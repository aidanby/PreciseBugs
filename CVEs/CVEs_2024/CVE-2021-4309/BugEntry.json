{"buggy_code": ["<?PHP\n/* \n\t01ACP - Copyright 2008 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\t\u2584bersicht \u00b3ber zentral zur Verf\u00b3gung stehende Arrays\n*/\n\n$menuecat = \"01acp_start\";\n$sitetitle = \"Dev-\u2584bersicht\";\n$filename = $_SERVER['PHP_SELF'];\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata['level'] == 10){\n?>\n\n<b>$userdata</b><br /><code>\n<?PHP echo print_r($userdata); ?>\n</code>\n\n<br /><br />\n\n<b>$settings</b><br /><code>\n<?PHP echo print_r($settings); ?>\n</code>\n\n<br /><br />\n\n<b>$module</b><br /><code>\n<?PHP echo print_r($module); ?>\n</code>\n\n<br /><br />\n\n<b>$inst_module</b><br /><code>\n<?PHP echo print_r($inst_module); ?>\n</code>\n\n<br /><br />\n\n<b>$mysql_tables</b><br /><code>\n<?PHP echo print_r($mysql_tables); ?>\n</code>\n\n<br /><br />\n\n<b>$picendungen</b><br /><code>\n<?PHP echo print_r($picendungen); ?>\n</code>\n\n<br /><br />\n\n<b>$attachmentendungen</b><br /><code>\n<?PHP echo print_r($attachmentendungen); ?>\n</code>\n\n<br /><br />\n\n<?PHP\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n// 01ACP Copyright 2008 by Michael Lorer - 01-Scripts.de\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tModulseiten laden\n*/\n\n// Config-Dateien\ninclude(\"system/main.php\");\n\nif(!isset($_REQUEST['loadpage'])) $_REQUEST['loadpage'] = \"\";\n\n$menuecat = $modul;\n$sitetitle = $module[$modul]['instname'];\n$filename = $_SERVER['PHP_SELF'].\"?modul=\".$modul.\"&amp;loadpage=\".$_REQUEST['loadpage'];\n\ninclude(\"system/head.php\");\n\nif(isset($_GET['modul']) && $_GET['modul'] == \"01acp\")\n\techo \"<script>redirect(\\\"acp.php\\\");</script>\";\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata[$modul] == 1){\n\n//echo $modulpath.$loadfile[$_REQUEST['loadpage']];\nif(isset($loadfile[$_REQUEST['loadpage']]) && file_exists($modulpath.$loadfile[$_REQUEST['loadpage']]) && !is_dir($modulpath.$loadfile[$_REQUEST['loadpage']]))\n\tinclude_once($modulpath.$loadfile[$_REQUEST['loadpage']]);\nelseif(file_exists($modulpath.$loadfile['index']) && !is_dir($modulpath.$loadfile['index']))\n\tinclude_once($modulpath.$loadfile['index']);\nelse\n\techo \"<p class=\\\"meldung_error\\\">Fehler: Es konnte keine zum Modul <i>\".$module[$modul]['instname'].\"</i>\n\t\t\tpassende Datei geladen werden.</p>\";\n\n\n\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n// 01ACP Copyright 2008 by Michael Lorer - 01-Scripts.de\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2013 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tStartseite des ACP-Bereich\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_start\";\n$sitetitle = \"Startseite\";\n$mootools_use = array(\"moo_core\",\"moo_more\",\"moo_slideh\",\"moo_request\");\n$filename = $_SERVER['PHP_SELF'];\n\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0){\ninclude_once(\"system/includes/tt.php\");\n\n// 01-Scripts.de RSS-Feed neu vom Server holen\nif($settings['cachetime']+CACHE_TIME_01RSS < time() && $flag_showacpRSS){\n\tgetXML2Cache(ACPSTART_RSSFEED_URL,RSS_CACHEFILE);\n\tgetXML2Cache(HTTP_VERSIONSINFO_DATEILINK,LOKAL_VERSIONSINFO_DATEILINK);\n\t}\n\n// Neue Versions-XML vom 01-Scripts.de-Server holen\nif($settings['cachetime']+CACHE_TIME < time() && $userdata['module'] == 1){\n\tgetXML2Cache(HTTP_VERSIONSINFO_DATEILINK,LOKAL_VERSIONSINFO_DATEILINK);\n\t}\n\n$xml = @simplexml_load_file(LOKAL_VERSIONSINFO_DATEILINK);\nif($xml && $xml->_01acp->version > $settings['acpversion'] && $userdata['module'] == 1)\n\t$newerversion = \" <a href=\\\"\".$xml->_01acp->updateurl.\"\\\" target=\\\"_blank\\\"><b class=\\\"yellow\\\">Update verf\u5790bar!</b></a>\";\nelse\n\t$newerversion = \"\"; \n\n?>\n\n<div class=\"acp_startbox\">\n<p align=\"center\">Herzlich Willkommen im <b class=\"yellow\">A</b>dmin <b class=\"yellow\">C</b>ontrol <b class=\"yellow\">P</b>anel</p>\n\n<div class=\"acp_doubleinnerbox\">\n\t<p style=\"float:left; margin-right:15px; margin-top:17px;\"><b>Was m\u943chten Sie tun?</b></p>\n\t<br />\n\t<form action=\"_loader.php\" method=\"get\">\n\t\t<select name=\"modul\" size=\"1\" class=\"input_select2\" onchange=\"location.href='_loader.php?modul='+this.options[this.selectedIndex].value+''\">\n\t\t\t<?PHP echo create_ModulDropDown(TRUE); ?>\n\t\t</select>\n\t\t<input name=\"input2\" type=\"submit\" class=\"input2\" value=\"Modul ausw&auml;hlen und arbeiten &raquo;\" />\n\t</form>\n</div>\n\n<div class=\"acp_innerbox\">\n\t<h4>Informationen</h4>\n\t<p>\n\t\t<b>01ACP-Version:</b> <?PHP echo $settings['acpversion'].$newerversion; ?><br />\n\t\t<br />\n\t\t<b>Benutzer:</b> <?PHP list($usermenge) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['user'].\" WHERE id!='0'\")->fetch_array(MYSQLI_NUM); echo $usermenge; ?><br />\n\t\t<b>Dateien:</b> <?PHP list($filemenge) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['files'].\" WHERE filetype='file'\")->fetch_array(MYSQLI_NUM); echo $filemenge; ?><br />\n\t\t<b>Bilder:</b> <?PHP list($picmenge) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['files'].\" WHERE filetype='pic'\")->fetch_array(MYSQLI_NUM); echo $picmenge; ?>\n\t\t<br /><br />\n\t\t<a href=\"http://board.01-scripts.de\" target=\"_blank\">Supportforum &amp; FAQ &raquo;</a><br />\n\t\t<a href=\"http://www.01-scripts.de/contact.php\" target=\"_blank\">Kontakt &raquo;</a><br />\n\t\t<br />\n\t\t<a href=\"http://www.01-scripts.de/lizenz.php\" target=\"_blank\">Lizenzbestimmungen &raquo;</a>\n\t</p>\n</div>\n<div class=\"acp_innerbox\">\n<?PHP \nif($flag_showacpRSS && ACPSTART_RSSFEED_URL != \"\")\n\t$rss01 = @simplexml_load_file(RSS_CACHEFILE);\nelse\n\t$rss01 = FALSE;\n\nif($flag_showacpRSS && ACPSTART_RSSFEED_URL != \"\" && $rss01){  \n\techo \"<h4>01-Scripts.de - News</h4>\";\n\tfor($x=0;$x<4;$x++){\n\t\techo \"<p>\".substr($rss01->channel->item->$x->pubDate,0,25).\"<br />\";\n\t\techo \"<a href=\\\"\".$rss01->channel->item->$x->link.\"\\\" target=\\\"_blank\\\"><b>\";\n\t\techo utf8_decode($rss01->channel->item->$x->title);\n\t\techo \"</b></a></p>\";\n\t\t}\n\t}\nelse{\n\techo \"<h4>Tipps &amp; Tricks</h4>\";\n\t\n\t$rand_tt = array_rand($tt, 3);\n\t\n\techo \"<ul>\\n\";\n\tforeach($rand_tt as $tippnr){\n\t\techo \"<li>\".$tt[$tippnr].\"</li>\\n\";\n\t}\n\techo \"\\n</ul>\";\n\t}\n ?>\n</div>\n<br />\n\n</div>\n<?PHP\n$rand_tt = array_rand($tt, 1);\necho \"<p align=\\\"center\\\"><b>Tipp:</b> \".$tt[$rand_tt].\"</p>\";\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2013 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tKommentare verwalten\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_comments\";\n$sitetitle = \"Kommentare verwalten\";\n$mootools_use = array(\"moo_core\",\"moo_more\",\"moo_slideh\",\"moo_request\");\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n$filename = $_SERVER['PHP_SELF'].\"?modul=\".$modul.\"\";\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata['editcomments'] == 1){\n\necho \"<h1>Kommentare verwalten</h1>\";\n\necho \"<p class=\\\"meldung_erfolg\\\" id=\\\"del_erfolgsmeldung\\\" style=\\\"display:none;\\\">\n\tDer Kommentar wurde erfolgreich gel&ouml;scht.\n</p>\";\n\nif($modul != \"01acp\"){\n\n\t// Selektierte Kommentare l\u98c9chen\n\tif(isset($_POST['cdelid']) && !empty($_POST['cdelid']) && \n\t   isset($_POST['delselected']) && $_POST['delselected'] == 1){\n\t\t$cup = 0;\n\t\tforeach($_POST['cdelid'] as $delid){\n\t\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['comments'].\" WHERE modul='\".$mysqli->escape_string($modul).\"' AND id='\".$mysqli->escape_string($delid).\"' LIMIT 1\");\n\t\t\t$cup++;\n\t\t\t}\n\t\techo \"<p class=\\\"meldung_erfolg\\\">Es wurden \".$cup.\" Kommentare gel&ouml;scht</p>\";\n\t\t}\n\t\n\t// Alle Kommentare eines Beitrags l\u98c9chen\n\tif(isset($_GET['delpostid']) && !empty($_GET['delpostid']) && isset($_GET['do']) && $_GET['do'] == \"dodelall\"){\n\t\tif(isset($_GET['delsubpostid']) && !empty($_GET['delsubpostid']) && $_GET['delsubpostid'] != 0)\n\t\t\tdelSubPostComments($_GET['delpostid'],$_GET['delsubpostid']);\n\t\telse\n\t\t\tdelComments($_GET['delpostid']);\n\t\t\n\t\techo \"<p class=\\\"meldung_erfolg\\\">Kommentare wurden gel&ouml;scht</p>\";\n\t\t}\n\t\t\n\t\n\tif(isset($_GET['postid']) && !empty($_GET['postid']) && isset($_GET['do']) && $_GET['do'] == \"deleteall\"){\n\t\techo \"<p class=\\\"meldung_frage\\\">M&ouml;chten Sie wirklich alle zum Eintrag <i>\".stripslashes($_GET['ptitel']).\"</i>\n\t\t\tgeh&ouml;renden <b>Kommentare komplett l&ouml;schen?</b><br />\n\t\t\t<br />\n\t\t\t<a href=\\\"\".$filename.\"&amp;do=dodelall&amp;delsubpostid=\".$_GET['subpostid'].\"&amp;delpostid=\".$_GET['postid'].\"&amp;commentsites=\".$_GET['commentsites'].\"\\\">JA</a> | <a href=\\\"javascript:history.back();\\\">Nein</a></p>\";\n\t\t}\n\t// Kommentare zu einem bestimmten Post / Subpost auflisten\n\telseif(isset($_GET['postid']) && !empty($_GET['postid'])){\n\t\t// Kommentare zu Sub-Posts auflisten:\n\t\tif(isset($_GET['subpostid']) && !empty($_GET['subpostid'])){\n\t\t\t$sites = 0;\n\t\t\t$query = \"SELECT id,postid,subpostid,frei,utimestamp,ip,autor,email,message,smilies,bbc FROM \".$mysql_tables['comments'].\" WHERE postid='\".$mysqli->escape_string($_GET['postid']).\"' AND subpostid='\".$mysqli->escape_string($_GET['subpostid']).\"' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY utimestamp DESC\";\n\t\t\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\t\t\n\t\t\t$list = $mysqli->query($query);\n\t\t\t\n\t\t\techo \"<h2>Kommentare bearbeiten <img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Stift + Block\\\" title=\\\"bearbeiten\\\" /></h2>\";\n\t\t\techo \"<p><a href=\\\"\".$filename.\"&amp;showsub=1&amp;postid=\".$_GET['postid'].\"\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t\t\t\n\t\t\techo \"<p><a href=\\\"\".$filename.\"&amp;postid=\".$_GET['postid'].\"&amp;subpostid=\".$_GET['subpostid'].\"&amp;do=deleteall&amp;ptitel=\\\">Alle zu diesem Eintrag geh&ouml;renden Kommentare l&ouml;schen &raquo;</a></p>\";\n\t\t\t\n\t\t\techo getCommentList($query,\"free\");\n\t\t\t\n\t\t\techo echopages($sites,\"80%\",\"site\",\"modul=\".$modul.\"&amp;postid=\".$_GET['postid'].\"&amp;subpostid=\".$_GET['subpostid']);\n\t\t\t}\n\t\t// Sub-POSTS selber auflisten:\n\t\telseif(isset($_GET['showsub']) && $_GET['showsub'] == 1 && function_exists(\"_\".$module[$modul]['modulname'].\"_getCommentChildTitle\")){\n\t\t\t$csites = 0;\n\t\t\t$menge = 0;\n\t\t\t$query = \"SELECT DISTINCT subpostid FROM \".$mysql_tables['comments'].\" WHERE frei = '1' AND modul='\".$mysqli->escape_string($modul).\"' AND postid = '\".$mysqli->escape_string($_GET['postid']).\"' ORDER BY (subpostid*'1') DESC\";\n\t\t\t$query = makepages($query,$csites,\"commentsites\",ACP_PER_PAGE);\n\t\t\t\n\t\t\techo \"<h2>Kommentare bearbeiten <img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Stift + Block\\\" title=\\\"bearbeiten\\\" /></h2>\";\n\t\t\t\n\t\t\techo \"<p><a href=\\\"\".$filename.\"\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t\t\t\n\t\t\techo getCommentPostList($query,\"child\");\n\t\t\t\n\t\t\techo echopages($csites,\"80%\",\"commentsites\",\"modul=\".$modul.\"&amp;postid=\".$_GET['postid'].\"&amp;showsub=1\");\n\t\t\t}\n\t\t// Kommentare zu Posts auflisten:\n\t\telse{\n\t\t\t$sites = 0;\n\t\t\t$query = \"SELECT id,postid,frei,utimestamp,ip,autor,email,message,smilies,bbc FROM \".$mysql_tables['comments'].\" WHERE postid='\".$mysqli->escape_string($_GET['postid']).\"' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY utimestamp DESC\";\n\t\t\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\t\t\n\t\t\t$list = $mysqli->query($query);\n\t\t\t\n\t\t\techo \"<h2>Kommentare bearbeiten <img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Stift + Block\\\" title=\\\"bearbeiten\\\" /></h2>\";\n\t\t\techo \"<p><a href=\\\"\".$filename.\"\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t\t\t\n\t\t\techo \"<p><a href=\\\"\".$filename.\"&amp;postid=\".$_GET['postid'].\"&amp;do=deleteall&amp;ptitel=\\\">Alle zu diesem Eintrag geh&ouml;renden Kommentare l&ouml;schen &raquo;</a></p>\";\n\t\t\t\n\t\t\techo getCommentList($query,\"free\");\n\t\t\t\n\t\t\techo echopages($sites,\"80%\",\"site\",\"modul=\".$modul.\"&amp;postid=\".$_GET['postid']);\n\t\t\t}\n\t\t}\n\telse{\n\t\t// Kommentare, die freigeschaltet werden m\u5aa0sen auflisten:\n\t\t$sites = 0;\n\t\t$menge = 0;\n\t\t$query = \"SELECT id,postid,utimestamp,ip,autor,email,message,smilies,bbc FROM \".$mysql_tables['comments'].\" WHERE frei = '0' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY utimestamp DESC\";\n\t\t$query = makepages($query,$sites,\"commentfreesite\",ACP_PER_PAGE);\n\t\t\n\t\t$list = $mysqli->query($query);\n\t\t$menge = $list->num_rows;\n\t\t\n\t\tif($menge > 0){\n\t\t\n\t\t\techo \"<h2>Kommentare freischalten <img src=\\\"images/icons/ok.gif\\\" alt=\\\"OK\\\" title=\\\"freischalten\\\" /></h2>\";\n\t\t\techo getCommentList($query,\"free\");\n\t\t\t\n\t\t\techo echopages($sites,\"80%\",\"commentfreesite\",\"modul=\".$modul.\"\");\n\t\t\t}\n\n\t\t// Posts mit Kommentaren auflisten:\n\t\t$csites = 0;\n\t\t$menge = 0;\n\t\t$query = \"SELECT DISTINCT postid FROM \".$mysql_tables['comments'].\" WHERE frei = '1' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY (postid*'1') DESC\";\n\t\t$query = makepages($query,$csites,\"commentsites\",ACP_PER_PAGE);\n\t\t\n\t\techo \"<h2>Kommentare bearbeiten <img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Stift + Block\\\" title=\\\"bearbeiten\\\" /></h2>\";\n\t\t\n\t\techo getCommentPostList($query);\n\t\t\n\t\techo echopages($csites,\"80%\",\"commentsites\",\"modul=\".$modul.\"\");\n\t\t}// Ende: Auflistung der Kommentare zu einem bestimmten Post\n\t}\nelse{\n\techo \"<div class=\\\"meldung_hinweis\\\"><p><b>Bitte w&auml;hlen Sie ein Modul</b></p>\".\n\t\tcreate_ModulForm($_SERVER['PHP_SELF'].\"?\",\"input\",TRUE).\"</div>\";\n\t}\n\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2013 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tDatei- & Bildverwaltung (Hochgeladenen Bilder und andere Dateien verwalten sowie neue Dateien hochladen)\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_filemanager\";\n$sitetitle = \"Datei- &amp; Bildverwaltung\";\n$filename = $_SERVER['PHP_SELF'];\n$mootools_use = array(\"moo_core\",\"moo_more\",\"moo_remooz\",\"moo_request\",\"moo_dragdrop\");\n\n\nif(!isset($_REQUEST['type'])) $_REQUEST['type'] = \"\";\nif(!isset($_REQUEST['search'])) $_REQUEST['search'] = \"\";\nif(!isset($_REQUEST['dir'])) $_REQUEST['dir'] = \"\";\n\n$filename2 = $filename.\"?type=\".$_REQUEST['type'].\"&amp;search=\".$_REQUEST['search'].\"&amp;dir=\".$_REQUEST['dir'];\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\nif(!isset($_REQUEST['uid'])) $_REQUEST['uid'] = \"\";\n\n// Sicherheitsabfrage: Login & Benutzerrechte f\u00fcr Dateimanager\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata['dateimanager'] >= 1){\n\n\tswitch($_REQUEST['type']){\n\t  case \"pic\":\n\t    echo \"<h1>Bildverwaltung</h1>\";\n\t  break;\n\t  case \"file\":\n\t    echo \"<h1>Dateiverwaltung</h1>\";\n\t  break;\n\t  default:\n\t    echo \"<h1>Datei- &amp; Bildverwaltung</h1>\";\n\t  break;\n\t  }\n\n\techo \"<p>\";\n\t// Darf neues Verzeichnis erstellen?\n\tif($userdata['dateimanager'] == 2){\n?>\n\t<a href=\"javascript: hide_unhide('adddir');\" class=\"actionbutton\">\n\t\t<img src=\"images/icons/add.gif\" alt=\"Plus-Icon\" title=\"Neues Verzeichnis anlegen\" style=\"border:0; margin-right:10px;\" />Neues Verzeichnis anlegen\n\t</a>\n<?PHP\n\t\t}\n\t\n\t// Berechtigung f\u00fcr Upload vorhanden?\n\tif($userdata['upload'] == 1){\n?>\n\t<!-- <a href=\"javascript: hide_unhide('uploadbox');\" class=\"actionbutton\"> -->\n\t<a href=\"javascript:popup('fmanageruploader','','','',620,480);\" class=\"actionbutton\">\n\t\t<img src=\"images/icons/icon_upload.gif\" alt=\"Neue Datei/Bild hochladen\" style=\"border:0; margin-right:10px;\" />Neue Datei / Bild hochladen\n\t</a>\n\t<?PHP } ?>\n</p>\n\n<?PHP\n\t// Berechtigung f\u00fcr Upload vorhanden?\n\tif($userdata['dateimanager'] == 2){\n\t\n\t$display = \"none\";\n\t// Verzeichnis anlegen\n\tif(isset($_POST['create_new_dir']) && $_POST['create_new_dir'] == 1 &&\n\t   isset($_POST['new_verzname']) && !empty($_POST['new_verzname'])){\n\t\t//Eintragung in Datenbank vornehmen:\n\t\t$sql_insert = \"INSERT INTO \".$mysql_tables['filedirs'].\" (parentid,utimestamp,name,uid) VALUES (\n\t\t\t\t\t'\".$mysqli->escape_string($_POST['parentfiledirid']).\"',\n\t\t\t\t\t'\".time().\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_POST['new_verzname']).\"',\n\t\t\t\t\t'\".$userdata['id'].\"'\n\t\t\t\t\t)\";\n\t\t$mysqli->query($sql_insert);\n\t\t\n\t\t$display = \"block\";\n\t\techo \"\n<script type=\\\"text/javascript\\\">\nSuccess_standard();\n</script>\";\n\t\t}\n\telseif(isset($_POST['create_new_dir']) && $_POST['create_new_dir'] == 1){\n\t\t$display = \"block\";\n\t\techo \"\n<script type=\\\"text/javascript\\\">\nShowAjaxError('<b>Fehler:</b><br />Sie haben nicht alle ben&ouml;tigen Felder ausgef&uuml;llt!');\n</script>\";\t\t\n\t\t}\n\t\t\n\t// Markierte Dateien l\u00f6schen\n\tif(isset($_POST['delselected']) && $_POST['delselected'] == 1 &&\n\t   isset($_POST['delfiles'])){\n\t\tif(!is_array($_POST['delfiles']))\n\t\t    $_POST['delfiles'] = array($_POST['delfiles']);\n\t\t\n\t\t$cup = 0;\n\t\tforeach($_POST['delfiles'] as $fileid){    \n\t\t\t$list = $mysqli->query(\"SELECT filetype,name,uid FROM \".$mysql_tables['files'].\" WHERE id='\".$mysqli->escape_string($fileid).\"' LIMIT 1\");\n\t\t\twhile($row = $list->fetch_assoc()){\n\t\t\t\t\n\t\t\t\tif($userdata['dateimanager'] == 2 || $userdata['dateimanager'] == 1 && $row['uid'] == $userdata['id']){\n\t\t\t\t\tswitch($row['filetype']){\n\t\t\t\t\t  case \"pic\":\n\t\t\t\t\t    if(delfile($picuploaddir,$row['name']))\n\t\t\t\t\t        $cup++;\n\t\t\t\t\t    break;\n\t\t\t\t\t  case \"file\":\n\t\t\t\t\t    if(delfile($attachmentuploaddir,$row['name']))\n\t\t\t\t\t        $cup++;\n\t\t\t\t\t    break;\n\t\t\t\t\t  }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t    }\n\t\techo \"<p class=\\\"meldung_erfolg\\\">\n\t\tEs wurden \".$cup.\" Dateien erfolgreich gel&ouml;scht.\n\t\t</p>\";\n\t\t}\n\telseif(isset($_POST['delfiles']))\n\t    echo \"<p class=\\\"meldung_hinweis\\\">\n\t\t<b>Bitte markieren Sie die <span style=\\\"color:#B00;\\\">Checkbox</span> unten, um die Dateien wirklich zu l&ouml;schen!</b>\n\t\t</p>\";\n?>\n\n<div id=\"adddir\" style=\"display: <?PHP echo $display; ?>;\">\n<form action=\"filemanager.php\" method=\"post\">\n\t<input type=\"text\" size=\"34\" name=\"new_verzname\" class=\"input_text\" />\n\t<select name=\"parentfiledirid\" size=\"1\" class=\"input_select\">\n\t\t<option value=\"0\">Kein Unterverzeichnis</option>\n\t\t<?PHP echo getFileVerz_Rek(0,0,-1,\"echo_FileVerz_select\",0); ?>\n\t</select>\n\t<input type=\"submit\" value=\"Anlegen &raquo;\" class=\"input\" />\n\t<input type=\"hidden\" name=\"create_new_dir\" value=\"1\" />\n</form>\n</div>\n\n<?PHP\n\t\t}\n\n\tif(isset($_GET['sort']) && $_GET['sort'] == \"desc\") $sortorder = \"DESC\";\n\telse{ $sortorder = \"ASC\"; $_GET['sort'] = \"ASC\"; }\n\t\n\tif(isset($_REQUEST['search']) && !empty($_REQUEST['search']) && $_REQUEST['search'] != \"Nach Dateiennamen suchen\") $where = \" WHERE orgname LIKE '%\".$mysqli->escape_string($_REQUEST['search']).\"%'\";\n\telse{ $where = \" WHERE 1 = 1\"; $_GET['search'] = \"\"; }\n\t\n\tif(isset($_REQUEST['dir']) && !empty($_REQUEST['dir']) && is_numeric($_REQUEST['dir'])) $where .= \" AND dir = '\".$mysqli->escape_string($_REQUEST['dir']).\"' \";\n\telse{ $_REQUEST['dir'] = 0; $where .= \" AND dir = '0' \"; }\n\t\n\tif($userdata['dateimanager'] == 1) $where .= \" AND uid='\".$userdata['id'].\"' \";\n\t\n\tif(isset($_REQUEST['uid']) && !empty($_REQUEST['uid']) && $userdata['dateimanager'] == 2) $where .= \" AND uid='\".$mysqli->escape_string($_REQUEST['uid']).\"' \";\n\t\n\tif(isset($_REQUEST['type']) && ($_REQUEST['type'] == \"pic\" || $_REQUEST['type'] == \"file\")) $where .= \" AND filetype = '\".$mysqli->escape_string($_REQUEST['type']).\"'\";\n\telse $_GET['type'] = \"\";\n\n\tif(!isset($_GET['orderby'])) $_GET['orderby'] = \"\";\n\tswitch($_GET['orderby']){\n\t  case \"downloads\":\n\t    $orderby = \"downloads+0 \".$sortorder.\",orgname,id\";\n\t  break;\n\t  case \"filename\":\n\t    $orderby = \"orgname,id\";\n\t  break;\n\t  case \"size\":\n\t    $orderby = \"size+0 \".$sortorder.\",orgname,id\";\n\t  break;\n\t  case \"date\":\n\t    $orderby = \"utimestamp \".$sortorder.\",orgname,id\";\n\t  break;  \n\t  default:\n\t    $orderby = \"utimestamp DESC,orgname,id\";\n\t  break;\n\t  }\n\n\t$sites = 0;\n\t$query = \"SELECT * FROM \".$mysql_tables['files'].\"\".$where.\" ORDER BY \".$orderby.\" \".$sortorder;\n\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\n\n\t// Fehlermeldung bei erfolgloser Suche\n\tif($sites == 0 && isset($_GET['search']) && !empty($_GET['search']))\n\t\techo \"<p class=\\\"meldung_error\\\">Es konnte leider kein Benutzer zu Ihrer Sucheingabe \\\"\".$_GET['search'].\"\\\" gefunden werden!<br />\n\t\t\tBitte probieren Sie es erneut.</p>\";\n?>\n<form action=\"<?PHP echo $filename; ?>\" method=\"get\">\n\t<p><input type=\"text\" name=\"search\" value=\"Nach Dateiennamen suchen\" size=\"30\" onfocus=\"clearField(this);\" onblur=\"checkField(this);\" class=\"input_search\" /> \n\t<select name=\"type\" size=\"1\" class=\"input_select\"><option value=\"\">Dateien &amp; Bilder</option><option value=\"pic\">Nur Bilder</option><option value=\"file\">Nur Dateien</option></select>\n\t<input type=\"submit\" value=\"Suchen &raquo;\" class=\"input\" /></p>\n</form>\n\n<p class=\"meldung_erfolg\" id=\"del_erfolgsmeldung\" style=\"display:none;\">\n\tDie Datei wurde erfolgreich gel&ouml;scht.\n</p>\n\n<p class=\"meldung_erfolg\" id=\"ers_erfolgsmeldung\" style=\"display:none;\">\n\tDie Datei wurde erfolgreich ersetzt!\n</p>\n\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen trab\">\n\n    <tr>\n\t\t<td style=\"width:10px;\" align=\"center\"><!--Mehrfach-L\u00f6schen--></td>\n\t\t<td style=\"width:70px;\" align=\"center\"><img src=\"images/icons/refresh.gif\" alt=\"Refresh-Icon\" title=\"Seite neu laden\" onclick=\"document.location.reload(true);\" /></td>\n        <td><b>Dateiname</b>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=asc&amp;orderby=filename\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=desc&amp;orderby=filename\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t\t<span style=\"float:right;\">\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=asc&amp;orderby=downloads\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=desc&amp;orderby=downloads\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t\t</span>\n\t\t</td>\n\t\t<td style=\"width:90px;\"><b>Gr\u00f6\u00dfe</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=asc&amp;orderby=size\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=desc&amp;orderby=size\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td style=\"width:90px;\"><b>Datum</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=asc&amp;orderby=date\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=desc&amp;orderby=date\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td style=\"width:130px;\"><b>Benutzer</b></td>\n\t\t<td style=\"width:20px;\">&nbsp;<!--Ersetzen--></td>\n\t\t<td style=\"width:20px;\" align=\"center\"><!--L\u00f6schen--><img src=\"images/icons/icon_trash.gif\" alt=\"M&uuml;lleimer\" title=\"Datei l&ouml;schen\" /></td>\n    </tr>\n\n<?PHP\necho getFilelist($query,$filename2.\"&amp;sort=\".$_GET['sort'].\"&amp;orderby=\".$_GET['orderby'].\"\",TRUE,TRUE,TRUE,TRUE,\"\");\n?>\n\n    <tr>\n\t\t<td align=\"center\" style=\"border: 1px solid #B00;\"><input type=\"checkbox\" name=\"delselected\" value=\"1\" /></td>\n\t\t<td colspan=\"7\" align=\"left\">\n\t\t\t<input type=\"submit\" name=\"sending\" value=\"Markierte Dateien l&ouml;schen\" class=\"input\" />\n\t\t\tEs erfolgt <b>keine</b> weitere Abfrage!\n\t\t</td>\n\t</tr>\n\n</form>\n</table>\n<br />\n\n<?PHP\necho echopages($sites,\"80%\",\"site\",\"search=\".$_GET['search'].\"&amp;type=\".$_GET['type'].\"&amp;sort=\".$_GET['sort'].\"&amp;orderby=\".$_GET['orderby'].\"&amp;dir=\".$_REQUEST['dir'].\"\").\"<br />\";\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2015 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tLogin-Formular f\u50e1 ACP-Bereich\n\t#fv.131#\n*/\n\n$dontshow = true;\n$menuecat = \"login\";\n$sitetitle = \"Anmelden\";\n$filename = $_SERVER['PHP_SELF'];\n$message = \"\";\n$menge = 0;\n$error = 1;\n$des_cookie = \"\";\n\nif(!isset($_POST['username'])) $_POST['username'] = \"\";\n\n// Config-Dateien\ninclude(\"system/main.php\");\n\n//Logout\nif(isset($_GET['action']) && $_GET['action'] == \"logout\"){\n    session_destroy();\n\n\tif(isset($_COOKIE[$instnr.'_start_auth_01acp'])){\n\t\t$des_cookie = $_COOKIE[$instnr.'_start_auth_01acp'];\n\t\tsetcookie($instnr.\"_start_auth_01acp\", \"\", time() - 3600);\n\t\t}\n\n\tif(!empty($des_cookie))\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET cookiehash='\".sha1(mt_rand().time().$salt.$instnr).\"', sessionhash='\".sha1(mt_rand().time().$salt.$instnr.$filename).\"' WHERE (cookiehash='\".$mysqli->escape_string($des_cookie).\"' OR id = '\".$userdata['id'].\"') AND id != '0' LIMIT 1\");\n\telse\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET sessionhash='\".sha1(mt_rand().time().$salt.$instnr.$filename).\"' WHERE id = '\".$userdata['id'].\"' AND id != '0' LIMIT 1\");\n    \n\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"index.php?logout=1\\\");</script>\";\n    $message .= \"<p class=\\\"meldung_hinweis\\\"><b>Sie werden weitergeleitet.</b><br />Falls Ihr Browser keine Weiterleitung unterst\u6164zt klicken Sie bitte <a href=\\\"index.php?logout=1\\\">hier</a>.</p>\";\n    }\nif(isset($_GET['logout']) && $_GET['logout'] == 1)\n    $message = \"<p class=\\\"meldung_ok\\\"><b>Sie wurden erfolgreich abgemeldet.</b></p>\";\n\n\n// Cookie vorhanden?\nif(isset($_COOKIE[$instnr.'_start_auth_01acp']) && !empty($_COOKIE[$instnr.'_start_auth_01acp']) && strlen($_COOKIE[$instnr.'_start_auth_01acp']) == 40 && !isset($_GET['action']) && !isset($_GET['logout'])){\n\t$list = $mysqli->query(\"SELECT id,username,userpassword,startpage,cookiehash,sessionhash FROM \".$mysql_tables['user'].\" WHERE cookiehash='\".$mysqli->escape_string($_COOKIE[$instnr.'_start_auth_01acp']).\"' AND id != '0' LIMIT 1\");\n\t$menge = $list->num_rows;\n\twhile($row = $list->fetch_assoc()){\n\t\t// Session erstellen/abrufen / Lastlogin speichern\n\t\tif(empty($row['sessionhash'])){\n\t\t\t$sessionhash = sha1(mt_rand().time().$salt.$instnr.$row['id'].$row['username'].$row['startpage']);\n\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET lastlogin='\".time().\"', sessionhash='\".$sessionhash.\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t}\n\t\telse{\n\t\t\t$sessionhash = $row['sessionhash'];\n\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET lastlogin='\".time().\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t}\n\n\t\t$_SESSION['01_idsession_'.sha1($salt)] = $row['id'];\n\t\t$_SESSION['01_passsession_'.sha1($salt)] = $sessionhash;\n\t\t\n\t\t//Weiterleiten:\n\t\tif($row['startpage'] == \"01acp\")\n\t\t\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"acp.php\\\");</script>\";\n\t\telse\n\t\t\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"_loader.php?modul=\".$row['startpage'].\"\\\");</script>\";\n\t\t$message .= \"<p class=\\\"meldung_ok\\\"><b>Login erfolgreich, Sie werden weitergeleitet.</b><br />Falls Ihr Browser keine Weiterleitung unterst&uuml;tzt klicken Sie bitte <a href=\\\"acp.php\\\">hier</a>.</p>\";\n\t\t}\n\n\t}\n\t\n// Login wurde abgeschickt\nif(isset($_POST['send']) && $_POST['send'] == 1){\n\n\tif($settings['acp_captcha4login'] == 0 || $settings['acp_captcha4login'] == 1 && ($settings['spamschutz'] == 1 && isset($_POST['antispam']) && md5($_POST['antispam']) == $_SESSION['antispam01'] || $settings['spamschutz'] == 2 && CheckReCAPTCHA($_POST['g-recaptcha-response'])) ){\n\n\t\t$list = $mysqli->query(\"SELECT id,username,userpassword,startpage,cookiehash,sessionhash FROM \".$mysql_tables['user'].\" WHERE username='\".$mysqli->escape_string($_POST['username']).\"' AND id != '0' LIMIT 1\");\n\t\twhile($row = $list->fetch_assoc()){\n\t\t\t// Check password for this user:\n\t\t\tif(pwhashing2($_POST['password'],$row['id']) != $row['userpassword']){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t\t$error = 0;\n\n\t\t\t// Session erstellen/abrufen / Lastlogin speichern\n\t\t\tif(empty($row['sessionhash'])){\n\t\t\t\t$sessionhash = sha1(mt_rand().time().$salt.$instnr.$row['id'].$row['username'].$row['startpage']);\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET lastlogin='\".time().\"', sessionhash='\".$sessionhash.\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t\t}\n\t\t\telse{\n\t\t\t\t$sessionhash = $row['sessionhash'];\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET lastlogin='\".time().\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t\t}\n\t\t\t$_SESSION['01_idsession_'.sha1($salt)] = $row['id'];\n\t\t\t$_SESSION['01_passsession_'.sha1($salt)] = $sessionhash;\n\t\t\t\n\t\t\t// Cookie erstellen\n\t\t\tif(isset($_POST['setcookie']) && $_POST['setcookie'] == 1){\n\t\t\t\tif(empty($row['cookiehash'])){\n\t\t\t\t\t$cookiehash = sha1(mt_rand().time().$salt.$instnr);\n\t\t\t\t\t\n\t\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET cookiehash='\".$cookiehash.\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t\t\t\t$row['cookiehash'] = $cookiehash;\n\t\t\t\t\t}\n\t\t\t\tsetcookie($instnr.\"_start_auth_01acp\",$row['cookiehash'],time()+60*60*24*14);\n\t\t\t\t}\n\t\t\t\n\t\t\t//Weiterleiten:\n\t\t\tif($row['startpage'] == \"01acp\")\n\t\t\t\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"acp.php\\\");</script>\";\n\t\t\telse\n\t\t\t\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"_loader.php?modul=\".$row['startpage'].\"\\\");</script>\";\n\t\t\t$message .= \"<p class=\\\"meldung_ok\\\"><b>Login erfolgreich, Sie werden weitergeleitet.</b><br />Falls Ihr Browser keine Weiterleitung unterst&uuml;tzt klicken Sie bitte <a href=\\\"acp.php\\\">hier</a>.</p>\";\n\t\t\t}\n\t\t\t\n\t\tif($error == 1)\n\t\t\t$message = \"<p class=\\\"meldung_error\\\"><b>Login war nicht erfolgreich!</b><br />Bitte &uuml;berpr&uuml;fen Sie\n\t\t\t\tBenutzernamen und Passwort und probieren Sie es erneut.</p>\";\n\t\t}\n\telse\n\t\t$message = \"<p class=\\\"meldung_error\\\"><b>Login nicht m&ouml;glich!</b><br />\n\t\t\tBitte f&uuml;llen Sie das Captcha korrekt aus!</p>\"; \n    }\n// \u9201erpr\u3639en des Passwort-Zusenden-Formulars\nelseif(isset($_POST['send']) && $_POST['send'] == 2){\n\t$list = $mysqli->query(\"SELECT id,username,mail FROM \".$mysql_tables['user'].\" WHERE (username='\".$mysqli->escape_string($_POST['username']).\"' OR mail='\".$mysqli->escape_string($_POST['email']).\"') AND id != '0' LIMIT 1\");\n\t$menge = $list->num_rows;\n\twhile($row = $list->fetch_assoc()){\n        $newpass = create_NewPassword(PW_LAENGE);\n        $newpassmd5 = pwhashing2($newpass, $row['id']);\n\n        // Datenbank aktualisieren:\n        $mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET userpassword='\".$newpassmd5.\"' WHERE id='\".$row['id'].\"'\");\n\n        $header = \"From:\".$settings['email_absender'].\"<\".$settings['email_absender'].\">\\n\";\n        $email_betreff = $settings['sitename'].\" - Neues Passwort f\u50e1 Administrationsbereich\";\n        $emailbody = \"Mit dieser E-Mail erhalten Sie ein neues Passwort f\u50e1 den Administrationsbereich\\n\\nName: \".stripslashes($row['username']).\"\\nE-Mail-Adresse: \".stripslashes($row['mail']).\"\\nNeues Passwort: \".$newpass.\"\\n\\n---\\nWebmailer\";\n\n        mail(stripslashes($row['mail']),$email_betreff,$emailbody,$header);\n\n        $message = \"<p class=\\\"meldung_ok\\\"><b>Ein neues Passwort wurde an Ihre E-Mail-Adresse verschickt.</b></p>\";\n\t\t}\n\n\tif($menge < 1)\n\t\t$message = \"<p class=\\\"meldung_error\\\"><b>Passwort konnte nicht zugestellt werden!</b><br />Bitte &uuml;berpr&uuml;fen Sie\n\t\t\tBenutzernamen / E-Mail-Adresse und probieren Sie es erneut.</p>\";\n    }\n\n\ninclude(\"system/head.php\");\necho $message;\n?>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<div class=\"box_centered\" id=\"loginform\" style=\"display:block;\">\n\t<h2>Login</h2>\n\t\n\t<p class=\"big\"><label for=\"input_username\">Benutzername:</label> <input type=\"text\" name=\"username\" value=\"<?PHP echo $_POST['username']; ?>\" id=\"input_username\" size=\"20\" /></p>\n\t<p class=\"big\"><span style=\"margin-right:38px;\"><label for=\"input_password\">Passwort:</label></span> <input type=\"password\" name=\"password\" id=\"input_password\" size=\"20\" /></p>\n<?php if($settings['acp_captcha4login'] == 1 && $settings['spamschutz'] == 2 && !empty($settings['ReCaptcha_PubKey']) &&  !empty($settings['ReCaptcha_PrivKey'])){ ?>\n\t<p class=\"big\"><span style=\"margin-right:18px;\"><?php echo create_Captcha($settings['spamschutz']); ?></span></p>\n<?php }elseif($settings['acp_captcha4login'] == 1 && $settings['spamschutz'] == 1){ ?>\n\t<p class=\"big\"><span style=\"margin-right:18px;\"><?php echo create_Captcha(); ?></span> <input type=\"text\" name=\"antispam\" size=\"20\" /></p>\n<?php } ?>\n\t<p class=\"big\"><span style=\"margin-right:18px;\"><label for=\"input_cookie\">2 Wochen eingeloggt bleiben?</label></span> <input type=\"checkbox\" name=\"setcookie\" id=\"input_cookie\" value=\"1\" /></p>\n\t<p class=\"small\"><a href=\"javascript: hide_unhide('loginform'); hide_unhide('passwordbox');\">Passwort vergessen?</a></p>\n\t<p align=\"right\"><input type=\"submit\" name=\"absenden\" class=\"input\" value=\"Einloggen &raquo;\" /></p>\n\n\t<input type=\"hidden\" name=\"send\" value=\"1\" />\n</div>\n</form>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<div class=\"box_centered\" id=\"passwordbox\" style=\"display:none;\">\n\t<h2>Passwort vergessen?</h2>\n\t<p>Benutzername <b>ODER</b> E-Mail-Adresse eingeben:</p>\n\t\n\t<p class=\"big\"><label for=\"forgotpw_username\">Benutzername:</label> <input type=\"text\" name=\"username\" value=\"<?PHP if(isset($_POST['username'])){ echo $_POST['username']; } ?>\" id=\"forgotpw_username\" size=\"20\" /></p>\n\t<p class=\"big\"><label for=\"forgotpw_email\">E-Mail-Adresse:</label> <input type=\"text\" name=\"email\" value=\"<?PHP if(isset($_POST['email'])){ echo $_POST['email']; } ?>\" id=\"forgotpw_email\" size=\"20\" /></p>\n\t<p class=\"small\"><a href=\"javascript: hide_unhide('loginform'); hide_unhide('passwordbox');\">&laquo; Zur&uuml;ck zum Login</a></p>\n\t<p align=\"right\"><input type=\"submit\" name=\"absenden\" class=\"input\" value=\"Neues Passwort anfordern &raquo;\" /></p>\n\n\t<input type=\"hidden\" name=\"send\" value=\"2\" />\n</div>\n</form>\n\n<p align=\"center\">Um den Administrationsbereich nutzen zu k\u9735nen m\u5aa0sen Sie \n<a href=\"http://de.wikipedia.org/wiki/HTTP-Cookie\" target=\"_blank\">Cookies</a> aktiviert haben.</p>\n\n<img src=\"images/layout/img04.gif\" alt=\"Layout-Bild\" style=\"display:none;\" />\n\n<?PHP\nif($menge < 1 && isset($_POST['send']) && $_POST['send'] == 2){\n\techo \"<script type=\\\"text/javascript\\\">\n\t\t<!--\n\t\thide_unhide('loginform');\n\t\thide_unhide('passwordbox');\n\t\t-->\n\t\t</script>\";\n\t}\n?>\n\n<?PHP\ninclude(\"system/foot.php\");\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2014 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tModule verwalten\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_module\";\n$sitetitle = \"Module verwalten\";\n$filename = $_SERVER['PHP_SELF'];\n$flag_stopupdate = FALSE;\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata['module'] == 1){\n\n// Neue Versions-XML vom 01-Scripts.de-Server holen\nif($settings['cachetime']+CACHE_TIME < time()){\n\tgetXML2Cache(HTTP_VERSIONSINFO_DATEILINK,LOKAL_VERSIONSINFO_DATEILINK);\n\t}\n$vinfoxml = @simplexml_load_file(LOKAL_VERSIONSINFO_DATEILINK);\n\n\n\n\n\n\n// Neues Modul installieren (Step 1)\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 1 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\")){\n\n\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\n\techo \"<h1>\".$xml->titel.\" installieren</h1>\";\n\t\n\t// ID-Namen auf Sonderzeichen \u00fcberpr\u00fcfen\n\t$err = \"\";\n\t$err2 = false;\n\tforeach($forbidden_chars as $char){\n\t\tif(strchr($_REQUEST['modul'],$char)) $err .= $char;\n\t\t}\n\n\t// Maximale L\u00e4nge von 25 Zeichen \u00fcberpr\u00fcfen\n\tif(strlen($_REQUEST['modul']) > 25) $err2 = true;\n\n\tif($xml->need01acpv <= $settings['acpversion'] && empty($err) && !$err2){\n?>\n\n<p class=\"meldung_hinweis\">\n\tDer Benutzer mit dem Sie momentan angemeldet sind (<i><?PHP echo $userdata['username']; ?></i>)\n\terh&auml;lt f&uuml;r das Modul alle Administrations- &amp; Benutzerrechte.<br />\n\tAllen anderen Benutzern m&uuml;ssen die Rechte <b>nachtr&auml;glich</b> entsprechend zugeteilt werden \n\t(&uuml;ber <i>Benutzer bearbeiten</i>).\n</p>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\" width=\"35%\"><b>Installationsname*</b><br /><span class=\"small\">Der eingegebene Name erscheint in der Dropdown-Modulauswahl (oben rechts).</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"instname\" value=\"<?PHP echo $xml->titel; ?>\" size=\"50\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><input type=\"reset\" value=\"Zur&uuml;cksetzen\" class=\"input\" /></td>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"install\" />\n\t\t\t<input type=\"hidden\" name=\"modul\" value=\"<?PHP echo $_REQUEST['modul']; ?>\" />\n\t\t\t<input type=\"hidden\" name=\"step\" value=\"2\" />\n\t\t\t<input type=\"submit\" value=\"Weiter &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n\n</table>\n</form><br />\n\n<?PHP\n\t\t}\n\telseif(!empty($err))\n\t\techo \"<p class=\\\"meldung_error\\\">Bitte entfernen Sie alle Sonderzeichen aus dem Verzeichnisnamen des Moduls:<br />\n\t\t\t\tAktueller Verzeichnisname: <b>\".$_REQUEST['modul'].\"</b><br />\n\t\t\t\tZu entfernende Zeichen: <b>\".$err.\"</b></p>\";\n\telseif($err2)\n\t\techo \"<p class=\\\"meldung_error\\\">Bitte w&auml;hlen Sie einen Verzeichnisnamen mit weniger als 25 Zeichen!</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Um das gew&uuml;nschte Modul zu installieren ben&ouml;tigen Sie die\n\t\t\t\tVersion \".$xml->need01acpv.\" des 01ACP.<br />\n\t\t\t\tBitte aktualisieren Sie zuerst das 01ACP!</p>\";\n\t}\n// Installation: Step 2\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['instname']) && !empty($_REQUEST['instname']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 2 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\")){\n\t\n\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\n\t// N\u00e4chste Modul-Nummer aus DB holen (f\u00fcr mehrere Parallelinstallationen)\n\t$newnr = 0;\n\t$list = $mysqli->query(\"SELECT nr FROM \".$mysql_tables['module'].\" WHERE modulname = '\".$mysqli->escape_string($xml->name).\"' ORDER BY nr DESC LIMIT 1\");\n\twhile($row = $list->fetch_assoc()){\n\t\t$newnr = $row['nr'];\n\t\t}\n\t$newnr = $newnr+1;\n\t\n\t// Modul in DB eintragen\n\t$sql_insert = \"INSERT INTO \".$mysql_tables['module'].\" (nr,aktiv,modulname,instname,idname,version,serialized_data) VALUES (\n\t\t\t\t\t'\".$newnr.\"',\n\t\t\t\t\t'1',\n\t\t\t\t\t'\".$mysqli->escape_string($xml->name).\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_REQUEST['instname']).\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_REQUEST['modul']).\"',\n\t\t\t\t\t'\".$mysqli->escape_string($xml->version).\"',\n\t\t\t\t\t''\n\t\t\t\t\t)\";\n\t$result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\t\n\t// CatID von cat_modulaccess holen:\n\t$list = $mysqli->query(\"SELECT catid FROM \".$mysql_tables['rights'].\" WHERE idname='cat_modulaccess' LIMIT 1\");\n\twhile($row = $list->fetch_assoc()){\n\t\t$catid = $row['catid'];\n\t\t}\n\t\n\t// SortID der Datens\u00e4tze von cat_modulaccess holen:\n\t$sortid = 0;\n\t$list = $mysqli->query(\"SELECT sortid FROM \".$mysql_tables['rights'].\" WHERE catid='\".$catid.\"' AND is_cat='0' ORDER BY sortid DESC LIMIT 1\");\n\twhile($row = $list->fetch_assoc()){\n\t\t$sortid = $row['sortid'];\n\t\t}\n\t$sortid = $sortid+1;\n\t\n\t// Neues Benutzerrecht anlegen\n\t$sql_insert = \"INSERT INTO \".$mysql_tables['rights'].\" (modul,is_cat,catid,sortid,idname,name,exp,formename,formwerte,input_exp,standardwert,nodelete,hide,in_profile) VALUES (\n\t\t\t\t\t'01acp',\n\t\t\t\t\t'0',\n\t\t\t\t\t'\".$catid.\"',\n\t\t\t\t\t'\".$sortid.\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_REQUEST['modul']).\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_REQUEST['instname']).\"',\n\t\t\t\t\t'',\n\t\t\t\t\t'Zugriff erlaubt|Zugriff verboten',\n\t\t\t\t\t'1|0',\n\t\t\t\t\t'',\n\t\t\t\t\t'0',\n\t\t\t\t\t'1',\n\t\t\t\t\t'0',\n\t\t\t\t\t'0')\";\n\t$result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\t\n\t// Datenbankspalte f\u00fcr neues Recht erzeugen\n\t$mysqli->query(\"ALTER TABLE `\".$mysql_tables['user'].\"` ADD `01acp_\".$mysqli->escape_string($_REQUEST['modul']).\"` TINYINT( 1 ) NOT NULL DEFAULT '0'\");\n\t\n\t// Aktuellem Benutzer Zugriff gestatten\n\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET 01acp_\".$mysqli->escape_string($_REQUEST['modul']).\"='1' WHERE id='\".$userdata['id'].\"'\");\n?>\n<h1>Installation wird fortgesetzt</h1>\n\n<p class=\"meldung_hinweis\"><b>Bitte legen Sie sp&auml;testens jetzt ein Backup Ihrer MySQL-Datenbank an!</b></p>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\" colspan=\"2\">Der n&auml;chste Schritt kann einige Zeit in Anspruch nehmen (bis zu 60s).<br />\n\t\t<b>Bitte unterbrechen Sie den Vorgang nicht!</b> Es werden SQL-Befehle zur Installation des\n\t\tModuls ausgef&uuml;hrt.</td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\">&nbsp;</td>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"install\" />\n\t\t\t<input type=\"hidden\" name=\"modul\" value=\"<?PHP echo $_REQUEST['modul']; ?>\" />\n\t\t\t<input type=\"hidden\" name=\"step\" value=\"3\" />\n\t\t\t<input type=\"submit\" value=\"Weiter &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n\n</table>\n</form><br />\n<?PHP\n\t}\n// Installation: Step 3 (Bigdump)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 3 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\") &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_sql_install.sql\")){\n\t\n\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\n\t// Modul-Infos aus DB holen\n\t$sql_modulnr = 1;\n\t$sql_modulidname = \"\";\n\t$list = $mysqli->query(\"SELECT nr,idname FROM \".$mysql_tables['module'].\" WHERE modulname = '\".$mysqli->escape_string($xml->name).\"' ORDER BY nr DESC LIMIT 1\");\n\twhile($row = $list->fetch_assoc()){\n\t\t$sql_modulnr = $row['nr'];\n\t\t$sql_modulidname = $row['idname'];\n\t\t}\n\t\t\n\t$sql_filename \t= $moduldir.$_REQUEST['modul'].\"/_sql_install.sql\";     // Specify the dump filename to suppress the file selection dialog\n\t$sql_erfolglink = \"<a href=\\\"\".$filename.\"?action=install&amp;modul=\".$_REQUEST['modul'].\"&amp;step=4\\\">Weiter &raquo;</a>\";\n\tinclude_once(\"system/sql_bigdump.php\");\n\t\n\t}\n// Installation: Step 4 (Iframe oder Ausgabe der Erfolgsmeldung)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 4 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\")){\n\t\n\t// Install-Datei (wenn vorhanden) in einem IFrame anzeigen\n\tif(file_exists($moduldir.$_REQUEST['modul'].\"/_install.php\"))\n\t\tinclude_once($moduldir.$_REQUEST['modul'].\"/_install.php\");\n\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['module'].\" SET aktiv='1' WHERE idname='\".$mysqli->escape_string($_REQUEST['modul']).\"'\");\n\t\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\t\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Das Modul wurde erfolgreich installiert!</b></p>\";\n\t\techo $xml->includeinfo;\n\t\t\n\t}\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n// UPDATE: Step 1 (Passendes Update aus XML ausw\u00e4hlen)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"update\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 1 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\")){\n\t$options = \"\";\n\n\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\n\tif($xml->need01acpv <= $settings['acpversion']){\n\t\n\t\tforeach($xml->updates as $updates){\n\t\t\tforeach($updates as $update){\n\t\t\t\t// Abfrage funktioniert aus ungekl\u00e4rter Ursache nicht ohne md5()\n\t\t\t\tif($update->startv == $module[$_REQUEST['modul']]['version'] && md5($update->zielv) == md5($xml->version))\n\t\t\t\t\t$options .= \"<option value=\\\"\".$update->action.\"\\\">Version \".$update->startv.\" nach \".$update->zielv.\"</option>\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\tif(empty($options) || !isset($options)){\n\t\t\t$options = \"<option value=\\\"0\\\">Es konnte keine passende Version gefunden werden</option>\";\n\t\t\t$flag_stopupdate = TRUE;\n\t\t\t}\n\t\t}\n\telse{\n\t\t$options = \"<option value=\\\"0\\\">Bitte aktualisieren Sie zuerst das 01ACP auf die Version \".$xml->need01acpv.\" !</option>\";\n\t\t$flag_stopupdate = TRUE;\n\t\t}\n?>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\">Bitte w&auml;hlen Sie das passende Update aus.<br />\n\t\t\t<br />\n\t\t\t<b>Beispiel:</b> Wenn Sie von Version 1.0.0.0 auf Version 1.0.0.3 aktualisieren m&ouml;chten,\n\t\t\tm&uuml;ssen <b class=\"red\">alle dazwischenliegende Updates</b> in der richtigen Reihenfolgen\n\t\t\t<b class=\"red\">einzeln(!)</b> installiert werden:<br />\n\t\t\tVersion 1.0.0.0 -&gt; Version 1.0.0.1 (passendes Update-Paket herunterladen!)<br />\n\t\t\tVersion 1.0.0.1 -&gt; Version 1.0.0.2 (passendes Update-Paket herunterladen!)<br />\n\t\t\tVersion 1.0.0.2 -&gt; Version 1.0.0.3 (passendes Update-Paket herunterladen!)<br />\n\t\t\t<b class=\"red\">Bitte achten Sie darauf, dass Sie mit dem ERSTEN Update-Paket (z.B. 1.0.0.0 nach 1.0.0.1) starten und wirklich alle ge&auml;nderten\n\t\t\tDateien &uuml;berschreiben.<br />\n\t\t\tStarten Sie dann hier den ERSTEN Update-Prozess (z.B. 1.0.0.0 nach 1.0.0.1)<br />\n\t\t\tund nehmen Sie ERST DANN das n&auml;chste Update (z.B. 1.0.0.1 nach 1.0.0.2, etc.) vor!</b></td>\n    </tr>\n\n\t<tr>\n\t\t<td class=\"trb\"><select name=\"update\" size=\"1\" class=\"input_select2\"><?PHP echo $options; ?></select></td>\n\t</tr>\n<?PHP if(!$flag_stopupdate){ ?>\n    <tr>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"update\" />\n\t\t\t<input type=\"hidden\" name=\"modul\" value=\"<?PHP echo $_REQUEST['modul']; ?>\" />\n\t\t\t<input type=\"hidden\" name=\"step\" value=\"2\" />\n\t\t\t<input type=\"submit\" value=\"Update starten &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n<?PHP } ?>\n</table>\n</form><br />\n\n<?PHP\t\n\t}\n// UPDATE: Step 2 (Update-Datei mit entsprechendem $_REQUEST-Parameter f\u00fcr richtigen Einsteig aufrufen)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"update\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['update']) && !empty($_REQUEST['update']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 2 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\") &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_updates.php\")){\n\t\n\tinclude_once($moduldir.$_REQUEST['modul'].\"/_updates.php\");\n\t\n\t}\n\n\n\n\n\n\n\n\n\n// MODUL L\u00d6SCHEN (Abfrage)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"delete\" &&\n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_functions.php\") &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_headinclude.php\")){\n\t\n\tif(function_exists(\"_\".$module[$modul]['modulname'].\"_DeleteModul\"))\t\n\t\techo \"<p class=\\\"meldung_error\\\">M&ouml;chten Sie das Modul <b>\".$_REQUEST['modul'].\"</b> wirklich komplett\n\t\tund unwiderruflich l&ouml;schen?<br />\n\t\t<br />\n\t\t<b>Bitte beachten Sie: Dieser Vorgang kann nicht r&uuml;ckg&auml;ngig gemacht werden.<br />\n\t\tLegen Sie ggf. vor dem Fortfahren ein Backup Ihrer Datenbank an!</b><br />\n\t\t<br />\n\t\t<a href=\\\"\".$filename.\"?action=dodelete&amp;modul=\".$_REQUEST['modul'].\"\\\">Ja, ich m&ouml;chte das \".$_REQUEST['modul'].\"-Modul unwiderruflich l&ouml;schen</a> | <b><a href=\\\"module.php\\\">Nein, abbrechen</a></b></p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">F&uuml;r dieses Modul existiert leider noch keine L&ouml;sch-Routine.<br />\n\t\tDiese Funktion wird mit dem n&auml;chsten Update des Moduls nachgeliefert.<br />\n\t\t<br />\n\t\t<a href=\\\"module.php\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t}\t\n// MODUL L\u00d6SCHEN (Durchf\u00fchren)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"dodelete\" &&\n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_functions.php\") &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_headinclude.php\")){\n\n\tif(function_exists(\"_\".$module[$modul]['modulname'].\"_DeleteModul\")){\n\t\t// Modul-Eintrag entfernen\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['module'].\" WHERE idname = '\".$modul.\"' LIMIT 1\");\n\t\t\n\t\t// Men\u00fc-Eintr\u00e4ge entfernen\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['menue'].\" WHERE modul = '\".$modul.\"'\");\n\t\t\n\t\t// Settings entfernen\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['settings'].\" WHERE modul = '\".$modul.\"'\");\n\t\t\n\t\t// Rechte entfernen\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['rights'].\" WHERE modul = '\".$modul.\"'\");\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['rights'].\" WHERE modul = '01acp' AND idname = '\".$modul.\"' LIMIT 1\");\n\t\t$mysqli->query(\"ALTER TABLE `\".$mysql_tables['user'].\"` DROP `01acp_\".$modul.\"`\");\n\t\t\n\t\t// ACP-Startseite ggf zur\u00fccksetzen\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET startpage = '01acp' WHERE startpage = '\".$modul.\"'\");\n\t\t\n\t\t// Modulspezifische Aufr\u00e4umarbeiten\n\t\tcall_user_func(\"_\".$module[$modul]['modulname'].\"_DeleteModul\");\n\t\t\n\t\techo \"<p class=\\\"meldung_ok\\\">Das Modul <b>\".$_REQUEST['modul'].\"</b> wurde erfolgreich\n\t\taus der Datenbank entfernt<br />\n\t\tSie k&ouml;nnen nun per FTP-Programm das Verzeichnis <i>01scripts/01module/\".$modul.\"</i> l&ouml;schen.<br />\n\t\t<br />\n\t\t<a href=\\\"module.php\\\">Zur&uuml;ck zur Modul-&Uuml;bersicht</a></p>\";\n\t\t}\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">F&uuml;r dieses Modul existiert leider noch keine L&ouml;sch-Routine.<br />\n\t\tDiese Funktion wird mit dem n&auml;chsten Update des Moduls nachgeliefert.<br />\n\t\t<br />\n\t\t<a href=\\\"module.php\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t}\n\t\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n// Fehlermeldungen ausgeben\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" ||\n\tisset($_REQUEST['action']) && $_REQUEST['action'] == \"update\"){\n\n\techo \"<p class=\\\"meldung_error\\\"><b>Fehler:</b> Es wurden nicht alle n&ouml;tigen Parameter &uuml;bergeben oder\n\t\t\tes konnten nicht alle n&ouml;tigen Dateien f&uuml;r den weiteren Installations/Update-Prozess gefunden werden.<br />\n\t\t\tBitte &uuml;berpr&uuml;fen Sie, ob Sie alle n&ouml;tigen Dateien hochgeladen haben und starten Sie den Vorgang ggf.\n\t\t\terneut.<br />\n\t\t\t<a href=\\\"module.php\\\">Zur&uuml;ck zur &Uuml;bersicht &raquo;</a><br />\n\t\t\t<br />\n\t\t\tSollten auch weitern Fehler oder Probleme auftreten, wenden Sie sich bitte an den \n\t\t\t<a href=\\\"http://board.01-scripts.de/\\\" target=\\\"_blank\\\">Support</a>.</p>\";\n\n\t}\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n// Module auflisten\nelse{\n?>\n\n<h1>Module verwalten</h1>\n\n<?PHP\n// Module aktiv / deaktiv setzen\nif(isset($_GET['aktiv']) && ($_GET['aktiv'] == 1 || $_GET['aktiv'] == 0) && $_GET['aktiv'] != \"\" && isset($_GET['modul']) && !empty($_GET['modul'])){\n\t$mysqli->query(\"UPDATE \".$mysql_tables['module'].\" SET aktiv='\".$mysqli->escape_string($_GET['aktiv']).\"' WHERE idname='\".$mysqli->escape_string($_GET['modul']).\"'\");\n\t\n\techo \"\n<script type=\\\"text/javascript\\\">\nredirect('module.php')\n</script>\";\n\t}\n?>\n\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n\t\t<td class=\"tra\" style=\"width:20px;\">&nbsp;</td>\n\t\t<td class=\"tra\" style=\"width:35px;\">&nbsp;</td>\n        <td class=\"tra\" style=\"width:110px;\"><b>Modul-ID-Name</b></td>\n        <td class=\"tra\" style=\"width:20px;\"><b>Nr.</b></td>\n\t\t<td class=\"tra\"><b>Titel</b></td>\n\t\t<td class=\"tra\" style=\"width:100px;\"><b>Version</b></td>\n\t\t<td class=\"tra\" style=\"width:30px;\">&nbsp;<!-- Info --></td>\n\t\t<td class=\"tra\" style=\"width:30px;\">&nbsp;<!-- Deaktivieren --></td>\n\t\t<td class=\"tra\" style=\"width:30px;\">&nbsp;<!-- L\u00f6schen --></td>\n\t</tr>\n\n<?PHP\n$count = 0;\n$readverz = opendir($moduldir);\nwhile($dir = readdir($readverz)){\n\tif($dir != \".\" && $dir != \"..\" && file_exists($moduldir.$dir.\"/_info.xml\") && $dir != \"01example\")\n        {\n\t\t$xml = simplexml_load_file($moduldir.$dir.\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\t\n\t\tif(isset($module[$dir]['modulname'])) $xml_modname = \"_\".$module[$dir]['modulname'];\n\t\tif(!isset($module[$dir]['idname'])) $module[$dir]['idname'] = \"\";\n\t\t\n\t\tif(file_exists($moduldir.$dir.\"/\".$xml->icon) && $xml->icon != \"\")\n\t\t\t$icon = \"<img src=\\\"\".$moduldir.$dir.\"/\".$xml->icon.\"\\\" alt=\\\"Icon\\\" title=\\\"\".$xml->titel.\"\\\" />\";\n\t\telse $icon = \"\";\n\t\t\n\t\t$del\t = \"<a href=\\\"\".$filename.\"?action=delete&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/cancel.gif\\\" alt=\\\"Rotes X\\\" title=\\\"Modul l&ouml;schen\\\" /></a>\";\n\t\tif(!in_array($dir,$inst_module)){\n\t\t\t$install = \"<a href=\\\"\".$filename.\"?action=install&amp;modul=\".$dir.\"&amp;step=1\\\"><img src=\\\"images/icons/icon_install.gif\\\" alt=\\\"Plus-Symbol\\\" title=\\\"Modul \".$xml->titel.\" installieren\\\" /></a>\";\n\t\t\t$installed = \" <b class=\\\"red\\\">*nicht installiert*</b>\";\n\t\t\t$vcolorclass = \"\";\n\t\t\t$warning = \"<img src=\\\"images/icons/add.gif\\\" alt=\\\"Plus-Symbol\\\" title=\\\"Modul \".$xml->titel.\" installieren\\\" />\";\n\t\t\t$version = $xml->version;\n\t\t\t$titel = $xml->titel;\n\t\t\t$deaktiv = \"\";\n\t\t\t$del\t = \"\";\n\t\t\t}\n\t\telseif(in_array($dir,$inst_module) && $module[$dir]['version'] < $xml->version){\n\t\t\t$install = \"<a href=\\\"\".$filename.\"?action=update&amp;modul=\".$dir.\"&amp;step=1\\\"><img src=\\\"images/icons/icon_update.gif\\\" alt=\\\"Plus-Symbol\\\" title=\\\"Modul \".$xml->titel.\" aktualisieren\\\" /></a>\";\n\t\t\t$installed = \" <b class=\\\"red\\\">*installiert - UPDATE m&ouml;glich*</b>\";\n\t\t\t$vcolorclass = \"red\";\n\t\t\t$warning = \"<img src=\\\"images/icons/warning.gif\\\" alt=\\\"Warnung\\\" title=\\\"Modul \".$xml->titel.\" aktualisieren!\\\" />\";\n\t\t\t$version = $module[$dir]['version'];\n\t\t\t$titel = $module[$dir]['instname'];\n\t\t\tif($module[$dir]['aktiv'] == 1)\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=0&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_deaktivieren.gif\\\" alt=\\\"Stop-Icon\\\" title=\\\"Modul deaktivieren (wird im ACP nicht mehr angezeigt)\\\" /></a>\";\n\t\t\telse\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=1&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_aktivieren.gif\\\" alt=\\\"Play-Icon\\\" title=\\\"Modul aktivieren (wird im ACP wieder angezeigt)\\\" /></a>\";\n\t\t\t}\n\t\telseif(in_array($dir,$inst_module) && $module[$dir]['version'] < $vinfoxml->$xml_modname->version){\n\t\t\t$install = \"<a href=\\\"\".$vinfoxml->$xml_modname->updateurl.\"\\\" target=\\\"_blank\\\"><img src=\\\"images/icons/icon_update.gif\\\" alt=\\\"Plus-Symbol\\\" title=\\\"Modul \".$xml->titel.\" aktualisieren\\\" /></a>\";\n\t\t\t$installed = \" <a href=\\\"\".$vinfoxml->$xml_modname->updateurl.\"\\\" target=\\\"_blank\\\"><b class=\\\"red\\\">*installiert - UPDATE vorhanden!*</b></a>\";\n\t\t\t$vcolorclass = \"red\";\n\t\t\t$warning = \"<img src=\\\"images/icons/warning.gif\\\" alt=\\\"Warnung\\\" title=\\\"Modul \".$xml->titel.\" aktualisieren!\\\" />\";\n\t\t\t$version = $module[$dir]['version'];\n\t\t\t$titel = $module[$dir]['instname'];\n\t\t\tif($module[$dir]['aktiv'] == 1)\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=0&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_deaktivieren.gif\\\" alt=\\\"Stop-Icon\\\" title=\\\"Modul deaktivieren (wird im ACP nicht mehr angezeigt)\\\" /></a>\";\n\t\t\telse\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=1&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_aktivieren.gif\\\" alt=\\\"Play-Icon\\\" title=\\\"Modul aktivieren (wird im ACP wieder angezeigt)\\\" /></a>\";\n\t\t\t}\n\t\telseif(in_array($dir,$inst_module) && $module[$dir]['version'] >= $xml->version){\n\t\t\t$install = \"<a href=\\\"javascript:hide_unhide_tr('_\".$module[$dir]['idname'].\"');\\\"><img src=\\\"images/icons/kreis_frage.gif\\\" alt=\\\"Fragezeichen\\\" title=\\\"Informationen zum Einbinden des Moduls ein/ausblenden\\\" /></a>\";\n\t\t\t$installed = \" <b class=\\\"green\\\">*installiert*</b>\";\n\t\t\t$vcolorclass = \"green\";\n\t\t\t$warning = \"<img src=\\\"images/icons/ok.gif\\\" alt=\\\"OK-Symbol\\\" title=\\\"Alles ok\\\" />\";\n\t\t\t$version = $module[$dir]['version'];\n\t\t\t$titel = $module[$dir]['instname'];\n\t\t\tif($module[$dir]['aktiv'] == 1)\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=0&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_deaktivieren.gif\\\" alt=\\\"Stop-Icon\\\" title=\\\"Modul deaktivieren (wird im ACP nicht mehr angezeigt)\\\" /></a>\";\n\t\t\telse\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=1&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_aktivieren.gif\\\" alt=\\\"Play-Icon\\\" title=\\\"Modul aktivieren (wird im ACP wieder angezeigt)\\\" /></a>\";\n\t\t\t}\n\n\t\tif(!isset($module[$dir]['nr'])) $module[$dir]['nr'] = \"\";\n\n\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\techo \"<tr>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$warning.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$icon.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\">\".$module[$dir]['idname'].\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$module[$dir]['nr'].\"</td>\n\t\t<td class=\\\"\".$class.\"\\\"><b>\".$titel.\"</b>\".$installed.\"<br />\".$xml->beschreibung.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\"><b class=\\\"\".$vcolorclass.\"\\\">\".$version.\"</b></td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$install.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$deaktiv.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$del.\"</td>\n</tr>\";\n\n\t\techo \"<tr id=\\\"_\".$module[$dir]['idname'].\"\\\" style=\\\"display:none;\\\">\n\t\t<td class=\\\"\".$class.\"\\\" colspan=\\\"9\\\">\".$xml->includeinfo.\"</td>\n</tr>\";\n        }\n\tclearstatcache(); \n    }\n?>\n\n</table>\n<br />\n\n\n<?PHP\n} // Ende: Module auflisten\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2014 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tBenutzerrechte verwalten (hinzuf\u00fcgen & sortieren)\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_users\";\n$sitetitle = \"Benutzerverwaltung : Rechteverwaltung\";\n$filename = $_SERVER['PHP_SELF'];\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0){\n\n// Sicherheitsabfrage: Userberechtigungen (Einstellungen erstellen / sortieren)\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_right\" && $userdata['rights'] == 1 && $userdata['level'] == 10){\n\t\n\t// Eintragung in Datenbank vornehmen\n\tif(isset($_POST['send']) && $_POST['send'] == 1){\n\t\t$sql_insert = \"INSERT INTO \".$mysql_tables['rights'].\" (modul,is_cat,catid,sortid,idname,name,exp,formename,formwerte,input_exp,standardwert,nodelete,hide,in_profile) VALUES (\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['modulname']).\"',\n\t\t\t\t\t\t'0',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['catid']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['sortid']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['idname']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['name']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['exp']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['formename']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['formwerte']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['input_exp']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['standardwert']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['nodelete']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['hide']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['in_profile']).\"')\";\n\t\t$result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\t\t\n\t\t//Datenbankspalte erzeugen\n\t\tif($_POST['formwerte'] == \"text\")\n\t\t\t$query = \"ALTER TABLE `\".$mysql_tables['user'].\"` ADD `\".$mysqli->escape_string($_POST['modulname']).\"_\".$mysqli->escape_string($_POST['idname']).\"` TEXT NOT NULL DEFAULT '\".$mysqli->escape_string($_POST['standardwert']).\"'\";\n\t\telse\n\t\t\t$query = \"ALTER TABLE `\".$mysql_tables['user'].\"` ADD `\".$mysqli->escape_string($_POST['modulname']).\"_\".$mysqli->escape_string($_POST['idname']).\"` VARCHAR( 255 ) NOT NULL DEFAULT '\".$mysqli->escape_string($_POST['standardwert']).\"'\";\n\t\t\t\n\t\t$mysqli->query($query);\n\t\t\n\n\t\tif($userdata['devmode'] == 1){\n\t\t\techo htmlentities($sql_insert).\"<br />\";\n\t\t\techo htmlentities($query).\"<br /><br />\";\n\t\t\t}\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Datensatz wurde hinzugef\u00fcgt</b></p>\";\n\t\t}\n?>\n\n<h1>Benutzerrecht hinzuf&uuml;gen</h1>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td colspan=\"2\">Auf dieser Seite k&ouml;nnen neue Benutzerrechte hinzugef&uuml;gt werden, die dann zur Userverwaltung im Administrationsbereich verwendet werden k&ouml;nnen.<br />\n        Dieser Bereich ist normalerweise nur f\u00fcr Entwickler von Modifikationen f\u00fcr das 01ACP interessant. Ein Funktion zur Bearbeitung von Datens&auml;tzen\n        ist nicht vorhanden.<br />\n\t\tF\u00fcr jedes neue Benutzerrecht wird sowohl ein neuer Eintrag in der Tabelle <i><?PHP echo $mysql_tables['rights']; ?></i>\n\t\tangelegt, als auch in der Tabelle <i><?PHP echo $mysql_tables['user']; ?></i> f\u00fcr jedes \"Recht\" eine Spalte angelegt, die mit dem \n\t\teingetragenen Standardwert gef\u00fcllt wird.<br />\n        Fragen werden gerne im <a href=\"http://forum.01-scripts.de/\" target=\"_blank\">01-Supportforum</a> gerne beantwortet.</td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\" width=\"50%\"><b>Kategorie*:</b><br /><span class=\"small\">catid(tinyint,2)</span></td>\n        <td class=\"trb\" width=\"50%\">\n\t\t\t<select name=\"catid\" size=\"1\">\n\t\t\t<?PHP\n\t\t\t$cats_rights = getSettingCats(\"\",$mysql_tables['rights']);\n\t\t\t\n\t\t\t$x = 0;\n\t\t\tforeach($cats_rights as $catvalue){\n\t\t\t\techo \"<option value=\\\"\".$catvalue['catid'].\"\\\">\".$catvalue['modul'].\" &raquo; \".$catvalue['name'].\" (ID: \".$catvalue['catid'].\")</option>\\n\";\n\t\t\t\t$x++;\n\t\t\t\t}\n\t\t\t?>\n\t\t\t</select>\n\t\t</td>\n    </tr>\n\t\n    <tr>\n        <td class=\"tra\"><b>Modul*:</b><br /><span class=\"small\">modul(varchar,25)</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"modulname\" value=\"<?PHP if(isset($_POST['modulname'])) echo $_POST['modulname']; ?>\" size=\"25\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>SortID:</b><br /><span class=\"small\">sortid(int,5): Sortier-Reihenfolge innerhalb der Kategorien (catid)</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"sortid\" value=\"<?PHP if(isset($_POST['sortid'])) echo $_POST['sortid']+1; ?>\" size=\"2\" maxlength=\"5\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Idname (unique)*:</b><br /><span class=\"small\">idname(varchar,25): Eindeutiger Name um den Datensatz anzusprechen</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"idname\" value=\"\" size=\"25\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Name:</b><br /><span class=\"small\">name(varchar,50): Name des neuen \"Rechts\"</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"name\" value=\"\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Beschreibung:</b><br /><span class=\"small\">exp(text): Beschreibung zum Datensatz f\u00fcr die Benutzerverwaltung</span></td>\n        <td class=\"tra\"><textarea name=\"exp\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Formular-Type*:</b><br /><span class=\"small\">formename(text):<br /><b>1:</b> text = einfaches Textfeld<br /><b>2:</b> textarea = Textarea<br /><b>3:</b> wahl1|wahl2 = Radiobutton Wahl1 X Wahl2 X<br /><b>4:</b> wahl1|wahl2|wahl3|... = Auswahlliste<br /><b>5:</b> function = Funktionsaufruf von <i>modul_right_Idname()</i></span></td>\n        <td class=\"trb\"><textarea name=\"formename\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Formwerte*:</b><br /><span class=\"small\">formwerte(varchar,255):<br /><b>1:</b> 123 = size<br /><b>2:</b> 5|50 = rows|cols<br /><b>3:</b> Wert1|Wert2 = Zu speichernder Wert<br /><b>4:</b> Wert1|Wert2|Wert3|... = zu speichernde Werte<br /><b>5:</b> text|varchar = Feldtyp f&uuml;r die Rights-Tabelle</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"formwerte\" value=\"\" size=\"50\" maxlength=\"255\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Feld-Beschreibung:</b><br /><span class=\"small\">input_exp(varchar,50): Beschreibung nach dem Input-Feld</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"input_exp\" value=\"\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Standardwert:</b><br /><span class=\"small\">standardwert(text): Standardwert<br />(bei 3 und 4: -> =selected)</span></td>\n        <td class=\"tra\"><textarea name=\"standardwert\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Ausblenden (Benutzer):</b><br /><span class=\"small\">hide(tinyint,1): Einstellung beim Benutzer bearbeiten ausblenden? (1/0)</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"hide\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>In Profil:</b><br /><span class=\"small\">in_profile(tinyint,1): Kann der Inhalt dieses Feldes vom Benutzer selber in seinem Profil ge&auml;ndert werden?<br /><b>NICHT f\u00fcr sicherheitsrelevante Berechtigungen verwenden!</b></span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"in_profile\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\t\n    <tr>\n        <td class=\"trb\"><b>NoDelete:</b><br /><span class=\"small\">nodelete(tinyint,1): Benutzerrecht kann nicht mehr gel&ouml;scht werden.</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"nodelete\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\t\n    <tr>\n        <td class=\"tra\" colspan=\"2\">Mit <b>*</b> markierte Felder m&uuml;ssen ausgef&uuml;llt werden. Es erfolgt jedoch keine &Uuml;berpr&uuml;fung der Formulardaten.</td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\" align=\"left\"><input type=\"reset\" value=\"Zur\u00fccksetzen\" class=\"input\" /></td>\n        <td class=\"tra\" align=\"right\"><input type=\"hidden\" name=\"action\" value=\"add_right\" /><input type=\"hidden\" name=\"send\" value=\"1\" /><input type=\"submit\" value=\"Datensatz anlegen\" class=\"input\" /></td>\n    </tr>\n</table>\t\n</form>\n\n<?PHP\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_right\")\n\t\t$flag_loginerror = true;\n\n// Datens\u00e4tze neu sortieren\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"sort_rights\" && $userdata['rights'] == 1 && $userdata['level'] == 10){\n\t\n\techo \"<h1>Benutzerrechte sortieren</h1>\";\n\t\n\techo \"<div class=\\\"meldung_hinweis\\\"><p><b>Benutzerrechte eines anderen Moduls sortieren:</b></p>\".\n\tcreate_ModulForm($filename.\"?action=sort_settings&amp;\",\"input2\",TRUE).\"</div>\";\n\t\n\t$cats_settings = getSettingCats($modul,$mysql_tables['rights']);\n\t\n\t// Eintr\u00e4ge speichern\n\tif(isset($_POST['send']) && $_POST['send'] == 1){\n\t\n\t\t$list_save = $mysqli->query(\"SELECT id,sortid FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND modul='\".$mysqli->escape_string($modul).\"'\");\n\t\twhile($row_save = $list_save->fetch_assoc()){\n\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['rights'].\" SET sortid='\".$mysqli->escape_string($_POST[$row_save['id']]).\"' WHERE id='\".$row_save['id'].\"'\");\n\t\t\tif($userdata['devmode'] == 1) echo \"UPDATE \".$mysql_tables['rights'].\" SET sortid='\".$mysqli->escape_string($_POST[$row_save['id']]).\"' WHERE id='\".$row_save['id'].\"'<br />\\n\";\n\t\t\t}\n\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Gespeichert</b></p>\";\n\t\t}\n\t\t\n\n        echo \"<form action=\\\"\".$filename.\"?action=sort_rights&amp;modul=\".$modul.\"\\\" method=\\\"post\\\">\";\n        echo \"<ul>\\n\";\n\n\t\t$save1 = \"\";\n        $list = $mysqli->query(\"SELECT id,catid,sortid,name FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY catid,sortid\");\n        while($row = $list->fetch_assoc()){\n            if($save1 != $row['catid']) echo \"<li><h2>\".$cats_settings[$row['catid'].$modul]['name'].\"</h2></li>\";\n\t\t\techo \"<li><input type=\\\"text\\\" name=\\\"\".$row['id'].\"\\\" size=\\\"3\\\" value=\\\"\".$row['sortid'].\"\\\" maxlength=\\\"5\\\" /> \".$row['name'].\" <i>ID: \".$row['id'].\"</i></li>\\n\";\n\n\t\t\t$save1 = $row['catid'];\n            }\n        echo \"</ul>\\n\";\n\n        echo \"<p><input type=\\\"reset\\\" value=\\\"Reset &raquo;\\\" class=\\\"input\\\" /> <input type=\\\"submit\\\" value=\\\"Sortieren &raquo;\\\" class=\\\"input\\\" /><input type=\\\"hidden\\\" name=\\\"send\\\" value=\\\"1\\\" /></p>\";\n\n        echo \"</form>\";\n\t\t\n    }elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"sort_rights\") \n\t\t$flag_loginerror = true;\n\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2014 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tEinstellungen verwalten (bearbeiten, hinzuf\u00fcgen, sortieren)\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_settings\";\n$sitetitle = \"Einstellungen\";\n$filename = $_SERVER['PHP_SELF'];\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0){\n\n// Sicherheitsabfrage: Userberechtigungen (Einstellungen bearbeiten)\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"settings\" && $userdata['settings'] == 1){\n\t\n\techo \"<h1>Einstellungen</h1>\";\n\t\n    // Frage: Wirklich auf Standardwerte zur\u00fccksetzen?\n\tif(isset($_GET['do']) && $_GET['do'] == \"standard1\"){\n        echo \"<p class=\\\"meldung_frage\\\">\n              <b>Wollen Sie wirklich alle Einstellungen auf die Standardwerte zur&uuml;cksetzen?</b><br />\n              <br />\n              <a href=\\\"\".$filename.\"?action=\".$_GET['action'].\"&amp;do=standard2&amp;modul=\".$modul.\"\\\">JA</a> | <a href=\\\"\".$filename.\"?action=\".$_GET['action'].\"&amp;modul=\".$modul.\"\\\">Nein</a></p>\";\n        }\n\n    // Einstellungen auf Standardwerte zur\u00fccksetzen\n\tif(isset($_GET['do']) && $_GET['do'] == \"standard2\" && $userdata['addsettings'] == 1 && $userdata['settings'] == 1 && $userdata['level'] == 10){\n        $list_save = $mysqli->query(\"SELECT id,standardwert,wert FROM \".$mysql_tables['settings'].\" WHERE modul='\".$mysqli->escape_string($modul).\"' AND standardwert!='' AND hide='0'\");\n        while($row_save = $list_save->fetch_assoc()){\n            $mysqli->query(\"UPDATE \".$mysql_tables['settings'].\" SET wert='\".$row_save['standardwert'].\"' WHERE id='\".$row_save['id'].\"'\");\n            }\n        echo \"<p class=\\\"meldung_ok\\\"><b>Einstellungen wurden zur&uuml;ckgesetzt.</b></p>\";\n        }\n\n\t// Einstellungen speichern\n\tif(isset($_POST['do']) && $_POST['do'] == \"save\"){\n        $list_save = $mysqli->query(\"SELECT * FROM \".$mysql_tables['settings'].\" WHERE modul='\".$mysqli->escape_string($modul).\"' AND is_cat='0' AND hide='0'\");\n        while($row_save = $list_save->fetch_assoc()){\n\t\t\tif($row_save['formename'] == \"function\" && isset($_POST[$row_save['idname']]))\n            \t$mysqli->query(\"UPDATE \".$mysql_tables['settings'].\" SET wert='\".$mysqli->escape_string(call_RightSettingsFunction_Write($row_save['modul'],$row_save['idname'],$_POST[$row_save['idname']])).\"' WHERE id='\".$row_save['id'].\"'\");\n\t\t\telseif(isset($_POST[$row_save['idname']]))\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['settings'].\" SET wert='\".$mysqli->escape_string($_POST[$row_save['idname']]).\"' WHERE id='\".$row_save['id'].\"'\");\n            }\n        echo \"<p class=\\\"meldung_ok\\\"><b>Einstellungen wurden erfolgreich gespeichert.</b></p>\";\n        }\n\t\n\techo \"<div class=\\\"meldung_hinweis\\\"><p><b>Einstellungen eines anderen Moduls bearbeiten:</b></p>\".\n\tcreate_ModulForm($filename.\"?action=settings&amp;\",\"input2\",TRUE).\"</div>\";\n\t\n\t$cats_settings = getSettingCats($modul,$mysql_tables['settings']);\n\t\n\techo \"<form action=\\\"\".$filename.\"?action=\".$_GET['action'].\"&amp;modul=\".$modul.\"\\\" method=\\\"post\\\">\n<table border=\\\"0\\\" align=\\\"center\\\" width=\\\"100%\\\" cellpadding=\\\"3\\\" cellspacing=\\\"5\\\" class=\\\"rundrahmen\\\">\";\n\n    $count = 0;\n\t$x = 0;\n\tforeach($cats_settings as $catvalue){\n\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\n        echo \"\\n    <tr>\n        <td colspan=\\\"2\\\" class=\\\"\".$class.\"\\\"><h3>\".$catvalue['name'].\"</h3></td>\n    </tr>\";\n        \n        $list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['settings'].\" WHERE modul='\".$mysqli->escape_string($modul).\"' AND is_cat='0' AND catid='\".$catvalue['catid'].\"' AND hide='0' ORDER BY sortid\");\n        while($row = $list->fetch_assoc()){\n            if($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\n\t\t\t// MySQL-daten verarbeiten\n\t\t\techo parse_dynFieldtypes($row,$class,$count,\"01acp\");\n            }\n\n\t\t$x++;\n\t\t}\n\n    echo \"    <tr>\n        <td><input type=\\\"reset\\\" value=\\\"Werte zur&uuml;cksetzen\\\" class=\\\"input\\\" /></td>\n        <td align=\\\"right\\\"><input type=\\\"hidden\\\" name=\\\"modul\\\" value=\\\"\".$modul.\"\\\" /><input type=\\\"hidden\\\" name=\\\"do\\\" value=\\\"save\\\" /><input type=\\\"submit\\\" value=\\\"Speichern &raquo;\\\" class=\\\"input\\\" /></td>\n    </tr>\";\n\n    echo \"</table>\n          </form>\";\n\n    if($userdata['addsettings'] == 1 && $userdata['settings'] == 1 && $userdata['level'] == 10){\n        echo \"<p class=\\\"meldung_frage\\\"><b><a href=\\\"\".$filename.\"?action=\".$_GET['action'].\"&amp;do=standard1&amp;modul=\".$modul.\"\\\">Einstellungen auf Standardwerte zur&uuml;cksetzen?</a></b><br />\n\t\t\tIndividuelle &Auml;nderungen gehen dabei verloren!</p>\";\n        }\n\t\t\n    if($userdata['level'] == 10 && $userdata['devmode'] == 1){\n        echo \"<p class=\\\"meldung_hinweis\\\"><b><a href=\\\"_dev.php\\\">_dev.php aufrufen</a></b></p>\";\n        }\n\t\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"settings\")\n\t\t$flag_loginerror = true;\n\t\n// Sicherheitsabfrage: Userberechtigungen (Einstellungen erstellen / sortieren)\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_setting\" && $userdata['addsettings'] == 1 && $userdata['settings'] == 1 && $userdata['level'] == 10){\n\t\n\t// Eintragung in Datenbank vornehmen\n\tif(isset($_POST['send']) && $_POST['send'] == 1){\n\t\t$sql_insert = \"INSERT INTO \".$mysql_tables['settings'].\" (modul,is_cat,catid,sortid,idname,name,exp,formename,formwerte,input_exp,standardwert,wert,nodelete,hide) VALUES ('\".$mysqli->escape_string($_POST['modulname']).\"','0','\".$mysqli->escape_string($_POST['catid']).\"','\".$mysqli->escape_string($_POST['sortid']).\"','\".$mysqli->escape_string($_POST['idname']).\"','\".$mysqli->escape_string($_POST['name']).\"','\".$mysqli->escape_string($_POST['exp']).\"','\".$mysqli->escape_string($_POST['formename']).\"','\".$mysqli->escape_string($_POST['formwerte']).\"','\".$mysqli->escape_string($_POST['input_exp']).\"','\".$mysqli->escape_string($_POST['standardwert']).\"','\".$mysqli->escape_string($_POST['wert']).\"','\".$mysqli->escape_string($_POST['nodelete']).\"','\".$mysqli->escape_string($_POST['hide']).\"')\";\n\t\t$result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\n\t\techo $sql_insert.\"<br /><br />\";\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Datensatz wurde hinzugef\u00fcgt</b></p>\";\n\t\t}\n?>\n\n<h1>Einstellung hinzuf&uuml;gen</h1>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td colspan=\"2\">Auf dieser Seite k&ouml;nnen neue Datens&auml;tze zur MySQL-Settings-Tabelle (<?PHP echo $mysql_tables['settings']; ?>) hinzugef&uuml;gt werden.<br />\n        Dieser Bereich ist normalerweise nur f\u00fcr Entwickler von Modifikationen f\u00fcr das 01ACP interessant. Ein Funktion zur Bearbeitung von Datens&auml;tzen\n        ist nicht vorhanden. Datens&auml;tze m&uuml;ssen ggf. per PHPMyAdmin bearbeitet werden.<br />\n        Fragen werden gerne im <a href=\"http://forum.01-scripts.de/\" target=\"_blank\">01-Supportforum</a> gerne beantwortet.</td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\" width=\"50%\"><b>Kategorie*:</b><br /><span class=\"small\">catid(tinyint,2)</span></td>\n        <td class=\"trb\" width=\"50%\">\n\t\t\t<select name=\"catid\" size=\"1\">\n\t\t\t<?PHP\n\t\t\t$cats_settings = getSettingCats(\"\",$mysql_tables['settings']);\n\n\t\t\t$x = 0;\n\t\t\tforeach($cats_settings as $catvalue){\n\t\t\t\techo \"<option value=\\\"\".$catvalue['catid'].\"\\\">\".$catvalue['modul'].\" &raquo; \".$catvalue['name'].\" (ID: \".$catvalue['catid'].\")</option>\\n\";\n\t\t\t\t$x++;\n\t\t\t\t}\n\t\t\t?>\n\t\t\t</select>\n\t\t</td>\n    </tr>\n\t\n    <tr>\n        <td class=\"tra\"><b>Modul*:</b><br /><span class=\"small\">modul(varchar,25)</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"modulname\" value=\"<?PHP if(isset($_POST['modulname'])) echo $_POST['modulname']; ?>\" size=\"25\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>SortID:</b><br /><span class=\"small\">sortid(int,5): Sortier-Reihenfolge innerhalb der Kategorien (catid)</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"sortid\" value=\"<?PHP if(isset($_POST['sortid'])) echo $_POST['sortid']+1; ?>\" size=\"2\" maxlength=\"5\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Idname (unique)*:</b><br /><span class=\"small\">idname(varchar,25): Eindeutiger Name um den Datensatz anzusprechen</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"idname\" value=\"\" size=\"25\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Name:</b><br /><span class=\"small\">name(varchar,50): Name, der auf der Einstellungs-Seite angezeigt wird</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"name\" value=\"\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Beschreibung:</b><br /><span class=\"small\">exp(text): Beschreibung zum Datensatz f\u00fcr die Einstellungs-Seite</span></td>\n        <td class=\"tra\"><textarea name=\"exp\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Formular-Type*:</b><br /><span class=\"small\">formename(text):<br /><b>1:</b> text = einfaches Textfeld<br /><b>2:</b> textarea = Textarea<br /><b>3:</b> wahl1|wahl2 = Radiobutton Wahl1 X Wahl2 X<br /><b>4:</b> wahl1|wahl2|wahl3|... = Auswahlliste<br /><b>5:</b> function = Funktionsaufruf von <i>modul_right_Idname()</i></span></td>\n        <td class=\"trb\"><textarea name=\"formename\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Formwerte*:</b><br /><span class=\"small\">formwerte(varchar,255):<br /><b>1:</b> 123 = size<br /><b>2:</b> 5|50 = rows|cols<br /><b>3:</b> Wert1|Wert2 = Zu speichernder Wert<br /><b>4:</b> Wert1|Wert2|Wert3|... = zu speichernde Werte</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"formwerte\" value=\"\" size=\"50\" maxlength=\"255\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Feld-Beschreibung:</b><br /><span class=\"small\">input_exp(varchar,50): Beschreibung nach dem Input-Feld</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"input_exp\" value=\"\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Standardwert:</b><br /><span class=\"small\">standardwert(text): Standardwert<br />(bei 3 und 4: -> =selected)</span></td>\n        <td class=\"tra\"><textarea name=\"standardwert\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Wert:</b><br /><span class=\"small\">wert(text): gespeicherter Wert</span></td>\n        <td class=\"trb\"><textarea name=\"wert\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>NoDelete:</b><br /><span class=\"small\">nodelete(tinyint,1): Benutzerrecht kann nicht mehr gel&ouml;scht werden.</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"nodelete\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\t\n    <tr>\n        <td class=\"trb\"><b>Ausblenden:</b><br /><span class=\"small\">hide(tinyint,1): Einstellung ausblenden? (1/0)</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"hide\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\" colspan=\"2\">Mit <b>*</b> markierte Felder m&uuml;ssen ausgef&uuml;llt werden. Es erfolgt jedoch keine &Uuml;berpr&uuml;fung der Formulardaten.</td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\" align=\"left\"><input type=\"reset\" value=\"Zur\u00fccksetzen\" class=\"input\" /></td>\n        <td class=\"tra\" align=\"right\"><input type=\"hidden\" name=\"action\" value=\"add_setting\" /><input type=\"hidden\" name=\"send\" value=\"1\" /><input type=\"submit\" value=\"Datensatz anlegen\" class=\"input\" /></td>\n    </tr>\n</table>\t\n</form>\n\n<?PHP\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_setting\")\n\t\t$flag_loginerror = true;\n\t\n// Datens\u00e4tze neu sortieren\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"sort_settings\" && $userdata['addsettings'] == 1 && $userdata['settings'] == 1 && $userdata['level'] == 10){\n\t\n\techo \"<h1>Einstellungen sortieren</h1>\";\n\t\n\techo \"<div class=\\\"meldung_hinweis\\\"><p><b>Einstellungen eines anderen Moduls sortieren:</b></p>\".\n\tcreate_ModulForm($filename.\"?action=sort_settings&amp;\",\"input2\",TRUE).\"</div>\";\n\t\n\t$cats_settings = getSettingCats($modul,$mysql_tables['settings']);\n\t\n\t// Eintr\u00e4ge speichern\n\tif(isset($_POST['send']) && $_POST['send'] == 1)\n\t\t{\n\t\t$list_save = $mysqli->query(\"SELECT id,sortid FROM \".$mysql_tables['settings'].\" WHERE is_cat='0' AND modul='\".$mysqli->escape_string($modul).\"'\");\n\t\twhile($row_save = $list_save->fetch_assoc()){\n\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['settings'].\" SET sortid='\".$mysqli->escape_string($_POST[$row_save['id']]).\"' WHERE id='\".$row_save['id'].\"'\");\n\t\t\techo \"UPDATE \".$mysql_tables['settings'].\" SET sortid='\".$mysqli->escape_string($_POST[$row_save['id']]).\"' WHERE id='\".$row_save['id'].\"'<br />\\n\";\n\t\t\t}\n\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Gespeichert</b></p>\";\n\t\t}\n\n        echo \"<form action=\\\"\".$filename.\"?action=sort_settings&amp;modul=\".$modul.\"\\\" method=\\\"post\\\">\";\n        echo \"<ul>\\n\";\n        \n\t\t$save1 = \"\";\n        $list = $mysqli->query(\"SELECT id,catid,sortid,name FROM \".$mysql_tables['settings'].\" WHERE is_cat='0' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY catid,sortid\");\n        while($row = $list->fetch_assoc()){\n            if($save1 != $row['catid']) echo \"<li><h2>\".$cats_settings[$row['catid'].$modul]['name'].\"</h2></li>\";\n\t\t\techo \"<li><input type=\\\"text\\\" name=\\\"\".$row['id'].\"\\\" size=\\\"3\\\" value=\\\"\".$row['sortid'].\"\\\" maxlength=\\\"5\\\" /> \".$row['name'].\" <i>(ID: \".$row['id'].\")</i></li>\\n\";\n\t\t\t\n\t\t\t$save1 = $row['catid'];\n            }\n        echo \"</ul>\\n\";\n\n        echo \"<p><input type=\\\"reset\\\" value=\\\"Reset &raquo;\\\" class=\\\"input\\\" /> <input type=\\\"submit\\\" value=\\\"Sortieren &raquo;\\\" class=\\\"input\\\" /><input type=\\\"hidden\\\" name=\\\"send\\\" value=\\\"1\\\" /></p>\";\n\n        echo \"</form>\";\n\t\t\n    }elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"sort_settings\") \n\t\t$flag_loginerror = TRUE;\n\t\n}else $flag_loginerror = TRUE;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2013 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tFormular & Logik f\u50e1 Dateiupload + Ausgabe innerhalb des TinyMCE-Editor\n\t#fv.130#\n*/\n\nif(!isset($filename)) $filename = $_SERVER['PHP_SELF'];\nif(!isset($_REQUEST['formname'])) $_REQUEST['formname'] = \"\";\nif(!isset($_REQUEST['type'])) $_REQUEST['type'] = \"\";\nif(!isset($_REQUEST['returnvalue'])) $_REQUEST['returnvalue'] = \"\";\nif(!isset($_REQUEST['formfield'])) $_REQUEST['formfield'] = \"\";\nif(!isset($_REQUEST['look'])) $_REQUEST['look'] = \"\";\nif(!isset($_REQUEST['delfileid'])) $_REQUEST['delfileid'] = \"\";\nif(!isset($_REQUEST['delfile'])) $_REQUEST['delfile'] = \"\";\n\t\n// Parameter an URL anh\u911agen\n$filename .= \"type=\".$_REQUEST['type'].\"&amp;returnvalue=\".$_REQUEST['returnvalue'].\"&amp;formname=\".$_REQUEST['formname'].\"&amp;formfield=\".$_REQUEST['formfield'].\"&amp;look=\".$_REQUEST['look'].\"&amp;delfileid=\".$_REQUEST['delfileid'].\"&amp;delfile=\".$_REQUEST['delfile'];\n\n$flag_showformular = TRUE;\n$flag_showlist = TRUE;\n\n// Sicherheitsabfrage: Login & Berechtigung f\u50e1 Upload\nif(isset($userdata['id']) && $userdata['id'] > 0){\n\t\n\t// Upload ausf\ud849\udfb4ren\n\tif(isset($_POST['upload']) && $_POST['upload'] == 1 && isset($_FILES['new_datei']['name']) && $_FILES['new_datei']['name'] != \"\" && $userdata['upload'] == 1){\n\t\t\n\t\tif(isset($_REQUEST['delfileid']) && !empty($_REQUEST['delfileid'])){\n\t\t\tif($userdata['dateimanager'] == 1) $query = \"SELECT id,filetype,name FROM \".$mysql_tables['files'].\" WHERE uid = '\".$userdata['id'].\"' AND id='\".$mysqli->escape_string($_REQUEST['delfileid']).\"' LIMIT 1\";\n\t\t\telseif($userdata['dateimanager'] == 2) $query = \"SELECT id,filetype,name FROM \".$mysql_tables['files'].\" WHERE id='\".$mysqli->escape_string($_REQUEST['delfileid']).\"' LIMIT 1\";\n\t\t\t\n\t\t\t$list = $mysqli->query($query);\n\t\t\tif($list->num_rows == 1){\n\t\t\t\twhile($row = $list->fetch_assoc()){\n\t\t\t\t\t$fupload = uploadfile($_FILES['new_datei']['name'],$_FILES['new_datei']['size'],$_FILES['new_datei']['tmp_name'],$_REQUEST['type'],\"01acp\",$row['name'],$_REQUEST['filedirid']);\n\t\t\t\t\t$fupload['msg'] = \"Die Datei <i>\".$_REQUEST['delfile'].\"</i> wurde erfolgreich ersetzt.\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\telse\n\t\t\t\techo \"<p class=\\\"meldung_error\\\"><b>Fehler:</b> Die Datei konnte nicht gefunden werden oder\n\t\t\t\t\t\tSie haben nicht die n&ouml;tige Berechtigung um die Datei zu ersetzen!<br />\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<a href=\\\"javascript:window.close();\\\">Fenster schlie&szlig;en</a>\";\n\t\t\t}\n\t\telse\n\t\t\t$fupload = uploadfile($_FILES['new_datei']['name'],$_FILES['new_datei']['size'],$_FILES['new_datei']['tmp_name'],$_REQUEST['type'],\"01acp\",\"\",$_REQUEST['filedirid']);\n\t\t\n\t\t// Ausgabe der Meldungen / R\ud846\udc77kgabewerte\n\t\tif($fupload['success'] == 1){\n\t\t\t$flag_showformular = FALSE;\n\t\t\t\n\t\t\tif(isset($_REQUEST['delfileid']) && !empty($_REQUEST['delfileid']) && $flag_ispopup){\n\t\t\t\techo \"\n<script type=\\\"text/javascript\\\">\nopener.location.reload(true);\nwindow.setTimeout(\\\"opener.document.getElementById('ers_erfolgsmeldung').style.display = 'block'\\\", 2500);\n</script>\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\techo \"<p class=\\\"meldung_ok\\\"><b>\".$fupload['msg'].\"</b><br />\";\n\t\t\t\n\t\t\t// JavaScript - Bilder\n\t\t\tif($fupload['fileart'] == \"pic\" && ($_REQUEST['returnvalue'] == \"js\" && !empty($_REQUEST['formname']) && !empty($_REQUEST['formfield']) || \n\t\t\t\t$_REQUEST['returnvalue'] == \"php\" || empty($_REQUEST['returnvalue']))){\n\t\t\t\t\n\t\t\t\tif($_REQUEST['returnvalue'] == \"js\" && !empty($_REQUEST['formname']) && !empty($_REQUEST['formfield']))\n\t\t\t\t\techo \"<br />Bild einf&uuml;gen:<br />\n\t\t\t\t\t<br />\n\t\t\t\t\t<input type=\\\"button\\\" value=\\\"Einf&uuml;gen\\\" class=\\\"input\\\" onclick=\\\"opener.document.\".$_REQUEST['formname'].\".\".$_REQUEST['formfield'].\".value='\".stripslashes($fupload['name']).\"'; window.close();\\\" />\";\n\n\t\t\t\techo \"</p><div style=\\\"float:left;\\\">\";\t\t\t\t\n\t\t\t\techo \"<a href=\\\"\".$picuploaddir.$fupload['name'].\"\\\" target=\\\"_blank\\\"><img src=\\\"\".$picuploaddir.\"showpics.php?img=\".$fupload['name'].\"&amp;size=\".ACP_TB_WIDTH200.\"&amp;hidegif=normal\\\" alt=\\\"Hochgeladenes Bild\\\" /></a>\";\n\t\t\t\techo \"</div>\";\n\t\t\t\t\n\t\t\t\techo \"<div style=\\\"float:right;\\\">\n\t\t\t\t<a href=\\\"\".$filename.\"&amp;deltype=pic&amp;del=1&amp;file=\".$fupload['name'].\"\\\" style=\\\"color:red;\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"Icon: L&ouml;schen\\\" title=\\\"Bild l&ouml;schen\\\" style=\\\"border:0; margin-right:8px;\\\" />Bild l&ouml;schen &raquo;</a><br />\n\t\t\t\t<a href=\\\"\".$filename.\"\\\"><img src=\\\"images/icons/icon_upload.gif\\\" alt=\\\"Weitere Datei hochladen\\\" style=\\\"border:0; margin-right:8px;\\\" />Weitere Datei hochladen &raquo;</a></div>\";\n\t\t\t\t}\n\t\t\t// JavaScript - Dateien\n\t\t\telseif($fupload['fileart'] == \"file\" && ($_REQUEST['returnvalue'] == \"js\" && !empty($_REQUEST['formname']) && !empty($_REQUEST['formfield']) || \n\t\t\t\t$_REQUEST['returnvalue'] == \"php\" || empty($_REQUEST['returnvalue']))){\n\t\t\t\t\n\t\t\t\tif($_REQUEST['returnvalue'] == \"js\" && !empty($_REQUEST['formname']) && !empty($_REQUEST['formfield']))\n\t\t\t\t\techo \"<br /><b>Datei einf&uuml;gen:</b><br />\n\t\t\t\t\t<input type=\\\"button\\\" value=\\\"Einf&uuml;gen\\\" class=\\\"input\\\" onclick=\\\"opener.document.\".$_REQUEST['formname'].\".\".$_REQUEST['formfield'].\".value='\".stripslashes($fupload['name']).\"'; window.close();\\\" />\n\t\t\t\t\t<br /><br />\";\n\t\t\t\t\n\t\t\t\techo \"\n\t\t\t\t<a href=\\\"\".$filename.\"&amp;deltype=file&amp;del=1&amp;file=\".$fupload['name'].\"\\\" style=\\\"color:red;\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"Icon: L&ouml;schen\\\" title=\\\"Datei l&ouml;schen\\\" style=\\\"border:0; margin-right:8px;\\\" />Datei l&ouml;schen</a><br />\n\t\t\t\t<a href=\\\"\".$filename.\"\\\"><img src=\\\"images/icons/icon_upload.gif\\\" alt=\\\"Weitere Datei hochladen\\\" style=\\\"border:0; margin-right:8px;\\\" />Weitere Datei hochladen &raquo;</a>\n\t\t\t\t</p>\";\n\t\t\t\t}\n\t\t\t// TinyMCE - Bilder\n\t\t\telseif($fupload['fileart'] == \"pic\" && $_REQUEST['returnvalue'] == \"tinymce\" && \n\t\t\t\t!empty($_REQUEST['formname']) && !empty($_REQUEST['formfield'])){\n                $info = getimagesize($picuploaddir.$fupload['name']);\n\t\t\t\tif($info[0] >= $info[1]){ $bigside = $info[0]; }else{ $bigside = $info[1]; }\n\t\t\t\t\n\t\t\t\tif($bigside > $settings['thumbwidth']){ $c1 = \"\"; $c2 = \" checked=\\\"checked\\\"\"; }\n\t\t\t\telse{ $c1 = \" checked=\\\"checked\\\"\"; $c2 = \"\"; }\n\t\t\t\t\n\t\t\t\techo \"<br />Bild einf&uuml;gen:<br />\n\t\t\t\t<span class=\\\"small\\\"><input type=\\\"radio\\\" name=\\\"usesize\\\" value=\\\"org\\\"\".$c1.\" />Original Datei (\".$info[0].\"x\".$info[1].\" px) einf&uuml;gen<br />\n                <input type=\\\"radio\\\" name=\\\"usesize\\\" value=\\\"small\\\"\".$c2.\" />Verkleinerte Version mit <input type=\\\"text\\\" name=\\\"maxsize\\\" value=\\\"\".$settings['thumbwidth'].\"\\\" size=\\\"5\\\" />px Kantenl&auml;nge einf&uuml;gen<br />\n\t\t\t\t<input type=\\\"checkbox\\\" name=\\\"link\\\" value=\\\"1\\\" checked=\\\"checked\\\" />Link auf original Datei (mit maximale Aufl&ouml;sung) setzen</span>\n\t\t\t\t<input type=\\\"button\\\" value=\\\"Einf&uuml;gen\\\" class=\\\"input\\\" onclick=\\\"FileDialog.insertpic('\".$picuploaddir.\"','\".$fupload['name'].\"');\\\" />\n\t\t\t\t</p>\n\t\t\t\t\n\t\t\t\t<div style=\\\"float:left;\\\">\";\t\t\t\t\n\t\t\t\techo \"<a href=\\\"\".$picuploaddir.$fupload['name'].\"\\\" target=\\\"_blank\\\"><img src=\\\"\".$picuploaddir.\"showpics.php?img=\".$fupload['name'].\"&amp;size=\".ACP_TB_WIDTH200.\"&amp;hidegif=normal\\\" alt=\\\"Hochgeladenes Bild\\\" /></a>\";\n\t\t\t\techo \"</div>\";\n\t\t\t\t\n\t\t\t\techo \"<div style=\\\"float:right;\\\">\n\t\t\t\t<a href=\\\"\".$filename.\"&amp;deltype=pic&amp;del=1&amp;file=\".$fupload['name'].\"\\\" style=\\\"color:red;\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"Icon: L&ouml;schen\\\" title=\\\"Bild l&ouml;schen\\\" style=\\\"border:0; margin-right:8px;\\\" />Bild l&ouml;schen &raquo;</a><br />\n\t\t\t\t<a href=\\\"\".$filename.\"\\\"><img src=\\\"images/icons/icon_upload.gif\\\" alt=\\\"Weitere Datei hochladen\\\" style=\\\"width:16px; margin-right:8px;\\\" />Weitere Datei hochladen &raquo;</a></div>\";\n\t\t\t\t}\n\t\t\t// TinyMCE - Dateien\n\t\t\telseif($fupload['fileart'] == \"file\" && $_REQUEST['returnvalue'] == \"tinymce\" && \n\t\t\t\t!empty($_REQUEST['formname']) && !empty($_REQUEST['formfield'])){\n\t\t\t\techo \"<br /><b>Datei einf&uuml;gen:</b><br />\n\t\t\t\t<input type=\\\"button\\\" value=\\\"Einf&uuml;gen\\\" class=\\\"input\\\" onclick=\\\"FileDialog.insertfile('\".$attachmentuploaddir.\"','\".$fupload['name'].\"','\".$fupload['orgname'].\"');\\\" />\n\t\t\t\t<br /><br />\n\t\t\t\t\n\t\t\t\t<a href=\\\"\".$filename.\"&amp;deltype=file&amp;del=1&amp;file=\".$fupload['name'].\"\\\" style=\\\"color:red;\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"Icon: L&ouml;schen\\\" title=\\\"Datei l&ouml;schen\\\" style=\\\"border:0; margin-right:8px;\\\" />Datei l&ouml;schen</a><br />\n\t\t\t\t<a href=\\\"\".$filename.\"\\\"><img src=\\\"images/icons/icon_upload.gif\\\" alt=\\\"Weitere Datei hochladen\\\" style=\\\"width:16px; margin-right:8px;\\\" />Weitere Datei hochladen &raquo;</a></p>\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\telse{\n\t\t\t$flag_showformular = TRUE;\n\t\t\techo \"<p class=\\\"meldung_error\\\">\".$fupload['msg'].\"</p>\";\n\t\t\t}\n\t\t}\n\telseif(isset($_POST['upload']) && $_POST['upload'] == 1 && $userdata['upload'] == 1){\n\t\t$flag_showformular = TRUE;\n\t\techo \"<p class=\\\"meldung_error\\\">Sie haben keine Datei ausgew&auml;hlt!</p>\";\n\t\t}\n\telseif(isset($_POST['upload']) && $_POST['upload'] == 1 && $userdata['upload'] != 1){\n\t\t$flag_showformular = FALSE;\n\t\techo \"<p class=\\\"meldung_error\\\">Sie haben keine Berechtigung eine neue Datei hochzuladen.</p>\";\n\t\t}\n\n\n\n\n\n\n\t// Abfrage: Datei l\u98c9chen\n\tif(isset($_GET['del']) && $_GET['del'] == 1 && isset($_GET['file']) && !empty($_GET['file']) && isset($_GET['deltype']) && !empty($_GET['deltype']) && $userdata['upload'] == 1){\n\t\t$flag_showformular = FALSE;\n\t\t\n\t\techo \"<p class=\\\"meldung_frage\\\">\n\t\tWollen Sie die Datei <b>\".$_GET['file'].\"</b> wirklich l&ouml;schen?\n\t\t<br /><br />\n\t\t<a href=\\\"\".$filename.\"&amp;deltype=\".$_GET['deltype'].\"&amp;del=2&amp;file=\".$_GET['file'].\"\\\">Ja, Datei l&ouml;schen</a> |\n\t\t<a href=\\\"\".$filename.\"\\\">Nein, zur&uuml;ck</a>\n\t\t</p>\";\n\t\t}\n\t// Durchf\ud849\udfb4rung: Datei l\u98c9chen\n\telseif(isset($_GET['del']) && $_GET['del'] == 2 && isset($_GET['file']) && !empty($_GET['file']) && isset($_GET['deltype']) && !empty($_GET['deltype']) && $userdata['upload'] == 1){\n\t\t$flag_showformular = TRUE;\n\t\t\n\t\tlist($fmenge) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['files'].\" WHERE name='\".$mysqli->escape_string($_GET['file']).\"' AND uid='\".$userdata['id'].\"'\")->fetch_array(MYSQLI_NUM);\n\t\tif($fmenge == 1){\n\t\t\tswitch($_REQUEST['deltype']){\n\t\t\t  case \"file\":\n\t\t\t  @delfile($attachmentuploaddir,$_GET['file']);\n\t\t\t  break;\n\t\t\t  case \"pic\":\n\t\t\t  @delfile($picuploaddir,$_GET['file']);\n\t\t\t  break;\n\t\t\t  }\n\t\t\t\n\t\t\techo \"<p class=\\\"meldung_ok\\\">Die Datei <b>\".$_GET['file'].\"</b> wurde erfolgreich gel&ouml;scht.</p>\";\n\t\t\t}\n\t\telse{\n\t\t\techo \"<p class=\\\"meldung_error\\\">Die Datei <b>\".$_GET['file'].\"</b> konnte nicht gefunden werden oder Sie haben keine Berechtigung diese Datei zu l&ouml;schen.</p>\";\n\t\t\t}\n\t\t}\n\t\t\nif($userdata['upload'] == 1 && $flag_showformular && (isset($_REQUEST['look']) && ($_REQUEST['look'] == \"upload\" || $_REQUEST['look'] == \"both\" || empty($_REQUEST['look'])) || !isset($_REQUEST['look']))){\n\n// Tun: Datei verschieben:\nif(isset($_REQUEST['delfileid']) && !empty($_REQUEST['delfileid']) &&\n   isset($_REQUEST['newdir']) && is_numeric($_REQUEST['newdir']) && $_REQUEST['newdir'] != $_REQUEST['olddir']){\n\t$mysqli->query(\"UPDATE \".$mysql_tables['files'].\" SET dir = '\".$mysqli->escape_string($_REQUEST['newdir']).\"' WHERE id = '\".$mysqli->escape_string($_REQUEST['delfileid']).\"' LIMIT 1\");\n\t\n\techo \"\n<script type=\\\"text/javascript\\\">\nopener.document.getElementById('id\".$_REQUEST['delfileid'].\"').style.display = 'none';\n</script>\";\n\t}\n// Ausgabe: Datei in anderes Verzeichnis verschieben und Hinweis auf M\u9437lichkeit der Ersetzung\nif(isset($_REQUEST['delfileid']) && !empty($_REQUEST['delfileid'])){\n\t$list = $mysqli->query(\"SELECT dir FROM \".$mysql_tables['files'].\" WHERE id = '\".$mysqli->escape_string($_REQUEST['delfileid']).\"' LIMIT 1\");\n\t$fileinfo = $list->fetch_assoc();\n\t\n\techo \"<div class=\\\"meldung_hinweis\\\"><form action=\\\"\".$filename.\"\\\" method=\\\"post\\\">\n\t<b>Datei in Verzeichnis verschieben:</b> <select name=\\\"newdir\\\" size=\\\"1\\\" class=\\\"input_select\\\">\n\t\t<option value=\\\"0\\\">Kein Unterverzeichnis</option>\n\t\t\".getFileVerz_Rek(0,0,-1,\"echo_FileVerz_select\",$fileinfo['dir']).\"\n\t</select>\n\t<input type=\\\"hidden\\\" name=\\\"olddir\\\" value=\\\"\".$fileinfo['dir'].\"\\\" />\n\t<input type=\\\"submit\\\" class=\\\"input\\\" value=\\\"Verschieben\\\" />\n\t</form></div>\";\n\techo \"<p class=\\\"meldung_hinweis\\\">W&auml;hlen Sie eine neue Datei, aus um die Datei <b>\".$_REQUEST['delfile'].\"</b> zu ersetzt:</p>\";\n\t\n\t$flag_showlist = FALSE;\n\t}\n?>\n\n<?php if(!strchr($_SERVER['HTTP_USER_AGENT'],\"MSIE 6.0\") && !$flag_oldfileupload &&\n\t\t isset($_REQUEST['action']) && $_REQUEST['action'] == \"fmanageruploader\"){ ?>\n<form action=\"_ajaxloader.php?SID=<?php echo htmlspecialchars(session_id(),$htmlent_flags,$htmlent_encoding_acp); ?>&amp;modul=01acp&amp;ajaxaction=fancyupload<?php if($flag_sessionbugfix){ echo \"&amp;sessiondata=\".urlencode(session_encode()); } ?>\" method=\"post\" enctype=\"multipart/form-data\" id=\"fancy-form\">\n\n<div id=\"fancy-status\" class=\"hide\">\n<p>\n\t<a href=\"#\" id=\"fancy-browse\">Dateien ausw&auml;hlen</a> |\n\t<a href=\"#\" id=\"fancy-clear\">Warteschlange l&ouml;schen</a> |\n\t<a href=\"#\" id=\"fancy-upload\">Dateien jetzt hochladen</a>\n</p>\n<p>\n\t<select name=\"filedirid\" id=\"filedirid\" size=\"1\" class=\"input_select\" onchange=\"up.setOptions({data: 'filedirid=' + $('filedirid').get('value'),})\">\n\t\t<option value=\"0\">Kein Unterverzeichnis</option>\n\t\t<?PHP echo getFileVerz_Rek(0,0,-1,\"echo_FileVerz_select\",0); ?>\n\t</select>\n</p>\n<div>\n\t<strong class=\"overall-title\"></strong><br />\n\t<img src=\"images/fancy/bar.gif\" class=\"progress overall-progress\" />\n</div>\n<div>\n\t<strong class=\"current-title\"></strong><br />\n\t<img src=\"images/fancy/bar.gif\" class=\"progress current-progress\" />\n</div>\n\n<div class=\"current-text\"></div>\n</div>\n\n<ul id=\"fancy-list\"></ul>\n\n</form>\n<?php } ?>\n\n<!-- Fallback-L\u98c9ung! + Standard-L\u98c9ung f\u50e1 TinyMCE-Upload! -->\n<div id=\"fancy-fallback\">\n<h2>Neue Datei hochladen</h2>\n<form enctype=\"multipart/form-data\" action=\"<?PHP echo $filename; ?>\" method=\"post\">\n\t<p>Bitte w&auml;hlen Sie auf Ihrer Festplatte eine Datei aus:<br />\n\t<input type=\"file\" name=\"new_datei\" class=\"input_text\" />&nbsp;&nbsp;\n\t<select name=\"filedirid\" size=\"1\" class=\"input_select\">\n\t\t<option value=\"0\">Kein Unterverzeichnis</option>\n\t\t<?PHP echo getFileVerz_Rek(0,0,-1,\"echo_FileVerz_select\",0); ?>\n\t</select>&nbsp;&nbsp;\n\t<input type=\"submit\" value=\"Hochladen\" onclick=\"hide_unhide('loading');\" class=\"input\" /><br />\n\t<b class=\"small\">(Keine Leer- oder Sonderzeichen im Dateiname!)</b></p>\n\t\n\t<div id=\"loading\" style=\"display:none; float:right; margin-right:35px; text-align:center;\">\n\t\t<img src=\"images/icons/loading.gif\" alt=\"Lade-Animation\" title=\"Datei wird zum Server &uuml;bertragen - bitte warten...\" /><br />\n\t\t<span class=\"small\">Datei wird &uuml;betragen...</span>\n\t</div>\n\t<p>\n\t\t<?PHP\n\t\tif(isset($_REQUEST['type']) && ($_REQUEST['type'] == \"pic\" || empty($_REQUEST['type'])) || !isset($_REQUEST['type'])){\n\t\t?>\n\t\t<b>Spezifikationen f\u50e1 Bilder:</b> <?PHP echo $settings['pic_end']; ?>-Datei mit max. <?PHP echo $settings['pic_size']; ?> KB<br />\n\t\t<?PHP\n\t\t}\n\t\t\n\t\tif(isset($_REQUEST['type']) && ($_REQUEST['type'] == \"file\" || empty($_REQUEST['type'])) || !isset($_REQUEST['type'])){\n\t\t?>\n\t\t<b>Spezifikationen f\u50e1 Dateien:</b> <?PHP echo $settings['attachment_end']; ?>-Datei mit max. <?PHP echo $settings['attachment_size']; ?> KB<br />\n\t\t<?PHP\n\t\t}\n\t\t?>\n\t\t<br />\n\t\t<input type=\"hidden\" name=\"upload\" value=\"1\" />\n\t</p>\n</form>\n</div>\n\n<?PHP\n\t}// Ende: $flag_showformular\n\n// Auflistung der bereits hochgeladenen Dateien\nif($flag_showlist && (isset($_REQUEST['look']) && ($_REQUEST['look'] == \"list\" || $_REQUEST['look'] == \"both\" || empty($_REQUEST['look'])) || !isset($_REQUEST['look']))){\n\n\tif(isset($_REQUEST['dir']) && !empty($_REQUEST['dir']) && is_numeric($_REQUEST['dir'])) $where = \" AND dir = '\".$mysqli->escape_string($_REQUEST['dir']).\"' \";\n\telse{ $_REQUEST['dir'] = 0; $where = \" AND dir = '0' \"; }\n\t\n\t$sites = 0;\n\tif($userdata['dateimanager'] == 1) $query = \"SELECT * FROM \".$mysql_tables['files'].\" WHERE filetype='\".$mysqli->escape_string($_REQUEST['type']).\"' AND uid='\".$userdata['id'].\"'\".$where.\" ORDER BY utimestamp DESC,orgname,id\";\n\telseif($userdata['dateimanager'] == 2) $query = \"SELECT * FROM \".$mysql_tables['files'].\" WHERE filetype='\".$mysqli->escape_string($_REQUEST['type']).\"'\".$where.\" ORDER BY utimestamp DESC,orgname,id\";\n\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\n\n    if($_REQUEST['returnvalue'] == \"tinymce\" && $_REQUEST['type'] == \"pic\"){\n        echo \"<h2 style=\\\"clear: both;\\\">Bild ausw&auml;hlen</h2>\";\n        echo \"<p>Die Bildgr&ouml;&szlig;e kann nach dem Einf&uuml;gen durch einen Klick auf <img src=\\\"system/tiny_mce/plugins/filemanager/img/old_pics.gif\\\" alt=\\\"Bild bearbeiten\\\" title=\\\"Bild-Eigenschaften bearbeiten\\\" /> ge\u911adert werden.</p>\";\n    }\n    elseif($_REQUEST['returnvalue'] == \"tinymce\" && $_REQUEST['type'] == \"file\")\n        echo \"<h2 style=\\\"clear: both;\\\">Datei ausw&auml;hlen</h2>\";\n?>\n<table border=\"0\" align=\"center\" width=\"95%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen trab\" style=\"margin-top: 10px;\">\n\n    <tr>\n\t\t<td style=\"width:70px;\" align=\"center\"><img src=\"images/icons/refresh.gif\" alt=\"Refresh-Icon\" title=\"Seite neu laden\" onclick=\"document.location.reload(true);\" /></td>\n        <td><b>Dateiname</b></td>\n\t\t<td style=\"width:80px;\" align=\"center\"><b>Gr\u5ef2e</b></td>\n\t\t<td style=\"width:80px;\" align=\"center\"><b>Datum</b></td>\n    </tr>\n\t\n<?PHP\necho getFilelist($query,$filename,FALSE,TRUE,TRUE,FALSE,$_REQUEST['returnvalue']);\n\necho \"</table>\\n<br />\";\n\necho echopages($sites,\"80%\",\"site\",\"dir=\".$_REQUEST['dir']).\"<br />\";\n\t\n\t}// Ende: $flag_showlist\n\n}else echo \"<p class=\\\"meldung_error\\\">Fehler: Sie haben keine Berechtigung diesen Bereich zu betreten.</p>\";\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2010 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\t01ACP-Updates durchf\ud849\udfb4ren\n\t#fv.1200#\n*/\n\n$menuecat = \"01acp_start\";\n$sitetitle = \"01ACP aktualisieren\";\n$filename = $_SERVER['PHP_SELF'];\n$flag_acp = TRUE;\n$flag_nofunctions = TRUE;\n$flag_loginerror = FALSE;\n$flag_stopupdate = FALSE;\n$mootools_use = array(); \n\n// Dummy-Functions\nfunction create_ModulDropDown($para) { return \"\"; }\nfunction create_menue($para,$para2) { return \"\"; }\nfunction load_js_and_moo($mootools_use) { return \"\"; }\n\n// Config-Dateien\ninclude(\"system/headinclude.php\");\ninclude(\"system/head.php\");\n\n$xml = simplexml_load_file(\"_info.xml\",NULL,LIBXML_NOCDATA);\n?>\n<h1>ACP aktualisieren</h1>\n<?PHP\n// Update durchf\ud849\udfb4ren\nif(isset($_POST['action']) && $_POST['action'] == \"update\" &&\n   isset($_POST['update']) && !empty($_POST['update']) &&\n   $xml->version > $settings['acpversion']){\n    $update_ok = TRUE;\n\tinclude_once(\"_up_data.php\");\n\t\n\techo \"<p class=\\\"meldung_error\\\"><b>Bitte l\u98c9chen Sie die Datei _up_data.php von Ihrem Server!<br />\n\tLeeren Sie den Cache ihres Browsers und starten Sie ihn ggf. neu!</b></p>\";\n\techo \"<p class=\\\"meldung_erfolg\\\"><a href=\\\"index.php\\\">Weiter zum Administrationsbereich &raquo;</a></p>\";\n\t}\nelse{\n\tif($xml->version > $settings['acpversion']){\n\t\t$options = \"\";\n\t\tforeach($xml->updates as $updates){\n\t\t\tforeach($updates as $update){\n\t\t\t\tif($update->startv == $settings['acpversion'])\n\t\t\t\t\t$options .= \"<option value=\\\"\".$update->action.\"\\\">Version \".$update->startv.\" nach \".$update->zielv.\"</option>\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\tif(empty($options) || !isset($options)){\n\t\t\t$options = \"<option value=\\\"0\\\">Es konnte keine passende Version gefunden werden</option>\";\n\t\t\t$flag_stopupdate = TRUE;\n\t\t\t}\n?>\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\">Bitte w&auml;hlen Sie das passende Update aus.</td>\n    </tr>\n\n\t<tr>\n\t\t<td class=\"trb\"><select name=\"update\" size=\"1\" class=\"input_select2\"><?PHP echo $options; ?></select></td>\n\t</tr>\n<?PHP if(!$flag_stopupdate){ ?>\n    <tr>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"update\" />\n\t\t\t<input type=\"submit\" value=\"Update starten &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n<?PHP } ?>\n</table>\n</form><br />\n<?PHP\n\t\t}\n\telse\n\t\techo \"<p class=\\\"meldung_hinweis\\\">Sie setzen bereits die aktuellste Version des 01ACP ein.</p>\";\n\t}\n\ninclude(\"system/foot.php\");\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2015 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tBenutzerverwaltung (Benutzer hinzuf\u00fcgen und bearbeiten; Eigenes Profil)\n\t#fv.131#\n*/\n\n$menuecat = \"01acp_users\";\n$sitetitle = \"Benutzerverwaltung\";\n$filename = $_SERVER['PHP_SELF'];\n$mootools_use = array(\"moo_core\",\"moo_more\",\"moo_slidev\");\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0){\n\n\n\n// Neuen Benutzer hinzuf\u00fcgen\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_user\" && $userdata['userverwaltung'] >= 1){\n?>\n<h1>Neuen Benutzer erstellen</h1>\n\n<?PHP\n\t// Neuen Benutzer in Datenbank eintragen\n\tif(isset($_POST['send']) && $_POST['send'] == 1 &&\n\tisset($_POST['username']) && !empty($_POST['username']) &&\n\tisset($_POST['mail']) && !empty($_POST['mail']) && check_mail($_POST['mail']) &&\n\tisset($_POST['pwwahl']) && (($_POST['pwwahl'] == \"eigen\" && isset($_POST['password']) && !empty($_POST['password']) && strlen($_POST['password']) >= PW_LAENGE) || $_POST['pwwahl'] == \"random\") &&\n\tisset($_POST['level']) && $_POST['level'] <= $userdata['level']){\n\t\t// \u00dcberpr\u00fcfen ob E-Mail-Adresse oder Benutzername schon vorhanden ist\n\t\t$list = $mysqli->query(\"SELECT id FROM \".$mysql_tables['user'].\" WHERE username='\".$mysqli->escape_string($_POST['username']).\"' OR mail='\".$mysqli->escape_string($_POST['mail']).\"'\");\n\t\tif($list->num_rows < 1){\n\t\t\tif($_POST['pwwahl'] == \"random\"){\n\t\t        $password = create_NewPassword(8);\n\t\t        $passmd5 = pwhashing($password);\n\t\t\t\t}\n\t\t\telse{\n\t\t\t\t$password = $_POST['password'];\n\t\t\t\t$passmd5 = pwhashing($_POST['password']);\n\t\t\t\t}\n\t\t\t\n\t\t\t// Eintrag in DB vornehmen\n\t\t\t$sql_insert = \"INSERT INTO \".$mysql_tables['user'].\" (username,mail,userpassword,level) VALUES (\n\t\t\t\t\t\t\t'\".$mysqli->escape_string(trim($_POST['username'])).\"',\n\t\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['mail']).\"',\n\t\t\t\t\t\t\t'\".$passmd5.\"',\n\t\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['level']).\"'\n\t\t\t\t\t\t\t)\";\n            $result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\t\t\t$lastinsertid = $mysqli->insert_id;\n\t\t\t\n\t\t\tif($lastinsertid > 0){\n\t\t\t\t// Passwort mit richtigem Passwort aus pwhasing2-Funkion ersetzen\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET userpassword = '\".pwhashing2($password, $lastinsertid).\"' WHERE id='\".$lastinsertid.\"' LIMIT 1\");\n\n\t\t\t\t// ggf. E-Mail @ Benutzer versenden\n\t\t\t\tif($_POST['pwwahl'] == \"random\" || isset($_POST['emailinfo']) && $_POST['emailinfo'] == 1){\n\t\t\t\t\t$header = \"From:\".$settings['email_absender'].\"<\".$settings['email_absender'].\">\\n\";\n\t\t\t        $email_betreff = $settings['sitename'].\" - Ein Benutzerkonto wurde f\u00fcr Sie angelegt\";\n\t\t\t        $emailbody = $settings['sitename'].\"\\n\\nF\u00fcr Sie wurde ein neues Benutzerkonto angelegt. Sie k\u00f6nnen sich unter\\n\".$settings['absolut_url'].\"01acp/\\nmit folgenden Zugangsdaten einloggen:\\n\\nBenutzername: \".$_POST['username'].\"\\nPasswort: \".$password.\"\\n\\n---\\nWebmailer\";\n\n\t\t\t        if(!mail(stripslashes($_POST['mail']),$email_betreff,$emailbody,$header)){\n\t\t\t\t\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Es konnte keine E-Mail an den neuen Benutzer versand werden.</p>\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} \n\n\t\t\t\tif($userdata['userverwaltung'] == 2){\n\t\t\t\t\techo \"<script>redirect(\\\"\".$filename.\"?action=edit_user&userid=\".$lastinsertid.\"\\\");</script>\";\n\t\t\t\t\techo \"<p class=\\\"meldung_ok\\\">Der Benutzer <b>\".$_POST['username'].\"</b> wurde erfolgreich erstellt.<br />\n\t\t\t\t\t\tSie werden zur Konfiguration der Benutzerrechte weitergeleitet. Sollten Sie nicht weitergeleitet werden, klicken Sie\n\t\t\t\t\t\tbitte <a href=\\\"\".$filename.\"?action=edit_user&amp;userid=\".$lastinsertid.\"\\\">hier</a>.</p>\";\n\t\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\techo \"<p class=\\\"meldung_ok\\\">Der Benutzer <b>\".$_POST['username'].\"</b> wurde erfolgreich erstellt.</p>\";\n\t\t\t\n\t\t\t\t}\n\t\t\t// Fehler: Beim Eintragen trat ein Fehler auf\n\t\t\telse{\n\t\t\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Es konnte kein neuer Benutzer erstellt werden.<br />\n\t\t\t\t\t\tBeim Eintragen in die Datenbank trat ein unvorhergesehener Fehler auf. Bitte beachten Sie\n\t\t\t\t\t\tdie MySQL-Fehlermeldung und setzen sich mit einem technischen Ansprechpartner in Verbindung.</p>\";\n\t\t\t\t}\n\t\t}\n\t\t// Fehler: Benutzername oder E-Mail existieren schon in der DB\n\t\telse{\n\t\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Der neue Benutzer konnte nicht erstellt werden. Ein Benutzer mit diesem\n\t\t\t\t\tBenutzernamen oder dieser E-Mail-Adresse existiert bereits.<br />\n\t\t\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a> und &auml;ndern Sie Ihre Eingaben entsprechend ab.</p>\";\n\t\t}\n\t}\n\t// Fehler: Nicht alle Felder ausgef\u00fcllt oder PW zu kurz\n\telseif(isset($_POST['send']) && $_POST['send'] == 1){\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Der neue Benutzer konnte nicht erstellt werden. Sie haben nicht\n\t\t\t\talle Felder komplett ausgef&uuml;llt oder das von Ihnen eingegebene Passwort ist zu kurz (mind. \".PW_LAENGE.\" Zeichen).<br />\n\t\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a> und &auml;ndern Sie Ihre Eingaben entsprechend ab.</p>\";\n\t\t}\n\telse{\n?>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\" width=\"30%\"><b>Benutzername*</b></td>\n        <td class=\"tra\"><input type=\"text\" name=\"username\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\t\n    <tr>\n        <td class=\"trb\"><b>E-Mail-Adresse*</b></td>\n        <td class=\"trb\"><input type=\"text\" name=\"mail\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\t\n\t\n    <tr>\n        <td class=\"tra\"><b>Passwort*</b></td>\n        <td class=\"tra\">\n\t\t\t<input type=\"radio\" name=\"pwwahl\" value=\"random\" checked=\"checked\" /> Zuf&auml;lliges Passwort generieren <span class=\"small\">(Wird per E-Mail an den Benutzer verschickt)</span><br />\n\t\t\t<input type=\"radio\" name=\"pwwahl\" value=\"eigen\" /> Passwort manuell festlegen: <input type=\"text\" name=\"password\" size=\"20\" /> <span class=\"small\"><b>Mindestens <?PHP echo PW_LAENGE; ?> Zeichen</b></span>\n\t\t</td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Sicherheitsstufe*</b></td>\n        <td class=\"trb\">\n\t\t\t<select name=\"level\" size=\"1\">\n\t\t\t\t<?PHP\n\t\t\t\tfor($x=1;$x<=$userdata['level'];$x++){\n\t\t\t\t\techo \"<option value=\\\"\".$x.\"\\\">Sicherheitsstufe \".$x.\"</option>\\n\";\n\t\t\t\t\t}\n\t\t\t\t?>\n\t\t\t</select> <b>[ <a href=\"javascript:hide_unhide('help_level');\">?</a> ]</b>\n\t\t</td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>E-Mail an Benutzer senden</b></td>\n        <td class=\"tra\">\n\t\t\t<input type=\"checkbox\" name=\"emailinfo\" value=\"1\" checked=\"checked\" /> Der neue Benutzer wird mit einer E-Mail &uuml;ber das f&uuml;r ihn eingerichtete Benutzerkonto informiert.\n\t\t</td>\n    </tr>\n\t\n    <tr>\n        <td class=\"tra\"><input type=\"reset\" value=\"Felder zur&uuml;cksetzen\" class=\"input\" /></td>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"add_user\" />\n\t\t\t<input type=\"hidden\" name=\"send\" value=\"1\" />\n\t\t\t<input type=\"submit\" value=\"Benutzer erstellen &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n\n</table>\n</form>\n\n<div class=\"meldung_hinweis\" id=\"help_level\" style=\"display:none;\">\n\tBenutzer mit einer niedrigeren Sicherheitsstufe k&ouml;nnen Benutzer mit h&ouml;heren Sicherheitsstufe nicht bearbeiten oder l&ouml;schen.<br />\n\t<br />\n\tBeispiel:<br />\n\tEinem Benutzer mit Sicherheitsstufe 2 ist es nicht gestattet einen Benutzer mit Sicherheitsstufe 3 (oder h&ouml;her) anzulegen oder zu bearbeiten.\n</div>\n\n<?PHP\n\t\t} // else: Formular anzeigen\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_user\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n\n// Durchf\u00fchren: Benutzer l\u00f6schen\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"do_del\" && $userdata['userverwaltung'] == 2 && isset($_GET['userid']) && !empty($_GET['userid']) && is_numeric($_GET['userid'])){\n\t$error = 0;\n\t\n\tif($_GET['userid'] == $userdata['id']) $error = 1;\n\telse{\n\t\t$list = $mysqli->query(\"SELECT id,username,mail,level FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($_GET['userid']).\"' AND id != '0' LIMIT 1\");\n\t\twhile($row = $list->fetch_assoc()){\n\t\t\t$u_id = $row['id'];\n\t\t\t$u_username = stripslashes($row['username']);\n\t\t\t$u_mail = stripslashes($row['mail']);\n\t\t\t$u_level = $row['level'];\n\t\t\t}\n\t\tif($u_level >= $userdata['level']) $error = 2;\n\t\t}\n\t\n\t// Ist ein Fehler aufgetreten?\n\tif($error == 0){\n\t\t// Normale weitere Programmausf\u00fchrung\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($u_id).\"' AND id != '0' LIMIT 1\");\n\t\t\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['files'].\" SET uid='0' WHERE uid='\".$mysqli->escape_string($u_id).\"'\");\n\t\t\n\t\t/*An dieser Stelle alle Modulspezifischen zur Verf\u00fcgung gestellten L\u00f6sch-Funktionen ausf\u00fchren\n\t\tSchema der Funktionsnamen: modulname_DeleteUser()\n\t\t\u00dcbergebene Parameter: Userid, Username, E-Mail-Adresse\n\t\tErwarteter R\u00fcckgabewert: TRUE / FALSE\n\t\t*/\n\n\t\tforeach($module as $modul_akt){\n\t\t\t$modul = $modul_akt['idname'];\n\t\t\t\n\t\t\tif(file_exists($moduldir.$modul_akt['idname'].\"/_headinclude.php\"))\n\t\t\t\tinclude_once($moduldir.$modul_akt['idname'].\"/_headinclude.php\");\n\t\t\tif(file_exists($moduldir.$modul_akt['idname'].\"/_functions.php\"))\n\t\t\t\tinclude_once($moduldir.$modul_akt['idname'].\"/_functions.php\");\n\t\t\tif(function_exists(\"_\".$modul_akt['modulname'].\"_DeleteUser\"))\n\t\t\t\tcall_user_func(\"_\".$modul_akt['modulname'].\"_DeleteUser\",$u_id,$u_username,$u_mail);\n\t\t\t\n\t\t\tunset($modul);\n\t\t\t}\n\t\t\n\t\techo \"<p class=\\\"meldung_ok\\\">Der Benutzer <i>\".$u_username.\"</i> wurde aus dem System gel&ouml;scht.</p>\";\n\t\t}\n\telseif($error == 1)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie k&ouml;nnen nicht Ihr eigenes Benutzerkonto l&ouml;schen!</p>\";\n\telseif($error == 2)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie k&ouml;nnen keinen Benutzer l&ouml;schen, der das gleiche oder ein h&ouml;heres Sicherheitslevel hat!</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Es trat ein unvorhergesehener Fehler auf.</p>\";\n\n\t// Variablen so setzen, dass Benutzer Auflistung erfolgt:\n\t$_REQUEST['action'] = \"edit_users\";\n\t$_GET['userid'] = \"\";\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"do_del\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n// Werte von Benutzer bearbeiten / Profil speichern\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"do_edit\" && $userdata['userverwaltung'] == 2 ||\n\tisset($_REQUEST['action']) && $_REQUEST['action'] == \"save_profile\" && $userdata['profil'] == 1){\n\t$error = 0;\n\tswitch($_REQUEST['action']){\n\t  case \"do_edit\":\n\t    // Weitere \u00dcberpr\u00fcfungen der \u00fcbergebenen Variablen\n\t\tif(!isset($_REQUEST['userid']) || isset($_REQUEST['userid']) && empty($_REQUEST['userid']))\n\t\t\t$error = 1;\n\t\telse{\n\t\t\t$list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($_REQUEST['userid']).\"' AND id != '0' AND (level < '\".$mysqli->escape_string($userdata['level']).\"' OR level = '10' AND level = '\".$mysqli->escape_string($userdata['level']).\"' OR id = '\".$mysqli->escape_string($userdata['id']).\"') LIMIT 1\");\n\t\t\tif($list->num_rows < 1) $error = 2;\n\t\t}\n\t\t\t\n\t\t$title = \"Benutzer bearbeiten\";\n\t\t$case = \"do_edit\";\n\t  break;\n\t  case \"save_profile\":\n\t    $list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['user'].\" WHERE id='\".$userdata['id'].\"' LIMIT 1\");\n\t\t\n\t\t$title = \"Eigenes Profil\";\n\t\t$case = \"profil\";\n\t  break;\n\t  }\n\t\n\t// Ist ein Fehler aufgetreten?\n\tif($error == 0){\n\t\t// Normale weitere Programmausf\u00fchrung\n\t\tswitch($case){\n\t\t  case \"do_edit\":\n\t\t    if(isset($_POST['username']) && !empty($_POST['username']) && \n\t\t\t\tisset($_POST['mail']) && !empty($_POST['mail']) && check_mail($_POST['mail']) &&\n\t\t\t\tisset($_POST['level']) && !empty($_POST['level']) && $_POST['level'] <= $userdata['level']){\n\t\t\t\t\n\t\t\t\tif(isset($_POST['sperre']) && $_POST['sperre'] != 1 || !isset($_POST['sperre'])) $_POST['sperre'] = 0;\n\t\t\t\t\n\t\t\t\t// \u00dcberpr\u00fcfen ob E-Mail-Adresse oder Benutzername schon vorhanden ist\n\t\t\t\t$list = $mysqli->query(\"SELECT id FROM \".$mysql_tables['user'].\" WHERE username='\".CleanStr($_POST['username']).\"' LIMIT 1\");\n\t\t\t\t$row_u\t\t= $list->fetch_assoc();\n\t\t\t\t$menge_u\t= $list->num_rows;\n\t\t\t\t$list = $mysqli->query(\"SELECT id FROM \".$mysql_tables['user'].\" WHERE mail='\".$mysqli->escape_string($_POST['mail']).\"' LIMIT 1\");\n\t\t\t\t$row_m\t\t= $list->fetch_assoc();\n\t\t\t\t$menge_m\t= $list->num_rows;\n\t\t\t\t\n\t\t\t\t$add2query = \"\";\n\t\t\t\t// Level can only be chaned for other users\n\t\t\t\tif($_POST['userid'] != $userdata['id'])\n\t\t\t\t\t$add2query .= \"level='\".$mysqli->escape_string(intval($_POST['level'])).\"', \";\n\t\t\t\t// Only changed username if it is unique\n\t\t\t\tif($menge_u < 1)\n\t\t\t\t    $add2query .= \"username='\".CleanStr($_POST['username']).\"', \";\n\t\t\t\telseif($row_u['id'] != $_POST['userid'])\n\t\t\t\t\techo \"<p class=\\\"meldung_error\\\">Der <b>Benutzername</b> wurde nicht ge&auml;ndert, da bereits ein Benutzerkonto mit diesem Namen existiert.</p>\";\n\t\t\t\t// Only changed mail if it is unique\n\t\t\t\tif($menge_m < 1)\n\t\t\t\t    $add2query .= \"mail='\".$mysqli->escape_string($_POST['mail']).\"', \";\n\t\t\t\telseif($row_m['id'] != $_POST['userid'])\n\t\t\t\t\techo \"<p class=\\\"meldung_error\\\">Die <b>E-Mail-Adresse</b> wurde nicht ge&auml;ndert, da bereits ein Benutzerkonto mit dieser Adresse existiert.</p>\";\n\t\t\t\t\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET \".$add2query.\"sperre='\".$mysqli->escape_string($_POST['sperre']).\"' WHERE id='\".$mysqli->escape_string($_POST['userid']).\"' AND id != '0' LIMIT 1\");\n\n\t\t\t\t// Passwort \u00e4ndern?\n\t\t\t\tif(isset($_POST['changepw']) && $_POST['changepw'] == 1){\n\t\t\t\t\t$pwerror = true;\n\t\t\t\t\tif(isset($_POST['pwwahl']) && $_POST['pwwahl'] == \"eigen\" && \n\t\t\t\t\t\tisset($_POST['password']) && !empty($_POST['password']) && \n\t\t\t\t\t\tstrlen($_POST['password']) >= PW_LAENGE){\n\t\t\t\t\t\t\n\t\t\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET userpassword='\".pwhashing2($_POST['password'], $_POST['userid']).\"', cookiehash='' WHERE id='\".$mysqli->escape_string($_POST['userid']).\"' AND id != '0' LIMIT 1\");\n\t\t\t\t\t\t$pwerror = false;\n\t\t\t\t\t}\n\t\t\t\t\telseif(isset($_POST['pwwahl']) && $_POST['pwwahl'] == \"random\" ||\n\t\t\t\t\t\tisset($_POST['pwwahl']) && $_POST['pwwahl'] == \"eigen\" && empty($_POST['password'])){\n\t\t\t\t\t\n\t\t\t\t\t\t$newpass = create_NewPassword(PW_LAENGE);\n\t\t\t\t        $newpassHash = pwhashing2($newpass, $_POST['userid']);\n\n\t\t\t\t        // Datenbank aktualisieren:\n\t\t\t\t        $mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET userpassword='\".$newpassHash.\"', cookiehash='' WHERE id='\".$mysqli->escape_string($_POST['userid']).\"' AND id != '0' LIMIT 1\");\n\n\t\t\t\t        $header = \"From:\".$settings['email_absender'].\"<\".$settings['email_absender'].\">\\n\";\n\t\t\t\t        $email_betreff = $settings['sitename'].\" - Neues Passwort f\u00fcr Administrationsbereich\";\n\t\t\t\t        $emailbody = \"Mit dieser E-Mail erhalten Sie ein neues Passwort f\u00fcr den Adminbereich\\n\\nName: \".CleanStr($_POST['username']).\"\\nE-Mail-Adresse: \".$_POST['mail'].\"\\nNeues Passwort: \".$newpass.\"\\n\\n---\\nWebmailer\";\n\t\t\t\t\t\t$emailbody = preg_replace( \"/(content-type:|bcc:|cc:|to:|from:)/im\", \"\",$emailbody);\n\n\t\t\t\t\t\t$empf = preg_replace( \"/[^a-z0-9 !?:;,.\\/_\\-=+@#$&\\*\\(\\)]/im\", \"\",$_POST['mail']);\n\t\t\t\t\t\t$empf = preg_replace( \"/(content-type:|bcc:|cc:|to:|from:)/im\", \"\",$empf);\n\t\t\t\t        mail($empf,$email_betreff,$emailbody,$header);\n\t\t\t\t        $pwerror = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$savequery = \"\";\n\t\t\t\t// F\u00fcr Benutzer mit Level < 10 nur Einstellungen speichern auf die der User auch Zugriff hat. Function-Felder werden nicht gespeichert\n\t\t\t\tif($_POST['userid'] != $userdata['id'] && $userdata['level'] < 10){\n\t\t\t\t\t$query = \"SELECT id,modul,idname,formename FROM \".$mysql_tables['rights'].\" WHERE formename != 'function' AND is_cat='0' AND hide='0'\";\n\t\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\t\twhile($row_save = $list->fetch_assoc()){\n\t\t\t\t\t\t// Nur Einstellungen mit Berechtigungen des Users speichern\n\t\t\t\t\t\tif(!isset($userdata[str_replace(\"01acp_\",\"\",$row_save['modul'].\"_\".$row_save['idname'])]) || $userdata[str_replace(\"01acp_\",\"\",$row_save['modul'].\"_\".$row_save['idname'])] == 0) continue;\n\n\t\t\t\t\t\tif(isset($_POST[$row_save['modul'].\"_\".$row_save['idname']]) && $_POST[$row_save['modul'].\"_\".$row_save['idname']] <= $userdata[str_replace(\"01acp_\",\"\",$row_save['modul'].\"_\".$row_save['idname'])])\n\t\t\t\t\t\t\t$savequery .= $row_save['modul'].\"_\".$row_save['idname'].\"='\".$mysqli->escape_string($_POST[$row_save['modul'].\"_\".$row_save['idname']]).\"', \";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// F\u00fcr Administratoren alle Felder speichern\n\t\t\t\telseif($userdata['level'] == 10){\n\t\t\t\t\t$query = \"SELECT id,modul,idname,formename FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND hide='0'\";\n\t\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\t\twhile($row_save = $list->fetch_assoc()){\n\t\t\t\t\t\tif($row_save['formename'] == \"function\" && isset($_POST[$row_save['modul'].\"_\".$row_save['idname']]))\n\t\t\t\t\t\t\t$savequery .= $row_save['modul'].\"_\".$row_save['idname'].\"='\".mysql_real_escape_string(call_RightSettingsFunction_Write($row_save['modul'],$row_save['idname'],$_POST[$row_save['modul'].\"_\".$row_save['idname']])).\"', \";\n\t\t\t\t\t\telseif(isset($_POST[$row_save['modul'].\"_\".$row_save['idname']]))\n\t\t\t\t\t\t\t$savequery .= $row_save['modul'].\"_\".$row_save['idname'].\"='\".$mysqli->escape_string($_POST[$row_save['modul'].\"_\".$row_save['idname']]).\"', \";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(isset($savequery) && !empty($savequery))\n\t\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET \".substr($savequery,0,strlen($savequery)-2).\" WHERE id='\".$mysqli->escape_string($_POST['userid']).\"' AND id != '0' LIMIT 1\");\n\t\t\t\t\n\t\t\t\techo \"<p class=\\\"meldung_ok\\\">Benutzerdaten wurden gespeichert.<br />\n\t\t\t\t\t<a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_user','userid'=>$_POST['userid'])).\"\\\">Benutzer erneut bearbeiten &raquo;</a></p>\";\n\t\t\t\t\n\t\t\t\tif(isset($pwerror) && $pwerror)\n\t\t\t\t    echo \"<p class=\\\"meldung_error\\\">Das Passwort wurde <b>nicht</b> ge&auml;ndert.<br />\n\t\t\t\t\t\t\tBitte geben Sie ein Passwort mit mindestens \".PW_LAENGE.\" Zeichen ein!</p>\";\n\t\t\t\t}\n\t\t\telse\n\t\t\t\techo \"<p class=\\\"meldung_error\\\">Sie haben keine Berechtigung diesen Benutzer zu bearbeiten.<br />\n\t\t\t\tOder Sie haben keinen Benutzernamen bzw. eine Nicht-valide E-Mail-Adresse eingegeben.<br />\n\t\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\n\t\t  $_REQUEST['action'] = \"edit_users\";\n\t\t  $_REQUEST['userid'] = \"\";\n\n\t\t  break;\n\t\t  case \"profil\":\n\t\t\tif(isset($_POST['mail']) && !empty($_POST['mail']) && check_mail($_POST['mail'])){\n\t\t\t\t// \u00dcberpr\u00fcfen ob E-Mail-Adresse schon vorhanden ist\n\t\t\t\t$list = $mysqli->query(\"SELECT id FROM \".$mysql_tables['user'].\" WHERE mail='\".$mysqli->escape_string($_POST['mail']).\"'\");\n\n\t\t\t\t$add2query = \"\";\n\t\t\t\tif($list->num_rows < 1)\n\t\t\t\t    $add2query .= \"mail='\".$mysqli->escape_string($_POST['mail']).\"', \";\n\t\t\t\telseif($userdata['mail'] != $_POST['mail']){\n\t\t\t\t\t$save_error = true;\n\t\t\t\t\techo \"<p class=\\\"meldung_error\\\">Die <b>E-Mail-Adresse</b> wurde nicht ge&auml;ndert, da bereits ein Benutzerkonto mit dieser Adresse existiert.</p>\";\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET \".$add2query.\"startpage='\".$mysqli->escape_string($_POST['startpage']).\"' WHERE id='\".$mysqli->escape_string($userdata['id']).\"' AND id != '0' LIMIT 1\");\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t$query = \"SELECT * FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND hide='0' AND in_profile='1' ORDER BY catid,sortid\";\n\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\t$savequery = \"\";\n\t\t\t\twhile($row_save = $list->fetch_assoc()){\n\t\t\t\t\tif(isset($_POST[$row_save['modul'].\"_\".$row_save['idname']]))\n\t\t\t\t\t\t$savequery .= $row_save['modul'].\"_\".$row_save['idname'].\"='\".$mysqli->escape_string($_POST[$row_save['modul'].\"_\".$row_save['idname']]).\"', \";\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET \".substr($savequery,0,strlen($savequery)-2).\" WHERE id='\".$mysqli->escape_string($userdata['id']).\"' AND id != '0' LIMIT 1\");\n\t\t\t\t\n\t\t\t\techo \"<p class=\\\"meldung_ok\\\">Daten wurden gespeichert.<br />\n\t\t\t\t\t<a href=\\\"users.php?action=profil\\\">Weiter &raquo;</a></p>\";\n\t\t\t\tif(!isset($save_error))\n\t\t\t\t\techo \"<script>redirect(\\\"users.php?action=profil&show=saved\\\");</script>\";\n\t\t\t\t}\n\t\t\telse{\n\t\t\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie haben keine oder eine fehlerhafte E-Mail-Adresse\n\t\t\t\teingegeben. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\t\t\t\t}\n\t\t  break;\n\t\t  }\n\t\t\n\t\t}\n\telseif($error == 1)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Die &uuml;bergebene Benutzer-ID ist leider fehlerhaft &amp; in dieser\n\t\t\tForm nicht g&uuml;ltig. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\telseif($error == 2)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Zur &uuml;bergebene Benutzer-ID konnte leider kein passender\n\t\t\tEintrag in der Datenbank gefunden werden, <b>oder Sie haben keine Berechtigung um diesen Benutzer zu bearbeiten</b>.\n\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Es trat ein unvorhergesehener Fehler auf. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"do_edit\" || \n\t\tisset($_REQUEST['action']) && $_REQUEST['action'] == \"save_profile\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n\n// Benutzer auflisten\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_users\" && $userdata['userverwaltung'] == 2){\n?>\n<h1>Benutzer bearbeiten</h1>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"get\">\n\t<p>\n\t<a href=\"users.php?action=add_user\" class=\"actionbutton\"><img src=\"images/icons/add.gif\" alt=\"Plus-Zeichen\" title=\"Neuen Benutzer erstellen\" style=\"border:0; margin-right:10px;\" />Neuen Benutzer erstellen</a>\n\t<input type=\"text\" name=\"search\" value=\"Nach Benutzername oder E-Mail\" size=\"30\" onfocus=\"clearField(this);\" onblur=\"checkField(this);\" class=\"input_search\" /> <input type=\"submit\" value=\"Benutzer suchen\" class=\"input\" /></p>\n\t<input type=\"hidden\" name=\"action\" value=\"edit_users\" />\n</form>\n\n<?PHP\n\tif(isset($_GET['sort']) && $_GET['sort'] == \"desc\") $sortorder = \"DESC\";\n\telse{ $sortorder = \"ASC\"; $_GET['sort'] = \"ASC\"; }\n\t\n\tif(isset($_GET['search']) && !empty($_GET['search'])) $where = \" WHERE (username LIKE '%\".$mysqli->escape_string($_GET['search']).\"%' OR mail LIKE '%\".$mysqli->escape_string($_GET['search']).\"%') AND id != '0'\";\n\telse{ $where = \" WHERE id != '0'\"; $_GET['search'] = \"\"; }\n\t\n\tif(!isset($_GET['orderby'])) $_GET['orderby'] = \"\";\n\tswitch($_GET['orderby']){\n\t  case \"sperre\":\n\t    $orderby = \"sperre,username\";\n\t  break;\n\t  case \"username\":\n\t    $orderby = \"username\";\n\t  break;\n\t  case \"mail\":\n\t    $orderby = \"mail\";\n\t  break;\n\t  case \"level\":\n\t    $orderby = \"level \".$sortorder.\", username\";\n\t  break;\n\t  case \"lastlogin\":\n\t    $orderby = \"lastlogin,username\";\n\t  break;\t  \n\t  default:\n\t    $orderby = \"username\";\n\t  break;\n\t  }\n\n\t$sites = 0;\n\t$query = \"SELECT * FROM \".$mysql_tables['user'].\"\".$where.\" ORDER BY \".$orderby.\" \".$sortorder;\n\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\n\n\t// Fehlermeldung bei erfolgloser Suche\n\tif($sites == 0 && isset($_GET['search']) && !empty($_GET['search']))\n\t\techo \"<p class=\\\"meldung_error\\\">Es konnte leider kein Benutzer zu Ihrer Sucheingabe \\\"\".stripslashes($_GET['search']).\"\\\" gefunden werden!<br />\n\t\t\tBitte probieren Sie es erneut.</p>\";\n\n?>\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n    <tr>\n\t\t<td class=\"tra\" width=\"25\" align=\"center\"><a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'sperre')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren (ASC)\" /></a><!--Benutzer ist gesperrt--></td>\n        <td class=\"tra\"><b>Benutzername</b>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'username')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'desc','orderby'=>'username')); ?>\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td class=\"tra\"><b>E-Mail-Adresse</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'mail')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'desc','orderby'=>'mail')); ?>\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td class=\"tra\" width=\"130\"><b>Sicherheitsstufe</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'level')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'desc','orderby'=>'level')); ?>\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td class=\"tra\" width=\"145\"><b>Letzte Anmeldung</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'lastlogin')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'desc','orderby'=>'lastlogin')); ?>\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td class=\"tra nosort\" width=\"25\">&nbsp;<!--Bearbeiten--></td>\n\t\t<td class=\"tra nosort\" width=\"25\" align=\"center\"><!--L\u00f6schen--><img src=\"images/icons/icon_trash.gif\" alt=\"M&uuml;lleimer\" title=\"Datei l&ouml;schen\" /></td>\n    </tr>\n<?PHP\n\t// Ausgabe der Datens\u00e4tze (Liste) aus DB\n\t$count = 0;\n\t$list = $mysqli->query($query);\n\twhile($row = $list->fetch_assoc()){\n\t\t// Zusatzinformationen/Statistiken \u00fcber Benutzer zusammentragen\n\t\t$userstats = getUserstats($row['id']);\n\n\t\tif(is_array($module)){\n\t\t\tforeach($module as $modul_akt){\n\t\t\t\t$modul = $modul_akt['idname'];\n\t\t\t\t\n\t\t\t\tif(file_exists($moduldir.$modul_akt['idname'].\"/_headinclude.php\"))\n\t\t\t\t\tinclude_once($moduldir.$modul_akt['idname'].\"/_headinclude.php\");\n\t\t\t\tif(file_exists($moduldir.$modul_akt['idname'].\"/_functions.php\"))\n\t\t\t\t\tinclude_once($moduldir.$modul_akt['idname'].\"/_functions.php\");\n\t\t\t\tif(function_exists(\"_\".$modul_akt['modulname'].\"_getUserstats\"))\n\t\t\t\t\t$addstats = call_user_func(\"_\".$modul_akt['modulname'].\"_getUserstats\",$row['id']);\n\t\t\t\t\n\t\t\t\tif(isset($addstats) && is_array($addstats))\n\t\t\t\t\t$userstats = array_merge($userstats,$addstats);\n\t\t\t\t\n\t\t\t\tunset($modul);\n\t\t\t\tunset($addstats);\n\t\t\t\t}\n\t\t\t}\n\n\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\n\t\tif($row['sperre'] == 1){\n\t\t\t$sperricon = \"<img src=\\\"images/icons/icon_gesperrt.gif\\\" alt=\\\"Icon: Schlo&szlig;\\\" title=\\\"Benutzer ist gesperrt\\\" />\";\n\t\t\t$class = \"tr_red\";\n\t\t\t}\n\t\telse $sperricon = \"\";\n\t\t\n\t\tif($row['lastlogin'] > 0) $lastlogin = date(\"d.m.Y\",$row['lastlogin']);\n\t\telse $lastlogin = \"-\";\n\t\t\n\t\techo \"    <tr>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$sperricon.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" onclick=\\\"hide_unhide_tr('id\".$row['id'].\"');\\\" style=\\\"cursor: pointer;\\\">\".stripslashes($row['username']).\"</td>\n\t\t<td class=\\\"\".$class.\"\\\"><a href=\\\"mailto:\".stripslashes($row['mail']).\"\\\">\".stripslashes($row['mail']).\"</a></td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$row['level'].\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$lastlogin.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\"><a href=\\\"\".BuildURL($filename,NULL,array('action'=>'edit_user','userid'=>$row['id'])).\"\\\"><img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Bearbeiten - Stift\\\" title=\\\"Benutzer bearbeiten\\\" style=\\\"border:0;\\\" /></a></td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\"><a href=\\\"\".BuildURL($filename,NULL,array('action'=>'ask_del','userid'=>$row['id'])).\"\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"L&ouml;schen - rotes X\\\" title=\\\"Benutzer l&ouml;schen\\\" style=\\\"border:0;\\\" /></a></td>\n\t</tr>\";\n\t\techo \"<tr id=\\\"id\".$row['id'].\"\\\" style=\\\"display:none;\\\">\n\t\t<td class=\\\"\".$class.\"\\\" colspan=\\\"7\\\">\";\n\t\tforeach($userstats as $data){\n\t\t\techo \"<b>\".$data['statcat'].\"</b> \".$data['statvalue'].\"<br />\\n\";\n\t\t\t}\n\t\techo \"\\n\t\t</td>\n\t</tr>\";\n\t\t}\n\t\n\techo \"</table>\";\n\n\techo echopages($sites,\"80%\",\"site\",\"action=edit_users&amp;search=\".$_GET['search'].\"&amp;sort=\".$_GET['sort'].\"&amp;orderby=\".$_GET['orderby'].\"\");\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_users\" && $userdata['userverwaltung'] == 1){\n\t\techo \"<h1>Benutzer erstellen</h1>\";\n\t\techo \"<p><a href=\\\"users.php?action=add_user\\\" class=\\\"actionbutton\\\"><img src=\\\"images/icons/add.gif\\\" alt=\\\"Plus-Zeichen\\\" title=\\\"Neuen Benutzer erstellen\\\" style=\\\"border:0; margin-right:10px;\\\" />Neuen Benutzer erstellen</a></p>\";\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_users\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n\n// Abfrage: Benutzer l\u00f6schen\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"ask_del\" && $userdata['userverwaltung'] == 2){\n\t$error = 0;\n\t\n\tif($_GET['userid'] == $userdata['id']) $error = 1;\n\telse{\n\t\t$list = $mysqli->query(\"SELECT username,level FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($_GET['userid']).\"' AND id != '0' LIMIT 1\");\n\t\twhile($row = $list->fetch_assoc()){\n\t\t\t$u_username = $row['username'];\n\t\t\t$u_level = $row['level'];\n\t\t\t}\n\t\tif($u_level >= $userdata['level']) $error = 2;\n\t\t}\n\n\t// Ist ein Fehler aufgetreten?\n\tif($error == 0){\n\t\t// Normale weitere Programmausf\u00fchrung\n\t\techo \"<p class=\\\"meldung_frage\\\">M&ouml;chten Sie den Benutzer <i>\".$u_username.\"</i> wirklich l&ouml;schen?<br />\n\t\t\tVom Benutzer erstellte Beitr&auml;ge und hochgeladene Dateien etc. bleiben davon unber&uuml;hrt.<br />\n\t\t\t<b><a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'do_del','userid'=>$_GET['userid'])).\"\\\">JA</a> | \n\t\t\t<a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_users','userid'=>'')).\"\\\">NEIN</a></b></p>\";\n\t\t}\n\telseif($error == 1)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie k&ouml;nnen nicht Ihr eigenes Benutzerkonto l&ouml;schen!<br />\n\t\t\t<a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_users','userid'=>'')).\"\\\">Zur&uuml;ck</a>.</p>\";\n\telseif($error == 2)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie k&ouml;nnen keinen Benutzer l&ouml;schen, der das gleiche oder ein h&ouml;heres\n\t\t\tSicherheitslevel hat!\n\t\t\tBitte gehen Sie <a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_users','userid'=>'')).\"\\\">zur&uuml;ck</a>.</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Es trat ein unvorhergesehener Fehler auf. Bitte gehen Sie <a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_users','userid'=>'')).\"\\\">zur&uuml;ck</a>.</p>\";\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"ask_del\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n\n// Einzelnen Benutzer bearbeiten / Profil\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_user\" && $userdata['userverwaltung'] == 2 ||\nisset($_REQUEST['action']) && $_REQUEST['action'] == \"profil\" && $userdata['profil'] == 1){\n\t$error = 0;\n\tswitch($_REQUEST['action']){\n\t  case \"edit_user\":\n\t    // Weitere \u00dcberpr\u00fcfungen der \u00fcbergebenen Variablen\n\t\tif(!isset($_REQUEST['userid']) || isset($_REQUEST['userid']) && empty($_REQUEST['userid'])){\n\t\t\t$error = 1;\n\t\t\t}\n\t\telse{\n\t\t\t$list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($_REQUEST['userid']).\"' AND id != '0' AND (level < '\".$mysqli->escape_string($userdata['level']).\"' OR level = '10' AND level = '\".$mysqli->escape_string($userdata['level']).\"' OR id = '\".$mysqli->escape_string($userdata['id']).\"') LIMIT 1\");\n\t\t\tif($list->num_rows < 1) $error = 2;\n\t\t\t}\n\t\t\t\n\t\t$title = \"Benutzer bearbeiten\";\n\t\t$case = \"edit\";\n\t\t$readonly = \"\";\n\n\t\techo \"<h1>\".$title.\"</h1>\";\n\t\t\n\t\techo \"<form action=\\\"\".BuildURL($filename,NULL,array('action'=>'','userid'=>'')).\"\\\" method=\\\"post\\\" name=\\\"post\\\">\";\n\t  break;\n\t  case \"profil\":\n\t    $list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['user'].\" WHERE id='\".$userdata['id'].\"' AND id != '0' LIMIT 1\");\n\t\t\n\t\t$title = \"Eigenes Profil\";\n\t\t$case = \"profil\";\n\t\t$readonly = \" readonly=\\\"readonly\\\"\";\n\n\t\techo \"<h1>\".$title.\"</h1>\";\n\t\t\n\t\techo \"<form action=\\\"\".$filename.\"\\\" method=\\\"post\\\" name=\\\"post\\\">\";\n\t\t\n\t\tif(isset($_GET['show']) && $_GET['show'] == \"saved\"){\n\t\t\techo \"<p class=\\\"meldung_ok\\\">Daten wurden gespeichert.</p>\";\n\t\t\t}\n\t  break;\n\t  }\n\t\n\t// Ist ein Fehler aufgetreten?\n\tif($error == 0){\n\t\t//Normale weitere Programmausf\u00fchrung\n\t\t\n\t\tif($userdata['level'] < 10)\n\t\t\techo \"<p class=\\\"meldung_hinweis\\\">Sie k&ouml;nnen nur Einstellungen vornehmen f&uuml;r die Sie selbst &uuml;ber die entsprechenden Berechtigungen verf&uuml;gen.</p>\";\n\n\t\techo \"<table border=\\\"0\\\" align=\\\"center\\\" width=\\\"100%\\\" cellpadding=\\\"3\\\" cellspacing=\\\"5\\\" class=\\\"rundrahmen\\\">\";\n\t\t\n\t\t// Datensatz aus Datenbank holen und \"besondere\" Felder (Name, Passw etc.) ausgeben\n\t\twhile($datarow = $list->fetch_assoc()){\n\t\t\t// WIRD AUF PROFIL & USER-BEARBEITEN-SEITE ANGEZEIGT\n\t\t\techo \"<tr>\n\t\t\t\t<td colspan=\\\"2\\\" class=\\\"tra\\\"><h3>Stammdaten</h3></td>\n\t\t\t</tr>\n\t\t\t\n\t\t\t<tr>\n\t\t\t\t<td class=\\\"trb\\\" width=\\\"60%\\\"><b>Benutzername</b></td>\n\t\t\t\t<td class=\\\"trb\\\"><input type=\\\"text\\\" name=\\\"username\\\" value=\\\"\".stripslashes($datarow['username']).\"\\\" size=\\\"50\\\"\".$readonly.\" /></td>\n\t\t\t</tr>\n\t\t\t\n\t\t\t<tr>\n\t\t\t\t<td class=\\\"tra\\\"><b>E-Mail-Adresse</b></td>\n\t\t\t\t<td class=\\\"tra\\\"><input type=\\\"text\\\" name=\\\"mail\\\" value=\\\"\".stripslashes($datarow['mail']).\"\\\" size=\\\"50\\\" /></td>\n\t\t\t</tr>\";\n\t\t\n\t\t\t$count = 0;\n\t\t\tif($case == \"edit\"){\n// CASE: BENUTZER BEARBEITEN\n\t\t\t\techo \"<tr>\n\t\t\t\t\t<td class=\\\"trb\\\"><b>Passwort &auml;ndern</b></td>\n\t\t\t\t\t<td class=\\\"trb\\\">\n\t\t\t\t\t\t<input type=\\\"checkbox\\\" name=\\\"changepw\\\" value=\\\"1\\\" /> <span class=\\\"small\\\"><b>Bitte Checkbox markieren um das Passwort zu &auml;ndern.</b></span><br />\n\t\t\t\t\t\t<input type=\\\"radio\\\" name=\\\"pwwahl\\\" value=\\\"random\\\" checked=\\\"checked\\\" /> Zuf\u00e4lliges Passwort generieren <span class=\\\"small\\\">(Wird per E-Mail an den Benutzer verschickt)</span><br />\n\t\t\t\t\t\t<input type=\\\"radio\\\" name=\\\"pwwahl\\\" value=\\\"eigen\\\" /> Passwort festlegen: <input type=\\\"text\\\" name=\\\"password\\\" size=\\\"20\\\" /> <br /><span class=\\\"small\\\"><b>Mindestens \".PW_LAENGE.\" Zeichen</b></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\\\"tra\\\"><b>Sicherheitsstufe</b></td>\n\t\t\t\t\t<td class=\\\"tra\\\">\";\n\t\t\t\t\t\n\t\t\t\tif($userdata['id'] != $datarow['id']){\n\t\t\t\t\techo \"<select name=\\\"level\\\" size=\\\"1\\\">\";\n\t\t\t\t\tfor($x=1;$x<=$userdata['level'];$x++){\n\t\t\t\t\t\tif($datarow['level'] == $x) $sel = \" selected=\\\"selected\\\"\";\n\t\t\t\t\t\telse $sel = \"\";\n\t\t\t\t\t\t\n\t\t\t\t\t\techo \"<option value=\\\"\".$x.\"\\\"\".$sel.\">Sicherheitsstufe \".$x.\"</option>\\n\";\n\t\t\t\t\t\t}\n\t\t\t\t\techo \"</select>\";\n\t\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\techo \"<input type=\\\"text\\\" size=\\\"5\\\" name=\\\"level\\\" value=\\\"\".$userdata['level'].\"\\\" readonly=\\\"readonly\\\" />\";\n\t\t\t\t\n\t\t\t\techo \"</td>\n\t\t\t\t</tr>\";\n\t\t\t\t\n\t\t\t\t// Benutzer sperren / entsperren\n\t\t\t\tif($userdata['id'] != $datarow['id'] && $datarow['level'] <= $userdata['level']){ \"\";\n\t\t\t\t\tif($datarow['sperre'] == 1){\n\t\t\t\t\t\t$s_text = \"Benutzer ist gesperrt\";\n\t\t\t\t\t\t$s_color = \"tr_red\";\n\t\t\t\t\t\t$s_checked = \" checked=\\\"checked\\\"\";\n\t\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t$s_text = \"Benutzer sperren\";\n\t\t\t\t\t\t$s_color = \"trb\";\n\t\t\t\t\t\t$s_checked = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\techo \"<tr>\n\t\t\t\t\t\t<td class=\\\"\".$s_color.\"\\\"><b>\".$s_text.\"</b></td>\n\t\t\t\t\t\t<td class=\\\"\".$s_color.\"\\\">\n\t\t\t\t\t\t\t<input type=\\\"checkbox\\\" name=\\\"sperre\\\" value=\\\"1\\\"\".$s_checked.\" /> Benutzer sperren\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Zugriff eingesch\u00e4nkt?\n\t\t\t\tif($datarow['id'] != $userdata['id'] || $userdata['level'] == 10){\n\t\t\t\t\t$tempmodarray = array(\"01acp\");\n\t\t\t\t\t$tempmodarray = array_merge($tempmodarray,$inst_module);\n\n\t\t\t\t\tforeach($tempmodarray as $modul_akt){\n\t\t\t\t\t\t$cats_rights = getSettingCats($modul_akt,$mysql_tables['rights']);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Berechtigungen f\u00fcr die einzelnen Kategorien vorhanden?\n\t\t\t\t\t\tif(isset($cats_rights) && !empty($cats_rights) && ($userdata['level'] == 10 || ($userdata[$modul_akt] == 1 || $modul_akt == \"01acp\"))){\n\n\t\t\t\t\t\t\tforeach($cats_rights as $catvalue){\n\t\t\t\t\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\t\t\t\t\tif($modul_akt != \"01acp\") $echomodulname = $module[$modul_akt]['instname'].\" &raquo; \";\n\t\t\t\t\t\t\t\telse $echomodulname = \"\";\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif($catvalue['modul'] != \"01acp\")\n\t\t\t\t\t\t\t\t\techo \"<tr>\n\t\t\t\t\t\t\t\t<td colspan=\\\"2\\\" class=\\\"\".$class.\"\\\"><h3><a href=\\\"javascript:moo_hide_unhide_tr('\".$catvalue['catid'].$catvalue['modul'].\"');\\\" title=\\\"Berechtigungen einblenden\\\">\".$echomodulname.$catvalue['name'].\"</a></h3></td>\n\t\t\t\t\t\t\t\t</tr>\";\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\techo \"<tr>\n\t\t\t\t\t\t\t\t<td colspan=\\\"2\\\" class=\\\"\".$class.\"\\\"><h3>\".$echomodulname.$catvalue['name'].\"</h3></td>\n\t\t\t\t\t\t\t\t</tr>\";\n\n\t\t\t\t\t\t\t\t$query = \"SELECT * FROM \".$mysql_tables['rights'].\" WHERE modul='\".$mysqli->escape_string($modul_akt).\"' AND is_cat='0' AND catid='\".$catvalue['catid'].\"' AND hide='0' ORDER BY sortid\";\n\t\t\t\t\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\t\t\t\t\twhile($row = $list->fetch_assoc()){\n\t\t\t\t\t\t\t\t\t// Nur Einstellungen mit Berechtigungen des Users anzeigen und function-Felder prinzipiell \u00fcberspringen\n\t\t\t\t\t\t\t\t\tif($userdata['level'] < 10 && ($userdata[str_replace(\"01acp_\",\"\",$modul_akt.'_'.$row['idname'])] == 0 || $row['formename'] == \"function\")) continue;\n\n\t\t\t\t\t\t            if($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t$row['idname'] = $modul_akt.\"_\".$row['idname'];\n\t\t\t\t\t\t\t\t\t$row['wert'] = $datarow[$row['idname']];\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// MySQL-Daten verarbeiten\n\t\t\t\t\t\t\t\t\techo parse_dynFieldtypes($row,$class,$count,$catvalue['catid'].$catvalue['modul']);\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\t\techo \"<tr>\n\t\t\t        <td class=\\\"\".$class.\"\\\" colspan=\\\"2\\\"><b class=\\\"red\\\">Das eigene Benutzerkonto kann nur eingesch&auml;nkt bearbeitet werden!</b></td>\n\t\t\t    </tr>\";\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\techo \"<tr>\n\t\t        <td class=\\\"\".$class.\"\\\"><input type=\\\"reset\\\" value=\\\"Reset\\\" class=\\\"input\\\" /></td>\n\t\t        <td class=\\\"\".$class.\"\\\" align=\\\"right\\\">\n\t\t\t\t\t<input type=\\\"hidden\\\" name=\\\"action\\\" value=\\\"do_edit\\\" />\n\t\t\t\t\t<input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\".$_REQUEST['userid'].\"\\\" />\n\t\t\t\t\t<input type=\\\"submit\\\" value=\\\"Benutzer bearbeiten &raquo;\\\" class=\\\"input\\\" />\n\t\t\t\t</td>\n\t\t    </tr>\";\n\t\t\t}\n\t\t\telse{\n// CASE: PROFIL\n\t\t\t\t$modul_temp = $modul;\n\t\t\t\t$modul = $userdata['startpage'];\n\n\t\t\t\techo \"<tr>\n\t\t\t\t<td class=\\\"trb\\\"><b>Passwort &auml;ndern</b></td>\n\t\t\t\t<td class=\\\"trb\\\"><img src=\\\"images/icons/icon_pw.gif\\\" alt=\\\"Icon: Schl\u00fc&szlig;el\\\" title=\\\"Passwort &auml;ndern\\\" /> <a href=\\\"javascript:popup('change_pw','','','',330,280);\\\">Passwort \u00e4ndern</a></td>\n\t\t\t\t</tr>\n\t\t\t\t\n\t\t\t\t<tr>\n\t\t\t\t<td colspan=\\\"2\\\" class=\\\"tra\\\"><h3>Startseite w&auml;hlen</h3></td>\n\t\t\t\t</tr>\n\t\t\t\t\n\t\t\t\t<tr>\n\t\t\t\t<td class=\\\"trb\\\"><b>Gew&uuml;nschte Startseite ausw&auml;hlen</b></td>\n\t\t\t\t<td class=\\\"trb\\\"><select name=\\\"startpage\\\" size=\\\"1\\\" class=\\\"input_select\\\">\n\t\t\t\t\t\".create_ModulDropDown(TRUE).\"\n\t\t\t\t</select></td>\n\t\t\t\t</tr>\n\t\t\t\t\n\t\t\t\t<tr>\n\t\t\t\t<td colspan=\\\"2\\\" class=\\\"tra\\\"><h3>Weitere Profilfelder</h3></td>\n\t\t\t\t</tr>\";\n\t\t\t\t$modul = $modul_temp;\n\t\t\t\t\n\t\t\t\t$query = \"SELECT * FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND hide='0' AND in_profile='1' ORDER BY catid,sortid\";\n\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\twhile($row = $list->fetch_assoc()){\n\t\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\t\t\n\t\t\t\t\t$row['idname'] = $row['modul'].\"_\".$row['idname'];\n\t\t\t\t\t$row['wert'] = $datarow[$row['idname']];\n\t\t\t\t\t\n\t\t\t\t\t// MySQL-Daten verarbeiten\n\t\t\t\t\techo parse_dynFieldtypes($row,$class,$count,\"01acp\");\n\t\t\t\t\t}\n\n\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\techo \"<tr>\n\t\t        <td class=\\\"\".$class.\"\\\"><input type=\\\"reset\\\" value=\\\"Reset\\\" class=\\\"input\\\" /></td>\n\t\t        <td class=\\\"\".$class.\"\\\">\n\t\t\t\t\t<input type=\\\"hidden\\\" name=\\\"action\\\" value=\\\"save_profile\\\" />\n\t\t\t\t\t<input type=\\\"submit\\\" value=\\\"Speichern &raquo;\\\" class=\\\"input\\\" />\n\t\t\t\t</td>\n\t\t    </tr>\";\n\t\t\t}\n\t\t}\n\t\t\n\t\techo \"</table>\";\n\t\techo \"</form><br />\";\n\t}\n\telseif($error == 1)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Die &uuml;bergebene Benutzer-ID ist leider fehlerhaft &amp; in dieser\n\t\t\tForm nicht g&uuml;ltig. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\telseif($error == 2)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Zur &uuml;bergebene Benutzer-ID konnte leider kein passender\n\t\t\tEintrag in der Datenbank gefunden werden, <b>oder Sie haben keine Berechtigung um diesen Benutzer zu bearbeiten</b>.\n\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Es trat ein unvorhergesehener Fehler auf. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\n}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_user\" || isset($_REQUEST['action']) && $_REQUEST['action'] == \"profil\")\n\t$flag_loginerror = true;\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>"], "fixing_code": ["<?PHP\n/* \n\t01ACP - Copyright 2008 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\t\u2584bersicht \u00b3ber zentral zur Verf\u00b3gung stehende Arrays\n*/\n\n$menuecat = \"01acp_start\";\n$sitetitle = \"Dev-\u2584bersicht\";\n$filename = $_SERVER['SCRIPT_NAME'];\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata['level'] == 10){\n?>\n\n<b>$userdata</b><br /><code>\n<?PHP echo print_r($userdata); ?>\n</code>\n\n<br /><br />\n\n<b>$settings</b><br /><code>\n<?PHP echo print_r($settings); ?>\n</code>\n\n<br /><br />\n\n<b>$module</b><br /><code>\n<?PHP echo print_r($module); ?>\n</code>\n\n<br /><br />\n\n<b>$inst_module</b><br /><code>\n<?PHP echo print_r($inst_module); ?>\n</code>\n\n<br /><br />\n\n<b>$mysql_tables</b><br /><code>\n<?PHP echo print_r($mysql_tables); ?>\n</code>\n\n<br /><br />\n\n<b>$picendungen</b><br /><code>\n<?PHP echo print_r($picendungen); ?>\n</code>\n\n<br /><br />\n\n<b>$attachmentendungen</b><br /><code>\n<?PHP echo print_r($attachmentendungen); ?>\n</code>\n\n<br /><br />\n\n<?PHP\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n// 01ACP Copyright 2008 by Michael Lorer - 01-Scripts.de\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tModulseiten laden\n*/\n\n// Config-Dateien\ninclude(\"system/main.php\");\n\nif(!isset($_REQUEST['loadpage'])) $_REQUEST['loadpage'] = \"\";\n\n$menuecat = $modul;\n$sitetitle = $module[$modul]['instname'];\n$filename = $_SERVER['SCRIPT_NAME'].\"?modul=\".$modul.\"&amp;loadpage=\".$_REQUEST['loadpage'];\n\ninclude(\"system/head.php\");\n\nif(isset($_GET['modul']) && $_GET['modul'] == \"01acp\")\n\techo \"<script>redirect(\\\"acp.php\\\");</script>\";\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata[$modul] == 1){\n\n//echo $modulpath.$loadfile[$_REQUEST['loadpage']];\nif(isset($loadfile[$_REQUEST['loadpage']]) && file_exists($modulpath.$loadfile[$_REQUEST['loadpage']]) && !is_dir($modulpath.$loadfile[$_REQUEST['loadpage']]))\n\tinclude_once($modulpath.$loadfile[$_REQUEST['loadpage']]);\nelseif(file_exists($modulpath.$loadfile['index']) && !is_dir($modulpath.$loadfile['index']))\n\tinclude_once($modulpath.$loadfile['index']);\nelse\n\techo \"<p class=\\\"meldung_error\\\">Fehler: Es konnte keine zum Modul <i>\".$module[$modul]['instname'].\"</i>\n\t\t\tpassende Datei geladen werden.</p>\";\n\n\n\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n// 01ACP Copyright 2008 by Michael Lorer - 01-Scripts.de\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2013 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tStartseite des ACP-Bereich\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_start\";\n$sitetitle = \"Startseite\";\n$mootools_use = array(\"moo_core\",\"moo_more\",\"moo_slideh\",\"moo_request\");\n$filename = $_SERVER['SCRIPT_NAME'];\n\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0){\ninclude_once(\"system/includes/tt.php\");\n\n// 01-Scripts.de RSS-Feed neu vom Server holen\nif($settings['cachetime']+CACHE_TIME_01RSS < time() && $flag_showacpRSS){\n\tgetXML2Cache(ACPSTART_RSSFEED_URL,RSS_CACHEFILE);\n\tgetXML2Cache(HTTP_VERSIONSINFO_DATEILINK,LOKAL_VERSIONSINFO_DATEILINK);\n\t}\n\n// Neue Versions-XML vom 01-Scripts.de-Server holen\nif($settings['cachetime']+CACHE_TIME < time() && $userdata['module'] == 1){\n\tgetXML2Cache(HTTP_VERSIONSINFO_DATEILINK,LOKAL_VERSIONSINFO_DATEILINK);\n\t}\n\n$xml = @simplexml_load_file(LOKAL_VERSIONSINFO_DATEILINK);\nif($xml && $xml->_01acp->version > $settings['acpversion'] && $userdata['module'] == 1)\n\t$newerversion = \" <a href=\\\"\".$xml->_01acp->updateurl.\"\\\" target=\\\"_blank\\\"><b class=\\\"yellow\\\">Update verf\u25a0gbar!</b></a>\";\nelse\n\t$newerversion = \"\"; \n\n?>\n\n<div class=\"acp_startbox\">\n<p align=\"center\">Herzlich Willkommen im <b class=\"yellow\">A</b>dmin <b class=\"yellow\">C</b>ontrol <b class=\"yellow\">P</b>anel</p>\n\n<div class=\"acp_doubleinnerbox\">\n\t<p style=\"float:left; margin-right:15px; margin-top:17px;\"><b>Was m\u2014chten Sie tun?</b></p>\n\t<br />\n\t<form action=\"_loader.php\" method=\"get\">\n\t\t<select name=\"modul\" size=\"1\" class=\"input_select2\" onchange=\"location.href='_loader.php?modul='+this.options[this.selectedIndex].value+''\">\n\t\t\t<?PHP echo create_ModulDropDown(TRUE); ?>\n\t\t</select>\n\t\t<input name=\"input2\" type=\"submit\" class=\"input2\" value=\"Modul ausw&auml;hlen und arbeiten &raquo;\" />\n\t</form>\n</div>\n\n<div class=\"acp_innerbox\">\n\t<h4>Informationen</h4>\n\t<p>\n\t\t<b>01ACP-Version:</b> <?PHP echo $settings['acpversion'].$newerversion; ?><br />\n\t\t<br />\n\t\t<b>Benutzer:</b> <?PHP list($usermenge) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['user'].\" WHERE id!='0'\")->fetch_array(MYSQLI_NUM); echo $usermenge; ?><br />\n\t\t<b>Dateien:</b> <?PHP list($filemenge) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['files'].\" WHERE filetype='file'\")->fetch_array(MYSQLI_NUM); echo $filemenge; ?><br />\n\t\t<b>Bilder:</b> <?PHP list($picmenge) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['files'].\" WHERE filetype='pic'\")->fetch_array(MYSQLI_NUM); echo $picmenge; ?>\n\t\t<br /><br />\n\t\t<a href=\"http://board.01-scripts.de\" target=\"_blank\">Supportforum &amp; FAQ &raquo;</a><br />\n\t\t<a href=\"http://www.01-scripts.de/contact.php\" target=\"_blank\">Kontakt &raquo;</a><br />\n\t\t<br />\n\t\t<a href=\"http://www.01-scripts.de/lizenz.php\" target=\"_blank\">Lizenzbestimmungen &raquo;</a>\n\t</p>\n</div>\n<div class=\"acp_innerbox\">\n<?PHP \nif($flag_showacpRSS && ACPSTART_RSSFEED_URL != \"\")\n\t$rss01 = @simplexml_load_file(RSS_CACHEFILE);\nelse\n\t$rss01 = FALSE;\n\nif($flag_showacpRSS && ACPSTART_RSSFEED_URL != \"\" && $rss01){  \n\techo \"<h4>01-Scripts.de - News</h4>\";\n\tfor($x=0;$x<4;$x++){\n\t\techo \"<p>\".substr($rss01->channel->item->$x->pubDate,0,25).\"<br />\";\n\t\techo \"<a href=\\\"\".$rss01->channel->item->$x->link.\"\\\" target=\\\"_blank\\\"><b>\";\n\t\techo utf8_decode($rss01->channel->item->$x->title);\n\t\techo \"</b></a></p>\";\n\t\t}\n\t}\nelse{\n\techo \"<h4>Tipps &amp; Tricks</h4>\";\n\t\n\t$rand_tt = array_rand($tt, 3);\n\t\n\techo \"<ul>\\n\";\n\tforeach($rand_tt as $tippnr){\n\t\techo \"<li>\".$tt[$tippnr].\"</li>\\n\";\n\t}\n\techo \"\\n</ul>\";\n\t}\n ?>\n</div>\n<br />\n\n</div>\n<?PHP\n$rand_tt = array_rand($tt, 1);\necho \"<p align=\\\"center\\\"><b>Tipp:</b> \".$tt[$rand_tt].\"</p>\";\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2013 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tKommentare verwalten\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_comments\";\n$sitetitle = \"Kommentare verwalten\";\n$mootools_use = array(\"moo_core\",\"moo_more\",\"moo_slideh\",\"moo_request\");\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n$filename = $_SERVER['SCRIPT_NAME'].\"?modul=\".$modul.\"\";\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata['editcomments'] == 1){\n\necho \"<h1>Kommentare verwalten</h1>\";\n\necho \"<p class=\\\"meldung_erfolg\\\" id=\\\"del_erfolgsmeldung\\\" style=\\\"display:none;\\\">\n\tDer Kommentar wurde erfolgreich gel&ouml;scht.\n</p>\";\n\nif($modul != \"01acp\"){\n\n\t// Selektierte Kommentare l\u00f6schen\n\tif(isset($_POST['cdelid']) && !empty($_POST['cdelid']) && \n\t   isset($_POST['delselected']) && $_POST['delselected'] == 1){\n\t\t$cup = 0;\n\t\tforeach($_POST['cdelid'] as $delid){\n\t\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['comments'].\" WHERE modul='\".$mysqli->escape_string($modul).\"' AND id='\".$mysqli->escape_string($delid).\"' LIMIT 1\");\n\t\t\t$cup++;\n\t\t\t}\n\t\techo \"<p class=\\\"meldung_erfolg\\\">Es wurden \".$cup.\" Kommentare gel&ouml;scht</p>\";\n\t\t}\n\t\n\t// Alle Kommentare eines Beitrags l\u00f6schen\n\tif(isset($_GET['delpostid']) && !empty($_GET['delpostid']) && isset($_GET['do']) && $_GET['do'] == \"dodelall\"){\n\t\tif(isset($_GET['delsubpostid']) && !empty($_GET['delsubpostid']) && $_GET['delsubpostid'] != 0)\n\t\t\tdelSubPostComments($_GET['delpostid'],$_GET['delsubpostid']);\n\t\telse\n\t\t\tdelComments($_GET['delpostid']);\n\t\t\n\t\techo \"<p class=\\\"meldung_erfolg\\\">Kommentare wurden gel&ouml;scht</p>\";\n\t\t}\n\t\t\n\t\n\tif(isset($_GET['postid']) && !empty($_GET['postid']) && isset($_GET['do']) && $_GET['do'] == \"deleteall\"){\n\t\techo \"<p class=\\\"meldung_frage\\\">M&ouml;chten Sie wirklich alle zum Eintrag <i>\".stripslashes($_GET['ptitel']).\"</i>\n\t\t\tgeh&ouml;renden <b>Kommentare komplett l&ouml;schen?</b><br />\n\t\t\t<br />\n\t\t\t<a href=\\\"\".$filename.\"&amp;do=dodelall&amp;delsubpostid=\".$_GET['subpostid'].\"&amp;delpostid=\".$_GET['postid'].\"&amp;commentsites=\".$_GET['commentsites'].\"\\\">JA</a> | <a href=\\\"javascript:history.back();\\\">Nein</a></p>\";\n\t\t}\n\t// Kommentare zu einem bestimmten Post / Subpost auflisten\n\telseif(isset($_GET['postid']) && !empty($_GET['postid'])){\n\t\t// Kommentare zu Sub-Posts auflisten:\n\t\tif(isset($_GET['subpostid']) && !empty($_GET['subpostid'])){\n\t\t\t$sites = 0;\n\t\t\t$query = \"SELECT id,postid,subpostid,frei,utimestamp,ip,autor,email,message,smilies,bbc FROM \".$mysql_tables['comments'].\" WHERE postid='\".$mysqli->escape_string($_GET['postid']).\"' AND subpostid='\".$mysqli->escape_string($_GET['subpostid']).\"' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY utimestamp DESC\";\n\t\t\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\t\t\n\t\t\t$list = $mysqli->query($query);\n\t\t\t\n\t\t\techo \"<h2>Kommentare bearbeiten <img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Stift + Block\\\" title=\\\"bearbeiten\\\" /></h2>\";\n\t\t\techo \"<p><a href=\\\"\".$filename.\"&amp;showsub=1&amp;postid=\".$_GET['postid'].\"\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t\t\t\n\t\t\techo \"<p><a href=\\\"\".$filename.\"&amp;postid=\".$_GET['postid'].\"&amp;subpostid=\".$_GET['subpostid'].\"&amp;do=deleteall&amp;ptitel=\\\">Alle zu diesem Eintrag geh&ouml;renden Kommentare l&ouml;schen &raquo;</a></p>\";\n\t\t\t\n\t\t\techo getCommentList($query,\"free\");\n\t\t\t\n\t\t\techo echopages($sites,\"80%\",\"site\",\"modul=\".$modul.\"&amp;postid=\".$_GET['postid'].\"&amp;subpostid=\".$_GET['subpostid']);\n\t\t\t}\n\t\t// Sub-POSTS selber auflisten:\n\t\telseif(isset($_GET['showsub']) && $_GET['showsub'] == 1 && function_exists(\"_\".$module[$modul]['modulname'].\"_getCommentChildTitle\")){\n\t\t\t$csites = 0;\n\t\t\t$menge = 0;\n\t\t\t$query = \"SELECT DISTINCT subpostid FROM \".$mysql_tables['comments'].\" WHERE frei = '1' AND modul='\".$mysqli->escape_string($modul).\"' AND postid = '\".$mysqli->escape_string($_GET['postid']).\"' ORDER BY (subpostid*'1') DESC\";\n\t\t\t$query = makepages($query,$csites,\"commentsites\",ACP_PER_PAGE);\n\t\t\t\n\t\t\techo \"<h2>Kommentare bearbeiten <img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Stift + Block\\\" title=\\\"bearbeiten\\\" /></h2>\";\n\t\t\t\n\t\t\techo \"<p><a href=\\\"\".$filename.\"\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t\t\t\n\t\t\techo getCommentPostList($query,\"child\");\n\t\t\t\n\t\t\techo echopages($csites,\"80%\",\"commentsites\",\"modul=\".$modul.\"&amp;postid=\".$_GET['postid'].\"&amp;showsub=1\");\n\t\t\t}\n\t\t// Kommentare zu Posts auflisten:\n\t\telse{\n\t\t\t$sites = 0;\n\t\t\t$query = \"SELECT id,postid,frei,utimestamp,ip,autor,email,message,smilies,bbc FROM \".$mysql_tables['comments'].\" WHERE postid='\".$mysqli->escape_string($_GET['postid']).\"' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY utimestamp DESC\";\n\t\t\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\t\t\n\t\t\t$list = $mysqli->query($query);\n\t\t\t\n\t\t\techo \"<h2>Kommentare bearbeiten <img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Stift + Block\\\" title=\\\"bearbeiten\\\" /></h2>\";\n\t\t\techo \"<p><a href=\\\"\".$filename.\"\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t\t\t\n\t\t\techo \"<p><a href=\\\"\".$filename.\"&amp;postid=\".$_GET['postid'].\"&amp;do=deleteall&amp;ptitel=\\\">Alle zu diesem Eintrag geh&ouml;renden Kommentare l&ouml;schen &raquo;</a></p>\";\n\t\t\t\n\t\t\techo getCommentList($query,\"free\");\n\t\t\t\n\t\t\techo echopages($sites,\"80%\",\"site\",\"modul=\".$modul.\"&amp;postid=\".$_GET['postid']);\n\t\t\t}\n\t\t}\n\telse{\n\t\t// Kommentare, die freigeschaltet werden m\u00fcssen auflisten:\n\t\t$sites = 0;\n\t\t$menge = 0;\n\t\t$query = \"SELECT id,postid,utimestamp,ip,autor,email,message,smilies,bbc FROM \".$mysql_tables['comments'].\" WHERE frei = '0' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY utimestamp DESC\";\n\t\t$query = makepages($query,$sites,\"commentfreesite\",ACP_PER_PAGE);\n\t\t\n\t\t$list = $mysqli->query($query);\n\t\t$menge = $list->num_rows;\n\t\t\n\t\tif($menge > 0){\n\t\t\n\t\t\techo \"<h2>Kommentare freischalten <img src=\\\"images/icons/ok.gif\\\" alt=\\\"OK\\\" title=\\\"freischalten\\\" /></h2>\";\n\t\t\techo getCommentList($query,\"free\");\n\t\t\t\n\t\t\techo echopages($sites,\"80%\",\"commentfreesite\",\"modul=\".$modul.\"\");\n\t\t\t}\n\n\t\t// Posts mit Kommentaren auflisten:\n\t\t$csites = 0;\n\t\t$menge = 0;\n\t\t$query = \"SELECT DISTINCT postid FROM \".$mysql_tables['comments'].\" WHERE frei = '1' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY (postid*'1') DESC\";\n\t\t$query = makepages($query,$csites,\"commentsites\",ACP_PER_PAGE);\n\t\t\n\t\techo \"<h2>Kommentare bearbeiten <img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Stift + Block\\\" title=\\\"bearbeiten\\\" /></h2>\";\n\t\t\n\t\techo getCommentPostList($query);\n\t\t\n\t\techo echopages($csites,\"80%\",\"commentsites\",\"modul=\".$modul.\"\");\n\t\t}// Ende: Auflistung der Kommentare zu einem bestimmten Post\n\t}\nelse{\n\techo \"<div class=\\\"meldung_hinweis\\\"><p><b>Bitte w&auml;hlen Sie ein Modul</b></p>\".\n\t\tcreate_ModulForm($_SERVER['SCRIPT_NAME'].\"?\",\"input\",TRUE).\"</div>\";\n\t}\n\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2013 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tDatei- & Bildverwaltung (Hochgeladenen Bilder und andere Dateien verwalten sowie neue Dateien hochladen)\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_filemanager\";\n$sitetitle = \"Datei- &amp; Bildverwaltung\";\n$filename = $_SERVER['SCRIPT_NAME'];\n$mootools_use = array(\"moo_core\",\"moo_more\",\"moo_remooz\",\"moo_request\",\"moo_dragdrop\");\n\n\nif(!isset($_REQUEST['type'])) $_REQUEST['type'] = \"\";\nif(!isset($_REQUEST['search'])) $_REQUEST['search'] = \"\";\nif(!isset($_REQUEST['dir'])) $_REQUEST['dir'] = \"\";\n\n$filename2 = $filename.\"?type=\".$_REQUEST['type'].\"&amp;search=\".$_REQUEST['search'].\"&amp;dir=\".$_REQUEST['dir'];\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\nif(!isset($_REQUEST['uid'])) $_REQUEST['uid'] = \"\";\n\n// Sicherheitsabfrage: Login & Benutzerrechte f\u50e1 Dateimanager\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata['dateimanager'] >= 1){\n\n\tswitch($_REQUEST['type']){\n\t  case \"pic\":\n\t    echo \"<h1>Bildverwaltung</h1>\";\n\t  break;\n\t  case \"file\":\n\t    echo \"<h1>Dateiverwaltung</h1>\";\n\t  break;\n\t  default:\n\t    echo \"<h1>Datei- &amp; Bildverwaltung</h1>\";\n\t  break;\n\t  }\n\n\techo \"<p>\";\n\t// Darf neues Verzeichnis erstellen?\n\tif($userdata['dateimanager'] == 2){\n?>\n\t<a href=\"javascript: hide_unhide('adddir');\" class=\"actionbutton\">\n\t\t<img src=\"images/icons/add.gif\" alt=\"Plus-Icon\" title=\"Neues Verzeichnis anlegen\" style=\"border:0; margin-right:10px;\" />Neues Verzeichnis anlegen\n\t</a>\n<?PHP\n\t\t}\n\t\n\t// Berechtigung f\u50e1 Upload vorhanden?\n\tif($userdata['upload'] == 1){\n?>\n\t<!-- <a href=\"javascript: hide_unhide('uploadbox');\" class=\"actionbutton\"> -->\n\t<a href=\"javascript:popup('fmanageruploader','','','',620,480);\" class=\"actionbutton\">\n\t\t<img src=\"images/icons/icon_upload.gif\" alt=\"Neue Datei/Bild hochladen\" style=\"border:0; margin-right:10px;\" />Neue Datei / Bild hochladen\n\t</a>\n\t<?PHP } ?>\n</p>\n\n<?PHP\n\t// Berechtigung f\u50e1 Upload vorhanden?\n\tif($userdata['dateimanager'] == 2){\n\t\n\t$display = \"none\";\n\t// Verzeichnis anlegen\n\tif(isset($_POST['create_new_dir']) && $_POST['create_new_dir'] == 1 &&\n\t   isset($_POST['new_verzname']) && !empty($_POST['new_verzname'])){\n\t\t//Eintragung in Datenbank vornehmen:\n\t\t$sql_insert = \"INSERT INTO \".$mysql_tables['filedirs'].\" (parentid,utimestamp,name,uid) VALUES (\n\t\t\t\t\t'\".$mysqli->escape_string($_POST['parentfiledirid']).\"',\n\t\t\t\t\t'\".time().\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_POST['new_verzname']).\"',\n\t\t\t\t\t'\".$userdata['id'].\"'\n\t\t\t\t\t)\";\n\t\t$mysqli->query($sql_insert);\n\t\t\n\t\t$display = \"block\";\n\t\techo \"\n<script type=\\\"text/javascript\\\">\nSuccess_standard();\n</script>\";\n\t\t}\n\telseif(isset($_POST['create_new_dir']) && $_POST['create_new_dir'] == 1){\n\t\t$display = \"block\";\n\t\techo \"\n<script type=\\\"text/javascript\\\">\nShowAjaxError('<b>Fehler:</b><br />Sie haben nicht alle ben&ouml;tigen Felder ausgef&uuml;llt!');\n</script>\";\t\t\n\t\t}\n\t\t\n\t// Markierte Dateien l\u98c9chen\n\tif(isset($_POST['delselected']) && $_POST['delselected'] == 1 &&\n\t   isset($_POST['delfiles'])){\n\t\tif(!is_array($_POST['delfiles']))\n\t\t    $_POST['delfiles'] = array($_POST['delfiles']);\n\t\t\n\t\t$cup = 0;\n\t\tforeach($_POST['delfiles'] as $fileid){    \n\t\t\t$list = $mysqli->query(\"SELECT filetype,name,uid FROM \".$mysql_tables['files'].\" WHERE id='\".$mysqli->escape_string($fileid).\"' LIMIT 1\");\n\t\t\twhile($row = $list->fetch_assoc()){\n\t\t\t\t\n\t\t\t\tif($userdata['dateimanager'] == 2 || $userdata['dateimanager'] == 1 && $row['uid'] == $userdata['id']){\n\t\t\t\t\tswitch($row['filetype']){\n\t\t\t\t\t  case \"pic\":\n\t\t\t\t\t    if(delfile($picuploaddir,$row['name']))\n\t\t\t\t\t        $cup++;\n\t\t\t\t\t    break;\n\t\t\t\t\t  case \"file\":\n\t\t\t\t\t    if(delfile($attachmentuploaddir,$row['name']))\n\t\t\t\t\t        $cup++;\n\t\t\t\t\t    break;\n\t\t\t\t\t  }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t    }\n\t\techo \"<p class=\\\"meldung_erfolg\\\">\n\t\tEs wurden \".$cup.\" Dateien erfolgreich gel&ouml;scht.\n\t\t</p>\";\n\t\t}\n\telseif(isset($_POST['delfiles']))\n\t    echo \"<p class=\\\"meldung_hinweis\\\">\n\t\t<b>Bitte markieren Sie die <span style=\\\"color:#B00;\\\">Checkbox</span> unten, um die Dateien wirklich zu l&ouml;schen!</b>\n\t\t</p>\";\n?>\n\n<div id=\"adddir\" style=\"display: <?PHP echo $display; ?>;\">\n<form action=\"filemanager.php\" method=\"post\">\n\t<input type=\"text\" size=\"34\" name=\"new_verzname\" class=\"input_text\" />\n\t<select name=\"parentfiledirid\" size=\"1\" class=\"input_select\">\n\t\t<option value=\"0\">Kein Unterverzeichnis</option>\n\t\t<?PHP echo getFileVerz_Rek(0,0,-1,\"echo_FileVerz_select\",0); ?>\n\t</select>\n\t<input type=\"submit\" value=\"Anlegen &raquo;\" class=\"input\" />\n\t<input type=\"hidden\" name=\"create_new_dir\" value=\"1\" />\n</form>\n</div>\n\n<?PHP\n\t\t}\n\n\tif(isset($_GET['sort']) && $_GET['sort'] == \"desc\") $sortorder = \"DESC\";\n\telse{ $sortorder = \"ASC\"; $_GET['sort'] = \"ASC\"; }\n\t\n\tif(isset($_REQUEST['search']) && !empty($_REQUEST['search']) && $_REQUEST['search'] != \"Nach Dateiennamen suchen\") $where = \" WHERE orgname LIKE '%\".$mysqli->escape_string($_REQUEST['search']).\"%'\";\n\telse{ $where = \" WHERE 1 = 1\"; $_GET['search'] = \"\"; }\n\t\n\tif(isset($_REQUEST['dir']) && !empty($_REQUEST['dir']) && is_numeric($_REQUEST['dir'])) $where .= \" AND dir = '\".$mysqli->escape_string($_REQUEST['dir']).\"' \";\n\telse{ $_REQUEST['dir'] = 0; $where .= \" AND dir = '0' \"; }\n\t\n\tif($userdata['dateimanager'] == 1) $where .= \" AND uid='\".$userdata['id'].\"' \";\n\t\n\tif(isset($_REQUEST['uid']) && !empty($_REQUEST['uid']) && $userdata['dateimanager'] == 2) $where .= \" AND uid='\".$mysqli->escape_string($_REQUEST['uid']).\"' \";\n\t\n\tif(isset($_REQUEST['type']) && ($_REQUEST['type'] == \"pic\" || $_REQUEST['type'] == \"file\")) $where .= \" AND filetype = '\".$mysqli->escape_string($_REQUEST['type']).\"'\";\n\telse $_GET['type'] = \"\";\n\n\tif(!isset($_GET['orderby'])) $_GET['orderby'] = \"\";\n\tswitch($_GET['orderby']){\n\t  case \"downloads\":\n\t    $orderby = \"downloads+0 \".$sortorder.\",orgname,id\";\n\t  break;\n\t  case \"filename\":\n\t    $orderby = \"orgname,id\";\n\t  break;\n\t  case \"size\":\n\t    $orderby = \"size+0 \".$sortorder.\",orgname,id\";\n\t  break;\n\t  case \"date\":\n\t    $orderby = \"utimestamp \".$sortorder.\",orgname,id\";\n\t  break;  \n\t  default:\n\t    $orderby = \"utimestamp DESC,orgname,id\";\n\t  break;\n\t  }\n\n\t$sites = 0;\n\t$query = \"SELECT * FROM \".$mysql_tables['files'].\"\".$where.\" ORDER BY \".$orderby.\" \".$sortorder;\n\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\n\n\t// Fehlermeldung bei erfolgloser Suche\n\tif($sites == 0 && isset($_GET['search']) && !empty($_GET['search']))\n\t\techo \"<p class=\\\"meldung_error\\\">Es konnte leider kein Benutzer zu Ihrer Sucheingabe \\\"\".$_GET['search'].\"\\\" gefunden werden!<br />\n\t\t\tBitte probieren Sie es erneut.</p>\";\n?>\n<form action=\"<?PHP echo $filename; ?>\" method=\"get\">\n\t<p><input type=\"text\" name=\"search\" value=\"Nach Dateiennamen suchen\" size=\"30\" onfocus=\"clearField(this);\" onblur=\"checkField(this);\" class=\"input_search\" /> \n\t<select name=\"type\" size=\"1\" class=\"input_select\"><option value=\"\">Dateien &amp; Bilder</option><option value=\"pic\">Nur Bilder</option><option value=\"file\">Nur Dateien</option></select>\n\t<input type=\"submit\" value=\"Suchen &raquo;\" class=\"input\" /></p>\n</form>\n\n<p class=\"meldung_erfolg\" id=\"del_erfolgsmeldung\" style=\"display:none;\">\n\tDie Datei wurde erfolgreich gel&ouml;scht.\n</p>\n\n<p class=\"meldung_erfolg\" id=\"ers_erfolgsmeldung\" style=\"display:none;\">\n\tDie Datei wurde erfolgreich ersetzt!\n</p>\n\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen trab\">\n\n    <tr>\n\t\t<td style=\"width:10px;\" align=\"center\"><!--Mehrfach-L\u98c9chen--></td>\n\t\t<td style=\"width:70px;\" align=\"center\"><img src=\"images/icons/refresh.gif\" alt=\"Refresh-Icon\" title=\"Seite neu laden\" onclick=\"document.location.reload(true);\" /></td>\n        <td><b>Dateiname</b>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=asc&amp;orderby=filename\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=desc&amp;orderby=filename\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t\t<span style=\"float:right;\">\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=asc&amp;orderby=downloads\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=desc&amp;orderby=downloads\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t\t</span>\n\t\t</td>\n\t\t<td style=\"width:90px;\"><b>Gr\u5ef2e</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=asc&amp;orderby=size\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=desc&amp;orderby=size\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td style=\"width:90px;\"><b>Datum</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=asc&amp;orderby=date\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo $filename2.\"&amp;uid=\".$_REQUEST['uid']; ?>&amp;sort=desc&amp;orderby=date\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td style=\"width:130px;\"><b>Benutzer</b></td>\n\t\t<td style=\"width:20px;\">&nbsp;<!--Ersetzen--></td>\n\t\t<td style=\"width:20px;\" align=\"center\"><!--L\u98c9chen--><img src=\"images/icons/icon_trash.gif\" alt=\"M&uuml;lleimer\" title=\"Datei l&ouml;schen\" /></td>\n    </tr>\n\n<?PHP\necho getFilelist($query,$filename2.\"&amp;sort=\".$_GET['sort'].\"&amp;orderby=\".$_GET['orderby'].\"\",TRUE,TRUE,TRUE,TRUE,\"\");\n?>\n\n    <tr>\n\t\t<td align=\"center\" style=\"border: 1px solid #B00;\"><input type=\"checkbox\" name=\"delselected\" value=\"1\" /></td>\n\t\t<td colspan=\"7\" align=\"left\">\n\t\t\t<input type=\"submit\" name=\"sending\" value=\"Markierte Dateien l&ouml;schen\" class=\"input\" />\n\t\t\tEs erfolgt <b>keine</b> weitere Abfrage!\n\t\t</td>\n\t</tr>\n\n</form>\n</table>\n<br />\n\n<?PHP\necho echopages($sites,\"80%\",\"site\",\"search=\".$_GET['search'].\"&amp;type=\".$_GET['type'].\"&amp;sort=\".$_GET['sort'].\"&amp;orderby=\".$_GET['orderby'].\"&amp;dir=\".$_REQUEST['dir'].\"\").\"<br />\";\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2015 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tLogin-Formular f\u50e1 ACP-Bereich\n\t#fv.131#\n*/\n\n$dontshow = true;\n$menuecat = \"login\";\n$sitetitle = \"Anmelden\";\n$filename = $_SERVER['SCRIPT_NAME'];\n$message = \"\";\n$menge = 0;\n$error = 1;\n$des_cookie = \"\";\n\nif(!isset($_POST['username'])) $_POST['username'] = \"\";\n\n// Config-Dateien\ninclude(\"system/main.php\");\n\n//Logout\nif(isset($_GET['action']) && $_GET['action'] == \"logout\"){\n    session_destroy();\n\n\tif(isset($_COOKIE[$instnr.'_start_auth_01acp'])){\n\t\t$des_cookie = $_COOKIE[$instnr.'_start_auth_01acp'];\n\t\tsetcookie($instnr.\"_start_auth_01acp\", \"\", time() - 3600);\n\t\t}\n\n\tif(!empty($des_cookie))\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET cookiehash='\".sha1(mt_rand().time().$salt.$instnr).\"', sessionhash='\".sha1(mt_rand().time().$salt.$instnr.$filename).\"' WHERE (cookiehash='\".$mysqli->escape_string($des_cookie).\"' OR id = '\".$userdata['id'].\"') AND id != '0' LIMIT 1\");\n\telse\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET sessionhash='\".sha1(mt_rand().time().$salt.$instnr.$filename).\"' WHERE id = '\".$userdata['id'].\"' AND id != '0' LIMIT 1\");\n    \n\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"index.php?logout=1\\\");</script>\";\n    $message .= \"<p class=\\\"meldung_hinweis\\\"><b>Sie werden weitergeleitet.</b><br />Falls Ihr Browser keine Weiterleitung unterst\u6164zt klicken Sie bitte <a href=\\\"index.php?logout=1\\\">hier</a>.</p>\";\n    }\nif(isset($_GET['logout']) && $_GET['logout'] == 1)\n    $message = \"<p class=\\\"meldung_ok\\\"><b>Sie wurden erfolgreich abgemeldet.</b></p>\";\n\n\n// Cookie vorhanden?\nif(isset($_COOKIE[$instnr.'_start_auth_01acp']) && !empty($_COOKIE[$instnr.'_start_auth_01acp']) && strlen($_COOKIE[$instnr.'_start_auth_01acp']) == 40 && !isset($_GET['action']) && !isset($_GET['logout'])){\n\t$list = $mysqli->query(\"SELECT id,username,userpassword,startpage,cookiehash,sessionhash FROM \".$mysql_tables['user'].\" WHERE cookiehash='\".$mysqli->escape_string($_COOKIE[$instnr.'_start_auth_01acp']).\"' AND id != '0' LIMIT 1\");\n\t$menge = $list->num_rows;\n\twhile($row = $list->fetch_assoc()){\n\t\t// Session erstellen/abrufen / Lastlogin speichern\n\t\tif(empty($row['sessionhash'])){\n\t\t\t$sessionhash = sha1(mt_rand().time().$salt.$instnr.$row['id'].$row['username'].$row['startpage']);\n\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET lastlogin='\".time().\"', sessionhash='\".$sessionhash.\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t}\n\t\telse{\n\t\t\t$sessionhash = $row['sessionhash'];\n\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET lastlogin='\".time().\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t}\n\n\t\t$_SESSION['01_idsession_'.sha1($salt)] = $row['id'];\n\t\t$_SESSION['01_passsession_'.sha1($salt)] = $sessionhash;\n\t\t\n\t\t//Weiterleiten:\n\t\tif($row['startpage'] == \"01acp\")\n\t\t\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"acp.php\\\");</script>\";\n\t\telse\n\t\t\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"_loader.php?modul=\".$row['startpage'].\"\\\");</script>\";\n\t\t$message .= \"<p class=\\\"meldung_ok\\\"><b>Login erfolgreich, Sie werden weitergeleitet.</b><br />Falls Ihr Browser keine Weiterleitung unterst&uuml;tzt klicken Sie bitte <a href=\\\"acp.php\\\">hier</a>.</p>\";\n\t\t}\n\n\t}\n\t\n// Login wurde abgeschickt\nif(isset($_POST['send']) && $_POST['send'] == 1){\n\n\tif($settings['acp_captcha4login'] == 0 || $settings['acp_captcha4login'] == 1 && ($settings['spamschutz'] == 1 && isset($_POST['antispam']) && md5($_POST['antispam']) == $_SESSION['antispam01'] || $settings['spamschutz'] == 2 && CheckReCAPTCHA($_POST['g-recaptcha-response'])) ){\n\n\t\t$list = $mysqli->query(\"SELECT id,username,userpassword,startpage,cookiehash,sessionhash FROM \".$mysql_tables['user'].\" WHERE username='\".$mysqli->escape_string($_POST['username']).\"' AND id != '0' LIMIT 1\");\n\t\twhile($row = $list->fetch_assoc()){\n\t\t\t// Check password for this user:\n\t\t\tif(pwhashing2($_POST['password'],$row['id']) != $row['userpassword']){\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t\t$error = 0;\n\n\t\t\t// Session erstellen/abrufen / Lastlogin speichern\n\t\t\tif(empty($row['sessionhash'])){\n\t\t\t\t$sessionhash = sha1(mt_rand().time().$salt.$instnr.$row['id'].$row['username'].$row['startpage']);\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET lastlogin='\".time().\"', sessionhash='\".$sessionhash.\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t\t}\n\t\t\telse{\n\t\t\t\t$sessionhash = $row['sessionhash'];\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET lastlogin='\".time().\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t\t}\n\t\t\t$_SESSION['01_idsession_'.sha1($salt)] = $row['id'];\n\t\t\t$_SESSION['01_passsession_'.sha1($salt)] = $sessionhash;\n\t\t\t\n\t\t\t// Cookie erstellen\n\t\t\tif(isset($_POST['setcookie']) && $_POST['setcookie'] == 1){\n\t\t\t\tif(empty($row['cookiehash'])){\n\t\t\t\t\t$cookiehash = sha1(mt_rand().time().$salt.$instnr);\n\t\t\t\t\t\n\t\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET cookiehash='\".$cookiehash.\"' WHERE id='\".$row['id'].\"' LIMIT 1\");\n\t\t\t\t\t$row['cookiehash'] = $cookiehash;\n\t\t\t\t\t}\n\t\t\t\tsetcookie($instnr.\"_start_auth_01acp\",$row['cookiehash'],time()+60*60*24*14);\n\t\t\t\t}\n\t\t\t\n\t\t\t//Weiterleiten:\n\t\t\tif($row['startpage'] == \"01acp\")\n\t\t\t\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"acp.php\\\");</script>\";\n\t\t\telse\n\t\t\t\t$message = \"<script type=\\\"text/javascript\\\">redirect(\\\"_loader.php?modul=\".$row['startpage'].\"\\\");</script>\";\n\t\t\t$message .= \"<p class=\\\"meldung_ok\\\"><b>Login erfolgreich, Sie werden weitergeleitet.</b><br />Falls Ihr Browser keine Weiterleitung unterst&uuml;tzt klicken Sie bitte <a href=\\\"acp.php\\\">hier</a>.</p>\";\n\t\t\t}\n\t\t\t\n\t\tif($error == 1)\n\t\t\t$message = \"<p class=\\\"meldung_error\\\"><b>Login war nicht erfolgreich!</b><br />Bitte &uuml;berpr&uuml;fen Sie\n\t\t\t\tBenutzernamen und Passwort und probieren Sie es erneut.</p>\";\n\t\t}\n\telse\n\t\t$message = \"<p class=\\\"meldung_error\\\"><b>Login nicht m&ouml;glich!</b><br />\n\t\t\tBitte f&uuml;llen Sie das Captcha korrekt aus!</p>\"; \n    }\n// \u9201erpr\u3639en des Passwort-Zusenden-Formulars\nelseif(isset($_POST['send']) && $_POST['send'] == 2){\n\t$list = $mysqli->query(\"SELECT id,username,mail FROM \".$mysql_tables['user'].\" WHERE (username='\".$mysqli->escape_string($_POST['username']).\"' OR mail='\".$mysqli->escape_string($_POST['email']).\"') AND id != '0' LIMIT 1\");\n\t$menge = $list->num_rows;\n\twhile($row = $list->fetch_assoc()){\n        $newpass = create_NewPassword(PW_LAENGE);\n        $newpassmd5 = pwhashing2($newpass, $row['id']);\n\n        // Datenbank aktualisieren:\n        $mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET userpassword='\".$newpassmd5.\"' WHERE id='\".$row['id'].\"'\");\n\n        $header = \"From:\".$settings['email_absender'].\"<\".$settings['email_absender'].\">\\n\";\n        $email_betreff = $settings['sitename'].\" - Neues Passwort f\u50e1 Administrationsbereich\";\n        $emailbody = \"Mit dieser E-Mail erhalten Sie ein neues Passwort f\u50e1 den Administrationsbereich\\n\\nName: \".stripslashes($row['username']).\"\\nE-Mail-Adresse: \".stripslashes($row['mail']).\"\\nNeues Passwort: \".$newpass.\"\\n\\n---\\nWebmailer\";\n\n        mail(stripslashes($row['mail']),$email_betreff,$emailbody,$header);\n\n        $message = \"<p class=\\\"meldung_ok\\\"><b>Ein neues Passwort wurde an Ihre E-Mail-Adresse verschickt.</b></p>\";\n\t\t}\n\n\tif($menge < 1)\n\t\t$message = \"<p class=\\\"meldung_error\\\"><b>Passwort konnte nicht zugestellt werden!</b><br />Bitte &uuml;berpr&uuml;fen Sie\n\t\t\tBenutzernamen / E-Mail-Adresse und probieren Sie es erneut.</p>\";\n    }\n\n\ninclude(\"system/head.php\");\necho $message;\n?>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<div class=\"box_centered\" id=\"loginform\" style=\"display:block;\">\n\t<h2>Login</h2>\n\t\n\t<p class=\"big\"><label for=\"input_username\">Benutzername:</label> <input type=\"text\" name=\"username\" value=\"<?PHP echo $_POST['username']; ?>\" id=\"input_username\" size=\"20\" /></p>\n\t<p class=\"big\"><span style=\"margin-right:38px;\"><label for=\"input_password\">Passwort:</label></span> <input type=\"password\" name=\"password\" id=\"input_password\" size=\"20\" /></p>\n<?php if($settings['acp_captcha4login'] == 1 && $settings['spamschutz'] == 2 && !empty($settings['ReCaptcha_PubKey']) &&  !empty($settings['ReCaptcha_PrivKey'])){ ?>\n\t<p class=\"big\"><span style=\"margin-right:18px;\"><?php echo create_Captcha($settings['spamschutz']); ?></span></p>\n<?php }elseif($settings['acp_captcha4login'] == 1 && $settings['spamschutz'] == 1){ ?>\n\t<p class=\"big\"><span style=\"margin-right:18px;\"><?php echo create_Captcha(); ?></span> <input type=\"text\" name=\"antispam\" size=\"20\" /></p>\n<?php } ?>\n\t<p class=\"big\"><span style=\"margin-right:18px;\"><label for=\"input_cookie\">2 Wochen eingeloggt bleiben?</label></span> <input type=\"checkbox\" name=\"setcookie\" id=\"input_cookie\" value=\"1\" /></p>\n\t<p class=\"small\"><a href=\"javascript: hide_unhide('loginform'); hide_unhide('passwordbox');\">Passwort vergessen?</a></p>\n\t<p align=\"right\"><input type=\"submit\" name=\"absenden\" class=\"input\" value=\"Einloggen &raquo;\" /></p>\n\n\t<input type=\"hidden\" name=\"send\" value=\"1\" />\n</div>\n</form>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<div class=\"box_centered\" id=\"passwordbox\" style=\"display:none;\">\n\t<h2>Passwort vergessen?</h2>\n\t<p>Benutzername <b>ODER</b> E-Mail-Adresse eingeben:</p>\n\t\n\t<p class=\"big\"><label for=\"forgotpw_username\">Benutzername:</label> <input type=\"text\" name=\"username\" value=\"<?PHP if(isset($_POST['username'])){ echo $_POST['username']; } ?>\" id=\"forgotpw_username\" size=\"20\" /></p>\n\t<p class=\"big\"><label for=\"forgotpw_email\">E-Mail-Adresse:</label> <input type=\"text\" name=\"email\" value=\"<?PHP if(isset($_POST['email'])){ echo $_POST['email']; } ?>\" id=\"forgotpw_email\" size=\"20\" /></p>\n\t<p class=\"small\"><a href=\"javascript: hide_unhide('loginform'); hide_unhide('passwordbox');\">&laquo; Zur&uuml;ck zum Login</a></p>\n\t<p align=\"right\"><input type=\"submit\" name=\"absenden\" class=\"input\" value=\"Neues Passwort anfordern &raquo;\" /></p>\n\n\t<input type=\"hidden\" name=\"send\" value=\"2\" />\n</div>\n</form>\n\n<p align=\"center\">Um den Administrationsbereich nutzen zu k\u9735nen m\u5aa0sen Sie \n<a href=\"http://de.wikipedia.org/wiki/HTTP-Cookie\" target=\"_blank\">Cookies</a> aktiviert haben.</p>\n\n<img src=\"images/layout/img04.gif\" alt=\"Layout-Bild\" style=\"display:none;\" />\n\n<?PHP\nif($menge < 1 && isset($_POST['send']) && $_POST['send'] == 2){\n\techo \"<script type=\\\"text/javascript\\\">\n\t\t<!--\n\t\thide_unhide('loginform');\n\t\thide_unhide('passwordbox');\n\t\t-->\n\t\t</script>\";\n\t}\n?>\n\n<?PHP\ninclude(\"system/foot.php\");\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2014 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tModule verwalten\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_module\";\n$sitetitle = \"Module verwalten\";\n$filename = $_SERVER['SCRIPT_NAME'];\n$flag_stopupdate = FALSE;\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0 && $userdata['module'] == 1){\n\n// Neue Versions-XML vom 01-Scripts.de-Server holen\nif($settings['cachetime']+CACHE_TIME < time()){\n\tgetXML2Cache(HTTP_VERSIONSINFO_DATEILINK,LOKAL_VERSIONSINFO_DATEILINK);\n\t}\n$vinfoxml = @simplexml_load_file(LOKAL_VERSIONSINFO_DATEILINK);\n\n\n\n\n\n\n// Neues Modul installieren (Step 1)\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 1 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\")){\n\n\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\n\techo \"<h1>\".$xml->titel.\" installieren</h1>\";\n\t\n\t// ID-Namen auf Sonderzeichen \u00fcberpr\u00fcfen\n\t$err = \"\";\n\t$err2 = false;\n\tforeach($forbidden_chars as $char){\n\t\tif(strchr($_REQUEST['modul'],$char)) $err .= $char;\n\t\t}\n\n\t// Maximale L\u00e4nge von 25 Zeichen \u00fcberpr\u00fcfen\n\tif(strlen($_REQUEST['modul']) > 25) $err2 = true;\n\n\tif($xml->need01acpv <= $settings['acpversion'] && empty($err) && !$err2){\n?>\n\n<p class=\"meldung_hinweis\">\n\tDer Benutzer mit dem Sie momentan angemeldet sind (<i><?PHP echo $userdata['username']; ?></i>)\n\terh&auml;lt f&uuml;r das Modul alle Administrations- &amp; Benutzerrechte.<br />\n\tAllen anderen Benutzern m&uuml;ssen die Rechte <b>nachtr&auml;glich</b> entsprechend zugeteilt werden \n\t(&uuml;ber <i>Benutzer bearbeiten</i>).\n</p>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\" width=\"35%\"><b>Installationsname*</b><br /><span class=\"small\">Der eingegebene Name erscheint in der Dropdown-Modulauswahl (oben rechts).</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"instname\" value=\"<?PHP echo $xml->titel; ?>\" size=\"50\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><input type=\"reset\" value=\"Zur&uuml;cksetzen\" class=\"input\" /></td>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"install\" />\n\t\t\t<input type=\"hidden\" name=\"modul\" value=\"<?PHP echo $_REQUEST['modul']; ?>\" />\n\t\t\t<input type=\"hidden\" name=\"step\" value=\"2\" />\n\t\t\t<input type=\"submit\" value=\"Weiter &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n\n</table>\n</form><br />\n\n<?PHP\n\t\t}\n\telseif(!empty($err))\n\t\techo \"<p class=\\\"meldung_error\\\">Bitte entfernen Sie alle Sonderzeichen aus dem Verzeichnisnamen des Moduls:<br />\n\t\t\t\tAktueller Verzeichnisname: <b>\".$_REQUEST['modul'].\"</b><br />\n\t\t\t\tZu entfernende Zeichen: <b>\".$err.\"</b></p>\";\n\telseif($err2)\n\t\techo \"<p class=\\\"meldung_error\\\">Bitte w&auml;hlen Sie einen Verzeichnisnamen mit weniger als 25 Zeichen!</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Um das gew&uuml;nschte Modul zu installieren ben&ouml;tigen Sie die\n\t\t\t\tVersion \".$xml->need01acpv.\" des 01ACP.<br />\n\t\t\t\tBitte aktualisieren Sie zuerst das 01ACP!</p>\";\n\t}\n// Installation: Step 2\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['instname']) && !empty($_REQUEST['instname']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 2 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\")){\n\t\n\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\n\t// N\u00e4chste Modul-Nummer aus DB holen (f\u00fcr mehrere Parallelinstallationen)\n\t$newnr = 0;\n\t$list = $mysqli->query(\"SELECT nr FROM \".$mysql_tables['module'].\" WHERE modulname = '\".$mysqli->escape_string($xml->name).\"' ORDER BY nr DESC LIMIT 1\");\n\twhile($row = $list->fetch_assoc()){\n\t\t$newnr = $row['nr'];\n\t\t}\n\t$newnr = $newnr+1;\n\t\n\t// Modul in DB eintragen\n\t$sql_insert = \"INSERT INTO \".$mysql_tables['module'].\" (nr,aktiv,modulname,instname,idname,version,serialized_data) VALUES (\n\t\t\t\t\t'\".$newnr.\"',\n\t\t\t\t\t'1',\n\t\t\t\t\t'\".$mysqli->escape_string($xml->name).\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_REQUEST['instname']).\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_REQUEST['modul']).\"',\n\t\t\t\t\t'\".$mysqli->escape_string($xml->version).\"',\n\t\t\t\t\t''\n\t\t\t\t\t)\";\n\t$result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\t\n\t// CatID von cat_modulaccess holen:\n\t$list = $mysqli->query(\"SELECT catid FROM \".$mysql_tables['rights'].\" WHERE idname='cat_modulaccess' LIMIT 1\");\n\twhile($row = $list->fetch_assoc()){\n\t\t$catid = $row['catid'];\n\t\t}\n\t\n\t// SortID der Datens\u00e4tze von cat_modulaccess holen:\n\t$sortid = 0;\n\t$list = $mysqli->query(\"SELECT sortid FROM \".$mysql_tables['rights'].\" WHERE catid='\".$catid.\"' AND is_cat='0' ORDER BY sortid DESC LIMIT 1\");\n\twhile($row = $list->fetch_assoc()){\n\t\t$sortid = $row['sortid'];\n\t\t}\n\t$sortid = $sortid+1;\n\t\n\t// Neues Benutzerrecht anlegen\n\t$sql_insert = \"INSERT INTO \".$mysql_tables['rights'].\" (modul,is_cat,catid,sortid,idname,name,exp,formename,formwerte,input_exp,standardwert,nodelete,hide,in_profile) VALUES (\n\t\t\t\t\t'01acp',\n\t\t\t\t\t'0',\n\t\t\t\t\t'\".$catid.\"',\n\t\t\t\t\t'\".$sortid.\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_REQUEST['modul']).\"',\n\t\t\t\t\t'\".$mysqli->escape_string($_REQUEST['instname']).\"',\n\t\t\t\t\t'',\n\t\t\t\t\t'Zugriff erlaubt|Zugriff verboten',\n\t\t\t\t\t'1|0',\n\t\t\t\t\t'',\n\t\t\t\t\t'0',\n\t\t\t\t\t'1',\n\t\t\t\t\t'0',\n\t\t\t\t\t'0')\";\n\t$result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\t\n\t// Datenbankspalte f\u00fcr neues Recht erzeugen\n\t$mysqli->query(\"ALTER TABLE `\".$mysql_tables['user'].\"` ADD `01acp_\".$mysqli->escape_string($_REQUEST['modul']).\"` TINYINT( 1 ) NOT NULL DEFAULT '0'\");\n\t\n\t// Aktuellem Benutzer Zugriff gestatten\n\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET 01acp_\".$mysqli->escape_string($_REQUEST['modul']).\"='1' WHERE id='\".$userdata['id'].\"'\");\n?>\n<h1>Installation wird fortgesetzt</h1>\n\n<p class=\"meldung_hinweis\"><b>Bitte legen Sie sp&auml;testens jetzt ein Backup Ihrer MySQL-Datenbank an!</b></p>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\" colspan=\"2\">Der n&auml;chste Schritt kann einige Zeit in Anspruch nehmen (bis zu 60s).<br />\n\t\t<b>Bitte unterbrechen Sie den Vorgang nicht!</b> Es werden SQL-Befehle zur Installation des\n\t\tModuls ausgef&uuml;hrt.</td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\">&nbsp;</td>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"install\" />\n\t\t\t<input type=\"hidden\" name=\"modul\" value=\"<?PHP echo $_REQUEST['modul']; ?>\" />\n\t\t\t<input type=\"hidden\" name=\"step\" value=\"3\" />\n\t\t\t<input type=\"submit\" value=\"Weiter &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n\n</table>\n</form><br />\n<?PHP\n\t}\n// Installation: Step 3 (Bigdump)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 3 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\") &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_sql_install.sql\")){\n\t\n\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\n\t// Modul-Infos aus DB holen\n\t$sql_modulnr = 1;\n\t$sql_modulidname = \"\";\n\t$list = $mysqli->query(\"SELECT nr,idname FROM \".$mysql_tables['module'].\" WHERE modulname = '\".$mysqli->escape_string($xml->name).\"' ORDER BY nr DESC LIMIT 1\");\n\twhile($row = $list->fetch_assoc()){\n\t\t$sql_modulnr = $row['nr'];\n\t\t$sql_modulidname = $row['idname'];\n\t\t}\n\t\t\n\t$sql_filename \t= $moduldir.$_REQUEST['modul'].\"/_sql_install.sql\";     // Specify the dump filename to suppress the file selection dialog\n\t$sql_erfolglink = \"<a href=\\\"\".$filename.\"?action=install&amp;modul=\".$_REQUEST['modul'].\"&amp;step=4\\\">Weiter &raquo;</a>\";\n\tinclude_once(\"system/sql_bigdump.php\");\n\t\n\t}\n// Installation: Step 4 (Iframe oder Ausgabe der Erfolgsmeldung)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 4 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\")){\n\t\n\t// Install-Datei (wenn vorhanden) in einem IFrame anzeigen\n\tif(file_exists($moduldir.$_REQUEST['modul'].\"/_install.php\"))\n\t\tinclude_once($moduldir.$_REQUEST['modul'].\"/_install.php\");\n\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['module'].\" SET aktiv='1' WHERE idname='\".$mysqli->escape_string($_REQUEST['modul']).\"'\");\n\t\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\t\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Das Modul wurde erfolgreich installiert!</b></p>\";\n\t\techo $xml->includeinfo;\n\t\t\n\t}\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n// UPDATE: Step 1 (Passendes Update aus XML ausw\u00e4hlen)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"update\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 1 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\")){\n\t$options = \"\";\n\n\t$xml = simplexml_load_file($moduldir.$_REQUEST['modul'].\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\n\tif($xml->need01acpv <= $settings['acpversion']){\n\t\n\t\tforeach($xml->updates as $updates){\n\t\t\tforeach($updates as $update){\n\t\t\t\t// Abfrage funktioniert aus ungekl\u00e4rter Ursache nicht ohne md5()\n\t\t\t\tif($update->startv == $module[$_REQUEST['modul']]['version'] && md5($update->zielv) == md5($xml->version))\n\t\t\t\t\t$options .= \"<option value=\\\"\".$update->action.\"\\\">Version \".$update->startv.\" nach \".$update->zielv.\"</option>\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\tif(empty($options) || !isset($options)){\n\t\t\t$options = \"<option value=\\\"0\\\">Es konnte keine passende Version gefunden werden</option>\";\n\t\t\t$flag_stopupdate = TRUE;\n\t\t\t}\n\t\t}\n\telse{\n\t\t$options = \"<option value=\\\"0\\\">Bitte aktualisieren Sie zuerst das 01ACP auf die Version \".$xml->need01acpv.\" !</option>\";\n\t\t$flag_stopupdate = TRUE;\n\t\t}\n?>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\">Bitte w&auml;hlen Sie das passende Update aus.<br />\n\t\t\t<br />\n\t\t\t<b>Beispiel:</b> Wenn Sie von Version 1.0.0.0 auf Version 1.0.0.3 aktualisieren m&ouml;chten,\n\t\t\tm&uuml;ssen <b class=\"red\">alle dazwischenliegende Updates</b> in der richtigen Reihenfolgen\n\t\t\t<b class=\"red\">einzeln(!)</b> installiert werden:<br />\n\t\t\tVersion 1.0.0.0 -&gt; Version 1.0.0.1 (passendes Update-Paket herunterladen!)<br />\n\t\t\tVersion 1.0.0.1 -&gt; Version 1.0.0.2 (passendes Update-Paket herunterladen!)<br />\n\t\t\tVersion 1.0.0.2 -&gt; Version 1.0.0.3 (passendes Update-Paket herunterladen!)<br />\n\t\t\t<b class=\"red\">Bitte achten Sie darauf, dass Sie mit dem ERSTEN Update-Paket (z.B. 1.0.0.0 nach 1.0.0.1) starten und wirklich alle ge&auml;nderten\n\t\t\tDateien &uuml;berschreiben.<br />\n\t\t\tStarten Sie dann hier den ERSTEN Update-Prozess (z.B. 1.0.0.0 nach 1.0.0.1)<br />\n\t\t\tund nehmen Sie ERST DANN das n&auml;chste Update (z.B. 1.0.0.1 nach 1.0.0.2, etc.) vor!</b></td>\n    </tr>\n\n\t<tr>\n\t\t<td class=\"trb\"><select name=\"update\" size=\"1\" class=\"input_select2\"><?PHP echo $options; ?></select></td>\n\t</tr>\n<?PHP if(!$flag_stopupdate){ ?>\n    <tr>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"update\" />\n\t\t\t<input type=\"hidden\" name=\"modul\" value=\"<?PHP echo $_REQUEST['modul']; ?>\" />\n\t\t\t<input type=\"hidden\" name=\"step\" value=\"2\" />\n\t\t\t<input type=\"submit\" value=\"Update starten &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n<?PHP } ?>\n</table>\n</form><br />\n\n<?PHP\t\n\t}\n// UPDATE: Step 2 (Update-Datei mit entsprechendem $_REQUEST-Parameter f\u00fcr richtigen Einsteig aufrufen)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"update\" && \n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tisset($_REQUEST['update']) && !empty($_REQUEST['update']) &&\n\tisset($_REQUEST['step']) && $_REQUEST['step'] == 2 &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_info.xml\") &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_updates.php\")){\n\t\n\tinclude_once($moduldir.$_REQUEST['modul'].\"/_updates.php\");\n\t\n\t}\n\n\n\n\n\n\n\n\n\n// MODUL L\u00d6SCHEN (Abfrage)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"delete\" &&\n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_functions.php\") &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_headinclude.php\")){\n\t\n\tif(function_exists(\"_\".$module[$modul]['modulname'].\"_DeleteModul\"))\t\n\t\techo \"<p class=\\\"meldung_error\\\">M&ouml;chten Sie das Modul <b>\".$_REQUEST['modul'].\"</b> wirklich komplett\n\t\tund unwiderruflich l&ouml;schen?<br />\n\t\t<br />\n\t\t<b>Bitte beachten Sie: Dieser Vorgang kann nicht r&uuml;ckg&auml;ngig gemacht werden.<br />\n\t\tLegen Sie ggf. vor dem Fortfahren ein Backup Ihrer Datenbank an!</b><br />\n\t\t<br />\n\t\t<a href=\\\"\".$filename.\"?action=dodelete&amp;modul=\".$_REQUEST['modul'].\"\\\">Ja, ich m&ouml;chte das \".$_REQUEST['modul'].\"-Modul unwiderruflich l&ouml;schen</a> | <b><a href=\\\"module.php\\\">Nein, abbrechen</a></b></p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">F&uuml;r dieses Modul existiert leider noch keine L&ouml;sch-Routine.<br />\n\t\tDiese Funktion wird mit dem n&auml;chsten Update des Moduls nachgeliefert.<br />\n\t\t<br />\n\t\t<a href=\\\"module.php\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t}\t\n// MODUL L\u00d6SCHEN (Durchf\u00fchren)\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"dodelete\" &&\n\tisset($_REQUEST['modul']) && !empty($_REQUEST['modul']) &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_functions.php\") &&\n\tfile_exists($moduldir.$_REQUEST['modul'].\"/_headinclude.php\")){\n\n\tif(function_exists(\"_\".$module[$modul]['modulname'].\"_DeleteModul\")){\n\t\t// Modul-Eintrag entfernen\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['module'].\" WHERE idname = '\".$modul.\"' LIMIT 1\");\n\t\t\n\t\t// Men\u00fc-Eintr\u00e4ge entfernen\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['menue'].\" WHERE modul = '\".$modul.\"'\");\n\t\t\n\t\t// Settings entfernen\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['settings'].\" WHERE modul = '\".$modul.\"'\");\n\t\t\n\t\t// Rechte entfernen\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['rights'].\" WHERE modul = '\".$modul.\"'\");\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['rights'].\" WHERE modul = '01acp' AND idname = '\".$modul.\"' LIMIT 1\");\n\t\t$mysqli->query(\"ALTER TABLE `\".$mysql_tables['user'].\"` DROP `01acp_\".$modul.\"`\");\n\t\t\n\t\t// ACP-Startseite ggf zur\u00fccksetzen\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET startpage = '01acp' WHERE startpage = '\".$modul.\"'\");\n\t\t\n\t\t// Modulspezifische Aufr\u00e4umarbeiten\n\t\tcall_user_func(\"_\".$module[$modul]['modulname'].\"_DeleteModul\");\n\t\t\n\t\techo \"<p class=\\\"meldung_ok\\\">Das Modul <b>\".$_REQUEST['modul'].\"</b> wurde erfolgreich\n\t\taus der Datenbank entfernt<br />\n\t\tSie k&ouml;nnen nun per FTP-Programm das Verzeichnis <i>01scripts/01module/\".$modul.\"</i> l&ouml;schen.<br />\n\t\t<br />\n\t\t<a href=\\\"module.php\\\">Zur&uuml;ck zur Modul-&Uuml;bersicht</a></p>\";\n\t\t}\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">F&uuml;r dieses Modul existiert leider noch keine L&ouml;sch-Routine.<br />\n\t\tDiese Funktion wird mit dem n&auml;chsten Update des Moduls nachgeliefert.<br />\n\t\t<br />\n\t\t<a href=\\\"module.php\\\">&laquo; Zur&uuml;ck</a></p>\";\n\t}\n\t\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n// Fehlermeldungen ausgeben\nelseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"install\" ||\n\tisset($_REQUEST['action']) && $_REQUEST['action'] == \"update\"){\n\n\techo \"<p class=\\\"meldung_error\\\"><b>Fehler:</b> Es wurden nicht alle n&ouml;tigen Parameter &uuml;bergeben oder\n\t\t\tes konnten nicht alle n&ouml;tigen Dateien f&uuml;r den weiteren Installations/Update-Prozess gefunden werden.<br />\n\t\t\tBitte &uuml;berpr&uuml;fen Sie, ob Sie alle n&ouml;tigen Dateien hochgeladen haben und starten Sie den Vorgang ggf.\n\t\t\terneut.<br />\n\t\t\t<a href=\\\"module.php\\\">Zur&uuml;ck zur &Uuml;bersicht &raquo;</a><br />\n\t\t\t<br />\n\t\t\tSollten auch weitern Fehler oder Probleme auftreten, wenden Sie sich bitte an den \n\t\t\t<a href=\\\"http://board.01-scripts.de/\\\" target=\\\"_blank\\\">Support</a>.</p>\";\n\n\t}\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n\t\n// Module auflisten\nelse{\n?>\n\n<h1>Module verwalten</h1>\n\n<?PHP\n// Module aktiv / deaktiv setzen\nif(isset($_GET['aktiv']) && ($_GET['aktiv'] == 1 || $_GET['aktiv'] == 0) && $_GET['aktiv'] != \"\" && isset($_GET['modul']) && !empty($_GET['modul'])){\n\t$mysqli->query(\"UPDATE \".$mysql_tables['module'].\" SET aktiv='\".$mysqli->escape_string($_GET['aktiv']).\"' WHERE idname='\".$mysqli->escape_string($_GET['modul']).\"'\");\n\t\n\techo \"\n<script type=\\\"text/javascript\\\">\nredirect('module.php')\n</script>\";\n\t}\n?>\n\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n\t\t<td class=\"tra\" style=\"width:20px;\">&nbsp;</td>\n\t\t<td class=\"tra\" style=\"width:35px;\">&nbsp;</td>\n        <td class=\"tra\" style=\"width:110px;\"><b>Modul-ID-Name</b></td>\n        <td class=\"tra\" style=\"width:20px;\"><b>Nr.</b></td>\n\t\t<td class=\"tra\"><b>Titel</b></td>\n\t\t<td class=\"tra\" style=\"width:100px;\"><b>Version</b></td>\n\t\t<td class=\"tra\" style=\"width:30px;\">&nbsp;<!-- Info --></td>\n\t\t<td class=\"tra\" style=\"width:30px;\">&nbsp;<!-- Deaktivieren --></td>\n\t\t<td class=\"tra\" style=\"width:30px;\">&nbsp;<!-- L\u00f6schen --></td>\n\t</tr>\n\n<?PHP\n$count = 0;\n$readverz = opendir($moduldir);\nwhile($dir = readdir($readverz)){\n\tif($dir != \".\" && $dir != \"..\" && file_exists($moduldir.$dir.\"/_info.xml\") && $dir != \"01example\")\n        {\n\t\t$xml = simplexml_load_file($moduldir.$dir.\"/_info.xml\",NULL,LIBXML_NOCDATA);\n\t\t\n\t\tif(isset($module[$dir]['modulname'])) $xml_modname = \"_\".$module[$dir]['modulname'];\n\t\tif(!isset($module[$dir]['idname'])) $module[$dir]['idname'] = \"\";\n\t\t\n\t\tif(file_exists($moduldir.$dir.\"/\".$xml->icon) && $xml->icon != \"\")\n\t\t\t$icon = \"<img src=\\\"\".$moduldir.$dir.\"/\".$xml->icon.\"\\\" alt=\\\"Icon\\\" title=\\\"\".$xml->titel.\"\\\" />\";\n\t\telse $icon = \"\";\n\t\t\n\t\t$del\t = \"<a href=\\\"\".$filename.\"?action=delete&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/cancel.gif\\\" alt=\\\"Rotes X\\\" title=\\\"Modul l&ouml;schen\\\" /></a>\";\n\t\tif(!in_array($dir,$inst_module)){\n\t\t\t$install = \"<a href=\\\"\".$filename.\"?action=install&amp;modul=\".$dir.\"&amp;step=1\\\"><img src=\\\"images/icons/icon_install.gif\\\" alt=\\\"Plus-Symbol\\\" title=\\\"Modul \".$xml->titel.\" installieren\\\" /></a>\";\n\t\t\t$installed = \" <b class=\\\"red\\\">*nicht installiert*</b>\";\n\t\t\t$vcolorclass = \"\";\n\t\t\t$warning = \"<img src=\\\"images/icons/add.gif\\\" alt=\\\"Plus-Symbol\\\" title=\\\"Modul \".$xml->titel.\" installieren\\\" />\";\n\t\t\t$version = $xml->version;\n\t\t\t$titel = $xml->titel;\n\t\t\t$deaktiv = \"\";\n\t\t\t$del\t = \"\";\n\t\t\t}\n\t\telseif(in_array($dir,$inst_module) && $module[$dir]['version'] < $xml->version){\n\t\t\t$install = \"<a href=\\\"\".$filename.\"?action=update&amp;modul=\".$dir.\"&amp;step=1\\\"><img src=\\\"images/icons/icon_update.gif\\\" alt=\\\"Plus-Symbol\\\" title=\\\"Modul \".$xml->titel.\" aktualisieren\\\" /></a>\";\n\t\t\t$installed = \" <b class=\\\"red\\\">*installiert - UPDATE m&ouml;glich*</b>\";\n\t\t\t$vcolorclass = \"red\";\n\t\t\t$warning = \"<img src=\\\"images/icons/warning.gif\\\" alt=\\\"Warnung\\\" title=\\\"Modul \".$xml->titel.\" aktualisieren!\\\" />\";\n\t\t\t$version = $module[$dir]['version'];\n\t\t\t$titel = $module[$dir]['instname'];\n\t\t\tif($module[$dir]['aktiv'] == 1)\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=0&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_deaktivieren.gif\\\" alt=\\\"Stop-Icon\\\" title=\\\"Modul deaktivieren (wird im ACP nicht mehr angezeigt)\\\" /></a>\";\n\t\t\telse\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=1&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_aktivieren.gif\\\" alt=\\\"Play-Icon\\\" title=\\\"Modul aktivieren (wird im ACP wieder angezeigt)\\\" /></a>\";\n\t\t\t}\n\t\telseif(in_array($dir,$inst_module) && $module[$dir]['version'] < $vinfoxml->$xml_modname->version){\n\t\t\t$install = \"<a href=\\\"\".$vinfoxml->$xml_modname->updateurl.\"\\\" target=\\\"_blank\\\"><img src=\\\"images/icons/icon_update.gif\\\" alt=\\\"Plus-Symbol\\\" title=\\\"Modul \".$xml->titel.\" aktualisieren\\\" /></a>\";\n\t\t\t$installed = \" <a href=\\\"\".$vinfoxml->$xml_modname->updateurl.\"\\\" target=\\\"_blank\\\"><b class=\\\"red\\\">*installiert - UPDATE vorhanden!*</b></a>\";\n\t\t\t$vcolorclass = \"red\";\n\t\t\t$warning = \"<img src=\\\"images/icons/warning.gif\\\" alt=\\\"Warnung\\\" title=\\\"Modul \".$xml->titel.\" aktualisieren!\\\" />\";\n\t\t\t$version = $module[$dir]['version'];\n\t\t\t$titel = $module[$dir]['instname'];\n\t\t\tif($module[$dir]['aktiv'] == 1)\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=0&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_deaktivieren.gif\\\" alt=\\\"Stop-Icon\\\" title=\\\"Modul deaktivieren (wird im ACP nicht mehr angezeigt)\\\" /></a>\";\n\t\t\telse\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=1&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_aktivieren.gif\\\" alt=\\\"Play-Icon\\\" title=\\\"Modul aktivieren (wird im ACP wieder angezeigt)\\\" /></a>\";\n\t\t\t}\n\t\telseif(in_array($dir,$inst_module) && $module[$dir]['version'] >= $xml->version){\n\t\t\t$install = \"<a href=\\\"javascript:hide_unhide_tr('_\".$module[$dir]['idname'].\"');\\\"><img src=\\\"images/icons/kreis_frage.gif\\\" alt=\\\"Fragezeichen\\\" title=\\\"Informationen zum Einbinden des Moduls ein/ausblenden\\\" /></a>\";\n\t\t\t$installed = \" <b class=\\\"green\\\">*installiert*</b>\";\n\t\t\t$vcolorclass = \"green\";\n\t\t\t$warning = \"<img src=\\\"images/icons/ok.gif\\\" alt=\\\"OK-Symbol\\\" title=\\\"Alles ok\\\" />\";\n\t\t\t$version = $module[$dir]['version'];\n\t\t\t$titel = $module[$dir]['instname'];\n\t\t\tif($module[$dir]['aktiv'] == 1)\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=0&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_deaktivieren.gif\\\" alt=\\\"Stop-Icon\\\" title=\\\"Modul deaktivieren (wird im ACP nicht mehr angezeigt)\\\" /></a>\";\n\t\t\telse\n\t\t\t\t$deaktiv = \"<a href=\\\"\".$filename.\"?aktiv=1&amp;modul=\".$dir.\"\\\"><img src=\\\"images/icons/icon_aktivieren.gif\\\" alt=\\\"Play-Icon\\\" title=\\\"Modul aktivieren (wird im ACP wieder angezeigt)\\\" /></a>\";\n\t\t\t}\n\n\t\tif(!isset($module[$dir]['nr'])) $module[$dir]['nr'] = \"\";\n\n\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\techo \"<tr>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$warning.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$icon.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\">\".$module[$dir]['idname'].\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$module[$dir]['nr'].\"</td>\n\t\t<td class=\\\"\".$class.\"\\\"><b>\".$titel.\"</b>\".$installed.\"<br />\".$xml->beschreibung.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\"><b class=\\\"\".$vcolorclass.\"\\\">\".$version.\"</b></td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$install.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$deaktiv.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$del.\"</td>\n</tr>\";\n\n\t\techo \"<tr id=\\\"_\".$module[$dir]['idname'].\"\\\" style=\\\"display:none;\\\">\n\t\t<td class=\\\"\".$class.\"\\\" colspan=\\\"9\\\">\".$xml->includeinfo.\"</td>\n</tr>\";\n        }\n\tclearstatcache(); \n    }\n?>\n\n</table>\n<br />\n\n\n<?PHP\n} // Ende: Module auflisten\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2014 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tBenutzerrechte verwalten (hinzuf\u9ee6en & sortieren)\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_users\";\n$sitetitle = \"Benutzerverwaltung : Rechteverwaltung\";\n$filename = $_SERVER['SCRIPT_NAME'];\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0){\n\n// Sicherheitsabfrage: Userberechtigungen (Einstellungen erstellen / sortieren)\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_right\" && $userdata['rights'] == 1 && $userdata['level'] == 10){\n\t\n\t// Eintragung in Datenbank vornehmen\n\tif(isset($_POST['send']) && $_POST['send'] == 1){\n\t\t$sql_insert = \"INSERT INTO \".$mysql_tables['rights'].\" (modul,is_cat,catid,sortid,idname,name,exp,formename,formwerte,input_exp,standardwert,nodelete,hide,in_profile) VALUES (\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['modulname']).\"',\n\t\t\t\t\t\t'0',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['catid']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['sortid']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['idname']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['name']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['exp']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['formename']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['formwerte']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['input_exp']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['standardwert']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['nodelete']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['hide']).\"',\n\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['in_profile']).\"')\";\n\t\t$result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\t\t\n\t\t//Datenbankspalte erzeugen\n\t\tif($_POST['formwerte'] == \"text\")\n\t\t\t$query = \"ALTER TABLE `\".$mysql_tables['user'].\"` ADD `\".$mysqli->escape_string($_POST['modulname']).\"_\".$mysqli->escape_string($_POST['idname']).\"` TEXT NOT NULL DEFAULT '\".$mysqli->escape_string($_POST['standardwert']).\"'\";\n\t\telse\n\t\t\t$query = \"ALTER TABLE `\".$mysql_tables['user'].\"` ADD `\".$mysqli->escape_string($_POST['modulname']).\"_\".$mysqli->escape_string($_POST['idname']).\"` VARCHAR( 255 ) NOT NULL DEFAULT '\".$mysqli->escape_string($_POST['standardwert']).\"'\";\n\t\t\t\n\t\t$mysqli->query($query);\n\t\t\n\n\t\tif($userdata['devmode'] == 1){\n\t\t\techo htmlentities($sql_insert).\"<br />\";\n\t\t\techo htmlentities($query).\"<br /><br />\";\n\t\t\t}\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Datensatz wurde hinzugef\u9ee6t</b></p>\";\n\t\t}\n?>\n\n<h1>Benutzerrecht hinzuf&uuml;gen</h1>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td colspan=\"2\">Auf dieser Seite k&ouml;nnen neue Benutzerrechte hinzugef&uuml;gt werden, die dann zur Userverwaltung im Administrationsbereich verwendet werden k&ouml;nnen.<br />\n        Dieser Bereich ist normalerweise nur f\u9ef5 Entwickler von Modifikationen f\u9ef5 das 01ACP interessant. Ein Funktion zur Bearbeitung von Datens&auml;tzen\n        ist nicht vorhanden.<br />\n\t\tF\u9ef5 jedes neue Benutzerrecht wird sowohl ein neuer Eintrag in der Tabelle <i><?PHP echo $mysql_tables['rights']; ?></i>\n\t\tangelegt, als auch in der Tabelle <i><?PHP echo $mysql_tables['user']; ?></i> f\u9ef5 jedes \"Recht\" eine Spalte angelegt, die mit dem \n\t\teingetragenen Standardwert gef\u9eeelt wird.<br />\n        Fragen werden gerne im <a href=\"http://forum.01-scripts.de/\" target=\"_blank\">01-Supportforum</a> gerne beantwortet.</td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\" width=\"50%\"><b>Kategorie*:</b><br /><span class=\"small\">catid(tinyint,2)</span></td>\n        <td class=\"trb\" width=\"50%\">\n\t\t\t<select name=\"catid\" size=\"1\">\n\t\t\t<?PHP\n\t\t\t$cats_rights = getSettingCats(\"\",$mysql_tables['rights']);\n\t\t\t\n\t\t\t$x = 0;\n\t\t\tforeach($cats_rights as $catvalue){\n\t\t\t\techo \"<option value=\\\"\".$catvalue['catid'].\"\\\">\".$catvalue['modul'].\" &raquo; \".$catvalue['name'].\" (ID: \".$catvalue['catid'].\")</option>\\n\";\n\t\t\t\t$x++;\n\t\t\t\t}\n\t\t\t?>\n\t\t\t</select>\n\t\t</td>\n    </tr>\n\t\n    <tr>\n        <td class=\"tra\"><b>Modul*:</b><br /><span class=\"small\">modul(varchar,25)</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"modulname\" value=\"<?PHP if(isset($_POST['modulname'])) echo $_POST['modulname']; ?>\" size=\"25\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>SortID:</b><br /><span class=\"small\">sortid(int,5): Sortier-Reihenfolge innerhalb der Kategorien (catid)</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"sortid\" value=\"<?PHP if(isset($_POST['sortid'])) echo $_POST['sortid']+1; ?>\" size=\"2\" maxlength=\"5\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Idname (unique)*:</b><br /><span class=\"small\">idname(varchar,25): Eindeutiger Name um den Datensatz anzusprechen</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"idname\" value=\"\" size=\"25\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Name:</b><br /><span class=\"small\">name(varchar,50): Name des neuen \"Rechts\"</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"name\" value=\"\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Beschreibung:</b><br /><span class=\"small\">exp(text): Beschreibung zum Datensatz f\u9ef5 die Benutzerverwaltung</span></td>\n        <td class=\"tra\"><textarea name=\"exp\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Formular-Type*:</b><br /><span class=\"small\">formename(text):<br /><b>1:</b> text = einfaches Textfeld<br /><b>2:</b> textarea = Textarea<br /><b>3:</b> wahl1|wahl2 = Radiobutton Wahl1 X Wahl2 X<br /><b>4:</b> wahl1|wahl2|wahl3|... = Auswahlliste<br /><b>5:</b> function = Funktionsaufruf von <i>modul_right_Idname()</i></span></td>\n        <td class=\"trb\"><textarea name=\"formename\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Formwerte*:</b><br /><span class=\"small\">formwerte(varchar,255):<br /><b>1:</b> 123 = size<br /><b>2:</b> 5|50 = rows|cols<br /><b>3:</b> Wert1|Wert2 = Zu speichernder Wert<br /><b>4:</b> Wert1|Wert2|Wert3|... = zu speichernde Werte<br /><b>5:</b> text|varchar = Feldtyp f&uuml;r die Rights-Tabelle</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"formwerte\" value=\"\" size=\"50\" maxlength=\"255\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Feld-Beschreibung:</b><br /><span class=\"small\">input_exp(varchar,50): Beschreibung nach dem Input-Feld</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"input_exp\" value=\"\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Standardwert:</b><br /><span class=\"small\">standardwert(text): Standardwert<br />(bei 3 und 4: -> =selected)</span></td>\n        <td class=\"tra\"><textarea name=\"standardwert\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Ausblenden (Benutzer):</b><br /><span class=\"small\">hide(tinyint,1): Einstellung beim Benutzer bearbeiten ausblenden? (1/0)</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"hide\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>In Profil:</b><br /><span class=\"small\">in_profile(tinyint,1): Kann der Inhalt dieses Feldes vom Benutzer selber in seinem Profil ge&auml;ndert werden?<br /><b>NICHT f\u9ef5 sicherheitsrelevante Berechtigungen verwenden!</b></span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"in_profile\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\t\n    <tr>\n        <td class=\"trb\"><b>NoDelete:</b><br /><span class=\"small\">nodelete(tinyint,1): Benutzerrecht kann nicht mehr gel&ouml;scht werden.</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"nodelete\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\t\n    <tr>\n        <td class=\"tra\" colspan=\"2\">Mit <b>*</b> markierte Felder m&uuml;ssen ausgef&uuml;llt werden. Es erfolgt jedoch keine &Uuml;berpr&uuml;fung der Formulardaten.</td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\" align=\"left\"><input type=\"reset\" value=\"Zur\u9edeksetzen\" class=\"input\" /></td>\n        <td class=\"tra\" align=\"right\"><input type=\"hidden\" name=\"action\" value=\"add_right\" /><input type=\"hidden\" name=\"send\" value=\"1\" /><input type=\"submit\" value=\"Datensatz anlegen\" class=\"input\" /></td>\n    </tr>\n</table>\t\n</form>\n\n<?PHP\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_right\")\n\t\t$flag_loginerror = true;\n\n// Datens\u92deze neu sortieren\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"sort_rights\" && $userdata['rights'] == 1 && $userdata['level'] == 10){\n\t\n\techo \"<h1>Benutzerrechte sortieren</h1>\";\n\t\n\techo \"<div class=\\\"meldung_hinweis\\\"><p><b>Benutzerrechte eines anderen Moduls sortieren:</b></p>\".\n\tcreate_ModulForm($filename.\"?action=sort_settings&amp;\",\"input2\",TRUE).\"</div>\";\n\t\n\t$cats_settings = getSettingCats($modul,$mysql_tables['rights']);\n\t\n\t// Eintr\u92d1e speichern\n\tif(isset($_POST['send']) && $_POST['send'] == 1){\n\t\n\t\t$list_save = $mysqli->query(\"SELECT id,sortid FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND modul='\".$mysqli->escape_string($modul).\"'\");\n\t\twhile($row_save = $list_save->fetch_assoc()){\n\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['rights'].\" SET sortid='\".$mysqli->escape_string($_POST[$row_save['id']]).\"' WHERE id='\".$row_save['id'].\"'\");\n\t\t\tif($userdata['devmode'] == 1) echo \"UPDATE \".$mysql_tables['rights'].\" SET sortid='\".$mysqli->escape_string($_POST[$row_save['id']]).\"' WHERE id='\".$row_save['id'].\"'<br />\\n\";\n\t\t\t}\n\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Gespeichert</b></p>\";\n\t\t}\n\t\t\n\n        echo \"<form action=\\\"\".$filename.\"?action=sort_rights&amp;modul=\".$modul.\"\\\" method=\\\"post\\\">\";\n        echo \"<ul>\\n\";\n\n\t\t$save1 = \"\";\n        $list = $mysqli->query(\"SELECT id,catid,sortid,name FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY catid,sortid\");\n        while($row = $list->fetch_assoc()){\n            if($save1 != $row['catid']) echo \"<li><h2>\".$cats_settings[$row['catid'].$modul]['name'].\"</h2></li>\";\n\t\t\techo \"<li><input type=\\\"text\\\" name=\\\"\".$row['id'].\"\\\" size=\\\"3\\\" value=\\\"\".$row['sortid'].\"\\\" maxlength=\\\"5\\\" /> \".$row['name'].\" <i>ID: \".$row['id'].\"</i></li>\\n\";\n\n\t\t\t$save1 = $row['catid'];\n            }\n        echo \"</ul>\\n\";\n\n        echo \"<p><input type=\\\"reset\\\" value=\\\"Reset &raquo;\\\" class=\\\"input\\\" /> <input type=\\\"submit\\\" value=\\\"Sortieren &raquo;\\\" class=\\\"input\\\" /><input type=\\\"hidden\\\" name=\\\"send\\\" value=\\\"1\\\" /></p>\";\n\n        echo \"</form>\";\n\t\t\n    }elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"sort_rights\") \n\t\t$flag_loginerror = true;\n\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2014 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tEinstellungen verwalten (bearbeiten, hinzuf\u5790en, sortieren)\n\t#fv.130#\n*/\n\n$menuecat = \"01acp_settings\";\n$sitetitle = \"Einstellungen\";\n$filename = $_SERVER['SCRIPT_NAME'];\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0){\n\n// Sicherheitsabfrage: Userberechtigungen (Einstellungen bearbeiten)\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"settings\" && $userdata['settings'] == 1){\n\t\n\techo \"<h1>Einstellungen</h1>\";\n\t\n    // Frage: Wirklich auf Standardwerte zur\ud846\udc77ksetzen?\n\tif(isset($_GET['do']) && $_GET['do'] == \"standard1\"){\n        echo \"<p class=\\\"meldung_frage\\\">\n              <b>Wollen Sie wirklich alle Einstellungen auf die Standardwerte zur&uuml;cksetzen?</b><br />\n              <br />\n              <a href=\\\"\".$filename.\"?action=\".$_GET['action'].\"&amp;do=standard2&amp;modul=\".$modul.\"\\\">JA</a> | <a href=\\\"\".$filename.\"?action=\".$_GET['action'].\"&amp;modul=\".$modul.\"\\\">Nein</a></p>\";\n        }\n\n    // Einstellungen auf Standardwerte zur\ud846\udc77ksetzen\n\tif(isset($_GET['do']) && $_GET['do'] == \"standard2\" && $userdata['addsettings'] == 1 && $userdata['settings'] == 1 && $userdata['level'] == 10){\n        $list_save = $mysqli->query(\"SELECT id,standardwert,wert FROM \".$mysql_tables['settings'].\" WHERE modul='\".$mysqli->escape_string($modul).\"' AND standardwert!='' AND hide='0'\");\n        while($row_save = $list_save->fetch_assoc()){\n            $mysqli->query(\"UPDATE \".$mysql_tables['settings'].\" SET wert='\".$row_save['standardwert'].\"' WHERE id='\".$row_save['id'].\"'\");\n            }\n        echo \"<p class=\\\"meldung_ok\\\"><b>Einstellungen wurden zur&uuml;ckgesetzt.</b></p>\";\n        }\n\n\t// Einstellungen speichern\n\tif(isset($_POST['do']) && $_POST['do'] == \"save\"){\n        $list_save = $mysqli->query(\"SELECT * FROM \".$mysql_tables['settings'].\" WHERE modul='\".$mysqli->escape_string($modul).\"' AND is_cat='0' AND hide='0'\");\n        while($row_save = $list_save->fetch_assoc()){\n\t\t\tif($row_save['formename'] == \"function\" && isset($_POST[$row_save['idname']]))\n            \t$mysqli->query(\"UPDATE \".$mysql_tables['settings'].\" SET wert='\".$mysqli->escape_string(call_RightSettingsFunction_Write($row_save['modul'],$row_save['idname'],$_POST[$row_save['idname']])).\"' WHERE id='\".$row_save['id'].\"'\");\n\t\t\telseif(isset($_POST[$row_save['idname']]))\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['settings'].\" SET wert='\".$mysqli->escape_string($_POST[$row_save['idname']]).\"' WHERE id='\".$row_save['id'].\"'\");\n            }\n        echo \"<p class=\\\"meldung_ok\\\"><b>Einstellungen wurden erfolgreich gespeichert.</b></p>\";\n        }\n\t\n\techo \"<div class=\\\"meldung_hinweis\\\"><p><b>Einstellungen eines anderen Moduls bearbeiten:</b></p>\".\n\tcreate_ModulForm($filename.\"?action=settings&amp;\",\"input2\",TRUE).\"</div>\";\n\t\n\t$cats_settings = getSettingCats($modul,$mysql_tables['settings']);\n\t\n\techo \"<form action=\\\"\".$filename.\"?action=\".$_GET['action'].\"&amp;modul=\".$modul.\"\\\" method=\\\"post\\\">\n<table border=\\\"0\\\" align=\\\"center\\\" width=\\\"100%\\\" cellpadding=\\\"3\\\" cellspacing=\\\"5\\\" class=\\\"rundrahmen\\\">\";\n\n    $count = 0;\n\t$x = 0;\n\tforeach($cats_settings as $catvalue){\n\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\n        echo \"\\n    <tr>\n        <td colspan=\\\"2\\\" class=\\\"\".$class.\"\\\"><h3>\".$catvalue['name'].\"</h3></td>\n    </tr>\";\n        \n        $list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['settings'].\" WHERE modul='\".$mysqli->escape_string($modul).\"' AND is_cat='0' AND catid='\".$catvalue['catid'].\"' AND hide='0' ORDER BY sortid\");\n        while($row = $list->fetch_assoc()){\n            if($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\n\t\t\t// MySQL-daten verarbeiten\n\t\t\techo parse_dynFieldtypes($row,$class,$count,\"01acp\");\n            }\n\n\t\t$x++;\n\t\t}\n\n    echo \"    <tr>\n        <td><input type=\\\"reset\\\" value=\\\"Werte zur&uuml;cksetzen\\\" class=\\\"input\\\" /></td>\n        <td align=\\\"right\\\"><input type=\\\"hidden\\\" name=\\\"modul\\\" value=\\\"\".$modul.\"\\\" /><input type=\\\"hidden\\\" name=\\\"do\\\" value=\\\"save\\\" /><input type=\\\"submit\\\" value=\\\"Speichern &raquo;\\\" class=\\\"input\\\" /></td>\n    </tr>\";\n\n    echo \"</table>\n          </form>\";\n\n    if($userdata['addsettings'] == 1 && $userdata['settings'] == 1 && $userdata['level'] == 10){\n        echo \"<p class=\\\"meldung_frage\\\"><b><a href=\\\"\".$filename.\"?action=\".$_GET['action'].\"&amp;do=standard1&amp;modul=\".$modul.\"\\\">Einstellungen auf Standardwerte zur&uuml;cksetzen?</a></b><br />\n\t\t\tIndividuelle &Auml;nderungen gehen dabei verloren!</p>\";\n        }\n\t\t\n    if($userdata['level'] == 10 && $userdata['devmode'] == 1){\n        echo \"<p class=\\\"meldung_hinweis\\\"><b><a href=\\\"_dev.php\\\">_dev.php aufrufen</a></b></p>\";\n        }\n\t\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"settings\")\n\t\t$flag_loginerror = true;\n\t\n// Sicherheitsabfrage: Userberechtigungen (Einstellungen erstellen / sortieren)\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_setting\" && $userdata['addsettings'] == 1 && $userdata['settings'] == 1 && $userdata['level'] == 10){\n\t\n\t// Eintragung in Datenbank vornehmen\n\tif(isset($_POST['send']) && $_POST['send'] == 1){\n\t\t$sql_insert = \"INSERT INTO \".$mysql_tables['settings'].\" (modul,is_cat,catid,sortid,idname,name,exp,formename,formwerte,input_exp,standardwert,wert,nodelete,hide) VALUES ('\".$mysqli->escape_string($_POST['modulname']).\"','0','\".$mysqli->escape_string($_POST['catid']).\"','\".$mysqli->escape_string($_POST['sortid']).\"','\".$mysqli->escape_string($_POST['idname']).\"','\".$mysqli->escape_string($_POST['name']).\"','\".$mysqli->escape_string($_POST['exp']).\"','\".$mysqli->escape_string($_POST['formename']).\"','\".$mysqli->escape_string($_POST['formwerte']).\"','\".$mysqli->escape_string($_POST['input_exp']).\"','\".$mysqli->escape_string($_POST['standardwert']).\"','\".$mysqli->escape_string($_POST['wert']).\"','\".$mysqli->escape_string($_POST['nodelete']).\"','\".$mysqli->escape_string($_POST['hide']).\"')\";\n\t\t$result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\n\t\techo $sql_insert.\"<br /><br />\";\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Datensatz wurde hinzugef\u5790t</b></p>\";\n\t\t}\n?>\n\n<h1>Einstellung hinzuf&uuml;gen</h1>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td colspan=\"2\">Auf dieser Seite k&ouml;nnen neue Datens&auml;tze zur MySQL-Settings-Tabelle (<?PHP echo $mysql_tables['settings']; ?>) hinzugef&uuml;gt werden.<br />\n        Dieser Bereich ist normalerweise nur f\u50e1 Entwickler von Modifikationen f\u50e1 das 01ACP interessant. Ein Funktion zur Bearbeitung von Datens&auml;tzen\n        ist nicht vorhanden. Datens&auml;tze m&uuml;ssen ggf. per PHPMyAdmin bearbeitet werden.<br />\n        Fragen werden gerne im <a href=\"http://forum.01-scripts.de/\" target=\"_blank\">01-Supportforum</a> gerne beantwortet.</td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\" width=\"50%\"><b>Kategorie*:</b><br /><span class=\"small\">catid(tinyint,2)</span></td>\n        <td class=\"trb\" width=\"50%\">\n\t\t\t<select name=\"catid\" size=\"1\">\n\t\t\t<?PHP\n\t\t\t$cats_settings = getSettingCats(\"\",$mysql_tables['settings']);\n\n\t\t\t$x = 0;\n\t\t\tforeach($cats_settings as $catvalue){\n\t\t\t\techo \"<option value=\\\"\".$catvalue['catid'].\"\\\">\".$catvalue['modul'].\" &raquo; \".$catvalue['name'].\" (ID: \".$catvalue['catid'].\")</option>\\n\";\n\t\t\t\t$x++;\n\t\t\t\t}\n\t\t\t?>\n\t\t\t</select>\n\t\t</td>\n    </tr>\n\t\n    <tr>\n        <td class=\"tra\"><b>Modul*:</b><br /><span class=\"small\">modul(varchar,25)</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"modulname\" value=\"<?PHP if(isset($_POST['modulname'])) echo $_POST['modulname']; ?>\" size=\"25\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>SortID:</b><br /><span class=\"small\">sortid(int,5): Sortier-Reihenfolge innerhalb der Kategorien (catid)</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"sortid\" value=\"<?PHP if(isset($_POST['sortid'])) echo $_POST['sortid']+1; ?>\" size=\"2\" maxlength=\"5\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Idname (unique)*:</b><br /><span class=\"small\">idname(varchar,25): Eindeutiger Name um den Datensatz anzusprechen</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"idname\" value=\"\" size=\"25\" maxlength=\"25\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Name:</b><br /><span class=\"small\">name(varchar,50): Name, der auf der Einstellungs-Seite angezeigt wird</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"name\" value=\"\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Beschreibung:</b><br /><span class=\"small\">exp(text): Beschreibung zum Datensatz f\u50e1 die Einstellungs-Seite</span></td>\n        <td class=\"tra\"><textarea name=\"exp\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Formular-Type*:</b><br /><span class=\"small\">formename(text):<br /><b>1:</b> text = einfaches Textfeld<br /><b>2:</b> textarea = Textarea<br /><b>3:</b> wahl1|wahl2 = Radiobutton Wahl1 X Wahl2 X<br /><b>4:</b> wahl1|wahl2|wahl3|... = Auswahlliste<br /><b>5:</b> function = Funktionsaufruf von <i>modul_right_Idname()</i></span></td>\n        <td class=\"trb\"><textarea name=\"formename\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Formwerte*:</b><br /><span class=\"small\">formwerte(varchar,255):<br /><b>1:</b> 123 = size<br /><b>2:</b> 5|50 = rows|cols<br /><b>3:</b> Wert1|Wert2 = Zu speichernder Wert<br /><b>4:</b> Wert1|Wert2|Wert3|... = zu speichernde Werte</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"formwerte\" value=\"\" size=\"50\" maxlength=\"255\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Feld-Beschreibung:</b><br /><span class=\"small\">input_exp(varchar,50): Beschreibung nach dem Input-Feld</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"input_exp\" value=\"\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>Standardwert:</b><br /><span class=\"small\">standardwert(text): Standardwert<br />(bei 3 und 4: -> =selected)</span></td>\n        <td class=\"tra\"><textarea name=\"standardwert\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Wert:</b><br /><span class=\"small\">wert(text): gespeicherter Wert</span></td>\n        <td class=\"trb\"><textarea name=\"wert\" rows=\"5\" cols=\"60\" style=\"font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px; font-style: normal;\"></textarea></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>NoDelete:</b><br /><span class=\"small\">nodelete(tinyint,1): Benutzerrecht kann nicht mehr gel&ouml;scht werden.</span></td>\n        <td class=\"tra\"><input type=\"text\" name=\"nodelete\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\t\n    <tr>\n        <td class=\"trb\"><b>Ausblenden:</b><br /><span class=\"small\">hide(tinyint,1): Einstellung ausblenden? (1/0)</span></td>\n        <td class=\"trb\"><input type=\"text\" name=\"hide\" value=\"0\" size=\"2\" maxlength=\"1\" /></td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\" colspan=\"2\">Mit <b>*</b> markierte Felder m&uuml;ssen ausgef&uuml;llt werden. Es erfolgt jedoch keine &Uuml;berpr&uuml;fung der Formulardaten.</td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\" align=\"left\"><input type=\"reset\" value=\"Zur\ud846\udc77ksetzen\" class=\"input\" /></td>\n        <td class=\"tra\" align=\"right\"><input type=\"hidden\" name=\"action\" value=\"add_setting\" /><input type=\"hidden\" name=\"send\" value=\"1\" /><input type=\"submit\" value=\"Datensatz anlegen\" class=\"input\" /></td>\n    </tr>\n</table>\t\n</form>\n\n<?PHP\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_setting\")\n\t\t$flag_loginerror = true;\n\t\n// Datens\u9179ze neu sortieren\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"sort_settings\" && $userdata['addsettings'] == 1 && $userdata['settings'] == 1 && $userdata['level'] == 10){\n\t\n\techo \"<h1>Einstellungen sortieren</h1>\";\n\t\n\techo \"<div class=\\\"meldung_hinweis\\\"><p><b>Einstellungen eines anderen Moduls sortieren:</b></p>\".\n\tcreate_ModulForm($filename.\"?action=sort_settings&amp;\",\"input2\",TRUE).\"</div>\";\n\t\n\t$cats_settings = getSettingCats($modul,$mysql_tables['settings']);\n\t\n\t// Eintr\u8f0de speichern\n\tif(isset($_POST['send']) && $_POST['send'] == 1)\n\t\t{\n\t\t$list_save = $mysqli->query(\"SELECT id,sortid FROM \".$mysql_tables['settings'].\" WHERE is_cat='0' AND modul='\".$mysqli->escape_string($modul).\"'\");\n\t\twhile($row_save = $list_save->fetch_assoc()){\n\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['settings'].\" SET sortid='\".$mysqli->escape_string($_POST[$row_save['id']]).\"' WHERE id='\".$row_save['id'].\"'\");\n\t\t\techo \"UPDATE \".$mysql_tables['settings'].\" SET sortid='\".$mysqli->escape_string($_POST[$row_save['id']]).\"' WHERE id='\".$row_save['id'].\"'<br />\\n\";\n\t\t\t}\n\n\t\techo \"<p class=\\\"meldung_ok\\\"><b>Gespeichert</b></p>\";\n\t\t}\n\n        echo \"<form action=\\\"\".$filename.\"?action=sort_settings&amp;modul=\".$modul.\"\\\" method=\\\"post\\\">\";\n        echo \"<ul>\\n\";\n        \n\t\t$save1 = \"\";\n        $list = $mysqli->query(\"SELECT id,catid,sortid,name FROM \".$mysql_tables['settings'].\" WHERE is_cat='0' AND modul='\".$mysqli->escape_string($modul).\"' ORDER BY catid,sortid\");\n        while($row = $list->fetch_assoc()){\n            if($save1 != $row['catid']) echo \"<li><h2>\".$cats_settings[$row['catid'].$modul]['name'].\"</h2></li>\";\n\t\t\techo \"<li><input type=\\\"text\\\" name=\\\"\".$row['id'].\"\\\" size=\\\"3\\\" value=\\\"\".$row['sortid'].\"\\\" maxlength=\\\"5\\\" /> \".$row['name'].\" <i>(ID: \".$row['id'].\")</i></li>\\n\";\n\t\t\t\n\t\t\t$save1 = $row['catid'];\n            }\n        echo \"</ul>\\n\";\n\n        echo \"<p><input type=\\\"reset\\\" value=\\\"Reset &raquo;\\\" class=\\\"input\\\" /> <input type=\\\"submit\\\" value=\\\"Sortieren &raquo;\\\" class=\\\"input\\\" /><input type=\\\"hidden\\\" name=\\\"send\\\" value=\\\"1\\\" /></p>\";\n\n        echo \"</form>\";\n\t\t\n    }elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"sort_settings\") \n\t\t$flag_loginerror = TRUE;\n\t\n}else $flag_loginerror = TRUE;\ninclude(\"system/foot.php\");\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2013 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tFormular & Logik f\u00b3r Dateiupload + Ausgabe innerhalb des TinyMCE-Editor\n\t#fv.130#\n*/\n\nif(!isset($filename)) $filename = $_SERVER['SCRIPT_NAME'];\nif(!isset($_REQUEST['formname'])) $_REQUEST['formname'] = \"\";\nif(!isset($_REQUEST['type'])) $_REQUEST['type'] = \"\";\nif(!isset($_REQUEST['returnvalue'])) $_REQUEST['returnvalue'] = \"\";\nif(!isset($_REQUEST['formfield'])) $_REQUEST['formfield'] = \"\";\nif(!isset($_REQUEST['look'])) $_REQUEST['look'] = \"\";\nif(!isset($_REQUEST['delfileid'])) $_REQUEST['delfileid'] = \"\";\nif(!isset($_REQUEST['delfile'])) $_REQUEST['delfile'] = \"\";\n\t\n// Parameter an URL anh\u00f5ngen\n$filename .= \"type=\".$_REQUEST['type'].\"&amp;returnvalue=\".$_REQUEST['returnvalue'].\"&amp;formname=\".$_REQUEST['formname'].\"&amp;formfield=\".$_REQUEST['formfield'].\"&amp;look=\".$_REQUEST['look'].\"&amp;delfileid=\".$_REQUEST['delfileid'].\"&amp;delfile=\".$_REQUEST['delfile'];\n\n$flag_showformular = TRUE;\n$flag_showlist = TRUE;\n\n// Sicherheitsabfrage: Login & Berechtigung f\u00b3r Upload\nif(isset($userdata['id']) && $userdata['id'] > 0){\n\t\n\t// Upload ausf\u00b3hren\n\tif(isset($_POST['upload']) && $_POST['upload'] == 1 && isset($_FILES['new_datei']['name']) && $_FILES['new_datei']['name'] != \"\" && $userdata['upload'] == 1){\n\t\t\n\t\tif(isset($_REQUEST['delfileid']) && !empty($_REQUEST['delfileid'])){\n\t\t\tif($userdata['dateimanager'] == 1) $query = \"SELECT id,filetype,name FROM \".$mysql_tables['files'].\" WHERE uid = '\".$userdata['id'].\"' AND id='\".$mysqli->escape_string($_REQUEST['delfileid']).\"' LIMIT 1\";\n\t\t\telseif($userdata['dateimanager'] == 2) $query = \"SELECT id,filetype,name FROM \".$mysql_tables['files'].\" WHERE id='\".$mysqli->escape_string($_REQUEST['delfileid']).\"' LIMIT 1\";\n\t\t\t\n\t\t\t$list = $mysqli->query($query);\n\t\t\tif($list->num_rows == 1){\n\t\t\t\twhile($row = $list->fetch_assoc()){\n\t\t\t\t\t$fupload = uploadfile($_FILES['new_datei']['name'],$_FILES['new_datei']['size'],$_FILES['new_datei']['tmp_name'],$_REQUEST['type'],\"01acp\",$row['name'],$_REQUEST['filedirid']);\n\t\t\t\t\t$fupload['msg'] = \"Die Datei <i>\".$_REQUEST['delfile'].\"</i> wurde erfolgreich ersetzt.\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\telse\n\t\t\t\techo \"<p class=\\\"meldung_error\\\"><b>Fehler:</b> Die Datei konnte nicht gefunden werden oder\n\t\t\t\t\t\tSie haben nicht die n&ouml;tige Berechtigung um die Datei zu ersetzen!<br />\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<a href=\\\"javascript:window.close();\\\">Fenster schlie&szlig;en</a>\";\n\t\t\t}\n\t\telse\n\t\t\t$fupload = uploadfile($_FILES['new_datei']['name'],$_FILES['new_datei']['size'],$_FILES['new_datei']['tmp_name'],$_REQUEST['type'],\"01acp\",\"\",$_REQUEST['filedirid']);\n\t\t\n\t\t// Ausgabe der Meldungen / R\u00b3ckgabewerte\n\t\tif($fupload['success'] == 1){\n\t\t\t$flag_showformular = FALSE;\n\t\t\t\n\t\t\tif(isset($_REQUEST['delfileid']) && !empty($_REQUEST['delfileid']) && $flag_ispopup){\n\t\t\t\techo \"\n<script type=\\\"text/javascript\\\">\nopener.location.reload(true);\nwindow.setTimeout(\\\"opener.document.getElementById('ers_erfolgsmeldung').style.display = 'block'\\\", 2500);\n</script>\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\techo \"<p class=\\\"meldung_ok\\\"><b>\".$fupload['msg'].\"</b><br />\";\n\t\t\t\n\t\t\t// JavaScript - Bilder\n\t\t\tif($fupload['fileart'] == \"pic\" && ($_REQUEST['returnvalue'] == \"js\" && !empty($_REQUEST['formname']) && !empty($_REQUEST['formfield']) || \n\t\t\t\t$_REQUEST['returnvalue'] == \"php\" || empty($_REQUEST['returnvalue']))){\n\t\t\t\t\n\t\t\t\tif($_REQUEST['returnvalue'] == \"js\" && !empty($_REQUEST['formname']) && !empty($_REQUEST['formfield']))\n\t\t\t\t\techo \"<br />Bild einf&uuml;gen:<br />\n\t\t\t\t\t<br />\n\t\t\t\t\t<input type=\\\"button\\\" value=\\\"Einf&uuml;gen\\\" class=\\\"input\\\" onclick=\\\"opener.document.\".$_REQUEST['formname'].\".\".$_REQUEST['formfield'].\".value='\".stripslashes($fupload['name']).\"'; window.close();\\\" />\";\n\n\t\t\t\techo \"</p><div style=\\\"float:left;\\\">\";\t\t\t\t\n\t\t\t\techo \"<a href=\\\"\".$picuploaddir.$fupload['name'].\"\\\" target=\\\"_blank\\\"><img src=\\\"\".$picuploaddir.\"showpics.php?img=\".$fupload['name'].\"&amp;size=\".ACP_TB_WIDTH200.\"&amp;hidegif=normal\\\" alt=\\\"Hochgeladenes Bild\\\" /></a>\";\n\t\t\t\techo \"</div>\";\n\t\t\t\t\n\t\t\t\techo \"<div style=\\\"float:right;\\\">\n\t\t\t\t<a href=\\\"\".$filename.\"&amp;deltype=pic&amp;del=1&amp;file=\".$fupload['name'].\"\\\" style=\\\"color:red;\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"Icon: L&ouml;schen\\\" title=\\\"Bild l&ouml;schen\\\" style=\\\"border:0; margin-right:8px;\\\" />Bild l&ouml;schen &raquo;</a><br />\n\t\t\t\t<a href=\\\"\".$filename.\"\\\"><img src=\\\"images/icons/icon_upload.gif\\\" alt=\\\"Weitere Datei hochladen\\\" style=\\\"border:0; margin-right:8px;\\\" />Weitere Datei hochladen &raquo;</a></div>\";\n\t\t\t\t}\n\t\t\t// JavaScript - Dateien\n\t\t\telseif($fupload['fileart'] == \"file\" && ($_REQUEST['returnvalue'] == \"js\" && !empty($_REQUEST['formname']) && !empty($_REQUEST['formfield']) || \n\t\t\t\t$_REQUEST['returnvalue'] == \"php\" || empty($_REQUEST['returnvalue']))){\n\t\t\t\t\n\t\t\t\tif($_REQUEST['returnvalue'] == \"js\" && !empty($_REQUEST['formname']) && !empty($_REQUEST['formfield']))\n\t\t\t\t\techo \"<br /><b>Datei einf&uuml;gen:</b><br />\n\t\t\t\t\t<input type=\\\"button\\\" value=\\\"Einf&uuml;gen\\\" class=\\\"input\\\" onclick=\\\"opener.document.\".$_REQUEST['formname'].\".\".$_REQUEST['formfield'].\".value='\".stripslashes($fupload['name']).\"'; window.close();\\\" />\n\t\t\t\t\t<br /><br />\";\n\t\t\t\t\n\t\t\t\techo \"\n\t\t\t\t<a href=\\\"\".$filename.\"&amp;deltype=file&amp;del=1&amp;file=\".$fupload['name'].\"\\\" style=\\\"color:red;\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"Icon: L&ouml;schen\\\" title=\\\"Datei l&ouml;schen\\\" style=\\\"border:0; margin-right:8px;\\\" />Datei l&ouml;schen</a><br />\n\t\t\t\t<a href=\\\"\".$filename.\"\\\"><img src=\\\"images/icons/icon_upload.gif\\\" alt=\\\"Weitere Datei hochladen\\\" style=\\\"border:0; margin-right:8px;\\\" />Weitere Datei hochladen &raquo;</a>\n\t\t\t\t</p>\";\n\t\t\t\t}\n\t\t\t// TinyMCE - Bilder\n\t\t\telseif($fupload['fileart'] == \"pic\" && $_REQUEST['returnvalue'] == \"tinymce\" && \n\t\t\t\t!empty($_REQUEST['formname']) && !empty($_REQUEST['formfield'])){\n                $info = getimagesize($picuploaddir.$fupload['name']);\n\t\t\t\tif($info[0] >= $info[1]){ $bigside = $info[0]; }else{ $bigside = $info[1]; }\n\t\t\t\t\n\t\t\t\tif($bigside > $settings['thumbwidth']){ $c1 = \"\"; $c2 = \" checked=\\\"checked\\\"\"; }\n\t\t\t\telse{ $c1 = \" checked=\\\"checked\\\"\"; $c2 = \"\"; }\n\t\t\t\t\n\t\t\t\techo \"<br />Bild einf&uuml;gen:<br />\n\t\t\t\t<span class=\\\"small\\\"><input type=\\\"radio\\\" name=\\\"usesize\\\" value=\\\"org\\\"\".$c1.\" />Original Datei (\".$info[0].\"x\".$info[1].\" px) einf&uuml;gen<br />\n                <input type=\\\"radio\\\" name=\\\"usesize\\\" value=\\\"small\\\"\".$c2.\" />Verkleinerte Version mit <input type=\\\"text\\\" name=\\\"maxsize\\\" value=\\\"\".$settings['thumbwidth'].\"\\\" size=\\\"5\\\" />px Kantenl&auml;nge einf&uuml;gen<br />\n\t\t\t\t<input type=\\\"checkbox\\\" name=\\\"link\\\" value=\\\"1\\\" checked=\\\"checked\\\" />Link auf original Datei (mit maximale Aufl&ouml;sung) setzen</span>\n\t\t\t\t<input type=\\\"button\\\" value=\\\"Einf&uuml;gen\\\" class=\\\"input\\\" onclick=\\\"FileDialog.insertpic('\".$picuploaddir.\"','\".$fupload['name'].\"');\\\" />\n\t\t\t\t</p>\n\t\t\t\t\n\t\t\t\t<div style=\\\"float:left;\\\">\";\t\t\t\t\n\t\t\t\techo \"<a href=\\\"\".$picuploaddir.$fupload['name'].\"\\\" target=\\\"_blank\\\"><img src=\\\"\".$picuploaddir.\"showpics.php?img=\".$fupload['name'].\"&amp;size=\".ACP_TB_WIDTH200.\"&amp;hidegif=normal\\\" alt=\\\"Hochgeladenes Bild\\\" /></a>\";\n\t\t\t\techo \"</div>\";\n\t\t\t\t\n\t\t\t\techo \"<div style=\\\"float:right;\\\">\n\t\t\t\t<a href=\\\"\".$filename.\"&amp;deltype=pic&amp;del=1&amp;file=\".$fupload['name'].\"\\\" style=\\\"color:red;\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"Icon: L&ouml;schen\\\" title=\\\"Bild l&ouml;schen\\\" style=\\\"border:0; margin-right:8px;\\\" />Bild l&ouml;schen &raquo;</a><br />\n\t\t\t\t<a href=\\\"\".$filename.\"\\\"><img src=\\\"images/icons/icon_upload.gif\\\" alt=\\\"Weitere Datei hochladen\\\" style=\\\"width:16px; margin-right:8px;\\\" />Weitere Datei hochladen &raquo;</a></div>\";\n\t\t\t\t}\n\t\t\t// TinyMCE - Dateien\n\t\t\telseif($fupload['fileart'] == \"file\" && $_REQUEST['returnvalue'] == \"tinymce\" && \n\t\t\t\t!empty($_REQUEST['formname']) && !empty($_REQUEST['formfield'])){\n\t\t\t\techo \"<br /><b>Datei einf&uuml;gen:</b><br />\n\t\t\t\t<input type=\\\"button\\\" value=\\\"Einf&uuml;gen\\\" class=\\\"input\\\" onclick=\\\"FileDialog.insertfile('\".$attachmentuploaddir.\"','\".$fupload['name'].\"','\".$fupload['orgname'].\"');\\\" />\n\t\t\t\t<br /><br />\n\t\t\t\t\n\t\t\t\t<a href=\\\"\".$filename.\"&amp;deltype=file&amp;del=1&amp;file=\".$fupload['name'].\"\\\" style=\\\"color:red;\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"Icon: L&ouml;schen\\\" title=\\\"Datei l&ouml;schen\\\" style=\\\"border:0; margin-right:8px;\\\" />Datei l&ouml;schen</a><br />\n\t\t\t\t<a href=\\\"\".$filename.\"\\\"><img src=\\\"images/icons/icon_upload.gif\\\" alt=\\\"Weitere Datei hochladen\\\" style=\\\"width:16px; margin-right:8px;\\\" />Weitere Datei hochladen &raquo;</a></p>\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\telse{\n\t\t\t$flag_showformular = TRUE;\n\t\t\techo \"<p class=\\\"meldung_error\\\">\".$fupload['msg'].\"</p>\";\n\t\t\t}\n\t\t}\n\telseif(isset($_POST['upload']) && $_POST['upload'] == 1 && $userdata['upload'] == 1){\n\t\t$flag_showformular = TRUE;\n\t\techo \"<p class=\\\"meldung_error\\\">Sie haben keine Datei ausgew&auml;hlt!</p>\";\n\t\t}\n\telseif(isset($_POST['upload']) && $_POST['upload'] == 1 && $userdata['upload'] != 1){\n\t\t$flag_showformular = FALSE;\n\t\techo \"<p class=\\\"meldung_error\\\">Sie haben keine Berechtigung eine neue Datei hochzuladen.</p>\";\n\t\t}\n\n\n\n\n\n\n\t// Abfrage: Datei l\u00f7schen\n\tif(isset($_GET['del']) && $_GET['del'] == 1 && isset($_GET['file']) && !empty($_GET['file']) && isset($_GET['deltype']) && !empty($_GET['deltype']) && $userdata['upload'] == 1){\n\t\t$flag_showformular = FALSE;\n\t\t\n\t\techo \"<p class=\\\"meldung_frage\\\">\n\t\tWollen Sie die Datei <b>\".$_GET['file'].\"</b> wirklich l&ouml;schen?\n\t\t<br /><br />\n\t\t<a href=\\\"\".$filename.\"&amp;deltype=\".$_GET['deltype'].\"&amp;del=2&amp;file=\".$_GET['file'].\"\\\">Ja, Datei l&ouml;schen</a> |\n\t\t<a href=\\\"\".$filename.\"\\\">Nein, zur&uuml;ck</a>\n\t\t</p>\";\n\t\t}\n\t// Durchf\u00b3hrung: Datei l\u00f7schen\n\telseif(isset($_GET['del']) && $_GET['del'] == 2 && isset($_GET['file']) && !empty($_GET['file']) && isset($_GET['deltype']) && !empty($_GET['deltype']) && $userdata['upload'] == 1){\n\t\t$flag_showformular = TRUE;\n\t\t\n\t\tlist($fmenge) = $mysqli->query(\"SELECT COUNT(*) FROM \".$mysql_tables['files'].\" WHERE name='\".$mysqli->escape_string($_GET['file']).\"' AND uid='\".$userdata['id'].\"'\")->fetch_array(MYSQLI_NUM);\n\t\tif($fmenge == 1){\n\t\t\tswitch($_REQUEST['deltype']){\n\t\t\t  case \"file\":\n\t\t\t  @delfile($attachmentuploaddir,$_GET['file']);\n\t\t\t  break;\n\t\t\t  case \"pic\":\n\t\t\t  @delfile($picuploaddir,$_GET['file']);\n\t\t\t  break;\n\t\t\t  }\n\t\t\t\n\t\t\techo \"<p class=\\\"meldung_ok\\\">Die Datei <b>\".$_GET['file'].\"</b> wurde erfolgreich gel&ouml;scht.</p>\";\n\t\t\t}\n\t\telse{\n\t\t\techo \"<p class=\\\"meldung_error\\\">Die Datei <b>\".$_GET['file'].\"</b> konnte nicht gefunden werden oder Sie haben keine Berechtigung diese Datei zu l&ouml;schen.</p>\";\n\t\t\t}\n\t\t}\n\t\t\nif($userdata['upload'] == 1 && $flag_showformular && (isset($_REQUEST['look']) && ($_REQUEST['look'] == \"upload\" || $_REQUEST['look'] == \"both\" || empty($_REQUEST['look'])) || !isset($_REQUEST['look']))){\n\n// Tun: Datei verschieben:\nif(isset($_REQUEST['delfileid']) && !empty($_REQUEST['delfileid']) &&\n   isset($_REQUEST['newdir']) && is_numeric($_REQUEST['newdir']) && $_REQUEST['newdir'] != $_REQUEST['olddir']){\n\t$mysqli->query(\"UPDATE \".$mysql_tables['files'].\" SET dir = '\".$mysqli->escape_string($_REQUEST['newdir']).\"' WHERE id = '\".$mysqli->escape_string($_REQUEST['delfileid']).\"' LIMIT 1\");\n\t\n\techo \"\n<script type=\\\"text/javascript\\\">\nopener.document.getElementById('id\".$_REQUEST['delfileid'].\"').style.display = 'none';\n</script>\";\n\t}\n// Ausgabe: Datei in anderes Verzeichnis verschieben und Hinweis auf M\u00f7glichkeit der Ersetzung\nif(isset($_REQUEST['delfileid']) && !empty($_REQUEST['delfileid'])){\n\t$list = $mysqli->query(\"SELECT dir FROM \".$mysql_tables['files'].\" WHERE id = '\".$mysqli->escape_string($_REQUEST['delfileid']).\"' LIMIT 1\");\n\t$fileinfo = $list->fetch_assoc();\n\t\n\techo \"<div class=\\\"meldung_hinweis\\\"><form action=\\\"\".$filename.\"\\\" method=\\\"post\\\">\n\t<b>Datei in Verzeichnis verschieben:</b> <select name=\\\"newdir\\\" size=\\\"1\\\" class=\\\"input_select\\\">\n\t\t<option value=\\\"0\\\">Kein Unterverzeichnis</option>\n\t\t\".getFileVerz_Rek(0,0,-1,\"echo_FileVerz_select\",$fileinfo['dir']).\"\n\t</select>\n\t<input type=\\\"hidden\\\" name=\\\"olddir\\\" value=\\\"\".$fileinfo['dir'].\"\\\" />\n\t<input type=\\\"submit\\\" class=\\\"input\\\" value=\\\"Verschieben\\\" />\n\t</form></div>\";\n\techo \"<p class=\\\"meldung_hinweis\\\">W&auml;hlen Sie eine neue Datei, aus um die Datei <b>\".$_REQUEST['delfile'].\"</b> zu ersetzt:</p>\";\n\t\n\t$flag_showlist = FALSE;\n\t}\n?>\n\n<?php if(!strchr($_SERVER['HTTP_USER_AGENT'],\"MSIE 6.0\") && !$flag_oldfileupload &&\n\t\t isset($_REQUEST['action']) && $_REQUEST['action'] == \"fmanageruploader\"){ ?>\n<form action=\"_ajaxloader.php?SID=<?php echo htmlspecialchars(session_id(),$htmlent_flags,$htmlent_encoding_acp); ?>&amp;modul=01acp&amp;ajaxaction=fancyupload<?php if($flag_sessionbugfix){ echo \"&amp;sessiondata=\".urlencode(session_encode()); } ?>\" method=\"post\" enctype=\"multipart/form-data\" id=\"fancy-form\">\n\n<div id=\"fancy-status\" class=\"hide\">\n<p>\n\t<a href=\"#\" id=\"fancy-browse\">Dateien ausw&auml;hlen</a> |\n\t<a href=\"#\" id=\"fancy-clear\">Warteschlange l&ouml;schen</a> |\n\t<a href=\"#\" id=\"fancy-upload\">Dateien jetzt hochladen</a>\n</p>\n<p>\n\t<select name=\"filedirid\" id=\"filedirid\" size=\"1\" class=\"input_select\" onchange=\"up.setOptions({data: 'filedirid=' + $('filedirid').get('value'),})\">\n\t\t<option value=\"0\">Kein Unterverzeichnis</option>\n\t\t<?PHP echo getFileVerz_Rek(0,0,-1,\"echo_FileVerz_select\",0); ?>\n\t</select>\n</p>\n<div>\n\t<strong class=\"overall-title\"></strong><br />\n\t<img src=\"images/fancy/bar.gif\" class=\"progress overall-progress\" />\n</div>\n<div>\n\t<strong class=\"current-title\"></strong><br />\n\t<img src=\"images/fancy/bar.gif\" class=\"progress current-progress\" />\n</div>\n\n<div class=\"current-text\"></div>\n</div>\n\n<ul id=\"fancy-list\"></ul>\n\n</form>\n<?php } ?>\n\n<!-- Fallback-L\u00f7sung! + Standard-L\u00f7sung f\u00b3r TinyMCE-Upload! -->\n<div id=\"fancy-fallback\">\n<h2>Neue Datei hochladen</h2>\n<form enctype=\"multipart/form-data\" action=\"<?PHP echo $filename; ?>\" method=\"post\">\n\t<p>Bitte w&auml;hlen Sie auf Ihrer Festplatte eine Datei aus:<br />\n\t<input type=\"file\" name=\"new_datei\" class=\"input_text\" />&nbsp;&nbsp;\n\t<select name=\"filedirid\" size=\"1\" class=\"input_select\">\n\t\t<option value=\"0\">Kein Unterverzeichnis</option>\n\t\t<?PHP echo getFileVerz_Rek(0,0,-1,\"echo_FileVerz_select\",0); ?>\n\t</select>&nbsp;&nbsp;\n\t<input type=\"submit\" value=\"Hochladen\" onclick=\"hide_unhide('loading');\" class=\"input\" /><br />\n\t<b class=\"small\">(Keine Leer- oder Sonderzeichen im Dateiname!)</b></p>\n\t\n\t<div id=\"loading\" style=\"display:none; float:right; margin-right:35px; text-align:center;\">\n\t\t<img src=\"images/icons/loading.gif\" alt=\"Lade-Animation\" title=\"Datei wird zum Server &uuml;bertragen - bitte warten...\" /><br />\n\t\t<span class=\"small\">Datei wird &uuml;betragen...</span>\n\t</div>\n\t<p>\n\t\t<?PHP\n\t\tif(isset($_REQUEST['type']) && ($_REQUEST['type'] == \"pic\" || empty($_REQUEST['type'])) || !isset($_REQUEST['type'])){\n\t\t?>\n\t\t<b>Spezifikationen f\u00b3r Bilder:</b> <?PHP echo $settings['pic_end']; ?>-Datei mit max. <?PHP echo $settings['pic_size']; ?> KB<br />\n\t\t<?PHP\n\t\t}\n\t\t\n\t\tif(isset($_REQUEST['type']) && ($_REQUEST['type'] == \"file\" || empty($_REQUEST['type'])) || !isset($_REQUEST['type'])){\n\t\t?>\n\t\t<b>Spezifikationen f\u00b3r Dateien:</b> <?PHP echo $settings['attachment_end']; ?>-Datei mit max. <?PHP echo $settings['attachment_size']; ?> KB<br />\n\t\t<?PHP\n\t\t}\n\t\t?>\n\t\t<br />\n\t\t<input type=\"hidden\" name=\"upload\" value=\"1\" />\n\t</p>\n</form>\n</div>\n\n<?PHP\n\t}// Ende: $flag_showformular\n\n// Auflistung der bereits hochgeladenen Dateien\nif($flag_showlist && (isset($_REQUEST['look']) && ($_REQUEST['look'] == \"list\" || $_REQUEST['look'] == \"both\" || empty($_REQUEST['look'])) || !isset($_REQUEST['look']))){\n\n\tif(isset($_REQUEST['dir']) && !empty($_REQUEST['dir']) && is_numeric($_REQUEST['dir'])) $where = \" AND dir = '\".$mysqli->escape_string($_REQUEST['dir']).\"' \";\n\telse{ $_REQUEST['dir'] = 0; $where = \" AND dir = '0' \"; }\n\t\n\t$sites = 0;\n\tif($userdata['dateimanager'] == 1) $query = \"SELECT * FROM \".$mysql_tables['files'].\" WHERE filetype='\".$mysqli->escape_string($_REQUEST['type']).\"' AND uid='\".$userdata['id'].\"'\".$where.\" ORDER BY utimestamp DESC,orgname,id\";\n\telseif($userdata['dateimanager'] == 2) $query = \"SELECT * FROM \".$mysql_tables['files'].\" WHERE filetype='\".$mysqli->escape_string($_REQUEST['type']).\"'\".$where.\" ORDER BY utimestamp DESC,orgname,id\";\n\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\n\n    if($_REQUEST['returnvalue'] == \"tinymce\" && $_REQUEST['type'] == \"pic\"){\n        echo \"<h2 style=\\\"clear: both;\\\">Bild ausw&auml;hlen</h2>\";\n        echo \"<p>Die Bildgr&ouml;&szlig;e kann nach dem Einf&uuml;gen durch einen Klick auf <img src=\\\"system/tiny_mce/plugins/filemanager/img/old_pics.gif\\\" alt=\\\"Bild bearbeiten\\\" title=\\\"Bild-Eigenschaften bearbeiten\\\" /> ge\u00f5ndert werden.</p>\";\n    }\n    elseif($_REQUEST['returnvalue'] == \"tinymce\" && $_REQUEST['type'] == \"file\")\n        echo \"<h2 style=\\\"clear: both;\\\">Datei ausw&auml;hlen</h2>\";\n?>\n<table border=\"0\" align=\"center\" width=\"95%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen trab\" style=\"margin-top: 10px;\">\n\n    <tr>\n\t\t<td style=\"width:70px;\" align=\"center\"><img src=\"images/icons/refresh.gif\" alt=\"Refresh-Icon\" title=\"Seite neu laden\" onclick=\"document.location.reload(true);\" /></td>\n        <td><b>Dateiname</b></td>\n\t\t<td style=\"width:80px;\" align=\"center\"><b>Gr\u00f7\u2580e</b></td>\n\t\t<td style=\"width:80px;\" align=\"center\"><b>Datum</b></td>\n    </tr>\n\t\n<?PHP\necho getFilelist($query,$filename,FALSE,TRUE,TRUE,FALSE,$_REQUEST['returnvalue']);\n\necho \"</table>\\n<br />\";\n\necho echopages($sites,\"80%\",\"site\",\"dir=\".$_REQUEST['dir']).\"<br />\";\n\t\n\t}// Ende: $flag_showlist\n\n}else echo \"<p class=\\\"meldung_error\\\">Fehler: Sie haben keine Berechtigung diesen Bereich zu betreten.</p>\";\n\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2010 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\t01ACP-Updates durchf\u0141hren\n\t#fv.1200#\n*/\n\n$menuecat = \"01acp_start\";\n$sitetitle = \"01ACP aktualisieren\";\n$filename = $_SERVER['SCRIPT_NAME'];\n$flag_acp = TRUE;\n$flag_nofunctions = TRUE;\n$flag_loginerror = FALSE;\n$flag_stopupdate = FALSE;\n$mootools_use = array(); \n\n// Dummy-Functions\nfunction create_ModulDropDown($para) { return \"\"; }\nfunction create_menue($para,$para2) { return \"\"; }\nfunction load_js_and_moo($mootools_use) { return \"\"; }\n\n// Config-Dateien\ninclude(\"system/headinclude.php\");\ninclude(\"system/head.php\");\n\n$xml = simplexml_load_file(\"_info.xml\",NULL,LIBXML_NOCDATA);\n?>\n<h1>ACP aktualisieren</h1>\n<?PHP\n// Update durchf\u0141hren\nif(isset($_POST['action']) && $_POST['action'] == \"update\" &&\n   isset($_POST['update']) && !empty($_POST['update']) &&\n   $xml->version > $settings['acpversion']){\n    $update_ok = TRUE;\n\tinclude_once(\"_up_data.php\");\n\t\n\techo \"<p class=\\\"meldung_error\\\"><b>Bitte l\u0172schen Sie die Datei _up_data.php von Ihrem Server!<br />\n\tLeeren Sie den Cache ihres Browsers und starten Sie ihn ggf. neu!</b></p>\";\n\techo \"<p class=\\\"meldung_erfolg\\\"><a href=\\\"index.php\\\">Weiter zum Administrationsbereich &raquo;</a></p>\";\n\t}\nelse{\n\tif($xml->version > $settings['acpversion']){\n\t\t$options = \"\";\n\t\tforeach($xml->updates as $updates){\n\t\t\tforeach($updates as $update){\n\t\t\t\tif($update->startv == $settings['acpversion'])\n\t\t\t\t\t$options .= \"<option value=\\\"\".$update->action.\"\\\">Version \".$update->startv.\" nach \".$update->zielv.\"</option>\\n\";\n\t\t\t\t}\n\t\t\t}\n\t\tif(empty($options) || !isset($options)){\n\t\t\t$options = \"<option value=\\\"0\\\">Es konnte keine passende Version gefunden werden</option>\";\n\t\t\t$flag_stopupdate = TRUE;\n\t\t\t}\n?>\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\">Bitte w&auml;hlen Sie das passende Update aus.</td>\n    </tr>\n\n\t<tr>\n\t\t<td class=\"trb\"><select name=\"update\" size=\"1\" class=\"input_select2\"><?PHP echo $options; ?></select></td>\n\t</tr>\n<?PHP if(!$flag_stopupdate){ ?>\n    <tr>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"update\" />\n\t\t\t<input type=\"submit\" value=\"Update starten &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n<?PHP } ?>\n</table>\n</form><br />\n<?PHP\n\t\t}\n\telse\n\t\techo \"<p class=\\\"meldung_hinweis\\\">Sie setzen bereits die aktuellste Version des 01ACP ein.</p>\";\n\t}\n\ninclude(\"system/foot.php\");\n?>", "<?PHP\n/* \n\t01ACP - Copyright 2008-2015 by Michael Lorer - 01-Scripts.de\n\tLizenz: Creative-Commons: Namensnennung-Keine kommerzielle Nutzung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland\n\tWeitere Lizenzinformationen unter: http://www.01-scripts.de/lizenz.php\n\t\n\tModul:\t\t01ACP\n\tDateiinfo:\tBenutzerverwaltung (Benutzer hinzuf\u00fcgen und bearbeiten; Eigenes Profil)\n\t#fv.131#\n*/\n\n$menuecat = \"01acp_users\";\n$sitetitle = \"Benutzerverwaltung\";\n$filename = $_SERVER['SCRIPT_NAME'];\n$mootools_use = array(\"moo_core\",\"moo_more\",\"moo_slidev\");\n\n// Config-Dateien\ninclude(\"system/main.php\");\ninclude(\"system/head.php\");\n\n// Sicherheitsabfrage: Login\nif(isset($userdata['id']) && $userdata['id'] > 0){\n\n\n\n// Neuen Benutzer hinzuf\u00fcgen\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_user\" && $userdata['userverwaltung'] >= 1){\n?>\n<h1>Neuen Benutzer erstellen</h1>\n\n<?PHP\n\t// Neuen Benutzer in Datenbank eintragen\n\tif(isset($_POST['send']) && $_POST['send'] == 1 &&\n\tisset($_POST['username']) && !empty($_POST['username']) &&\n\tisset($_POST['mail']) && !empty($_POST['mail']) && check_mail($_POST['mail']) &&\n\tisset($_POST['pwwahl']) && (($_POST['pwwahl'] == \"eigen\" && isset($_POST['password']) && !empty($_POST['password']) && strlen($_POST['password']) >= PW_LAENGE) || $_POST['pwwahl'] == \"random\") &&\n\tisset($_POST['level']) && $_POST['level'] <= $userdata['level']){\n\t\t// \u00dcberpr\u00fcfen ob E-Mail-Adresse oder Benutzername schon vorhanden ist\n\t\t$list = $mysqli->query(\"SELECT id FROM \".$mysql_tables['user'].\" WHERE username='\".$mysqli->escape_string($_POST['username']).\"' OR mail='\".$mysqli->escape_string($_POST['mail']).\"'\");\n\t\tif($list->num_rows < 1){\n\t\t\tif($_POST['pwwahl'] == \"random\"){\n\t\t        $password = create_NewPassword(8);\n\t\t        $passmd5 = pwhashing($password);\n\t\t\t\t}\n\t\t\telse{\n\t\t\t\t$password = $_POST['password'];\n\t\t\t\t$passmd5 = pwhashing($_POST['password']);\n\t\t\t\t}\n\t\t\t\n\t\t\t// Eintrag in DB vornehmen\n\t\t\t$sql_insert = \"INSERT INTO \".$mysql_tables['user'].\" (username,mail,userpassword,level) VALUES (\n\t\t\t\t\t\t\t'\".$mysqli->escape_string(trim($_POST['username'])).\"',\n\t\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['mail']).\"',\n\t\t\t\t\t\t\t'\".$passmd5.\"',\n\t\t\t\t\t\t\t'\".$mysqli->escape_string($_POST['level']).\"'\n\t\t\t\t\t\t\t)\";\n            $result = $mysqli->query($sql_insert) OR die($mysqli->error);\n\t\t\t$lastinsertid = $mysqli->insert_id;\n\t\t\t\n\t\t\tif($lastinsertid > 0){\n\t\t\t\t// Passwort mit richtigem Passwort aus pwhasing2-Funkion ersetzen\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET userpassword = '\".pwhashing2($password, $lastinsertid).\"' WHERE id='\".$lastinsertid.\"' LIMIT 1\");\n\n\t\t\t\t// ggf. E-Mail @ Benutzer versenden\n\t\t\t\tif($_POST['pwwahl'] == \"random\" || isset($_POST['emailinfo']) && $_POST['emailinfo'] == 1){\n\t\t\t\t\t$header = \"From:\".$settings['email_absender'].\"<\".$settings['email_absender'].\">\\n\";\n\t\t\t        $email_betreff = $settings['sitename'].\" - Ein Benutzerkonto wurde f\u00fcr Sie angelegt\";\n\t\t\t        $emailbody = $settings['sitename'].\"\\n\\nF\u00fcr Sie wurde ein neues Benutzerkonto angelegt. Sie k\u00f6nnen sich unter\\n\".$settings['absolut_url'].\"01acp/\\nmit folgenden Zugangsdaten einloggen:\\n\\nBenutzername: \".$_POST['username'].\"\\nPasswort: \".$password.\"\\n\\n---\\nWebmailer\";\n\n\t\t\t        if(!mail(stripslashes($_POST['mail']),$email_betreff,$emailbody,$header)){\n\t\t\t\t\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Es konnte keine E-Mail an den neuen Benutzer versand werden.</p>\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} \n\n\t\t\t\tif($userdata['userverwaltung'] == 2){\n\t\t\t\t\techo \"<script>redirect(\\\"\".$filename.\"?action=edit_user&userid=\".$lastinsertid.\"\\\");</script>\";\n\t\t\t\t\techo \"<p class=\\\"meldung_ok\\\">Der Benutzer <b>\".$_POST['username'].\"</b> wurde erfolgreich erstellt.<br />\n\t\t\t\t\t\tSie werden zur Konfiguration der Benutzerrechte weitergeleitet. Sollten Sie nicht weitergeleitet werden, klicken Sie\n\t\t\t\t\t\tbitte <a href=\\\"\".$filename.\"?action=edit_user&amp;userid=\".$lastinsertid.\"\\\">hier</a>.</p>\";\n\t\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\techo \"<p class=\\\"meldung_ok\\\">Der Benutzer <b>\".$_POST['username'].\"</b> wurde erfolgreich erstellt.</p>\";\n\t\t\t\n\t\t\t\t}\n\t\t\t// Fehler: Beim Eintragen trat ein Fehler auf\n\t\t\telse{\n\t\t\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Es konnte kein neuer Benutzer erstellt werden.<br />\n\t\t\t\t\t\tBeim Eintragen in die Datenbank trat ein unvorhergesehener Fehler auf. Bitte beachten Sie\n\t\t\t\t\t\tdie MySQL-Fehlermeldung und setzen sich mit einem technischen Ansprechpartner in Verbindung.</p>\";\n\t\t\t\t}\n\t\t}\n\t\t// Fehler: Benutzername oder E-Mail existieren schon in der DB\n\t\telse{\n\t\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Der neue Benutzer konnte nicht erstellt werden. Ein Benutzer mit diesem\n\t\t\t\t\tBenutzernamen oder dieser E-Mail-Adresse existiert bereits.<br />\n\t\t\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a> und &auml;ndern Sie Ihre Eingaben entsprechend ab.</p>\";\n\t\t}\n\t}\n\t// Fehler: Nicht alle Felder ausgef\u00fcllt oder PW zu kurz\n\telseif(isset($_POST['send']) && $_POST['send'] == 1){\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Der neue Benutzer konnte nicht erstellt werden. Sie haben nicht\n\t\t\t\talle Felder komplett ausgef&uuml;llt oder das von Ihnen eingegebene Passwort ist zu kurz (mind. \".PW_LAENGE.\" Zeichen).<br />\n\t\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a> und &auml;ndern Sie Ihre Eingaben entsprechend ab.</p>\";\n\t\t}\n\telse{\n?>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"post\">\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n\n    <tr>\n        <td class=\"tra\" width=\"30%\"><b>Benutzername*</b></td>\n        <td class=\"tra\"><input type=\"text\" name=\"username\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\n\t\n    <tr>\n        <td class=\"trb\"><b>E-Mail-Adresse*</b></td>\n        <td class=\"trb\"><input type=\"text\" name=\"mail\" size=\"50\" maxlength=\"50\" /></td>\n    </tr>\t\n\t\n    <tr>\n        <td class=\"tra\"><b>Passwort*</b></td>\n        <td class=\"tra\">\n\t\t\t<input type=\"radio\" name=\"pwwahl\" value=\"random\" checked=\"checked\" /> Zuf&auml;lliges Passwort generieren <span class=\"small\">(Wird per E-Mail an den Benutzer verschickt)</span><br />\n\t\t\t<input type=\"radio\" name=\"pwwahl\" value=\"eigen\" /> Passwort manuell festlegen: <input type=\"text\" name=\"password\" size=\"20\" /> <span class=\"small\"><b>Mindestens <?PHP echo PW_LAENGE; ?> Zeichen</b></span>\n\t\t</td>\n    </tr>\n\n    <tr>\n        <td class=\"trb\"><b>Sicherheitsstufe*</b></td>\n        <td class=\"trb\">\n\t\t\t<select name=\"level\" size=\"1\">\n\t\t\t\t<?PHP\n\t\t\t\tfor($x=1;$x<=$userdata['level'];$x++){\n\t\t\t\t\techo \"<option value=\\\"\".$x.\"\\\">Sicherheitsstufe \".$x.\"</option>\\n\";\n\t\t\t\t\t}\n\t\t\t\t?>\n\t\t\t</select> <b>[ <a href=\"javascript:hide_unhide('help_level');\">?</a> ]</b>\n\t\t</td>\n    </tr>\n\n    <tr>\n        <td class=\"tra\"><b>E-Mail an Benutzer senden</b></td>\n        <td class=\"tra\">\n\t\t\t<input type=\"checkbox\" name=\"emailinfo\" value=\"1\" checked=\"checked\" /> Der neue Benutzer wird mit einer E-Mail &uuml;ber das f&uuml;r ihn eingerichtete Benutzerkonto informiert.\n\t\t</td>\n    </tr>\n\t\n    <tr>\n        <td class=\"tra\"><input type=\"reset\" value=\"Felder zur&uuml;cksetzen\" class=\"input\" /></td>\n        <td class=\"tra\">\n\t\t\t<input type=\"hidden\" name=\"action\" value=\"add_user\" />\n\t\t\t<input type=\"hidden\" name=\"send\" value=\"1\" />\n\t\t\t<input type=\"submit\" value=\"Benutzer erstellen &raquo;\" class=\"input\" />\n\t\t</td>\n    </tr>\n\n</table>\n</form>\n\n<div class=\"meldung_hinweis\" id=\"help_level\" style=\"display:none;\">\n\tBenutzer mit einer niedrigeren Sicherheitsstufe k&ouml;nnen Benutzer mit h&ouml;heren Sicherheitsstufe nicht bearbeiten oder l&ouml;schen.<br />\n\t<br />\n\tBeispiel:<br />\n\tEinem Benutzer mit Sicherheitsstufe 2 ist es nicht gestattet einen Benutzer mit Sicherheitsstufe 3 (oder h&ouml;her) anzulegen oder zu bearbeiten.\n</div>\n\n<?PHP\n\t\t} // else: Formular anzeigen\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"add_user\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n\n// Durchf\u00fchren: Benutzer l\u00f6schen\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"do_del\" && $userdata['userverwaltung'] == 2 && isset($_GET['userid']) && !empty($_GET['userid']) && is_numeric($_GET['userid'])){\n\t$error = 0;\n\t\n\tif($_GET['userid'] == $userdata['id']) $error = 1;\n\telse{\n\t\t$list = $mysqli->query(\"SELECT id,username,mail,level FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($_GET['userid']).\"' AND id != '0' LIMIT 1\");\n\t\twhile($row = $list->fetch_assoc()){\n\t\t\t$u_id = $row['id'];\n\t\t\t$u_username = stripslashes($row['username']);\n\t\t\t$u_mail = stripslashes($row['mail']);\n\t\t\t$u_level = $row['level'];\n\t\t\t}\n\t\tif($u_level >= $userdata['level']) $error = 2;\n\t\t}\n\t\n\t// Ist ein Fehler aufgetreten?\n\tif($error == 0){\n\t\t// Normale weitere Programmausf\u00fchrung\n\t\t$mysqli->query(\"DELETE FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($u_id).\"' AND id != '0' LIMIT 1\");\n\t\t\n\t\t$mysqli->query(\"UPDATE \".$mysql_tables['files'].\" SET uid='0' WHERE uid='\".$mysqli->escape_string($u_id).\"'\");\n\t\t\n\t\t/*An dieser Stelle alle Modulspezifischen zur Verf\u00fcgung gestellten L\u00f6sch-Funktionen ausf\u00fchren\n\t\tSchema der Funktionsnamen: modulname_DeleteUser()\n\t\t\u00dcbergebene Parameter: Userid, Username, E-Mail-Adresse\n\t\tErwarteter R\u00fcckgabewert: TRUE / FALSE\n\t\t*/\n\n\t\tforeach($module as $modul_akt){\n\t\t\t$modul = $modul_akt['idname'];\n\t\t\t\n\t\t\tif(file_exists($moduldir.$modul_akt['idname'].\"/_headinclude.php\"))\n\t\t\t\tinclude_once($moduldir.$modul_akt['idname'].\"/_headinclude.php\");\n\t\t\tif(file_exists($moduldir.$modul_akt['idname'].\"/_functions.php\"))\n\t\t\t\tinclude_once($moduldir.$modul_akt['idname'].\"/_functions.php\");\n\t\t\tif(function_exists(\"_\".$modul_akt['modulname'].\"_DeleteUser\"))\n\t\t\t\tcall_user_func(\"_\".$modul_akt['modulname'].\"_DeleteUser\",$u_id,$u_username,$u_mail);\n\t\t\t\n\t\t\tunset($modul);\n\t\t\t}\n\t\t\n\t\techo \"<p class=\\\"meldung_ok\\\">Der Benutzer <i>\".$u_username.\"</i> wurde aus dem System gel&ouml;scht.</p>\";\n\t\t}\n\telseif($error == 1)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie k&ouml;nnen nicht Ihr eigenes Benutzerkonto l&ouml;schen!</p>\";\n\telseif($error == 2)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie k&ouml;nnen keinen Benutzer l&ouml;schen, der das gleiche oder ein h&ouml;heres Sicherheitslevel hat!</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Es trat ein unvorhergesehener Fehler auf.</p>\";\n\n\t// Variablen so setzen, dass Benutzer Auflistung erfolgt:\n\t$_REQUEST['action'] = \"edit_users\";\n\t$_GET['userid'] = \"\";\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"do_del\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n// Werte von Benutzer bearbeiten / Profil speichern\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"do_edit\" && $userdata['userverwaltung'] == 2 ||\n\tisset($_REQUEST['action']) && $_REQUEST['action'] == \"save_profile\" && $userdata['profil'] == 1){\n\t$error = 0;\n\tswitch($_REQUEST['action']){\n\t  case \"do_edit\":\n\t    // Weitere \u00dcberpr\u00fcfungen der \u00fcbergebenen Variablen\n\t\tif(!isset($_REQUEST['userid']) || isset($_REQUEST['userid']) && empty($_REQUEST['userid']))\n\t\t\t$error = 1;\n\t\telse{\n\t\t\t$list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($_REQUEST['userid']).\"' AND id != '0' AND (level < '\".$mysqli->escape_string($userdata['level']).\"' OR level = '10' AND level = '\".$mysqli->escape_string($userdata['level']).\"' OR id = '\".$mysqli->escape_string($userdata['id']).\"') LIMIT 1\");\n\t\t\tif($list->num_rows < 1) $error = 2;\n\t\t}\n\t\t\t\n\t\t$title = \"Benutzer bearbeiten\";\n\t\t$case = \"do_edit\";\n\t  break;\n\t  case \"save_profile\":\n\t    $list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['user'].\" WHERE id='\".$userdata['id'].\"' LIMIT 1\");\n\t\t\n\t\t$title = \"Eigenes Profil\";\n\t\t$case = \"profil\";\n\t  break;\n\t  }\n\t\n\t// Ist ein Fehler aufgetreten?\n\tif($error == 0){\n\t\t// Normale weitere Programmausf\u00fchrung\n\t\tswitch($case){\n\t\t  case \"do_edit\":\n\t\t    if(isset($_POST['username']) && !empty($_POST['username']) && \n\t\t\t\tisset($_POST['mail']) && !empty($_POST['mail']) && check_mail($_POST['mail']) &&\n\t\t\t\tisset($_POST['level']) && !empty($_POST['level']) && $_POST['level'] <= $userdata['level']){\n\t\t\t\t\n\t\t\t\tif(isset($_POST['sperre']) && $_POST['sperre'] != 1 || !isset($_POST['sperre'])) $_POST['sperre'] = 0;\n\t\t\t\t\n\t\t\t\t// \u00dcberpr\u00fcfen ob E-Mail-Adresse oder Benutzername schon vorhanden ist\n\t\t\t\t$list = $mysqli->query(\"SELECT id FROM \".$mysql_tables['user'].\" WHERE username='\".CleanStr($_POST['username']).\"' LIMIT 1\");\n\t\t\t\t$row_u\t\t= $list->fetch_assoc();\n\t\t\t\t$menge_u\t= $list->num_rows;\n\t\t\t\t$list = $mysqli->query(\"SELECT id FROM \".$mysql_tables['user'].\" WHERE mail='\".$mysqli->escape_string($_POST['mail']).\"' LIMIT 1\");\n\t\t\t\t$row_m\t\t= $list->fetch_assoc();\n\t\t\t\t$menge_m\t= $list->num_rows;\n\t\t\t\t\n\t\t\t\t$add2query = \"\";\n\t\t\t\t// Level can only be chaned for other users\n\t\t\t\tif($_POST['userid'] != $userdata['id'])\n\t\t\t\t\t$add2query .= \"level='\".$mysqli->escape_string(intval($_POST['level'])).\"', \";\n\t\t\t\t// Only changed username if it is unique\n\t\t\t\tif($menge_u < 1)\n\t\t\t\t    $add2query .= \"username='\".CleanStr($_POST['username']).\"', \";\n\t\t\t\telseif($row_u['id'] != $_POST['userid'])\n\t\t\t\t\techo \"<p class=\\\"meldung_error\\\">Der <b>Benutzername</b> wurde nicht ge&auml;ndert, da bereits ein Benutzerkonto mit diesem Namen existiert.</p>\";\n\t\t\t\t// Only changed mail if it is unique\n\t\t\t\tif($menge_m < 1)\n\t\t\t\t    $add2query .= \"mail='\".$mysqli->escape_string($_POST['mail']).\"', \";\n\t\t\t\telseif($row_m['id'] != $_POST['userid'])\n\t\t\t\t\techo \"<p class=\\\"meldung_error\\\">Die <b>E-Mail-Adresse</b> wurde nicht ge&auml;ndert, da bereits ein Benutzerkonto mit dieser Adresse existiert.</p>\";\n\t\t\t\t\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET \".$add2query.\"sperre='\".$mysqli->escape_string($_POST['sperre']).\"' WHERE id='\".$mysqli->escape_string($_POST['userid']).\"' AND id != '0' LIMIT 1\");\n\n\t\t\t\t// Passwort \u00e4ndern?\n\t\t\t\tif(isset($_POST['changepw']) && $_POST['changepw'] == 1){\n\t\t\t\t\t$pwerror = true;\n\t\t\t\t\tif(isset($_POST['pwwahl']) && $_POST['pwwahl'] == \"eigen\" && \n\t\t\t\t\t\tisset($_POST['password']) && !empty($_POST['password']) && \n\t\t\t\t\t\tstrlen($_POST['password']) >= PW_LAENGE){\n\t\t\t\t\t\t\n\t\t\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET userpassword='\".pwhashing2($_POST['password'], $_POST['userid']).\"', cookiehash='' WHERE id='\".$mysqli->escape_string($_POST['userid']).\"' AND id != '0' LIMIT 1\");\n\t\t\t\t\t\t$pwerror = false;\n\t\t\t\t\t}\n\t\t\t\t\telseif(isset($_POST['pwwahl']) && $_POST['pwwahl'] == \"random\" ||\n\t\t\t\t\t\tisset($_POST['pwwahl']) && $_POST['pwwahl'] == \"eigen\" && empty($_POST['password'])){\n\t\t\t\t\t\n\t\t\t\t\t\t$newpass = create_NewPassword(PW_LAENGE);\n\t\t\t\t        $newpassHash = pwhashing2($newpass, $_POST['userid']);\n\n\t\t\t\t        // Datenbank aktualisieren:\n\t\t\t\t        $mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET userpassword='\".$newpassHash.\"', cookiehash='' WHERE id='\".$mysqli->escape_string($_POST['userid']).\"' AND id != '0' LIMIT 1\");\n\n\t\t\t\t        $header = \"From:\".$settings['email_absender'].\"<\".$settings['email_absender'].\">\\n\";\n\t\t\t\t        $email_betreff = $settings['sitename'].\" - Neues Passwort f\u00fcr Administrationsbereich\";\n\t\t\t\t        $emailbody = \"Mit dieser E-Mail erhalten Sie ein neues Passwort f\u00fcr den Adminbereich\\n\\nName: \".CleanStr($_POST['username']).\"\\nE-Mail-Adresse: \".$_POST['mail'].\"\\nNeues Passwort: \".$newpass.\"\\n\\n---\\nWebmailer\";\n\t\t\t\t\t\t$emailbody = preg_replace( \"/(content-type:|bcc:|cc:|to:|from:)/im\", \"\",$emailbody);\n\n\t\t\t\t\t\t$empf = preg_replace( \"/[^a-z0-9 !?:;,.\\/_\\-=+@#$&\\*\\(\\)]/im\", \"\",$_POST['mail']);\n\t\t\t\t\t\t$empf = preg_replace( \"/(content-type:|bcc:|cc:|to:|from:)/im\", \"\",$empf);\n\t\t\t\t        mail($empf,$email_betreff,$emailbody,$header);\n\t\t\t\t        $pwerror = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$savequery = \"\";\n\t\t\t\t// F\u00fcr Benutzer mit Level < 10 nur Einstellungen speichern auf die der User auch Zugriff hat. Function-Felder werden nicht gespeichert\n\t\t\t\tif($_POST['userid'] != $userdata['id'] && $userdata['level'] < 10){\n\t\t\t\t\t$query = \"SELECT id,modul,idname,formename FROM \".$mysql_tables['rights'].\" WHERE formename != 'function' AND is_cat='0' AND hide='0'\";\n\t\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\t\twhile($row_save = $list->fetch_assoc()){\n\t\t\t\t\t\t// Nur Einstellungen mit Berechtigungen des Users speichern\n\t\t\t\t\t\tif(!isset($userdata[str_replace(\"01acp_\",\"\",$row_save['modul'].\"_\".$row_save['idname'])]) || $userdata[str_replace(\"01acp_\",\"\",$row_save['modul'].\"_\".$row_save['idname'])] == 0) continue;\n\n\t\t\t\t\t\tif(isset($_POST[$row_save['modul'].\"_\".$row_save['idname']]) && $_POST[$row_save['modul'].\"_\".$row_save['idname']] <= $userdata[str_replace(\"01acp_\",\"\",$row_save['modul'].\"_\".$row_save['idname'])])\n\t\t\t\t\t\t\t$savequery .= $row_save['modul'].\"_\".$row_save['idname'].\"='\".$mysqli->escape_string($_POST[$row_save['modul'].\"_\".$row_save['idname']]).\"', \";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// F\u00fcr Administratoren alle Felder speichern\n\t\t\t\telseif($userdata['level'] == 10){\n\t\t\t\t\t$query = \"SELECT id,modul,idname,formename FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND hide='0'\";\n\t\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\t\twhile($row_save = $list->fetch_assoc()){\n\t\t\t\t\t\tif($row_save['formename'] == \"function\" && isset($_POST[$row_save['modul'].\"_\".$row_save['idname']]))\n\t\t\t\t\t\t\t$savequery .= $row_save['modul'].\"_\".$row_save['idname'].\"='\".mysql_real_escape_string(call_RightSettingsFunction_Write($row_save['modul'],$row_save['idname'],$_POST[$row_save['modul'].\"_\".$row_save['idname']])).\"', \";\n\t\t\t\t\t\telseif(isset($_POST[$row_save['modul'].\"_\".$row_save['idname']]))\n\t\t\t\t\t\t\t$savequery .= $row_save['modul'].\"_\".$row_save['idname'].\"='\".$mysqli->escape_string($_POST[$row_save['modul'].\"_\".$row_save['idname']]).\"', \";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(isset($savequery) && !empty($savequery))\n\t\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET \".substr($savequery,0,strlen($savequery)-2).\" WHERE id='\".$mysqli->escape_string($_POST['userid']).\"' AND id != '0' LIMIT 1\");\n\t\t\t\t\n\t\t\t\techo \"<p class=\\\"meldung_ok\\\">Benutzerdaten wurden gespeichert.<br />\n\t\t\t\t\t<a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_user','userid'=>$_POST['userid'])).\"\\\">Benutzer erneut bearbeiten &raquo;</a></p>\";\n\t\t\t\t\n\t\t\t\tif(isset($pwerror) && $pwerror)\n\t\t\t\t    echo \"<p class=\\\"meldung_error\\\">Das Passwort wurde <b>nicht</b> ge&auml;ndert.<br />\n\t\t\t\t\t\t\tBitte geben Sie ein Passwort mit mindestens \".PW_LAENGE.\" Zeichen ein!</p>\";\n\t\t\t\t}\n\t\t\telse\n\t\t\t\techo \"<p class=\\\"meldung_error\\\">Sie haben keine Berechtigung diesen Benutzer zu bearbeiten.<br />\n\t\t\t\tOder Sie haben keinen Benutzernamen bzw. eine Nicht-valide E-Mail-Adresse eingegeben.<br />\n\t\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\n\t\t  $_REQUEST['action'] = \"edit_users\";\n\t\t  $_REQUEST['userid'] = \"\";\n\n\t\t  break;\n\t\t  case \"profil\":\n\t\t\tif(isset($_POST['mail']) && !empty($_POST['mail']) && check_mail($_POST['mail'])){\n\t\t\t\t// \u00dcberpr\u00fcfen ob E-Mail-Adresse schon vorhanden ist\n\t\t\t\t$list = $mysqli->query(\"SELECT id FROM \".$mysql_tables['user'].\" WHERE mail='\".$mysqli->escape_string($_POST['mail']).\"'\");\n\n\t\t\t\t$add2query = \"\";\n\t\t\t\tif($list->num_rows < 1)\n\t\t\t\t    $add2query .= \"mail='\".$mysqli->escape_string($_POST['mail']).\"', \";\n\t\t\t\telseif($userdata['mail'] != $_POST['mail']){\n\t\t\t\t\t$save_error = true;\n\t\t\t\t\techo \"<p class=\\\"meldung_error\\\">Die <b>E-Mail-Adresse</b> wurde nicht ge&auml;ndert, da bereits ein Benutzerkonto mit dieser Adresse existiert.</p>\";\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET \".$add2query.\"startpage='\".$mysqli->escape_string($_POST['startpage']).\"' WHERE id='\".$mysqli->escape_string($userdata['id']).\"' AND id != '0' LIMIT 1\");\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t$query = \"SELECT * FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND hide='0' AND in_profile='1' ORDER BY catid,sortid\";\n\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\t$savequery = \"\";\n\t\t\t\twhile($row_save = $list->fetch_assoc()){\n\t\t\t\t\tif(isset($_POST[$row_save['modul'].\"_\".$row_save['idname']]))\n\t\t\t\t\t\t$savequery .= $row_save['modul'].\"_\".$row_save['idname'].\"='\".$mysqli->escape_string($_POST[$row_save['modul'].\"_\".$row_save['idname']]).\"', \";\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t$mysqli->query(\"UPDATE \".$mysql_tables['user'].\" SET \".substr($savequery,0,strlen($savequery)-2).\" WHERE id='\".$mysqli->escape_string($userdata['id']).\"' AND id != '0' LIMIT 1\");\n\t\t\t\t\n\t\t\t\techo \"<p class=\\\"meldung_ok\\\">Daten wurden gespeichert.<br />\n\t\t\t\t\t<a href=\\\"users.php?action=profil\\\">Weiter &raquo;</a></p>\";\n\t\t\t\tif(!isset($save_error))\n\t\t\t\t\techo \"<script>redirect(\\\"users.php?action=profil&show=saved\\\");</script>\";\n\t\t\t\t}\n\t\t\telse{\n\t\t\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie haben keine oder eine fehlerhafte E-Mail-Adresse\n\t\t\t\teingegeben. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\t\t\t\t}\n\t\t  break;\n\t\t  }\n\t\t\n\t\t}\n\telseif($error == 1)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Die &uuml;bergebene Benutzer-ID ist leider fehlerhaft &amp; in dieser\n\t\t\tForm nicht g&uuml;ltig. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\telseif($error == 2)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Zur &uuml;bergebene Benutzer-ID konnte leider kein passender\n\t\t\tEintrag in der Datenbank gefunden werden, <b>oder Sie haben keine Berechtigung um diesen Benutzer zu bearbeiten</b>.\n\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Es trat ein unvorhergesehener Fehler auf. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"do_edit\" || \n\t\tisset($_REQUEST['action']) && $_REQUEST['action'] == \"save_profile\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n\n// Benutzer auflisten\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_users\" && $userdata['userverwaltung'] == 2){\n?>\n<h1>Benutzer bearbeiten</h1>\n\n<form action=\"<?PHP echo $filename; ?>\" method=\"get\">\n\t<p>\n\t<a href=\"users.php?action=add_user\" class=\"actionbutton\"><img src=\"images/icons/add.gif\" alt=\"Plus-Zeichen\" title=\"Neuen Benutzer erstellen\" style=\"border:0; margin-right:10px;\" />Neuen Benutzer erstellen</a>\n\t<input type=\"text\" name=\"search\" value=\"Nach Benutzername oder E-Mail\" size=\"30\" onfocus=\"clearField(this);\" onblur=\"checkField(this);\" class=\"input_search\" /> <input type=\"submit\" value=\"Benutzer suchen\" class=\"input\" /></p>\n\t<input type=\"hidden\" name=\"action\" value=\"edit_users\" />\n</form>\n\n<?PHP\n\tif(isset($_GET['sort']) && $_GET['sort'] == \"desc\") $sortorder = \"DESC\";\n\telse{ $sortorder = \"ASC\"; $_GET['sort'] = \"ASC\"; }\n\t\n\tif(isset($_GET['search']) && !empty($_GET['search'])) $where = \" WHERE (username LIKE '%\".$mysqli->escape_string($_GET['search']).\"%' OR mail LIKE '%\".$mysqli->escape_string($_GET['search']).\"%') AND id != '0'\";\n\telse{ $where = \" WHERE id != '0'\"; $_GET['search'] = \"\"; }\n\t\n\tif(!isset($_GET['orderby'])) $_GET['orderby'] = \"\";\n\tswitch($_GET['orderby']){\n\t  case \"sperre\":\n\t    $orderby = \"sperre,username\";\n\t  break;\n\t  case \"username\":\n\t    $orderby = \"username\";\n\t  break;\n\t  case \"mail\":\n\t    $orderby = \"mail\";\n\t  break;\n\t  case \"level\":\n\t    $orderby = \"level \".$sortorder.\", username\";\n\t  break;\n\t  case \"lastlogin\":\n\t    $orderby = \"lastlogin,username\";\n\t  break;\t  \n\t  default:\n\t    $orderby = \"username\";\n\t  break;\n\t  }\n\n\t$sites = 0;\n\t$query = \"SELECT * FROM \".$mysql_tables['user'].\"\".$where.\" ORDER BY \".$orderby.\" \".$sortorder;\n\t$query = makepages($query,$sites,\"site\",ACP_PER_PAGE);\n\n\t// Fehlermeldung bei erfolgloser Suche\n\tif($sites == 0 && isset($_GET['search']) && !empty($_GET['search']))\n\t\techo \"<p class=\\\"meldung_error\\\">Es konnte leider kein Benutzer zu Ihrer Sucheingabe \\\"\".stripslashes($_GET['search']).\"\\\" gefunden werden!<br />\n\t\t\tBitte probieren Sie es erneut.</p>\";\n\n?>\n<table border=\"0\" align=\"center\" width=\"100%\" cellpadding=\"3\" cellspacing=\"5\" class=\"rundrahmen\">\n    <tr>\n\t\t<td class=\"tra\" width=\"25\" align=\"center\"><a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'sperre')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren (ASC)\" /></a><!--Benutzer ist gesperrt--></td>\n        <td class=\"tra\"><b>Benutzername</b>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'username')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'desc','orderby'=>'username')); ?>\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td class=\"tra\"><b>E-Mail-Adresse</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'mail')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'desc','orderby'=>'mail')); ?>\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td class=\"tra\" width=\"130\"><b>Sicherheitsstufe</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'level')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'desc','orderby'=>'level')); ?>\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td class=\"tra\" width=\"145\"><b>Letzte Anmeldung</b>\t\t\t\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'asc','orderby'=>'lastlogin')); ?>\"><img src=\"images/icons/sort_asc.gif\" alt=\"Icon: Pfeil nach oben\" title=\"Aufsteigend sortieren\" /></a>\n\t\t\t<a href=\"<?PHP echo BuildURL($filename,NULL,array('sort'=>'desc','orderby'=>'lastlogin')); ?>\"><img src=\"images/icons/sort_desc.gif\" alt=\"Icon: Pfeil nach unten\" title=\"Absteigend sortieren (DESC)\" /></a>\n\t\t</td>\n\t\t<td class=\"tra nosort\" width=\"25\">&nbsp;<!--Bearbeiten--></td>\n\t\t<td class=\"tra nosort\" width=\"25\" align=\"center\"><!--L\u00f6schen--><img src=\"images/icons/icon_trash.gif\" alt=\"M&uuml;lleimer\" title=\"Datei l&ouml;schen\" /></td>\n    </tr>\n<?PHP\n\t// Ausgabe der Datens\u00e4tze (Liste) aus DB\n\t$count = 0;\n\t$list = $mysqli->query($query);\n\twhile($row = $list->fetch_assoc()){\n\t\t// Zusatzinformationen/Statistiken \u00fcber Benutzer zusammentragen\n\t\t$userstats = getUserstats($row['id']);\n\n\t\tif(is_array($module)){\n\t\t\tforeach($module as $modul_akt){\n\t\t\t\t$modul = $modul_akt['idname'];\n\t\t\t\t\n\t\t\t\tif(file_exists($moduldir.$modul_akt['idname'].\"/_headinclude.php\"))\n\t\t\t\t\tinclude_once($moduldir.$modul_akt['idname'].\"/_headinclude.php\");\n\t\t\t\tif(file_exists($moduldir.$modul_akt['idname'].\"/_functions.php\"))\n\t\t\t\t\tinclude_once($moduldir.$modul_akt['idname'].\"/_functions.php\");\n\t\t\t\tif(function_exists(\"_\".$modul_akt['modulname'].\"_getUserstats\"))\n\t\t\t\t\t$addstats = call_user_func(\"_\".$modul_akt['modulname'].\"_getUserstats\",$row['id']);\n\t\t\t\t\n\t\t\t\tif(isset($addstats) && is_array($addstats))\n\t\t\t\t\t$userstats = array_merge($userstats,$addstats);\n\t\t\t\t\n\t\t\t\tunset($modul);\n\t\t\t\tunset($addstats);\n\t\t\t\t}\n\t\t\t}\n\n\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\n\t\tif($row['sperre'] == 1){\n\t\t\t$sperricon = \"<img src=\\\"images/icons/icon_gesperrt.gif\\\" alt=\\\"Icon: Schlo&szlig;\\\" title=\\\"Benutzer ist gesperrt\\\" />\";\n\t\t\t$class = \"tr_red\";\n\t\t\t}\n\t\telse $sperricon = \"\";\n\t\t\n\t\tif($row['lastlogin'] > 0) $lastlogin = date(\"d.m.Y\",$row['lastlogin']);\n\t\telse $lastlogin = \"-\";\n\t\t\n\t\techo \"    <tr>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$sperricon.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" onclick=\\\"hide_unhide_tr('id\".$row['id'].\"');\\\" style=\\\"cursor: pointer;\\\">\".stripslashes($row['username']).\"</td>\n\t\t<td class=\\\"\".$class.\"\\\"><a href=\\\"mailto:\".stripslashes($row['mail']).\"\\\">\".stripslashes($row['mail']).\"</a></td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$row['level'].\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\">\".$lastlogin.\"</td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\"><a href=\\\"\".BuildURL($filename,NULL,array('action'=>'edit_user','userid'=>$row['id'])).\"\\\"><img src=\\\"images/icons/icon_edit.gif\\\" alt=\\\"Bearbeiten - Stift\\\" title=\\\"Benutzer bearbeiten\\\" style=\\\"border:0;\\\" /></a></td>\n\t\t<td class=\\\"\".$class.\"\\\" align=\\\"center\\\"><a href=\\\"\".BuildURL($filename,NULL,array('action'=>'ask_del','userid'=>$row['id'])).\"\\\"><img src=\\\"images/icons/icon_delete.gif\\\" alt=\\\"L&ouml;schen - rotes X\\\" title=\\\"Benutzer l&ouml;schen\\\" style=\\\"border:0;\\\" /></a></td>\n\t</tr>\";\n\t\techo \"<tr id=\\\"id\".$row['id'].\"\\\" style=\\\"display:none;\\\">\n\t\t<td class=\\\"\".$class.\"\\\" colspan=\\\"7\\\">\";\n\t\tforeach($userstats as $data){\n\t\t\techo \"<b>\".$data['statcat'].\"</b> \".$data['statvalue'].\"<br />\\n\";\n\t\t\t}\n\t\techo \"\\n\t\t</td>\n\t</tr>\";\n\t\t}\n\t\n\techo \"</table>\";\n\n\techo echopages($sites,\"80%\",\"site\",\"action=edit_users&amp;search=\".$_GET['search'].\"&amp;sort=\".$_GET['sort'].\"&amp;orderby=\".$_GET['orderby'].\"\");\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_users\" && $userdata['userverwaltung'] == 1){\n\t\techo \"<h1>Benutzer erstellen</h1>\";\n\t\techo \"<p><a href=\\\"users.php?action=add_user\\\" class=\\\"actionbutton\\\"><img src=\\\"images/icons/add.gif\\\" alt=\\\"Plus-Zeichen\\\" title=\\\"Neuen Benutzer erstellen\\\" style=\\\"border:0; margin-right:10px;\\\" />Neuen Benutzer erstellen</a></p>\";\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_users\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n\n// Abfrage: Benutzer l\u00f6schen\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"ask_del\" && $userdata['userverwaltung'] == 2){\n\t$error = 0;\n\t\n\tif($_GET['userid'] == $userdata['id']) $error = 1;\n\telse{\n\t\t$list = $mysqli->query(\"SELECT username,level FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($_GET['userid']).\"' AND id != '0' LIMIT 1\");\n\t\twhile($row = $list->fetch_assoc()){\n\t\t\t$u_username = $row['username'];\n\t\t\t$u_level = $row['level'];\n\t\t\t}\n\t\tif($u_level >= $userdata['level']) $error = 2;\n\t\t}\n\n\t// Ist ein Fehler aufgetreten?\n\tif($error == 0){\n\t\t// Normale weitere Programmausf\u00fchrung\n\t\techo \"<p class=\\\"meldung_frage\\\">M&ouml;chten Sie den Benutzer <i>\".$u_username.\"</i> wirklich l&ouml;schen?<br />\n\t\t\tVom Benutzer erstellte Beitr&auml;ge und hochgeladene Dateien etc. bleiben davon unber&uuml;hrt.<br />\n\t\t\t<b><a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'do_del','userid'=>$_GET['userid'])).\"\\\">JA</a> | \n\t\t\t<a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_users','userid'=>'')).\"\\\">NEIN</a></b></p>\";\n\t\t}\n\telseif($error == 1)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie k&ouml;nnen nicht Ihr eigenes Benutzerkonto l&ouml;schen!<br />\n\t\t\t<a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_users','userid'=>'')).\"\\\">Zur&uuml;ck</a>.</p>\";\n\telseif($error == 2)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Sie k&ouml;nnen keinen Benutzer l&ouml;schen, der das gleiche oder ein h&ouml;heres\n\t\t\tSicherheitslevel hat!\n\t\t\tBitte gehen Sie <a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_users','userid'=>'')).\"\\\">zur&uuml;ck</a>.</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Es trat ein unvorhergesehener Fehler auf. Bitte gehen Sie <a href=\\\"\".BuildURL(\"users.php\",NULL,array('action'=>'edit_users','userid'=>'')).\"\\\">zur&uuml;ck</a>.</p>\";\n\n\t}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"ask_del\")\n\t\t$flag_loginerror = true;\n\n\n\n\n\n\n\n\n// Einzelnen Benutzer bearbeiten / Profil\nif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_user\" && $userdata['userverwaltung'] == 2 ||\nisset($_REQUEST['action']) && $_REQUEST['action'] == \"profil\" && $userdata['profil'] == 1){\n\t$error = 0;\n\tswitch($_REQUEST['action']){\n\t  case \"edit_user\":\n\t    // Weitere \u00dcberpr\u00fcfungen der \u00fcbergebenen Variablen\n\t\tif(!isset($_REQUEST['userid']) || isset($_REQUEST['userid']) && empty($_REQUEST['userid'])){\n\t\t\t$error = 1;\n\t\t\t}\n\t\telse{\n\t\t\t$list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['user'].\" WHERE id='\".$mysqli->escape_string($_REQUEST['userid']).\"' AND id != '0' AND (level < '\".$mysqli->escape_string($userdata['level']).\"' OR level = '10' AND level = '\".$mysqli->escape_string($userdata['level']).\"' OR id = '\".$mysqli->escape_string($userdata['id']).\"') LIMIT 1\");\n\t\t\tif($list->num_rows < 1) $error = 2;\n\t\t\t}\n\t\t\t\n\t\t$title = \"Benutzer bearbeiten\";\n\t\t$case = \"edit\";\n\t\t$readonly = \"\";\n\n\t\techo \"<h1>\".$title.\"</h1>\";\n\t\t\n\t\techo \"<form action=\\\"\".BuildURL($filename,NULL,array('action'=>'','userid'=>'')).\"\\\" method=\\\"post\\\" name=\\\"post\\\">\";\n\t  break;\n\t  case \"profil\":\n\t    $list = $mysqli->query(\"SELECT * FROM \".$mysql_tables['user'].\" WHERE id='\".$userdata['id'].\"' AND id != '0' LIMIT 1\");\n\t\t\n\t\t$title = \"Eigenes Profil\";\n\t\t$case = \"profil\";\n\t\t$readonly = \" readonly=\\\"readonly\\\"\";\n\n\t\techo \"<h1>\".$title.\"</h1>\";\n\t\t\n\t\techo \"<form action=\\\"\".$filename.\"\\\" method=\\\"post\\\" name=\\\"post\\\">\";\n\t\t\n\t\tif(isset($_GET['show']) && $_GET['show'] == \"saved\"){\n\t\t\techo \"<p class=\\\"meldung_ok\\\">Daten wurden gespeichert.</p>\";\n\t\t\t}\n\t  break;\n\t  }\n\t\n\t// Ist ein Fehler aufgetreten?\n\tif($error == 0){\n\t\t//Normale weitere Programmausf\u00fchrung\n\t\t\n\t\tif($userdata['level'] < 10)\n\t\t\techo \"<p class=\\\"meldung_hinweis\\\">Sie k&ouml;nnen nur Einstellungen vornehmen f&uuml;r die Sie selbst &uuml;ber die entsprechenden Berechtigungen verf&uuml;gen.</p>\";\n\n\t\techo \"<table border=\\\"0\\\" align=\\\"center\\\" width=\\\"100%\\\" cellpadding=\\\"3\\\" cellspacing=\\\"5\\\" class=\\\"rundrahmen\\\">\";\n\t\t\n\t\t// Datensatz aus Datenbank holen und \"besondere\" Felder (Name, Passw etc.) ausgeben\n\t\twhile($datarow = $list->fetch_assoc()){\n\t\t\t// WIRD AUF PROFIL & USER-BEARBEITEN-SEITE ANGEZEIGT\n\t\t\techo \"<tr>\n\t\t\t\t<td colspan=\\\"2\\\" class=\\\"tra\\\"><h3>Stammdaten</h3></td>\n\t\t\t</tr>\n\t\t\t\n\t\t\t<tr>\n\t\t\t\t<td class=\\\"trb\\\" width=\\\"60%\\\"><b>Benutzername</b></td>\n\t\t\t\t<td class=\\\"trb\\\"><input type=\\\"text\\\" name=\\\"username\\\" value=\\\"\".stripslashes($datarow['username']).\"\\\" size=\\\"50\\\"\".$readonly.\" /></td>\n\t\t\t</tr>\n\t\t\t\n\t\t\t<tr>\n\t\t\t\t<td class=\\\"tra\\\"><b>E-Mail-Adresse</b></td>\n\t\t\t\t<td class=\\\"tra\\\"><input type=\\\"text\\\" name=\\\"mail\\\" value=\\\"\".stripslashes($datarow['mail']).\"\\\" size=\\\"50\\\" /></td>\n\t\t\t</tr>\";\n\t\t\n\t\t\t$count = 0;\n\t\t\tif($case == \"edit\"){\n// CASE: BENUTZER BEARBEITEN\n\t\t\t\techo \"<tr>\n\t\t\t\t\t<td class=\\\"trb\\\"><b>Passwort &auml;ndern</b></td>\n\t\t\t\t\t<td class=\\\"trb\\\">\n\t\t\t\t\t\t<input type=\\\"checkbox\\\" name=\\\"changepw\\\" value=\\\"1\\\" /> <span class=\\\"small\\\"><b>Bitte Checkbox markieren um das Passwort zu &auml;ndern.</b></span><br />\n\t\t\t\t\t\t<input type=\\\"radio\\\" name=\\\"pwwahl\\\" value=\\\"random\\\" checked=\\\"checked\\\" /> Zuf\u00e4lliges Passwort generieren <span class=\\\"small\\\">(Wird per E-Mail an den Benutzer verschickt)</span><br />\n\t\t\t\t\t\t<input type=\\\"radio\\\" name=\\\"pwwahl\\\" value=\\\"eigen\\\" /> Passwort festlegen: <input type=\\\"text\\\" name=\\\"password\\\" size=\\\"20\\\" /> <br /><span class=\\\"small\\\"><b>Mindestens \".PW_LAENGE.\" Zeichen</b></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t\n\t\t\t\t<tr>\n\t\t\t\t\t<td class=\\\"tra\\\"><b>Sicherheitsstufe</b></td>\n\t\t\t\t\t<td class=\\\"tra\\\">\";\n\t\t\t\t\t\n\t\t\t\tif($userdata['id'] != $datarow['id']){\n\t\t\t\t\techo \"<select name=\\\"level\\\" size=\\\"1\\\">\";\n\t\t\t\t\tfor($x=1;$x<=$userdata['level'];$x++){\n\t\t\t\t\t\tif($datarow['level'] == $x) $sel = \" selected=\\\"selected\\\"\";\n\t\t\t\t\t\telse $sel = \"\";\n\t\t\t\t\t\t\n\t\t\t\t\t\techo \"<option value=\\\"\".$x.\"\\\"\".$sel.\">Sicherheitsstufe \".$x.\"</option>\\n\";\n\t\t\t\t\t\t}\n\t\t\t\t\techo \"</select>\";\n\t\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\techo \"<input type=\\\"text\\\" size=\\\"5\\\" name=\\\"level\\\" value=\\\"\".$userdata['level'].\"\\\" readonly=\\\"readonly\\\" />\";\n\t\t\t\t\n\t\t\t\techo \"</td>\n\t\t\t\t</tr>\";\n\t\t\t\t\n\t\t\t\t// Benutzer sperren / entsperren\n\t\t\t\tif($userdata['id'] != $datarow['id'] && $datarow['level'] <= $userdata['level']){ \"\";\n\t\t\t\t\tif($datarow['sperre'] == 1){\n\t\t\t\t\t\t$s_text = \"Benutzer ist gesperrt\";\n\t\t\t\t\t\t$s_color = \"tr_red\";\n\t\t\t\t\t\t$s_checked = \" checked=\\\"checked\\\"\";\n\t\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t$s_text = \"Benutzer sperren\";\n\t\t\t\t\t\t$s_color = \"trb\";\n\t\t\t\t\t\t$s_checked = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\techo \"<tr>\n\t\t\t\t\t\t<td class=\\\"\".$s_color.\"\\\"><b>\".$s_text.\"</b></td>\n\t\t\t\t\t\t<td class=\\\"\".$s_color.\"\\\">\n\t\t\t\t\t\t\t<input type=\\\"checkbox\\\" name=\\\"sperre\\\" value=\\\"1\\\"\".$s_checked.\" /> Benutzer sperren\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Zugriff eingesch\u00e4nkt?\n\t\t\t\tif($datarow['id'] != $userdata['id'] || $userdata['level'] == 10){\n\t\t\t\t\t$tempmodarray = array(\"01acp\");\n\t\t\t\t\t$tempmodarray = array_merge($tempmodarray,$inst_module);\n\n\t\t\t\t\tforeach($tempmodarray as $modul_akt){\n\t\t\t\t\t\t$cats_rights = getSettingCats($modul_akt,$mysql_tables['rights']);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Berechtigungen f\u00fcr die einzelnen Kategorien vorhanden?\n\t\t\t\t\t\tif(isset($cats_rights) && !empty($cats_rights) && ($userdata['level'] == 10 || ($userdata[$modul_akt] == 1 || $modul_akt == \"01acp\"))){\n\n\t\t\t\t\t\t\tforeach($cats_rights as $catvalue){\n\t\t\t\t\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\t\t\t\t\tif($modul_akt != \"01acp\") $echomodulname = $module[$modul_akt]['instname'].\" &raquo; \";\n\t\t\t\t\t\t\t\telse $echomodulname = \"\";\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif($catvalue['modul'] != \"01acp\")\n\t\t\t\t\t\t\t\t\techo \"<tr>\n\t\t\t\t\t\t\t\t<td colspan=\\\"2\\\" class=\\\"\".$class.\"\\\"><h3><a href=\\\"javascript:moo_hide_unhide_tr('\".$catvalue['catid'].$catvalue['modul'].\"');\\\" title=\\\"Berechtigungen einblenden\\\">\".$echomodulname.$catvalue['name'].\"</a></h3></td>\n\t\t\t\t\t\t\t\t</tr>\";\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\techo \"<tr>\n\t\t\t\t\t\t\t\t<td colspan=\\\"2\\\" class=\\\"\".$class.\"\\\"><h3>\".$echomodulname.$catvalue['name'].\"</h3></td>\n\t\t\t\t\t\t\t\t</tr>\";\n\n\t\t\t\t\t\t\t\t$query = \"SELECT * FROM \".$mysql_tables['rights'].\" WHERE modul='\".$mysqli->escape_string($modul_akt).\"' AND is_cat='0' AND catid='\".$catvalue['catid'].\"' AND hide='0' ORDER BY sortid\";\n\t\t\t\t\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\t\t\t\t\twhile($row = $list->fetch_assoc()){\n\t\t\t\t\t\t\t\t\t// Nur Einstellungen mit Berechtigungen des Users anzeigen und function-Felder prinzipiell \u00fcberspringen\n\t\t\t\t\t\t\t\t\tif($userdata['level'] < 10 && ($userdata[str_replace(\"01acp_\",\"\",$modul_akt.'_'.$row['idname'])] == 0 || $row['formename'] == \"function\")) continue;\n\n\t\t\t\t\t\t            if($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t$row['idname'] = $modul_akt.\"_\".$row['idname'];\n\t\t\t\t\t\t\t\t\t$row['wert'] = $datarow[$row['idname']];\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// MySQL-Daten verarbeiten\n\t\t\t\t\t\t\t\t\techo parse_dynFieldtypes($row,$class,$count,$catvalue['catid'].$catvalue['modul']);\n\t\t\t\t\t\t        }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\t\techo \"<tr>\n\t\t\t        <td class=\\\"\".$class.\"\\\" colspan=\\\"2\\\"><b class=\\\"red\\\">Das eigene Benutzerkonto kann nur eingesch&auml;nkt bearbeitet werden!</b></td>\n\t\t\t    </tr>\";\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\techo \"<tr>\n\t\t        <td class=\\\"\".$class.\"\\\"><input type=\\\"reset\\\" value=\\\"Reset\\\" class=\\\"input\\\" /></td>\n\t\t        <td class=\\\"\".$class.\"\\\" align=\\\"right\\\">\n\t\t\t\t\t<input type=\\\"hidden\\\" name=\\\"action\\\" value=\\\"do_edit\\\" />\n\t\t\t\t\t<input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\".$_REQUEST['userid'].\"\\\" />\n\t\t\t\t\t<input type=\\\"submit\\\" value=\\\"Benutzer bearbeiten &raquo;\\\" class=\\\"input\\\" />\n\t\t\t\t</td>\n\t\t    </tr>\";\n\t\t\t}\n\t\t\telse{\n// CASE: PROFIL\n\t\t\t\t$modul_temp = $modul;\n\t\t\t\t$modul = $userdata['startpage'];\n\n\t\t\t\techo \"<tr>\n\t\t\t\t<td class=\\\"trb\\\"><b>Passwort &auml;ndern</b></td>\n\t\t\t\t<td class=\\\"trb\\\"><img src=\\\"images/icons/icon_pw.gif\\\" alt=\\\"Icon: Schl\u00fc&szlig;el\\\" title=\\\"Passwort &auml;ndern\\\" /> <a href=\\\"javascript:popup('change_pw','','','',330,280);\\\">Passwort \u00e4ndern</a></td>\n\t\t\t\t</tr>\n\t\t\t\t\n\t\t\t\t<tr>\n\t\t\t\t<td colspan=\\\"2\\\" class=\\\"tra\\\"><h3>Startseite w&auml;hlen</h3></td>\n\t\t\t\t</tr>\n\t\t\t\t\n\t\t\t\t<tr>\n\t\t\t\t<td class=\\\"trb\\\"><b>Gew&uuml;nschte Startseite ausw&auml;hlen</b></td>\n\t\t\t\t<td class=\\\"trb\\\"><select name=\\\"startpage\\\" size=\\\"1\\\" class=\\\"input_select\\\">\n\t\t\t\t\t\".create_ModulDropDown(TRUE).\"\n\t\t\t\t</select></td>\n\t\t\t\t</tr>\n\t\t\t\t\n\t\t\t\t<tr>\n\t\t\t\t<td colspan=\\\"2\\\" class=\\\"tra\\\"><h3>Weitere Profilfelder</h3></td>\n\t\t\t\t</tr>\";\n\t\t\t\t$modul = $modul_temp;\n\t\t\t\t\n\t\t\t\t$query = \"SELECT * FROM \".$mysql_tables['rights'].\" WHERE is_cat='0' AND hide='0' AND in_profile='1' ORDER BY catid,sortid\";\n\t\t\t\t$list = $mysqli->query($query);\n\t\t\t\twhile($row = $list->fetch_assoc()){\n\t\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\t\t\n\t\t\t\t\t$row['idname'] = $row['modul'].\"_\".$row['idname'];\n\t\t\t\t\t$row['wert'] = $datarow[$row['idname']];\n\t\t\t\t\t\n\t\t\t\t\t// MySQL-Daten verarbeiten\n\t\t\t\t\techo parse_dynFieldtypes($row,$class,$count,\"01acp\");\n\t\t\t\t\t}\n\n\t\t\t\tif($count == 1){ $class = \"tra\"; $count--; }else{ $class = \"trb\"; $count++; }\n\t\t\t\techo \"<tr>\n\t\t        <td class=\\\"\".$class.\"\\\"><input type=\\\"reset\\\" value=\\\"Reset\\\" class=\\\"input\\\" /></td>\n\t\t        <td class=\\\"\".$class.\"\\\">\n\t\t\t\t\t<input type=\\\"hidden\\\" name=\\\"action\\\" value=\\\"save_profile\\\" />\n\t\t\t\t\t<input type=\\\"submit\\\" value=\\\"Speichern &raquo;\\\" class=\\\"input\\\" />\n\t\t\t\t</td>\n\t\t    </tr>\";\n\t\t\t}\n\t\t}\n\t\t\n\t\techo \"</table>\";\n\t\techo \"</form><br />\";\n\t}\n\telseif($error == 1)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Die &uuml;bergebene Benutzer-ID ist leider fehlerhaft &amp; in dieser\n\t\t\tForm nicht g&uuml;ltig. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\telseif($error == 2)\n\t\techo \"<p class=\\\"meldung_error\\\">Fehler: Zur &uuml;bergebene Benutzer-ID konnte leider kein passender\n\t\t\tEintrag in der Datenbank gefunden werden, <b>oder Sie haben keine Berechtigung um diesen Benutzer zu bearbeiten</b>.\n\t\t\tBitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\telse\n\t\techo \"<p class=\\\"meldung_error\\\">Es trat ein unvorhergesehener Fehler auf. Bitte gehen Sie <a href=\\\"javascript:history.back();\\\">zur&uuml;ck</a>.</p>\";\n\n}elseif(isset($_REQUEST['action']) && $_REQUEST['action'] == \"edit_user\" || isset($_REQUEST['action']) && $_REQUEST['action'] == \"profil\")\n\t$flag_loginerror = true;\n\n}else $flag_loginerror = true;\ninclude(\"system/foot.php\");\n\n?>"], "filenames": ["01acp/_dev.php", "01acp/_loader.php", "01acp/acp.php", "01acp/comments.php", "01acp/filemanager.php", "01acp/index.php", "01acp/module.php", "01acp/rights.php", "01acp/settings.php", "01acp/system/uploader.php", "01acp/update.php", "01acp/users.php"], "buggy_code_start_loc": [13, 18, 15, 20, 14, 15, 14, 8, 8, 8, 8, 14], "buggy_code_end_loc": [14, 19, 50, 145, 228, 16, 15, 180, 233, 314, 42, 15], "fixing_code_start_loc": [13, 18, 15, 20, 14, 15, 14, 8, 8, 8, 8, 14], "fixing_code_end_loc": [14, 19, 50, 145, 228, 16, 15, 180, 233, 314, 42, 15], "type": "CWE-79", "message": "A vulnerability, which was classified as problematic, has been found in 01-Scripts 01ACP. This issue affects some unknown processing. The manipulation of the argument $_SERVER['SCRIPT_NAME'] leads to cross site scripting. The attack may be initiated remotely. The name of the patch is a16eb7da46ed22bc61067c212635394f2571d3c4. It is recommended to apply a patch to fix this issue. The identifier VDB-217649 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2021-4309", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-08T17:15:17.947", "lastModified": "2023-01-12T22:25:20.557", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, has been found in 01-Scripts 01ACP. This issue affects some unknown processing. The manipulation of the argument $_SERVER['SCRIPT_NAME'] leads to cross site scripting. The attack may be initiated remotely. The name of the patch is a16eb7da46ed22bc61067c212635394f2571d3c4. It is recommended to apply a patch to fix this issue. The identifier VDB-217649 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:01-scripts:01acp:*:*:*:*:*:*:*:*", "versionEndExcluding": "2021-09-15", "matchCriteriaId": "1127B73F-C0BC-49C7-9E04-1AF6FC41E5F5"}]}]}], "references": [{"url": "https://github.com/01-Scripts/01ACP/commit/a16eb7da46ed22bc61067c212635394f2571d3c4", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217649", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.217649", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/01-Scripts/01ACP/commit/a16eb7da46ed22bc61067c212635394f2571d3c4"}}