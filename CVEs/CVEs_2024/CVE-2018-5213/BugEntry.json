{"buggy_code": ["<?php\n/**\n * Plugin Name: Simple Download Monitor\n * Plugin URI: https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin\n * Description: Easily manage downloadable files and monitor downloads of your digital files from your WordPress site.\n * Version: 3.5.3\n * Author: Tips and Tricks HQ, Ruhul Amin, Josh Lobe\n * Author URI: https://www.tipsandtricks-hq.com/development-center\n * License: GPL2\n * Text Domain: simple-download-monitor\n * Domain Path: /languages/\n */\n\nif (!defined('ABSPATH')) {\n    exit;\n}\n\ndefine('WP_SIMPLE_DL_MONITOR_VERSION', '3.5.3');\ndefine('WP_SIMPLE_DL_MONITOR_DIR_NAME', dirname(plugin_basename(__FILE__)));\ndefine('WP_SIMPLE_DL_MONITOR_URL', plugins_url('', __FILE__));\ndefine('WP_SIMPLE_DL_MONITOR_PATH', plugin_dir_path(__FILE__));\ndefine('WP_SIMPLE_DL_MONITOR_SITE_HOME_URL', home_url());\ndefine('WP_SDM_LOG_FILE', WP_SIMPLE_DL_MONITOR_PATH . 'sdm-debug-log.txt');\n\nglobal $sdm_db_version;\n$sdm_db_version = '1.2';\n\n//File includes\ninclude_once('includes/sdm-debug.php');\ninclude_once('includes/sdm-utility-functions.php');\ninclude_once('includes/sdm-utility-functions-admin-side.php');\ninclude_once('includes/sdm-download-request-handler.php');\ninclude_once('includes/sdm-logs-list-table.php');\ninclude_once('includes/sdm-latest-downloads.php');\ninclude_once('includes/sdm-search-shortcode-handler.php');\ninclude_once('sdm-post-type-and-taxonomy.php');\ninclude_once('sdm-shortcodes.php');\ninclude_once('sdm-post-type-content-handler.php');\n\n//Activation hook handler\nregister_activation_hook(__FILE__, 'sdm_install_db_table');\n\nfunction sdm_install_db_table() {\n\n    global $wpdb;\n    global $sdm_db_version;\n    $table_name = $wpdb->prefix . 'sdm_downloads';\n\n    $sql = 'CREATE TABLE ' . $table_name . ' (\n\t\t\t  id mediumint(9) NOT NULL AUTO_INCREMENT,\n\t\t\t  post_id mediumint(9) NOT NULL,\n\t\t\t  post_title mediumtext NOT NULL,\n\t\t\t  file_url mediumtext NOT NULL,\n\t\t\t  visitor_ip mediumtext NOT NULL,\n\t\t\t  date_time datetime DEFAULT \"0000-00-00 00:00:00\" NOT NULL,\n\t\t\t  visitor_country mediumtext NOT NULL,\n\t\t\t  visitor_name mediumtext NOT NULL,\n\t\t\t  UNIQUE KEY id (id)\n\t\t);';\n\n    require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );\n    dbDelta($sql);\n\n    update_option('sdm_db_version', $sdm_db_version);\n\n    //Register the post type so you can flush the rewrite rules\n    sdm_register_post_type();\n\n    // Flush rules after install/activation\n    flush_rewrite_rules();\n}\n\n/*\n * * Handle Plugins loaded tasks\n */\nadd_action('plugins_loaded', 'sdm_plugins_loaded_tasks');\n\nfunction sdm_plugins_loaded_tasks() {\n    //Load language\n    load_plugin_textdomain('simple-download-monitor', false, dirname(plugin_basename(__FILE__)) . '/langs/');\n\n    //Handle db upgrade stuff\n    sdm_db_update_check();\n}\n\n/*\n * * Handle Generic Init tasks\n */\nadd_action('init', 'sdm_init_time_tasks');\nadd_action('admin_init', 'sdm_admin_init_time_tasks');\n\nfunction sdm_init_time_tasks() {\n    //Handle download request if any\n    handle_sdm_download_via_direct_post();\n    if (is_admin()) {\n\t//Register Google Charts library\n\twp_register_script('sdm_google_charts', 'https://www.gstatic.com/charts/loader.js', array(), null, true);\n\twp_register_style('sdm_jquery_ui_style', WP_SIMPLE_DL_MONITOR_URL . '/css/jquery.ui.min.css', array(), null, 'all');\n    }\n}\n\nfunction sdm_admin_init_time_tasks() {\n    //Register ajax handlers\n    add_action('wp_ajax_sdm_reset_log', 'sdm_reset_log_handler');\n    add_action('wp_ajax_sdm_delete_data', 'sdm_delete_data_handler');\n\n    if (is_admin()) {\n\tif (user_can(wp_get_current_user(), 'administrator')) {\n\t    // user is an admin\n\t    if (isset($_GET['sdm-action'])) {\n\t\tif ($_GET['sdm-action'] === 'view_log') {\n\t\t    $logfile = fopen(WP_SDM_LOG_FILE, 'rb');\n\t\t    header('Content-Type: text/plain');\n\t\t    fpassthru($logfile);\n\t\t    die;\n\t\t}\n\t    }\n\t}\n    }\n}\n\nfunction sdm_reset_log_handler() {\n    SDM_Debug::reset_log();\n    echo '1';\n    wp_die();\n}\n\nfunction sdm_delete_data_handler() {\n    if (!check_ajax_referer('sdm_delete_data', 'nonce', false)) {\n\t//nonce check failed\n\twp_die(0);\n    }\n    global $wpdb;\n    //let's find and delete smd_download posts and meta\n    $posts = $wpdb->get_results('SELECT id FROM ' . $wpdb->prefix . 'posts WHERE post_type=\"sdm_downloads\"', ARRAY_A);\n    if (!is_null($posts)) {\n\tforeach ($posts as $post) {\n\t    wp_delete_post($post['id'], true);\n\t}\n    }\n    //let's delete options\n    delete_option('sdm_downloads_options');\n    delete_option('sdm_db_version');\n    //remove post type and taxonomies\n    unregister_post_type('sdm_downloads');\n    unregister_taxonomy('sdm_categories');\n    unregister_taxonomy('sdm_tags');\n    //let's delete sdm_downloads table\n    $wpdb->query(\"DROP TABLE \" . $wpdb->prefix . \"sdm_downloads\");\n    //deactivate plugin\n    deactivate_plugins(plugin_basename(__FILE__));\n    //flush rewrite rules\n    flush_rewrite_rules(false);\n    echo '1';\n    wp_die();\n}\n\n/*\n * DB upgrade check\n */\n\nfunction sdm_db_update_check() {\n    if (is_admin()) {//Check if DB needs to be upgraded\n\tglobal $sdm_db_version;\n\t$inst_db_version = get_option('sdm_db_version');\n\tif ($inst_db_version != $sdm_db_version) {\n\t    sdm_install_db_table();\n\t}\n    }\n}\n\n/*\n * * Add a 'Settings' link to plugins list page\n */\nadd_filter('plugin_action_links', 'sdm_settings_link', 10, 2);\n\nfunction sdm_settings_link($links, $file) {\n    static $this_plugin;\n    if (!$this_plugin)\n\t$this_plugin = plugin_basename(__FILE__);\n    if ($file == $this_plugin) {\n\t$settings_link = '<a href=\"edit.php?post_type=sdm_downloads&page=sdm-settings\" title=\"SDM Settings Page\">' . __(\"Settings\", 'simple-download-monitor') . '</a>';\n\tarray_unshift($links, $settings_link);\n    }\n    return $links;\n}\n\n// Houston... we have lift-off!!\nclass simpleDownloadManager {\n\n    public function __construct() {\n\n\tadd_action('init', 'sdm_register_post_type');  // Create 'sdm_downloads' custom post type\n\tadd_action('init', 'sdm_create_taxonomies');  // Register 'tags' and 'categories' taxonomies\n\tadd_action('init', 'sdm_register_shortcodes'); //Register the shortcodes\n\tadd_action('wp_enqueue_scripts', array($this, 'sdm_frontend_scripts'));  // Register frontend scripts\n\n\tif (is_admin()) {\n\t    add_action('admin_menu', array($this, 'sdm_create_menu_pages'));  // Create admin pages\n\t    add_action('add_meta_boxes', array($this, 'sdm_create_upload_metabox'));  // Create metaboxes\n\n\t    add_action('save_post', array($this, 'sdm_save_description_meta_data'));  // Save 'description' metabox\n\t    add_action('save_post', array($this, 'sdm_save_upload_meta_data'));  // Save 'upload file' metabox\n\t    add_action('save_post', array($this, 'sdm_save_dispatch_meta_data'));  // Save 'dispatch' metabox\n\t    add_action('save_post', array($this, 'sdm_save_thumbnail_meta_data'));  // Save 'thumbnail' metabox\n\t    add_action('save_post', array($this, 'sdm_save_statistics_meta_data'));  // Save 'statistics' metabox\n\t    add_action('save_post', array($this, 'sdm_save_other_details_meta_data'));  // Save 'other details' metabox\n\n\t    add_action('admin_enqueue_scripts', array($this, 'sdm_admin_scripts'));  // Register admin scripts\n\t    add_action('admin_print_styles', array($this, 'sdm_admin_styles'));  // Register admin styles\n\n\t    add_action('admin_init', array($this, 'sdm_register_options'));  // Register admin options\n\t    //add_filter('post_row_actions', array($this, 'sdm_remove_view_link_cpt'), 10, 2);  // Remove 'View' link in all downloads list view\n\t}\n    }\n\n    public function sdm_admin_scripts() {\n\n\tglobal $current_screen, $post;\n\n\tif (is_admin() && $current_screen->post_type == 'sdm_downloads' && $current_screen->base == 'post') {\n\n\t    // These scripts are needed for the media upload thickbox\n\t    wp_enqueue_script('media-upload');\n\t    wp_enqueue_script('thickbox');\n\t    wp_register_script('sdm-upload', WP_SIMPLE_DL_MONITOR_URL . '/js/sdm_admin_scripts.js', array('jquery', 'media-upload', 'thickbox'), WP_SIMPLE_DL_MONITOR_VERSION);\n\t    wp_enqueue_script('sdm-upload');\n\n\t    // Pass postID for thumbnail deletion\n\t    ?>\n\t    <script type=\"text/javascript\">\n\t        var sdm_del_thumb_postid = '<?php echo $post->ID; ?>';\n\t    </script>\n\t    <?php\n\t    // Localize langauge strings used in js file\n\t    $sdmTranslations = array(\n\t\t'select_file' => __('Select File', 'simple-download-monitor'),\n\t\t'select_thumbnail' => __('Select Thumbnail', 'simple-download-monitor'),\n\t\t'insert' => __('Insert', 'simple-download-monitor'),\n\t\t'image_removed' => __('Image Successfully Removed', 'simple-download-monitor'),\n\t\t'ajax_error' => __('Error with AJAX', 'simple-download-monitor')\n\t    );\n\t    wp_localize_script('sdm-upload', 'sdm_translations', $sdmTranslations);\n\t}\n\n\t// Pass admin ajax url\n\t?>\n\t<script type=\"text/javascript\">\n\t    var sdm_admin_ajax_url = {sdm_admin_ajax_url: '<?php echo admin_url('admin-ajax.php?action=ajax'); ?>'};\n\t    var sdm_plugin_url = '<?php echo plugins_url(); ?>';\n\t    var tinymce_langs = {\n\t\tselect_download_item: '<?php _e('Please select a Download Item:', 'simple-download-monitor') ?>',\n\t\tdownload_title: '<?php _e('Download Title', 'simple-download-monitor') ?>',\n\t\tinclude_fancy: '<?php _e('Include Fancy Box', 'simple-download-monitor') ?>',\n\t\topen_new_window: '<?php _e('Open New Window', 'simple-download-monitor') ?>',\n\t\tbutton_color: '<?php _e('Button Color', 'simple-download-monitor'); ?>',\n\t\tinsert_shortcode: '<?php _e('Insert SDM Shortcode', 'simple-download-monitor') ?>'\n\t    };\n\t    var sdm_button_colors = <?php echo wp_json_encode(sdm_get_download_button_colors()); ?>;\n\t</script>\n\t<?php\n    }\n\n    public function sdm_frontend_scripts() {\n\t//Use this function to enqueue fron-end js scripts.\n\twp_enqueue_style('sdm-styles', WP_SIMPLE_DL_MONITOR_URL . '/css/sdm_wp_styles.css');\n\twp_register_script('sdm-scripts', WP_SIMPLE_DL_MONITOR_URL . '/js/sdm_wp_scripts.js', array('jquery'));\n\twp_enqueue_script('sdm-scripts');\n\n\t// Localize ajax script for frontend\n\twp_localize_script('sdm-scripts', 'sdm_ajax_script', array('ajaxurl' => admin_url('admin-ajax.php')));\n    }\n\n    public function sdm_admin_styles() {\n\n\twp_enqueue_style('thickbox');  // Needed for media upload thickbox\n\twp_enqueue_style('sdm_admin_styles', WP_SIMPLE_DL_MONITOR_URL . '/css/sdm_admin_styles.css', array(), WP_SIMPLE_DL_MONITOR_VERSION);  // Needed for media upload thickbox\n    }\n\n    public function sdm_create_menu_pages() {\n\tinclude_once('includes/sdm-admin-menu-handler.php');\n\tsdm_handle_admin_menu();\n    }\n\n    public function sdm_create_upload_metabox() {\n\n\t//*****  Create metaboxes for the custom post type\n\tadd_meta_box('sdm_description_meta_box', __('Description', 'simple-download-monitor'), array($this, 'display_sdm_description_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_upload_meta_box', __('Downloadable File (Visitors will download this item)', 'simple-download-monitor'), array($this, 'display_sdm_upload_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_dispatch_meta_box', __('PHP Dispatch or Redirect', 'simple-download-monitor'), array($this, 'display_sdm_dispatch_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_thumbnail_meta_box', __('File Thumbnail (Optional)', 'simple-download-monitor'), array($this, 'display_sdm_thumbnail_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_stats_meta_box', __('Statistics', 'simple-download-monitor'), array($this, 'display_sdm_stats_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_other_details_meta_box', __('Other Details (Optional)', 'simple-download-monitor'), array($this, 'display_sdm_other_details_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_shortcode_meta_box', __('Shortcodes', 'simple-download-monitor'), array($this, 'display_sdm_shortcode_meta_box'), 'sdm_downloads', 'normal', 'default');\n    }\n\n    public function display_sdm_description_meta_box($post) {  // Description metabox\n\t_e('Add a description for this download item.', 'simple-download-monitor');\n\techo '<br /><br />';\n\n\t$old_description = get_post_meta($post->ID, 'sdm_description', true);\n\t$sdm_description_field = array('textarea_name' => 'sdm_description');\n\twp_editor($old_description, \"sdm_description_editor_content\", $sdm_description_field);\n\n\twp_nonce_field('sdm_description_box_nonce', 'sdm_description_box_nonce_check');\n    }\n\n    public function display_sdm_upload_meta_box($post) {  // File Upload metabox\n\t$old_upload = get_post_meta($post->ID, 'sdm_upload', true);\n\t$old_value = isset($old_upload) ? $old_upload : '';\n\n\t_e('Manually enter a valid URL of the file in the text box below, or click \"Select File\" button to upload (or choose) the downloadable file.', 'simple-download-monitor');\n\techo '<br /><br />';\n\n\techo '<div class=\"sdm-download-edit-file-url-section\">';\n\techo '<input id=\"sdm_upload\" type=\"text\" size=\"100\" name=\"sdm_upload\" value=\"' . $old_value . '\" placeholder=\"http://...\" />';\n\techo '</div>';\n\n\techo '<br />';\n\techo '<input id=\"upload_image_button\" type=\"button\" class=\"button-primary\" value=\"' . __('Select File', 'simple-download-monitor') . '\" />';\n\n\techo '<br /><br />';\n\t_e('Steps to upload a file or choose one from your media library:', 'simple-download-monitor');\n\techo '<ol>';\n\techo '<li>Hit the \"Select File\" button.</li>';\n\techo '<li>Upload a new file or choose an existing one from your media library.</li>';\n\techo '<li>Click the \"Insert\" button, this will populate the uploaded file\\'s URL in the above text field.</li>';\n\techo '</ol>';\n\n\twp_nonce_field('sdm_upload_box_nonce', 'sdm_upload_box_nonce_check');\n    }\n\n    public function display_sdm_dispatch_meta_box($post) {\n\t$dispatch = get_post_meta($post->ID, 'sdm_item_dispatch', true);\n\n\tif ($dispatch === '') {\n\t    // No value yet (either new item or saved with older version of plugin)\n\t    $screen = get_current_screen();\n\n\t    if ($screen->action === 'add') {\n\t\t// New item: set default value as per plugin settings.\n\t\t$main_opts = get_option('sdm_downloads_options');\n\t\t$dispatch = isset($main_opts['general_default_dispatch_value']) && $main_opts['general_default_dispatch_value'];\n\t    }\n\t}\n\n\techo '<input id=\"sdm_item_dispatch\" type=\"checkbox\" name=\"sdm_item_dispatch\" value=\"yes\"' . checked(true, $dispatch, false) . ' />';\n\techo '<label for=\"sdm_item_dispatch\">' . __('Dispatch the file via PHP directly instead of redirecting to it. PHP Dispatching keeps the download URL hidden. Dispatching works only for local files (files that you uploaded to this site via this plugin or media library).', 'simple-download-monitor') . '</label>';\n\n\twp_nonce_field('sdm_dispatch_box_nonce', 'sdm_dispatch_box_nonce_check');\n    }\n\n    public function display_sdm_thumbnail_meta_box($post) {  // Thumbnail upload metabox\n\t$old_thumbnail = get_post_meta($post->ID, 'sdm_upload_thumbnail', true);\n\t$old_value = isset($old_thumbnail) ? $old_thumbnail : '';\n\t_e('Manually enter a valid URL, or click \"Select Image\" to upload (or choose) the file thumbnail image.', 'simple-download-monitor');\n\t?>\n\t<br /><br />\n\t<input id=\"sdm_upload_thumbnail\" type=\"text\" size=\"100\" name=\"sdm_upload_thumbnail\" value=\"<?php echo $old_value; ?>\" placeholder=\"http://...\" />\n\t<br /><br />\n\t<input id=\"upload_thumbnail_button\" type=\"button\" class=\"button-primary\" value=\"<?php _e('Select Image', 'simple-download-monitor'); ?>\" />\n\t<input id=\"remove_thumbnail_button\" type=\"button\" class=\"button\" value=\"<?php _e('Remove Image', 'simple-download-monitor'); ?>\" />\n\t<br /><br />\n\n\t<span id=\"sdm_admin_thumb_preview\">\n\t    <?php\n\t    if (!empty($old_value)) {\n\t\t?><img id=\"sdm_thumbnail_image\" src=\"<?php echo $old_value; ?>\" style=\"max-width:200px;\" />\n\t\t<?php\n\t    }\n\t    ?>\n\t</span>\n\n\t<?php\n\techo '<p class=\"description\">';\n\t_e('This thumbnail image will be used to create a fancy file download box if you want to use it.', 'simple-download-monitor');\n\techo '</p>';\n\n\twp_nonce_field('sdm_thumbnail_box_nonce', 'sdm_thumbnail_box_nonce_check');\n    }\n\n    public function display_sdm_stats_meta_box($post) {  //Stats metabox\n\t$old_count = get_post_meta($post->ID, 'sdm_count_offset', true);\n\t$value = isset($old_count) && $old_count != '' ? $old_count : '0';\n\n\t// Get checkbox for \"disable download logging\"\n\t$no_logs = get_post_meta($post->ID, 'sdm_item_no_log', true);\n\t$checked = isset($no_logs) && $no_logs === 'on' ? 'checked=\"checked\"' : '';\n\n\t_e('These are the statistics for this download item.', 'simple-download-monitor');\n\techo '<br /><br />';\n\n\tglobal $wpdb;\n\t$wpdb->get_results($wpdb->prepare('SELECT * FROM ' . $wpdb->prefix . 'sdm_downloads WHERE post_id=%s', $post->ID));\n\n\techo '<div class=\"sdm-download-edit-dl-count\">';\n\t_e('Number of Downloads:', 'simple-download-monitor');\n\techo ' <strong>' . $wpdb->num_rows . '</strong>';\n\techo '</div>';\n\n\techo '<div class=\"sdm-download-edit-offset-count\">';\n\t_e('Offset Count: ', 'simple-download-monitor');\n\techo '<br />';\n\techo ' <input type=\"text\" size=\"10\" name=\"sdm_count_offset\" value=\"' . $value . '\" />';\n\techo '<p class=\"description\">' . __('Enter any positive or negative numerical value; to offset the download count shown to the visitors (when using the download counter shortcode).', 'simple-download-monitor') . '</p>';\n\techo '</div>';\n\n\techo '<br />';\n\techo '<div class=\"sdm-download-edit-disable-logging\">';\n\techo '<input type=\"checkbox\" name=\"sdm_item_no_log\" ' . $checked . ' />';\n\techo '<span style=\"margin-left: 5px;\"></span>';\n\t_e('Disable download logging for this item.', 'simple-download-monitor');\n\techo '</div>';\n\n\twp_nonce_field('sdm_count_offset_nonce', 'sdm_count_offset_nonce_check');\n    }\n\n    public function display_sdm_other_details_meta_box($post) { //Other details metabox\n\t$file_size = get_post_meta($post->ID, 'sdm_item_file_size', true);\n\t$file_size = isset($file_size) ? $file_size : '';\n\n\t$version = get_post_meta($post->ID, 'sdm_item_version', true);\n\t$version = isset($version) ? $version : '';\n\n\techo '<div class=\"sdm-download-edit-filesize\">';\n\t_e('File Size: ', 'simple-download-monitor');\n\techo '<br />';\n\techo ' <input type=\"text\" name=\"sdm_item_file_size\" value=\"' . $file_size . '\" size=\"20\" />';\n\techo '<p class=\"description\">' . __('Enter the size of this file (example value: 2.15 MB). You can show this value in the fancy display by using a shortcode parameter.', 'simple-download-monitor') . '</p>';\n\techo '</div>';\n\n\techo '<div class=\"sdm-download-edit-version\">';\n\t_e('Version: ', 'simple-download-monitor');\n\techo '<br />';\n\techo ' <input type=\"text\" name=\"sdm_item_version\" value=\"' . $version . '\" size=\"20\" />';\n\techo '<p class=\"description\">' . __('Enter the version number for this item if any (example value: v2.5.10). You can show this value in the fancy display by using a shortcode parameter.', 'simple-download-monitor') . '</p>';\n\techo '</div>';\n\n\twp_nonce_field('sdm_other_details_nonce', 'sdm_other_details_nonce_check');\n    }\n\n    public function display_sdm_shortcode_meta_box($post) {  //Shortcode metabox\n\t_e('The following shortcode can be used on posts or pages to embed a download now button for this file. You can also use the shortcode inserter (in the post editor) to add this shortcode to a post or page.', 'simple-download-monitor');\n\techo '<br />';\n\t$shortcode_text = '[sdm_download id=\"' . $post->ID . '\" fancy=\"0\"]';\n\techo \"<input type='text' class='code' onfocus='this.select();' readonly='readonly' value='\" . $shortcode_text . \"' size='40'>\";\n\techo \"<br /><br />\";\n\n\t_e('The following shortcode can be used to show a download counter for this item.', 'simple-download-monitor');\n\techo '<br />';\n\t$shortcode_text = '[sdm_download_counter id=\"' . $post->ID . '\"]';\n\techo \"<input type='text' class='code' onfocus='this.select();' readonly='readonly' value='\" . $shortcode_text . \"' size='40'>\";\n\n\techo '<br /><br />';\n\techo 'Read the full shortcode usage documentation <a href=\"https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin\" target=\"_blank\">here</a>.';\n    }\n\n    public function sdm_save_description_meta_data($post_id) {  // Save Description metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)\n\t    return;\n\tif (!isset($_POST['sdm_description_box_nonce_check']) || !wp_verify_nonce($_POST['sdm_description_box_nonce_check'], 'sdm_description_box_nonce'))\n\t    return;\n\n\tif (isset($_POST['sdm_description'])) {\n\t    update_post_meta($post_id, 'sdm_description', $_POST['sdm_description']);\n\t}\n    }\n\n    public function sdm_save_upload_meta_data($post_id) {  // Save File Upload metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)\n\t    return;\n\tif (!isset($_POST['sdm_upload_box_nonce_check']) || !wp_verify_nonce($_POST['sdm_upload_box_nonce_check'], 'sdm_upload_box_nonce'))\n\t    return;\n\n\tif (isset($_POST['sdm_upload'])) {\n\t    update_post_meta($post_id, 'sdm_upload', $_POST['sdm_upload']);\n\t}\n    }\n\n    public function sdm_save_dispatch_meta_data($post_id) { // Save \"Dispatch or Redirect\" metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {\n\t    return;\n\t}\n\tif (!isset($_POST['sdm_dispatch_box_nonce_check']) || !wp_verify_nonce($_POST['sdm_dispatch_box_nonce_check'], 'sdm_dispatch_box_nonce')) {\n\t    return;\n\t}\n\t// Get POST-ed data as boolean value\n\t$value = filter_input(INPUT_POST, 'sdm_item_dispatch', FILTER_VALIDATE_BOOLEAN);\n\tupdate_post_meta($post_id, 'sdm_item_dispatch', $value);\n    }\n\n    public function sdm_save_thumbnail_meta_data($post_id) {  // Save Thumbnail Upload metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)\n\t    return;\n\tif (!isset($_POST['sdm_thumbnail_box_nonce_check']) || !wp_verify_nonce($_POST['sdm_thumbnail_box_nonce_check'], 'sdm_thumbnail_box_nonce'))\n\t    return;\n\n\tif (isset($_POST['sdm_upload_thumbnail'])) {\n\t    update_post_meta($post_id, 'sdm_upload_thumbnail', $_POST['sdm_upload_thumbnail']);\n\t}\n    }\n\n    public function sdm_save_statistics_meta_data($post_id) {  // Save Statistics Upload metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)\n\t    return;\n\tif (!isset($_POST['sdm_count_offset_nonce_check']) || !wp_verify_nonce($_POST['sdm_count_offset_nonce_check'], 'sdm_count_offset_nonce'))\n\t    return;\n\n\tif (isset($_POST['sdm_count_offset']) && is_numeric($_POST['sdm_count_offset'])) {\n\n\t    update_post_meta($post_id, 'sdm_count_offset', $_POST['sdm_count_offset']);\n\t}\n\n\t// Checkbox for disabling download logging for this item\n\tif (isset($_POST['sdm_item_no_log'])) {\n\t    update_post_meta($post_id, 'sdm_item_no_log', $_POST['sdm_item_no_log']);\n\t} else {\n\t    delete_post_meta($post_id, 'sdm_item_no_log');\n\t}\n    }\n\n    public function sdm_save_other_details_meta_data($post_id) {  // Save Statistics Upload metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {\n\t    return;\n\t}\n\tif (!isset($_POST['sdm_other_details_nonce_check']) || !wp_verify_nonce($_POST['sdm_other_details_nonce_check'], 'sdm_other_details_nonce')) {\n\t    return;\n\t}\n\n\tif (isset($_POST['sdm_item_file_size'])) {\n\t    update_post_meta($post_id, 'sdm_item_file_size', $_POST['sdm_item_file_size']);\n\t}\n\n\tif (isset($_POST['sdm_item_version'])) {\n\t    update_post_meta($post_id, 'sdm_item_version', $_POST['sdm_item_version']);\n\t}\n    }\n\n    public function sdm_remove_view_link_cpt($action, $post) {\n\n\t// Only execute on SDM CPT posts page\n\tif ($post->post_type == 'sdm_downloads') {\n\t    unset($action['view']);\n\t}\n\n\treturn $action;\n    }\n\n    public function sdm_register_options() {\n\n\t//Register the main setting\n\tregister_setting('sdm_downloads_options', 'sdm_downloads_options');\n\n\t//Add all the settings section that will go under the main settings\n\tadd_settings_section('general_options', __('General Options', 'simple-download-monitor'), array($this, 'general_options_cb'), 'general_options_section');\n\tadd_settings_section('admin_options', __('Admin Options', 'simple-download-monitor'), array($this, 'admin_options_cb'), 'admin_options_section');\n\tadd_settings_section('sdm_colors', __('Colors', 'simple-download-monitor'), array($this, 'sdm_colors_cb'), 'sdm_colors_section');\n\tadd_settings_section('sdm_debug', __('Debug', 'simple-download-monitor'), array($this, 'sdm_debug_cb'), 'sdm_debug_section');\n\tadd_settings_section('sdm_deldata', __('Delete Plugin Data', 'simple-download-monitor'), array($this, 'sdm_deldata_cb'), 'sdm_deldata_section');\n\n\t//Add all the individual settings fields that goes under the sections\n\tadd_settings_field('general_hide_donwload_count', __('Hide Download Count', 'simple-download-monitor'), array($this, 'hide_download_count_cb'), 'general_options_section', 'general_options');\n\tadd_settings_field('general_default_dispatch_value', __('PHP Dispatching', 'simple-download-monitor'), array($this, 'general_default_dispatch_value_cb'), 'general_options_section', 'general_options');\n\tadd_settings_field('only_logged_in_can_download', __('Only Allow Logged-in Users to Download', 'simple-download-monitor'), array($this, 'general_only_logged_in_can_download_cb'), 'general_options_section', 'general_options');\n\tadd_settings_field('general_login_page_url', __('Login Page URL', 'simple-download-monitor'), array($this, 'general_login_page_url_cb'), 'general_options_section', 'general_options');\n\n\tadd_settings_field('admin_tinymce_button', __('Remove Tinymce Button', 'simple-download-monitor'), array($this, 'admin_tinymce_button_cb'), 'admin_options_section', 'admin_options');\n\tadd_settings_field('admin_log_unique', __('Log Unique IP', 'simple-download-monitor'), array($this, 'admin_log_unique'), 'admin_options_section', 'admin_options');\n\tadd_settings_field('admin_dont_log_bots', __('Do Not Count Downloads from Bots', 'simple-download-monitor'), array($this, 'admin_dont_log_bots'), 'admin_options_section', 'admin_options');\n\tadd_settings_field('admin_no_logs', __('Disable Download Logs', 'simple-download-monitor'), array($this, 'admin_no_logs_cb'), 'admin_options_section', 'admin_options');\n\n\tadd_settings_field('download_button_color', __('Download Button Color', 'simple-download-monitor'), array($this, 'download_button_color_cb'), 'sdm_colors_section', 'sdm_colors');\n\n\tadd_settings_field('enable_debug', __('Enable Debug', 'simple-download-monitor'), array($this, 'enable_debug_cb'), 'sdm_debug_section', 'sdm_debug');\n    }\n\n    public function general_options_cb() {\n\t//Set the message that will be shown below the general options settings heading\n\t_e('General options settings', 'simple-download-monitor');\n    }\n\n    public function admin_options_cb() {\n\t//Set the message that will be shown below the admin options settings heading\n\t_e('Admin options settings', 'simple-download-monitor');\n    }\n\n    public function sdm_colors_cb() {\n\t//Set the message that will be shown below the color options settings heading\n\t_e('Front End colors settings', 'simple-download-monitor');\n    }\n\n    public function sdm_debug_cb() {\n\t//Set the message that will be shown below the debug options settings heading\n\t_e('Debug settings', 'simple-download-monitor');\n    }\n\n    public function sdm_deldata_cb() {\n\t//Set the message that will be shown below the debug options settings heading\n\t_e('You can delete all the data related to this plugin from database using the button below. Useful when you\\'re uninstalling the plugin and don\\'t want any leftovers remaining.', 'simple-download-monitor');\n\techo '<p><b>' . __('Warning', 'simple-download-monitor') . ': </b> ' . __('this can\\'t be undone. All settings, download items, download logs will be deleted.', 'simple-download-monitor') . '</p>';\n\techo '<p><button id=\"sdmDeleteData\" class=\"button\" style=\"color:red;\">' . __('Delete all data and deactivate plugin', 'simple-download-monitor') . '</button></p>';\n    }\n\n    public function hide_download_count_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[general_hide_donwload_count]\" id=\"general_hide_download_count\" type=\"checkbox\" ' . checked(1, isset($main_opts['general_hide_donwload_count']), false) . ' /> ';\n\techo '<label for=\"general_hide_download_count\">' . __('Hide the download count that is shown in some of the fancy templates.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function general_default_dispatch_value_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\t$value = isset($main_opts['general_default_dispatch_value']) && $main_opts['general_default_dispatch_value'];\n\techo '<input name=\"sdm_downloads_options[general_default_dispatch_value]\" id=\"general_default_dispatch_value\" type=\"checkbox\" value=\"1\"' . checked(true, $value, false) . ' />';\n\techo '<label for=\"general_default_dispatch_value\">' . __('When you create a new download item, The PHP Dispatching option should be enabled by default. PHP Dispatching keeps the URL of the downloadable files hidden.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function general_only_logged_in_can_download_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\t$value = isset($main_opts['only_logged_in_can_download']) && $main_opts['only_logged_in_can_download'];\n\techo '<input name=\"sdm_downloads_options[only_logged_in_can_download]\" id=\"only_logged_in_can_download\" type=\"checkbox\" value=\"1\"' . checked(true, $value, false) . ' />';\n\techo '<label for=\"only_logged_in_can_download\">' . __('Enable this option if you want to allow downloads only for logged-in users. When enabled, anonymous users clicking on the download button will receive an error message.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function general_login_page_url_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\t$value = isset($main_opts['general_login_page_url']) ? $main_opts['general_login_page_url'] : '';\n\techo '<input size=\"100\" name=\"sdm_downloads_options[general_login_page_url]\" id=\"general_login_page_url\" type=\"text\" value=\"' . $value . '\" />';\n\techo '<p class=\"description\">' . __('(Optional) Specify a login page URL where users can login. This is useful if you only allow logged in users to be able to download. This link will be added to the message that is shown to anonymous users.', 'simple-download-monitor') . '</p>';\n    }\n\n    public function admin_tinymce_button_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[admin_tinymce_button]\" id=\"admin_tinymce_button\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['admin_tinymce_button']), false) . ' /> ';\n\techo '<label for=\"admin_tinymce_button\">' . __('Removes the SDM Downloads button from the WP content editor.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function admin_log_unique() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[admin_log_unique]\" id=\"admin_log_unique\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['admin_log_unique']), false) . ' /> ';\n\techo '<label for=\"admin_log_unique\">' . __('Only logs downloads from unique IP addresses.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function admin_dont_log_bots() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[admin_dont_log_bots]\" id=\"admin_dont_log_bots\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['admin_dont_log_bots']), false) . ' /> ';\n\techo '<label for=\"admin_dont_log_bots\">' . __('When enabled, the plugin won\\'t count and log downloads from bots.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function admin_no_logs_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[admin_no_logs]\" id=\"admin_no_logs\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['admin_no_logs']), false) . ' /> ';\n\techo '<label for=\"admin_no_logs\">' . __('Disables all download logs. (This global option overrides the individual download item option.)', 'simple-download-monitor') . '</label>';\n    }\n\n    public function download_button_color_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\t// Read current color class.\n\t$color_opt = isset($main_opts['download_button_color']) ? $main_opts['download_button_color'] : null;\n\t$color_opts = sdm_get_download_button_colors();\n\n\techo '<select name=\"sdm_downloads_options[download_button_color]\" id=\"download_button_color\" class=\"sdm_opts_ajax_dropdowns\">';\n\tforeach ($color_opts as $color_class => $color_name) {\n\t    echo '<option value=\"' . $color_class . '\"' . selected($color_class, $color_opt, false) . '>' . $color_name . '</option>';\n\t}\n\techo '</select> ';\n\tesc_html_e('Adjusts the color of the \"Download Now\" button.', 'simple-download-monitor');\n    }\n\n    public function enable_debug_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[enable_debug]\" id=\"enable_debug\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['enable_debug']), false) . ' /> ';\n\techo '<label for=\"enable_debug\">' . __('Check this option to enable debug logging.', 'simple-download-monitor') .\n\t'<p class=\"description\"><a href=\"' . get_admin_url() . '?sdm-action=view_log\" target=\"_blank\">' .\n\t__('Click here', 'simple-download-monitor') . '</a>' .\n\t__(' to view log file.', 'simple-download-monitor') . '<br>' .\n\t'<a id=\"sdm-reset-log\" href=\"#0\" style=\"color: red\">' . __('Click here', 'simple-download-monitor') . '</a>' .\n\t__(' to reset log file.', 'simple-download-monitor') . '</p></label>';\n    }\n\n}\n\n//End of simpleDownloadManager class\n//Initialize the simpleDownloadManager class\n$simpleDownloadManager = new simpleDownloadManager();\n\n// Tinymce Button Populate Post ID's\nadd_action('wp_ajax_nopriv_sdm_tiny_get_post_ids', 'sdm_tiny_get_post_ids_ajax_call');\nadd_action('wp_ajax_sdm_tiny_get_post_ids', 'sdm_tiny_get_post_ids_ajax_call');\n\nfunction sdm_tiny_get_post_ids_ajax_call() {\n\n    $posts = get_posts(array(\n\t'post_type' => 'sdm_downloads',\n\t'numberposts' => -1,\n\t    )\n    );\n    foreach ($posts as $item) {\n\t$test[] = array('post_id' => $item->ID, 'post_title' => $item->post_title);\n    }\n\n    $response = json_encode(array('success' => true, 'test' => $test));\n\n    header('Content-Type: application/json');\n    echo $response;\n    exit;\n}\n\n//Remove Thumbnail Image\n//add_action('wp_ajax_nopriv_sdm_remove_thumbnail_image', '');//This is only available to logged-in users\nadd_action('wp_ajax_sdm_remove_thumbnail_image', 'sdm_remove_thumbnail_image_ajax_call'); //Execute this for authenticated users only\n\nfunction sdm_remove_thumbnail_image_ajax_call() {\n    if (!current_user_can('edit_posts')) {\n\t//Permission denied\n\twp_die(__('Permission denied!', 'simple-download-monitor'));\n\texit;\n    }\n\n//Go ahead with the thumbnail removal\n    $post_id = $_POST['post_id_del'];\n    $key_exists = metadata_exists('post', $post_id, 'sdm_upload_thumbnail');\n    if ($key_exists) {\n\t$success = delete_post_meta($post_id, 'sdm_upload_thumbnail');\n\tif ($success) {\n\t    $response = json_encode(array('success' => true));\n\t}\n    } else {\n\t// in order for frontend script to not display \"Ajax error\", let's return some data\n\t$response = json_encode(array('not_exists' => true));\n    }\n\n    header('Content-Type: application/json');\n    echo $response;\n    exit;\n}\n\n// Populate category tree\nadd_action('wp_ajax_nopriv_sdm_pop_cats', 'sdm_pop_cats_ajax_call');\nadd_action('wp_ajax_sdm_pop_cats', 'sdm_pop_cats_ajax_call');\n\nfunction sdm_pop_cats_ajax_call() {\n\n    $cat_slug = $_POST['cat_slug'];  // Get button cpt slug\n    $parent_id = $_POST['parent_id'];  // Get button cpt id\n// Query custom posts based on taxonomy slug\n    $posts = get_posts(array(\n\t'post_type' => 'sdm_downloads',\n\t'numberposts' => -1,\n\t'tax_query' => array(\n\t    array(\n\t\t'taxonomy' => 'sdm_categories',\n\t\t'field' => 'slug',\n\t\t'terms' => $cat_slug,\n\t\t'include_children' => 0\n\t    )\n\t),\n\t'orderby' => 'title',\n\t'order' => 'ASC')\n    );\n\n    $final_array = array();\n\n// Loop results\n    foreach ($posts as $post) {\n\t// Create array of variables to pass to js\n\t$final_array[] = array('id' => $post->ID, 'permalink' => get_permalink($post->ID), 'title' => $post->post_title);\n    }\n\n// Generate ajax response\n    $response = json_encode(array('final_array' => $final_array));\n    header('Content-Type: application/json');\n    echo $response;\n    exit;\n}\n\n/*\n * * Setup Sortable Columns\n */\nadd_filter('manage_edit-sdm_downloads_columns', 'sdm_create_columns'); // Define columns\nadd_filter('manage_edit-sdm_downloads_sortable_columns', 'sdm_downloads_sortable'); // Make sortable\nadd_action('manage_sdm_downloads_posts_custom_column', 'sdm_downloads_columns_content', 10, 2); // Populate new columns\n\nfunction sdm_create_columns($cols) {\n\n    unset($cols['title']);\n    unset($cols['taxonomy-sdm_tags']);\n    unset($cols['taxonomy-sdm_categories']);\n    unset($cols['date']);\n\n    $cols['sdm_downloads_thumbnail'] = __('Image', 'simple-download-monitor');\n    $cols['title'] = __('Title', 'simple-download-monitor');\n    $cols['sdm_downloads_id'] = __('ID', 'simple-download-monitor');\n    $cols['sdm_downloads_file'] = __('File', 'simple-download-monitor');\n    $cols['taxonomy-sdm_categories'] = __('Categories', 'simple-download-monitor');\n    $cols['taxonomy-sdm_tags'] = __('Tags', 'simple-download-monitor');\n    $cols['sdm_downloads_count'] = __('Downloads', 'simple-download-monitor');\n    $cols['date'] = __('Date Posted', 'simple-download-monitor');\n    return $cols;\n}\n\nfunction sdm_downloads_sortable($cols) {\n\n    $cols['sdm_downloads_id'] = 'sdm_downloads_id';\n    $cols['sdm_downloads_file'] = 'sdm_downloads_file';\n    $cols['sdm_downloads_count'] = 'sdm_downloads_count';\n    $cols['taxonomy-sdm_categories'] = 'taxonomy-sdm_categories';\n    $cols['taxonomy-sdm_tags'] = 'taxonomy-sdm_tags';\n    return $cols;\n}\n\nfunction sdm_downloads_columns_content($column_name, $post_ID) {\n\n    if ($column_name == 'sdm_downloads_thumbnail') {\n\t$old_thumbnail = get_post_meta($post_ID, 'sdm_upload_thumbnail', true);\n\t//$old_value = isset($old_thumbnail) ? $old_thumbnail : '';\n\tif ($old_thumbnail) {\n\t    echo '<p class=\"sdm_downloads_count\"><img src=\"' . $old_thumbnail . '\" style=\"width:50px;height:50px;\" /></p>';\n\t}\n    }\n    if ($column_name == 'sdm_downloads_id') {\n\techo '<p class=\"sdm_downloads_postid\">' . $post_ID . '</p>';\n    }\n    if ($column_name == 'sdm_downloads_file') {\n\t$old_file = get_post_meta($post_ID, 'sdm_upload', true);\n\t$file = isset($old_file) ? $old_file : '--';\n\techo '<p class=\"sdm_downloads_file\">' . $file . '</p>';\n    }\n    if ($column_name == 'sdm_downloads_count') {\n\tglobal $wpdb;\n\t$wpdb->get_results($wpdb->prepare('SELECT * FROM ' . $wpdb->prefix . 'sdm_downloads WHERE post_id=%s', $post_ID));\n\techo '<p class=\"sdm_downloads_count\">' . $wpdb->num_rows . '</p>';\n    }\n}\n\n// Adjust admin column widths\nadd_action('admin_head', 'sdm_admin_column_width'); // Adjust column width in admin panel\n\nfunction sdm_admin_column_width() {\n\n    echo '<style type=\"text/css\">';\n    echo '.column-sdm_downloads_thumbnail { width:75px !important; overflow:hidden }';\n    echo '.column-sdm_downloads_id { width:100px !important; overflow:hidden }';\n    echo '.column-taxonomy-sdm_categories { width:200px !important; overflow:hidden }';\n    echo '.column-taxonomy-sdm_tags { width:200px !important; overflow:hidden }';\n    echo '</style>';\n}\n\n/*\n * * Register Tinymce Button\n */\n\n// First check if option is checked to disable tinymce button\n$main_option = get_option('sdm_downloads_options');\n$tiny_button_option = isset($main_option['admin_tinymce_button']);\nif ($tiny_button_option != true) {\n\n// Okay.. we're good.  Add the button.\n    add_action('init', 'sdm_downloads_tinymce_button');\n\n    function sdm_downloads_tinymce_button() {\n\n\tadd_filter('mce_external_plugins', 'sdm_downloads_add_button');\n\tadd_filter('mce_buttons', 'sdm_downloads_register_button');\n    }\n\n    function sdm_downloads_add_button($plugin_array) {\n\n\t$plugin_array['sdm_downloads'] = WP_SIMPLE_DL_MONITOR_URL . '/tinymce/sdm_editor_plugin.js';\n\treturn $plugin_array;\n    }\n\n    function sdm_downloads_register_button($buttons) {\n\n\t$buttons[] = 'sdm_downloads';\n\treturn $buttons;\n    }\n\n}\n", "=== Simple Download Monitor ===\nContributors: Tips and Tricks HQ, Ruhul Amin, josh401, mbrsolution, alexanderfoxc\nDonate link: https://www.tipsandtricks-hq.com\nTags: download, downloads, count, counter, tracker, tracking, hits, logging, monitor, manager, files, media, digital, download monitor, download manager, downloadmanager, file manager, protect downloads, password, download category, file tree, ajax, download template, grid, documents, ip address\nRequires at least: 4.1.0\nTested up to: 4.9\nStable tag: 3.5.3\nLicense: GPLv2 or later\n\nEasily manage downloadable files and monitor downloads of your digital files from your WordPress site.\n\n== Description ==\n\nI developed the Simple Download Monitor plugin because I needed a nice way to manage my digital downloads and monitor the number of downloads of my files and documents.\n\nThis plugin is very useful for managing and tracking your digital file download counts. \n\nYou can password protect your downloadable files and documents too (visitors will require a password before downloading the file when you use this option).\n\nThere is an option to show an ajax file tree browser so your visitors can browse all your files and download the ones they want.\n\nYou can configure downloadable files from your WordPress admin dashboard via an elegant user interface. Then allow your visitors to download the files and this plugin will monitor which files get downloaded how many times.\n\nThe plugin will log the IP addresses of the users who download your digital files and documents. It will also log the date and time of each download.\n\nIt has a very user-friendly interface for uploading, managing, monitoring and tracking file downloads.\n\nhttps://www.youtube.com/watch?v=utYIH0fILuQ\n\n= Simple Download Monitor Features =\n\n* Add, edit and remove downloads from an easy to use interface.\n* Drag and drop file and document uploads.\n* Assign categories and tags to your downloadable files and documents.\n* Rich text editor for editing your download item description.\n* Use shortcodes to display a download now button on a WordPress post or page.\n* Show trackable download now buttons for your files anywhere on your site.\n* Shortcode to create a direct download link for a file. Useful for hotlinking.\n* Download counter for each file.\n* Ability to set a download count offset for each file.\n* Track IP addresses of the users who downloaded your files.\n* Track date and time of each file downloads.\n* Track the usernames of the users downloading the files.\n* Option to setup secure downloads for your files (the URL of the downloadable file will be hidden).\n* Option to upload a thumbnail image for each of your downloadable files.\n* Option to use a nice looking template to show your download now buttons.\n* Ability to search and sort your downloadable files in the admin dashboard.\n* Ability to create a search page and allow your visitors to search your downloads.\n* Track the number of downloads for each of your files.\n* Track the visitors country.\n* View the daily download counts of your items in a chart.\n* WordPress Shortcode for embedding a download link for a file.\n* Tinymce button in the WordPress post/page editor so you can easily add the shortcode.\n* You can customize the \"Download Now\" button text of an item to anything you want.\n* Ability to add the download now buttons to your sidebar widget.\n* Create password protected download now buttons. Users will only be able to download the file if they enter the correct password. [View the tutorial](https://www.tipsandtricks-hq.com/create-a-password-protected-download-file-6838)\n* Shortcode to show the download counter of a file. Use it to show off your file download count.\n* Shortcode to show all the downloads from a particular category.\n* Shortcode to embed a file tree browser for your downloadable files. The file browser is ajax based and it shows the files structured by categories.\n* Ability to open the downloads in new browser window or tab. When your users click on a download button, it will open in a new window or tab.\n* Ability to show your downloads in a grid display. [View the tutorial](https://www.tipsandtricks-hq.com/show-file-downloads-in-a-nice-grid-display-7273)\n* Export all the file download logs to a CSV file.\n* Ability to reset the log entries.\n* Shortcode to show a number of latest downloads to your visitors.\n* Ability to disable the download monitoring (logging) for certain items (or all items).\n* You can also choose to only monitor downloads from unique IP address only.\n* Option to specify file size info so it can be shown to your visitors. [View the tutorial](https://simple-download-monitor.com/how-to-show-file-size-info-of-your-downloads/)\n* Option to specify version number info for the download item so it can be shown to your visitors.\n* Option to restrict downloads to logged-in users only.\n* Option to ignore download count from bots.\n\nView more details on the [download monitor plugin](https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin) page.\n\n= Language Translations =\n\nThe following language translations are already available for the download monitor plugin:\n\n* English\n* German\n* Spanish\n* French\n* Italian\n* Russian\n* Dutch\n* Portuguese (Brasil)\n\n= Simple Download Monitor Plugin Usage =\n\nOnce you have installed the plugin, go to \"Downloads -> Settings\" interface to configure some options\n\n**A) Configure Download Monitor basic settings**\n\n* Admin Options: Remove Tinymce Button - Removes the SDM Downloads button from the WP content editor (default: unchecked).\n* Color Options: Download Button Color - Select a default color of the download button (default: green).\n\n**B) Add a new download**\n\nTo configure a new download follow these steps:\n\n1. Go to \"Downloads->Add New\" interface in your WP admin\n1. Enter a title for your download\n1. Add a description for the download\n1. Select the file from your computer and upload it (or use an URL of the file)\n1. Select an image for the download (it will be displayed as a thumbnail on the front end)\n1. Publish it\n\nYou can view all of your existing downloads from the \"Downloads->Downloads\" interface.\n\n**C) Create a download button**\n\nCreate a new post/page and click the \"SDM Downlaods\" TinyMCE button to insert a shortcode (This button will only show up if you haven't unchecked it in the settings). You can choose to display your download with a nice looking box or just a plain download link/button. \n\nExample Shortcode Usage:\n\n`[sdm_download id=\"271\" fancy=\"1\"]`  (embed a download button inside a box with other information e.g. Thumbnail, Title and Description)\n\n`[sdm_download id=\"271\" fancy=\"0\"]`  (embed a plain download button/link for a file)\n\n`[sdm_download id=\"271\" fancy=\"0\" color=\"blue\"]`  (embed a plain download button/link for a file with a blue color)\n\n**D) Download logs**\n\nYou can check the download stats from the \"Downloads->Logs\" interface. It shows the number of downloads for each files, IP address of the user who downloaded it, date and time of the download.\n\n** Detailed Usage Documentation **\n\nView more usage instructions on the [Download Monitor Plugin](https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin) page.\n\n** Github Repository **\n\nhttps://github.com/Arsenal21/simple-download-monitor\n\nIf you need extra action hooks or filters for this plugin then let us know.\n\n== Installation ==\n\n1. Go to the Add New plugins screen in your WordPress admin area\n1. Click the upload tab\n1. Browse for the plugin file (simple-download-monitor.zip)\n1. Click Install Now and then activate the plugin\n\n== Frequently Asked Questions ==\n\n= Can this plugin be used to offer free downloads to the users? =\nYes.\n\n= What file formats can I upload? =\nYou can pretty much upload all common file types.\n\n= Can I use external file URLs? = \nYes, you can use both local paths and external URLs.\n\n= Can I password protect a downloadable file? = \nYes.\n\n= Can I show the file download counts to my visitors? =\nYes.\n\n= Can I show all downloads from a category? =\nYes.\n\n= Can I show an ajax file tree browser using this plugin? =\nYes.\n\n= Can I show a number of latest downloads to my usrs? =\nYes.\n\n= Can I track downloads from unique IP address only? =\nYes\n\n== Screenshots ==\n\nFor screenshots please visit the [download monitor plugin page](https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin)\n\n== Changelog ==\n\n= 3.5.3 =\n- Added \"Text Domain\" and \"Domain Path\" to the File Header.\n\n= 3.5.2 =\n- Renamed the \"langs\" folder to \"languages\"\n\n= 3.5.1 = \n- Added a few more user-agents check in the is_bot function.\n- Search shortcode has been improved so it performs the search using each keyword of a multi-word search phrase. It will ignore any word that are less than 4 characters long.\n- Includes some missing translation strings to the POT file.\n\n= 3.5.0 =\n- Added check for a couple of user-agents in the is_bot function.\n- Added a filter that can be used to override what you consider bot via your own custom function.\n\n= 3.4.9 =\n- Added a new option in the settings menu to ignore downloads from bots. The name of the new settings field is \"Do Not Count Downloads from Bots\".\n- Updated the settings menu slug to make it unique.\n- Enhancement to the password protected download function.\n\n= 3.4.8 =\n- Fixed an issue with the shortcode inserter interface showing the last 5 items only.\n- The \"show_size\" shortcode parameter will work correctly with the fancy template now.\n\n= 3.4.7 =\n- Reworked the file upload interface to make it more user-friendly. \n- Delete plugin Data button now also deletes taxonomies and rewrite rules related to plugin.\n\n= 3.4.6 =\n- Added option to delete plugin's settings, data and tables from database.\n- Added \"Login Page URL\" option to optionally specify a login page URL when user is required to be logged in to download.\n\n= 3.4.5 =\n- Updated the slug of the new stats menu in this plugin so it doesn't conflict with jetpack's stat menu.\n\n= 3.4.4 =\n- Added \"Stats\" menu in the plugin that shows download count using a chart.\n- Removed the \"modal\" class definition from the admin CSS file.\n\n= 3.4.3 =\n- The [sdm_search_form] can take the fancy template as a shortcode argument to display the search result using that template.\n\n= 3.4.2 =\n- Added a new option \"Only Allow Logged-in Users to Download\".\n- Added [sdm_search_form] shortcode to display a search form for searching SDM downloads only.\n\n= 3.4.1 =\n- The password protected download button will use the \"button_text\" specified in the shortcode (if any).\n- The download now log will track WP eMember plugin username if the user is logged in as a member.\n\n= 3.4.0 =\n- Added a new hook to allow plugin extensions to hook into download request handling.\n- Added empty index file to the plugin folder.\n- Fixed potential XSS vulnerability. Thanks to Neven Biruski (Defensecode) for pointing it out.\n- Minor typo fix.\n\n= 3.3.7 =\n- Added an improvement for the password protected download. If a user goes directly to the download link without entering a password, it will point the users to go to a page where they can enter a password for the download item.\n\n= 3.3.6 =\n- Fix fancy template shortcode attributes: some shortcode attributes were ignored in the previous release.\n\n= 3.3.5 =\n- Download button color can now be specified in the shortcode for fancy 1 and the standard download button.\n- Added clearfix to .sdm_download_link container for better rendering in mobile devices.\n- The button text color CSS has been sharpened a little to make it look nicer.\n- Fixed an undefined variable notice.\n- Updated TinyMCE button icon to a better one.\n- Minimum WordPress version requirement changed to WP4.1\n\n= 3.3.4 =\n- Replace deprecated get_currentuserinfo() with wp_get_current_user()\n- Improve remote IP and location detection\n- Added a new shortcode to show a simple list of the download categories\n- Fix: avoid undefined variable notices in sdm_pop_cats_ajax_call()\n\n= 3.3.3 =\n- New feature - local download items can now be dispatched via PHP. This way, the actual URL of the downloaded file is not exposed (offers secure download).\n- Minimum required WP version raised to WordPress v3.3\n- WordPress 4.6 compatibility.\n\n= 3.3.2 =\n- Added an option to specify the file size info when editing the item. Size info can be shown in the fancy display template using a shortcode parameter (show_size).\n- Added an option to specify the version number info when editing the item. Version info can be shown in the fancy display template using a shortcode parameter (show_version).\n- Added French language translation. Translation file submitted by Laurent Jaunaux.\n- The stats metabox in the download edit page will now appear before the shortcodes metabox.\n- Added more usage instructions in the download file upload section.\n\n= 3.3.1 =\n- Added a new feature to hide the download counts that is shown in some of the fancy templates. This new option can be found in the settings menu of the plugin.\n- Added delete confirm dialogue in the individual download logs delete option.\n- Simplified the settings menu page style.\n- Fixed multiple vulnerabilities (thanks to NCSC-NL).\n\n= 3.3.0 =\n- Better implementation of the export log data to CSV file.\n- Added a new filter in the download logs menu so the items per page value can be customized.\n- Fixed a bug in the logs menu sorting. Sorting for some columns weren't working correctly.\n- Added sanitization for the order and orderby columns in the logs list table.\n- Added sanitization for the log entry delete functionality.\n\n= 3.2.9 =\n- Renamed the label of categories and tags of this plugin to \"Download Categories\" and \"Download Tags\".\n- Better implementation of password protected download items. The ajax method of checking password has been completely replaced with a more robust implementation.\n- Fixed a bug with the remove thumbnail ajax query.\n- Thanks to @James Golovich for pointing out the issues.\n\n= 3.2.8 =\n- WordPress 4.4 compatibility.\n\n= 3.2.7 =\n- Added a new feature to specify the new window parameter when using the shortcode inserter (from TinyMCE).\n- Minor CSS style fix for the \"Logs\" interface.\n- The log entries will be sorted by \"date\" field (by default).\n\n= 3.2.6 =\n- The language slug has been changed to \"simple-download-monitor\" so it can be imported to the WordPress language pack.\n\n= 3.2.5 =\n- Modified the 'sdm_download_shortcode_output' filter to pass the arguments array also (allows greater customization option via this filter).\n- Added a new option to show X number of latest downloads from a specified category.\n\n= 3.2.4 =\n- Added a new feature to show pagination in the display all downloads from a category shortcode.\n- Added validation checks while processing a download request to make sure the download item ID is valid and the item has a download link.\n\n= 3.2.3 =\n- Addressed some warning/notice messages that shows when debug is enabled.\n\n= 3.2.2 =\n- Added a new shortcode to create a direct download link for the file. Useful if you want to create a custom download link.\n- WordPress 4.2 compatibility.\n\n= 3.2.1 =\n- Fixed an issue with the ajax category browser shortcode.\n- Improved the ajax category downloads shortcode to show an up/down arrow icon next to the category name.\n\n= 3.2.0 =\n- Added a textbox to manually type in an image thumbnail URL when editing a download item.\n- Minor javascript improvements for the select and remove image option.\n- Improved the image thumbnail preview in the admin side.\n- Added placeholder text in the URL input fields.\n\n= 3.1.9 =\n- Fixed a compatibility issue with WooCommerce's latest release.\n\n= 3.1.8 =\n- Enabled shortcode filtering in standard text widget.\n- Fixed an intermittent issue with the rewrite rules flushing.\n\n= 3.1.7 =\n- Added Portuguese language translation. Translation file submitted by Visto Marketing.\n- New feature to disable the download monitoring (logging) for certain items (or all items).\n- New option to only monitor downloads from unique IP address only.\n\n= 3.1.6 =\n- Improved the queries in the \"Logs\" interface to be more efficient.\n- Added a new feature to reset/empty the download log entries. You can find it in the \"Logs\" menu of the plugin.\n\n= 3.1.5 =\n- Added Spanish language translation. Translation file submitted by Manuel.\n- Added Russian language translation. Translation file submitted by \u0411\u0430\u043b\u0430\u0448\u043e\u0432 \u0410\u043b\u0435\u043a\u0441.\n- Added Dutch language translation. Translation file submitted by Paul Tuinman.\n- Added a new feature to show X number of latest downloads.\n\n= 3.1.4 = \n- New feature to track the usernames of the WP Users downloading the files. You can view the username info in the \"Logs\" menu.\n- Enabled the \"View\" link in the all downloads list table.\n- Some refactoring work to move the admin menu handling code to a separate file.\n\n= 3.1.3 =\n- Added an option to use \"orderby\" and \"order\" parameters in the display downloads from a category shortcode to allow sorting the download items display list.\n- The download item description field has been converted to a rich text editor. So you can customize the download description with rich text.\n\n= 3.1.2 = \n- Removed the link from the download item name in the template 2 display.\n\n= 3.1.1 =\n- Fixed a bug with the file download password entry field.\n\n= 3.1 =\n- Added a new fancy template to display the downloads.\n- You can now show a grid display of your downloads.\n- Added some error validation in the download shortcode entry.\n- Refactored some code and added a couple of new filters.\n- Added CSS classes around the download count shortcode output.\n- Modified the styles of the simple downloads post type output.\n- The fancy 1 template now shows the download count of each item.\n- Updated the POT file for language translation.\n\n= 3.0 =\n* Added an option to specify a download count offset for each download. This will allow you to set a starting download count for each item. \n* Added a new parameter in the shortcode to allow customization of the button text. You can now customize the \"Download Now\" button text to anything you want from the shortcode.\n* Added a new parameter in the shortcode to allow opening the download in a new window or tab.\n\n= 2.9 =\n* Added visitor Country to database table; allowing tracking of each download visitors Country.\n* Visitor Country is also seen in the \"Logs\" page; can be sorted; and exported.\n\n= 2.8 = \n* Added the ability to use shortcodes in the description area of the downloads. For example: you can use the download counter shortcode in the description field to show the current counter to your visitors.\n* Bug-fix for the \"show downloads from a category\" shortcode. It will now correctly show all items in a download category.\n* Added a better dashicons icon for the downloads menu in the admin dashborad.\n\n= 2.7 =\n* Added a new feature to show an ajax file tree browser.\n* Added some missing translation strings in the plugin.\n* Added German language translation. Translation file submitted by Meinhard\n* Changed the password input field to a type of \"password\"\n* Fixed a minor but that would preven the \"view\" links from displaying in WordPress posts\n\n= 2.6 =\n* Added a new shortcode to show all downloads from a download category.\n* Added a filter to handle the URL of SDM downloads post type.\n\n= 2.5 =\n* Added a new feature to password protect a downloadable file.\n* Added a new shortcode to show the download count to your visitors.\n\n= 2.4 =\n* Fixed an issue with file download using external file URL.\n\n= 2.3 =\n* Wordpress 3.8 compatibility\n\n= 2.2 =\n* Fixed the plugin language translation issue. Now it can be translated to any language.\n\n= 2.1 = \n* Minor bug fixes with the stylesheet file URL.\n\n= 2.0 =\n* Complete new architecture for the download monitor plugin\n* You can download the old version with old architecture here:\nhttp://wordpress.org/plugins/simple-download-monitor/developers/\n\n== Upgrade Notice ==\n\nDownload monitor 2.0 uses a completely new architecture (it is much simpler and user friendly) for configuring and monitoring downloads. Read the usage section to understand how it works.\n"], "fixing_code": ["<?php\n/**\n * Plugin Name: Simple Download Monitor\n * Plugin URI: https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin\n * Description: Easily manage downloadable files and monitor downloads of your digital files from your WordPress site.\n * Version: 3.5.4\n * Author: Tips and Tricks HQ, Ruhul Amin, Josh Lobe\n * Author URI: https://www.tipsandtricks-hq.com/development-center\n * License: GPL2\n * Text Domain: simple-download-monitor\n * Domain Path: /languages/\n */\n\nif (!defined('ABSPATH')) {\n    exit;\n}\n\ndefine('WP_SIMPLE_DL_MONITOR_VERSION', '3.5.4');\ndefine('WP_SIMPLE_DL_MONITOR_DIR_NAME', dirname(plugin_basename(__FILE__)));\ndefine('WP_SIMPLE_DL_MONITOR_URL', plugins_url('', __FILE__));\ndefine('WP_SIMPLE_DL_MONITOR_PATH', plugin_dir_path(__FILE__));\ndefine('WP_SIMPLE_DL_MONITOR_SITE_HOME_URL', home_url());\ndefine('WP_SDM_LOG_FILE', WP_SIMPLE_DL_MONITOR_PATH . 'sdm-debug-log.txt');\n\nglobal $sdm_db_version;\n$sdm_db_version = '1.2';\n\n//File includes\ninclude_once('includes/sdm-debug.php');\ninclude_once('includes/sdm-utility-functions.php');\ninclude_once('includes/sdm-utility-functions-admin-side.php');\ninclude_once('includes/sdm-download-request-handler.php');\ninclude_once('includes/sdm-logs-list-table.php');\ninclude_once('includes/sdm-latest-downloads.php');\ninclude_once('includes/sdm-search-shortcode-handler.php');\ninclude_once('sdm-post-type-and-taxonomy.php');\ninclude_once('sdm-shortcodes.php');\ninclude_once('sdm-post-type-content-handler.php');\n\n//Activation hook handler\nregister_activation_hook(__FILE__, 'sdm_install_db_table');\n\nfunction sdm_install_db_table() {\n\n    global $wpdb;\n    global $sdm_db_version;\n    $table_name = $wpdb->prefix . 'sdm_downloads';\n\n    $sql = 'CREATE TABLE ' . $table_name . ' (\n\t\t\t  id mediumint(9) NOT NULL AUTO_INCREMENT,\n\t\t\t  post_id mediumint(9) NOT NULL,\n\t\t\t  post_title mediumtext NOT NULL,\n\t\t\t  file_url mediumtext NOT NULL,\n\t\t\t  visitor_ip mediumtext NOT NULL,\n\t\t\t  date_time datetime DEFAULT \"0000-00-00 00:00:00\" NOT NULL,\n\t\t\t  visitor_country mediumtext NOT NULL,\n\t\t\t  visitor_name mediumtext NOT NULL,\n\t\t\t  UNIQUE KEY id (id)\n\t\t);';\n\n    require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );\n    dbDelta($sql);\n\n    update_option('sdm_db_version', $sdm_db_version);\n\n    //Register the post type so you can flush the rewrite rules\n    sdm_register_post_type();\n\n    // Flush rules after install/activation\n    flush_rewrite_rules();\n}\n\n/*\n * * Handle Plugins loaded tasks\n */\nadd_action('plugins_loaded', 'sdm_plugins_loaded_tasks');\n\nfunction sdm_plugins_loaded_tasks() {\n    //Load language\n    load_plugin_textdomain('simple-download-monitor', false, dirname(plugin_basename(__FILE__)) . '/langs/');\n\n    //Handle db upgrade stuff\n    sdm_db_update_check();\n}\n\n/*\n * * Handle Generic Init tasks\n */\nadd_action('init', 'sdm_init_time_tasks');\nadd_action('admin_init', 'sdm_admin_init_time_tasks');\n\nfunction sdm_init_time_tasks() {\n    //Handle download request if any\n    handle_sdm_download_via_direct_post();\n    if (is_admin()) {\n\t//Register Google Charts library\n\twp_register_script('sdm_google_charts', 'https://www.gstatic.com/charts/loader.js', array(), null, true);\n\twp_register_style('sdm_jquery_ui_style', WP_SIMPLE_DL_MONITOR_URL . '/css/jquery.ui.min.css', array(), null, 'all');\n    }\n}\n\nfunction sdm_admin_init_time_tasks() {\n    //Register ajax handlers\n    add_action('wp_ajax_sdm_reset_log', 'sdm_reset_log_handler');\n    add_action('wp_ajax_sdm_delete_data', 'sdm_delete_data_handler');\n\n    if (is_admin()) {\n\tif (user_can(wp_get_current_user(), 'administrator')) {\n\t    // user is an admin\n\t    if (isset($_GET['sdm-action'])) {\n\t\tif ($_GET['sdm-action'] === 'view_log') {\n\t\t    $logfile = fopen(WP_SDM_LOG_FILE, 'rb');\n\t\t    header('Content-Type: text/plain');\n\t\t    fpassthru($logfile);\n\t\t    die;\n\t\t}\n\t    }\n\t}\n    }\n}\n\nfunction sdm_reset_log_handler() {\n    SDM_Debug::reset_log();\n    echo '1';\n    wp_die();\n}\n\nfunction sdm_delete_data_handler() {\n    if (!check_ajax_referer('sdm_delete_data', 'nonce', false)) {\n\t//nonce check failed\n\twp_die(0);\n    }\n    global $wpdb;\n    //let's find and delete smd_download posts and meta\n    $posts = $wpdb->get_results('SELECT id FROM ' . $wpdb->prefix . 'posts WHERE post_type=\"sdm_downloads\"', ARRAY_A);\n    if (!is_null($posts)) {\n\tforeach ($posts as $post) {\n\t    wp_delete_post($post['id'], true);\n\t}\n    }\n    //let's delete options\n    delete_option('sdm_downloads_options');\n    delete_option('sdm_db_version');\n    //remove post type and taxonomies\n    unregister_post_type('sdm_downloads');\n    unregister_taxonomy('sdm_categories');\n    unregister_taxonomy('sdm_tags');\n    //let's delete sdm_downloads table\n    $wpdb->query(\"DROP TABLE \" . $wpdb->prefix . \"sdm_downloads\");\n    //deactivate plugin\n    deactivate_plugins(plugin_basename(__FILE__));\n    //flush rewrite rules\n    flush_rewrite_rules(false);\n    echo '1';\n    wp_die();\n}\n\n/*\n * DB upgrade check\n */\n\nfunction sdm_db_update_check() {\n    if (is_admin()) {//Check if DB needs to be upgraded\n\tglobal $sdm_db_version;\n\t$inst_db_version = get_option('sdm_db_version');\n\tif ($inst_db_version != $sdm_db_version) {\n\t    sdm_install_db_table();\n\t}\n    }\n}\n\n/*\n * * Add a 'Settings' link to plugins list page\n */\nadd_filter('plugin_action_links', 'sdm_settings_link', 10, 2);\n\nfunction sdm_settings_link($links, $file) {\n    static $this_plugin;\n    if (!$this_plugin)\n\t$this_plugin = plugin_basename(__FILE__);\n    if ($file == $this_plugin) {\n\t$settings_link = '<a href=\"edit.php?post_type=sdm_downloads&page=sdm-settings\" title=\"SDM Settings Page\">' . __(\"Settings\", 'simple-download-monitor') . '</a>';\n\tarray_unshift($links, $settings_link);\n    }\n    return $links;\n}\n\n// Houston... we have lift-off!!\nclass simpleDownloadManager {\n\n    public function __construct() {\n\n\tadd_action('init', 'sdm_register_post_type');  // Create 'sdm_downloads' custom post type\n\tadd_action('init', 'sdm_create_taxonomies');  // Register 'tags' and 'categories' taxonomies\n\tadd_action('init', 'sdm_register_shortcodes'); //Register the shortcodes\n\tadd_action('wp_enqueue_scripts', array($this, 'sdm_frontend_scripts'));  // Register frontend scripts\n\n\tif (is_admin()) {\n\t    add_action('admin_menu', array($this, 'sdm_create_menu_pages'));  // Create admin pages\n\t    add_action('add_meta_boxes', array($this, 'sdm_create_upload_metabox'));  // Create metaboxes\n\n\t    add_action('save_post', array($this, 'sdm_save_description_meta_data'));  // Save 'description' metabox\n\t    add_action('save_post', array($this, 'sdm_save_upload_meta_data'));  // Save 'upload file' metabox\n\t    add_action('save_post', array($this, 'sdm_save_dispatch_meta_data'));  // Save 'dispatch' metabox\n\t    add_action('save_post', array($this, 'sdm_save_thumbnail_meta_data'));  // Save 'thumbnail' metabox\n\t    add_action('save_post', array($this, 'sdm_save_statistics_meta_data'));  // Save 'statistics' metabox\n\t    add_action('save_post', array($this, 'sdm_save_other_details_meta_data'));  // Save 'other details' metabox\n\n\t    add_action('admin_enqueue_scripts', array($this, 'sdm_admin_scripts'));  // Register admin scripts\n\t    add_action('admin_print_styles', array($this, 'sdm_admin_styles'));  // Register admin styles\n\n\t    add_action('admin_init', array($this, 'sdm_register_options'));  // Register admin options\n\t    //add_filter('post_row_actions', array($this, 'sdm_remove_view_link_cpt'), 10, 2);  // Remove 'View' link in all downloads list view\n\t}\n    }\n\n    public function sdm_admin_scripts() {\n\n\tglobal $current_screen, $post;\n\n\tif (is_admin() && $current_screen->post_type == 'sdm_downloads' && $current_screen->base == 'post') {\n\n\t    // These scripts are needed for the media upload thickbox\n\t    wp_enqueue_script('media-upload');\n\t    wp_enqueue_script('thickbox');\n\t    wp_register_script('sdm-upload', WP_SIMPLE_DL_MONITOR_URL . '/js/sdm_admin_scripts.js', array('jquery', 'media-upload', 'thickbox'), WP_SIMPLE_DL_MONITOR_VERSION);\n\t    wp_enqueue_script('sdm-upload');\n\n\t    // Pass postID for thumbnail deletion\n\t    ?>\n\t    <script type=\"text/javascript\">\n\t        var sdm_del_thumb_postid = '<?php echo $post->ID; ?>';\n\t    </script>\n\t    <?php\n\t    // Localize langauge strings used in js file\n\t    $sdmTranslations = array(\n\t\t'select_file' => __('Select File', 'simple-download-monitor'),\n\t\t'select_thumbnail' => __('Select Thumbnail', 'simple-download-monitor'),\n\t\t'insert' => __('Insert', 'simple-download-monitor'),\n\t\t'image_removed' => __('Image Successfully Removed', 'simple-download-monitor'),\n\t\t'ajax_error' => __('Error with AJAX', 'simple-download-monitor')\n\t    );\n\t    wp_localize_script('sdm-upload', 'sdm_translations', $sdmTranslations);\n\t}\n\n\t// Pass admin ajax url\n\t?>\n\t<script type=\"text/javascript\">\n\t    var sdm_admin_ajax_url = {sdm_admin_ajax_url: '<?php echo admin_url('admin-ajax.php?action=ajax'); ?>'};\n\t    var sdm_plugin_url = '<?php echo plugins_url(); ?>';\n\t    var tinymce_langs = {\n\t\tselect_download_item: '<?php _e('Please select a Download Item:', 'simple-download-monitor') ?>',\n\t\tdownload_title: '<?php _e('Download Title', 'simple-download-monitor') ?>',\n\t\tinclude_fancy: '<?php _e('Include Fancy Box', 'simple-download-monitor') ?>',\n\t\topen_new_window: '<?php _e('Open New Window', 'simple-download-monitor') ?>',\n\t\tbutton_color: '<?php _e('Button Color', 'simple-download-monitor'); ?>',\n\t\tinsert_shortcode: '<?php _e('Insert SDM Shortcode', 'simple-download-monitor') ?>'\n\t    };\n\t    var sdm_button_colors = <?php echo wp_json_encode(sdm_get_download_button_colors()); ?>;\n\t</script>\n\t<?php\n    }\n\n    public function sdm_frontend_scripts() {\n\t//Use this function to enqueue fron-end js scripts.\n\twp_enqueue_style('sdm-styles', WP_SIMPLE_DL_MONITOR_URL . '/css/sdm_wp_styles.css');\n\twp_register_script('sdm-scripts', WP_SIMPLE_DL_MONITOR_URL . '/js/sdm_wp_scripts.js', array('jquery'));\n\twp_enqueue_script('sdm-scripts');\n\n\t// Localize ajax script for frontend\n\twp_localize_script('sdm-scripts', 'sdm_ajax_script', array('ajaxurl' => admin_url('admin-ajax.php')));\n    }\n\n    public function sdm_admin_styles() {\n\n\twp_enqueue_style('thickbox');  // Needed for media upload thickbox\n\twp_enqueue_style('sdm_admin_styles', WP_SIMPLE_DL_MONITOR_URL . '/css/sdm_admin_styles.css', array(), WP_SIMPLE_DL_MONITOR_VERSION);  // Needed for media upload thickbox\n    }\n\n    public function sdm_create_menu_pages() {\n\tinclude_once('includes/sdm-admin-menu-handler.php');\n\tsdm_handle_admin_menu();\n    }\n\n    public function sdm_create_upload_metabox() {\n\n\t//*****  Create metaboxes for the custom post type\n\tadd_meta_box('sdm_description_meta_box', __('Description', 'simple-download-monitor'), array($this, 'display_sdm_description_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_upload_meta_box', __('Downloadable File (Visitors will download this item)', 'simple-download-monitor'), array($this, 'display_sdm_upload_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_dispatch_meta_box', __('PHP Dispatch or Redirect', 'simple-download-monitor'), array($this, 'display_sdm_dispatch_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_thumbnail_meta_box', __('File Thumbnail (Optional)', 'simple-download-monitor'), array($this, 'display_sdm_thumbnail_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_stats_meta_box', __('Statistics', 'simple-download-monitor'), array($this, 'display_sdm_stats_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_other_details_meta_box', __('Other Details (Optional)', 'simple-download-monitor'), array($this, 'display_sdm_other_details_meta_box'), 'sdm_downloads', 'normal', 'default');\n\tadd_meta_box('sdm_shortcode_meta_box', __('Shortcodes', 'simple-download-monitor'), array($this, 'display_sdm_shortcode_meta_box'), 'sdm_downloads', 'normal', 'default');\n    }\n\n    public function display_sdm_description_meta_box($post) {  // Description metabox\n\t_e('Add a description for this download item.', 'simple-download-monitor');\n\techo '<br /><br />';\n\n\t$old_description = get_post_meta($post->ID, 'sdm_description', true);\n\t$sdm_description_field = array('textarea_name' => 'sdm_description');\n\twp_editor($old_description, \"sdm_description_editor_content\", $sdm_description_field);\n\n\twp_nonce_field('sdm_description_box_nonce', 'sdm_description_box_nonce_check');\n    }\n\n    public function display_sdm_upload_meta_box($post) {  // File Upload metabox\n\t$old_upload = get_post_meta($post->ID, 'sdm_upload', true);\n\t$old_value = isset($old_upload) ? $old_upload : '';\n\n\t_e('Manually enter a valid URL of the file in the text box below, or click \"Select File\" button to upload (or choose) the downloadable file.', 'simple-download-monitor');\n\techo '<br /><br />';\n\n\techo '<div class=\"sdm-download-edit-file-url-section\">';\n\techo '<input id=\"sdm_upload\" type=\"text\" size=\"100\" name=\"sdm_upload\" value=\"' . esc_url($old_value) . '\" placeholder=\"http://...\" />';\n\techo '</div>';\n\n\techo '<br />';\n\techo '<input id=\"upload_image_button\" type=\"button\" class=\"button-primary\" value=\"' . __('Select File', 'simple-download-monitor') . '\" />';\n\n\techo '<br /><br />';\n\t_e('Steps to upload a file or choose one from your media library:', 'simple-download-monitor');\n\techo '<ol>';\n\techo '<li>Hit the \"Select File\" button.</li>';\n\techo '<li>Upload a new file or choose an existing one from your media library.</li>';\n\techo '<li>Click the \"Insert\" button, this will populate the uploaded file\\'s URL in the above text field.</li>';\n\techo '</ol>';\n\n\twp_nonce_field('sdm_upload_box_nonce', 'sdm_upload_box_nonce_check');\n    }\n\n    public function display_sdm_dispatch_meta_box($post) {\n\t$dispatch = get_post_meta($post->ID, 'sdm_item_dispatch', true);\n\n\tif ($dispatch === '') {\n\t    // No value yet (either new item or saved with older version of plugin)\n\t    $screen = get_current_screen();\n\n\t    if ($screen->action === 'add') {\n\t\t// New item: set default value as per plugin settings.\n\t\t$main_opts = get_option('sdm_downloads_options');\n\t\t$dispatch = isset($main_opts['general_default_dispatch_value']) && $main_opts['general_default_dispatch_value'];\n\t    }\n\t}\n\n\techo '<input id=\"sdm_item_dispatch\" type=\"checkbox\" name=\"sdm_item_dispatch\" value=\"yes\"' . checked(true, $dispatch, false) . ' />';\n\techo '<label for=\"sdm_item_dispatch\">' . __('Dispatch the file via PHP directly instead of redirecting to it. PHP Dispatching keeps the download URL hidden. Dispatching works only for local files (files that you uploaded to this site via this plugin or media library).', 'simple-download-monitor') . '</label>';\n\n\twp_nonce_field('sdm_dispatch_box_nonce', 'sdm_dispatch_box_nonce_check');\n    }\n\n    public function display_sdm_thumbnail_meta_box($post) {  // Thumbnail upload metabox\n\t$old_thumbnail = get_post_meta($post->ID, 'sdm_upload_thumbnail', true);\n\t$old_value = isset($old_thumbnail) ? $old_thumbnail : '';\n\t_e('Manually enter a valid URL, or click \"Select Image\" to upload (or choose) the file thumbnail image.', 'simple-download-monitor');\n\t?>\n\t<br /><br />\n\t<input id=\"sdm_upload_thumbnail\" type=\"text\" size=\"100\" name=\"sdm_upload_thumbnail\" value=\"<?php echo esc_url($old_value); ?>\" placeholder=\"http://...\" />\n\t<br /><br />\n\t<input id=\"upload_thumbnail_button\" type=\"button\" class=\"button-primary\" value=\"<?php _e('Select Image', 'simple-download-monitor'); ?>\" />\n\t<input id=\"remove_thumbnail_button\" type=\"button\" class=\"button\" value=\"<?php _e('Remove Image', 'simple-download-monitor'); ?>\" />\n\t<br /><br />\n\n\t<span id=\"sdm_admin_thumb_preview\">\n\t    <?php\n\t    if (!empty($old_value)) {\n\t\t?><img id=\"sdm_thumbnail_image\" src=\"<?php echo $old_value; ?>\" style=\"max-width:200px;\" />\n\t\t<?php\n\t    }\n\t    ?>\n\t</span>\n\n\t<?php\n\techo '<p class=\"description\">';\n\t_e('This thumbnail image will be used to create a fancy file download box if you want to use it.', 'simple-download-monitor');\n\techo '</p>';\n\n\twp_nonce_field('sdm_thumbnail_box_nonce', 'sdm_thumbnail_box_nonce_check');\n    }\n\n    public function display_sdm_stats_meta_box($post) {  //Stats metabox\n\t$old_count = get_post_meta($post->ID, 'sdm_count_offset', true);\n\t$value = isset($old_count) && $old_count != '' ? $old_count : '0';\n\n\t// Get checkbox for \"disable download logging\"\n\t$no_logs = get_post_meta($post->ID, 'sdm_item_no_log', true);\n\t$checked = isset($no_logs) && $no_logs === 'on' ? 'checked=\"checked\"' : '';\n\n\t_e('These are the statistics for this download item.', 'simple-download-monitor');\n\techo '<br /><br />';\n\n\tglobal $wpdb;\n\t$wpdb->get_results($wpdb->prepare('SELECT * FROM ' . $wpdb->prefix . 'sdm_downloads WHERE post_id=%s', $post->ID));\n\n\techo '<div class=\"sdm-download-edit-dl-count\">';\n\t_e('Number of Downloads:', 'simple-download-monitor');\n\techo ' <strong>' . $wpdb->num_rows . '</strong>';\n\techo '</div>';\n\n\techo '<div class=\"sdm-download-edit-offset-count\">';\n\t_e('Offset Count: ', 'simple-download-monitor');\n\techo '<br />';\n\techo ' <input type=\"text\" size=\"10\" name=\"sdm_count_offset\" value=\"' . esc_attr($value) . '\" />';\n\techo '<p class=\"description\">' . __('Enter any positive or negative numerical value; to offset the download count shown to the visitors (when using the download counter shortcode).', 'simple-download-monitor') . '</p>';\n\techo '</div>';\n\n\techo '<br />';\n\techo '<div class=\"sdm-download-edit-disable-logging\">';\n\techo '<input type=\"checkbox\" name=\"sdm_item_no_log\" ' . $checked . ' />';\n\techo '<span style=\"margin-left: 5px;\"></span>';\n\t_e('Disable download logging for this item.', 'simple-download-monitor');\n\techo '</div>';\n\n\twp_nonce_field('sdm_count_offset_nonce', 'sdm_count_offset_nonce_check');\n    }\n\n    public function display_sdm_other_details_meta_box($post) { //Other details metabox\n\t$file_size = get_post_meta($post->ID, 'sdm_item_file_size', true);\n\t$file_size = isset($file_size) ? $file_size : '';\n\n\t$version = get_post_meta($post->ID, 'sdm_item_version', true);\n\t$version = isset($version) ? $version : '';\n\n\techo '<div class=\"sdm-download-edit-filesize\">';\n\t_e('File Size: ', 'simple-download-monitor');\n\techo '<br />';\n\techo ' <input type=\"text\" name=\"sdm_item_file_size\" value=\"' . esc_attr($file_size) . '\" size=\"20\" />';\n\techo '<p class=\"description\">' . __('Enter the size of this file (example value: 2.15 MB). You can show this value in the fancy display by using a shortcode parameter.', 'simple-download-monitor') . '</p>';\n\techo '</div>';\n\n\techo '<div class=\"sdm-download-edit-version\">';\n\t_e('Version: ', 'simple-download-monitor');\n\techo '<br />';\n\techo ' <input type=\"text\" name=\"sdm_item_version\" value=\"' . esc_attr($version) . '\" size=\"20\" />';\n\techo '<p class=\"description\">' . __('Enter the version number for this item if any (example value: v2.5.10). You can show this value in the fancy display by using a shortcode parameter.', 'simple-download-monitor') . '</p>';\n\techo '</div>';\n\n\twp_nonce_field('sdm_other_details_nonce', 'sdm_other_details_nonce_check');\n    }\n\n    public function display_sdm_shortcode_meta_box($post) {  //Shortcode metabox\n\t_e('The following shortcode can be used on posts or pages to embed a download now button for this file. You can also use the shortcode inserter (in the post editor) to add this shortcode to a post or page.', 'simple-download-monitor');\n\techo '<br />';\n\t$shortcode_text = '[sdm_download id=\"' . $post->ID . '\" fancy=\"0\"]';\n\techo \"<input type='text' class='code' onfocus='this.select();' readonly='readonly' value='\" . $shortcode_text . \"' size='40'>\";\n\techo \"<br /><br />\";\n\n\t_e('The following shortcode can be used to show a download counter for this item.', 'simple-download-monitor');\n\techo '<br />';\n\t$shortcode_text = '[sdm_download_counter id=\"' . $post->ID . '\"]';\n\techo \"<input type='text' class='code' onfocus='this.select();' readonly='readonly' value='\" . $shortcode_text . \"' size='40'>\";\n\n\techo '<br /><br />';\n\techo 'Read the full shortcode usage documentation <a href=\"https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin\" target=\"_blank\">here</a>.';\n    }\n\n    public function sdm_save_description_meta_data($post_id) {  // Save Description metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)\n\t    return;\n\tif (!isset($_POST['sdm_description_box_nonce_check']) || !wp_verify_nonce($_POST['sdm_description_box_nonce_check'], 'sdm_description_box_nonce'))\n\t    return;\n\n\tif (isset($_POST['sdm_description'])) {\n\t    update_post_meta($post_id, 'sdm_description', $_POST['sdm_description']);\n\t}\n    }\n\n    public function sdm_save_upload_meta_data($post_id) {  // Save File Upload metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)\n\t    return;\n\tif (!isset($_POST['sdm_upload_box_nonce_check']) || !wp_verify_nonce($_POST['sdm_upload_box_nonce_check'], 'sdm_upload_box_nonce'))\n\t    return;\n\n\tif (isset($_POST['sdm_upload'])) {\n\t    update_post_meta($post_id, 'sdm_upload', sanitize_text_field($_POST['sdm_upload']));\n\t}\n    }\n\n    public function sdm_save_dispatch_meta_data($post_id) { // Save \"Dispatch or Redirect\" metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {\n\t    return;\n\t}\n\tif (!isset($_POST['sdm_dispatch_box_nonce_check']) || !wp_verify_nonce($_POST['sdm_dispatch_box_nonce_check'], 'sdm_dispatch_box_nonce')) {\n\t    return;\n\t}\n\t// Get POST-ed data as boolean value\n\t$value = filter_input(INPUT_POST, 'sdm_item_dispatch', FILTER_VALIDATE_BOOLEAN);\n\tupdate_post_meta($post_id, 'sdm_item_dispatch', $value);\n    }\n\n    public function sdm_save_thumbnail_meta_data($post_id) {  // Save Thumbnail Upload metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)\n\t    return;\n\tif (!isset($_POST['sdm_thumbnail_box_nonce_check']) || !wp_verify_nonce($_POST['sdm_thumbnail_box_nonce_check'], 'sdm_thumbnail_box_nonce'))\n\t    return;\n\n\tif (isset($_POST['sdm_upload_thumbnail'])) {\n\t    update_post_meta($post_id, 'sdm_upload_thumbnail', sanitize_text_field($_POST['sdm_upload_thumbnail']));\n\t}\n    }\n\n    public function sdm_save_statistics_meta_data($post_id) {  // Save Statistics Upload metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)\n\t    return;\n\tif (!isset($_POST['sdm_count_offset_nonce_check']) || !wp_verify_nonce($_POST['sdm_count_offset_nonce_check'], 'sdm_count_offset_nonce'))\n\t    return;\n\n\tif (isset($_POST['sdm_count_offset']) && is_numeric($_POST['sdm_count_offset'])) {\n\n\t    update_post_meta($post_id, 'sdm_count_offset', $_POST['sdm_count_offset']);\n\t}\n\n\t// Checkbox for disabling download logging for this item\n\tif (isset($_POST['sdm_item_no_log'])) {\n\t    update_post_meta($post_id, 'sdm_item_no_log', $_POST['sdm_item_no_log']);\n\t} else {\n\t    delete_post_meta($post_id, 'sdm_item_no_log');\n\t}\n    }\n\n    public function sdm_save_other_details_meta_data($post_id) {  // Save Statistics Upload metabox\n\tif (defined('DOING_AUTOSAVE') && DOING_AUTOSAVE) {\n\t    return;\n\t}\n\tif (!isset($_POST['sdm_other_details_nonce_check']) || !wp_verify_nonce($_POST['sdm_other_details_nonce_check'], 'sdm_other_details_nonce')) {\n\t    return;\n\t}\n\n\tif (isset($_POST['sdm_item_file_size'])) {\n\t    update_post_meta($post_id, 'sdm_item_file_size', sanitize_text_field($_POST['sdm_item_file_size']));\n\t}\n\n\tif (isset($_POST['sdm_item_version'])) {\n\t    update_post_meta($post_id, 'sdm_item_version', sanitize_text_field($_POST['sdm_item_version']));\n\t}\n    }\n\n    public function sdm_remove_view_link_cpt($action, $post) {\n\n\t// Only execute on SDM CPT posts page\n\tif ($post->post_type == 'sdm_downloads') {\n\t    unset($action['view']);\n\t}\n\n\treturn $action;\n    }\n\n    public function sdm_register_options() {\n\n\t//Register the main setting\n\tregister_setting('sdm_downloads_options', 'sdm_downloads_options');\n\n\t//Add all the settings section that will go under the main settings\n\tadd_settings_section('general_options', __('General Options', 'simple-download-monitor'), array($this, 'general_options_cb'), 'general_options_section');\n\tadd_settings_section('admin_options', __('Admin Options', 'simple-download-monitor'), array($this, 'admin_options_cb'), 'admin_options_section');\n\tadd_settings_section('sdm_colors', __('Colors', 'simple-download-monitor'), array($this, 'sdm_colors_cb'), 'sdm_colors_section');\n\tadd_settings_section('sdm_debug', __('Debug', 'simple-download-monitor'), array($this, 'sdm_debug_cb'), 'sdm_debug_section');\n\tadd_settings_section('sdm_deldata', __('Delete Plugin Data', 'simple-download-monitor'), array($this, 'sdm_deldata_cb'), 'sdm_deldata_section');\n\n\t//Add all the individual settings fields that goes under the sections\n\tadd_settings_field('general_hide_donwload_count', __('Hide Download Count', 'simple-download-monitor'), array($this, 'hide_download_count_cb'), 'general_options_section', 'general_options');\n\tadd_settings_field('general_default_dispatch_value', __('PHP Dispatching', 'simple-download-monitor'), array($this, 'general_default_dispatch_value_cb'), 'general_options_section', 'general_options');\n\tadd_settings_field('only_logged_in_can_download', __('Only Allow Logged-in Users to Download', 'simple-download-monitor'), array($this, 'general_only_logged_in_can_download_cb'), 'general_options_section', 'general_options');\n\tadd_settings_field('general_login_page_url', __('Login Page URL', 'simple-download-monitor'), array($this, 'general_login_page_url_cb'), 'general_options_section', 'general_options');\n\n\tadd_settings_field('admin_tinymce_button', __('Remove Tinymce Button', 'simple-download-monitor'), array($this, 'admin_tinymce_button_cb'), 'admin_options_section', 'admin_options');\n\tadd_settings_field('admin_log_unique', __('Log Unique IP', 'simple-download-monitor'), array($this, 'admin_log_unique'), 'admin_options_section', 'admin_options');\n\tadd_settings_field('admin_dont_log_bots', __('Do Not Count Downloads from Bots', 'simple-download-monitor'), array($this, 'admin_dont_log_bots'), 'admin_options_section', 'admin_options');\n\tadd_settings_field('admin_no_logs', __('Disable Download Logs', 'simple-download-monitor'), array($this, 'admin_no_logs_cb'), 'admin_options_section', 'admin_options');\n\n\tadd_settings_field('download_button_color', __('Download Button Color', 'simple-download-monitor'), array($this, 'download_button_color_cb'), 'sdm_colors_section', 'sdm_colors');\n\n\tadd_settings_field('enable_debug', __('Enable Debug', 'simple-download-monitor'), array($this, 'enable_debug_cb'), 'sdm_debug_section', 'sdm_debug');\n    }\n\n    public function general_options_cb() {\n\t//Set the message that will be shown below the general options settings heading\n\t_e('General options settings', 'simple-download-monitor');\n    }\n\n    public function admin_options_cb() {\n\t//Set the message that will be shown below the admin options settings heading\n\t_e('Admin options settings', 'simple-download-monitor');\n    }\n\n    public function sdm_colors_cb() {\n\t//Set the message that will be shown below the color options settings heading\n\t_e('Front End colors settings', 'simple-download-monitor');\n    }\n\n    public function sdm_debug_cb() {\n\t//Set the message that will be shown below the debug options settings heading\n\t_e('Debug settings', 'simple-download-monitor');\n    }\n\n    public function sdm_deldata_cb() {\n\t//Set the message that will be shown below the debug options settings heading\n\t_e('You can delete all the data related to this plugin from database using the button below. Useful when you\\'re uninstalling the plugin and don\\'t want any leftovers remaining.', 'simple-download-monitor');\n\techo '<p><b>' . __('Warning', 'simple-download-monitor') . ': </b> ' . __('this can\\'t be undone. All settings, download items, download logs will be deleted.', 'simple-download-monitor') . '</p>';\n\techo '<p><button id=\"sdmDeleteData\" class=\"button\" style=\"color:red;\">' . __('Delete all data and deactivate plugin', 'simple-download-monitor') . '</button></p>';\n    }\n\n    public function hide_download_count_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[general_hide_donwload_count]\" id=\"general_hide_download_count\" type=\"checkbox\" ' . checked(1, isset($main_opts['general_hide_donwload_count']), false) . ' /> ';\n\techo '<label for=\"general_hide_download_count\">' . __('Hide the download count that is shown in some of the fancy templates.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function general_default_dispatch_value_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\t$value = isset($main_opts['general_default_dispatch_value']) && $main_opts['general_default_dispatch_value'];\n\techo '<input name=\"sdm_downloads_options[general_default_dispatch_value]\" id=\"general_default_dispatch_value\" type=\"checkbox\" value=\"1\"' . checked(true, $value, false) . ' />';\n\techo '<label for=\"general_default_dispatch_value\">' . __('When you create a new download item, The PHP Dispatching option should be enabled by default. PHP Dispatching keeps the URL of the downloadable files hidden.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function general_only_logged_in_can_download_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\t$value = isset($main_opts['only_logged_in_can_download']) && $main_opts['only_logged_in_can_download'];\n\techo '<input name=\"sdm_downloads_options[only_logged_in_can_download]\" id=\"only_logged_in_can_download\" type=\"checkbox\" value=\"1\"' . checked(true, $value, false) . ' />';\n\techo '<label for=\"only_logged_in_can_download\">' . __('Enable this option if you want to allow downloads only for logged-in users. When enabled, anonymous users clicking on the download button will receive an error message.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function general_login_page_url_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\t$value = isset($main_opts['general_login_page_url']) ? $main_opts['general_login_page_url'] : '';\n\techo '<input size=\"100\" name=\"sdm_downloads_options[general_login_page_url]\" id=\"general_login_page_url\" type=\"text\" value=\"' . $value . '\" />';\n\techo '<p class=\"description\">' . __('(Optional) Specify a login page URL where users can login. This is useful if you only allow logged in users to be able to download. This link will be added to the message that is shown to anonymous users.', 'simple-download-monitor') . '</p>';\n    }\n\n    public function admin_tinymce_button_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[admin_tinymce_button]\" id=\"admin_tinymce_button\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['admin_tinymce_button']), false) . ' /> ';\n\techo '<label for=\"admin_tinymce_button\">' . __('Removes the SDM Downloads button from the WP content editor.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function admin_log_unique() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[admin_log_unique]\" id=\"admin_log_unique\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['admin_log_unique']), false) . ' /> ';\n\techo '<label for=\"admin_log_unique\">' . __('Only logs downloads from unique IP addresses.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function admin_dont_log_bots() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[admin_dont_log_bots]\" id=\"admin_dont_log_bots\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['admin_dont_log_bots']), false) . ' /> ';\n\techo '<label for=\"admin_dont_log_bots\">' . __('When enabled, the plugin won\\'t count and log downloads from bots.', 'simple-download-monitor') . '</label>';\n    }\n\n    public function admin_no_logs_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[admin_no_logs]\" id=\"admin_no_logs\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['admin_no_logs']), false) . ' /> ';\n\techo '<label for=\"admin_no_logs\">' . __('Disables all download logs. (This global option overrides the individual download item option.)', 'simple-download-monitor') . '</label>';\n    }\n\n    public function download_button_color_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\t// Read current color class.\n\t$color_opt = isset($main_opts['download_button_color']) ? $main_opts['download_button_color'] : null;\n\t$color_opts = sdm_get_download_button_colors();\n\n\techo '<select name=\"sdm_downloads_options[download_button_color]\" id=\"download_button_color\" class=\"sdm_opts_ajax_dropdowns\">';\n\tforeach ($color_opts as $color_class => $color_name) {\n\t    echo '<option value=\"' . $color_class . '\"' . selected($color_class, $color_opt, false) . '>' . $color_name . '</option>';\n\t}\n\techo '</select> ';\n\tesc_html_e('Adjusts the color of the \"Download Now\" button.', 'simple-download-monitor');\n    }\n\n    public function enable_debug_cb() {\n\t$main_opts = get_option('sdm_downloads_options');\n\techo '<input name=\"sdm_downloads_options[enable_debug]\" id=\"enable_debug\" type=\"checkbox\" class=\"sdm_opts_ajax_checkboxes\" ' . checked(1, isset($main_opts['enable_debug']), false) . ' /> ';\n\techo '<label for=\"enable_debug\">' . __('Check this option to enable debug logging.', 'simple-download-monitor') .\n\t'<p class=\"description\"><a href=\"' . get_admin_url() . '?sdm-action=view_log\" target=\"_blank\">' .\n\t__('Click here', 'simple-download-monitor') . '</a>' .\n\t__(' to view log file.', 'simple-download-monitor') . '<br>' .\n\t'<a id=\"sdm-reset-log\" href=\"#0\" style=\"color: red\">' . __('Click here', 'simple-download-monitor') . '</a>' .\n\t__(' to reset log file.', 'simple-download-monitor') . '</p></label>';\n    }\n\n}\n\n//End of simpleDownloadManager class\n//Initialize the simpleDownloadManager class\n$simpleDownloadManager = new simpleDownloadManager();\n\n// Tinymce Button Populate Post ID's\nadd_action('wp_ajax_nopriv_sdm_tiny_get_post_ids', 'sdm_tiny_get_post_ids_ajax_call');\nadd_action('wp_ajax_sdm_tiny_get_post_ids', 'sdm_tiny_get_post_ids_ajax_call');\n\nfunction sdm_tiny_get_post_ids_ajax_call() {\n\n    $posts = get_posts(array(\n\t'post_type' => 'sdm_downloads',\n\t'numberposts' => -1,\n\t    )\n    );\n    foreach ($posts as $item) {\n\t$test[] = array('post_id' => $item->ID, 'post_title' => $item->post_title);\n    }\n\n    $response = json_encode(array('success' => true, 'test' => $test));\n\n    header('Content-Type: application/json');\n    echo $response;\n    exit;\n}\n\n//Remove Thumbnail Image\n//add_action('wp_ajax_nopriv_sdm_remove_thumbnail_image', '');//This is only available to logged-in users\nadd_action('wp_ajax_sdm_remove_thumbnail_image', 'sdm_remove_thumbnail_image_ajax_call'); //Execute this for authenticated users only\n\nfunction sdm_remove_thumbnail_image_ajax_call() {\n    if (!current_user_can('edit_posts')) {\n\t//Permission denied\n\twp_die(__('Permission denied!', 'simple-download-monitor'));\n\texit;\n    }\n\n//Go ahead with the thumbnail removal\n    $post_id = $_POST['post_id_del'];\n    $key_exists = metadata_exists('post', $post_id, 'sdm_upload_thumbnail');\n    if ($key_exists) {\n\t$success = delete_post_meta($post_id, 'sdm_upload_thumbnail');\n\tif ($success) {\n\t    $response = json_encode(array('success' => true));\n\t}\n    } else {\n\t// in order for frontend script to not display \"Ajax error\", let's return some data\n\t$response = json_encode(array('not_exists' => true));\n    }\n\n    header('Content-Type: application/json');\n    echo $response;\n    exit;\n}\n\n// Populate category tree\nadd_action('wp_ajax_nopriv_sdm_pop_cats', 'sdm_pop_cats_ajax_call');\nadd_action('wp_ajax_sdm_pop_cats', 'sdm_pop_cats_ajax_call');\n\nfunction sdm_pop_cats_ajax_call() {\n\n    $cat_slug = $_POST['cat_slug'];  // Get button cpt slug\n    $parent_id = $_POST['parent_id'];  // Get button cpt id\n// Query custom posts based on taxonomy slug\n    $posts = get_posts(array(\n\t'post_type' => 'sdm_downloads',\n\t'numberposts' => -1,\n\t'tax_query' => array(\n\t    array(\n\t\t'taxonomy' => 'sdm_categories',\n\t\t'field' => 'slug',\n\t\t'terms' => $cat_slug,\n\t\t'include_children' => 0\n\t    )\n\t),\n\t'orderby' => 'title',\n\t'order' => 'ASC')\n    );\n\n    $final_array = array();\n\n// Loop results\n    foreach ($posts as $post) {\n\t// Create array of variables to pass to js\n\t$final_array[] = array('id' => $post->ID, 'permalink' => get_permalink($post->ID), 'title' => $post->post_title);\n    }\n\n// Generate ajax response\n    $response = json_encode(array('final_array' => $final_array));\n    header('Content-Type: application/json');\n    echo $response;\n    exit;\n}\n\n/*\n * * Setup Sortable Columns\n */\nadd_filter('manage_edit-sdm_downloads_columns', 'sdm_create_columns'); // Define columns\nadd_filter('manage_edit-sdm_downloads_sortable_columns', 'sdm_downloads_sortable'); // Make sortable\nadd_action('manage_sdm_downloads_posts_custom_column', 'sdm_downloads_columns_content', 10, 2); // Populate new columns\n\nfunction sdm_create_columns($cols) {\n\n    unset($cols['title']);\n    unset($cols['taxonomy-sdm_tags']);\n    unset($cols['taxonomy-sdm_categories']);\n    unset($cols['date']);\n\n    $cols['sdm_downloads_thumbnail'] = __('Image', 'simple-download-monitor');\n    $cols['title'] = __('Title', 'simple-download-monitor');\n    $cols['sdm_downloads_id'] = __('ID', 'simple-download-monitor');\n    $cols['sdm_downloads_file'] = __('File', 'simple-download-monitor');\n    $cols['taxonomy-sdm_categories'] = __('Categories', 'simple-download-monitor');\n    $cols['taxonomy-sdm_tags'] = __('Tags', 'simple-download-monitor');\n    $cols['sdm_downloads_count'] = __('Downloads', 'simple-download-monitor');\n    $cols['date'] = __('Date Posted', 'simple-download-monitor');\n    return $cols;\n}\n\nfunction sdm_downloads_sortable($cols) {\n\n    $cols['sdm_downloads_id'] = 'sdm_downloads_id';\n    $cols['sdm_downloads_file'] = 'sdm_downloads_file';\n    $cols['sdm_downloads_count'] = 'sdm_downloads_count';\n    $cols['taxonomy-sdm_categories'] = 'taxonomy-sdm_categories';\n    $cols['taxonomy-sdm_tags'] = 'taxonomy-sdm_tags';\n    return $cols;\n}\n\nfunction sdm_downloads_columns_content($column_name, $post_ID) {\n\n    if ($column_name == 'sdm_downloads_thumbnail') {\n\t$old_thumbnail = get_post_meta($post_ID, 'sdm_upload_thumbnail', true);\n\t//$old_value = isset($old_thumbnail) ? $old_thumbnail : '';\n\tif ($old_thumbnail) {\n\t    echo '<p class=\"sdm_downloads_count\"><img src=\"' . $old_thumbnail . '\" style=\"width:50px;height:50px;\" /></p>';\n\t}\n    }\n    if ($column_name == 'sdm_downloads_id') {\n\techo '<p class=\"sdm_downloads_postid\">' . $post_ID . '</p>';\n    }\n    if ($column_name == 'sdm_downloads_file') {\n\t$old_file = get_post_meta($post_ID, 'sdm_upload', true);\n\t$file = isset($old_file) ? $old_file : '--';\n\techo '<p class=\"sdm_downloads_file\">' . $file . '</p>';\n    }\n    if ($column_name == 'sdm_downloads_count') {\n\tglobal $wpdb;\n\t$wpdb->get_results($wpdb->prepare('SELECT * FROM ' . $wpdb->prefix . 'sdm_downloads WHERE post_id=%s', $post_ID));\n\techo '<p class=\"sdm_downloads_count\">' . $wpdb->num_rows . '</p>';\n    }\n}\n\n// Adjust admin column widths\nadd_action('admin_head', 'sdm_admin_column_width'); // Adjust column width in admin panel\n\nfunction sdm_admin_column_width() {\n\n    echo '<style type=\"text/css\">';\n    echo '.column-sdm_downloads_thumbnail { width:75px !important; overflow:hidden }';\n    echo '.column-sdm_downloads_id { width:100px !important; overflow:hidden }';\n    echo '.column-taxonomy-sdm_categories { width:200px !important; overflow:hidden }';\n    echo '.column-taxonomy-sdm_tags { width:200px !important; overflow:hidden }';\n    echo '</style>';\n}\n\n/*\n * * Register Tinymce Button\n */\n\n// First check if option is checked to disable tinymce button\n$main_option = get_option('sdm_downloads_options');\n$tiny_button_option = isset($main_option['admin_tinymce_button']);\nif ($tiny_button_option != true) {\n\n// Okay.. we're good.  Add the button.\n    add_action('init', 'sdm_downloads_tinymce_button');\n\n    function sdm_downloads_tinymce_button() {\n\n\tadd_filter('mce_external_plugins', 'sdm_downloads_add_button');\n\tadd_filter('mce_buttons', 'sdm_downloads_register_button');\n    }\n\n    function sdm_downloads_add_button($plugin_array) {\n\n\t$plugin_array['sdm_downloads'] = WP_SIMPLE_DL_MONITOR_URL . '/tinymce/sdm_editor_plugin.js';\n\treturn $plugin_array;\n    }\n\n    function sdm_downloads_register_button($buttons) {\n\n\t$buttons[] = 'sdm_downloads';\n\treturn $buttons;\n    }\n\n}\n", "=== Simple Download Monitor ===\nContributors: Tips and Tricks HQ, Ruhul Amin, josh401, mbrsolution, alexanderfoxc\nDonate link: https://www.tipsandtricks-hq.com\nTags: download, downloads, count, counter, tracker, tracking, hits, logging, monitor, manager, files, media, digital, download monitor, download manager, downloadmanager, file manager, protect downloads, password, download category, file tree, ajax, download template, grid, documents, ip address\nRequires at least: 4.1.0\nTested up to: 4.9\nStable tag: 3.5.4\nLicense: GPLv2 or later\n\nEasily manage downloadable files and monitor downloads of your digital files from your WordPress site.\n\n== Description ==\n\nI developed the Simple Download Monitor plugin because I needed a nice way to manage my digital downloads and monitor the number of downloads of my files and documents.\n\nThis plugin is very useful for managing and tracking your digital file download counts. \n\nYou can password protect your downloadable files and documents too (visitors will require a password before downloading the file when you use this option).\n\nThere is an option to show an ajax file tree browser so your visitors can browse all your files and download the ones they want.\n\nYou can configure downloadable files from your WordPress admin dashboard via an elegant user interface. Then allow your visitors to download the files and this plugin will monitor which files get downloaded how many times.\n\nThe plugin will log the IP addresses of the users who download your digital files and documents. It will also log the date and time of each download.\n\nIt has a very user-friendly interface for uploading, managing, monitoring and tracking file downloads.\n\nhttps://www.youtube.com/watch?v=utYIH0fILuQ\n\n= Simple Download Monitor Features =\n\n* Add, edit and remove downloads from an easy to use interface.\n* Drag and drop file and document uploads.\n* Assign categories and tags to your downloadable files and documents.\n* Rich text editor for editing your download item description.\n* Use shortcodes to display a download now button on a WordPress post or page.\n* Show trackable download now buttons for your files anywhere on your site.\n* Shortcode to create a direct download link for a file. Useful for hotlinking.\n* Download counter for each file.\n* Ability to set a download count offset for each file.\n* Track IP addresses of the users who downloaded your files.\n* Track date and time of each file downloads.\n* Track the usernames of the users downloading the files.\n* Option to setup secure downloads for your files (the URL of the downloadable file will be hidden).\n* Option to upload a thumbnail image for each of your downloadable files.\n* Option to use a nice looking template to show your download now buttons.\n* Ability to search and sort your downloadable files in the admin dashboard.\n* Ability to create a search page and allow your visitors to search your downloads.\n* Track the number of downloads for each of your files.\n* Track the visitors country.\n* View the daily download counts of your items in a chart.\n* WordPress Shortcode for embedding a download link for a file.\n* Tinymce button in the WordPress post/page editor so you can easily add the shortcode.\n* You can customize the \"Download Now\" button text of an item to anything you want.\n* Ability to add the download now buttons to your sidebar widget.\n* Create password protected download now buttons. Users will only be able to download the file if they enter the correct password. [View the tutorial](https://www.tipsandtricks-hq.com/create-a-password-protected-download-file-6838)\n* Shortcode to show the download counter of a file. Use it to show off your file download count.\n* Shortcode to show all the downloads from a particular category.\n* Shortcode to embed a file tree browser for your downloadable files. The file browser is ajax based and it shows the files structured by categories.\n* Ability to open the downloads in new browser window or tab. When your users click on a download button, it will open in a new window or tab.\n* Ability to show your downloads in a grid display. [View the tutorial](https://www.tipsandtricks-hq.com/show-file-downloads-in-a-nice-grid-display-7273)\n* Export all the file download logs to a CSV file.\n* Ability to reset the log entries.\n* Shortcode to show a number of latest downloads to your visitors.\n* Ability to disable the download monitoring (logging) for certain items (or all items).\n* You can also choose to only monitor downloads from unique IP address only.\n* Option to specify file size info so it can be shown to your visitors. [View the tutorial](https://simple-download-monitor.com/how-to-show-file-size-info-of-your-downloads/)\n* Option to specify version number info for the download item so it can be shown to your visitors.\n* Option to restrict downloads to logged-in users only.\n* Option to ignore download count from bots.\n\nView more details on the [download monitor plugin](https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin) page.\n\n= Language Translations =\n\nThe following language translations are already available for the download monitor plugin:\n\n* English\n* German\n* Spanish\n* French\n* Italian\n* Russian\n* Dutch\n* Portuguese (Brasil)\n\n= Simple Download Monitor Plugin Usage =\n\nOnce you have installed the plugin, go to \"Downloads -> Settings\" interface to configure some options\n\n**A) Configure Download Monitor basic settings**\n\n* Admin Options: Remove Tinymce Button - Removes the SDM Downloads button from the WP content editor (default: unchecked).\n* Color Options: Download Button Color - Select a default color of the download button (default: green).\n\n**B) Add a new download**\n\nTo configure a new download follow these steps:\n\n1. Go to \"Downloads->Add New\" interface in your WP admin\n1. Enter a title for your download\n1. Add a description for the download\n1. Select the file from your computer and upload it (or use an URL of the file)\n1. Select an image for the download (it will be displayed as a thumbnail on the front end)\n1. Publish it\n\nYou can view all of your existing downloads from the \"Downloads->Downloads\" interface.\n\n**C) Create a download button**\n\nCreate a new post/page and click the \"SDM Downlaods\" TinyMCE button to insert a shortcode (This button will only show up if you haven't unchecked it in the settings). You can choose to display your download with a nice looking box or just a plain download link/button. \n\nExample Shortcode Usage:\n\n`[sdm_download id=\"271\" fancy=\"1\"]`  (embed a download button inside a box with other information e.g. Thumbnail, Title and Description)\n\n`[sdm_download id=\"271\" fancy=\"0\"]`  (embed a plain download button/link for a file)\n\n`[sdm_download id=\"271\" fancy=\"0\" color=\"blue\"]`  (embed a plain download button/link for a file with a blue color)\n\n**D) Download logs**\n\nYou can check the download stats from the \"Downloads->Logs\" interface. It shows the number of downloads for each files, IP address of the user who downloaded it, date and time of the download.\n\n** Detailed Usage Documentation **\n\nView more usage instructions on the [Download Monitor Plugin](https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin) page.\n\n** Github Repository **\n\nhttps://github.com/Arsenal21/simple-download-monitor\n\nIf you need extra action hooks or filters for this plugin then let us know.\n\n== Installation ==\n\n1. Go to the Add New plugins screen in your WordPress admin area\n1. Click the upload tab\n1. Browse for the plugin file (simple-download-monitor.zip)\n1. Click Install Now and then activate the plugin\n\n== Frequently Asked Questions ==\n\n= Can this plugin be used to offer free downloads to the users? =\nYes.\n\n= What file formats can I upload? =\nYou can pretty much upload all common file types.\n\n= Can I use external file URLs? = \nYes, you can use both local paths and external URLs.\n\n= Can I password protect a downloadable file? = \nYes.\n\n= Can I show the file download counts to my visitors? =\nYes.\n\n= Can I show all downloads from a category? =\nYes.\n\n= Can I show an ajax file tree browser using this plugin? =\nYes.\n\n= Can I show a number of latest downloads to my usrs? =\nYes.\n\n= Can I track downloads from unique IP address only? =\nYes\n\n== Screenshots ==\n\nFor screenshots please visit the [download monitor plugin page](https://www.tipsandtricks-hq.com/simple-wordpress-download-monitor-plugin)\n\n== Changelog ==\n\n= 3.5.4 =\n- Fixed stored-XSS bug. Thanks to d4wner.\n\n= 3.5.3 =\n- Added \"Text Domain\" and \"Domain Path\" to the File Header.\n\n= 3.5.2 =\n- Renamed the \"langs\" folder to \"languages\"\n\n= 3.5.1 = \n- Added a few more user-agents check in the is_bot function.\n- Search shortcode has been improved so it performs the search using each keyword of a multi-word search phrase. It will ignore any word that are less than 4 characters long.\n- Includes some missing translation strings to the POT file.\n\n= 3.5.0 =\n- Added check for a couple of user-agents in the is_bot function.\n- Added a filter that can be used to override what you consider bot via your own custom function.\n\n= 3.4.9 =\n- Added a new option in the settings menu to ignore downloads from bots. The name of the new settings field is \"Do Not Count Downloads from Bots\".\n- Updated the settings menu slug to make it unique.\n- Enhancement to the password protected download function.\n\n= 3.4.8 =\n- Fixed an issue with the shortcode inserter interface showing the last 5 items only.\n- The \"show_size\" shortcode parameter will work correctly with the fancy template now.\n\n= 3.4.7 =\n- Reworked the file upload interface to make it more user-friendly. \n- Delete plugin Data button now also deletes taxonomies and rewrite rules related to plugin.\n\n= 3.4.6 =\n- Added option to delete plugin's settings, data and tables from database.\n- Added \"Login Page URL\" option to optionally specify a login page URL when user is required to be logged in to download.\n\n= 3.4.5 =\n- Updated the slug of the new stats menu in this plugin so it doesn't conflict with jetpack's stat menu.\n\n= 3.4.4 =\n- Added \"Stats\" menu in the plugin that shows download count using a chart.\n- Removed the \"modal\" class definition from the admin CSS file.\n\n= 3.4.3 =\n- The [sdm_search_form] can take the fancy template as a shortcode argument to display the search result using that template.\n\n= 3.4.2 =\n- Added a new option \"Only Allow Logged-in Users to Download\".\n- Added [sdm_search_form] shortcode to display a search form for searching SDM downloads only.\n\n= 3.4.1 =\n- The password protected download button will use the \"button_text\" specified in the shortcode (if any).\n- The download now log will track WP eMember plugin username if the user is logged in as a member.\n\n= 3.4.0 =\n- Added a new hook to allow plugin extensions to hook into download request handling.\n- Added empty index file to the plugin folder.\n- Fixed potential XSS vulnerability. Thanks to Neven Biruski (Defensecode) for pointing it out.\n- Minor typo fix.\n\n= 3.3.7 =\n- Added an improvement for the password protected download. If a user goes directly to the download link without entering a password, it will point the users to go to a page where they can enter a password for the download item.\n\n= 3.3.6 =\n- Fix fancy template shortcode attributes: some shortcode attributes were ignored in the previous release.\n\n= 3.3.5 =\n- Download button color can now be specified in the shortcode for fancy 1 and the standard download button.\n- Added clearfix to .sdm_download_link container for better rendering in mobile devices.\n- The button text color CSS has been sharpened a little to make it look nicer.\n- Fixed an undefined variable notice.\n- Updated TinyMCE button icon to a better one.\n- Minimum WordPress version requirement changed to WP4.1\n\n= 3.3.4 =\n- Replace deprecated get_currentuserinfo() with wp_get_current_user()\n- Improve remote IP and location detection\n- Added a new shortcode to show a simple list of the download categories\n- Fix: avoid undefined variable notices in sdm_pop_cats_ajax_call()\n\n= 3.3.3 =\n- New feature - local download items can now be dispatched via PHP. This way, the actual URL of the downloaded file is not exposed (offers secure download).\n- Minimum required WP version raised to WordPress v3.3\n- WordPress 4.6 compatibility.\n\n= 3.3.2 =\n- Added an option to specify the file size info when editing the item. Size info can be shown in the fancy display template using a shortcode parameter (show_size).\n- Added an option to specify the version number info when editing the item. Version info can be shown in the fancy display template using a shortcode parameter (show_version).\n- Added French language translation. Translation file submitted by Laurent Jaunaux.\n- The stats metabox in the download edit page will now appear before the shortcodes metabox.\n- Added more usage instructions in the download file upload section.\n\n= 3.3.1 =\n- Added a new feature to hide the download counts that is shown in some of the fancy templates. This new option can be found in the settings menu of the plugin.\n- Added delete confirm dialogue in the individual download logs delete option.\n- Simplified the settings menu page style.\n- Fixed multiple vulnerabilities (thanks to NCSC-NL).\n\n= 3.3.0 =\n- Better implementation of the export log data to CSV file.\n- Added a new filter in the download logs menu so the items per page value can be customized.\n- Fixed a bug in the logs menu sorting. Sorting for some columns weren't working correctly.\n- Added sanitization for the order and orderby columns in the logs list table.\n- Added sanitization for the log entry delete functionality.\n\n= 3.2.9 =\n- Renamed the label of categories and tags of this plugin to \"Download Categories\" and \"Download Tags\".\n- Better implementation of password protected download items. The ajax method of checking password has been completely replaced with a more robust implementation.\n- Fixed a bug with the remove thumbnail ajax query.\n- Thanks to @James Golovich for pointing out the issues.\n\n= 3.2.8 =\n- WordPress 4.4 compatibility.\n\n= 3.2.7 =\n- Added a new feature to specify the new window parameter when using the shortcode inserter (from TinyMCE).\n- Minor CSS style fix for the \"Logs\" interface.\n- The log entries will be sorted by \"date\" field (by default).\n\n= 3.2.6 =\n- The language slug has been changed to \"simple-download-monitor\" so it can be imported to the WordPress language pack.\n\n= 3.2.5 =\n- Modified the 'sdm_download_shortcode_output' filter to pass the arguments array also (allows greater customization option via this filter).\n- Added a new option to show X number of latest downloads from a specified category.\n\n= 3.2.4 =\n- Added a new feature to show pagination in the display all downloads from a category shortcode.\n- Added validation checks while processing a download request to make sure the download item ID is valid and the item has a download link.\n\n= 3.2.3 =\n- Addressed some warning/notice messages that shows when debug is enabled.\n\n= 3.2.2 =\n- Added a new shortcode to create a direct download link for the file. Useful if you want to create a custom download link.\n- WordPress 4.2 compatibility.\n\n= 3.2.1 =\n- Fixed an issue with the ajax category browser shortcode.\n- Improved the ajax category downloads shortcode to show an up/down arrow icon next to the category name.\n\n= 3.2.0 =\n- Added a textbox to manually type in an image thumbnail URL when editing a download item.\n- Minor javascript improvements for the select and remove image option.\n- Improved the image thumbnail preview in the admin side.\n- Added placeholder text in the URL input fields.\n\n= 3.1.9 =\n- Fixed a compatibility issue with WooCommerce's latest release.\n\n= 3.1.8 =\n- Enabled shortcode filtering in standard text widget.\n- Fixed an intermittent issue with the rewrite rules flushing.\n\n= 3.1.7 =\n- Added Portuguese language translation. Translation file submitted by Visto Marketing.\n- New feature to disable the download monitoring (logging) for certain items (or all items).\n- New option to only monitor downloads from unique IP address only.\n\n= 3.1.6 =\n- Improved the queries in the \"Logs\" interface to be more efficient.\n- Added a new feature to reset/empty the download log entries. You can find it in the \"Logs\" menu of the plugin.\n\n= 3.1.5 =\n- Added Spanish language translation. Translation file submitted by Manuel.\n- Added Russian language translation. Translation file submitted by \u0411\u0430\u043b\u0430\u0448\u043e\u0432 \u0410\u043b\u0435\u043a\u0441.\n- Added Dutch language translation. Translation file submitted by Paul Tuinman.\n- Added a new feature to show X number of latest downloads.\n\n= 3.1.4 = \n- New feature to track the usernames of the WP Users downloading the files. You can view the username info in the \"Logs\" menu.\n- Enabled the \"View\" link in the all downloads list table.\n- Some refactoring work to move the admin menu handling code to a separate file.\n\n= 3.1.3 =\n- Added an option to use \"orderby\" and \"order\" parameters in the display downloads from a category shortcode to allow sorting the download items display list.\n- The download item description field has been converted to a rich text editor. So you can customize the download description with rich text.\n\n= 3.1.2 = \n- Removed the link from the download item name in the template 2 display.\n\n= 3.1.1 =\n- Fixed a bug with the file download password entry field.\n\n= 3.1 =\n- Added a new fancy template to display the downloads.\n- You can now show a grid display of your downloads.\n- Added some error validation in the download shortcode entry.\n- Refactored some code and added a couple of new filters.\n- Added CSS classes around the download count shortcode output.\n- Modified the styles of the simple downloads post type output.\n- The fancy 1 template now shows the download count of each item.\n- Updated the POT file for language translation.\n\n= 3.0 =\n* Added an option to specify a download count offset for each download. This will allow you to set a starting download count for each item. \n* Added a new parameter in the shortcode to allow customization of the button text. You can now customize the \"Download Now\" button text to anything you want from the shortcode.\n* Added a new parameter in the shortcode to allow opening the download in a new window or tab.\n\n= 2.9 =\n* Added visitor Country to database table; allowing tracking of each download visitors Country.\n* Visitor Country is also seen in the \"Logs\" page; can be sorted; and exported.\n\n= 2.8 = \n* Added the ability to use shortcodes in the description area of the downloads. For example: you can use the download counter shortcode in the description field to show the current counter to your visitors.\n* Bug-fix for the \"show downloads from a category\" shortcode. It will now correctly show all items in a download category.\n* Added a better dashicons icon for the downloads menu in the admin dashborad.\n\n= 2.7 =\n* Added a new feature to show an ajax file tree browser.\n* Added some missing translation strings in the plugin.\n* Added German language translation. Translation file submitted by Meinhard\n* Changed the password input field to a type of \"password\"\n* Fixed a minor but that would preven the \"view\" links from displaying in WordPress posts\n\n= 2.6 =\n* Added a new shortcode to show all downloads from a download category.\n* Added a filter to handle the URL of SDM downloads post type.\n\n= 2.5 =\n* Added a new feature to password protect a downloadable file.\n* Added a new shortcode to show the download count to your visitors.\n\n= 2.4 =\n* Fixed an issue with file download using external file URL.\n\n= 2.3 =\n* Wordpress 3.8 compatibility\n\n= 2.2 =\n* Fixed the plugin language translation issue. Now it can be translated to any language.\n\n= 2.1 = \n* Minor bug fixes with the stylesheet file URL.\n\n= 2.0 =\n* Complete new architecture for the download monitor plugin\n* You can download the old version with old architecture here:\nhttp://wordpress.org/plugins/simple-download-monitor/developers/\n\n== Upgrade Notice ==\n\nDownload monitor 2.0 uses a completely new architecture (it is much simpler and user friendly) for configuring and monitoring downloads. Read the usage section to understand how it works.\n"], "filenames": ["simple-download-monitor/main.php", "simple-download-monitor/readme.txt"], "buggy_code_start_loc": [6, 7], "buggy_code_end_loc": [536, 176], "fixing_code_start_loc": [6, 7], "fixing_code_end_loc": [536, 180], "type": "CWE-79", "message": "The Simple Download Monitor plugin before 3.5.4 for WordPress has XSS via the sdm_upload (aka Downloadable File) parameter in an edit action to wp-admin/post.php.", "other": {"cve": {"id": "CVE-2018-5213", "sourceIdentifier": "cve@mitre.org", "published": "2018-01-04T18:29:00.307", "lastModified": "2018-01-16T16:18:43.217", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The Simple Download Monitor plugin before 3.5.4 for WordPress has XSS via the sdm_upload (aka Downloadable File) parameter in an edit action to wp-admin/post.php."}, {"lang": "es", "value": "El plugin Simple Download Monitor en versiones anteriores a la 3.5.4 para WordPress tiene Cross-Site Scripting (XSS) mediante el par\u00e1metro sdm_upload (tambi\u00e9n conocido como Downloadable File) en una acci\u00f3n edit en wp-admin/post.php."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:simple_download_monitor_project:simple_download_monitor:3.5.4:*:*:*:*:wordpress:*:*", "matchCriteriaId": "F35A3C45-E15D-4777-8CBA-1D666BBE3211"}]}]}], "references": [{"url": "https://github.com/Arsenal21/simple-download-monitor/commit/8ab8b9166bc87feba26a1573cf595af48eff7805", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/Arsenal21/simple-download-monitor/issues/27", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://github.com/d4wner/Vulnerabilities-Report/blob/master/simple-download-monitor.md", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Arsenal21/simple-download-monitor/commit/8ab8b9166bc87feba26a1573cf595af48eff7805"}}