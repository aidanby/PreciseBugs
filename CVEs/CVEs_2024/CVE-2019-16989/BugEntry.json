{"buggy_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2012\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tJames Rose <james.o.rose@gmail.com>\n*/\ninclude \"root.php\";\nrequire_once \"resources/require.php\";\nrequire_once \"resources/check_auth.php\";\nif (permission_exists('conference_interactive_view')) {\n\t//access granted\n}\nelse {\n\techo \"access denied\";\n\texit;\n}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get and prepare the conference name\n\t$conference_name = check_str(trim($_REQUEST[\"c\"]));\n\t$conference_display_name = str_replace(\"-\", \" \", $conference_name);\n\t$conference_display_name = str_replace(\"_\", \" \", $conference_display_name);\n\n//show the header\n\trequire_once \"resources/header.php\";\n\n?><script type=\"text/javascript\">\nfunction loadXmlHttp(url, id) {\n\tvar f = this;\n\tf.xmlHttp = null;\n\t/*@cc_on @*/ // used here and below, limits try/catch to those IE browsers that both benefit from and support it\n\t/*@if(@_jscript_version >= 5) // prevents errors in old browsers that barf on try/catch & problems in IE if Active X disabled\n\ttry {f.ie = window.ActiveXObject}catch(e){f.ie = false;}\n\t@end @*/\n\tif (window.XMLHttpRequest&&!f.ie||/^http/.test(window.location.href))\n\t\tf.xmlHttp = new XMLHttpRequest(); // Firefox, Opera 8.0+, Safari, others, IE 7+ when live - this is the standard method\n\telse if (/(object)|(function)/.test(typeof createRequest))\n\t\tf.xmlHttp = createRequest(); // ICEBrowser, perhaps others\n\telse {\n\t\tf.xmlHttp = null;\n\t\t // Internet Explorer 5 to 6, includes IE 7+ when local //\n\t\t/*@cc_on @*/\n\t\t/*@if(@_jscript_version >= 5)\n\t\ttry{f.xmlHttp=new ActiveXObject(\"Msxml2.XMLHTTP\");}\n\t\tcatch (e){try{f.xmlHttp=new ActiveXObject(\"Microsoft.XMLHTTP\");}catch(e){f.xmlHttp=null;}}\n\t\t@end @*/\n\t}\n\tif(f.xmlHttp != null){\n\t\tf.el = document.getElementById(id);\n\t\tf.xmlHttp.open(\"GET\",url,true);\n\t\tf.xmlHttp.onreadystatechange = function(){f.stateChanged();};\n\t\tf.xmlHttp.send(null);\n\t}\n}\n\nloadXmlHttp.prototype.stateChanged=function () {\nif (this.xmlHttp.readyState == 4 && (this.xmlHttp.status == 200 || !/^http/.test(window.location.href)))\n\t//this.el.innerHTML = this.xmlHttp.responseText;\n\tdocument.getElementById('ajax_reponse').innerHTML = this.xmlHttp.responseText;\n}\n\nvar requestTime = function() {\n\tvar url = 'conference_interactive_inc.php?c=<?php echo trim($_REQUEST[\"c\"]); ?>';\n\tnew loadXmlHttp(url, 'ajax_reponse');\n\tsetInterval(function(){new loadXmlHttp(url, 'ajax_reponse');}, 1222);\n}\n\nif (window.addEventListener) {\n\twindow.addEventListener('load', requestTime, false);\n}\nelse if (window.attachEvent) {\n\twindow.attachEvent('onload', requestTime);\n}\n\nfunction send_cmd(url) {\n\tif (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari\n\t\txmlhttp=new XMLHttpRequest();\n\t}\n\telse {// code for IE6, IE5\n\t\txmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\n\t}\n\txmlhttp.open(\"GET\",url,false);\n\txmlhttp.send(null);\n\tdocument.getElementById('cmd_reponse').innerHTML=xmlhttp.responseText;\n}\n\nvar record_count = 0;\n</script>\n\n<?php\necho \"<table width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\necho \"\t<tr>\\n\";\necho \"\t<td align='left'>\";\necho \"\t\t<b>\".$text['label-interactive'].\"</b><br><br>\\n\";\necho \"\t\t\".$text['description-interactive'].\"\\n\";\necho \"\t</td>\\n\";\necho \"\t</tr>\\n\";\necho \"\t<tr>\\n\";\necho \"\t<td align=\\\"left\\\">\\n\";\necho \"\t\t<br>\\n\";\necho \"\t\t<div id=\\\"ajax_reponse\\\"></div>\\n\";\necho \"\t\t<div id=\\\"time_stamp\\\" style=\\\"visibility:hidden\\\">\".date('Y-m-d-s').\"</div>\\n\";\necho \"\t</td>\";\necho \"\t</tr>\";\necho \"</table>\";\n\n//show the header\n\trequire_once \"resources/footer.php\";\n?>"], "fixing_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2019\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tJames Rose <james.o.rose@gmail.com>\n*/\n\n//includes\n\tinclude \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists('conference_interactive_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get and prepare the conference name\n\t$conference_name = check_str(trim($_REQUEST[\"c\"]));\n\t$conference_display_name = str_replace(\"-\", \" \", $conference_name);\n\t$conference_display_name = str_replace(\"_\", \" \", $conference_display_name);\n\n//show the header\n\trequire_once \"resources/header.php\";\n\n?><script type=\"text/javascript\">\nfunction loadXmlHttp(url, id) {\n\tvar f = this;\n\tf.xmlHttp = null;\n\t/*@cc_on @*/ // used here and below, limits try/catch to those IE browsers that both benefit from and support it\n\t/*@if(@_jscript_version >= 5) // prevents errors in old browsers that barf on try/catch & problems in IE if Active X disabled\n\ttry {f.ie = window.ActiveXObject}catch(e){f.ie = false;}\n\t@end @*/\n\tif (window.XMLHttpRequest&&!f.ie||/^http/.test(window.location.href))\n\t\tf.xmlHttp = new XMLHttpRequest(); // Firefox, Opera 8.0+, Safari, others, IE 7+ when live - this is the standard method\n\telse if (/(object)|(function)/.test(typeof createRequest))\n\t\tf.xmlHttp = createRequest(); // ICEBrowser, perhaps others\n\telse {\n\t\tf.xmlHttp = null;\n\t\t // Internet Explorer 5 to 6, includes IE 7+ when local //\n\t\t/*@cc_on @*/\n\t\t/*@if(@_jscript_version >= 5)\n\t\ttry{f.xmlHttp=new ActiveXObject(\"Msxml2.XMLHTTP\");}\n\t\tcatch (e){try{f.xmlHttp=new ActiveXObject(\"Microsoft.XMLHTTP\");}catch(e){f.xmlHttp=null;}}\n\t\t@end @*/\n\t}\n\tif(f.xmlHttp != null){\n\t\tf.el = document.getElementById(id);\n\t\tf.xmlHttp.open(\"GET\",url,true);\n\t\tf.xmlHttp.onreadystatechange = function(){f.stateChanged();};\n\t\tf.xmlHttp.send(null);\n\t}\n}\n\nloadXmlHttp.prototype.stateChanged=function () {\nif (this.xmlHttp.readyState == 4 && (this.xmlHttp.status == 200 || !/^http/.test(window.location.href)))\n\t//this.el.innerHTML = this.xmlHttp.responseText;\n\tdocument.getElementById('ajax_reponse').innerHTML = this.xmlHttp.responseText;\n}\n\nvar requestTime = function() {\n\tvar url = 'conference_interactive_inc.php?c=<?php echo trim(escape($_REQUEST[\"c\"])); ?>';\n\tnew loadXmlHttp(url, 'ajax_reponse');\n\tsetInterval(function(){new loadXmlHttp(url, 'ajax_reponse');}, 1222);\n}\n\nif (window.addEventListener) {\n\twindow.addEventListener('load', requestTime, false);\n}\nelse if (window.attachEvent) {\n\twindow.attachEvent('onload', requestTime);\n}\n\nfunction send_cmd(url) {\n\tif (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari\n\t\txmlhttp=new XMLHttpRequest();\n\t}\n\telse {// code for IE6, IE5\n\t\txmlhttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\n\t}\n\txmlhttp.open(\"GET\",url,false);\n\txmlhttp.send(null);\n\tdocument.getElementById('cmd_reponse').innerHTML=xmlhttp.responseText;\n}\n\nvar record_count = 0;\n</script>\n\n<?php\necho \"<table width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\necho \"\t<tr>\\n\";\necho \"\t<td align='left'>\";\necho \"\t\t<b>\".$text['label-interactive'].\"</b><br><br>\\n\";\necho \"\t\t\".$text['description-interactive'].\"\\n\";\necho \"\t</td>\\n\";\necho \"\t</tr>\\n\";\necho \"\t<tr>\\n\";\necho \"\t<td align=\\\"left\\\">\\n\";\necho \"\t\t<br>\\n\";\necho \"\t\t<div id=\\\"ajax_reponse\\\"></div>\\n\";\necho \"\t\t<div id=\\\"time_stamp\\\" style=\\\"visibility:hidden\\\">\".date('Y-m-d-s').\"</div>\\n\";\necho \"\t</td>\";\necho \"\t</tr>\";\necho \"</table>\";\n\n//show the header\n\trequire_once \"resources/footer.php\";\n?>\n"], "filenames": ["app/conferences_active/conference_interactive.php"], "buggy_code_start_loc": [20], "buggy_code_end_loc": [133], "fixing_code_start_loc": [20], "fixing_code_end_loc": [137], "type": "CWE-79", "message": "In FusionPBX up to v4.5.7, the file app\\conferences_active\\conference_interactive.php uses an unsanitized \"c\" variable coming from the URL, which is reflected in HTML, leading to XSS.", "other": {"cve": {"id": "CVE-2019-16989", "sourceIdentifier": "cve@mitre.org", "published": "2019-10-21T16:15:18.350", "lastModified": "2023-02-03T21:34:40.467", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In FusionPBX up to v4.5.7, the file app\\conferences_active\\conference_interactive.php uses an unsanitized \"c\" variable coming from the URL, which is reflected in HTML, leading to XSS."}, {"lang": "es", "value": "En FusionPBX versiones hasta v4.5.7, el archivo app\\conferences_active\\conference_interactive.php utiliza una variable \"c\" no saneada proveniente de la URL, que es reflejada en HTML, conllevando a una vulnerabilidad de tipo XSS."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.5.7", "matchCriteriaId": "A5A0C1F9-8032-46C6-8DD4-DB91FACF7330"}]}]}], "references": [{"url": "https://github.com/fusionpbx/fusionpbx/commit/83123e314a2e4c2dd0815446f89bcad97278d98d", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://resp3ctblog.wordpress.com/2019/10/19/fusionpbx-xss-19/", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/83123e314a2e4c2dd0815446f89bcad97278d98d"}}