{"buggy_code": ["<?php\n/* Pi-hole: A black hole for Internet advertisements\n*  (c) 2017 Pi-hole, LLC (https://pi-hole.net)\n*  Network-wide ad blocking via your own hardware.\n*\n*  This file is copyright under the latest version of the EUPL.\n*  Please see LICENSE file for your rights under this license. */\n\nwhile (ob_get_level() > 0) {\n    ob_end_flush();\n}\nrequire_once(\"func.php\");\nini_set(\"output_buffering\", \"0\");\nob_implicit_flush(true);\nheader('Content-Type: text/event-stream');\nheader('Cache-Control: no-cache');\n\nfunction echoEvent($datatext) {\n    if(!isset($_GET[\"IE\"]))\n      echo \"data:\".implode(\"\\ndata:\", explode(\"\\n\", $datatext)).\"\\n\\n\";\n    else\n      echo $datatext;\n}\n\n// Test if domain is set\nif(isset($_GET[\"domain\"]))\n{\n    // Is this a valid domain?\n    $url = idn_to_ascii($_GET[\"domain\"]);\n    if(!validDomain($url))\n    {\n        echoEvent(\"$url is an invalid domain!\");\n        die();\n    }\n}\nelse\n{\n    echoEvent(\"No domain provided\");\n    die();\n}\n\nif(isset($_GET[\"exact\"]))\n{\n    $exact = \"-exact\";\n}\nelseif(isset($_GET[\"bp\"]))\n{\n    $exact = \"-bp\";\n}\nelse\n{\n    $exact = \"\";\n}\n\n$proc = popen(\"sudo pihole -q -adlist \".$url.\" \".$exact, 'r');\nwhile (!feof($proc)) {\n    echoEvent(fread($proc, 4096));\n}\n?>\n"], "fixing_code": ["<?php\n/* Pi-hole: A black hole for Internet advertisements\n*  (c) 2017 Pi-hole, LLC (https://pi-hole.net)\n*  Network-wide ad blocking via your own hardware.\n*\n*  This file is copyright under the latest version of the EUPL.\n*  Please see LICENSE file for your rights under this license. */\n\nwhile (ob_get_level() > 0) {\n    ob_end_flush();\n}\nrequire_once(\"func.php\");\nini_set(\"output_buffering\", \"0\");\nob_implicit_flush(true);\nheader('Content-Type: text/event-stream');\nheader('Cache-Control: no-cache');\n\nfunction echoEvent($datatext) {\n    if(!isset($_GET[\"IE\"]))\n      echo \"data:\".implode(\"\\ndata:\", explode(\"\\n\", $datatext)).\"\\n\\n\";\n    else\n      echo $datatext;\n}\n\n// Test if domain is set\nif(isset($_GET[\"domain\"]))\n{\n    // Is this a valid domain?\n    $url = idn_to_ascii($_GET[\"domain\"]);\n    if (!validDomain($url)) {\n        echoEvent(htmlentities($url).\" is an invalid domain!\");\n        die();\n    }\n}\nelse\n{\n    echoEvent(\"No domain provided\");\n    die();\n}\n\nif(isset($_GET[\"exact\"]))\n{\n    $exact = \"-exact\";\n}\nelseif(isset($_GET[\"bp\"]))\n{\n    $exact = \"-bp\";\n}\nelse\n{\n    $exact = \"\";\n}\n\n$proc = popen(\"sudo pihole -q -adlist \".$url.\" \".$exact, 'r');\nwhile (!feof($proc)) {\n    echoEvent(fread($proc, 4096));\n}\n?>\n"], "filenames": ["scripts/pi-hole/php/queryads.php"], "buggy_code_start_loc": [30], "buggy_code_end_loc": [33], "fixing_code_start_loc": [30], "fixing_code_end_loc": [32], "type": "CWE-79", "message": "AdminLTE is a Pi-hole Dashboard for stats and configuration. In affected versions inserting code like `<script>alert(\"XSS\")</script>` in the field marked with \"Domain to look for\" and hitting <kbd>enter</kbd> (or clicking on any of the buttons) will execute the script. The user must be logged in to use this vulnerability. Usually only administrators have login access to pi-hole, minimizing the risks. Users are advised to upgrade. There are no known workarounds for this issue.", "other": {"cve": {"id": "CVE-2022-31029", "sourceIdentifier": "security-advisories@github.com", "published": "2022-07-07T22:15:08.643", "lastModified": "2022-12-23T17:41:44.460", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "AdminLTE is a Pi-hole Dashboard for stats and configuration. In affected versions inserting code like `<script>alert(\"XSS\")</script>` in the field marked with \"Domain to look for\" and hitting <kbd>enter</kbd> (or clicking on any of the buttons) will execute the script. The user must be logged in to use this vulnerability. Usually only administrators have login access to pi-hole, minimizing the risks. Users are advised to upgrade. There are no known workarounds for this issue."}, {"lang": "es", "value": "AdminLTE es un tablero de control para las estad\u00edsticas y la configuraci\u00f3n. En las versiones afectadas insertar c\u00f3digo como \"(script)alert(\"XSS\")(/script)\" en el campo marcado con \"Domain to look for\" y pulsando (kbd)enter(/kbd) (o haciendo clic en cualquiera de los botones) ejecutar\u00e1 el script. El usuario debe estar conectado para usar esta vulnerabilidad. Normalmente, s\u00f3lo los administradores presentan acceso a pi-hole, lo que minimiza los riesgos. Es recomendado a usuarios actualizar. No se presentan mitigaciones conocidas para este problema"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.9, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 3.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:pi-hole:adminlte:*:*:*:*:*:*:*:*", "versionEndExcluding": "5.13", "matchCriteriaId": "F57CCF82-6E0F-414F-92A9-4AF6C66969E6"}]}]}], "references": [{"url": "https://github.com/pi-hole/AdminLTE/commit/b07372bd426ca8111824a0244dc89d07a7243509", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/pi-hole/AdminLTE/security/advisories/GHSA-cfr5-rqm5-9vhp", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/pi-hole/AdminLTE/commit/b07372bd426ca8111824a0244dc89d07a7243509"}}