{"buggy_code": ["<?php\n\nset_time_limit(0);\nYii::import('application.modules.timesheet.models.TimesheetCurricularMatrix', true);\nYii::import('application.modules.timesheet.models.TimesheetInstructor', true);\nYii::import('application.modules.timesheet.models.InstructorSchool', true);\nYii::import('application.modules.timesheet.models.Unavailability', true);\n\nclass ClassesController extends Controller\n{\n\n    /**\n     * @var string the default layout for the views. Defaults to '//layouts/column2', meaning\n     * using two-column layout. See 'protected/views/layouts/column2.php'.\n     */\n    public $layout = 'fullmenu';\n\n    /**\n     * @return array action filters\n     */\n    public function filters()\n    {\n        return array(\n            'accessControl', // perform access control for CRUD operations\n            'postOnly + delete', // we only allow deletion via POST request\n        );\n    }\n\n    /**\n     * Specifies the access control rules.\n     * This method is used by the 'accessControl' filter.\n     * @return array access control rules\n     */\n    public function accessRules()\n    {\n        return array(\n            array('allow', // allow authenticated user to perform 'create' and 'update' actions\n                'actions' => array('index',\n                    'frequency', 'saveFrequency',\n                    'classContents', 'getClassContents', 'saveClassContents', 'saveContent',\n                    'getdisciplines', 'getfrequency', 'getcontents'),\n                'users' => array('@'),\n            ),\n            array('allow', // allow admin user to perform 'admin' and 'delete' actions\n                'actions' => array('admin', 'delete'),\n                'users' => array('admin'),\n            ),\n            array('deny', // deny all users\n                'users' => array('*'),\n            ),\n        );\n    }\n\n    /**\n     * Displays the Class Contents\n     */\n    public function actionClassContents()\n    {\n        if (Yii::app()->getAuthManager()->checkAccess('instructor', Yii::app()->user->loginInfos->id)) {\n            $criteria = new CDbCriteria;\n            $criteria->alias = \"c\";\n            $criteria->join = \"\"\n                . \" join instructor_teaching_data on instructor_teaching_data.classroom_id_fk = c.id \"\n                . \" join instructor_identification on instructor_teaching_data.instructor_fk = instructor_identification.id \";\n            $criteria->condition = \"c.school_year = :school_year and c.school_inep_fk = :school_inep_fk and instructor_identification.users_fk = :users_fk\";\n            $criteria->order = \"name\";\n            $criteria->params = array(':school_year' => Yii::app()->user->year, ':school_inep_fk' => Yii::app()->user->school, ':users_fk' => Yii::app()->user->loginInfos->id);\n\n            $classrooms = Classroom::model()->findAll($criteria);\n        } else {\n            $classrooms = Classroom::model()->findAll('school_year = :school_year and school_inep_fk = :school_inep_fk order by name', ['school_year' => Yii::app()->user->year, 'school_inep_fk' => Yii::app()->user->school]);\n        }\n        $this->render('classContents', array(\n            'classrooms' => $classrooms\n        ));\n    }\n\n    /**\n     * Get all contents\n     */\n    public function actionGetContents()\n    {\n        $contents = ClassResources::model()->findAllByAttributes(['type' => ClassResources::CONTENT]);\n        $return = [];\n        foreach ($contents as $content) {\n            $return[$content->id] = $content->name;\n        }\n        echo json_encode($return);\n    }\n\n    /**\n     *   Save a new Content\n     */\n    public function actionSaveContent()\n    {\n        if (isset($_POST['name']) && !empty($_POST['name'])) {\n            $name = strtoupper($_POST['name']);\n            $description = isset($_POST['description']) ? strtoupper($_POST['description']) : \"\";\n            $type = isset($_POST['type']) ? $_POST['type'] : 1;\n            $exist = ClassResources::model()->exists('name = :n', ['n' => $name]);\n            if (!$exist) {\n                $newContent = new ClassResources();\n                $newContent->name = $name;\n                $newContent->description = $description;\n                $newContent->type = $type;\n                $newContent->save();\n\n                $return = ['id' => $newContent->id, 'name' => $newContent->name];\n                echo json_encode($return);\n            }\n        }\n    }\n\n    /**\n     * Get all classes by classroom, discipline and month\n     */\n    public function actionGetClassContents()\n    {\n        if ($_POST[\"fundamentalMaior\"] == \"1\") {\n            $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and discipline_fk = :discipline_fk and unavailable = 0 order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"], \"discipline_fk\" => $_POST[\"discipline\"]]);\n        } else {\n            $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and unavailable = 0 group by day order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"]]);\n        }\n        if (!empty($schedules)) {\n            foreach ($schedules as $schedule) {\n                $classContents[$schedule->day][\"available\"] = date(\"Y-m-d\") >= Yii::app()->user->year . \"-\" . str_pad($schedule->month, 2, \"0\", STR_PAD_LEFT) . \"-\" . str_pad($schedule->day, 2, \"0\", STR_PAD_LEFT);\n                foreach ($schedule->classHasContents as $classHasContent) {\n                    $classContents[$schedule->day][\"contents\"][$classHasContent->contentFk->id] = $classHasContent->contentFk->description;\n                }\n            }\n            echo json_encode([\"valid\" => true, \"classContents\" => $classContents]);\n        } else {\n            echo json_encode([\"valid\" => false, \"error\" => \"N\u00e3o existe quadro de hor\u00e1rio com dias letivos para o m\u00eas selecionado.\"]);\n        }\n    }\n\n    /**\n     * Save the contents for each class.\n     */\n    public function actionSaveClassContents()\n    {\n        if ($_POST[\"fundamentalMaior\"] == \"1\") {\n            $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and discipline_fk = :discipline_fk group by day order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"], \"discipline_fk\" => $_POST[\"discipline\"]]);\n        } else {\n            $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month group by day order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"]]);\n        }\n        foreach ($_POST[\"classContents\"] as $classContent) {\n            foreach ($schedules as $schedule) {\n                if ($schedule->day == $classContent[\"day\"]) {\n                    ClassHasContent::model()->deleteAll(\"schedule_fk = :schedule_fk\", [\"schedule_fk\" => $schedule->id]);\n                    foreach ($classContent[\"contents\"] as $content) {\n                        $classHasContent = new ClassHasContent();\n                        $classHasContent->schedule_fk = $schedule->id;\n                        $classHasContent->content_fk = $content;\n                        $classHasContent->save();\n                    }\n                    break;\n                }\n            }\n        }\n    }\n\n/**\n * Open the Frequency View.\n */\npublic\nfunction actionFrequency()\n{\n    if (Yii::app()->getAuthManager()->checkAccess('instructor', Yii::app()->user->loginInfos->id)) {\n        $criteria = new CDbCriteria;\n        $criteria->alias = \"c\";\n        $criteria->join = \"\"\n            . \" join instructor_teaching_data on instructor_teaching_data.classroom_id_fk = c.id \"\n            . \" join instructor_identification on instructor_teaching_data.instructor_fk = instructor_identification.id \";\n        $criteria->condition = \"c.school_year = :school_year and c.school_inep_fk = :school_inep_fk and instructor_identification.users_fk = :users_fk\";\n        $criteria->order = \"name\";\n        $criteria->params = array(':school_year' => Yii::app()->user->year, ':school_inep_fk' => Yii::app()->user->school, ':users_fk' => Yii::app()->user->loginInfos->id);\n\n        $classrooms = Classroom::model()->findAll($criteria);\n    } else {\n        $classrooms = Classroom::model()->findAll('school_year = :school_year and school_inep_fk = :school_inep_fk order by name', ['school_year' => Yii::app()->user->year, 'school_inep_fk' => Yii::app()->user->school]);\n    }\n    $this->render('frequency', array(\n        'classrooms' => $classrooms\n    ));\n}\n\n/**\n * Get all frequency by classroom, discipline and month\n */\npublic\nfunction actionGetFrequency()\n{\n    if ($_POST[\"fundamentalMaior\"] == \"1\") {\n        $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and discipline_fk = :discipline_fk and unavailable = 0 order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"], \"discipline_fk\" => $_POST[\"discipline\"]]);\n    } else {\n        $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and unavailable = 0 group by day order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"]]);\n    }\n    $criteria = new CDbCriteria();\n    $criteria->with = array('studentFk');\n    $criteria->together = true;\n    $criteria->order = 'name';\n    $enrollments = StudentEnrollment::model()->findAllByAttributes(array('classroom_fk' => $_POST[\"classroom\"]), $criteria);\n    if ($schedules != null) {\n        if ($enrollments != null) {\n            $students = [];\n            $dayName = [\"Domingo\", \"Segunda\", \"Ter\u00e7a\", \"Quarta\", \"Quinta\", \"Sexta\", \"S\u00e1bado\"];\n            foreach ($enrollments as $enrollment) {\n                $array[\"studentId\"] = $enrollment->student_fk;\n                $array[\"studentName\"] = $enrollment->studentFk->name;\n                $array[\"schedules\"] = [];\n                foreach ($schedules as $schedule) {\n                    $classFault = ClassFaults::model()->exists(\"schedule_fk = :schedule_fk and student_fk = :student_fk\", [\"schedule_fk\" => $schedule->id, \"student_fk\" => $enrollment->student_fk]);\n                    $available = date(\"Y-m-d\") >= Yii::app()->user->year . \"-\" . str_pad($schedule->month, 2, \"0\", STR_PAD_LEFT) . \"-\" . str_pad($schedule->day, 2, \"0\", STR_PAD_LEFT);\n                    array_push($array[\"schedules\"], [\"available\" => $available, \"day\" => $schedule->day, \"week_day\" => $dayName[$schedule->week_day], \"schedule\" => $schedule->schedule, \"fault\" => $classFault]);\n                }\n                array_push($students, $array);\n            }\n            echo json_encode([\"valid\" => true, \"students\" => $students]);\n        } else {\n            echo json_encode([\"valid\" => false, \"error\" => \"Matricule alunos nesta turma para trazer o quadro de frequ\u00eancia.\"]);\n        }\n    } else {\n        echo json_encode([\"valid\" => false, \"error\" => \"N\u00e3o existe quadro de hor\u00e1rio com dias letivos para o m\u00eas selecionado.\"]);\n    }\n}\n\n/**\n * Save the frequency for each student and class.\n */\npublic\nfunction actionSaveFrequency()\n{\n    if ($_POST[\"fundamentalMaior\"] == \"1\") {\n        $schedule = Schedule::model()->find(\"classroom_fk = :classroom_fk and day = :day and month = :month and schedule = :schedule\", [\"classroom_fk\" => $_POST[\"classroomId\"], \"day\" => $_POST[\"day\"], \"month\" => $_POST[\"month\"], \"schedule\" => $_POST[\"schedule\"]]);\n        $this->saveFrequency($schedule);\n    } else {\n        $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and day = :day and month = :month\", [\"classroom_fk\" => $_POST[\"classroomId\"], \"day\" => $_POST[\"day\"], \"month\" => $_POST[\"month\"]]);\n        foreach ($schedules as $schedule) {\n            $this->saveFrequency($schedule);\n        }\n    }\n}\n\nprivate\nfunction saveFrequency($schedule)\n{\n    if ($_POST[\"studentId\"] != null) {\n        if ($_POST[\"fault\"] == \"1\") {\n            $classFault = new ClassFaults();\n            $classFault->student_fk = $_POST[\"studentId\"];\n            $classFault->schedule_fk = $schedule->id;\n            $classFault->save();\n        } else {\n            ClassFaults::model()->deleteAll(\"schedule_fk = :schedule_fk and student_fk = :student_fk\", [\"schedule_fk\" => $schedule->id, \"student_fk\" => $_POST[\"studentId\"]]);\n        }\n    } else {\n        if ($_POST[\"fault\"] == \"1\") {\n            $enrollments = StudentEnrollment::model()->findAll(\"classroom_fk = :classroom_fk\", [\"classroom_fk\" => $_POST[\"classroomId\"]]);\n            foreach ($enrollments as $enrollment) {\n                $classFault = ClassFaults::model()->find(\"schedule_fk = :schedule_fk and student_fk = :student_fk\", [\"schedule_fk\" => $schedule->id, \"student_fk\" => $enrollment->student_fk]);\n                if ($classFault == null) {\n                    $classFault = new ClassFaults();\n                    $classFault->student_fk = $enrollment->student_fk;\n                    $classFault->schedule_fk = $schedule->id;\n                    $classFault->save();\n                }\n            }\n        } else {\n            ClassFaults::model()->deleteAll(\"schedule_fk = :schedule_fk\", [\"schedule_fk\" => $schedule->id]);\n        }\n    }\n}\n\n/**\n * Get all disciplines by classroom\n */\npublic\nfunction actionGetDisciplines()\n{\n    $crid = $_POST['classroom'];\n    $disciplinesLabels = ClassroomController::classroomDisciplineLabelArray();\n    if (Yii::app()->getAuthManager()->checkAccess('instructor', Yii::app()->user->loginInfos->id)) {\n        $disciplines = Yii::app()->db->createCommand(\n            \"select d.id from `edcenso_discipline` as `d`\n                        JOIN `instructor_teaching_data` `t` ON \n                                (`t`.`discipline_1_fk` = `d`.`id` \n                                || `t`.`discipline_2_fk` = `d`.`id` \n                                || `t`.`discipline_3_fk` = `d`.`id`\n                                || `t`.`discipline_4_fk` = `d`.`id`\n                                || `t`.`discipline_5_fk` = `d`.`id`\n                                || `t`.`discipline_6_fk` = `d`.`id`\n                                || `t`.`discipline_7_fk` = `d`.`id`\n                                || `t`.`discipline_8_fk` = `d`.`id`\n                                || `t`.`discipline_9_fk` = `d`.`id`\n                                || `t`.`discipline_10_fk` = `d`.`id`\n                                || `t`.`discipline_11_fk` = `d`.`id`\n                                || `t`.`discipline_12_fk` = `d`.`id`\n                                || `t`.`discipline_13_fk` = `d`.`id`)\n                        join `classroom` as `c` on (c.id = t.classroom_id_fk)\n                        left join instructor_identification ii on t.instructor_fk = ii.id \n                        where ii.users_fk = \" . Yii::app()->user->loginInfos->id . \" and t.classroom_id_fk = \" . $crid . \" order by d.name\")->queryAll();\n        foreach ($disciplines as $discipline) {\n            echo CHtml::tag('option', array('value' => $discipline['id']), CHtml::encode($disciplinesLabels[$discipline['id']]), true);\n        }\n    } else {\n        echo CHtml::tag('option', array('value' => \"\"), CHtml::encode('Selecione a disciplina'), true);\n        $classr = Yii::app()->db->createCommand(\"select distinct discipline_fk from schedule join edcenso_discipline on edcenso_discipline.id = schedule.discipline_fk where classroom_fk = \" . $crid . \" order by edcenso_discipline.name\")->queryAll();\n        foreach ($classr as $i => $discipline) {\n            if (isset($discipline['discipline_fk'])) {\n                echo CHtml::tag('option', array('value' => $discipline['discipline_fk']), CHtml::encode($disciplinesLabels[$discipline['discipline_fk']]), true);\n            }\n        }\n    }\n}\n}\n", "$(document).on(\"click\", \".new-calendar-button\", function () {\n    $(\".error-calendar-event\").hide();\n    $(\".create-calendar-title, #copy\").val(\"\");\n    $(\"#stages\").val(null).trigger(\"change.select2\");\n    $(\"#myNewCalendar\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".create-calendar\", function () {\n    var form = $(this).closest(\"form\");\n    if (form.find(\".create-calendar-title\").val() === \"\" || form.find(\"#stages\").val() === null) {\n        form.find(\".alert\").html(\"Campos com * s\u00e3o obrigat\u00f3rios.\").show();\n    } else {\n        form.find(\".alert\").hide();\n        $.ajax({\n            url: \"?r=calendar/default/create\",\n            type: \"POST\",\n            data: {\n                title: $(\".create-calendar-title\").val(),\n                stages: $(\"#stages\").val(),\n                copyFrom: $(\"#copy\").val()\n            },\n            beforeSend: function () {\n                $(\"#myNewCalendar .centered-loading-gif\").show();\n                $(\"#myNewCalendar .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#myNewCalendar button\").attr(\"disabled\", \"disabled\");\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            if (!data.valid) {\n                form.find(\".alert\").html(data.error).show();\n                $(\"#myNewCalendar .centered-loading-gif\").hide();\n                $(\"#myNewCalendar .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n                $(\"#myNewCalendar button\").removeAttr(\"disabled\");\n            } else {\n                window.location.reload();\n            }\n        });\n    }\n});\n\n$(document).on(\"click\", \".edit-calendar-title\", function (e) {\n    e.stopPropagation();\n    $(\"#edit-calendar-title-modal\").find(\"#Calendar_id\").val($(this).attr(\"data-id\"));\n    $(\"#edit-calendar-title-modal\").find(\"#Calendar_title\").val($(this).closest(\".accordion-group\").find(\".accordion-title\").text().trim());\n    $(\"#edit-calendar-title-modal\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".edit-calendar-title-button\", function () {\n    if ($(\"#edit-calendar-title-modal\").find(\"#Calendar_title\").val() === \"\") {\n        $(\"#edit-calendar-title-modal\").find(\".alert\").html(\"Preencha o campo abaixo.\").show();\n    } else {\n        $(\"#edit-calendar-title-modal\").find(\".alert\").hide();\n        $.ajax({\n            url: \"?r=calendar/default/editCalendarTitle\",\n            type: \"POST\",\n            data: {\n                id: $(\"#edit-calendar-title-modal\").find(\"#Calendar_id\").val(),\n                title: $(\"#edit-calendar-title-modal\").find(\"#Calendar_title\").val()\n            },\n            beforeSend: function () {\n                $(\"#edit-calendar-title-modal\").find(\".modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#edit-calendar-title-modal\").find(\"button\").attr(\"disabled\", \"disabled\");\n                $(\"#edit-calendar-title-modal\").find(\".centered-loading-gif\").show();\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            if (data.valid) {\n                $(\".calendar-container[data-id=\" + $(\"#edit-calendar-title-modal\").find(\"#Calendar_id\").val() + \"]\").closest(\".accordion-group\").find(\".accordion-title\").text($(\"#edit-calendar-title-modal\").find(\"#Calendar_title\").val());\n                $(\"#edit-calendar-title-modal\").modal(\"hide\");\n            } else {\n                $(\"#edit-calendar-title-modal\").find(\".alert\").html(data.error).show();\n            }\n        }).complete(function () {\n            $(\"#edit-calendar-title-modal\").find(\".modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\"#edit-calendar-title-modal\").find(\"button\").removeAttr(\"disabled\");\n            $(\"#edit-calendar-title-modal\").find(\".centered-loading-gif\").hide();\n        });\n    }\n});\n\n$(document).on(\"click\", \".remove-calendar\", function (e) {\n    e.stopPropagation();\n    $(\"#calendar_removal_id\").val($(this).data('id'));\n    $(\"#removeCalendar\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".remove-calendar-button\", function () {\n    $(\"#removeCalendar\").find(\".alert\").hide();\n    $.ajax({\n        url: \"?r=calendar/default/removeCalendar\",\n        type: \"POST\",\n        data: {\n            calendar_removal_id: $(\"#calendar_removal_id\").val(),\n        },\n        beforeSend: function () {\n            $(\"#removeCalendar .centered-loading-gif\").show();\n            $(\"#removeCalendar .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#removeCalendar button\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            $(\".calendar-container[data-id=\" + $(\"#calendar_removal_id\").val() + \"]\").closest(\".accordion-group\").remove();\n            $(\".accordion\").children().length\n                ? $(\".no-calendars-alert\").hide()\n                : $(\".no-calendars-alert\").show();\n            $(\"#removeCalendar\").modal(\"hide\");\n        } else {\n            $(\"#removeCalendar\").find(\".alert\").html(data.error).show();\n        }\n    }).complete(function () {\n        $(\"#removeCalendar .centered-loading-gif\").hide();\n        $(\"#removeCalendar .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\"#removeCalendar button\").removeAttr(\"disabled\");\n    });\n});\n\n$(document).on(\"click\", \".remove-event-button\", function () {\n    $.ajax({\n        url: \"?r=calendar/default/deleteEvent\",\n        type: \"POST\",\n        data: {\n            id: $(\"#CalendarEvent_id\").val(),\n            calendarId: $(\"#CalendarEvent_calendar_fk\").val()\n        },\n        beforeSend: function () {\n            $(\"#myChangeEvent .centered-loading-gif\").show();\n            $(\"#myChangeEvent .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#myChangeEvent button\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            var eventDays = $(\"a.change-event[data-id=\" + data.id + \"]\");\n            eventDays.attr(\"data-id\", \"-1\").removeAttr(\"data-toggle\").removeAttr(\"data-placement\").removeAttr(\"data-original-title\");\n            eventDays.parent().removeClass(\"calendar-\" + data.color);\n            eventDays.find(\".calendar-icon\").remove();\n            $(\"#myChangeEvent\").modal(\"hide\");\n        } else {\n            $(\"#myChangeEvent\").find(\".alert\").html(data.error).show();\n        }\n    }).complete(function () {\n        $(\"#myChangeEvent .centered-loading-gif\").hide();\n        $(\"#myChangeEvent .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\"#myChangeEvent button\").removeAttr(\"disabled\");\n    });\n});\n\n$(document).on(\"click\", \".change-event\", function () {\n    var event = this;\n    $(\"#myChangeEvent\").find(\".selected-calendar-current-year\").val($(event).closest(\".calendar\").data(\"year\"));\n    $(\".error-calendar-event\").hide();\n    if ($(event).attr('data-id') !== \"-1\") {\n        $(\".remove-event-button\").show();\n        $.ajax({\n            url: \"?r=calendar/default/event\",\n            type: \"POST\",\n            dataType: 'text',\n            data: {\n                id: $(event).attr('data-id')\n            },\n            beforeSend: function () {\n                $(event).closest(\".calendar-container\").css(\"pointer-events\", \"none\").css(\"opacity\", 0.3);\n                $(event).closest(\".accordion-inner\").find(\".centered-loading-gif\").show();\n            },\n            success: function (data) {\n                data = $.parseJSON(data);\n                $(\"#CalendarEvent_id\").val(data.id);\n                $(\"#CalendarEvent_calendar_fk\").val(data.calendar_fk);\n                $(\"#CalendarEvent_name\").val(data.name);\n                $(\"#CalendarEvent_start_date\").val(data.start_date.split(\" \")[0]);\n                $(\"#CalendarEvent_end_date\").val(data.end_date.split(\" \")[0]);\n                $(\"#CalendarEvent_calendar_event_type_fk\").val(data.calendar_event_type_fk);\n                $(\"#CalendarEvent_copyable\").attr(\"checked\", data.copyable);\n                $(\"#myChangeEvent\").modal(\"show\");\n            },\n            complete: function () {\n                $(event).closest(\".calendar-container\").css(\"pointer-events\", \"auto\").css(\"opacity\", 1);\n                $(event).closest(\".accordion-inner\").find(\".centered-loading-gif\").hide();\n            }\n        });\n    } else {\n        $(\".remove-event-button\").hide();\n        $(\"#CalendarEvent_id\").val($(event).attr('data-id'));\n        $(\"#CalendarEvent_calendar_fk\").val($(event).closest(\".calendar\").attr(\"data-id\"));\n        $(\"#CalendarEvent_name\").val(\"\");\n        $(\"#CalendarEvent_start_date\").val($(event).data('year') + \"-\" + pad($(event).data('month'), 2) + \"-\" + pad($(event).data('day'), 2));\n        $(\"#CalendarEvent_end_date\").val($(event).data('year') + \"-\" + pad($(event).data('month'), 2) + \"-\" + pad($(event).data('day'), 2));\n        $(\"#CalendarEvent_calendar_event_type_fk\").val(\"\");\n        $(\"#CalendarEvent_copyable\").attr(\"checked\", \"checked\");\n        $(\"#myChangeEvent\").modal(\"show\");\n    }\n});\n\n$(document).on(\"click\", \".save-event\", function (e) {\n    var form = $(this).closest(\"form\");\n    if (form.find(\"#CalendarEvent_name\").val() === \"\" || form.find(\"#CalendarEvent_start_date\").val() === \"\" || form.find(\"#CalendarEvent_end_date\").val() === \"\" || form.find(\"#CalendarEvent_calendar_event_type_fk\").val() === \"\") {\n        form.find(\".alert\").html(\"Campos com * s\u00e3o obrigat\u00f3rios.\").show();\n    } else if (form.find(\"#CalendarEvent_end_date\").val() < form.find(\"#CalendarEvent_start_date\").val()) {\n        form.find(\".alert\").html(\"A Data de Encerramento n\u00e3o deve ser anterior \u00e0 Data de In\u00edcio.\").show();\n    } else if (form.find(\"#CalendarEvent_start_date\").val().split(\"-\")[0] !== form.find(\".selected-calendar-current-year\").val() || form.find(\"#CalendarEvent_end_date\").val().split(\"-\")[0] !== form.find(\".selected-calendar-current-year\").val()) {\n        form.find(\".alert\").html(\"O intervalo de datas deve atender o ano do calend\u00e1rio.\").show();\n    } else {\n        form.find(\".alert\").hide();\n        $.ajax({\n            url: \"?r=calendar/default/changeEvent\",\n            type: \"POST\",\n            data: {\n                id: $(\"#CalendarEvent_id\").val(),\n                calendarFk: $(\"#CalendarEvent_calendar_fk\").val(),\n                name: $(\"#CalendarEvent_name\").val(),\n                startDate: $(\"#CalendarEvent_start_date\").val(),\n                endDate: $(\"#CalendarEvent_end_date\").val(),\n                eventTypeFk: $(\"#CalendarEvent_calendar_event_type_fk\").val(),\n                copyable: $(\"#CalendarEvent_copyable\").is(\":checked\")\n            },\n            beforeSend: function () {\n                $(\"#myChangeEvent .centered-loading-gif\").show();\n                $(\"#myChangeEvent .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#myChangeEvent button\").attr(\"disabled\", \"disabled\");\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            if (data.valid) {\n                var calendar = $(\".calendar-container[data-id=\" + $(\"#CalendarEvent_calendar_fk\").val() + \"]\");\n                if (data.uniqueDayToDelete !== null) {\n                    var uniqueDay = $(\"a.change-event[data-id=\" + data.uniqueDayToDelete.id + \"]\");\n                    uniqueDay.attr(\"data-id\", \"-1\").removeAttr(\"data-toggle\").removeAttr(\"data-placement\").removeAttr(\"data-original-title\");\n                    uniqueDay.parent().removeClass(\"calendar-\" + data.uniqueDayToDelete.color);\n                    uniqueDay.find(\".calendar-icon\").remove();\n                }\n                var oldEventDays = $(\"a.change-event[data-id=\" + data.eventId + \"]\");\n                oldEventDays.attr(\"data-id\", \"-1\").removeAttr(\"data-toggle\").removeAttr(\"data-placement\").removeAttr(\"data-original-title\");\n                oldEventDays.parent().removeClass(\"calendar-\" + data.color);\n                oldEventDays.find(\".calendar-icon\").remove();\n                $.each(data.datesToFill, function () {\n                    var date = calendar.find(\".change-event[data-year=\" + this.year + \"][data-month=\" + this.month + \"][data-day=\" + this.day + \"]\");\n                    date.attr(\"data-id\", data.eventId).attr(\"data-toggle\", \"tooltip\").attr(\"data-placement\", \"top\").attr(\"data-original-title\", data.eventName);\n                    date.parent().addClass(\"calendar-\" + data.color);\n                    date.children(\".calendar-icon\").remove();\n                    date.prepend(\"<i class='calendar-icon fa \" + data.icon + \"'></i>\");\n                    $(\"#myChangeEvent\").modal(\"hide\");\n                });\n                $('[data-toggle=\"tooltip\"]').tooltip({container: \"body\"});\n            } else {\n                form.find(\".alert\").html(data.error).show();\n            }\n        }).complete(function () {\n            $(\"#myChangeEvent .centered-loading-gif\").hide();\n            $(\"#myChangeEvent .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\"#myChangeEvent button\").removeAttr(\"disabled\");\n        });\n    }\n});\n\n$(document).on(\"click\", \".show-stages\", function (e) {\n    var icon = this;\n    e.stopPropagation();\n    if (!$(icon).closest(\".accordion-group\").find(\".floating-stages-container\").length) {\n        $(\".floating-stages-container\").remove();\n        $.ajax({\n            url: \"?r=calendar/default/showStages\",\n            type: \"POST\",\n            data: {\n                id: $(icon).data('id')\n            },\n            beforeSend: function () {\n                $(icon).css(\"pointer-events\", \"none\").find(\"i\").addClass(\"fa-spin\").addClass(\"fa-spinner\").removeClass(\"fa-question-circle-o\");\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            var html = \"<div class='floating-stages-container'><div class='stages-container-title'>\" + $(icon).closest(\".accordion-group\").find(\".accordion-title\").text() + \"</div>\";\n            $.each(data, function () {\n                html += \"<div class='stage-container'>\" + this.name + \"</div>\";\n            });\n            html += '<i class=\"close-stages-container fa fa-remove\"></i></div>';\n            $(icon).closest(\".accordion-group\").append(html);\n            $(\".floating-stages-container\").css(\"top\", $(icon).closest(\".accordion-group\").offset().top);\n        }).complete(function () {\n            $(icon).css(\"pointer-events\", \"auto\").find(\"i\").removeClass(\"fa-spin\").removeClass(\"fa-spinner\").addClass(\"fa-question-circle-o\");\n        });\n    } else {\n        $(\".floating-stages-container\").remove();\n    }\n\n});\n\n$(document).on(\"click\", \".close-stages-container\", function () {\n    $(\".floating-stages-container\").remove();\n});\n\n$(document).on(\"click\", \".change-calendar-status\", function (e) {\n    e.stopPropagation();\n    $(\"#changeCalendarStatus\").find(\".alert\").hide();\n    $(\"#changeCalendarStatus\").find(\".modal-title\").text($(this).find(\"i\").hasClass(\"fa-eye\") ? \"Indisponibilizar Calend\u00e1rio\" : \"Disponibilizar Calend\u00e1rio\");\n    $(\"#changeCalendarStatus\").find(\"#calendar-change-status-id\").val($(this).data('id'));\n    $(\"#changeCalendarStatus\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".change-calendar-status-button\", function () {\n    $(\"#changeCalendarStatus\").find(\".alert\").hide();\n    $.ajax({\n        url: \"?r=calendar/default/changeCalendarStatus\",\n        type: \"POST\",\n        data: {\n            id: $(\"#calendar-change-status-id\").val(),\n        },\n        beforeSend: function () {\n            $(\"#changeCalendarStatus .centered-loading-gif\").show();\n            $(\"#changeCalendarStatus .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#changeCalendarStatus button\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            var icon = $(\".change-calendar-status[data-id=\" + $(\"#calendar-change-status-id\").val() + \"]\");\n            data.available\n                ? icon.attr(\"data-original-title\", \"Indisponibilizar Calend\u00e1rio\").find(\"i\").removeClass(\"fa-eye-slash\").addClass(\"fa-eye\")\n                : icon.attr(\"data-original-title\", \"Disponibilizar Calend\u00e1rio\").find(\"i\").removeClass(\"fa-eye\").addClass(\"fa-eye-slash\");\n            $(icon).tooltip({container: \"body\"});\n            $(\"#changeCalendarStatus\").modal(\"hide\");\n        } else {\n            $(\"#changeCalendarStatus\").find(\".alert\").html(data.error).show();\n        }\n    }).complete(function () {\n        $(\"#changeCalendarStatus .centered-loading-gif\").hide();\n        $(\"#changeCalendarStatus .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\"#changeCalendarStatus button\").removeAttr(\"disabled\");\n    });\n});\n\n$(document).on(\"click\", \".add-fundamental-menor\", function () {\n    $(\"#stages option[value=14]\").prop(\"selected\", true);\n    $(\"#stages option[value=15]\").prop(\"selected\", true);\n    $(\"#stages option[value=16]\").prop(\"selected\", true);\n    $(\"#stages\").trigger(\"change.select2\");\n});\n\n$(document).on(\"click\", \".add-fundamental-maior\", function () {\n    $(\"#stages option[value=17]\").prop(\"selected\", true);\n    $(\"#stages option[value=18]\").prop(\"selected\", true);\n    $(\"#stages option[value=19]\").prop(\"selected\", true);\n    $(\"#stages option[value=20]\").prop(\"selected\", true);\n    $(\"#stages option[value=21]\").prop(\"selected\", true);\n    $(\"#stages option[value=41]\").prop(\"selected\", true);\n    $(\"#stages\").trigger(\"change.select2\");\n});\n\n$(document).on(\"click\", \".remove-stages\", function () {\n    $(\"#stages option\").prop(\"selected\", false);\n    $(\"#stages\").trigger(\"change.select2\");\n});\n\nfunction pad(num, size) {\n    num = num.toString();\n    while (num.length < size) num = \"0\" + num;\n    return num;\n}", "$('#save_button').click(function() { \n    $('#quiz-form').submit();\n});\n\n$('#delete_button').click(function() {\n    if(confirm('Deseja excluir o question\u00e1rio')){\n        var host = window.location.href;\n        var url = host.split('?')[1];\n        var action = 'index.php?' + (url.indexOf(\"update\") == -1 ? url.replace('create','delete') : url.replace('update','delete'));\n        $('#quiz-form').attr('action', action);\n        $('#quiz-form').submit();\n    } \n});\n\n$('#save_group_button').click(function() { \n    $('#group-form').submit();\n});\n\n$('#delete_group_button').click(function() {\n    if(confirm('Deseja excluir o grupo')){\n        var host = window.location.href;\n        var url = host.split('?')[1];\n        var action = 'index.php?' + (url.indexOf(\"update\") == -1 ? url.replace('create','delete') : url.replace('update','delete'));\n        $('#group-form').attr('action', action);\n        $('#group-form').submit();\n    } \n});\n\n$('#save_question_group_button').click(function() { \n    $('#questiongroup-form').submit();\n});\n\n$('#delete_question_group_button').click(function() {\n    if(confirm('Deseja excluir o grupo')){\n        var host = window.location.href;\n        var url = host.split('?')[1];\n        var action = 'index.php?' + (url.indexOf(\"update\") == -1 ? url.replace('create','delete') : url.replace('update','delete'));\n        $('#questiongroup-form').attr('action', action);\n        $('#questiongroup-form').submit();\n    } \n});\n\n\n$('#save_question_button').click(function() { \n    $('#question-form').submit();\n});\n\n$('#delete_question_button').click(function() {\n    if(confirm('Deseja excluir a quest\u00e3o')){\n        var host = window.location.href;\n        var url = host.split('?')[1];\n        var action = 'index.php?' + (url.indexOf(\"update\") == -1 ? url.replace('create','delete') : url.replace('update','delete'));\n        $('#question-form').attr('action', action);\n        $('#question-form').submit();\n    } \n});\n\n$('#save_answer_button').click(function() { \n    $('#answer-form').submit();\n});\n\nvar Option = function(){\n    var description = $('#QuestionOption_description');\n    var answer = $('#QuestionOption_answer');\n    var questionId = $('#QuestionOption_question_id');\n    var id = $('#QuestionOption_id');\n    var complement = $('#QuestionOption_complement');\n    var container = $('#container_option');\n    var button = $('#save_option_button');\n\n    return{\n        insert: function(){\n            if(Option.validate()){\n                var data = {description: description.val(), question_id: questionId.val(), answer: answer.val(), complement: complement.is(':checked') ? 1 : 0};\n                $.ajax({\n                    type: \"GET\",\n                    url: \"index.php\",\n                    data: { r: 'quiz/default/createOption', QuestionOption: data},\n                    dataType: 'json',\n                    contentType: \"application/json; charset=utf-8\"\n                  })\n                .done(function(data){\n                    if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                        var element = $('<tr></tr>')\n                            .attr({'option-id': data.id, 'option-description': data.description, 'option-answer': data.answer, 'option-complement': data.complement})\n                            .append($('<td></td>').text(container.find('tr').length + 1))\n                            .append($('<td></td>').text(data.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Editar').click(Option.initUpdate))\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(Option.initDelete))\n                            );\n                        container.append(element);\n                        Option.clear();\n                    }\n                })\n                .fail(function(data){\n                    alert('Erro ao salvar item');\n                });\n            }\n        },\n        update: function(){\n            if(Option.validate()){\n                var data = {description: description.val(), question_id: questionId.val(), answer: answer.val(), complement: complement.is(':checked') ? 1 : 0};\n                $.ajax({\n                    type: \"GET\",\n                    url: \"index.php\",\n                    data: { r: 'quiz/default/updateOption', id: id.val(), QuestionOption: data},\n                    dataType: 'json',\n                    contentType: \"application/json; charset=utf-8\"\n                  })\n                .done(function(data){\n                    if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                       var elementActive = container.find('tr[option-id=\"'+data.id+'\"]');\n                        var element = $('<tr></tr>')\n                            .attr({'option-id': data.id, 'option-description': data.description, 'option-answer': data.answer, 'option-complement': data.complement})\n                            .append($('<td></td>').text(elementActive.children('td:eq(0)').text()))\n                            .append($('<td></td>').text(data.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Editar').click(Option.initUpdate))\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(Option.initDelete))\n                            );\n                        elementActive.replaceWith(element);\n                    }\n                    else if(typeof data.errorCode != 'undefined' && data.errorCode == '1'){\n                        alert(data.msg);\n                    }\n                    Option.clear();\n                    Option.initInsert();\n                })\n                .fail(function(data){\n                    alert('Erro ao alterar item');\n                    Option.clear();\n                    Option.initInsert();\n                });\n            }\n        },\n        delete: function(){\n            var data = {id: id.val(), question_id: questionId.val()};\n            $.ajax({\n                type: \"GET\",\n                url: \"index.php\",\n                data: { r: 'quiz/default/deleteOption', id: id.val(), QuestionOption: data},\n                dataType: 'json',\n                contentType: \"application/json; charset=utf-8\"\n                })\n            .done(function(data){\n                if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                    var elementActive = container.find('tr[option-id=\"'+data.id+'\"]');\n                    elementActive.remove();\n                }\n                else if(typeof data.errorCode != 'undefined' && data.errorCode == '1'){\n                    alert(data.msg);\n                }\n\n                Option.clear();\n                Option.initInsert();\n            })\n            .fail(function(data){\n                alert('Erro ao excluir item');\n                Option.clear();\n                Option.initInsert();\n            });\n        },\n        initInsert: function(){\n            id.val('');\n            button.unbind('click');\n            button.bind('click', Option.insert);\n        },\n        initUpdate: function(e){\n            e.preventDefault();\n            var element = $(this).closest('tr');\n            id.val(element.attr('option-id'));\n            description.val(element.attr('option-description'));\n            answer.val(element.attr('option-answer'));\n            complement.prop('checked', Boolean(parseInt(element.attr('option-complement'))));\n            button.unbind('click');\n            button.bind('click', Option.update);\n        },\n        initDelete: function(e){\n            e.preventDefault();\n            var element = $(this).closest('tr');\n            id.val(element.attr('option-id'));\n            if(confirm('Deseja excluir o item?')){\n                Option.delete();\n            }\n        },\n        init: function(){\n            id.val('');\n            button.unbind('click');\n            button.bind('click', Option.insert);\n            Option.buildTable(dataOption);\n        },\n        validate: function(){\n            if(description.val() == '' || answer.val() == '' || questionId.val() == '' ){\n                alert('Preencha todos os campos!');\n                return false;\n            }\n            return true;\n        },\n        clear: function(){\n            description.val('');\n            answer.val('');\n            id.val('');\n            complement.prop('checked',false);\n        },\n        buildTable: function(data){\n            $.each(data, function(K, v){\n                var element = $('<tr></tr>')\n                            .attr({'option-id': v.id, 'option-description': v.description, 'option-answer': v.answer, 'option-complement': v.complement})\n                            .append($('<td></td>').text(container.find('tr').length + 1))\n                            .append($('<td></td>').text(v.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Editar').click(Option.initUpdate))\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(Option.initDelete))\n                            );\n                container.append(element);\n            });\n        },\n        showComplement: function(){\n            var uid = $(this).attr('uid');\n            var id = $(this).attr('id');\n            var type = $(this).attr('type');\n            var complement = id.replace(\"response\",\"complement\");\n            var isChecked = $(this).is(':checked');\n            if(type == 'checkbox'){\n                if(isChecked){\n                    $('#'+uid).show();\n                    $('#'+complement).prop('disabled',false);\n                }\n                else{\n                    $('#'+uid).hide();\n                    $('#'+complement).prop('disabled',true);\n                }\n            }\n            else if(type == 'radio'){\n                var partialUid = uid.substring(0,(uid.length -1));\n                var elementChecked = $('input[id^=\"'+partialUid+'\"]:checked');\n                \n                if(isChecked){\n                    $('div[id^=\"'+partialUid+'\"]').each(function(){\n                        $(this).hide();\n                    });\n    \n                    $('input[id^=\"'+partialUid+'\"]').each(function(){\n                        if($(this).attr('type') == 'text')\n                            $(this).prop('disabled',true);\n                        else if($(this).attr('type') == 'radio')\n                            $(this).prop('checked',false);\n                    });\n                    $(this).prop('checked',true);\n                    $('#'+uid).show();\n                    $('#'+complement).prop('disabled',false);\n                }\n            }\n        },\n        initComplement: function(){\n            $('input[type=\"checkbox\"],input[type=\"radio\"]').each(\n                function(k, v){\n                    $(this).bind('click', Option.showComplement);\n                    $(this).bind('change', Option.showComplement);\n                    $(this).trigger('change');\n                }\n            );\n        }\n    }\n}();\n\nOption.initComplement();\n\n\nvar QuizQuestion = function(){\n    var quizId = $('#QuizQuestion_quiz_id');\n    var questionId = $('#QuizQuestion_question_id');\n    var container = $('#container_quiz_question');\n    var button = $('#save_quiz_question_button');\n\n    return{\n        insert: function(){\n            if(QuizQuestion.validate()){\n                var data = {quiz_id: quizId.val(), question_id: questionId.val()};\n                $.ajax({\n                    type: \"GET\",\n                    url: \"index.php\",\n                    data: { r: 'quiz/default/setQuizQuestion', quizId: quizId.val(), questionId: questionId.val(),  QuizQuestion: data},\n                    dataType: 'json',\n                    contentType: \"application/json; charset=utf-8\"\n                  })\n                .done(function(data){\n                    if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                        var element = $('<tr></tr>')\n                            .attr({'key': data.quizId + '' + data.questionId, 'quiz-id': data.quizId, 'question-id': data.questionId, 'question-description': data.description})\n                            .append($('<td></td>').text(container.find('tr').length + 1))\n                            .append($('<td></td>').text(data.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(QuizQuestion.initDelete))\n                            );\n                        container.append(element);\n                        QuizQuestion.clear();\n                    }\n                    else if(typeof data.errorCode != 'undefined' && parseInt(data.errorCode) > 0){\n                        alert(data.msg);\n                    }\n                })\n                .fail(function(data){\n                    alert('Erro ao salvar item');\n                });\n            }\n        },\n        delete: function(){\n            var data = {quiz_id: quizId.val(), question_id: questionId.val()};\n            $.ajax({\n                type: \"GET\",\n                url: \"index.php\",\n                data: { r: 'quiz/default/unsetQuizQuestion', quizId: quizId.val(), questionId: questionId.val(), QuizQuestion: data},\n                dataType: 'json',\n                contentType: \"application/json; charset=utf-8\"\n                })\n            .done(function(data){\n                if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                    var elementActive = container.find('tr[key=\"'+data.quizId+ '' + data.questionId +'\"]');\n                    elementActive.remove();\n                }\n                else if(typeof data.errorCode != 'undefined' && data.errorCode == '1'){\n                    alert(data.msg);\n                }\n\n                QuizQuestion.clear();\n            })\n            .fail(function(data){\n                alert('Erro ao excluir item');\n                QuizQuestion.clear();\n            });\n        },\n        initInsert: function(){\n            id.val('');\n            button.unbind('click');\n            button.bind('click', Option.insert);\n        },\n        initDelete: function(e){\n            e.preventDefault();\n            var element = $(this).closest('tr');\n            quizId.val(element.attr('quiz-id'));\n            questionId.val(element.attr('question-id'));\n            if(confirm('Deseja excluir o item?')){\n                QuizQuestion.delete();\n            }\n        },\n        init: function(){\n            questionId.val('');\n            button.unbind('click');\n            button.bind('click', QuizQuestion.insert);\n            QuizQuestion.buildTable(dataQuizQuestion);\n        },\n        validate: function(){\n            if(questionId.val() == '' || quizId.val() == ''){\n                alert('Preencha todos os campos!');\n                return false;\n            }\n            return true;\n        },\n        clear: function(){\n            questionId.val('');\n        },\n        buildTable: function(data){\n            $.each(data, function(k, v){\n                var element = $('<tr></tr>')\n                            .attr({'key': v.quiz_id + '' + v.question_id, 'quiz-id': v.quiz_id, 'question-id': v.question_id, 'question-description': v.description})\n                            .append($('<td></td>').text(container.find('tr').length + 1))\n                            .append($('<td></td>').text(v.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(QuizQuestion.initDelete))\n                            );\n                container.append(element);\n            });\n        }\n    }\n}();", "$(document).on(\"change\", \"#classroom_fk\", function () {\n    if ($(this).val() !== \"\") {\n        var select = this;\n        $(select).attr(\"disabled\", \"disabled\");\n        $.ajax({\n            url: getTimesheetURL,\n            type: \"POST\",\n            data: {\n                cid: $(this).val()\n            },\n            beforeSend: function () {\n                $(\".loading-alert\").addClass(\"display-hide\");\n                $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n                $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n            },\n        }).success(function (data) {\n            getTimesheet(data);\n            data = JSON.parse(data);\n            if (data.disciplines !== undefined) {\n                var html = \"<option></option>\";\n                $.each(data.disciplines, function () {\n                    html += \"<option value='\" + this.disciplineId + \"'>\" + this.disciplineName + \"</option>\";\n                });\n                $(\".modal-add-schedule-discipline\").html(html);\n                $(\".modal-add-schedule-discipline\").select2('destroy');\n                $(\".modal-add-schedule-discipline\").select2({\n                    placeholder: \"Selecione a Disciplina...\",\n                    width: \"100%\"\n                });\n            }\n        }).complete(function () {\n            $(\".loading-timesheet\").hide();\n            $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(select).removeAttr(\"disabled\");\n            $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n        });\n    } else {\n        $(\".schedule-info\").addClass(\"display-hide\");\n        $(\".table-container\").hide();\n    }\n});\n\n$(document).on(\"click\", \".btn-generate-timesheet\", function () {\n    if ($(\".tables-timesheet\").is(\":visible\") && $(\".table-month tbody td\").children().length) {\n        $(\"#generateAnotherTimesheet\").modal(\"show\");\n    } else {\n        generateTimesheet();\n    }\n});\n\n$(document).on(\"click\", \".confirm-timesheet-generation\", function () {\n    generateTimesheet();\n});\n\nfunction generateTimesheet() {\n    var classroom = $(\"select.classroom-id\").val();\n    $.ajax({\n        url: generateTimesheetURL,\n        type: \"POST\",\n        data: {\n            classroom: classroom\n        },\n        beforeSend: function () {\n            $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n            $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n            $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        getTimesheet(data);\n    }).complete(function () {\n        $(\".loading-timesheet\").hide();\n        $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n        $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n    });\n}\n\nfunction getTimesheet(data) {\n    data = DOMPurify.sanitize(data);\n    data = JSON.parse(data);\n    $(\".loading-alert\").addClass(\"display-hide\");\n    $(\".schedule-info\").removeClass(\"display-hide\");\n    $(\"#turn\").hide();\n    $(\".table-container\").show();\n    if (data.valid == null) {\n        $(\".schedule-info\").addClass(\"display-hide\");\n    } else if (!data.valid) {\n        if (data.error === \"curricularMatrix\") {\n            $(\".loading-alert\").removeClass(\"display-hide\").html(\"Crie uma <b>matriz curricular</b> com disciplinas diversas e com a mesma etapa da turma selecionada.\");\n            $(\".schedule-info\").addClass(\"display-hide\");\n            $(\".table-container\").hide();\n        } else if (data.error === \"calendar\") {\n            $(\".loading-alert\").removeClass(\"display-hide\").html(\"Disponibilize um <b>calend\u00e1rio</b> contemplando a etapa da turma selecionada e com os eventos de in\u00edcio e fim de ano escolar.\");\n            $(\".schedule-info\").addClass(\"display-hide\");\n            $(\".table-container\").hide();\n        } else if (data.error === \"frequencyFilled\") {\n            $(\".loading-alert\").removeClass(\"display-hide\").html(\"N\u00e3o se pode mais gerar um novo quadro de hor\u00e1rio, visto que j\u00e1 existe preenchimento de frequ\u00eancia.\");\n            $(\"#turn\").show();\n        }\n    } else {\n        $(\".tables-timesheet tbody\").children().remove();\n        $(\".calendar-icons th\").children().remove();\n        var turn = \"\";\n        var lastMonthWeek = 1;\n        $.each(data.calendarEvents, function () {\n            $(\".calendar-icons th[icon-month=\" + this.month + \"][icon-day=\" + this.day + \"]\").append(\n                '<div class=\"calendar-timesheet-icon calendar-' + this.color + '\">' +\n                '<i data-toggle=\"tooltip\" data-placement=\"bottom\" data-original-title=\"' + this.name + '\" class=\"fa ' + this.icon + '\"></i>' +\n                '</div>'\n            );\n        });\n        for (var month = 1; month <= 12; month++) {\n            var html = \"\";\n\n            for (var schedule = 1; schedule <= 10; schedule++) {\n                var weekDayCount = Number($(\".table-month[month=\" + month + \"]\").attr(\"first-day-weekday\"));\n                var week = lastMonthWeek;\n                html += \"<tr schedule='\" + schedule + \"'><th>\" + schedule + \"\u00ba</th>\";\n\n                for (var day = 1; day <= Number($(\".table-month[month=\" + month + \"]\").attr(\"days-count\")); day++) {\n                    var hardUnavailableDay = data.hardUnavailableDays[month] !== undefined && $.inArray(day.toString(), data.hardUnavailableDays[month]) !== -1;\n                    var softUnavailableDay = data.softUnavailableDays[month] !== undefined && $.inArray(day.toString(), data.softUnavailableDays[month]) !== -1;\n\n                    var frequencyUnavailableDay = !hardUnavailableDay && data.frequencyUnavailableLastDay !== undefined\n                        && (month < Number(data.frequencyUnavailableLastDay.month) || (month === Number(data.frequencyUnavailableLastDay.month) && day <= Number(data.frequencyUnavailableLastDay.day)));\n\n                    if (data.schedules[month] !== undefined && data.schedules[month][schedule] !== undefined && data.schedules[month][schedule][day] !== undefined) {\n                        if (turn === \"\") {\n                            if (data.schedules[month][schedule][day].turn === \"0\") turn = \"Manh\u00e3\";\n                            if (data.schedules[month][schedule][day].turn === \"1\") turn = \"Tarde\";\n                            if (data.schedules[month][schedule][day].turn === \"2\") turn = \"Noite\";\n                        }\n                        var discipline = changeNameLength(data.schedules[month][schedule][day].disciplineName, 30);\n                        // var instructor = changeNameLength(info.instructorInfo.name, 30);\n\n                        // var icons = \"\";\n                        // if (info.instructorInfo.unavailable)\n                        //     icons +=\n                        //         \"<i title='Hor\u00e1rio indispon\u00edvel para o instrutor.' class='unavailability-icon fa fa-times-circle darkred'></i>\";\n                        // if (info.instructorInfo.countConflicts > 1)\n                        //     icons +=\n                        //         \"<i title='Instrutor possui \" +\n                        //         info.instructorInfo.countConflicts +\n                        //         \" conflitos neste hor\u00e1rio.' class='fa fa-exclamation-triangle conflict-icon darkgoldenrod'></i>\";\n                        html += \"\" +\n                            \"<td class='\" + (hardUnavailableDay ? \"hard-unavailable\" : \"\") + (frequencyUnavailableDay ? \" frequency-unavailable\" : (softUnavailableDay ? \"soft-unavailable\" : \"\")) + \"' day='\" + day + \"' week='\" + week + \"' week_day='\" + weekDayCount + \"' \" + (frequencyUnavailableDay ? 'data-toggle=\"tooltip\" data-placement=\"bottom\" data-original-title=\"N\u00e3o se pode mais editar esse hor\u00e1rio, visto que j\u00e1 existe preenchimento de frequ\u00eancia at\u00e9 o dia ' + (pad(data.frequencyUnavailableLastDay.day, 2) + \"/\" + pad(data.frequencyUnavailableLastDay.month, 2)) + '.\"' : \"\") + \">\" +\n                            \"<div schedule='\" + data.schedules[month][schedule][day].id + \"' discipline_id='\" + data.schedules[month][schedule][day].disciplineId + \"'class='schedule-block'>\" +\n                            \"<p class='discipline-name' title='\" + data.schedules[month][schedule][day].disciplineName + \"'>\" + discipline + \"</p>\" +\n                            // \"<p class='instructor-name' instructor_id='\" + info.instructorInfo.id + \"' title='\" + info.instructorInfo.name + \"'>\" +\n                            // instructor +\n                            // \"<i class='fa fa-pencil edit-instructor'></i></p>\" +\n                            // icons +\n                            \"</div>\" +\n                            \"</td>\";\n                    } else {\n                        html += \"<td class='\" + (hardUnavailableDay ? \"hard-unavailable\" : \"\") + (frequencyUnavailableDay ? \" frequency-unavailable\" : (softUnavailableDay ? \"soft-unavailable\" : \"\")) + \"' day='\" + day + \"' week='\" + week + \"' week_day='\" + weekDayCount + \"' \" + (frequencyUnavailableDay ? 'data-toggle=\"tooltip\" data-placement=\"bottom\" data-original-title=\"N\u00e3o se pode mais editar esse hor\u00e1rio, visto que j\u00e1 existe preenchimento de frequ\u00eancia at\u00e9 o dia ' + (pad(data.frequencyUnavailableLastDay.day, 2) + \"/\" + pad(data.frequencyUnavailableLastDay.month, 2)) + '.\"' : \"\") + \"></td>\";\n                    }\n\n                    if (weekDayCount === 6) {\n                        weekDayCount = 0;\n                        week++;\n                    } else {\n                        weekDayCount++;\n                    }\n                    if (day === Number($(\".table-month[month=\" + month + \"]\").attr(\"days-count\")) && schedule === 10) {\n                        lastMonthWeek = week;\n                    }\n                }\n                html += \"</tr>\";\n            }\n            $(\".tables-timesheet table[month=\" + month + \"] tbody\").html(html);\n            $('[data-toggle=\"tooltip\"]').tooltip({container: \"body\"});\n        }\n        calculateWorkload(data.disciplines, false);\n        $(\"#turn\").text(turn).show();\n        $(\".table-container\").show();\n    }\n}\n\nfunction calculateWorkload(disciplines, increment) {\n    var hasOverflow = false;\n    if (!increment) {\n        disciplines = sortResults(disciplines, \"disciplineName\", true);\n        var html = \"\";\n        $.each(disciplines, function () {\n            var workloadUsed = Number(this.workloadUsed);\n            var workloadTotal = Number(this.workloadTotal);\n            if (!hasOverflow) {\n                hasOverflow = workloadUsed > workloadTotal;\n            }\n            var workloadColor = workloadUsed > workloadTotal ? \"workload-red\" : (workloadUsed === workloadTotal ? \"workload-green\" : \"\");\n            html += \"<div class='workload \" + workloadColor + \"' discipline-id='\" + this.disciplineId + \"'><div class='workload-discipline'>\" + this.disciplineName + \"</div><div class='workload-numbers'><span class='workload-used'>\" + workloadUsed + \"</span>/<span class='workload-total'>\" + workloadTotal + \"</span></div></div>\";\n        });\n        $(\".workloads\").find(\".workload\").remove();\n        $(\".workloads\").append(html);\n    } else {\n        $.each(disciplines, function () {\n            var workload = $(\".workload[discipline-id=\" + this.disciplineId + \"]\");\n            var workloadUsed = Number(workload.find(\".workload-used\").text()) + Number(this.workloadUsed);\n            var workloadTotal = Number(workload.find(\".workload-total\").text());\n            workloadUsed > workloadTotal\n                ? workload.addClass(\"workload-red\").removeClass(\"workload-green\")\n                : (workloadUsed === workloadTotal ? workload.addClass(\"workload-green\").removeClass(\"workload-red\") : workload.removeClass(\"workload-red\").removeClass(\"workload-green\"));\n            workload.find(\".workload-used\").text(workloadUsed);\n        });\n        hasOverflow = $(\".workloads\").find(\".workload.workload-red\").length;\n    }\n    if (hasOverflow) {\n        $(\".workloads-overflow\").show();\n        $(\".workloads-activator\").addClass(\"fa-chevron-left\").removeClass(\"fa-chevron-right\");\n        $(\".workloads\").show();\n    } else {\n        $(\".workloads-overflow\").hide();\n    }\n}\n\nfunction sortResults(array, prop, asc) {\n    array.sort(function (a, b) {\n        if (asc) {\n            return (a[prop] > b[prop]) ? 1 : ((a[prop] < b[prop]) ? -1 : 0);\n        } else {\n            return (b[prop] > a[prop]) ? 1 : ((b[prop] < a[prop]) ? -1 : 0);\n        }\n    });\n    return array;\n}\n\nfunction changeNameLength(name, limit) {\n    return name.length > limit ? name.substring(0, limit - 3) + \"...\" : name;\n}\n\n$(document).on(\"click\", \".tables-timesheet td\", function () {\n    if ($(this).hasClass(\"schedule-selected\")) {\n        $(this).removeClass(\"schedule-selected\");\n        $(\".tables-timesheet\").find(\".schedule-available\").removeClass(\"schedule-available\");\n        $(\".schedule-remove, .schedule-add\").remove();\n    } else {\n        //J\u00e1 selecionou algum diferente do primeiro e da mesma semana\n        if ($(\".tables-timesheet\").find(\".schedule-selected\").length > 0) {\n            var firstSelected = $(\".tables-timesheet\").find(\".schedule-selected\");\n            var secondSelected = $(this);\n\n            if ((!firstSelected.find(\".schedule-block\").length && !secondSelected.find(\".schedule-block\").length) || !secondSelected.hasClass(\"schedule-available\")) {\n                firstSelected.removeClass(\"schedule-selected\");\n                $(\".tables-timesheet\").find(\".schedule-available\").removeClass(\"schedule-available\");\n                $(\".schedule-remove, .schedule-add\").remove();\n            } else {\n                var firstSchedule = {\n                    month: firstSelected.closest(\"table\").attr(\"month\"),\n                    day: firstSelected.attr(\"day\"),\n                    week_day: firstSelected.attr(\"week_day\"),\n                    schedule: firstSelected.closest(\"tr\").attr(\"schedule\")\n                };\n                var secondSchedule = {\n                    month: secondSelected.closest(\"table\").attr(\"month\"),\n                    day: secondSelected.attr(\"day\"),\n                    week_day: secondSelected.attr(\"week_day\"),\n                    schedule: secondSelected.closest(\"tr\").attr(\"schedule\")\n                };\n                swapSchedule(firstSchedule, secondSchedule);\n            }\n        } else if (!$(this).hasClass(\"hard-unavailable\") && !$(this).hasClass(\"frequency-unavailable\")) {\n            //Primeira sele\u00e7\u00e3o\n            $(this).addClass(\"schedule-selected\");\n            $(this).closest(\".tables-timesheet\").find(\"td[week=\" + $(this).attr(\"week\") + \"]:not(.hard-unavailable):not(.frequency-unavailable)\").not(this).addClass(\"schedule-available\");\n            if ($(this).find(\".schedule-block\").length) {\n                $(this).append(\"<i class='schedule-remove fa fa-remove'></i>\");\n            } else {\n                $(this).append(\"<i class='schedule-add fa fa-plus'></i>\");\n            }\n        }\n    }\n});\n\n$(document).on(\"click\", \".schedule-remove\", function (e) {\n    e.stopPropagation();\n    var schedule = {\n        month: $(this).closest(\"table\").attr(\"month\"),\n        day: $(this).closest(\"td\").attr(\"day\"),\n        week_day: $(this).closest(\"td\").attr(\"week_day\"),\n        schedule: $(this).closest(\"tr\").attr(\"schedule\")\n    };\n    $.ajax({\n        url: removeScheduleURL,\n        type: \"POST\",\n        data: {\n            classroomId: $(\"select.classroom-id\").val(),\n            schedule: schedule,\n            replicate: $(\".replicate-actions\").is(\":checked\") ? 1 : 0\n        }, beforeSend: function () {\n            $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n            $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\".classroom_fk\").attr(\"disabled\", \"disabled\");\n            $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            $.each(data.removes, function () {\n                $(\"table[month=\" + this.month + \"] tr[schedule=\" + this.schedule + \"] td[day=\" + this.day + \"]\").children().remove();\n            });\n            calculateWorkload(data.disciplines, true);\n        }\n        $(\".schedule-remove\").remove();\n        $(\".schedule-selected\").removeClass(\"schedule-selected\");\n        $(\".schedule-available\").removeClass(\"schedule-available\");\n    }).complete(function () {\n        $(\".loading-timesheet\").hide();\n        $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\".classroom_fk\").removeAttr(\"disabled\");\n        $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n    });\n});\n\n$(document).on(\"click\", \".schedule-add\", function (e) {\n    e.stopPropagation();\n    $(\".add-schedule-alert\").addClass(\"no-show\");\n    $(\".modal-replicate-actions\").prop(\"checked\", $(\".replicate-actions\").is(\":checked\"));\n    $(\".add-schedule-month\").val($(this).closest(\"table\").attr(\"month\"));\n    $(\".add-schedule-day\").val($(this).closest(\"td\").attr(\"day\"));\n    $(\".add-schedule-weekday\").val($(this).closest(\"td\").attr(\"week_day\"));\n    $(\".add-schedule-schedule\").val($(this).closest(\"tr\").attr(\"schedule\"));\n    $(\".modal-add-schedule-discipline\").val(\"\").trigger(\"change.select2\");\n    $(\"#addSchedule\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".replicate-actions-container\", function (e) {\n    if (e.target === this) {\n        $(this).find(\".replicate-actions-checkbox\").prop(\"checked\", !$(this).find(\".replicate-actions-checkbox\").is(\":checked\")).trigger(\"change\");\n    }\n});\n\n$(document).on(\"change\", \".replicate-actions-checkbox\", function (e) {\n    $(\".replicate-actions-checkbox\").prop(\"checked\", $(this).is(\":checked\"));\n});\n\n$(document).on(\"click\", \".btn-add-schedule\", function () {\n    if ($(\"select.modal-add-schedule-discipline\").val() !== \"\") {\n        $(\".add-schedule-alert\").addClass(\"no-show\");\n        $(\"#addSchedule\").modal(\"hide\");\n        $.ajax({\n            url: addScheduleURL,\n            type: \"POST\",\n            data: {\n                classroomId: $(\"select.classroom-id\").val(),\n                disciplineId: $(\"select.modal-add-schedule-discipline\").val(),\n                schedule: {\n                    month: $(\".add-schedule-month\").val(),\n                    day: $(\".add-schedule-day\").val(),\n                    week_day: $(\".add-schedule-weekday\").val(),\n                    schedule: $(\".add-schedule-schedule\").val()\n                },\n                replicate: $(\".modal-replicate-actions\").is(\":checked\") ? 1 : 0\n            }, beforeSend: function () {\n                $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n                $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\".classroom_fk\").attr(\"disabled\", \"disabled\");\n                $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            if (data.valid) {\n                $.each(data.adds, function () {\n                    var discipline = changeNameLength(this.disciplineName, 30);\n                    $(\".table-month[month=\" + this.month + \"] tbody\").find(\"tr[schedule=\" + this.schedule + \"]\").find(\"td[day=\" + this.day + \"]\").html(\"\" +\n                        \"<div schedule='\" + this.id + \"' discipline_id='\" + this.disciplineId + \"' class='schedule-block'>\" +\n                        \"<p class='discipline-name' title='\" + this.disciplineName + \"'>\" + discipline + \"</p>\" +\n                        \"</div>\"\n                    );\n                });\n                calculateWorkload(data.disciplines, true);\n            }\n            $(\".schedule-add\").remove();\n            $(\".schedule-selected\").removeClass(\"schedule-selected\");\n            $(\".schedule-available\").removeClass(\"schedule-available\");\n        }).complete(function () {\n            $(\".loading-timesheet\").hide();\n            $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\".classroom_fk\").removeAttr(\"disabled\");\n            $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n        });\n    } else {\n        $(\".add-schedule-alert\").removeClass(\"no-show\");\n    }\n});\n\n$(document).on('click', \".cancel-add-schedule\", function () {\n    $(\".schedule-add\").remove();\n    $(\".schedule-selected\").removeClass(\"schedule-selected\");\n    $(\".schedule-available\").removeClass(\"schedule-available\");\n});\n\nfunction swapSchedule(firstSchedule, secondSchedule) {\n    $.ajax({\n        url: changeSchedulesURL,\n        type: \"POST\",\n        data: {\n            classroomId: $(\"select.classroom-id\").val(),\n            firstSchedule: firstSchedule,\n            secondSchedule: secondSchedule,\n            replicate: $(\".replicate-actions\").is(\":checked\") ? 1 : 0\n        }, beforeSend: function () {\n            $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n            $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\".classroom_fk\").attr(\"disabled\", \"disabled\");\n            $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            $.each(data.changes, function () {\n                var firstScheduleBlock = $(\"table[month=\" + this.firstSchedule.month + \"] tr[schedule=\" + this.firstSchedule.schedule + \"] td[day=\" + this.firstSchedule.day + \"]\").children();\n                var secondScheduleBlock = $(\"table[month=\" + this.secondSchedule.month + \"] tr[schedule=\" + this.secondSchedule.schedule + \"] td[day=\" + this.secondSchedule.day + \"]\").children();\n                $(\"table[month=\" + this.firstSchedule.month + \"] tr[schedule=\" + this.firstSchedule.schedule + \"] td[day=\" + this.firstSchedule.day + \"]\").html(secondScheduleBlock);\n                $(\"table[month=\" + this.secondSchedule.month + \"] tr[schedule=\" + this.secondSchedule.schedule + \"] td[day=\" + this.secondSchedule.day + \"]\").html(firstScheduleBlock);\n            });\n            $(\"td.hard-unavailable\").children().remove();\n            calculateWorkload(data.disciplines, false);\n        }\n        $(\".schedule-remove, .schedule-add\").remove();\n        $(\".schedule-selected\").removeClass(\"schedule-selected\");\n        $(\".schedule-available\").removeClass(\"schedule-available\");\n    }).complete(function () {\n        $(\".loading-timesheet\").hide();\n        $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\".classroom_fk\").removeAttr(\"disabled\");\n        $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n    });\n}\n\n$(document).on(\"click\", \".workloads-activator\", function () {\n    if ($(\".workloads-activator\").hasClass(\"fa-chevron-right\")) {\n        $(\".workloads-activator\").addClass(\"fa-chevron-left\").removeClass(\"fa-chevron-right\");\n        $(\".workloads\").show();\n    } else {\n        $(\".workloads-activator\").addClass(\"fa-chevron-right\").removeClass(\"fa-chevron-left\");\n        $(\".workloads\").hide();\n    }\n});\n\n$(document).on(\"click\", \".schedule-selected .instructor-name\", function () {\n    var instructorId = $(this).attr(\"instructor_id\");\n    var disciplineId = $(this)\n        .parent()\n        .find(\".discipline-name\")\n        .attr(\"discipline_id\");\n    var scheduleId = $(this)\n        .parent()\n        .attr(\"schedule\");\n\n    $.ajax({\n        url: getInstructorsUrl,\n        type: \"POST\",\n        data: {\n            discipline: disciplineId\n        }\n    }).success(function (result) {\n        $(\"#change-instructor-schedule\").val(scheduleId);\n        $(\"#change-instructor-id\").html(result);\n        $(\"#change-instructor-id\").val(instructorId).select2();\n        $(\"#change-instructor-modal\").modal();\n    });\n});\n$(document).on(\"click\", \"#change-instructor-button\", function () {\n    $.ajax({\n        url: changeInstructorUrl,\n        type: \"POST\",\n        data: {\n            schedule: $(\"#change-instructor-schedule\").val(),\n            instructor: $(\"#change-instructor-id\").val()\n        }\n    }).success(function (data) {\n        data = JSON.parse(data);\n        getTimesheet(data);\n        $(\"#change-instructor-modal\").modal(\"hide\");\n    });\n});\n\n$(document).on(\"click\", \"#add-instructors-disciplines-button\", function () {\n    $(\"#add-instructors-disciplines-form\").submit();\n});", "$('#classesSearch').on('click', function () {\n    if ($(\"#classroom\").val() !== \"\" && $(\"#month\").val() !== \"\" && (!$(\"#disciplines\").is(\":visible\") || $(\"#disciplines\").val() !== \"\")) {\n        $(\".alert-required-fields\").hide();\n        var fundamentalMaior = Number($(\"#classroom option:selected\").attr(\"fundamentalmaior\"));\n        jQuery.ajax({\n            type: 'POST',\n            url: \"?r=classes/getClassContents\",\n            cache: false,\n            data: {\n                classroom: $(\"#classroom\").val(),\n                fundamentalMaior: fundamentalMaior,\n                month: $(\"#month\").val(),\n                discipline: $(\"#disciplines\").val()\n            },\n            beforeSend: function () {\n                $(\".loading-class-contents\").css(\"display\", \"inline-block\");\n                $(\"#widget-class-contents\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#classroom, #month, #disciplines, #classesSearch\").attr(\"disabled\", \"disabled\");\n            },\n            success: function (data) {\n                var data = jQuery.parseJSON(data);\n                if (data.valid) {\n                    $.ajax({\n                        type: 'POST',\n                        url: \"?r=classes/getContents\",\n                        cache: false,\n                        success: function (contents) {\n                            var obj = jQuery.parseJSON(contents);\n\n                            if (data === null) {\n                                $('#class-contents > thead').html('<tr><th class=\"center\">' + data.error + '</th></tr>');\n                                $('#class-contents > tbody').html('');\n                                $('#widget-class-contents').show();\n                                $('#class-contents').show();\n                                $(\"#print, #save\").hide();\n                            } else {\n                                createTable(data, obj);\n                                $(\"#print, #save\").show();\n                            }\n                        },\n                        complete: function (response) {\n                            $(\".loading-class-contents\").hide();\n                            $(\"#widget-class-contents\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n                            $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n                        },\n                    });\n                } else {\n                    $('#class-contents > thead').html('<tr><th class=\"center\">' + data.error + '</th></tr>');\n                    $('#class-contents > tbody').html('');\n                    $('#widget-class-contents').css(\"opacity\", 1).css(\"pointer-events\", \"auto\").show();\n                    $('#class-contents').show();\n                    $(\".loading-class-contents\").hide();\n                    $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n                }\n            }\n        });\n    } else {\n        $(\".alert-required-fields\").show();\n        $(\"#widget-class-contents\").hide();\n        $(\"#print, #save\").hide();\n    }\n});\n\n$(\"#classroom\").on(\"change\", function () {\n    $(\"#disciplines\").val(\"\").trigger(\"change.select2\");\n    if ($(this).val() !== \"\") {\n        if ($(\"#classroom > option:selected\").attr(\"fundamentalmaior\") === \"1\") {\n            $.ajax({\n                type: \"POST\",\n                url: \"?r=classes/getDisciplines\",\n                cache: false,\n                data: {\n                    classroom: $(\"#classroom\").val(),\n                },\n                success: function (response) {\n                    if (response == \"\") {\n                        $(\"#disciplines\").html(\"<option value='-1'></option>\").trigger(\"change.select2\").show();\n                    } else {\n                        $(\"#disciplines\").html(response).trigger(\"change.select2\").show();\n                    }\n                    $(\".disciplines-container\").show();\n                },\n            });\n        } else {\n            $(\".disciplines-container\").hide();\n        }\n    } else {\n        $(\".disciplines-container\").hide();\n    }\n});\n\n$(document).ready(function () {\n    $('#class-contents').hide();\n});\n\n$(\"#print\").on('click', function () {\n    window.print();\n});\n\n$(\"#save\").on('click', function () {\n    $(\".alert-save\").hide();\n    var classContents = [];\n    $(\".day-row\").each(function() {\n        classContents.push({\n            day: $(this).attr(\"day\"),\n            contents: $(this).find(\"select.contents-select\").val()\n        });\n    });\n\n    $.ajax({\n        type: \"POST\",\n        url: \"?r=classes/saveClassContents\",\n        cache: false,\n        data: {\n            classroom: $(\"#class-contents\").attr(\"classroom\"),\n            month: $(\"#class-contents\").attr(\"month\"),\n            discipline: $(\"#class-contents\").attr(\"discipline\"),\n            fundamentalMaior: $(\"#class-contents\").attr(\"fundamentalmaior\"),\n            classContents: classContents\n        },\n        beforeSend: function () {\n            $(\".loading-class-contents\").css(\"display\", \"inline-block\");\n            $(\"#widget-class-contents\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#classroom, #month, #disciplines, #classesSearch\").attr(\"disabled\", \"disabled\");\n        },\n        success: function (response) {\n            $(\".alert-save\").show();\n        },\n        complete: function (response) {\n            $(\".loading-class-contents\").hide();\n            $(\"#widget-class-contents\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n        },\n    });\n});\n\n$('.heading-buttons').css('width', $('#content').width());\n\n", "$(\"#classesSearch\").on(\"click\", function () {\n    if ($(\"#classroom\").val() !== \"\" && $(\"#month\").val() !== \"\" && (!$(\"#disciplines\").is(\":visible\") || $(\"#disciplines\").val() !== \"\")) {\n        $(\".alert-required-fields, .alert-incomplete-data\").hide();\n        var fundamentalMaior = Number($(\"#classroom option:selected\").attr(\"fundamentalmaior\"));\n        jQuery.ajax({\n            type: \"POST\",\n            url: \"?r=classes/getFrequency\",\n            cache: false,\n            data: {\n                classroom: $(\"#classroom\").val(),\n                fundamentalMaior: fundamentalMaior,\n                discipline: $(\"#disciplines\").val(),\n                month: $(\"#month\").val(),\n            },\n            beforeSend: function () {\n                $(\".loading-frequency\").css(\"display\", \"inline-block\");\n                $(\".table-frequency\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#classroom, #month, #disciplines, #classesSearch\").attr(\"disabled\", \"disabled\");\n            },\n            success: function (response) {\n                var data = JSON.parse(response);\n                if (data.valid) {\n                    var html = \"\";\n                    html += \"\" +\n                        \"<table class='table-frequency table table-bordered table-striped table-hover'>\" +\n                        \"<thead>\" +\n                        \"<tr><th class='table-title' colspan='\" + (Object.keys(data.students[0].schedules).length + 1) + \"'>\" + (fundamentalMaior ? $('#disciplines').select2('data').text : \"Todas as Disciplinas\") + \"</th></tr>\";\n                    var daynameRow = \"\";\n                    var dayRow = \"\";\n                    var scheduleRow = \"\";\n                    var checkboxRow = \"\";\n                    $.each(data.students[0].schedules, function () {\n                        dayRow += \"<th>\" + (pad(this.day, 2) + \"/\" + pad($(\"#month\").val(), 2)) + \"</th>\";\n                        daynameRow += \"<th>\" + this.week_day + \"</th>\";\n                        scheduleRow += fundamentalMaior ? \"<th>\" + this.schedule + \"\u00ba Hor\u00e1rio</th>\" : \"\";\n                        checkboxRow += \"<th class='frequency-checkbox-general frequency-checkbox-container \" + (!this.available ? \"disabled\" : \"\") + \"'><input class='frequency-checkbox' type='checkbox' \" + (!this.available ? \"disabled\" : \"\") + \" classroomId='\" + $(\"#classroom\").val() + \"' day='\" + this.day + \"' month='\" + $(\"#month\").val() + \"' schedule='\" + this.schedule + \"' fundamentalMaior='\" + fundamentalMaior + \"'></th>\";\n                    });\n                    html += \"<tr class='day-row'><th></th>\" + dayRow + \"</tr><tr class='dayname-row'><th></th>\" + daynameRow + \"</tr>\" + (fundamentalMaior ? \"<tr class='schedule-row'><th></th>\" + scheduleRow + \"</tr>\" : \"\") + \"<tr class='checkbox-row'><th></th>\" + checkboxRow + \"</tr>\";\n                    html += \"</thead><tbody>\";\n                    $.each(data.students, function (indexStudent, student) {\n                        html += \"<tr><td class='student-name'>\" + student.studentName + \"</td>\";\n                        $.each(student.schedules, function (indexSchedule, schedule) {\n                            html += \"<td class='frequency-checkbox-student frequency-checkbox-container \" + (!this.available ? \"disabled\" : \"\") + \"'><input class='frequency-checkbox' type='checkbox' \" + (!schedule.available ? \"disabled\" : \"\") + \" \" + (schedule.fault ? \"checked\" : \"\") + \" classroomId='\" + $(\"#classroom\").val() + \"' studentId='\" + student.studentId + \"' day='\" + schedule.day + \"' month='\" + $(\"#month\").val() + \"' schedule='\" + schedule.schedule + \"' fundamentalMaior='\" + fundamentalMaior + \"'></td>\";\n                        });\n                        html += \"</tr>\";\n                    });\n                    html += \"</tbody></table>\";\n                    $(\"#frequency-container\").html(html).show();\n                    $(\".frequency-checkbox-general\").each(function() {\n                        var day = $(this).find(\".frequency-checkbox\").attr(\"day\");\n                        $(this).find(\".frequency-checkbox\").prop(\"checked\", $(\".frequency-checkbox-student .frequency-checkbox[day=\" + day + \"]:checked\").length === $(\".frequency-checkbox-student .frequency-checkbox[day=\" + day + \"]\").length);\n\n                    })\n                } else {\n                    $(\"#frequency-container\").hide();\n                    $(\".alert-incomplete-data\").html(data.error).show();\n                }\n            },\n            complete: function (response) {\n                $(\".loading-frequency\").hide();\n                $(\".table-frequency\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n                $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n            },\n        });\n    } else {\n        $(\".alert-required-fields\").show();\n        $(\"#frequency-container, .alert-incomplete-data\").hide();\n    }\n});\n\n$(document).on(\"click\", \".frequency-checkbox-container\", function (e) {\n    if (e.target === this && !$(this).hasClass(\"disabled\")) {\n        $(this).find(\".frequency-checkbox\").prop(\"checked\", !$(this).find(\".frequency-checkbox\").is(\":checked\")).trigger(\"change\");\n    }\n});\n\n$(\"#classroom\").on(\"change\", function () {\n    $(\"#disciplines\").val(\"\").trigger(\"change.select2\");\n    if ($(this).val() !== \"\") {\n        if ($(\"#classroom > option:selected\").attr(\"fundamentalMaior\") === \"1\") {\n            $.ajax({\n                type: \"POST\",\n                url: \"?r=classes/getDisciplines\",\n                cache: false,\n                data: {\n                    classroom: $(\"#classroom\").val(),\n                },\n                success: function (response) {\n                    if (response === \"\") {\n                        $(\"#disciplines\").html(\"<option value='-1'></option>\").trigger(\"change.select2\").show();\n                    } else {\n                        $(\"#disciplines\").html(response).trigger(\"change.select2\").show();\n                    }\n                    $(\".disciplines-container\").show();\n                },\n            });\n        } else {\n            $(\".disciplines-container\").hide();\n        }\n    } else {\n        $(\".disciplines-container\").hide();\n    }\n});\n\n$(document).on(\"change\", \".frequency-checkbox\", function () {\n    var checkbox = this;\n    $.ajax({\n        type: \"POST\",\n        url: \"?r=classes/saveFrequency\",\n        cache: false,\n        data: {\n            classroomId: $(this).attr(\"classroomId\"),\n            day: $(this).attr(\"day\"),\n            month: $(this).attr(\"month\"),\n            schedule: $(this).attr(\"schedule\"),\n            studentId: $(this).attr(\"studentId\"),\n            fault: $(this).is(\":checked\") ? 1 : 0,\n            fundamentalMaior: $(this).attr(\"fundamentalMaior\")\n        },\n        beforeSend: function () {\n            $(\".loading-frequency\").css(\"display\", \"inline-block\");\n            $(\".table-frequency\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#classroom, #month, #disciplines, #classesSearch\").attr(\"disabled\", \"disabled\");\n        },\n        complete: function (response) {\n            if ($(checkbox).attr(\"studentId\") === undefined) {\n                $(\".table-frequency tbody .frequency-checkbox[day=\" + $(checkbox).attr(\"day\") + \"][schedule=\" + $(checkbox).attr(\"schedule\") + \"]\").prop(\"checked\", $(checkbox).is(\":checked\"));\n            }\n            $(\".loading-frequency\").hide();\n            $(\".table-frequency\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n        },\n    });\n});", "<?php\n/* @var $this ReportsController */\n\n$baseUrl = Yii::app()->baseUrl;\n$cs = Yii::app()->getClientScript();\n$cs->registerCssFile($baseUrl . '/css/reports.css');\n\n$this->pageTitle = 'TAG - ' . Yii::t('default', 'Reports');\n$this->breadcrumbs = array(\n    Yii::t('default', 'Reports'),\n);\n?>\n\n<div class=\"row-fluid\">\n    <div class=\"span12\">\n        <h3 class=\"heading-mosaic\"><?php echo Yii::t('default', 'Reports'); ?></h3>  \n    </div>\n</div>\n\n<div class=\"innerLR home\">\n    <div class=\"row-fluid\">\n        <?php if (Yii::app()->user->hasFlash('success')): ?>\n            <div class=\"alert alert-success\">\n                <?php echo Yii::app()->user->getFlash('success') ?>\n            </div>\n            <br/>\n        <?php endif ?>\n        <div class=\"span12\">\n                <div class=\"span2\">\n                    <a href=\"#\" data-toggle=\"modal\" data-target=\"#reportFamilyBag\" class=\"widget-stats\" target=\"_blank\">\n                    <!-- <a  href=\"<?php //echo Yii::app()->createUrl('reports/BFReport')?>\" class=\"widget-stats\"> -->\n                        <div><i class=\"fa-percent fa fa-4x\"></i></div>\n                        <span class=\"report-title\">Frequ\u00eancia para o Bolsa Fam\u00edlia</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/NumberStudentsPerClassroomReport')?>\" class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-sort-numeric-asc fa-4x\"></i></div>\n                        <span class=\"report-title\">N\u00famero de Alunos por Turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/InstructorsPerClassroomReport')?>\" class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-graduation-cap fa-4x\"></i></div>\n                        <span class=\"report-title\">Professores por Turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/studentsbetween5and14yearsoldreport',array('id'=>Yii::app()->user->school))?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-heartbeat fa-4x\"></i></div>\n                    <span class=\"report-title\">Alunos com Idade entre 5 e 14 Anos (SUS)</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/enrollmentcomparativeanalysisreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-exchange fa-4x\"></i></div>\n                    <span class=\"report-title\">An\u00e1lise Comparativa de Matr\u00edculas</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/schoolprofessionalnumberbyclassroomreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><span class=\"glyphicons signal\"><i></i></span></div>\n                    <span class=\"report-title\">N\u00famero de Profissionais por turma</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n        </div>\n        <div class=\"span12\" style=\"margin: 10px 0 0 0\">\n\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/educationalassistantperclassroomreport',array('id'=>Yii::app()->user->school))?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-handshake-o fa-4x\"></i></div>\n                    <span class=\"report-title\">Auxiliar/Assistente Educacional por Turma</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/disciplineandinstructorrelationreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-podcast fa-4x\"></i></div>\n                    <span class=\"report-title\">Rela\u00e7\u00e3o Disciplina/Docente</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/complementaractivityassistantbyclassroomreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-dot-circle-o fa-4x\"></i></div>\n                    <span class=\"report-title\">Monitores de Atividade Complementar por Turma</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/classroomwithoutinstructorrelationreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-ban fa-4x\"></i></div>\n                    <span class=\"report-title\">Rela\u00e7\u00e3o Turmas sem Instrutor</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/studentinstructornumbersrelationreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-users fa-4x\"></i></div>\n                    <span class=\"report-title\">N\u00famero de Alunos e Professores por Turma</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/studentsbyclassroomreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-address-book fa-4x\"></i></div>\n                    <span class=\"report-title\">Rela\u00e7\u00e3o de alunos por turma</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n        </div>\n        <div class=\"span12\" style=\"margin: 10px 0 0 0\">\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/studentsinalphabeticalorderrelationreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-sort-alpha-asc fa-4x\"></i></div>\n                    <span class=\"report-title\">Rela\u00e7ao de Alunos em ordem Alfab\u00e9tica</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/studentswithdisabilitiesrelationreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-wheelchair fa-4x\"></i></div>\n                    <span class=\"report-title\">Rela\u00e7\u00e3o Acessibilidade</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/studentsusingschooltransportationrelationreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-bus fa-4x\"></i></div>\n                    <span class=\"report-title\">Rela\u00e7\u00e3o Transporte Escolar</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/incompatiblestudentagebyclassroomreport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-street-view fa-4x\"></i></div>\n                    <span class=\"report-title\">Alunos com Idade Incompat\u00edvel por Turma</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/bfrstudentReport')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><span class=\"glyphicons justify\"><i></i></span></div>\n                    <span class=\"report-title\">Alunos participantes Bolsa Familia</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/studentpendingdocument')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <div><i class=\"fa fa-list-ol fa-4x\"></i></div>\n                    <span class=\"report-title\">Alunos com Documentos Pendentes</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n        </div>\n        <div class=\"span12\" style=\"margin: 10px 0 0 0\">\n            <div class=\"span2\">\n                <a href=\"#\" data-toggle=\"modal\" data-target=\"#report\" class=\"widget-stats\" target=\"_blank\">\n                    <div><span class=\"glyphicons signal\"><i></i></span></div>\n                    <span class=\"report-title\">Alunos por turma</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n            <div class=\"span2\">\n                <a href=\"<?php echo Yii::app()->createUrl('reports/studentspecialfood')?>\" class=\"widget-stats\" target=\"_blank\">\n                    <span class=\"glyphicons fast_food\"><i></i></span>\n                    <span class=\"txt\">Alunos - Card\u00e1pios Especiais</span>\n                    <div class=\"clearfix\"></div>\n                </a>\n            </div>\n        </div>\n        <div class=\"modal fade\" id=\"report\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"New Calendar\">\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-header\">\n                        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">\u00d7</span></button>\n                        <h4 class=\"modal-title\" id=\"myModalLabel\">Escolha a Turma</h4>\n                    </div>\n                    <form class=\"form-vertical\" id=\"createCalendar\" action=\"/br.tag/?r=calendar\" method=\"post\">            \n                    <div class=\"modal-body\">\n                        <div class=\"row-fluid\">\n                            <div class=\" span12\" style=\"margin: 10px 0 10px 0;\">\n                                <div class=\"span4\">\n                                    <?php echo CHtml::label(yii::t('default', 'Classroom'), 'classroom', array('class' => 'control-label')); ?>\n                                </div>\n                                <div class=\"span8\">\n                                     <?php\n                                        echo CHtml::dropDownList('classroom', '', CHtml::listData(Classroom::model()->findAll(array('condition'=>'school_inep_fk=' . Yii::app()->user->school . ' && school_year = ' . Yii::app()->user->year,'order' => 'name')), 'id', 'name'), array(\n                                            'key' => 'id',\n                                            'class' => 'select-search-on',\n                                            'prompt' => 'Selecione a turma',\n                                            'ajax' => array(\n                                                'type' => 'POST',\n                                                'url' => CController::createUrl('classes/getDisciplines'),\n                                                'update' => '#disciplines',\n                                        )));\n                                    ?>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class=\"modal-footer\" style=\"background-color:#FFF;\">\n                            <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancelar</button>\n                            <a class=\"btn btn-primary\" url=\"<?php echo Yii::app()->createUrl('reports/studentbyclassroomreport'); ?>\" type=\"button\" value=\"Gerar\" id=\"buildReport\"> Gerar </a>         \n                        </div>\n                    </form>        \n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div class=\"modal fade\" id=\"reportFamilyBag\" tabindex=\"-1\" role=\"dialog\">\n    <div class=\"modal-dialog\" role=\"documentBag\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">\u00d7</span></button>\n                <h4 class=\"modal-title\">Frequ\u00eancia Bolsa Fam\u00edlia - Escolha a Turma</h4>\n            </div>\n            <form class=\"form-vertical\" action=\"/br.tag/?r=calendar\" method=\"post\">            \n                <div class=\"modal-body\">\n                    <div class=\"row-fluid\">\n                        <div class=\" span12\" style=\"margin: 10px 0 10px 0;\">\n                            <div class=\"span4\">\n                                <?php echo CHtml::label(yii::t('default', 'Classroom'), 'classroom', array('class' => 'control-label')); ?>\n                            </div>\n                            <div class=\"span8\">\n                                <?php\n                                    echo CHtml::dropDownList('classroom2', '', CHtml::listData(Classroom::model()->findAll(array('condition'=>'school_inep_fk=' . Yii::app()->user->school . ' && school_year = ' . Yii::app()->user->year,'order' => 'name')), 'id', 'name'), array(\n                                        'key' => 'id',\n                                        'class' => 'select-search-on',\n                                        'prompt' => 'Todas as turmas',\n                                        'ajax' => array(\n                                            'type' => 'POST',\n                                            'url' => CController::createUrl('classes/getDisciplines'),\n                                            'update' => '#disciplines',\n                                    )));\n                                ?>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"modal-footer\" style=\"background-color:#FFF;\">\n                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancelar</button>\n                    <a class=\"btn btn-primary\" url=\"<?php echo Yii::app()->createUrl('reports/BFReport'); ?>\" type=\"button\" value=\"Gerar\" id=\"buildReportBF\"> Gerar </a>         \n                </div>\n            </form>        \n        </div>\n    </div>\n</div>\n\n<?php\n\n$cs = Yii::app()->getClientScript();\n$cs->registerScript('buildReport',\"  \n    $('#buildReport').live('click', function(event) {\n        var url = $(this).attr('url');\n        var id = $('#classroom').val();\n        $(this).attr('url', url + '&id='+ id);\n    });\n    registerAndOpenTab('#buildReport');\", CClientScript::POS_END);\n\n$cs->registerScript('buildReportBF',\"  \n    $('#buildReportBF').live('click', function(event) {\n        var url = $(this).attr('url');\n        var id = $('#classroom2').val();\n        $(this).attr('url', url + '&id='+ id);\n    });\n    registerAndOpenTab('#buildReportBF');\", CClientScript::POS_END);\n\n ?>"], "fixing_code": ["<?php\n\nset_time_limit(0);\nYii::import('application.modules.timesheet.models.TimesheetCurricularMatrix', true);\nYii::import('application.modules.timesheet.models.TimesheetInstructor', true);\nYii::import('application.modules.timesheet.models.InstructorSchool', true);\nYii::import('application.modules.timesheet.models.Unavailability', true);\n\nclass ClassesController extends Controller\n{\n\n    /**\n     * @var string the default layout for the views. Defaults to '//layouts/column2', meaning\n     * using two-column layout. See 'protected/views/layouts/column2.php'.\n     */\n    public $layout = 'fullmenu';\n\n    /**\n     * @return array action filters\n     */\n    public function filters()\n    {\n        return array(\n            'accessControl', // perform access control for CRUD operations\n            'postOnly + delete', // we only allow deletion via POST request\n        );\n    }\n\n    /**\n     * Specifies the access control rules.\n     * This method is used by the 'accessControl' filter.\n     * @return array access control rules\n     */\n    public function accessRules()\n    {\n        return array(\n            array('allow', // allow authenticated user to perform 'create' and 'update' actions\n                'actions' => array('index',\n                    'frequency', 'saveFrequency',\n                    'classContents', 'getClassContents', 'saveClassContents', 'saveContent',\n                    'getdisciplines', 'getfrequency', 'getcontents'),\n                'users' => array('@'),\n            ),\n            array('allow', // allow admin user to perform 'admin' and 'delete' actions\n                'actions' => array('admin', 'delete'),\n                'users' => array('admin'),\n            ),\n            array('deny', // deny all users\n                'users' => array('*'),\n            ),\n        );\n    }\n\n    /**\n     * Displays the Class Contents\n     */\n    public function actionClassContents()\n    {\n        if (Yii::app()->getAuthManager()->checkAccess('instructor', Yii::app()->user->loginInfos->id)) {\n            $criteria = new CDbCriteria;\n            $criteria->alias = \"c\";\n            $criteria->join = \"\"\n                . \" join instructor_teaching_data on instructor_teaching_data.classroom_id_fk = c.id \"\n                . \" join instructor_identification on instructor_teaching_data.instructor_fk = instructor_identification.id \";\n            $criteria->condition = \"c.school_year = :school_year and c.school_inep_fk = :school_inep_fk and instructor_identification.users_fk = :users_fk\";\n            $criteria->order = \"name\";\n            $criteria->params = array(':school_year' => Yii::app()->user->year, ':school_inep_fk' => Yii::app()->user->school, ':users_fk' => Yii::app()->user->loginInfos->id);\n\n            $classrooms = Classroom::model()->findAll($criteria);\n        } else {\n            $classrooms = Classroom::model()->findAll('school_year = :school_year and school_inep_fk = :school_inep_fk order by name', ['school_year' => Yii::app()->user->year, 'school_inep_fk' => Yii::app()->user->school]);\n        }\n        $this->render('classContents', array(\n            'classrooms' => $classrooms\n        ));\n    }\n\n    /**\n     * Get all contents\n     */\n    public function actionGetContents()\n    {\n        $contents = ClassResources::model()->findAllByAttributes(['type' => ClassResources::CONTENT]);\n        $return = [];\n        foreach ($contents as $content) {\n            $return[$content->id] = $content->name;\n        }\n        echo json_encode($return);\n    }\n\n    /**\n     *   Save a new Content\n     */\n    public function actionSaveContent()\n    {\n        if (isset($_POST['name']) && !empty($_POST['name'])) {\n            $name = strtoupper($_POST['name']);\n            $description = isset($_POST['description']) ? strtoupper($_POST['description']) : \"\";\n            $type = isset($_POST['type']) ? $_POST['type'] : 1;\n            $exist = ClassResources::model()->exists('name = :n', ['n' => $name]);\n            if (!$exist) {\n                $newContent = new ClassResources();\n                $newContent->name = $name;\n                $newContent->description = $description;\n                $newContent->type = $type;\n                $newContent->save();\n\n                $return = ['id' => $newContent->id, 'name' => $newContent->name];\n                echo json_encode($return);\n            }\n        }\n    }\n\n    /**\n     * Get all classes by classroom, discipline and month\n     */\n    public function actionGetClassContents()\n    {\n        if ($_POST[\"fundamentalMaior\"] == \"1\") {\n            $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and discipline_fk = :discipline_fk and unavailable = 0 order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"], \"discipline_fk\" => $_POST[\"discipline\"]]);\n        } else {\n            $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and unavailable = 0 group by day order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"]]);\n        }\n        if (!empty($schedules)) {\n            foreach ($schedules as $schedule) {\n                $classContents[$schedule->day][\"available\"] = date(\"Y-m-d\") >= Yii::app()->user->year . \"-\" . str_pad($schedule->month, 2, \"0\", STR_PAD_LEFT) . \"-\" . str_pad($schedule->day, 2, \"0\", STR_PAD_LEFT);\n                foreach ($schedule->classHasContents as $classHasContent) {\n                    $classContents[$schedule->day][\"contents\"][$classHasContent->contentFk->id] = $classHasContent->contentFk->description;\n                }\n            }\n            echo json_encode([\"valid\" => true, \"classContents\" => $classContents]);\n        } else {\n            echo json_encode([\"valid\" => false, \"error\" => \"N\u00e3o existe quadro de hor\u00e1rio com dias letivos para o m\u00eas selecionado.\"]);\n        }\n    }\n\n    /**\n     * Save the contents for each class.\n     */\n    public function actionSaveClassContents()\n    {\n        if ($_POST[\"fundamentalMaior\"] == \"1\") {\n            $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and discipline_fk = :discipline_fk group by day order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"], \"discipline_fk\" => $_POST[\"discipline\"]]);\n        } else {\n            $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month group by day order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"]]);\n        }\n        foreach ($_POST[\"classContents\"] as $classContent) {\n            foreach ($schedules as $schedule) {\n                if ($schedule->day == $classContent[\"day\"]) {\n                    ClassHasContent::model()->deleteAll(\"schedule_fk = :schedule_fk\", [\"schedule_fk\" => $schedule->id]);\n                    foreach ($classContent[\"contents\"] as $content) {\n                        $classHasContent = new ClassHasContent();\n                        $classHasContent->schedule_fk = $schedule->id;\n                        $classHasContent->content_fk = $content;\n                        $classHasContent->save();\n                    }\n                    break;\n                }\n            }\n        }\n    }\n\n/**\n * Open the Frequency View.\n */\npublic\nfunction actionFrequency()\n{\n    if (Yii::app()->getAuthManager()->checkAccess('instructor', Yii::app()->user->loginInfos->id)) {\n        $criteria = new CDbCriteria;\n        $criteria->alias = \"c\";\n        $criteria->join = \"\"\n            . \" join instructor_teaching_data on instructor_teaching_data.classroom_id_fk = c.id \"\n            . \" join instructor_identification on instructor_teaching_data.instructor_fk = instructor_identification.id \";\n        $criteria->condition = \"c.school_year = :school_year and c.school_inep_fk = :school_inep_fk and instructor_identification.users_fk = :users_fk\";\n        $criteria->order = \"name\";\n        $criteria->params = array(':school_year' => Yii::app()->user->year, ':school_inep_fk' => Yii::app()->user->school, ':users_fk' => Yii::app()->user->loginInfos->id);\n\n        $classrooms = Classroom::model()->findAll($criteria);\n    } else {\n        $classrooms = Classroom::model()->findAll('school_year = :school_year and school_inep_fk = :school_inep_fk order by name', ['school_year' => Yii::app()->user->year, 'school_inep_fk' => Yii::app()->user->school]);\n    }\n    $this->render('frequency', array(\n        'classrooms' => $classrooms\n    ));\n}\n\n/**\n * Get all frequency by classroom, discipline and month\n */\npublic\nfunction actionGetFrequency()\n{\n    if ($_POST[\"fundamentalMaior\"] == \"1\") {\n        $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and discipline_fk = :discipline_fk and unavailable = 0 order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"], \"discipline_fk\" => $_POST[\"discipline\"]]);\n    } else {\n        $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and month = :month and unavailable = 0 group by day order by day, schedule\", [\"classroom_fk\" => $_POST[\"classroom\"], \"month\" => $_POST[\"month\"]]);\n    }\n    $criteria = new CDbCriteria();\n    $criteria->with = array('studentFk');\n    $criteria->together = true;\n    $criteria->order = 'name';\n    $enrollments = StudentEnrollment::model()->findAllByAttributes(array('classroom_fk' => $_POST[\"classroom\"]), $criteria);\n    if ($schedules != null) {\n        if ($enrollments != null) {\n            $students = [];\n            $dayName = [\"Domingo\", \"Segunda\", \"Ter\u00e7a\", \"Quarta\", \"Quinta\", \"Sexta\", \"S\u00e1bado\"];\n            foreach ($enrollments as $enrollment) {\n                $array[\"studentId\"] = $enrollment->student_fk;\n                $array[\"studentName\"] = $enrollment->studentFk->name;\n                $array[\"schedules\"] = [];\n                foreach ($schedules as $schedule) {\n                    $classFault = ClassFaults::model()->exists(\"schedule_fk = :schedule_fk and student_fk = :student_fk\", [\"schedule_fk\" => $schedule->id, \"student_fk\" => $enrollment->student_fk]);\n                    $available = date(\"Y-m-d\") >= Yii::app()->user->year . \"-\" . str_pad($schedule->month, 2, \"0\", STR_PAD_LEFT) . \"-\" . str_pad($schedule->day, 2, \"0\", STR_PAD_LEFT);\n                    array_push($array[\"schedules\"], [\"available\" => $available, \"day\" => $schedule->day, \"week_day\" => $dayName[$schedule->week_day], \"schedule\" => $schedule->schedule, \"fault\" => $classFault]);\n                }\n                array_push($students, $array);\n            }\n            echo json_encode([\"valid\" => true, \"students\" => $students]);\n        } else {\n            echo json_encode([\"valid\" => false, \"error\" => \"Matricule alunos nesta turma para trazer o quadro de frequ\u00eancia.\"]);\n        }\n    } else {\n        echo json_encode([\"valid\" => false, \"error\" => \"N\u00e3o existe quadro de hor\u00e1rio com dias letivos para o m\u00eas selecionado.\"]);\n    }\n}\n\n/**\n * Save the frequency for each student and class.\n */\npublic\nfunction actionSaveFrequency()\n{\n    if ($_POST[\"fundamentalMaior\"] == \"1\") {\n        $schedule = Schedule::model()->find(\"classroom_fk = :classroom_fk and day = :day and month = :month and schedule = :schedule\", [\"classroom_fk\" => $_POST[\"classroomId\"], \"day\" => $_POST[\"day\"], \"month\" => $_POST[\"month\"], \"schedule\" => $_POST[\"schedule\"]]);\n        $this->saveFrequency($schedule);\n    } else {\n        $schedules = Schedule::model()->findAll(\"classroom_fk = :classroom_fk and day = :day and month = :month\", [\"classroom_fk\" => $_POST[\"classroomId\"], \"day\" => $_POST[\"day\"], \"month\" => $_POST[\"month\"]]);\n        foreach ($schedules as $schedule) {\n            $this->saveFrequency($schedule);\n        }\n    }\n}\n\nprivate\nfunction saveFrequency($schedule)\n{\n    if ($_POST[\"studentId\"] != null) {\n        if ($_POST[\"fault\"] == \"1\") {\n            $classFault = new ClassFaults();\n            $classFault->student_fk = $_POST[\"studentId\"];\n            $classFault->schedule_fk = $schedule->id;\n            $classFault->save();\n        } else {\n            ClassFaults::model()->deleteAll(\"schedule_fk = :schedule_fk and student_fk = :student_fk\", [\"schedule_fk\" => $schedule->id, \"student_fk\" => $_POST[\"studentId\"]]);\n        }\n    } else {\n        if ($_POST[\"fault\"] == \"1\") {\n            $enrollments = StudentEnrollment::model()->findAll(\"classroom_fk = :classroom_fk\", [\"classroom_fk\" => $_POST[\"classroomId\"]]);\n            foreach ($enrollments as $enrollment) {\n                $classFault = ClassFaults::model()->find(\"schedule_fk = :schedule_fk and student_fk = :student_fk\", [\"schedule_fk\" => $schedule->id, \"student_fk\" => $enrollment->student_fk]);\n                if ($classFault == null) {\n                    $classFault = new ClassFaults();\n                    $classFault->student_fk = $enrollment->student_fk;\n                    $classFault->schedule_fk = $schedule->id;\n                    $classFault->save();\n                }\n            }\n        } else {\n            ClassFaults::model()->deleteAll(\"schedule_fk = :schedule_fk\", [\"schedule_fk\" => $schedule->id]);\n        }\n    }\n}\n\n/**\n * Get all disciplines by classroom\n */\npublic\nfunction actionGetDisciplines()\n{\n    $crid = $_POST['classroom'];\n    $disciplinesLabels = ClassroomController::classroomDisciplineLabelArray();\n    if (Yii::app()->getAuthManager()->checkAccess('instructor', Yii::app()->user->loginInfos->id)) {\n        $disciplines = Yii::app()->db->createCommand(\n            \"select d.id from `edcenso_discipline` as `d`\n                        JOIN `instructor_teaching_data` `t` ON \n                                (`t`.`discipline_1_fk` = `d`.`id` \n                                || `t`.`discipline_2_fk` = `d`.`id` \n                                || `t`.`discipline_3_fk` = `d`.`id`\n                                || `t`.`discipline_4_fk` = `d`.`id`\n                                || `t`.`discipline_5_fk` = `d`.`id`\n                                || `t`.`discipline_6_fk` = `d`.`id`\n                                || `t`.`discipline_7_fk` = `d`.`id`\n                                || `t`.`discipline_8_fk` = `d`.`id`\n                                || `t`.`discipline_9_fk` = `d`.`id`\n                                || `t`.`discipline_10_fk` = `d`.`id`\n                                || `t`.`discipline_11_fk` = `d`.`id`\n                                || `t`.`discipline_12_fk` = `d`.`id`\n                                || `t`.`discipline_13_fk` = `d`.`id`)\n                        join `classroom` as `c` on (c.id = t.classroom_id_fk)\n                        left join instructor_identification ii on t.instructor_fk = ii.id \n                        where ii.users_fk = \" . Yii::app()->user->loginInfos->id . \" and t.classroom_id_fk = \" . $crid . \" order by d.name\")->queryAll();\n        foreach ($disciplines as $discipline) {\n            echo htmlspecialchars(CHtml::tag('option', array('value' => $discipline['id']), CHtml::encode($disciplinesLabels[$discipline['id']]), true));\n        }\n    } else {\n        echo CHtml::tag('option', array('value' => \"\"), CHtml::encode('Selecione a disciplina'), true);\n        $classr = Yii::app()->db->createCommand(\"select distinct discipline_fk from schedule join edcenso_discipline on edcenso_discipline.id = schedule.discipline_fk where classroom_fk = \" . $crid . \" order by edcenso_discipline.name\")->queryAll();\n        foreach ($classr as $i => $discipline) {\n            if (isset($discipline['discipline_fk'])) {\n                echo htmlspecialchars(CHtml::tag('option', array('value' => $discipline['discipline_fk']), CHtml::encode($disciplinesLabels[$discipline['discipline_fk']]), true));\n            }\n        }\n    }\n}\n}\n", "$(document).on(\"click\", \".new-calendar-button\", function () {\n    $(\".error-calendar-event\").hide();\n    $(\".create-calendar-title, #copy\").val(\"\");\n    $(\"#stages\").val(null).trigger(\"change.select2\");\n    $(\"#myNewCalendar\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".create-calendar\", function () {\n    var form = $(this).closest(\"form\");\n    if (form.find(\".create-calendar-title\").val() === \"\" || form.find(\"#stages\").val() === null) {\n        form.find(\".alert\").html(\"Campos com * s\u00e3o obrigat\u00f3rios.\").show();\n    } else {\n        form.find(\".alert\").hide();\n        $.ajax({\n            url: \"?r=calendar/default/create\",\n            type: \"POST\",\n            data: {\n                title: $(\".create-calendar-title\").val(),\n                stages: $(\"#stages\").val(),\n                copyFrom: $(\"#copy\").val()\n            },\n            beforeSend: function () {\n                $(\"#myNewCalendar .centered-loading-gif\").show();\n                $(\"#myNewCalendar .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#myNewCalendar button\").attr(\"disabled\", \"disabled\");\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            if (!data.valid) {\n                form.find(\".alert\").html(DOMPurify.sanitize(data.error)).show();\n                $(\"#myNewCalendar .centered-loading-gif\").hide();\n                $(\"#myNewCalendar .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n                $(\"#myNewCalendar button\").removeAttr(\"disabled\");\n            } else {\n                window.location.reload();\n            }\n        });\n    }\n});\n\n$(document).on(\"click\", \".edit-calendar-title\", function (e) {\n    e.stopPropagation();\n    $(\"#edit-calendar-title-modal\").find(\"#Calendar_id\").val($(this).attr(\"data-id\"));\n    $(\"#edit-calendar-title-modal\").find(\"#Calendar_title\").val($(this).closest(\".accordion-group\").find(\".accordion-title\").text().trim());\n    $(\"#edit-calendar-title-modal\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".edit-calendar-title-button\", function () {\n    if ($(\"#edit-calendar-title-modal\").find(\"#Calendar_title\").val() === \"\") {\n        $(\"#edit-calendar-title-modal\").find(\".alert\").html(\"Preencha o campo abaixo.\").show();\n    } else {\n        $(\"#edit-calendar-title-modal\").find(\".alert\").hide();\n        $.ajax({\n            url: \"?r=calendar/default/editCalendarTitle\",\n            type: \"POST\",\n            data: {\n                id: $(\"#edit-calendar-title-modal\").find(\"#Calendar_id\").val(),\n                title: $(\"#edit-calendar-title-modal\").find(\"#Calendar_title\").val()\n            },\n            beforeSend: function () {\n                $(\"#edit-calendar-title-modal\").find(\".modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#edit-calendar-title-modal\").find(\"button\").attr(\"disabled\", \"disabled\");\n                $(\"#edit-calendar-title-modal\").find(\".centered-loading-gif\").show();\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            if (data.valid) {\n                $(\".calendar-container[data-id=\" + $(\"#edit-calendar-title-modal\").find(\"#Calendar_id\").val() + \"]\").closest(\".accordion-group\").find(\".accordion-title\").text($(\"#edit-calendar-title-modal\").find(\"#Calendar_title\").val());\n                $(\"#edit-calendar-title-modal\").modal(\"hide\");\n            } else {\n                $(\"#edit-calendar-title-modal\").find(\".alert\").html(DOMPurify.sanitize(data.error)).show();\n            }\n        }).complete(function () {\n            $(\"#edit-calendar-title-modal\").find(\".modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\"#edit-calendar-title-modal\").find(\"button\").removeAttr(\"disabled\");\n            $(\"#edit-calendar-title-modal\").find(\".centered-loading-gif\").hide();\n        });\n    }\n});\n\n$(document).on(\"click\", \".remove-calendar\", function (e) {\n    e.stopPropagation();\n    $(\"#calendar_removal_id\").val($(this).data('id'));\n    $(\"#removeCalendar\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".remove-calendar-button\", function () {\n    $(\"#removeCalendar\").find(\".alert\").hide();\n    $.ajax({\n        url: \"?r=calendar/default/removeCalendar\",\n        type: \"POST\",\n        data: {\n            calendar_removal_id: $(\"#calendar_removal_id\").val(),\n        },\n        beforeSend: function () {\n            $(\"#removeCalendar .centered-loading-gif\").show();\n            $(\"#removeCalendar .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#removeCalendar button\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            $(\".calendar-container[data-id=\" + $(\"#calendar_removal_id\").val() + \"]\").closest(\".accordion-group\").remove();\n            $(\".accordion\").children().length\n                ? $(\".no-calendars-alert\").hide()\n                : $(\".no-calendars-alert\").show();\n            $(\"#removeCalendar\").modal(\"hide\");\n        } else {\n            $(\"#removeCalendar\").find(\".alert\").html(DOMPurify.sanitize(data.error)).show();\n        }\n    }).complete(function () {\n        $(\"#removeCalendar .centered-loading-gif\").hide();\n        $(\"#removeCalendar .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\"#removeCalendar button\").removeAttr(\"disabled\");\n    });\n});\n\n$(document).on(\"click\", \".remove-event-button\", function () {\n    $.ajax({\n        url: \"?r=calendar/default/deleteEvent\",\n        type: \"POST\",\n        data: {\n            id: $(\"#CalendarEvent_id\").val(),\n            calendarId: $(\"#CalendarEvent_calendar_fk\").val()\n        },\n        beforeSend: function () {\n            $(\"#myChangeEvent .centered-loading-gif\").show();\n            $(\"#myChangeEvent .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#myChangeEvent button\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            var eventDays = $(\"a.change-event[data-id=\" + data.id + \"]\");\n            eventDays.attr(\"data-id\", \"-1\").removeAttr(\"data-toggle\").removeAttr(\"data-placement\").removeAttr(\"data-original-title\");\n            eventDays.parent().removeClass(\"calendar-\" + data.color);\n            eventDays.find(\".calendar-icon\").remove();\n            $(\"#myChangeEvent\").modal(\"hide\");\n        } else {\n            $(\"#myChangeEvent\").find(\".alert\").html(DOMPurify.sanitize(data.error)).show();\n        }\n    }).complete(function () {\n        $(\"#myChangeEvent .centered-loading-gif\").hide();\n        $(\"#myChangeEvent .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\"#myChangeEvent button\").removeAttr(\"disabled\");\n    });\n});\n\n$(document).on(\"click\", \".change-event\", function () {\n    var event = this;\n    $(\"#myChangeEvent\").find(\".selected-calendar-current-year\").val($(event).closest(\".calendar\").data(\"year\"));\n    $(\".error-calendar-event\").hide();\n    if ($(event).attr('data-id') !== \"-1\") {\n        $(\".remove-event-button\").show();\n        $.ajax({\n            url: \"?r=calendar/default/event\",\n            type: \"POST\",\n            dataType: 'text',\n            data: {\n                id: $(event).attr('data-id')\n            },\n            beforeSend: function () {\n                $(event).closest(\".calendar-container\").css(\"pointer-events\", \"none\").css(\"opacity\", 0.3);\n                $(event).closest(\".accordion-inner\").find(\".centered-loading-gif\").show();\n            },\n            success: function (data) {\n                data = $.parseJSON(data);\n                $(\"#CalendarEvent_id\").val(data.id);\n                $(\"#CalendarEvent_calendar_fk\").val(data.calendar_fk);\n                $(\"#CalendarEvent_name\").val(data.name);\n                $(\"#CalendarEvent_start_date\").val(data.start_date.split(\" \")[0]);\n                $(\"#CalendarEvent_end_date\").val(data.end_date.split(\" \")[0]);\n                $(\"#CalendarEvent_calendar_event_type_fk\").val(data.calendar_event_type_fk);\n                $(\"#CalendarEvent_copyable\").attr(\"checked\", data.copyable);\n                $(\"#myChangeEvent\").modal(\"show\");\n            },\n            complete: function () {\n                $(event).closest(\".calendar-container\").css(\"pointer-events\", \"auto\").css(\"opacity\", 1);\n                $(event).closest(\".accordion-inner\").find(\".centered-loading-gif\").hide();\n            }\n        });\n    } else {\n        $(\".remove-event-button\").hide();\n        $(\"#CalendarEvent_id\").val($(event).attr('data-id'));\n        $(\"#CalendarEvent_calendar_fk\").val($(event).closest(\".calendar\").attr(\"data-id\"));\n        $(\"#CalendarEvent_name\").val(\"\");\n        $(\"#CalendarEvent_start_date\").val($(event).data('year') + \"-\" + pad($(event).data('month'), 2) + \"-\" + pad($(event).data('day'), 2));\n        $(\"#CalendarEvent_end_date\").val($(event).data('year') + \"-\" + pad($(event).data('month'), 2) + \"-\" + pad($(event).data('day'), 2));\n        $(\"#CalendarEvent_calendar_event_type_fk\").val(\"\");\n        $(\"#CalendarEvent_copyable\").attr(\"checked\", \"checked\");\n        $(\"#myChangeEvent\").modal(\"show\");\n    }\n});\n\n$(document).on(\"click\", \".save-event\", function (e) {\n    var form = $(this).closest(\"form\");\n    if (form.find(\"#CalendarEvent_name\").val() === \"\" || form.find(\"#CalendarEvent_start_date\").val() === \"\" || form.find(\"#CalendarEvent_end_date\").val() === \"\" || form.find(\"#CalendarEvent_calendar_event_type_fk\").val() === \"\") {\n        form.find(\".alert\").html(\"Campos com * s\u00e3o obrigat\u00f3rios.\").show();\n    } else if (form.find(\"#CalendarEvent_end_date\").val() < form.find(\"#CalendarEvent_start_date\").val()) {\n        form.find(\".alert\").html(\"A Data de Encerramento n\u00e3o deve ser anterior \u00e0 Data de In\u00edcio.\").show();\n    } else if (form.find(\"#CalendarEvent_start_date\").val().split(\"-\")[0] !== form.find(\".selected-calendar-current-year\").val() || form.find(\"#CalendarEvent_end_date\").val().split(\"-\")[0] !== form.find(\".selected-calendar-current-year\").val()) {\n        form.find(\".alert\").html(\"O intervalo de datas deve atender o ano do calend\u00e1rio.\").show();\n    } else {\n        form.find(\".alert\").hide();\n        $.ajax({\n            url: \"?r=calendar/default/changeEvent\",\n            type: \"POST\",\n            data: {\n                id: $(\"#CalendarEvent_id\").val(),\n                calendarFk: $(\"#CalendarEvent_calendar_fk\").val(),\n                name: $(\"#CalendarEvent_name\").val(),\n                startDate: $(\"#CalendarEvent_start_date\").val(),\n                endDate: $(\"#CalendarEvent_end_date\").val(),\n                eventTypeFk: $(\"#CalendarEvent_calendar_event_type_fk\").val(),\n                copyable: $(\"#CalendarEvent_copyable\").is(\":checked\")\n            },\n            beforeSend: function () {\n                $(\"#myChangeEvent .centered-loading-gif\").show();\n                $(\"#myChangeEvent .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#myChangeEvent button\").attr(\"disabled\", \"disabled\");\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            if (data.valid) {\n                var calendar = $(\".calendar-container[data-id=\" + $(\"#CalendarEvent_calendar_fk\").val() + \"]\");\n                if (data.uniqueDayToDelete !== null) {\n                    var uniqueDay = $(\"a.change-event[data-id=\" + data.uniqueDayToDelete.id + \"]\");\n                    uniqueDay.attr(\"data-id\", \"-1\").removeAttr(\"data-toggle\").removeAttr(\"data-placement\").removeAttr(\"data-original-title\");\n                    uniqueDay.parent().removeClass(\"calendar-\" + data.uniqueDayToDelete.color);\n                    uniqueDay.find(\".calendar-icon\").remove();\n                }\n                var oldEventDays = $(\"a.change-event[data-id=\" + data.eventId + \"]\");\n                oldEventDays.attr(\"data-id\", \"-1\").removeAttr(\"data-toggle\").removeAttr(\"data-placement\").removeAttr(\"data-original-title\");\n                oldEventDays.parent().removeClass(\"calendar-\" + data.color);\n                oldEventDays.find(\".calendar-icon\").remove();\n                $.each(data.datesToFill, function () {\n                    var date = calendar.find(\".change-event[data-year=\" + this.year + \"][data-month=\" + this.month + \"][data-day=\" + this.day + \"]\");\n                    date.attr(\"data-id\", data.eventId).attr(\"data-toggle\", \"tooltip\").attr(\"data-placement\", \"top\").attr(\"data-original-title\", data.eventName);\n                    date.parent().addClass(\"calendar-\" + data.color);\n                    date.children(\".calendar-icon\").remove();\n                    date.prepend(\"<i class='calendar-icon fa \" + DOMPurify.sanitize(data.icon) + \"'></i>\");\n                    $(\"#myChangeEvent\").modal(\"hide\");\n                });\n                $('[data-toggle=\"tooltip\"]').tooltip({container: \"body\"});\n            } else {\n                form.find(\".alert\").html(DOMPurify.sanitize(data.error)).show();\n            }\n        }).complete(function () {\n            $(\"#myChangeEvent .centered-loading-gif\").hide();\n            $(\"#myChangeEvent .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\"#myChangeEvent button\").removeAttr(\"disabled\");\n        });\n    }\n});\n\n$(document).on(\"click\", \".show-stages\", function (e) {\n    var icon = this;\n    e.stopPropagation();\n    if (!$(icon).closest(\".accordion-group\").find(\".floating-stages-container\").length) {\n        $(\".floating-stages-container\").remove();\n        $.ajax({\n            url: \"?r=calendar/default/showStages\",\n            type: \"POST\",\n            data: {\n                id: $(icon).data('id')\n            },\n            beforeSend: function () {\n                $(icon).css(\"pointer-events\", \"none\").find(\"i\").addClass(\"fa-spin\").addClass(\"fa-spinner\").removeClass(\"fa-question-circle-o\");\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            var html = \"<div class='floating-stages-container'><div class='stages-container-title'>\" + $(icon).closest(\".accordion-group\").find(\".accordion-title\").text() + \"</div>\";\n            $.each(data, function () {\n                html += \"<div class='stage-container'>\" + this.name + \"</div>\";\n            });\n            html += '<i class=\"close-stages-container fa fa-remove\"></i></div>';\n            $(icon).closest(\".accordion-group\").append(html);\n            $(\".floating-stages-container\").css(\"top\", $(icon).closest(\".accordion-group\").offset().top);\n        }).complete(function () {\n            $(icon).css(\"pointer-events\", \"auto\").find(\"i\").removeClass(\"fa-spin\").removeClass(\"fa-spinner\").addClass(\"fa-question-circle-o\");\n        });\n    } else {\n        $(\".floating-stages-container\").remove();\n    }\n\n});\n\n$(document).on(\"click\", \".close-stages-container\", function () {\n    $(\".floating-stages-container\").remove();\n});\n\n$(document).on(\"click\", \".change-calendar-status\", function (e) {\n    e.stopPropagation();\n    $(\"#changeCalendarStatus\").find(\".alert\").hide();\n    $(\"#changeCalendarStatus\").find(\".modal-title\").text($(this).find(\"i\").hasClass(\"fa-eye\") ? \"Indisponibilizar Calend\u00e1rio\" : \"Disponibilizar Calend\u00e1rio\");\n    $(\"#changeCalendarStatus\").find(\"#calendar-change-status-id\").val($(this).data('id'));\n    $(\"#changeCalendarStatus\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".change-calendar-status-button\", function () {\n    $(\"#changeCalendarStatus\").find(\".alert\").hide();\n    $.ajax({\n        url: \"?r=calendar/default/changeCalendarStatus\",\n        type: \"POST\",\n        data: {\n            id: $(\"#calendar-change-status-id\").val(),\n        },\n        beforeSend: function () {\n            $(\"#changeCalendarStatus .centered-loading-gif\").show();\n            $(\"#changeCalendarStatus .modal-body\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#changeCalendarStatus button\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            var icon = $(\".change-calendar-status[data-id=\" + $(\"#calendar-change-status-id\").val() + \"]\");\n            data.available\n                ? icon.attr(\"data-original-title\", \"Indisponibilizar Calend\u00e1rio\").find(\"i\").removeClass(\"fa-eye-slash\").addClass(\"fa-eye\")\n                : icon.attr(\"data-original-title\", \"Disponibilizar Calend\u00e1rio\").find(\"i\").removeClass(\"fa-eye\").addClass(\"fa-eye-slash\");\n            $(icon).tooltip({container: \"body\"});\n            $(\"#changeCalendarStatus\").modal(\"hide\");\n        } else {\n            $(\"#changeCalendarStatus\").find(\".alert\").html(DOMPurify.sanitize(data.error)).show();\n        }\n    }).complete(function () {\n        $(\"#changeCalendarStatus .centered-loading-gif\").hide();\n        $(\"#changeCalendarStatus .modal-body\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\"#changeCalendarStatus button\").removeAttr(\"disabled\");\n    });\n});\n\n$(document).on(\"click\", \".add-fundamental-menor\", function () {\n    $(\"#stages option[value=14]\").prop(\"selected\", true);\n    $(\"#stages option[value=15]\").prop(\"selected\", true);\n    $(\"#stages option[value=16]\").prop(\"selected\", true);\n    $(\"#stages\").trigger(\"change.select2\");\n});\n\n$(document).on(\"click\", \".add-fundamental-maior\", function () {\n    $(\"#stages option[value=17]\").prop(\"selected\", true);\n    $(\"#stages option[value=18]\").prop(\"selected\", true);\n    $(\"#stages option[value=19]\").prop(\"selected\", true);\n    $(\"#stages option[value=20]\").prop(\"selected\", true);\n    $(\"#stages option[value=21]\").prop(\"selected\", true);\n    $(\"#stages option[value=41]\").prop(\"selected\", true);\n    $(\"#stages\").trigger(\"change.select2\");\n});\n\n$(document).on(\"click\", \".remove-stages\", function () {\n    $(\"#stages option\").prop(\"selected\", false);\n    $(\"#stages\").trigger(\"change.select2\");\n});\n\nfunction pad(num, size) {\n    num = num.toString();\n    while (num.length < size) num = \"0\" + num;\n    return num;\n}", "$('#save_button').click(function() {\n    $('#quiz-form').submit();\n});\n\n$('#delete_button').click(function() {\n    if(confirm('Deseja excluir o question\u00e1rio')){\n        var host = window.location.href;\n        var url = host.split('?')[1];\n        var action = 'index.php?' + (url.indexOf(\"update\") == -1 ? url.replace('create','delete') : url.replace('update','delete'));\n        $('#quiz-form').attr('action', action);\n        $('#quiz-form').submit();\n    }\n});\n\n$('#save_group_button').click(function() {\n    $('#group-form').submit();\n});\n\n$('#delete_group_button').click(function() {\n    if(confirm('Deseja excluir o grupo')){\n        var host = window.location.href;\n        var url = host.split('?')[1];\n        var action = 'index.php?' + (url.indexOf(\"update\") == -1 ? url.replace('create','delete') : url.replace('update','delete'));\n        $('#group-form').attr('action', action);\n        $('#group-form').submit();\n    }\n});\n\n$('#save_question_group_button').click(function() {\n    $('#questiongroup-form').submit();\n});\n\n$('#delete_question_group_button').click(function() {\n    if(confirm('Deseja excluir o grupo')){\n        var host = window.location.href;\n        var url = host.split('?')[1];\n        var action = 'index.php?' + (url.indexOf(\"update\") == -1 ? url.replace('create','delete') : url.replace('update','delete'));\n        $('#questiongroup-form').attr('action', action);\n        $('#questiongroup-form').submit();\n    }\n});\n\n\n$('#save_question_button').click(function() {\n    $('#question-form').submit();\n});\n\n$('#delete_question_button').click(function() {\n    if(confirm('Deseja excluir a quest\u00e3o')){\n        var host = window.location.href;\n        var url = host.split('?')[1];\n        var action = 'index.php?' + (url.indexOf(\"update\") == -1 ? url.replace('create','delete') : url.replace('update','delete'));\n        $('#question-form').attr('action', action);\n        $('#question-form').submit();\n    }\n});\n\n$('#save_answer_button').click(function() {\n    $('#answer-form').submit();\n});\n\nvar Option = function(){\n    var description = $('#QuestionOption_description');\n    var answer = $('#QuestionOption_answer');\n    var questionId = $('#QuestionOption_question_id');\n    var id = $('#QuestionOption_id');\n    var complement = $('#QuestionOption_complement');\n    var container = $('#container_option');\n    var button = $('#save_option_button');\n\n    return{\n        insert: function(){\n            if(Option.validate()){\n                var data = {description: description.val(), question_id: questionId.val(), answer: answer.val(), complement: complement.is(':checked') ? 1 : 0};\n                $.ajax({\n                    type: \"GET\",\n                    url: \"index.php\",\n                    data: { r: 'quiz/default/createOption', QuestionOption: data},\n                    dataType: 'json',\n                    contentType: \"application/json; charset=utf-8\"\n                  })\n                .done(function(data){\n                    data = JSON.stringify(data);\n                    data = DOMPurify.sanitize(data);\n                    data = JSON.parse(data);\n                    if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                        var element = $('<tr></tr>')\n                            .attr({'option-id': data.id, 'option-description': data.description, 'option-answer': data.answer, 'option-complement': data.complement})\n                            .append($('<td></td>').text(container.find('tr').length + 1))\n                            .append($('<td></td>').text(data.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Editar').click(Option.initUpdate))\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(Option.initDelete))\n                            );\n                        container.append(element);\n                        Option.clear();\n                    }\n                })\n                .fail(function(data){\n                    alert('Erro ao salvar item');\n                });\n            }\n        },\n        update: function(){\n            if(Option.validate()){\n                var data = {description: description.val(), question_id: questionId.val(), answer: answer.val(), complement: complement.is(':checked') ? 1 : 0};\n                $.ajax({\n                    type: \"GET\",\n                    url: \"index.php\",\n                    data: { r: 'quiz/default/updateOption', id: id.val(), QuestionOption: data},\n                    dataType: 'json',\n                    contentType: \"application/json; charset=utf-8\"\n                  })\n                .done(function(data){\n                    data = JSON.stringify(data);\n                    data = DOMPurify.sanitize(data);\n                    data = JSON.parse(data);\n                    if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                       var elementActive = container.find('tr[option-id=\"'+data.id+'\"]');\n                        var element = $('<tr></tr>')\n                            .attr({'option-id': data.id, 'option-description': data.description, 'option-answer': data.answer, 'option-complement': data.complement})\n                            .append($('<td></td>').text(elementActive.children('td:eq(0)').text()))\n                            .append($('<td></td>').text(data.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Editar').click(Option.initUpdate))\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(Option.initDelete))\n                            );\n                        elementActive.replaceWith(element);\n                    }\n                    else if(typeof data.errorCode != 'undefined' && data.errorCode == '1'){\n                        alert(data.msg);\n                    }\n                    Option.clear();\n                    Option.initInsert();\n                })\n                .fail(function(data){\n                    alert('Erro ao alterar item');\n                    Option.clear();\n                    Option.initInsert();\n                });\n            }\n        },\n        delete: function(){\n            var data = {id: id.val(), question_id: questionId.val()};\n            $.ajax({\n                type: \"GET\",\n                url: \"index.php\",\n                data: { r: 'quiz/default/deleteOption', id: id.val(), QuestionOption: data},\n                dataType: 'json',\n                contentType: \"application/json; charset=utf-8\"\n                })\n            .done(function(data){\n                if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                    var elementActive = container.find('tr[option-id=\"'+data.id+'\"]');\n                    elementActive.remove();\n                }\n                else if(typeof data.errorCode != 'undefined' && data.errorCode == '1'){\n                    alert(data.msg);\n                }\n\n                Option.clear();\n                Option.initInsert();\n            })\n            .fail(function(data){\n                alert('Erro ao excluir item');\n                Option.clear();\n                Option.initInsert();\n            });\n        },\n        initInsert: function(){\n            id.val('');\n            button.unbind('click');\n            button.bind('click', Option.insert);\n        },\n        initUpdate: function(e){\n            e.preventDefault();\n            var element = $(this).closest('tr');\n            id.val(element.attr('option-id'));\n            description.val(element.attr('option-description'));\n            answer.val(element.attr('option-answer'));\n            complement.prop('checked', Boolean(parseInt(element.attr('option-complement'))));\n            button.unbind('click');\n            button.bind('click', Option.update);\n        },\n        initDelete: function(e){\n            e.preventDefault();\n            var element = $(this).closest('tr');\n            id.val(element.attr('option-id'));\n            if(confirm('Deseja excluir o item?')){\n                Option.delete();\n            }\n        },\n        init: function(){\n            id.val('');\n            button.unbind('click');\n            button.bind('click', Option.insert);\n            Option.buildTable(dataOption);\n        },\n        validate: function(){\n            if(description.val() == '' || answer.val() == '' || questionId.val() == '' ){\n                alert('Preencha todos os campos!');\n                return false;\n            }\n            return true;\n        },\n        clear: function(){\n            description.val('');\n            answer.val('');\n            id.val('');\n            complement.prop('checked',false);\n        },\n        buildTable: function(data){\n            $.each(data, function(K, v){\n                var element = $('<tr></tr>')\n                            .attr({'option-id': v.id, 'option-description': v.description, 'option-answer': v.answer, 'option-complement': v.complement})\n                            .append($('<td></td>').text(container.find('tr').length + 1))\n                            .append($('<td></td>').text(v.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Editar').click(Option.initUpdate))\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(Option.initDelete))\n                            );\n                container.append(element);\n            });\n        },\n        showComplement: function(){\n            var uid = $(this).attr('uid');\n            var id = $(this).attr('id');\n            var type = $(this).attr('type');\n            var complement = id.replace(\"response\",\"complement\");\n            var isChecked = $(this).is(':checked');\n            if(type == 'checkbox'){\n                if(isChecked){\n                    $('#'+uid).show();\n                    $('#'+complement).prop('disabled',false);\n                }\n                else{\n                    $('#'+uid).hide();\n                    $('#'+complement).prop('disabled',true);\n                }\n            }\n            else if(type == 'radio'){\n                var partialUid = uid.substring(0,(uid.length -1));\n                var elementChecked = $('input[id^=\"'+partialUid+'\"]:checked');\n\n                if(isChecked){\n                    $('div[id^=\"'+partialUid+'\"]').each(function(){\n                        $(this).hide();\n                    });\n\n                    $('input[id^=\"'+partialUid+'\"]').each(function(){\n                        if($(this).attr('type') == 'text')\n                            $(this).prop('disabled',true);\n                        else if($(this).attr('type') == 'radio')\n                            $(this).prop('checked',false);\n                    });\n                    $(this).prop('checked',true);\n                    $('#'+uid).show();\n                    $('#'+complement).prop('disabled',false);\n                }\n            }\n        },\n        initComplement: function(){\n            $('input[type=\"checkbox\"],input[type=\"radio\"]').each(\n                function(k, v){\n                    $(this).bind('click', Option.showComplement);\n                    $(this).bind('change', Option.showComplement);\n                    $(this).trigger('change');\n                }\n            );\n        }\n    }\n}();\n\nOption.initComplement();\n\n\nvar QuizQuestion = function(){\n    var quizId = $('#QuizQuestion_quiz_id');\n    var questionId = $('#QuizQuestion_question_id');\n    var container = $('#container_quiz_question');\n    var button = $('#save_quiz_question_button');\n\n    return{\n        insert: function(){\n            if(QuizQuestion.validate()){\n                var data = {quiz_id: quizId.val(), question_id: questionId.val()};\n                $.ajax({\n                    type: \"GET\",\n                    url: \"index.php\",\n                    data: { r: 'quiz/default/setQuizQuestion', quizId: quizId.val(), questionId: questionId.val(),  QuizQuestion: data},\n                    dataType: 'json',\n                    contentType: \"application/json; charset=utf-8\"\n                  })\n                .done(function(data){\n                    data = JSON.stringify(data);\n                    data = DOMPurify.sanitize(data);\n                    data = JSON.parse(data);\n                    if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                        var element = $('<tr></tr>')\n                            .attr({'key': data.quizId + '' + data.questionId, 'quiz-id': data.quizId, 'question-id': data.questionId, 'question-description': data.description})\n                            .append($('<td></td>').text(container.find('tr').length + 1))\n                            .append($('<td></td>').text(data.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(QuizQuestion.initDelete))\n                            );\n                        container.append(element);\n                        QuizQuestion.clear();\n                    }\n                    else if(typeof data.errorCode != 'undefined' && parseInt(data.errorCode) > 0){\n                        alert(data.msg);\n                    }\n                })\n                .fail(function(data){\n                    alert('Erro ao salvar item');\n                });\n            }\n        },\n        delete: function(){\n            var data = {quiz_id: quizId.val(), question_id: questionId.val()};\n            $.ajax({\n                type: \"GET\",\n                url: \"index.php\",\n                data: { r: 'quiz/default/unsetQuizQuestion', quizId: quizId.val(), questionId: questionId.val(), QuizQuestion: data},\n                dataType: 'json',\n                contentType: \"application/json; charset=utf-8\"\n                })\n            .done(function(data){\n                if(typeof data.errorCode != 'undefined' && data.errorCode == '0'){\n                    var elementActive = container.find('tr[key=\"'+data.quizId+ '' + data.questionId +'\"]');\n                    elementActive.remove();\n                }\n                else if(typeof data.errorCode != 'undefined' && data.errorCode == '1'){\n                    alert(data.msg);\n                }\n\n                QuizQuestion.clear();\n            })\n            .fail(function(data){\n                alert('Erro ao excluir item');\n                QuizQuestion.clear();\n            });\n        },\n        initInsert: function(){\n            id.val('');\n            button.unbind('click');\n            button.bind('click', Option.insert);\n        },\n        initDelete: function(e){\n            e.preventDefault();\n            var element = $(this).closest('tr');\n            quizId.val(element.attr('quiz-id'));\n            questionId.val(element.attr('question-id'));\n            if(confirm('Deseja excluir o item?')){\n                QuizQuestion.delete();\n            }\n        },\n        init: function(){\n            questionId.val('');\n            button.unbind('click');\n            button.bind('click', QuizQuestion.insert);\n            QuizQuestion.buildTable(dataQuizQuestion);\n        },\n        validate: function(){\n            if(questionId.val() == '' || quizId.val() == ''){\n                alert('Preencha todos os campos!');\n                return false;\n            }\n            return true;\n        },\n        clear: function(){\n            questionId.val('');\n        },\n        buildTable: function(data){\n            $.each(data, function(k, v){\n                var element = $('<tr></tr>')\n                            .attr({'key': v.quiz_id + '' + v.question_id, 'quiz-id': v.quiz_id, 'question-id': v.question_id, 'question-description': v.description})\n                            .append($('<td></td>').text(container.find('tr').length + 1))\n                            .append($('<td></td>').text(v.description))\n                            .append($('<td></td>').attr({'class': 'center-button'})\n                                .append($('<button></button>').attr({'class': 'btn btn-primary space-button font-button'}).text('Excluir').click(QuizQuestion.initDelete))\n                            );\n                container.append(element);\n            });\n        }\n    }\n}();", "$(document).on(\"change\", \"#classroom_fk\", function () {\n    if ($(this).val() !== \"\") {\n        var select = this;\n        $(select).attr(\"disabled\", \"disabled\");\n        $.ajax({\n            url: getTimesheetURL,\n            type: \"POST\",\n            data: {\n                cid: $(this).val()\n            },\n            beforeSend: function () {\n                $(\".loading-alert\").addClass(\"display-hide\");\n                $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n                $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n            },\n        }).success(function (data) {\n            getTimesheet(data);\n            data = JSON.parse(data);\n            if (data.disciplines !== undefined) {\n                var html = \"<option></option>\";\n                $.each(data.disciplines, function () {\n                    html += \"<option value='\" + this.disciplineId + \"'>\" + this.disciplineName + \"</option>\";\n                });\n                $(\".modal-add-schedule-discipline\").html(html);\n                $(\".modal-add-schedule-discipline\").select2('destroy');\n                $(\".modal-add-schedule-discipline\").select2({\n                    placeholder: \"Selecione a Disciplina...\",\n                    width: \"100%\"\n                });\n            }\n        }).complete(function () {\n            $(\".loading-timesheet\").hide();\n            $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(select).removeAttr(\"disabled\");\n            $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n        });\n    } else {\n        $(\".schedule-info\").addClass(\"display-hide\");\n        $(\".table-container\").hide();\n    }\n});\n\n$(document).on(\"click\", \".btn-generate-timesheet\", function () {\n    if ($(\".tables-timesheet\").is(\":visible\") && $(\".table-month tbody td\").children().length) {\n        $(\"#generateAnotherTimesheet\").modal(\"show\");\n    } else {\n        generateTimesheet();\n    }\n});\n\n$(document).on(\"click\", \".confirm-timesheet-generation\", function () {\n    generateTimesheet();\n});\n\nfunction generateTimesheet() {\n    var classroom = $(\"select.classroom-id\").val();\n    $.ajax({\n        url: generateTimesheetURL,\n        type: \"POST\",\n        data: {\n            classroom: classroom\n        },\n        beforeSend: function () {\n            $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n            $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n            $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        getTimesheet(data);\n    }).complete(function () {\n        $(\".loading-timesheet\").hide();\n        $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n        $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n    });\n}\n\nfunction getTimesheet(data) {\n    data = DOMPurify.sanitize(data);\n    data = JSON.parse(data);\n    $(\".loading-alert\").addClass(\"display-hide\");\n    $(\".schedule-info\").removeClass(\"display-hide\");\n    $(\"#turn\").hide();\n    $(\".table-container\").show();\n    if (data.valid == null) {\n        $(\".schedule-info\").addClass(\"display-hide\");\n    } else if (!data.valid) {\n        if (data.error === \"curricularMatrix\") {\n            $(\".loading-alert\").removeClass(\"display-hide\").html(\"Crie uma <b>matriz curricular</b> com disciplinas diversas e com a mesma etapa da turma selecionada.\");\n            $(\".schedule-info\").addClass(\"display-hide\");\n            $(\".table-container\").hide();\n        } else if (data.error === \"calendar\") {\n            $(\".loading-alert\").removeClass(\"display-hide\").html(\"Disponibilize um <b>calend\u00e1rio</b> contemplando a etapa da turma selecionada e com os eventos de in\u00edcio e fim de ano escolar.\");\n            $(\".schedule-info\").addClass(\"display-hide\");\n            $(\".table-container\").hide();\n        } else if (data.error === \"frequencyFilled\") {\n            $(\".loading-alert\").removeClass(\"display-hide\").html(\"N\u00e3o se pode mais gerar um novo quadro de hor\u00e1rio, visto que j\u00e1 existe preenchimento de frequ\u00eancia.\");\n            $(\"#turn\").show();\n        }\n    } else {\n        $(\".tables-timesheet tbody\").children().remove();\n        $(\".calendar-icons th\").children().remove();\n        var turn = \"\";\n        var lastMonthWeek = 1;\n        $.each(data.calendarEvents, function () {\n            $(\".calendar-icons th[icon-month=\" + this.month + \"][icon-day=\" + this.day + \"]\").append(\n                '<div class=\"calendar-timesheet-icon calendar-' + this.color + '\">' +\n                '<i data-toggle=\"tooltip\" data-placement=\"bottom\" data-original-title=\"' + this.name + '\" class=\"fa ' + this.icon + '\"></i>' +\n                '</div>'\n            );\n        });\n        for (var month = 1; month <= 12; month++) {\n            var html = \"\";\n\n            for (var schedule = 1; schedule <= 10; schedule++) {\n                var weekDayCount = Number($(\".table-month[month=\" + month + \"]\").attr(\"first-day-weekday\"));\n                var week = lastMonthWeek;\n                html += \"<tr schedule='\" + schedule + \"'><th>\" + schedule + \"\u00ba</th>\";\n\n                for (var day = 1; day <= Number($(\".table-month[month=\" + month + \"]\").attr(\"days-count\")); day++) {\n                    var hardUnavailableDay = data.hardUnavailableDays[month] !== undefined && $.inArray(day.toString(), data.hardUnavailableDays[month]) !== -1;\n                    var softUnavailableDay = data.softUnavailableDays[month] !== undefined && $.inArray(day.toString(), data.softUnavailableDays[month]) !== -1;\n\n                    var frequencyUnavailableDay = !hardUnavailableDay && data.frequencyUnavailableLastDay !== undefined\n                        && (month < Number(data.frequencyUnavailableLastDay.month) || (month === Number(data.frequencyUnavailableLastDay.month) && day <= Number(data.frequencyUnavailableLastDay.day)));\n\n                    if (data.schedules[month] !== undefined && data.schedules[month][schedule] !== undefined && data.schedules[month][schedule][day] !== undefined) {\n                        if (turn === \"\") {\n                            if (data.schedules[month][schedule][day].turn === \"0\") turn = \"Manh\u00e3\";\n                            if (data.schedules[month][schedule][day].turn === \"1\") turn = \"Tarde\";\n                            if (data.schedules[month][schedule][day].turn === \"2\") turn = \"Noite\";\n                        }\n                        var discipline = changeNameLength(data.schedules[month][schedule][day].disciplineName, 30);\n                        // var instructor = changeNameLength(info.instructorInfo.name, 30);\n\n                        // var icons = \"\";\n                        // if (info.instructorInfo.unavailable)\n                        //     icons +=\n                        //         \"<i title='Hor\u00e1rio indispon\u00edvel para o instrutor.' class='unavailability-icon fa fa-times-circle darkred'></i>\";\n                        // if (info.instructorInfo.countConflicts > 1)\n                        //     icons +=\n                        //         \"<i title='Instrutor possui \" +\n                        //         info.instructorInfo.countConflicts +\n                        //         \" conflitos neste hor\u00e1rio.' class='fa fa-exclamation-triangle conflict-icon darkgoldenrod'></i>\";\n                        html += \"\" +\n                            \"<td class='\" + (hardUnavailableDay ? \"hard-unavailable\" : \"\") + (frequencyUnavailableDay ? \" frequency-unavailable\" : (softUnavailableDay ? \"soft-unavailable\" : \"\")) + \"' day='\" + day + \"' week='\" + week + \"' week_day='\" + weekDayCount + \"' \" + (frequencyUnavailableDay ? 'data-toggle=\"tooltip\" data-placement=\"bottom\" data-original-title=\"N\u00e3o se pode mais editar esse hor\u00e1rio, visto que j\u00e1 existe preenchimento de frequ\u00eancia at\u00e9 o dia ' + (pad(data.frequencyUnavailableLastDay.day, 2) + \"/\" + pad(data.frequencyUnavailableLastDay.month, 2)) + '.\"' : \"\") + \">\" +\n                            \"<div schedule='\" + data.schedules[month][schedule][day].id + \"' discipline_id='\" + data.schedules[month][schedule][day].disciplineId + \"'class='schedule-block'>\" +\n                            \"<p class='discipline-name' title='\" + data.schedules[month][schedule][day].disciplineName + \"'>\" + discipline + \"</p>\" +\n                            // \"<p class='instructor-name' instructor_id='\" + info.instructorInfo.id + \"' title='\" + info.instructorInfo.name + \"'>\" +\n                            // instructor +\n                            // \"<i class='fa fa-pencil edit-instructor'></i></p>\" +\n                            // icons +\n                            \"</div>\" +\n                            \"</td>\";\n                    } else {\n                        html += \"<td class='\" + (hardUnavailableDay ? \"hard-unavailable\" : \"\") + (frequencyUnavailableDay ? \" frequency-unavailable\" : (softUnavailableDay ? \"soft-unavailable\" : \"\")) + \"' day='\" + day + \"' week='\" + week + \"' week_day='\" + weekDayCount + \"' \" + (frequencyUnavailableDay ? 'data-toggle=\"tooltip\" data-placement=\"bottom\" data-original-title=\"N\u00e3o se pode mais editar esse hor\u00e1rio, visto que j\u00e1 existe preenchimento de frequ\u00eancia at\u00e9 o dia ' + (pad(data.frequencyUnavailableLastDay.day, 2) + \"/\" + pad(data.frequencyUnavailableLastDay.month, 2)) + '.\"' : \"\") + \"></td>\";\n                    }\n\n                    if (weekDayCount === 6) {\n                        weekDayCount = 0;\n                        week++;\n                    } else {\n                        weekDayCount++;\n                    }\n                    if (day === Number($(\".table-month[month=\" + month + \"]\").attr(\"days-count\")) && schedule === 10) {\n                        lastMonthWeek = week;\n                    }\n                }\n                html += \"</tr>\";\n            }\n            $(\".tables-timesheet table[month=\" + month + \"] tbody\").html(html);\n            $('[data-toggle=\"tooltip\"]').tooltip({container: \"body\"});\n        }\n        calculateWorkload(data.disciplines, false);\n        $(\"#turn\").text(turn).show();\n        $(\".table-container\").show();\n    }\n}\n\nfunction calculateWorkload(disciplines, increment) {\n    var hasOverflow = false;\n    if (!increment) {\n        disciplines = sortResults(disciplines, \"disciplineName\", true);\n        var html = \"\";\n        $.each(disciplines, function () {\n            var workloadUsed = Number(this.workloadUsed);\n            var workloadTotal = Number(this.workloadTotal);\n            if (!hasOverflow) {\n                hasOverflow = workloadUsed > workloadTotal;\n            }\n            var workloadColor = workloadUsed > workloadTotal ? \"workload-red\" : (workloadUsed === workloadTotal ? \"workload-green\" : \"\");\n            html += \"<div class='workload \" + workloadColor + \"' discipline-id='\" + this.disciplineId + \"'><div class='workload-discipline'>\" + this.disciplineName + \"</div><div class='workload-numbers'><span class='workload-used'>\" + workloadUsed + \"</span>/<span class='workload-total'>\" + workloadTotal + \"</span></div></div>\";\n        });\n        $(\".workloads\").find(\".workload\").remove();\n        $(\".workloads\").append(html);\n    } else {\n        $.each(disciplines, function () {\n            var workload = $(\".workload[discipline-id=\" + this.disciplineId + \"]\");\n            var workloadUsed = Number(workload.find(\".workload-used\").text()) + Number(this.workloadUsed);\n            var workloadTotal = Number(workload.find(\".workload-total\").text());\n            workloadUsed > workloadTotal\n                ? workload.addClass(\"workload-red\").removeClass(\"workload-green\")\n                : (workloadUsed === workloadTotal ? workload.addClass(\"workload-green\").removeClass(\"workload-red\") : workload.removeClass(\"workload-red\").removeClass(\"workload-green\"));\n            workload.find(\".workload-used\").text(workloadUsed);\n        });\n        hasOverflow = $(\".workloads\").find(\".workload.workload-red\").length;\n    }\n    if (hasOverflow) {\n        $(\".workloads-overflow\").show();\n        $(\".workloads-activator\").addClass(\"fa-chevron-left\").removeClass(\"fa-chevron-right\");\n        $(\".workloads\").show();\n    } else {\n        $(\".workloads-overflow\").hide();\n    }\n}\n\nfunction sortResults(array, prop, asc) {\n    array.sort(function (a, b) {\n        if (asc) {\n            return (a[prop] > b[prop]) ? 1 : ((a[prop] < b[prop]) ? -1 : 0);\n        } else {\n            return (b[prop] > a[prop]) ? 1 : ((b[prop] < a[prop]) ? -1 : 0);\n        }\n    });\n    return array;\n}\n\nfunction changeNameLength(name, limit) {\n    return name.length > limit ? name.substring(0, limit - 3) + \"...\" : name;\n}\n\n$(document).on(\"click\", \".tables-timesheet td\", function () {\n    if ($(this).hasClass(\"schedule-selected\")) {\n        $(this).removeClass(\"schedule-selected\");\n        $(\".tables-timesheet\").find(\".schedule-available\").removeClass(\"schedule-available\");\n        $(\".schedule-remove, .schedule-add\").remove();\n    } else {\n        //J\u00e1 selecionou algum diferente do primeiro e da mesma semana\n        if ($(\".tables-timesheet\").find(\".schedule-selected\").length > 0) {\n            var firstSelected = $(\".tables-timesheet\").find(\".schedule-selected\");\n            var secondSelected = $(this);\n\n            if ((!firstSelected.find(\".schedule-block\").length && !secondSelected.find(\".schedule-block\").length) || !secondSelected.hasClass(\"schedule-available\")) {\n                firstSelected.removeClass(\"schedule-selected\");\n                $(\".tables-timesheet\").find(\".schedule-available\").removeClass(\"schedule-available\");\n                $(\".schedule-remove, .schedule-add\").remove();\n            } else {\n                var firstSchedule = {\n                    month: firstSelected.closest(\"table\").attr(\"month\"),\n                    day: firstSelected.attr(\"day\"),\n                    week_day: firstSelected.attr(\"week_day\"),\n                    schedule: firstSelected.closest(\"tr\").attr(\"schedule\")\n                };\n                var secondSchedule = {\n                    month: secondSelected.closest(\"table\").attr(\"month\"),\n                    day: secondSelected.attr(\"day\"),\n                    week_day: secondSelected.attr(\"week_day\"),\n                    schedule: secondSelected.closest(\"tr\").attr(\"schedule\")\n                };\n                swapSchedule(firstSchedule, secondSchedule);\n            }\n        } else if (!$(this).hasClass(\"hard-unavailable\") && !$(this).hasClass(\"frequency-unavailable\")) {\n            //Primeira sele\u00e7\u00e3o\n            $(this).addClass(\"schedule-selected\");\n            $(this).closest(\".tables-timesheet\").find(\"td[week=\" + $(this).attr(\"week\") + \"]:not(.hard-unavailable):not(.frequency-unavailable)\").not(this).addClass(\"schedule-available\");\n            if ($(this).find(\".schedule-block\").length) {\n                $(this).append(\"<i class='schedule-remove fa fa-remove'></i>\");\n            } else {\n                $(this).append(\"<i class='schedule-add fa fa-plus'></i>\");\n            }\n        }\n    }\n});\n\n$(document).on(\"click\", \".schedule-remove\", function (e) {\n    e.stopPropagation();\n    var schedule = {\n        month: $(this).closest(\"table\").attr(\"month\"),\n        day: $(this).closest(\"td\").attr(\"day\"),\n        week_day: $(this).closest(\"td\").attr(\"week_day\"),\n        schedule: $(this).closest(\"tr\").attr(\"schedule\")\n    };\n    $.ajax({\n        url: removeScheduleURL,\n        type: \"POST\",\n        data: {\n            classroomId: $(\"select.classroom-id\").val(),\n            schedule: schedule,\n            replicate: $(\".replicate-actions\").is(\":checked\") ? 1 : 0\n        }, beforeSend: function () {\n            $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n            $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\".classroom_fk\").attr(\"disabled\", \"disabled\");\n            $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            $.each(data.removes, function () {\n                $(\"table[month=\" + this.month + \"] tr[schedule=\" + this.schedule + \"] td[day=\" + this.day + \"]\").children().remove();\n            });\n            calculateWorkload(data.disciplines, true);\n        }\n        $(\".schedule-remove\").remove();\n        $(\".schedule-selected\").removeClass(\"schedule-selected\");\n        $(\".schedule-available\").removeClass(\"schedule-available\");\n    }).complete(function () {\n        $(\".loading-timesheet\").hide();\n        $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\".classroom_fk\").removeAttr(\"disabled\");\n        $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n    });\n});\n\n$(document).on(\"click\", \".schedule-add\", function (e) {\n    e.stopPropagation();\n    $(\".add-schedule-alert\").addClass(\"no-show\");\n    $(\".modal-replicate-actions\").prop(\"checked\", $(\".replicate-actions\").is(\":checked\"));\n    $(\".add-schedule-month\").val($(this).closest(\"table\").attr(\"month\"));\n    $(\".add-schedule-day\").val($(this).closest(\"td\").attr(\"day\"));\n    $(\".add-schedule-weekday\").val($(this).closest(\"td\").attr(\"week_day\"));\n    $(\".add-schedule-schedule\").val($(this).closest(\"tr\").attr(\"schedule\"));\n    $(\".modal-add-schedule-discipline\").val(\"\").trigger(\"change.select2\");\n    $(\"#addSchedule\").modal(\"show\");\n});\n\n$(document).on(\"click\", \".replicate-actions-container\", function (e) {\n    if (e.target === this) {\n        $(this).find(\".replicate-actions-checkbox\").prop(\"checked\", !$(this).find(\".replicate-actions-checkbox\").is(\":checked\")).trigger(\"change\");\n    }\n});\n\n$(document).on(\"change\", \".replicate-actions-checkbox\", function (e) {\n    $(\".replicate-actions-checkbox\").prop(\"checked\", $(this).is(\":checked\"));\n});\n\n$(document).on(\"click\", \".btn-add-schedule\", function () {\n    if ($(\"select.modal-add-schedule-discipline\").val() !== \"\") {\n        $(\".add-schedule-alert\").addClass(\"no-show\");\n        $(\"#addSchedule\").modal(\"hide\");\n        $.ajax({\n            url: addScheduleURL,\n            type: \"POST\",\n            data: {\n                classroomId: $(\"select.classroom-id\").val(),\n                disciplineId: $(\"select.modal-add-schedule-discipline\").val(),\n                schedule: {\n                    month: $(\".add-schedule-month\").val(),\n                    day: $(\".add-schedule-day\").val(),\n                    week_day: $(\".add-schedule-weekday\").val(),\n                    schedule: $(\".add-schedule-schedule\").val()\n                },\n                replicate: $(\".modal-replicate-actions\").is(\":checked\") ? 1 : 0\n            }, beforeSend: function () {\n                $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n                $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\".classroom_fk\").attr(\"disabled\", \"disabled\");\n                $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n            },\n        }).success(function (data) {\n            data = JSON.parse(data);\n            if (data.valid) {\n                $.each(data.adds, function () {\n                    var discipline = changeNameLength(this.disciplineName, 30);\n                    $(\".table-month[month=\" + this.month + \"] tbody\").find(\"tr[schedule=\" + this.schedule + \"]\").find(\"td[day=\" + this.day + \"]\").html(\"\" +\n                        \"<div schedule='\" + this.id + \"' discipline_id='\" + this.disciplineId + \"' class='schedule-block'>\" +\n                        \"<p class='discipline-name' title='\" + this.disciplineName + \"'>\" + discipline + \"</p>\" +\n                        \"</div>\"\n                    );\n                });\n                calculateWorkload(data.disciplines, true);\n            }\n            $(\".schedule-add\").remove();\n            $(\".schedule-selected\").removeClass(\"schedule-selected\");\n            $(\".schedule-available\").removeClass(\"schedule-available\");\n        }).complete(function () {\n            $(\".loading-timesheet\").hide();\n            $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\".classroom_fk\").removeAttr(\"disabled\");\n            $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n        });\n    } else {\n        $(\".add-schedule-alert\").removeClass(\"no-show\");\n    }\n});\n\n$(document).on('click', \".cancel-add-schedule\", function () {\n    $(\".schedule-add\").remove();\n    $(\".schedule-selected\").removeClass(\"schedule-selected\");\n    $(\".schedule-available\").removeClass(\"schedule-available\");\n});\n\nfunction swapSchedule(firstSchedule, secondSchedule) {\n    $.ajax({\n        url: changeSchedulesURL,\n        type: \"POST\",\n        data: {\n            classroomId: $(\"select.classroom-id\").val(),\n            firstSchedule: firstSchedule,\n            secondSchedule: secondSchedule,\n            replicate: $(\".replicate-actions\").is(\":checked\") ? 1 : 0\n        }, beforeSend: function () {\n            $(\".loading-timesheet\").css(\"display\", \"inline-block\");\n            $(\".table-container\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\".classroom_fk\").attr(\"disabled\", \"disabled\");\n            $(\".btn-generate-timesheet\").attr(\"disabled\", \"disabled\");\n        },\n    }).success(function (data) {\n        data = JSON.parse(data);\n        if (data.valid) {\n            $.each(data.changes, function () {\n                var firstScheduleBlock = $(\"table[month=\" + this.firstSchedule.month + \"] tr[schedule=\" + this.firstSchedule.schedule + \"] td[day=\" + this.firstSchedule.day + \"]\").children();\n                var secondScheduleBlock = $(\"table[month=\" + this.secondSchedule.month + \"] tr[schedule=\" + this.secondSchedule.schedule + \"] td[day=\" + this.secondSchedule.day + \"]\").children();\n                $(\"table[month=\" + this.firstSchedule.month + \"] tr[schedule=\" + this.firstSchedule.schedule + \"] td[day=\" + this.firstSchedule.day + \"]\").html(secondScheduleBlock);\n                $(\"table[month=\" + this.secondSchedule.month + \"] tr[schedule=\" + this.secondSchedule.schedule + \"] td[day=\" + this.secondSchedule.day + \"]\").html(firstScheduleBlock);\n            });\n            $(\"td.hard-unavailable\").children().remove();\n            calculateWorkload(data.disciplines, false);\n        }\n        $(\".schedule-remove, .schedule-add\").remove();\n        $(\".schedule-selected\").removeClass(\"schedule-selected\");\n        $(\".schedule-available\").removeClass(\"schedule-available\");\n    }).complete(function () {\n        $(\".loading-timesheet\").hide();\n        $(\".table-container\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n        $(\".classroom_fk\").removeAttr(\"disabled\");\n        $(\".btn-generate-timesheet\").removeAttr(\"disabled\");\n    });\n}\n\n$(document).on(\"click\", \".workloads-activator\", function () {\n    if ($(\".workloads-activator\").hasClass(\"fa-chevron-right\")) {\n        $(\".workloads-activator\").addClass(\"fa-chevron-left\").removeClass(\"fa-chevron-right\");\n        $(\".workloads\").show();\n    } else {\n        $(\".workloads-activator\").addClass(\"fa-chevron-right\").removeClass(\"fa-chevron-left\");\n        $(\".workloads\").hide();\n    }\n});\n\n// $(document).on(\"click\", \".schedule-selected .instructor-name\", function () {\n//     var instructorId = $(this).attr(\"instructor_id\");\n//     var disciplineId = $(this)\n//         .parent()\n//         .find(\".discipline-name\")\n//         .attr(\"discipline_id\");\n//     var scheduleId = $(this)\n//         .parent()\n//         .attr(\"schedule\");\n//\n//     $.ajax({\n//         url: getInstructorsUrl,\n//         type: \"POST\",\n//         data: {\n//             discipline: disciplineId\n//         }\n//     }).success(function (result) {\n//         $(\"#change-instructor-schedule\").val(scheduleId);\n//         $(\"#change-instructor-id\").html(result);\n//         $(\"#change-instructor-id\").val(instructorId).select2();\n//         $(\"#change-instructor-modal\").modal();\n//     });\n// });\n$(document).on(\"click\", \"#change-instructor-button\", function () {\n    $.ajax({\n        url: changeInstructorUrl,\n        type: \"POST\",\n        data: {\n            schedule: $(\"#change-instructor-schedule\").val(),\n            instructor: $(\"#change-instructor-id\").val()\n        }\n    }).success(function (data) {\n        data = JSON.parse(data);\n        getTimesheet(data);\n        $(\"#change-instructor-modal\").modal(\"hide\");\n    });\n});\n\n$(document).on(\"click\", \"#add-instructors-disciplines-button\", function () {\n    $(\"#add-instructors-disciplines-form\").submit();\n});", "$('#classesSearch').on('click', function () {\n    if ($(\"#classroom\").val() !== \"\" && $(\"#month\").val() !== \"\" && (!$(\"#disciplines\").is(\":visible\") || $(\"#disciplines\").val() !== \"\")) {\n        $(\".alert-required-fields\").hide();\n        var fundamentalMaior = Number($(\"#classroom option:selected\").attr(\"fundamentalmaior\"));\n        jQuery.ajax({\n            type: 'POST',\n            url: \"?r=classes/getClassContents\",\n            cache: false,\n            data: {\n                classroom: $(\"#classroom\").val(),\n                fundamentalMaior: fundamentalMaior,\n                month: $(\"#month\").val(),\n                discipline: $(\"#disciplines\").val()\n            },\n            beforeSend: function () {\n                $(\".loading-class-contents\").css(\"display\", \"inline-block\");\n                $(\"#widget-class-contents\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#classroom, #month, #disciplines, #classesSearch\").attr(\"disabled\", \"disabled\");\n            },\n            success: function (data) {\n                var data = jQuery.parseJSON(data);\n                if (data.valid) {\n                    $.ajax({\n                        type: 'POST',\n                        url: \"?r=classes/getContents\",\n                        cache: false,\n                        success: function (contents) {\n                            var obj = jQuery.parseJSON(contents);\n\n                            if (data === null) {\n                                $('#class-contents > thead').html('<tr><th class=\"center\">' + data.error + '</th></tr>');\n                                $('#class-contents > tbody').html('');\n                                $('#widget-class-contents').show();\n                                $('#class-contents').show();\n                                $(\"#print, #save\").hide();\n                            } else {\n                                createTable(data, obj);\n                                $(\"#print, #save\").show();\n                            }\n                        },\n                        complete: function (response) {\n                            $(\".loading-class-contents\").hide();\n                            $(\"#widget-class-contents\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n                            $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n                        },\n                    });\n                } else {\n                    $('#class-contents > thead').html('<tr><th class=\"center\">' + data.error + '</th></tr>');\n                    $('#class-contents > tbody').html('');\n                    $('#widget-class-contents').css(\"opacity\", 1).css(\"pointer-events\", \"auto\").show();\n                    $('#class-contents').show();\n                    $(\".loading-class-contents\").hide();\n                    $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n                }\n            }\n        });\n    } else {\n        $(\".alert-required-fields\").show();\n        $(\"#widget-class-contents\").hide();\n        $(\"#print, #save\").hide();\n    }\n});\n\n$(\"#classroom\").on(\"change\", function () {\n    $(\"#disciplines\").val(\"\").trigger(\"change.select2\");\n    if ($(this).val() !== \"\") {\n        if ($(\"#classroom > option:selected\").attr(\"fundamentalmaior\") === \"1\") {\n            $.ajax({\n                type: \"POST\",\n                url: \"?r=classes/getDisciplines\",\n                cache: false,\n                data: {\n                    classroom: $(\"#classroom\").val(),\n                },\n                success: function (response) {\n                    if (response == \"\") {\n                        $(\"#disciplines\").html(\"<option value='-1'></option>\").trigger(\"change.select2\").show();\n                    } else {\n                        $(\"#disciplines\").html(decodeHtml(response)).trigger(\"change.select2\").show();\n                    }\n                    $(\".disciplines-container\").show();\n                },\n            });\n        } else {\n            $(\".disciplines-container\").hide();\n        }\n    } else {\n        $(\".disciplines-container\").hide();\n    }\n});\n\n$(document).ready(function () {\n    $('#class-contents').hide();\n});\n\n$(\"#print\").on('click', function () {\n    window.print();\n});\n\n$(\"#save\").on('click', function () {\n    $(\".alert-save\").hide();\n    var classContents = [];\n    $(\".day-row\").each(function() {\n        classContents.push({\n            day: $(this).attr(\"day\"),\n            contents: $(this).find(\"select.contents-select\").val()\n        });\n    });\n\n    $.ajax({\n        type: \"POST\",\n        url: \"?r=classes/saveClassContents\",\n        cache: false,\n        data: {\n            classroom: $(\"#class-contents\").attr(\"classroom\"),\n            month: $(\"#class-contents\").attr(\"month\"),\n            discipline: $(\"#class-contents\").attr(\"discipline\"),\n            fundamentalMaior: $(\"#class-contents\").attr(\"fundamentalmaior\"),\n            classContents: classContents\n        },\n        beforeSend: function () {\n            $(\".loading-class-contents\").css(\"display\", \"inline-block\");\n            $(\"#widget-class-contents\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#classroom, #month, #disciplines, #classesSearch\").attr(\"disabled\", \"disabled\");\n        },\n        success: function (response) {\n            $(\".alert-save\").show();\n        },\n        complete: function (response) {\n            $(\".loading-class-contents\").hide();\n            $(\"#widget-class-contents\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n        },\n    });\n});\n\n$('.heading-buttons').css('width', $('#content').width());\n\n", "$(\"#classesSearch\").on(\"click\", function () {\n    if ($(\"#classroom\").val() !== \"\" && $(\"#month\").val() !== \"\" && (!$(\"#disciplines\").is(\":visible\") || $(\"#disciplines\").val() !== \"\")) {\n        $(\".alert-required-fields, .alert-incomplete-data\").hide();\n        var fundamentalMaior = Number($(\"#classroom option:selected\").attr(\"fundamentalmaior\"));\n        jQuery.ajax({\n            type: \"POST\",\n            url: \"?r=classes/getFrequency\",\n            cache: false,\n            data: {\n                classroom: $(\"#classroom\").val(),\n                fundamentalMaior: fundamentalMaior,\n                discipline: $(\"#disciplines\").val(),\n                month: $(\"#month\").val(),\n            },\n            beforeSend: function () {\n                $(\".loading-frequency\").css(\"display\", \"inline-block\");\n                $(\".table-frequency\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n                $(\"#classroom, #month, #disciplines, #classesSearch\").attr(\"disabled\", \"disabled\");\n            },\n            success: function (response) {\n                var data = JSON.parse(response);\n                if (data.valid) {\n                    var html = \"\";\n                    html += \"\" +\n                        \"<table class='table-frequency table table-bordered table-striped table-hover'>\" +\n                        \"<thead>\" +\n                        \"<tr><th class='table-title' colspan='\" + (Object.keys(data.students[0].schedules).length + 1) + \"'>\" + (fundamentalMaior ? $('#disciplines').select2('data').text : \"Todas as Disciplinas\") + \"</th></tr>\";\n                    var daynameRow = \"\";\n                    var dayRow = \"\";\n                    var scheduleRow = \"\";\n                    var checkboxRow = \"\";\n                    $.each(data.students[0].schedules, function () {\n                        dayRow += \"<th>\" + (pad(this.day, 2) + \"/\" + pad($(\"#month\").val(), 2)) + \"</th>\";\n                        daynameRow += \"<th>\" + this.week_day + \"</th>\";\n                        scheduleRow += fundamentalMaior ? \"<th>\" + this.schedule + \"\u00ba Hor\u00e1rio</th>\" : \"\";\n                        checkboxRow += \"<th class='frequency-checkbox-general frequency-checkbox-container \" + (!this.available ? \"disabled\" : \"\") + \"'><input class='frequency-checkbox' type='checkbox' \" + (!this.available ? \"disabled\" : \"\") + \" classroomId='\" + $(\"#classroom\").val() + \"' day='\" + this.day + \"' month='\" + $(\"#month\").val() + \"' schedule='\" + this.schedule + \"' fundamentalMaior='\" + fundamentalMaior + \"'></th>\";\n                    });\n                    html += \"<tr class='day-row'><th></th>\" + dayRow + \"</tr><tr class='dayname-row'><th></th>\" + daynameRow + \"</tr>\" + (fundamentalMaior ? \"<tr class='schedule-row'><th></th>\" + scheduleRow + \"</tr>\" : \"\") + \"<tr class='checkbox-row'><th></th>\" + checkboxRow + \"</tr>\";\n                    html += \"</thead><tbody>\";\n                    $.each(data.students, function (indexStudent, student) {\n                        html += \"<tr><td class='student-name'>\" + student.studentName + \"</td>\";\n                        $.each(student.schedules, function (indexSchedule, schedule) {\n                            html += \"<td class='frequency-checkbox-student frequency-checkbox-container \" + (!this.available ? \"disabled\" : \"\") + \"'><input class='frequency-checkbox' type='checkbox' \" + (!schedule.available ? \"disabled\" : \"\") + \" \" + (schedule.fault ? \"checked\" : \"\") + \" classroomId='\" + $(\"#classroom\").val() + \"' studentId='\" + student.studentId + \"' day='\" + schedule.day + \"' month='\" + $(\"#month\").val() + \"' schedule='\" + schedule.schedule + \"' fundamentalMaior='\" + fundamentalMaior + \"'></td>\";\n                        });\n                        html += \"</tr>\";\n                    });\n                    html += \"</tbody></table>\";\n                    $(\"#frequency-container\").html(html).show();\n                    $(\".frequency-checkbox-general\").each(function() {\n                        var day = $(this).find(\".frequency-checkbox\").attr(\"day\");\n                        $(this).find(\".frequency-checkbox\").prop(\"checked\", $(\".frequency-checkbox-student .frequency-checkbox[day=\" + day + \"]:checked\").length === $(\".frequency-checkbox-student .frequency-checkbox[day=\" + day + \"]\").length);\n\n                    })\n                } else {\n                    $(\"#frequency-container\").hide();\n                    $(\".alert-incomplete-data\").html(data.error).show();\n                }\n            },\n            complete: function (response) {\n                $(\".loading-frequency\").hide();\n                $(\".table-frequency\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n                $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n            },\n        });\n    } else {\n        $(\".alert-required-fields\").show();\n        $(\"#frequency-container, .alert-incomplete-data\").hide();\n    }\n});\n\n$(document).on(\"click\", \".frequency-checkbox-container\", function (e) {\n    if (e.target === this && !$(this).hasClass(\"disabled\")) {\n        $(this).find(\".frequency-checkbox\").prop(\"checked\", !$(this).find(\".frequency-checkbox\").is(\":checked\")).trigger(\"change\");\n    }\n});\n\n$(\"#classroom\").on(\"change\", function () {\n    $(\"#disciplines\").val(\"\").trigger(\"change.select2\");\n    if ($(this).val() !== \"\") {\n        if ($(\"#classroom > option:selected\").attr(\"fundamentalMaior\") === \"1\") {\n            $.ajax({\n                type: \"POST\",\n                url: \"?r=classes/getDisciplines\",\n                cache: false,\n                data: {\n                    classroom: $(\"#classroom\").val(),\n                },\n                success: function (response) {\n                    if (response === \"\") {\n                        $(\"#disciplines\").html(\"<option value='-1'></option>\").trigger(\"change.select2\").show();\n                    } else {\n                        $(\"#disciplines\").html(decodeHtml(response)).trigger(\"change.select2\").show();\n                    }\n                    $(\".disciplines-container\").show();\n                },\n            });\n        } else {\n            $(\".disciplines-container\").hide();\n        }\n    } else {\n        $(\".disciplines-container\").hide();\n    }\n});\n\n$(document).on(\"change\", \".frequency-checkbox\", function () {\n    var checkbox = this;\n    $.ajax({\n        type: \"POST\",\n        url: \"?r=classes/saveFrequency\",\n        cache: false,\n        data: {\n            classroomId: $(this).attr(\"classroomId\"),\n            day: $(this).attr(\"day\"),\n            month: $(this).attr(\"month\"),\n            schedule: $(this).attr(\"schedule\"),\n            studentId: $(this).attr(\"studentId\"),\n            fault: $(this).is(\":checked\") ? 1 : 0,\n            fundamentalMaior: $(this).attr(\"fundamentalMaior\")\n        },\n        beforeSend: function () {\n            $(\".loading-frequency\").css(\"display\", \"inline-block\");\n            $(\".table-frequency\").css(\"opacity\", 0.3).css(\"pointer-events\", \"none\");\n            $(\"#classroom, #month, #disciplines, #classesSearch\").attr(\"disabled\", \"disabled\");\n        },\n        complete: function (response) {\n            if ($(checkbox).attr(\"studentId\") === undefined) {\n                $(\".table-frequency tbody .frequency-checkbox[day=\" + $(checkbox).attr(\"day\") + \"][schedule=\" + $(checkbox).attr(\"schedule\") + \"]\").prop(\"checked\", $(checkbox).is(\":checked\"));\n            }\n            $(\".loading-frequency\").hide();\n            $(\".table-frequency\").css(\"opacity\", 1).css(\"pointer-events\", \"auto\");\n            $(\"#classroom, #month, #disciplines, #classesSearch\").removeAttr(\"disabled\");\n        },\n    });\n});", "<?php\n/* @var $this ReportsController */\n\n$baseUrl = Yii::app()->baseUrl;\n$cs = Yii::app()->getClientScript();\n$cs->registerCssFile($baseUrl . '/css/reports.css');\n\n$this->pageTitle = 'TAG - ' . Yii::t('default', 'Reports');\n$this->breadcrumbs = array(\n    Yii::t('default', 'Reports'),\n);\n?>\n\n    <div class=\"row-fluid\">\n        <div class=\"span12\">\n            <h3 class=\"heading-mosaic\"><?php echo Yii::t('default', 'Reports'); ?></h3>\n        </div>\n    </div>\n\n    <div class=\"innerLR home\">\n        <div class=\"row-fluid\">\n            <?php if (Yii::app()->user->hasFlash('success')): ?>\n                <div class=\"alert alert-success\">\n                    <?php echo Yii::app()->user->getFlash('success') ?>\n                </div>\n                <br/>\n            <?php endif ?>\n            <div class=\"span12\">\n                <div class=\"span2\">\n                    <a href=\"#\" data-toggle=\"modal\" data-target=\"#reportFamilyBag\" class=\"widget-stats\" target=\"_blank\">\n                        <!-- <a  href=\"<?php //echo Yii::app()->createUrl('reports/BFReport')?>\" class=\"widget-stats\"> -->\n                        <div><i class=\"fa-percent fa fa-4x\"></i></div>\n                        <span class=\"report-title\">Frequ\u00eancia para o Bolsa Fam\u00edlia</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/NumberStudentsPerClassroomReport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-sort-numeric-asc fa-4x\"></i></div>\n                        <span class=\"report-title\">N\u00famero de Alunos por Turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/InstructorsPerClassroomReport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-graduation-cap fa-4x\"></i></div>\n                        <span class=\"report-title\">Professores por Turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/studentsbetween5and14yearsoldreport', array('id' => Yii::app()->user->school)) ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-heartbeat fa-4x\"></i></div>\n                        <span class=\"report-title\">Alunos com Idade entre 5 e 14 Anos (SUS)</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/enrollmentcomparativeanalysisreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-exchange fa-4x\"></i></div>\n                        <span class=\"report-title\">An\u00e1lise Comparativa de Matr\u00edculas</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/schoolprofessionalnumberbyclassroomreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><span class=\"glyphicons signal\"><i></i></span></div>\n                        <span class=\"report-title\">N\u00famero de Profissionais por turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n            </div>\n            <div class=\"span12\" style=\"margin: 10px 0 0 0\">\n\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/educationalassistantperclassroomreport', array('id' => Yii::app()->user->school)) ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-handshake-o fa-4x\"></i></div>\n                        <span class=\"report-title\">Auxiliar/Assistente Educacional por Turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/disciplineandinstructorrelationreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-podcast fa-4x\"></i></div>\n                        <span class=\"report-title\">Rela\u00e7\u00e3o Disciplina/Docente</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/complementaractivityassistantbyclassroomreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-dot-circle-o fa-4x\"></i></div>\n                        <span class=\"report-title\">Monitores de Atividade Complementar por Turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/classroomwithoutinstructorrelationreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-ban fa-4x\"></i></div>\n                        <span class=\"report-title\">Rela\u00e7\u00e3o Turmas sem Instrutor</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/studentinstructornumbersrelationreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-users fa-4x\"></i></div>\n                        <span class=\"report-title\">N\u00famero de Alunos e Professores por Turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/studentsbyclassroomreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-address-book fa-4x\"></i></div>\n                        <span class=\"report-title\">Rela\u00e7\u00e3o de alunos por turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n            </div>\n            <div class=\"span12\" style=\"margin: 10px 0 0 0\">\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/studentsinalphabeticalorderrelationreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-sort-alpha-asc fa-4x\"></i></div>\n                        <span class=\"report-title\">Rela\u00e7ao de Alunos em ordem Alfab\u00e9tica</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/studentswithdisabilitiesrelationreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-wheelchair fa-4x\"></i></div>\n                        <span class=\"report-title\">Rela\u00e7\u00e3o Acessibilidade</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/studentsusingschooltransportationrelationreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-bus fa-4x\"></i></div>\n                        <span class=\"report-title\">Rela\u00e7\u00e3o Transporte Escolar</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/incompatiblestudentagebyclassroomreport') ?>\"\n                       class=\"widget-stats\" target=\"_blank\">\n                        <div><i class=\"fa fa-street-view fa-4x\"></i></div>\n                        <span class=\"report-title\">Alunos com Idade Incompat\u00edvel por Turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/bfrstudentReport') ?>\" class=\"widget-stats\"\n                       target=\"_blank\">\n                        <div><span class=\"glyphicons justify\"><i></i></span></div>\n                        <span class=\"report-title\">Alunos participantes Bolsa Familia</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/studentpendingdocument') ?>\" class=\"widget-stats\"\n                       target=\"_blank\">\n                        <div><i class=\"fa fa-list-ol fa-4x\"></i></div>\n                        <span class=\"report-title\">Alunos com Documentos Pendentes</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n            </div>\n            <div class=\"span12\" style=\"margin: 10px 0 0 0\">\n                <div class=\"span2\">\n                    <a href=\"#\" data-toggle=\"modal\" data-target=\"#report\" class=\"widget-stats\" target=\"_blank\">\n                        <div><span class=\"glyphicons signal\"><i></i></span></div>\n                        <span class=\"report-title\">Alunos por turma</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n                <div class=\"span2\">\n                    <a href=\"<?php echo Yii::app()->createUrl('reports/studentspecialfood') ?>\" class=\"widget-stats\"\n                       target=\"_blank\">\n                        <span class=\"glyphicons fast_food\"><i></i></span>\n                        <span class=\"txt\">Alunos - Card\u00e1pios Especiais</span>\n                        <div class=\"clearfix\"></div>\n                    </a>\n                </div>\n            </div>\n            <div class=\"modal fade\" id=\"report\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"New Calendar\">\n                <div class=\"modal-dialog\" role=\"document\">\n                    <div class=\"modal-content\">\n                        <div class=\"modal-header\">\n                            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span\n                                        aria-hidden=\"true\">\u00d7</span></button>\n                            <h4 class=\"modal-title\" id=\"myModalLabel\">Escolha a Turma</h4>\n                        </div>\n                        <form class=\"form-vertical\" id=\"createCalendar\" action=\"/br.tag/?r=calendar\" method=\"post\">\n                            <div class=\"modal-body\">\n                                <div class=\"row-fluid\">\n                                    <div class=\" span12\" style=\"margin: 10px 0 10px 0;\">\n                                        <div class=\"span4\">\n                                            <?php echo CHtml::label(yii::t('default', 'Classroom'), 'classroom', array('class' => 'control-label')); ?>\n                                        </div>\n                                        <div class=\"span8\">\n                                            <?php\n                                            echo CHtml::dropDownList('classroom', '', CHtml::listData(Classroom::model()->findAll(array('condition' => 'school_inep_fk=' . Yii::app()->user->school . ' && school_year = ' . Yii::app()->user->year, 'order' => 'name')), 'id', 'name'), array(\n                                                'key' => 'id',\n                                                'class' => 'select-search-on',\n                                                'prompt' => 'Selecione a turma',\n                                                'ajax' => array(\n                                                    'type' => 'POST',\n                                                    'url' => CController::createUrl('classes/getDisciplines'),\n                                                    'success' => 'function(data){\n                                                        $(\"#disciplines\").html(decodeHtml(data));\n                                                    }'\n                                                )));\n                                            ?>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class=\"modal-footer\" style=\"background-color:#FFF;\">\n                                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancelar</button>\n                                    <a class=\"btn btn-primary\"\n                                       url=\"<?php echo Yii::app()->createUrl('reports/studentbyclassroomreport'); ?>\"\n                                       type=\"button\" value=\"Gerar\" id=\"buildReport\"> Gerar </a>\n                                </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"modal fade\" id=\"reportFamilyBag\" tabindex=\"-1\" role=\"dialog\">\n        <div class=\"modal-dialog\" role=\"documentBag\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span\n                                aria-hidden=\"true\">\u00d7</span></button>\n                    <h4 class=\"modal-title\">Frequ\u00eancia Bolsa Fam\u00edlia - Escolha a Turma</h4>\n                </div>\n                <form class=\"form-vertical\" action=\"/br.tag/?r=calendar\" method=\"post\">\n                    <div class=\"modal-body\">\n                        <div class=\"row-fluid\">\n                            <div class=\" span12\" style=\"margin: 10px 0 10px 0;\">\n                                <div class=\"span4\">\n                                    <?php echo CHtml::label(yii::t('default', 'Classroom'), 'classroom', array('class' => 'control-label')); ?>\n                                </div>\n                                <div class=\"span8\">\n                                    <?php\n                                    echo CHtml::dropDownList('classroom2', '', CHtml::listData(Classroom::model()->findAll(array('condition' => 'school_inep_fk=' . Yii::app()->user->school . ' && school_year = ' . Yii::app()->user->year, 'order' => 'name')), 'id', 'name'), array(\n                                        'key' => 'id',\n                                        'class' => 'select-search-on',\n                                        'prompt' => 'Todas as turmas',\n                                        'ajax' => array(\n                                            'type' => 'POST',\n                                            'url' => CController::createUrl('classes/getDisciplines'),\n                                            'success' => 'function(data){\n                                                $(\"#disciplines\").html(decodeHtml(data));\n                                            }'\n                                        )));\n                                    ?>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"modal-footer\" style=\"background-color:#FFF;\">\n                        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancelar</button>\n                        <a class=\"btn btn-primary\" url=\"<?php echo Yii::app()->createUrl('reports/BFReport'); ?>\"\n                           type=\"button\" value=\"Gerar\" id=\"buildReportBF\"> Gerar </a>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n\n<?php\n\n$cs = Yii::app()->getClientScript();\n$cs->registerScript('buildReport', \"  \n    $('#buildReport').live('click', function(event) {\n        var url = $(this).attr('url');\n        var id = $('#classroom').val();\n        $(this).attr('url', url + '&id='+ id);\n    });\n    registerAndOpenTab('#buildReport');\", CClientScript::POS_END);\n\n$cs->registerScript('buildReportBF', \"  \n    $('#buildReportBF').live('click', function(event) {\n        var url = $(this).attr('url');\n        var id = $('#classroom2').val();\n        $(this).attr('url', url + '&id='+ id);\n    });\n    registerAndOpenTab('#buildReportBF');\", CClientScript::POS_END);\n\n?>"], "filenames": ["app/controllers/ClassesController.php", "app/modules/calendar/resources/common/js/calendar.js", "app/modules/quiz/resources/common/js/quiz.js", "app/modules/timesheet/resources/common/js/timesheet.js", "js/classes/class-contents/_initialization.js", "js/classes/frequency/_initialization.js", "themes/default/views/reports/index.php"], "buggy_code_start_loc": [304, 30, 1, 442, 79, 92, 14], "buggy_code_end_loc": [317, 324, 288, 465, 80, 93, 279], "fixing_code_start_loc": [304, 30, 1, 442, 79, 92, 14], "fixing_code_end_loc": [317, 324, 298, 465, 80, 93, 306], "type": "CWE-79", "message": "A vulnerability was found in ipti br.tag. It has been declared as problematic. Affected by this vulnerability is an unknown functionality. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 2.13.0 is able to address this issue. The name of the patch is 7e311be22d3a0a1b53e61cb987ba13d681d85f06. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-215431.", "other": {"cve": {"id": "CVE-2022-4444", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-13T09:15:09.120", "lastModified": "2022-12-15T16:26:20.857", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in ipti br.tag. It has been declared as problematic. Affected by this vulnerability is an unknown functionality. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 2.13.0 is able to address this issue. The name of the patch is 7e311be22d3a0a1b53e61cb987ba13d681d85f06. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-215431."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "cna@vuldb.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:ipti:tag:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.13.0", "matchCriteriaId": "10786D4B-AC17-404F-96E4-C43607CD27E2"}]}]}], "references": [{"url": "https://github.com/ipti/br.tag/commit/7e311be22d3a0a1b53e61cb987ba13d681d85f06", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/ipti/br.tag/pull/131", "source": "cna@vuldb.com", "tags": ["Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.215431", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/ipti/br.tag/commit/7e311be22d3a0a1b53e61cb987ba13d681d85f06"}}