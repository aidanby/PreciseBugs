{"buggy_code": ["# Release Notes\n\n## WIP\n\n- Fix mime type detection on asset upload\n- Fix possible Cross-site Scripting (XSS) in Rest/GraphQL viewer\n- Add src setting for slect and tag fields to load options from internal sources\n\n## 2.6.3 (2023-08-15)\n\n- Prevent uploading .phps + .(x)html files in assets manager\n- Require verification for updating user data\n- Support post field projection after content population (via ..{fieldname})\n- Extract width + height and colors from uploaded svg files\n- Implement HTTP caching when using response cache (via rspc parameter)\n- Resolve `{field}:locale` in filter and sort parameters\n- Optimize icon font size\n- Add missing meta fields to GraphQL model definitions @filipmiik\n- Fix long text expanding grid items\n\n## 2.6.2 (2023-07-31)\n\n- Add video frame preview (assets manager)\n- Fix `$not` for MongoLite\n- Add `app.system.install` event trigger on initial installation\n- Add support for closing dialogs via `Escape`\n- Add cached modules loading\n- Update icon font\n- Fix global error handler when using spaces\n- Auto map :{space}/storage/* to .spaces/{space}/storage/* (Apache)\n\n## 2.6.1 (2023-06-24)\n\n- Fix api token checking\n\n## 2.6.0 (2023-06-21)\n\n- Try to auto-generate meaningful linked content preview if display setting is missing\n- Update Vue to v3.3.4\n- Add missing permission settings @raffaelj\n- Improve role permissions UI\n- Show locale value picker only if multiple locales are available\n- Use `crypto.randomUUID()` only if available\n- Populate only allowed models in content api (thanks @Ccamm)\n- Fix possible content `models` permission naming collision (thanks @raffaelj)\n- Fix internal content find/populate api exposing data to users without required rights (thanks @raffaelj)\n- Fix empty settings screen\n- Add csrf token validation to internal api calls to improve security (thanks @Ccamm)\n- Add clone functionality to tree content items\n- Add additional checks to `/api/system/healthcheck`\n- Fix disabling asset picker in wysiwyg field\n- Improve fields projection (eg nested fields) when using MongoLite as data storage\n- Use AG Grid instead of Tabulator.js as a foundation for the table field\n- Limit number of files to upload in admin ui based on php setting `max_file_uploads`\n\n## 2.5.2 (2023-05-18)\n\n- Fix link content item dialog\n- Update vendor libs\n\n## 2.5.1 (2023-05-15)\n\n- Fix js error thrown in dialog component\n- Remove 2FA info from internal users/load api\n- Update icons\n- Minor UI improvements\n- add `content.remove.before` event\n- Refactor `kiss-popoutmenu` component to `kiss-popout`\n- Introduce `user-info` component\n- Update Vue to v3.3.2\n- Update vendor libs\n\n## 2.5.0 (2023-04-15)\n\n- Fix initial item position on tree item creation\n- Add avif image type support (depending on used GD lib)\n- Add experimental natural language to mongo query support (only for admin ui filtering collection items and assets)\n- Add lightweight indexing library (for full-text search)\n- Make logged login data configurable\n- Add filter models feature on role permission page\n- Fix populate option singleton data queries via GraphQL\n- Clone / duplicate collection items\n- Refactor admin ui language loading\n- Add `content:field:remove` and `content:field:rename` tower cli commands to cleanup content data after model changes\n\n\n## 2.4.1 (2023-03-20)\n\n- Add field preview renderer for boolen field\n- Fix tag field\n- Add display meta property support for tree content models\n- Add active property to field-nav items\n- Add additional security check when uploading files\n- Fix assets image cache check\n- Add thumbnail api usage to internal bucket storage file previews\n- Improve revisions display performance\n\n## 2.4.0 (2023-03-08)\n\n- Add additional security check editing php files in finder\n- Fix base64 encoding data not in latin char range\n- Add internal bucket storage container feature\n- Add /content/tree/{model} api endpoint\n- Batch edit content items\n- Update vendor libs\n\n## 2.3.9 (2023-02-13)\n\n- Fix batch state update (when using MongoLite) #75\n- Fix min/max settings for number fields #76\n- Set X-Frame-Options to prevent possible clickjacking via iframe layer\n- Allow to load linked content items in display previews #78\n- Allow to load thumbnails from linked assets in display previews\n\n## 2.3.8 (2023-02-04)\n\n- Fix not allowed user role modification by intercepting request\n- Fix tree item view #72\n- Update Vue to v3.2.47\n- Improve svg loading for <kiss-svg /> elements\n- Update vendor libs\n\n## 2.3.7 (2023-01-31)\n\n- Batch update collection items state\n- Add state filter to collection items view\n- Fix possible infinite content population loop\n- Fix filter option for collection link field\n- Add content view aside event triggers\n- Deep clone data object for preview interpolation\n- Update vendor libs\n\n## 2.3.6 (2023-01-03)\n\n- Fix tree model nesting items\n- Fix table preview for repeatable wysiwyg fields\n- Fix clearing readonly fields\n- Fix filter option for collection link field\n- Update vendor libs\n\n## 2.3.5 (2022-12-15)\n\n- Fix getallheaders keys\n- Improve assets api error message on missing parameters\n- Add placeholder container if empty nav field\n- Add autofocus to app search field on show\n- Add current locale context to fields in fields renderer component\n- Invalidate opcache for edited php files via finder\n- Remove avif support due to unpredictable server configurations\n- Fix PHP 8.2 related issues\n- Fix `maxlevel` meta property if value is 0\n- Define default sorting of items in collection model meta settings\n- Auto-resolve $DATE() values in db queries\n\n## 2.3.4 (2022-11-25)\n\n- Fix user settings updating for users without admin role\n- Update vendor libs\n- Update Vue to 3.2.45\n- Cache loaded icons in admin view\n- Add drag'n drop upload of files support (finder module)\n- Fix cross-origin error (content previews) @isemog\n\n## 2.3.3 (2022-11-02)\n\n- Add ESC + auto focus support for dialogs\n- Update Vue to 3.2.41\n- Add finder module (only for super admin users)\n- Set default value to false for boolean fields\n- Update vendor libs\n\n## 2.3.2 (2022-10-24)\n\n- Add clear cache action\n- Fix spaces load error if spaces folder does not exists\n\n\n## 2.3.1 (2022-10-21)\n\n- Fix return type for Utils::parseSize\n- Update Uppy.js to v3.0.1\n- Resolve nested linked content items on content item population\n- Auto-populate content item for content previews\n- Fix response cache\n- Fix time field error (list option)\n- Refactor CORS preflight handling\n- Add spaces feature (beta)\n\n## 2.3.0 (2022-09-16)\n\n- Update vendor libs\n- Fix field-object js error\n- Don't apply default content fields on update (saveItem)\n- Fix GraphQL error when numeric field names are used\n- Fix wysiwyg field (Safari) #24\n- Fix enter on selected result in app search\n- Update Vue to 3.2.39\n- Improve custom api endpoint resolving\n- Fix updating items via API #27 @o-\n\n\n## 2.2.2 (2022-08-20)\n\n- Add `./tower app:update` cli command to update Cockpit to the latest or specific version\n- Fix exposing 2FA secret in JWT token on login\n- Enable keyboard navigation in search modal #14 @raffaelj\n- Prevent double loading of field-code.js #15 @raffaelj\n- Fix 2fa for login modal #13 @raffaelj\n\n## 2.2.1 (2022-08-10)\n\n- Fix linked tree content item display resolver\n- Refactor content models index page\n\n## 2.2.0 (2022-08-08)\n\n- Add create|update|delete endpoints content item to REST API\n- Add GraphQL mutation saveContentItem to create|update content items\n- Add GraphQL mutation deleteContentItem to delete content items\n- Add app side panel (admin layout)\n- Stop execution of code after redirecting\n\n## 2.1.2 (2022-08-04)\n\n- \ud83d\udea8 Fix typo field-contentItemtLink -> Need to re-assign field type contentItemLink \ud83d\udea8\n- General cleanup + fix typos\n- Add content tree items reorder permission\n- Refactor app layout header\n- Show more detailed error message if saving user settings fail\n- Hide publish state configuration ui if missing permission to mange publish state\n- Fix selected item link of tree model\n- Fix missing assets folders permission checks\n\n## 2.1.1 (2022-08-02)\n\n- Fix tree model route in app search results\n- Fix loosing nested level on saving tree item\n\n## 2.1.0 (2022-08-01)\n\n- Add initial global app search implementation (alt|option + f)\n- Minor fixes on closing html tag + uninitialized variable #11 @remluben\n- Update lib/vendor\n- Update vendor assets sortablejs v1.15, uppy v2.13.1, tinyMCE v6.1.2\n- Add model type tree - organize content items as tree\n\n## 2.0.2 (2022-07-20)\n\n- Fix select boxes in dark theme (chrome on windows) #8\n- Change login (noun) to log in (verb)\n- Fix required field check on nested repeatable items\n- Enable picking item by clicking on empty placeholder area (Asset + Content Link field)\n- Open api playground with preselected api key\n- Enable clear field function also in nested fields\n- Make fields-manger + fields-renderer component available by default\n- Set content model icon\n\n## 2.0.1 (2022-07-17)\n\n- Refactor admin ui localization\n- Object.freeze App._vars + App._paths\n- Make logged in user information available on the client side (App.user)\n- Update .htaccess file to deny public access to php files except router entry index.php\n- Add visual hover state to content item tables\n\n## 2.0.0 (2022-07-13)\n\n- Initial release \ud83c\udf7e\ud83e\udd73", "<?php\n\nfunction hasSQLiteSupport() {\n    try {\n\n        if (extension_loaded('pdo')) {\n            $test = new PDO('sqlite::memory:');\n            return true;\n        }\n\n    } catch (Exception $e) {}\n\n    return false;\n}\n\nfunction ensureWritableStorageFolder($path) {\n    try {\n        $dir = __DIR__.'/../storage'.$path;\n        if (!file_exists($dir)) {\n            mkdir($dir, 0700, true);\n            if ($path === '/data') {\n                if (file_put_contents($dir.'/.htaccess', 'deny from all') === false) {\n                    return false;\n                }\n            }\n        }\n        return is_writable($dir);\n    } catch (Exception $e) {\n        error_log($e);\n        return false;\n    }\n}\n\n// misc checks\n$checks = array(\n    'Php version >= 8.1.0'                              => (version_compare(PHP_VERSION, '8.1.0') >= 0),\n    'Missing PDO extension with Sqlite support'         => hasSQLiteSupport(),\n    'Curl extension not available'                      => extension_loaded('curl'),\n    'Fileinfo extension not available'                  => extension_loaded('fileinfo'),\n    'GD extension not available'                        => extension_loaded('gd'),\n    'OpenSSL extension not available'                   => extension_loaded('openssl'),\n    'Data folder is not writable: /storage/data'        => ensureWritableStorageFolder('/data'),\n    'Cache folder is not writable: /storage/cache'      => ensureWritableStorageFolder('/cache'),\n    'Temp folder is not writable: /storage/tmp'         => ensureWritableStorageFolder('/tmp'),\n    'Thumbs folder is not writable: /storage/thumbs'    => ensureWritableStorageFolder('/thumbs'),\n    'Uploads folder is not writable: /storage/uploads'  => ensureWritableStorageFolder('/uploads'),\n);\n\n$failed = [];\n\nforeach ($checks as $info => $check) {\n    if (!$check) $failed[] = $info;\n}\n\n$APP_SPACE_DIR = dirname(__DIR__);\n$APP_SPACE = null;\n\n// support ?space=myenv to install custom cockpit instance from /.spaces/*\nif (isset($_GET['space']) && $_GET['space']) {\n\n    $APP_SPACE = $_GET['space'];\n    $spaceDir  = $APP_SPACE_DIR.\"/.spaces/{$APP_SPACE}\";\n\n    if (!file_exists($spaceDir)) {\n        $failed[] = \"Space :{$APP_SPACE}: does not exist!\";\n    } else {\n        $APP_SPACE_DIR = $spaceDir;\n    }\n}\n\nif (!count($failed)) {\n\n    if (!class_exists('Cockpit')) {\n        include (__DIR__.'/../bootstrap.php');\n    }\n\n    $app = Cockpit::instance($APP_SPACE_DIR, [\n        'app_space' => $APP_SPACE\n    ]);\n\n    // check whether cockpit is already installed\n    try {\n\n        if ($app->dataStorage->getCollection('system/users')->count()) {\n\n            header('Location: ../'.($APP_SPACE ? \":{$APP_SPACE}\" : \"\"));\n            exit;\n        }\n\n        $created = time();\n\n        $user = [\n            'active' => true,\n            'user' => 'admin',\n            'name' => 'Admin',\n            'email' => 'admin@admin.com',\n            'password' => $app->hash('admin'),\n            'i18n' => 'en',\n            'role' => 'admin',\n            'theme' => 'auto',\n            '_modified' => $created,\n            '_created' => $created\n        ];\n\n        $app->dataStorage->save('system/users', $user);\n        $app->trigger('app.system.install');\n\n    } catch(Throwable $e) {\n\n        $failed[] = $e->getMessage();\n\n    }\n\n}\n\n?><!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>System installation</title>\n    <link rel=\"icon\" type=\"image/png\" href=\"../favicon.png\">\n    <link href=\"../modules/App/assets/css/app.css\" type=\"text/css\" rel=\"stylesheet\">\n    <script src=\"../modules/App/assets/vendor/kiss/lib.js\" type=\"module\"></script>\n    <style>\n\n        .install-card {\n            box-shadow: 0 2.8px 2.2px rgba(0, 0, 0, 0.034), 0 6.7px 5.3px rgba(0, 0, 0, 0.048), 0 12.5px 10px rgba(0, 0, 0, 0.06), 0 22.3px 17.9px rgba(0, 0, 0, 0.072), 0 41.8px 33.4px rgba(0, 0, 0, 0.086), 0 100px 80px rgba(0, 0, 0, 0.12);\n            border-radius: 4px;\n            overflow: hidden;\n            width: 450px;\n        }\n    </style>\n    <script>\n        document.documentElement.setAttribute('data-theme', getComputedStyle(document.documentElement).getPropertyValue(\"--app-auto-theme\").trim());\n    </script>\n</head>\n<body class=\"kiss-flex kiss-flex-center kiss-flex-middle\">\n\n\n    <kiss-container class=\"install-container\">\n\n        <kiss-card class=\"install-card kiss-padding-large animated <?=(count($failed) ? 'bounceInDown':'pulse')?>\" theme=\"shadowed contrast\">\n\n            <div>\n                <div class=\"kiss-flex kiss-margin\">\n                    <div class=\"kiss-margin-right\">\n                        <img src=\"../modules/App/assets/logo.svg\" width=\"30\" height=\"30\"alt=\"logo\">\n                    </div>\n                    <div class=\"kiss-flex-1 kiss-size-xsmall\">\n                        <strong>Cockpit</strong>\n                        <div class=\"kiss-color-muted\">Content Platform</div>\n                    </div>\n                </div>\n\n                <hr class=\"kiss-margin-large-bottom\">\n\n                <?php if (count($failed)): ?>\n\n                    <h1 class=\"kiss-size-3\">\n                        <icon class=\"kiss-color-danger kiss-margin-small-right\" size=\"larger\">block</icon>\n                        Installation failed\n                    </h1>\n\n                    <kiss-card class=\"kiss-padding kiss-bgcolor-contrast kiss-flex kiss-flex-column kiss-margin\">\n\n                        <div class=\"kiss-text-caption kiss-text-bold kiss-color-muted kiss-margin-small\">Reasons:</div>\n\n                        <?php foreach ($failed as $info): ?>\n                        <div class=\"kiss-text-monospace kiss-margin-small kiss-flex\">\n                            <span>\ud83d\udd25</span><div class=\"kiss-flex-1 kiss-size-small kiss-margin-small-left\"><?=$info?></div>\n                        </div>\n                        <?php endforeach; ?>\n\n                    </kiss-card>\n\n                    <div class=\"kiss-margin-large-bottom kiss-color-muted\">\n                        Please try to fix the errors and retry the installation.\n                    </div>\n\n                    <div class=\"kiss-margin-large\">\n                        <a class=\"kiss-button kiss-width-1-1\" href=\"?<?=implode('&', [time(), ($APP_SPACE ? \"space={$APP_SPACE}\" : \"\")])?>\">Retry installation</a>\n                    </div>\n\n                <?php else: ?>\n\n                    <h1 class=\"kiss-size-3\">\n                        <icon class=\"kiss-color-success kiss-margin-small-right\" size=\"larger\">verified</icon>\n                        Installation completed\n                    </h1>\n\n                    <div class=\"kiss-text-caption kiss-text-bold kiss-color-muted kiss-margin\">Next step:</div>\n\n                    <div class=\"kiss-margin\">Please login into Cockpit using the following credentials:</div>\n\n                    <kiss-card class=\"kiss-text-monospace kiss-padding kiss-bgcolor-contrast kiss-flex kiss-flex-column kiss-margin\">\n                        <div><icon class=\"kiss-color-muted kiss-margin-right\" size=\"larger\">person</icon>admin</div>\n                        <div><icon class=\"kiss-color-muted kiss-margin-right\" size=\"larger\">key</icon>admin</div>\n                    </kiss-card>\n\n                    <div class=\"kiss-margin-large-bottom kiss-color-muted\">\n                        Don't forget to change the credentials after your initial login to prevent bad things from bad people.\n                    </div>\n\n                    <div class=\"kiss-margin-large\">\n                        <a class=\"kiss-button kiss-button-primary kiss-width-1-1\" href=\"../<?=($APP_SPACE ? \":{$APP_SPACE}\" : \"\")?>\" class=\"uk-button uk-button-large uk-button-primary uk-button-outline uk-width-1-1\">Login now</a>\n                    </div>\n\n                <?php endif; ?>\n\n            </div>\n\n        </kiss-card>\n\n    </kiss-container>\n\n</body>\n</html>\n"], "fixing_code": ["# Release Notes\n\n## WIP\n\n- Fix mime type detection on asset upload\n- Fix possible Cross-site Scripting (XSS) in Rest/GraphQL viewer\n- Add src setting for slect and tag fields to load options from internal sources\n- Sanitize space name during installation\n\n## 2.6.3 (2023-08-15)\n\n- Prevent uploading .phps + .(x)html files in assets manager\n- Require verification for updating user data\n- Support post field projection after content population (via ..{fieldname})\n- Extract width + height and colors from uploaded svg files\n- Implement HTTP caching when using response cache (via rspc parameter)\n- Resolve `{field}:locale` in filter and sort parameters\n- Optimize icon font size\n- Add missing meta fields to GraphQL model definitions @filipmiik\n- Fix long text expanding grid items\n\n## 2.6.2 (2023-07-31)\n\n- Add video frame preview (assets manager)\n- Fix `$not` for MongoLite\n- Add `app.system.install` event trigger on initial installation\n- Add support for closing dialogs via `Escape`\n- Add cached modules loading\n- Update icon font\n- Fix global error handler when using spaces\n- Auto map :{space}/storage/* to .spaces/{space}/storage/* (Apache)\n\n## 2.6.1 (2023-06-24)\n\n- Fix api token checking\n\n## 2.6.0 (2023-06-21)\n\n- Try to auto-generate meaningful linked content preview if display setting is missing\n- Update Vue to v3.3.4\n- Add missing permission settings @raffaelj\n- Improve role permissions UI\n- Show locale value picker only if multiple locales are available\n- Use `crypto.randomUUID()` only if available\n- Populate only allowed models in content api (thanks @Ccamm)\n- Fix possible content `models` permission naming collision (thanks @raffaelj)\n- Fix internal content find/populate api exposing data to users without required rights (thanks @raffaelj)\n- Fix empty settings screen\n- Add csrf token validation to internal api calls to improve security (thanks @Ccamm)\n- Add clone functionality to tree content items\n- Add additional checks to `/api/system/healthcheck`\n- Fix disabling asset picker in wysiwyg field\n- Improve fields projection (eg nested fields) when using MongoLite as data storage\n- Use AG Grid instead of Tabulator.js as a foundation for the table field\n- Limit number of files to upload in admin ui based on php setting `max_file_uploads`\n\n## 2.5.2 (2023-05-18)\n\n- Fix link content item dialog\n- Update vendor libs\n\n## 2.5.1 (2023-05-15)\n\n- Fix js error thrown in dialog component\n- Remove 2FA info from internal users/load api\n- Update icons\n- Minor UI improvements\n- add `content.remove.before` event\n- Refactor `kiss-popoutmenu` component to `kiss-popout`\n- Introduce `user-info` component\n- Update Vue to v3.3.2\n- Update vendor libs\n\n## 2.5.0 (2023-04-15)\n\n- Fix initial item position on tree item creation\n- Add avif image type support (depending on used GD lib)\n- Add experimental natural language to mongo query support (only for admin ui filtering collection items and assets)\n- Add lightweight indexing library (for full-text search)\n- Make logged login data configurable\n- Add filter models feature on role permission page\n- Fix populate option singleton data queries via GraphQL\n- Clone / duplicate collection items\n- Refactor admin ui language loading\n- Add `content:field:remove` and `content:field:rename` tower cli commands to cleanup content data after model changes\n\n\n## 2.4.1 (2023-03-20)\n\n- Add field preview renderer for boolen field\n- Fix tag field\n- Add display meta property support for tree content models\n- Add active property to field-nav items\n- Add additional security check when uploading files\n- Fix assets image cache check\n- Add thumbnail api usage to internal bucket storage file previews\n- Improve revisions display performance\n\n## 2.4.0 (2023-03-08)\n\n- Add additional security check editing php files in finder\n- Fix base64 encoding data not in latin char range\n- Add internal bucket storage container feature\n- Add /content/tree/{model} api endpoint\n- Batch edit content items\n- Update vendor libs\n\n## 2.3.9 (2023-02-13)\n\n- Fix batch state update (when using MongoLite) #75\n- Fix min/max settings for number fields #76\n- Set X-Frame-Options to prevent possible clickjacking via iframe layer\n- Allow to load linked content items in display previews #78\n- Allow to load thumbnails from linked assets in display previews\n\n## 2.3.8 (2023-02-04)\n\n- Fix not allowed user role modification by intercepting request\n- Fix tree item view #72\n- Update Vue to v3.2.47\n- Improve svg loading for <kiss-svg /> elements\n- Update vendor libs\n\n## 2.3.7 (2023-01-31)\n\n- Batch update collection items state\n- Add state filter to collection items view\n- Fix possible infinite content population loop\n- Fix filter option for collection link field\n- Add content view aside event triggers\n- Deep clone data object for preview interpolation\n- Update vendor libs\n\n## 2.3.6 (2023-01-03)\n\n- Fix tree model nesting items\n- Fix table preview for repeatable wysiwyg fields\n- Fix clearing readonly fields\n- Fix filter option for collection link field\n- Update vendor libs\n\n## 2.3.5 (2022-12-15)\n\n- Fix getallheaders keys\n- Improve assets api error message on missing parameters\n- Add placeholder container if empty nav field\n- Add autofocus to app search field on show\n- Add current locale context to fields in fields renderer component\n- Invalidate opcache for edited php files via finder\n- Remove avif support due to unpredictable server configurations\n- Fix PHP 8.2 related issues\n- Fix `maxlevel` meta property if value is 0\n- Define default sorting of items in collection model meta settings\n- Auto-resolve $DATE() values in db queries\n\n## 2.3.4 (2022-11-25)\n\n- Fix user settings updating for users without admin role\n- Update vendor libs\n- Update Vue to 3.2.45\n- Cache loaded icons in admin view\n- Add drag'n drop upload of files support (finder module)\n- Fix cross-origin error (content previews) @isemog\n\n## 2.3.3 (2022-11-02)\n\n- Add ESC + auto focus support for dialogs\n- Update Vue to 3.2.41\n- Add finder module (only for super admin users)\n- Set default value to false for boolean fields\n- Update vendor libs\n\n## 2.3.2 (2022-10-24)\n\n- Add clear cache action\n- Fix spaces load error if spaces folder does not exists\n\n\n## 2.3.1 (2022-10-21)\n\n- Fix return type for Utils::parseSize\n- Update Uppy.js to v3.0.1\n- Resolve nested linked content items on content item population\n- Auto-populate content item for content previews\n- Fix response cache\n- Fix time field error (list option)\n- Refactor CORS preflight handling\n- Add spaces feature (beta)\n\n## 2.3.0 (2022-09-16)\n\n- Update vendor libs\n- Fix field-object js error\n- Don't apply default content fields on update (saveItem)\n- Fix GraphQL error when numeric field names are used\n- Fix wysiwyg field (Safari) #24\n- Fix enter on selected result in app search\n- Update Vue to 3.2.39\n- Improve custom api endpoint resolving\n- Fix updating items via API #27 @o-\n\n\n## 2.2.2 (2022-08-20)\n\n- Add `./tower app:update` cli command to update Cockpit to the latest or specific version\n- Fix exposing 2FA secret in JWT token on login\n- Enable keyboard navigation in search modal #14 @raffaelj\n- Prevent double loading of field-code.js #15 @raffaelj\n- Fix 2fa for login modal #13 @raffaelj\n\n## 2.2.1 (2022-08-10)\n\n- Fix linked tree content item display resolver\n- Refactor content models index page\n\n## 2.2.0 (2022-08-08)\n\n- Add create|update|delete endpoints content item to REST API\n- Add GraphQL mutation saveContentItem to create|update content items\n- Add GraphQL mutation deleteContentItem to delete content items\n- Add app side panel (admin layout)\n- Stop execution of code after redirecting\n\n## 2.1.2 (2022-08-04)\n\n- \ud83d\udea8 Fix typo field-contentItemtLink -> Need to re-assign field type contentItemLink \ud83d\udea8\n- General cleanup + fix typos\n- Add content tree items reorder permission\n- Refactor app layout header\n- Show more detailed error message if saving user settings fail\n- Hide publish state configuration ui if missing permission to mange publish state\n- Fix selected item link of tree model\n- Fix missing assets folders permission checks\n\n## 2.1.1 (2022-08-02)\n\n- Fix tree model route in app search results\n- Fix loosing nested level on saving tree item\n\n## 2.1.0 (2022-08-01)\n\n- Add initial global app search implementation (alt|option + f)\n- Minor fixes on closing html tag + uninitialized variable #11 @remluben\n- Update lib/vendor\n- Update vendor assets sortablejs v1.15, uppy v2.13.1, tinyMCE v6.1.2\n- Add model type tree - organize content items as tree\n\n## 2.0.2 (2022-07-20)\n\n- Fix select boxes in dark theme (chrome on windows) #8\n- Change login (noun) to log in (verb)\n- Fix required field check on nested repeatable items\n- Enable picking item by clicking on empty placeholder area (Asset + Content Link field)\n- Open api playground with preselected api key\n- Enable clear field function also in nested fields\n- Make fields-manger + fields-renderer component available by default\n- Set content model icon\n\n## 2.0.1 (2022-07-17)\n\n- Refactor admin ui localization\n- Object.freeze App._vars + App._paths\n- Make logged in user information available on the client side (App.user)\n- Update .htaccess file to deny public access to php files except router entry index.php\n- Add visual hover state to content item tables\n\n## 2.0.0 (2022-07-13)\n\n- Initial release \ud83c\udf7e\ud83e\udd73", "<?php\n\nfunction hasSQLiteSupport() {\n    try {\n\n        if (extension_loaded('pdo')) {\n            $test = new PDO('sqlite::memory:');\n            return true;\n        }\n\n    } catch (Exception $e) {}\n\n    return false;\n}\n\nfunction ensureWritableStorageFolder($path) {\n    try {\n        $dir = __DIR__.'/../storage'.$path;\n        if (!file_exists($dir)) {\n            mkdir($dir, 0700, true);\n            if ($path === '/data') {\n                if (file_put_contents($dir.'/.htaccess', 'deny from all') === false) {\n                    return false;\n                }\n            }\n        }\n        return is_writable($dir);\n    } catch (Exception $e) {\n        error_log($e);\n        return false;\n    }\n}\n\n// misc checks\n$checks = array(\n    'Php version >= 8.1.0'                              => (version_compare(PHP_VERSION, '8.1.0') >= 0),\n    'Missing PDO extension with Sqlite support'         => hasSQLiteSupport(),\n    'Curl extension not available'                      => extension_loaded('curl'),\n    'Fileinfo extension not available'                  => extension_loaded('fileinfo'),\n    'GD extension not available'                        => extension_loaded('gd'),\n    'OpenSSL extension not available'                   => extension_loaded('openssl'),\n    'Data folder is not writable: /storage/data'        => ensureWritableStorageFolder('/data'),\n    'Cache folder is not writable: /storage/cache'      => ensureWritableStorageFolder('/cache'),\n    'Temp folder is not writable: /storage/tmp'         => ensureWritableStorageFolder('/tmp'),\n    'Thumbs folder is not writable: /storage/thumbs'    => ensureWritableStorageFolder('/thumbs'),\n    'Uploads folder is not writable: /storage/uploads'  => ensureWritableStorageFolder('/uploads'),\n);\n\n$failed = [];\n\nforeach ($checks as $info => $check) {\n    if (!$check) $failed[] = $info;\n}\n\n$APP_SPACE_DIR = dirname(__DIR__);\n$APP_SPACE = null;\n\n// support ?space=myenv to install custom cockpit instance from /.spaces/*\nif (isset($_GET['space']) && $_GET['space']) {\n\n    $APP_SPACE = preg_replace('/[^a-z0-9\\-_]/', '', $_GET['space']);\n    $spaceDir  = $APP_SPACE_DIR.\"/.spaces/{$APP_SPACE}\";\n\n    if (!file_exists($spaceDir)) {\n        $failed[] = \"Space :{$APP_SPACE}: does not exist!\";\n    } else {\n        $APP_SPACE_DIR = $spaceDir;\n    }\n}\n\nif (!count($failed)) {\n\n    if (!class_exists('Cockpit')) {\n        include (__DIR__.'/../bootstrap.php');\n    }\n\n    $app = Cockpit::instance($APP_SPACE_DIR, [\n        'app_space' => $APP_SPACE\n    ]);\n\n    // check whether cockpit is already installed\n    try {\n\n        if ($app->dataStorage->getCollection('system/users')->count()) {\n\n            header('Location: ../'.($APP_SPACE ? \":{$APP_SPACE}\" : \"\"));\n            exit;\n        }\n\n        $created = time();\n\n        $user = [\n            'active' => true,\n            'user' => 'admin',\n            'name' => 'Admin',\n            'email' => 'admin@admin.com',\n            'password' => $app->hash('admin'),\n            'i18n' => 'en',\n            'role' => 'admin',\n            'theme' => 'auto',\n            '_modified' => $created,\n            '_created' => $created\n        ];\n\n        $app->dataStorage->save('system/users', $user);\n        $app->trigger('app.system.install');\n\n    } catch(Throwable $e) {\n\n        $failed[] = $e->getMessage();\n\n    }\n\n}\n\n?><!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>System installation</title>\n    <link rel=\"icon\" type=\"image/png\" href=\"../favicon.png\">\n    <link href=\"../modules/App/assets/css/app.css\" type=\"text/css\" rel=\"stylesheet\">\n    <script src=\"../modules/App/assets/vendor/kiss/lib.js\" type=\"module\"></script>\n    <style>\n\n        .install-card {\n            box-shadow: 0 2.8px 2.2px rgba(0, 0, 0, 0.034), 0 6.7px 5.3px rgba(0, 0, 0, 0.048), 0 12.5px 10px rgba(0, 0, 0, 0.06), 0 22.3px 17.9px rgba(0, 0, 0, 0.072), 0 41.8px 33.4px rgba(0, 0, 0, 0.086), 0 100px 80px rgba(0, 0, 0, 0.12);\n            border-radius: 4px;\n            overflow: hidden;\n            width: 450px;\n        }\n    </style>\n    <script>\n        document.documentElement.setAttribute('data-theme', getComputedStyle(document.documentElement).getPropertyValue(\"--app-auto-theme\").trim());\n    </script>\n</head>\n<body class=\"kiss-flex kiss-flex-center kiss-flex-middle\">\n\n\n    <kiss-container class=\"install-container\">\n\n        <kiss-card class=\"install-card kiss-padding-large animated <?=(count($failed) ? 'bounceInDown':'pulse')?>\" theme=\"shadowed contrast\">\n\n            <div>\n                <div class=\"kiss-flex kiss-margin\">\n                    <div class=\"kiss-margin-right\">\n                        <img src=\"../modules/App/assets/logo.svg\" width=\"30\" height=\"30\"alt=\"logo\">\n                    </div>\n                    <div class=\"kiss-flex-1 kiss-size-xsmall\">\n                        <strong>Cockpit</strong>\n                        <div class=\"kiss-color-muted\">Content Platform</div>\n                    </div>\n                </div>\n\n                <hr class=\"kiss-margin-large-bottom\">\n\n                <?php if (count($failed)): ?>\n\n                    <h1 class=\"kiss-size-3\">\n                        <icon class=\"kiss-color-danger kiss-margin-small-right\" size=\"larger\">block</icon>\n                        Installation failed\n                    </h1>\n\n                    <kiss-card class=\"kiss-padding kiss-bgcolor-contrast kiss-flex kiss-flex-column kiss-margin\">\n\n                        <div class=\"kiss-text-caption kiss-text-bold kiss-color-muted kiss-margin-small\">Reasons:</div>\n\n                        <?php foreach ($failed as $info): ?>\n                        <div class=\"kiss-text-monospace kiss-margin-small kiss-flex\">\n                            <span>\ud83d\udd25</span><div class=\"kiss-flex-1 kiss-size-small kiss-margin-small-left\"><?=$info?></div>\n                        </div>\n                        <?php endforeach; ?>\n\n                    </kiss-card>\n\n                    <div class=\"kiss-margin-large-bottom kiss-color-muted\">\n                        Please try to fix the errors and retry the installation.\n                    </div>\n\n                    <div class=\"kiss-margin-large\">\n                        <a class=\"kiss-button kiss-width-1-1\" href=\"?<?=implode('&', [time(), ($APP_SPACE ? \"space={$APP_SPACE}\" : \"\")])?>\">Retry installation</a>\n                    </div>\n\n                <?php else: ?>\n\n                    <h1 class=\"kiss-size-3\">\n                        <icon class=\"kiss-color-success kiss-margin-small-right\" size=\"larger\">verified</icon>\n                        Installation completed\n                    </h1>\n\n                    <div class=\"kiss-text-caption kiss-text-bold kiss-color-muted kiss-margin\">Next step:</div>\n\n                    <div class=\"kiss-margin\">Please login into Cockpit using the following credentials:</div>\n\n                    <kiss-card class=\"kiss-text-monospace kiss-padding kiss-bgcolor-contrast kiss-flex kiss-flex-column kiss-margin\">\n                        <div><icon class=\"kiss-color-muted kiss-margin-right\" size=\"larger\">person</icon>admin</div>\n                        <div><icon class=\"kiss-color-muted kiss-margin-right\" size=\"larger\">key</icon>admin</div>\n                    </kiss-card>\n\n                    <div class=\"kiss-margin-large-bottom kiss-color-muted\">\n                        Don't forget to change the credentials after your initial login to prevent bad things from bad people.\n                    </div>\n\n                    <div class=\"kiss-margin-large\">\n                        <a class=\"kiss-button kiss-button-primary kiss-width-1-1\" href=\"../<?=($APP_SPACE ? \":{$APP_SPACE}\" : \"\")?>\" class=\"uk-button uk-button-large uk-button-primary uk-button-outline uk-width-1-1\">Login now</a>\n                    </div>\n\n                <?php endif; ?>\n\n            </div>\n\n        </kiss-card>\n\n    </kiss-container>\n\n</body>\n</html>\n"], "filenames": ["CHANGELOG.md", "install/index.php"], "buggy_code_start_loc": [7, 61], "buggy_code_end_loc": [7, 62], "fixing_code_start_loc": [8, 61], "fixing_code_end_loc": [9, 62], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Reflected in GitHub repository cockpit-hq/cockpit prior to 2.6.4.", "other": {"cve": {"id": "CVE-2023-4451", "sourceIdentifier": "security@huntr.dev", "published": "2023-08-20T15:15:29.760", "lastModified": "2023-08-24T20:31:44.960", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Reflected in GitHub repository cockpit-hq/cockpit prior to 2.6.4."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:agentejo:cockpit:*:*:*:*:*:*:*:*", "versionEndIncluding": "2.6.3", "matchCriteriaId": "DB13440F-5FAF-437B-A4EF-47CA96DB8FC4"}]}]}], "references": [{"url": "https://github.com/cockpit-hq/cockpit/commit/30609466c817e39f9de1871559603e93cd4d0d0c", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/4e111c3e-6cf3-4b4c-b3c1-a540bf30f8fa", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/cockpit-hq/cockpit/commit/30609466c817e39f9de1871559603e93cd4d0d0c"}}