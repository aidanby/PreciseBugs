{"buggy_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsApplicationsPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Notifications.Code.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsApplicationsPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>7243fde7-c9c7-4d40-bd63-8f0938d9d6cf</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>'use strict';\n/**\n * Start the real script.\n */\nrequire(['jquery', 'xwiki-meta', 'ApplicationWidget', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($, xm, ApplicationWidget) {\n\n  /**\n   * Page initialization\n   */\n  var preferenceInit = function (event) {\n\n    var applications = [];\n    if (event.data &amp;&amp; event.data.elements) {\n      var container = $(event.data.elements);\n    } else {\n      var container = $(document);\n    }\n\n    // Create application widgets\n    container.find('.applicationElem').each(function() {\n      applications.push(new ApplicationWidget($(this)));\n    });\n\n    /**\n     * Save the current settings\n     */\n    var save = function() {\n      // To avoid having several requests in the same time (which could lead to error 500), we disable all the triggers during the save process\n      var toggles = $('.bootstrap-switch input');\n      toggles.bootstrapSwitch('disabled', true);\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      var data = [];\n      for (var i = 0; i &lt; applications.length; ++i) {\n        for (var j = 0; j &lt; applications[i].eventTypes.length; j++) {\n          data.push({\n            eventType: applications[i].eventTypes[j].eventType,\n            format: 'alert',\n            enabled: applications[i].eventTypes[j].getAlertState()\n          });\n          // Email might be disabled, so we don't send info about the email settings if the corresponding buttons are not there\n          if ($('.notificationTypeCell[data-format=\"email\"]').length &gt; 0) {\n            data.push({\n              eventType: applications[i].eventTypes[j].eventType,\n              format: 'email',\n              enabled: applications[i].eventTypes[j].getEmailState()\n            });\n          }\n        }\n      }\n      var target = $('.notifPreferences').attr('data-target');\n      var targetUser = \"\";\n      if (target == 'user') {\n        var targetUser = $('.notifPreferences').attr('data-user');\n      }\n      var url = \"$xwiki.getURL('XWiki.Notifications.Code.NotificationPreferenceService', 'get', 'outputSyntax=plain')\";\n      Promise.resolve($.post(url, {\n        action: 'savePreferences',\n        target: $('.notifPreferences').attr('data-target'),\n        user: targetUser,\n        json: JSON.stringify(data),\n        csrf: xm.form_token\n      })).then(function() {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saved'))\", 'done');\n      }).catch(function() {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.savingfailed'))\", 'error');\n      }).finally(function() {\n        // Enable again the triggers\n        toggles.bootstrapSwitch('disabled', false);\n      });\n    };\n\n    /**\n     * Several changes can be received very closely (for example, when several switches are updated in the same time),\n     * so we save only the last received event.\n     * For that we postpone the save action (300ms is clone enought for the user) and we cancel it if an other event\n     * happens in the meantime.\n     */\n    var nextSave = 0;\n    $($('.notifPreferences')).off('switchChange.bootstrapSwitch').on('switchChange.bootstrapSwitch', function(event, state) {\n      if (nextSave != 0) {\n        clearTimeout(nextSave);\n      }\n      nextSave = setTimeout(save, 300);\n    });\n\n    // Disable the \"loading\" screens\n    $('td.notificationTypeCell, td.notificationAppCell').each(function(){\n      $(this).find('.hidden').removeClass('hidden');\n      $(this).removeClass('loading');\n    });\n\n    /**\n     * Disable the \"loading\" screens\n     */\n    $('td.notificationTypeCell').each(function(){\n      $(this).find('&gt; div.hidden').removeClass('hidden');\n      $(this).removeClass('loading');\n    });\n\n  };\n\n  $(preferenceInit);\n  $(document).on('xwiki:dom:updated', preferenceInit)\n});\n</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>67db5954-866d-4f6f-b94a-64e1a47eaeb6</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('EventTypeWidget', ['jquery', 'xwiki-meta', 'xwiki-bootstrap-switch'], function($, xm) {\n  /**\n  * Construct an EventTypeWidget.\n  */\n  return function(domElement, application) {\n    var self               = this;\n    self.domElement        = domElement;\n    self.application       = application;\n    self.eventType         = domElement.attr('data-eventtype');\n    self.cellAlert         = domElement.find('.notificationTypeCell[data-format=\"alert\"]');\n    self.cellEmail         = domElement.find('.notificationTypeCell[data-format=\"email\"]');\n    self.switchAlert       = self.cellAlert.find('.notificationTypeCheckbox');\n    self.switchEmail       = self.cellEmail.find('.notificationTypeCheckbox');\n    self.alertObjectNumber = self.cellAlert.attr('data-objnumber');\n    self.emailObjectNumber = self.cellEmail.attr('data-objnumber');\n\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // Replace the 'hidden' class by a call to jQuery.hide();\n      self.domElement.removeClass('hidden').hide();\n      // Enable bootstrap switches\n      $([self.switchAlert, self.switchEmail]).bootstrapSwitch({\n        size: 'mini',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n    };\n\n    // On change\n    $(self.switchAlert).on('switchChange.bootstrapSwitch', function(event, state) {\n      self.application.updateSwitches();\n    });\n    $(self.switchEmail).on('switchChange.bootstrapSwitch', function(event, state) {\n      self.application.updateSwitches();\n    });\n\n    /**\n     * Get the state of the alert switch\n     */\n    self.getAlertState = function() {\n      return self.switchAlert.bootstrapSwitch('state');\n    };\n\n    /**\n     * Get the state of the email switch\n     */\n    self.getEmailState = function() {\n      return self.switchEmail.bootstrapSwitch('state');\n    };\n\n    /**\n     * Set the state of the alert switch\n     */\n    self.setAlertState = function (state) {\n      self.switchAlert.bootstrapSwitch('state', state);\n    };\n\n    /**\n     * Set the state of the email switch\n     */\n    self.setEmailState = function (state) {\n      self.switchEmail.bootstrapSwitch('state', state);\n    };\n\n    /**\n     * Hide/Show the event type widget\n     */\n    self.toggleVisibility = function () {\n      self.domElement.toggle();\n    };\n\n    // Call init\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>Event Type Widget</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>2</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>0fd09e7a-bd3b-4b56-b903-5496788f6f9b</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('ApplicationWidget', ['jquery', 'EventTypeWidget', 'xwiki-bootstrap-switch'], function($, EventTypeWidget) {\n  /**\n   * Construct an application widget.\n   */\n  return function(domElement) {\n\n    var self             = this;\n    self.domElement      = domElement;\n    self.applicationId   = domElement.attr('data-applicationid');\n    self.cellAlert       = domElement.find('.notificationAppCell[data-format=\"alert\"]');\n    self.cellEmail       = domElement.find('.notificationAppCell[data-format=\"email\"]');\n    self.switchAlert     = self.cellAlert.find('.notificationAppCheckbox');\n    self.switchEmail     = self.cellEmail.find('.notificationAppCheckbox');\n    self.collapseButton  = domElement.find('.collapseButton');\n    self.eventTypes      = [];\n\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // Creates event type widgets for this application\n      self.domElement.find('.rowEventType').each(function() {\n        self.eventTypes.push(new EventTypeWidget($(this), self));\n      });\n      // Enable bootstrap switch.\n      $([self.switchAlert, self.switchEmail]).bootstrapSwitch({\n        size: 'small',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n      // Set initial state for the switches\n      self.updateSwitches();\n      self.updateTypesOnChange = true;\n      // Handle collapsing\n      // Make sure the click listener is registered only once.\n      self.collapseButton.off('click.toggleVisibility').on('click.toggleVisibility', function() {\n        for (var i = 0; i &lt; self.eventTypes.length; ++i) {\n          self.eventTypes[i].toggleVisibility();\n        }\n      });\n\n      // Handle switch change\n      self.switchAlert.on('switchChange.bootstrapSwitch', function(event, state) {\n        for (var i = 0; i &lt; self.eventTypes.length; ++i) {\n          self.eventTypes[i].setAlertState(state);\n        }\n      });\n      self.switchEmail.on('switchChange.bootstrapSwitch', function(event, state) {\n        for (var i = 0; i &lt; self.eventTypes.length; ++i) {\n          self.eventTypes[i].setEmailState(state);\n        }\n      });\n    };\n\n    /**\n     * Set the switch states according to their event type\n     */\n    self.updateSwitches = function() {\n      var allAlertsOn = true;\n      var allAlertsOff = true;\n      var allEmailsOn = true;\n      var allEmailsOff = true;\n      for (var i = 0; i &lt; self.eventTypes.length; ++i) {\n        var eventType = self.eventTypes[i];\n        allAlertsOn  &amp;=  eventType.getAlertState();\n        allAlertsOff &amp;= !eventType.getAlertState();\n        allEmailsOn  &amp;=  eventType.getEmailState();\n        allEmailsOff &amp;= !eventType.getEmailState();\n      }\n      if (allAlertsOn) {\n        self.switchAlert.bootstrapSwitch('state', true);\n      } else if (allAlertsOff) {\n        self.switchAlert.bootstrapSwitch('state', false);\n      } else {\n        self.switchAlert.bootstrapSwitch('indeterminate', true);\n      }\n      if (allEmailsOn) {\n        self.switchEmail.bootstrapSwitch('state', true);\n      } else if (allEmailsOff) {\n        self.switchEmail.bootstrapSwitch('state', false);\n      } else {\n        self.switchEmail.bootstrapSwitch('indeterminate', true);\n      }\n    };\n\n    // Call to init()\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>Application Widget</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>e2e07b42-f423-455b-8553-c51bbe9f2092</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>.notifPreferences tbody {\n  margin-top: 2em;\n}\n.notifPreferences .appOdd {\n  background: #e5e5e5;\n}\n.notifPreferences .appEven {\n  background: #fafafa;\n}\n.notifPreferences .rowApp td, .notifPreferences .rowApp th{\n  height: 3em;\n}\n.notifPreferences th:nth-child(1) {\n  vertical-align: top;\n  width: 250px;\n}\n.notificationAppCell {\n  vertical-align: top;\n  width: 33%;\n}\n.notificationCollapseButtonCell {\n  vertical-align: top;\n  text-align: right;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>NotificationPreferencesTable</name>\n    </property>\n    <property>\n      <parse/>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>8d0d26c4-d487-4d19-b8a1-688e6e9ee7b2</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{include reference=\"XWiki.Notifications.Code.NotificationsPreferencesMacros\" /}}\n\n{{velocity}}\n#checkMacroNotificationPreferencesParameters($checkResult)\n#if ($checkResult)\n######################################################\n### CSS and JAVASCRIPTS\n######################################################\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro'))\n#set ($discard = $xwiki.ssx.use('XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro'))\n## TODO: replace by $xwiki.sswx.use() or something like this when XWIKI-12788 is closed.\n#set ($discard = $xwiki.linkx.use($services.webjars.url('bootstrap-switch', 'css/bootstrap3/bootstrap-switch.min.css'), {'type': 'text/css', 'rel': 'stylesheet'}))\n######################################################\n### GLOBALS\n######################################################\n#if ($wikimacro.parameters.target != \"wiki\")\n  #if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n    #set ($targetUserReference = $wikimacro.parameters.user)\n  #else\n    #set ($targetUser = $xcontext.userReference)\n    #set ($targetUserReference = $services.user.currentUserReference)\n  #end\n  #set ($divData = \"data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n#end\n#set ($userDoc = $xwiki.getDocument($targetUser))\n######################################################\n### MACRO CONTENT\n######################################################\n{{html clean=\"false\"}}\n&lt;div class=\"xform\"&gt;\n&lt;p class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.applications.hint'))&lt;/p&gt;\n&lt;table class=\"notifPreferences\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $divData&gt;\n  &lt;thead&gt;\n    &lt;tr&gt;\n      &lt;th scope=\"col\"&gt;$escapetool.xml($services.localization.render('notifications.settings.applications.appName'))&lt;/th&gt;\n      &lt;th scope=\"col\"&gt;$services.icon.renderHTML('bell') $escapetool.xml($services.localization.render('notifications.settings.menu'))\n        &lt;small class=\"xHint\"&gt;$services.localization.render('notifications.settings.menu.hint', [$services.icon.renderHTML('bell')])&lt;/small&gt;\n      &lt;/th&gt;\n      #set ($colsCount = 2)\n      #if ($services.notification.areEmailsEnabled())\n        &lt;th scope=\"col\"&gt;$services.icon.renderHTML('envelope') $escapetool.xml($services.localization.render('notifications.settings.email'))\n          &lt;small class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.email.hint'))&lt;/small&gt;\n        &lt;/th&gt;\n        #set ($colsCount = 3)\n      #end\n      &lt;th scope=\"col\"&gt;&lt;/th&gt;\n    &lt;/tr&gt;\n  &lt;/thead&gt;\n  ##\n  ## Display all applications\n  ##\n  #set ($appClass = \"appOdd\")\n  #foreach ($app in $apps)\n    #displayApp($app)\n  #end\n&lt;/table&gt;\n&lt;/div&gt;\n\n#**\n * Display Application\n *#\n#macro(displayApp $app)\n  #set ($type = $app[0])\n  &lt;tbody class=\"applicationElem $appClass\" data-applicationid=\"$escapetool.xml($type.applicationId)\"&gt;\n    ##\n    ## Display the application row\n    ##\n    &lt;tr&gt;\n      ## Application Name and Icon\n      &lt;th scope=\"row\"&gt;\n        $type.applicationIcon $escapetool.xml($type.applicationName)\n      &lt;/th&gt;\n      ## Alert switch\n      &lt;td class=\"notificationAppCell loading\" data-format=\"alert\"&gt;\n        &lt;input type=\"checkbox\" class=\"notificationAppCheckbox hidden\"/&gt;\n      &lt;/td&gt;\n      ## Email switch\n      #if ($services.notification.areEmailsEnabled())\n        &lt;td class=\"notificationAppCell loading\" data-format=\"email\"&gt;\n          &lt;input type=\"checkbox\" class=\"notificationAppCheckbox hidden\"/&gt;\n        &lt;/td&gt;\n      #end\n      ## Collapse button\n      &lt;td class=\"notificationCollapseButtonCell\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-default btn-sm collapseButton\"&gt;$services.icon.renderHTML('caret-down')&lt;/button&gt;\n      &lt;/td&gt;\n    &lt;/tr&gt;\n    ##\n    ## Display all events of this application\n    ##\n    #foreach($type in $app)\n      &lt;tr class=\"rowEventType hidden\" data-eventtype=\"$type.eventType\"&gt;\n        &lt;td&gt;$escapetool.xml($type.description)&lt;/td&gt;\n        #displayPreference($type, 'alert')\n        #if ($services.notification.areEmailsEnabled())\n          #displayPreference($type, 'email')\n        #end\n        &lt;td&gt;&lt;/td&gt;\n      &lt;/tr&gt;\n    #end\n  &lt;/tbody&gt;\n  #if ($appClass == 'appOdd')\n    #set ($appClass = 'appEven')\n  #else\n    #set ($appClass = 'appOdd')\n  #end\n#end\n\n#**\n * Display a preference button for an event type and a given format\n *#\n#macro(displayPreference $type $format)\n  #set ($checked = '')\n  #set ($preference = '')\n  #if (($wikimacro.parameters.target == 'wiki' &amp;&amp; $services.notification.preferences.isEventTypeEnabled($type.eventType, $format, $services.wiki.currentWikiId)) ||\n    ($wikimacro.parameters.target == 'user' &amp;&amp; $services.notification.preferences.isEventTypeEnabledForUser($type.eventType, $format, $targetUserReference)))\n    #set ($checked = 'checked=\"checked\"')\n  #end\n  &lt;td class=\"notificationTypeCell loading\" data-eventtype=\"$!escapetool.xml($type.eventType)\" data-format=\"$format\" data-filter=\"${type.filter}\"&gt;\n    &lt;div class=\"hidden\"&gt;\n      &lt;input type=\"checkbox\" class=\"notificationTypeCheckbox\" $checked/&gt;\n    &lt;/div&gt;\n  &lt;/td&gt;\n#end\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the current user about notification applications.</description>\n    </property>\n    <property>\n      <id>notificationsApplicationsPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Applications Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>9d1dfbad-5ac6-4633-82c8-e9a152e0e657</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description>Target of the macro (could be \"user\" for the current user or \"wiki\" for the current wiki)</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>79c9b6f0-e62f-493d-9be6-49a58adc9e8d</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the application preferences. This parameter is optional, only used if the target parameter is set to ##user## and default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsAutoWatchPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Notifications.Code.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsAutoWatchPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>0cc3951e-8999-4723-9d67-c6ca7a80bd3e</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require(['jquery', 'xwiki-meta'], function ($, xm) {\n  // Make sure the change listener is not added twice.\n  $(document).off('change.notificationAutoWatchMode');\n  $(document).on('change.notificationAutoWatchMode', '.notificationAutoWatchMode', function() {\n    var input = $(this);\n    var target = input.data('target') === 'wiki' ? 'wiki' : 'user';\n    var notification = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n      'notifications.settings.saving')), 'inprogress');\n    var url = new XWiki.Document('NotificationPreferenceService', 'XWiki.Notifications.Code').getURL('get',\n      'outputSyntax=plain');\n    $.post(url, {\n      action: 'setAutoWatchMode',\n      mode: input.val(),\n      target: target,\n      user: input.data('user'),\n      csrf: xm.form_token\n    }).then(() =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.saved')), 'done'));\n    }).catch(() =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.savingfailed')), 'error'));\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>Automatic Page Watching</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>bdd88a72-eb41-468f-b39f-d687f9011ba3</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{velocity}}\n#if (!$services.notification.watch.isEnabled())\n  {{warning}}\n    {{localization key=\"notifications.settings.watch.disabled\" /}}\n  {{warning}}\n#elseif (!$xcontext.userReference)\n  {{info}}\n    {{translation key=\"notifications.settings.watch.forGuest\" /}}\n  {{/info}}\n#elseif ($wikimacro.parameters.target == 'wiki' &amp;&amp; !$hasAdmin)\n  {{error}}\n    {{translation key=\"notifications.settings.error.notAdmin\" /}}\n  {{/error}}\n#elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; $wikimacro.parameters.user.class.simpleName != 'DocumentUserReference')\n  {{error}}\n    {{translation key=\"notifications.settings.error.userReferenceNotSupported\" /}}\n  {{/error}}\n#elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n  {{error}}\n    {{translation key=\"notifications.settings.error.userReferenceAdminForbidden\" parameters=\"$wikimacro.parameters.user\" /}}\n  {{/error}}\n#else\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro'))\n#if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n#else\n    #set ($targetUser = $xcontext.userReference)\n#end\n#set ($dataUser = \"\")\n#if ($wikimacro.parameters.target == 'user')\n  #set ($mode = $services.notification.watch.getAutomaticWatchMode($targetUser))\n  #set ($dataUser = \"data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n#else\n  #set ($mode = $services.notification.watch.defaultAutomaticWatchMode)\n#end\n{{html clean=\"false\"}}\n  &lt;div class=\"xform\"&gt;\n    &lt;dl&gt;\n      &lt;dt&gt;&lt;label&gt;$escapetool.xml($services.localization.render('notifications.settings.watch.autowatchmode'))&lt;/label&gt;\n      &lt;p class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.watch.autowatchmode.hint'))&lt;/p&gt;\n      &lt;/dt&gt;\n      &lt;dd&gt;\n        &lt;select class=\"notificationAutoWatchMode\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $dataUser&gt;\n          &lt;option value=\"NONE\" #if($mode == 'NONE')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.AutomaticWatchModeClass_automaticWatchMode_NONE'))&lt;/option&gt;\n          &lt;option value=\"ALL\"  #if($mode == 'ALL')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.AutomaticWatchModeClass_automaticWatchMode_ALL'))&lt;/option&gt;\n          &lt;option value=\"MAJOR\" #if($mode == 'MAJOR')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.AutomaticWatchModeClass_automaticWatchMode_MAJOR'))&lt;/option&gt;\n          &lt;option value=\"NEW\" #if($mode == 'NEW')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.AutomaticWatchModeClass_automaticWatchMode_NEW'))&lt;/option&gt;\n        &lt;/select&gt;\n      &lt;/dd&gt;\n    &lt;/dl&gt;\n  &lt;/div&gt;\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description/>\n    </property>\n    <property>\n      <id>notificationsAutoWatchPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Auto Watch Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>a6e9b8b7-bd0e-4090-b1e7-227704db0202</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description/>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>d9ad825d-7241-4cc5-8ea9-3e4fc008b8a6</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the autowatch preferences. This parameter is optional, only used if the target parameter is set to ##user## and default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsCustomFiltersPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsCustomFiltersPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>65504b94-1ba9-40c1-aab9-79fa692cc57b</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>'use strict';\n/**\n * Start the real script.\n */\nrequire(['jquery', 'AddCustomNotificationFilterPreferenceLivetable', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($, AddCustomNotificationFilterPreferenceLivetable) {\n\n  /**\n   * Page initialization\n   */\n  $(function() {\n\n    new AddCustomNotificationFilterPreferenceLivetable($('#modal-add-custom-filter-preference'), window['livetable_notificationCustomFilterPreferencesLiveTable'], $('.customFilterPreferences button.btn-addfilter'),\n      $('.customFilterPreferences').attr('data-doc-url'));\n    var initBootstrapSwitches = function () {\n      $('#notificationCustomFilterPreferencesLiveTable .notificationFilterPreferenceCheckbox, #notificationCustomFilterPreferencesLiveTable .toggleableFilterPreferenceCheckbox').bootstrapSwitch({\n        size: 'mini',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n    };\n    $(document).on('xwiki:livetable:displayComplete', function (event, data) {\n      // Enable bootstrap switches\n      initBootstrapSwitches();\n    });\n    initBootstrapSwitches();\n\n  });\n});\n</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>689554cf-0101-4b9d-b4d6-a8412152bea1</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('AddCustomNotificationFilterPreferenceLivetable', ['jquery', 'xwiki-meta', 'bootstrap'], function($, xm) {\n\n  return function(modal, filterPreferencesLivetable, buttonAddFilter, docURL) {\n    var self = this;\n    self.modal = modal;\n    self.filterPreferencesLivetable = filterPreferencesLivetable;\n    self.buttonAddFilter = buttonAddFilter;\n    self.docURL = docURL;\n    self.filterTypeSelector = modal.find('select#notificationFilterTypeSelector');\n    self.eventTypeSelector = modal.find('select#notificationFilterEventTypeSelector');\n    self.filterScopeTree = modal.find('.location-tree');\n    self.cancelButton = modal.find('button[data-action=\"cancel\"]');\n    self.submitButton = modal.find('button[data-action=\"submit\"]');\n\n    self.getFormats = function () {\n      return self.modal.find('input[name=notificationFilterNotificationFormatSelector]:checked').map(function () { return $(this).val();}).get().join(',');\n    };\n\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      self.buttonAddFilter.on('click', function() {\n        self.filterScopeTree.xtree();\n        self.submitButton.prop('disabled', 'disabled');\n\n        self.filterScopeTree.on('changed.jstree', function(e, data) {\n          if (data.selected.length &gt; 0 &amp;&amp; self.getFormats() !== \"\") {\n            self.submitButton.prop('disabled', '');\n          }\n        });\n      });\n\n      self.submitButton.on('click', self.onSelectButtonClicked);\n    };\n\n    /**\n     * On \"submit\" button clicked\n     */\n    self.onSelectButtonClicked = function() {\n      self.modal.modal('toggle');\n\n      var tree = $.jstree.reference(self.filterScopeTree);\n      var nodes = tree.get_selected(true);\n\n      var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService', XWiki.EntityType.DOCUMENT);\n      var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n      var eventTypesSelected = self.eventTypeSelector.val();\n      var eventTypes;\n      if (eventTypesSelected != null &amp;&amp; eventTypesSelected.length &gt; 0) {\n        eventTypes = eventTypesSelected.join(',');\n      }\n      var target = self.modal.data('target');\n\n      var params = {\n        action: 'createScopeFilterPreference',\n        target: target,\n        filterType: self.filterTypeSelector.val(),\n        filterFormats: self.getFormats(),\n        eventTypes: eventTypes,\n        csrf: xm.form_token,\n        wiki: [],\n        space: [],\n        page: []\n      }\n      if (target == 'user') {\n        params['user'] = self.modal.data('user');\n      }\n\n      for (var i = 0; i &lt; nodes.length; ++i) {\n        var node = nodes[i];\n        var reference = node.data.id;\n        if (node.data.type == 'wiki') {\n          params['wiki'].push(reference);\n        } else if (node.data.type == 'document' &amp;&amp; node.data.id.match('WebHome$')) {\n          params['space'].push(reference.substring(0, reference.length - '.WebHome'.length));\n        } else {\n          params['page'].push(reference);\n        }\n      }\n\n      // Saving\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      // We use a \"traditional: true\" argument here to be sure that the argument names are not transformed to wiki[] etc by jquery. For more info see doc about $.param.\n      $.post({\n        url: serviceURL,\n        data: params,\n        traditional: true\n      }).then(data =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saved'))\", 'done');\n\n        // Reload the livetable\n        self.filterPreferencesLivetable.refresh();\n      }).catch(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.savingfailed'))\", 'error');\n      });\n    };\n\n    // Call init()\n    self.init();\n  };\n\n});\n</code>\n    </property>\n    <property>\n      <name>Add Notification Filter Preference Livetable</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>2</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>c4eea5ea-c958-4870-9eec-6f0d90818465</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('CustomToggleableFilterPreference', ['jquery', 'xwiki-bootstrap-switch'], function($) {\n  /**\n  * Construct the Toggleable Filter Preference object.\n  */\n  return function(domElement, docURL, row) {\n    var self               = this;\n    self.domElement        = $(domElement);\n    self.docURL           = docURL;\n    self.row               = row;\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // On change\n      self.domElement.off('switchChange.bootstrapSwitch.customFilter')\n        .on('switchChange.bootstrapSwitch.customFilter', function(event, state) {\n          setTimeout(function() { self.save(state); }, 1);\n        });\n    };\n\n    /**\n     * Save the filter preference\n     */\n    self.save = function(state) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      var filterName = self.domElement.attr('data-filterName');\n      var objectNumber = self.domElement.attr('data-objectNumber');\n      if (objectNumber == '') {\n        // If the object does not exist yet, create it (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.docURL + '/objects?media=json&amp;minorRevision=true';\n        var params = {\n          'className': 'XWiki.Notifications.Code.ToggleableFilterPreferenceClass',\n          'property#filterName': filterName,\n          'property#isEnabled': state ? '1' : '0'\n        };\n        $.post(restURL, params).then(data =&gt; {\n          self.domElement.attr('data-objectNumber', data.number);\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      } else if (objectNumber != '') {\n        // If the object already exist, just update its value (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.docURL + '/objects/XWiki.Notifications.Code.ToggleableFilterPreferenceClass/' + objectNumber\n          + '/properties/isEnabled?media=json&amp;minorRevision=true';\n        $.ajax(restURL, {\n          method: 'PUT',\n          contentType: 'text/plain',\n          data: state ? '1' : '0'\n        }).then(data =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n          $(document).trigger('xwiki:livetable:notifications-filters-custom:toggle', {'row': self.row, 'state': state});\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      }\n    };\n\n    // Call init\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>Custom Toggleable Filter Preference</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>3</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>e91b3d46-cc48-4d58-ae70-8303b46b8557</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require([\n  'jquery',\n  'xwiki-meta',\n  'CustomToggleableFilterPreference',\n  'xwiki-bootstrap-switch',\n  'xwiki-events-bridge'\n], function ($, xm, CustomToggleableFilterPreference) {\n\n  $(document).on('xwiki:livetable:notifications-filters-custom:toggle', function(event, data) {\n    var changedRow = $(data.row.isEnabled);\n    if (changedRow.length &gt; 0) {\n      if (data.state) {\n        changedRow.attr(\"checked\", \"checked\");\n      } else {\n        changedRow.removeAttr(\"checked\");\n      }\n      data.row.isEnabled = changedRow.get(0).outerHTML;\n    }\n  });\n\n  // Globals\n  var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService',\n    XWiki.EntityType.DOCUMENT);\n  var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n  var target = $('.customFilterPreferences').attr('data-target');\n\n  var docURL = $('.customFilterPreferences').attr('data-doc-url');\n  var postParams = {\n    csrf: xm.form_token,\n    target: target\n  };\n  if (target == 'user') {\n    var targetUser = $('.customFilterPreferences').attr('data-user');\n    postParams['user'] = targetUser;\n  };\n\n  var enhanceRow = function(row, data) {\n    // Delete action\n    $(row).find('a.actiondelete').off('click.deleteCustomFilter').on('click.deleteCustomFilter', function(event) {\n      event.preventDefault();\n      new XWiki.widgets.ConfirmationBox({\n        onYes: function() {\n          var notif = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n            'notifications.filters.preferences.delete.inProgress')), 'inprogress');\n          var params = {\n            action: 'deleteFilterPreference',\n            filterPreferenceId: data.filterPreferenceId\n          };\n          $.post(serviceURL, $.extend({}, params, postParams)).then(() =&gt; {\n            notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n              'notifications.filters.preferences.delete.done')), 'done'));\n            window.livetable_notificationCustomFilterPreferencesLiveTable.refresh();\n          }).catch(() =&gt; {\n            notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n              'notifications.filters.preferences.delete.error')), 'error'));\n          });\n        }\n      });\n    });\n    // Enable / Disable action for classic filter preferences\n    $(row).find('.notificationFilterPreferenceCheckbox').off('switchChange.bootstrapSwitch.customFilter')\n    .on('switchChange.bootstrapSwitch.customFilter', function(event, state) {\n      var notif = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.filters.preferences.setEnabled.inProgress')), 'inprogress');\n      var params = {\n        action: 'setFilterPreferenceEnabled',\n        filterPreferenceId: data.filterPreferenceId,\n        enabled: state\n      };\n      $.post(serviceURL, $.extend({}, params, postParams)).then(() =&gt; {\n        notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n          'notifications.filters.preferences.setEnabled.done')), 'done'));\n        $(document).trigger('xwiki:livetable:notifications-filters-custom:toggle', {'row': data, 'state': state});\n      }).catch(() =&gt; {\n        notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n          'notifications.filters.preferences.setEnabled.error')), 'error'));\n      });\n    });\n    // Enable / Disable action for toggleable filter preferences\n    $(row).find('.toggleableFilterPreferenceCheckbox').each(function() {\n      new CustomToggleableFilterPreference(this, docURL, data);\n    });\n  };\n\n  // Callback on livetable row printing\n  $(document).on('xwiki:livetable:notificationCustomFilterPreferencesLiveTable:newrow', function(event, data) {\n    enhanceRow(data.row, data.data);\n  });\n\n  // Initializer\n  $(function() {\n    // This script is usually loaded after the live table is displayed and so the previous callback might not be called.\n    $('#notificationCustomFilterPreferencesLiveTable-display &gt; tr[data-index]').each(function() {\n      var data = window.livetable_notificationCustomFilterPreferencesLiveTable.fetchedRows[$(this).data('index')];\n      enhanceRow(this, data);\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>Filter Preferences Livetable Callback</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>78413304-d950-417e-8b11-094a771546e4</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#notificationCustomFilterPreferencesLiveTable select.pagesizeselect {\n  width: auto;\n}\n\n.modal-description {\n   .text-muted-smaller;\n    font-weight: 400;\n    text-transform: none;\n}</code>\n    </property>\n    <property>\n      <contentType>LESS</contentType>\n    </property>\n    <property>\n      <name>NotificationFilterPreferences</name>\n    </property>\n    <property>\n      <parse/>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>0e9925d3-1a0b-4203-be02-e795f7801368</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{template name=\"locationPicker_macros.vm\" /}}\n\n{{include reference=\"XWiki.Notifications.Code.NotificationsPreferencesMacros\" /}}\n\n{{velocity}}\n#checkMacroNotificationPreferencesParameters($checkResult)\n#if ($checkResult)\n#if ($wikimacro.parameters.target == \"wiki\")\n  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($services.model.createDocumentReference('', ['XWiki', 'Notifications', 'Code'], 'NotificationAdministration')))\"\"\")\n#else\n  #if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n  #else\n    #set ($targetUser = $xcontext.userReference)\n  #end\n  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($targetUser))\"\" data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n#end\n######################################################\n### CSS and JAVASCRIPTS\n######################################################\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro'))\n#set ($discard = $xwiki.ssx.use('XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro'))\n## TODO: replace by $xwiki.sswx.use() or something like this when XWIKI-12788 is closed.\n#set ($discard = $xwiki.linkx.use($services.webjars.url('bootstrap-switch', 'css/bootstrap3/bootstrap-switch.min.css'), {'type': 'text/css', 'rel': 'stylesheet'}))\n######################################################\n### MACRO CONTENT\n######################################################\n{{html clean=\"false\"}}\n&lt;div class=\"customFilterPreferences xform\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $divData&gt;\n  &lt;div class=\"row\"&gt;\n    &lt;p class=\"xHint col-xs-12 col-sm-9 col-md-8 col-lg-9\"&gt;\n      $escapetool.xml($services.localization.render('notifications.settings.filters.preferences.custom.hint'))\n    &lt;/p&gt;\n    &lt;div class=\"col-xs-12 col-sm-3 col-md-4 col-lg-3 text-right\"&gt;\n      &lt;button type=\"button\" class=\"btn btn-default btn-addfilter\" data-target=\"#modal-add-custom-filter-preference\" data-toggle=\"modal\"&gt;\n        &lt;span class=\"fa fa-plus\"&gt;&lt;/span&gt;&amp;nbsp;$escapetool.xml($services.localization.render('notifications.settings.addFilter'))\n      &lt;/button&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  #set($collist  = ['name', 'filterType', 'eventTypes', 'notificationFormats', 'isEnabled', '_actions'])\n  #set($colprops = {\n    'name':                { 'sortable': false, 'html': true, 'filterable': false },\n    'filterType':          { 'sortable': false, 'filterable': false },\n    'eventTypes':          { 'sortable': false, 'html': true, 'filterable': false },\n    'notificationFormats': { 'sortable': false, 'html': true, 'filterable': false },\n    'isEnabled':           { 'sortable': false, 'html' : true, 'filterable': false },\n    '_actions':            { 'sortable': false, 'actions': ['delete'], 'filterable': false}\n  })\n  #set ($extraParams = \"eventType=&amp;format=&amp;type=custom\")\n  #if ($wikimacro.parameters.target == 'user')\n    #set ($extraParams = \"$extraParams&amp;user=${services.model.serialize($targetUser, 'default')}\")\n  #end\n  #set($options  = {\n    'resultPage'        : 'XWiki.Notifications.Code.NotificationFilterPreferenceLivetableResults',\n    'rowCount'          : 10,\n    'description'       : 'This table lists every custom filter registered for the given user or current wiki.',\n    'translationPrefix' : 'notifications.settings.filters.preferences.custom.table.',\n    'extraParams'       : $extraParams,\n    'outputOnlyHtml'    : true\n  })\n\n  #livetable(\"notificationCustomFilterPreferencesLiveTable\" $collist $colprops $options)\n&lt;/div&gt;\n######################################################\n### ADD FILTER MODAL\n######################################################\n&lt;div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" id=\"modal-add-custom-filter-preference\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $divData&gt;\n  &lt;div class=\"modal-dialog\" role=\"document\"&gt;\n    &lt;div class=\"modal-content\"&gt;\n      &lt;div class=\"modal-header\"&gt;\n        &lt;button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"&gt;&lt;span aria-hidden=\"true\"&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;\n        &lt;div class=\"modal-title\"&gt;$escapetool.xml($services.localization.render('notifications.settings.addFilter'))&lt;/div&gt;\n        &lt;div class=\"modal-description\"&gt;$escapetool.xml($services.localization.render('notifications.settings.addFilter.hint'))&lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"modal-body\"&gt;\n        &lt;div class=\"xform\"&gt;\n          &lt;dl class=\"location-picker\"&gt;\n            &lt;dt&gt;\n              &lt;label&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.location.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.location.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd class=\"document-tree\"&gt;\n              #documentTree({\n                'class': 'location-tree',\n                'finder': true,\n                'showAttachments': false,\n                'showRoot': false,\n                'showTerminalDocuments': true,\n                'showTranslations': false,\n                'showWikis': true\n              })\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterTypeSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.type.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.type.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterTypeSelector\" name=\"notificationFilterTypeSelector\" size=\"1\"&gt;\n                &lt;option value=\"inclusive\" selected=\"selected\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.filterType.inclusive'))&lt;/option&gt;\n                &lt;option value=\"exclusive\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.filterType.exclusive'))&lt;/option&gt;\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterEventTypeSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.eventType.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.eventType.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterEventTypeSelector\" name=\"notificationFilterEventTypeSelector\" size=\"5\" multiple&gt;\n                #foreach ($app in $apps)\n                  #set ($type = $app[0])\n                  &lt;optgroup label=\"$escapetool.xml($type.applicationName)\"&gt;\n                  #foreach($descriptor in $app)\n                    &lt;option value=\"$escapetool.xml($descriptor.eventType)\"&gt;$escapetool.xml($services.localization.render($descriptor.description))&lt;/option&gt;\n                  #end\n                  &lt;/optgroup&gt;\n                #end\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;span class=\"label\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.notificationFormat.label'))&lt;/span&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.notificationFormat.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;input type=\"checkbox\" id=\"notificationFilterNotificationFormatSelector_alert\" name=\"notificationFilterNotificationFormatSelector\" value=\"alert\" checked=\"checked\" /&gt;\n              &lt;label for=\"notificationFilterNotificationFormatSelector_alert\"&gt;$escapetool.xml($services.localization.render('notifications.format.alert'))&lt;/label&gt;\n              &lt;br /&gt;\n              &lt;input type=\"checkbox\" id=\"notificationFilterNotificationFormatSelector_email\" name=\"notificationFilterNotificationFormatSelector\" value=\"email\" checked=\"checked\" /&gt;\n              &lt;label for=\"notificationFilterNotificationFormatSelector_email\"&gt;$escapetool.xml($services.localization.render('notifications.format.email'))&lt;/label&gt;\n            &lt;/dd&gt;\n          &lt;/dl&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"modal-footer\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-default\" data-action=\"cancel\" data-dismiss=\"modal\"&gt;$services.localization.render('notifications.filters.cancel')&lt;/button&gt;\n        &lt;button type=\"button\" class=\"btn btn-primary\" data-action=\"submit\" disabled=\"disabled\"&gt;$services.localization.render('notifications.filters.submit')&lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;&lt;!-- /.modal-content --&gt;\n  &lt;/div&gt;&lt;!-- /.modal-dialog --&gt;\n&lt;/div&gt;&lt;!-- /.modal --&gt;\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the given user about custom notification filters.</description>\n    </property>\n    <property>\n      <id>notificationsCustomFiltersPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Custom Filters Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>60838ffa-0f48-4c1b-9244-1435f02914af</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the filter preferences. This parameter is optional, default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>a2b19666-5ac4-452c-a1d9-cfb74e7ac4ed</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description>Target of the macro (could be \"user\" for the given user or \"wiki\" for the current wiki)</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsEmailPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsEmailPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Notifications.Code.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsEmailPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsEmailPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>9267c736-6acc-410a-9f61-2aeb625de28d</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require(['jquery', 'xwiki-meta'], function ($, xm) {\n  'use strict';\n\n  /**\n   * Handle the notification email interval.\n   */\n  $(document).off('change.notificationEmailInterval');\n  $(document).on('change.notificationEmailInterval', '.notificationEmailInterval', function() {\n    var intervalSelect = $(this);\n    var notification = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n      'notifications.settings.saving')), 'inprogress');\n    var serviceURL = new XWiki.Document(XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService',\n      XWiki.EntityType.DOCUMENT)).getURL('get', 'outputSyntax=plain');\n    var target = $('.notifEmailPreferences').attr('data-target');\n    var targetUser = target === 'user' ? $('.notifEmailPreferences').attr('data-user') : '';\n    $.post(serviceURL, {\n      'action': 'setInterval',\n      'interval': intervalSelect.val(),\n      'target': target,\n      'user': targetUser,\n      'csrf': xm.form_token\n    }).then(data =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.saved')), 'done'));\n    }).catch(() =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.savingfailed')), 'error'));\n    });\n  });\n\n  /**\n   * Handle the include diff in email setting\n   */\n  $(document).off('change.notificationEmailDiffType');\n  $(document).on('change.notificationEmailDiffType', '.notificationEmailDiffType', function() {\n    var diffTypeSelect = $(this);\n    var notification = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n      'notifications.settings.saving')), 'inprogress');\n    var serviceURL = new XWiki.Document(XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService',\n      XWiki.EntityType.DOCUMENT)).getURL('get', 'outputSyntax=plain');\n    var target = $('.notifEmailPreferences').attr('data-target');\n    var targetUser = target === 'user' ? $('.notifEmailPreferences').attr('data-user') : '';\n    $.post(serviceURL, {\n      'action': 'setDiffType',\n      'diffType': diffTypeSelect.val(),\n      'target': target,\n      'user': targetUser,\n      'csrf': xm.form_token\n    }).then(data =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.saved')), 'done'));\n    }).catch(() =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.savingfailed')), 'error'));\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsEmailPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>1646274b-9c55-419e-a3d9-f6e1eb1fca31</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{velocity}}\n#if (!$services.notification.areEmailsEnabled())\n  {{warning}}\n    {{localization key=\"notifications.settings.email.disabled\" /}}\n  {{warning}}\n#elseif (!$xcontext.userReference)\n  {{info}}\n    {{translation key=\"notifications.settings.email.forGuest\" /}}\n  {{/info}}\n#elseif ($wikimacro.parameters.target == 'wiki' &amp;&amp; !$hasAdmin)\n  {{error}}\n    {{translation key=\"notifications.settings.error.notAdmin\" /}}\n  {{/error}}\n#elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; $wikimacro.parameters.user.class.simpleName != 'DocumentUserReference')\n  {{error}}\n    {{translation key=\"notifications.settings.error.userReferenceNotSupported\" /}}\n  {{/error}}\n#elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n  {{error}}\n    {{translation key=\"notifications.settings.error.userReferenceAdminForbidden\" parameters=\"$wikimacro.parameters.user\" /}}\n  {{/error}}\n#else\n  \n  #if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n  #else\n    #set ($targetUser = $xcontext.userReference)\n  #end\n  #set ($dataUser = \"\")\n  #if ($wikimacro.parameters.target == 'user')\n    #set ($dataUser = \"data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n  #end\n  #set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsEmailPreferencesMacro'))\n  {{html clean=\"false\"}}\n    &lt;div class=\"notification-top-panel-preferences notifEmailPreferences\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $dataUser&gt;\n      &lt;div class=\"xform\"&gt;\n        ## TODO: handle the interval for the wiki target too\n        #if ($wikimacro.parameters.target == 'user')\n        &lt;dl&gt;\n          &lt;dt&gt;&lt;label&gt;$escapetool.xml($services.localization.render('notifications.settings.email.frequency'))&lt;/label&gt;\n          &lt;p class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.email.frequency.hint'))&lt;/p&gt;\n          &lt;/dt&gt;\n          &lt;dd&gt;\n            #set ($targetDocument = $xwiki.getDocument($targetUser))\n            #set ($interval = 'daily')\n            #set ($objPref = $targetDocument.getObject('XWiki.Notifications.Code.NotificationEmailPreferenceClass'))\n            #if (\"$!objPref\" != '')\n              #set ($objInterval = $objPref.getValue('interval'))\n              #if (\"$!objInterval\" != '')\n                #set ($interval = $objInterval)\n              #end\n            #end\n            &lt;select class=\"notificationEmailInterval\"&gt;\n              &lt;option value=\"hourly\" #if($interval == 'hourly')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_interval_hourly'))&lt;/option&gt;\n              &lt;option value=\"daily\"  #if($interval == 'daily')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_interval_daily'))&lt;/option&gt;\n              &lt;option value=\"weekly\" #if($interval == 'weekly')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_interval_weekly'))&lt;/option&gt;\n              &lt;option value=\"live\" #if($interval == 'live')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_interval_live'))&lt;/option&gt;\n            &lt;/select&gt;\n          &lt;/dd&gt;\n        &lt;/dl&gt;\n        #else\n          #set ($targetDocument = $xwiki.getDocument($services.model.createDocumentReference('', ['XWiki', 'Notifications', 'Code'], 'NotificationAdministration')))\n        #end\n        &lt;dl&gt;\n          &lt;dt&gt;&lt;label&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_diffType'))&lt;/label&gt;\n          &lt;p class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.email.diffType.hint'))&lt;/p&gt;\n          &lt;/dt&gt;\n          &lt;dd&gt;\n            #if ($wikimacro.parameters.target == 'user')\n              #set ($diffType = $services.notification.preferences.getDiffType($targetUser))\n            #else\n              #set ($diffType = $services.notification.preferences.getDiffType())\n            #end\n            #set ($objPref = $targetDocument.getObject('XWiki.Notifications.Code.NotificationEmailPreferenceClass'))\n            #if (\"$!objPref\" != '')\n              #set ($objDiffType = $objPref.getValue('diffType'))\n              #if (\"$!objDiffType\" != '')\n                #set ($diffType = $objDiffType)\n              #end\n            #end\n            &lt;select class=\"notificationEmailDiffType\"&gt;\n              &lt;option value=\"NOTHING\" #if($diffType == 'NOTHING')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_diffType_NOTHING'))&lt;/option&gt;\n              &lt;option value=\"STANDARD\"  #if($diffType == 'STANDARD')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_diffType_STANDARD'))&lt;/option&gt;\n            &lt;/select&gt;\n          &lt;/dd&gt;\n        &lt;/dl&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  {{/html}}\n#end\n{{/velocity}}\n</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the current user about notification emails.</description>\n    </property>\n    <property>\n      <id>notificationsEmailPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Email Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsEmailPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>02bb1d4d-2854-48e0-997e-6462d024d243</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description/>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsEmailPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>4e7e7ddc-bbda-48ac-b9ee-eeb0d2b2afbe</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the email preferences. This parameter is optional, only used if the target parameter is set to ##user## and default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsFiltersPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Notifications.Code.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsFiltersPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>35d1d8c7-f9e7-4cad-a505-5e46ddaf5d79</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>'use strict';\n/**\n * Start the real script.\n */\nrequire(['jquery', 'AddNotificationFilterPreferenceLivetable', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($, AddNotificationFilterPreferenceLivetable) {\n\n  /**\n   * Page initialization\n   */\n  $(function() {\n\n    new AddNotificationFilterPreferenceLivetable($('#modal-add-filter-preference'), window['livetable_notificationFilterPreferencesLiveTable'], $('.filterPreferences button.btn-addfilter'),\n      $('.filterPreferences').attr('data-user-url'));\n    var initBootstrapSwitches = function () {\n      $('#notificationFilterPreferencesLiveTable .notificationFilterPreferenceCheckbox, #notificationFilterPreferencesLiveTable .toggleableFilterPreferenceCheckbox').bootstrapSwitch({\n        size: 'mini',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n    };\n    $(document).on('xwiki:livetable:displayComplete', function (event, data) {\n      // Enable bootstrap switches\n      initBootstrapSwitches();\n    });\n    initBootstrapSwitches();\n\n  });\n});\n</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>19d1a6ca-02cf-41f5-81fb-415e557974dc</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('AddNotificationFilterPreferenceLivetable', ['jquery', 'xwiki-meta', 'bootstrap'], function($, xm) {\n\n  return function(modal, filterPreferencesLivetable, buttonAddFilter, userURL) {\n    var self = this;\n    self.modal = modal;\n    self.filterPreferencesLivetable = filterPreferencesLivetable;\n    self.buttonAddFilter = buttonAddFilter;\n    self.userURL = userURL;\n    self.filterTypeSelector = modal.find('select#notificationFilterTypeSelector');\n    self.eventTypeSelector = modal.find('select#notificationFilterEventTypeSelector');\n    self.notificationFormatSelector = modal.find('select#notificationFilterNotificationFormatSelector');\n    self.filterScopeTree = modal.find('.location-tree');\n    self.cancelButton = modal.find('button[data-action=\"cancel\"]');\n    self.submitButton = modal.find('button[data-action=\"submit\"]');\n\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      self.buttonAddFilter.on('click', function() {\n        self.filterScopeTree.xtree();\n        self.submitButton.prop('disabled', 'disabled');\n\n        self.filterScopeTree.on('changed.jstree', function(e, data) {\n          if (data.selected.length &gt; 0) {\n            self.submitButton.prop('disabled', '');\n          }\n        });\n      });\n\n      self.submitButton.on('click', self.onSelectButtonClicked);\n    };\n\n    /**\n     * On \"submit\" button clicked\n     */\n    self.onSelectButtonClicked = function() {\n      self.modal.modal('toggle');\n\n      var tree = $.jstree.reference(self.filterScopeTree);\n      var nodes = tree.get_selected(true);\n\n      var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService', XWiki.EntityType.DOCUMENT);\n      var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n\n      var eventTypesSelected = self.eventTypeSelector.val();\n      var eventTypes;\n      if (eventTypesSelected != null &amp;&amp; eventTypesSelected.length &gt; 0) {\n        eventTypes = eventTypesSelected.join(',');\n      }\n      var params = {\n        action: 'createScopeFilterPreference',\n        target: 'user',\n        user: self.modal.data('user'),\n        filterType: self.filterTypeSelector.val(),\n        filterFormats: self.notificationFormatSelector.val().join(','),\n        eventTypes: eventTypes,\n        csrf: xm.form_token,\n        wiki: [],\n        space: [],\n        page: []\n      }\n\n      for (var i = 0; i &lt; nodes.length; ++i) {\n        var node = nodes[i];\n        var reference = node.data.id;\n        if (node.data.type == 'wiki') {\n          params['wiki'].push(reference);\n        } else if (node.data.type == 'document' &amp;&amp; node.data.id.match('WebHome$')) {\n          params['space'].push(reference.substring(0, reference.length - '.WebHome'.length));\n        } else {\n          params['page'].push(reference);\n        }\n      }\n\n      // Saving\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      // We use a \"traditional: true\" argument here to be sure that the argument names are not transformed to wiki[] etc by jquery. For more info see doc about $.param.\n      $.post({\n        url: serviceURL,\n        data: params,\n        traditional: true\n      }).then(data =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saved'))\", 'done');\n\n        // Reload the livetable\n        self.filterPreferencesLivetable.refresh();\n      }).catch(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.savingfailed'))\", 'error');\n      });\n    };\n\n    // Call init()\n    self.init();\n  };\n\n});\n</code>\n    </property>\n    <property>\n      <name>Add Notification Filter Preference Livetable</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>2</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>53f67179-890e-4d1f-aec6-69873f9f87f4</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('ToggleableFilterPreference', ['jquery', 'xwiki-bootstrap-switch'], function($) {\n  /**\n  * Construct the Toggleable Filter Preference object.\n  */\n  return function(domElement, userURL, row) {\n    var self               = this;\n    self.domElement        = $(domElement);\n    self.userURL           = userURL;\n    self.row               = row;\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // On change\n      self.domElement.on('switchChange.bootstrapSwitch', function(event, state) {\n        setTimeout(function() { self.save(state); }, 1);\n      });\n    };\n\n    /**\n     * Save the filter preference\n     */\n    self.save = function(state) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      var filterName = self.domElement.attr('data-filterName');\n      var objectNumber = self.domElement.attr('data-objectNumber');\n      if (objectNumber == '') {\n        // If the object does not exist yet, create it (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.userURL + '/objects?media=json&amp;minorRevision=true';\n        var params = {\n          'className': 'XWiki.Notifications.Code.ToggleableFilterPreferenceClass',\n          'property#filterName': filterName,\n          'property#isEnabled': state ? '1' : '0'\n        };\n        $.post(restURL, params).then(data =&gt; {\n          self.domElement.attr('data-objectNumber', data.number);\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      } else if (objectNumber != '') {\n        // If the object already exist, just update its value (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.userURL + '/objects/XWiki.Notifications.Code.ToggleableFilterPreferenceClass/' + objectNumber\n          + '/properties/isEnabled?media=json&amp;minorRevision=true';\n        $.ajax(restURL, {\n          method: 'PUT',\n          contentType: 'text/plain',\n          data: state ? '1' : '0'\n        }).then(data =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n          $(document).trigger('xwiki:livetable:notifications-filters:toggle', {'row': self.row, 'state': state});\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      }\n    };\n\n    // Call init\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>Toggleable Filter Preference</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>3</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>de91de12-11fa-4ec8-9e37-1d231500dedb</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require(['jquery', 'xwiki-meta', 'ToggleableFilterPreference', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($, xm, ToggleableFilterPreference) {\n\n  $(document).on('xwiki:livetable:notifications-filters:toggle', function(event, data) {\n    var changedRow = $(data.row.isEnabled);\n    if (changedRow.length &gt; 0) {\n      if (data.state) {\n        changedRow.attr(\"checked\", \"checked\");\n      } else {\n        changedRow.removeAttr(\"checked\");\n      }\n      data.row.isEnabled = changedRow.get(0).outerHTML;\n    }\n  });\n\n  // Globals\n  var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService', XWiki.EntityType.DOCUMENT);\n  var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n  var userURL = $('.filterPreferences').attr('data-user-url');\n  var targetUser = $('.filterPreferences').attr('data-user');\n\n  // Callback on livetable row printing\n  $(document).on('xwiki:livetable:notificationFilterPreferencesLiveTable:newrow', function(event, data) {\n    // Delete action\n    $(data.row).find('a.actiondelete').on('click', function(event) {\n      event.preventDefault();\n      new XWiki.widgets.ConfirmationBox({\n        onYes: function() {\n          var notif = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.delete.inProgress'))\", 'inprogress');\n          $.post(serviceURL, {\n            action: 'deleteFilterPreference',\n            target: 'user',\n            user: targetUser,\n            filterPreferenceId: data.data.filterPreferenceId,\n            csrf: xm.form_token\n          }).then(() =&gt; {\n            notif.hide();\n            new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.delete.done'))\", 'done');\n            window.livetable_notificationFilterPreferencesLiveTable.refresh();\n          }).catch(() =&gt; {\n            notif.hide();\n            new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.delete.error'))\", 'error');\n          });\n        }\n      });\n    });\n    // Enable / Disable action for classic filter preferences\n    $(data.row).find('.notificationFilterPreferenceCheckbox').on('switchChange.bootstrapSwitch', function(event, state) {\n      // TODO: Translation keys\n      var notif = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.inProgress'))\", 'inprogress');\n      $.post(serviceURL, {\n        action: 'setFilterPreferenceEnabled',\n        filterPreferenceId: data.data.filterPreferenceId,\n        target: 'user',\n        user: targetUser,\n        enabled: state,\n        csrf: xm.form_token\n      }).then(() =&gt; {\n        notif.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n        $(document).trigger('xwiki:livetable:notifications-filters:toggle', {'row': data.data, 'state': state});\n      }).catch(() =&gt; {\n        notif.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n      });\n    });\n    // Enable / Disable action for toggleable filter preferences\n    $(data.row).find('.toggleableFilterPreferenceCheckbox').each(function() {\n      new ToggleableFilterPreference(this, userURL, data.data);\n    });\n  });\n\n  // Initializer\n  $(function() {\n    // This script is usually loaded after the livetable is displayed and so the previous callback is not called.\n    // Because of that, we need\n    if (window.livetable_notificationFilterPreferencesLiveTable) {\n      window.livetable_notificationFilterPreferencesLiveTable.refresh();\n    }\n  });\n});</code>\n    </property>\n    <property>\n      <name>Filter Preferences Livetable Callback</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>068bd3af-8e02-45bb-b1dc-0e99095bf10a</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#notificationFilterPreferencesLiveTable select.pagesizeselect {\n  width: auto;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>NotificationFilterPreferences</name>\n    </property>\n    <property>\n      <parse/>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>35dc5b39-6a83-4d70-bdb5-531f67b51e12</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{template name=\"locationPicker_macros.vm\" /}}\n\n{{include reference=\"XWiki.Notifications.Code.NotificationsPreferencesMacros\" /}}\n\n{{velocity}}\n#if (!$xcontext.userReference)\n  {{info}}\n    {{translation key=\"notifications.settings.filters.preferences.forGuest\" /}}\n  {{/info}}\n## FIXME: This check should not be needed with a proper API able to check rights on UserReference.\n## This should be improved later with such API.\n#elseif (\"$!wikimacro.parameters.user\" != \"\" &amp;&amp; $wikimacro.parameters.user.class.simpleName != 'DocumentUserReference')\n  {{error}}\n    This macro only allows to handle DocumentUserReference references and you specified a $wikimacro.parameters.user.class.simpleName reference.\n  {{/error}}\n#elseif (\"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n  {{error}}\n    You don't have administration right on  $wikimacro.parameters.user.\n  {{/error}}\n#else\n#set ($discard = $services.logging.deprecate(\"NotificationsFiltersPreferencesMacro\", \"This macro should not be used anymore in favor of SystemNotificationsFiltersPreferencesMacro and CustomNotificationsFiltersPreferencesMacro.\"))\n## TODO: We should actually manipulate only UserReferences here.\n#if (\"$!wikimacro.parameters.user\" != \"\")\n  #set ($targetUser = $wikimacro.parameters.user.reference)\n#else\n  #set ($targetUser = $xcontext.userReference)\n#end\n######################################################\n### CSS and JAVASCRIPTS\n######################################################\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro'))\n#set ($discard = $xwiki.ssx.use('XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro'))\n## TODO: replace by $xwiki.sswx.use() or something like this when XWIKI-12788 is closed.\n#set ($discard = $xwiki.linkx.use($services.webjars.url('bootstrap-switch', 'css/bootstrap3/bootstrap-switch.min.css'), {'type': 'text/css', 'rel': 'stylesheet'}))\n######################################################\n### MACRO CONTENT\n######################################################\n{{html clean=\"false\"}}\n&lt;div class=\"filterPreferences xform\" data-user-url=\"$escapetool.xml($services.rest.url($targetUser))\" data-user=\"$services.model.serialize($targetUser)\"&gt;\n  &lt;div class=\"row\"&gt;\n    &lt;p class=\"xHint col-xs-12 col-sm-9 col-md-8 col-lg-9\"&gt;\n      $escapetool.xml($services.localization.render('notifications.settings.filters.preferences.hint'))\n    &lt;/p&gt;\n    &lt;div class=\"col-xs-12 col-sm-3 col-md-4 col-lg-3 text-right\"&gt;\n      &lt;button type=\"button\" class=\"btn btn-default btn-addfilter\" data-target=\"#modal-add-filter-preference\" data-toggle=\"modal\"&gt;\n        &lt;span class=\"fa fa-plus\"&gt;&lt;/span&gt;&amp;nbsp;$escapetool.xml($services.localization.render('notifications.settings.addFilter'))\n      &lt;/button&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  #set($collist  = ['name', 'filterType', 'eventTypes', 'notificationFormats', 'isEnabled', '_actions'])\n  #set($colprops = {\n    'name':                { 'sortable': false, 'html': true, 'filterable': false },\n    'filterType':          { 'sortable': false, 'filterable': false },\n    'eventTypes':          { 'sortable': false, 'html': true, 'filterable': false },\n    'notificationFormats': { 'sortable': false, 'html': true, 'filterable': false },\n    'isEnabled':           { 'sortable': false, 'html' : true, 'filterable': false },\n    '_actions':            { 'sortable': false, 'actions': ['delete'], 'filterable': false}\n  })\n  #set($options  = {\n    'resultPage'        : 'XWiki.Notifications.Code.NotificationFilterPreferenceLivetableResults',\n    'rowCount'          : 10,\n    'description'       : 'This table lists every filter registered for the current user.',\n    'translationPrefix' : 'notifications.settings.filters.preferences.table.',\n    'extraParams'       : \"eventType=&amp;format=&amp;user=${services.model.serialize($targetUser, 'default')}\",\n    'outputOnlyHtml'    : true\n  })\n\n  #livetable(\"notificationFilterPreferencesLiveTable\" $collist $colprops $options)\n&lt;/div&gt;\n######################################################\n### ADD FILTER MODAL\n######################################################\n&lt;div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" id=\"modal-add-filter-preference\" data-user=\"$services.model.serialize($targetUser)\"&gt;\n  &lt;div class=\"modal-dialog\" role=\"document\"&gt;\n    &lt;div class=\"modal-content\"&gt;\n      &lt;div class=\"modal-header\"&gt;\n        &lt;button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"&gt;&lt;span aria-hidden=\"true\"&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;\n        &lt;div class=\"modal-title\"&gt;$escapetool.xml($services.localization.render('notifications.settings.addFilter'))&lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"modal-body\"&gt;\n        &lt;div class=\"xform\"&gt;\n          &lt;dl class=\"location-picker\"&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterTypeSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.type.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.type.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterTypeSelector\" name=\"notificationFilterTypeSelector\" size=\"1\"&gt;\n                &lt;option value=\"inclusive\" selected=\"selected\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.filterType.inclusive'))&lt;/option&gt;\n                &lt;option value=\"exclusive\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.filterType.exclusive'))&lt;/option&gt;\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterNotificationFormatSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.notificationFormat.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.notificationFormat.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterNotificationFormatSelector\" name=\"notificationFilterNotificationFormatSelector\" size=\"2\" multiple&gt;\n                &lt;option value=\"alert\" selected=\"selected\"&gt;$escapetool.xml($services.localization.render('notifications.format.alert'))&lt;/option&gt;\n                &lt;option value=\"email\"&gt;$escapetool.xml($services.localization.render('notifications.format.email'))&lt;/option&gt;\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterEventTypeSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.eventType.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.eventType.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterEventTypeSelector\" name=\"notificationFilterEventTypeSelector\" size=\"5\" multiple&gt;\n                #foreach ($app in $apps)\n                  #set ($type = $app[0])\n                  &lt;optgroup label=\"$escapetool.xml($type.applicationName)\"&gt;\n                  #foreach($descriptor in $app)\n                    &lt;option value=\"$escapetool.xml($descriptor.eventType)\"&gt;$escapetool.xml($services.localization.render($descriptor.description))&lt;/option&gt;\n                  #end\n                  &lt;/optgroup&gt;\n                #end\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.location.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.location.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd class=\"document-tree\"&gt;\n              #documentTree({\n                'class': 'location-tree',\n                'finder': true,\n                'showAttachments': false,\n                'showRoot': false,\n                'showTerminalDocuments': true,\n                'showTranslations': false,\n                'showWikis': true\n              })\n            &lt;/dd&gt;\n          &lt;/dl&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"modal-footer\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-default\" data-action=\"cancel\" data-dismiss=\"modal\"&gt;$services.localization.render('notifications.filters.cancel')&lt;/button&gt;\n        &lt;button type=\"button\" class=\"btn btn-primary\" data-action=\"submit\" disabled=\"disabled\"&gt;$services.localization.render('notifications.filters.submit')&lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;&lt;!-- /.modal-content --&gt;\n  &lt;/div&gt;&lt;!-- /.modal-dialog --&gt;\n&lt;/div&gt;&lt;!-- /.modal --&gt;\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the current user about notification filters.\nThis macro is now deprecated in favor of Custom Notifications Filters Preferences or System Notifications Filters Preferences.</description>\n    </property>\n    <property>\n      <id>notificationsFiltersPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Filters Preferences (deprecated)</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>38b562b3-61ed-40bf-8ab1-088260b579bc</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the filter preferences. This parameter is optional, default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsSystemFiltersPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsSystemFiltersPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>7e7d151b-e4dd-498b-8e50-f213104fa256</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>'use strict';\n/**\n * Start the real script.\n */\nrequire(['jquery', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($) {\n\n  /**\n   * Page initialization\n   */\n  $(function() {\n    var initBootstrapSwitches = function () {\n      $('#notificationSystemFilterPreferencesLiveTable .notificationFilterPreferenceCheckbox, #notificationSystemFilterPreferencesLiveTable .toggleableFilterPreferenceCheckbox').bootstrapSwitch({\n        size: 'mini',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n    };\n    $(document).on('xwiki:livetable:displayComplete', function (event, data) {\n      // Enable bootstrap switches\n      initBootstrapSwitches();\n    });\n    initBootstrapSwitches();\n\n  });\n});\n</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>2</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>f3d87be8-97d5-490f-b519-952b54fc3e69</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('SystemToggleableFilterPreference', ['jquery', 'xwiki-bootstrap-switch'], function($) {\n  /**\n  * Construct the Toggleable Filter Preference object.\n  */\n  return function(domElement, docURL, row) {\n    var self               = this;\n    self.domElement        = $(domElement);\n    self.docURL           = docURL;\n    self.row               = row;\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // On change\n      self.domElement.off('switchChange.bootstrapSwitch.systemFilter')\n        .on('switchChange.bootstrapSwitch.systemFilter', function(event, state) {\n          setTimeout(function() { self.save(state); }, 1);\n        });\n    };\n\n    /**\n     * Save the filter preference\n     */\n    self.save = function(state) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      var filterName = self.domElement.attr('data-filterName');\n      var objectNumber = self.domElement.attr('data-objectNumber');\n      if (objectNumber == '') {\n        // If the object does not exist yet, create it (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.docURL + '/objects?media=json&amp;minorRevision=true';\n        var params = {\n          'className': 'XWiki.Notifications.Code.ToggleableFilterPreferenceClass',\n          'property#filterName': filterName,\n          'property#isEnabled': state ? '1' : '0'\n        };\n        $.post(restURL, params).then(data =&gt; {\n          self.domElement.attr('data-objectNumber', data.number);\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      } else if (objectNumber != '') {\n        // If the object already exist, just update its value (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.docURL + '/objects/XWiki.Notifications.Code.ToggleableFilterPreferenceClass/' + objectNumber\n          + '/properties/isEnabled?media=json&amp;minorRevision=true';\n        $.ajax(restURL, {\n          method: 'PUT',\n          contentType: 'text/plain',\n          data: state ? '1' : '0'\n        }).then(data =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n          $(document).trigger('xwiki:livetable:notifications-filters-system:toggle', {'row': self.row, 'state': state});\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      }\n    };\n\n    // Call init\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>System Toggleable Filter Preference</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>3</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>2ce1c5a8-4fdb-479f-85f7-7cbfe9b7d646</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require([\n  'jquery',\n  'SystemToggleableFilterPreference',\n  'xwiki-meta',\n  'xwiki-bootstrap-switch',\n  'xwiki-events-bridge'\n], function ($, SystemToggleableFilterPreference, xm) {\n  $(document).on('xwiki:livetable:notifications-filters-system:toggle', function(event, data) {\n    var changedRow = $(data.row.isEnabled);\n    if (changedRow.length &gt; 0) {\n      if (data.state) {\n        changedRow.attr(\"checked\", \"checked\");\n      } else {\n        changedRow.removeAttr(\"checked\");\n      }\n      data.row.isEnabled = changedRow.get(0).outerHTML;\n    }\n  });\n\n  // Globals\n  var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService',\n    XWiki.EntityType.DOCUMENT);\n  var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n  var target = $('.systemFilterPreferences').attr('data-target');\n\n  var docURL = $('.systemFilterPreferences').attr('data-doc-url');\n  var postParams = {\n    action: 'setFilterPreferenceEnabled',\n    csrf: xm.form_token,\n    target: target\n  };\n  if (target == 'user') {\n    var targetUser = $('.systemFilterPreferences').attr('data-user');\n    postParams['user'] = targetUser;\n  };\n\n  var enhanceRow = function(row, data) {\n    // Enable / Disable action for classic filter preferences\n    $(row).find('.notificationFilterPreferenceCheckbox').off('switchChange.bootstrapSwitch.systemFilter')\n    .on('switchChange.bootstrapSwitch.systemFilter', function(event, state) {\n      var notif = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.filters.preferences.setEnabled.inProgress')), 'inprogress');\n      var params = {\n        filterPreferenceId: data.filterPreferenceId,\n        enabled: state\n      };\n      $.post(serviceURL, $.extend({}, params, postParams)).then(() =&gt; {\n        notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n          'notifications.filters.preferences.setEnabled.done')), 'done'));\n        $(document).trigger('xwiki:livetable:notifications-filters-system:toggle', {'row': data, 'state': state});\n      }).catch(() =&gt; {\n        notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n          'notifications.filters.preferences.setEnabled.error')), 'error'));\n      });\n    });\n    // Enable / Disable action for toggleable filter preferences\n    $(row).find('.toggleableFilterPreferenceCheckbox').each(function() {\n      new SystemToggleableFilterPreference(this, docURL, data);\n    });\n  };\n\n  // Callback on livetable row printing\n  $(document).on('xwiki:livetable:notificationSystemFilterPreferencesLiveTable:newrow', function(event, data) {\n    enhanceRow(data.row, data.data);\n  });\n\n  // Initializer\n  $(function() {\n    // This script is usually loaded after the live table is displayed and so the previous callback might not be called.\n    $('#notificationSystemFilterPreferencesLiveTable-display &gt; tr[data-index]').each(function() {\n      var data = window.livetable_notificationSystemFilterPreferencesLiveTable.fetchedRows[$(this).data('index')];\n      enhanceRow(this, data);\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>Filter Preferences Livetable Callback</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>0dbeaf20-9549-4eb2-99b9-95dc3fef916d</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#notificationSystemFilterPreferencesLiveTable select.pagesizeselect {\n  width: auto;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>NotificationFilterPreferences</name>\n    </property>\n    <property>\n      <parse/>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>3ed9f676-5c82-48c0-9082-1305822ba742</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{include reference=\"XWiki.Notifications.Code.NotificationsPreferencesMacros\" /}}\n\n{{velocity}}\n#checkMacroNotificationPreferencesParameters($checkResult)\n#if ($checkResult)\n#if ($wikimacro.parameters.target == \"wiki\")\n  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($services.model.createDocumentReference('', ['XWiki', 'Notifications', 'Code'], 'NotificationAdministration')))\"\"\")\n#else\n  #if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n  #else\n    #set ($targetUser = $xcontext.userReference)\n  #end\n  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($targetUser))\"\" data-user=\"\"$services.model.serialize($targetUser)\"\"\")\n#end\n######################################################\n### CSS and JAVASCRIPTS\n######################################################\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro'))\n#set ($discard = $xwiki.ssx.use('XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro'))\n## TODO: replace by $xwiki.sswx.use() or something like this when XWIKI-12788 is closed.\n#set ($discard = $xwiki.linkx.use($services.webjars.url('bootstrap-switch', 'css/bootstrap3/bootstrap-switch.min.css'), {'type': 'text/css', 'rel': 'stylesheet'}))\n######################################################\n### MACRO CONTENT\n######################################################\n{{html clean=\"false\"}}\n&lt;div class=\"systemFilterPreferences xform\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $divData&gt;\n  &lt;div class=\"row\"&gt;\n    &lt;p class=\"xHint col-xs-12 col-sm-9 col-md-8 col-lg-9\"&gt;\n      $escapetool.xml($services.localization.render('notifications.settings.filters.preferences.system.hint'))\n    &lt;/p&gt;\n  &lt;/div&gt;\n  #set($collist  = ['name', 'filterType', 'notificationFormats', 'isEnabled'])\n  #set($colprops = {\n    'name':                { 'sortable': false, 'html': true, 'filterable': false },\n    'filterType':          { 'sortable': false, 'filterable': false },\n    'notificationFormats': { 'sortable': false, 'html': true, 'filterable': false },\n    'isEnabled':           { 'sortable': false, 'html' : true, 'filterable': false }\n  })\n  #set ($extraParams = \"eventType=&amp;format=&amp;type=system\")\n  #if ($wikimacro.parameters.target == 'user')\n    #set ($extraParams = \"$extraParams&amp;user=${services.model.serialize($targetUser, 'default')}\")\n  #end\n  #set($options  = {\n    'resultPage'        : 'XWiki.Notifications.Code.NotificationFilterPreferenceLivetableResults',\n    'rowCount'          : 10,\n    'description'       : 'This table lists every system filter registered in the wiki.',\n    'translationPrefix' : 'notifications.settings.filters.preferences.system.table.',\n    'extraParams'       : $extraParams,\n    'outputOnlyHtml'    : true\n  })\n\n  #livetable(\"notificationSystemFilterPreferencesLiveTable\" $collist $colprops $options)\n&lt;/div&gt;\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the given user about system notification filters.</description>\n    </property>\n    <property>\n      <id>notificationsSystemFiltersPreferences</id>\n    </property>\n    <property>\n      <name>Notifications System Filters Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>d4798048-ddea-4fa6-a959-4a01d1e9bae9</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the filter preferences. This parameter is optional, default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>77306320-9711-4c7f-afd2-3c92b89fbf7c</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description>Target of the macro (could be \"user\" for the given user or \"wiki\" for the current wiki)</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n</xwikidoc>\n"], "fixing_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsApplicationsPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Notifications.Code.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsApplicationsPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>7243fde7-c9c7-4d40-bd63-8f0938d9d6cf</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>'use strict';\n/**\n * Start the real script.\n */\nrequire(['jquery', 'xwiki-meta', 'ApplicationWidget', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($, xm, ApplicationWidget) {\n\n  /**\n   * Page initialization\n   */\n  var preferenceInit = function (event) {\n\n    var applications = [];\n    if (event.data &amp;&amp; event.data.elements) {\n      var container = $(event.data.elements);\n    } else {\n      var container = $(document);\n    }\n\n    // Create application widgets\n    container.find('.applicationElem').each(function() {\n      applications.push(new ApplicationWidget($(this)));\n    });\n\n    /**\n     * Save the current settings\n     */\n    var save = function() {\n      // To avoid having several requests in the same time (which could lead to error 500), we disable all the triggers during the save process\n      var toggles = $('.bootstrap-switch input');\n      toggles.bootstrapSwitch('disabled', true);\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      var data = [];\n      for (var i = 0; i &lt; applications.length; ++i) {\n        for (var j = 0; j &lt; applications[i].eventTypes.length; j++) {\n          data.push({\n            eventType: applications[i].eventTypes[j].eventType,\n            format: 'alert',\n            enabled: applications[i].eventTypes[j].getAlertState()\n          });\n          // Email might be disabled, so we don't send info about the email settings if the corresponding buttons are not there\n          if ($('.notificationTypeCell[data-format=\"email\"]').length &gt; 0) {\n            data.push({\n              eventType: applications[i].eventTypes[j].eventType,\n              format: 'email',\n              enabled: applications[i].eventTypes[j].getEmailState()\n            });\n          }\n        }\n      }\n      var target = $('.notifPreferences').attr('data-target');\n      var targetUser = \"\";\n      if (target == 'user') {\n        var targetUser = $('.notifPreferences').attr('data-user');\n      }\n      var url = \"$xwiki.getURL('XWiki.Notifications.Code.NotificationPreferenceService', 'get', 'outputSyntax=plain')\";\n      Promise.resolve($.post(url, {\n        action: 'savePreferences',\n        target: $('.notifPreferences').attr('data-target'),\n        user: targetUser,\n        json: JSON.stringify(data),\n        csrf: xm.form_token\n      })).then(function() {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saved'))\", 'done');\n      }).catch(function() {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.savingfailed'))\", 'error');\n      }).finally(function() {\n        // Enable again the triggers\n        toggles.bootstrapSwitch('disabled', false);\n      });\n    };\n\n    /**\n     * Several changes can be received very closely (for example, when several switches are updated in the same time),\n     * so we save only the last received event.\n     * For that we postpone the save action (300ms is clone enought for the user) and we cancel it if an other event\n     * happens in the meantime.\n     */\n    var nextSave = 0;\n    $($('.notifPreferences')).off('switchChange.bootstrapSwitch').on('switchChange.bootstrapSwitch', function(event, state) {\n      if (nextSave != 0) {\n        clearTimeout(nextSave);\n      }\n      nextSave = setTimeout(save, 300);\n    });\n\n    // Disable the \"loading\" screens\n    $('td.notificationTypeCell, td.notificationAppCell').each(function(){\n      $(this).find('.hidden').removeClass('hidden');\n      $(this).removeClass('loading');\n    });\n\n    /**\n     * Disable the \"loading\" screens\n     */\n    $('td.notificationTypeCell').each(function(){\n      $(this).find('&gt; div.hidden').removeClass('hidden');\n      $(this).removeClass('loading');\n    });\n\n  };\n\n  $(preferenceInit);\n  $(document).on('xwiki:dom:updated', preferenceInit)\n});\n</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>67db5954-866d-4f6f-b94a-64e1a47eaeb6</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('EventTypeWidget', ['jquery', 'xwiki-meta', 'xwiki-bootstrap-switch'], function($, xm) {\n  /**\n  * Construct an EventTypeWidget.\n  */\n  return function(domElement, application) {\n    var self               = this;\n    self.domElement        = domElement;\n    self.application       = application;\n    self.eventType         = domElement.attr('data-eventtype');\n    self.cellAlert         = domElement.find('.notificationTypeCell[data-format=\"alert\"]');\n    self.cellEmail         = domElement.find('.notificationTypeCell[data-format=\"email\"]');\n    self.switchAlert       = self.cellAlert.find('.notificationTypeCheckbox');\n    self.switchEmail       = self.cellEmail.find('.notificationTypeCheckbox');\n    self.alertObjectNumber = self.cellAlert.attr('data-objnumber');\n    self.emailObjectNumber = self.cellEmail.attr('data-objnumber');\n\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // Replace the 'hidden' class by a call to jQuery.hide();\n      self.domElement.removeClass('hidden').hide();\n      // Enable bootstrap switches\n      $([self.switchAlert, self.switchEmail]).bootstrapSwitch({\n        size: 'mini',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n    };\n\n    // On change\n    $(self.switchAlert).on('switchChange.bootstrapSwitch', function(event, state) {\n      self.application.updateSwitches();\n    });\n    $(self.switchEmail).on('switchChange.bootstrapSwitch', function(event, state) {\n      self.application.updateSwitches();\n    });\n\n    /**\n     * Get the state of the alert switch\n     */\n    self.getAlertState = function() {\n      return self.switchAlert.bootstrapSwitch('state');\n    };\n\n    /**\n     * Get the state of the email switch\n     */\n    self.getEmailState = function() {\n      return self.switchEmail.bootstrapSwitch('state');\n    };\n\n    /**\n     * Set the state of the alert switch\n     */\n    self.setAlertState = function (state) {\n      self.switchAlert.bootstrapSwitch('state', state);\n    };\n\n    /**\n     * Set the state of the email switch\n     */\n    self.setEmailState = function (state) {\n      self.switchEmail.bootstrapSwitch('state', state);\n    };\n\n    /**\n     * Hide/Show the event type widget\n     */\n    self.toggleVisibility = function () {\n      self.domElement.toggle();\n    };\n\n    // Call init\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>Event Type Widget</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>2</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>0fd09e7a-bd3b-4b56-b903-5496788f6f9b</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('ApplicationWidget', ['jquery', 'EventTypeWidget', 'xwiki-bootstrap-switch'], function($, EventTypeWidget) {\n  /**\n   * Construct an application widget.\n   */\n  return function(domElement) {\n\n    var self             = this;\n    self.domElement      = domElement;\n    self.applicationId   = domElement.attr('data-applicationid');\n    self.cellAlert       = domElement.find('.notificationAppCell[data-format=\"alert\"]');\n    self.cellEmail       = domElement.find('.notificationAppCell[data-format=\"email\"]');\n    self.switchAlert     = self.cellAlert.find('.notificationAppCheckbox');\n    self.switchEmail     = self.cellEmail.find('.notificationAppCheckbox');\n    self.collapseButton  = domElement.find('.collapseButton');\n    self.eventTypes      = [];\n\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // Creates event type widgets for this application\n      self.domElement.find('.rowEventType').each(function() {\n        self.eventTypes.push(new EventTypeWidget($(this), self));\n      });\n      // Enable bootstrap switch.\n      $([self.switchAlert, self.switchEmail]).bootstrapSwitch({\n        size: 'small',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n      // Set initial state for the switches\n      self.updateSwitches();\n      self.updateTypesOnChange = true;\n      // Handle collapsing\n      // Make sure the click listener is registered only once.\n      self.collapseButton.off('click.toggleVisibility').on('click.toggleVisibility', function() {\n        for (var i = 0; i &lt; self.eventTypes.length; ++i) {\n          self.eventTypes[i].toggleVisibility();\n        }\n      });\n\n      // Handle switch change\n      self.switchAlert.on('switchChange.bootstrapSwitch', function(event, state) {\n        for (var i = 0; i &lt; self.eventTypes.length; ++i) {\n          self.eventTypes[i].setAlertState(state);\n        }\n      });\n      self.switchEmail.on('switchChange.bootstrapSwitch', function(event, state) {\n        for (var i = 0; i &lt; self.eventTypes.length; ++i) {\n          self.eventTypes[i].setEmailState(state);\n        }\n      });\n    };\n\n    /**\n     * Set the switch states according to their event type\n     */\n    self.updateSwitches = function() {\n      var allAlertsOn = true;\n      var allAlertsOff = true;\n      var allEmailsOn = true;\n      var allEmailsOff = true;\n      for (var i = 0; i &lt; self.eventTypes.length; ++i) {\n        var eventType = self.eventTypes[i];\n        allAlertsOn  &amp;=  eventType.getAlertState();\n        allAlertsOff &amp;= !eventType.getAlertState();\n        allEmailsOn  &amp;=  eventType.getEmailState();\n        allEmailsOff &amp;= !eventType.getEmailState();\n      }\n      if (allAlertsOn) {\n        self.switchAlert.bootstrapSwitch('state', true);\n      } else if (allAlertsOff) {\n        self.switchAlert.bootstrapSwitch('state', false);\n      } else {\n        self.switchAlert.bootstrapSwitch('indeterminate', true);\n      }\n      if (allEmailsOn) {\n        self.switchEmail.bootstrapSwitch('state', true);\n      } else if (allEmailsOff) {\n        self.switchEmail.bootstrapSwitch('state', false);\n      } else {\n        self.switchEmail.bootstrapSwitch('indeterminate', true);\n      }\n    };\n\n    // Call to init()\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>Application Widget</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>e2e07b42-f423-455b-8553-c51bbe9f2092</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>.notifPreferences tbody {\n  margin-top: 2em;\n}\n.notifPreferences .appOdd {\n  background: #e5e5e5;\n}\n.notifPreferences .appEven {\n  background: #fafafa;\n}\n.notifPreferences .rowApp td, .notifPreferences .rowApp th{\n  height: 3em;\n}\n.notifPreferences th:nth-child(1) {\n  vertical-align: top;\n  width: 250px;\n}\n.notificationAppCell {\n  vertical-align: top;\n  width: 33%;\n}\n.notificationCollapseButtonCell {\n  vertical-align: top;\n  text-align: right;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>NotificationPreferencesTable</name>\n    </property>\n    <property>\n      <parse/>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>8d0d26c4-d487-4d19-b8a1-688e6e9ee7b2</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{include reference=\"XWiki.Notifications.Code.NotificationsPreferencesMacros\" /}}\n\n{{velocity}}\n#checkMacroNotificationPreferencesParameters($checkResult)\n#if ($checkResult)\n######################################################\n### CSS and JAVASCRIPTS\n######################################################\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro'))\n#set ($discard = $xwiki.ssx.use('XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro'))\n## TODO: replace by $xwiki.sswx.use() or something like this when XWIKI-12788 is closed.\n#set ($discard = $xwiki.linkx.use($services.webjars.url('bootstrap-switch', 'css/bootstrap3/bootstrap-switch.min.css'), {'type': 'text/css', 'rel': 'stylesheet'}))\n######################################################\n### GLOBALS\n######################################################\n#if ($wikimacro.parameters.target != \"wiki\")\n  #if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n    #set ($targetUserReference = $wikimacro.parameters.user)\n  #else\n    #set ($targetUser = $xcontext.userReference)\n    #set ($targetUserReference = $services.user.currentUserReference)\n  #end\n  #set ($divData = \"data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n#end\n#set ($userDoc = $xwiki.getDocument($targetUser))\n######################################################\n### MACRO CONTENT\n######################################################\n{{html clean=\"false\"}}\n&lt;div class=\"xform\"&gt;\n&lt;p class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.applications.hint'))&lt;/p&gt;\n&lt;table class=\"notifPreferences\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $divData&gt;\n  &lt;thead&gt;\n    &lt;tr&gt;\n      &lt;th scope=\"col\"&gt;$escapetool.xml($services.localization.render('notifications.settings.applications.appName'))&lt;/th&gt;\n      &lt;th scope=\"col\"&gt;$services.icon.renderHTML('bell') $escapetool.xml($services.localization.render('notifications.settings.menu'))\n        &lt;small class=\"xHint\"&gt;$services.localization.render('notifications.settings.menu.hint', [$services.icon.renderHTML('bell')])&lt;/small&gt;\n      &lt;/th&gt;\n      #set ($colsCount = 2)\n      #if ($services.notification.areEmailsEnabled())\n        &lt;th scope=\"col\"&gt;$services.icon.renderHTML('envelope') $escapetool.xml($services.localization.render('notifications.settings.email'))\n          &lt;small class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.email.hint'))&lt;/small&gt;\n        &lt;/th&gt;\n        #set ($colsCount = 3)\n      #end\n      &lt;th scope=\"col\"&gt;&lt;/th&gt;\n    &lt;/tr&gt;\n  &lt;/thead&gt;\n  ##\n  ## Display all applications\n  ##\n  #set ($appClass = \"appOdd\")\n  #foreach ($app in $apps)\n    #displayApp($app)\n  #end\n&lt;/table&gt;\n&lt;/div&gt;\n\n#**\n * Display Application\n *#\n#macro(displayApp $app)\n  #set ($type = $app[0])\n  &lt;tbody class=\"applicationElem $appClass\" data-applicationid=\"$escapetool.xml($type.applicationId)\"&gt;\n    ##\n    ## Display the application row\n    ##\n    &lt;tr&gt;\n      ## Application Name and Icon\n      &lt;th scope=\"row\"&gt;\n        $type.applicationIcon $escapetool.xml($type.applicationName)\n      &lt;/th&gt;\n      ## Alert switch\n      &lt;td class=\"notificationAppCell loading\" data-format=\"alert\"&gt;\n        &lt;input type=\"checkbox\" class=\"notificationAppCheckbox hidden\"/&gt;\n      &lt;/td&gt;\n      ## Email switch\n      #if ($services.notification.areEmailsEnabled())\n        &lt;td class=\"notificationAppCell loading\" data-format=\"email\"&gt;\n          &lt;input type=\"checkbox\" class=\"notificationAppCheckbox hidden\"/&gt;\n        &lt;/td&gt;\n      #end\n      ## Collapse button\n      &lt;td class=\"notificationCollapseButtonCell\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-default btn-sm collapseButton\"&gt;$services.icon.renderHTML('caret-down')&lt;/button&gt;\n      &lt;/td&gt;\n    &lt;/tr&gt;\n    ##\n    ## Display all events of this application\n    ##\n    #foreach($type in $app)\n      &lt;tr class=\"rowEventType hidden\" data-eventtype=\"$type.eventType\"&gt;\n        &lt;td&gt;$escapetool.xml($type.description)&lt;/td&gt;\n        #displayPreference($type, 'alert')\n        #if ($services.notification.areEmailsEnabled())\n          #displayPreference($type, 'email')\n        #end\n        &lt;td&gt;&lt;/td&gt;\n      &lt;/tr&gt;\n    #end\n  &lt;/tbody&gt;\n  #if ($appClass == 'appOdd')\n    #set ($appClass = 'appEven')\n  #else\n    #set ($appClass = 'appOdd')\n  #end\n#end\n\n#**\n * Display a preference button for an event type and a given format\n *#\n#macro(displayPreference $type $format)\n  #set ($checked = '')\n  #set ($preference = '')\n  #if (($wikimacro.parameters.target == 'wiki' &amp;&amp; $services.notification.preferences.isEventTypeEnabled($type.eventType, $format, $services.wiki.currentWikiId)) ||\n    ($wikimacro.parameters.target == 'user' &amp;&amp; $services.notification.preferences.isEventTypeEnabledForUser($type.eventType, $format, $targetUserReference)))\n    #set ($checked = 'checked=\"checked\"')\n  #end\n  &lt;td class=\"notificationTypeCell loading\" data-eventtype=\"$!escapetool.xml($type.eventType)\" data-format=\"$format\" data-filter=\"${type.filter}\"&gt;\n    &lt;div class=\"hidden\"&gt;\n      &lt;input type=\"checkbox\" class=\"notificationTypeCheckbox\" $checked/&gt;\n    &lt;/div&gt;\n  &lt;/td&gt;\n#end\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the current user about notification applications.</description>\n    </property>\n    <property>\n      <id>notificationsApplicationsPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Applications Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>9d1dfbad-5ac6-4633-82c8-e9a152e0e657</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description>Target of the macro (could be \"user\" for the current user or \"wiki\" for the current wiki)</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsApplicationsPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>79c9b6f0-e62f-493d-9be6-49a58adc9e8d</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the application preferences. This parameter is optional, only used if the target parameter is set to ##user## and default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsAutoWatchPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Notifications.Code.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsAutoWatchPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>0cc3951e-8999-4723-9d67-c6ca7a80bd3e</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require(['jquery', 'xwiki-meta'], function ($, xm) {\n  // Make sure the change listener is not added twice.\n  $(document).off('change.notificationAutoWatchMode');\n  $(document).on('change.notificationAutoWatchMode', '.notificationAutoWatchMode', function() {\n    var input = $(this);\n    var target = input.data('target') === 'wiki' ? 'wiki' : 'user';\n    var notification = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n      'notifications.settings.saving')), 'inprogress');\n    var url = new XWiki.Document('NotificationPreferenceService', 'XWiki.Notifications.Code').getURL('get',\n      'outputSyntax=plain');\n    $.post(url, {\n      action: 'setAutoWatchMode',\n      mode: input.val(),\n      target: target,\n      user: input.data('user'),\n      csrf: xm.form_token\n    }).then(() =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.saved')), 'done'));\n    }).catch(() =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.savingfailed')), 'error'));\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>Automatic Page Watching</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>bdd88a72-eb41-468f-b39f-d687f9011ba3</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{velocity}}\n#if (!$services.notification.watch.isEnabled())\n  {{warning}}\n    {{localization key=\"notifications.settings.watch.disabled\" /}}\n  {{warning}}\n#elseif (!$xcontext.userReference)\n  {{info}}\n    {{translation key=\"notifications.settings.watch.forGuest\" /}}\n  {{/info}}\n#elseif ($wikimacro.parameters.target == 'wiki' &amp;&amp; !$hasAdmin)\n  {{error}}\n    {{translation key=\"notifications.settings.error.notAdmin\" /}}\n  {{/error}}\n#elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; $wikimacro.parameters.user.class.simpleName != 'DocumentUserReference')\n  {{error}}\n    {{translation key=\"notifications.settings.error.userReferenceNotSupported\" /}}\n  {{/error}}\n#elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n  {{error}}\n    {{translation key=\"notifications.settings.error.userReferenceAdminForbidden\" parameters=\"~\"${services.rendering.escape($escapetool.java($wikimacro.parameters.user), 'xwiki/2.1')}~\"\" /}}\n  {{/error}}\n#else\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro'))\n#if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n#else\n    #set ($targetUser = $xcontext.userReference)\n#end\n#set ($dataUser = \"\")\n#if ($wikimacro.parameters.target == 'user')\n  #set ($mode = $services.notification.watch.getAutomaticWatchMode($targetUser))\n  #set ($dataUser = \"data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n#else\n  #set ($mode = $services.notification.watch.defaultAutomaticWatchMode)\n#end\n{{html clean=\"false\"}}\n  &lt;div class=\"xform\"&gt;\n    &lt;dl&gt;\n      &lt;dt&gt;&lt;label&gt;$escapetool.xml($services.localization.render('notifications.settings.watch.autowatchmode'))&lt;/label&gt;\n      &lt;p class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.watch.autowatchmode.hint'))&lt;/p&gt;\n      &lt;/dt&gt;\n      &lt;dd&gt;\n        &lt;select class=\"notificationAutoWatchMode\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $dataUser&gt;\n          &lt;option value=\"NONE\" #if($mode == 'NONE')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.AutomaticWatchModeClass_automaticWatchMode_NONE'))&lt;/option&gt;\n          &lt;option value=\"ALL\"  #if($mode == 'ALL')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.AutomaticWatchModeClass_automaticWatchMode_ALL'))&lt;/option&gt;\n          &lt;option value=\"MAJOR\" #if($mode == 'MAJOR')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.AutomaticWatchModeClass_automaticWatchMode_MAJOR'))&lt;/option&gt;\n          &lt;option value=\"NEW\" #if($mode == 'NEW')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.AutomaticWatchModeClass_automaticWatchMode_NEW'))&lt;/option&gt;\n        &lt;/select&gt;\n      &lt;/dd&gt;\n    &lt;/dl&gt;\n  &lt;/div&gt;\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description/>\n    </property>\n    <property>\n      <id>notificationsAutoWatchPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Auto Watch Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>a6e9b8b7-bd0e-4090-b1e7-227704db0202</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description/>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsAutoWatchPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>d9ad825d-7241-4cc5-8ea9-3e4fc008b8a6</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the autowatch preferences. This parameter is optional, only used if the target parameter is set to ##user## and default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsCustomFiltersPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsCustomFiltersPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>65504b94-1ba9-40c1-aab9-79fa692cc57b</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>'use strict';\n/**\n * Start the real script.\n */\nrequire(['jquery', 'AddCustomNotificationFilterPreferenceLivetable', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($, AddCustomNotificationFilterPreferenceLivetable) {\n\n  /**\n   * Page initialization\n   */\n  $(function() {\n\n    new AddCustomNotificationFilterPreferenceLivetable($('#modal-add-custom-filter-preference'), window['livetable_notificationCustomFilterPreferencesLiveTable'], $('.customFilterPreferences button.btn-addfilter'),\n      $('.customFilterPreferences').attr('data-doc-url'));\n    var initBootstrapSwitches = function () {\n      $('#notificationCustomFilterPreferencesLiveTable .notificationFilterPreferenceCheckbox, #notificationCustomFilterPreferencesLiveTable .toggleableFilterPreferenceCheckbox').bootstrapSwitch({\n        size: 'mini',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n    };\n    $(document).on('xwiki:livetable:displayComplete', function (event, data) {\n      // Enable bootstrap switches\n      initBootstrapSwitches();\n    });\n    initBootstrapSwitches();\n\n  });\n});\n</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>689554cf-0101-4b9d-b4d6-a8412152bea1</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('AddCustomNotificationFilterPreferenceLivetable', ['jquery', 'xwiki-meta', 'bootstrap'], function($, xm) {\n\n  return function(modal, filterPreferencesLivetable, buttonAddFilter, docURL) {\n    var self = this;\n    self.modal = modal;\n    self.filterPreferencesLivetable = filterPreferencesLivetable;\n    self.buttonAddFilter = buttonAddFilter;\n    self.docURL = docURL;\n    self.filterTypeSelector = modal.find('select#notificationFilterTypeSelector');\n    self.eventTypeSelector = modal.find('select#notificationFilterEventTypeSelector');\n    self.filterScopeTree = modal.find('.location-tree');\n    self.cancelButton = modal.find('button[data-action=\"cancel\"]');\n    self.submitButton = modal.find('button[data-action=\"submit\"]');\n\n    self.getFormats = function () {\n      return self.modal.find('input[name=notificationFilterNotificationFormatSelector]:checked').map(function () { return $(this).val();}).get().join(',');\n    };\n\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      self.buttonAddFilter.on('click', function() {\n        self.filterScopeTree.xtree();\n        self.submitButton.prop('disabled', 'disabled');\n\n        self.filterScopeTree.on('changed.jstree', function(e, data) {\n          if (data.selected.length &gt; 0 &amp;&amp; self.getFormats() !== \"\") {\n            self.submitButton.prop('disabled', '');\n          }\n        });\n      });\n\n      self.submitButton.on('click', self.onSelectButtonClicked);\n    };\n\n    /**\n     * On \"submit\" button clicked\n     */\n    self.onSelectButtonClicked = function() {\n      self.modal.modal('toggle');\n\n      var tree = $.jstree.reference(self.filterScopeTree);\n      var nodes = tree.get_selected(true);\n\n      var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService', XWiki.EntityType.DOCUMENT);\n      var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n      var eventTypesSelected = self.eventTypeSelector.val();\n      var eventTypes;\n      if (eventTypesSelected != null &amp;&amp; eventTypesSelected.length &gt; 0) {\n        eventTypes = eventTypesSelected.join(',');\n      }\n      var target = self.modal.data('target');\n\n      var params = {\n        action: 'createScopeFilterPreference',\n        target: target,\n        filterType: self.filterTypeSelector.val(),\n        filterFormats: self.getFormats(),\n        eventTypes: eventTypes,\n        csrf: xm.form_token,\n        wiki: [],\n        space: [],\n        page: []\n      }\n      if (target == 'user') {\n        params['user'] = self.modal.data('user');\n      }\n\n      for (var i = 0; i &lt; nodes.length; ++i) {\n        var node = nodes[i];\n        var reference = node.data.id;\n        if (node.data.type == 'wiki') {\n          params['wiki'].push(reference);\n        } else if (node.data.type == 'document' &amp;&amp; node.data.id.match('WebHome$')) {\n          params['space'].push(reference.substring(0, reference.length - '.WebHome'.length));\n        } else {\n          params['page'].push(reference);\n        }\n      }\n\n      // Saving\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      // We use a \"traditional: true\" argument here to be sure that the argument names are not transformed to wiki[] etc by jquery. For more info see doc about $.param.\n      $.post({\n        url: serviceURL,\n        data: params,\n        traditional: true\n      }).then(data =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saved'))\", 'done');\n\n        // Reload the livetable\n        self.filterPreferencesLivetable.refresh();\n      }).catch(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.savingfailed'))\", 'error');\n      });\n    };\n\n    // Call init()\n    self.init();\n  };\n\n});\n</code>\n    </property>\n    <property>\n      <name>Add Notification Filter Preference Livetable</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>2</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>c4eea5ea-c958-4870-9eec-6f0d90818465</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('CustomToggleableFilterPreference', ['jquery', 'xwiki-bootstrap-switch'], function($) {\n  /**\n  * Construct the Toggleable Filter Preference object.\n  */\n  return function(domElement, docURL, row) {\n    var self               = this;\n    self.domElement        = $(domElement);\n    self.docURL           = docURL;\n    self.row               = row;\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // On change\n      self.domElement.off('switchChange.bootstrapSwitch.customFilter')\n        .on('switchChange.bootstrapSwitch.customFilter', function(event, state) {\n          setTimeout(function() { self.save(state); }, 1);\n        });\n    };\n\n    /**\n     * Save the filter preference\n     */\n    self.save = function(state) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      var filterName = self.domElement.attr('data-filterName');\n      var objectNumber = self.domElement.attr('data-objectNumber');\n      if (objectNumber == '') {\n        // If the object does not exist yet, create it (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.docURL + '/objects?media=json&amp;minorRevision=true';\n        var params = {\n          'className': 'XWiki.Notifications.Code.ToggleableFilterPreferenceClass',\n          'property#filterName': filterName,\n          'property#isEnabled': state ? '1' : '0'\n        };\n        $.post(restURL, params).then(data =&gt; {\n          self.domElement.attr('data-objectNumber', data.number);\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      } else if (objectNumber != '') {\n        // If the object already exist, just update its value (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.docURL + '/objects/XWiki.Notifications.Code.ToggleableFilterPreferenceClass/' + objectNumber\n          + '/properties/isEnabled?media=json&amp;minorRevision=true';\n        $.ajax(restURL, {\n          method: 'PUT',\n          contentType: 'text/plain',\n          data: state ? '1' : '0'\n        }).then(data =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n          $(document).trigger('xwiki:livetable:notifications-filters-custom:toggle', {'row': self.row, 'state': state});\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      }\n    };\n\n    // Call init\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>Custom Toggleable Filter Preference</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>3</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>e91b3d46-cc48-4d58-ae70-8303b46b8557</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require([\n  'jquery',\n  'xwiki-meta',\n  'CustomToggleableFilterPreference',\n  'xwiki-bootstrap-switch',\n  'xwiki-events-bridge'\n], function ($, xm, CustomToggleableFilterPreference) {\n\n  $(document).on('xwiki:livetable:notifications-filters-custom:toggle', function(event, data) {\n    var changedRow = $(data.row.isEnabled);\n    if (changedRow.length &gt; 0) {\n      if (data.state) {\n        changedRow.attr(\"checked\", \"checked\");\n      } else {\n        changedRow.removeAttr(\"checked\");\n      }\n      data.row.isEnabled = changedRow.get(0).outerHTML;\n    }\n  });\n\n  // Globals\n  var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService',\n    XWiki.EntityType.DOCUMENT);\n  var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n  var target = $('.customFilterPreferences').attr('data-target');\n\n  var docURL = $('.customFilterPreferences').attr('data-doc-url');\n  var postParams = {\n    csrf: xm.form_token,\n    target: target\n  };\n  if (target == 'user') {\n    var targetUser = $('.customFilterPreferences').attr('data-user');\n    postParams['user'] = targetUser;\n  };\n\n  var enhanceRow = function(row, data) {\n    // Delete action\n    $(row).find('a.actiondelete').off('click.deleteCustomFilter').on('click.deleteCustomFilter', function(event) {\n      event.preventDefault();\n      new XWiki.widgets.ConfirmationBox({\n        onYes: function() {\n          var notif = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n            'notifications.filters.preferences.delete.inProgress')), 'inprogress');\n          var params = {\n            action: 'deleteFilterPreference',\n            filterPreferenceId: data.filterPreferenceId\n          };\n          $.post(serviceURL, $.extend({}, params, postParams)).then(() =&gt; {\n            notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n              'notifications.filters.preferences.delete.done')), 'done'));\n            window.livetable_notificationCustomFilterPreferencesLiveTable.refresh();\n          }).catch(() =&gt; {\n            notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n              'notifications.filters.preferences.delete.error')), 'error'));\n          });\n        }\n      });\n    });\n    // Enable / Disable action for classic filter preferences\n    $(row).find('.notificationFilterPreferenceCheckbox').off('switchChange.bootstrapSwitch.customFilter')\n    .on('switchChange.bootstrapSwitch.customFilter', function(event, state) {\n      var notif = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.filters.preferences.setEnabled.inProgress')), 'inprogress');\n      var params = {\n        action: 'setFilterPreferenceEnabled',\n        filterPreferenceId: data.filterPreferenceId,\n        enabled: state\n      };\n      $.post(serviceURL, $.extend({}, params, postParams)).then(() =&gt; {\n        notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n          'notifications.filters.preferences.setEnabled.done')), 'done'));\n        $(document).trigger('xwiki:livetable:notifications-filters-custom:toggle', {'row': data, 'state': state});\n      }).catch(() =&gt; {\n        notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n          'notifications.filters.preferences.setEnabled.error')), 'error'));\n      });\n    });\n    // Enable / Disable action for toggleable filter preferences\n    $(row).find('.toggleableFilterPreferenceCheckbox').each(function() {\n      new CustomToggleableFilterPreference(this, docURL, data);\n    });\n  };\n\n  // Callback on livetable row printing\n  $(document).on('xwiki:livetable:notificationCustomFilterPreferencesLiveTable:newrow', function(event, data) {\n    enhanceRow(data.row, data.data);\n  });\n\n  // Initializer\n  $(function() {\n    // This script is usually loaded after the live table is displayed and so the previous callback might not be called.\n    $('#notificationCustomFilterPreferencesLiveTable-display &gt; tr[data-index]').each(function() {\n      var data = window.livetable_notificationCustomFilterPreferencesLiveTable.fetchedRows[$(this).data('index')];\n      enhanceRow(this, data);\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>Filter Preferences Livetable Callback</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>78413304-d950-417e-8b11-094a771546e4</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#notificationCustomFilterPreferencesLiveTable select.pagesizeselect {\n  width: auto;\n}\n\n.modal-description {\n   .text-muted-smaller;\n    font-weight: 400;\n    text-transform: none;\n}</code>\n    </property>\n    <property>\n      <contentType>LESS</contentType>\n    </property>\n    <property>\n      <name>NotificationFilterPreferences</name>\n    </property>\n    <property>\n      <parse/>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>0e9925d3-1a0b-4203-be02-e795f7801368</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{template name=\"locationPicker_macros.vm\" /}}\n\n{{include reference=\"XWiki.Notifications.Code.NotificationsPreferencesMacros\" /}}\n\n{{velocity}}\n#checkMacroNotificationPreferencesParameters($checkResult)\n#if ($checkResult)\n#if ($wikimacro.parameters.target == \"wiki\")\n  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($services.model.createDocumentReference('', ['XWiki', 'Notifications', 'Code'], 'NotificationAdministration')))\"\"\")\n#else\n  #if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n  #else\n    #set ($targetUser = $xcontext.userReference)\n  #end\n  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($targetUser))\"\" data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n#end\n######################################################\n### CSS and JAVASCRIPTS\n######################################################\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro'))\n#set ($discard = $xwiki.ssx.use('XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro'))\n## TODO: replace by $xwiki.sswx.use() or something like this when XWIKI-12788 is closed.\n#set ($discard = $xwiki.linkx.use($services.webjars.url('bootstrap-switch', 'css/bootstrap3/bootstrap-switch.min.css'), {'type': 'text/css', 'rel': 'stylesheet'}))\n######################################################\n### MACRO CONTENT\n######################################################\n{{html clean=\"false\"}}\n&lt;div class=\"customFilterPreferences xform\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $divData&gt;\n  &lt;div class=\"row\"&gt;\n    &lt;p class=\"xHint col-xs-12 col-sm-9 col-md-8 col-lg-9\"&gt;\n      $escapetool.xml($services.localization.render('notifications.settings.filters.preferences.custom.hint'))\n    &lt;/p&gt;\n    &lt;div class=\"col-xs-12 col-sm-3 col-md-4 col-lg-3 text-right\"&gt;\n      &lt;button type=\"button\" class=\"btn btn-default btn-addfilter\" data-target=\"#modal-add-custom-filter-preference\" data-toggle=\"modal\"&gt;\n        &lt;span class=\"fa fa-plus\"&gt;&lt;/span&gt;&amp;nbsp;$escapetool.xml($services.localization.render('notifications.settings.addFilter'))\n      &lt;/button&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  #set($collist  = ['name', 'filterType', 'eventTypes', 'notificationFormats', 'isEnabled', '_actions'])\n  #set($colprops = {\n    'name':                { 'sortable': false, 'html': true, 'filterable': false },\n    'filterType':          { 'sortable': false, 'filterable': false },\n    'eventTypes':          { 'sortable': false, 'html': true, 'filterable': false },\n    'notificationFormats': { 'sortable': false, 'html': true, 'filterable': false },\n    'isEnabled':           { 'sortable': false, 'html' : true, 'filterable': false },\n    '_actions':            { 'sortable': false, 'actions': ['delete'], 'filterable': false}\n  })\n  #set ($extraParams = \"eventType=&amp;format=&amp;type=custom\")\n  #if ($wikimacro.parameters.target == 'user')\n    #set ($extraParams = \"$extraParams&amp;user=${services.model.serialize($targetUser, 'default')}\")\n  #end\n  #set($options  = {\n    'resultPage'        : 'XWiki.Notifications.Code.NotificationFilterPreferenceLivetableResults',\n    'rowCount'          : 10,\n    'description'       : 'This table lists every custom filter registered for the given user or current wiki.',\n    'translationPrefix' : 'notifications.settings.filters.preferences.custom.table.',\n    'extraParams'       : $extraParams,\n    'outputOnlyHtml'    : true\n  })\n\n  #livetable(\"notificationCustomFilterPreferencesLiveTable\" $collist $colprops $options)\n&lt;/div&gt;\n######################################################\n### ADD FILTER MODAL\n######################################################\n&lt;div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" id=\"modal-add-custom-filter-preference\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $divData&gt;\n  &lt;div class=\"modal-dialog\" role=\"document\"&gt;\n    &lt;div class=\"modal-content\"&gt;\n      &lt;div class=\"modal-header\"&gt;\n        &lt;button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"&gt;&lt;span aria-hidden=\"true\"&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;\n        &lt;div class=\"modal-title\"&gt;$escapetool.xml($services.localization.render('notifications.settings.addFilter'))&lt;/div&gt;\n        &lt;div class=\"modal-description\"&gt;$escapetool.xml($services.localization.render('notifications.settings.addFilter.hint'))&lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"modal-body\"&gt;\n        &lt;div class=\"xform\"&gt;\n          &lt;dl class=\"location-picker\"&gt;\n            &lt;dt&gt;\n              &lt;label&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.location.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.location.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd class=\"document-tree\"&gt;\n              #documentTree({\n                'class': 'location-tree',\n                'finder': true,\n                'showAttachments': false,\n                'showRoot': false,\n                'showTerminalDocuments': true,\n                'showTranslations': false,\n                'showWikis': true\n              })\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterTypeSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.type.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.type.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterTypeSelector\" name=\"notificationFilterTypeSelector\" size=\"1\"&gt;\n                &lt;option value=\"inclusive\" selected=\"selected\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.filterType.inclusive'))&lt;/option&gt;\n                &lt;option value=\"exclusive\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.filterType.exclusive'))&lt;/option&gt;\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterEventTypeSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.eventType.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.eventType.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterEventTypeSelector\" name=\"notificationFilterEventTypeSelector\" size=\"5\" multiple&gt;\n                #foreach ($app in $apps)\n                  #set ($type = $app[0])\n                  &lt;optgroup label=\"$escapetool.xml($type.applicationName)\"&gt;\n                  #foreach($descriptor in $app)\n                    &lt;option value=\"$escapetool.xml($descriptor.eventType)\"&gt;$escapetool.xml($services.localization.render($descriptor.description))&lt;/option&gt;\n                  #end\n                  &lt;/optgroup&gt;\n                #end\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;span class=\"label\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.notificationFormat.label'))&lt;/span&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.custom.addFilter.notificationFormat.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;input type=\"checkbox\" id=\"notificationFilterNotificationFormatSelector_alert\" name=\"notificationFilterNotificationFormatSelector\" value=\"alert\" checked=\"checked\" /&gt;\n              &lt;label for=\"notificationFilterNotificationFormatSelector_alert\"&gt;$escapetool.xml($services.localization.render('notifications.format.alert'))&lt;/label&gt;\n              &lt;br /&gt;\n              &lt;input type=\"checkbox\" id=\"notificationFilterNotificationFormatSelector_email\" name=\"notificationFilterNotificationFormatSelector\" value=\"email\" checked=\"checked\" /&gt;\n              &lt;label for=\"notificationFilterNotificationFormatSelector_email\"&gt;$escapetool.xml($services.localization.render('notifications.format.email'))&lt;/label&gt;\n            &lt;/dd&gt;\n          &lt;/dl&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"modal-footer\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-default\" data-action=\"cancel\" data-dismiss=\"modal\"&gt;$services.localization.render('notifications.filters.cancel')&lt;/button&gt;\n        &lt;button type=\"button\" class=\"btn btn-primary\" data-action=\"submit\" disabled=\"disabled\"&gt;$services.localization.render('notifications.filters.submit')&lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;&lt;!-- /.modal-content --&gt;\n  &lt;/div&gt;&lt;!-- /.modal-dialog --&gt;\n&lt;/div&gt;&lt;!-- /.modal --&gt;\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the given user about custom notification filters.</description>\n    </property>\n    <property>\n      <id>notificationsCustomFiltersPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Custom Filters Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>60838ffa-0f48-4c1b-9244-1435f02914af</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the filter preferences. This parameter is optional, default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsCustomFiltersPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>a2b19666-5ac4-452c-a1d9-cfb74e7ac4ed</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description>Target of the macro (could be \"user\" for the given user or \"wiki\" for the current wiki)</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsEmailPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsEmailPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Notifications.Code.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsEmailPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsEmailPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>9267c736-6acc-410a-9f61-2aeb625de28d</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require(['jquery', 'xwiki-meta'], function ($, xm) {\n  'use strict';\n\n  /**\n   * Handle the notification email interval.\n   */\n  $(document).off('change.notificationEmailInterval');\n  $(document).on('change.notificationEmailInterval', '.notificationEmailInterval', function() {\n    var intervalSelect = $(this);\n    var notification = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n      'notifications.settings.saving')), 'inprogress');\n    var serviceURL = new XWiki.Document(XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService',\n      XWiki.EntityType.DOCUMENT)).getURL('get', 'outputSyntax=plain');\n    var target = $('.notifEmailPreferences').attr('data-target');\n    var targetUser = target === 'user' ? $('.notifEmailPreferences').attr('data-user') : '';\n    $.post(serviceURL, {\n      'action': 'setInterval',\n      'interval': intervalSelect.val(),\n      'target': target,\n      'user': targetUser,\n      'csrf': xm.form_token\n    }).then(data =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.saved')), 'done'));\n    }).catch(() =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.savingfailed')), 'error'));\n    });\n  });\n\n  /**\n   * Handle the include diff in email setting\n   */\n  $(document).off('change.notificationEmailDiffType');\n  $(document).on('change.notificationEmailDiffType', '.notificationEmailDiffType', function() {\n    var diffTypeSelect = $(this);\n    var notification = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n      'notifications.settings.saving')), 'inprogress');\n    var serviceURL = new XWiki.Document(XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService',\n      XWiki.EntityType.DOCUMENT)).getURL('get', 'outputSyntax=plain');\n    var target = $('.notifEmailPreferences').attr('data-target');\n    var targetUser = target === 'user' ? $('.notifEmailPreferences').attr('data-user') : '';\n    $.post(serviceURL, {\n      'action': 'setDiffType',\n      'diffType': diffTypeSelect.val(),\n      'target': target,\n      'user': targetUser,\n      'csrf': xm.form_token\n    }).then(data =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.saved')), 'done'));\n    }).catch(() =&gt; {\n      notification.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.settings.savingfailed')), 'error'));\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsEmailPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>1646274b-9c55-419e-a3d9-f6e1eb1fca31</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{velocity}}\n#if (!$services.notification.areEmailsEnabled())\n  {{warning}}\n    {{localization key=\"notifications.settings.email.disabled\" /}}\n  {{warning}}\n#elseif (!$xcontext.userReference)\n  {{info}}\n    {{translation key=\"notifications.settings.email.forGuest\" /}}\n  {{/info}}\n#elseif ($wikimacro.parameters.target == 'wiki' &amp;&amp; !$hasAdmin)\n  {{error}}\n    {{translation key=\"notifications.settings.error.notAdmin\" /}}\n  {{/error}}\n#elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; $wikimacro.parameters.user.class.simpleName != 'DocumentUserReference')\n  {{error}}\n    {{translation key=\"notifications.settings.error.userReferenceNotSupported\" /}}\n  {{/error}}\n#elseif ($wikimacro.parameters.target == 'user' &amp;&amp; \"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n  {{error}}\n    {{translation key=\"notifications.settings.error.userReferenceAdminForbidden\" parameters=\"$~\"${services.rendering.escape($escapetool.java($wikimacro.parameters.user), 'xwiki/2.1')}~\"\" /}}\n  {{/error}}\n#else\n  \n  #if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n  #else\n    #set ($targetUser = $xcontext.userReference)\n  #end\n  #set ($dataUser = \"\")\n  #if ($wikimacro.parameters.target == 'user')\n    #set ($dataUser = \"data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n  #end\n  #set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsEmailPreferencesMacro'))\n  {{html clean=\"false\"}}\n    &lt;div class=\"notification-top-panel-preferences notifEmailPreferences\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $dataUser&gt;\n      &lt;div class=\"xform\"&gt;\n        ## TODO: handle the interval for the wiki target too\n        #if ($wikimacro.parameters.target == 'user')\n        &lt;dl&gt;\n          &lt;dt&gt;&lt;label&gt;$escapetool.xml($services.localization.render('notifications.settings.email.frequency'))&lt;/label&gt;\n          &lt;p class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.email.frequency.hint'))&lt;/p&gt;\n          &lt;/dt&gt;\n          &lt;dd&gt;\n            #set ($targetDocument = $xwiki.getDocument($targetUser))\n            #set ($interval = 'daily')\n            #set ($objPref = $targetDocument.getObject('XWiki.Notifications.Code.NotificationEmailPreferenceClass'))\n            #if (\"$!objPref\" != '')\n              #set ($objInterval = $objPref.getValue('interval'))\n              #if (\"$!objInterval\" != '')\n                #set ($interval = $objInterval)\n              #end\n            #end\n            &lt;select class=\"notificationEmailInterval\"&gt;\n              &lt;option value=\"hourly\" #if($interval == 'hourly')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_interval_hourly'))&lt;/option&gt;\n              &lt;option value=\"daily\"  #if($interval == 'daily')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_interval_daily'))&lt;/option&gt;\n              &lt;option value=\"weekly\" #if($interval == 'weekly')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_interval_weekly'))&lt;/option&gt;\n              &lt;option value=\"live\" #if($interval == 'live')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_interval_live'))&lt;/option&gt;\n            &lt;/select&gt;\n          &lt;/dd&gt;\n        &lt;/dl&gt;\n        #else\n          #set ($targetDocument = $xwiki.getDocument($services.model.createDocumentReference('', ['XWiki', 'Notifications', 'Code'], 'NotificationAdministration')))\n        #end\n        &lt;dl&gt;\n          &lt;dt&gt;&lt;label&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_diffType'))&lt;/label&gt;\n          &lt;p class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.settings.email.diffType.hint'))&lt;/p&gt;\n          &lt;/dt&gt;\n          &lt;dd&gt;\n            #if ($wikimacro.parameters.target == 'user')\n              #set ($diffType = $services.notification.preferences.getDiffType($targetUser))\n            #else\n              #set ($diffType = $services.notification.preferences.getDiffType())\n            #end\n            #set ($objPref = $targetDocument.getObject('XWiki.Notifications.Code.NotificationEmailPreferenceClass'))\n            #if (\"$!objPref\" != '')\n              #set ($objDiffType = $objPref.getValue('diffType'))\n              #if (\"$!objDiffType\" != '')\n                #set ($diffType = $objDiffType)\n              #end\n            #end\n            &lt;select class=\"notificationEmailDiffType\"&gt;\n              &lt;option value=\"NOTHING\" #if($diffType == 'NOTHING')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_diffType_NOTHING'))&lt;/option&gt;\n              &lt;option value=\"STANDARD\"  #if($diffType == 'STANDARD')selected=\"selected\"#end&gt;$escapetool.xml($services.localization.render('XWiki.Notifications.Code.NotificationEmailPreferenceClass_diffType_STANDARD'))&lt;/option&gt;\n            &lt;/select&gt;\n          &lt;/dd&gt;\n        &lt;/dl&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  {{/html}}\n#end\n{{/velocity}}\n</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the current user about notification emails.</description>\n    </property>\n    <property>\n      <id>notificationsEmailPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Email Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsEmailPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>02bb1d4d-2854-48e0-997e-6462d024d243</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description/>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsEmailPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>4e7e7ddc-bbda-48ac-b9ee-eeb0d2b2afbe</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the email preferences. This parameter is optional, only used if the target parameter is set to ##user## and default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsFiltersPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Notifications.Code.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsFiltersPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>35d1d8c7-f9e7-4cad-a505-5e46ddaf5d79</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>'use strict';\n/**\n * Start the real script.\n */\nrequire(['jquery', 'AddNotificationFilterPreferenceLivetable', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($, AddNotificationFilterPreferenceLivetable) {\n\n  /**\n   * Page initialization\n   */\n  $(function() {\n\n    new AddNotificationFilterPreferenceLivetable($('#modal-add-filter-preference'), window['livetable_notificationFilterPreferencesLiveTable'], $('.filterPreferences button.btn-addfilter'),\n      $('.filterPreferences').attr('data-user-url'));\n    var initBootstrapSwitches = function () {\n      $('#notificationFilterPreferencesLiveTable .notificationFilterPreferenceCheckbox, #notificationFilterPreferencesLiveTable .toggleableFilterPreferenceCheckbox').bootstrapSwitch({\n        size: 'mini',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n    };\n    $(document).on('xwiki:livetable:displayComplete', function (event, data) {\n      // Enable bootstrap switches\n      initBootstrapSwitches();\n    });\n    initBootstrapSwitches();\n\n  });\n});\n</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>19d1a6ca-02cf-41f5-81fb-415e557974dc</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('AddNotificationFilterPreferenceLivetable', ['jquery', 'xwiki-meta', 'bootstrap'], function($, xm) {\n\n  return function(modal, filterPreferencesLivetable, buttonAddFilter, userURL) {\n    var self = this;\n    self.modal = modal;\n    self.filterPreferencesLivetable = filterPreferencesLivetable;\n    self.buttonAddFilter = buttonAddFilter;\n    self.userURL = userURL;\n    self.filterTypeSelector = modal.find('select#notificationFilterTypeSelector');\n    self.eventTypeSelector = modal.find('select#notificationFilterEventTypeSelector');\n    self.notificationFormatSelector = modal.find('select#notificationFilterNotificationFormatSelector');\n    self.filterScopeTree = modal.find('.location-tree');\n    self.cancelButton = modal.find('button[data-action=\"cancel\"]');\n    self.submitButton = modal.find('button[data-action=\"submit\"]');\n\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      self.buttonAddFilter.on('click', function() {\n        self.filterScopeTree.xtree();\n        self.submitButton.prop('disabled', 'disabled');\n\n        self.filterScopeTree.on('changed.jstree', function(e, data) {\n          if (data.selected.length &gt; 0) {\n            self.submitButton.prop('disabled', '');\n          }\n        });\n      });\n\n      self.submitButton.on('click', self.onSelectButtonClicked);\n    };\n\n    /**\n     * On \"submit\" button clicked\n     */\n    self.onSelectButtonClicked = function() {\n      self.modal.modal('toggle');\n\n      var tree = $.jstree.reference(self.filterScopeTree);\n      var nodes = tree.get_selected(true);\n\n      var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService', XWiki.EntityType.DOCUMENT);\n      var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n\n      var eventTypesSelected = self.eventTypeSelector.val();\n      var eventTypes;\n      if (eventTypesSelected != null &amp;&amp; eventTypesSelected.length &gt; 0) {\n        eventTypes = eventTypesSelected.join(',');\n      }\n      var params = {\n        action: 'createScopeFilterPreference',\n        target: 'user',\n        user: self.modal.data('user'),\n        filterType: self.filterTypeSelector.val(),\n        filterFormats: self.notificationFormatSelector.val().join(','),\n        eventTypes: eventTypes,\n        csrf: xm.form_token,\n        wiki: [],\n        space: [],\n        page: []\n      }\n\n      for (var i = 0; i &lt; nodes.length; ++i) {\n        var node = nodes[i];\n        var reference = node.data.id;\n        if (node.data.type == 'wiki') {\n          params['wiki'].push(reference);\n        } else if (node.data.type == 'document' &amp;&amp; node.data.id.match('WebHome$')) {\n          params['space'].push(reference.substring(0, reference.length - '.WebHome'.length));\n        } else {\n          params['page'].push(reference);\n        }\n      }\n\n      // Saving\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      // We use a \"traditional: true\" argument here to be sure that the argument names are not transformed to wiki[] etc by jquery. For more info see doc about $.param.\n      $.post({\n        url: serviceURL,\n        data: params,\n        traditional: true\n      }).then(data =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saved'))\", 'done');\n\n        // Reload the livetable\n        self.filterPreferencesLivetable.refresh();\n      }).catch(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.savingfailed'))\", 'error');\n      });\n    };\n\n    // Call init()\n    self.init();\n  };\n\n});\n</code>\n    </property>\n    <property>\n      <name>Add Notification Filter Preference Livetable</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>2</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>53f67179-890e-4d1f-aec6-69873f9f87f4</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('ToggleableFilterPreference', ['jquery', 'xwiki-bootstrap-switch'], function($) {\n  /**\n  * Construct the Toggleable Filter Preference object.\n  */\n  return function(domElement, userURL, row) {\n    var self               = this;\n    self.domElement        = $(domElement);\n    self.userURL           = userURL;\n    self.row               = row;\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // On change\n      self.domElement.on('switchChange.bootstrapSwitch', function(event, state) {\n        setTimeout(function() { self.save(state); }, 1);\n      });\n    };\n\n    /**\n     * Save the filter preference\n     */\n    self.save = function(state) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      var filterName = self.domElement.attr('data-filterName');\n      var objectNumber = self.domElement.attr('data-objectNumber');\n      if (objectNumber == '') {\n        // If the object does not exist yet, create it (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.userURL + '/objects?media=json&amp;minorRevision=true';\n        var params = {\n          'className': 'XWiki.Notifications.Code.ToggleableFilterPreferenceClass',\n          'property#filterName': filterName,\n          'property#isEnabled': state ? '1' : '0'\n        };\n        $.post(restURL, params).then(data =&gt; {\n          self.domElement.attr('data-objectNumber', data.number);\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      } else if (objectNumber != '') {\n        // If the object already exist, just update its value (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.userURL + '/objects/XWiki.Notifications.Code.ToggleableFilterPreferenceClass/' + objectNumber\n          + '/properties/isEnabled?media=json&amp;minorRevision=true';\n        $.ajax(restURL, {\n          method: 'PUT',\n          contentType: 'text/plain',\n          data: state ? '1' : '0'\n        }).then(data =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n          $(document).trigger('xwiki:livetable:notifications-filters:toggle', {'row': self.row, 'state': state});\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      }\n    };\n\n    // Call init\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>Toggleable Filter Preference</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>3</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>de91de12-11fa-4ec8-9e37-1d231500dedb</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require(['jquery', 'xwiki-meta', 'ToggleableFilterPreference', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($, xm, ToggleableFilterPreference) {\n\n  $(document).on('xwiki:livetable:notifications-filters:toggle', function(event, data) {\n    var changedRow = $(data.row.isEnabled);\n    if (changedRow.length &gt; 0) {\n      if (data.state) {\n        changedRow.attr(\"checked\", \"checked\");\n      } else {\n        changedRow.removeAttr(\"checked\");\n      }\n      data.row.isEnabled = changedRow.get(0).outerHTML;\n    }\n  });\n\n  // Globals\n  var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService', XWiki.EntityType.DOCUMENT);\n  var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n  var userURL = $('.filterPreferences').attr('data-user-url');\n  var targetUser = $('.filterPreferences').attr('data-user');\n\n  // Callback on livetable row printing\n  $(document).on('xwiki:livetable:notificationFilterPreferencesLiveTable:newrow', function(event, data) {\n    // Delete action\n    $(data.row).find('a.actiondelete').on('click', function(event) {\n      event.preventDefault();\n      new XWiki.widgets.ConfirmationBox({\n        onYes: function() {\n          var notif = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.delete.inProgress'))\", 'inprogress');\n          $.post(serviceURL, {\n            action: 'deleteFilterPreference',\n            target: 'user',\n            user: targetUser,\n            filterPreferenceId: data.data.filterPreferenceId,\n            csrf: xm.form_token\n          }).then(() =&gt; {\n            notif.hide();\n            new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.delete.done'))\", 'done');\n            window.livetable_notificationFilterPreferencesLiveTable.refresh();\n          }).catch(() =&gt; {\n            notif.hide();\n            new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.delete.error'))\", 'error');\n          });\n        }\n      });\n    });\n    // Enable / Disable action for classic filter preferences\n    $(data.row).find('.notificationFilterPreferenceCheckbox').on('switchChange.bootstrapSwitch', function(event, state) {\n      // TODO: Translation keys\n      var notif = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.inProgress'))\", 'inprogress');\n      $.post(serviceURL, {\n        action: 'setFilterPreferenceEnabled',\n        filterPreferenceId: data.data.filterPreferenceId,\n        target: 'user',\n        user: targetUser,\n        enabled: state,\n        csrf: xm.form_token\n      }).then(() =&gt; {\n        notif.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n        $(document).trigger('xwiki:livetable:notifications-filters:toggle', {'row': data.data, 'state': state});\n      }).catch(() =&gt; {\n        notif.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n      });\n    });\n    // Enable / Disable action for toggleable filter preferences\n    $(data.row).find('.toggleableFilterPreferenceCheckbox').each(function() {\n      new ToggleableFilterPreference(this, userURL, data.data);\n    });\n  });\n\n  // Initializer\n  $(function() {\n    // This script is usually loaded after the livetable is displayed and so the previous callback is not called.\n    // Because of that, we need\n    if (window.livetable_notificationFilterPreferencesLiveTable) {\n      window.livetable_notificationFilterPreferencesLiveTable.refresh();\n    }\n  });\n});</code>\n    </property>\n    <property>\n      <name>Filter Preferences Livetable Callback</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>068bd3af-8e02-45bb-b1dc-0e99095bf10a</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#notificationFilterPreferencesLiveTable select.pagesizeselect {\n  width: auto;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>NotificationFilterPreferences</name>\n    </property>\n    <property>\n      <parse/>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>35dc5b39-6a83-4d70-bdb5-531f67b51e12</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{template name=\"locationPicker_macros.vm\" /}}\n\n{{include reference=\"XWiki.Notifications.Code.NotificationsPreferencesMacros\" /}}\n\n{{velocity}}\n#if (!$xcontext.userReference)\n  {{info}}\n    {{translation key=\"notifications.settings.filters.preferences.forGuest\" /}}\n  {{/info}}\n## FIXME: This check should not be needed with a proper API able to check rights on UserReference.\n## This should be improved later with such API.\n#elseif (\"$!wikimacro.parameters.user\" != \"\" &amp;&amp; $wikimacro.parameters.user.class.simpleName != 'DocumentUserReference')\n  {{error}}\n    This macro only allows to handle DocumentUserReference references and you specified a $services.rendering.escape($wikimacro.parameters.user.class.simpleName, 'xwiki/2.1') reference.\n  {{/error}}\n#elseif (\"$!wikimacro.parameters.user\" != \"\" &amp;&amp; !$services.security.authorization.hasAccess('admin', $wikimacro.parameters.user.reference) &amp;&amp; !$xcontext.userReference.equals($wikimacro.parameters.user.reference))\n  {{error}}\n    You don't have administration right on $services.rendering.escape($wikimacro.parameters.user, 'xwiki/2.1').\n  {{/error}}\n#else\n#set ($discard = $services.logging.deprecate(\"NotificationsFiltersPreferencesMacro\", \"This macro should not be used anymore in favor of SystemNotificationsFiltersPreferencesMacro and CustomNotificationsFiltersPreferencesMacro.\"))\n## TODO: We should actually manipulate only UserReferences here.\n#if (\"$!wikimacro.parameters.user\" != \"\")\n  #set ($targetUser = $wikimacro.parameters.user.reference)\n#else\n  #set ($targetUser = $xcontext.userReference)\n#end\n######################################################\n### CSS and JAVASCRIPTS\n######################################################\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro'))\n#set ($discard = $xwiki.ssx.use('XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro'))\n## TODO: replace by $xwiki.sswx.use() or something like this when XWIKI-12788 is closed.\n#set ($discard = $xwiki.linkx.use($services.webjars.url('bootstrap-switch', 'css/bootstrap3/bootstrap-switch.min.css'), {'type': 'text/css', 'rel': 'stylesheet'}))\n######################################################\n### MACRO CONTENT\n######################################################\n{{html clean=\"false\"}}\n&lt;div class=\"filterPreferences xform\" data-user-url=\"$escapetool.xml($services.rest.url($targetUser))\"\n  data-user=\"$escapetool.xml($services.model.serialize($targetUser))\"&gt;\n  &lt;div class=\"row\"&gt;\n    &lt;p class=\"xHint col-xs-12 col-sm-9 col-md-8 col-lg-9\"&gt;\n      $escapetool.xml($services.localization.render('notifications.settings.filters.preferences.hint'))\n    &lt;/p&gt;\n    &lt;div class=\"col-xs-12 col-sm-3 col-md-4 col-lg-3 text-right\"&gt;\n      &lt;button type=\"button\" class=\"btn btn-default btn-addfilter\" data-target=\"#modal-add-filter-preference\" data-toggle=\"modal\"&gt;\n        &lt;span class=\"fa fa-plus\"&gt;&lt;/span&gt;&amp;nbsp;$escapetool.xml($services.localization.render('notifications.settings.addFilter'))\n      &lt;/button&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n  #set($collist  = ['name', 'filterType', 'eventTypes', 'notificationFormats', 'isEnabled', '_actions'])\n  #set($colprops = {\n    'name':                { 'sortable': false, 'html': true, 'filterable': false },\n    'filterType':          { 'sortable': false, 'filterable': false },\n    'eventTypes':          { 'sortable': false, 'html': true, 'filterable': false },\n    'notificationFormats': { 'sortable': false, 'html': true, 'filterable': false },\n    'isEnabled':           { 'sortable': false, 'html' : true, 'filterable': false },\n    '_actions':            { 'sortable': false, 'actions': ['delete'], 'filterable': false}\n  })\n  #set($options  = {\n    'resultPage'        : 'XWiki.Notifications.Code.NotificationFilterPreferenceLivetableResults',\n    'rowCount'          : 10,\n    'description'       : 'This table lists every filter registered for the current user.',\n    'translationPrefix' : 'notifications.settings.filters.preferences.table.',\n    'extraParams'       : \"eventType=&amp;format=&amp;user=${services.model.serialize($targetUser, 'default')}\",\n    'outputOnlyHtml'    : true\n  })\n\n  #livetable(\"notificationFilterPreferencesLiveTable\" $collist $colprops $options)\n&lt;/div&gt;\n######################################################\n### ADD FILTER MODAL\n######################################################\n&lt;div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" id=\"modal-add-filter-preference\"\n  data-user=\"$escapetool.xml($services.model.serialize($targetUser))\"&gt;\n  &lt;div class=\"modal-dialog\" role=\"document\"&gt;\n    &lt;div class=\"modal-content\"&gt;\n      &lt;div class=\"modal-header\"&gt;\n        &lt;button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"&gt;&lt;span aria-hidden=\"true\"&gt;&amp;times;&lt;/span&gt;&lt;/button&gt;\n        &lt;div class=\"modal-title\"&gt;$escapetool.xml($services.localization.render('notifications.settings.addFilter'))&lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"modal-body\"&gt;\n        &lt;div class=\"xform\"&gt;\n          &lt;dl class=\"location-picker\"&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterTypeSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.type.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.type.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterTypeSelector\" name=\"notificationFilterTypeSelector\" size=\"1\"&gt;\n                &lt;option value=\"inclusive\" selected=\"selected\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.filterType.inclusive'))&lt;/option&gt;\n                &lt;option value=\"exclusive\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.filterType.exclusive'))&lt;/option&gt;\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterNotificationFormatSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.notificationFormat.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.notificationFormat.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterNotificationFormatSelector\" name=\"notificationFilterNotificationFormatSelector\" size=\"2\" multiple&gt;\n                &lt;option value=\"alert\" selected=\"selected\"&gt;$escapetool.xml($services.localization.render('notifications.format.alert'))&lt;/option&gt;\n                &lt;option value=\"email\"&gt;$escapetool.xml($services.localization.render('notifications.format.email'))&lt;/option&gt;\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label for=\"notificationFilterEventTypeSelector\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.eventType.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.eventType.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd&gt;\n              &lt;select id=\"notificationFilterEventTypeSelector\" name=\"notificationFilterEventTypeSelector\" size=\"5\" multiple&gt;\n                #foreach ($app in $apps)\n                  #set ($type = $app[0])\n                  &lt;optgroup label=\"$escapetool.xml($type.applicationName)\"&gt;\n                  #foreach($descriptor in $app)\n                    &lt;option value=\"$escapetool.xml($descriptor.eventType)\"&gt;$escapetool.xml($services.localization.render($descriptor.description))&lt;/option&gt;\n                  #end\n                  &lt;/optgroup&gt;\n                #end\n              &lt;/select&gt;\n            &lt;/dd&gt;\n            &lt;dt&gt;\n              &lt;label&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.location.label'))&lt;/label&gt;\n              &lt;span class=\"xHint\"&gt;$escapetool.xml($services.localization.render('notifications.filters.preferences.addPreference.location.hint'))&lt;/span&gt;\n            &lt;/dt&gt;\n            &lt;dd class=\"document-tree\"&gt;\n              #documentTree({\n                'class': 'location-tree',\n                'finder': true,\n                'showAttachments': false,\n                'showRoot': false,\n                'showTerminalDocuments': true,\n                'showTranslations': false,\n                'showWikis': true\n              })\n            &lt;/dd&gt;\n          &lt;/dl&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n      &lt;div class=\"modal-footer\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-default\" data-action=\"cancel\" data-dismiss=\"modal\"&gt;$services.localization.render('notifications.filters.cancel')&lt;/button&gt;\n        &lt;button type=\"button\" class=\"btn btn-primary\" data-action=\"submit\" disabled=\"disabled\"&gt;$services.localization.render('notifications.filters.submit')&lt;/button&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;&lt;!-- /.modal-content --&gt;\n  &lt;/div&gt;&lt;!-- /.modal-dialog --&gt;\n&lt;/div&gt;&lt;!-- /.modal --&gt;\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the current user about notification filters.\nThis macro is now deprecated in favor of Custom Notifications Filters Preferences or System Notifications Filters Preferences.</description>\n    </property>\n    <property>\n      <id>notificationsFiltersPreferences</id>\n    </property>\n    <property>\n      <name>Notifications Filters Preferences (deprecated)</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>38b562b3-61ed-40bf-8ab1-088260b579bc</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the filter preferences. This parameter is optional, default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n</xwikidoc>\n", "<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.5\" reference=\"XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro\" locale=\"\">\n  <web>XWiki.Notifications.Code</web>\n  <name>NotificationsSystemFiltersPreferencesMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>NotificationsSystemFiltersPreferencesMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content/>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>7e7d151b-e4dd-498b-8e50-f213104fa256</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>'use strict';\n/**\n * Start the real script.\n */\nrequire(['jquery', 'xwiki-bootstrap-switch', 'xwiki-events-bridge'], function ($) {\n\n  /**\n   * Page initialization\n   */\n  $(function() {\n    var initBootstrapSwitches = function () {\n      $('#notificationSystemFilterPreferencesLiveTable .notificationFilterPreferenceCheckbox, #notificationSystemFilterPreferencesLiveTable .toggleableFilterPreferenceCheckbox').bootstrapSwitch({\n        size: 'mini',\n        labelText: '$escapetool.javascript($services.icon.renderHTML(\"bell\"))'\n      });\n    };\n    $(document).on('xwiki:livetable:displayComplete', function (event, data) {\n      // Enable bootstrap switches\n      initBootstrapSwitches();\n    });\n    initBootstrapSwitches();\n\n  });\n});\n</code>\n    </property>\n    <property>\n      <name>JS</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>2</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>f3d87be8-97d5-490f-b519-952b54fc3e69</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>define('SystemToggleableFilterPreference', ['jquery', 'xwiki-bootstrap-switch'], function($) {\n  /**\n  * Construct the Toggleable Filter Preference object.\n  */\n  return function(domElement, docURL, row) {\n    var self               = this;\n    self.domElement        = $(domElement);\n    self.docURL           = docURL;\n    self.row               = row;\n    /**\n     * Initialization\n     */\n    self.init = function () {\n      // On change\n      self.domElement.off('switchChange.bootstrapSwitch.systemFilter')\n        .on('switchChange.bootstrapSwitch.systemFilter', function(event, state) {\n          setTimeout(function() { self.save(state); }, 1);\n        });\n    };\n\n    /**\n     * Save the filter preference\n     */\n    self.save = function(state) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.settings.saving'))\", 'inprogress');\n      var filterName = self.domElement.attr('data-filterName');\n      var objectNumber = self.domElement.attr('data-objectNumber');\n      if (objectNumber == '') {\n        // If the object does not exist yet, create it (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.docURL + '/objects?media=json&amp;minorRevision=true';\n        var params = {\n          'className': 'XWiki.Notifications.Code.ToggleableFilterPreferenceClass',\n          'property#filterName': filterName,\n          'property#isEnabled': state ? '1' : '0'\n        };\n        $.post(restURL, params).then(data =&gt; {\n          self.domElement.attr('data-objectNumber', data.number);\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      } else if (objectNumber != '') {\n        // If the object already exist, just update its value (make this change a minor edit so it's not displayed, by default, in notifications)\n        var restURL = self.docURL + '/objects/XWiki.Notifications.Code.ToggleableFilterPreferenceClass/' + objectNumber\n          + '/properties/isEnabled?media=json&amp;minorRevision=true';\n        $.ajax(restURL, {\n          method: 'PUT',\n          contentType: 'text/plain',\n          data: state ? '1' : '0'\n        }).then(data =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.done'))\", 'done');\n          $(document).trigger('xwiki:livetable:notifications-filters-system:toggle', {'row': self.row, 'state': state});\n        }).catch(() =&gt; {\n          notification.hide();\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('notifications.filters.preferences.setEnabled.error'))\", 'error');\n        });\n      }\n    };\n\n    // Call init\n    self.init();\n  };\n});\n</code>\n    </property>\n    <property>\n      <name>System Toggleable Filter Preference</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>3</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>2ce1c5a8-4fdb-479f-85f7-7cbfe9b7d646</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require([\n  'jquery',\n  'SystemToggleableFilterPreference',\n  'xwiki-meta',\n  'xwiki-bootstrap-switch',\n  'xwiki-events-bridge'\n], function ($, SystemToggleableFilterPreference, xm) {\n  $(document).on('xwiki:livetable:notifications-filters-system:toggle', function(event, data) {\n    var changedRow = $(data.row.isEnabled);\n    if (changedRow.length &gt; 0) {\n      if (data.state) {\n        changedRow.attr(\"checked\", \"checked\");\n      } else {\n        changedRow.removeAttr(\"checked\");\n      }\n      data.row.isEnabled = changedRow.get(0).outerHTML;\n    }\n  });\n\n  // Globals\n  var serviceReference = XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService',\n    XWiki.EntityType.DOCUMENT);\n  var serviceURL = new XWiki.Document(serviceReference).getURL('get', 'outputSyntax=plain');\n  var target = $('.systemFilterPreferences').attr('data-target');\n\n  var docURL = $('.systemFilterPreferences').attr('data-doc-url');\n  var postParams = {\n    action: 'setFilterPreferenceEnabled',\n    csrf: xm.form_token,\n    target: target\n  };\n  if (target == 'user') {\n    var targetUser = $('.systemFilterPreferences').attr('data-user');\n    postParams['user'] = targetUser;\n  };\n\n  var enhanceRow = function(row, data) {\n    // Enable / Disable action for classic filter preferences\n    $(row).find('.notificationFilterPreferenceCheckbox').off('switchChange.bootstrapSwitch.systemFilter')\n    .on('switchChange.bootstrapSwitch.systemFilter', function(event, state) {\n      var notif = new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n        'notifications.filters.preferences.setEnabled.inProgress')), 'inprogress');\n      var params = {\n        filterPreferenceId: data.filterPreferenceId,\n        enabled: state\n      };\n      $.post(serviceURL, $.extend({}, params, postParams)).then(() =&gt; {\n        notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n          'notifications.filters.preferences.setEnabled.done')), 'done'));\n        $(document).trigger('xwiki:livetable:notifications-filters-system:toggle', {'row': data, 'state': state});\n      }).catch(() =&gt; {\n        notif.replace(new XWiki.widgets.Notification($jsontool.serialize($services.localization.render(\n          'notifications.filters.preferences.setEnabled.error')), 'error'));\n      });\n    });\n    // Enable / Disable action for toggleable filter preferences\n    $(row).find('.toggleableFilterPreferenceCheckbox').each(function() {\n      new SystemToggleableFilterPreference(this, docURL, data);\n    });\n  };\n\n  // Callback on livetable row printing\n  $(document).on('xwiki:livetable:notificationSystemFilterPreferencesLiveTable:newrow', function(event, data) {\n    enhanceRow(data.row, data.data);\n  });\n\n  // Initializer\n  $(function() {\n    // This script is usually loaded after the live table is displayed and so the previous callback might not be called.\n    $('#notificationSystemFilterPreferencesLiveTable-display &gt; tr[data-index]').each(function() {\n      var data = window.livetable_notificationSystemFilterPreferencesLiveTable.fetchedRows[$(this).data('index')];\n      enhanceRow(this, data);\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>Filter Preferences Livetable Callback</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>0dbeaf20-9549-4eb2-99b9-95dc3fef916d</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#notificationSystemFilterPreferencesLiveTable select.pagesizeselect {\n  width: auto;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>NotificationFilterPreferences</name>\n    </property>\n    <property>\n      <parse/>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>3ed9f676-5c82-48c0-9082-1305822ba742</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.cookies|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategories>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>defaultCategories</name>\n        <number>4</number>\n        <prettyName>Default categories</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values/>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </defaultCategories>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{include reference=\"XWiki.Notifications.Code.NotificationsPreferencesMacros\" /}}\n\n{{velocity}}\n#checkMacroNotificationPreferencesParameters($checkResult)\n#if ($checkResult)\n#if ($wikimacro.parameters.target == \"wiki\")\n  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($services.model.createDocumentReference('', ['XWiki', 'Notifications', 'Code'], 'NotificationAdministration')))\"\"\")\n#else\n  #if (\"$!wikimacro.parameters.user\" != \"\")\n    #set ($targetUser = $wikimacro.parameters.user.reference)\n  #else\n    #set ($targetUser = $xcontext.userReference)\n  #end\n  #set ($divData = \"data-doc-url=\"\"$escapetool.xml($services.rest.url($targetUser))\"\" data-user=\"\"$escapetool.xml($services.model.serialize($targetUser))\"\"\")\n#end\n######################################################\n### CSS and JAVASCRIPTS\n######################################################\n#set ($discard = $xwiki.jsx.use('XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro'))\n#set ($discard = $xwiki.ssx.use('XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro'))\n## TODO: replace by $xwiki.sswx.use() or something like this when XWIKI-12788 is closed.\n#set ($discard = $xwiki.linkx.use($services.webjars.url('bootstrap-switch', 'css/bootstrap3/bootstrap-switch.min.css'), {'type': 'text/css', 'rel': 'stylesheet'}))\n######################################################\n### MACRO CONTENT\n######################################################\n{{html clean=\"false\"}}\n&lt;div class=\"systemFilterPreferences xform\" data-target=\"$escapetool.xml($wikimacro.parameters.target)\" $divData&gt;\n  &lt;div class=\"row\"&gt;\n    &lt;p class=\"xHint col-xs-12 col-sm-9 col-md-8 col-lg-9\"&gt;\n      $escapetool.xml($services.localization.render('notifications.settings.filters.preferences.system.hint'))\n    &lt;/p&gt;\n  &lt;/div&gt;\n  #set($collist  = ['name', 'filterType', 'notificationFormats', 'isEnabled'])\n  #set($colprops = {\n    'name':                { 'sortable': false, 'html': true, 'filterable': false },\n    'filterType':          { 'sortable': false, 'filterable': false },\n    'notificationFormats': { 'sortable': false, 'html': true, 'filterable': false },\n    'isEnabled':           { 'sortable': false, 'html' : true, 'filterable': false }\n  })\n  #set ($extraParams = \"eventType=&amp;format=&amp;type=system\")\n  #if ($wikimacro.parameters.target == 'user')\n    #set ($extraParams = \"$extraParams&amp;user=${services.model.serialize($targetUser, 'default')}\")\n  #end\n  #set($options  = {\n    'resultPage'        : 'XWiki.Notifications.Code.NotificationFilterPreferenceLivetableResults',\n    'rowCount'          : 10,\n    'description'       : 'This table lists every system filter registered in the wiki.',\n    'translationPrefix' : 'notifications.settings.filters.preferences.system.table.',\n    'extraParams'       : $extraParams,\n    'outputOnlyHtml'    : true\n  })\n\n  #livetable(\"notificationSystemFilterPreferencesLiveTable\" $collist $colprops $options)\n&lt;/div&gt;\n{{/html}}\n#end\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategories>\n        <value>Notifications</value>\n      </defaultCategories>\n    </property>\n    <property>\n      <description>Display the preferences of the given user about system notification filters.</description>\n    </property>\n    <property>\n      <id>notificationsSystemFiltersPreferences</id>\n    </property>\n    <property>\n      <name>Notifications System Filters Preferences</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>0</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>d4798048-ddea-4fa6-a959-4a01d1e9bae9</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>User reference of the user for which to display and manipulate the filter preferences. This parameter is optional, default value is the context user. Note that for using this parameter, the context user needs administrator right on the given user reference.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>user</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Notifications.Code.NotificationsSystemFiltersPreferencesMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>77306320-9711-4c7f-afd2-3c92b89fbf7c</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>user</defaultValue>\n    </property>\n    <property>\n      <description>Target of the macro (could be \"user\" for the given user or \"wiki\" for the current wiki)</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>target</name>\n    </property>\n    <property>\n      <type/>\n    </property>\n  </object>\n</xwikidoc>\n"], "filenames": ["xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsApplicationsPreferencesMacro.xml", "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsAutoWatchPreferencesMacro.xml", "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsCustomFiltersPreferencesMacro.xml", "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsEmailPreferencesMacro.xml", "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsFiltersPreferencesMacro.xml", "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationsSystemFiltersPreferencesMacro.xml"], "buggy_code_start_loc": [985, 394, 1086, 426, 1053, 848], "buggy_code_end_loc": [986, 407, 1087, 438, 1113, 849], "fixing_code_start_loc": [985, 394, 1086, 426, 1053, 848], "fixing_code_end_loc": [986, 407, 1087, 438, 1115, 849], "type": "CWE-94", "message": "XWiki Commons are technical libraries common to several other top level XWiki projects. Any user with view rights on commonly accessible documents including the notification preferences macros can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation. The root cause is improper escaping of the user parameter of the macro that provide the notification filters. These macros are used in the user profiles and thus installed by default in XWiki. The vulnerability has been patched in XWiki 13.10.11, 14.4.7 and 14.10.", "other": {"cve": {"id": "CVE-2023-29210", "sourceIdentifier": "security-advisories@github.com", "published": "2023-04-15T17:15:07.113", "lastModified": "2023-04-24T18:31:14.720", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Commons are technical libraries common to several other top level XWiki projects. Any user with view rights on commonly accessible documents including the notification preferences macros can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation. The root cause is improper escaping of the user parameter of the macro that provide the notification filters. These macros are used in the user profiles and thus installed by default in XWiki. The vulnerability has been patched in XWiki 13.10.11, 14.4.7 and 14.10."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.9, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.1, "impactScore": 6.0}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-94"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-95"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionEndExcluding": "13.10.11", "matchCriteriaId": "A3CD7FFB-D491-4B7D-839D-D567B0C00E59"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.4.0", "versionEndExcluding": "14.4.7", "matchCriteriaId": "FC782E27-0FE5-48CE-B1E6-896F47ACB5BD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:14.10:rc1:*:*:*:*:*:*", "matchCriteriaId": "0EC7DC4E-E9FD-407B-B95F-6CBD1B5E08E0"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/cebf9167e4fd64a8777781fc56461e9abbe0b32a", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-p9mj-v5mf-m82x", "source": "security-advisories@github.com", "tags": ["Exploit", "Patch", "Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-20259", "source": "security-advisories@github.com", "tags": ["Exploit", "Issue Tracking"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/cebf9167e4fd64a8777781fc56461e9abbe0b32a"}}