{"buggy_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.3\" reference=\"XWiki.ForgotUsername\" locale=\"\">\n  <web>XWiki</web>\n  <name>ForgotUsername</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>Main.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>$services.localization.render('xe.admin.forgotUsername.title')</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n#set($email = \"$!request.get('e')\")\n#if($email == '')\n{{translation key=\"xe.admin.forgotUsername.instructions\"/}}\n\n{{html}}\n  &lt;form method=\"post\" action=\"$doc.getURL()\" class=\"xformInline\"&gt;\n    &lt;div&gt;&lt;label for=\"e\"&gt;$services.localization.render('xe.admin.forgotUsername.email.label')&lt;/label&gt; &lt;input type=\"text\" id=\"e\" name=\"e\"/&gt; &lt;span class=\"buttonwrapper\"&gt;&lt;input type=\"submit\" value=\"$services.localization.render('xe.admin.forgotUsername.submit')\" class=\"button\"/&gt;&lt;/span&gt;&lt;/div&gt;\n  &lt;/form&gt;\n{{/html}}\n\n#else\n  #set($query = $services.query.hql(\", BaseObject obj, StringProperty prop where obj.name = doc.fullName and obj.className = 'XWiki.XWikiUsers' and prop.id.id = obj.id and prop.id.name = 'email' and LOWER(prop.value) = :email\").bindValue('email', $email.toLowerCase()))\n  #set($results = $query.execute())\n  ## If local user does not exist check global user\n  #if($results.size() == 0 &amp;&amp; ${xcontext.database} != ${xcontext.mainWikiName})\n    #set($results = $query.setWiki(\"${xcontext.mainWikiName}\").execute())\n  #end\n  #set ($emailError = false)\n    #if($results.size() != 0)\n      ## Send the email\n      #set ($from = $services.mail.sender.configuration.fromAddress)\n      #if (\"$!from\" == '')\n        #set ($from = \"no-reply@${request.serverName}\")\n      #end\n      ## The mail template use $usernames to display the results.\n      #set ($usernames = $results)\n      #set ($mailTemplateReference = $services.model.createDocumentReference('', 'XWiki', 'ForgotUsernameMailContent'))\n      #set ($mailParameters = {'from' : $from, 'to' : $email, 'language' : $xcontext.locale})\n      #set ($message = $services.mail.sender.createMessage('template', $mailTemplateReference, $mailParameters))\n      #set ($discard = $message.setType('Forgot Username'))\n      #macro (displayError $text)\n\n        {{html}}\n          &lt;div class=\"xwikirenderingerror\" title=\"Click to get more details about the error\" style=\"cursor: pointer;\"&gt;\n            $services.localization.render('xe.admin.forgotUsername.error.emailFailed')\n          &lt;/div&gt;\n          &lt;div class=\"xwikirenderingerrordescription hidden\"&gt;\n            &lt;pre&gt;${text}&lt;/pre&gt;\n          &lt;/div&gt;\n        {{/html}}\n\n        #set ($emailError = true)\n      #end\n      ## Check for an error constructing the message!\n      #if ($services.mail.sender.lastError)\n          #displayError($exceptiontool.getStackTrace($services.mail.sender.lastError))\n      #else\n          ## Send the message and wait for it to be sent or for any error to be raised.\n          #set ($mailResult = $services.mail.sender.send([$message], 'database'))\n          ## Check for errors during the send\n          #if ($services.mail.sender.lastError)\n              #displayError($exceptiontool.getStackTrace($services.mail.sender.lastError))\n          #else\n              #set ($failedMailStatuses = $mailResult.statusResult.getAllErrors())\n              #if ($failedMailStatuses.hasNext())\n                  #set ($mailStatus = $failedMailStatuses.next())\n                  #displayError($mailStatus.errorDescription)\n              #end\n          #end\n      #end\n    #end\n    ## We always display a success message even if there's no user found to avoid disclosing information\n    ## about the users registered on the wiki.\n    #if (!$emailError)\n      {{success}}\n        $services.localization.render('xe.admin.forgotUsername.emailSent', [\"$email\"])\n\n        {{html}}\n        &lt;div&gt;\n          &lt;a href=\"$xwiki.getURL('XWiki.XWikiLogin', 'login')\"&gt;$services.localization.render('xe.admin.forgotUsername.login')&lt;/a&gt;\n        &lt;/div&gt;\n        {{/html}}\n\n      {{/success}}\n    #end\n#end\n{{/velocity}}</content>\n  <object>\n    <name>XWiki.ForgotUsername</name>\n    <number>0</number>\n    <className>XWiki.XWikiRights</className>\n    <guid>5f9081d2-87b6-430e-8bb9-edc66544fc06</guid>\n    <class>\n      <name>XWiki.XWikiRights</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <allow>\n        <defaultValue>1</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>allow</displayType>\n        <name>allow</name>\n        <number>4</number>\n        <prettyName>Allow/Deny</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </allow>\n      <groups>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>groups</name>\n        <number>1</number>\n        <picker>1</picker>\n        <prettyName>Groups</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n      </groups>\n      <levels>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>1</multiSelect>\n        <name>levels</name>\n        <number>2</number>\n        <prettyName>Levels</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>3</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n      </levels>\n      <users>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>users</name>\n        <number>3</number>\n        <picker>1</picker>\n        <prettyName>Users</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n      </users>\n    </class>\n    <property>\n      <allow>0</allow>\n    </property>\n    <property>\n      <groups>XWiki.XWikiAllGroup</groups>\n    </property>\n    <property>\n      <levels>edit</levels>\n    </property>\n    <property>\n      <users>XWiki.XWikiGuest</users>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.ForgotUsername</name>\n    <number>1</number>\n    <className>XWiki.XWikiRights</className>\n    <guid>54be8bc6-c81a-4149-b2b0-161b2b974857</guid>\n    <class>\n      <name>XWiki.XWikiRights</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <allow>\n        <defaultValue>1</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>allow</displayType>\n        <name>allow</name>\n        <number>4</number>\n        <prettyName>Allow/Deny</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </allow>\n      <groups>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>groups</name>\n        <number>1</number>\n        <picker>1</picker>\n        <prettyName>Groups</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n      </groups>\n      <levels>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>1</multiSelect>\n        <name>levels</name>\n        <number>2</number>\n        <prettyName>Levels</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>3</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n      </levels>\n      <users>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>users</name>\n        <number>3</number>\n        <picker>1</picker>\n        <prettyName>Users</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n      </users>\n    </class>\n    <property>\n      <allow>0</allow>\n    </property>\n    <property>\n      <groups>xwiki:XWiki.XWikiAllGroup</groups>\n    </property>\n    <property>\n      <levels>edit</levels>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.ForgotUsername</name>\n    <number>2</number>\n    <className>XWiki.XWikiRights</className>\n    <guid>06daec64-228b-4da1-b7e6-b59d9624c859</guid>\n    <class>\n      <name>XWiki.XWikiRights</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <allow>\n        <defaultValue>1</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>allow</displayType>\n        <name>allow</name>\n        <number>4</number>\n        <prettyName>Allow/Deny</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </allow>\n      <groups>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>groups</name>\n        <number>1</number>\n        <picker>1</picker>\n        <prettyName>Groups</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n      </groups>\n      <levels>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>1</multiSelect>\n        <name>levels</name>\n        <number>2</number>\n        <prettyName>Levels</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>3</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n      </levels>\n      <users>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>users</name>\n        <number>3</number>\n        <picker>1</picker>\n        <prettyName>Users</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n      </users>\n    </class>\n    <property>\n      <allow>1</allow>\n    </property>\n    <property>\n      <groups>XWiki.XWikiAllGroup</groups>\n    </property>\n    <property>\n      <levels>view</levels>\n    </property>\n    <property>\n      <users>XWiki.XWikiGuest</users>\n    </property>\n  </object>\n</xwikidoc>\n"], "fixing_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.3\" reference=\"XWiki.ForgotUsername\" locale=\"\">\n  <web>XWiki</web>\n  <name>ForgotUsername</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>Main.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>$services.localization.render('xe.admin.forgotUsername.title')</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n#set($email = \"$!request.get('e')\")\n#if($email == '' || !$services.csrf.isTokenValid($request.form_token))\n{{translation key=\"xe.admin.forgotUsername.instructions\"/}}\n\n{{html}}\n  &lt;form method=\"post\" action=\"$doc.getURL()\" class=\"xformInline\"&gt;\n    &lt;div&gt;\n      &lt;label for=\"e\"&gt;$services.localization.render('xe.admin.forgotUsername.email.label')&lt;/label&gt;\n      &lt;input type=\"text\" id=\"e\" name=\"e\"/&gt;\n      &lt;input type=\"hidden\" name=\"form_token\" value=\"$services.csrf.getToken()\"/&gt;\n      &lt;span class=\"buttonwrapper\"&gt;\n        &lt;input type=\"submit\" value=\"$services.localization.render('xe.admin.forgotUsername.submit')\" class=\"button\"/&gt;\n      &lt;/span&gt;\n    &lt;/div&gt;\n  &lt;/form&gt;\n{{/html}}\n\n#else\n  #set($query = $services.query.hql(\", BaseObject obj, StringProperty prop where obj.name = doc.fullName and obj.className = 'XWiki.XWikiUsers' and prop.id.id = obj.id and prop.id.name = 'email' and LOWER(prop.value) = :email\").bindValue('email', $email.toLowerCase()))\n  #set($results = $query.execute())\n  ## If local user does not exist check global user\n  #if($results.size() == 0 &amp;&amp; ${xcontext.database} != ${xcontext.mainWikiName})\n    #set($results = $query.setWiki(\"${xcontext.mainWikiName}\").execute())\n  #end\n  #set ($emailError = false)\n    #if($results.size() != 0)\n      ## Send the email\n      #set ($from = $services.mail.sender.configuration.fromAddress)\n      #if (\"$!from\" == '')\n        #set ($from = \"no-reply@${request.serverName}\")\n      #end\n      ## The mail template use $usernames to display the results.\n      #set ($usernames = $results)\n      #set ($mailTemplateReference = $services.model.createDocumentReference('', 'XWiki', 'ForgotUsernameMailContent'))\n      #set ($mailParameters = {'from' : $from, 'to' : $email, 'language' : $xcontext.locale})\n      #set ($message = $services.mail.sender.createMessage('template', $mailTemplateReference, $mailParameters))\n      #set ($discard = $message.setType('Forgot Username'))\n      #macro (displayError $text)\n\n        {{html}}\n          &lt;div class=\"xwikirenderingerror\" title=\"Click to get more details about the error\" style=\"cursor: pointer;\"&gt;\n            $services.localization.render('xe.admin.forgotUsername.error.emailFailed')\n          &lt;/div&gt;\n          &lt;div class=\"xwikirenderingerrordescription hidden\"&gt;\n            &lt;pre&gt;${text}&lt;/pre&gt;\n          &lt;/div&gt;\n        {{/html}}\n\n        #set ($emailError = true)\n      #end\n      ## Check for an error constructing the message!\n      #if ($services.mail.sender.lastError)\n          #displayError($exceptiontool.getStackTrace($services.mail.sender.lastError))\n      #else\n          ## Send the message and wait for it to be sent or for any error to be raised.\n          #set ($mailResult = $services.mail.sender.send([$message], 'database'))\n          ## Check for errors during the send\n          #if ($services.mail.sender.lastError)\n              #displayError($exceptiontool.getStackTrace($services.mail.sender.lastError))\n          #else\n              #set ($failedMailStatuses = $mailResult.statusResult.getAllErrors())\n              #if ($failedMailStatuses.hasNext())\n                  #set ($mailStatus = $failedMailStatuses.next())\n                  #displayError($mailStatus.errorDescription)\n              #end\n          #end\n      #end\n    #end\n    ## We always display a success message even if there's no user found to avoid disclosing information\n    ## about the users registered on the wiki.\n    #if (!$emailError)\n      {{success}}\n        $services.localization.render('xe.admin.forgotUsername.emailSent', [\"$email\"])\n\n        {{html}}\n        &lt;div&gt;\n          &lt;a href=\"$xwiki.getURL('XWiki.XWikiLogin', 'login')\"&gt;$services.localization.render('xe.admin.forgotUsername.login')&lt;/a&gt;\n        &lt;/div&gt;\n        {{/html}}\n\n      {{/success}}\n    #end\n#end\n{{/velocity}}</content>\n  <object>\n    <name>XWiki.ForgotUsername</name>\n    <number>0</number>\n    <className>XWiki.XWikiRights</className>\n    <guid>5f9081d2-87b6-430e-8bb9-edc66544fc06</guid>\n    <class>\n      <name>XWiki.XWikiRights</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <allow>\n        <defaultValue>1</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>allow</displayType>\n        <name>allow</name>\n        <number>4</number>\n        <prettyName>Allow/Deny</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </allow>\n      <groups>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>groups</name>\n        <number>1</number>\n        <picker>1</picker>\n        <prettyName>Groups</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n      </groups>\n      <levels>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>1</multiSelect>\n        <name>levels</name>\n        <number>2</number>\n        <prettyName>Levels</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>3</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n      </levels>\n      <users>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>users</name>\n        <number>3</number>\n        <picker>1</picker>\n        <prettyName>Users</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n      </users>\n    </class>\n    <property>\n      <allow>0</allow>\n    </property>\n    <property>\n      <groups>XWiki.XWikiAllGroup</groups>\n    </property>\n    <property>\n      <levels>edit</levels>\n    </property>\n    <property>\n      <users>XWiki.XWikiGuest</users>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.ForgotUsername</name>\n    <number>1</number>\n    <className>XWiki.XWikiRights</className>\n    <guid>54be8bc6-c81a-4149-b2b0-161b2b974857</guid>\n    <class>\n      <name>XWiki.XWikiRights</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <allow>\n        <defaultValue>1</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>allow</displayType>\n        <name>allow</name>\n        <number>4</number>\n        <prettyName>Allow/Deny</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </allow>\n      <groups>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>groups</name>\n        <number>1</number>\n        <picker>1</picker>\n        <prettyName>Groups</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n      </groups>\n      <levels>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>1</multiSelect>\n        <name>levels</name>\n        <number>2</number>\n        <prettyName>Levels</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>3</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n      </levels>\n      <users>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>users</name>\n        <number>3</number>\n        <picker>1</picker>\n        <prettyName>Users</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n      </users>\n    </class>\n    <property>\n      <allow>0</allow>\n    </property>\n    <property>\n      <groups>xwiki:XWiki.XWikiAllGroup</groups>\n    </property>\n    <property>\n      <levels>edit</levels>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.ForgotUsername</name>\n    <number>2</number>\n    <className>XWiki.XWikiRights</className>\n    <guid>06daec64-228b-4da1-b7e6-b59d9624c859</guid>\n    <class>\n      <name>XWiki.XWikiRights</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <allow>\n        <defaultValue>1</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>allow</displayType>\n        <name>allow</name>\n        <number>4</number>\n        <prettyName>Allow/Deny</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </allow>\n      <groups>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>groups</name>\n        <number>1</number>\n        <picker>1</picker>\n        <prettyName>Groups</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n      </groups>\n      <levels>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <multiSelect>1</multiSelect>\n        <name>levels</name>\n        <number>2</number>\n        <prettyName>Levels</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>3</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n      </levels>\n      <users>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <multiSelect>1</multiSelect>\n        <name>users</name>\n        <number>3</number>\n        <picker>1</picker>\n        <prettyName>Users</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n      </users>\n    </class>\n    <property>\n      <allow>1</allow>\n    </property>\n    <property>\n      <groups>XWiki.XWikiAllGroup</groups>\n    </property>\n    <property>\n      <levels>view</levels>\n    </property>\n    <property>\n      <users>XWiki.XWikiGuest</users>\n    </property>\n  </object>\n</xwikidoc>\n"], "filenames": ["xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ForgotUsername.xml"], "buggy_code_start_loc": [41], "buggy_code_end_loc": [47], "fixing_code_start_loc": [41], "fixing_code_end_loc": [54], "type": "CWE-352", "message": "### Impact It's possible to know if a user has or not an account in a wiki related to an email address, and which username(s) is actually tied to that email by forging a request to the Forgot username page. Note that since this page does not have a CSRF check it's quite easy to perform a lot of those requests. ### Patches This issue has been patched in XWiki 12.10.5 and 13.2RC1. Two different patches are provided: - a first one to fix the CSRF problem - a more complex one that now relies on sending an email for the Forgot username process. ### Workarounds It's possible to fix the problem without uprading by editing the ForgotUsername page in version below 13.x, to use the following code: https://github.com/xwiki/xwiki-platform/blob/69548c0320cbd772540cf4668743e69f879812cf/xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ForgotUsername.xml#L39-L123 In version after 13.x it's also possible to edit manually the forgotusername.vm file, but it's really encouraged to upgrade the version here. ### References * https://jira.xwiki.org/browse/XWIKI-18384 * https://jira.xwiki.org/browse/XWIKI-18408 ### For more information If you have any questions or comments about this advisory: * Open an issue in [Jira XWiki](https://jira.xwiki.org) * Email us at [security ML](mailto:security@xwiki.org)", "other": {"cve": {"id": "CVE-2021-32732", "sourceIdentifier": "security-advisories@github.com", "published": "2022-02-04T23:15:11.547", "lastModified": "2022-02-10T18:39:12.117", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "### Impact It's possible to know if a user has or not an account in a wiki related to an email address, and which username(s) is actually tied to that email by forging a request to the Forgot username page. Note that since this page does not have a CSRF check it's quite easy to perform a lot of those requests. ### Patches This issue has been patched in XWiki 12.10.5 and 13.2RC1. Two different patches are provided: - a first one to fix the CSRF problem - a more complex one that now relies on sending an email for the Forgot username process. ### Workarounds It's possible to fix the problem without uprading by editing the ForgotUsername page in version below 13.x, to use the following code: https://github.com/xwiki/xwiki-platform/blob/69548c0320cbd772540cf4668743e69f879812cf/xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ForgotUsername.xml#L39-L123 In version after 13.x it's also possible to edit manually the forgotusername.vm file, but it's really encouraged to upgrade the version here. ### References * https://jira.xwiki.org/browse/XWIKI-18384 * https://jira.xwiki.org/browse/XWIKI-18408 ### For more information If you have any questions or comments about this advisory: * Open an issue in [Jira XWiki](https://jira.xwiki.org) * Email us at [security ML](mailto:security@xwiki.org)"}, {"lang": "es", "value": "### Impacto Es posible saber si un usuario presenta o no una cuenta en un wiki relacionada con una direcci\u00f3n de correo electr\u00f3nico, y qu\u00e9 nombre(s) de usuario est\u00e1(n) realmente vinculado(s) a ese correo electr\u00f3nico al falsificar una petici\u00f3n a la p\u00e1gina de Nombre de usuario olvidado. Ten en cuenta que como esta p\u00e1gina no presenta una comprobaci\u00f3n de tipo CSRF es bastante f\u00e1cil llevar a cabo muchas de esas peticiones. ### Parches Este problema ha sido parcheado en XWiki versiones 12.10.5 y 13.2RC1. Se proporcionan dos parches diferentes: - uno para corregir el problema de CSRF - otro m\u00e1s complejo que ahora es basado en el env\u00edo de un correo electr\u00f3nico para el proceso Forgot username. ### Mitigaciones Es posible arreglar el problema sin actualizar al editar la p\u00e1gina de ForgotUsername en versiones anteriores a 13.x, para usar el siguiente c\u00f3digo: https://github.com/xwiki/xwiki-platform/blob/69548c0320cbd772540cf4668743e69f879812cf/xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ForgotUsername.xml#L39-L123 En la versi\u00f3n posterior a 13.x tambi\u00e9n es posible editar manualmente el archivo forgotusername.vm, pero es recomendado actualizar la versi\u00f3n aqu\u00ed.  References * https://jira.xwiki.org/browse/XWIKI-18384 * https://jira.xwiki.org/browse/XWIKI-18408 ###. Para m\u00e1s informaci\u00f3n Si presenta alguna pregunta o comentario sobre este aviso: * Abra una incidencia en [Jira XWiki](https://jira.xwiki.org) * Env\u00edenos un correo electr\u00f3nico a [security ML](mailto:security@xwiki.org)"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:N/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-352"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionEndExcluding": "12.10.5", "matchCriteriaId": "1D3FA811-A9C4-45F7-A876-BB5D69DA7BCE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:13.0:*:*:*:*:*:*:*", "matchCriteriaId": "E8ED2C6F-77E6-4B53-A52D-0CD7FA08AFD1"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:13.1:-:*:*:*:*:*:*", "matchCriteriaId": "333C6A66-CDCD-46DC-A095-74D35B076A78"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/69548c0320cbd772540cf4668743e69f879812cf", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/commit/f0440dfcbba705e03f7565cd88893dde57ca3fa8", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-vh5c-jqfg-mhrh", "source": "security-advisories@github.com", "tags": ["Mitigation", "Third Party Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-18384", "source": "security-advisories@github.com", "tags": ["Exploit", "Patch", "Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-18408", "source": "security-advisories@github.com", "tags": ["Exploit", "Patch", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/69548c0320cbd772540cf4668743e69f879812cf"}}