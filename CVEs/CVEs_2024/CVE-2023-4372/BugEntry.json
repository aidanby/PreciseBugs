{"buggy_code": ["<?php\n\n/**\n * Plugin Name:       LiteSpeed Cache\n * Plugin URI:        https://www.litespeedtech.com/products/cache-plugins/wordpress-acceleration\n * Description:       High-performance page caching and site optimization from LiteSpeed\n * Version:           5.6.1-a9\n * Author:            LiteSpeed Technologies\n * Author URI:        https://www.litespeedtech.com\n * License:           GPLv3\n * License URI:       http://www.gnu.org/licenses/gpl.html\n * Text Domain:       litespeed-cache\n * Domain Path:       /lang\n *\n * Copyright (C) 2015-2017 LiteSpeed Technologies, Inc.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n */\ndefined('WPINC') || exit;\n\nif (defined('LSCWP_V')) {\n\treturn;\n}\n\n!defined('LSCWP_V') && define('LSCWP_V', '5.6.1-a9');\n\n!defined('LSCWP_CONTENT_DIR') && define('LSCWP_CONTENT_DIR', WP_CONTENT_DIR);\n!defined('LSCWP_DIR') && define('LSCWP_DIR', __DIR__ . '/'); // Full absolute path '/var/www/html/***/wp-content/plugins/litespeed-cache/' or MU\n!defined('LSCWP_BASENAME') && define('LSCWP_BASENAME', 'litespeed-cache/litespeed-cache.php'); //LSCWP_BASENAME='litespeed-cache/litespeed-cache.php'\n\n/**\n * This needs to be before activation because admin-rules.class.php need const `LSCWP_CONTENT_FOLDER`\n * This also needs to be before cfg.cls init because default cdn_included_dir needs `LSCWP_CONTENT_FOLDER`\n * @since  5.2 Auto correct protocol for CONTENT URL\n */\n$WP_CONTENT_URL = WP_CONTENT_URL;\n$home_url = home_url('/');\nif (substr($WP_CONTENT_URL, 0, 5) == 'http:' && substr($home_url, 0, 5) == 'https') $WP_CONTENT_URL = str_replace('http://', 'https://', $WP_CONTENT_URL);\n!defined('LSCWP_CONTENT_FOLDER') && define('LSCWP_CONTENT_FOLDER', str_replace($home_url, '', $WP_CONTENT_URL)); // `wp-content`\n!defined('LSWCP_PLUGIN_URL') && define('LSWCP_PLUGIN_URL', plugin_dir_url(__FILE__)); // Full URL path '//example.com/wp-content/plugins/litespeed-cache/'\n\n/**\n * Static cache files consts\n * @since  3.0\n */\n!defined('LITESPEED_STATIC_URL') && define('LITESPEED_STATIC_URL', $WP_CONTENT_URL . '/litespeed'); // Full static cache folder URL '//example.com/wp-content/litespeed'\n!defined('LITESPEED_STATIC_DIR') && define('LITESPEED_STATIC_DIR', LSCWP_CONTENT_DIR . '/litespeed'); // Full static cache folder path '/var/www/html/***/wp-content/litespeed'\n\n!defined('LITESPEED_TIME_OFFSET') && define('LITESPEED_TIME_OFFSET', get_option('gmt_offset') * 60 * 60);\n\n// Placeholder for lazyload img\n!defined('LITESPEED_PLACEHOLDER') && define('LITESPEED_PLACEHOLDER', 'data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=');\n\n// Auto register LiteSpeed classes\nrequire_once LSCWP_DIR . 'autoload.php';\n\n// Define CLI\nif ((defined('WP_CLI') && WP_CLI) || PHP_SAPI == 'cli') {\n\t!defined('LITESPEED_CLI') &&  define('LITESPEED_CLI', true);\n\n\t// Register CLI cmd\n\tif (method_exists('WP_CLI', 'add_command')) {\n\t\tWP_CLI::add_command('litespeed-option', 'LiteSpeed\\CLI\\Option');\n\t\tWP_CLI::add_command('litespeed-purge', 'LiteSpeed\\CLI\\Purge');\n\t\tWP_CLI::add_command('litespeed-online', 'LiteSpeed\\CLI\\Online');\n\t\tWP_CLI::add_command('litespeed-image', 'LiteSpeed\\CLI\\Image');\n\t\tWP_CLI::add_command('litespeed-debug', 'LiteSpeed\\CLI\\Debug');\n\t\tWP_CLI::add_command('litespeed-presets', 'LiteSpeed\\CLI\\Presets');\n\t}\n}\n\n// Server type\nif (!defined('LITESPEED_SERVER_TYPE')) {\n\tif (isset($_SERVER['HTTP_X_LSCACHE']) && $_SERVER['HTTP_X_LSCACHE']) {\n\t\tdefine('LITESPEED_SERVER_TYPE', 'LITESPEED_SERVER_ADC');\n\t} elseif (isset($_SERVER['LSWS_EDITION']) && strpos($_SERVER['LSWS_EDITION'], 'Openlitespeed') === 0) {\n\t\tdefine('LITESPEED_SERVER_TYPE', 'LITESPEED_SERVER_OLS');\n\t} elseif (isset($_SERVER['SERVER_SOFTWARE']) && $_SERVER['SERVER_SOFTWARE'] == 'LiteSpeed') {\n\t\tdefine('LITESPEED_SERVER_TYPE', 'LITESPEED_SERVER_ENT');\n\t} else {\n\t\tdefine('LITESPEED_SERVER_TYPE', 'NONE');\n\t}\n}\n\n// Checks if caching is allowed via server variable\nif (!empty($_SERVER['X-LSCACHE']) ||  LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_ADC' || defined('LITESPEED_CLI')) {\n\t!defined('LITESPEED_ALLOWED') &&  define('LITESPEED_ALLOWED', true);\n}\n\n// ESI const defination\nif (!defined('LSWCP_ESI_SUPPORT')) {\n\tdefine('LSWCP_ESI_SUPPORT', LITESPEED_SERVER_TYPE !== 'LITESPEED_SERVER_OLS' ? true : false);\n}\n\nif (!defined('LSWCP_TAG_PREFIX')) {\n\tdefine('LSWCP_TAG_PREFIX', substr(md5(LSCWP_DIR), -3));\n}\n\n/**\n * Handle exception\n */\nif (!function_exists('litespeed_exception_handler')) {\n\tfunction litespeed_exception_handler($errno, $errstr, $errfile, $errline)\n\t{\n\t\tthrow new \\ErrorException($errstr, 0, $errno, $errfile, $errline);\n\t}\n}\n\n/**\n * Overwride the WP nonce funcs outside of LiteSpeed namespace\n * @since  3.0\n */\nif (!function_exists('litespeed_define_nonce_func')) {\n\tfunction litespeed_define_nonce_func()\n\t{\n\t\t/**\n\t\t * If the nonce is in none_actions filter, convert it to ESI\n\t\t */\n\t\tfunction wp_create_nonce($action = -1)\n\t\t{\n\t\t\tif (!defined('LITESPEED_DISABLE_ALL')) {\n\t\t\t\t$control = \\LiteSpeed\\ESI::cls()->is_nonce_action($action);\n\t\t\t\tif ($control !== null) {\n\t\t\t\t\t$params = array(\n\t\t\t\t\t\t'action'\t=> $action,\n\t\t\t\t\t);\n\t\t\t\t\treturn \\LiteSpeed\\ESI::cls()->sub_esi_block('nonce', 'wp_create_nonce ' . $action, $params, $control, true, true, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn wp_create_nonce_litespeed_esi($action);\n\t\t}\n\n\t\t/**\n\t\t * Ori WP wp_create_nonce\n\t\t */\n\t\tfunction wp_create_nonce_litespeed_esi($action = -1)\n\t\t{\n\t\t\t$uid  = get_current_user_id();\n\t\t\tif (!$uid) {\n\t\t\t\t/** This filter is documented in wp-includes/pluggable.php */\n\t\t\t\t$uid = apply_filters('nonce_user_logged_out', $uid, $action);\n\t\t\t}\n\n\t\t\t$token = wp_get_session_token();\n\t\t\t$i     = wp_nonce_tick();\n\n\t\t\treturn substr(wp_hash($i . '|' . $action . '|' . $uid . '|' . $token, 'nonce'), -12, 10);\n\t\t}\n\t}\n}\n\n/**\n * Begins execution of the plugin.\n *\n * @since    1.0.0\n */\nif (!function_exists('run_litespeed_cache')) {\n\tfunction run_litespeed_cache()\n\t{\n\t\t//Check minimum PHP requirements, which is 5.3 at the moment.\n\t\tif (version_compare(PHP_VERSION, '5.3.0', '<')) {\n\t\t\treturn;\n\t\t}\n\n\t\t//Check minimum WP requirements, which is 4.0 at the moment.\n\t\tif (version_compare($GLOBALS['wp_version'], '4.0', '<')) {\n\t\t\treturn;\n\t\t}\n\n\t\t\\LiteSpeed\\Core::cls();\n\t}\n\n\trun_litespeed_cache();\n}\n", "=== LiteSpeed Cache ===\nContributors: LiteSpeedTech\nTags: caching, optimize, performance, pagespeed, core web vitals, seo, speed, image optimize, compress, object cache, redis, memcached, database cleaner\nRequires at least: 4.0\nTested up to: 6.3\nStable tag: 5.6\nLicense: GPLv3\nLicense URI: http://www.gnu.org/licenses/gpl.html\n\nAll-in-one unbeatable acceleration & PageSpeed improvement: caching, image/CSS/JS optimization...\n\n== Description ==\n\nLiteSpeed Cache for WordPress (LSCWP) is an all-in-one site acceleration plugin, featuring an exclusive server-level cache and a collection of optimization features.\n\nLSCWP supports WordPress Multisite and is compatible with most popular plugins, including WooCommerce, bbPress, and Yoast SEO.\n\nLiteSpeed Cache for WordPress is compatible with ClassicPress.\n\n== Requirements ==\n**General Features** may be used by anyone with any web server (LiteSpeed, Apache, NGINX, etc.).\n\n**LiteSpeed Exclusive Features** require one of the following: OpenLiteSpeed, commercial LiteSpeed products, LiteSpeed-powered hosting, or QUIC.cloud CDN. [Why?](https://docs.litespeedtech.com/lscache/lscwp/faq/#why-do-the-cache-features-require-a-litespeed-server)\n\n== Plugin Features ==\n\n= General Features =\n\n* Free QUIC.cloud CDN Cache\n* Object Cache (Memcached/LSMCD/Redis) Support<sup>+</sup>\n* Image Optimization (Lossless/Lossy)\n* Minify CSS, JavaScript, and HTML\n* Minify inline & external CSS/JS\n* Combine CSS/JS\n* Automatically generate Critical CSS\n* Lazy-load images/iframes\n* Responsive Image Placeholders\n* Multiple CDN Support<sup>+</sup>\n* Load CSS Asynchronously\n* Defer/delay JS loading\n* Browser Cache Support<sup>+</sup>\n* Database Cleaner and Optimizer\n* PageSpeed score (including Core Web Vitals) optimization\n* OPcode Cache Support<sup>+</sup>\n* HTTP/2 Push for CSS/JS (on web servers that support it)\n* DNS Prefetch\n* Cloudflare API\n* Single Site and Multisite (Network) support\n* Import/Export settings\n* Attractive, easy-to-understand interface\n* WebP image format support\n* Heartbeat control\n\n<sup>+</sup> This service is not provided by the LSCache plugin, nor is it guaranteed to be installed by your service provider. However, the plugin is compatible with the service if it is in use on your site.\n\n= LiteSpeed Exclusive Features =\n\n* Automatic page caching to greatly improve site performance\n* Automatic purge of related pages based on certain events\n* Private cache for logged-in users\n* Caching of WordPress REST API calls\n* Separate caching of desktop and mobile views\n* Ability to schedule purge for specified URLs\n* WooCommerce and bbPress support\n* [WordPress CLI](https://docs.litespeedtech.com/lscache/lscwp/cli/) commands\n* API system for easy cache integration\n* Exclude from cache by URI, Category, Tag, Cookie, User Agent\n* Smart preload crawler with support for SEO-friendly sitemap\n* Multiple crawlers for cache varies\n* HTTP/2 support\n* [HTTP/3 & QUIC](https://www.litespeedtech.com/http3-faq) support\n* ESI (Edge Side Includes) support<sup>*</sup>\n* Widgets and Shortcodes as ESI blocks<sup>*</sup> (requires Classic Widgets plugin for WP 5.8+)\n\n<sup>*</sup> Feature not available in OpenLiteSpeed\n\n== Screenshots ==\n\n1. Plugin Benchmarks\n2. Admin - Dashboard\n3. Admin - Image Optimization\n4. Admin - Crawler\n5. Admin Settings - Cache\n6. Admin Settings - Page Optimization\n7. Admin Settings - CDN\n8. Admin Settings - DB Optimizer\n9. Admin Settings - Toolbox\n10. Cache Miss Example\n11. Cache Hit Example\n\n== LSCWP Resources ==\n* [Join our Slack community](https://litespeedtech.com/slack) to connect with other LiteSpeed users.\n* [Ask a question on our support forum](https://wordpress.org/support/plugin/litespeed-cache/).\n* [View detailed documentation](https://docs.litespeedtech.com/lscache/lscwp/overview/).\n* [Read WordPress Wednesday tutorials on our blog](https://blog.litespeedtech.com/tag/wordpress-wednesday/).\n* [Help translate LSCWP](https://translate.wordpress.org/projects/wp-plugins/litespeed-cache/).\n* [LSCWP GitHub repo](https://github.com/litespeedtech/lscache_wp).\n\n== Installation ==\n\n[View detailed documentation](https://docs.litespeedtech.com/lscache/lscwp/installation/).\n\n= For Optimization Without a LiteSpeed Web Server =\n1. Install the LiteSpeed Cache for WordPress plugin and activate it.\n1. From the WordPress Dashboard, navigate to **LiteSpeed Cache > Page Optimization**. Enable the available optimization features in the various tabs.\n\n= For Caching and Optimization With a LiteSpeed Web Server =\n1. Install [LiteSpeed Web Server Enterprise](https://www.litespeedtech.com/products/litespeed-web-server) with LSCache Module, [LiteSpeed Web ADC](https://www.litespeedtech.com/products/litespeed-web-adc), or [OpenLiteSpeed](https://www.litespeedtech.com/open-source/openlitespeed) with cache module (Free). Or sign up for [QUIC.cloud CDN](https://quic.cloud).\n1. Install the LiteSpeed Cache for WordPress plugin and activate it.\n1. From the WordPress Dashboard, navigate to **LiteSpeed Cache > Cache**, make sure the option **Enable LiteSpeed Cache** is set to `ON`.\n1. Enable any desired caching and optimization features in the various tabs.\n\n= Notes for LiteSpeed Web Server Enterprise =\n\n* Make sure that your license includes the LSCache module. A [2-CPU trial license with LSCache module](https://www.litespeedtech.com/products/litespeed-web-server/download/get-a-trial-license \"trial license\") is available for free for 15 days.\n* The server must be configured to have caching enabled. If you are the server admin, [click here](https://docs.litespeedtech.com/lscache/start/#configure-cache-root-and-cache-policy) for instructions. Otherwise, please request that the server admin configure the cache root for the server.\n\n= Notes for OpenLiteSpeed =\n\n* This integration utilizes OpenLiteSpeed's cache module.\n* If it is a fresh OLS installation, the easiest way to integrate is to use [ols1clk](https://openlitespeed.org/kb/1-click-install/). If using an existing WordPress installation, use the `--wordpresspath` parameter.\n* If OLS and WordPress are both already installed, please follow the instructions in [How To Set Up LSCache For WordPress](https://openlitespeed.org/kb/how-to-setup-lscache-for-wordpress/).\n\n== Third Party Compatibility ==\n\nThe vast majority of plugins and themes are compatible with LSCache. [Our API](https://docs.litespeedtech.com/lscache/lscwp/api/) is available for those that are not. Use the API to customize smart purging, customize cache rules, create cache varies, and make WP nonce cacheable, among other things.\n\n== Privacy ==\n\nThis plugin includes some suggested text that you can add to your site's Privacy Policy via the Guide in the WordPress Privacy settings.\n\n**For your own information:** LiteSpeed Cache for WordPress potentially stores a duplicate copy of every web page on display on your site. The pages are stored locally on the system where LiteSpeed server software is installed and are not transferred to or accessed by LiteSpeed employees in any way, except as necessary in providing routine technical support if you request it. All cache files are temporary, and may easily be purged before their natural expiration, if necessary, via a Purge All command. It is up to individual site administrators to come up with their own cache expiration rules.\n\nIn addition to caching, our WordPress plugin has online features provided by QUIC.cloud for Image Optimization, CSS Optimization and Low Quality Image Placeholder services. When one of those optimizations are requested, data is transmitted to a remote QUIC.cloud server, processed, and then transmitted back for use on your site. Now if using the QUIC.cloud CDN it uses LSCache technologies to access your site then host your site to others globally and also your data is not transferred to or accessed by QUIC.cloud employees in any way, except as necessary in providing maintenance or technical support. QUIC.cloud keeps copies of that data for up to 7 days and then permanently deletes them. Similarly, the WordPress plugin has a Reporting feature whereby a site owner can transmit an environment report to LiteSpeed so that we may better provide technical support. None of these features collects any visitor data. Only server and site data are involved.\n\nPlease see the [QUIC.cloud Privacy Policy](https://quic.cloud/privacy-policy/) for our complete Privacy/GDPR statement.\n\n== Frequently Asked Questions ==\n\n= Why do the cache features require LiteSpeed Server? =\nThis plugin communicates with your LiteSpeed Web Server and its built-in page cache (LSCache) to deliver superior performance to your WordPress site. The plugin\u2019s cache features indicate to the server that a page is cacheable and for how long, or they invalidate particular cached pages using tags.\n\nLSCache is a server-level cache, so it's faster than PHP-level caches. [Compare with other PHP-based caches](https://www.litespeedtech.com/benchmarks/wordpress).\n\nA page cache allows the server to bypass PHP and database queries altogether. LSCache, in particular, because of its close relationship with the server, can remember things about the cache entries that other plugins cannot, and it can analyze dependencies. It can utilize tags to manage the smart purging of the cache, and it can use vary cookies to serve multiple versions of cached content based on things like mobile vs. desktop, geographic location, and currencies. [See our Caching 101 blog series](https://blog.litespeedtech.com/tag/caching-101/).\n\nIf all of that sounds complicated, no need to worry. LSCWP works right out of the box with default settings that are appropriate for most sites. [See the Beginner's Guide](https://docs.litespeedtech.com/lscache/lscwp/beginner/).\n\n**Don't have a LiteSpeed server?** Try our QUIC.cloud CDN service. It allows sites on *any server* (NGINX and Apache included) to experience the power of LiteSpeed caching! [Click here](https://quic.cloud) to learn more or to give QUIC.cloud a try.\n\n= What about the optimization features of LSCache? =\n\nLSCWP includes additional optimization features, such as Database Optimization, Minification and Combination of CSS and JS files, HTTP/2 Push, CDN Support, Browser Cache, Object Cache, Lazy Load for Images, and Image Optimization! These features do not require the use of a LiteSpeed web server.\n\n= Is the LiteSpeed Cache Plugin for WordPress free? =\n\nYes, LSCWP will always be free and open source. That said, a LiteSpeed server is required for the cache features, and there are fees associated with some LiteSpeed server editions. Some of the premium online services provided through QUIC.cloud (CDN Service, Image Optimization, Critical CSS, Low-Quality Image Placeholder, etc.) require payment at certain usage levels. You can learn more about what these services cost, and what levels of service are free, on [your QUIC.cloud dashboard](https://my.quic.cloud).\n\n= What server software is required for this plugin? =\n\nA LiteSpeed solution is required in order to use the **LiteSpeed Exclusive** features of this plugin. Any one of the following will work:\n\n1. LiteSpeed Web Server Enterprise with LSCache Module (v5.0.10+)\n2. OpenLiteSpeed (v1.4.17+)\n3. LiteSpeed WebADC (v2.0+)\n4. QUIC.cloud CDN\n\nThe **General Features** may be used with *any* web server. LiteSpeed is not required.\n\n= Does this plugin work in a clustered environment? =\n\nThe cache entries are stored at the LiteSpeed server level. The simplest solution is to use LiteSpeed WebADC, as the cache entries will be stored at that level.\n\nIf using another load balancer, the cache entries will only be stored at the backend nodes, not at the load balancer.\n\nThe purges will also not be synchronized across the nodes, so this is not recommended.\n\nIf a customized solution is required, please contact LiteSpeed Technologies at `info@litespeedtech.com`\n\nNOTICE: The rewrite rules created by this plugin must be copied to the Load Balancer.\n\n= Where are the cached files stored? =\n\nThe actual cached pages are stored and managed by LiteSpeed Servers.\n\nNothing is stored within the WordPress file structure.\n\n= Does LiteSpeed Cache for WordPress work with OpenLiteSpeed? =\n\nYes it can work well with OpenLiteSpeed, although some features may not be supported. See **Plugin Features** above for details. Any setting changes that require modifying the `.htaccess` file will require a server restart.\n\n= Is WooCommerce supported? =\n\nIn short, yes. However, for some WooCommerce themes, the cart may not be updated correctly. Please [visit our blog](https://blog.litespeedtech.com/2017/05/31/wpw-fixing-lscachewoocommerce-conflicts/) for a quick tutorial on how to detect this problem and fix it if necessary.\n\n= Are my images optimized? =\n\nImages are not optimized automatically unless you set **LiteSpeed Cache > Image Optimization > Image Optimization Settings > Auto Request Cron** to `ON`. You may also optimize your images manually. [Learn more](https://docs.litespeedtech.com/lscache/lscwp/imageopt/).\n\n= How do I make a WP nonce cacheable in my third-party plugin? =\n\nOur API includes a function that uses ESI to \"punch a hole\" in a cached page for a nonce. This allows the nonce to be cached separately, regardless of the TTL of the page it is on. Learn more in [the API documentation](https://docs.litespeedtech.com/lscache/lscwp/api/#esi). We also welcome contributions to our predefined list of known third party plugin nonces that users can optionally include via [the plugin's ESI settings](https://docs.litespeedtech.com/lscache/lscwp/cache/#esi-nonce).\n\n= How do I enable the crawler? =\n\nThe crawler is disabled by default, and must be enabled by the server admin first.\n\nOnce the crawler is enabled on the server side, navigate to **LiteSpeed Cache > Crawler > General Settings** and set **Crawler** to `ON`.\n\nFor more detailed information about crawler setup, please see [the Crawler documentation](https://docs.litespeedtech.com/lscache/lscwp/crawler/).\n\n= What are the known compatible plugins and themes? =\n\n* [WPML](https://wpml.org/)\n* [DoLogin Security](https://wordpress.org/plugins/dologin/)\n* [bbPress](https://wordpress.org/plugins/bbpress/)\n* [WooCommerce](https://wordpress.org/plugins/woocommerce/)\n* [Contact Form 7](https://wordpress.org/plugins/contact-form-7/)\n* [All in One SEO](https://wordpress.org/plugins/all-in-one-seo-pack/)\n* [Google XML Sitemaps](https://wordpress.org/plugins/google-sitemap-generator/)\n* [Yoast SEO](https://wordpress.org/plugins/wordpress-seo/)\n* [Wordfence Security](https://wordpress.org/plugins/wordfence/)\n* [NextGen Gallery](https://wordpress.org/plugins/nextgen-gallery/)\n* [ShortPixel](https://shortpixel.com/h/af/CXNO4OI28044/)\n* Aelia CurrencySwitcher\n* [Fast Velocity Minify](https://wordpress.org/plugins/fast-velocity-minify/) - Thanks Raul Peixoto!\n* Autoptimize\n* [Better WP Minify](https://wordpress.org/plugins/bwp-minify/)\n* [WP Touch](https://wordpress.org/plugins/wptouch/)\n* [Theme My Login](https://wordpress.org/plugins/theme-my-login/)\n* [WPLister](https://www.wplab.com/plugins/wp-lister/)\n* [WP-PostRatings](https://wordpress.org/plugins/wp-postratings/)\n* [Avada 5.1 RC1+](https://avada.theme-fusion.com/)\n* [Elegant Themes Divi 3.0.67+](https://www.elegantthemes.com/gallery/divi/)\n* [Elegant Divi Builder](https://www.elegantthemes.com/plugins/divi-builder/)\n* [Caldera Forms](https://wordpress.org/plugins/caldera-forms/) 1.5.6.2+\n* Login With Ajax\n* [Ninja Forms](https://wordpress.org/plugins/ninja-forms/)\n* [Post Types Order 1.9.3.6+](https://wordpress.org/plugins/post-types-order/)\n* [BoomBox \u2014 Viral Magazine WordPress Theme](https://themeforest.net/item/boombox-viral-buzz-wordpress-theme/16596434?ref=PX-lab)\n* FacetWP (LSWS 5.3.6+)\n* Beaver Builder\n* WpDiscuz\n* WP-Stateless\n* Elementor\n* WS Form\n* WP Statistics\n\nThe vast majority of plugins and themes are compatible with LiteSpeed Cache. The most up-to-date compatibility information can be found [in our documentation](https://docs.litespeedtech.com/lscache/lscwp/thirdparty/)\n\n== Changelog ==\n\n= 5.6.1 - Oct 2023 =\n* \ud83c\udf31**Page Optimize** New option available: Preconnect. (xguiboy/Mukesh Patel)\n* **Cloud** Force syncing the configuration to QUIC.cloud if CDN is reenabled.\n* **Cloud** Force syncing the configuration to QUIC.cloud if domain key is readded.\n* \ud83d\udc1e**Image Optimize** Bypass unnecessary image processing when images were only partially optimized. (Ruikai)\n* **CDN** Auto disabled CDN if CDN URL is invalid. (Ruikai)\n* **API** A third filter `litespeed_media_add_missing_sizes` allows bypassing Media's \"add missing sizes\" option (for Guest Optimization and otherwise). (PR #564)\n* **Guest** Fixed soft 404 and robots.txt report for guest.vary.php.\n* **Vary** Enabled `litespeed_vary_cookies` for LSWS enterprise.\n* **Vary** OLS password protected page removed the legacy beginning comma.\n\n= 5.6 - Aug 1 2023 =\n* \ud83c\udf31**Page Optimize** New JS Delay Includes option. (Mitchell Krog/Gerard Reches/Ignacy Ho\u0142oga)\n* **Crawler** Sitemap can use search for URL now.\n* **GUI** Restrict the scope of balloon CSS rules to avoid conflicts. (#567)\n* **Object Cache** Detect Memcached in more situations. (#568)\n* **API** Support `litespeed_purged_front` hook. (Umberto Fiorelli)\n\n= 5.5.1 - Jul 19 2023 =\n* \ud83d\udc1e**Image Optimization** Fixed a bug where WebP replacements couldn't be pulled without optimizing the original images.\n* \ud83d\udc1e**Image Optimization** Invalid images will now be removed when sending requests to the server. (#138993)\n* **Cloud** Added support for error codes `unpulled_images` and `blocklisted`. (Tynan)\n\n= 5.5 - Jun 20 2023 =\n* \ud83c\udf31**Crawler** Can now use multiple sitemaps. (Tobolo/Tim Nolte)\n* \ud83c\udf31**Crawler** Now runs asynchronously when manually invoked.\n* \ud83c\udf31**Crawler** Now runs asynchronously when invoked from cron.\n* \ud83d\udc1e**Crawler** Fixed the realtime status bug when crawling.\n* **Crawler** Summary page now displays server load. (Ruikai)\n* \ud83d\udc1e**Page Optimize** Fixed an issue where UCSS could not be generated for error pages. (james58899) #556\n* \ud83c\udf31**Image Optimize** Now pulls images asynchronously.\n* **Image Optimize** Now prevents concurrent requests via a locking mechanism.\n* **Image Optimize** The process can now bypass invalid image records and continue.\n* \ud83d\udc1e**Image Optimize** Fixed an issue where images ready for optimization might have to wait for new images to be added before sending the request.\n* **Cloud** Replaced dashboard links with login/link to my.quic.cloud actions.\n* **GUI** Added indicators to show when certain options are passively enabled by Guest Mode.\n* **Htaccess** Added a noabort rule to support asynchronous crawling.\n* **Htaccess** The \"Do Not Cache User Agents\" option is now case-insensitive. (Ellen Dabo)\n* **General** The \"Server IP\" option now allows IPv4 format only. (Ruikai)\n* **Misc** Every page's closing HTML comments now displays UCSS/CCSS status.\n* **Object** Fixed a warning for null get_post_type_object.\n* **Object** Object_Cache::delete now always returns a boolean value.\n* **Cache** Fixed advanced-cache.php file warnings for WordPress versions less than 5.3.\n* **Debug** Added debug logging to record the plugin's total processing time.\n* **API** HTML minification can now be bypassed via the litespeed_html_min filter.\n\n= 5.4 - Apr 19 2023 =\n* **Image Optimize** Refactored DB storage for this feature.\n* **Image Optimize** Reduced DB table size.\n* **Image Optimize** Existing `img_optm` DB tables will have their data gradually transitioned to the new storage format with this update. Once an `img_optm` table is empty, it won't be used anymore.\n* **Page Optimize** Enabled WebP support for Googlebot User Agent.\n\n= 5.3.3 - Feb 22 2023 =\n* **Page Optimize** Excluded Jetpack stats JS.\n* **DB Optimize** Fixed DB Optm SQL for revision postmeta.\n* **Cache** Fixed an undefined array key warning.\n* **Purge** Prevented undefined array key warning when widgets are disabled.\n* **Object** Fixed dynamic property deprecation warnings.\n* **Admin** Safely redirect to homepage if referer is unknown.\n* **Activation** Check that item slug exists first.\n* **Cache** Prevented cache header to send globally if header part already closed.\n* **CSS** Improved string handling for CSS minifier.\n* **Debug** Fixed undefined array key warnings.\n* **Misc** Fixed implicit conversion in random string generation function `Str::rrand`.\n\n= 5.3.2 - Jan 10 2023 =\n* **Object** Fixed object cache lib incr, decr functions (thanks bdrbros/DANIEL) #516\n* **Database Optimize** Database optimizer now handles postmeta when cleaning revisions #515\n* **Cache** Made nocache the default for 4xx/5xx response codes.\n* **Cache** Default cache TTL settings removed for 403 response code, changed to 10 mins for 500 response code.\n* **GUI** Added a description for the redetect nodes function.\n* **GUI** Added a description for the refresh button sync function.\n\n= 5.3.1 - Dec 12 2022 =\n* **CLI** Presets feature is now usable from the CLI. (xLukii)\n* **CLI** Added 'import_remote' for litespeed-option to enable importing options from URLs. (xLukii)\n* **Cache** Added LiteSpeed headers to site health check for full page cache.\n* **Crawler* Fixed unauthorized crawler toggle operation. (#CVE-2022-46800)\n* **UCSS** Fixed a bug where items weren't added back to the UCSS queue after purging.\n* **Page Optimize** Fixed a bug where generated CSS would return 404 after upgrading via CLI.\n* **3rd** Fixed a bug where a WooCommerce session doesn't exist when checking cart, notices (Jason Levy/Gilles)\n* **GUI** Made LiteSpeed admin notice icon grayscale to avoid distraction. (martinsauter)\n* **GUI** Fixed RTL style for notification icon.\n* **API** Added a new hook `litespeed_optm_uri_exc` to exclude URI from page optimization.\n* **API** Excluded `.well-known` path from page optimization.\n\n= 5.3 - Oct 31 2022 =\n* \ud83c\udf31**Presets** New `Presets` feature and menu item.\n* \ud83c\udf31**UCSS** New option `UCSS File Excludes and Inline` to increase page score. (Ankit)\n* **UCSS** When UCSS is purged, automatically append URL to UCSS generation queue. (Ankit)\n* **Page Optimize** Removed a redundant `defer` attribute from Lazy Load image library usage. (#928019)\n* **Image Optimize** Dropped `Create WebP Versions` setting. Will automatically enable when `Image WebP Replacement` is activated.\n* **Cloud** Fixed a bug where internal updates were delayed for API keys.\n* **Cloud** Improved auto alias feature by waiting for second request from alias domain validation before removing a pending alias.\n* **Purge** Automatically Purge All when plugin auto update is done.\n* **Purge** Fixed a potential PHP8 error that occurred when removing unused widgets. (acsnaterse)\n* **Cache** Fixed an infinite 301 redirection caused by UTM-encoded link.\n* **CLI** Added syntax examples for values that include line breaks (xLukii)\n* **CLI** Purge requests will now be included with the original request to avoid potential CSS/JS 404 issues.\n* **ESI** Check all user roles for cache vary and page optimization excludes.\n* **GUI** Added a LiteSpeed icon to admin message banners to indicate the banners are from our plugin. (Michael D)\n* **Crawler** Fixed a cache-miss issue that occurred when Guest Mode was ON and WebP Replacement was OFF.\n* **3rd** Remove WooCommerce private cache.\n* **3rd** Removed LiteSpeed metabox from ACF field group edit page. (keepmovingdk)\n\n= 5.2.1 - Sep 7 2022 =\n* \ud83d\udc1e**Core** Fixed a fatal error that occurred when uninstalling. (#894556 Hostinger)\n* **Dash** Show partner info on the dashboard for partner-tier QC accounts.\n* **UCSS** Auto-purge UCSS on post update. (Ankit)\n* \ud83d\udd78\ufe0f**Crawler** Respect the `LITESPEED_CRAWLER_DISABLE_BLOCKLIST` constant for unexpected results too. (Abe)\n\n= 5.2 - Aug 17 2022 =\n* \ud83c\udf31**UCSS** Added UCSS message queue to improve service quality and reliability\n* \ud83d\udc1e**VPI** Fixed conflict w/ image lazyload; used HTML before image lazyload to avoid invalid `data:base64` results.\n* **VPI** Changed VPI Cron default setting to OFF.\n* **VPI** Automatically resend requests when VPI result contains invalid `data:` image value.\n* **Conf** Fixed an issue with URI Excludes, where paths using both ^ and $ were not correctly excluded (Eric/Abe)\n* **Conf** Auto corrected `WP_CONTENT_URL` protocol if it was explicitly set to `http://`.\n* **Cloud** No longer sync the configuration to QUIC.cloud if configuration is unchanged.\n* **Cloud** Appended home_url value into synced configuration data for wp-content folder path correction.\n* \ud83d\udd78\ufe0f**Crawler** Improved compatibility with server `open_basedir` PHP setting limit when detecting load before crawling. (Tom Robak/mmieszalski)\n\n= 5.1 - Aug 1 2022 =\n* \ud83c\udf31**Toolbox** Debug log can now show Purge/Crawler logs as well. (Tynan)\n* **UCSS** Prepared for future message queue.\n* **UCSS** Moved UCSS class to its own file.\n* **3rd** Added 3rd-party support for WC PDF Product Vouchers. (Tynan)\n* **Core** Fixed potential PHP warning when saving summary data. (Sarah Richardson)\n* **Purge** Purge can now clear the summary correctly. (Kevin)\n* **VPI** Added `queue_k` to API notification.\n\n= 5.0.1 - Jul 27 2022 =\n* \ud83d\udc1e**Cloud** Fixed a potential PHP error that could occur with the cloud service summary. (Bruno Cantuaria)\n* **3rd** Added Autoptimize back to compatibility list.\n\n= 5.0.0.1 - Jul 26 2022 =\n* \ud83d\udd25\ud83d\udc1e**Cloud** Fixed an issue with the cloud request timestamp update which causes a usage sync failure. (great thanks to Kevin)\n\n= 5.0 - Jul 25 2022 =\n* \ud83c\udf31**VPI** Added Viewport Images feature to LiteSpeed Options metabox on Post Edit page.\n* \ud83c\udf31**CDN** Added Auto CDN Setup feature for simple QUIC.cloud CDN setup. (Kevin)\n* \ud83c\udf31**Page Optimize** Automatically cache remote CSS/JS files when fetching for optimization (Lauren)\n* \ud83c\udf31**Cache** Added LiteSpeed Options for page-level cache control on Post Edit page. (denisgomesfranco)\n* \ud83c\udf31**Cloud** Auto Alias feature.\n* \ud83c\udf31**Debug** Added `Debug String Excludes` option. (Hanna)\n* \ud83c\udf31**UCSS** Added `Purge this page - UCSS` option to Admin Bar dropdown menu. (Ankit)\n* \ud83c\udf31**Guest** Added `litespeed_guest_off=1` URL query string parameter to bypass Guest Mode. (cbdfactum)\n* \ud83d\udc1e**Page Optimize** Fixed an issue where CSS anchors could be wrongly converted to a full path when minifying. (Tynan)\n* **Page Optimize** Bypass CCSS/UCSS generation when a self-crawled CSS resource returns a 404 code. (Abe)\n* **Object** Allow `LSCWP_OBJECT_CACHE` predefined to turn off Object Cache. (knutsp)\n* **Data** Fixed an issue where empty version tags in the database repeatedly toggled the upgrade banner and reset settings to default.\n* **Purge** Fixed an issue where the site's index page could be purged upon deletion of an unviewable post. (Kevin)\n* **Toolbox** Added `View site before optimization` button under `Debug` tab. (Ryan D)\n* **Admin** Switch to using the `DONOTCACHEPAGE` constant to indicated WP-Admin pages are not cacheable.\n* **Admin** Moved no-cache header to very beginning to avoid caching unexpected exits.\n* **Cloud** Added message queue service for VPI. (Abe)\n* **Cloud** Bypassed 503 error nodes from node redetection process. (Abe)\n* **Cloud** Fixed a failure to detect `out_of_quota`. (Lauren)\n* **Cloud** Added ability to display dismissable banners generated by QUIC.cloud.\n* \ud83d\udd78\ufe0f**Crawler** Added realtime load detection before crawl.\n* \ud83d\udd78\ufe0f**Crawler** Adjusted crawler behavior for Divi pages to allow for Divi's CCSS generation process. (miketemby)\n* \ud83d\udd78\ufe0f**API** PHP constant `LITESPEED_CRAWLER_DISABLE_BLOCKLIST` and filter `litespeed_crawler_disable_blocklist` to disable blocklist. (Tobolo)\n* **CDN** Automatically add a trailing slash to `CDN URL` and `Original URLs` if user didn't provide one. (Lucas)\n* **Cache** When a URL redirects to a URL with a query string, consider these as different for caching purposes. (Shivam)\n* **Media** Added ability to disable lazyload from the LiteSpeed Options metabox on Post Edit page.\n* **Media** Added new default values to `WebP Attribute to Replace` setting for WPBakery and Slider Revolution. (JibsouX)\n* **Image Optimize** Dropped redundant `Page Speed` user agent when serving WebP images. (serpentdriver)\n* **GUI** Fixed an issue where manually dismissable admin messages were instead being treated as one-time messages. (Tynan Beatty)\n* **GUI** Fixed an issue where subsequent admin alerts would overwrite existing alerts in the queue. (Kevin/Tynan)\n* **GUI** Updated time offset in log. (Ruikai #PR444 #PR445)\n* **GUI** Added `litespeed_media_ignore_remote_missing_sizes` API description.\n* **CCSS** Fixed an issue where CCSS was unexpectedly bypassed if `CSS Combine` was OFF and `UCSS Inline` was ON. (Ruikai)\n* **Debug** Added resposne headers to debug log. (Kevin)\n\n= 4.6 - Mar 29 2022 =\n* **Page Optimize** Improved compatibility for JS Delay.\n* \ud83d\udc1e**Page Optimize** Fixed an issue for network subsites that occurred when only CSS/JS Minify are enabled.\n* **Localization** Added query string compatibility for Resource URLs.\n* **Vary** Fixed a potential PHP warning when server variable `REQUEST_METHOD` is not detected.\n* **Cache** Guest Mode now respects Cache Excludes settings.\n* **GUI** Added warning notice when enabling `Localize Resources` feature; each localized JS resource requires thorough testing!\n* **GUI** Fixed a PHP Deprecated warning that occurred with the Mobile Cache User Agent setting on PHP v8.1+. (jrmora)\n* **Conf** Removed Google related scripts from default `Localization Files` value.\n* **Media** WordPress core Lazy Load feature is now automatically disabled when LiteSpeed Lazy Load Images option is enabled. (VR51 #Issue440)\n* \ud83d\udc1e**API** Filter `litespeed_ucss_per_pagetype` for UCSS now also applies to CSS Combine to avoid UCSS failure. (Ankit)\n* **API** Added a filter `litespeed_media_ignore_remote_missing_sizes` to disable auto detection for remote images that are missing dimensions. (Lucas)\n\n= 4.5.0.1 - Feb 24 2022 =\n* \ud83d\udd25\ud83d\udc1e**Media** Fixed an issue where lazy-loaded images would disappear when using custom CSS image loading effects.\n\n= 4.5 - Feb 23 2022 =\n* \ud83c\udf31**Page Optimize** Localization is back.\n* **Guest** Fixed organic traffic issue as different browsers may fail to set `document.referrer`.\n* **Image Optimize** Improved wp_postmeta table compatibility when gathering images. (Thanks to Thomas Stroemme)\n* \ud83d\udc1e**Page Optimize** Fixed a potential CSS/JS 404 issue for existing records that have been marked as expired.\n* **ESI** `LITESPEED_ESI_OFF` now affects `litespeed_esi_url` API filter too.\n* **Guest** Added a check to determine if Guest Mode is blocked by a third-party, and display warning if it is (Ruikai)\n* **Guest** To support WP sites with multiple domains, Guest Mode detection URL no longer uses domain.\n* **Report** Network now shows Toolbox page when having a large number of subsites.\n* **DB Optimize** Reduced default subsites count from 10 to 3 under Network Admin -> DB Optimize page to avoid timeout.\n* **Cloud** Fixed potential `lack_of_token` error when requesting domain key for cases where local summary value was not historically included in the array.\n* **Cloud** Fixed a PHP fatal error that occurred when encountering a frequency issue under CLI. (Dean Taylor #Issue410)\n* **Avatar** Force gravatar cache refresh in browsers and on CDN (rafaucau #PR430)\n* **API** New filter `litespeed_purge_ucss` to purge a single page UCSS. (#376681)\n* **API** New filter `litespeed_ucss_per_pagetype` for UCSS per page type generation. (Ankit)\n* **GUI** Replaced some GUI text and settings with more inclusive language  (kebbet #PR437 #PR435)\n* **3rd** Excluded `WP Statistics` from inline JS optimize. (Ryan D)\n* **3rd** Added API filter `litespeed_3rd_aelia_cookies` for Aelia CurrencySwitcher.\n* **Media** Updated image lazyload library to 17.5.0.\n\n= 4.4.7 - Jan 11 2022 =\n* **Page Optimize** Dropped `Inline Lazy Load Images Library` option. Now will always inline lazyload library. (Ankit)\n* **3rd** Prevented JavaScript files from being appended to Rank Math SEO sitemap.\n* **Purge** Dropped default stale purge when purging a post.\n* **Cloud** Dropped unused API calls.\n* **Cloud** Dropped redundant IP validation in API calls.\n\n= 4.4.6 - Dec 27 2022 =\n* **Guest** Restored `document.referrer` for organic traffic purposes when Guest Mode is enabled. (michelefns)\n* **Image Optimize** Fixed a potential PHP notice when uploading images in WP w/ PHP7.4+. (titsmaker)\n* **ESI** Fixed an issue where ESI settings were not updated on customized widgets(#422 Abe)\n* **3rd** Reverted ESI Adminbar change on Elementor front pages for backward compatibility (#423 Abe)\n* **3rd** Fixed an issue where disabling ESI potential caused a PHP warning when using `Perfmatters`. (Jeffrey Zhang)\n* **Misc** Check whether HTTP_REFERER is set or not before using it in Router class. (#425 Abe)\n\n= 4.4.5 - Dec 1 2021 =\n* **Data** Fixed potential PHP notice when generating CSS/JS optimized files w/ PHP v7.4+. (Sarah Richardson/silencedgd/slr1979)\n* **API** Added `LITESPEED_ESI_OFF` constant to disable ESI, when defined before the WP `init` hook.\n* **API** Added `LSCWP_DEBUG_PATH` constant to specify debug log path. (khanh-nt)\n* \ud83d\udc1e**GUI** Fixed an issue where admin messages were not displayed. (Daniel McD)\n* **CDN** Used WP remote function to communicate w/ Cloudflare per WP guidance.\n* **3rd** Added compatibility for Perfmatters plugin's script manager (#417 Abe)\n* **3rd** Added compatibility for Elementor's Editor button when ESI is on (#418 Abe)\n\n= 4.4.4 - Nov 23 2021 =\n* **Page Optimize** Delay deletion of outdated CSS/JS files for a default of 20 days to avoid 404 errors with cached search engine copies.\n* **Cache** When caching, no longer send a purge request for CSS/JS removal to avoid cache engine conflicts.\n* \ud83d\udc1e**Core** Optimized SQL queries while autoloading if expected options are missing; reduced by 7 and 3 queries on backend and frontend respectively. (#396425 Jackson)\n* **Page Optimize** Fixed a 404 issue that occured when upgrading the plugin manually, with a package upload or through the plugin manager. (Tobolo/Ma\u0142gorzata/Abe)\n* **API** Added `litespeed_ccss_url` and `litespeed_ucss_url` API to manipulate the request URL for CCSS and UCSS.\n* **REST** Fixed a potential warning when detecting cacheable status on REST call. (rafaucau)\n* **OLS** Fixed an issue where the `COOKIEHASH` constant was undefined when used with OpenLiteSpeed as an MU plugin or with network activation.\n* **3rd** Sanitized POST data for nextgengallery.\n* **Cloud** Sanitized GET data when linking to QUIC.cloud. (#591762 WPScan)\n\n= 4.4.3 - Oct 13 2021 =\n* \ud83d\udc1e**Media** Fixed an issue where WebP is served erroneously under Guest Mode on older versions of Safari. (hash73)\n* \ud83d\udc1e**Media** Reverted regex change to fix `Lazy Load Image Parent Class Name Excludes` failure. (thpstock)\n* **Purge** Disabled `Purge Delay` in the optimization process by default.\n* **Conf** Dropped `.htaccess Path Settings` options for security concern. (WP)\n* **Conf** Dropped `CSS HTTP/2 Push`/`JS HTTP/2 Push` options. (Kevin)\n* **Conf** Set `Guest Optimization` default to OFF.\n* **Conf** Set `CCSS Per URL` default to OFF to avoid consuming more quota than intended after upgrade to v4. (n111)\n* **Object** Fixed an issue with Object Cache warnings during upgrade, when Guest Mode is enabled.\n* \u2601\ufe0f**Cloud** Fixed an issue with PHP notices when inquiring about quota usage for a service not currently in use.\n* **GUI** Added GO detail warning. (n111)\n* **GUI** Moved \"quota wil be still in use\" warning from Guest Mode to Guest Optimization section.\n* **API** Added `LITESPEED_CFG_HTACCESS` PHP Constant to specify .htaccess path.\n* **API** Added `litespeed_qs_forbidden` hook to bypass `?LSCWP_CTRL=` query string. (minhduc)\n* **API** Added `litespeed_delay_purge` hook to delay the following Purge header until the next request.\n* **API** Added `litespeed_wpconfig_readonly` hook to disable `WP_CACHE` constant update based on the wp-config.php file. (#633545)\n\n= 4.4.2 - Sep 23 2021 =\n* **Purge** In order to clear pages containing 404 CSS/JS, the purge header will always be sent even in cases where purge must be delayed.\n* \ud83d\udc1e**Purge** Fixed a potential PHP warning caused when generating different optimized filenames.\n* **Cron** Dropped unnecessary HTML response in cron which sometimes resulted in wp-cron report email. (Gilles)\n* **Page Optimize** Purge caused by CSS/JS file deletion will now be silent.\n* **Page Optimize** Fixed an issue where the homepage failed to purge when addressing the 404 CSS/JS issue.\n* **Avatar** Fixed potential localized Avatar folder creation warning. (mattk0220/josebab)\n* **API** Added filter `litespeed_optm_html_after_head` to move all optimized code(UCSS/CCSS/Combined CSS/Combined JS) to be right before the `</head>` tag. (ducpl/Kris Regmi)\n* **Debug** Under debug mode, cache/purge tags will be plaintext.\n\n= 4.4.1 - Sep 16 2021 =\n* \ud83d\udc1e**ESI** Fixed ESI failure on non-cached pages caused by `DONOTCACHEPAGE` constant.\n* \ud83d\udc1e**Page Optimize** Fixed an issue where the minified CSS/JS file failed to update when the file was changed. (ceap80)\n* \ud83d\udc1e**Page Optimize** Fixed an issue where the combined CSS/JS file randomly returned a 404 error when visiting the same URL with different query strings. (Abe)\n* **API** Added `litespeed_const_DONOTCACHEPAGE` hook to control the cache-or-not result of the `DONOTCACHEPAGE` constant.\n\n= 4.4 - Sep 8 2021 =\n* \ud83c\udf31**Crawler** Added the ability to enable or disable specific crawlers. (\u2b50 Contributed by Astrid Wang #PR390)\n* \ud83c\udf31**UCSS** Added `UCSS Inline` option. (Ankit).\n* \ud83c\udf31**UCSS** Added `UCSS URI Excludes` option. (RC Verma).\n* \ud83d\udc1e**Page Optimize** Fixed an issue where combined CSS/JS files would potentially return 404 errors after a Purge All. (Special thanks to Abe & Ruikai)\n* **Page Optimize** Minimized the potential for 404 errors by query string when Purging All.\n* **Page Optimize** Dropped redundant query strings for minified CSS/JS files.\n* **Conf** Ugrade configuration safely to avoid the issue of new functions not being found in old codebase.\n* **Conf** Configuration upgrade process now adds a notification to admin pages and disables configuration save until upgrade is complete. (Lisa)\n* **JS** Fixed an issue where JS Defer caused a `litespeed_var_1_ is not defined` error when enabled w/ ESI options. (Tobolo)\n* \ud83d\udc1e**JS** Fixed an issue where `JS Delay` doesn't work for combined JS when `JS Combine` is enabled. (Special thanks to Joshua & Ankit)\n* **JS** `JS Delay` now will continue loading JS, even if there is an error in the current JS loading process.\n* \ud83d\udc1e**CCSS** If CCSS fails to generate, Load CSS Asynchronously will now be disabled. (Stars #54074166)\n* \ud83d\udc1e**UCSS** If UCSS generation fails the generated error will no longer be served inside the file. (Ryan D)\n* **Log** Updated the Debug log to use less code for prefix.\n* **3rd** Always respect `DONOTCACHEPAGE` constant defination to fix DIVI dynamic css calculation process.\n\n= 4.3 - Aug 16 2021 =\n* **UCSS** Separated UCSS Purge from CCSS Purge. (\u2b50 Contributed by Alice Tang #PR388)\n* \ud83d\udc1e**Cloud** Fixed an issue where CCSS/UCSS quota data failed to update locally.\n* **Cloud** Added server load as a factor when detecting node availability.\n* **Cloud** Improved the speed of checking daily quota and showing the related error message.\n* **Cloud** Added ability to re-detect node availability if the current node is responding w/ a heavy load code.\n* **Cloud** CCSS/UCSS/LQIP queue now exits immediately when quota is depleted.\n* **Cloud** Replaced separate `d/regionnodes` with a single `d/nodes` in the node list API for image optimization.\n* **LQIP** Fixed an issue with LQIP network compatibility. (\u2b50 Contributed by Alice Tang #PR387)\n* **GUEST** JS no longer preloads for Guest Optimization. (Ankit)\n* \ud83d\udc1e**Data** Fixed an issue where deleting the `cssjs` data folder causes a failure in the upgrade process. (Joshua #PR391)\n* **GUI** Fixed a potential dashboard PHP warning when no queue existed. (jrmora)\n* **GUI** Added daily quota on dashboard.\n* **GUI** Added downgrade warning to Toolbox -> Beta Test.\n* **GUI** Tuned `.litespeed-desc` class to full width in CSS.\n* **Conf** `Preserve EXIF/XMP data` now defaults to ON due to copyright concerns. (Tobolo)\n* \ud83d\udc1e**3rd** Fixed a PHP warning when using Google AMP w/ /amp as structure. (thanhstran98)\n\n= 4.2 - Jul 29 2021 =\n* **Cloud** Auto redirect to a new node if the current node is not available anymore.\n* **Cloud** Combined CCSS/UCSS to sub services of Page Optimization.\n* **Cloud** Added a daily quota rate limit to help mitigate the heavy service load at the beginning of the month.\n* **Cloud** Cached the node IP list in order to speed up security check. (Lucas)\n* \ud83d\udc1e**GUEST** Fixed an issue where Guest Mode remained enabled even when the UA setting is empty. (Stars)\n* **GUEST** Guest Mode will no longer cache POST requests.\n* **UCSS** Purging CSS/JS now purges the UCSS queue as well, to avoid failure when generating UCSS.\n* **UCSS** Separated service entry `UCSS` from `CCSS`.\n* **CCSS** Simplified `load_queue/save_queue/build_filepath_prefix` functions. (\u2b50 Contributed by Alice Tang #PR373)\n* **CCSS** If CCSS request fails, details are now saved in the CSS file.\n* **CCSS** Renamed CCSS ID in inline HTML from `litespeed-optm-css-rules` to `litespeed-ccss`. (Alice)\n* **Page Optimize** CCSS/UCSS now supports Cloud queue/notify for asynchronous generation.\n* **Page Optimize** Simplified CCSS/UCSS generation function.\n* **Page Optimize** Added the ability to cancel CCSS/UCSS Cloud requests.\n* **Page Optimize** Unnecessary quesry strings will now be dropped from CSS/JS combined files.\n* **Crawler** Reset position now resets crawler running status too.\n* **REST** Cloud request to REST will now detect whether an IP in in the Cloud IP list for security reasons.\n* **Object** Enhanced Object Cache compatibility for `CONF_FILE` constant detection.\n* **API** Added shorter alias `litespeed_tag` and other similar aliases for Cache Tag API.\n* **API** Renamed `LITESPEED_BYPASS_OPTM` to `LITESPEED_NO_OPTM` for Page Optimization.\n* **Toolbox** Dropped v3.6.4- versions in Beta Test as they will cause a fatal error in downgrade.\n* **GUI** Added shortcut links to each section on the Dashboard.\n* **GUI** Added UCSS whitelist usage description. (wyb)\n* **GUI** Showed the default recommended values for Guest Mode UA/IPs.\n* **3rd** Fixed AMP plugin compatibility. (\u2b50 Contributed by Alice Tang #PR368)\n* **3rd** Bypassed all page optimization including CDN/WebP for AMP pages.\n* **3rd** Improved compatibility with All in One SEO plugin sitemap. (arnaudbroes/flschaves #Issue372)\n* **3rd** Added wsform nonce. (#365 cstrouse)\n* **3rd** Added Easy Digital Download (EDD) & WP Menu Cart nonce. (#PR366 AkramiPro)\n* **3rd** Improved compatibility w/ Restrict Content Pro. (Abe #PR370)\n* **3rd** Improved compatibility w/ Gravity Forms. (Ruikai #371)\n\n= 4.1 - Jun 25 2021 =\n* \ud83c\udf31**UCSS/CCSS/LQIP** Moved queue storage to file system from database wp-options table to lessen the IO load. (#633504)\n* \ud83c\udf31**3rd** Added an option to disable ESI for the WooCommerce Cart. (#358 Anna Feng/Astrid Wang)\n* **ESI** Fixed an ESI nonce issue introduced in v4.0. (Andrew Choi)\n* **Object** Used new `.litespeed_conf.dat` instead of `.object-cache.ini` for object cache configuration storage.\n* **Conf** Now updating related files after plugin upgrade and not just after activation.\n* \ud83c\udf31**Guest** Added a Guest Mode JS Excludes option. (Ankit/Mamac/Rcverma)\n* **Guest** Guest Mode now uses a lightweight script to update guest vary for reduced server load.\n* **Guest** Guest Mode now adds missing image dimensions.\n* **Guest** Guest vary will no longer update if there's already a vary in place to address the infinite loop caused by CloudFlare's incorrect cache control setting for PHP.\n* **Guest** Guest vary update request will no longer be sent if `lscache_vary` is already set.\n* **Guest** Added a Configurable Guest Mode UA/IP under the Tuning tab in the General menu.\n* **Guest** Guest Mode now allows cron to be hooked, even when UCSS/CCSS options are off. (#338437 Stars)\n* **Guest** Simplified the vary generation process under Guest Mode.\n* **Guest** Added a Guest Mode HTML comment for easier debugging. (Ruikai)\n* **Guest** Guest vary update ajax now bypasses potential POST cache.\n* **CCSS** Added back the options `Separate CCSS Cache Post Types` and `Separate CCSS Cache URIs`. (Joshua/Ankit)\n* **CCSS** CCSS/UCSS queue is now limited to a maximum of 500 entries.\n* **Control** The cache control constant `LSCACHE_NO_CACHE` will now have a higher priority than the Forced Public Cache setting.\n* **Crawler** The Crawler can now crawl Guest Mode pages.\n* **Crawler** Fixed a potential XSS vulnerability in the Crawler settings. (#927355)\n* **Crawler** The Crawler now supports a cookie value of `_null`. (Tobolo)\n* **Media** Updated the default value for the Responsive Placeholder SVG to be transparent.\n* **Media** WebP images in the background may now be served in Guest Mode.\n* **Media** WebP images in CSS may now be bypassed if the requesting Guest Mode client doesn't support WebP.\n* **Media** Fixed empty default image placeholder under Guest Mode.\n* \ud83d\udc1e**Image Optimize** Changed the missing `$_POST` to `$post_data` so the database status is properly updated. (#345 Lucas)\n* **Import** Export file is now readable to allow importing of partial configurations. (Ryan D/Joshua)\n* **Page Optimize** Fixed W3 validator errors in Guest Mode. (#61393817)\n* **3rd** A fatal WooCommerce error is no longer triggered by a custom theme reusing a previous LSCWP cache detection tag.\n* **3rd** AMP may now bypass Guest Mode automatically.\n* **Localize** Dropped the `Localize Resources` option as Guest Mode is a sufficient replacement. (Note: Due to user feedback during the development period, we have decided to reinstate this option in a future version.)\n* **Cloud** Changed the WP API url.\n* **Lang** Corrected a missing language folder.\n* **GUI** Added a CCSS/UCSS loading page visualization. (\u2b50 Contributed by Astrid Wang & Anna Feng #PR360)\n* **GUI** Added a warning to indicate when Guest Mode CCSS/UCSS quota is in use. (Contributed by Astrid Wang & Anna Feng #PR361)\n* **GUI** Added a `litespeed-info` text color. (Astrid Wang)\n* **GUI** Implemented various UI/UX improvements. (Joshua/Lisa)\n* **GUI** Duplicate cloud service messages with the same content will only display once now. (Marc Dahl)\n* **GUI** Added a WebP replacement warning for Guest Mode Optimization if WebP replacement is off.\n* **Misc** Dropped `wp_assets` from distribution to reduce the package size. (lowwebtech)\n* **Misc** Increased the new version and score detection intervals.\n* **Misc** Optimized WP Assets images. (#352 lowwebtech)\n* **Debug** Dropped the redundant error_log debug info.\n\n= 4.0 - Apr 30 2021 =\n* \ud83c\udf31\ud83c\udf31\ud83c\udf31**Guest** Introduced `Guest Mode` for instantly cacheable content on the first visit.\n* \ud83c\udf31**UCSS** Added a new service: `Unique CSS`, to drop unused CSS from elements from combined CSS\n* \ud83c\udf31**CCSS** Added `HTML Lazyload` option. (Ankit)\n* \ud83c\udf31**CCSS** Added `CCSS Per URL` option to allow Critical CSS to be generated for each page instead of for each Post Type.\n* \ud83c\udf31**Media** Added `Add Missing Sizes` setting for improving Cumulative Layout Shift. (Fahim)\n* \ud83c\udf31**JS** Switched to new JS minification library for better compression and compatibility w/ template literals. (LuminSol)\n* **Media** WebP may now be replaced in CSS.\n* **Media** Can now drop image tags in noscript to avoid lazyload. (Abe #314 /mattthomas-photography)\n* **Media** Bypass optimization if a page is not cacheable.\n* **Image Optimize** Auto hook to `wp_update_attachment_metadata` to automate image gathering process, and to handle the new thumbnail generation after images are uploaded. (smerriman).\n* **Image Optimize** Repeated image thumbnails won't be gathered anymore.\n* **Image Optimize** Simplified the rescan/gather/upload_hook for existing image detection.\n* **Image Optimize** Fixed the duplicated optimize size records in the postmeta table. (Abe #315)\n* **Image Optimize** Allow either JSON POST request or normal form request in `notify_img`. (Lucas #313)\n* **Image Optimize** Optimized SQL query for better efficiency. (lucas/Lauren)\n* **Image Optimize** Fixed issue where rescan mass created duplicate images. (#954399)\n* **Image Optimize** Image optimization pie will not show 100% anymore if there is still a small amount in the unfinished queue.\n* **Image Optimize** WebP generation defaults to ON for Guest Mode.\n* **Image Optimize** `Priority Line` package now can have smaller request interval.\n* **ESI** Disable ESI when page is not cacheable. (titsmaker)\n* **ESI** Fixed an issue where Divi was disabling all in edit mode, but couldn't disable ESI. (Abe)\n* **ESI** ESI init moved under `init` hook from `plugin_loaded` hook.\n* **CDN** Add basic support for CloudFlare API Tokens (Abe #320)\n* **CSS** Simplified `Font Display Optimization` option.\n* **CSS** Fixed manual cron timeout issue. (jesse Distad)\n* **CSS** Inline CSS may now use `data-no-optimize` to be excluded from optimization. (popaionut)\n* **JS** Combined `Load JS Defer` and `Load Inline JS Defer` options.\n* **JS** Forced async to defer.\n* **JS** Moved Google Analytics JS from constant default to setting default for removal.\n* **JS** Fixed potential JS parsing issue caused by JS src being changed to data-src by other plugins. (ankit)\n* **JS** Excluded spotlight from JS optimize. (tobolo)\n* **CCSS** Fixed CCSS/UCSS manual cron timeout issue.\n* **CCSS** Only 10 items will be kept for CCSS history.\n* **CCSS** The appearance of CCSS Purge in the topbar menu will be determined by the existance of CCSS cache, and not the setting only.\n* **CCSS** To avoid stuck queues when the current request keeps failing, the CCSS queue will always drop once requested.\n* **CCSS** CCSS will no longer hide adminbar.\n* **CCSS** CCSS may now be separate for network subsites. (Joshua)\n* **CCSS** Gave CCSS a unique filename per URL per user role per subsite.\n* **CCSS** Dropped `Separate CCSS Cache Post Types` option.\n* **CCSS** Dropped `Separate CCSS Cache URIs` option.\n* **CCSS** Subsites purge Avatar/CSS/JS/CCSS will not affect the whole network anymore.\n* **CCSS** Implemented a better queue list for CCSS that auto collapses if there are more than 20 entries, and shows the total on top.\n* **CSSJS** Now using separate CSS and JS folders instead of `cssjs`.\n* **CSSJS** Automatically purge cache after CCSS is generated.\n* **Network** Dropped network CSS/JS rewrite rules.\n* **Cache** Send cache tag header whenever adding a tag to make it effective in the page optimization process.\n* **Core** Used hook for buffer optimization; Used `init()` instead of `constructor`.\n* **Object** Used `cls` instead of `get_instance` for init.\n* **Cloud** Replaced one-time message with a dismissible-only message when the domain key has been automatically cleared due to domain/key dismatch.\n* **API** Dropped function `hook_vary_add()`.\n* **API** Dropped function `vary_add()`.\n* **API** Dropped function `filter_vary_cookies()`.\n* **API** Dropped function `hook_vary()`.\n* **API** Dropped action `litespeed_vary_add`.\n* **API** Dropped filter `litespeed_api_vary`.\n* **API** Use `litespeed_vary_curr_cookies` and `litespeed_vary_cookies` for Vary cookie operations instead.\n* **API** Dropped action `litespeed_vary_append`.\n* **Vary** 3rd party vary cookies will not append into .htaccess anymore but only present in response vary header if in use.\n* **Vary** Dropped function `append()`.\n* **Vary** Commenter cookie is now considered cacheable.\n* **Crawler** Minor update to crawler user agent to accommodate mobile_detect.php (Abe #304)\n* **Data** Added a table truncate function.\n* **Data** Added new tables url & url_file.\n* **Data** Dropped cssjs table.\n* **Data** Options/Summary data is now stored in JSON format to speed up backend visit. (#233250)\n* **Data** Default `CSS Combine External and Inline` and `JS Combine External and Inline` to On for new installations for better compatibility.\n* **Purge** Fixed potential purge warning for certain themes.\n* **Purge** Purge will be stored for next valid visit to trigger if it is initially generated by CLI.\n* **Page Optimize** `CSS Combine`/`JS Combine` will now share the same file if the contents are the same. Limited disk usage for better file usage and fewer issues with random string problems.\n* **Page Optimize** Dropped option CSS/JS Cache TTL.\n* **Page Optimize** Bypass optimization if page not cacheable.\n* **Page Optimize** Purge CSS/JS will purge the `url_file` table too.\n* **Page Optimize** Optionally store a vary with a shorter value.\n* **Page Optimize** Removing query strings will no longer affect external assets. (ankit)\n* **Page Optimize** Better regex for optimization parsing.\n* **Page Optimize** Eliminated w3 validator for DNS prefetch and duplicated ID errors. (sumit Pandey)\n* **Page Optimize** New Optimization for Guest Only option under Tuning.\n* **Page Optimize** Now forbidding external link redirection for localization.\n* **Debug** Implemented a better debug format for the 2nd parameter in the log.\n* **GUI** Bypass page score banner when score is not detected (both 0). (ankit)\n* **GUI** Fixed deprecated JQuery function warning in WP-Admin. (krzxsiek)\n\n= 3.6.4 - Mar 15 2021 =\n* **Toolbox** Fixed Beta Test upgrade error when upgrading to v3.7+.\n\n= 3.6.3 - Mar 10 2021 =\n* **Core** Fixed potential upgrade failure when new versions have changes in activation related functions.\n* **Core** Upgrade process won't get deactivated anymore on Network setup.\n\n= 3.6.2 - Feb 1 2021 =\n* **Page Optimize** Fixed an issue where network purge CSS/JS caused 404 errors for subsites.\n* **Page Optimize** Fixed an issue where purge CSS/JS only caused 404 errors.\n* **Page Optimize** Added a notice for CSS/JS data detection and potential random string issue.\n* **Page Optimize** Limited localization resources to specified .js only. (closte #292/ormonk)\n* **JS** Data src may now be bypassed from JS Combine. (ankit)\n* **CLI** Fixed a message typo in Purge. (flixwatchsupport)\n* **Browser** Added font/otf to Browser Cache expire list. (ruikai)\n* **Data** Updated data files to accept PR from dev branch only.\n* **3rd** Add data-view-breakpoint-pointer to js_excludes.txt for the Events Calendar plugin. (therealgilles)\n* **Cloud** Bypassed invalid requests.\n* **Doc** CDN Mapping description improvement. (mihai A.)\n\n= 3.6.1 - Dec 21 2020 =\n* **WP** Tested up to WP v5.6.\n* **WebP** Reverted WebP support on Safari Big Sur and Safari v14.0.1+ due to an inability to detect MacOS versions from UA. (@antomal)\n* **CDN** Dropped the option `Load JQuery Remotely`.\n* **CDN** Fixed CDN URL replacement issue in optimized CSS files. (@ankit)\n* **CDN** Fixed an issue where CDN CLI wouldn't set mapping image/CSS/JS to OFF when `false` was the value.\n* **CDN** Started using React for CDN Mapping settings.\n* **GUI** Secured Server IP setting from potential XSS issues. (@WonTae Jang)\n* **Toolbox** Supported both dev and master branches for Beta Test. Latest version updated to v3.6.1.\n* **Purge** Purge Pages now can purge non-archive pages too.\n* **Admin** Simplified the admin JS.\n* **Admin** Limited crawler-related react JS to crawler page only.\n\n= 3.6 - Dec 14 2020 =\n* \ud83c\udf31**WebP** Added WebP support on Safari Big Sur or Safari v14.0.1+. (@ruikai)\n* \ud83d\udc1e**Config** Fixed an issue where new installations were not getting the correct default .htaccess content.\n* **Crawler** Will auto bypass empty sub-sitemap instead of throwing an exception. (@nanoprobes @Tobolo)\n* **Crawler** Now using React for Cookie Simulation settings instead of Vue.js. Dropped Vue.js.\n* **Crawler** Dropped `Sitemap Generation` (will only use 3rd party sitemap for crawler).\n* **CSS** Added `CSS Combine External and Inline` option for backward compatibility. (@lisa)\n* **Object** Forbid .object-cache.ini visits. (@Tarik)\n* **Page Optimize** Dropped `Remove Comments` option to avoid combine error.\n* **CSS** Added a predefined CSS exclude file `data/css_excludes.txt`.\n* **CSS** Excluded Flatsome theme random inline CSS from combine.\n* **CSS** Excluded WoodMart theme from combine. (@moemauphie)\n* **Page Optimize** Excluded tagDiv.com Newspaper theme dynamic CSS/JS from CSS/JS Combine.\n* **CSS** Added predefined JS defer excludes list. (@Shivam)\n* **JS** `data-no-defer` option now supports inline JS. (@rafaucau)\n* **Media** Lazyload inline library is now bypassed by JS Combine.\n* **Admin** Fixed WP-Admin console ID duplicate warnings.\n* **Cloud** Dropped QUIC.cloud sync options that have long been unused.\n* **CSS** Dropped `Unique CSS File` option (UCSS will always generate unique file, will use whitelist to group post type to one CSS).\n* **GUI** Dropped Help tab.\n* **Toolbox** Added 3.5.2 to version list.\n\n= 3.5.2 - Oct 27 2020 =\n* **CSS** `CSS Combine` is now compatible w/ inline noscript CSS. (@galbaras)\n* **GUI** Added ability to manually dismiss the JS option reset message in v3.5.1 upgrade process. (#473917)\n* \ud83d\udc1e**CSS** `CSS Excludes` setting will no longer lose items beginning w/ `#`. (@ankit)\n* **API** New `litespeed_media_reset` API function for image editing purposes. (@Andro)\n\n= 3.5.1 - Oct 20 2020 =\n* **JS** Inline JS containing nonces can now be combined.\n* **JS** Reset JS Combine/Defer to OFF when upgrading to avoid breaking sites.\n* **JS** Added new option JS Combine External and Inline to allow backwards compatibility.\n* **JS** Added Inline JS Defer option back. (@ankit)\n* **Page Optimize** Dropped Inline JS Minify option and merged the feature into JS Minify.\n* **JS** Pre-added jQuery to the default JS excludes/defer list for better layout compatibility for new users.\n* **JS** Excluded Stripe/PayPal/Google Map from JS optimization. (@FPCSJames)\n* **JS** Allowed excluded JS to still be HTTP2 pushed. (@joshua)\n* **CCSS** Critical CSS now can avoid network pollution from other sites. (@ankit)\n* **Toolbox** Beta Test now displays recent public versions so it is easier to revert to an older version\n* **Vary** Server environment variable Vary can now be passed to original server from QUIC.cloud for non-LiteSpeed servers.\n* **ESI** Improved backward compatibility for ESI nonce list. (@zach E)\n* \ud83d\udc1e**Misc** Fixed failure of upgrade button on plugin news banner and made cosmetic improvements.\n* **Doc** Added note that LSCWP works with ClassicPress.\n\n= 3.5.0.2 - Sep 30 2020 =\n* This is a temporary revert fix. Code is SAME as v3.4.2.\n\n= 3.5.0.1 - Sep 29 2020 =\n* \ud83d\udd25\ud83d\udc1e**CSS** Fixed print media query issue when having CSS Combine. (@paddy-duncan)\n\n= 3.5 - Sep 29 2020 =\n* **Page Optimize** Refactored CSS/JS optimization.\n* **Page Optimize** CSS and JS Combine now each save to a single file without memory usage issues.\n* **CSS** Inline CSS Minify is now a part of CSS Minify, and will respect thr original priorities. (thanks to @galbaras)\n* **JS** JS Combine now generates a single JS file in the footer. (Special thanks to @ankit)\n* **JS** JS Combine now combines external JS files, too. (Thanks to @ankit)\n* **JS** JS Deferred Excludes now uses the original path/filename as keywords instead of the minified path/filename, when JS Minify is enabled.\n* **JS** JS Combine now combines inline JS, too.\n* **JS** JS Excludes may now be used for inline JS snippet.\n* **Page Optimize** Inline CSS Minify and Max Combined File Size retired due to changes listed above.\n* **CSS** Combined CSS Priority retired due to changes listed above.\n* **JS** Exclude JQuery, Combined JS Priority, Load Inline JS Deferred, and Inline JS Deferred Excludes retired due to changes listed above.\n* **JS** Predefined data file data/js_excludes.txt now available for JS Excludes.\n* **ESI** Predefined data file data/esi.nonces.txt now available for ESI Nonces.\n* **ESI** Remote Fetch ESI Nonces functionality retired.\n* **API** Added support for new litespeed_esi_nonces filter.\n* **Object** Object Cache will not try to reconnect after failure to connect in a single process.\n* **CCSS** Remote read CSS will add the scheme if it is missing from the URL.\n* **CCSS** CSS will no longer be prepared for a URL if 404 result is detected.\n* **CCSS** Fixed most failures caused by third party CSS syntax errors.\n* **CCSS** Remote read CSS will fix the scheme if the URL doesn't have it.\n* **CCSS** Excluded 404 when preparing CSS before request.\n* **CCSS** Adjusted CCSS timeout from 180 seconds to 30 seconds.\n* **Image Optimize** Fixed the delete attachment database error that occurred when not using the image optimization service yet.\n* **Media** Added iOS 14 WebP support.\n* **Data** Fixed database creation failure for MySQL v8.\n* **Cloud** Error code err_key will clear the domain key in order to avoid duplicate invalid requests.\n* **Network** Fixed issue with object cache password file storage that occurred when resaving the settings. (#302358)\n* **Misc** Fixed IP detect compatibility w/ Apache.\n* **GUI** Fixed the description for Do Not Cache Categories.\n* **Preload** Upgraded Instant Click to a new stable preload library. (@stasonua0)\n\n= 3.4.2 - Sep 8 2020 =\n* **CCSS** Corrected the issue that wrongly appended non-CSS files to CSS in links before sending request.\n* **3rd** YITH wishlist now sends a combined single sub request for all widgets contained in one page. (LSWS v5.4.9 build 3+ required)\n* **ESI** Added support for ESI combine feature.\n* **GUI** Dropped banner notification for missing domain key when domain key is not initialized.\n* **Log** When QC whitelist check fails, a detailed failure log is now appended.\n\n= 3.4.1 - Sep 2 2020 =\n* \ud83d\udc1e**CCSS** Fixed an issue where dynamically generated CSS failed with `TypeError: Cannot read property type of undefined`.\n* \ud83d\udc1e**Page Optimize** Fixed CSS optimization compatibility for CSS dynamically generated with PHP.\n* **Page Optimize** Added the ability to defer JS even when the resource is excluded from other JS optimizations. (@slr1979)\n* **ESI** Added support for ESI last paramater inline value.\n* **3rd** YITH Wishlist, when cached for the first time, will no longer send sub requests.\n\n= 3.4 - Aug 26 2020 =\n* \ud83c\udf31**LQIP** New setting **LQIP Excludes**.\n* \ud83c\udf31**LQIP** Added a Clear LQIP Queue button.\n* \ud83c\udf31**CCSS** Added a Clear CCSS Queue button.\n* **CCSS** Fixed an issue which wrongly included preloaded images in CCSS. (@pixtweaks)\n* **Network** Primary site and subsite settings now display correctly.\n* **Page Optimize** Noscript tags generated by LSCWP will only be dropped when the corresponding option is enabled. (@ankit)\n* **DB Optimize** Fixed database optimizer conflicts w/ object cache transient setting. (#752931)\n* **3rd** Fixed an issue with WooCommerce product purge when order is placed.\n* **3rd** Improved WooCommerce product comment compatibility with **WooCommerce Photo Reviews Premium** plugin when using ESI.\n* **CDN** Fixed Remote jQuery compatibility with WordPress v5.5. (@pixtweaks)\n* **API** New API `litespeed_purge_all_object` and `litespeed_purged_all_object` action hooks.\n\n= 3.3.1 - Aug 12 2020 =\n* \ud83c\udf31**Page Optimize** New option to Remove Noscript Tags. (@phuc88bmt)\n* \ud83d\udc1e**LQIP** Fixed a critical bug that bypassed all requests in v3.3.\n* **LQIP** Requests are now bypassed if domain has no credit left.\n* **Page Optimize** Inline defer will be bypassed if document listener is detected in the code. (@ssurfer)\n* **CCSS** Print-only styles will no longer be included in Critical CSS.\n* **API** Added hooks to Purge action to handle file deletions. (@biati)\n* **Cloud** Plain permalinks are no longer required for use of cloud services.\n* **Data** Added an access denial to work with OpenLiteSpeed. (@spenweb #PR228)\n* **GUI** Spelling and grammar adjustments. (@blastoise186 #PR253)\n\n= 3.3 - Aug 6 2020 =\n* \ud83c\udf31**Page Optimize** Added a new setting, Inline JS Deferred Excludes. (@ankit)\n* **Page Optimize** CSS/JS Combine/Minify file versions will be differentiated by query string hash instead of new filename to reduce DB/file system storage.\n* **Page Optimize** Added the ability to use local copies of external JS files for better control over page score impacts.\n* **Page Optimize** Improved combination of CSS media queries. (@galbaras)\n* **Page Optimize** Reprioritized Inline JS Defer to be optimized before encoding, for a significantly smaller result.\n* **LQIP** Detect if the file exists before sending LQIP request to QUIC.cloud.\n* **CCSS** Sped up CCSS process significantly by sending HTML and CSS in request.\n* **CCSS** Improvements to mobile CSS support in CCSS.\n* **CCSS** Minimize CCSS failures by attempting to automatically fix CSS syntax errors.\n* **Cloud** Domain Key will be deleted after QUIC.cloud site_not_registered error to avoid endless repeated requests.\n* **CDN** CDN Original URL will default to WP Site URL if not set. (@ruikai)\n* **CLI** Global output format `--format=json/yaml/dump` and `--json` support in CLI. (@alya1992)\n* **CDN** Improved handling of non-image CSS `url()` sources in CDN. (@daniel McD)\n* \ud83d\udc1e**CDN** Fixed CDN replacement conflict w/ JS/CSS Optimize. (@ankit)\n* **Crawler** Only reset Crawler waiting queues when crawling begins. (@ruikai)\n* **Network** Network Enable Cache is no longer reset to ON Use Network Settings in enabled. (@RavanH)\n* \ud83d\udc1e**Activation** Fixed a PHP warning that appeared during uninstall. (@RavanH)\n* **Debug** Automatically omit long strings when dumping an array to debug log.\n* **Report** Subsites report now shows overwritten values along w/ original values. (#52593959)\n* **REST** Improved WP5.5 REST compatibility. (@oldrup)\n* **GUI** Server IP setting moved from Crawler menu to General menu.\n* **GUI** Localize resources moved to Localization tab.\n* **Config** News option now defaults to ON.\n\n= 3.2.4 - Jul 8 2020 =\n* **Object** New installations no longer get custom data.ini reset, as this could cause lost configuration. (@Eric)\n* **ESI** Now using `svar` to load nonces more quickly. (@Lauren)\n* **ESI** Fixed the conflicts between nonces in inline JS and ESI Nonces when Inline JS Deferred is enabled. (@JesseDistad)\n* \ud83d\udc1e**ESI** Fixed Fetch Latest Predefined Nonce button.\n* \ud83d\udc1e**Cache** Fixed an issue where mobile visits were not being cached when Cache Mobile was disabled.\n* **CDN** Bypass CDN constant `LITESPEED_BYPASS_CDN` now will apply to all CDN replacements.\n* **Router** Dropped `Router::get_uid()` function.\n* **Crawler** Updated role simulator function for future UCSS usage.\n* **GUI** Textarea will now automatically adjust the height based on the number of rows input.\n* **CLI** Fixed an issue that caused WP-Cron to exit when a task errored out. (@DovidLevine @MatthewJohnson)\n* **Cloud** No longer communcate with QUIC.cloud when Domain Key is not set and Debug is enabled.\n* **Cloud** Score banner no longer automatically fetches a new score. (@LucasRolff)\n\n= 3.2.3.2 - Jun 19 2020 =\n* \ud83d\udd25\ud83d\udc1e**Page Optimize** Hotfix for CSS/JS minify/combine. (@jdelgadoesteban @martin_bailey)\n\n= 3.2.3.1 - Jun 18 2020 =\n* **API** New filter `litespeed_buffer_before` and `litespeed_buffer_after`. (#PR243 @joejordanbrown)\n\n= 3.2.3 - Jun 18 2020 =\n* \ud83c\udf31**Page Optimize** Added Unique CSS option for future removal of unused CSS per page. (@moongear)\n* **Page Optimize** Fixed an issue where Font Optimization could fail when having Load JS Deferred and Load Inline JS Deferred. (#PR241 @joejordanbrown)\n* \ud83d\udc1e**Page Optimize** Fixed an issue with Font Display Optimization which caused Google Fonts to load incorrectly. (#PR240 @joejordanbrown @haidan)\n* \ud83d\udc1e**Network** Use Primary Site Configuration setting for network sites now works properly with Object Cache and Browser Cache. (#56175101)\n* **API** Added filter `litespeed_is_from_cloud` to detect if the current request is from QC or not. (@lechon)\n* **ESI** ESI Nonce now can fetch latest list with one click.\n* **GUI** Updated remaining documentation links & some minor UI tweaks. (@Joshua Reynolds)\n\n= 3.2.2 - Jun 10 2020 =\n* \ud83c\udf31**Purge** Scheduled Purge URLs now supports wildcard. (#427338)\n* \ud83c\udf31**ESI** ESI Nonce supports wildcard match now.\n* **Network** Use Primary Site Settings now can support Domain Key, and override mechanism improved. (@alican532 #96266273)\n* **Cloud** Debug mode will now have no interval limit for most cloud requests. (@ruikai)\n* **Conf** Default Purge Stale to OFF.\n* **GUI** Purge Stale renamed to Serve Stale.\n* **Data** Predefined nonce list located in `/litespeed-cache/data/esi.nonce.txt`. Pull requests welcome.\n* **Debug** Limited parameter log length.\n* \ud83d\udc1e**CDN** Fixed an issue where upgrading lost value of CDN switch setting. (#888668)\n* **3rd** Caldera Forms ESI Nonce enhancement. (@paconarud16 @marketingsweet)\n* **3rd** Elementor now purges correctly after post/page updates.\n* **3rd** Disabled Page Optimization features on AMP to avoid webfont JS inject. (@rahulgupta1985)\n\n= 3.2.1 - Jun 1 2020 =\n* **Cloud** LQIP/CCSS rate limit tweaks. (@ianpegg)\n* **Admin** Improved frontend Admin Bar menu functionality. (#708642)\n* **Crawler** Fixed an issue where cleaning up a crawler map with a leftover page number would cause a MySQL error. (@saowp)\n* **Image Optimize** Added WP default thumbnails to image optimization summary list. (@johnny Nguyen)\n* **REST** Improved REST compatibility w/ WP4.4-. (#767203)\n* **GUI** Moved Use Primary Site Configuration to General menu. (@joshua)\n\n= 3.2 - May 27 2020 =\n* **Image Optimize** Major improvements in queue management, scalability, and speed. (@LucasRolff)\n* **Cloud** Implemented a series of communication enhancements. (@Lucas Rolff)\n* **Crawler** Enhanced PHP 5.3 compatibility. (@JTS-FIN #230)\n* **Page Optimize** Appended image template in wpDiscuz script into default lazyload image exclude list. (@philipfaster @szmigieldesign)\n* **Page Optimize** Eliminated the 404 issue for CSS/JS in server environments with missing SCRIPT_URI. (@ankit)\n* **Data** ENhanced summary data storage typecasting.\n\n= 3.1 - May 20 2020 =\n* \ud83c\udf31**Network** Added Debug settings to network level when on network.\n* \ud83d\udc1e**Purge** Network now can purge all.\n* \ud83d\udc1e**Network** Fixed issue where saving the network primary site settings failed.\n* **Network** Moved Beta Test to network level when on network.\n* \ud83d\udc1e**Cache** Fixed issue in admin where new post editor was wrongly cached for non-admin roles. (@TEKFused)\n* \ud83d\udc1e**Data** Fixed issue with crawler & img_optm table creation failure. (@berdini @piercand)\n* \ud83d\udc1e**Core** Improved plugin activation compatibility on Windows 10 #224 (@greenphp)\n* **Core** Improved compatibility for .htaccess path search.\n* **Object** Catch RedisException. (@elparts)\n* Fixed Script URI issue in 3.0.9 #223 (@aonsyed)\n* **Image Optimize** Show thumbnail size set list in image optimization summary. (@Johnny Nguyen)\n* **Debug** Parameters will now be logged.\n\n= 3.0.9 - May 13 2020 =\n* **Purge** Comment cache can be successfully purged now.\n* **Data** Better MySQL charset support for crawler/image optimize table creation. (@Roshan Jonah)\n* **API** New hook to fire after Purge All. (@salvatorefresta)\n* **Crawler** Resolve IP for crawler.\n* **Task** PHP5.3 Cron compatibility fix.\n* **3rd** Elementor edit mode compatibility.\n* **Page Optimize** Fixed an issue where Purge Stale returned 404 for next visitor on CSS/JS.\n* **Page Optimize** Fixed the PHP warning when srcset doesn't have size info inside. (@gvidano)\n* **Cloud** Fixed the potential PHP warning when applying for the domain key.\n* **Core** PHP __DIR__ const replacement. (@MathiasReker)\n\n= 3.0.8.6 - May 4 2020 =\n* **CCSS** Bypassed CCSS functionality on frontend when domain key isn't setup yet.\n* **Cloud** Fixed WP node redetection bug when node expired. (@Joshua Reynolds)\n* **Crawler** Fixed an issue where URL is wrongly blacklisted when using ADC.\n\n= 3.0.8.5 - May 1 2020 =\n* \ud83d\udd25\ud83d\udc1e**3rd** Hotfix for WPLister critical error due to v3.0.8.4 changes.\n* **Image Optimize** Unfinished queue now will get more detailed info to indicate the proceeding status on node.\n* **CLI** Options can now use true/false as value for bool. (@gavin)\n* **CLI** Detect error if the ID does not exist when get/set an option value.\n* **Doc** An API comment typo for `litespeed_esi_load-` is fixed.\n\n= 3.0.8.4 - Apr 30 2020 =\n* \ud83c\udf31**Crawler** New setting: Sitemap timeout. (#364607)\n* **Image Optimize** Images that fail to optimize are now counted to increase next request limit.\n* **Cloud** Redetect fastest node every 3 days.\n* **Cloud** Suppressed auto upgrade version detection error. (@marc Dahl)\n* **3rd** 3rd party namespace compatibility. (#366352)\n\n= 3.0.8.3 - Apr 28 2020 =\n* **Cloud** Better compatibility for the Link to QUIC.cloud operation. (@Ronei de Sousa Almeida)\n* **Image Optimize** Automatically clear invalid image sources before sending requests. (@Richard Hordern)\n\n= 3.0.8.2 - Apr 27 2020 =\n* **GUI** Corrected the Request Domain Key wording.\n\n= 3.0.8.1 - Apr 27 2020 =\n* **Object** Object cache compatibility for upgrade from v2.9.9- versions.\n\n= 3.0.8 - Apr 27 2020 =\n* Released v3 on WordPress officially.\n\n= 3.0.4 - Apr 23 2020 =\n* **Cloud** Apply Domain Key now receives error info in next apply action if failed to generate.\n* **GUI** Apply Domain Key timeout now displays troubleshooting guidance.\n* **REST** Added /ping and /token to REST GET for easier debug.\n* **Cache** Dropped `advanced-cache.php` file detection and usage.\n\n= 3.0.3 - Apr 21 2020 =\n* **Conf** Settings from all options (data ini, defined constant, and forced) will be filtered and cast to expected type.\n* **Upgrade** CDN mapping and other multiple line settings will now migrate correctly when upgrading from v2 to v3.\n\n= 3.0.2 - Apr 17 2020 =\n* **GUI** More guidance on domain key setting page.\n* **Cloud** Now Apply Domain Key will append the server IP if it exists in Crawler Server IP setting.\n\n= 3.0.1 - Apr 16 2020 =\n* **Data** Increased timeout for database upgrade related to version upgrade. Display a banner while update in progress.\n* **Page Optimize** All appended HTML attributes now will use double quotes to reduce the conflicts when the optimized resources are in JS snippets.\n\n= 3.0 - Apr 15 2020 =\n* \ud83c\udf31**Media** LQIP (Low Quality Image Placeholder).\n* \ud83c\udf31**Page Optimize** Load Inline JS Deferred Compatibility Mode. (Special thanks to @joe B - AppsON)\n* \ud83c\udf31**Cloud** New QUIC.cloud API key setting.\n* \ud83c\udf31**ESI** New ESI nonce setting.\n* \ud83c\udf31**Media** JPG quality control. (@geckomist)\n* \ud83c\udf31**Media** Responsive local SVG placeholder.\n* \ud83c\udf31**Discussion** Gravatar warmup cron.\n* \ud83c\udf31**DB** Table Engine Converter tool. (@johnny Nguyen)\n* \ud83c\udf31**DB** Database summary: Autoload size. (@JohnnyNguyen)\n* \ud83c\udf31**DB** Database summary: Autoload entries list.\n* \ud83c\udf31**DB** Revisions older than. (@thememasterguru)\n* \ud83c\udf31**Cache** Forced public cache setting. (#308207)\n* \ud83c\udf31**Crawler** New timeout setting to avoid incorrect blacklist addition. (#900171)\n* \ud83c\udf31**Htaccess** Frontend & backend .htaccess path customize. (@jon81)\n* \ud83c\udf31**Toolbox** Detailed Heartbeat Control (@K9Heaven)\n* \ud83c\udf31**Purge** Purge Stale setting.\n* \ud83c\udf31**Page Optimize** Font display optimization. (@Joeee)\n* \ud83c\udf31**Page Optimize** Google font URL display optimization.\n* \ud83c\udf31**Page Optimize** Load Inline JS deferred.\n* \ud83c\udf31**Page Optimize** Store gravatar locally. (@zzTaLaNo1zz @JohnnyNguyen)\n* \ud83c\udf31**Page Optimize** DNS prefetch control setting.\n* \ud83c\udf31**Page Optimize** Lazy Load Image Parent Class Name Excludes. (@pako69)\n* \ud83c\udf31**Page Optimize** Lazy load iframe class excludes. (@vnnloser)\n* \ud83c\udf31**Page Optimize** Lazy load exclude URIs. (@wordpress_fan1 @aminaz)\n* \ud83c\udf31**GUI** New Dashboard and new menus.\n* \ud83c\udf31**Image Optimize** Supported GIF WebP optimization. (@Lucas Rolff)\n* \ud83c\udf31**Image Optimize** New workflow for image optimization (Gather first, request second).\n* \ud83c\udf31**Image Optimize** The return of Rescan.\n* \ud83c\udf31**CLI** Get single option cmd.\n* \ud83c\udf31**CLI** QUIC.cloud cmd supported.\n* \ud83c\udf31**CLI** CLI can send report now.\n* \ud83c\udf31**Health** Page speed and page score now are in dashboard.\n* \ud83c\udf31**Conf** Supported consts overwritten of `LITESPEED_CONF__` for all settings. (@menathor)\n* \ud83c\udf31**REST** New REST TTL setting.  (@thekendog)\n* \ud83c\udf31**CDN** New setting `HTML Attribute To Replace`. CDN can now support any HTML attribute to be replaced. (@danushkaj91)\n* \ud83c\udf31**Debug** Debug URI includes/excludes setings.\n* \ud83c\udf31**Crawler** \ud83d\udc1e Support for multiple domains in custom sitemap. (@alchem)\n* \ud83c\udf31**Crawler** New Crawler dashboard. New sitemap w/ crawler status. New blacklist w/ reason.\n* \ud83c\udf31**Media** LQIP minimum dimensions setting. (@Lukasz Szmigiel)\n* **Crawler** Able to add single rows to blacklist.\n* **Crawler** Crawler data now saved into database instead of creating new files.\n* **Crawler** Larger timeout to avoid wrongly added to blacklist.\n* **Crawler** Manually changed the priority of mobile and WebP. (@rafaucau)\n* **Browser** Larger Browser Cache TTL for Google Page Score improvement. (@max2348)\n* **Task** Task refactored. Disabled cron will not show in cron list anymore.\n* **Task** Speed up task load speed.\n* **ESI** Added Bloom nonce to ESI for Elegant Themes.\n* **Cloud** Able to redetect cloud nodes now.\n* **Img_optm** Fixed stale data in redirected links.\n* **Lazyload** CSS class `litespeed_lazyloaded` is now appended to HTML body after lazyload is finished. (@Adam Wilson)\n* **Cache** Default drop qs values. (@gijo Varghese)\n* **LQIP** Show all LQIP images in Media column.\n* **CDN** Can now support custom REST API prefix other than wp-json. (#174 @therealgilles)\n* **IAPI** Used REST for notify/destroy/check_img; Removed callback passive/aggreesive IAPI func\n* **CSSJS** Saved all static files to litespeed folder; Uninstallation will remove static cache folder too; Reduced .htaccess rules by serving CSS/JS directly.\n* **Object** Fixed override different ports issue. (@timofeycom #ISSUE178)\n* **Conf** DB Tables will now only create when activating/upgrading/changing settings.\n* **DB** Simplified table operation funcs.\n* **CSSJS** Bypassed CSS/JS generation to return 404 if file is empty (@grubyy)\n* **CSSJS** Inline JS defer will not conflict with JS inline optm anymore.\n* **CDN** settings will not be overwritten by primary settings in network anymore. (@rudi Khoury)\n* **OPcache** Purged all opcache when updating cache file. (@closte #170)\n* **CLI** CLI cmd renamed.\n* **CLI** Well-formated table to show all options.\n* **Purge** Only purge related posts that have a status of \"published\" to avoid unnecessary \"draft\" purges. (@Jakub Knytl)\n* **GUI** Removed basic/adv mode for settings. Moved non-cache settings to its own menu.\n* **Htaccess** Protected .htaccess.bk file. Only kept one backup. (@teflonmann)\n* **Crawler** Crawler cookie now support `_null` as empty value.\n* **Crawler** Avoid crawler PHP fatal error on Windows OS. (@technisolutions)\n* **Admin** Simplified admin setting logic.\n* **Conf** Multi values settings now uniformed to multi lines for easier setting.\n* **Conf** New preset default data file `data/consts.default.ini`.\n* **Conf** Config setting renamed and uniformed.\n* **Conf** Dropped `Conf::option()`. Used `Conf::val()` instead.\n* **Conf** Improved conf initialization and upgrade convertion workflow.\n* **Core** Code base refactored. New namespace LiteSpeed.\n* **API** New API: iframe lazyload exclude filter.\n* **GUI** human readable seconds. (@MarkCanada)\n* **API** API refactored. * NOTE: All 3rd party plugins that are using previous APIs, especially `LiteSpeed_Cache_API`, need to be adjusted to the latest one. Same for ESI blocks.* ESI shortcode doesn't change.\n* **API** New hook `litespeed_update_confs` to settings update.\n* **API** New Hooks `litespeed_frontend_shortcut` and `litespeed_backend_shortcut` for dropdown menu. (@callaloo)\n* **API** Removed `litespeed_option_*` hooks. Use `litespeed_force_option` hook insteadly\n* **API** Renamed `litespeed_force_option` to `litespeed_conf_force`.\n* **API** Removed function `litespeed_purge_single_post`.\n* **REST** New rest API to fetch public IP.\n* **GUI** Hiding Cloudflare/Object Cache/Cloud API key credentials. (@menathor)\n* **GUI** Renamed all backend link tag from lscache to litespeed.\n* **GUI** fixed duplicated form tag.\n* **GUI** Fix cron doc link. (@arnab Mohapatra)\n* **GUI** Frontend adminbar menu added `Purge All` actions. (@Monarobase)\n* **GUI** Localized vue.js to avoid CloudFlare cookie. (@politicske)\n* **GUI** Always show optm column in Media Library for future single row optm operation. (@mikeyhash)\n* **GUI** Displayed TTL range below the corresponding setting.\n* **GUI** GUI refactored.\n* **Debug** Report can now append notes.\n* **3rd** Default added parallax-image to webp replacement for BB.\n* **3rd** User Switching plugin compatibility. (@robert Staddon)\n* **3rd** Beaver Builder plugin compatibility with v3.0.\n* **3rd** Avada plugin compatibility w/ BBPress. (@pimg)\n* **3rd** WooCommerce PayPal Checkout Gateway compatibility. (#960642 @Glen Cabusas)\n* **Network** Fixed potential timeout issue when containing a large volume of sites. (@alican532)\n* **Debug** `Disable All Features` now will see the warning banner if ON.\n* **Debug** Dropped `log filters` section.\n* **Debug** Debug and Tools sections combined into new `Toolbox` section.\n* \ud83d\udc1e**Crawler** Multi sites will now use separate sitemap even when `Use Primary Site` is ON. (@mrhuynhanh)\n* \ud83d\udc1e**Img_optm** Fixed large volume image table storage issue. (#328956)\n* \ud83d\udc1e **Cloud** Cloud callback hash validation fixed OC conflict. (@pbpiotr)\n* \ud83c\udf8a Any user that had the contribution to our WP community or changelog (even just bug report/feedback/suggestion) can apply for extra credits in QUIC.cloud.\n\n= 2.9.9.2 - Nov 24 2019 =\n* \ud83c\udf31**GUI** New settings to limit News Feed to plugin page only.\n\n= 2.9.9.1 - Nov 18 2019 =\n* \ud83c\udf31**Env** Environment Report can now append a passwordless link for support access without wp-admin password.\n* **Admin** The latest v3.0 beta test link may now be shown on the admin page when it's available.\n* **3rd** Compatibility with [DoLogin Security](https://wordpress.org/plugins/dologin/).\n* \ud83d\udc1e**ESI** Fixed a failure issue with Vary Group save. (@rafasshop)\n* \ud83d\udc1e**3rd** In browsers where WebP is not supported, Divi image picker will no longer serve WebP. (@Austin Tinius)\n\n= 2.9.9 - Oct 28 2019 =\n* <strong>Core</strong>: Preload all classes to avoid getting error for upcoming v3.0 upgrade.\n* <strong>Object</strong>: Improved compatibility with upcoming v3.0 release.\n* <strong>ESI</strong>: Unlocked ESI for OLS in case OLS is using QUIC.cloud CDN which supports ESI.\n* <strong>3rd</strong>: Elementor Edit button will now show when ESI enabled. (#PR149 #335322 @maxgorky)\n* \ud83d\udc1e<strong>Media</strong>: Fixed missing Media optimization column when Admin role is excluded from optimization in settings. (@mikeyhash @pako69 @dgilfillan)\n\n= 2.9.8.7 - Oct 11 2019 =\n* <strong>3rd</strong>: Enhanced WP stateless compatibility. (#PR143)\n* <strong>3rd</strong>: Fixed a PHP warning caused by previous PR for AMP. (#PR176)\n\n= 2.9.8.6 - Sep 24 2019 =\n* <strong>3rd</strong>: Bypassed page optimizations for AMP. (#359748 #PR169)\n* <strong>GUI</strong>: Firefox compatibility with radio button state when reloading pages. (#288940 #PR162)\n* <strong>GUI</strong>: Updated Slack invitation link. (#PR173)\n\n= 2.9.8.5 - Aug 21 2019 =\n* <strong>CCSS</strong>: Removed potential PHP notice when getting post_type. (@amcgiffert)\n* <strong>CDN</strong>: Bypassed CDN replacement on admin page when adding media to page/post. (@martin_bailey)\n* \ud83d\udc1e<strong>Media</strong>: Fixed inability to update or destroy postmeta data for child images. (#167713)\n\n= 2.9.8.4 - Jul 25 2019 =\n* <strong>Object</strong>: Increased compatibility with phpredis 5.0.\n* <strong>Object</strong>: Appended `wc_session_id` to default Do Not Cache Groups setting to avoid issue where WooCommerce cart items were missing when Object Cache is used. NOTE: Existing users must add `wc_session_id` manually! (#895333)\n* <strong>CSS</strong>: Added null onload handler for CSS async loading. (@joejordanbrown)\n* \ud83d\udd77\ufe0f: Increased crawler timeout to avoid wrongly adding a URL to the blacklist.\n* <strong>3rd</strong>: WooCommerce Advanced Bulk Edit can now purge cache automatically.\n\n= 2.9.8.3 - Jul 9 2019 =\n* <strong>CSS</strong>: Enhanced the CSS Minify compatibility for CSS with missing closing bracket syntax errors. (@fa508210020)\n* \ud83d\udd77\ufe0f: Crawler now supports both cookie and no-cookie cases. (@tabare)\n* <strong>CCSS</strong>: Enhanced compatibility with requested pages where meta info size exceeds 8k. (@Joe B)\n* <strong>CCSS</strong>: No longer processing \"font\" or \"import\" directives as they are not considered critical. (@Ankit @Joe B)\n* <strong>IAPI</strong>: Removed IPv6 from all servers to avoid invalid firewall whitelist.\n\n= 2.9.8.2 - Jun 17 2019 =\n* \ud83d\udd25\ud83d\udc1e <strong>3rd</strong>: Fixed PHP 5.3 compatibility issue with Facetwp.\n\n= 2.9.8.1 - Jun 17 2019 =\n* <strong>3rd</strong>: Set ESI template hook priority to highest number to prevent ESI conflict with Enfold theme. (#289354)\n* <strong>3rd</strong>: Improved Facetwp reset button compatibility with ESI. (@emilyel)\n* <strong>3rd</strong>: Enabled user role change to fix duplicate login issue for plugins that use alternative login processes. (#114165 #717223 @sergiom87)\n* <strong>GUI</strong>: Wrapped static text with translate function. (@halilemreozen)\n\n= 2.9.8 - May 22 2019 =\n* <strong>Core</strong>: Refactored loading priority so user related functions & optimization features are set after user initialization. (#717223 #114165 #413338)\n* <strong>Media</strong>: Improved backup file calculation query to prevent out-of-memory issue.\n* <strong>Conf</strong>: Feed cache now defaults to ON.\n* <strong>API</strong>: Fully remote attachment compatibility API of image optimization now supported.\n* \ud83d\udd77\ufe0f: Bypassed vary change for crawler; crawler can now simulate default vary cookie.\n* <strong>ESI</strong>: Refactored ESI widget. Removed `widget_load_get_options()` function.\n* <strong>ESI</strong>: Changed the input name of widget fields in form.\n* <strong>3rd</strong>: Elementor can now save ESI widget settings in frontend builder.\n* <strong>3rd</strong>: WP-Stateless compatibility.\n* <strong>IAPI</strong>: Image optimization can now successfully finish the destroy process with large volume images with automatic continual mode.\n* \ud83d\udc1e<strong>CDN</strong>: Fixed issue with Load JQuery Remotely setting where WP 5.2.1 provided an unexpected jQuery version.\n* \ud83d\udc1e<strong>3rd</strong>: Login process now gets the correct role; fixed double login issue.\n\n= 2.9.7.2 - May 2 2019 =\n* <strong>Conf</strong>: Enhanced compatibility when an option is not properly initialized.\n* <strong>Conf</strong>: Prevent non-array instance in widget from causing 500 error. (#210407)\n* <strong>CCSS</strong>: Increase CCSS generation timeout to 60s.\n* <strong>Media</strong>: Renamed lazyload CSS class to avoid conflicts with other plugins. (@DynamoProd)\n* <strong>JS</strong>: Improved W3 validator. (@istanbulantik)\n* <strong>QUIC</strong>: Synced cache tag prefix for static files cache.\n* <strong>ESI</strong>: Restored query strings to ESI admin bar for accurate rendering. (#977284)\n* <strong>ESI</strong>: Tweaked ESI init priority to honor LITESPEED_DISABLE_ALL const. ESI will now init after plugin loaded.\n* \ud83d\udc1e<strong>ESI</strong>: No longer initialize ESI if ESI option is OFF.\n* <strong>API</strong>: New \"Disable All\" API function.\n* <strong>API</strong>: New \"Force public cache\" API function.\n* \ud83d\udc1e<strong>Vary</strong>: Fixed an issue with saving vary groups.\n* \ud83d\udc1e<strong>IAPI</strong>: Fixed an issue where image md5 validation failed due to whitespace in the image path.\n* \ud83d\udc1e<strong>3rd</strong>: Bypass all optimization/ESI/Cache features when entering Divi Theme Builder frontend editor.\n* \ud83d\udc1e<strong>3rd</strong>: Fixed an issue where DIVI admin bar exit button didn't work when ESI was ON.\n\n= 2.9.7.1 - Apr 9 2019 =\n* <strong>Purge</script>: Purge All no longer includes Purge CCSS/Placeholder.\n* <strong>3rd</strong>: Divi Theme Builder no longer experiences nonce expiration issues in the contact form widget. (#475461)\n\n= 2.9.7 - Apr 1 2019 =\n* \ud83c\udf31\ud83c\udf31\ud83c\udf31 QUIC.cloud CDN feature. Now Apache/Nginx can use LiteSpeed cache freely.\n\n= 2.9.6 - Mar 27 2019 =\n* \ud83c\udf31<strong>IAPI</strong>: Appended XMP to `Preserve EXIF data` setting. WebP will now honor this setting. (#902219)\n* <strong>Object</script>: Fixed SASL connection with LSMCD.\n* <strong>ESI</strong>: Converted ESI URI parameters to JSON; Added ESI validation.\n* <strong>Import</strong>: Import/Export will now use JSON format. <strong>Please re-export any backed up settings. Previous backup format is no longer recognized.</strong>\n* <strong>Media</strong>: WebP replacement will honor `Role Excludes` setting now. (@mfazio26)\n* <strong>Data</strong>: Forbid direct visit to const.default.ini.\n* <strong>Utility</strong>: Can handle WHM passed in `LITESPEED_ERR` constant now.\n* <strong>IAPI</strong>: Communicate via JSON encoding.\n* <strong>IAPI</strong>: IAPI v2.9.6.\n\n= 2.9.5 - Mar 14 2019 =\n* \ud83c\udf31 Auto convert default WordPress nonce to ESI to avoid expiration.\n* \ud83c\udf31 <strong>API</strong>: Ability to easily convert custom nonce to ESI by registering `LiteSpeed_Cache_API::nonce_action`.\n* <strong>OPTM</strong>: Tweaked redundant attr `data-no-optimize` in func `_analyse_links` to `data-ignore-optimize` to offer the API to bypass optimization but still move src to top of source code.\n* <strong>API</strong>: Renamed default nonce ESI ID from `lscwp_nonce_esi` to `nonce`.\n* <strong>API</strong>: Added WebP generation & validation hook API. (@alim #wp-stateless)\n* <strong>API</strong>: Added hook to bypass vary commenter check. (#wpdiscuz)\n* <strong>Doc</strong>: Clarified Cache Mobile description. (@JohnnyNguyen)\n* <strong>Doc</strong>: Replaced incorrect link in description. (@JohnnyNguyen)\n* <strong>3rd</strong>: Improved wpDiscuz compatibility.\n* \ud83d\udc1e<strong>3rd</strong>: Fixed Divi Theme Builder comment compatibility on non-builder pages. (#410919)\n* <strong>3rd</strong>: Added YITH ESI adjustment.\n\n= 2.9.4.1 - Feb 28 2019 =\n* \ud83d\udd25\ud83d\udc1e<strong>Tag</strong>: Fixed issue where unnecessary warning potentially displayed after upgrade process when object cache is enabled.\n\n= 2.9.4 - Feb 27 2019 =\n* \ud83d\udc1e<strong>REST</strong>: New REST class with better WP5 Gutenberg and internal REST call support when ESI is embedded.\n* <strong>ESI</strong>: ESI block ID is now in plain text in ESI URL parameters.\n* \ud83d\udc1e<strong>ESI</strong>: Fixed a redundant ESI 301 redirect when comma is in ESI URL.\n* <strong>ESI</strong>: REST call can now parse shortcodes in ESI.\n* <strong>API</strong>: Changed ESI `parse_esi_param()` function to private and `load_esi_block` function to non-static.\n* <strong>API</strong>: Added `litespeed_is_json` hook for buffer JSON conversion.\n* <strong>GUI</strong>: Prepended plugin name to new version notification banner.\n* <strong>3rd</strong>: WPML multi domains can now be handled in optimization without CDN tricks.\n\n= 2.9.3 - Feb 20 2019 =\n* <strong>ESI</strong>: ESI shortcodes can now be saved in Gutenberg editor.\n* <strong>ESI</strong>: ESI now honors the parent page JSON data type to avoid breaking REST calls (LSWS 5.3.6+).\n* <strong>ESI</strong>: Added is_json parameter support for admin_bar.\n* <strong>ESI</strong>: Simplified comment form code.\n* <strong>3rd</strong>: Better page builder plugin compatibility within AJAX calls.\n* <strong>3rd</strong>: Compatibility with FacetWP (LSWS 5.3.6+).\n* <strong>3rd</strong>: Compatibility with Beaver Builder.\n* <strong>Debug</strong>: Added ESI buffer content to log.\n* <strong>Tag</strong>: Only append blog ID to cache tags when site is part of a network.\n* <strong>IAPI</strong>: Optimized database query for pulling images.\n* <strong>GUI</strong>: Added more plugin version checking for better feature compatibility.\n* <strong>GUI</strong>: Ability to bypass non-critical banners with the file .litespeed_no_banner.\n* <strong>Media</strong>: Background image WebP replacement now supports quotes around src.\n\n= 2.9.2 - Feb 5 2019 =\n* <strong>API</strong>: Add a hook `litespeed_esi_shortcode-*` for ESI shortcodes.\n* <strong>3rd</strong>: WooCommerce can purge products now when variation stock is changed.\n* \ud83d\udc1e\ud83d\udd77\ufe0f: Forced HTTP1.1 for crawler due to a CURL HTTP2 bug.\n\n= 2.9.1 - Jan 25 2019 =\n* <strong>Compatibility</strong>: Fixed fatal error for PHP 5.3.\n* <strong>Compatibility</strong>: Fixed PHP warning in htmlspecialchars when building URLs. (@souljahn2)\n* <strong>Media</strong>: Excluded invalid image src from lazyload. (@andrew55)\n* <strong>Optm</strong>: Improved URL compatibility when detecting closest cloud server.\n* <strong>ESI</strong>: Supported JSON format comment format in ESI with `is_json` parameter.\n* <strong>API</strong>: Added filters to CCSS/CSS/JS content. (@lhoucine)\n* <strong>3rd</strong>: Improved comment compatibility with Elegant Divi Builder.\n* <strong>IAPI</strong>: New Europe Image Optimization server (EU5). <strong>Please whitelist the new [IAPI IP List](https://wp.api.litespeedtech.com/ips).</strong>\n* <strong>GUI</strong>: No longer show banners when `Disable All` in `Debug` is ON. (@rabbitwordpress)\n* <strong>GUI</strong>: Fixed button style for RTL languages.\n* <strong>GUI</strong>: Removed unnecessary translation in report.\n* <strong>GUI</strong>: Updated readme wiki links.\n* <strong>GUI</strong>: Fixed pie styles in image optimization page.\n\n= 2.9 - Dec 31 2018 =\n* \ud83c\udf31<strong>Media</strong>: Lazy Load Image Classname Excludes. (@thinkmedia)\n* \ud83c\udf31: New EU/AS cloud servers for faster image optimization handling.\n* \ud83c\udf31: New EU/AS cloud servers for faster CCSS generation.\n* \ud83c\udf31: New EU/AS cloud servers for faster responsive placeholder generation.\n* \ud83c\udf31<strong>Conf</strong>: Ability to set single options via link.\n* \ud83c\udf31<strong>Cache</strong>: Ability to add custom TTLs to Force Cache URIs.\n* <strong>Purge</strong>: Added post type to Purge tags.\n* <strong>Purge</strong>: Redefined CCSS page types.\n* <strong>Core</strong>: Using Exception for .htaccess R/W.\n* <strong>IAPI</strong>: <strong>New cloud servers added. Please whitelist the new [IAPI IP List](https://wp.api.litespeedtech.com/ips).</strong>\n* <strong>Optm</strong>: Trim BOM when detecting if the page is HTML.\n* <strong>GUI</strong>: Added PageSpeed Score comparison into promotion banner.\n* <strong>GUI</strong>: Refactored promotion banner logic.\n* <strong>GUI</strong>: Removed page optimized comment when ESI Silence is requested.\n* <strong>GUI</strong>: WHM transient changed to option instead of transient when storing.\n* <strong>GUI</strong>: Appending more descriptions to CDN filetype setting.\n* <strong>IAPI</strong>: Removed duplicate messages.\n* <strong>IAPI</strong>: Removed taken_failed/client_pull(duplicated) status.\n* <strong>Debug</strong>: Environment report no longer generates hash for validation.\n* <strong>3rd</strong>: Non-cacheable pages no longer punch ESI holes for Divi compatibility.\n* \ud83d\udc1e<strong>Network</strong>: Added slashes for mobile rules when activating plugin.\n* \ud83d\udc1e<strong>CCSS</strong>: Eliminated a PHP notice when appending CCSS.\n\n= 2.8.1 - Dec 5 2018 =\n* \ud83d\udc1e\ud83d\udd77\ufe0f: Fixed an activation warning related to cookie crawler. (@kacper3355 @rastel72)\n* \ud83d\udc1e<strong>Media</strong>: Replace safely by checking if pulled images is empty or not first. (@Monarobase)\n* <strong>3rd</strong>: Shortcode ESI compatibility with Elementor.\n\n= 2.8 - Nov 30 2018 =\n* \ud83c\udf31: ESI shortcodes.\n* \ud83c\udf31: Mobile crawler.\n* \ud83c\udf31: Cookie crawler.\n* <strong>API</strong>: Can now add `_litespeed_rm_qs=0` to bypass Remove Query Strings.\n* <strong>Optm</strong>: Removed error log when minify JS failed.\n* \ud83d\udc1e<strong>Core</strong>: Fixed a bug that caused network activation PHP warning.\n* <strong>Media</strong>: Removed canvas checking for WebP to support TOR. (@odeskumair)\n* <strong>Media</strong>: Eliminated potential image placeholder PHP warning.\n* <strong>3rd</strong>: Bypassed Google recaptcha from Remove Query Strings for better compatibility.\n* <strong>IAPI</strong>: Showed destroy timeout details.\n* <strong>Debug</strong>: Moved Google Fonts log to advanced level.\n* <strong>GUI</strong>: Replaced all Learn More links for functions.\n* <strong>GUI</strong>: Cosmetic updates including Emoji.\n* \ud83d\udd77\ufe0f: Removed duplicated data in sitemap and blacklist.\n\n= 2.7.3 - Nov 26 2018 =\n* <strong>Optm</strong>: Improved page render speed with Web Font Loader JS library for Load Google Fonts Asynchronously.\n* <strong>Optm</strong>: Directly used JS library files in plugin folder instead of short links `/min/`.\n* <strong>Optm</strong>: Handled exceptions in JS optimization when meeting badly formatted JS.\n* <strong>3rd</strong>: Added Adobe Lightroom support for NextGen Gallery.\n* <strong>3rd</strong>: Improved Postman app support for POST JSON requests.\n* <strong>IAPI</strong>: <strong>US3 server IP changed to 68.183.60.185</strong>.\n\n= 2.7.2 - Nov 19 2018 =\n* \ud83c\udf31: Auto Upgrade feature.\n* <strong>CDN</strong>: Bypass CDN for cron to avoid WP jQuery deregister warning.\n\n= 2.7.1 - Nov 15 2018 =\n* \ud83c\udf31<strong>CLI</strong>: Ability to set CDN mapping by `set_option litespeed-cache-cdn_mapping[url][0] https://url`.\n* \ud83c\udf31<strong>CDN</strong>: Ability to customize default CDN mapping data in default.ini.\n* \ud83c\udf31<strong>API</strong>: Default.ini now supports both text-area items and on/off options.\n* <strong>Vary</strong>: Refactored Vary and related API.\n* <strong>Vary</strong>: New hook to manipulate vary cookies value.\n* <strong>Core</strong>: Activation now can generate Object Cache file.\n* <strong>Core</strong>: Unified Object Cache/rewrite rules generation process across activation/import/reset/CLI.\n* <strong>Core</strong>: Always hook activation to make activation available through the front end.\n* \ud83d\udc1e<strong>IAPI</strong>: Fixed a bug where environment report gave incorrect image optimization data.\n* \ud83d\udc1e<strong>OLS</strong>: Fixed a bug where login cookie kept showing a warning on OpenLiteSpeed.\n* \ud83d\udc1e<strong>Core</strong>: Fixed a bug where Import/Activation/CLI was missing CDN mapping settings.\n* <strong>API</strong>: <strong>Filters `litespeed_cache_media_lazy_img_excludes/litespeed_optm_js_defer_exc` passed-in parameter is changed from string to array.</strong>\n\n= 2.7 - Nov 2 2018 =\n* \ud83c\udf31: Separate Purge log for better debugging.\n* <strong>3rd</strong>: Now fully compatible with WPML.\n* <strong>IAPI</strong>: Sped up Image Optimization workflow.\n* <strong>GUI</strong>: Current IP now shows in Debug settings.\n* <strong>GUI</strong>: Space separated placeholder queue list for better look.\n* <strong>IAPI</strong>: <strong>EU3 server IP changed to 165.227.131.98</strong>.\n\n= 2.6.4.1 - Oct 25 2018 =\n* \ud83d\udd25\ud83d\udc1e<strong>Media</strong>: Fixed a bug where the wrong table was used in the Image Optimization process.\n* <strong>IAPI</strong>: IAPI v2.6.4.1.\n\n= 2.6.4 - Oct 24 2018 =\n* \ud83c\udf31: Ability to create custom default config options per hosting company.\n* \ud83c\udf31: Ability to generate mobile Critical CSS.\n* \ud83d\udc1e<strong>Media</strong>: Fixed a bug where Network sites could incorrectly override optimized images.\n* \ud83d\udc1e<strong>CDN</strong>: Fixed a bug where image URLs containing backslashes were matched.\n* <strong>Cache</strong>: Added default Mobile UA config setting.\n* <strong>GUI</strong>: Fixed unknown shortcut characters for non-English languages Setting tabs.\n\n= 2.6.3 - Oct 18 2018 =\n* \ud83c\udf31: Ability to Reset All Options.\n* \ud83c\udf31<strong>CLI</strong>: Added new `lscache-admin reset_options` command.\n* <strong>GUI</strong>: Added shortcuts for more of the Settings tabs.\n* <strong>Media</strong>: Updated Lazy Load JS library to the most recent version.\n* There is no longer any need to explicitly Save Settings upon Import.\n* Remove Query String now will remove *all* query strings in JS/CSS static files.\n* <strong>IAPI</strong>: Added summary info to debug log.\n\n= 2.6.2 - Oct 11 2018 =\n* <strong>Setting</strong>: Automatically correct invalid numeric values in configuration settings upon submit.\n* \ud83d\udc1e<strong>Media</strong>: Fixed the issue where iframe lazy load was broken by latest Chrome release. (@ofmarconi)\n* \ud83d\udc1e: Fixed an issue with Multisite where subsites failed to purge when only primary site has WooCommerce . (@kierancalv)\n\n= 2.6.1 - Oct 4 2018 =\n* \ud83c\udf31: Ability to generate separate Critical CSS Cache for Post Types & URIs.\n* <strong>API</strong>: Filter `litespeed_frontend_htaccess` for frontend htaccess path.\n* <strong>Media</strong>: Removed responsive placeholder generation history to save space.\n\n= 2.6.0.1 - Sep 24 2018 =\n* \ud83d\udd25\ud83d\udc1e: Fixed an issue in responsive placeholder generation where redundant history data was being saved and using a lot of space.\n\n= 2.6 - Sep 22 2018 =\n* <strong>Vary</strong>: Moved `litespeed_cache_api_vary` hook outside of OLS condition for .htaccess generation.\n* <strong>CDN</strong>: Trim spaces in original URL of CDN setting.\n* <strong>API</strong>: New filter `litespeed_option_` to change all options dynamically.\n* <strong>API</strong>: New `LiteSpeed_Cache_API::force_option()` to change all options dynamically.\n* <strong>API</strong>: New `LiteSpeed_Cache_API::vary()` to set default vary directly for easier compaitiblity with WPML WooCommerce Multilingual.\n* <strong>API</strong>: New `LiteSpeed_Cache_API::nonce()` to safely and easily allow caching of wp-nonce.\n* <strong>API</strong>: New `LiteSpeed_Cache_API::hook_vary_add()` to add new vary.\n* <strong>Optm</strong>: Changed HTML/JS/CSS optimization options assignment position from constructor to `finalize()`.\n* <strong>Doc</strong>: Added nonce to FAQ and mentioned nonce in 3rd Party Compatibility section.\n* <strong>GUI</strong>: Moved inline minify to under html minify due to the dependency.\n* <strong>3rd</strong>: Cached Aelia CurrencySwitcher by default.\n* \ud83d\udc1e: Fixed issue where enabling remote JQuery caused missing jquery-migrate library error.\n\n= 2.5.1 - Sep 11 2018 =\n* \ud83c\udf31 Responsive placeholder. (@szmigieldesign)\n* Changed CSS::ccss_realpath function scope to private.\n* \ud83d\udc1e Detected JS filetype before optimizing to avoid PHP source conflict. (@closte #50)\n\n= 2.5 - Sep 6 2018 =\n* [IMPROVEMENT] <strong>CLI</strong> can now execute Remove Original Image Backups. (@Shon)\n* [UPDATE] Fixed issue where WP-PostViews documentation contained extra slashes. (#545638)\n* [UPDATE] Check LITESPEED_SERVER_TYPE for more accurate LSCache Disabled messaging.\n* [IAPI] Fixed a bug where optimize/fetch error notification was not being received. (@LucasRolff)\n\n= 2.4.4 - Aug 31 2018 =\n* [NEW] <strong>CLI</strong> can now support image optimization. (@Shon)\n* [IMPROVEMENT] <strong>GUI</strong> Cron/CLI will not create admin message anymore.\n* [UPDATE] <strong>Media</strong> Fixed a PHP notice that appeared when pulling optimized images.\n* [UPDATE] Fixed a PHP notice when detecting origin of ajax call. (@iosoft)\n* [DEBUG] Debug log can now log referer URL.\n* [DEBUG] Changes to options will now be logged.\n\n= 2.4.3 - Aug 27 2018 =\n* [NEW] <strong>Media</strong> Ability to inline image lazyload JS library. (@Music47ell)\n* [IMPROVEMENT] <strong>Media</strong> Deleting images will now clear related optimization file & info too.\n* [IMPROVEMENT] <strong>Media</strong> Non-image postfix data will now be bypassed before sending image optimization request.\n* [BUGFIX] <strong>CDN</strong> CDN URL will no longer be replaced during admin ajax call. (@pankaj)\n* [BUGFIX] <strong>CLI</strong> WPCLI can now save options without incorrectly clearing textarea items. (@Shon)\n* [GUI] Moved Settings above Manage on the main menu.\n\n= 2.4.2 - Aug 21 2018 =\n* [IMPROVEMENT] <strong>Media</strong> Sped up Image Optimization process by replacing IAPI server pull communication.\n* [IMPROVEMENT] <strong>Media</strong> Ability to delete optimized WebP/original image by item in Media Library. (@redgoodapple)\n* [IMPROVEMENT] <strong>CSS Optimize</strong> Generate new optimized CSS name based on purge timestamp. Allows CSS cache to be cleared for visitors. (@bradbrownmagic)\n* [IMPROVEMENT] <strong>API</strong> added litespeed_img_optm_options_per_image. (@gintsg)\n* [UPDATE] Stopped showing \"No Image Found\" message when all images have finished optimization. (@knutsp)\n* [UPDATE] Improved a PHP warning when saving settings. (@sergialarconrecio)\n* [UPDATE] Changed backend adminbar icon default behavior from Purge All to Purge LSCache.\n* [UPDATE] Clearing CCSS cache will clear unfinished queue too.\n* [UPDATE] Added \"$\" exact match when adding URL by frontend adminbar dropdown menu, to avoid affecting any sub-URLs.\n* [UPDATE] Fixed IAPI error message showing array bug. (@thiomas)\n* [UPDATE] Debug Disable All will do a Purge All.\n* [UPDATE] <strong>Critical CSS server IP changed to 142.93.3.57</strong>.\n* [GUI] Showed plugin update link for IAPI version message.\n* [GUI] Bypassed null IAPI response message.\n* [GUI] Grouped related settings with indent.\n* [IAPI] Added 503 handler for IAPI response.\n* [IAPI] IAPI v2.4.2.\n* [IAPI] <strong>Center Server IP Changed from 34.198.229.186 to 142.93.112.87</strong>.\n\n= 2.4.1 - Jul 19 2018 =\n* [NEW FEATURE] <strong>Media</strong> Auto Level Up. Auto refill credit.\n* [NEW FEATURE] <strong>Media</strong> Auto delete original backups after pulled. (@borisov87 @JMCA2)\n* [NEW FEATURE] <strong>Media</strong> Auto request image optimization. (@ericsondr)\n* [IMPROVEMENT] <strong>Media</strong> Fetch 404 error will notify client as other errors.\n* [IMPROVEMENT] <strong>Media</strong> Support WebP for PageSpeed Insights. (@LucasRolff)\n* [BUGFIX] <strong>CLI</strong> Fixed the issue where CLI import/export caused certain textarea settings to be lost. (#767519)\n* [BUGFIX] <strong>CSS Optimize</strong> Fixed the issue that duplicated optimized CSS and caused rapid expansion of CSS cache folder.\n* [GUI] <strong>Media</strong> Refactored operation workflow and interface.\n* [UPDATE] <strong>Media</strong> Set timeout seconds to avoid pulling timeout. (@Jose)\n* [UPDATE] <strong>CDN</strong>Fixed the notice when no path is in URL. (@sabitkamera)\n* [UPDATE] <strong>Media</strong> Auto correct credits when pulling.\n* [UPDATE] <strong>GUI</strong> Removed redundant double quote in gui.cls. (@DaveyJake)\n* [IAPI] IAPI v2.4.1.\n* [IAPI] Allow new error status notification and success message from IAPI.\n\n= 2.4 - Jul 2 2018 =\n* [NEW FEATURE] <strong>Media</strong> Added lossless optimization.\n* [NEW FEATURE] <strong>Media</strong> Added Request Orignal Images ON/OFF.\n* [NEW FEATURE] <strong>Media</strong> Added Request WebP ON/OFF. (@JMCA2)\n* [IMPROVEMENT] <strong>Media</strong> Improved optimization tools to archive maximum compression and score.\n* [IMPROVEMENT] <strong>Media</strong> Improved speed of image pull.\n* [IMPROVEMENT] <strong>Media</strong> Automatically recover credit after pulled.\n* [REFACTOR] <strong>Config</strong> Separated configure const class.\n* [BUGFIX] <strong>Report</strong> Report can be sent successfully with emoji now. (@music47ell)\n* [IAPI] New Europe Image Optimization server (EU3/EU4).\n* [IAPI] New America Image Optimization server (US3/US4/US5/US6).\n* [IAPI] New Asian Image Optimization server (AS3).\n* [IAPI] Refactored optimization process.\n* [IAPI] Increased credit limit.\n* [IAPI] Removed request interval limit.\n* [IAPI] IAPI v2.4.\n* <strong>We strongly recommended that you re-optimize your image library to get a better compression result</strong>.\n\n= 2.3.1 - Jun 18 2018 =\n* [IMPROVEMENT] New setting to disable Generate Critical CSS. (@cybmeta)\n* [IMPROVEMENT] Added filter to can_cdn/can_optm check. (@Jacob)\n* [UPDATE] *Critical CSS* Added 404 css. Limit cron interval.\n* [UPDATE] AJAX will not bypass CDN anymore by default. (@Jacob)\n* [GUI] Show Disable All Features warning if it is on in Debug tab.\n\n= 2.3 - Jun 13 2018 =\n* [NEW FEATURE] Automatically generate critical CSS. (@joeee @ivan_ivanov @3dseo)\n* [BUGFIX] \"Mark this page as...\" from dropdown menu will not reset settings anymore. (@cbratschi)\n\n= 2.2.7 - Jun 4 2018 =\n* [IMPROVEMENT] Improved redirection for manual image pull to avoid too many redirections warning.\n* [IAPI] Increased credit limit.\n* [BUGFIX] Fixed 503 error when enabling log filters in Debug tab. (#525206)\n* [UPDATE] Improve compatibility when using sitemap url on servers with allow_url_open off.\n* [UPDATE] Removed Crawler HTTP2 option due to causing no-cache blacklist issue for certain environments.\n* [UPDATE] Privacy policy can be now translated. (@Josemi)\n* [UPDATE] IAPI Increased default img request max to 3000.\n\n= 2.2.6 - May 24 2018 =\n* [NEW FEATURE] Original image backups can be removed now. (@borisov87 @JMCA2)\n* [BUGFIX] Role Excludes in Tuning tab can save now. (@pako69)\n* [UPDATE] Added privacy policy support.\n\n= 2.2.5 - May 14 2018 =\n* [IAPI] <strong>Image Optimization</strong> New Asian Image Optimization server (AS2).\n* [INTEGRATION] Removed wpForo 3rd party file. (@massimod)\n\n= 2.2.4 - May 7 2018 =\n* [IMPROVEMENT] Improved compatibility with themes using the same js_min library. (#129093 @Darren)\n* [BUGFIX] Fixed a bug when checking image path for dynamic files. (@miladk)\n* [INTEGRATION] Compatibility with Universal Star Rating. (@miladk)\n\n= 2.2.3 - Apr 27 2018 =\n* [NEW FEATURE] WebP For Extra srcset setting in Media tab. (@vengen)\n* [REFACTOR] Removed redundant LS consts.\n* [REFACTOR] Refactored adv_cache generation flow.\n* [BUGFIX] Fixed issue where inline JS minify exception caused a blank page. (@oomskaap @kenb1978)\n* [UPDATE] Changed HTTP/2 Crawl default value to OFF.\n* [UPDATE] Added img.data-src to default WebP replacement value for WooCommerce WebP support.\n* [UPDATE] Detached crawler from LSCache LITESPEED_ON status.\n* [API] Improved ESI API to honor the cache control in ESI wrapper.\n* [API] Added LITESPEED_PURGE_SILENT const to bypass the notification when purging\n* [INTEGRATION] Fixed issue with nonce expiration when using ESI API. (#923505 @Dan)\n* [INTEGRATION] Improved compatibility with Ninja Forms by bypassing non-javascript JS from inline JS minify.\n* [INTEGRATION] Added a hook for plugins that change the CSS/JS path e.g. Hide My WordPress.\n\n= 2.2.2 - Apr 16 2018 =\n* [NEW FEATURE] WebP Attribute To Replace setting in Media tab. (@vengen)\n* [IMPROVEMENT] Generate adv_cache file automatically when it is lost.\n* [IMPROVEMENT] Improved compatibility with ajax login. (@veganostomy)\n* [UPDATE] Added object cache lib check in case user downgrades LSCWP to non-object-cache versions.\n* [UPDATE] Avoided infinite loop when users enter invalid hook values in Purge All Hooks settings.\n* [UPDATE] Updated log format in media&cdn class.\n* [UPDATE] Added more items to Report.\n\n= 2.2.1 - Apr 10 2018 =\n* [NEW FEATURE] Included Directories setting in CDN tab. (@Dave)\n* [NEW FEATURE] Purge All Hooks setting in Advanced tab.\n* [UPDATE] Added background-image WebP replacement support. (@vengen)\n* [UPDATE] Show recommended values for textarea items in settings.\n* [UPDATE] Moved CSS/JS optimizer log to Advanced level.\n* [INTEGRATION] Added WebP support for Avada Fusion Sliders. (@vengen)\n\n= 2.2.0.2 - Apr 3 2018 =\n* [HOTFIX] <strong>Object Cache</strong> Fixed the PHP warning caused by previous improvement to Object Cache.\n\n= 2.2.0.1 - Apr 3 2018 =\n* [HOTFIX] Object parameter will no longer cause warnings to be logged for Purge and Cache classes. (@kelltech @khrifat)\n* [UPDATE] Removed duplicated del_file func from Object Cache class.\n* [BUGFIX] `CLI` no longer shows 400 error upon successful result.\n\n= 2.2 - Apr 2 2018 =\n* [NEW FEATURE] <strong>Debug</strong> Disable All Features setting in Debug tab. (@monarobase)\n* [NEW FEATURE] <strong>Cache</strong> Force Cacheable URIs setting in Excludes tab.\n* [NEW FEATURE] <strong>Purge</strong> Purge all LSCache and other caches in one link.\n* [REFACTOR] <strong>Purge</strong> Refactored Purge class.\n* [BUGFIX] Query strings in DoNotCacheURI setting now works.\n* [BUGFIX] <strong>Cache</strong> Mobile cache compatibility with WebP vary. (@Shivam #987121)\n* [UPDATE] <strong>Purge</strong> Moved purge_all to Purge class from core class.\n* [API] Set cacheable/Set force cacheable. (@Jacob)\n\n= 2.1.2 - Mar 28 2018 =\n* [NEW FEATURE] <strong>Image Optimization</strong> Clean Up Unfinished Data feature.\n* [IAPI] IAPI v2.1.2.\n* [IMPROVEMENT] <strong>CSS/JS Minify</strong> Reduced loading time significantly by improving CSS/JS minify loading process. (@kokers)\n* [IMPROVEMENT] <strong>CSS/JS Minify</strong> Cache empty JS Minify content. (@kokers)\n* [IMPROVEMENT] <strong>Cache</strong> Cache 301 redirect when scheme/host are same.\n* [BUGFIX] <strong>Media</strong> Lazy load now can support WebP. (@relle)\n* [UPDATE] <strong>CSS/JS Optimize</strong> Serve static files for CSS async & lazy load JS library.\n* [UPDATE] <strong>Report</strong> Appended Basic/Advanced View setting to Report.\n* [UPDATE] <strong>CSS/JS Minify</strong> Removed zero-width space from CSS/JS content.\n* [GUI] Added Purge CSS/JS Cache link in Admin.\n\n= 2.1.1.1 - Mar 21 2018 =\n* [BUGFIX] Fixed issue where activation failed to add rules to .htaccess.\n* [BUGFIX] Fixed issue where 304 header was blank on feed page refresh.\n\n= 2.1.1 - Mar 20 2018 =\n* [NEW FEATURE] <strong>Browser Cache</strong> Unlocked for non-LiteSpeed users.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Fixed issue where images with bad postmeta value continued to show in not-yet-requested queue.\n\n= 2.1 - Mar 15 2018 =\n* [NEW FEATURE] <strong>Image Optimization</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>Object Cache</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>Crawler</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>Database Cleaner and Optimizer</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>Lazy Load Images</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>CSS/JS/HTML Minify/Combine Optimize</strong> Unlocked for non-LiteSpeed users.\n* [IAPI] IAPI v2.0.\n* [IAPI] Increased max rows prefetch when client has additional credit.\n* [IMPROVEMENT] <strong>CDN</strong> Multiple domains may now be used.\n* [IMPROVEMENT] <strong>Report</strong> Added WP environment constants for better debugging.\n* [REFACTOR] Separated Cloudflare CDN class.\n* [BUGFIX] <strong>Image Optimization</strong> Fixed issue where certain MySQL version failed to create img_optm table. (@philippwidmer)\n* [BUGFIX] <strong>Image Optimization</strong> Fixed issue where callback validation failed when pulling and sending request simultaneously.\n* [GUI] Added Slack community banner.\n* [INTEGRATION] CDN compatibility with WPML multiple domains. (@egemensarica)\n\n= 2.0 - Mar 7 2018 =\n* [NEW FEATURE] <strong>Image Optimization</strong> Added level up guidance.\n* [REFACTOR] <strong>Image Optimization</strong> Refactored Image Optimization class.\n* [IAPI] <strong>Image Optimization</strong> New European Image Optimization server (EU2).\n* [IMPROVEMENT] <strong>Image Optimization</strong> Manual pull action continues pulling until complete.\n* [IMPROVEMENT] <strong>CDN</strong> Multiple CDNs can now be randomized for a single resource.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Improved compatibility of long src images.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Reduced runtime load.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Avoid potential loss/reset of notified images status when pulling.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Avoid duplicated optimization for multiple records in Media that have the same image source.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Fixed issue where phantom images continued to show in not-yet-requested queue.\n* [BUGFIX] <strong>Core</strong> Improved compatibility when upgrading outside of WP Admin. (@jikatal @TylorB)\n* [BUGFIX] <strong>Crawler</strong> Improved HTTP/2 compatibility to avoid erroneous blacklisting.\n* [BUGFIX] <strong>Crawler</strong> Changing Delay setting will use server variable for min value validation if set.\n* [UPDATE] <strong>Crawler</strong> Added HTTP/2 protocol switch in the Crawler settings.\n* [UPDATE] Removed unnecessary translation strings.\n* [GUI] Display translated role group name string instead of English values. (@Richard Hordern)\n* [GUI] Added Join LiteSpeed Slack link.\n* [GUI] <strong>Import / Export</strong> Cosmetic changes to Import Settings file field.\n* [INTEGRATION] Improved compatibility with WPML Media for Image Optimization. (@szmigieldesign)\n\n= 1.9.1.1 - February 20 2018 =\n* [Hotfix] Removed empty crawler when no role simulation is set.\n\n= 1.9.1 - February 20 2018 =\n* [NEW FEATURE] Role Simulation crawler.\n* [NEW FEATURE] WebP multiple crawler.\n* [NEW FEATURE] HTTP/2 support for crawler.\n* [BUGFIX] Fixed a js bug with the auto complete mobile user agents field when cache mobile is turned on.\n* [BUGFIX] Fixed a constant undefined warning after activation.\n* [GUI] Sitemap generation settings are no longer hidden when using a custom sitemap.\n\n= 1.9 - February 12 2018 =\n* [NEW FEATURE] Inline CSS/JS Minify.\n* [IMPROVEMENT] Removed Composer vendor to thin the plugin folder.\n* [UPDATE] Tweaked H2 to H1 in Admin headings for accessibility. (@steverep)\n* [GUI] Added Mobile User Agents to basic view.\n* [GUI] Moved Object Cache & Browser Cache from Cache tab to Advanced tab.\n* [GUI] Moved LSCache Purge All from Adminbar to dropdown menu.\n\n= 1.8.3 - February 2 2018 =\n* [NEW FEATURE] Crawler server variable limitation support.\n* [IMPROVEMENT] Added Store Transients option to fix transients missing issue when Cache Wp-Admin setting is OFF.\n* [IMPROVEMENT] Tweaked ARIA support. (@steverep)\n* [IMPROVEMENT] Used strpos instead of strncmp for performance. (@Zach E)\n* [BUGFIX] Transient cache can now be removed when the Cache Wp-Admin setting is ON in Object Cache.\n* [BUGFIX] Network sites can now save Advanced settings.\n* [BUGFIX] Media list now shows in network sites.\n* [BUGFIX] Show Crawler Status button is working again.\n* [UPDATE] Fixed a couple of potential PHP notices in the Network cache tab and when no vary group is set.\n* [GUI] Added Learn More link to all setting pages.\n\n= 1.8.2 - January 29 2018 =\n* [NEW FEATURE] Instant Click in the Advanced tab.\n* [NEW FEATURE] Import/Export settings.\n* [NEW FEATURE] Opcode Cache support.\n* [NEW FEATURE] Basic/Advanced setting view.\n* [IMPROVEMENT] Added ARIA support in widget settings.\n* [BUGFIX] Multiple WordPress instances with same Object Cache address will no longer see shared data.\n* [BUGFIX] WebP Replacement may now be set at the Network level.\n* [BUGFIX] Object Cache file can now be removed at the Network level uninstall.\n\n= 1.8.1 - January 22 2018 =\n* [NEW FEATURE] Object Cache now supports Redis.\n* [IMPROVEMENT] Memcached Object Cache now supports authorization.\n* [IMPROVEMENT] A 500 error will no longer be encountered when turning on Object Cache without the proper PHP extension installed.\n* [BUGFIX] Object Cache settings can now be saved at the Network level.\n* [BUGFIX] Mu-plugin now supports Network setting.\n* [BUGFIX] Fixed admin bar showing inaccurate Edit Page link.\n* [UPDATE] Removed warning information when no Memcached server is available.\n\n= 1.8 - January 17 2018 =\n* [NEW FEATURE] Object Cache.\n* [REFACTOR] Refactored Log class.\n* [REFACTOR] Refactored LSCWP basic const initialization.\n* [BUGFIX] Fixed Cloudflare domain search breaking when saving more than 50 domains under a single account.\n* [UPDATE] Log filter settings are now their own item in the wp-option table.\n\n= 1.7.2 - January 5 2018 =\n* [NEW FEATURE] Cloudflare API support.\n* [IMPROVEMENT] IAPI key can now be reset to avoid issues when domain is changed.\n* [BUGFIX] Fixed JS optimizer breaking certain plugins JS.\n* [UPDATE] Added cdn settings to environment report.\n* [GUI] Added more shortcuts to backend adminbar.\n* [INTEGRATION] WooCommerce visitors are now served from public cache when cart is empty.\n\n= 1.7.1.1 - December 29 2017 =\n* [BUGFIX] Fixed an extra trailing underscore issue when saving multiple lines with DNS Prefetch.\n* [UPDATE] Cleaned up unused dependency vendor files.\n\n= 1.7.1 - December 28 2017 =\n* [NEW FEATURE] Added DNS Prefetch setting on the Optimize page.\n* [NEW FEATURE] Added Combined File Max Size setting on the Tuning page.\n* [IMPROVEMENT] Improved JS/CSS minify to achieve higher page scores.\n* [IMPROVEMENT] Optimized JS/CSS files will not be served from private cache for OLS or with ESI off.\n* [UPDATE] Fixed a potential warning for new installations on the Settings page.\n* [UPDATE] Fixed an issue with guest users occasionally receiving PHP warnings.\n* [BUGFIX] Fixed a bug with the Improve HTTPS Compatibility setting failing to save.\n* Thanks to all of our users for your encouragement and support! Happy New Year!\n* PS: Lookout 2018, we're back!\n\n= 1.7 - December 22 2017 =\n* [NEW FEATURE] Drop Query Strings setting in the Cache tab.\n* [NEW FEATURE] Multiple CDN Mapping in the CDN tab.\n* [IMPROVEMENT] Improve HTTP/HTTPS Compatibility setting in the Advanced tab.\n* [IMPROVEMENT] Keep JS/CSS original position in HTML when excluded in setting.\n* [IAPI] Reset client level credit after Image Optimization data is destroyed.\n* [REFACTOR] Refactored build_input/textarea functions in admin_display class.\n* [REFACTOR] Refactored CDN class.\n* [GUI] Added a notice to Image Optimization and Crawler to warn when cache is disabled.\n* [GUI] Improved image optimization indicator styles in Media Library List.\n\n= 1.6.7 - December 15 2017 =\n* [IAPI] Added ability to scan for new image thumbnail sizes and auto-resend image optimization requests.\n* [IAPI] Added ability to destroy all optimization data.\n* [IAPI] Updated IAPI to v1.6.7.\n* [INTEGRATION] Fixed certain 3rd party plugins calling REST without user nonce causing logged in users to be served as guest.\n\n= 1.6.6.1 - December 8 2017 =\n* [IAPI] Limit first-time submission to one image group for test-run purposes.\n* [BUGFIX] Fixed vary group generation issue associated with custom user role plugins.\n* [BUGFIX] Fixed WooCommerce issue where logged-in users were erroneously purged when ESI is off.\n* [BUGFIX] Fixed WooCommerce cache miss issue when ESI is off.\n\n= 1.6.6 - December 6 2017 =\n* [NEW FEATURE] Preserve EXIF in Media setting.\n* [NEW FEATURE] Clear log button in Debug Log Viewer.\n* [IAPI] Fixed notified images resetting to previous status when pulling.\n* [IAPI] Fixed HTTPS compatibility for image optimization initialization.\n* [IAPI] An error message is now displayed when image optimization request submission is bypassed due to a lack of credit.\n* [IAPI] IAPI v1.6.6.\n* [IMPROVEMENT] Support JS data-no-optimize attribute to bypass optimization.\n* [GUI] Added image group wiki link.\n* [INTEGRATION] Improved compatibility with Login With Ajax.\n* [INTEGRATION] Added function_exists check for WooCommerce to avoid 500 errors.\n\n= 1.6.5.1 - December 1 2017 =\n* [HOTFIX] Fixed warning message on Edit .htaccess page.\n\n= 1.6.5 - November 30 2017 =\n* [IAPI] Manually pull image optimization action button.\n* [IAPI] Automatic credit system for image optimization to bypass unfinished image optimization error.\n* [IAPI] Notify failed images from LiteSpeed's Image Server.\n* [IAPI] Reset/Clear failed images feature.\n* [IAPI] Redesigned report page.\n* [REFACTOR] Moved pull_img logic from admin_api to media.\n* [BUGFIX] Fixed a compatibility issue for clients who have allow_url_open setting off.\n* [BUGFIX] Fixed logged in users sometimes being served from guest cache.\n* [UPDATE] Environment report is no longer saved to a file.\n* [UPDATE] Removed crawler reset notification.\n* [GUI] Added more details on image optimization.\n* [GUI] Removed info page from admin menu.\n* [GUI] Moved environment report from network level to single site level.\n* [GUI] Crawler time added in a user friendly format.\n* [INTEGRATION] Improved compatibility with FacetWP json call.\n\n= 1.6.4 - November 22 2017 =\n* [NEW FEATURE] Send env reports privately with a new built-in report number referral system.\n* [IAPI] Increased request timeout to fix a cUrl 28 timeout issue.\n* [BUGFIX] Fixed a TTL max value validation bug.\n* [INTEGRATION] Improved Contact Form 7 REST call compatibility for logged in users.\n* Thanks for all your ratings. That encouraged us to be more diligent. Happy Thanksgiving.\n\n= 1.6.3 - November 17 2017 =\n* [NEW FEATURE] Only async Google Fonts setting.\n* [NEW FEATURE] Only create WebP images when optimizing setting.\n* [NEW FEATURE] Batch switch images to original/optimized versions in Image Optimization.\n* [NEW FEATURE] Browser Cache TTL setting.\n* [NEW FEATURE] Cache WooCommerce Cart setting.\n* [IMPROVEMENT] Moved optimized JS/CSS snippet in header html to after meta charset.\n* [IMPROVEMENT] Added a constant for better JS/CSS optimization compatibility for different dir WordPress installation.\n* [IAPI] Take over failed callback check instead of bypassing it.\n* [IAPI] Image optimization requests are now limited to 500 images per request.\n* [BUGFIX] Fixed a parsing failure bug not using attributes in html elements with dash.\n* [BUGFIX] Fixed a bug causing non-script code to move to the top of a page when not using combination.\n* [UPDATE] Added detailed logs for external link detection.\n* [UPDATE] Added new lines in footer comment to avoid Firefox crash when enabled HTML minify.\n* [API] `Purge private` / `Purge private all` / `Add private tag` functions.\n* [GUI] Redesigned image optimization operation links in Media Lib list.\n* [GUI] Tweaked wp-admin form save button position.\n* [GUI] Added \"learn more\" link for image optimization.\n\n= 1.6.2.1 - November 6 2017 =\n* [INTEGRATION] Improved compatibility with old WooCommerce versions to avoid unknown 500 errors.\n* [BUGFIX] Fixed WebP images sometimes being used in non-supported browsers.\n* [BUGFIX] Kept query strings for HTTP/2 push to avoid re-fetching pushed sources.\n* [BUGFIX] Excluded JS/CSS from HTTP/2 push when using CDN.\n* [GUI] Fixed a typo in Media list.\n* [GUI] Made more image optimization strings translatable.\n* [GUI] Updated Tuning description to include API documentation.\n\n= 1.6.2 - November 3 2017 =\n* [NEW FEATURE] Do Not Cache Roles.\n* [NEW FEATURE] Use WebP Images for supported browsers.\n* [NEW FEATURE] Disable Optimization Poll ON/OFF Switch in Media tab.\n* [NEW FEATURE] Revert image optimization per image in Media list.\n* [NEW FEATURE] Disable/Enable image WebP per image in Media list.\n* [IAPI] Limit optimized images fetching cron to a single process.\n* [IAPI] Updated IAPI to v1.6.2.\n* [IAPI] Fixed repeating image request issue by adding a failure status to local images.\n* [REFACTOR] Refactored login vary logic.\n\n= 1.6.1 - October 29 2017 =\n* [IAPI] Updated LiteSpeed Image Optimization Server API to v1.6.1.\n\n= 1.6 - October 27 2017 =\n* [NEW FEATURE] Image Optimization.\n* [NEW FEATURE] Role Excludes for Optimization.\n* [NEW FEATURE] Combined CSS/JS Priority.\n* [IMPROVEMENT] Bypass CDN for login/register page.\n* [UPDATE] Expanded ExpiresByType rules to include new font types. ( Thanks to JMCA2 )\n* [UPDATE] Removed duplicated type param in admin action link.\n* [BUGFIX] Fixed CDN wrongly replacing img base64 and \"fake\" src in JS.\n* [BUGFIX] Fixed image lazy load replacing base64 src.\n* [BUGFIX] Fixed a typo in Optimize class exception.\n* [GUI] New Tuning tab in admin settings panel.\n* [REFACTOR] Simplified router by reducing actions and adding types.\n* [REFACTOR] Renamed `run()` to `finalize()` in buffer process.\n\n= 1.5 - October 17 2017 =\n* [NEW FEATURE] Exclude JQuery (to fix inline JS error when using JS Combine).\n* [NEW FEATURE] Load JQuery Remotely.\n* [NEW FEATURE] JS Deferred Excludes.\n* [NEW FEATURE] Lazy Load Images Excludes.\n* [NEW FEATURE] Lazy Load Image Placeholder.\n* [IMPROVEMENT] Improved Lazy Load size attribute for w3c validator.\n* [UPDATE] Added basic caching info and LSCWP version to HTML comment.\n* [UPDATE] Added debug log to HTML detection.\n* [BUGFIX] Fixed potential font CORS issue when using CDN.\n* [GUI] Added API docs to setting description.\n* [REFACTOR] Relocated all classes under includes with backwards compatibility.\n* [REFACTOR] Relocated admin templates.\n\n= 1.4 - October 11 2017 =\n* [NEW FEATURE] Lazy load images/iframes.\n* [NEW FEATURE] Clean CSS/JS optimizer data functionality in DB Optimizer panel.\n* [NEW FEATURE] Exclude certain URIs from optimizer.\n* [IMPROVEMENT] Improved optimizer HTML check compatibility to avoid conflicts with ESI functions.\n* [IMPROVEMENT] Added support for using ^ when matching the start of a path in matching settings.\n* [IMPROVEMENT] Added wildcard support in CDN original URL.\n* [IMPROVEMENT] Moved optimizer table initialization to admin setting panel with failure warning.\n* [UPDATE] Added a one-time welcome banner.\n* [UPDATE] Partly relocated class: 'api'.\n* [API] Added API wrapper for removing wrapped HTML output.\n* [INTEGRATION] Fixed WooCommerce conflict with optimizer.\n* [INTEGRATION] Private cache support for WooCommerce v3.2.0+.\n* [GUI] Added No Optimization menu to frontend.\n\n= 1.3.1.1 - October 6 2017 =\n* [BUGFIX] Improved optimizer table creating process in certain database charset to avoid css/js minify/combination failure.\n\n= 1.3.1 - October 5 2017 =\n* [NEW FEATURE] Remove WP Emoji Option.\n* [IMPROVEMENT] Separated optimizer data from wp_options to improve compatibility with backup plugins.\n* [IMPROVEMENT] Enhanced crawler cron hook to prevent de-scheduling in some cases.\n* [IMPROVEMENT] Enhanced Remove Query Strings to also remove Emoji query strings.\n* [IMPROVEMENT] Enhanced HTML detection when extra spaces are present at the beginning.\n* [UPDATE] Added private cache support for OLS.\n* [BUGFIX] Self-redirects are no longer cached.\n* [BUGFIX] Fixed css async lib warning when loading in HTTP/2 push.\n\n= 1.3 - October 1 2017 =\n* [NEW FEATURE] Added Browser Cache support.\n* [NEW FEATURE] Added Remove Query Strings support.\n* [NEW FEATURE] Added Remove Google Fonts support.\n* [NEW FEATURE] Added Load CSS Asynchronously support.\n* [NEW FEATURE] Added Load JS Deferred support.\n* [NEW FEATURE] Added Critical CSS Rules support.\n* [NEW FEATURE] Added Private Cached URIs support.\n* [NEW FEATURE] Added Do Not Cache Query Strings support.\n* [NEW FEATURE] Added frontend adminbar shortcuts ( Purge this page/Do Not Cache/Private cache ).\n* [IMPROVEMENT] Do Not Cache URIs now supports full URLs.\n* [IMPROVEMENT] Improved performance of Do Not Cache settings.\n* [IMPROVEMENT] Encrypted vary cookie.\n* [IMPROVEMENT] Enhanced HTML optimizer.\n* [IMPROVEMENT] Limited combined file size to avoid heavy memory usage.\n* [IMPROVEMENT] CDN supports custom upload folder for media files.\n* [API] Added purge single post API.\n* [API] Added version compare API.\n* [API] Enhanced ESI API for third party plugins.\n* [INTEGRATION] Compatibility with NextGEN Gallery v2.2.14.\n* [INTEGRATION] Compatibility with Caldera Forms v1.5.6.2+.\n* [BUGFIX] Fixed CDN&Minify compatibility with css url links.\n* [BUGFIX] Fixed .htaccess being regenerated despite there being no changes.\n* [BUGFIX] Fixed CDN path bug for subfolder WP instance.\n* [BUGFIX] Fixed crawler path bug for subfolder WP instance with different site url and home url.\n* [BUGFIX] Fixed a potential Optimizer generating redundant duplicated JS in HTML bug.\n* [GUI] Added a more easily accessed submit button in admin settings.\n* [GUI] Admin settings page cosmetic changes.\n* [GUI] Reorganized GUI css/img folder structure.\n* [REFACTOR] Refactored configuration init.\n* [REFACTOR] Refactored admin setting save.\n* [REFACTOR] Refactored .htaccess operator and rewrite rule generation.\n\n= 1.2.3.1 - September 20 2017 =\n* [UPDATE] Improved PHP5.3 compatibility.\n\n= 1.2.3 - September 20 2017 =\n* [NEW FEATURE] Added CDN support.\n* [IMPROVEMENT] Improved compatibility when upgrading by fixing a possible fatal error.\n* [IMPROVEMENT] Added support for custom wp-content paths.\n* [BUGFIX] Fixed non-primary network blogs not being able to minify.\n* [BUGFIX] Fixed HTML Minify preventing Facebook from being able to parse og tags.\n* [BUGFIX] Preview page is no longer cacheable.\n* [BUGFIX] Corrected log and crawler timezone to match set WP timezone.\n* [GUI] Revamp of plugin GUI.\n\n= 1.2.2 - September 15 2017 =\n* [NEW FEATURE] Added CSS/JS minification.\n* [NEW FEATURE] Added CSS/JS combining.\n* [NEW FEATURE] Added CSS/JS HTTP/2 server push.\n* [NEW FEATURE] Added HTML minification.\n* [NEW FEATURE] Added CSS/JS cache purge button in management.\n* [UPDATE] Improved debug log formatting.\n* [UPDATE] Fixed some description typos.\n\n= 1.2.1 - September 7 2017 =\n* [NEW FEATURE] Added Database Optimizer.\n* [NEW FEATURE] Added Tab switch shortcut.\n* [IMPROVEMENT] Added cache disabled check for management pages.\n* [IMPROVEMENT] Renamed .htaccess backup for security.\n* [BUGFIX] Fixed woocommerce default ESI setting bug.\n* [REFACTOR] Show ESI page for OLS with notice.\n* [REFACTOR] Management Purge GUI updated.\n\n= 1.2.0.1 - September 1 2017 =\n* [BUGFIX] Fixed a naming bug for network constant ON2.\n\n= 1.2.0 - September 1 2017 =\n* [NEW FEATURE] Added ESI support.\n* [NEW FEATURE] Added a private cache TTL setting.\n* [NEW FEATURE] Debug level can now be set to either 'Basic' or 'Advanced'.\n* [REFACTOR] Renamed const 'NOTSET' to 'ON2' in class config.\n\n= 1.1.6 - August 23 2017 =\n* [NEW FEATURE] Added option to privately cache logged-in users.\n* [NEW FEATURE] Added option to privately cache commenters.\n* [NEW FEATURE] Added option to cache requests made through WordPress REST API.\n* [BUGFIX] Fixed network 3rd-party full-page cache detection bug.\n* [GUI] New Cache and Purge menus in Settings.\n\n= 1.1.5.1 - August 16 2017 =\n* [IMPROVEMENT] Improved compatibility of frontend&backend .htaccess path detection when site url is different than installation path.\n* [UPDATE] Removed unused format string from header tags.\n* [BUGFIX] 'showheader' Admin Query String now works.\n* [REFACTOR] Cache tags will no longer output if not needed.\n\n= 1.1.5 - August 10 2017 =\n* [NEW FEATURE] Scheduled Purge URLs feature.\n* [NEW FEATURE] Added buffer callback to improve compatibility with some plugins that force buffer cleaning.\n* [NEW FEATURE] Hide purge_all admin bar quick link if cache is disabled.\n* [NEW FEATURE] Required htaccess rules are now displayed when .htaccess is not writable.\n* [NEW FEATURE] Debug log features: filter log support; heartbeat control; log file size limit; log viewer.\n* [IMPROVEMENT] Separate crawler access log.\n* [IMPROVEMENT] Lazy PURGE requests made after output are now queued and working.\n* [IMPROVEMENT] Improved readme.txt with keywords relating to our compatible plugins list.\n* [UPDATE] 'ExpiresDefault' conflict msg is now closeable and only appears in the .htaccess edit screen.\n* [UPDATE] Improved debug log formatting.\n* [INTEGRATION] Compatibility with MainWP plugin.\n* [BUGFIX] Fixed Woocommerce order not purging product stock quantity.\n* [BUGFIX] Fixed Woocommerce scheduled sale price not updating issue.\n* [REFACTOR] Combined cache_enable functions into a single function.\n\n= 1.1.4 - August 1 2017 =\n* [IMPROVEMENT] Unexpected rewrite rules will now show an error message.\n* [IMPROVEMENT] Added Cache Tag Prefix setting info in the Env Report and Info page.\n* [IMPROVEMENT] LSCWP setting link is now displayed in the plugin list.\n* [IMPROVEMENT] Improved performance when setting cache control.\n* [UPDATE] Added backward compatibility for v1.1.2.2 API calls. (used by 3rd-party plugins)\n* [BUGFIX] Fixed WPCLI purge tag/category never succeeding.\n\n= 1.1.3 - July 31 2017 =\n* [NEW FEATURE] New LiteSpeed_Cache_API class and documentation for 3rd party integration.\n* [NEW FEATURE] New API function litespeed_purge_single_post($post_id).\n* [NEW FEATURE] PHP CLI support for crawler.\n* [IMPROVEMENT] Set 'no cache' for same location 301 redirects.\n* [IMPROVEMENT] Improved LiteSpeed footer comment compatibility.\n* [UPDATE] Removed 'cache tag prefix' setting.\n* [BUGFIX] Fixed a bug involving CLI purge all.\n* [BUGFIX] Crawler now honors X-LiteSpeed-Cache-Control for the 'no-cache' header.\n* [BUGFIX] Cache/rewrite rules are now cleared when the plugin is uninstalled.\n* [BUGFIX] Prevent incorrect removal of the advanced-cache.php on deactivation if it was added by another plugin.\n* [BUGFIX] Fixed subfolder WP installations being unable to Purge By URL using a full URL path.\n* [REFACTOR] Reorganized existing code for an upcoming ESI release.\n\n= 1.1.2.2 - July 13 2017 =\n* [BUGFIX] Fixed blank page in Hebrew language post editor by removing unused font-awesome and jquery-ui css libraries.\n\n= 1.1.2.1 - July 5 2017 =\n* [UPDATE] Improved compatibility with WooCommerce v3.1.0.\n\n= 1.1.2 - June 20 2017 =\n* [BUGFIX] Fixed missing form close tag.\n* [UPDATE] Added a wiki link for enabling the crawler.\n* [UPDATE] Improved Site IP description.\n* [UPDATE] Added an introduction to the crawler on the Information page.\n* [REFACTOR] Added more detailed error messages for Site IP and Custom Sitemap settings.\n\n= 1.1.1.1 - June 15 2017 =\n* [BUGFIX] Hotfix for insufficient validation of site IP value in crawler settings.\n\n= 1.1.1 - June 15 2017 =\n* [NEW] As of LiteSpeed Web Server v.5.1.16, the crawler can now be enabled/disabled at the server level.\n* [NEW] Added the ability to provide a custom sitemap for crawling.\n* [NEW] Added ability to use site IP address directly in crawler settings.\n* [NEW] Crawler performance improved with the use of new custom user agent 'lsrunner'.\n* [NEW] \"Purge By URLs\" now supports full URL paths.\n* [NEW] Added thirdparty WP-PostRatings compatibility.\n* [BUGFIX] Cache is now cleared when changing post status from published to draft.\n* [BUGFIX] WHM activation message no longer continues to reappear after being dismissed.\n* [COSMETIC] Display recommended values for settings.\n\n= 1.1.0.1 - June 8 2017 =\n* [UPDATE] Improved default crawler interval setting.\n* [UPDATE] Tested up to WP 4.8.\n* [BUGFIX] Fixed compatibility with plugins that output json data.\n* [BUGFIX] Fixed tab switching bug.\n* [BUGFIX] Removed occasional duplicated messages on save.\n* [COSMETIC] Improved crawler tooltips and descriptions.\n\n= 1.1.0 - June 6 2017 =\n* [NEW] Added a crawler - this includes configuration options and a dedicated admin page. Uses wp-cron\n* [NEW] Added integration for WPLister\n* [NEW] Added integration for Avada\n* [UPDATE] General structure of the plugin revamped\n* [UPDATE] Improved look of admin pages\n* [BUGFIX] Fix any/all wp-content path retrieval issues\n* [BUGFIX] Use realpath to clear symbolic link when determining .htaccess paths\n* [BUGFIX] Fixed a bug where upgrading multiple plugins did not trigger a purge all\n* [BUGFIX] Fixed a bug where cli import_options did not actually update the options.\n* [REFACTOR] Most of the files in the code were split into more, smaller files\n\n= 1.0.15 - April 20 2017 =\n* [NEW] Added Purge Pages and Purge Recent Posts Widget pages options.\n* [NEW] Added wp-cli command for setting and getting options.\n* [NEW] Added an import/export options cli command.\n* [NEW] Added wpForo integration.\n* [NEW] Added Theme My Login integration.\n* [UPDATE] Purge adjacent posts when publish a new post.\n* [UPDATE] Change environment report file to .php and increase security.\n* [UPDATE] Added new purgeby option to wp-cli.\n* [UPDATE] Remove nag for multiple sites.\n* [UPDATE] Only inject LiteSpeed javascripts in LiteSpeed pages.\n* [REFACTOR] Properly check for zero in ttl settings.\n* [BUGFIX] Fixed the 404 issue that can be caused by some certain plugins when save the settings.\n* [BUGFIX] Fixed mu-plugin compatibility.\n* [BUGFIX] Fixed problem with creating zip backup.\n* [BUGFIX] Fixed conflict with jetpack.\n\n= 1.0.14.1 - January 31 2017 =\n* [UPDATE] Removed Freemius integration due to feedback.\n\n= 1.0.14 - January 30 2017 =\n* [NEW] Added error page caching. Currently supports 403, 404, 500s.\n* [NEW] Added a purge errors action.\n* [NEW] Added wp-cli integration.\n* [UPDATE] Added support for multiple varies.\n* [UPDATE] Reorganize the admin interface to be less cluttered.\n* [UPDATE] Add support for LiteSpeed Web ADC.\n* [UPDATE] Add Freemius integration.\n* [REFACTOR] Made some changes so that the rewrite rules are a little more consistent.\n* [BUGFIX] Check member type before adding purge all button.\n* [BUGFIX] Fixed a bug where activating/deactivating the plugin quickly caused the WP_CACHE error to show up.\n* [BUGFIX] Handle more characters in the rewrite parser.\n* [BUGFIX] Correctly purge posts when they are made public/private.\n\n= 1.0.13.1 - November 30 2016 =\n* [BUGFIX] Fixed a bug where a global was being used without checking existence first, causing unnecessary log entries.\n\n= 1.0.13 - November 28 2016 =\n* [NEW] Add an Empty Entire Cache button.\n* [NEW] Add stale logic to certain purge actions.\n* [NEW] Add option to use primary site settings for all subsites in a multisite environment.\n* [NEW] Add support for Aelia CurrencySwitcher\n* [UPDATE] Add logic to allow third party vary headers\n* [UPDATE] Handle password protected pages differently.\n* [BUGFIX] Fixed bug caused by saving settings.\n* [BUGFIX] FIxed bug when searching for advanced-cache.php\n\n= 1.0.12 - November 14 2016 =\n* [NEW] Added logic to generate environment reports.\n* [NEW] Created a notice that will be triggered when the WHM Plugin installs this plugin. This will notify users when the plugin is installed by their server admin.\n* [NEW] Added the option to cache 404 pages via 404 Page TTL setting.\n* [NEW] Reworked log system to be based on selection of yes or no instead of log level.\n* [NEW] Added support for Autoptimize.\n* [NEW] Added Better WP Minify integration.\n* [UPDATE] On plugin disable, clear .htaccess.\n* [UPDATE] Introduced URL tag. Changed Purge by URL to use this new tag.\n* [BUGFIX] Fixed a bug triggered when .htaccess files were empty.\n* [BUGFIX] Correctly determine when to clear files in multisite environments (wp-config, advanced-cache, etc.).\n* [BUGFIX] When disabling the cache, settings changed in the same save will now be saved.\n* [BUGFIX] Various bugs from setting changes and multisite fixed.\n* [BUGFIX] Fixed two bugs with the .htaccess path search.\n* [BUGFIX] Do not alter $_GET in add_quick_purge. This may cause issues for functionality occurring later in the same request.\n* [BUGFIX] Right to left radio settings were incorrectly displayed. The radio buttons themselves were the opposite direction of the associated text.\n\n= 1.0.11 - October 11 2016 =\n* [NEW] The plugin will now set cachelookup public on.\n* [NEW] New option - check advanced-cache.php. This enables users to have two caching plugins enabled at the same time as long as the other plugin is not used for caching purposes. For example, using another cache plugin for css/js minification.\n* [UPDATE] Rules added by the plugin will now be inserted into an LSCACHE START/END PLUGIN comment block.\n* [UPDATE] For woocommerce pages, if a user visits a non-cached page with a non-empty cart, do not cache the page.\n* [UPDATE] If woocommerce needs to display any notice, do not cache the page.\n* [UPDATE] Single site settings are now in both the litespeed cache submenu and the settings submenu.\n* [BUGFIX] Multisite network options were not updated on upgrade. This is now corrected.\n\n= 1.0.10 - September 16 2016 =\n* Added a check for LSCACHE_NO_CACHE definition.\n* Added a Purge All button to the admin bar.\n* Added logic to purge the cache when upgrading a plugin or theme. By default this is enabled on single site installations and disabled on multisite installations.\n* Added support for WooCommerce Versions < 2.5.0.\n* Added .htaccess backup rotation. Every 10 backups, an .htaccess archive will be created. If one already exists, it will be overwritten.\n* Moved some settings to the new Specific Pages tab to reduce clutter in the General tab.\n* The .htaccess editor is now disabled if DISALLOW_FILE_EDIT is set.\n* After saving the Cache Tag Prefix setting, all cache will be purged.\n\n= 1.0.9.1 - August 26 2016 =\n* Fixed a bug where an error displayed on the configuration screen despite not being an error.\n* Change logic to check .htaccess file less often.\n\n= 1.0.9 - August 25 2016 =\n* [NEW] Added functionality to cache and purge feeds.\n* [NEW] Added cache tag prefix setting to avoid conflicts when using LiteSpeed Cache for WordPress with LiteSpeed Cache for XenForo and LiteMage.\n* [NEW] Added hooks to allow third party plugins to create config options.\n* [NEW] Added WooCommerce config options.\n* The plugin now also checks for wp-config in the parent directory.\n* Improved WooCommerce support.\n* Changed .htaccess backup process. Will create a .htaccess_lscachebak_orig file if one does not exist. If it does already exist, creates a backup using the date and timestamp.\n* Fixed a bug where get_home_path() sometimes returned an invalid path.\n* Fixed a bug where if the .htaccess was removed from a WordPress subdirectory, it was not handled properly.\n\n= 1.0.8.1 - July 28 2016 =\n* Fixed a bug where check cacheable was sometimes not hit.\n* Fixed a bug where extra slashes in clear rules were stripped.\n\n= 1.0.8 - July 25 2016 =\n* Added purge all on update check to purge by post id logic.\n* Added uninstall logic.\n* Added configuration for caching favicons.\n* Added configuration for caching the login page.\n* Added configuration for caching php resources (scripts/stylesheets accessed as .php).\n* Set login cookie if user is logged in and it isn\u2019t set.\n* Improved NextGenGallery support to include new actions.\n* Now displays a notice on the network admin if WP_CACHE is not set.\n* Fixed a few php syntax issues.\n* Fixed a bug where purge by pid didn\u2019t work.\n* Fixed a bug where the Network Admin settings were shown when the plugin was active in a subsite, but not network active.\n* Fixed a bug where the Advanced Cache check would sometimes not work.\n\n= 1.0.7.1 - May 26 2016 =\n* Fixed a bug where enabling purge all in the auto purge on update settings page did not purge the correct blogs.\n* Fixed a bug reported by user wpc on our forums where enabling purge all in the auto purge on update settings page caused nothing to be cached.\n\n= 1.0.7 - May 24 2016 =\n* Added login cookie configuration to the Advanced Settings page.\n* Added support for WPTouch plugin.\n* Added support for WP-Polls plugin.\n* Added Like Dislike Counter third party integration.\n* Added support for Admin IP Query String Actions.\n* Added confirmation pop up for purge all.\n* Refactor: LiteSpeed_Cache_Admin is now split into LiteSpeed_Cache_Admin, LiteSpeed_Cache_Admin_Display, and LiteSpeed_Cache_Admin_Rules\n* Refactor: Rename functions to accurately represent their functionality\n* Fixed a bug that sometimes caused a \u201cno valid header\u201d error message.\n\n= 1.0.6 - May 5 2016 =\n* Fixed a bug reported by Knut Sparhell that prevented dashboard widgets from being opened or closed.\n* Fixed a bug reported by Knut Sparhell that caused problems with https support for admin pages.\n\n= 1.0.5 - April 26 2016 =\n* [BETA] Added NextGen Gallery plugin support.\n* Added third party plugin integration.\n* Improved cache tag system.\n* Improved formatting for admin settings pages.\n* Converted bbPress to use the new third party integration system.\n* Converted WooCommerce to use the new third party integration system.\n* If .htaccess is not writable, disable separate mobile view and do not cache cookies/user agents.\n* Cache is now automatically purged when disabled.\n* Fixed a bug where .htaccess was not checked properly when adding common rules.\n* Fixed a bug where multisite setups would be completely purged when one site requested a purge all.\n\n= 1.0.4 - April 7 2016 =\n* Added logic to cache commenters.\n* Added htaccess backup to the install script.\n* Added an htaccess editor in the wp-admin dashboard.\n* Added do not cache user agents.\n* Added do not cache cookies.\n* Created new LiteSpeed Cache Settings submenu entries.\n* Implemented Separate Mobile View.\n* Modified WP_CACHE not defined message to only show up for users who can manage options.\n* Moved enabled all/disable all from network management to network settings.\n* Fixed a bug where WP_CACHE was not defined on activation if it was commented out.\n\n= 1.0.3 - March 23 2016 =\n* Added a Purge Front Page button to the LiteSpeed Cache Management page.\n* Added a Default Front Page TTL option to the general settings.\n* Added ability to define web application specific cookie names through rewrite rules to handle logged-in cookie conflicts when using multiple web applications. <strong>[Requires LSWS 5.0.15+]</strong>\n* Improved WooCommerce handling.\n* Fixed a bug where activating lscwp sets the \u201cenable cache\u201d radio button to enabled, but the cache was not enabled by default.\n* Refactored code to make it cleaner.\n* Updated readme.txt.\n\n= 1.0.2 - March 11 2016 =\n* Added a \"Use Network Admin Setting\" option for \"Enable LiteSpeed Cache\". For single sites, this choice will default to enabled.\n* Added enable/disable all buttons for network admin. This controls the setting of all managed sites with \"Use Network Admin Setting\" selected for \"Enable LiteSpeed Cache\".\n* Exclude by Category/Tag are now text areas to avoid slow load times on the LiteSpeed Cache Settings page for sites with a large number of categories/tags.\n* Added a new line to advanced-cache.php to allow identification as a LiteSpeed Cache file.\n* Activation/Deactivation are now better handled in multi-site environments.\n* Enable LiteSpeed Cache setting is now a radio button selection instead of a single checkbox.\n* Can now add '$' to the end of a URL in Exclude URI to perform an exact match.\n* The _lscache_vary cookie will now be deleted upon logout.\n* Fixed a bug in multi-site setups that would cause a \"function already defined\" error.\n\n= 1.0.1 - March 8 2016 =\n* Added Do Not Cache by URI, by Category, and by Tag.  URI is a prefix/string equals match.\n* Added a help tab for plugin compatibilities.\n* Created logic for other plugins to purge a single post if updated.\n* Fixed a bug where woocommerce pages that display the cart were cached.\n* Fixed a bug where admin menus in multi-site setups were not correctly displayed.\n* Fixed a bug where logged in users were served public cached pages.\n* Fixed a compatibility bug with bbPress.  If there is a new forum/topic/reply, the parent pages will now be purged as well.\n* Fixed a bug that didn't allow cron job to update scheduled posts.\n\n= 1.0.0 - January 20 2016 =\n* Initial Release.\n", "<?php\n/**\n * The ESI class.\n *\n * This is used to define all esi related functions.\n *\n * @since      \t1.1.3\n * @package    \tLiteSpeed\n * @subpackage \tLiteSpeed/src\n * @author     \tLiteSpeed Technologies <info@litespeedtech.com>\n */\nnamespace LiteSpeed;\n\ndefined( 'WPINC' ) || exit;\n\nclass ESI extends Root {\n\tprivate static $has_esi = false;\n\tprivate static $_combine_ids = array();\n\tprivate $esi_args = null;\n\tprivate $_esi_preserve_list = array();\n\tprivate $_nonce_actions = array( -1 => '' ); // val is cache control\n\n\tconst QS_ACTION = 'lsesi';\n\tconst QS_PARAMS = 'esi';\n\tconst COMBO = '__combo'; // ESI include combine='main' handler\n\n\tconst PARAM_ARGS = 'args';\n\tconst PARAM_ID = 'id';\n\tconst PARAM_INSTANCE = 'instance';\n\tconst PARAM_NAME = 'name';\n\n\tconst WIDGET_O_ESIENABLE = 'widget_esi_enable';\n\tconst WIDGET_O_TTL = 'widget_ttl';\n\n\t/**\n\t * Confructor of ESI\n\t *\n\t * @since  1.2.0\n\t * @since  4.0 Change to be after Vary init in hook 'after_setup_theme'\n\t */\n\tpublic function init() {\n\t\t/**\n\t\t * Bypass ESI related funcs if disabled ESI to fix potential DIVI compatibility issue\n\t\t * @since  2.9.7.2\n\t\t */\n\t\tif ( Router::is_ajax() || ! $this->cls( 'Router' )->esi_enabled() ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Guest mode, don't need to use ESI\n\t\tif ( defined( 'LITESPEED_GUEST' ) && LITESPEED_GUEST ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_ESI_OFF' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Init ESI in `after_setup_theme` hook after detected if LITESPEED_DISABLE_ALL is ON or not\n\t\t$this->_hooks();\n\n\t\t/**\n\t\t * Overwrite wp_create_nonce func\n\t\t * @since  2.9.5\n\t\t */\n\t\t$this->_transform_nonce();\n\n\t\t! defined( 'LITESPEED_ESI_INITED' ) && define( 'LITESPEED_ESI_INITED', true );\n\t}\n\n\t/**\n\t * Init ESI related hooks\n\t *\n\t * Load delayed by hook to give the ability to bypass by LITESPEED_DISABLE_ALL const\n\t *\n\t * @since 2.9.7.2\n\t * @since  4.0 Changed to private from public\n\t * @access private\n\t */\n\tprivate function _hooks() {\n\t\tadd_filter( 'template_include', array( $this, 'esi_template' ), 99999 );\n\n\t\tadd_action( 'load-widgets.php', __NAMESPACE__ . '\\Purge::purge_widget' );\n\t\tadd_action( 'wp_update_comment_count', __NAMESPACE__ . '\\Purge::purge_comment_widget' );\n\n\t\t/**\n\t\t * Recover REQUEST_URI\n\t\t * @since  1.8.1\n\t\t */\n\t\tif ( ! empty( $_GET[ self::QS_ACTION ] ) ) {\n\t\t\t$this->_register_esi_actions();\n\t\t}\n\n\t\t/**\n\t\t * Shortcode ESI\n\t\t *\n\t\t * To use it, just change the origianl shortcode as below:\n\t\t * \t\told: [someshortcode aa='bb']\n\t\t * \t\tnew: [esi someshortcode aa='bb' cache='private,no-vary' ttl='600']\n\t\t *\n\t\t * \t1. `cache` attribute is optional, default to 'public,no-vary'.\n\t\t * \t2. `ttl` attribute is optional, default is your public TTL setting.\n\t\t *  3. `_ls_silence` attribute is optional, default is false.\n\t\t *\n\t\t * @since  2.8\n\t\t * @since  2.8.1 Check is_admin for Elementor compatibility #726013\n\t\t */\n\t\tif ( ! is_admin() ) {\n\t\t\tadd_shortcode( 'esi', array( $this, 'shortcode' ) );\n\t\t}\n\n\t}\n\n\t/**\n\t * Take over all nonce calls and transform to ESI\n\t *\n\t * @since  2.9.5\n\t */\n\tprivate function _transform_nonce() {\n\t\tif ( is_admin() ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Load ESI nonces in conf\n\t\t$nonces = $this->conf( Base::O_ESI_NONCE );\n\t\tadd_filter( 'litespeed_esi_nonces', array( $this->cls( 'Data' ), 'load_esi_nonces' ) );\n\t\tif ( $nonces = apply_filters( 'litespeed_esi_nonces', $nonces ) ) {\n\t\t\tforeach ( $nonces as $action ) {\n\t\t\t\t$this->nonce_action( $action );\n\t\t\t}\n\t\t}\n\n\t\tadd_action( 'litespeed_nonce', array( $this, 'nonce_action' ) );\n\t}\n\n\t/**\n\t * Register a new nonce action to convert it to ESI\n\t *\n\t * @since  2.9.5\n\t */\n\tpublic function nonce_action( $action ) {\n\t\t// Split the Cache Control\n\t\t$action = explode( ' ', $action );\n\t\t$control = ! empty( $action[ 1 ] ) ? $action[ 1 ] : '';\n\t\t$action = $action[ 0 ];\n\n\t\t// Wildcard supported\n\t\t$action = Utility::wildcard2regex( $action );\n\n\t\tif ( array_key_exists( $action, $this->_nonce_actions ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_nonce_actions[ $action ] = $control;\n\n\t\tDebug2::debug( '[ESI] Appended nonce action to nonce list [action] ' . $action );\n\t}\n\n\t/**\n\t * Check if an action is registered to replace ESI\n\t *\n\t * @since 2.9.5\n\t */\n\tpublic function is_nonce_action( $action ) {\n\t\t// If GM not run yet, then ESI not init yet, then ESI nonce will not be allowed even nonce func replaced.\n\t\tif ( ! defined( 'LITESPEED_ESI_INITED' ) ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( is_admin() ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_ESI_OFF' ) ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tforeach ( $this->_nonce_actions as $k => $v ) {\n\t\t\tif ( strpos( $k, '*' ) !== false ) {\n\t\t\t\tif( preg_match( '#' . $k . '#iU', $action ) ) {\n\t\t\t\t\treturn $v;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif ( $k == $action ) {\n\t\t\t\t\treturn $v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Shortcode ESI\n\t *\n\t * @since 2.8\n\t * @access public\n\t */\n\tpublic function shortcode( $atts ) {\n\t\tif ( empty( $atts[ 0 ] ) ) {\n\t\t\tDebug2::debug( '[ESI] ===shortcode wrong format', $atts );\n\t\t\treturn 'Wrong shortcode esi format';\n\t\t}\n\n\t\t$cache = 'public,no-vary';\n\t\tif ( ! empty( $atts[ 'cache' ] ) ) {\n\t\t\t$cache = $atts[ 'cache' ];\n\t\t\tunset( $atts[ 'cache' ] );\n\t\t}\n\n\t\t$silence = false;\n\t\tif ( ! empty( $atts[ '_ls_silence' ] ) ) {\n\t\t\t$silence = true;\n\t\t}\n\n\t\tdo_action( 'litespeed_esi_shortcode-' . $atts[ 0 ] );\n\n\t\t// Show ESI link\n\t\treturn $this->sub_esi_block( 'esi', 'esi-shortcode', $atts, $cache, $silence );\n\t}\n\n\t/**\n\t * Check if the requested page has esi elements. If so, return esi on\n\t * header.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @return string Esi On header if request has esi, empty string otherwise.\n\t */\n\tpublic static function has_esi() {\n\t\treturn self::$has_esi;\n\t}\n\n\t/**\n\t * Sets that the requested page has esi elements.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function set_has_esi() {\n\t\tself::$has_esi = true;\n\t}\n\n\t/**\n\t * Register all of the hooks related to the esi logic of the plugin.\n\t * Specifically when the page IS an esi page.\n\t *\n\t * @since    1.1.3\n\t * @access   private\n\t */\n\tprivate function _register_esi_actions() {\n\t\t! defined( 'LSCACHE_IS_ESI' ) && define( 'LSCACHE_IS_ESI', $_GET[ self::QS_ACTION ] );// Reused this to ESI block ID\n\n\t\t! empty( $_SERVER[ 'ESI_REFERER' ] ) && defined( 'LSCWP_LOG' ) && Debug2::debug( '[ESI] ESI_REFERER: ' . $_SERVER[ 'ESI_REFERER' ] );\n\n\t\t/**\n\t\t * Only when ESI's parent is not REST, replace REQUEST_URI to avoid breaking WP5 editor REST call\n\t\t * @since 2.9.3\n\t\t */\n\t\tif ( ! empty( $_SERVER[ 'ESI_REFERER' ] ) && ! $this->cls( 'REST' )->is_rest( $_SERVER[ 'ESI_REFERER' ] ) ) {\n\t\t\t$_SERVER[ 'REQUEST_URI' ] = $_SERVER[ 'ESI_REFERER' ];\n\t\t}\n\n\t\tif ( ! empty( $_SERVER[ 'ESI_CONTENT_TYPE' ] ) && strpos( $_SERVER[ 'ESI_CONTENT_TYPE' ], 'application/json' ) === 0 ) {\n\t\t\tadd_filter( 'litespeed_is_json', '__return_true' );\n\t\t}\n\n\t\t/**\n\t\t * Make REST call be able to parse ESI\n\t\t * NOTE: Not effective due to ESI req are all to `/` yet\n\t\t * @since 2.9.4\n\t\t */\n\t\tadd_action( 'rest_api_init', array( $this, 'load_esi_block' ), 101 );\n\n\t\t// Register ESI blocks\n\t\tadd_action('litespeed_esi_load-widget', array($this, 'load_widget_block'));\n\t\tadd_action('litespeed_esi_load-admin-bar', array($this, 'load_admin_bar_block'));\n\t\tadd_action('litespeed_esi_load-comment-form', array($this, 'load_comment_form_block'));\n\n\t\tadd_action('litespeed_esi_load-nonce', array( $this, 'load_nonce_block' ) );\n\t\tadd_action('litespeed_esi_load-esi', array( $this, 'load_esi_shortcode' ) );\n\n\t\tadd_action('litespeed_esi_load-' . self::COMBO, array( $this, 'load_combo' ) );\n\t}\n\n\t/**\n\t * Hooked to the template_include action.\n\t * Selects the esi template file when the post type is a LiteSpeed ESI page.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param string $template The template path filtered.\n\t * @return string The new template path.\n\t */\n\tpublic function esi_template( $template ) {\n\t\t// Check if is an ESI request\n\t\tif ( defined( 'LSCACHE_IS_ESI' ) ) {\n\t\t\tDebug2::debug( '[ESI] calling template' );\n\n\t\t\treturn LSCWP_DIR . 'tpl/esi.tpl.php';\n\t\t}\n\t\t$this->_register_not_esi_actions();\n\t\treturn $template;\n\t}\n\n\t/**\n\t * Register all of the hooks related to the esi logic of the plugin.\n\t * Specifically when the page is NOT an esi page.\n\t *\n\t * @since    1.1.3\n\t * @access   private\n\t */\n\tprivate function _register_not_esi_actions() {\n\t\tdo_action( 'litespeed_tpl_normal' );\n\n\t\tif ( ! Control::is_cacheable() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Router::is_ajax() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter('widget_display_callback', array( $this, 'sub_widget_block' ), 0, 3);\n\n\t\t// Add admin_bar esi\n\t\tif ( Router::is_logged_in() ) {\n\t\t\tremove_action('wp_footer', 'wp_admin_bar_render', 1000);\n\t\t\tadd_action('wp_footer', array($this, 'sub_admin_bar_block'), 1000);\n\t\t}\n\n\t\t// Add comment forum esi for logged-in user or commenter\n\t\tif ( ! Router::is_ajax() && Vary::has_vary() ) {\n\t\t\tadd_filter( 'comment_form_defaults', array( $this, 'register_comment_form_actions' ) );\n\t\t}\n\n\t}\n\n\t/**\n\t * Set an ESI to be combine='sub'\n\t *\n\t * @since  3.4.2\n\t */\n\tpublic static function combine( $block_id ) {\n\t\tif ( ! isset( $_SERVER[ 'X-LSCACHE' ] ) || strpos( $_SERVER[ 'X-LSCACHE' ], 'combine' ) === false ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( in_array( $block_id, self::$_combine_ids ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::$_combine_ids[] = $block_id;\n\t}\n\n\t/**\n\t * Load combined ESI\n\t *\n\t * @since  3.4.2\n\t */\n\tpublic function load_combo() {\n\t\tControl::set_nocache( 'ESI combine request' );\n\n\t\tif ( empty( $_POST[ 'esi_include' ] ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::set_has_esi();\n\n\t\tDebug2::debug( '[ESI] \ud83c\udf54 Load combo', $_POST[ 'esi_include' ] );\n\n\t\t$output = '';\n\t\tforeach ( $_POST[ 'esi_include' ] as $url ) {\n\t\t\t$qs = parse_url( htmlspecialchars_decode( $url ), PHP_URL_QUERY );\n\t\t\tparse_str( $qs, $qs );\n\t\t\tif ( empty( $qs[ self::QS_ACTION ] ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$esi_id = $qs[ self::QS_ACTION ];\n\t\t\t$esi_param = ! empty( $qs[ self::QS_PARAMS ] ) ? $this->_parse_esi_param( $qs[ self::QS_PARAMS ] ) : false;\n\t\t\t$inline_param = apply_filters( 'litespeed_esi_inline-' . $esi_id, array(), $esi_param ); // Returned array need to be [ val, control, tag ]\n\t\t\tif ( $inline_param ) {\n\t\t\t\t$output .= self::_build_inline( $url, $inline_param );\n\t\t\t}\n\t\t}\n\n\t\techo $output;\n\t}\n\n\t/**\n\t * Build a whole inline segment\n\t *\n\t * @since  3.4.2\n\t */\n\tprivate static function _build_inline( $url, $inline_param ) {\n\t\tif ( ! $url || empty( $inline_param[ 'val' ] ) || empty( $inline_param[ 'control' ] ) || empty( $inline_param[ 'tag' ] ) ) {\n\t\t\treturn '';\n\t\t}\n\n\t\treturn \"<esi:inline name='$url' cache-control='\" . $inline_param[ 'control' ] . \"' cache-tag='\" . $inline_param[ 'tag' ] . \"'>\" . $inline_param[ 'val' ] . \"</esi:inline>\";\n\t}\n\n\t/**\n\t * Build the esi url. This method will build the html comment wrapper as well as serialize and encode the parameter array.\n\t *\n\t * The block_id parameter should contain alphanumeric and '-_' only.\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t * @param string $block_id The id to use to display the correct esi block.\n\t * @param string $wrapper The wrapper for the esi comments.\n\t * @param array $params The esi parameters.\n\t * @param string $control The cache control attribute if any.\n\t * @param bool $silence If generate wrapper comment or not\n\t * @param bool $preserved \tIf this ESI block is used in any filter, need to temporarily convert it to a string to avoid the HTML tag being removed/filtered.\n\t * @param bool $svar  \t\tIf store the value in memory or not, in memory wil be faster\n\t * @param array $inline_val \tIf show the current value for current request( this can avoid multiple esi requests in first time cache generating process )\n\t */\n\tpublic function sub_esi_block( $block_id, $wrapper, $params = array(), $control = 'private,no-vary', $silence = false, $preserved = false, $svar = false, $inline_param = array() ) {\n\t\tif ( empty($block_id) || ! is_array($params) || preg_match('/[^\\w-]/', $block_id) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( defined( 'LITESPEED_ESI_OFF' ) ) {\n\t\t\tDebug2::debug( '[ESI] ESI OFF so force loading [block_id] ' . $block_id );\n\t\t\tdo_action( 'litespeed_esi_load-' . $block_id, $params );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( $silence ) {\n\t\t\t// Don't add comment to esi block ( original for nonce used in tag property data-nonce='esi_block' )\n\t\t\t$params[ '_ls_silence' ] = true;\n\t\t}\n\n\t\tif ( $this->cls( 'REST' )->is_rest() || $this->cls( 'REST' )->is_internal_rest() ) {\n\t\t\t$params[ 'is_json' ] = 1;\n\t\t}\n\n\t\t$params = apply_filters( 'litespeed_esi_params', $params, $block_id );\n\t\t$control = apply_filters('litespeed_esi_control', $control, $block_id );\n\n\t\tif ( !is_array($params) || !is_string($control) ) {\n\t\t\tdefined( 'LSCWP_LOG' ) && Debug2::debug( \"[ESI] \ud83d\uded1 Sub hooks returned Params: \\n\" . var_export($params, true) . \"\\ncache control: \\n\" . var_export($control, true) );\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Build params for URL\n\t\t$appended_params = array(\n\t\t\tself::QS_ACTION\t=> $block_id,\n\t\t);\n\t\tif ( ! empty( $control ) ) {\n\t\t\t$appended_params[ '_control' ] = $control;\n\t\t}\n\t\tif ( $params ) {\n\t\t\t$appended_params[ self::QS_PARAMS ] = base64_encode( json_encode( $params ) );\n\t\t\tDebug2::debug2( '[ESI] param ', $params );\n\t\t}\n\n\t\t// Append hash\n\t\t$appended_params[ '_hash' ] = $this->_gen_esi_md5( $appended_params );\n\n\t\t/**\n\t\t * Escape potential chars\n\t\t * @since 2.9.4\n\t\t */\n\t\t$appended_params = array_map( 'urlencode', $appended_params );\n\n\t\t// Generate ESI URL\n\t\t$url = add_query_arg( $appended_params, trailingslashit( wp_make_link_relative( home_url() ) ) );\n\n\t\t$output = '';\n\t\tif ( $inline_param ) {\n\t\t\t$output .= self::_build_inline( $url, $inline_param );\n\t\t}\n\n\t\t$output .= \"<esi:include src='$url'\";\n\t\tif ( ! empty( $control ) ) {\n\t\t\t$output .= \" cache-control='$control'\";\n\t\t}\n\t\tif ( $svar ) {\n\t\t\t$output .= \" as-var='1'\";\n\t\t}\n\t\tif ( in_array( $block_id, self::$_combine_ids ) ) {\n\t\t\t$output .= \" combine='sub'\";\n\t\t}\n\t\tif ( $block_id == self::COMBO && isset( $_SERVER[ 'X-LSCACHE' ] ) && strpos( $_SERVER[ 'X-LSCACHE' ], 'combine' ) !== false ) {\n\t\t\t$output .= \" combine='main'\";\n\t\t}\n\t\t$output .= \" />\";\n\n\t\tif ( ! $silence ) {\n\t\t\t$output = \"<!-- lscwp $wrapper -->$output<!-- lscwp $wrapper esi end -->\";\n\t\t}\n\n\t\tDebug2::debug( \"[ESI] \ud83d\udc95  [BLock_ID] $block_id \\t[wrapper] $wrapper \\t\\t[Control] $control\" );\n\t\tDebug2::debug2( $output );\n\n\t\tself::set_has_esi();\n\n\t\t// Convert to string to avoid html chars filter when using\n\t\t// Will reverse the buffer when output in self::finalize()\n\t\tif ( $preserved ) {\n\t\t\t$hash = md5( $output );\n\t\t\t$this->_esi_preserve_list[ $hash ] = $output;\n\t\t\tDebug2::debug( \"[ESI] Preserved to $hash\" );\n\n\t\t\treturn $hash;\n\t\t}\n\n\t\treturn $output;\n\t}\n\n\t/**\n\t * Generate ESI hash md5\n\t *\n\t * @since  2.9.6\n\t * @access private\n\t */\n\tprivate function _gen_esi_md5( $params ) {\n\t\t$keys = array(\n\t\t\tself::QS_ACTION,\n\t\t\t'_control',\n\t\t\tself::QS_PARAMS,\n\t\t);\n\n\t\t$str = '';\n\t\tforeach ( $keys as $v ) {\n\t\t\tif ( isset( $params[ $v ] ) && is_string( $params[ $v ] ) ) {\n\t\t\t\t$str .= $params[ $v ];\n\t\t\t}\n\t\t}\n\t\tDebug2::debug2( '[ESI] md5_string=' . $str );\n\n\t\treturn md5( $this->conf( Base::HASH ) . $str );\n\t}\n\n\t/**\n\t * Parses the request parameters on an ESI request\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t */\n\tprivate function _parse_esi_param( $qs_params = false ) {\n\t\t$req_params = false;\n\t\tif ( $qs_params ) {\n\t\t\t$req_params = $qs_params;\n\t\t}\n\t\telseif ( isset( $_REQUEST[ self::QS_PARAMS ] ) ) {\n\t\t\t$req_params = $_REQUEST[ self::QS_PARAMS ];\n\t\t}\n\n\t\tif ( ! $req_params ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$unencrypted = base64_decode( $req_params );\n\t\tif ( $unencrypted === false ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug2( '[ESI] parms', $unencrypted );\n\t\t// $unencoded = urldecode($unencrypted); no need to do this as $_GET is already parsed\n\t\t$params = json_decode( $unencrypted, true );\n\n\t\treturn $params;\n\t}\n\n\t/**\n\t * Select the correct esi output based on the parameters in an ESI request.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function load_esi_block() {\n\t\t/**\n\t\t * Validate if is a legal ESI req\n\t\t * @since 2.9.6\n\t\t */\n\t\tif ( empty( $_GET[ '_hash' ] ) || $this->_gen_esi_md5( $_GET ) != $_GET[ '_hash' ] ) {\n\t\t\tDebug2::debug( '[ESI] \u274c Failed to validate _hash' );\n\t\t\treturn;\n\t\t}\n\n\t\t$params = $this->_parse_esi_param();\n\n\t\tif ( defined( 'LSCWP_LOG' ) ) {\n\t\t\t$logInfo = '[ESI] \u2b55 ';\n\t\t\tif( ! empty( $params[ self::PARAM_NAME ] ) ) {\n\t\t\t\t$logInfo .= ' Name: ' . $params[ self::PARAM_NAME ] . ' ----- ';\n\t\t\t}\n\t\t\t$logInfo .= ' [ID] ' . LSCACHE_IS_ESI;\n\t\t\tDebug2::debug( $logInfo );\n\t\t}\n\n\t\tif ( ! empty( $params[ '_ls_silence' ] ) ) {\n\t\t\t! defined( 'LSCACHE_ESI_SILENCE' ) && define( 'LSCACHE_ESI_SILENCE', true );\n\t\t}\n\n\t\t/**\n\t\t * Buffer needs to be JSON format\n\t\t * @since  2.9.4\n\t\t */\n\t\tif ( ! empty( $params[ 'is_json' ] ) ) {\n\t\t\tadd_filter( 'litespeed_is_json', '__return_true' );\n\t\t}\n\n\t\tTag::add( rtrim( Tag::TYPE_ESI, '.' ) );\n\t\tTag::add( Tag::TYPE_ESI . LSCACHE_IS_ESI );\n\n\t\t// Debug2::debug(var_export($params, true ));\n\n\t\t/**\n\t\t * Handle default cache control 'private,no-vary' for sub_esi_block() \t@ticket #923505\n\t\t *\n\t\t * @since  2.2.3\n\t\t */\n\t\tif ( ! empty( $_GET[ '_control' ] ) ) {\n\t\t\t$control = explode( ',', $_GET[ '_control' ] );\n\t\t\tif ( in_array( 'private', $control ) ) {\n\t\t\t\tControl::set_private();\n\t\t\t}\n\n\t\t\tif ( in_array( 'no-vary', $control ) ) {\n\t\t\t\tControl::set_no_vary();\n\t\t\t}\n\t\t}\n\n\t\tdo_action('litespeed_esi_load-' . LSCACHE_IS_ESI, $params);\n\t}\n\n// The *_sub_* functions are helpers for the sub_* functions.\n// The *_load_* functions are helpers for the load_* functions.\n\n\t/**\n\t * Loads the default options for default WordPress widgets.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function widget_default_options($options, $widget) {\n\t\tif ( ! is_array($options) ) {\n\t\t\treturn $options;\n\t\t}\n\n\t\t$widget_name = get_class($widget);\n\t\tswitch ($widget_name) {\n\t\t\tcase 'WP_Widget_Recent_Posts' :\n\t\t\tcase 'WP_Widget_Recent_Comments' :\n\t\t\t\t$options[self::WIDGET_O_ESIENABLE] = Base::VAL_OFF;\n\t\t\t\t$options[self::WIDGET_O_TTL] = 86400;\n\t\t\t\tbreak;\n\t\t\tdefault :\n\t\t\t\tbreak;\n\t\t}\n\t\treturn $options;\n\t}\n\n\t/**\n\t * Hooked to the widget_display_callback filter.\n\t * If the admin configured the widget to display via esi, this function\n\t * will set up the esi request and cancel the widget display.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param array $instance Parameter used to build the widget.\n\t * @param WP_Widget $widget The widget to build.\n\t * @param array $args Parameter used to build the widget.\n\t * @return mixed Return false if display through esi, instance otherwise.\n\t */\n\tpublic function sub_widget_block( $instance, $widget, $args ) {\n\t\t// #210407\n\t\tif ( ! is_array( $instance ) ) {\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$name = get_class( $widget );\n\t\tif ( ! isset( $instance[ Base::OPTION_NAME ] ) ) {\n\t\t\treturn $instance;\n\t\t}\n\t\t$options = $instance[ Base::OPTION_NAME ];\n\t\tif ( ! isset( $options ) || ! $options[ self::WIDGET_O_ESIENABLE ] ) {\n\t\t\tdefined( 'LSCWP_LOG' ) && Debug2::debug( 'ESI 0 ' . $name . ': '. ( ! isset( $options ) ? 'not set' : 'set off' ) );\n\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$esi_private = $options[ self::WIDGET_O_ESIENABLE ] == Base::VAL_ON2 ? 'private,' : '';\n\n\t\t$params = array(\n\t\t\tself::PARAM_NAME => $name,\n\t\t\tself::PARAM_ID => $widget->id,\n\t\t\tself::PARAM_INSTANCE => $instance,\n\t\t\tself::PARAM_ARGS => $args\n\t\t);\n\n\t\techo $this->sub_esi_block( 'widget', 'widget ' . $name, $params, $esi_private . 'no-vary' );\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Hooked to the wp_footer action.\n\t * Sets up the ESI request for the admin bar.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global type $wp_admin_bar\n\t */\n\tpublic function sub_admin_bar_block() {\n\t\tglobal $wp_admin_bar;\n\n\t\tif ( ! is_admin_bar_showing() || ! is_object($wp_admin_bar) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// To make each admin bar ESI request different for `Edit` button different link\n\t\t$params = array(\n\t\t\t'ref' => $_SERVER[ 'REQUEST_URI' ],\n\t\t);\n\n\t\techo $this->sub_esi_block( 'admin-bar', 'adminbar', $params );\n\t}\n\n\t/**\n\t * Parses the esi input parameters and generates the widget for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global $wp_widget_factory\n\t * @param array $params Input parameters needed to correctly display widget\n\t */\n\tpublic function load_widget_block( $params ) {\n\t\t// global $wp_widget_factory;\n\t\t// $widget = $wp_widget_factory->widgets[ $params[ self::PARAM_NAME ] ];\n\t\t$option = $params[ self::PARAM_INSTANCE ];\n\t\t$option = $option[ Base::OPTION_NAME ];\n\n\t\t// Since we only reach here via esi, safe to assume setting exists.\n\t\t$ttl = $option[ self::WIDGET_O_TTL ];\n\t\tdefined( 'LSCWP_LOG' ) && Debug2::debug( 'ESI widget render: name ' . $params[ self::PARAM_NAME ] . ', id ' . $params[ self::PARAM_ID ] . ', ttl ' . $ttl );\n\t\tif ( $ttl == 0 ) {\n\t\t\tControl::set_nocache( 'ESI Widget time to live set to 0' );\n\t\t}\n\t\telse {\n\t\t\tControl::set_custom_ttl( $ttl );\n\n\t\t\tif ( $option[ self::WIDGET_O_ESIENABLE ] == Base::VAL_ON2 ) {\n\t\t\t\tControl::set_private();\n\t\t\t}\n\t\t\tControl::set_no_vary();\n\t\t\tTag::add( Tag::TYPE_WIDGET . $params[ self::PARAM_ID ] );\n\t\t}\n\t\tthe_widget( $params[ self::PARAM_NAME ], $params[ self::PARAM_INSTANCE ], $params[ self::PARAM_ARGS ] );\n\t}\n\n\t/**\n\t * Generates the admin bar for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t */\n\tpublic function load_admin_bar_block( $params ) {\n\n\t\tif ( ! empty( $params[ 'ref' ] ) ) {\n\t\t\t$ref_qs = parse_url( $params[ 'ref' ], PHP_URL_QUERY );\n\t\t\tif ( ! empty( $ref_qs ) ) {\n\t\t\t\tparse_str( $ref_qs, $ref_qs_arr );\n\n\t\t\t\tif ( ! empty( $ref_qs_arr ) ) {\n\t\t\t\t\tforeach ( $ref_qs_arr as $k => $v ) {\n\t\t\t\t\t\t$_GET[ $k ] = $v;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\twp_admin_bar_render();\n\t\tif ( ! $this->conf( Base::O_ESI_CACHE_ADMBAR ) ) {\n\t\t\tControl::set_nocache( 'build-in set to not cacheable' );\n\t\t}\n\t\telse {\n\t\t\tControl::set_private();\n\t\t\tControl::set_no_vary();\n\t\t}\n\n\t\tdefined( 'LSCWP_LOG' ) && Debug2::debug( 'ESI: adminbar ref: ' . $_SERVER[ 'REQUEST_URI' ] );\n\t}\n\n\n\t/**\n\t * Parses the esi input parameters and generates the comment form for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @param array $params Input parameters needed to correctly display comment form\n\t */\n\tpublic function load_comment_form_block( $params ) {\n\t\tcomment_form( $params[ self::PARAM_ARGS ], $params[ self::PARAM_ID ] );\n\n\t\tif ( ! $this->conf( Base::O_ESI_CACHE_COMMFORM ) ) {\n\t\t\tControl::set_nocache( 'build-in set to not cacheable' );\n\t\t}\n\t\telse {\n\t\t\t// by default comment form is public\n\t\t\tif ( Vary::has_vary() ) {\n\t\t\t\tControl::set_private();\n\t\t\t\tControl::set_no_vary();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Generate nonce for certain action\n\t *\n\t * @access public\n\t * @since 2.6\n\t */\n\tpublic function load_nonce_block( $params ) {\n\t\t$action = $params[ 'action' ];\n\n\t\tDebug2::debug( '[ESI] load_nonce_block [action] ' . $action );\n\n\t\t// set nonce TTL to half day\n\t\tControl::set_custom_ttl( 43200 );\n\n\t\tif ( Router::is_logged_in() ) {\n\t\t\tControl::set_private();\n\t\t}\n\n\t\tif ( function_exists( 'wp_create_nonce_litespeed_esi' ) ) {\n\t\t\techo wp_create_nonce_litespeed_esi( $action );\n\t\t}\n\t\telse {\n\t\t\techo wp_create_nonce( $action );\n\t\t}\n\t}\n\n\t/**\n\t * Show original shortcode\n\t *\n\t * @access public\n\t * @since 2.8\n\t */\n\tpublic function load_esi_shortcode( $params ) {\n\t\tif ( isset( $params[ 'ttl' ] ) ) {\n\t\t\tif ( ! $params[ 'ttl' ] ) {\n\t\t\t\tControl::set_nocache( 'ESI shortcode att ttl=0' );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tControl::set_custom_ttl( $params[ 'ttl' ] );\n\t\t\t}\n\t\t\tunset( $params[ 'ttl' ] );\n\t\t}\n\n\t\t// Replace to original shortcode\n\t\t$shortcode = $params[ 0 ];\n\t\t$atts_ori = array();\n\t\tforeach ( $params as $k => $v ) {\n\t\t\tif ( $k === 0 ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$atts_ori[] = is_string( $k ) ? \"$k='\" . addslashes( $v ) . \"'\" : $v;\n\t\t}\n\n\t\tTag::add( Tag::TYPE_ESI . \"esi.$shortcode\" );\n\n\t\t// Output original shortcode final content\n\t\techo do_shortcode( \"[$shortcode \" . implode( ' ', $atts_ori ) . \" ]\" );\n\t}\n\n\t/**\n\t * Hooked to the comment_form_defaults filter.\n\t * Stores the default comment form settings.\n\t * If sub_comment_form_block is triggered, the output buffer is cleared and an esi block is added. The remaining comment form is also buffered and cleared.\n\t * Else there is no need to make the comment form ESI.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function register_comment_form_actions( $defaults ) {\n\t\t$this->esi_args = $defaults;\n\t\techo GUI::clean_wrapper_begin();\n\t\tadd_filter( 'comment_form_submit_button', array( $this, 'sub_comment_form_btn' ), 1000, 2 ); // To save the params passed in\n\t\tadd_action( 'comment_form', array( $this, 'sub_comment_form_block' ), 1000 );\n\t\treturn $defaults;\n\t}\n\n\t/**\n\t * Store the args passed in comment_form for the ESI comment param usage in `$this->sub_comment_form_block()`\n\t *\n\t * @since  3.4\n\t * @access public\n\t */\n\tpublic function sub_comment_form_btn( $unused, $args ) {\n\t\tif ( empty( $args ) || empty( $this->esi_args ) ) {\n\t\t\tDebug2::debug( 'comment form args empty?' );\n\t\t\treturn $unused;\n\t\t}\n\t\t$esi_args = array();\n\n\t\t// compare current args with default ones\n\t\tforeach ( $args as $k => $v ) {\n\t\t\tif ( ! isset( $this->esi_args[ $k ] ) ) {\n\t\t\t\t$esi_args[ $k ] = $v;\n\t\t\t}\n\t\t\telseif ( is_array( $v ) ) {\n\t\t\t\t$diff = array_diff_assoc( $v, $this->esi_args[ $k ] );\n\t\t\t\tif ( ! empty( $diff ) ) {\n\t\t\t\t\t$esi_args[ $k ] = $diff;\n\t\t\t\t}\n\t\t\t}\n\t\t\telseif ( $v !== $this->esi_args[ $k ] ) {\n\t\t\t\t$esi_args[ $k ] = $v;\n\t\t\t}\n\t\t}\n\n\t\t$this->esi_args = $esi_args;\n\n\t\treturn $unused;\n\t}\n\n\t/**\n\t * Hooked to the comment_form_submit_button filter.\n\t *\n\t * This method will compare the used comment form args against the default args. The difference will be passed to the esi request.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t */\n\tpublic function sub_comment_form_block( $post_id ) {\n\t\techo GUI::clean_wrapper_end();\n\t\t$params = array(\n\t\t\tself::PARAM_ID => $post_id,\n\t\t\tself::PARAM_ARGS => $this->esi_args,\n\t\t);\n\n\t\techo $this->sub_esi_block( 'comment-form', 'comment form', $params );\n\t\techo GUI::clean_wrapper_begin();\n\t\tadd_action( 'comment_form_after', array( $this, 'comment_form_sub_clean' ) );\n\t}\n\n\t/**\n\t * Hooked to the comment_form_after action.\n\t * Cleans up the remaining comment form output.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function comment_form_sub_clean() {\n\t\techo GUI::clean_wrapper_end();\n\t}\n\n\t/**\n\t * Replace preseved blocks\n\t *\n\t * @since  2.6\n\t * @access public\n\t */\n\tpublic function finalize( $buffer ) {\n\t\t// Prepend combo esi block\n\t\tif ( self::$_combine_ids ) {\n\t\t\tDebug2::debug( '[ESI] \ud83c\udf54 Enabled combo' );\n\t\t\t$esi_block = $this->sub_esi_block( self::COMBO, '__COMBINE_MAIN__', array(), 'no-cache', true );\n\t\t\t$buffer = $esi_block . $buffer;\n\t\t}\n\n\t\t// Bypass if no preserved list to be replaced\n\t\tif ( ! $this->_esi_preserve_list ) {\n\t\t\treturn $buffer;\n\t\t}\n\n\t\t$keys = array_keys( $this->_esi_preserve_list );\n\n\t\tDebug2::debug( '[ESI] replacing preserved blocks', $keys );\n\n\t\t$buffer = str_replace( $keys, $this->_esi_preserve_list, $buffer );\n\n\t\treturn $buffer;\n\t}\n\n\t/**\n\t * Check if the content contains preserved list or not\n\t *\n\t * @since  3.3\n\t */\n\tpublic function contain_preserve_esi( $content ) {\n\t\t$hit_list = array();\n\t\tforeach ( $this->_esi_preserve_list as $k => $v ) {\n\t\t\tif ( strpos( $content, '\"' . $k . '\"' ) !== false ) {\n\t\t\t\t$hit_list[] = '\"' . $k . '\"';\n\t\t\t}\n\t\t\tif ( strpos( $content, \"'\" . $k . \"'\" ) !== false ) {\n\t\t\t\t$hit_list[] = \"'\" . $k . \"'\";\n\t\t\t}\n\t\t}\n\t\treturn $hit_list;\n\t}\n\n}\n"], "fixing_code": ["<?php\n\n/**\n * Plugin Name:       LiteSpeed Cache\n * Plugin URI:        https://www.litespeedtech.com/products/cache-plugins/wordpress-acceleration\n * Description:       High-performance page caching and site optimization from LiteSpeed\n * Version:           5.6.1-a10\n * Author:            LiteSpeed Technologies\n * Author URI:        https://www.litespeedtech.com\n * License:           GPLv3\n * License URI:       http://www.gnu.org/licenses/gpl.html\n * Text Domain:       litespeed-cache\n * Domain Path:       /lang\n *\n * Copyright (C) 2015-2017 LiteSpeed Technologies, Inc.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n */\ndefined('WPINC') || exit;\n\nif (defined('LSCWP_V')) {\n\treturn;\n}\n\n!defined('LSCWP_V') && define('LSCWP_V', '5.6.1-a10');\n\n!defined('LSCWP_CONTENT_DIR') && define('LSCWP_CONTENT_DIR', WP_CONTENT_DIR);\n!defined('LSCWP_DIR') && define('LSCWP_DIR', __DIR__ . '/'); // Full absolute path '/var/www/html/***/wp-content/plugins/litespeed-cache/' or MU\n!defined('LSCWP_BASENAME') && define('LSCWP_BASENAME', 'litespeed-cache/litespeed-cache.php'); //LSCWP_BASENAME='litespeed-cache/litespeed-cache.php'\n\n/**\n * This needs to be before activation because admin-rules.class.php need const `LSCWP_CONTENT_FOLDER`\n * This also needs to be before cfg.cls init because default cdn_included_dir needs `LSCWP_CONTENT_FOLDER`\n * @since  5.2 Auto correct protocol for CONTENT URL\n */\n$WP_CONTENT_URL = WP_CONTENT_URL;\n$home_url = home_url('/');\nif (substr($WP_CONTENT_URL, 0, 5) == 'http:' && substr($home_url, 0, 5) == 'https') $WP_CONTENT_URL = str_replace('http://', 'https://', $WP_CONTENT_URL);\n!defined('LSCWP_CONTENT_FOLDER') && define('LSCWP_CONTENT_FOLDER', str_replace($home_url, '', $WP_CONTENT_URL)); // `wp-content`\n!defined('LSWCP_PLUGIN_URL') && define('LSWCP_PLUGIN_URL', plugin_dir_url(__FILE__)); // Full URL path '//example.com/wp-content/plugins/litespeed-cache/'\n\n/**\n * Static cache files consts\n * @since  3.0\n */\n!defined('LITESPEED_STATIC_URL') && define('LITESPEED_STATIC_URL', $WP_CONTENT_URL . '/litespeed'); // Full static cache folder URL '//example.com/wp-content/litespeed'\n!defined('LITESPEED_STATIC_DIR') && define('LITESPEED_STATIC_DIR', LSCWP_CONTENT_DIR . '/litespeed'); // Full static cache folder path '/var/www/html/***/wp-content/litespeed'\n\n!defined('LITESPEED_TIME_OFFSET') && define('LITESPEED_TIME_OFFSET', get_option('gmt_offset') * 60 * 60);\n\n// Placeholder for lazyload img\n!defined('LITESPEED_PLACEHOLDER') && define('LITESPEED_PLACEHOLDER', 'data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=');\n\n// Auto register LiteSpeed classes\nrequire_once LSCWP_DIR . 'autoload.php';\n\n// Define CLI\nif ((defined('WP_CLI') && WP_CLI) || PHP_SAPI == 'cli') {\n\t!defined('LITESPEED_CLI') &&  define('LITESPEED_CLI', true);\n\n\t// Register CLI cmd\n\tif (method_exists('WP_CLI', 'add_command')) {\n\t\tWP_CLI::add_command('litespeed-option', 'LiteSpeed\\CLI\\Option');\n\t\tWP_CLI::add_command('litespeed-purge', 'LiteSpeed\\CLI\\Purge');\n\t\tWP_CLI::add_command('litespeed-online', 'LiteSpeed\\CLI\\Online');\n\t\tWP_CLI::add_command('litespeed-image', 'LiteSpeed\\CLI\\Image');\n\t\tWP_CLI::add_command('litespeed-debug', 'LiteSpeed\\CLI\\Debug');\n\t\tWP_CLI::add_command('litespeed-presets', 'LiteSpeed\\CLI\\Presets');\n\t}\n}\n\n// Server type\nif (!defined('LITESPEED_SERVER_TYPE')) {\n\tif (isset($_SERVER['HTTP_X_LSCACHE']) && $_SERVER['HTTP_X_LSCACHE']) {\n\t\tdefine('LITESPEED_SERVER_TYPE', 'LITESPEED_SERVER_ADC');\n\t} elseif (isset($_SERVER['LSWS_EDITION']) && strpos($_SERVER['LSWS_EDITION'], 'Openlitespeed') === 0) {\n\t\tdefine('LITESPEED_SERVER_TYPE', 'LITESPEED_SERVER_OLS');\n\t} elseif (isset($_SERVER['SERVER_SOFTWARE']) && $_SERVER['SERVER_SOFTWARE'] == 'LiteSpeed') {\n\t\tdefine('LITESPEED_SERVER_TYPE', 'LITESPEED_SERVER_ENT');\n\t} else {\n\t\tdefine('LITESPEED_SERVER_TYPE', 'NONE');\n\t}\n}\n\n// Checks if caching is allowed via server variable\nif (!empty($_SERVER['X-LSCACHE']) ||  LITESPEED_SERVER_TYPE === 'LITESPEED_SERVER_ADC' || defined('LITESPEED_CLI')) {\n\t!defined('LITESPEED_ALLOWED') &&  define('LITESPEED_ALLOWED', true);\n}\n\n// ESI const defination\nif (!defined('LSWCP_ESI_SUPPORT')) {\n\tdefine('LSWCP_ESI_SUPPORT', LITESPEED_SERVER_TYPE !== 'LITESPEED_SERVER_OLS' ? true : false);\n}\n\nif (!defined('LSWCP_TAG_PREFIX')) {\n\tdefine('LSWCP_TAG_PREFIX', substr(md5(LSCWP_DIR), -3));\n}\n\n/**\n * Handle exception\n */\nif (!function_exists('litespeed_exception_handler')) {\n\tfunction litespeed_exception_handler($errno, $errstr, $errfile, $errline)\n\t{\n\t\tthrow new \\ErrorException($errstr, 0, $errno, $errfile, $errline);\n\t}\n}\n\n/**\n * Overwride the WP nonce funcs outside of LiteSpeed namespace\n * @since  3.0\n */\nif (!function_exists('litespeed_define_nonce_func')) {\n\tfunction litespeed_define_nonce_func()\n\t{\n\t\t/**\n\t\t * If the nonce is in none_actions filter, convert it to ESI\n\t\t */\n\t\tfunction wp_create_nonce($action = -1)\n\t\t{\n\t\t\tif (!defined('LITESPEED_DISABLE_ALL')) {\n\t\t\t\t$control = \\LiteSpeed\\ESI::cls()->is_nonce_action($action);\n\t\t\t\tif ($control !== null) {\n\t\t\t\t\t$params = array(\n\t\t\t\t\t\t'action'\t=> $action,\n\t\t\t\t\t);\n\t\t\t\t\treturn \\LiteSpeed\\ESI::cls()->sub_esi_block('nonce', 'wp_create_nonce ' . $action, $params, $control, true, true, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn wp_create_nonce_litespeed_esi($action);\n\t\t}\n\n\t\t/**\n\t\t * Ori WP wp_create_nonce\n\t\t */\n\t\tfunction wp_create_nonce_litespeed_esi($action = -1)\n\t\t{\n\t\t\t$uid  = get_current_user_id();\n\t\t\tif (!$uid) {\n\t\t\t\t/** This filter is documented in wp-includes/pluggable.php */\n\t\t\t\t$uid = apply_filters('nonce_user_logged_out', $uid, $action);\n\t\t\t}\n\n\t\t\t$token = wp_get_session_token();\n\t\t\t$i     = wp_nonce_tick();\n\n\t\t\treturn substr(wp_hash($i . '|' . $action . '|' . $uid . '|' . $token, 'nonce'), -12, 10);\n\t\t}\n\t}\n}\n\n/**\n * Begins execution of the plugin.\n *\n * @since    1.0.0\n */\nif (!function_exists('run_litespeed_cache')) {\n\tfunction run_litespeed_cache()\n\t{\n\t\t//Check minimum PHP requirements, which is 5.3 at the moment.\n\t\tif (version_compare(PHP_VERSION, '5.3.0', '<')) {\n\t\t\treturn;\n\t\t}\n\n\t\t//Check minimum WP requirements, which is 4.0 at the moment.\n\t\tif (version_compare($GLOBALS['wp_version'], '4.0', '<')) {\n\t\t\treturn;\n\t\t}\n\n\t\t\\LiteSpeed\\Core::cls();\n\t}\n\n\trun_litespeed_cache();\n}\n", "=== LiteSpeed Cache ===\nContributors: LiteSpeedTech\nTags: caching, optimize, performance, pagespeed, core web vitals, seo, speed, image optimize, compress, object cache, redis, memcached, database cleaner\nRequires at least: 4.0\nTested up to: 6.3\nStable tag: 5.6\nLicense: GPLv3\nLicense URI: http://www.gnu.org/licenses/gpl.html\n\nAll-in-one unbeatable acceleration & PageSpeed improvement: caching, image/CSS/JS optimization...\n\n== Description ==\n\nLiteSpeed Cache for WordPress (LSCWP) is an all-in-one site acceleration plugin, featuring an exclusive server-level cache and a collection of optimization features.\n\nLSCWP supports WordPress Multisite and is compatible with most popular plugins, including WooCommerce, bbPress, and Yoast SEO.\n\nLiteSpeed Cache for WordPress is compatible with ClassicPress.\n\n== Requirements ==\n**General Features** may be used by anyone with any web server (LiteSpeed, Apache, NGINX, etc.).\n\n**LiteSpeed Exclusive Features** require one of the following: OpenLiteSpeed, commercial LiteSpeed products, LiteSpeed-powered hosting, or QUIC.cloud CDN. [Why?](https://docs.litespeedtech.com/lscache/lscwp/faq/#why-do-the-cache-features-require-a-litespeed-server)\n\n== Plugin Features ==\n\n= General Features =\n\n* Free QUIC.cloud CDN Cache\n* Object Cache (Memcached/LSMCD/Redis) Support<sup>+</sup>\n* Image Optimization (Lossless/Lossy)\n* Minify CSS, JavaScript, and HTML\n* Minify inline & external CSS/JS\n* Combine CSS/JS\n* Automatically generate Critical CSS\n* Lazy-load images/iframes\n* Responsive Image Placeholders\n* Multiple CDN Support<sup>+</sup>\n* Load CSS Asynchronously\n* Defer/delay JS loading\n* Browser Cache Support<sup>+</sup>\n* Database Cleaner and Optimizer\n* PageSpeed score (including Core Web Vitals) optimization\n* OPcode Cache Support<sup>+</sup>\n* HTTP/2 Push for CSS/JS (on web servers that support it)\n* DNS Prefetch\n* Cloudflare API\n* Single Site and Multisite (Network) support\n* Import/Export settings\n* Attractive, easy-to-understand interface\n* WebP image format support\n* Heartbeat control\n\n<sup>+</sup> This service is not provided by the LSCache plugin, nor is it guaranteed to be installed by your service provider. However, the plugin is compatible with the service if it is in use on your site.\n\n= LiteSpeed Exclusive Features =\n\n* Automatic page caching to greatly improve site performance\n* Automatic purge of related pages based on certain events\n* Private cache for logged-in users\n* Caching of WordPress REST API calls\n* Separate caching of desktop and mobile views\n* Ability to schedule purge for specified URLs\n* WooCommerce and bbPress support\n* [WordPress CLI](https://docs.litespeedtech.com/lscache/lscwp/cli/) commands\n* API system for easy cache integration\n* Exclude from cache by URI, Category, Tag, Cookie, User Agent\n* Smart preload crawler with support for SEO-friendly sitemap\n* Multiple crawlers for cache varies\n* HTTP/2 support\n* [HTTP/3 & QUIC](https://www.litespeedtech.com/http3-faq) support\n* ESI (Edge Side Includes) support<sup>*</sup>\n* Widgets and Shortcodes as ESI blocks<sup>*</sup> (requires Classic Widgets plugin for WP 5.8+)\n\n<sup>*</sup> Feature not available in OpenLiteSpeed\n\n== Screenshots ==\n\n1. Plugin Benchmarks\n2. Admin - Dashboard\n3. Admin - Image Optimization\n4. Admin - Crawler\n5. Admin Settings - Cache\n6. Admin Settings - Page Optimization\n7. Admin Settings - CDN\n8. Admin Settings - DB Optimizer\n9. Admin Settings - Toolbox\n10. Cache Miss Example\n11. Cache Hit Example\n\n== LSCWP Resources ==\n* [Join our Slack community](https://litespeedtech.com/slack) to connect with other LiteSpeed users.\n* [Ask a question on our support forum](https://wordpress.org/support/plugin/litespeed-cache/).\n* [View detailed documentation](https://docs.litespeedtech.com/lscache/lscwp/overview/).\n* [Read WordPress Wednesday tutorials on our blog](https://blog.litespeedtech.com/tag/wordpress-wednesday/).\n* [Help translate LSCWP](https://translate.wordpress.org/projects/wp-plugins/litespeed-cache/).\n* [LSCWP GitHub repo](https://github.com/litespeedtech/lscache_wp).\n\n== Installation ==\n\n[View detailed documentation](https://docs.litespeedtech.com/lscache/lscwp/installation/).\n\n= For Optimization Without a LiteSpeed Web Server =\n1. Install the LiteSpeed Cache for WordPress plugin and activate it.\n1. From the WordPress Dashboard, navigate to **LiteSpeed Cache > Page Optimization**. Enable the available optimization features in the various tabs.\n\n= For Caching and Optimization With a LiteSpeed Web Server =\n1. Install [LiteSpeed Web Server Enterprise](https://www.litespeedtech.com/products/litespeed-web-server) with LSCache Module, [LiteSpeed Web ADC](https://www.litespeedtech.com/products/litespeed-web-adc), or [OpenLiteSpeed](https://www.litespeedtech.com/open-source/openlitespeed) with cache module (Free). Or sign up for [QUIC.cloud CDN](https://quic.cloud).\n1. Install the LiteSpeed Cache for WordPress plugin and activate it.\n1. From the WordPress Dashboard, navigate to **LiteSpeed Cache > Cache**, make sure the option **Enable LiteSpeed Cache** is set to `ON`.\n1. Enable any desired caching and optimization features in the various tabs.\n\n= Notes for LiteSpeed Web Server Enterprise =\n\n* Make sure that your license includes the LSCache module. A [2-CPU trial license with LSCache module](https://www.litespeedtech.com/products/litespeed-web-server/download/get-a-trial-license \"trial license\") is available for free for 15 days.\n* The server must be configured to have caching enabled. If you are the server admin, [click here](https://docs.litespeedtech.com/lscache/start/#configure-cache-root-and-cache-policy) for instructions. Otherwise, please request that the server admin configure the cache root for the server.\n\n= Notes for OpenLiteSpeed =\n\n* This integration utilizes OpenLiteSpeed's cache module.\n* If it is a fresh OLS installation, the easiest way to integrate is to use [ols1clk](https://openlitespeed.org/kb/1-click-install/). If using an existing WordPress installation, use the `--wordpresspath` parameter.\n* If OLS and WordPress are both already installed, please follow the instructions in [How To Set Up LSCache For WordPress](https://openlitespeed.org/kb/how-to-setup-lscache-for-wordpress/).\n\n== Third Party Compatibility ==\n\nThe vast majority of plugins and themes are compatible with LSCache. [Our API](https://docs.litespeedtech.com/lscache/lscwp/api/) is available for those that are not. Use the API to customize smart purging, customize cache rules, create cache varies, and make WP nonce cacheable, among other things.\n\n== Privacy ==\n\nThis plugin includes some suggested text that you can add to your site's Privacy Policy via the Guide in the WordPress Privacy settings.\n\n**For your own information:** LiteSpeed Cache for WordPress potentially stores a duplicate copy of every web page on display on your site. The pages are stored locally on the system where LiteSpeed server software is installed and are not transferred to or accessed by LiteSpeed employees in any way, except as necessary in providing routine technical support if you request it. All cache files are temporary, and may easily be purged before their natural expiration, if necessary, via a Purge All command. It is up to individual site administrators to come up with their own cache expiration rules.\n\nIn addition to caching, our WordPress plugin has online features provided by QUIC.cloud for Image Optimization, CSS Optimization and Low Quality Image Placeholder services. When one of those optimizations are requested, data is transmitted to a remote QUIC.cloud server, processed, and then transmitted back for use on your site. Now if using the QUIC.cloud CDN it uses LSCache technologies to access your site then host your site to others globally and also your data is not transferred to or accessed by QUIC.cloud employees in any way, except as necessary in providing maintenance or technical support. QUIC.cloud keeps copies of that data for up to 7 days and then permanently deletes them. Similarly, the WordPress plugin has a Reporting feature whereby a site owner can transmit an environment report to LiteSpeed so that we may better provide technical support. None of these features collects any visitor data. Only server and site data are involved.\n\nPlease see the [QUIC.cloud Privacy Policy](https://quic.cloud/privacy-policy/) for our complete Privacy/GDPR statement.\n\n== Frequently Asked Questions ==\n\n= Why do the cache features require LiteSpeed Server? =\nThis plugin communicates with your LiteSpeed Web Server and its built-in page cache (LSCache) to deliver superior performance to your WordPress site. The plugin\u2019s cache features indicate to the server that a page is cacheable and for how long, or they invalidate particular cached pages using tags.\n\nLSCache is a server-level cache, so it's faster than PHP-level caches. [Compare with other PHP-based caches](https://www.litespeedtech.com/benchmarks/wordpress).\n\nA page cache allows the server to bypass PHP and database queries altogether. LSCache, in particular, because of its close relationship with the server, can remember things about the cache entries that other plugins cannot, and it can analyze dependencies. It can utilize tags to manage the smart purging of the cache, and it can use vary cookies to serve multiple versions of cached content based on things like mobile vs. desktop, geographic location, and currencies. [See our Caching 101 blog series](https://blog.litespeedtech.com/tag/caching-101/).\n\nIf all of that sounds complicated, no need to worry. LSCWP works right out of the box with default settings that are appropriate for most sites. [See the Beginner's Guide](https://docs.litespeedtech.com/lscache/lscwp/beginner/).\n\n**Don't have a LiteSpeed server?** Try our QUIC.cloud CDN service. It allows sites on *any server* (NGINX and Apache included) to experience the power of LiteSpeed caching! [Click here](https://quic.cloud) to learn more or to give QUIC.cloud a try.\n\n= What about the optimization features of LSCache? =\n\nLSCWP includes additional optimization features, such as Database Optimization, Minification and Combination of CSS and JS files, HTTP/2 Push, CDN Support, Browser Cache, Object Cache, Lazy Load for Images, and Image Optimization! These features do not require the use of a LiteSpeed web server.\n\n= Is the LiteSpeed Cache Plugin for WordPress free? =\n\nYes, LSCWP will always be free and open source. That said, a LiteSpeed server is required for the cache features, and there are fees associated with some LiteSpeed server editions. Some of the premium online services provided through QUIC.cloud (CDN Service, Image Optimization, Critical CSS, Low-Quality Image Placeholder, etc.) require payment at certain usage levels. You can learn more about what these services cost, and what levels of service are free, on [your QUIC.cloud dashboard](https://my.quic.cloud).\n\n= What server software is required for this plugin? =\n\nA LiteSpeed solution is required in order to use the **LiteSpeed Exclusive** features of this plugin. Any one of the following will work:\n\n1. LiteSpeed Web Server Enterprise with LSCache Module (v5.0.10+)\n2. OpenLiteSpeed (v1.4.17+)\n3. LiteSpeed WebADC (v2.0+)\n4. QUIC.cloud CDN\n\nThe **General Features** may be used with *any* web server. LiteSpeed is not required.\n\n= Does this plugin work in a clustered environment? =\n\nThe cache entries are stored at the LiteSpeed server level. The simplest solution is to use LiteSpeed WebADC, as the cache entries will be stored at that level.\n\nIf using another load balancer, the cache entries will only be stored at the backend nodes, not at the load balancer.\n\nThe purges will also not be synchronized across the nodes, so this is not recommended.\n\nIf a customized solution is required, please contact LiteSpeed Technologies at `info@litespeedtech.com`\n\nNOTICE: The rewrite rules created by this plugin must be copied to the Load Balancer.\n\n= Where are the cached files stored? =\n\nThe actual cached pages are stored and managed by LiteSpeed Servers.\n\nNothing is stored within the WordPress file structure.\n\n= Does LiteSpeed Cache for WordPress work with OpenLiteSpeed? =\n\nYes it can work well with OpenLiteSpeed, although some features may not be supported. See **Plugin Features** above for details. Any setting changes that require modifying the `.htaccess` file will require a server restart.\n\n= Is WooCommerce supported? =\n\nIn short, yes. However, for some WooCommerce themes, the cart may not be updated correctly. Please [visit our blog](https://blog.litespeedtech.com/2017/05/31/wpw-fixing-lscachewoocommerce-conflicts/) for a quick tutorial on how to detect this problem and fix it if necessary.\n\n= Are my images optimized? =\n\nImages are not optimized automatically unless you set **LiteSpeed Cache > Image Optimization > Image Optimization Settings > Auto Request Cron** to `ON`. You may also optimize your images manually. [Learn more](https://docs.litespeedtech.com/lscache/lscwp/imageopt/).\n\n= How do I make a WP nonce cacheable in my third-party plugin? =\n\nOur API includes a function that uses ESI to \"punch a hole\" in a cached page for a nonce. This allows the nonce to be cached separately, regardless of the TTL of the page it is on. Learn more in [the API documentation](https://docs.litespeedtech.com/lscache/lscwp/api/#esi). We also welcome contributions to our predefined list of known third party plugin nonces that users can optionally include via [the plugin's ESI settings](https://docs.litespeedtech.com/lscache/lscwp/cache/#esi-nonce).\n\n= How do I enable the crawler? =\n\nThe crawler is disabled by default, and must be enabled by the server admin first.\n\nOnce the crawler is enabled on the server side, navigate to **LiteSpeed Cache > Crawler > General Settings** and set **Crawler** to `ON`.\n\nFor more detailed information about crawler setup, please see [the Crawler documentation](https://docs.litespeedtech.com/lscache/lscwp/crawler/).\n\n= What are the known compatible plugins and themes? =\n\n* [WPML](https://wpml.org/)\n* [DoLogin Security](https://wordpress.org/plugins/dologin/)\n* [bbPress](https://wordpress.org/plugins/bbpress/)\n* [WooCommerce](https://wordpress.org/plugins/woocommerce/)\n* [Contact Form 7](https://wordpress.org/plugins/contact-form-7/)\n* [All in One SEO](https://wordpress.org/plugins/all-in-one-seo-pack/)\n* [Google XML Sitemaps](https://wordpress.org/plugins/google-sitemap-generator/)\n* [Yoast SEO](https://wordpress.org/plugins/wordpress-seo/)\n* [Wordfence Security](https://wordpress.org/plugins/wordfence/)\n* [NextGen Gallery](https://wordpress.org/plugins/nextgen-gallery/)\n* [ShortPixel](https://shortpixel.com/h/af/CXNO4OI28044/)\n* Aelia CurrencySwitcher\n* [Fast Velocity Minify](https://wordpress.org/plugins/fast-velocity-minify/) - Thanks Raul Peixoto!\n* Autoptimize\n* [Better WP Minify](https://wordpress.org/plugins/bwp-minify/)\n* [WP Touch](https://wordpress.org/plugins/wptouch/)\n* [Theme My Login](https://wordpress.org/plugins/theme-my-login/)\n* [WPLister](https://www.wplab.com/plugins/wp-lister/)\n* [WP-PostRatings](https://wordpress.org/plugins/wp-postratings/)\n* [Avada 5.1 RC1+](https://avada.theme-fusion.com/)\n* [Elegant Themes Divi 3.0.67+](https://www.elegantthemes.com/gallery/divi/)\n* [Elegant Divi Builder](https://www.elegantthemes.com/plugins/divi-builder/)\n* [Caldera Forms](https://wordpress.org/plugins/caldera-forms/) 1.5.6.2+\n* Login With Ajax\n* [Ninja Forms](https://wordpress.org/plugins/ninja-forms/)\n* [Post Types Order 1.9.3.6+](https://wordpress.org/plugins/post-types-order/)\n* [BoomBox \u2014 Viral Magazine WordPress Theme](https://themeforest.net/item/boombox-viral-buzz-wordpress-theme/16596434?ref=PX-lab)\n* FacetWP (LSWS 5.3.6+)\n* Beaver Builder\n* WpDiscuz\n* WP-Stateless\n* Elementor\n* WS Form\n* WP Statistics\n\nThe vast majority of plugins and themes are compatible with LiteSpeed Cache. The most up-to-date compatibility information can be found [in our documentation](https://docs.litespeedtech.com/lscache/lscwp/thirdparty/)\n\n== Changelog ==\n\n= 5.6.1 - Oct 2023 =\n* \ud83c\udf31**Page Optimize** New option available: Preconnect. (xguiboy/Mukesh Patel)\n* **Cloud** Force syncing the configuration to QUIC.cloud if CDN is reenabled.\n* **Cloud** Force syncing the configuration to QUIC.cloud if domain key is readded.\n* \ud83d\udc1e**ESI** Patched a possible vulnerability issue. (Istv\u00e1n M\u00e1rton@Wordfence #841011)\n* \ud83d\udc1e**Image Optimize** Bypass unnecessary image processing when images were only partially optimized. (Ruikai)\n* **CDN** Auto disabled CDN if CDN URL is invalid. (Ruikai)\n* **API** A third filter `litespeed_media_add_missing_sizes` allows bypassing Media's \"add missing sizes\" option (for Guest Optimization and otherwise). (PR #564)\n* **Guest** Fixed soft 404 and robots.txt report for guest.vary.php.\n* **Vary** Enabled `litespeed_vary_cookies` for LSWS enterprise.\n* **Vary** OLS password protected page removed the legacy beginning comma.\n\n= 5.6 - Aug 1 2023 =\n* \ud83c\udf31**Page Optimize** New JS Delay Includes option. (Mitchell Krog/Gerard Reches/Ignacy Ho\u0142oga)\n* **Crawler** Sitemap can use search for URL now.\n* **GUI** Restrict the scope of balloon CSS rules to avoid conflicts. (#567)\n* **Object Cache** Detect Memcached in more situations. (#568)\n* **API** Support `litespeed_purged_front` hook. (Umberto Fiorelli)\n\n= 5.5.1 - Jul 19 2023 =\n* \ud83d\udc1e**Image Optimization** Fixed a bug where WebP replacements couldn't be pulled without optimizing the original images.\n* \ud83d\udc1e**Image Optimization** Invalid images will now be removed when sending requests to the server. (#138993)\n* **Cloud** Added support for error codes `unpulled_images` and `blocklisted`. (Tynan)\n\n= 5.5 - Jun 20 2023 =\n* \ud83c\udf31**Crawler** Can now use multiple sitemaps. (Tobolo/Tim Nolte)\n* \ud83c\udf31**Crawler** Now runs asynchronously when manually invoked.\n* \ud83c\udf31**Crawler** Now runs asynchronously when invoked from cron.\n* \ud83d\udc1e**Crawler** Fixed the realtime status bug when crawling.\n* **Crawler** Summary page now displays server load. (Ruikai)\n* \ud83d\udc1e**Page Optimize** Fixed an issue where UCSS could not be generated for error pages. (james58899) #556\n* \ud83c\udf31**Image Optimize** Now pulls images asynchronously.\n* **Image Optimize** Now prevents concurrent requests via a locking mechanism.\n* **Image Optimize** The process can now bypass invalid image records and continue.\n* \ud83d\udc1e**Image Optimize** Fixed an issue where images ready for optimization might have to wait for new images to be added before sending the request.\n* **Cloud** Replaced dashboard links with login/link to my.quic.cloud actions.\n* **GUI** Added indicators to show when certain options are passively enabled by Guest Mode.\n* **Htaccess** Added a noabort rule to support asynchronous crawling.\n* **Htaccess** The \"Do Not Cache User Agents\" option is now case-insensitive. (Ellen Dabo)\n* **General** The \"Server IP\" option now allows IPv4 format only. (Ruikai)\n* **Misc** Every page's closing HTML comments now displays UCSS/CCSS status.\n* **Object** Fixed a warning for null get_post_type_object.\n* **Object** Object_Cache::delete now always returns a boolean value.\n* **Cache** Fixed advanced-cache.php file warnings for WordPress versions less than 5.3.\n* **Debug** Added debug logging to record the plugin's total processing time.\n* **API** HTML minification can now be bypassed via the litespeed_html_min filter.\n\n= 5.4 - Apr 19 2023 =\n* **Image Optimize** Refactored DB storage for this feature.\n* **Image Optimize** Reduced DB table size.\n* **Image Optimize** Existing `img_optm` DB tables will have their data gradually transitioned to the new storage format with this update. Once an `img_optm` table is empty, it won't be used anymore.\n* **Page Optimize** Enabled WebP support for Googlebot User Agent.\n\n= 5.3.3 - Feb 22 2023 =\n* **Page Optimize** Excluded Jetpack stats JS.\n* **DB Optimize** Fixed DB Optm SQL for revision postmeta.\n* **Cache** Fixed an undefined array key warning.\n* **Purge** Prevented undefined array key warning when widgets are disabled.\n* **Object** Fixed dynamic property deprecation warnings.\n* **Admin** Safely redirect to homepage if referer is unknown.\n* **Activation** Check that item slug exists first.\n* **Cache** Prevented cache header to send globally if header part already closed.\n* **CSS** Improved string handling for CSS minifier.\n* **Debug** Fixed undefined array key warnings.\n* **Misc** Fixed implicit conversion in random string generation function `Str::rrand`.\n\n= 5.3.2 - Jan 10 2023 =\n* **Object** Fixed object cache lib incr, decr functions (thanks bdrbros/DANIEL) #516\n* **Database Optimize** Database optimizer now handles postmeta when cleaning revisions #515\n* **Cache** Made nocache the default for 4xx/5xx response codes.\n* **Cache** Default cache TTL settings removed for 403 response code, changed to 10 mins for 500 response code.\n* **GUI** Added a description for the redetect nodes function.\n* **GUI** Added a description for the refresh button sync function.\n\n= 5.3.1 - Dec 12 2022 =\n* **CLI** Presets feature is now usable from the CLI. (xLukii)\n* **CLI** Added 'import_remote' for litespeed-option to enable importing options from URLs. (xLukii)\n* **Cache** Added LiteSpeed headers to site health check for full page cache.\n* **Crawler* Fixed unauthorized crawler toggle operation. (#CVE-2022-46800)\n* **UCSS** Fixed a bug where items weren't added back to the UCSS queue after purging.\n* **Page Optimize** Fixed a bug where generated CSS would return 404 after upgrading via CLI.\n* **3rd** Fixed a bug where a WooCommerce session doesn't exist when checking cart, notices (Jason Levy/Gilles)\n* **GUI** Made LiteSpeed admin notice icon grayscale to avoid distraction. (martinsauter)\n* **GUI** Fixed RTL style for notification icon.\n* **API** Added a new hook `litespeed_optm_uri_exc` to exclude URI from page optimization.\n* **API** Excluded `.well-known` path from page optimization.\n\n= 5.3 - Oct 31 2022 =\n* \ud83c\udf31**Presets** New `Presets` feature and menu item.\n* \ud83c\udf31**UCSS** New option `UCSS File Excludes and Inline` to increase page score. (Ankit)\n* **UCSS** When UCSS is purged, automatically append URL to UCSS generation queue. (Ankit)\n* **Page Optimize** Removed a redundant `defer` attribute from Lazy Load image library usage. (#928019)\n* **Image Optimize** Dropped `Create WebP Versions` setting. Will automatically enable when `Image WebP Replacement` is activated.\n* **Cloud** Fixed a bug where internal updates were delayed for API keys.\n* **Cloud** Improved auto alias feature by waiting for second request from alias domain validation before removing a pending alias.\n* **Purge** Automatically Purge All when plugin auto update is done.\n* **Purge** Fixed a potential PHP8 error that occurred when removing unused widgets. (acsnaterse)\n* **Cache** Fixed an infinite 301 redirection caused by UTM-encoded link.\n* **CLI** Added syntax examples for values that include line breaks (xLukii)\n* **CLI** Purge requests will now be included with the original request to avoid potential CSS/JS 404 issues.\n* **ESI** Check all user roles for cache vary and page optimization excludes.\n* **GUI** Added a LiteSpeed icon to admin message banners to indicate the banners are from our plugin. (Michael D)\n* **Crawler** Fixed a cache-miss issue that occurred when Guest Mode was ON and WebP Replacement was OFF.\n* **3rd** Remove WooCommerce private cache.\n* **3rd** Removed LiteSpeed metabox from ACF field group edit page. (keepmovingdk)\n\n= 5.2.1 - Sep 7 2022 =\n* \ud83d\udc1e**Core** Fixed a fatal error that occurred when uninstalling. (#894556 Hostinger)\n* **Dash** Show partner info on the dashboard for partner-tier QC accounts.\n* **UCSS** Auto-purge UCSS on post update. (Ankit)\n* \ud83d\udd78\ufe0f**Crawler** Respect the `LITESPEED_CRAWLER_DISABLE_BLOCKLIST` constant for unexpected results too. (Abe)\n\n= 5.2 - Aug 17 2022 =\n* \ud83c\udf31**UCSS** Added UCSS message queue to improve service quality and reliability\n* \ud83d\udc1e**VPI** Fixed conflict w/ image lazyload; used HTML before image lazyload to avoid invalid `data:base64` results.\n* **VPI** Changed VPI Cron default setting to OFF.\n* **VPI** Automatically resend requests when VPI result contains invalid `data:` image value.\n* **Conf** Fixed an issue with URI Excludes, where paths using both ^ and $ were not correctly excluded (Eric/Abe)\n* **Conf** Auto corrected `WP_CONTENT_URL` protocol if it was explicitly set to `http://`.\n* **Cloud** No longer sync the configuration to QUIC.cloud if configuration is unchanged.\n* **Cloud** Appended home_url value into synced configuration data for wp-content folder path correction.\n* \ud83d\udd78\ufe0f**Crawler** Improved compatibility with server `open_basedir` PHP setting limit when detecting load before crawling. (Tom Robak/mmieszalski)\n\n= 5.1 - Aug 1 2022 =\n* \ud83c\udf31**Toolbox** Debug log can now show Purge/Crawler logs as well. (Tynan)\n* **UCSS** Prepared for future message queue.\n* **UCSS** Moved UCSS class to its own file.\n* **3rd** Added 3rd-party support for WC PDF Product Vouchers. (Tynan)\n* **Core** Fixed potential PHP warning when saving summary data. (Sarah Richardson)\n* **Purge** Purge can now clear the summary correctly. (Kevin)\n* **VPI** Added `queue_k` to API notification.\n\n= 5.0.1 - Jul 27 2022 =\n* \ud83d\udc1e**Cloud** Fixed a potential PHP error that could occur with the cloud service summary. (Bruno Cantuaria)\n* **3rd** Added Autoptimize back to compatibility list.\n\n= 5.0.0.1 - Jul 26 2022 =\n* \ud83d\udd25\ud83d\udc1e**Cloud** Fixed an issue with the cloud request timestamp update which causes a usage sync failure. (great thanks to Kevin)\n\n= 5.0 - Jul 25 2022 =\n* \ud83c\udf31**VPI** Added Viewport Images feature to LiteSpeed Options metabox on Post Edit page.\n* \ud83c\udf31**CDN** Added Auto CDN Setup feature for simple QUIC.cloud CDN setup. (Kevin)\n* \ud83c\udf31**Page Optimize** Automatically cache remote CSS/JS files when fetching for optimization (Lauren)\n* \ud83c\udf31**Cache** Added LiteSpeed Options for page-level cache control on Post Edit page. (denisgomesfranco)\n* \ud83c\udf31**Cloud** Auto Alias feature.\n* \ud83c\udf31**Debug** Added `Debug String Excludes` option. (Hanna)\n* \ud83c\udf31**UCSS** Added `Purge this page - UCSS` option to Admin Bar dropdown menu. (Ankit)\n* \ud83c\udf31**Guest** Added `litespeed_guest_off=1` URL query string parameter to bypass Guest Mode. (cbdfactum)\n* \ud83d\udc1e**Page Optimize** Fixed an issue where CSS anchors could be wrongly converted to a full path when minifying. (Tynan)\n* **Page Optimize** Bypass CCSS/UCSS generation when a self-crawled CSS resource returns a 404 code. (Abe)\n* **Object** Allow `LSCWP_OBJECT_CACHE` predefined to turn off Object Cache. (knutsp)\n* **Data** Fixed an issue where empty version tags in the database repeatedly toggled the upgrade banner and reset settings to default.\n* **Purge** Fixed an issue where the site's index page could be purged upon deletion of an unviewable post. (Kevin)\n* **Toolbox** Added `View site before optimization` button under `Debug` tab. (Ryan D)\n* **Admin** Switch to using the `DONOTCACHEPAGE` constant to indicated WP-Admin pages are not cacheable.\n* **Admin** Moved no-cache header to very beginning to avoid caching unexpected exits.\n* **Cloud** Added message queue service for VPI. (Abe)\n* **Cloud** Bypassed 503 error nodes from node redetection process. (Abe)\n* **Cloud** Fixed a failure to detect `out_of_quota`. (Lauren)\n* **Cloud** Added ability to display dismissable banners generated by QUIC.cloud.\n* \ud83d\udd78\ufe0f**Crawler** Added realtime load detection before crawl.\n* \ud83d\udd78\ufe0f**Crawler** Adjusted crawler behavior for Divi pages to allow for Divi's CCSS generation process. (miketemby)\n* \ud83d\udd78\ufe0f**API** PHP constant `LITESPEED_CRAWLER_DISABLE_BLOCKLIST` and filter `litespeed_crawler_disable_blocklist` to disable blocklist. (Tobolo)\n* **CDN** Automatically add a trailing slash to `CDN URL` and `Original URLs` if user didn't provide one. (Lucas)\n* **Cache** When a URL redirects to a URL with a query string, consider these as different for caching purposes. (Shivam)\n* **Media** Added ability to disable lazyload from the LiteSpeed Options metabox on Post Edit page.\n* **Media** Added new default values to `WebP Attribute to Replace` setting for WPBakery and Slider Revolution. (JibsouX)\n* **Image Optimize** Dropped redundant `Page Speed` user agent when serving WebP images. (serpentdriver)\n* **GUI** Fixed an issue where manually dismissable admin messages were instead being treated as one-time messages. (Tynan Beatty)\n* **GUI** Fixed an issue where subsequent admin alerts would overwrite existing alerts in the queue. (Kevin/Tynan)\n* **GUI** Updated time offset in log. (Ruikai #PR444 #PR445)\n* **GUI** Added `litespeed_media_ignore_remote_missing_sizes` API description.\n* **CCSS** Fixed an issue where CCSS was unexpectedly bypassed if `CSS Combine` was OFF and `UCSS Inline` was ON. (Ruikai)\n* **Debug** Added resposne headers to debug log. (Kevin)\n\n= 4.6 - Mar 29 2022 =\n* **Page Optimize** Improved compatibility for JS Delay.\n* \ud83d\udc1e**Page Optimize** Fixed an issue for network subsites that occurred when only CSS/JS Minify are enabled.\n* **Localization** Added query string compatibility for Resource URLs.\n* **Vary** Fixed a potential PHP warning when server variable `REQUEST_METHOD` is not detected.\n* **Cache** Guest Mode now respects Cache Excludes settings.\n* **GUI** Added warning notice when enabling `Localize Resources` feature; each localized JS resource requires thorough testing!\n* **GUI** Fixed a PHP Deprecated warning that occurred with the Mobile Cache User Agent setting on PHP v8.1+. (jrmora)\n* **Conf** Removed Google related scripts from default `Localization Files` value.\n* **Media** WordPress core Lazy Load feature is now automatically disabled when LiteSpeed Lazy Load Images option is enabled. (VR51 #Issue440)\n* \ud83d\udc1e**API** Filter `litespeed_ucss_per_pagetype` for UCSS now also applies to CSS Combine to avoid UCSS failure. (Ankit)\n* **API** Added a filter `litespeed_media_ignore_remote_missing_sizes` to disable auto detection for remote images that are missing dimensions. (Lucas)\n\n= 4.5.0.1 - Feb 24 2022 =\n* \ud83d\udd25\ud83d\udc1e**Media** Fixed an issue where lazy-loaded images would disappear when using custom CSS image loading effects.\n\n= 4.5 - Feb 23 2022 =\n* \ud83c\udf31**Page Optimize** Localization is back.\n* **Guest** Fixed organic traffic issue as different browsers may fail to set `document.referrer`.\n* **Image Optimize** Improved wp_postmeta table compatibility when gathering images. (Thanks to Thomas Stroemme)\n* \ud83d\udc1e**Page Optimize** Fixed a potential CSS/JS 404 issue for existing records that have been marked as expired.\n* **ESI** `LITESPEED_ESI_OFF` now affects `litespeed_esi_url` API filter too.\n* **Guest** Added a check to determine if Guest Mode is blocked by a third-party, and display warning if it is (Ruikai)\n* **Guest** To support WP sites with multiple domains, Guest Mode detection URL no longer uses domain.\n* **Report** Network now shows Toolbox page when having a large number of subsites.\n* **DB Optimize** Reduced default subsites count from 10 to 3 under Network Admin -> DB Optimize page to avoid timeout.\n* **Cloud** Fixed potential `lack_of_token` error when requesting domain key for cases where local summary value was not historically included in the array.\n* **Cloud** Fixed a PHP fatal error that occurred when encountering a frequency issue under CLI. (Dean Taylor #Issue410)\n* **Avatar** Force gravatar cache refresh in browsers and on CDN (rafaucau #PR430)\n* **API** New filter `litespeed_purge_ucss` to purge a single page UCSS. (#376681)\n* **API** New filter `litespeed_ucss_per_pagetype` for UCSS per page type generation. (Ankit)\n* **GUI** Replaced some GUI text and settings with more inclusive language  (kebbet #PR437 #PR435)\n* **3rd** Excluded `WP Statistics` from inline JS optimize. (Ryan D)\n* **3rd** Added API filter `litespeed_3rd_aelia_cookies` for Aelia CurrencySwitcher.\n* **Media** Updated image lazyload library to 17.5.0.\n\n= 4.4.7 - Jan 11 2022 =\n* **Page Optimize** Dropped `Inline Lazy Load Images Library` option. Now will always inline lazyload library. (Ankit)\n* **3rd** Prevented JavaScript files from being appended to Rank Math SEO sitemap.\n* **Purge** Dropped default stale purge when purging a post.\n* **Cloud** Dropped unused API calls.\n* **Cloud** Dropped redundant IP validation in API calls.\n\n= 4.4.6 - Dec 27 2022 =\n* **Guest** Restored `document.referrer` for organic traffic purposes when Guest Mode is enabled. (michelefns)\n* **Image Optimize** Fixed a potential PHP notice when uploading images in WP w/ PHP7.4+. (titsmaker)\n* **ESI** Fixed an issue where ESI settings were not updated on customized widgets(#422 Abe)\n* **3rd** Reverted ESI Adminbar change on Elementor front pages for backward compatibility (#423 Abe)\n* **3rd** Fixed an issue where disabling ESI potential caused a PHP warning when using `Perfmatters`. (Jeffrey Zhang)\n* **Misc** Check whether HTTP_REFERER is set or not before using it in Router class. (#425 Abe)\n\n= 4.4.5 - Dec 1 2021 =\n* **Data** Fixed potential PHP notice when generating CSS/JS optimized files w/ PHP v7.4+. (Sarah Richardson/silencedgd/slr1979)\n* **API** Added `LITESPEED_ESI_OFF` constant to disable ESI, when defined before the WP `init` hook.\n* **API** Added `LSCWP_DEBUG_PATH` constant to specify debug log path. (khanh-nt)\n* \ud83d\udc1e**GUI** Fixed an issue where admin messages were not displayed. (Daniel McD)\n* **CDN** Used WP remote function to communicate w/ Cloudflare per WP guidance.\n* **3rd** Added compatibility for Perfmatters plugin's script manager (#417 Abe)\n* **3rd** Added compatibility for Elementor's Editor button when ESI is on (#418 Abe)\n\n= 4.4.4 - Nov 23 2021 =\n* **Page Optimize** Delay deletion of outdated CSS/JS files for a default of 20 days to avoid 404 errors with cached search engine copies.\n* **Cache** When caching, no longer send a purge request for CSS/JS removal to avoid cache engine conflicts.\n* \ud83d\udc1e**Core** Optimized SQL queries while autoloading if expected options are missing; reduced by 7 and 3 queries on backend and frontend respectively. (#396425 Jackson)\n* **Page Optimize** Fixed a 404 issue that occured when upgrading the plugin manually, with a package upload or through the plugin manager. (Tobolo/Ma\u0142gorzata/Abe)\n* **API** Added `litespeed_ccss_url` and `litespeed_ucss_url` API to manipulate the request URL for CCSS and UCSS.\n* **REST** Fixed a potential warning when detecting cacheable status on REST call. (rafaucau)\n* **OLS** Fixed an issue where the `COOKIEHASH` constant was undefined when used with OpenLiteSpeed as an MU plugin or with network activation.\n* **3rd** Sanitized POST data for nextgengallery.\n* **Cloud** Sanitized GET data when linking to QUIC.cloud. (#591762 WPScan)\n\n= 4.4.3 - Oct 13 2021 =\n* \ud83d\udc1e**Media** Fixed an issue where WebP is served erroneously under Guest Mode on older versions of Safari. (hash73)\n* \ud83d\udc1e**Media** Reverted regex change to fix `Lazy Load Image Parent Class Name Excludes` failure. (thpstock)\n* **Purge** Disabled `Purge Delay` in the optimization process by default.\n* **Conf** Dropped `.htaccess Path Settings` options for security concern. (WP)\n* **Conf** Dropped `CSS HTTP/2 Push`/`JS HTTP/2 Push` options. (Kevin)\n* **Conf** Set `Guest Optimization` default to OFF.\n* **Conf** Set `CCSS Per URL` default to OFF to avoid consuming more quota than intended after upgrade to v4. (n111)\n* **Object** Fixed an issue with Object Cache warnings during upgrade, when Guest Mode is enabled.\n* \u2601\ufe0f**Cloud** Fixed an issue with PHP notices when inquiring about quota usage for a service not currently in use.\n* **GUI** Added GO detail warning. (n111)\n* **GUI** Moved \"quota wil be still in use\" warning from Guest Mode to Guest Optimization section.\n* **API** Added `LITESPEED_CFG_HTACCESS` PHP Constant to specify .htaccess path.\n* **API** Added `litespeed_qs_forbidden` hook to bypass `?LSCWP_CTRL=` query string. (minhduc)\n* **API** Added `litespeed_delay_purge` hook to delay the following Purge header until the next request.\n* **API** Added `litespeed_wpconfig_readonly` hook to disable `WP_CACHE` constant update based on the wp-config.php file. (#633545)\n\n= 4.4.2 - Sep 23 2021 =\n* **Purge** In order to clear pages containing 404 CSS/JS, the purge header will always be sent even in cases where purge must be delayed.\n* \ud83d\udc1e**Purge** Fixed a potential PHP warning caused when generating different optimized filenames.\n* **Cron** Dropped unnecessary HTML response in cron which sometimes resulted in wp-cron report email. (Gilles)\n* **Page Optimize** Purge caused by CSS/JS file deletion will now be silent.\n* **Page Optimize** Fixed an issue where the homepage failed to purge when addressing the 404 CSS/JS issue.\n* **Avatar** Fixed potential localized Avatar folder creation warning. (mattk0220/josebab)\n* **API** Added filter `litespeed_optm_html_after_head` to move all optimized code(UCSS/CCSS/Combined CSS/Combined JS) to be right before the `</head>` tag. (ducpl/Kris Regmi)\n* **Debug** Under debug mode, cache/purge tags will be plaintext.\n\n= 4.4.1 - Sep 16 2021 =\n* \ud83d\udc1e**ESI** Fixed ESI failure on non-cached pages caused by `DONOTCACHEPAGE` constant.\n* \ud83d\udc1e**Page Optimize** Fixed an issue where the minified CSS/JS file failed to update when the file was changed. (ceap80)\n* \ud83d\udc1e**Page Optimize** Fixed an issue where the combined CSS/JS file randomly returned a 404 error when visiting the same URL with different query strings. (Abe)\n* **API** Added `litespeed_const_DONOTCACHEPAGE` hook to control the cache-or-not result of the `DONOTCACHEPAGE` constant.\n\n= 4.4 - Sep 8 2021 =\n* \ud83c\udf31**Crawler** Added the ability to enable or disable specific crawlers. (\u2b50 Contributed by Astrid Wang #PR390)\n* \ud83c\udf31**UCSS** Added `UCSS Inline` option. (Ankit).\n* \ud83c\udf31**UCSS** Added `UCSS URI Excludes` option. (RC Verma).\n* \ud83d\udc1e**Page Optimize** Fixed an issue where combined CSS/JS files would potentially return 404 errors after a Purge All. (Special thanks to Abe & Ruikai)\n* **Page Optimize** Minimized the potential for 404 errors by query string when Purging All.\n* **Page Optimize** Dropped redundant query strings for minified CSS/JS files.\n* **Conf** Ugrade configuration safely to avoid the issue of new functions not being found in old codebase.\n* **Conf** Configuration upgrade process now adds a notification to admin pages and disables configuration save until upgrade is complete. (Lisa)\n* **JS** Fixed an issue where JS Defer caused a `litespeed_var_1_ is not defined` error when enabled w/ ESI options. (Tobolo)\n* \ud83d\udc1e**JS** Fixed an issue where `JS Delay` doesn't work for combined JS when `JS Combine` is enabled. (Special thanks to Joshua & Ankit)\n* **JS** `JS Delay` now will continue loading JS, even if there is an error in the current JS loading process.\n* \ud83d\udc1e**CCSS** If CCSS fails to generate, Load CSS Asynchronously will now be disabled. (Stars #54074166)\n* \ud83d\udc1e**UCSS** If UCSS generation fails the generated error will no longer be served inside the file. (Ryan D)\n* **Log** Updated the Debug log to use less code for prefix.\n* **3rd** Always respect `DONOTCACHEPAGE` constant defination to fix DIVI dynamic css calculation process.\n\n= 4.3 - Aug 16 2021 =\n* **UCSS** Separated UCSS Purge from CCSS Purge. (\u2b50 Contributed by Alice Tang #PR388)\n* \ud83d\udc1e**Cloud** Fixed an issue where CCSS/UCSS quota data failed to update locally.\n* **Cloud** Added server load as a factor when detecting node availability.\n* **Cloud** Improved the speed of checking daily quota and showing the related error message.\n* **Cloud** Added ability to re-detect node availability if the current node is responding w/ a heavy load code.\n* **Cloud** CCSS/UCSS/LQIP queue now exits immediately when quota is depleted.\n* **Cloud** Replaced separate `d/regionnodes` with a single `d/nodes` in the node list API for image optimization.\n* **LQIP** Fixed an issue with LQIP network compatibility. (\u2b50 Contributed by Alice Tang #PR387)\n* **GUEST** JS no longer preloads for Guest Optimization. (Ankit)\n* \ud83d\udc1e**Data** Fixed an issue where deleting the `cssjs` data folder causes a failure in the upgrade process. (Joshua #PR391)\n* **GUI** Fixed a potential dashboard PHP warning when no queue existed. (jrmora)\n* **GUI** Added daily quota on dashboard.\n* **GUI** Added downgrade warning to Toolbox -> Beta Test.\n* **GUI** Tuned `.litespeed-desc` class to full width in CSS.\n* **Conf** `Preserve EXIF/XMP data` now defaults to ON due to copyright concerns. (Tobolo)\n* \ud83d\udc1e**3rd** Fixed a PHP warning when using Google AMP w/ /amp as structure. (thanhstran98)\n\n= 4.2 - Jul 29 2021 =\n* **Cloud** Auto redirect to a new node if the current node is not available anymore.\n* **Cloud** Combined CCSS/UCSS to sub services of Page Optimization.\n* **Cloud** Added a daily quota rate limit to help mitigate the heavy service load at the beginning of the month.\n* **Cloud** Cached the node IP list in order to speed up security check. (Lucas)\n* \ud83d\udc1e**GUEST** Fixed an issue where Guest Mode remained enabled even when the UA setting is empty. (Stars)\n* **GUEST** Guest Mode will no longer cache POST requests.\n* **UCSS** Purging CSS/JS now purges the UCSS queue as well, to avoid failure when generating UCSS.\n* **UCSS** Separated service entry `UCSS` from `CCSS`.\n* **CCSS** Simplified `load_queue/save_queue/build_filepath_prefix` functions. (\u2b50 Contributed by Alice Tang #PR373)\n* **CCSS** If CCSS request fails, details are now saved in the CSS file.\n* **CCSS** Renamed CCSS ID in inline HTML from `litespeed-optm-css-rules` to `litespeed-ccss`. (Alice)\n* **Page Optimize** CCSS/UCSS now supports Cloud queue/notify for asynchronous generation.\n* **Page Optimize** Simplified CCSS/UCSS generation function.\n* **Page Optimize** Added the ability to cancel CCSS/UCSS Cloud requests.\n* **Page Optimize** Unnecessary quesry strings will now be dropped from CSS/JS combined files.\n* **Crawler** Reset position now resets crawler running status too.\n* **REST** Cloud request to REST will now detect whether an IP in in the Cloud IP list for security reasons.\n* **Object** Enhanced Object Cache compatibility for `CONF_FILE` constant detection.\n* **API** Added shorter alias `litespeed_tag` and other similar aliases for Cache Tag API.\n* **API** Renamed `LITESPEED_BYPASS_OPTM` to `LITESPEED_NO_OPTM` for Page Optimization.\n* **Toolbox** Dropped v3.6.4- versions in Beta Test as they will cause a fatal error in downgrade.\n* **GUI** Added shortcut links to each section on the Dashboard.\n* **GUI** Added UCSS whitelist usage description. (wyb)\n* **GUI** Showed the default recommended values for Guest Mode UA/IPs.\n* **3rd** Fixed AMP plugin compatibility. (\u2b50 Contributed by Alice Tang #PR368)\n* **3rd** Bypassed all page optimization including CDN/WebP for AMP pages.\n* **3rd** Improved compatibility with All in One SEO plugin sitemap. (arnaudbroes/flschaves #Issue372)\n* **3rd** Added wsform nonce. (#365 cstrouse)\n* **3rd** Added Easy Digital Download (EDD) & WP Menu Cart nonce. (#PR366 AkramiPro)\n* **3rd** Improved compatibility w/ Restrict Content Pro. (Abe #PR370)\n* **3rd** Improved compatibility w/ Gravity Forms. (Ruikai #371)\n\n= 4.1 - Jun 25 2021 =\n* \ud83c\udf31**UCSS/CCSS/LQIP** Moved queue storage to file system from database wp-options table to lessen the IO load. (#633504)\n* \ud83c\udf31**3rd** Added an option to disable ESI for the WooCommerce Cart. (#358 Anna Feng/Astrid Wang)\n* **ESI** Fixed an ESI nonce issue introduced in v4.0. (Andrew Choi)\n* **Object** Used new `.litespeed_conf.dat` instead of `.object-cache.ini` for object cache configuration storage.\n* **Conf** Now updating related files after plugin upgrade and not just after activation.\n* \ud83c\udf31**Guest** Added a Guest Mode JS Excludes option. (Ankit/Mamac/Rcverma)\n* **Guest** Guest Mode now uses a lightweight script to update guest vary for reduced server load.\n* **Guest** Guest Mode now adds missing image dimensions.\n* **Guest** Guest vary will no longer update if there's already a vary in place to address the infinite loop caused by CloudFlare's incorrect cache control setting for PHP.\n* **Guest** Guest vary update request will no longer be sent if `lscache_vary` is already set.\n* **Guest** Added a Configurable Guest Mode UA/IP under the Tuning tab in the General menu.\n* **Guest** Guest Mode now allows cron to be hooked, even when UCSS/CCSS options are off. (#338437 Stars)\n* **Guest** Simplified the vary generation process under Guest Mode.\n* **Guest** Added a Guest Mode HTML comment for easier debugging. (Ruikai)\n* **Guest** Guest vary update ajax now bypasses potential POST cache.\n* **CCSS** Added back the options `Separate CCSS Cache Post Types` and `Separate CCSS Cache URIs`. (Joshua/Ankit)\n* **CCSS** CCSS/UCSS queue is now limited to a maximum of 500 entries.\n* **Control** The cache control constant `LSCACHE_NO_CACHE` will now have a higher priority than the Forced Public Cache setting.\n* **Crawler** The Crawler can now crawl Guest Mode pages.\n* **Crawler** Fixed a potential XSS vulnerability in the Crawler settings. (#927355)\n* **Crawler** The Crawler now supports a cookie value of `_null`. (Tobolo)\n* **Media** Updated the default value for the Responsive Placeholder SVG to be transparent.\n* **Media** WebP images in the background may now be served in Guest Mode.\n* **Media** WebP images in CSS may now be bypassed if the requesting Guest Mode client doesn't support WebP.\n* **Media** Fixed empty default image placeholder under Guest Mode.\n* \ud83d\udc1e**Image Optimize** Changed the missing `$_POST` to `$post_data` so the database status is properly updated. (#345 Lucas)\n* **Import** Export file is now readable to allow importing of partial configurations. (Ryan D/Joshua)\n* **Page Optimize** Fixed W3 validator errors in Guest Mode. (#61393817)\n* **3rd** A fatal WooCommerce error is no longer triggered by a custom theme reusing a previous LSCWP cache detection tag.\n* **3rd** AMP may now bypass Guest Mode automatically.\n* **Localize** Dropped the `Localize Resources` option as Guest Mode is a sufficient replacement. (Note: Due to user feedback during the development period, we have decided to reinstate this option in a future version.)\n* **Cloud** Changed the WP API url.\n* **Lang** Corrected a missing language folder.\n* **GUI** Added a CCSS/UCSS loading page visualization. (\u2b50 Contributed by Astrid Wang & Anna Feng #PR360)\n* **GUI** Added a warning to indicate when Guest Mode CCSS/UCSS quota is in use. (Contributed by Astrid Wang & Anna Feng #PR361)\n* **GUI** Added a `litespeed-info` text color. (Astrid Wang)\n* **GUI** Implemented various UI/UX improvements. (Joshua/Lisa)\n* **GUI** Duplicate cloud service messages with the same content will only display once now. (Marc Dahl)\n* **GUI** Added a WebP replacement warning for Guest Mode Optimization if WebP replacement is off.\n* **Misc** Dropped `wp_assets` from distribution to reduce the package size. (lowwebtech)\n* **Misc** Increased the new version and score detection intervals.\n* **Misc** Optimized WP Assets images. (#352 lowwebtech)\n* **Debug** Dropped the redundant error_log debug info.\n\n= 4.0 - Apr 30 2021 =\n* \ud83c\udf31\ud83c\udf31\ud83c\udf31**Guest** Introduced `Guest Mode` for instantly cacheable content on the first visit.\n* \ud83c\udf31**UCSS** Added a new service: `Unique CSS`, to drop unused CSS from elements from combined CSS\n* \ud83c\udf31**CCSS** Added `HTML Lazyload` option. (Ankit)\n* \ud83c\udf31**CCSS** Added `CCSS Per URL` option to allow Critical CSS to be generated for each page instead of for each Post Type.\n* \ud83c\udf31**Media** Added `Add Missing Sizes` setting for improving Cumulative Layout Shift. (Fahim)\n* \ud83c\udf31**JS** Switched to new JS minification library for better compression and compatibility w/ template literals. (LuminSol)\n* **Media** WebP may now be replaced in CSS.\n* **Media** Can now drop image tags in noscript to avoid lazyload. (Abe #314 /mattthomas-photography)\n* **Media** Bypass optimization if a page is not cacheable.\n* **Image Optimize** Auto hook to `wp_update_attachment_metadata` to automate image gathering process, and to handle the new thumbnail generation after images are uploaded. (smerriman).\n* **Image Optimize** Repeated image thumbnails won't be gathered anymore.\n* **Image Optimize** Simplified the rescan/gather/upload_hook for existing image detection.\n* **Image Optimize** Fixed the duplicated optimize size records in the postmeta table. (Abe #315)\n* **Image Optimize** Allow either JSON POST request or normal form request in `notify_img`. (Lucas #313)\n* **Image Optimize** Optimized SQL query for better efficiency. (lucas/Lauren)\n* **Image Optimize** Fixed issue where rescan mass created duplicate images. (#954399)\n* **Image Optimize** Image optimization pie will not show 100% anymore if there is still a small amount in the unfinished queue.\n* **Image Optimize** WebP generation defaults to ON for Guest Mode.\n* **Image Optimize** `Priority Line` package now can have smaller request interval.\n* **ESI** Disable ESI when page is not cacheable. (titsmaker)\n* **ESI** Fixed an issue where Divi was disabling all in edit mode, but couldn't disable ESI. (Abe)\n* **ESI** ESI init moved under `init` hook from `plugin_loaded` hook.\n* **CDN** Add basic support for CloudFlare API Tokens (Abe #320)\n* **CSS** Simplified `Font Display Optimization` option.\n* **CSS** Fixed manual cron timeout issue. (jesse Distad)\n* **CSS** Inline CSS may now use `data-no-optimize` to be excluded from optimization. (popaionut)\n* **JS** Combined `Load JS Defer` and `Load Inline JS Defer` options.\n* **JS** Forced async to defer.\n* **JS** Moved Google Analytics JS from constant default to setting default for removal.\n* **JS** Fixed potential JS parsing issue caused by JS src being changed to data-src by other plugins. (ankit)\n* **JS** Excluded spotlight from JS optimize. (tobolo)\n* **CCSS** Fixed CCSS/UCSS manual cron timeout issue.\n* **CCSS** Only 10 items will be kept for CCSS history.\n* **CCSS** The appearance of CCSS Purge in the topbar menu will be determined by the existance of CCSS cache, and not the setting only.\n* **CCSS** To avoid stuck queues when the current request keeps failing, the CCSS queue will always drop once requested.\n* **CCSS** CCSS will no longer hide adminbar.\n* **CCSS** CCSS may now be separate for network subsites. (Joshua)\n* **CCSS** Gave CCSS a unique filename per URL per user role per subsite.\n* **CCSS** Dropped `Separate CCSS Cache Post Types` option.\n* **CCSS** Dropped `Separate CCSS Cache URIs` option.\n* **CCSS** Subsites purge Avatar/CSS/JS/CCSS will not affect the whole network anymore.\n* **CCSS** Implemented a better queue list for CCSS that auto collapses if there are more than 20 entries, and shows the total on top.\n* **CSSJS** Now using separate CSS and JS folders instead of `cssjs`.\n* **CSSJS** Automatically purge cache after CCSS is generated.\n* **Network** Dropped network CSS/JS rewrite rules.\n* **Cache** Send cache tag header whenever adding a tag to make it effective in the page optimization process.\n* **Core** Used hook for buffer optimization; Used `init()` instead of `constructor`.\n* **Object** Used `cls` instead of `get_instance` for init.\n* **Cloud** Replaced one-time message with a dismissible-only message when the domain key has been automatically cleared due to domain/key dismatch.\n* **API** Dropped function `hook_vary_add()`.\n* **API** Dropped function `vary_add()`.\n* **API** Dropped function `filter_vary_cookies()`.\n* **API** Dropped function `hook_vary()`.\n* **API** Dropped action `litespeed_vary_add`.\n* **API** Dropped filter `litespeed_api_vary`.\n* **API** Use `litespeed_vary_curr_cookies` and `litespeed_vary_cookies` for Vary cookie operations instead.\n* **API** Dropped action `litespeed_vary_append`.\n* **Vary** 3rd party vary cookies will not append into .htaccess anymore but only present in response vary header if in use.\n* **Vary** Dropped function `append()`.\n* **Vary** Commenter cookie is now considered cacheable.\n* **Crawler** Minor update to crawler user agent to accommodate mobile_detect.php (Abe #304)\n* **Data** Added a table truncate function.\n* **Data** Added new tables url & url_file.\n* **Data** Dropped cssjs table.\n* **Data** Options/Summary data is now stored in JSON format to speed up backend visit. (#233250)\n* **Data** Default `CSS Combine External and Inline` and `JS Combine External and Inline` to On for new installations for better compatibility.\n* **Purge** Fixed potential purge warning for certain themes.\n* **Purge** Purge will be stored for next valid visit to trigger if it is initially generated by CLI.\n* **Page Optimize** `CSS Combine`/`JS Combine` will now share the same file if the contents are the same. Limited disk usage for better file usage and fewer issues with random string problems.\n* **Page Optimize** Dropped option CSS/JS Cache TTL.\n* **Page Optimize** Bypass optimization if page not cacheable.\n* **Page Optimize** Purge CSS/JS will purge the `url_file` table too.\n* **Page Optimize** Optionally store a vary with a shorter value.\n* **Page Optimize** Removing query strings will no longer affect external assets. (ankit)\n* **Page Optimize** Better regex for optimization parsing.\n* **Page Optimize** Eliminated w3 validator for DNS prefetch and duplicated ID errors. (sumit Pandey)\n* **Page Optimize** New Optimization for Guest Only option under Tuning.\n* **Page Optimize** Now forbidding external link redirection for localization.\n* **Debug** Implemented a better debug format for the 2nd parameter in the log.\n* **GUI** Bypass page score banner when score is not detected (both 0). (ankit)\n* **GUI** Fixed deprecated JQuery function warning in WP-Admin. (krzxsiek)\n\n= 3.6.4 - Mar 15 2021 =\n* **Toolbox** Fixed Beta Test upgrade error when upgrading to v3.7+.\n\n= 3.6.3 - Mar 10 2021 =\n* **Core** Fixed potential upgrade failure when new versions have changes in activation related functions.\n* **Core** Upgrade process won't get deactivated anymore on Network setup.\n\n= 3.6.2 - Feb 1 2021 =\n* **Page Optimize** Fixed an issue where network purge CSS/JS caused 404 errors for subsites.\n* **Page Optimize** Fixed an issue where purge CSS/JS only caused 404 errors.\n* **Page Optimize** Added a notice for CSS/JS data detection and potential random string issue.\n* **Page Optimize** Limited localization resources to specified .js only. (closte #292/ormonk)\n* **JS** Data src may now be bypassed from JS Combine. (ankit)\n* **CLI** Fixed a message typo in Purge. (flixwatchsupport)\n* **Browser** Added font/otf to Browser Cache expire list. (ruikai)\n* **Data** Updated data files to accept PR from dev branch only.\n* **3rd** Add data-view-breakpoint-pointer to js_excludes.txt for the Events Calendar plugin. (therealgilles)\n* **Cloud** Bypassed invalid requests.\n* **Doc** CDN Mapping description improvement. (mihai A.)\n\n= 3.6.1 - Dec 21 2020 =\n* **WP** Tested up to WP v5.6.\n* **WebP** Reverted WebP support on Safari Big Sur and Safari v14.0.1+ due to an inability to detect MacOS versions from UA. (@antomal)\n* **CDN** Dropped the option `Load JQuery Remotely`.\n* **CDN** Fixed CDN URL replacement issue in optimized CSS files. (@ankit)\n* **CDN** Fixed an issue where CDN CLI wouldn't set mapping image/CSS/JS to OFF when `false` was the value.\n* **CDN** Started using React for CDN Mapping settings.\n* **GUI** Secured Server IP setting from potential XSS issues. (@WonTae Jang)\n* **Toolbox** Supported both dev and master branches for Beta Test. Latest version updated to v3.6.1.\n* **Purge** Purge Pages now can purge non-archive pages too.\n* **Admin** Simplified the admin JS.\n* **Admin** Limited crawler-related react JS to crawler page only.\n\n= 3.6 - Dec 14 2020 =\n* \ud83c\udf31**WebP** Added WebP support on Safari Big Sur or Safari v14.0.1+. (@ruikai)\n* \ud83d\udc1e**Config** Fixed an issue where new installations were not getting the correct default .htaccess content.\n* **Crawler** Will auto bypass empty sub-sitemap instead of throwing an exception. (@nanoprobes @Tobolo)\n* **Crawler** Now using React for Cookie Simulation settings instead of Vue.js. Dropped Vue.js.\n* **Crawler** Dropped `Sitemap Generation` (will only use 3rd party sitemap for crawler).\n* **CSS** Added `CSS Combine External and Inline` option for backward compatibility. (@lisa)\n* **Object** Forbid .object-cache.ini visits. (@Tarik)\n* **Page Optimize** Dropped `Remove Comments` option to avoid combine error.\n* **CSS** Added a predefined CSS exclude file `data/css_excludes.txt`.\n* **CSS** Excluded Flatsome theme random inline CSS from combine.\n* **CSS** Excluded WoodMart theme from combine. (@moemauphie)\n* **Page Optimize** Excluded tagDiv.com Newspaper theme dynamic CSS/JS from CSS/JS Combine.\n* **CSS** Added predefined JS defer excludes list. (@Shivam)\n* **JS** `data-no-defer` option now supports inline JS. (@rafaucau)\n* **Media** Lazyload inline library is now bypassed by JS Combine.\n* **Admin** Fixed WP-Admin console ID duplicate warnings.\n* **Cloud** Dropped QUIC.cloud sync options that have long been unused.\n* **CSS** Dropped `Unique CSS File` option (UCSS will always generate unique file, will use whitelist to group post type to one CSS).\n* **GUI** Dropped Help tab.\n* **Toolbox** Added 3.5.2 to version list.\n\n= 3.5.2 - Oct 27 2020 =\n* **CSS** `CSS Combine` is now compatible w/ inline noscript CSS. (@galbaras)\n* **GUI** Added ability to manually dismiss the JS option reset message in v3.5.1 upgrade process. (#473917)\n* \ud83d\udc1e**CSS** `CSS Excludes` setting will no longer lose items beginning w/ `#`. (@ankit)\n* **API** New `litespeed_media_reset` API function for image editing purposes. (@Andro)\n\n= 3.5.1 - Oct 20 2020 =\n* **JS** Inline JS containing nonces can now be combined.\n* **JS** Reset JS Combine/Defer to OFF when upgrading to avoid breaking sites.\n* **JS** Added new option JS Combine External and Inline to allow backwards compatibility.\n* **JS** Added Inline JS Defer option back. (@ankit)\n* **Page Optimize** Dropped Inline JS Minify option and merged the feature into JS Minify.\n* **JS** Pre-added jQuery to the default JS excludes/defer list for better layout compatibility for new users.\n* **JS** Excluded Stripe/PayPal/Google Map from JS optimization. (@FPCSJames)\n* **JS** Allowed excluded JS to still be HTTP2 pushed. (@joshua)\n* **CCSS** Critical CSS now can avoid network pollution from other sites. (@ankit)\n* **Toolbox** Beta Test now displays recent public versions so it is easier to revert to an older version\n* **Vary** Server environment variable Vary can now be passed to original server from QUIC.cloud for non-LiteSpeed servers.\n* **ESI** Improved backward compatibility for ESI nonce list. (@zach E)\n* \ud83d\udc1e**Misc** Fixed failure of upgrade button on plugin news banner and made cosmetic improvements.\n* **Doc** Added note that LSCWP works with ClassicPress.\n\n= 3.5.0.2 - Sep 30 2020 =\n* This is a temporary revert fix. Code is SAME as v3.4.2.\n\n= 3.5.0.1 - Sep 29 2020 =\n* \ud83d\udd25\ud83d\udc1e**CSS** Fixed print media query issue when having CSS Combine. (@paddy-duncan)\n\n= 3.5 - Sep 29 2020 =\n* **Page Optimize** Refactored CSS/JS optimization.\n* **Page Optimize** CSS and JS Combine now each save to a single file without memory usage issues.\n* **CSS** Inline CSS Minify is now a part of CSS Minify, and will respect thr original priorities. (thanks to @galbaras)\n* **JS** JS Combine now generates a single JS file in the footer. (Special thanks to @ankit)\n* **JS** JS Combine now combines external JS files, too. (Thanks to @ankit)\n* **JS** JS Deferred Excludes now uses the original path/filename as keywords instead of the minified path/filename, when JS Minify is enabled.\n* **JS** JS Combine now combines inline JS, too.\n* **JS** JS Excludes may now be used for inline JS snippet.\n* **Page Optimize** Inline CSS Minify and Max Combined File Size retired due to changes listed above.\n* **CSS** Combined CSS Priority retired due to changes listed above.\n* **JS** Exclude JQuery, Combined JS Priority, Load Inline JS Deferred, and Inline JS Deferred Excludes retired due to changes listed above.\n* **JS** Predefined data file data/js_excludes.txt now available for JS Excludes.\n* **ESI** Predefined data file data/esi.nonces.txt now available for ESI Nonces.\n* **ESI** Remote Fetch ESI Nonces functionality retired.\n* **API** Added support for new litespeed_esi_nonces filter.\n* **Object** Object Cache will not try to reconnect after failure to connect in a single process.\n* **CCSS** Remote read CSS will add the scheme if it is missing from the URL.\n* **CCSS** CSS will no longer be prepared for a URL if 404 result is detected.\n* **CCSS** Fixed most failures caused by third party CSS syntax errors.\n* **CCSS** Remote read CSS will fix the scheme if the URL doesn't have it.\n* **CCSS** Excluded 404 when preparing CSS before request.\n* **CCSS** Adjusted CCSS timeout from 180 seconds to 30 seconds.\n* **Image Optimize** Fixed the delete attachment database error that occurred when not using the image optimization service yet.\n* **Media** Added iOS 14 WebP support.\n* **Data** Fixed database creation failure for MySQL v8.\n* **Cloud** Error code err_key will clear the domain key in order to avoid duplicate invalid requests.\n* **Network** Fixed issue with object cache password file storage that occurred when resaving the settings. (#302358)\n* **Misc** Fixed IP detect compatibility w/ Apache.\n* **GUI** Fixed the description for Do Not Cache Categories.\n* **Preload** Upgraded Instant Click to a new stable preload library. (@stasonua0)\n\n= 3.4.2 - Sep 8 2020 =\n* **CCSS** Corrected the issue that wrongly appended non-CSS files to CSS in links before sending request.\n* **3rd** YITH wishlist now sends a combined single sub request for all widgets contained in one page. (LSWS v5.4.9 build 3+ required)\n* **ESI** Added support for ESI combine feature.\n* **GUI** Dropped banner notification for missing domain key when domain key is not initialized.\n* **Log** When QC whitelist check fails, a detailed failure log is now appended.\n\n= 3.4.1 - Sep 2 2020 =\n* \ud83d\udc1e**CCSS** Fixed an issue where dynamically generated CSS failed with `TypeError: Cannot read property type of undefined`.\n* \ud83d\udc1e**Page Optimize** Fixed CSS optimization compatibility for CSS dynamically generated with PHP.\n* **Page Optimize** Added the ability to defer JS even when the resource is excluded from other JS optimizations. (@slr1979)\n* **ESI** Added support for ESI last paramater inline value.\n* **3rd** YITH Wishlist, when cached for the first time, will no longer send sub requests.\n\n= 3.4 - Aug 26 2020 =\n* \ud83c\udf31**LQIP** New setting **LQIP Excludes**.\n* \ud83c\udf31**LQIP** Added a Clear LQIP Queue button.\n* \ud83c\udf31**CCSS** Added a Clear CCSS Queue button.\n* **CCSS** Fixed an issue which wrongly included preloaded images in CCSS. (@pixtweaks)\n* **Network** Primary site and subsite settings now display correctly.\n* **Page Optimize** Noscript tags generated by LSCWP will only be dropped when the corresponding option is enabled. (@ankit)\n* **DB Optimize** Fixed database optimizer conflicts w/ object cache transient setting. (#752931)\n* **3rd** Fixed an issue with WooCommerce product purge when order is placed.\n* **3rd** Improved WooCommerce product comment compatibility with **WooCommerce Photo Reviews Premium** plugin when using ESI.\n* **CDN** Fixed Remote jQuery compatibility with WordPress v5.5. (@pixtweaks)\n* **API** New API `litespeed_purge_all_object` and `litespeed_purged_all_object` action hooks.\n\n= 3.3.1 - Aug 12 2020 =\n* \ud83c\udf31**Page Optimize** New option to Remove Noscript Tags. (@phuc88bmt)\n* \ud83d\udc1e**LQIP** Fixed a critical bug that bypassed all requests in v3.3.\n* **LQIP** Requests are now bypassed if domain has no credit left.\n* **Page Optimize** Inline defer will be bypassed if document listener is detected in the code. (@ssurfer)\n* **CCSS** Print-only styles will no longer be included in Critical CSS.\n* **API** Added hooks to Purge action to handle file deletions. (@biati)\n* **Cloud** Plain permalinks are no longer required for use of cloud services.\n* **Data** Added an access denial to work with OpenLiteSpeed. (@spenweb #PR228)\n* **GUI** Spelling and grammar adjustments. (@blastoise186 #PR253)\n\n= 3.3 - Aug 6 2020 =\n* \ud83c\udf31**Page Optimize** Added a new setting, Inline JS Deferred Excludes. (@ankit)\n* **Page Optimize** CSS/JS Combine/Minify file versions will be differentiated by query string hash instead of new filename to reduce DB/file system storage.\n* **Page Optimize** Added the ability to use local copies of external JS files for better control over page score impacts.\n* **Page Optimize** Improved combination of CSS media queries. (@galbaras)\n* **Page Optimize** Reprioritized Inline JS Defer to be optimized before encoding, for a significantly smaller result.\n* **LQIP** Detect if the file exists before sending LQIP request to QUIC.cloud.\n* **CCSS** Sped up CCSS process significantly by sending HTML and CSS in request.\n* **CCSS** Improvements to mobile CSS support in CCSS.\n* **CCSS** Minimize CCSS failures by attempting to automatically fix CSS syntax errors.\n* **Cloud** Domain Key will be deleted after QUIC.cloud site_not_registered error to avoid endless repeated requests.\n* **CDN** CDN Original URL will default to WP Site URL if not set. (@ruikai)\n* **CLI** Global output format `--format=json/yaml/dump` and `--json` support in CLI. (@alya1992)\n* **CDN** Improved handling of non-image CSS `url()` sources in CDN. (@daniel McD)\n* \ud83d\udc1e**CDN** Fixed CDN replacement conflict w/ JS/CSS Optimize. (@ankit)\n* **Crawler** Only reset Crawler waiting queues when crawling begins. (@ruikai)\n* **Network** Network Enable Cache is no longer reset to ON Use Network Settings in enabled. (@RavanH)\n* \ud83d\udc1e**Activation** Fixed a PHP warning that appeared during uninstall. (@RavanH)\n* **Debug** Automatically omit long strings when dumping an array to debug log.\n* **Report** Subsites report now shows overwritten values along w/ original values. (#52593959)\n* **REST** Improved WP5.5 REST compatibility. (@oldrup)\n* **GUI** Server IP setting moved from Crawler menu to General menu.\n* **GUI** Localize resources moved to Localization tab.\n* **Config** News option now defaults to ON.\n\n= 3.2.4 - Jul 8 2020 =\n* **Object** New installations no longer get custom data.ini reset, as this could cause lost configuration. (@Eric)\n* **ESI** Now using `svar` to load nonces more quickly. (@Lauren)\n* **ESI** Fixed the conflicts between nonces in inline JS and ESI Nonces when Inline JS Deferred is enabled. (@JesseDistad)\n* \ud83d\udc1e**ESI** Fixed Fetch Latest Predefined Nonce button.\n* \ud83d\udc1e**Cache** Fixed an issue where mobile visits were not being cached when Cache Mobile was disabled.\n* **CDN** Bypass CDN constant `LITESPEED_BYPASS_CDN` now will apply to all CDN replacements.\n* **Router** Dropped `Router::get_uid()` function.\n* **Crawler** Updated role simulator function for future UCSS usage.\n* **GUI** Textarea will now automatically adjust the height based on the number of rows input.\n* **CLI** Fixed an issue that caused WP-Cron to exit when a task errored out. (@DovidLevine @MatthewJohnson)\n* **Cloud** No longer communcate with QUIC.cloud when Domain Key is not set and Debug is enabled.\n* **Cloud** Score banner no longer automatically fetches a new score. (@LucasRolff)\n\n= 3.2.3.2 - Jun 19 2020 =\n* \ud83d\udd25\ud83d\udc1e**Page Optimize** Hotfix for CSS/JS minify/combine. (@jdelgadoesteban @martin_bailey)\n\n= 3.2.3.1 - Jun 18 2020 =\n* **API** New filter `litespeed_buffer_before` and `litespeed_buffer_after`. (#PR243 @joejordanbrown)\n\n= 3.2.3 - Jun 18 2020 =\n* \ud83c\udf31**Page Optimize** Added Unique CSS option for future removal of unused CSS per page. (@moongear)\n* **Page Optimize** Fixed an issue where Font Optimization could fail when having Load JS Deferred and Load Inline JS Deferred. (#PR241 @joejordanbrown)\n* \ud83d\udc1e**Page Optimize** Fixed an issue with Font Display Optimization which caused Google Fonts to load incorrectly. (#PR240 @joejordanbrown @haidan)\n* \ud83d\udc1e**Network** Use Primary Site Configuration setting for network sites now works properly with Object Cache and Browser Cache. (#56175101)\n* **API** Added filter `litespeed_is_from_cloud` to detect if the current request is from QC or not. (@lechon)\n* **ESI** ESI Nonce now can fetch latest list with one click.\n* **GUI** Updated remaining documentation links & some minor UI tweaks. (@Joshua Reynolds)\n\n= 3.2.2 - Jun 10 2020 =\n* \ud83c\udf31**Purge** Scheduled Purge URLs now supports wildcard. (#427338)\n* \ud83c\udf31**ESI** ESI Nonce supports wildcard match now.\n* **Network** Use Primary Site Settings now can support Domain Key, and override mechanism improved. (@alican532 #96266273)\n* **Cloud** Debug mode will now have no interval limit for most cloud requests. (@ruikai)\n* **Conf** Default Purge Stale to OFF.\n* **GUI** Purge Stale renamed to Serve Stale.\n* **Data** Predefined nonce list located in `/litespeed-cache/data/esi.nonce.txt`. Pull requests welcome.\n* **Debug** Limited parameter log length.\n* \ud83d\udc1e**CDN** Fixed an issue where upgrading lost value of CDN switch setting. (#888668)\n* **3rd** Caldera Forms ESI Nonce enhancement. (@paconarud16 @marketingsweet)\n* **3rd** Elementor now purges correctly after post/page updates.\n* **3rd** Disabled Page Optimization features on AMP to avoid webfont JS inject. (@rahulgupta1985)\n\n= 3.2.1 - Jun 1 2020 =\n* **Cloud** LQIP/CCSS rate limit tweaks. (@ianpegg)\n* **Admin** Improved frontend Admin Bar menu functionality. (#708642)\n* **Crawler** Fixed an issue where cleaning up a crawler map with a leftover page number would cause a MySQL error. (@saowp)\n* **Image Optimize** Added WP default thumbnails to image optimization summary list. (@johnny Nguyen)\n* **REST** Improved REST compatibility w/ WP4.4-. (#767203)\n* **GUI** Moved Use Primary Site Configuration to General menu. (@joshua)\n\n= 3.2 - May 27 2020 =\n* **Image Optimize** Major improvements in queue management, scalability, and speed. (@LucasRolff)\n* **Cloud** Implemented a series of communication enhancements. (@Lucas Rolff)\n* **Crawler** Enhanced PHP 5.3 compatibility. (@JTS-FIN #230)\n* **Page Optimize** Appended image template in wpDiscuz script into default lazyload image exclude list. (@philipfaster @szmigieldesign)\n* **Page Optimize** Eliminated the 404 issue for CSS/JS in server environments with missing SCRIPT_URI. (@ankit)\n* **Data** ENhanced summary data storage typecasting.\n\n= 3.1 - May 20 2020 =\n* \ud83c\udf31**Network** Added Debug settings to network level when on network.\n* \ud83d\udc1e**Purge** Network now can purge all.\n* \ud83d\udc1e**Network** Fixed issue where saving the network primary site settings failed.\n* **Network** Moved Beta Test to network level when on network.\n* \ud83d\udc1e**Cache** Fixed issue in admin where new post editor was wrongly cached for non-admin roles. (@TEKFused)\n* \ud83d\udc1e**Data** Fixed issue with crawler & img_optm table creation failure. (@berdini @piercand)\n* \ud83d\udc1e**Core** Improved plugin activation compatibility on Windows 10 #224 (@greenphp)\n* **Core** Improved compatibility for .htaccess path search.\n* **Object** Catch RedisException. (@elparts)\n* Fixed Script URI issue in 3.0.9 #223 (@aonsyed)\n* **Image Optimize** Show thumbnail size set list in image optimization summary. (@Johnny Nguyen)\n* **Debug** Parameters will now be logged.\n\n= 3.0.9 - May 13 2020 =\n* **Purge** Comment cache can be successfully purged now.\n* **Data** Better MySQL charset support for crawler/image optimize table creation. (@Roshan Jonah)\n* **API** New hook to fire after Purge All. (@salvatorefresta)\n* **Crawler** Resolve IP for crawler.\n* **Task** PHP5.3 Cron compatibility fix.\n* **3rd** Elementor edit mode compatibility.\n* **Page Optimize** Fixed an issue where Purge Stale returned 404 for next visitor on CSS/JS.\n* **Page Optimize** Fixed the PHP warning when srcset doesn't have size info inside. (@gvidano)\n* **Cloud** Fixed the potential PHP warning when applying for the domain key.\n* **Core** PHP __DIR__ const replacement. (@MathiasReker)\n\n= 3.0.8.6 - May 4 2020 =\n* **CCSS** Bypassed CCSS functionality on frontend when domain key isn't setup yet.\n* **Cloud** Fixed WP node redetection bug when node expired. (@Joshua Reynolds)\n* **Crawler** Fixed an issue where URL is wrongly blacklisted when using ADC.\n\n= 3.0.8.5 - May 1 2020 =\n* \ud83d\udd25\ud83d\udc1e**3rd** Hotfix for WPLister critical error due to v3.0.8.4 changes.\n* **Image Optimize** Unfinished queue now will get more detailed info to indicate the proceeding status on node.\n* **CLI** Options can now use true/false as value for bool. (@gavin)\n* **CLI** Detect error if the ID does not exist when get/set an option value.\n* **Doc** An API comment typo for `litespeed_esi_load-` is fixed.\n\n= 3.0.8.4 - Apr 30 2020 =\n* \ud83c\udf31**Crawler** New setting: Sitemap timeout. (#364607)\n* **Image Optimize** Images that fail to optimize are now counted to increase next request limit.\n* **Cloud** Redetect fastest node every 3 days.\n* **Cloud** Suppressed auto upgrade version detection error. (@marc Dahl)\n* **3rd** 3rd party namespace compatibility. (#366352)\n\n= 3.0.8.3 - Apr 28 2020 =\n* **Cloud** Better compatibility for the Link to QUIC.cloud operation. (@Ronei de Sousa Almeida)\n* **Image Optimize** Automatically clear invalid image sources before sending requests. (@Richard Hordern)\n\n= 3.0.8.2 - Apr 27 2020 =\n* **GUI** Corrected the Request Domain Key wording.\n\n= 3.0.8.1 - Apr 27 2020 =\n* **Object** Object cache compatibility for upgrade from v2.9.9- versions.\n\n= 3.0.8 - Apr 27 2020 =\n* Released v3 on WordPress officially.\n\n= 3.0.4 - Apr 23 2020 =\n* **Cloud** Apply Domain Key now receives error info in next apply action if failed to generate.\n* **GUI** Apply Domain Key timeout now displays troubleshooting guidance.\n* **REST** Added /ping and /token to REST GET for easier debug.\n* **Cache** Dropped `advanced-cache.php` file detection and usage.\n\n= 3.0.3 - Apr 21 2020 =\n* **Conf** Settings from all options (data ini, defined constant, and forced) will be filtered and cast to expected type.\n* **Upgrade** CDN mapping and other multiple line settings will now migrate correctly when upgrading from v2 to v3.\n\n= 3.0.2 - Apr 17 2020 =\n* **GUI** More guidance on domain key setting page.\n* **Cloud** Now Apply Domain Key will append the server IP if it exists in Crawler Server IP setting.\n\n= 3.0.1 - Apr 16 2020 =\n* **Data** Increased timeout for database upgrade related to version upgrade. Display a banner while update in progress.\n* **Page Optimize** All appended HTML attributes now will use double quotes to reduce the conflicts when the optimized resources are in JS snippets.\n\n= 3.0 - Apr 15 2020 =\n* \ud83c\udf31**Media** LQIP (Low Quality Image Placeholder).\n* \ud83c\udf31**Page Optimize** Load Inline JS Deferred Compatibility Mode. (Special thanks to @joe B - AppsON)\n* \ud83c\udf31**Cloud** New QUIC.cloud API key setting.\n* \ud83c\udf31**ESI** New ESI nonce setting.\n* \ud83c\udf31**Media** JPG quality control. (@geckomist)\n* \ud83c\udf31**Media** Responsive local SVG placeholder.\n* \ud83c\udf31**Discussion** Gravatar warmup cron.\n* \ud83c\udf31**DB** Table Engine Converter tool. (@johnny Nguyen)\n* \ud83c\udf31**DB** Database summary: Autoload size. (@JohnnyNguyen)\n* \ud83c\udf31**DB** Database summary: Autoload entries list.\n* \ud83c\udf31**DB** Revisions older than. (@thememasterguru)\n* \ud83c\udf31**Cache** Forced public cache setting. (#308207)\n* \ud83c\udf31**Crawler** New timeout setting to avoid incorrect blacklist addition. (#900171)\n* \ud83c\udf31**Htaccess** Frontend & backend .htaccess path customize. (@jon81)\n* \ud83c\udf31**Toolbox** Detailed Heartbeat Control (@K9Heaven)\n* \ud83c\udf31**Purge** Purge Stale setting.\n* \ud83c\udf31**Page Optimize** Font display optimization. (@Joeee)\n* \ud83c\udf31**Page Optimize** Google font URL display optimization.\n* \ud83c\udf31**Page Optimize** Load Inline JS deferred.\n* \ud83c\udf31**Page Optimize** Store gravatar locally. (@zzTaLaNo1zz @JohnnyNguyen)\n* \ud83c\udf31**Page Optimize** DNS prefetch control setting.\n* \ud83c\udf31**Page Optimize** Lazy Load Image Parent Class Name Excludes. (@pako69)\n* \ud83c\udf31**Page Optimize** Lazy load iframe class excludes. (@vnnloser)\n* \ud83c\udf31**Page Optimize** Lazy load exclude URIs. (@wordpress_fan1 @aminaz)\n* \ud83c\udf31**GUI** New Dashboard and new menus.\n* \ud83c\udf31**Image Optimize** Supported GIF WebP optimization. (@Lucas Rolff)\n* \ud83c\udf31**Image Optimize** New workflow for image optimization (Gather first, request second).\n* \ud83c\udf31**Image Optimize** The return of Rescan.\n* \ud83c\udf31**CLI** Get single option cmd.\n* \ud83c\udf31**CLI** QUIC.cloud cmd supported.\n* \ud83c\udf31**CLI** CLI can send report now.\n* \ud83c\udf31**Health** Page speed and page score now are in dashboard.\n* \ud83c\udf31**Conf** Supported consts overwritten of `LITESPEED_CONF__` for all settings. (@menathor)\n* \ud83c\udf31**REST** New REST TTL setting.  (@thekendog)\n* \ud83c\udf31**CDN** New setting `HTML Attribute To Replace`. CDN can now support any HTML attribute to be replaced. (@danushkaj91)\n* \ud83c\udf31**Debug** Debug URI includes/excludes setings.\n* \ud83c\udf31**Crawler** \ud83d\udc1e Support for multiple domains in custom sitemap. (@alchem)\n* \ud83c\udf31**Crawler** New Crawler dashboard. New sitemap w/ crawler status. New blacklist w/ reason.\n* \ud83c\udf31**Media** LQIP minimum dimensions setting. (@Lukasz Szmigiel)\n* **Crawler** Able to add single rows to blacklist.\n* **Crawler** Crawler data now saved into database instead of creating new files.\n* **Crawler** Larger timeout to avoid wrongly added to blacklist.\n* **Crawler** Manually changed the priority of mobile and WebP. (@rafaucau)\n* **Browser** Larger Browser Cache TTL for Google Page Score improvement. (@max2348)\n* **Task** Task refactored. Disabled cron will not show in cron list anymore.\n* **Task** Speed up task load speed.\n* **ESI** Added Bloom nonce to ESI for Elegant Themes.\n* **Cloud** Able to redetect cloud nodes now.\n* **Img_optm** Fixed stale data in redirected links.\n* **Lazyload** CSS class `litespeed_lazyloaded` is now appended to HTML body after lazyload is finished. (@Adam Wilson)\n* **Cache** Default drop qs values. (@gijo Varghese)\n* **LQIP** Show all LQIP images in Media column.\n* **CDN** Can now support custom REST API prefix other than wp-json. (#174 @therealgilles)\n* **IAPI** Used REST for notify/destroy/check_img; Removed callback passive/aggreesive IAPI func\n* **CSSJS** Saved all static files to litespeed folder; Uninstallation will remove static cache folder too; Reduced .htaccess rules by serving CSS/JS directly.\n* **Object** Fixed override different ports issue. (@timofeycom #ISSUE178)\n* **Conf** DB Tables will now only create when activating/upgrading/changing settings.\n* **DB** Simplified table operation funcs.\n* **CSSJS** Bypassed CSS/JS generation to return 404 if file is empty (@grubyy)\n* **CSSJS** Inline JS defer will not conflict with JS inline optm anymore.\n* **CDN** settings will not be overwritten by primary settings in network anymore. (@rudi Khoury)\n* **OPcache** Purged all opcache when updating cache file. (@closte #170)\n* **CLI** CLI cmd renamed.\n* **CLI** Well-formated table to show all options.\n* **Purge** Only purge related posts that have a status of \"published\" to avoid unnecessary \"draft\" purges. (@Jakub Knytl)\n* **GUI** Removed basic/adv mode for settings. Moved non-cache settings to its own menu.\n* **Htaccess** Protected .htaccess.bk file. Only kept one backup. (@teflonmann)\n* **Crawler** Crawler cookie now support `_null` as empty value.\n* **Crawler** Avoid crawler PHP fatal error on Windows OS. (@technisolutions)\n* **Admin** Simplified admin setting logic.\n* **Conf** Multi values settings now uniformed to multi lines for easier setting.\n* **Conf** New preset default data file `data/consts.default.ini`.\n* **Conf** Config setting renamed and uniformed.\n* **Conf** Dropped `Conf::option()`. Used `Conf::val()` instead.\n* **Conf** Improved conf initialization and upgrade convertion workflow.\n* **Core** Code base refactored. New namespace LiteSpeed.\n* **API** New API: iframe lazyload exclude filter.\n* **GUI** human readable seconds. (@MarkCanada)\n* **API** API refactored. * NOTE: All 3rd party plugins that are using previous APIs, especially `LiteSpeed_Cache_API`, need to be adjusted to the latest one. Same for ESI blocks.* ESI shortcode doesn't change.\n* **API** New hook `litespeed_update_confs` to settings update.\n* **API** New Hooks `litespeed_frontend_shortcut` and `litespeed_backend_shortcut` for dropdown menu. (@callaloo)\n* **API** Removed `litespeed_option_*` hooks. Use `litespeed_force_option` hook insteadly\n* **API** Renamed `litespeed_force_option` to `litespeed_conf_force`.\n* **API** Removed function `litespeed_purge_single_post`.\n* **REST** New rest API to fetch public IP.\n* **GUI** Hiding Cloudflare/Object Cache/Cloud API key credentials. (@menathor)\n* **GUI** Renamed all backend link tag from lscache to litespeed.\n* **GUI** fixed duplicated form tag.\n* **GUI** Fix cron doc link. (@arnab Mohapatra)\n* **GUI** Frontend adminbar menu added `Purge All` actions. (@Monarobase)\n* **GUI** Localized vue.js to avoid CloudFlare cookie. (@politicske)\n* **GUI** Always show optm column in Media Library for future single row optm operation. (@mikeyhash)\n* **GUI** Displayed TTL range below the corresponding setting.\n* **GUI** GUI refactored.\n* **Debug** Report can now append notes.\n* **3rd** Default added parallax-image to webp replacement for BB.\n* **3rd** User Switching plugin compatibility. (@robert Staddon)\n* **3rd** Beaver Builder plugin compatibility with v3.0.\n* **3rd** Avada plugin compatibility w/ BBPress. (@pimg)\n* **3rd** WooCommerce PayPal Checkout Gateway compatibility. (#960642 @Glen Cabusas)\n* **Network** Fixed potential timeout issue when containing a large volume of sites. (@alican532)\n* **Debug** `Disable All Features` now will see the warning banner if ON.\n* **Debug** Dropped `log filters` section.\n* **Debug** Debug and Tools sections combined into new `Toolbox` section.\n* \ud83d\udc1e**Crawler** Multi sites will now use separate sitemap even when `Use Primary Site` is ON. (@mrhuynhanh)\n* \ud83d\udc1e**Img_optm** Fixed large volume image table storage issue. (#328956)\n* \ud83d\udc1e **Cloud** Cloud callback hash validation fixed OC conflict. (@pbpiotr)\n* \ud83c\udf8a Any user that had the contribution to our WP community or changelog (even just bug report/feedback/suggestion) can apply for extra credits in QUIC.cloud.\n\n= 2.9.9.2 - Nov 24 2019 =\n* \ud83c\udf31**GUI** New settings to limit News Feed to plugin page only.\n\n= 2.9.9.1 - Nov 18 2019 =\n* \ud83c\udf31**Env** Environment Report can now append a passwordless link for support access without wp-admin password.\n* **Admin** The latest v3.0 beta test link may now be shown on the admin page when it's available.\n* **3rd** Compatibility with [DoLogin Security](https://wordpress.org/plugins/dologin/).\n* \ud83d\udc1e**ESI** Fixed a failure issue with Vary Group save. (@rafasshop)\n* \ud83d\udc1e**3rd** In browsers where WebP is not supported, Divi image picker will no longer serve WebP. (@Austin Tinius)\n\n= 2.9.9 - Oct 28 2019 =\n* <strong>Core</strong>: Preload all classes to avoid getting error for upcoming v3.0 upgrade.\n* <strong>Object</strong>: Improved compatibility with upcoming v3.0 release.\n* <strong>ESI</strong>: Unlocked ESI for OLS in case OLS is using QUIC.cloud CDN which supports ESI.\n* <strong>3rd</strong>: Elementor Edit button will now show when ESI enabled. (#PR149 #335322 @maxgorky)\n* \ud83d\udc1e<strong>Media</strong>: Fixed missing Media optimization column when Admin role is excluded from optimization in settings. (@mikeyhash @pako69 @dgilfillan)\n\n= 2.9.8.7 - Oct 11 2019 =\n* <strong>3rd</strong>: Enhanced WP stateless compatibility. (#PR143)\n* <strong>3rd</strong>: Fixed a PHP warning caused by previous PR for AMP. (#PR176)\n\n= 2.9.8.6 - Sep 24 2019 =\n* <strong>3rd</strong>: Bypassed page optimizations for AMP. (#359748 #PR169)\n* <strong>GUI</strong>: Firefox compatibility with radio button state when reloading pages. (#288940 #PR162)\n* <strong>GUI</strong>: Updated Slack invitation link. (#PR173)\n\n= 2.9.8.5 - Aug 21 2019 =\n* <strong>CCSS</strong>: Removed potential PHP notice when getting post_type. (@amcgiffert)\n* <strong>CDN</strong>: Bypassed CDN replacement on admin page when adding media to page/post. (@martin_bailey)\n* \ud83d\udc1e<strong>Media</strong>: Fixed inability to update or destroy postmeta data for child images. (#167713)\n\n= 2.9.8.4 - Jul 25 2019 =\n* <strong>Object</strong>: Increased compatibility with phpredis 5.0.\n* <strong>Object</strong>: Appended `wc_session_id` to default Do Not Cache Groups setting to avoid issue where WooCommerce cart items were missing when Object Cache is used. NOTE: Existing users must add `wc_session_id` manually! (#895333)\n* <strong>CSS</strong>: Added null onload handler for CSS async loading. (@joejordanbrown)\n* \ud83d\udd77\ufe0f: Increased crawler timeout to avoid wrongly adding a URL to the blacklist.\n* <strong>3rd</strong>: WooCommerce Advanced Bulk Edit can now purge cache automatically.\n\n= 2.9.8.3 - Jul 9 2019 =\n* <strong>CSS</strong>: Enhanced the CSS Minify compatibility for CSS with missing closing bracket syntax errors. (@fa508210020)\n* \ud83d\udd77\ufe0f: Crawler now supports both cookie and no-cookie cases. (@tabare)\n* <strong>CCSS</strong>: Enhanced compatibility with requested pages where meta info size exceeds 8k. (@Joe B)\n* <strong>CCSS</strong>: No longer processing \"font\" or \"import\" directives as they are not considered critical. (@Ankit @Joe B)\n* <strong>IAPI</strong>: Removed IPv6 from all servers to avoid invalid firewall whitelist.\n\n= 2.9.8.2 - Jun 17 2019 =\n* \ud83d\udd25\ud83d\udc1e <strong>3rd</strong>: Fixed PHP 5.3 compatibility issue with Facetwp.\n\n= 2.9.8.1 - Jun 17 2019 =\n* <strong>3rd</strong>: Set ESI template hook priority to highest number to prevent ESI conflict with Enfold theme. (#289354)\n* <strong>3rd</strong>: Improved Facetwp reset button compatibility with ESI. (@emilyel)\n* <strong>3rd</strong>: Enabled user role change to fix duplicate login issue for plugins that use alternative login processes. (#114165 #717223 @sergiom87)\n* <strong>GUI</strong>: Wrapped static text with translate function. (@halilemreozen)\n\n= 2.9.8 - May 22 2019 =\n* <strong>Core</strong>: Refactored loading priority so user related functions & optimization features are set after user initialization. (#717223 #114165 #413338)\n* <strong>Media</strong>: Improved backup file calculation query to prevent out-of-memory issue.\n* <strong>Conf</strong>: Feed cache now defaults to ON.\n* <strong>API</strong>: Fully remote attachment compatibility API of image optimization now supported.\n* \ud83d\udd77\ufe0f: Bypassed vary change for crawler; crawler can now simulate default vary cookie.\n* <strong>ESI</strong>: Refactored ESI widget. Removed `widget_load_get_options()` function.\n* <strong>ESI</strong>: Changed the input name of widget fields in form.\n* <strong>3rd</strong>: Elementor can now save ESI widget settings in frontend builder.\n* <strong>3rd</strong>: WP-Stateless compatibility.\n* <strong>IAPI</strong>: Image optimization can now successfully finish the destroy process with large volume images with automatic continual mode.\n* \ud83d\udc1e<strong>CDN</strong>: Fixed issue with Load JQuery Remotely setting where WP 5.2.1 provided an unexpected jQuery version.\n* \ud83d\udc1e<strong>3rd</strong>: Login process now gets the correct role; fixed double login issue.\n\n= 2.9.7.2 - May 2 2019 =\n* <strong>Conf</strong>: Enhanced compatibility when an option is not properly initialized.\n* <strong>Conf</strong>: Prevent non-array instance in widget from causing 500 error. (#210407)\n* <strong>CCSS</strong>: Increase CCSS generation timeout to 60s.\n* <strong>Media</strong>: Renamed lazyload CSS class to avoid conflicts with other plugins. (@DynamoProd)\n* <strong>JS</strong>: Improved W3 validator. (@istanbulantik)\n* <strong>QUIC</strong>: Synced cache tag prefix for static files cache.\n* <strong>ESI</strong>: Restored query strings to ESI admin bar for accurate rendering. (#977284)\n* <strong>ESI</strong>: Tweaked ESI init priority to honor LITESPEED_DISABLE_ALL const. ESI will now init after plugin loaded.\n* \ud83d\udc1e<strong>ESI</strong>: No longer initialize ESI if ESI option is OFF.\n* <strong>API</strong>: New \"Disable All\" API function.\n* <strong>API</strong>: New \"Force public cache\" API function.\n* \ud83d\udc1e<strong>Vary</strong>: Fixed an issue with saving vary groups.\n* \ud83d\udc1e<strong>IAPI</strong>: Fixed an issue where image md5 validation failed due to whitespace in the image path.\n* \ud83d\udc1e<strong>3rd</strong>: Bypass all optimization/ESI/Cache features when entering Divi Theme Builder frontend editor.\n* \ud83d\udc1e<strong>3rd</strong>: Fixed an issue where DIVI admin bar exit button didn't work when ESI was ON.\n\n= 2.9.7.1 - Apr 9 2019 =\n* <strong>Purge</script>: Purge All no longer includes Purge CCSS/Placeholder.\n* <strong>3rd</strong>: Divi Theme Builder no longer experiences nonce expiration issues in the contact form widget. (#475461)\n\n= 2.9.7 - Apr 1 2019 =\n* \ud83c\udf31\ud83c\udf31\ud83c\udf31 QUIC.cloud CDN feature. Now Apache/Nginx can use LiteSpeed cache freely.\n\n= 2.9.6 - Mar 27 2019 =\n* \ud83c\udf31<strong>IAPI</strong>: Appended XMP to `Preserve EXIF data` setting. WebP will now honor this setting. (#902219)\n* <strong>Object</script>: Fixed SASL connection with LSMCD.\n* <strong>ESI</strong>: Converted ESI URI parameters to JSON; Added ESI validation.\n* <strong>Import</strong>: Import/Export will now use JSON format. <strong>Please re-export any backed up settings. Previous backup format is no longer recognized.</strong>\n* <strong>Media</strong>: WebP replacement will honor `Role Excludes` setting now. (@mfazio26)\n* <strong>Data</strong>: Forbid direct visit to const.default.ini.\n* <strong>Utility</strong>: Can handle WHM passed in `LITESPEED_ERR` constant now.\n* <strong>IAPI</strong>: Communicate via JSON encoding.\n* <strong>IAPI</strong>: IAPI v2.9.6.\n\n= 2.9.5 - Mar 14 2019 =\n* \ud83c\udf31 Auto convert default WordPress nonce to ESI to avoid expiration.\n* \ud83c\udf31 <strong>API</strong>: Ability to easily convert custom nonce to ESI by registering `LiteSpeed_Cache_API::nonce_action`.\n* <strong>OPTM</strong>: Tweaked redundant attr `data-no-optimize` in func `_analyse_links` to `data-ignore-optimize` to offer the API to bypass optimization but still move src to top of source code.\n* <strong>API</strong>: Renamed default nonce ESI ID from `lscwp_nonce_esi` to `nonce`.\n* <strong>API</strong>: Added WebP generation & validation hook API. (@alim #wp-stateless)\n* <strong>API</strong>: Added hook to bypass vary commenter check. (#wpdiscuz)\n* <strong>Doc</strong>: Clarified Cache Mobile description. (@JohnnyNguyen)\n* <strong>Doc</strong>: Replaced incorrect link in description. (@JohnnyNguyen)\n* <strong>3rd</strong>: Improved wpDiscuz compatibility.\n* \ud83d\udc1e<strong>3rd</strong>: Fixed Divi Theme Builder comment compatibility on non-builder pages. (#410919)\n* <strong>3rd</strong>: Added YITH ESI adjustment.\n\n= 2.9.4.1 - Feb 28 2019 =\n* \ud83d\udd25\ud83d\udc1e<strong>Tag</strong>: Fixed issue where unnecessary warning potentially displayed after upgrade process when object cache is enabled.\n\n= 2.9.4 - Feb 27 2019 =\n* \ud83d\udc1e<strong>REST</strong>: New REST class with better WP5 Gutenberg and internal REST call support when ESI is embedded.\n* <strong>ESI</strong>: ESI block ID is now in plain text in ESI URL parameters.\n* \ud83d\udc1e<strong>ESI</strong>: Fixed a redundant ESI 301 redirect when comma is in ESI URL.\n* <strong>ESI</strong>: REST call can now parse shortcodes in ESI.\n* <strong>API</strong>: Changed ESI `parse_esi_param()` function to private and `load_esi_block` function to non-static.\n* <strong>API</strong>: Added `litespeed_is_json` hook for buffer JSON conversion.\n* <strong>GUI</strong>: Prepended plugin name to new version notification banner.\n* <strong>3rd</strong>: WPML multi domains can now be handled in optimization without CDN tricks.\n\n= 2.9.3 - Feb 20 2019 =\n* <strong>ESI</strong>: ESI shortcodes can now be saved in Gutenberg editor.\n* <strong>ESI</strong>: ESI now honors the parent page JSON data type to avoid breaking REST calls (LSWS 5.3.6+).\n* <strong>ESI</strong>: Added is_json parameter support for admin_bar.\n* <strong>ESI</strong>: Simplified comment form code.\n* <strong>3rd</strong>: Better page builder plugin compatibility within AJAX calls.\n* <strong>3rd</strong>: Compatibility with FacetWP (LSWS 5.3.6+).\n* <strong>3rd</strong>: Compatibility with Beaver Builder.\n* <strong>Debug</strong>: Added ESI buffer content to log.\n* <strong>Tag</strong>: Only append blog ID to cache tags when site is part of a network.\n* <strong>IAPI</strong>: Optimized database query for pulling images.\n* <strong>GUI</strong>: Added more plugin version checking for better feature compatibility.\n* <strong>GUI</strong>: Ability to bypass non-critical banners with the file .litespeed_no_banner.\n* <strong>Media</strong>: Background image WebP replacement now supports quotes around src.\n\n= 2.9.2 - Feb 5 2019 =\n* <strong>API</strong>: Add a hook `litespeed_esi_shortcode-*` for ESI shortcodes.\n* <strong>3rd</strong>: WooCommerce can purge products now when variation stock is changed.\n* \ud83d\udc1e\ud83d\udd77\ufe0f: Forced HTTP1.1 for crawler due to a CURL HTTP2 bug.\n\n= 2.9.1 - Jan 25 2019 =\n* <strong>Compatibility</strong>: Fixed fatal error for PHP 5.3.\n* <strong>Compatibility</strong>: Fixed PHP warning in htmlspecialchars when building URLs. (@souljahn2)\n* <strong>Media</strong>: Excluded invalid image src from lazyload. (@andrew55)\n* <strong>Optm</strong>: Improved URL compatibility when detecting closest cloud server.\n* <strong>ESI</strong>: Supported JSON format comment format in ESI with `is_json` parameter.\n* <strong>API</strong>: Added filters to CCSS/CSS/JS content. (@lhoucine)\n* <strong>3rd</strong>: Improved comment compatibility with Elegant Divi Builder.\n* <strong>IAPI</strong>: New Europe Image Optimization server (EU5). <strong>Please whitelist the new [IAPI IP List](https://wp.api.litespeedtech.com/ips).</strong>\n* <strong>GUI</strong>: No longer show banners when `Disable All` in `Debug` is ON. (@rabbitwordpress)\n* <strong>GUI</strong>: Fixed button style for RTL languages.\n* <strong>GUI</strong>: Removed unnecessary translation in report.\n* <strong>GUI</strong>: Updated readme wiki links.\n* <strong>GUI</strong>: Fixed pie styles in image optimization page.\n\n= 2.9 - Dec 31 2018 =\n* \ud83c\udf31<strong>Media</strong>: Lazy Load Image Classname Excludes. (@thinkmedia)\n* \ud83c\udf31: New EU/AS cloud servers for faster image optimization handling.\n* \ud83c\udf31: New EU/AS cloud servers for faster CCSS generation.\n* \ud83c\udf31: New EU/AS cloud servers for faster responsive placeholder generation.\n* \ud83c\udf31<strong>Conf</strong>: Ability to set single options via link.\n* \ud83c\udf31<strong>Cache</strong>: Ability to add custom TTLs to Force Cache URIs.\n* <strong>Purge</strong>: Added post type to Purge tags.\n* <strong>Purge</strong>: Redefined CCSS page types.\n* <strong>Core</strong>: Using Exception for .htaccess R/W.\n* <strong>IAPI</strong>: <strong>New cloud servers added. Please whitelist the new [IAPI IP List](https://wp.api.litespeedtech.com/ips).</strong>\n* <strong>Optm</strong>: Trim BOM when detecting if the page is HTML.\n* <strong>GUI</strong>: Added PageSpeed Score comparison into promotion banner.\n* <strong>GUI</strong>: Refactored promotion banner logic.\n* <strong>GUI</strong>: Removed page optimized comment when ESI Silence is requested.\n* <strong>GUI</strong>: WHM transient changed to option instead of transient when storing.\n* <strong>GUI</strong>: Appending more descriptions to CDN filetype setting.\n* <strong>IAPI</strong>: Removed duplicate messages.\n* <strong>IAPI</strong>: Removed taken_failed/client_pull(duplicated) status.\n* <strong>Debug</strong>: Environment report no longer generates hash for validation.\n* <strong>3rd</strong>: Non-cacheable pages no longer punch ESI holes for Divi compatibility.\n* \ud83d\udc1e<strong>Network</strong>: Added slashes for mobile rules when activating plugin.\n* \ud83d\udc1e<strong>CCSS</strong>: Eliminated a PHP notice when appending CCSS.\n\n= 2.8.1 - Dec 5 2018 =\n* \ud83d\udc1e\ud83d\udd77\ufe0f: Fixed an activation warning related to cookie crawler. (@kacper3355 @rastel72)\n* \ud83d\udc1e<strong>Media</strong>: Replace safely by checking if pulled images is empty or not first. (@Monarobase)\n* <strong>3rd</strong>: Shortcode ESI compatibility with Elementor.\n\n= 2.8 - Nov 30 2018 =\n* \ud83c\udf31: ESI shortcodes.\n* \ud83c\udf31: Mobile crawler.\n* \ud83c\udf31: Cookie crawler.\n* <strong>API</strong>: Can now add `_litespeed_rm_qs=0` to bypass Remove Query Strings.\n* <strong>Optm</strong>: Removed error log when minify JS failed.\n* \ud83d\udc1e<strong>Core</strong>: Fixed a bug that caused network activation PHP warning.\n* <strong>Media</strong>: Removed canvas checking for WebP to support TOR. (@odeskumair)\n* <strong>Media</strong>: Eliminated potential image placeholder PHP warning.\n* <strong>3rd</strong>: Bypassed Google recaptcha from Remove Query Strings for better compatibility.\n* <strong>IAPI</strong>: Showed destroy timeout details.\n* <strong>Debug</strong>: Moved Google Fonts log to advanced level.\n* <strong>GUI</strong>: Replaced all Learn More links for functions.\n* <strong>GUI</strong>: Cosmetic updates including Emoji.\n* \ud83d\udd77\ufe0f: Removed duplicated data in sitemap and blacklist.\n\n= 2.7.3 - Nov 26 2018 =\n* <strong>Optm</strong>: Improved page render speed with Web Font Loader JS library for Load Google Fonts Asynchronously.\n* <strong>Optm</strong>: Directly used JS library files in plugin folder instead of short links `/min/`.\n* <strong>Optm</strong>: Handled exceptions in JS optimization when meeting badly formatted JS.\n* <strong>3rd</strong>: Added Adobe Lightroom support for NextGen Gallery.\n* <strong>3rd</strong>: Improved Postman app support for POST JSON requests.\n* <strong>IAPI</strong>: <strong>US3 server IP changed to 68.183.60.185</strong>.\n\n= 2.7.2 - Nov 19 2018 =\n* \ud83c\udf31: Auto Upgrade feature.\n* <strong>CDN</strong>: Bypass CDN for cron to avoid WP jQuery deregister warning.\n\n= 2.7.1 - Nov 15 2018 =\n* \ud83c\udf31<strong>CLI</strong>: Ability to set CDN mapping by `set_option litespeed-cache-cdn_mapping[url][0] https://url`.\n* \ud83c\udf31<strong>CDN</strong>: Ability to customize default CDN mapping data in default.ini.\n* \ud83c\udf31<strong>API</strong>: Default.ini now supports both text-area items and on/off options.\n* <strong>Vary</strong>: Refactored Vary and related API.\n* <strong>Vary</strong>: New hook to manipulate vary cookies value.\n* <strong>Core</strong>: Activation now can generate Object Cache file.\n* <strong>Core</strong>: Unified Object Cache/rewrite rules generation process across activation/import/reset/CLI.\n* <strong>Core</strong>: Always hook activation to make activation available through the front end.\n* \ud83d\udc1e<strong>IAPI</strong>: Fixed a bug where environment report gave incorrect image optimization data.\n* \ud83d\udc1e<strong>OLS</strong>: Fixed a bug where login cookie kept showing a warning on OpenLiteSpeed.\n* \ud83d\udc1e<strong>Core</strong>: Fixed a bug where Import/Activation/CLI was missing CDN mapping settings.\n* <strong>API</strong>: <strong>Filters `litespeed_cache_media_lazy_img_excludes/litespeed_optm_js_defer_exc` passed-in parameter is changed from string to array.</strong>\n\n= 2.7 - Nov 2 2018 =\n* \ud83c\udf31: Separate Purge log for better debugging.\n* <strong>3rd</strong>: Now fully compatible with WPML.\n* <strong>IAPI</strong>: Sped up Image Optimization workflow.\n* <strong>GUI</strong>: Current IP now shows in Debug settings.\n* <strong>GUI</strong>: Space separated placeholder queue list for better look.\n* <strong>IAPI</strong>: <strong>EU3 server IP changed to 165.227.131.98</strong>.\n\n= 2.6.4.1 - Oct 25 2018 =\n* \ud83d\udd25\ud83d\udc1e<strong>Media</strong>: Fixed a bug where the wrong table was used in the Image Optimization process.\n* <strong>IAPI</strong>: IAPI v2.6.4.1.\n\n= 2.6.4 - Oct 24 2018 =\n* \ud83c\udf31: Ability to create custom default config options per hosting company.\n* \ud83c\udf31: Ability to generate mobile Critical CSS.\n* \ud83d\udc1e<strong>Media</strong>: Fixed a bug where Network sites could incorrectly override optimized images.\n* \ud83d\udc1e<strong>CDN</strong>: Fixed a bug where image URLs containing backslashes were matched.\n* <strong>Cache</strong>: Added default Mobile UA config setting.\n* <strong>GUI</strong>: Fixed unknown shortcut characters for non-English languages Setting tabs.\n\n= 2.6.3 - Oct 18 2018 =\n* \ud83c\udf31: Ability to Reset All Options.\n* \ud83c\udf31<strong>CLI</strong>: Added new `lscache-admin reset_options` command.\n* <strong>GUI</strong>: Added shortcuts for more of the Settings tabs.\n* <strong>Media</strong>: Updated Lazy Load JS library to the most recent version.\n* There is no longer any need to explicitly Save Settings upon Import.\n* Remove Query String now will remove *all* query strings in JS/CSS static files.\n* <strong>IAPI</strong>: Added summary info to debug log.\n\n= 2.6.2 - Oct 11 2018 =\n* <strong>Setting</strong>: Automatically correct invalid numeric values in configuration settings upon submit.\n* \ud83d\udc1e<strong>Media</strong>: Fixed the issue where iframe lazy load was broken by latest Chrome release. (@ofmarconi)\n* \ud83d\udc1e: Fixed an issue with Multisite where subsites failed to purge when only primary site has WooCommerce . (@kierancalv)\n\n= 2.6.1 - Oct 4 2018 =\n* \ud83c\udf31: Ability to generate separate Critical CSS Cache for Post Types & URIs.\n* <strong>API</strong>: Filter `litespeed_frontend_htaccess` for frontend htaccess path.\n* <strong>Media</strong>: Removed responsive placeholder generation history to save space.\n\n= 2.6.0.1 - Sep 24 2018 =\n* \ud83d\udd25\ud83d\udc1e: Fixed an issue in responsive placeholder generation where redundant history data was being saved and using a lot of space.\n\n= 2.6 - Sep 22 2018 =\n* <strong>Vary</strong>: Moved `litespeed_cache_api_vary` hook outside of OLS condition for .htaccess generation.\n* <strong>CDN</strong>: Trim spaces in original URL of CDN setting.\n* <strong>API</strong>: New filter `litespeed_option_` to change all options dynamically.\n* <strong>API</strong>: New `LiteSpeed_Cache_API::force_option()` to change all options dynamically.\n* <strong>API</strong>: New `LiteSpeed_Cache_API::vary()` to set default vary directly for easier compaitiblity with WPML WooCommerce Multilingual.\n* <strong>API</strong>: New `LiteSpeed_Cache_API::nonce()` to safely and easily allow caching of wp-nonce.\n* <strong>API</strong>: New `LiteSpeed_Cache_API::hook_vary_add()` to add new vary.\n* <strong>Optm</strong>: Changed HTML/JS/CSS optimization options assignment position from constructor to `finalize()`.\n* <strong>Doc</strong>: Added nonce to FAQ and mentioned nonce in 3rd Party Compatibility section.\n* <strong>GUI</strong>: Moved inline minify to under html minify due to the dependency.\n* <strong>3rd</strong>: Cached Aelia CurrencySwitcher by default.\n* \ud83d\udc1e: Fixed issue where enabling remote JQuery caused missing jquery-migrate library error.\n\n= 2.5.1 - Sep 11 2018 =\n* \ud83c\udf31 Responsive placeholder. (@szmigieldesign)\n* Changed CSS::ccss_realpath function scope to private.\n* \ud83d\udc1e Detected JS filetype before optimizing to avoid PHP source conflict. (@closte #50)\n\n= 2.5 - Sep 6 2018 =\n* [IMPROVEMENT] <strong>CLI</strong> can now execute Remove Original Image Backups. (@Shon)\n* [UPDATE] Fixed issue where WP-PostViews documentation contained extra slashes. (#545638)\n* [UPDATE] Check LITESPEED_SERVER_TYPE for more accurate LSCache Disabled messaging.\n* [IAPI] Fixed a bug where optimize/fetch error notification was not being received. (@LucasRolff)\n\n= 2.4.4 - Aug 31 2018 =\n* [NEW] <strong>CLI</strong> can now support image optimization. (@Shon)\n* [IMPROVEMENT] <strong>GUI</strong> Cron/CLI will not create admin message anymore.\n* [UPDATE] <strong>Media</strong> Fixed a PHP notice that appeared when pulling optimized images.\n* [UPDATE] Fixed a PHP notice when detecting origin of ajax call. (@iosoft)\n* [DEBUG] Debug log can now log referer URL.\n* [DEBUG] Changes to options will now be logged.\n\n= 2.4.3 - Aug 27 2018 =\n* [NEW] <strong>Media</strong> Ability to inline image lazyload JS library. (@Music47ell)\n* [IMPROVEMENT] <strong>Media</strong> Deleting images will now clear related optimization file & info too.\n* [IMPROVEMENT] <strong>Media</strong> Non-image postfix data will now be bypassed before sending image optimization request.\n* [BUGFIX] <strong>CDN</strong> CDN URL will no longer be replaced during admin ajax call. (@pankaj)\n* [BUGFIX] <strong>CLI</strong> WPCLI can now save options without incorrectly clearing textarea items. (@Shon)\n* [GUI] Moved Settings above Manage on the main menu.\n\n= 2.4.2 - Aug 21 2018 =\n* [IMPROVEMENT] <strong>Media</strong> Sped up Image Optimization process by replacing IAPI server pull communication.\n* [IMPROVEMENT] <strong>Media</strong> Ability to delete optimized WebP/original image by item in Media Library. (@redgoodapple)\n* [IMPROVEMENT] <strong>CSS Optimize</strong> Generate new optimized CSS name based on purge timestamp. Allows CSS cache to be cleared for visitors. (@bradbrownmagic)\n* [IMPROVEMENT] <strong>API</strong> added litespeed_img_optm_options_per_image. (@gintsg)\n* [UPDATE] Stopped showing \"No Image Found\" message when all images have finished optimization. (@knutsp)\n* [UPDATE] Improved a PHP warning when saving settings. (@sergialarconrecio)\n* [UPDATE] Changed backend adminbar icon default behavior from Purge All to Purge LSCache.\n* [UPDATE] Clearing CCSS cache will clear unfinished queue too.\n* [UPDATE] Added \"$\" exact match when adding URL by frontend adminbar dropdown menu, to avoid affecting any sub-URLs.\n* [UPDATE] Fixed IAPI error message showing array bug. (@thiomas)\n* [UPDATE] Debug Disable All will do a Purge All.\n* [UPDATE] <strong>Critical CSS server IP changed to 142.93.3.57</strong>.\n* [GUI] Showed plugin update link for IAPI version message.\n* [GUI] Bypassed null IAPI response message.\n* [GUI] Grouped related settings with indent.\n* [IAPI] Added 503 handler for IAPI response.\n* [IAPI] IAPI v2.4.2.\n* [IAPI] <strong>Center Server IP Changed from 34.198.229.186 to 142.93.112.87</strong>.\n\n= 2.4.1 - Jul 19 2018 =\n* [NEW FEATURE] <strong>Media</strong> Auto Level Up. Auto refill credit.\n* [NEW FEATURE] <strong>Media</strong> Auto delete original backups after pulled. (@borisov87 @JMCA2)\n* [NEW FEATURE] <strong>Media</strong> Auto request image optimization. (@ericsondr)\n* [IMPROVEMENT] <strong>Media</strong> Fetch 404 error will notify client as other errors.\n* [IMPROVEMENT] <strong>Media</strong> Support WebP for PageSpeed Insights. (@LucasRolff)\n* [BUGFIX] <strong>CLI</strong> Fixed the issue where CLI import/export caused certain textarea settings to be lost. (#767519)\n* [BUGFIX] <strong>CSS Optimize</strong> Fixed the issue that duplicated optimized CSS and caused rapid expansion of CSS cache folder.\n* [GUI] <strong>Media</strong> Refactored operation workflow and interface.\n* [UPDATE] <strong>Media</strong> Set timeout seconds to avoid pulling timeout. (@Jose)\n* [UPDATE] <strong>CDN</strong>Fixed the notice when no path is in URL. (@sabitkamera)\n* [UPDATE] <strong>Media</strong> Auto correct credits when pulling.\n* [UPDATE] <strong>GUI</strong> Removed redundant double quote in gui.cls. (@DaveyJake)\n* [IAPI] IAPI v2.4.1.\n* [IAPI] Allow new error status notification and success message from IAPI.\n\n= 2.4 - Jul 2 2018 =\n* [NEW FEATURE] <strong>Media</strong> Added lossless optimization.\n* [NEW FEATURE] <strong>Media</strong> Added Request Orignal Images ON/OFF.\n* [NEW FEATURE] <strong>Media</strong> Added Request WebP ON/OFF. (@JMCA2)\n* [IMPROVEMENT] <strong>Media</strong> Improved optimization tools to archive maximum compression and score.\n* [IMPROVEMENT] <strong>Media</strong> Improved speed of image pull.\n* [IMPROVEMENT] <strong>Media</strong> Automatically recover credit after pulled.\n* [REFACTOR] <strong>Config</strong> Separated configure const class.\n* [BUGFIX] <strong>Report</strong> Report can be sent successfully with emoji now. (@music47ell)\n* [IAPI] New Europe Image Optimization server (EU3/EU4).\n* [IAPI] New America Image Optimization server (US3/US4/US5/US6).\n* [IAPI] New Asian Image Optimization server (AS3).\n* [IAPI] Refactored optimization process.\n* [IAPI] Increased credit limit.\n* [IAPI] Removed request interval limit.\n* [IAPI] IAPI v2.4.\n* <strong>We strongly recommended that you re-optimize your image library to get a better compression result</strong>.\n\n= 2.3.1 - Jun 18 2018 =\n* [IMPROVEMENT] New setting to disable Generate Critical CSS. (@cybmeta)\n* [IMPROVEMENT] Added filter to can_cdn/can_optm check. (@Jacob)\n* [UPDATE] *Critical CSS* Added 404 css. Limit cron interval.\n* [UPDATE] AJAX will not bypass CDN anymore by default. (@Jacob)\n* [GUI] Show Disable All Features warning if it is on in Debug tab.\n\n= 2.3 - Jun 13 2018 =\n* [NEW FEATURE] Automatically generate critical CSS. (@joeee @ivan_ivanov @3dseo)\n* [BUGFIX] \"Mark this page as...\" from dropdown menu will not reset settings anymore. (@cbratschi)\n\n= 2.2.7 - Jun 4 2018 =\n* [IMPROVEMENT] Improved redirection for manual image pull to avoid too many redirections warning.\n* [IAPI] Increased credit limit.\n* [BUGFIX] Fixed 503 error when enabling log filters in Debug tab. (#525206)\n* [UPDATE] Improve compatibility when using sitemap url on servers with allow_url_open off.\n* [UPDATE] Removed Crawler HTTP2 option due to causing no-cache blacklist issue for certain environments.\n* [UPDATE] Privacy policy can be now translated. (@Josemi)\n* [UPDATE] IAPI Increased default img request max to 3000.\n\n= 2.2.6 - May 24 2018 =\n* [NEW FEATURE] Original image backups can be removed now. (@borisov87 @JMCA2)\n* [BUGFIX] Role Excludes in Tuning tab can save now. (@pako69)\n* [UPDATE] Added privacy policy support.\n\n= 2.2.5 - May 14 2018 =\n* [IAPI] <strong>Image Optimization</strong> New Asian Image Optimization server (AS2).\n* [INTEGRATION] Removed wpForo 3rd party file. (@massimod)\n\n= 2.2.4 - May 7 2018 =\n* [IMPROVEMENT] Improved compatibility with themes using the same js_min library. (#129093 @Darren)\n* [BUGFIX] Fixed a bug when checking image path for dynamic files. (@miladk)\n* [INTEGRATION] Compatibility with Universal Star Rating. (@miladk)\n\n= 2.2.3 - Apr 27 2018 =\n* [NEW FEATURE] WebP For Extra srcset setting in Media tab. (@vengen)\n* [REFACTOR] Removed redundant LS consts.\n* [REFACTOR] Refactored adv_cache generation flow.\n* [BUGFIX] Fixed issue where inline JS minify exception caused a blank page. (@oomskaap @kenb1978)\n* [UPDATE] Changed HTTP/2 Crawl default value to OFF.\n* [UPDATE] Added img.data-src to default WebP replacement value for WooCommerce WebP support.\n* [UPDATE] Detached crawler from LSCache LITESPEED_ON status.\n* [API] Improved ESI API to honor the cache control in ESI wrapper.\n* [API] Added LITESPEED_PURGE_SILENT const to bypass the notification when purging\n* [INTEGRATION] Fixed issue with nonce expiration when using ESI API. (#923505 @Dan)\n* [INTEGRATION] Improved compatibility with Ninja Forms by bypassing non-javascript JS from inline JS minify.\n* [INTEGRATION] Added a hook for plugins that change the CSS/JS path e.g. Hide My WordPress.\n\n= 2.2.2 - Apr 16 2018 =\n* [NEW FEATURE] WebP Attribute To Replace setting in Media tab. (@vengen)\n* [IMPROVEMENT] Generate adv_cache file automatically when it is lost.\n* [IMPROVEMENT] Improved compatibility with ajax login. (@veganostomy)\n* [UPDATE] Added object cache lib check in case user downgrades LSCWP to non-object-cache versions.\n* [UPDATE] Avoided infinite loop when users enter invalid hook values in Purge All Hooks settings.\n* [UPDATE] Updated log format in media&cdn class.\n* [UPDATE] Added more items to Report.\n\n= 2.2.1 - Apr 10 2018 =\n* [NEW FEATURE] Included Directories setting in CDN tab. (@Dave)\n* [NEW FEATURE] Purge All Hooks setting in Advanced tab.\n* [UPDATE] Added background-image WebP replacement support. (@vengen)\n* [UPDATE] Show recommended values for textarea items in settings.\n* [UPDATE] Moved CSS/JS optimizer log to Advanced level.\n* [INTEGRATION] Added WebP support for Avada Fusion Sliders. (@vengen)\n\n= 2.2.0.2 - Apr 3 2018 =\n* [HOTFIX] <strong>Object Cache</strong> Fixed the PHP warning caused by previous improvement to Object Cache.\n\n= 2.2.0.1 - Apr 3 2018 =\n* [HOTFIX] Object parameter will no longer cause warnings to be logged for Purge and Cache classes. (@kelltech @khrifat)\n* [UPDATE] Removed duplicated del_file func from Object Cache class.\n* [BUGFIX] `CLI` no longer shows 400 error upon successful result.\n\n= 2.2 - Apr 2 2018 =\n* [NEW FEATURE] <strong>Debug</strong> Disable All Features setting in Debug tab. (@monarobase)\n* [NEW FEATURE] <strong>Cache</strong> Force Cacheable URIs setting in Excludes tab.\n* [NEW FEATURE] <strong>Purge</strong> Purge all LSCache and other caches in one link.\n* [REFACTOR] <strong>Purge</strong> Refactored Purge class.\n* [BUGFIX] Query strings in DoNotCacheURI setting now works.\n* [BUGFIX] <strong>Cache</strong> Mobile cache compatibility with WebP vary. (@Shivam #987121)\n* [UPDATE] <strong>Purge</strong> Moved purge_all to Purge class from core class.\n* [API] Set cacheable/Set force cacheable. (@Jacob)\n\n= 2.1.2 - Mar 28 2018 =\n* [NEW FEATURE] <strong>Image Optimization</strong> Clean Up Unfinished Data feature.\n* [IAPI] IAPI v2.1.2.\n* [IMPROVEMENT] <strong>CSS/JS Minify</strong> Reduced loading time significantly by improving CSS/JS minify loading process. (@kokers)\n* [IMPROVEMENT] <strong>CSS/JS Minify</strong> Cache empty JS Minify content. (@kokers)\n* [IMPROVEMENT] <strong>Cache</strong> Cache 301 redirect when scheme/host are same.\n* [BUGFIX] <strong>Media</strong> Lazy load now can support WebP. (@relle)\n* [UPDATE] <strong>CSS/JS Optimize</strong> Serve static files for CSS async & lazy load JS library.\n* [UPDATE] <strong>Report</strong> Appended Basic/Advanced View setting to Report.\n* [UPDATE] <strong>CSS/JS Minify</strong> Removed zero-width space from CSS/JS content.\n* [GUI] Added Purge CSS/JS Cache link in Admin.\n\n= 2.1.1.1 - Mar 21 2018 =\n* [BUGFIX] Fixed issue where activation failed to add rules to .htaccess.\n* [BUGFIX] Fixed issue where 304 header was blank on feed page refresh.\n\n= 2.1.1 - Mar 20 2018 =\n* [NEW FEATURE] <strong>Browser Cache</strong> Unlocked for non-LiteSpeed users.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Fixed issue where images with bad postmeta value continued to show in not-yet-requested queue.\n\n= 2.1 - Mar 15 2018 =\n* [NEW FEATURE] <strong>Image Optimization</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>Object Cache</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>Crawler</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>Database Cleaner and Optimizer</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>Lazy Load Images</strong> Unlocked for non-LiteSpeed users.\n* [NEW FEATURE] <strong>CSS/JS/HTML Minify/Combine Optimize</strong> Unlocked for non-LiteSpeed users.\n* [IAPI] IAPI v2.0.\n* [IAPI] Increased max rows prefetch when client has additional credit.\n* [IMPROVEMENT] <strong>CDN</strong> Multiple domains may now be used.\n* [IMPROVEMENT] <strong>Report</strong> Added WP environment constants for better debugging.\n* [REFACTOR] Separated Cloudflare CDN class.\n* [BUGFIX] <strong>Image Optimization</strong> Fixed issue where certain MySQL version failed to create img_optm table. (@philippwidmer)\n* [BUGFIX] <strong>Image Optimization</strong> Fixed issue where callback validation failed when pulling and sending request simultaneously.\n* [GUI] Added Slack community banner.\n* [INTEGRATION] CDN compatibility with WPML multiple domains. (@egemensarica)\n\n= 2.0 - Mar 7 2018 =\n* [NEW FEATURE] <strong>Image Optimization</strong> Added level up guidance.\n* [REFACTOR] <strong>Image Optimization</strong> Refactored Image Optimization class.\n* [IAPI] <strong>Image Optimization</strong> New European Image Optimization server (EU2).\n* [IMPROVEMENT] <strong>Image Optimization</strong> Manual pull action continues pulling until complete.\n* [IMPROVEMENT] <strong>CDN</strong> Multiple CDNs can now be randomized for a single resource.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Improved compatibility of long src images.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Reduced runtime load.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Avoid potential loss/reset of notified images status when pulling.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Avoid duplicated optimization for multiple records in Media that have the same image source.\n* [IMPROVEMENT] <strong>Image Optimization</strong> Fixed issue where phantom images continued to show in not-yet-requested queue.\n* [BUGFIX] <strong>Core</strong> Improved compatibility when upgrading outside of WP Admin. (@jikatal @TylorB)\n* [BUGFIX] <strong>Crawler</strong> Improved HTTP/2 compatibility to avoid erroneous blacklisting.\n* [BUGFIX] <strong>Crawler</strong> Changing Delay setting will use server variable for min value validation if set.\n* [UPDATE] <strong>Crawler</strong> Added HTTP/2 protocol switch in the Crawler settings.\n* [UPDATE] Removed unnecessary translation strings.\n* [GUI] Display translated role group name string instead of English values. (@Richard Hordern)\n* [GUI] Added Join LiteSpeed Slack link.\n* [GUI] <strong>Import / Export</strong> Cosmetic changes to Import Settings file field.\n* [INTEGRATION] Improved compatibility with WPML Media for Image Optimization. (@szmigieldesign)\n\n= 1.9.1.1 - February 20 2018 =\n* [Hotfix] Removed empty crawler when no role simulation is set.\n\n= 1.9.1 - February 20 2018 =\n* [NEW FEATURE] Role Simulation crawler.\n* [NEW FEATURE] WebP multiple crawler.\n* [NEW FEATURE] HTTP/2 support for crawler.\n* [BUGFIX] Fixed a js bug with the auto complete mobile user agents field when cache mobile is turned on.\n* [BUGFIX] Fixed a constant undefined warning after activation.\n* [GUI] Sitemap generation settings are no longer hidden when using a custom sitemap.\n\n= 1.9 - February 12 2018 =\n* [NEW FEATURE] Inline CSS/JS Minify.\n* [IMPROVEMENT] Removed Composer vendor to thin the plugin folder.\n* [UPDATE] Tweaked H2 to H1 in Admin headings for accessibility. (@steverep)\n* [GUI] Added Mobile User Agents to basic view.\n* [GUI] Moved Object Cache & Browser Cache from Cache tab to Advanced tab.\n* [GUI] Moved LSCache Purge All from Adminbar to dropdown menu.\n\n= 1.8.3 - February 2 2018 =\n* [NEW FEATURE] Crawler server variable limitation support.\n* [IMPROVEMENT] Added Store Transients option to fix transients missing issue when Cache Wp-Admin setting is OFF.\n* [IMPROVEMENT] Tweaked ARIA support. (@steverep)\n* [IMPROVEMENT] Used strpos instead of strncmp for performance. (@Zach E)\n* [BUGFIX] Transient cache can now be removed when the Cache Wp-Admin setting is ON in Object Cache.\n* [BUGFIX] Network sites can now save Advanced settings.\n* [BUGFIX] Media list now shows in network sites.\n* [BUGFIX] Show Crawler Status button is working again.\n* [UPDATE] Fixed a couple of potential PHP notices in the Network cache tab and when no vary group is set.\n* [GUI] Added Learn More link to all setting pages.\n\n= 1.8.2 - January 29 2018 =\n* [NEW FEATURE] Instant Click in the Advanced tab.\n* [NEW FEATURE] Import/Export settings.\n* [NEW FEATURE] Opcode Cache support.\n* [NEW FEATURE] Basic/Advanced setting view.\n* [IMPROVEMENT] Added ARIA support in widget settings.\n* [BUGFIX] Multiple WordPress instances with same Object Cache address will no longer see shared data.\n* [BUGFIX] WebP Replacement may now be set at the Network level.\n* [BUGFIX] Object Cache file can now be removed at the Network level uninstall.\n\n= 1.8.1 - January 22 2018 =\n* [NEW FEATURE] Object Cache now supports Redis.\n* [IMPROVEMENT] Memcached Object Cache now supports authorization.\n* [IMPROVEMENT] A 500 error will no longer be encountered when turning on Object Cache without the proper PHP extension installed.\n* [BUGFIX] Object Cache settings can now be saved at the Network level.\n* [BUGFIX] Mu-plugin now supports Network setting.\n* [BUGFIX] Fixed admin bar showing inaccurate Edit Page link.\n* [UPDATE] Removed warning information when no Memcached server is available.\n\n= 1.8 - January 17 2018 =\n* [NEW FEATURE] Object Cache.\n* [REFACTOR] Refactored Log class.\n* [REFACTOR] Refactored LSCWP basic const initialization.\n* [BUGFIX] Fixed Cloudflare domain search breaking when saving more than 50 domains under a single account.\n* [UPDATE] Log filter settings are now their own item in the wp-option table.\n\n= 1.7.2 - January 5 2018 =\n* [NEW FEATURE] Cloudflare API support.\n* [IMPROVEMENT] IAPI key can now be reset to avoid issues when domain is changed.\n* [BUGFIX] Fixed JS optimizer breaking certain plugins JS.\n* [UPDATE] Added cdn settings to environment report.\n* [GUI] Added more shortcuts to backend adminbar.\n* [INTEGRATION] WooCommerce visitors are now served from public cache when cart is empty.\n\n= 1.7.1.1 - December 29 2017 =\n* [BUGFIX] Fixed an extra trailing underscore issue when saving multiple lines with DNS Prefetch.\n* [UPDATE] Cleaned up unused dependency vendor files.\n\n= 1.7.1 - December 28 2017 =\n* [NEW FEATURE] Added DNS Prefetch setting on the Optimize page.\n* [NEW FEATURE] Added Combined File Max Size setting on the Tuning page.\n* [IMPROVEMENT] Improved JS/CSS minify to achieve higher page scores.\n* [IMPROVEMENT] Optimized JS/CSS files will not be served from private cache for OLS or with ESI off.\n* [UPDATE] Fixed a potential warning for new installations on the Settings page.\n* [UPDATE] Fixed an issue with guest users occasionally receiving PHP warnings.\n* [BUGFIX] Fixed a bug with the Improve HTTPS Compatibility setting failing to save.\n* Thanks to all of our users for your encouragement and support! Happy New Year!\n* PS: Lookout 2018, we're back!\n\n= 1.7 - December 22 2017 =\n* [NEW FEATURE] Drop Query Strings setting in the Cache tab.\n* [NEW FEATURE] Multiple CDN Mapping in the CDN tab.\n* [IMPROVEMENT] Improve HTTP/HTTPS Compatibility setting in the Advanced tab.\n* [IMPROVEMENT] Keep JS/CSS original position in HTML when excluded in setting.\n* [IAPI] Reset client level credit after Image Optimization data is destroyed.\n* [REFACTOR] Refactored build_input/textarea functions in admin_display class.\n* [REFACTOR] Refactored CDN class.\n* [GUI] Added a notice to Image Optimization and Crawler to warn when cache is disabled.\n* [GUI] Improved image optimization indicator styles in Media Library List.\n\n= 1.6.7 - December 15 2017 =\n* [IAPI] Added ability to scan for new image thumbnail sizes and auto-resend image optimization requests.\n* [IAPI] Added ability to destroy all optimization data.\n* [IAPI] Updated IAPI to v1.6.7.\n* [INTEGRATION] Fixed certain 3rd party plugins calling REST without user nonce causing logged in users to be served as guest.\n\n= 1.6.6.1 - December 8 2017 =\n* [IAPI] Limit first-time submission to one image group for test-run purposes.\n* [BUGFIX] Fixed vary group generation issue associated with custom user role plugins.\n* [BUGFIX] Fixed WooCommerce issue where logged-in users were erroneously purged when ESI is off.\n* [BUGFIX] Fixed WooCommerce cache miss issue when ESI is off.\n\n= 1.6.6 - December 6 2017 =\n* [NEW FEATURE] Preserve EXIF in Media setting.\n* [NEW FEATURE] Clear log button in Debug Log Viewer.\n* [IAPI] Fixed notified images resetting to previous status when pulling.\n* [IAPI] Fixed HTTPS compatibility for image optimization initialization.\n* [IAPI] An error message is now displayed when image optimization request submission is bypassed due to a lack of credit.\n* [IAPI] IAPI v1.6.6.\n* [IMPROVEMENT] Support JS data-no-optimize attribute to bypass optimization.\n* [GUI] Added image group wiki link.\n* [INTEGRATION] Improved compatibility with Login With Ajax.\n* [INTEGRATION] Added function_exists check for WooCommerce to avoid 500 errors.\n\n= 1.6.5.1 - December 1 2017 =\n* [HOTFIX] Fixed warning message on Edit .htaccess page.\n\n= 1.6.5 - November 30 2017 =\n* [IAPI] Manually pull image optimization action button.\n* [IAPI] Automatic credit system for image optimization to bypass unfinished image optimization error.\n* [IAPI] Notify failed images from LiteSpeed's Image Server.\n* [IAPI] Reset/Clear failed images feature.\n* [IAPI] Redesigned report page.\n* [REFACTOR] Moved pull_img logic from admin_api to media.\n* [BUGFIX] Fixed a compatibility issue for clients who have allow_url_open setting off.\n* [BUGFIX] Fixed logged in users sometimes being served from guest cache.\n* [UPDATE] Environment report is no longer saved to a file.\n* [UPDATE] Removed crawler reset notification.\n* [GUI] Added more details on image optimization.\n* [GUI] Removed info page from admin menu.\n* [GUI] Moved environment report from network level to single site level.\n* [GUI] Crawler time added in a user friendly format.\n* [INTEGRATION] Improved compatibility with FacetWP json call.\n\n= 1.6.4 - November 22 2017 =\n* [NEW FEATURE] Send env reports privately with a new built-in report number referral system.\n* [IAPI] Increased request timeout to fix a cUrl 28 timeout issue.\n* [BUGFIX] Fixed a TTL max value validation bug.\n* [INTEGRATION] Improved Contact Form 7 REST call compatibility for logged in users.\n* Thanks for all your ratings. That encouraged us to be more diligent. Happy Thanksgiving.\n\n= 1.6.3 - November 17 2017 =\n* [NEW FEATURE] Only async Google Fonts setting.\n* [NEW FEATURE] Only create WebP images when optimizing setting.\n* [NEW FEATURE] Batch switch images to original/optimized versions in Image Optimization.\n* [NEW FEATURE] Browser Cache TTL setting.\n* [NEW FEATURE] Cache WooCommerce Cart setting.\n* [IMPROVEMENT] Moved optimized JS/CSS snippet in header html to after meta charset.\n* [IMPROVEMENT] Added a constant for better JS/CSS optimization compatibility for different dir WordPress installation.\n* [IAPI] Take over failed callback check instead of bypassing it.\n* [IAPI] Image optimization requests are now limited to 500 images per request.\n* [BUGFIX] Fixed a parsing failure bug not using attributes in html elements with dash.\n* [BUGFIX] Fixed a bug causing non-script code to move to the top of a page when not using combination.\n* [UPDATE] Added detailed logs for external link detection.\n* [UPDATE] Added new lines in footer comment to avoid Firefox crash when enabled HTML minify.\n* [API] `Purge private` / `Purge private all` / `Add private tag` functions.\n* [GUI] Redesigned image optimization operation links in Media Lib list.\n* [GUI] Tweaked wp-admin form save button position.\n* [GUI] Added \"learn more\" link for image optimization.\n\n= 1.6.2.1 - November 6 2017 =\n* [INTEGRATION] Improved compatibility with old WooCommerce versions to avoid unknown 500 errors.\n* [BUGFIX] Fixed WebP images sometimes being used in non-supported browsers.\n* [BUGFIX] Kept query strings for HTTP/2 push to avoid re-fetching pushed sources.\n* [BUGFIX] Excluded JS/CSS from HTTP/2 push when using CDN.\n* [GUI] Fixed a typo in Media list.\n* [GUI] Made more image optimization strings translatable.\n* [GUI] Updated Tuning description to include API documentation.\n\n= 1.6.2 - November 3 2017 =\n* [NEW FEATURE] Do Not Cache Roles.\n* [NEW FEATURE] Use WebP Images for supported browsers.\n* [NEW FEATURE] Disable Optimization Poll ON/OFF Switch in Media tab.\n* [NEW FEATURE] Revert image optimization per image in Media list.\n* [NEW FEATURE] Disable/Enable image WebP per image in Media list.\n* [IAPI] Limit optimized images fetching cron to a single process.\n* [IAPI] Updated IAPI to v1.6.2.\n* [IAPI] Fixed repeating image request issue by adding a failure status to local images.\n* [REFACTOR] Refactored login vary logic.\n\n= 1.6.1 - October 29 2017 =\n* [IAPI] Updated LiteSpeed Image Optimization Server API to v1.6.1.\n\n= 1.6 - October 27 2017 =\n* [NEW FEATURE] Image Optimization.\n* [NEW FEATURE] Role Excludes for Optimization.\n* [NEW FEATURE] Combined CSS/JS Priority.\n* [IMPROVEMENT] Bypass CDN for login/register page.\n* [UPDATE] Expanded ExpiresByType rules to include new font types. ( Thanks to JMCA2 )\n* [UPDATE] Removed duplicated type param in admin action link.\n* [BUGFIX] Fixed CDN wrongly replacing img base64 and \"fake\" src in JS.\n* [BUGFIX] Fixed image lazy load replacing base64 src.\n* [BUGFIX] Fixed a typo in Optimize class exception.\n* [GUI] New Tuning tab in admin settings panel.\n* [REFACTOR] Simplified router by reducing actions and adding types.\n* [REFACTOR] Renamed `run()` to `finalize()` in buffer process.\n\n= 1.5 - October 17 2017 =\n* [NEW FEATURE] Exclude JQuery (to fix inline JS error when using JS Combine).\n* [NEW FEATURE] Load JQuery Remotely.\n* [NEW FEATURE] JS Deferred Excludes.\n* [NEW FEATURE] Lazy Load Images Excludes.\n* [NEW FEATURE] Lazy Load Image Placeholder.\n* [IMPROVEMENT] Improved Lazy Load size attribute for w3c validator.\n* [UPDATE] Added basic caching info and LSCWP version to HTML comment.\n* [UPDATE] Added debug log to HTML detection.\n* [BUGFIX] Fixed potential font CORS issue when using CDN.\n* [GUI] Added API docs to setting description.\n* [REFACTOR] Relocated all classes under includes with backwards compatibility.\n* [REFACTOR] Relocated admin templates.\n\n= 1.4 - October 11 2017 =\n* [NEW FEATURE] Lazy load images/iframes.\n* [NEW FEATURE] Clean CSS/JS optimizer data functionality in DB Optimizer panel.\n* [NEW FEATURE] Exclude certain URIs from optimizer.\n* [IMPROVEMENT] Improved optimizer HTML check compatibility to avoid conflicts with ESI functions.\n* [IMPROVEMENT] Added support for using ^ when matching the start of a path in matching settings.\n* [IMPROVEMENT] Added wildcard support in CDN original URL.\n* [IMPROVEMENT] Moved optimizer table initialization to admin setting panel with failure warning.\n* [UPDATE] Added a one-time welcome banner.\n* [UPDATE] Partly relocated class: 'api'.\n* [API] Added API wrapper for removing wrapped HTML output.\n* [INTEGRATION] Fixed WooCommerce conflict with optimizer.\n* [INTEGRATION] Private cache support for WooCommerce v3.2.0+.\n* [GUI] Added No Optimization menu to frontend.\n\n= 1.3.1.1 - October 6 2017 =\n* [BUGFIX] Improved optimizer table creating process in certain database charset to avoid css/js minify/combination failure.\n\n= 1.3.1 - October 5 2017 =\n* [NEW FEATURE] Remove WP Emoji Option.\n* [IMPROVEMENT] Separated optimizer data from wp_options to improve compatibility with backup plugins.\n* [IMPROVEMENT] Enhanced crawler cron hook to prevent de-scheduling in some cases.\n* [IMPROVEMENT] Enhanced Remove Query Strings to also remove Emoji query strings.\n* [IMPROVEMENT] Enhanced HTML detection when extra spaces are present at the beginning.\n* [UPDATE] Added private cache support for OLS.\n* [BUGFIX] Self-redirects are no longer cached.\n* [BUGFIX] Fixed css async lib warning when loading in HTTP/2 push.\n\n= 1.3 - October 1 2017 =\n* [NEW FEATURE] Added Browser Cache support.\n* [NEW FEATURE] Added Remove Query Strings support.\n* [NEW FEATURE] Added Remove Google Fonts support.\n* [NEW FEATURE] Added Load CSS Asynchronously support.\n* [NEW FEATURE] Added Load JS Deferred support.\n* [NEW FEATURE] Added Critical CSS Rules support.\n* [NEW FEATURE] Added Private Cached URIs support.\n* [NEW FEATURE] Added Do Not Cache Query Strings support.\n* [NEW FEATURE] Added frontend adminbar shortcuts ( Purge this page/Do Not Cache/Private cache ).\n* [IMPROVEMENT] Do Not Cache URIs now supports full URLs.\n* [IMPROVEMENT] Improved performance of Do Not Cache settings.\n* [IMPROVEMENT] Encrypted vary cookie.\n* [IMPROVEMENT] Enhanced HTML optimizer.\n* [IMPROVEMENT] Limited combined file size to avoid heavy memory usage.\n* [IMPROVEMENT] CDN supports custom upload folder for media files.\n* [API] Added purge single post API.\n* [API] Added version compare API.\n* [API] Enhanced ESI API for third party plugins.\n* [INTEGRATION] Compatibility with NextGEN Gallery v2.2.14.\n* [INTEGRATION] Compatibility with Caldera Forms v1.5.6.2+.\n* [BUGFIX] Fixed CDN&Minify compatibility with css url links.\n* [BUGFIX] Fixed .htaccess being regenerated despite there being no changes.\n* [BUGFIX] Fixed CDN path bug for subfolder WP instance.\n* [BUGFIX] Fixed crawler path bug for subfolder WP instance with different site url and home url.\n* [BUGFIX] Fixed a potential Optimizer generating redundant duplicated JS in HTML bug.\n* [GUI] Added a more easily accessed submit button in admin settings.\n* [GUI] Admin settings page cosmetic changes.\n* [GUI] Reorganized GUI css/img folder structure.\n* [REFACTOR] Refactored configuration init.\n* [REFACTOR] Refactored admin setting save.\n* [REFACTOR] Refactored .htaccess operator and rewrite rule generation.\n\n= 1.2.3.1 - September 20 2017 =\n* [UPDATE] Improved PHP5.3 compatibility.\n\n= 1.2.3 - September 20 2017 =\n* [NEW FEATURE] Added CDN support.\n* [IMPROVEMENT] Improved compatibility when upgrading by fixing a possible fatal error.\n* [IMPROVEMENT] Added support for custom wp-content paths.\n* [BUGFIX] Fixed non-primary network blogs not being able to minify.\n* [BUGFIX] Fixed HTML Minify preventing Facebook from being able to parse og tags.\n* [BUGFIX] Preview page is no longer cacheable.\n* [BUGFIX] Corrected log and crawler timezone to match set WP timezone.\n* [GUI] Revamp of plugin GUI.\n\n= 1.2.2 - September 15 2017 =\n* [NEW FEATURE] Added CSS/JS minification.\n* [NEW FEATURE] Added CSS/JS combining.\n* [NEW FEATURE] Added CSS/JS HTTP/2 server push.\n* [NEW FEATURE] Added HTML minification.\n* [NEW FEATURE] Added CSS/JS cache purge button in management.\n* [UPDATE] Improved debug log formatting.\n* [UPDATE] Fixed some description typos.\n\n= 1.2.1 - September 7 2017 =\n* [NEW FEATURE] Added Database Optimizer.\n* [NEW FEATURE] Added Tab switch shortcut.\n* [IMPROVEMENT] Added cache disabled check for management pages.\n* [IMPROVEMENT] Renamed .htaccess backup for security.\n* [BUGFIX] Fixed woocommerce default ESI setting bug.\n* [REFACTOR] Show ESI page for OLS with notice.\n* [REFACTOR] Management Purge GUI updated.\n\n= 1.2.0.1 - September 1 2017 =\n* [BUGFIX] Fixed a naming bug for network constant ON2.\n\n= 1.2.0 - September 1 2017 =\n* [NEW FEATURE] Added ESI support.\n* [NEW FEATURE] Added a private cache TTL setting.\n* [NEW FEATURE] Debug level can now be set to either 'Basic' or 'Advanced'.\n* [REFACTOR] Renamed const 'NOTSET' to 'ON2' in class config.\n\n= 1.1.6 - August 23 2017 =\n* [NEW FEATURE] Added option to privately cache logged-in users.\n* [NEW FEATURE] Added option to privately cache commenters.\n* [NEW FEATURE] Added option to cache requests made through WordPress REST API.\n* [BUGFIX] Fixed network 3rd-party full-page cache detection bug.\n* [GUI] New Cache and Purge menus in Settings.\n\n= 1.1.5.1 - August 16 2017 =\n* [IMPROVEMENT] Improved compatibility of frontend&backend .htaccess path detection when site url is different than installation path.\n* [UPDATE] Removed unused format string from header tags.\n* [BUGFIX] 'showheader' Admin Query String now works.\n* [REFACTOR] Cache tags will no longer output if not needed.\n\n= 1.1.5 - August 10 2017 =\n* [NEW FEATURE] Scheduled Purge URLs feature.\n* [NEW FEATURE] Added buffer callback to improve compatibility with some plugins that force buffer cleaning.\n* [NEW FEATURE] Hide purge_all admin bar quick link if cache is disabled.\n* [NEW FEATURE] Required htaccess rules are now displayed when .htaccess is not writable.\n* [NEW FEATURE] Debug log features: filter log support; heartbeat control; log file size limit; log viewer.\n* [IMPROVEMENT] Separate crawler access log.\n* [IMPROVEMENT] Lazy PURGE requests made after output are now queued and working.\n* [IMPROVEMENT] Improved readme.txt with keywords relating to our compatible plugins list.\n* [UPDATE] 'ExpiresDefault' conflict msg is now closeable and only appears in the .htaccess edit screen.\n* [UPDATE] Improved debug log formatting.\n* [INTEGRATION] Compatibility with MainWP plugin.\n* [BUGFIX] Fixed Woocommerce order not purging product stock quantity.\n* [BUGFIX] Fixed Woocommerce scheduled sale price not updating issue.\n* [REFACTOR] Combined cache_enable functions into a single function.\n\n= 1.1.4 - August 1 2017 =\n* [IMPROVEMENT] Unexpected rewrite rules will now show an error message.\n* [IMPROVEMENT] Added Cache Tag Prefix setting info in the Env Report and Info page.\n* [IMPROVEMENT] LSCWP setting link is now displayed in the plugin list.\n* [IMPROVEMENT] Improved performance when setting cache control.\n* [UPDATE] Added backward compatibility for v1.1.2.2 API calls. (used by 3rd-party plugins)\n* [BUGFIX] Fixed WPCLI purge tag/category never succeeding.\n\n= 1.1.3 - July 31 2017 =\n* [NEW FEATURE] New LiteSpeed_Cache_API class and documentation for 3rd party integration.\n* [NEW FEATURE] New API function litespeed_purge_single_post($post_id).\n* [NEW FEATURE] PHP CLI support for crawler.\n* [IMPROVEMENT] Set 'no cache' for same location 301 redirects.\n* [IMPROVEMENT] Improved LiteSpeed footer comment compatibility.\n* [UPDATE] Removed 'cache tag prefix' setting.\n* [BUGFIX] Fixed a bug involving CLI purge all.\n* [BUGFIX] Crawler now honors X-LiteSpeed-Cache-Control for the 'no-cache' header.\n* [BUGFIX] Cache/rewrite rules are now cleared when the plugin is uninstalled.\n* [BUGFIX] Prevent incorrect removal of the advanced-cache.php on deactivation if it was added by another plugin.\n* [BUGFIX] Fixed subfolder WP installations being unable to Purge By URL using a full URL path.\n* [REFACTOR] Reorganized existing code for an upcoming ESI release.\n\n= 1.1.2.2 - July 13 2017 =\n* [BUGFIX] Fixed blank page in Hebrew language post editor by removing unused font-awesome and jquery-ui css libraries.\n\n= 1.1.2.1 - July 5 2017 =\n* [UPDATE] Improved compatibility with WooCommerce v3.1.0.\n\n= 1.1.2 - June 20 2017 =\n* [BUGFIX] Fixed missing form close tag.\n* [UPDATE] Added a wiki link for enabling the crawler.\n* [UPDATE] Improved Site IP description.\n* [UPDATE] Added an introduction to the crawler on the Information page.\n* [REFACTOR] Added more detailed error messages for Site IP and Custom Sitemap settings.\n\n= 1.1.1.1 - June 15 2017 =\n* [BUGFIX] Hotfix for insufficient validation of site IP value in crawler settings.\n\n= 1.1.1 - June 15 2017 =\n* [NEW] As of LiteSpeed Web Server v.5.1.16, the crawler can now be enabled/disabled at the server level.\n* [NEW] Added the ability to provide a custom sitemap for crawling.\n* [NEW] Added ability to use site IP address directly in crawler settings.\n* [NEW] Crawler performance improved with the use of new custom user agent 'lsrunner'.\n* [NEW] \"Purge By URLs\" now supports full URL paths.\n* [NEW] Added thirdparty WP-PostRatings compatibility.\n* [BUGFIX] Cache is now cleared when changing post status from published to draft.\n* [BUGFIX] WHM activation message no longer continues to reappear after being dismissed.\n* [COSMETIC] Display recommended values for settings.\n\n= 1.1.0.1 - June 8 2017 =\n* [UPDATE] Improved default crawler interval setting.\n* [UPDATE] Tested up to WP 4.8.\n* [BUGFIX] Fixed compatibility with plugins that output json data.\n* [BUGFIX] Fixed tab switching bug.\n* [BUGFIX] Removed occasional duplicated messages on save.\n* [COSMETIC] Improved crawler tooltips and descriptions.\n\n= 1.1.0 - June 6 2017 =\n* [NEW] Added a crawler - this includes configuration options and a dedicated admin page. Uses wp-cron\n* [NEW] Added integration for WPLister\n* [NEW] Added integration for Avada\n* [UPDATE] General structure of the plugin revamped\n* [UPDATE] Improved look of admin pages\n* [BUGFIX] Fix any/all wp-content path retrieval issues\n* [BUGFIX] Use realpath to clear symbolic link when determining .htaccess paths\n* [BUGFIX] Fixed a bug where upgrading multiple plugins did not trigger a purge all\n* [BUGFIX] Fixed a bug where cli import_options did not actually update the options.\n* [REFACTOR] Most of the files in the code were split into more, smaller files\n\n= 1.0.15 - April 20 2017 =\n* [NEW] Added Purge Pages and Purge Recent Posts Widget pages options.\n* [NEW] Added wp-cli command for setting and getting options.\n* [NEW] Added an import/export options cli command.\n* [NEW] Added wpForo integration.\n* [NEW] Added Theme My Login integration.\n* [UPDATE] Purge adjacent posts when publish a new post.\n* [UPDATE] Change environment report file to .php and increase security.\n* [UPDATE] Added new purgeby option to wp-cli.\n* [UPDATE] Remove nag for multiple sites.\n* [UPDATE] Only inject LiteSpeed javascripts in LiteSpeed pages.\n* [REFACTOR] Properly check for zero in ttl settings.\n* [BUGFIX] Fixed the 404 issue that can be caused by some certain plugins when save the settings.\n* [BUGFIX] Fixed mu-plugin compatibility.\n* [BUGFIX] Fixed problem with creating zip backup.\n* [BUGFIX] Fixed conflict with jetpack.\n\n= 1.0.14.1 - January 31 2017 =\n* [UPDATE] Removed Freemius integration due to feedback.\n\n= 1.0.14 - January 30 2017 =\n* [NEW] Added error page caching. Currently supports 403, 404, 500s.\n* [NEW] Added a purge errors action.\n* [NEW] Added wp-cli integration.\n* [UPDATE] Added support for multiple varies.\n* [UPDATE] Reorganize the admin interface to be less cluttered.\n* [UPDATE] Add support for LiteSpeed Web ADC.\n* [UPDATE] Add Freemius integration.\n* [REFACTOR] Made some changes so that the rewrite rules are a little more consistent.\n* [BUGFIX] Check member type before adding purge all button.\n* [BUGFIX] Fixed a bug where activating/deactivating the plugin quickly caused the WP_CACHE error to show up.\n* [BUGFIX] Handle more characters in the rewrite parser.\n* [BUGFIX] Correctly purge posts when they are made public/private.\n\n= 1.0.13.1 - November 30 2016 =\n* [BUGFIX] Fixed a bug where a global was being used without checking existence first, causing unnecessary log entries.\n\n= 1.0.13 - November 28 2016 =\n* [NEW] Add an Empty Entire Cache button.\n* [NEW] Add stale logic to certain purge actions.\n* [NEW] Add option to use primary site settings for all subsites in a multisite environment.\n* [NEW] Add support for Aelia CurrencySwitcher\n* [UPDATE] Add logic to allow third party vary headers\n* [UPDATE] Handle password protected pages differently.\n* [BUGFIX] Fixed bug caused by saving settings.\n* [BUGFIX] FIxed bug when searching for advanced-cache.php\n\n= 1.0.12 - November 14 2016 =\n* [NEW] Added logic to generate environment reports.\n* [NEW] Created a notice that will be triggered when the WHM Plugin installs this plugin. This will notify users when the plugin is installed by their server admin.\n* [NEW] Added the option to cache 404 pages via 404 Page TTL setting.\n* [NEW] Reworked log system to be based on selection of yes or no instead of log level.\n* [NEW] Added support for Autoptimize.\n* [NEW] Added Better WP Minify integration.\n* [UPDATE] On plugin disable, clear .htaccess.\n* [UPDATE] Introduced URL tag. Changed Purge by URL to use this new tag.\n* [BUGFIX] Fixed a bug triggered when .htaccess files were empty.\n* [BUGFIX] Correctly determine when to clear files in multisite environments (wp-config, advanced-cache, etc.).\n* [BUGFIX] When disabling the cache, settings changed in the same save will now be saved.\n* [BUGFIX] Various bugs from setting changes and multisite fixed.\n* [BUGFIX] Fixed two bugs with the .htaccess path search.\n* [BUGFIX] Do not alter $_GET in add_quick_purge. This may cause issues for functionality occurring later in the same request.\n* [BUGFIX] Right to left radio settings were incorrectly displayed. The radio buttons themselves were the opposite direction of the associated text.\n\n= 1.0.11 - October 11 2016 =\n* [NEW] The plugin will now set cachelookup public on.\n* [NEW] New option - check advanced-cache.php. This enables users to have two caching plugins enabled at the same time as long as the other plugin is not used for caching purposes. For example, using another cache plugin for css/js minification.\n* [UPDATE] Rules added by the plugin will now be inserted into an LSCACHE START/END PLUGIN comment block.\n* [UPDATE] For woocommerce pages, if a user visits a non-cached page with a non-empty cart, do not cache the page.\n* [UPDATE] If woocommerce needs to display any notice, do not cache the page.\n* [UPDATE] Single site settings are now in both the litespeed cache submenu and the settings submenu.\n* [BUGFIX] Multisite network options were not updated on upgrade. This is now corrected.\n\n= 1.0.10 - September 16 2016 =\n* Added a check for LSCACHE_NO_CACHE definition.\n* Added a Purge All button to the admin bar.\n* Added logic to purge the cache when upgrading a plugin or theme. By default this is enabled on single site installations and disabled on multisite installations.\n* Added support for WooCommerce Versions < 2.5.0.\n* Added .htaccess backup rotation. Every 10 backups, an .htaccess archive will be created. If one already exists, it will be overwritten.\n* Moved some settings to the new Specific Pages tab to reduce clutter in the General tab.\n* The .htaccess editor is now disabled if DISALLOW_FILE_EDIT is set.\n* After saving the Cache Tag Prefix setting, all cache will be purged.\n\n= 1.0.9.1 - August 26 2016 =\n* Fixed a bug where an error displayed on the configuration screen despite not being an error.\n* Change logic to check .htaccess file less often.\n\n= 1.0.9 - August 25 2016 =\n* [NEW] Added functionality to cache and purge feeds.\n* [NEW] Added cache tag prefix setting to avoid conflicts when using LiteSpeed Cache for WordPress with LiteSpeed Cache for XenForo and LiteMage.\n* [NEW] Added hooks to allow third party plugins to create config options.\n* [NEW] Added WooCommerce config options.\n* The plugin now also checks for wp-config in the parent directory.\n* Improved WooCommerce support.\n* Changed .htaccess backup process. Will create a .htaccess_lscachebak_orig file if one does not exist. If it does already exist, creates a backup using the date and timestamp.\n* Fixed a bug where get_home_path() sometimes returned an invalid path.\n* Fixed a bug where if the .htaccess was removed from a WordPress subdirectory, it was not handled properly.\n\n= 1.0.8.1 - July 28 2016 =\n* Fixed a bug where check cacheable was sometimes not hit.\n* Fixed a bug where extra slashes in clear rules were stripped.\n\n= 1.0.8 - July 25 2016 =\n* Added purge all on update check to purge by post id logic.\n* Added uninstall logic.\n* Added configuration for caching favicons.\n* Added configuration for caching the login page.\n* Added configuration for caching php resources (scripts/stylesheets accessed as .php).\n* Set login cookie if user is logged in and it isn\u2019t set.\n* Improved NextGenGallery support to include new actions.\n* Now displays a notice on the network admin if WP_CACHE is not set.\n* Fixed a few php syntax issues.\n* Fixed a bug where purge by pid didn\u2019t work.\n* Fixed a bug where the Network Admin settings were shown when the plugin was active in a subsite, but not network active.\n* Fixed a bug where the Advanced Cache check would sometimes not work.\n\n= 1.0.7.1 - May 26 2016 =\n* Fixed a bug where enabling purge all in the auto purge on update settings page did not purge the correct blogs.\n* Fixed a bug reported by user wpc on our forums where enabling purge all in the auto purge on update settings page caused nothing to be cached.\n\n= 1.0.7 - May 24 2016 =\n* Added login cookie configuration to the Advanced Settings page.\n* Added support for WPTouch plugin.\n* Added support for WP-Polls plugin.\n* Added Like Dislike Counter third party integration.\n* Added support for Admin IP Query String Actions.\n* Added confirmation pop up for purge all.\n* Refactor: LiteSpeed_Cache_Admin is now split into LiteSpeed_Cache_Admin, LiteSpeed_Cache_Admin_Display, and LiteSpeed_Cache_Admin_Rules\n* Refactor: Rename functions to accurately represent their functionality\n* Fixed a bug that sometimes caused a \u201cno valid header\u201d error message.\n\n= 1.0.6 - May 5 2016 =\n* Fixed a bug reported by Knut Sparhell that prevented dashboard widgets from being opened or closed.\n* Fixed a bug reported by Knut Sparhell that caused problems with https support for admin pages.\n\n= 1.0.5 - April 26 2016 =\n* [BETA] Added NextGen Gallery plugin support.\n* Added third party plugin integration.\n* Improved cache tag system.\n* Improved formatting for admin settings pages.\n* Converted bbPress to use the new third party integration system.\n* Converted WooCommerce to use the new third party integration system.\n* If .htaccess is not writable, disable separate mobile view and do not cache cookies/user agents.\n* Cache is now automatically purged when disabled.\n* Fixed a bug where .htaccess was not checked properly when adding common rules.\n* Fixed a bug where multisite setups would be completely purged when one site requested a purge all.\n\n= 1.0.4 - April 7 2016 =\n* Added logic to cache commenters.\n* Added htaccess backup to the install script.\n* Added an htaccess editor in the wp-admin dashboard.\n* Added do not cache user agents.\n* Added do not cache cookies.\n* Created new LiteSpeed Cache Settings submenu entries.\n* Implemented Separate Mobile View.\n* Modified WP_CACHE not defined message to only show up for users who can manage options.\n* Moved enabled all/disable all from network management to network settings.\n* Fixed a bug where WP_CACHE was not defined on activation if it was commented out.\n\n= 1.0.3 - March 23 2016 =\n* Added a Purge Front Page button to the LiteSpeed Cache Management page.\n* Added a Default Front Page TTL option to the general settings.\n* Added ability to define web application specific cookie names through rewrite rules to handle logged-in cookie conflicts when using multiple web applications. <strong>[Requires LSWS 5.0.15+]</strong>\n* Improved WooCommerce handling.\n* Fixed a bug where activating lscwp sets the \u201cenable cache\u201d radio button to enabled, but the cache was not enabled by default.\n* Refactored code to make it cleaner.\n* Updated readme.txt.\n\n= 1.0.2 - March 11 2016 =\n* Added a \"Use Network Admin Setting\" option for \"Enable LiteSpeed Cache\". For single sites, this choice will default to enabled.\n* Added enable/disable all buttons for network admin. This controls the setting of all managed sites with \"Use Network Admin Setting\" selected for \"Enable LiteSpeed Cache\".\n* Exclude by Category/Tag are now text areas to avoid slow load times on the LiteSpeed Cache Settings page for sites with a large number of categories/tags.\n* Added a new line to advanced-cache.php to allow identification as a LiteSpeed Cache file.\n* Activation/Deactivation are now better handled in multi-site environments.\n* Enable LiteSpeed Cache setting is now a radio button selection instead of a single checkbox.\n* Can now add '$' to the end of a URL in Exclude URI to perform an exact match.\n* The _lscache_vary cookie will now be deleted upon logout.\n* Fixed a bug in multi-site setups that would cause a \"function already defined\" error.\n\n= 1.0.1 - March 8 2016 =\n* Added Do Not Cache by URI, by Category, and by Tag.  URI is a prefix/string equals match.\n* Added a help tab for plugin compatibilities.\n* Created logic for other plugins to purge a single post if updated.\n* Fixed a bug where woocommerce pages that display the cart were cached.\n* Fixed a bug where admin menus in multi-site setups were not correctly displayed.\n* Fixed a bug where logged in users were served public cached pages.\n* Fixed a compatibility bug with bbPress.  If there is a new forum/topic/reply, the parent pages will now be purged as well.\n* Fixed a bug that didn't allow cron job to update scheduled posts.\n\n= 1.0.0 - January 20 2016 =\n* Initial Release.\n", "<?php\n\n/**\n * The ESI class.\n *\n * This is used to define all esi related functions.\n *\n * @since      \t1.1.3\n * @package    \tLiteSpeed\n * @subpackage \tLiteSpeed/src\n * @author     \tLiteSpeed Technologies <info@litespeedtech.com>\n */\n\nnamespace LiteSpeed;\n\ndefined('WPINC') || exit;\n\nclass ESI extends Root\n{\n\tprivate static $has_esi = false;\n\tprivate static $_combine_ids = array();\n\tprivate $esi_args = null;\n\tprivate $_esi_preserve_list = array();\n\tprivate $_nonce_actions = array(-1 => ''); // val is cache control\n\n\tconst QS_ACTION = 'lsesi';\n\tconst QS_PARAMS = 'esi';\n\tconst COMBO = '__combo'; // ESI include combine='main' handler\n\n\tconst PARAM_ARGS = 'args';\n\tconst PARAM_ID = 'id';\n\tconst PARAM_INSTANCE = 'instance';\n\tconst PARAM_NAME = 'name';\n\n\tconst WIDGET_O_ESIENABLE = 'widget_esi_enable';\n\tconst WIDGET_O_TTL = 'widget_ttl';\n\n\t/**\n\t * Confructor of ESI\n\t *\n\t * @since  1.2.0\n\t * @since  4.0 Change to be after Vary init in hook 'after_setup_theme'\n\t */\n\tpublic function init()\n\t{\n\t\t/**\n\t\t * Bypass ESI related funcs if disabled ESI to fix potential DIVI compatibility issue\n\t\t * @since  2.9.7.2\n\t\t */\n\t\tif (Router::is_ajax() || !$this->cls('Router')->esi_enabled()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Guest mode, don't need to use ESI\n\t\tif (defined('LITESPEED_GUEST') && LITESPEED_GUEST) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Init ESI in `after_setup_theme` hook after detected if LITESPEED_DISABLE_ALL is ON or not\n\t\t$this->_hooks();\n\n\t\t/**\n\t\t * Overwrite wp_create_nonce func\n\t\t * @since  2.9.5\n\t\t */\n\t\t$this->_transform_nonce();\n\n\t\t!defined('LITESPEED_ESI_INITED') && define('LITESPEED_ESI_INITED', true);\n\t}\n\n\t/**\n\t * Init ESI related hooks\n\t *\n\t * Load delayed by hook to give the ability to bypass by LITESPEED_DISABLE_ALL const\n\t *\n\t * @since 2.9.7.2\n\t * @since  4.0 Changed to private from public\n\t * @access private\n\t */\n\tprivate function _hooks()\n\t{\n\t\tadd_filter('template_include', array($this, 'esi_template'), 99999);\n\n\t\tadd_action('load-widgets.php', __NAMESPACE__ . '\\Purge::purge_widget');\n\t\tadd_action('wp_update_comment_count', __NAMESPACE__ . '\\Purge::purge_comment_widget');\n\n\t\t/**\n\t\t * Recover REQUEST_URI\n\t\t * @since  1.8.1\n\t\t */\n\t\tif (!empty($_GET[self::QS_ACTION])) {\n\t\t\t$this->_register_esi_actions();\n\t\t}\n\n\t\t/**\n\t\t * Shortcode ESI\n\t\t *\n\t\t * To use it, just change the origianl shortcode as below:\n\t\t * \t\told: [someshortcode aa='bb']\n\t\t * \t\tnew: [esi someshortcode aa='bb' cache='private,no-vary' ttl='600']\n\t\t *\n\t\t * \t1. `cache` attribute is optional, default to 'public,no-vary'.\n\t\t * \t2. `ttl` attribute is optional, default is your public TTL setting.\n\t\t *  3. `_ls_silence` attribute is optional, default is false.\n\t\t *\n\t\t * @since  2.8\n\t\t * @since  2.8.1 Check is_admin for Elementor compatibility #726013\n\t\t */\n\t\tif (!is_admin()) {\n\t\t\tadd_shortcode('esi', array($this, 'shortcode'));\n\t\t}\n\t}\n\n\t/**\n\t * Take over all nonce calls and transform to ESI\n\t *\n\t * @since  2.9.5\n\t */\n\tprivate function _transform_nonce()\n\t{\n\t\tif (is_admin()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Load ESI nonces in conf\n\t\t$nonces = $this->conf(Base::O_ESI_NONCE);\n\t\tadd_filter('litespeed_esi_nonces', array($this->cls('Data'), 'load_esi_nonces'));\n\t\tif ($nonces = apply_filters('litespeed_esi_nonces', $nonces)) {\n\t\t\tforeach ($nonces as $action) {\n\t\t\t\t$this->nonce_action($action);\n\t\t\t}\n\t\t}\n\n\t\tadd_action('litespeed_nonce', array($this, 'nonce_action'));\n\t}\n\n\t/**\n\t * Register a new nonce action to convert it to ESI\n\t *\n\t * @since  2.9.5\n\t */\n\tpublic function nonce_action($action)\n\t{\n\t\t// Split the Cache Control\n\t\t$action = explode(' ', $action);\n\t\t$control = !empty($action[1]) ? $action[1] : '';\n\t\t$action = $action[0];\n\n\t\t// Wildcard supported\n\t\t$action = Utility::wildcard2regex($action);\n\n\t\tif (array_key_exists($action, $this->_nonce_actions)) {\n\t\t\treturn;\n\t\t}\n\n\t\t$this->_nonce_actions[$action] = $control;\n\n\t\tDebug2::debug('[ESI] Appended nonce action to nonce list [action] ' . $action);\n\t}\n\n\t/**\n\t * Check if an action is registered to replace ESI\n\t *\n\t * @since 2.9.5\n\t */\n\tpublic function is_nonce_action($action)\n\t{\n\t\t// If GM not run yet, then ESI not init yet, then ESI nonce will not be allowed even nonce func replaced.\n\t\tif (!defined('LITESPEED_ESI_INITED')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (is_admin()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\treturn null;\n\t\t}\n\n\t\tforeach ($this->_nonce_actions as $k => $v) {\n\t\t\tif (strpos($k, '*') !== false) {\n\t\t\t\tif (preg_match('#' . $k . '#iU', $action)) {\n\t\t\t\t\treturn $v;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ($k == $action) {\n\t\t\t\t\treturn $v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Shortcode ESI\n\t *\n\t * @since 2.8\n\t * @access public\n\t */\n\tpublic function shortcode($atts)\n\t{\n\t\tif (empty($atts[0])) {\n\t\t\tDebug2::debug('[ESI] ===shortcode wrong format', $atts);\n\t\t\treturn 'Wrong shortcode esi format';\n\t\t}\n\n\t\t$cache = 'public,no-vary';\n\t\tif (!empty($atts['cache'])) {\n\t\t\t$cache = $atts['cache'];\n\t\t\tunset($atts['cache']);\n\t\t}\n\n\t\t$silence = false;\n\t\tif (!empty($atts['_ls_silence'])) {\n\t\t\t$silence = true;\n\t\t}\n\n\t\tdo_action('litespeed_esi_shortcode-' . $atts[0]);\n\n\t\t// Show ESI link\n\t\treturn $this->sub_esi_block('esi', 'esi-shortcode', $atts, $cache, $silence);\n\t}\n\n\t/**\n\t * Check if the requested page has esi elements. If so, return esi on\n\t * header.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @return string Esi On header if request has esi, empty string otherwise.\n\t */\n\tpublic static function has_esi()\n\t{\n\t\treturn self::$has_esi;\n\t}\n\n\t/**\n\t * Sets that the requested page has esi elements.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function set_has_esi()\n\t{\n\t\tself::$has_esi = true;\n\t}\n\n\t/**\n\t * Register all of the hooks related to the esi logic of the plugin.\n\t * Specifically when the page IS an esi page.\n\t *\n\t * @since    1.1.3\n\t * @access   private\n\t */\n\tprivate function _register_esi_actions()\n\t{\n\t\t!defined('LSCACHE_IS_ESI') && define('LSCACHE_IS_ESI', $_GET[self::QS_ACTION]); // Reused this to ESI block ID\n\n\t\t!empty($_SERVER['ESI_REFERER']) && defined('LSCWP_LOG') && Debug2::debug('[ESI] ESI_REFERER: ' . $_SERVER['ESI_REFERER']);\n\n\t\t/**\n\t\t * Only when ESI's parent is not REST, replace REQUEST_URI to avoid breaking WP5 editor REST call\n\t\t * @since 2.9.3\n\t\t */\n\t\tif (!empty($_SERVER['ESI_REFERER']) && !$this->cls('REST')->is_rest($_SERVER['ESI_REFERER'])) {\n\t\t\t$_SERVER['REQUEST_URI'] = $_SERVER['ESI_REFERER'];\n\t\t}\n\n\t\tif (!empty($_SERVER['ESI_CONTENT_TYPE']) && strpos($_SERVER['ESI_CONTENT_TYPE'], 'application/json') === 0) {\n\t\t\tadd_filter('litespeed_is_json', '__return_true');\n\t\t}\n\n\t\t/**\n\t\t * Make REST call be able to parse ESI\n\t\t * NOTE: Not effective due to ESI req are all to `/` yet\n\t\t * @since 2.9.4\n\t\t */\n\t\tadd_action('rest_api_init', array($this, 'load_esi_block'), 101);\n\n\t\t// Register ESI blocks\n\t\tadd_action('litespeed_esi_load-widget', array($this, 'load_widget_block'));\n\t\tadd_action('litespeed_esi_load-admin-bar', array($this, 'load_admin_bar_block'));\n\t\tadd_action('litespeed_esi_load-comment-form', array($this, 'load_comment_form_block'));\n\n\t\tadd_action('litespeed_esi_load-nonce', array($this, 'load_nonce_block'));\n\t\tadd_action('litespeed_esi_load-esi', array($this, 'load_esi_shortcode'));\n\n\t\tadd_action('litespeed_esi_load-' . self::COMBO, array($this, 'load_combo'));\n\t}\n\n\t/**\n\t * Hooked to the template_include action.\n\t * Selects the esi template file when the post type is a LiteSpeed ESI page.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param string $template The template path filtered.\n\t * @return string The new template path.\n\t */\n\tpublic function esi_template($template)\n\t{\n\t\t// Check if is an ESI request\n\t\tif (defined('LSCACHE_IS_ESI')) {\n\t\t\tDebug2::debug('[ESI] calling template');\n\n\t\t\treturn LSCWP_DIR . 'tpl/esi.tpl.php';\n\t\t}\n\t\t$this->_register_not_esi_actions();\n\t\treturn $template;\n\t}\n\n\t/**\n\t * Register all of the hooks related to the esi logic of the plugin.\n\t * Specifically when the page is NOT an esi page.\n\t *\n\t * @since    1.1.3\n\t * @access   private\n\t */\n\tprivate function _register_not_esi_actions()\n\t{\n\t\tdo_action('litespeed_tpl_normal');\n\n\t\tif (!Control::is_cacheable()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (Router::is_ajax()) {\n\t\t\treturn;\n\t\t}\n\n\t\tadd_filter('widget_display_callback', array($this, 'sub_widget_block'), 0, 3);\n\n\t\t// Add admin_bar esi\n\t\tif (Router::is_logged_in()) {\n\t\t\tremove_action('wp_footer', 'wp_admin_bar_render', 1000);\n\t\t\tadd_action('wp_footer', array($this, 'sub_admin_bar_block'), 1000);\n\t\t}\n\n\t\t// Add comment forum esi for logged-in user or commenter\n\t\tif (!Router::is_ajax() && Vary::has_vary()) {\n\t\t\tadd_filter('comment_form_defaults', array($this, 'register_comment_form_actions'));\n\t\t}\n\t}\n\n\t/**\n\t * Set an ESI to be combine='sub'\n\t *\n\t * @since  3.4.2\n\t */\n\tpublic static function combine($block_id)\n\t{\n\t\tif (!isset($_SERVER['X-LSCACHE']) || strpos($_SERVER['X-LSCACHE'], 'combine') === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (in_array($block_id, self::$_combine_ids)) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::$_combine_ids[] = $block_id;\n\t}\n\n\t/**\n\t * Load combined ESI\n\t *\n\t * @since  3.4.2\n\t */\n\tpublic function load_combo()\n\t{\n\t\tControl::set_nocache('ESI combine request');\n\n\t\tif (empty($_POST['esi_include'])) {\n\t\t\treturn;\n\t\t}\n\n\t\tself::set_has_esi();\n\n\t\tDebug2::debug('[ESI] \ud83c\udf54 Load combo', $_POST['esi_include']);\n\n\t\t$output = '';\n\t\tforeach ($_POST['esi_include'] as $url) {\n\t\t\t$qs = parse_url(htmlspecialchars_decode($url), PHP_URL_QUERY);\n\t\t\tparse_str($qs, $qs);\n\t\t\tif (empty($qs[self::QS_ACTION])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$esi_id = $qs[self::QS_ACTION];\n\t\t\t$esi_param = !empty($qs[self::QS_PARAMS]) ? $this->_parse_esi_param($qs[self::QS_PARAMS]) : false;\n\t\t\t$inline_param = apply_filters('litespeed_esi_inline-' . $esi_id, array(), $esi_param); // Returned array need to be [ val, control, tag ]\n\t\t\tif ($inline_param) {\n\t\t\t\t$output .= self::_build_inline($url, $inline_param);\n\t\t\t}\n\t\t}\n\n\t\techo $output;\n\t}\n\n\t/**\n\t * Build a whole inline segment\n\t *\n\t * @since  3.4.2\n\t */\n\tprivate static function _build_inline($url, $inline_param)\n\t{\n\t\tif (!$url || empty($inline_param['val']) || empty($inline_param['control']) || empty($inline_param['tag'])) {\n\t\t\treturn '';\n\t\t}\n\n\t\treturn \"<esi:inline name='$url' cache-control='\" . $inline_param['control'] . \"' cache-tag='\" . $inline_param['tag'] . \"'>\" . $inline_param['val'] . \"</esi:inline>\";\n\t}\n\n\t/**\n\t * Build the esi url. This method will build the html comment wrapper as well as serialize and encode the parameter array.\n\t *\n\t * The block_id parameter should contain alphanumeric and '-_' only.\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t * @param string $block_id The id to use to display the correct esi block.\n\t * @param string $wrapper The wrapper for the esi comments.\n\t * @param array $params The esi parameters.\n\t * @param string $control The cache control attribute if any.\n\t * @param bool $silence If generate wrapper comment or not\n\t * @param bool $preserved \tIf this ESI block is used in any filter, need to temporarily convert it to a string to avoid the HTML tag being removed/filtered.\n\t * @param bool $svar  \t\tIf store the value in memory or not, in memory wil be faster\n\t * @param array $inline_val \tIf show the current value for current request( this can avoid multiple esi requests in first time cache generating process )\n\t */\n\tpublic function sub_esi_block($block_id, $wrapper, $params = array(), $control = 'private,no-vary', $silence = false, $preserved = false, $svar = false, $inline_param = array())\n\t{\n\t\tif (empty($block_id) || !is_array($params) || preg_match('/[^\\w-]/', $block_id)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (defined('LITESPEED_ESI_OFF')) {\n\t\t\tDebug2::debug('[ESI] ESI OFF so force loading [block_id] ' . $block_id);\n\t\t\tdo_action('litespeed_esi_load-' . $block_id, $params);\n\t\t\treturn;\n\t\t}\n\n\t\tif ($silence) {\n\t\t\t// Don't add comment to esi block ( original for nonce used in tag property data-nonce='esi_block' )\n\t\t\t$params['_ls_silence'] = true;\n\t\t}\n\n\t\tif ($this->cls('REST')->is_rest() || $this->cls('REST')->is_internal_rest()) {\n\t\t\t$params['is_json'] = 1;\n\t\t}\n\n\t\t$params = apply_filters('litespeed_esi_params', $params, $block_id);\n\t\t$control = apply_filters('litespeed_esi_control', $control, $block_id);\n\n\t\tif (!is_array($params) || !is_string($control)) {\n\t\t\tdefined('LSCWP_LOG') && Debug2::debug(\"[ESI] \ud83d\uded1 Sub hooks returned Params: \\n\" . var_export($params, true) . \"\\ncache control: \\n\" . var_export($control, true));\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// Build params for URL\n\t\t$appended_params = array(\n\t\t\tself::QS_ACTION\t=> $block_id,\n\t\t);\n\t\tif (!empty($control)) {\n\t\t\t$appended_params['_control'] = $control;\n\t\t}\n\t\tif ($params) {\n\t\t\t$appended_params[self::QS_PARAMS] = base64_encode(json_encode($params));\n\t\t\tDebug2::debug2('[ESI] param ', $params);\n\t\t}\n\n\t\t// Append hash\n\t\t$appended_params['_hash'] = $this->_gen_esi_md5($appended_params);\n\n\t\t/**\n\t\t * Escape potential chars\n\t\t * @since 2.9.4\n\t\t */\n\t\t$appended_params = array_map('urlencode', $appended_params);\n\n\t\t// Generate ESI URL\n\t\t$url = add_query_arg($appended_params, trailingslashit(wp_make_link_relative(home_url())));\n\n\t\t$output = '';\n\t\tif ($inline_param) {\n\t\t\t$output .= self::_build_inline($url, $inline_param);\n\t\t}\n\n\t\t$output .= \"<esi:include src='$url'\";\n\t\tif (!empty($control)) {\n\t\t\t$control = esc_attr($control);\n\t\t\t$output .= \" cache-control='$control'\";\n\t\t}\n\t\tif ($svar) {\n\t\t\t$output .= \" as-var='1'\";\n\t\t}\n\t\tif (in_array($block_id, self::$_combine_ids)) {\n\t\t\t$output .= \" combine='sub'\";\n\t\t}\n\t\tif ($block_id == self::COMBO && isset($_SERVER['X-LSCACHE']) && strpos($_SERVER['X-LSCACHE'], 'combine') !== false) {\n\t\t\t$output .= \" combine='main'\";\n\t\t}\n\t\t$output .= \" />\";\n\n\t\tif (!$silence) {\n\t\t\t$output = \"<!-- lscwp $wrapper -->$output<!-- lscwp $wrapper esi end -->\";\n\t\t}\n\n\t\tDebug2::debug(\"[ESI] \ud83d\udc95  [BLock_ID] $block_id \\t[wrapper] $wrapper \\t\\t[Control] $control\");\n\t\tDebug2::debug2($output);\n\n\t\tself::set_has_esi();\n\n\t\t// Convert to string to avoid html chars filter when using\n\t\t// Will reverse the buffer when output in self::finalize()\n\t\tif ($preserved) {\n\t\t\t$hash = md5($output);\n\t\t\t$this->_esi_preserve_list[$hash] = $output;\n\t\t\tDebug2::debug(\"[ESI] Preserved to $hash\");\n\n\t\t\treturn $hash;\n\t\t}\n\n\t\treturn $output;\n\t}\n\n\t/**\n\t * Generate ESI hash md5\n\t *\n\t * @since  2.9.6\n\t * @access private\n\t */\n\tprivate function _gen_esi_md5($params)\n\t{\n\t\t$keys = array(\n\t\t\tself::QS_ACTION,\n\t\t\t'_control',\n\t\t\tself::QS_PARAMS,\n\t\t);\n\n\t\t$str = '';\n\t\tforeach ($keys as $v) {\n\t\t\tif (isset($params[$v]) && is_string($params[$v])) {\n\t\t\t\t$str .= $params[$v];\n\t\t\t}\n\t\t}\n\t\tDebug2::debug2('[ESI] md5_string=' . $str);\n\n\t\treturn md5($this->conf(Base::HASH) . $str);\n\t}\n\n\t/**\n\t * Parses the request parameters on an ESI request\n\t *\n\t * @since 1.1.3\n\t * @access private\n\t */\n\tprivate function _parse_esi_param($qs_params = false)\n\t{\n\t\t$req_params = false;\n\t\tif ($qs_params) {\n\t\t\t$req_params = $qs_params;\n\t\t} elseif (isset($_REQUEST[self::QS_PARAMS])) {\n\t\t\t$req_params = $_REQUEST[self::QS_PARAMS];\n\t\t}\n\n\t\tif (!$req_params) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$unencrypted = base64_decode($req_params);\n\t\tif ($unencrypted === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\tDebug2::debug2('[ESI] parms', $unencrypted);\n\t\t// $unencoded = urldecode($unencrypted); no need to do this as $_GET is already parsed\n\t\t$params = json_decode($unencrypted, true);\n\n\t\treturn $params;\n\t}\n\n\t/**\n\t * Select the correct esi output based on the parameters in an ESI request.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function load_esi_block()\n\t{\n\t\t/**\n\t\t * Validate if is a legal ESI req\n\t\t * @since 2.9.6\n\t\t */\n\t\tif (empty($_GET['_hash']) || $this->_gen_esi_md5($_GET) != $_GET['_hash']) {\n\t\t\tDebug2::debug('[ESI] \u274c Failed to validate _hash');\n\t\t\treturn;\n\t\t}\n\n\t\t$params = $this->_parse_esi_param();\n\n\t\tif (defined('LSCWP_LOG')) {\n\t\t\t$logInfo = '[ESI] \u2b55 ';\n\t\t\tif (!empty($params[self::PARAM_NAME])) {\n\t\t\t\t$logInfo .= ' Name: ' . $params[self::PARAM_NAME] . ' ----- ';\n\t\t\t}\n\t\t\t$logInfo .= ' [ID] ' . LSCACHE_IS_ESI;\n\t\t\tDebug2::debug($logInfo);\n\t\t}\n\n\t\tif (!empty($params['_ls_silence'])) {\n\t\t\t!defined('LSCACHE_ESI_SILENCE') && define('LSCACHE_ESI_SILENCE', true);\n\t\t}\n\n\t\t/**\n\t\t * Buffer needs to be JSON format\n\t\t * @since  2.9.4\n\t\t */\n\t\tif (!empty($params['is_json'])) {\n\t\t\tadd_filter('litespeed_is_json', '__return_true');\n\t\t}\n\n\t\tTag::add(rtrim(Tag::TYPE_ESI, '.'));\n\t\tTag::add(Tag::TYPE_ESI . LSCACHE_IS_ESI);\n\n\t\t// Debug2::debug(var_export($params, true ));\n\n\t\t/**\n\t\t * Handle default cache control 'private,no-vary' for sub_esi_block() \t@ticket #923505\n\t\t *\n\t\t * @since  2.2.3\n\t\t */\n\t\tif (!empty($_GET['_control'])) {\n\t\t\t$control = explode(',', $_GET['_control']);\n\t\t\tif (in_array('private', $control)) {\n\t\t\t\tControl::set_private();\n\t\t\t}\n\n\t\t\tif (in_array('no-vary', $control)) {\n\t\t\t\tControl::set_no_vary();\n\t\t\t}\n\t\t}\n\n\t\tdo_action('litespeed_esi_load-' . LSCACHE_IS_ESI, $params);\n\t}\n\n\t// The *_sub_* functions are helpers for the sub_* functions.\n\t// The *_load_* functions are helpers for the load_* functions.\n\n\t/**\n\t * Loads the default options for default WordPress widgets.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic static function widget_default_options($options, $widget)\n\t{\n\t\tif (!is_array($options)) {\n\t\t\treturn $options;\n\t\t}\n\n\t\t$widget_name = get_class($widget);\n\t\tswitch ($widget_name) {\n\t\t\tcase 'WP_Widget_Recent_Posts':\n\t\t\tcase 'WP_Widget_Recent_Comments':\n\t\t\t\t$options[self::WIDGET_O_ESIENABLE] = Base::VAL_OFF;\n\t\t\t\t$options[self::WIDGET_O_TTL] = 86400;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn $options;\n\t}\n\n\t/**\n\t * Hooked to the widget_display_callback filter.\n\t * If the admin configured the widget to display via esi, this function\n\t * will set up the esi request and cancel the widget display.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t * @param array $instance Parameter used to build the widget.\n\t * @param WP_Widget $widget The widget to build.\n\t * @param array $args Parameter used to build the widget.\n\t * @return mixed Return false if display through esi, instance otherwise.\n\t */\n\tpublic function sub_widget_block($instance, $widget, $args)\n\t{\n\t\t// #210407\n\t\tif (!is_array($instance)) {\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$name = get_class($widget);\n\t\tif (!isset($instance[Base::OPTION_NAME])) {\n\t\t\treturn $instance;\n\t\t}\n\t\t$options = $instance[Base::OPTION_NAME];\n\t\tif (!isset($options) || !$options[self::WIDGET_O_ESIENABLE]) {\n\t\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI 0 ' . $name . ': ' . (!isset($options) ? 'not set' : 'set off'));\n\n\t\t\treturn $instance;\n\t\t}\n\n\t\t$esi_private = $options[self::WIDGET_O_ESIENABLE] == Base::VAL_ON2 ? 'private,' : '';\n\n\t\t$params = array(\n\t\t\tself::PARAM_NAME => $name,\n\t\t\tself::PARAM_ID => $widget->id,\n\t\t\tself::PARAM_INSTANCE => $instance,\n\t\t\tself::PARAM_ARGS => $args\n\t\t);\n\n\t\techo $this->sub_esi_block('widget', 'widget ' . $name, $params, $esi_private . 'no-vary');\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Hooked to the wp_footer action.\n\t * Sets up the ESI request for the admin bar.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global type $wp_admin_bar\n\t */\n\tpublic function sub_admin_bar_block()\n\t{\n\t\tglobal $wp_admin_bar;\n\n\t\tif (!is_admin_bar_showing() || !is_object($wp_admin_bar)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// To make each admin bar ESI request different for `Edit` button different link\n\t\t$params = array(\n\t\t\t'ref' => $_SERVER['REQUEST_URI'],\n\t\t);\n\n\t\techo $this->sub_esi_block('admin-bar', 'adminbar', $params);\n\t}\n\n\t/**\n\t * Parses the esi input parameters and generates the widget for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @global $wp_widget_factory\n\t * @param array $params Input parameters needed to correctly display widget\n\t */\n\tpublic function load_widget_block($params)\n\t{\n\t\t// global $wp_widget_factory;\n\t\t// $widget = $wp_widget_factory->widgets[ $params[ self::PARAM_NAME ] ];\n\t\t$option = $params[self::PARAM_INSTANCE];\n\t\t$option = $option[Base::OPTION_NAME];\n\n\t\t// Since we only reach here via esi, safe to assume setting exists.\n\t\t$ttl = $option[self::WIDGET_O_TTL];\n\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI widget render: name ' . $params[self::PARAM_NAME] . ', id ' . $params[self::PARAM_ID] . ', ttl ' . $ttl);\n\t\tif ($ttl == 0) {\n\t\t\tControl::set_nocache('ESI Widget time to live set to 0');\n\t\t} else {\n\t\t\tControl::set_custom_ttl($ttl);\n\n\t\t\tif ($option[self::WIDGET_O_ESIENABLE] == Base::VAL_ON2) {\n\t\t\t\tControl::set_private();\n\t\t\t}\n\t\t\tControl::set_no_vary();\n\t\t\tTag::add(Tag::TYPE_WIDGET . $params[self::PARAM_ID]);\n\t\t}\n\t\tthe_widget($params[self::PARAM_NAME], $params[self::PARAM_INSTANCE], $params[self::PARAM_ARGS]);\n\t}\n\n\t/**\n\t * Generates the admin bar for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t */\n\tpublic function load_admin_bar_block($params)\n\t{\n\n\t\tif (!empty($params['ref'])) {\n\t\t\t$ref_qs = parse_url($params['ref'], PHP_URL_QUERY);\n\t\t\tif (!empty($ref_qs)) {\n\t\t\t\tparse_str($ref_qs, $ref_qs_arr);\n\n\t\t\t\tif (!empty($ref_qs_arr)) {\n\t\t\t\t\tforeach ($ref_qs_arr as $k => $v) {\n\t\t\t\t\t\t$_GET[$k] = $v;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\twp_admin_bar_render();\n\t\tif (!$this->conf(Base::O_ESI_CACHE_ADMBAR)) {\n\t\t\tControl::set_nocache('build-in set to not cacheable');\n\t\t} else {\n\t\t\tControl::set_private();\n\t\t\tControl::set_no_vary();\n\t\t}\n\n\t\tdefined('LSCWP_LOG') && Debug2::debug('ESI: adminbar ref: ' . $_SERVER['REQUEST_URI']);\n\t}\n\n\n\t/**\n\t * Parses the esi input parameters and generates the comment form for esi display.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t * @param array $params Input parameters needed to correctly display comment form\n\t */\n\tpublic function load_comment_form_block($params)\n\t{\n\t\tcomment_form($params[self::PARAM_ARGS], $params[self::PARAM_ID]);\n\n\t\tif (!$this->conf(Base::O_ESI_CACHE_COMMFORM)) {\n\t\t\tControl::set_nocache('build-in set to not cacheable');\n\t\t} else {\n\t\t\t// by default comment form is public\n\t\t\tif (Vary::has_vary()) {\n\t\t\t\tControl::set_private();\n\t\t\t\tControl::set_no_vary();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Generate nonce for certain action\n\t *\n\t * @access public\n\t * @since 2.6\n\t */\n\tpublic function load_nonce_block($params)\n\t{\n\t\t$action = $params['action'];\n\n\t\tDebug2::debug('[ESI] load_nonce_block [action] ' . $action);\n\n\t\t// set nonce TTL to half day\n\t\tControl::set_custom_ttl(43200);\n\n\t\tif (Router::is_logged_in()) {\n\t\t\tControl::set_private();\n\t\t}\n\n\t\tif (function_exists('wp_create_nonce_litespeed_esi')) {\n\t\t\techo wp_create_nonce_litespeed_esi($action);\n\t\t} else {\n\t\t\techo wp_create_nonce($action);\n\t\t}\n\t}\n\n\t/**\n\t * Show original shortcode\n\t *\n\t * @access public\n\t * @since 2.8\n\t */\n\tpublic function load_esi_shortcode($params)\n\t{\n\t\tif (isset($params['ttl'])) {\n\t\t\tif (!$params['ttl']) {\n\t\t\t\tControl::set_nocache('ESI shortcode att ttl=0');\n\t\t\t} else {\n\t\t\t\tControl::set_custom_ttl($params['ttl']);\n\t\t\t}\n\t\t\tunset($params['ttl']);\n\t\t}\n\n\t\t// Replace to original shortcode\n\t\t$shortcode = $params[0];\n\t\t$atts_ori = array();\n\t\tforeach ($params as $k => $v) {\n\t\t\tif ($k === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$atts_ori[] = is_string($k) ? \"$k='\" . addslashes($v) . \"'\" : $v;\n\t\t}\n\n\t\tTag::add(Tag::TYPE_ESI . \"esi.$shortcode\");\n\n\t\t// Output original shortcode final content\n\t\techo do_shortcode(\"[$shortcode \" . implode(' ', $atts_ori) . \" ]\");\n\t}\n\n\t/**\n\t * Hooked to the comment_form_defaults filter.\n\t * Stores the default comment form settings.\n\t * If sub_comment_form_block is triggered, the output buffer is cleared and an esi block is added. The remaining comment form is also buffered and cleared.\n\t * Else there is no need to make the comment form ESI.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function register_comment_form_actions($defaults)\n\t{\n\t\t$this->esi_args = $defaults;\n\t\techo GUI::clean_wrapper_begin();\n\t\tadd_filter('comment_form_submit_button', array($this, 'sub_comment_form_btn'), 1000, 2); // To save the params passed in\n\t\tadd_action('comment_form', array($this, 'sub_comment_form_block'), 1000);\n\t\treturn $defaults;\n\t}\n\n\t/**\n\t * Store the args passed in comment_form for the ESI comment param usage in `$this->sub_comment_form_block()`\n\t *\n\t * @since  3.4\n\t * @access public\n\t */\n\tpublic function sub_comment_form_btn($unused, $args)\n\t{\n\t\tif (empty($args) || empty($this->esi_args)) {\n\t\t\tDebug2::debug('comment form args empty?');\n\t\t\treturn $unused;\n\t\t}\n\t\t$esi_args = array();\n\n\t\t// compare current args with default ones\n\t\tforeach ($args as $k => $v) {\n\t\t\tif (!isset($this->esi_args[$k])) {\n\t\t\t\t$esi_args[$k] = $v;\n\t\t\t} elseif (is_array($v)) {\n\t\t\t\t$diff = array_diff_assoc($v, $this->esi_args[$k]);\n\t\t\t\tif (!empty($diff)) {\n\t\t\t\t\t$esi_args[$k] = $diff;\n\t\t\t\t}\n\t\t\t} elseif ($v !== $this->esi_args[$k]) {\n\t\t\t\t$esi_args[$k] = $v;\n\t\t\t}\n\t\t}\n\n\t\t$this->esi_args = $esi_args;\n\n\t\treturn $unused;\n\t}\n\n\t/**\n\t * Hooked to the comment_form_submit_button filter.\n\t *\n\t * This method will compare the used comment form args against the default args. The difference will be passed to the esi request.\n\t *\n\t * @access public\n\t * @since 1.1.3\n\t */\n\tpublic function sub_comment_form_block($post_id)\n\t{\n\t\techo GUI::clean_wrapper_end();\n\t\t$params = array(\n\t\t\tself::PARAM_ID => $post_id,\n\t\t\tself::PARAM_ARGS => $this->esi_args,\n\t\t);\n\n\t\techo $this->sub_esi_block('comment-form', 'comment form', $params);\n\t\techo GUI::clean_wrapper_begin();\n\t\tadd_action('comment_form_after', array($this, 'comment_form_sub_clean'));\n\t}\n\n\t/**\n\t * Hooked to the comment_form_after action.\n\t * Cleans up the remaining comment form output.\n\t *\n\t * @since 1.1.3\n\t * @access public\n\t */\n\tpublic function comment_form_sub_clean()\n\t{\n\t\techo GUI::clean_wrapper_end();\n\t}\n\n\t/**\n\t * Replace preseved blocks\n\t *\n\t * @since  2.6\n\t * @access public\n\t */\n\tpublic function finalize($buffer)\n\t{\n\t\t// Prepend combo esi block\n\t\tif (self::$_combine_ids) {\n\t\t\tDebug2::debug('[ESI] \ud83c\udf54 Enabled combo');\n\t\t\t$esi_block = $this->sub_esi_block(self::COMBO, '__COMBINE_MAIN__', array(), 'no-cache', true);\n\t\t\t$buffer = $esi_block . $buffer;\n\t\t}\n\n\t\t// Bypass if no preserved list to be replaced\n\t\tif (!$this->_esi_preserve_list) {\n\t\t\treturn $buffer;\n\t\t}\n\n\t\t$keys = array_keys($this->_esi_preserve_list);\n\n\t\tDebug2::debug('[ESI] replacing preserved blocks', $keys);\n\n\t\t$buffer = str_replace($keys, $this->_esi_preserve_list, $buffer);\n\n\t\treturn $buffer;\n\t}\n\n\t/**\n\t * Check if the content contains preserved list or not\n\t *\n\t * @since  3.3\n\t */\n\tpublic function contain_preserve_esi($content)\n\t{\n\t\t$hit_list = array();\n\t\tforeach ($this->_esi_preserve_list as $k => $v) {\n\t\t\tif (strpos($content, '\"' . $k . '\"') !== false) {\n\t\t\t\t$hit_list[] = '\"' . $k . '\"';\n\t\t\t}\n\t\t\tif (strpos($content, \"'\" . $k . \"'\") !== false) {\n\t\t\t\t$hit_list[] = \"'\" . $k . \"'\";\n\t\t\t}\n\t\t}\n\t\treturn $hit_list;\n\t}\n}\n"], "filenames": ["litespeed-cache.php", "readme.txt", "src/esi.cls.php"], "buggy_code_start_loc": [7, 256, 1], "buggy_code_end_loc": [38, 256, 1002], "fixing_code_start_loc": [7, 257, 2], "fixing_code_end_loc": [38, 258, 1025], "type": "CWE-79", "message": "The LiteSpeed Cache plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the 'esi' shortcode in versions up to, and including, 5.6 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers with contributor-level and above permissions to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.", "other": {"cve": {"id": "CVE-2023-4372", "sourceIdentifier": "security@wordfence.com", "published": "2024-01-11T09:15:46.773", "lastModified": "2024-01-17T21:50:15.347", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The LiteSpeed Cache plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the 'esi' shortcode in versions up to, and including, 5.6 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers with contributor-level and above permissions to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page."}, {"lang": "es", "value": "El complemento LiteSpeed Cache para WordPress es vulnerable a Cross-Site Scripting Almacenado a trav\u00e9s del c\u00f3digo abreviado 'esi' en versiones hasta la 5.6 incluida debido a una sanitizaci\u00f3n de entrada insuficiente y a un escape de salida en los atributos proporcionados por el usuario. Esto hace posible que atacantes autenticados con permisos de nivel de colaborador y superiores inyecten scripts web arbitrarios en p\u00e1ginas que se ejecutar\u00e1n cada vez que un usuario acceda a una p\u00e1gina inyectada."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}, {"source": "security@wordfence.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 3.1, "impactScore": 2.7}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:litespeedtech:litespeed_cache:*:*:*:*:*:wordpress:*:*", "versionEndIncluding": "5.6", "matchCriteriaId": "22C7B730-D532-4674-8968-13C0CC4BC1B9"}]}]}], "references": [{"url": "https://github.com/litespeedtech/lscache_wp/commit/95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7#diff-7b2c514b58d1b8a71655607bdfab87cedb013bc1b8927ce0b49a89ddf4a7e01cR495", "source": "security@wordfence.com", "tags": ["Patch"]}, {"url": "https://plugins.trac.wordpress.org/browser/litespeed-cache/tags/5.5.1/src/esi.cls.php#L480", "source": "security@wordfence.com", "tags": ["Issue Tracking"]}, {"url": "https://plugins.trac.wordpress.org/changeset/2977143/litespeed-cache#file348", "source": "security@wordfence.com", "tags": ["Patch"]}, {"url": "https://www.wordfence.com/threat-intel/vulnerabilities/id/27026f0f-c85e-4409-9973-4b9cb8a90da5?source=cve", "source": "security@wordfence.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/litespeedtech/lscache_wp/commit/95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7#diff-7b2c514b58d1b8a71655607bdfab87cedb013bc1b8927ce0b49a89ddf4a7e01cR495"}}