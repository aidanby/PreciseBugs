{"buggy_code": ["Changelog\n==============\n\n|kitty| is a feature-rich, cross-platform, *fast*, GPU based terminal.\nTo update |kitty|, :doc:`follow the instructions <binary>`.\n\n.. recent major features {{{\n\nRecent major new features\n---------------------------\n\nTruly convenient SSH\n~~~~~~~~~~~~~~~~~~~~~~~~\n\nThe :doc:`ssh kitten <kittens/ssh>` is redesigned with powerful new features:\n\n* Automatic :ref:`shell_integration` on remote machines\n* Easily :ref:`clone local shell/editor config <real_world_ssh_kitten_config>` on remote machines\n* Easily :ref:`edit files in your local editor <edit_file>` on remote machines\n* Automatic :opt:`re-use of existing connections <kitten-ssh.share_connections>` to avoid connection setup latency\n\n\nShell integration\n~~~~~~~~~~~~~~~~~~~~~\n\nkitty automatically integrates with common shells to allow browsing the\noutput of the previous command in a pager by pressing\n:sc:`show_last_command_output`, jumping to previous prompt locations in the\nscrollback by pressing :sc:`scroll_to_previous_prompt` and clicking with the\nmouse anywhere in the current command to move the cursor there. See\n:doc:`shell-integration` for details.\n\n.. }}}\n\nDetailed list of changes\n-------------------------------------\n\n0.26.2 [future]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow creating :code:`overlay-main` windows, which are treated as the active window unlike normal overlays (:iss:`5392`)\n\n- hyperlinked_grep kitten: Allow control over which parts of rg output are hyperlinked (:pull:`5428`)\n\n- Fix regression in 0.26.0 that caused launching kitty without working STDIO handles to result in high CPU usage and prewarming failing (:iss:`5444`)\n\n- :doc:`/launch`: Allow setting the margin and padding for the newly created window (:iss:`5463`)\n\n- macOS: Fix regression in 0.26.0 that caused asking the user for a line of input such as for :ac:`set_tab_title` to not work (:iss:`5447`)\n\n- hints kitten: hyperlink matching: Fix hints occasionally matching text on subsequent line as part of hyperlink (:pull:`5450`)\n\n- hints kitten: Allow using :doc:`launch` as the program to run, to open the result in a new kitty tab/window/etc. (:iss:`5462`)\n\n- Fix a regression in 0.26.0 that broke mapping of native keys who key codes did not fit in 21 bits (:iss:`5452`)\n\n- Wayland: Fix remembering window size not accurate when client side decorations are present\n\n0.26.1 [2022-08-30]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- ssh kitten: Fix executable permission missing from kitty bootstrap script (:iss:`5438`)\n\n- Fix a regression in 0.26.0 that caused kitty to no longer set the ``LANG`` environment variable on macOS (:iss:`5439`)\n\n- Allow specifying a title when using the :ac:`set_tab_title` action (:iss:`5441`)\n\n0.26.0 [2022-08-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new option :opt:`remote_control_password` to use fine grained permissions for what can be remote controlled (:disc:`5320`)\n\n- Reduce startup latency by ~30 milliseconds when running kittens via key bindings inside kitty (:iss:`5159`)\n\n- A new option :opt:`modify_font` to adjust various font metrics like underlines, cell sizes etc. (:pull:`5265`)\n\n- A new shortcut :sc:`show_kitty_doc` to display the kitty docs in a browser\n\n- Graphics protocol: Only delete temp files if they have the string\n  :code:`tty-graphics-protocol` in their file paths. This prevents deletion of arbitrary files in :file:`/tmp`.\n\n- Deprecate the ``adjust_baseline``, ``adjust_line_height`` and ``adjust_column_width`` options in favor of :opt:`modify_font`\n\n- Wayland: Fix a regression in the previous release that caused mouse cursor\n  animation and keyboard repeat to stop working when switching seats (:iss:`5188`)\n\n- Allow resizing windows created in session files (:pull:`5196`)\n\n- Fix horizontal wheel events not being reported to client programs when they grab the mouse (:iss:`2819`)\n\n- macOS: Remote control: Fix unable to launch a new OS window or background process when there is no OS window (:iss:`5210`)\n\n- macOS: Fix unable to open new tab or new window when there is no OS window (:iss:`5276`)\n\n- kitty @ set-colors: Fix changing inactive_tab_foreground not working (:iss:`5214`)\n\n- macOS: Fix a regression that caused switching keyboard input using Eisu and\n  Kana keys not working (:iss:`5232`)\n\n- Add a mappable action to toggle the mirrored setting for the tall and fat\n  layouts (:pull:`5344`)\n\n- Add a mappable action to switch between predefined bias values for the tall and fat\n  layouts (:pull:`5352`)\n\n- Wayland: Reduce flicker at startup by not using render frames immediately after a resize (:iss:`5235`)\n\n- Linux: Update cursor position after all key presses not just pre-edit text\n  changes (:iss:`5241`)\n\n- ssh kitten: Allow ssh kitten to work from inside tmux, provided the tmux\n  session inherits the correct KITTY env vars (:iss:`5227`)\n\n- ssh kitten: A new option :code:`--symlink-strategy` to control how symlinks\n  are copied to the remote machine (:iss:`5249`)\n\n- ssh kitten: Allow pressing :kbd:`Ctrl+C` to abort ssh before the connection is\n  completed (:iss:`5271`)\n\n- Bash integration: Fix declare not creating global variables in .bashrc (:iss:`5254`)\n\n- Bash integration: Fix the inherit_errexit option being set by shell integration (:iss:`5349`)\n\n- :command:`kitty @ scroll-window` allow scrolling by fractions of a screen\n  (:iss:`5294`)\n\n- remote files kitten: Fix working with files whose names have characters that\n  need to be quoted in shell scripts (:iss:`5313`)\n\n- Expand ~ in paths configured in :opt:`editor` and :opt:`exe_search_path` (:disc:`5298`)\n\n- Allow showing the working directory of the active window in tab titles\n  (:pull:`5314`)\n\n- ssh kitten: Allow completion of ssh options between the destination and command (:iss:`5322`)\n\n- macOS: Fix speaking selected text not working (:iss:`5357`)\n\n- Allow ignoring failure to close windows/tabs via rc commands (:disc:`5406`)\n\n- Fix hyperlinks not present when fetching text from the history buffer\n  (:iss:`5427`)\n\n\n0.25.2 [2022-06-07]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new command :command:`edit-in-kitty` to :ref:`edit_file`\n\n- Allow getting the last non-empty command output easily via an action or\n  remote control (:pull:`4973`)\n\n- Fix a bug that caused :opt:`macos_colorspace` to always be ``default`` regardless of its actual value (:iss:`5129`)\n\n- diff kitten: A new option :opt:`kitten-diff.ignore_name` to exclude files and directories from being scanned (:pull:`5171`)\n\n- ssh kitten: Fix bash not being executed as a login shell since kitty 0.25.0 (:iss:`5130`)\n\n- macOS: When pasting text and the clipboard has a filesystem path, paste the\n  full path instead of the text, which is sometimes just the file name (:pull:`5142`)\n\n- macOS: Allow opening executables without a file extension with kitty as well\n  (:iss:`5160`)\n\n- Themes kitten: Add a tab to show user defined custom color themes separately\n  (:pull:`5150`)\n\n- Iosevka: Fix incorrect rendering when there is a combining char that does not\n  group with its neighbors (:iss:`5153`)\n\n- Weston: Fix client side decorations flickering on slow computers during\n  window resize (:iss:`5162`)\n\n- Remote control: Fix commands with large or asynchronous payloads like\n  :command:`kitty @ set-backround-image`, :command:`kitty @ set-window-logo`\n  and :command:`kitty @ select-window` not working correctly\n  when using a socket (:iss:`5165`)\n\n- hints kitten: Fix surrounding quotes/brackets and embedded carriage returns\n  not being removed when using line number processing (:iss:`5170`)\n\n\n0.25.1 [2022-05-26]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Shell integration: Add a command to :ref:`clone_shell`\n\n- Remote control: Allow using :ref:`Boolean operators <search_syntax>` when constructing queries to match windows or tabs\n\n- Sessions: Fix :code:`os_window_size` and :code:`os_window_class` not applying to the first OS Window (:iss:`4957`)\n\n- Allow using the cwd of the oldest as well as the newest foreground process for :option:`launch --cwd` (:disc:`4869`)\n\n- Bash integration: Fix the value of :opt:`shell_integration` not taking effect if the integration script is sourced in bashrc (:pull:`4964`)\n\n- Fix a regression in the previous release that caused mouse move events to be incorrectly reported as drag events even when a button is not pressed (:iss:`4992`)\n\n- remote file kitten: Integrate with the ssh kitten for improved performance\n  and robustness. Re-uses the control master connection of the ssh kitten to\n  avoid round-trip latency.\n\n- Fix tab selection when closing a new tab not correct in some scenarios (:iss:`4987`)\n\n- A new action :ac:`open_url` to open the specified URL (:pull:`5004`)\n\n- A new option :opt:`select_by_word_characters_forward` that allows changing\n  which characters are considered part of a word to the right when double clicking to select\n  words (:pull:`5103`)\n\n- macOS: Make the global menu shortcut to open kitty website configurable (:pull:`5004`)\n\n- macOS: Add the :opt:`macos_colorspace` option to control what color space colors are rendered in (:iss:`4686`)\n\n- Fix reloading of config not working when :file:`kitty.conf` does not exist when kitty is launched (:iss:`5071`)\n\n- Fix deleting images by row not calculating image bounds correctly (:iss:`5081`)\n\n- Increase the max number of combining chars per cell from two to three, without increasing memory usage.\n\n- Linux: Load libfontconfig at runtime to allow the binaries to work for\n  running kittens on servers without FontConfig\n\n- GNOME: Fix for high CPU usage caused by GNOME's text input subsystem going\n  into an infinite loop when IME cursor position is updated after a done event\n  (:iss:`5105`)\n\n\n0.25.0 [2022-04-11]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- :doc:`kittens/ssh`: automatic shell integration when using SSH. Easily\n  clone local shell and editor configuration on remote machines, and automatic\n  re-use of existing connections to avoid connection setup latency.\n\n- When pasting URLs at shell prompts automatically quote them. Also allow filtering pasted text and confirm pastes. See :opt:`paste_actions` for details. (:iss:`4873`)\n\n- Change the default value of :opt:`confirm_os_window_close` to ask for confirmation when closing windows that are not sitting at shell prompts\n\n- A new value :code:`last_reported` for :option:`launch --cwd` to use the current working directory last reported by the program running in the terminal\n\n- macOS: When using Apple's less as the pager for viewing scrollback strip out OSC codes as it cant parse them (:iss:`4788`)\n\n- diff kitten: Fix incorrect rendering in rare circumstances when scrolling after changing the context size (:iss:`4831`)\n\n- icat kitten: Fix a regression that broke :option:`kitty +kitten icat --print-window-size` (:pull:`4818`)\n\n- Wayland: Fix :opt:`hide_window_decorations` causing docked windows to be resized on blur (:iss:`4797`)\n\n- Bash integration: Prevent shell integration code from running twice if user enables both automatic and manual integration\n\n- Bash integration: Handle existing PROMPT_COMMAND ending with a literal newline\n\n- Fix continued lines not having their continued status reset on line feed (:iss:`4837`)\n\n- macOS: Allow the New kitty Tab/Window Here services to open multiple selected folders.  (:pull:`4848`)\n\n- Wayland: Fix a regression that broke IME when changing windows/tabs (:iss:`4853`)\n\n- macOS: Fix Unicode paths not decoded correctly when dropping files (:pull:`4879`)\n\n- Avoid flicker when starting kittens such as the hints kitten (:iss:`4674`)\n\n- A new action :ac:`scroll_prompt_to_top` to move the current prompt to the top (:pull:`4891`)\n\n- :ac:`select_tab`: Use stable numbers when selecting the tab (:iss:`4792`)\n\n- Only check for updates in the official binary builds. Distro packages or source builds will no longer check for updates, regardless of the\n  value of :opt:`update_check_interval`.\n\n- Fix :opt:`inactive_text_alpha` still being applied to the cursor hidden window after focus (:iss:`4928`)\n\n- Fix resizing window that is extra tall/wide because of left-over cells not\n  working reliably (:iss:`4913`)\n\n- A new action :ac:`close_other_tabs_in_os_window` to close other tabs in the active OS window (:pull:`4944`)\n\n\n0.24.4 [2022-03-03]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Shell integration: Fix the default Bash :code:`$HISTFILE` changing to :file:`~/.sh_history` instead of :file:`~/.bash_history` (:iss:`4765`)\n\n- Linux binaries: Fix binaries not working on systems with older Wayland client libraries (:iss:`4760`)\n\n- Fix a regression in the previous release that broke kittens launched with :code:`STDIN` not connected to a terminal (:iss:`4763`)\n\n- Wayland: Fix surface configure events not being acknowledged before commit\n  the resized buffer (:pull:`4768`)\n\n\n0.24.3 [2022-02-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Bash integration: No longer modify :file:`~/.bashrc` to load :ref:`shell integration <shell_integration>`.\n  It is recommended to remove the lines used to load the shell integration from :file:`~/.bashrc` as they are no-ops.\n\n- macOS: Allow kitty to handle various URL types. Can be configured via\n  :ref:`launch_actions` (:pull:`4618`)\n\n- macOS: Add a new service ``Open with kitty`` to open file types that are not\n  recognized by the system (:pull:`4641`)\n\n- Splits layout: A new value for :option:`launch --location` to auto-select the split axis when splitting existing windows.\n  Wide windows are split side-by-side and tall windows are split one-above-the-other\n\n- hints kitten: Fix a regression that broke recognition of path:linenumber:colnumber (:iss:`4675`)\n\n- Fix a regression in the previous release that broke :opt:`active_tab_foreground` (:iss:`4620`)\n\n- Fix :ac:`show_last_command_output` not working when the output is stored\n  partially in the scrollback pager history buffer (:iss:`4435`)\n\n- When dropping URLs/files onto kitty at a shell prompt insert them appropriately quoted and space\n  separated (:iss:`4734`)\n\n- Improve CWD detection when there are multiple foreground processes in the TTY process group\n\n- A new option :opt:`narrow_symbols` to turn off opportunistic wide rendering of private use codepoints\n\n- ssh kitten: Fix location of generated terminfo files on NetBSD (:iss:`4622`)\n\n- A new action to clear the screen up to the line containing the cursor, see\n  :ac:`clear_terminal`\n\n- A new action :ac:`copy_ansi_to_clipboard` to copy the current selection with ANSI formatting codes\n  (:iss:`4665`)\n\n- Linux: Do not rescale fallback fonts to match the main font cell height, instead just\n  set the font size and let FreeType take care of it. This matches\n  rendering on macOS (:iss:`4707`)\n\n- macOS: Fix a regression in the previous release that broke switching input\n  sources by keyboard (:iss:`4621`)\n\n- macOS: Add the default shortcut :kbd:`cmd+k` to clear the terminal screen and\n  scrollback up to the cursor (:iss:`4625`)\n\n- Fix a regression in the previous release that broke strikethrough (:disc:`4632`)\n\n- A new action :ac:`scroll_prompt_to_bottom` to move the current prompt\n  to the bottom, filling in the window from the scrollback (:pull:`4634`)\n\n- Add two special arguments ``@first-line-on-screen`` and ``@last-line-on-screen``\n  for the :doc:`launch <launch>` command to be used for pager positioning.\n  (:iss:`4462`)\n\n- Linux: Fix rendering of emoji when using scalable fonts such as Segoe UI Emoji\n\n- Shell integration: bash: Dont fail if an existing PROMPT_COMMAND ends with a semi-colon (:iss:`4645`)\n\n- Shell integration: bash: Fix rendering of multiline prompts with more than two lines (:iss:`4681`)\n\n- Shell integration: fish: Check fish version 3.3.0+ and exit on outdated versions (:pull:`4745`)\n\n- Shell integration: fish: Fix pipestatus being overwritten (:pull:`4756`)\n\n- Linux: Fix fontconfig alias not being used if the aliased font is dual spaced instead of monospaced (:iss:`4649`)\n\n- macOS: Add an option :opt:`macos_menubar_title_max_length` to control the max length of the window title displayed in the global menubar (:iss:`2132`)\n\n- Fix :opt:`touch_scroll_multiplier` also taking effect in terminal programs such as vim that handle mouse events themselves (:iss:`4680`)\n\n- Fix symbol/PUA glyphs loaded via :opt:`symbol_map` instead of as fallbacks not using following spaces to render larger versions (:iss:`4670`)\n\n- macOS: Fix regression in previous release that caused Apple's global shortcuts to not work if they had never been configured on a particular machine (:iss:`4657`)\n\n- Fix a fast *click, move mouse, click* sequence causing the first click event to be discarded (:iss:`4603`)\n\n- Wayland: Fix wheel mice with line based scrolling being incorrectly handled as high precision devices (:iss:`4694`)\n\n- Wayland: Fix touchpads and high resolution wheels not scrolling at the same speed on monitors with different scales (:iss:`4703`)\n\n- Add an option :opt:`wheel_scroll_min_lines` to set the minimum number of lines for mouse wheel scrolling when using a mouse with a wheel that generates very small offsets when slow scrolling (:pull:`4710`)\n\n- macOS: Make the shortcut to toggle full screen configurable (:pull:`4714`)\n\n- macOS: Fix the mouse cursor being set to arrow after switching desktops or toggling full screen (:pull:`4716`)\n\n- Fix copying of selection after selection has been scrolled off history buffer raising an error (:iss:`4713`)\n\n\n0.24.2 [2022-02-03]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Allow opening text files, images and directories with kitty when\n  launched using \"Open with\" in Finder (:iss:`4460`)\n\n- Allow including config files matching glob patterns in :file:`kitty.conf`\n  (:iss:`4533`)\n\n- Shell integration: Fix bash integration not working when ``PROMPT_COMMAND``\n  is used to change the prompt variables (:iss:`4476`)\n\n- Shell integration: Fix cursor shape not being restored to default when\n  running commands in the shell\n\n- Improve the UI of the ask kitten (:iss:`4545`)\n\n- Allow customizing the placement and formatting of the\n  :opt:`tab_activity_symbol` and :opt:`bell_on_tab` symbols\n  by adding them to the :opt:`tab_title_template` (:iss:`4581`, :pull:`4507`)\n\n- macOS: Persist \"Secure Keyboard Entry\" across restarts to match the behavior\n  of Terminal.app (:iss:`4471`)\n\n- hints kitten: Fix common single letter extension files not being detected\n  (:iss:`4491`)\n\n- Support dotted and dashed underline styles (:pull:`4529`)\n\n- For the vertical and horizontal layouts have the windows arranged on a ring\n  rather than a plane. This means the first and last window are considered\n  neighbors (:iss:`4494`)\n\n- A new action to clear the current selection (:iss:`4600`)\n\n- Shell integration: fish: Fix cursor shape not working with fish's vi mode\n  (:iss:`4508`)\n\n- Shell integration: fish: Dont override fish's native title setting functionality.\n  See `discussion <https://github.com/fish-shell/fish-shell/issues/8641>`__.\n\n- macOS: Fix hiding via :kbd:`cmd+h` not working on macOS 10.15.7 (:iss:`4472`)\n\n- Draw the dots for braille characters more evenly spaced at all font sizes (:iss:`4499`)\n\n- icat kitten: Add options to mirror images and remove their transparency\n  before displaying them (:iss:`4513`)\n\n- macOS: Respect the users system-wide global keyboard shortcut preferences\n  (:iss:`4501`)\n\n- macOS: Fix a few key-presses causing beeps from Cocoa's text input system\n  (:iss:`4489`)\n\n- macOS: Fix using shortcuts from the global menu bar as subsequent key presses\n  in a multi key mapping not working (:iss:`4519`)\n\n- Fix getting last command output not working correctly when the screen is\n  scrolled (:pull:`4522`)\n\n- Show number of windows per tab in the :ac:`select_tab` action (:pull:`4523`)\n\n- macOS: Fix the shift key not clearing pre-edit text in IME (:iss:`4541`)\n\n- Fix clicking in a window to focus it and typing immediately sometimes having\n  unexpected effects if at a shell prompt (:iss:`4128`)\n\n- themes kitten: Allow writing to a different file than :file:`kitty.conf`.\n\n\n0.24.1 [2022-01-06]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Shell integration: Work around conflicts with some zsh plugins (:iss:`4428`)\n\n- Have the zero width space and various other characters from the *Other,\n  formatting* Unicode category be treated as combining characters (:iss:`4439`)\n\n- Fix using ``--shell-integration`` with :file:`setup.py` broken (:iss:`4434`)\n\n- Fix showing debug information not working if kitty's :file:`STDIN` is not a tty\n  (:iss:`4424`)\n\n- Linux: Fix a regression that broke rendering of emoji with variation selectors\n  (:iss:`4444`)\n\n\n0.24.0 [2022-01-04]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Integrate kitty closely with common shells such as zsh, fish and bash.\n  This allows lots of niceties such as jumping to previous prompts, opening the\n  output of the last command in a new window, etc. See :ref:`shell_integration`\n  for details. Packagers please read :ref:`packagers`.\n\n- A new shortcut :sc:`focus_visible_window` to visually focus a window using\n  the keyboard. Pressing it causes numbers to appear over each visible window\n  and you can press the number to focus the corresponding window (:iss:`4110`)\n\n- A new facility :opt:`window_logo_path` to draw an arbitrary PNG image as\n  logo in the corner of a kitty window (:pull:`4167`)\n\n- Allow rendering the cursor with a *reverse video* effect. See :opt:`cursor`\n  for details (:iss:`126`)\n\n- Allow rendering the mouse selection with a *reverse video* effect. See\n  :opt:`selection_foreground` (:iss:`646`)\n\n- A new option :opt:`tab_bar_align` to draw the tab bar centered or right\n  aligned (:iss:`3946`)\n\n- Allow the user to supply a custom Python function to draw tab bar. See\n  :opt:`tab_bar_style`\n\n- A new remote control command to :program:`change the tab color <kitty @\n  set-tab-color>` (:iss:`1287`)\n\n- A new remote control command to :program:`visually select a window <kitty @\n  select-window>` (:iss:`4165`)\n\n- Add support for reporting mouse events with pixel co-ordinates using the\n  ``SGR_PIXEL_PROTOCOL`` introduced in xterm 359\n\n- When programs ask to read from the clipboard prompt, ask the user to allow\n  the request by default instead of denying it by default. See\n  :opt:`clipboard_control` for details (:iss:`4022`)\n\n- A new mappable action ``swap_with_window`` to swap the current window with another window in the tab, visually\n\n- A new :program:`remote control command <kitty @ set-enabled-layouts>` to change\n  the enabled layouts in a tab (:iss:`4129`)\n\n- A new option :opt:`bell_path` to specify the path to a sound file\n  to use as the bell sound\n\n- A new option :opt:`exe_search_path` to modify the locations kitty searches\n  for executables to run (:iss:`4324`)\n\n- broadcast kitten: Show a \"fake\" cursor in all windows being broadcast too\n  (:iss:`4225`)\n\n- Allow defining :opt:`aliases <action_alias>` for more general actions, not just kittens\n  (:pull:`4260`)\n\n- Fix a regression that caused :option:`kitty --title` to not work when\n  opening new OS windows using :option:`kitty --single-instance` (:iss:`3893`)\n\n- icat kitten: Fix display of JPEG images that are rotated via EXIF data and\n  larger than available screen size (:iss:`3949`)\n\n- macOS: Fix SIGUSR1 quitting kitty instead of reloading the config file (:iss:`3952`)\n\n- Launch command: Allow specifying the OS window title\n\n- broadcast kitten: Allow broadcasting :kbd:`ctrl+c` (:pull:`3956`)\n\n- Fix space ligatures not working with Iosevka for some characters in the\n  Enclosed Alphanumeric Supplement (:iss:`3954`)\n\n- hints kitten: Fix a regression that caused using the default open program\n  to trigger open actions instead of running the program (:iss:`3968`)\n\n- Allow deleting environment variables in :opt:`env` by specifying\n  just the variable name, without a value\n\n- Fix :opt:`active_tab_foreground` not being honored when :opt:`tab_bar_style`\n  is ``slant`` (:iss:`4053`)\n\n- When a :opt:`tab_bar_background` is specified it should extend to the edges\n  of the OS window (:iss:`4054`)\n\n- Linux: Fix IME with fcitx5 not working after fcitx5 is restarted\n  (:pull:`4059`)\n\n- Various improvements to IME integration (:iss:`4219`)\n\n- Remote file transfer: Fix transfer not working if custom ssh port or identity\n  is specified on the command line (:iss:`4067`)\n\n- Unicode input kitten: Implement scrolling when more results are found than\n  the available display space (:pull:`4068`)\n\n- Allow middle clicking on a tab to close it (:iss:`4151`)\n\n- The command line option ``--watcher`` has been deprecated in favor of the\n  :opt:`watcher` option in :file:`kitty.conf`. It has the advantage of\n  applying to all windows, not just the initially created ones. Note that\n  ``--watcher`` now also applies to all windows, not just initially created ones.\n\n- **Backward incompatibility**: No longer turn on the kitty extended keyboard\n  protocol's disambiguate mode when the client sends the XTMODKEYS escape code.\n  Applications must use the dedicated escape code to turn on the protocol.\n  (:iss:`4075`)\n\n- Fix soft hyphens not being preserved when round tripping text through the\n  terminal\n\n- macOS: Fix :kbd:`ctrl+shift` with :kbd:`Esc` or :kbd:`F1` - :kbd:`F12` not working\n  (:iss:`4109`)\n\n- macOS: Fix :opt:`resize_in_steps` not working correctly on high DPI screens\n  (:iss:`4114`)\n\n- Fix the :program:`resize OS Windows <kitty @ resize-os-window>` setting a\n  slightly incorrect size on high DPI screens (:iss:`4114`)\n\n- :program:`kitty @ launch` - when creating tabs with the ``--match`` option create\n  the tab in the OS Window containing the result of the match rather than\n  the active OS Window (:iss:`4126`)\n\n- Linux X11: Add support for 10bit colors (:iss:`4150`)\n\n- Fix various issues with changing :opt:`tab_bar_background` by remote control\n  (:iss:`4152`)\n\n- A new option :opt:`tab_bar_margin_color` to control the color of the tab bar\n  margins\n\n- A new option :opt:`visual_bell_color` to customize the color of the visual bell\n  (:pull:`4181`)\n\n- Add support for OSC 777 based desktop notifications\n\n- Wayland: Fix pasting from applications that use a MIME type of \"text/plain\"\n  rather than \"text/plain;charset=utf-8\" not working (:iss:`4183`)\n\n- A new mappable action to close windows with a confirmation (:iss:`4195`)\n\n- When remembering OS window sizes for full screen windows use the size before\n  the window became fullscreen (:iss:`4221`)\n\n- macOS: Fix keyboard input not working after toggling fullscreen till the\n  window is clicked in\n\n- A new mappable action ``nth_os_window`` to to focus the specified nth OS\n  window. (:pull:`4316`)\n\n- macOS: The kitty window can be scrolled by the mouse wheel when OS window not\n  in focus. (:pull:`4371`)\n\n- macOS: Light or dark system appearance can be specified in\n  :opt:`macos_titlebar_color` and used in kitty themes. (:pull:`4378`)\n\n\n0.23.1 [2021-08-17]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix themes kitten failing to download themes because of missing SSL\n  root certificates (:iss:`3936`)\n\n- A new option :opt:`clipboard_max_size` to control the maximum size\n  of data that kitty will transmit to the system clipboard on behalf of\n  programs running inside it (:iss:`3937`)\n\n- When matching windows/tabs in kittens or using remote control, allow matching\n  by recency. ``recent:0`` matches the active window/tab, ``recent:1`` matches\n  the previous window/tab and so on\n\n- themes kitten: Fix only the first custom theme file being loaded correctly\n  (:iss:`3938`)\n\n\n0.23.0 [2021-08-16]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new :doc:`themes kitten </kittens/themes>` to easily change kitty themes.\n  Choose from almost two hundred themes in the `kitty themes repository\n  <https://github.com/kovidgoyal/kitty-themes>`_\n\n- A new style for the tab bar that makes tabs looks like the tabs in a physical\n  tabbed file, see :opt:`tab_bar_style`\n\n- Make the visual bell flash more gentle, especially on dark themes\n  (:pull:`2937`)\n\n- Fix :option:`kitty --title` not overriding the OS Window title when multiple\n  tabs are present. Also this option is no longer used as the default title for\n  windows, allowing individual tabs/windows to have their own titles, even when\n  the OS Window has a fixed overall title (:iss:`3893`)\n\n- Linux: Fix some very long ligatures being rendered incorrectly at some font\n  sizes (:iss:`3896`)\n\n- Fix shift+middle click to paste sending a mouse press event but no release\n  event which breaks some applications that grab the mouse but cant handle\n  mouse events (:iss:`3902`)\n\n- macOS: When the language is set to English and the country to one for which\n  an English locale does not exist, set :envvar:`LANG` to ``en_US.UTF-8``\n  (:iss:`3899`)\n\n- terminfo: Fix \"cnorm\" the property for setting the cursor to normal using a\n  solid block rather than a blinking block cursor (:iss:`3906`)\n\n- Add :opt:`clear_all_mouse_actions` to clear all mouse actions defined to\n  that point (:iss:`3907`)\n\n- Fix the remote file kitten not working when using -- with ssh. The ssh kitten\n  was recently changed to do this (:iss:`3929`)\n\n- When dragging word or line selections, ensure the initially selected item is\n  never deselected. This matches behavior in most other programs (:iss:`3930`)\n\n- hints kitten: Make copy/paste with the :option:`kitty +kitten hints\n  --program` option work when using the ``self``\n  :option:`kitty +kitten hints --linenum-action` (:iss:`3931`)\n\n\n0.22.2 [2021-08-02]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix a long standing bug that could cause kitty windows to stop\n  updating, that got worse in the previous release (:iss:`3890` and\n  :iss:`2016`)\n\n- Wayland: A better fix for compositors like sway that can toggle client side\n  decorations on and off (:iss:`3888`)\n\n\n0.22.1 [2021-07-31]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix a regression in the previous release that broke ``kitty --help`` (:iss:`3869`)\n\n- Graphics protocol: Fix composing onto currently displayed frame not updating the frame on the GPU (:iss:`3874`)\n\n- Fix switching to previously active tab after detaching a tab not working (:pull:`3871`)\n\n- macOS: Fix an error on Apple silicon when enumerating monitors (:pull:`3875`)\n\n- detach_window: Allow specifying the previously active tab or the tab to the left/right of\n  the active tab (:disc:`3877`)\n\n- broadcast kitten: Fix a regression in ``0.20.0`` that broke sending of some\n  keys, such as backspace\n\n- Linux binary: Remove any RPATH build artifacts from bundled libraries\n\n- Wayland: If the compositor turns off server side decorations after turning\n  them on do not draw client side decorations (:iss:`3888`)\n\n\n0.22.0 [2021-07-26]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a new :ac:`toggle_layout` action to easily zoom/unzoom a window\n\n- When right clicking to extend a selection, move the nearest selection\n  boundary rather than the end of the selection. To restore previous behavior\n  use ``mouse_map right press ungrabbed mouse_selection move-end``.\n\n- When opening hyperlinks, allow defining open actions for directories\n  (:pull:`3836`)\n\n- When using the OSC 52 escape code to copy to clipboard allow large\n  copies (up to 8MB) without needing a kitty specific chunking protocol.\n  Note that if you used the chunking protocol in the past, it will no longer\n  work and you should switch to using the unmodified protocol which has the\n  advantage of working with all terminal emulators.\n\n- Fix a bug in the implementation of the synchronized updates escape code that\n  could cause incorrect parsing if either the pending buffer capacity or the\n  pending timeout were exceeded (:iss:`3779`)\n\n- A new remote control command to :program:`resize the OS Window <kitty @\n  resize-os-window>`\n\n- Graphics protocol: Add support for composing rectangles from one animation\n  frame onto another (:iss:`3809`)\n\n- diff kitten: Remove limit on max line length of 4096 characters (:iss:`3806`)\n\n- Fix turning off cursor blink via escape codes not working (:iss:`3808`)\n\n- Allow using neighboring window operations in the stack layout. The previous\n  window is considered the left and top neighbor and the next window is\n  considered the bottom and right neighbor (:iss:`3778`)\n\n- macOS: Render colors in the sRGB colorspace to match other macOS terminal\n  applications (:iss:`2249`)\n\n- Add a new variable ``{num_window_groups}`` for the :opt:`tab_title_template`\n  (:iss:`3837`)\n\n- Wayland: Fix :opt:`initial_window_width/height <remember_window_size>` specified\n  in cells not working on High DPI screens (:iss:`3834`)\n\n- A new theme for the kitty website with support for dark mode.\n\n- Render \u2504 \u2505 \u2506 \u2507 \u2508 \u2509 \u250a \u250b with spaces at the edges. Matches rendering in\n  most other programs and allows long chains of them to look better\n  (:iss:`3844`)\n\n- hints kitten: Detect paths and hashes that appear over multiple lines.\n  Note that this means that all line breaks in the text are no longer \\n\n  soft breaks are instead \\r. If you use a custom regular expression that\n  is meant to match over line breaks, you will need to match over both.\n  (:iss:`3845`)\n\n- Allow leading or trailing spaces in :opt:`tab_activity_symbol`\n\n- Fix mouse actions not working when caps lock or num lock are engaged\n  (:iss:`3859`)\n\n- macOS: Fix automatic detection of bold/italic faces for fonts that\n  use the family name as the full face name of the regular font not working\n  (:iss:`3861`)\n\n- clipboard kitten: fix copies to clipboard not working without the\n  :option:`kitty +kitten clipboard --wait-for-completion` option\n\n\n0.21.2 [2021-06-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new ``adjust_baseline`` option to adjust the vertical alignment of text\n  inside a line (:pull:`3734`)\n\n- A new :opt:`url_excluded_characters` option to exclude additional characters\n  when detecting URLs under the mouse (:pull:`3738`)\n\n- Fix a regression in 0.21.0 that broke rendering of private use Unicode symbols followed\n  by spaces, when they also exist not followed by spaces (:iss:`3729`)\n\n- ssh kitten: Support systems where the login shell is a non-POSIX shell\n  (:iss:`3405`)\n\n- ssh kitten: Add completion (:iss:`3760`)\n\n- ssh kitten: Fix \"Connection closed\" message being printed by ssh when running\n  remote commands\n\n- Add support for the XTVERSION escape code\n\n- macOS: Fix a regression in 0.21.0 that broke middle-click to paste from clipboard (:iss:`3730`)\n\n- macOS: Fix shortcuts in the global menu bar responding slowly when cursor blink\n  is disabled/timed out (:iss:`3693`)\n\n- When displaying scrollback ensure that the window does not quit if the amount\n  of scrollback is less than a screen and the user has the ``--quit-if-one-screen``\n  option enabled for less (:iss:`3740`)\n\n- Linux: Fix Emoji/bitmapped fonts not use able in symbol_map\n\n- query terminal kitten: Allow querying font face and size information\n  (:iss:`3756`)\n\n- hyperlinked grep kitten: Fix context options not generating contextual output (:iss:`3759`)\n\n- Allow using superscripts in tab titles (:iss:`3763`)\n\n- Unicode input kitten: Fix searching when a word has more than 1024 matches (:iss:`3773`)\n\n\n0.21.1 [2021-06-14]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix a regression in the previous release that broke rendering of\n  strikeout (:iss:`3717`)\n\n- macOS: Fix a crash when rendering ligatures larger than 128 characters\n  (:iss:`3724`)\n\n- Fix a regression in the previous release that could cause a crash when\n  changing layouts and mousing (:iss:`3713`)\n\n\n0.21.0 [2021-06-12]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow reloading the :file:`kitty.conf` config file by pressing\n  :sc:`reload_config_file`. (:iss:`1292`)\n\n- Allow clicking URLs to open them without needing to also hold\n  :kbd:`ctrl+shift`\n\n- Allow remapping all mouse button press/release events to perform arbitrary\n  actions. :ref:`See details <conf-kitty-mouse.mousemap>` (:iss:`1033`)\n\n- Support infinite length ligatures (:iss:`3504`)\n\n- **Backward incompatibility**: The options to control which modifiers keys to\n  press for various mouse actions have been removed, if you used these options,\n  you will need to replace them with configuration using the new\n  :ref:`mouse actions framework <conf-kitty-mouse.mousemap>` as they will be\n  ignored. The options were: ``terminal_select_modifiers``,\n  ``rectangle_select_modifiers`` and ``open_url_modifiers``.\n\n- Add a configurable mouse action (:kbd:`ctrl+alt+triplepress` to select from the\n  clicked point to the end of the line. (:iss:`3585`)\n\n- Add the ability to un-scroll the screen to the ``kitty @ scroll-window``\n  remote control command (:iss:`3604`)\n\n- A new option, :opt:`tab_bar_margin_height` to add margins around the\n  top and bottom edges of the tab bar (:iss:`3247`)\n\n- Unicode input kitten: Fix a regression in 0.20.0 that broke keyboard handling\n  when the NumLock or CapsLock modifiers were engaged. (:iss:`3587`)\n\n- Fix a regression in 0.20.0 that sent incorrect bytes for the :kbd:`F1`-:kbd:`F4` keys\n  in rmkx mode (:iss:`3586`)\n\n- macOS: When the Apple Color Emoji font lacks an emoji glyph search for it in other\n  installed fonts (:iss:`3591`)\n\n- macOS: Fix rendering getting stuck on some machines after sleep/screensaver\n  (:iss:`2016`)\n\n- macOS: Add a new ``Shell`` menu to the global menubar with some commonly used\n  actions (:pull:`3653`)\n\n- macOS: Fix the baseline for text not matching other CoreText based\n  applications for some fonts (:iss:`2022`)\n\n- Add a few more special commandline arguments for the launch command. Now all\n  ``KITTY_PIPE_DATA`` is also available via command line argument substitution\n  (:iss:`3593`)\n\n- Fix dynamically changing the background color in a window causing rendering\n  artifacts in the tab bar (:iss:`3595`)\n\n- Fix passing STDIN to launched background processes causing them to not inherit\n  environment variables (:pull:`3603`)\n\n- Fix deleting windows that are not the last window via remote control leaving\n  no window focused (:iss:`3619`)\n\n- Add an option :option:`kitty @ get-text --add-cursor` to also get the current\n  cursor position and state as ANSI escape codes (:iss:`3625`)\n\n- Add an option :option:`kitty @ get-text --add-wrap-markers` to add line wrap\n  markers to the output (:pull:`3633`)\n\n- Improve rendering of curly underlines on HiDPI screens (:pull:`3637`)\n\n- ssh kitten: Mimic behavior of ssh command line client more closely by\n  executing any command specified on the command line via the users' shell\n  just as ssh does (:iss:`3638`)\n\n- Fix trailing parentheses in URLs not being detected (:iss:`3688`)\n\n- Tab bar: Use a lower contrast color for tab separators (:pull:`3666`)\n\n- Fix a regression that caused using the ``title`` command in session files\n  to stop working (:iss:`3676`)\n\n- macOS: Fix a rare crash on exit (:iss:`3686`)\n\n- Fix ligatures not working with the `Iosevka\n  <https://github.com/be5invis/Iosevka>`_ font (requires Iosevka >= 7.0.4)\n  (:iss:`297`)\n\n- Remote control: Allow matching tabs by index number in currently active OS\n  Window (:iss:`3708`)\n\n- ssh kitten: Fix non-standard properties in terminfo such as the ones used for\n  true color not being copied (:iss:`312`)\n\n\n0.20.3 [2021-05-06]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Distribute universal binaries with both ARM and Intel architectures\n\n- A new ``show_key`` kitten to easily see the bytes generated by the terminal\n  for key presses in the various keyboard modes (:pull:`3556`)\n\n- Linux: Fix keyboard layout change keys defined via compose rules not being\n  ignored\n\n- macOS: Fix Spotlight search of global menu not working in non-English locales\n  (:pull:`3567`)\n\n- Fix tab activity symbol not appearing if no other changes happen in tab bar even when\n  there is activity in a tab (:iss:`3571`)\n\n- Fix focus changes not being sent to windows when focused window changes\n  because of the previously focused window being closed (:iss:`3571`)\n\n\n0.20.2 [2021-04-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new protocol extension to :ref:`unscroll <unscroll>` text from the\n  scrollback buffer onto the screen. Useful, for example, to restore\n  the screen after showing completions below the shell prompt.\n\n- A new remote control command :ref:`at-env` to change the default\n  environment passed to newly created windows (:iss:`3529`)\n\n- Linux: Fix binary kitty builds not able to load fonts in WOFF2 format\n  (:iss:`3506`)\n\n- macOS: Prevent :kbd:`option` based shortcuts for being used for global menu\n  actions (:iss:`3515`)\n\n- Fix ``kitty @ close-tab`` not working with pipe based remote control\n  (:iss:`3510`)\n\n- Fix removal of inactive tab that is before the currently active tab causing\n  the highlighted tab to be incorrect (:iss:`3516`)\n\n- icat kitten: Respect EXIF orientation when displaying JPEG images\n  (:iss:`3518`)\n\n- GNOME: Fix maximize state not being remembered when focus changes and window\n  decorations are hidden (:iss:`3507`)\n\n- GNOME: Add a new :opt:`wayland_titlebar_color` option to control the color of the\n  kitty window title bar\n\n- Fix reading :option:`kitty --session` from ``STDIN`` not working when the\n  :code:`kitty --detach` option is used (:iss:`3523`)\n\n- Special case rendering of the few remaining Powerline box drawing chars\n  (:iss:`3535`)\n\n- Fix ``kitty @ set-colors`` not working for the :opt:`active_tab_foreground`.\n\n\n0.20.1 [2021-04-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- icat: Fix some broken GIF images with no frame delays not being animated\n  (:iss:`3498`)\n\n- hints kitten: Fix sending hyperlinks to their default handler not working\n  (:pull:`3500`)\n\n- Wayland: Fix regression in previous release causing window decorations to\n  be drawn even when compositor supports server side decorations (:iss:`3501`)\n\n\n0.20.0 [2021-04-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Support display of animated images ``kitty +kitten icat animation.gif``. See\n  :ref:`animation_protocol` for details on animation support in the kitty\n  graphics protocol.\n\n- A new keyboard reporting protocol with various advanced features that can be\n  used by full screen terminal programs and even games, see\n  :doc:`keyboard-protocol` (:iss:`3248`)\n\n- **Backward incompatibility**: Session files now use the full :doc:`launch <launch>`\n  command with all its capabilities. However, the syntax of the command is\n  slightly different from before. In particular watchers are now specified\n  directly on launch and environment variables are set using ``--env``.\n\n- Allow setting colors when creating windows using the :doc:`launch <launch>` command.\n\n- A new option :opt:`tab_powerline_style` to control the appearance of the tab\n  bar when using the powerline tab bar style.\n\n- A new option :opt:`scrollback_fill_enlarged_window` to fill extra lines in\n  the window when the window is expanded with lines from the scrollback\n  (:pull:`3371`)\n\n- diff kitten: Implement recursive diff over SSH (:iss:`3268`)\n\n- ssh kitten: Allow using python instead of the shell on the server, useful if\n  the shell used is a non-POSIX compliant one, such as fish (:iss:`3277`)\n\n- Add support for the color settings stack that XTerm copied from us without\n  acknowledgement and decided to use incompatible escape codes for.\n\n- Add entries to the terminfo file for some user capabilities that are shared\n  with XTerm (:pull:`3193`)\n\n- The launch command now does more sophisticated resolving of executables to\n  run. The system-wide PATH is used first, then system specific default paths,\n  and finally the PATH inside the shell.\n\n- Double clicking on empty tab bar area now opens a new tab (:iss:`3201`)\n\n- kitty @ ls: Show only environment variables that are different for each\n  window, by default.\n\n- When passing a directory or a non-executable file as the program to run to\n  kitty opens it with the shell or by parsing the shebang, instead of just failing.\n\n- Linux: Fix rendering of emoji followed by the graphics variation selector not\n  being colored with some fonts (:iss:`3211`)\n\n- Unicode input: Fix using index in select by name mode not working for indices\n  larger than 16. Also using an index does not filter the list of matches. (:pull:`3219`)\n\n- Wayland: Add support for the text input protocol (:iss:`3410`)\n\n- Wayland: Fix mouse handling when using client side decorations\n\n- Wayland: Fix un-maximizing a window not restoring its size to what it was\n  before being maximized\n\n- GNOME/Wayland: Improve window decorations the titlebar now shows the window\n  title. Allow running under Wayland on GNOME by default. (:iss:`3284`)\n\n- Panel kitten: Allow setting WM_CLASS (:iss:`3233`)\n\n- macOS: Add menu items to close the OS window and the current tab (:pull:`3240`, :iss:`3246`)\n\n- macOS: Allow opening script and command files with kitty (:iss:`3366`)\n\n- Also detect ``gemini://`` URLs when hovering with the mouse (:iss:`3370`)\n\n- When using a non-US keyboard layout and pressing :kbd:`ctrl+key` when\n  the key matches an English key, send that to the program running in the\n  terminal automatically (:iss:`2000`)\n\n- When matching shortcuts, also match on shifted keys, so a shortcut defined as\n  :kbd:`ctrl+plus` will match a keyboard where you have to press\n  :kbd:`shift+equal` to get the plus key (:iss:`2000`)\n\n- Fix extra space at bottom of OS window when using the fat layout with the tab bar at the\n  top (:iss:`3258`)\n\n- Fix window icon not working on X11 with 64bits (:iss:`3260`)\n\n- Fix OS window sizes under 100px resulting in scaled display (:iss:`3307`)\n\n- Fix rendering of ligatures in the latest release of Cascadia code, which for\n  some reason puts empty glyphs after the ligature glyph rather than before it\n  (:iss:`3313`)\n\n- Improve handling of infinite length ligatures in newer versions of FiraCode\n  and CascadiaCode. Now such ligatures are detected based on glyph naming\n  convention. This removes the gap in the ligatures at cell boundaries (:iss:`2695`)\n\n- macOS: Disable the native operating system tabs as they are non-functional\n  and can be confusing (:iss:`3325`)\n\n- hints kitten: When using the linenumber action with a background action,\n  preserve the working directory (:iss:`3352`)\n\n- Graphics protocol: Fix suppression of responses not working for chunked\n  transmission (:iss:`3375`)\n\n- Fix inactive tab closing causing active tab to change (:iss:`3398`)\n\n- Fix a crash on systems using musl as libc (:iss:`3395`)\n\n- Improve rendering of rounded corners by using a rectircle equation rather\n  than a cubic bezier (:iss:`3409`)\n\n- Graphics protocol: Add a control to allow clients to specify that the cursor\n  should not move when displaying an image (:iss:`3411`)\n\n- Fix marking of text not working on lines that contain zero cells\n  (:iss:`3403`)\n\n- Fix the selection getting changed if the screen contents scroll while\n  the selection is in progress (:iss:`3431`)\n\n- X11: Fix :opt:`resize_in_steps` being applied even when window is maximized\n  (:iss:`3473`)\n\n\n0.19.3 [2020-12-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Happy holidays to all kitty users!\n\n- A new :doc:`broadcast <kittens/broadcast>` kitten to type in all kitty windows\n  simultaneously (:iss:`1569`)\n\n- Add a new mappable `select_tab` action to choose a tab to switch to even\n  when the tab bar is hidden (:iss:`3115`)\n\n- Allow specifying text formatting in :opt:`tab_title_template` (:iss:`3146`)\n\n- Linux: Read :opt:`font_features` from the FontConfig database as well, so\n  that they can be configured in a single, central location (:pull:`3174`)\n\n- Graphics protocol: Add support for giving individual image placements their\n  own ids and for asking the terminal emulator to assign ids for images. Also\n  allow suppressing responses from the terminal to commands.\n  These are backwards compatible protocol extensions. (:iss:`3133`,\n  :iss:`3163`)\n\n- Distribute extra pixels among all eight-blocks rather than adding them\n  all to the last block (:iss:`3097`)\n\n- Fix drawing of a few sextant characters incorrect (:pull:`3105`)\n\n- macOS: Fix minimize not working for chromeless windows (:iss:`3112`)\n\n- Preserve lines in the scrollback if a scrolling region is defined that\n  is contiguous with the top of the screen (:iss:`3113`)\n\n- Wayland: Fix key repeat being stopped by the release of an unrelated key\n  (:iss:`2191`)\n\n- Add an option, :opt:`detect_urls` to control whether kitty will detect URLs\n  when the mouse moves over them (:pull:`3118`)\n\n- Graphics protocol: Dont return filename in the error message when opening file\n  fails, since filenames can contain control characters (:iss:`3128`)\n\n- macOS: Partial fix for traditional fullscreen not working on Big Sur\n  (:iss:`3100`)\n\n- Fix one ANSI formatting escape code not being removed from the pager history\n  buffer when piping it as plain text (:iss:`3132`)\n\n- Match the save/restore cursor behavior of other terminals, for the sake of\n  interoperability. This means that doing a DECRC without a prior DECSC is now\n  undefined (:iss:`1264`)\n\n- Fix mapping ``remote_control send-text`` not working (:iss:`3147`)\n\n- Add a ``right`` option for :opt:`tab_switch_strategy` (:pull:`3155`)\n\n- Fix a regression in 0.19.0 that caused a rare crash when using the optional\n  :opt:`scrollback_pager_history_size` (:iss:`3049`)\n\n- Full screen kittens: Fix incorrect cursor position after kitten quits\n  (:iss:`3176`)\n\n\n0.19.2 [2020-11-13]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new :doc:`kittens/query_terminal` kitten to easily query the running kitty\n  via escape codes to detect its version, and the values of\n  configuration options that enable or disable terminal features.\n\n- Options to control mouse pointer shape, :opt:`default_pointer_shape`, and\n  :opt:`pointer_shape_when_dragging` (:pull:`3041`)\n\n- Font independent rendering for braille characters, which ensures they are properly\n  aligned at all font sizes.\n\n- Fix a regression in 0.19.0 that caused borders not to be drawn when setting\n  :opt:`window_margin_width` and keeping :opt:`draw_minimal_borders` on\n  (:iss:`3017`)\n\n- Fix a regression in 0.19.0 that broke rendering of one-eight bar unicode\n  characters at very small font sizes (:iss:`3025`)\n\n- Wayland: Fix a crash under GNOME when using multiple OS windows\n  (:pull:`3066`)\n\n- Fix selections created by dragging upwards not being auto-cleared when\n  screen contents change (:pull:`3028`)\n\n- macOS: Fix kitty not being added to PATH automatically when using pre-built\n  binaries (:iss:`3063`)\n\n- Allow adding MIME definitions to kitty by placing a ``mime.types`` file in\n  the kitty config directory (:iss:`3056`)\n\n- Dont ignore :option:`--title` when using a session file that defines no\n  windows (:iss:`3055`)\n\n- Fix the send_text action not working in URL handlers (:iss:`3081`)\n\n- Fix last character of URL not being detected if it is the only character on a\n  new line (:iss:`3088`)\n\n- Don't restrict the ICH,DCH,REP control codes to only the current scroll region  (:iss:`3090`, :iss:`3096`)\n\n\n0.19.1 [2020-10-06]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- hints kitten: Add an ``ip`` type for easy selection of IP addresses\n  (:pull:`3009`)\n\n- Fix a regression that caused a segfault when using\n  :opt:`scrollback_pager_history_size` and it needs to be expanded (:iss:`3011`)\n\n- Fix update available notifications repeating (:pull:`3006`)\n\n\n0.19.0 [2020-10-04]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add support for `hyperlinks from terminal programs\n  <https://gist.github.com/egmontkob/eb114294efbcd5adb1944c9f3cb5feda>`_.\n  Controlled via :opt:`allow_hyperlinks` (:iss:`68`)\n\n- Add support for easily editing or downloading files over SSH sessions\n  without the need for any special software, see :doc:`kittens/remote_file`\n\n- A new :doc:`kittens/hyperlinked_grep` kitten to easily search files and open\n  the results at the matched line by clicking on them.\n\n- Allow customizing the :doc:`actions kitty takes <open_actions>` when clicking on URLs\n\n- Improve rendering of borders when using minimal borders. Use less space and\n  do not display a box around active windows\n\n- Add a new extensible escape code to allow terminal programs to trigger\n  desktop notifications. See :ref:`desktop_notifications` (:iss:`1474`)\n\n- Implement special rendering for various characters from the set of \"Symbols\n  for Legacy Computing\" from the Unicode 13 standard\n\n- Unicode input kitten: Allow choosing symbols from the NERD font as well.\n  These are mostly Private Use symbols not in any standard, however are common. (:iss:`2972`)\n\n- Allow specifying border sizes in either pts or pixels. Change the default to\n  0.5pt borders as this works best with the new minimal border style\n\n- Add support for displaying correct colors with non-sRGB PNG files (Adds a\n  dependency on liblcms2)\n\n- hints kitten: Add a new :option:`kitty +kitten hints --type` of ``hyperlink`` useful\n  for activating hyperlinks using just the keyboard\n\n- Allow tracking focus change events in watchers (:iss:`2918`)\n\n- Allow specifying watchers in session files and via a command line argument\n  (:iss:`2933`)\n\n- Add a setting :opt:`tab_activity_symbol` to show a symbol in the tab title\n  if one of the windows has some activity after it was last focused\n  (:iss:`2515`)\n\n- macOS: Switch to using the User Notifications framework for notifications.\n  The current notifications framework has been deprecated in Big Sur. The new\n  framework only allows notifications from signed and notarized applications,\n  so people using kitty from homebrew/source are out of luck. Complain to\n  Apple.\n\n- When in the main screen and a program grabs the mouse, do not use the scroll\n  wheel events to scroll the scrollback buffer, instead send them to the\n  program (:iss:`2939`)\n\n- Fix unfocused windows in which a bell occurs not changing their border color\n  to red until a relayout\n\n- Linux: Fix automatic detection of bold/italic faces for fonts such as IBM\n  Plex Mono that have the regular face with a full name that is the same as the\n  family name (:iss:`2951`)\n\n- Fix a regression that broke :opt:`kitten_alias` (:iss:`2952`)\n\n- Fix a regression that broke the ``move_window_to_top`` action (:pull:`2953`)\n\n- Fix a memory leak when changing font sizes\n\n- Fix some lines in the scrollback buffer not being properly rendered after a\n  window resize/font size change (:iss:`2619`)\n\n\n0.18.3 [2020-08-11]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- hints kitten: Allow customizing hint colors (:pull:`2894`)\n\n- Wayland: Fix a typo in the previous release that broke reading mouse cursor size (:iss:`2895`)\n\n- Fix a regression in the previous release that could cause an exception during\n  startup in rare circumstances (:iss:`2896`)\n\n- Fix image leaving behind a black rectangle when switch away and back to\n  alternate screen (:iss:`2901`)\n\n- Fix one pixel mis-alignment of rounded corners when either the cell\n  dimensions or the thickness of the line is an odd number of pixels\n  (:iss:`2907`)\n\n- Fix a regression that broke specifying OS window size in the session file\n  (:iss:`2908`)\n\n\n0.18.2 [2020-07-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- X11: Improve handling of multiple keyboards. Now pressing a modifier key in\n  one keyboard and a normal key in another works (:iss:`2362`). Don't rebuild\n  keymaps on new keyboard events that only change geometry (:iss:`2787`).\n  Better handling of multiple keyboards with incompatible layouts (:iss:`2726`)\n\n- Improve anti-aliasing of triangular box drawing characters, noticeable on\n  low-resolution screens (:iss:`2844`)\n\n- Fix ``kitty @ send-text`` not working reliably when using a socket for remote\n  control (:iss:`2852`)\n\n- Implement support for box drawing rounded-corners characters (:iss:`2240`)\n\n- Allow setting the class for new OS windows in a session file\n\n- When a character from the Unicode Dingbat block is followed by a space, use\n  the extra space to render a larger version of the character (:iss:`2850`)\n\n- macOS: Fix the LC_CTYPE env var being set to UTF-8 on systems in which the\n  language and country code do not form a valid locale (:iss:`1233`)\n\n- macOS: Fix :kbd:`cmd+plus` not changing font size (:iss:`2839`)\n\n- Make neighboring window selection in grid and splits layouts more intelligent\n  (:pull:`2840`)\n\n- Allow passing the current selection to kittens (:iss:`2796`)\n\n- Fix pre-edit text not always being cleared with ibus input (:iss:`2862`)\n\n- Allow setting the :opt:`background_opacity` of new OS windows created via\n  :option:`kitty --single-instance` using the :option:`kitty --override` command line\n  argument (:iss:`2806`)\n\n- Fix the CSI J (Erase in display ED) escape code not removing line continued\n  markers (:iss:`2809`)\n\n- hints kitten: In linenumber mode expand paths that starts with ~\n  (:iss:`2822`)\n\n- Fix ``launch --location=last`` not working (:iss:`2841`)\n\n- Fix incorrect centering when a PUA or symbol glyph is followed by more than one space\n\n- Have the :opt:`confirm_os_window_close` option also apply when closing tabs\n  with multiple windows (:iss:`2857`)\n\n- Add support for legacy DECSET codes 47, 1047 and 1048 (:pull:`2871`)\n\n- macOS: no longer render emoji 20% below the baseline. This caused some emoji\n  to be cut-off and also look misaligned with very high cells (:iss:`2873`)\n\n- macOS: Make the window id of OS windows available in the ``WINDOWID``\n  environment variable (:pull:`2877`)\n\n- Wayland: Fix a regression in 0.18.0 that could cause crashes related to mouse\n  cursors in some rare circumstances (:iss:`2810`)\n\n- Fix change in window size that does not change number of cells not being\n  reported to the kernel (:iss:`2880`)\n\n\n0.18.1 [2020-06-23]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix for diff kitten not working with python 3.8 (:iss:`2780`)\n\n\n0.18.0 [2020-06-20]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow multiple overlay windows per normal window\n\n- Add an option :opt:`confirm_os_window_close` to ask for confirmation\n  when closing an OS window with multiple kitty windows.\n\n- Tall and Fat layouts: Add a ``mirrored`` option to put the full size window\n  on the opposite edge of the screen (:iss:`2654`)\n\n- Tall and Fat layouts: Add mappable actions to increase or decrease the number\n  of full size windows (:iss:`2688`)\n\n- Allow sending arbitrary signals to the current foreground process in a window\n  using either a mapping in kitty.conf or via remote control (:iss:`2778`)\n\n- Allow sending the back and forward mouse buttons to terminal applications\n  (:pull:`2742`)\n\n- **Backwards incompatibility**: The numbers used to encode mouse buttons\n  for the ``send_mouse_event`` function that can be used in kittens have\n  been changed (see :ref:`send_mouse_event`).\n\n- Add a new mappable ``quit`` action to quit kitty completely.\n\n- Fix marks using different colors with regexes using only a single color\n  (:pull:`2663`)\n\n- Linux: Workaround for broken Nvidia drivers for old cards (:iss:`456`)\n\n- Wayland: Fix kitty being killed on some Wayland compositors if a hidden window\n  has a lot of output (:iss:`2329`)\n\n- BSD: Fix controlling terminal not being established (:pull:`2686`)\n\n- Add support for the CSI REP escape code (:pull:`2702`)\n\n- Wayland: Fix mouse cursor rendering on HiDPI screens (:pull:`2709`)\n\n- X11: Recompile keymaps on XkbNewKeyboardNotify events (:iss:`2726`)\n\n- X11: Reduce startup time by ~25% by only querying GLX for framebuffer\n  configurations once (:iss:`2754`)\n\n- macOS: Notarize the kitty application bundle (:iss:`2040`)\n\n- Fix the kitty shell launched via a mapping needlessly requiring\n  :opt:`allow_remote_control` to be turned on.\n\n\n0.17.4 [2020-05-09]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow showing the name of the current layout and the number of windows\n  in tab titles (:iss:`2634`)\n\n- macOS: Fix a regression in the previous release that caused ligatures to be\n  not be centered horizontally (:iss:`2591`)\n\n- By default, double clicking no longer considers the : as part of words, see\n  :opt:`select_by_word_characters` (:iss:`2602`)\n\n- Fix a regression that caused clicking in the padding/margins of windows in\n  the stack layout to switch the window to the first window (:iss:`2604`)\n\n- macOS: Fix a regression that broke drag and drop (:iss:`2605`)\n\n- Report modifier key state when sending wheel events to the terminal program\n\n- Fix kitty @ send-text not working with text larger than 1024 bytes when using\n  :option:`kitty --listen-on` (:iss:`2607`)\n\n- Wayland: Fix OS window title not updating for hidden windows (:iss:`2629`)\n\n- Fix :opt:`background_tint` making the window semi-transparent (:iss:`2618`)\n\n\n0.17.3 [2020-04-23]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow individually setting margins and padding for each edge (left, right,\n  top, bottom). Margins can also be controlled per window via remote control\n  (:iss:`2546`)\n\n- Fix reverse video not being rendered correctly when using transparency or a\n  background image (:iss:`2419`)\n\n- Allow mapping arbitrary remote control commands to key presses in\n  :file:`kitty.conf`\n\n- X11: Fix crash when doing drag and drop from some applications (:iss:`2505`)\n\n- Fix :option:`launch --stdin-add-formatting` not working (:iss:`2512`)\n\n- Update to Unicode 13.0 (:iss:`2513`)\n\n- Render country flags designated by a pair of unicode codepoints\n  in two cells instead of four.\n\n- diff kitten: New option to control the background color for filler lines in\n  the margin (:iss:`2518`)\n\n- Fix specifying options for layouts in the startup session file not working\n  (:iss:`2520`)\n\n- macOS: Fix incorrect horizontal positioning of some full-width East Asian characters\n  (:iss:`1457`)\n\n- macOS: Render multi-cell PUA characters centered, matching behavior on other\n  platforms\n\n- Linux: Ignore keys if they are designated as layout/group/mode switch keys\n  (:iss:`2519`)\n\n- Marks: Fix marks not handling wide characters and tab characters correctly\n  (:iss:`2534`)\n\n- Add a new :opt:`listen_on` option in kitty.conf to set :option:`kitty --listen-on`\n  globally. Also allow using environment variables in this option (:iss:`2569`).\n\n- Allow sending mouse events in kittens (:pull:`2538`)\n\n- icat kitten: Fix display of 16-bit depth images (:iss:`2542`)\n\n- Add ncurses specific terminfo definitions for strikethrough (:pull:`2567`)\n\n- Fix a regression in 0.17 that broke displaying graphics over SSH\n  (:iss:`2568`)\n\n- Fix :option:`--title` not being applied at window creation time (:iss:`2570`)\n\n0.17.2 [2020-03-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a :option:`launch --watcher` option that allows defining callbacks\n  that are called for various events in the window's life-cycle (:iss:`2440`)\n\n- Fix a regression in 0.17 that broke drawing of borders with non-minimal\n  borders (:iss:`2474`)\n\n- Hints kitten: Allow copying to primary selection as well as clipboard\n  (:pull:`2487`)\n\n- Add a new mappable action ``close_other_windows_in_tab`` to close all but the\n  active window (:iss:`2484`)\n\n- Hints kitten: Adjust the default regex used to detect line numbers to handle\n  line+column numbers (:iss:`2268`)\n\n- Fix blank space at the start of tab bar in the powerline style when first tab is\n  inactive (:iss:`2478`)\n\n- Fix regression causing incorrect rendering of separators in tab bar when\n  defining a tab bar background color (:pull:`2480`)\n\n- Fix a regression in 0.17 that broke the kitty @ launch remote command and\n  also broke the --tab-title option when creating a new tab. (:iss:`2488`)\n\n- Linux: Fix selection of fonts with multiple width variants not preferring\n  the normal width faces (:iss:`2491`)\n\n\n0.17.1 [2020-03-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix :opt:`cursor_underline_thickness` not working (:iss:`2465`)\n\n- Fix a regression in 0.17 that caused tab bar background to be rendered after\n  the last tab as well (:iss:`2464`)\n\n- macOS: Fix a regression in 0.17 that caused incorrect variants to be\n  automatically selected for some fonts (:iss:`2462`)\n\n- Fix a regression in 0.17 that caused kitty @ set-colors to require setting\n  cursor_text_color (:iss:`2470`)\n\n\n0.17.0 [2020-03-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- :ref:`splits_layout` to arrange windows in arbitrary splits\n  (:iss:`2308`)\n\n- Add support for specifying a background image, see :opt:`background_image`\n  (:iss:`163` and :pull:`2326`; thanks to Fredrick Brennan.)\n\n- A new :opt:`background_tint` option to darken the background under the text\n  area when using background images and/or transparent windows.\n\n- Allow selection of single cells with the mouse. Also improve mouse selection\n  to follow semantics common to most programs (:iss:`945`)\n\n- New options :opt:`cursor_beam_thickness` and :opt:`cursor_underline_thickness` to control the thickness of the\n  beam and underline cursors (:iss:`2337` and :pull:`2342`)\n\n- When the application running in the terminal grabs the mouse, pass middle\n  clicks to the application unless `terminal_select_modifiers` are\n  pressed (:iss:`2368`)\n\n- A new ``copy_and_clear_or_interrupt`` function (:iss:`2403`)\n\n- X11: Fix arrow mouse cursor using right pointing instead of the default left\n  pointing arrow (:iss:`2341`)\n\n- Allow passing the currently active kitty window id in the launch command\n  (:iss:`2391`)\n\n- unicode input kitten: Allow pressing :kbd:`ctrl+tab` to change the input mode\n  (:iss:`2343`)\n\n- Fix a bug that prevented using custom functions with the new marks feature\n  (:iss:`2344`)\n\n- Make the set of URL prefixes that are recognized while hovering with the\n  mouse configurable (:iss:`2416`)\n\n- Fix border/margin/padding sizes not being recalculated on DPI change\n  (:iss:`2346`)\n\n- diff kitten: Fix directory diffing with removed binary files failing\n  (:iss:`2378`)\n\n- macOS: Fix menubar title not updating on OS Window focus change (:iss:`2350`)\n\n- Fix rendering of combining characters with fonts that have glyphs for\n  precomposed characters but not decomposed versions (:iss:`2365`)\n\n- Fix incorrect rendering of selection when using rectangular select and\n  scrolling (:iss:`2351`)\n\n- Allow setting WM_CLASS and WM_NAME when creating new OS windows with the\n  launch command (:option:`launch --os-window-class`)\n\n- macOS: When switching input method while a pending multi-key input is in\n  progress, clear the pending input (:iss:`2358`)\n\n- Fix a regression in the previous release that broke switching to neighboring windows\n  in the Grid layout when there are less than four windows (:iss:`2377`)\n\n- Fix colors in scrollback pager off if the window has redefined terminal\n  colors using escape codes (:iss:`2381`)\n\n- Fix selection not updating properly while scrolling (:iss:`2442`)\n\n- Allow extending selections by dragging with right button pressed\n  (:iss:`2445`)\n\n- Workaround for bug in less that causes colors to reset at wrapped lines\n  (:iss:`2381`)\n\n- X11/Wayland: Allow drag and drop of text/plain in addition to text/uri-list\n  (:iss:`2441`)\n\n- Dont strip :code:`&` and :code:`-` from the end of URLs (:iss:`2436`)\n\n- Fix ``@selection`` placeholder not working with launch command (:iss:`2417`)\n\n- Drop support for python 3.5\n\n- Wayland: Fix a crash when drag and dropping into kitty (:iss:`2432`)\n\n- diff kitten: Fix images lingering as blank rectangles after the kitten quits\n  (:iss:`2449`)\n\n- diff kitten: Fix images losing position when scrolling using mouse\n  wheel/touchpad\n\n\n0.16.0 [2020-01-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new :doc:`marks` feature that allows highlighting and scrolling to arbitrary\n  text in the terminal window.\n\n- hints kitten: Allow pressing :sc:`goto_file_line` to quickly open\n  the selected file at the selected line in vim or a configurable editor (:iss:`2268`)\n\n- Allow having more than one full height window in the :code:`tall` layout\n  (:iss:`2276`)\n\n- Allow choosing OpenType features for individual fonts via the\n  :opt:`font_features` option. (:pull:`2248`)\n\n- Wayland: Fix a freeze in rare circumstances when having multiple OS Windows\n  (:iss:`2307` and :iss:`1722`)\n\n- Wayland: Fix window titles being set to very long strings on the order of 8KB\n  causing a crash (:iss:`1526`)\n\n- Add an option :opt:`force_ltr` to turn off the display of text in RTL scripts\n  in right-to-left order (:pull:`2293`)\n\n- Allow opening new tabs/windows before the current tab/window as well as after\n  it with the :option:`launch --location` option.\n\n- Add a :opt:`resize_in_steps` option that can be used to resize the OS window\n  in steps as large as character cells (:pull:`2131`)\n\n- When triple-click+dragging to select multiple lines, extend the selection\n  of the first line to match the rest on the left (:pull:`2284`)\n\n- macOS: Add a :code:`titlebar-only` setting to\n  :opt:`hide_window_decorations` to only hide the title bar (:pull:`2286`)\n\n- Fix a segfault when using ``--debug-config`` with maps (:iss:`2270`)\n\n- ``goto_tab`` now maps numbers larger than the last tab to the last tab\n  (:iss:`2291`)\n\n- Fix URL detection not working for urls of the form scheme:///url\n  (:iss:`2292`)\n\n- When windows are semi-transparent and all contain graphics, correctly render\n  them. (:iss:`2310`)\n\n0.15.1 [2019-12-21]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix a crash/incorrect rendering when detaching a window in some circumstances\n  (:iss:`2173`)\n\n- hints kitten: Add an option :option:`kitty +kitten hints --ascending` to\n  control if the hints numbers increase or decrease from top to bottom\n\n- Fix :opt:`background_opacity` incorrectly applying to selected text and\n  reverse video text (:iss:`2177`)\n\n- Add a new option :opt:`tab_bar_background` to specify a different color\n  for the tab bar (:iss:`2198`)\n\n- Add a new option :opt:`active_tab_title_template` to specify a different\n  template for active tab titles (:iss:`2198`)\n\n- Fix lines at the edge of the window at certain windows sizes when drawing\n  images on a transparent window (:iss:`2079`)\n\n- Fix window not being rendered for the first time until some input has been\n  received from child process (:iss:`2216`)\n\n\n0.15.0 [2019-11-27]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a new action :ref:`detach_window <detach_window>` that can be used to move the current\n  window into a different tab (:iss:`1310`)\n\n- Add a new action :doc:`launch <launch>` that unifies launching of processes\n  in new kitty windows/tabs.\n\n- Add a new style ``powerline`` for tab bar rendering, see :opt:`tab_bar_style` (:pull:`2021`)\n\n- Allow changing colors by mapping a keyboard shortcut to read a kitty config\n  file with color definitions. See the :doc:`FAQ <faq>` for details\n  (:iss:`2083`)\n\n- hints kitten: Allow completely customizing the matching and actions performed\n  by the kitten using your own script (:iss:`2124`)\n\n- Wayland: Fix key repeat not being stopped when focus leaves window. This is\n  expected behavior on Wayland, apparently (:iss:`2014`)\n\n- When drawing unicode symbols that are followed by spaces, use multiple cells\n  to avoid resized or cut-off glyphs (:iss:`1452`)\n\n- diff kitten: Allow diffing remote files easily via ssh (:iss:`727`)\n\n- unicode input kitten: Add an option :option:`kitty +kitten unicode_input\n  --emoji-variation` to control the presentation variant of selected emojis\n  (:iss:`2139`)\n\n- Add specialised rendering for a few more box powerline and unicode symbols\n  (:pull:`2074` and :pull:`2021`)\n\n- Add a new socket only mode for :opt:`allow_remote_control`. This makes\n  it possible for programs running on the local machine to control kitty\n  but not programs running over ssh.\n\n- hints kitten: Allow using named groups in the regular expression. The named\n  groups are passed to the invoked program for further processing.\n\n- Fix a regression in 0.14.5 that caused rendering of private use glyphs\n  with and without spaces to be identical (:iss:`2117`)\n\n- Wayland: Fix incorrect scale used when first creating an OS window\n  (:iss:`2133`)\n\n- macOS: Disable mouse hiding by default as getting it to work robustly\n  on Cocoa is too much effort (:iss:`2158`)\n\n\n0.14.6 [2019-09-25]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix a regression in the previous release that caused a crash when\n  pressing a unprintable key, such as the POWER key (:iss:`1997`)\n\n- Fix a regression in the previous release that caused kitty to not always\n  respond to DPI changes (:pull:`1999`)\n\n\n0.14.5 [2019-09-23]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Implement a hack to (mostly) preserve tabs when cat-ting a file with them and then\n  copying the text or passing screen contents to another program (:iss:`1829`)\n\n- When all visible windows have the same background color, use that as the\n  color for the global padding, instead of the configured background color\n  (:iss:`1957`)\n\n- When resetting the terminal, also reset parser state, this allows easy\n  recovery from incomplete escape codes (:iss:`1961`)\n\n- Allow mapping keys commonly found on European keyboards (:pull:`1928`)\n\n- Fix incorrect rendering of some symbols when followed by a space while using\n  the PowerLine font which does not have a space glyph (:iss:`1225`)\n\n- Linux: Allow using fonts with spacing=90 in addition to fonts with\n  spacing=100 (:iss:`1968`)\n\n- Use selection foreground color for underlines as well (:iss:`1982`)\n\n0.14.4 [2019-08-31]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- hints kitten: Add a :option:`kitty +kitten hints --alphabet` option to\n  control what alphabets are used for hints (:iss:`1879`)\n\n- hints kitten: Allow specifying :option:`kitty +kitten hints --program`\n  multiple times to run multiple programs  (:iss:`1879`)\n\n- Add a :opt:`kitten_alias` option that can be used to alias kitten invocation\n  for brevity and to change kitten option defaults globally (:iss:`1879`)\n\n- macOS: Add an option :opt:`macos_show_window_title_in` to control\n  showing the window title in the menubar/titlebar (:pull:`1837`)\n\n- macOS: Allow drag and drop of text from other applications into kitty\n  (:pull:`1921`)\n\n- When running kittens, use the colorscheme of the current window\n  rather than the configured colorscheme (:iss:`1906`)\n\n- Don't fail to start if running the shell to read the EDITOR env var fails\n  (:iss:`1869`)\n\n- Disable the ``liga`` and ``dlig`` OpenType features for broken fonts\n  such as Nimbus Mono.\n\n- Fix a regression that broke setting background_opacity via remote control\n  (:iss:`1895`)\n\n- Fix piping PNG images into the icat kitten not working (:iss:`1920`)\n\n- When the OS returns a fallback font that does not actually contain glyphs\n  for the text, do not exhaust the list of fallback fonts (:iss:`1918`)\n\n- Fix formatting attributes not reset across line boundaries when passing\n  buffer as ANSI (:iss:`1924`)\n\n\n0.14.3 [2019-07-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Remote control: Add a command `kitty @ scroll-window` to scroll windows\n\n- Allow passing a ``!neighbor`` argument to the new_window mapping to open a\n  new window next to the active window (:iss:`1746`)\n\n- Document the kitty remote control protocol (:iss:`1646`)\n\n- Add a new option :opt:`pointer_shape_when_grabbed` that allows you to control\n  the mouse pointer shape when the terminal programs grabs the pointer\n  (:iss:`1808`)\n\n- Add an option `terminal_select_modifiers` to control which modifiers\n  are used to override mouse selection even when a terminal application has\n  grabbed the mouse (:iss:`1774`)\n\n- When piping data to a child in the pipe command do it in a thread so as not\n  to block the UI (:iss:`1708`)\n\n- unicode_input kitten: Fix a regression that broke using indices to select\n  recently used symbols.\n\n- Fix a regression that caused closing an overlay window to focus\n  the previously focused window rather than the underlying window (:iss:`1720`)\n\n- macOS: Reduce energy consumption when idle by shutting down Apple's display\n  link thread after 30 second of inactivity (:iss:`1763`)\n\n- Linux: Fix incorrect scaling for fallback fonts when the font has an\n  underscore that renders out of bounds (:iss:`1713`)\n\n- macOS: Fix finding fallback font for private use unicode symbols not working\n  reliably (:iss:`1650`)\n\n- Fix an out of bounds read causing a crash when selecting text with the mouse\n  in the alternate screen mode (:iss:`1578`)\n\n- Linux: Use the system \"bell\" sound for the terminal bell. Adds libcanberra\n  as a new dependency to play the system sound.\n\n- macOS: Fix a rare deadlock causing kitty to hang (:iss:`1779`)\n\n- Linux: Fix a regression in 0.14.0 that caused the event loop to tick\n  continuously, wasting CPU even when idle (:iss:`1782`)\n\n- ssh kitten: Make argument parsing more like ssh (:iss:`1787`)\n\n- When using :opt:`strip_trailing_spaces` do not remove empty lines\n  (:iss:`1802`)\n\n- Fix a crash when displaying very large number of images (:iss:`1825`)\n\n\n0.14.2 [2019-06-09]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option :opt:`placement_strategy` to control how the cell area is\n  aligned inside the window when the window size is not an exact multiple\n  of the cell size (:pull:`1670`)\n\n- hints kitten: Add a :option:`kitty +kitten hints --multiple-joiner` option to\n  control how multiple selections are serialized when copying to clipboard\n  or inserting into the terminal. You can have them on separate lines,\n  separated by arbitrary characters, or even serialized as JSON (:iss:`1665`)\n\n- macOS: Fix a regression in the previous release that broke using\n  :kbd:`ctrl+shift+tab` (:iss:`1671`)\n\n- panel kitten: Fix the contents of the panel kitten not being positioned\n  correctly on the vertical axis\n\n- icat kitten: Fix a regression that broke passing directories to icat\n  (:iss:`1683`)\n\n- clipboard kitten: Add a :option:`kitty +kitten clipboard --wait-for-completion`\n  option to have the kitten wait till copying to clipboard is complete\n  (:iss:`1693`)\n\n- Allow using the :doc:`pipe <pipe>` command to send screen and scrollback\n  contents directly to the clipboard (:iss:`1693`)\n\n- Linux: Disable the Wayland backend on GNOME by default as GNOME has no\n  support for server side decorations. Can be controlled by\n  :opt:`linux_display_server`.\n\n- Add an option to control the default :opt:`update_check_interval` when\n  building kitty packages\n\n- Wayland: Fix resizing the window on a compositor that does not provide\n  server side window decorations, such a GNOME or Weston not working\n  correctly (:iss:`1659`)\n\n- Wayland: Fix crash when enabling disabling monitors on sway (:iss:`1696`)\n\n\n0.14.1 [2019-05-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option :opt:`command_on_bell` to run an arbitrary command when\n  a bell occurs (:iss:`1660`)\n\n- Add a shortcut to toggle maximized window state :sc:`toggle_maximized`\n\n- Add support for the underscore key found in some keyboard layouts\n  (:iss:`1639`)\n\n- Fix a missing newline when using the pipe command between the\n  scrollback and screen contents (:iss:`1642`)\n\n- Fix colors not being preserved when using the pipe command with\n  the pager history buffer (:pull:`1657`)\n\n- macOS: Fix a regression that could cause rendering of a kitty window\n  to occasionally freeze in certain situations, such as moving it between\n  monitors or transitioning from/to fullscreen (:iss:`1641`)\n\n- macOS: Fix a regression that caused :kbd:`cmd+v` to double up in the dvorak\n  keyboard layout (:iss:`1652`)\n\n- When resizing and only a single window is present in the current layout,\n  use that window's background color to fill in the blank areas.\n\n- Linux: Automatically increase cell height if the font being used is broken\n  and draws the underscore outside the bounding box (:iss:`690`)\n\n- Wayland: Fix maximizing the window on a compositor that does not provide\n  server side window decorations, such a GNOME or Weston not working\n  (:iss:`1662`)\n\n\n0.14.0 [2019-05-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: The default behavior of the Option key has changed. It now generates\n  unicode characters rather than acting as the :kbd:`Alt` modifier. See\n  :opt:`macos_option_as_alt`.\n\n- Support for an arbitrary number of internal clipboard buffers to copy/paste\n  from, see (:ref:`cpbuf`)\n\n- Allow using the new private internal clipboard buffers with the\n  :opt:`copy_on_select` option (:iss:`1390`)\n\n- macOS: Allow opening new kitty tabs/top-level windows from Finder\n  (:pull:`1350`)\n\n- Add an option :opt:`disable_ligatures` to disable\n  multi-character ligatures under the cursor to make editing easier\n  or disable them completely (:iss:`461`)\n\n- Allow creating new OS windows in session files (:iss:`1514`)\n\n- Allow setting OS window size in session files\n\n- Add an option :opt:`tab_switch_strategy` to control which\n  tab becomes active when the current tab is closed (:pull:`1524`)\n\n- Allow specifying a value of ``none`` for the :opt:`selection_foreground`\n  which will cause kitty to not change text color in selections (:iss:`1358`)\n\n- Make live resizing of OS windows smoother and add an option\n  :opt:`resize_draw_strategy` to control what is drawn while a\n  resize is in progress.\n\n- macOS: Improve handling of IME extended input. Compose characters\n  are now highlighted and the IME panel moves along with the text\n  (:pull:`1586`). Also fixes handling of delete key in Chinese IME\n  (:iss:`1461`)\n\n- When a window is closed, switch focus to the previously active window (if\n  any) instead of picking the previous window in the layout (:iss:`1450`)\n\n- icat kitten: Add support for displaying images at http(s) URLs (:iss:`1340`)\n\n- A new option :opt:`strip_trailing_spaces` to optionally remove trailing\n  spaces from lines when copying to clipboard.\n\n- A new option :opt:`tab_bar_min_tabs` to control how many tabs must be\n  present before the tab-bar is shown (:iss:`1382`)\n\n- Automatically check for new releases and notify when an update is available,\n  via the system notification facilities. Can be controlled by\n  :opt:`update_check_interval` (:iss:`1342`)\n\n- macOS: Fix :kbd:`cmd+period` key not working (:iss:`1318`)\n\n- macOS: Add an option `macos_show_window_title_in_menubar` to not\n  show the current window title in the menu-bar (:iss:`1066`)\n\n- macOS: Workaround for cocoa bug that could cause the mouse cursor to become\n  hidden in other applications in rare circumstances (:iss:`1218`)\n\n- macOS: Allow assigning only the left or right :kbd:`Option` key to work as the\n  :kbd:`Alt` key. See :opt:`macos_option_as_alt` for details (:iss:`1022`)\n\n- Fix using remote control to set cursor text color causing errors when\n  creating new windows (:iss:`1326`)\n\n- Fix window title for minimized windows not being updated (:iss:`1332`)\n\n- macOS: Fix using multi-key sequences to input text ignoring the\n  first few key presses if the sequence is aborted (:iss:`1311`)\n\n- macOS: Add a number of common macOS keyboard shortcuts\n\n- macOS: Reduce energy consumption by not rendering occluded windows\n\n- Fix scrollback pager history not being cleared when clearing the\n  main scrollback buffer (:iss:`1387`)\n\n- macOS: When closing a top-level window only switch focus to the previous kitty\n  window if it is on the same workspace (:iss:`1379`)\n\n- macOS: Fix :opt:`sync_to_monitor` not working on Mojave.\n\n- macOS: Use the system cursor blink interval by default\n  :opt:`cursor_blink_interval`.\n\n- Wayland: Use the kitty Wayland backend by default. Can be switched back\n  to using XWayland by setting the environment variable:\n  ``KITTY_DISABLE_WAYLAND=1``\n\n- Add a ``no-append`` setting to :opt:`clipboard_control` to disable\n  the kitty copy concatenation protocol extension for OSC 52.\n\n- Update to using the Unicode 12 standard\n\n- Unicode input kitten: Allow using the arrow keys in code mode to go to next\n  and previous unicode symbol.\n\n- macOS: Fix specifying initial window size in cells not working correctly on\n  Retina screens (:iss:`1444`)\n\n- Fix a regression in version 0.13.0 that caused background colors of space\n  characters after private use unicode characters to not be respected\n  (:iss:`1455`)\n\n- Only update the selected text to clipboard when the selection is finished,\n  not continuously as it is updated. (:iss:`1460`)\n\n- Allow setting :opt:`active_border_color` to ``none`` to not draw a border\n  around the active window (:iss:`805`)\n\n- Use negative values for :opt:`mouse_hide_wait` to hide the mouse cursor\n  immediately when pressing a key (:iss:`1534`)\n\n- When encountering errors in :file:`kitty.conf` report them to the user\n  instead of failing to start.\n\n- Allow the user to control the resize debounce time via\n  :opt:`resize_debounce_time`.\n\n- Remote control: Make the :ref:`at-set-font-size` command more capable.\n  It can now increment font size and reset it. It also only acts on the\n  active top-level window, by default (:iss:`1581`)\n\n- When launching child processes set the :code:`PWD` environment variable\n  (:iss:`1595`)\n\n- X11: use the window manager's native full-screen implementation when\n  making windows full-screen (:iss:`1605`)\n\n- Mouse selection: When extending by word, fix extending selection to non-word\n  characters not working well (:iss:`1616`)\n\n0.13.3 [2019-01-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- icat kitten: Add a ``--stdin`` option to control if image data is read from\n  STDIN (:iss:`1308`)\n\n- hints kitten: Start hints numbering at one instead of zero by default. Added\n  an option ``--hints-offset`` to control it. (:iss:`1289`)\n\n- Fix a regression in the previous release that broke using ``background`` for\n  :opt:`cursor_text_color` (:iss:`1288`)\n\n- macOS: Fix dragging kitty window tabs in traditional full screen mode causing\n  crashes (:iss:`1296`)\n\n- macOS: Ensure that when running from a bundle, the bundle kitty exe is\n  preferred over any kitty in PATH (:iss:`1280`)\n\n- macOS: Fix a regression that broke mapping of :kbd:`ctrl+tab` (:iss:`1304`)\n\n- Add a list of user-created kittens to the docs\n\n- Fix a regression that broke changing mouse wheel scroll direction with\n  negative :opt:`wheel_scroll_multiplier` values in full-screen applications\n  like vim (:iss:`1299`)\n\n- Fix :opt:`background_opacity` not working with pure white backgrounds\n  (:iss:`1285`)\n\n- macOS: Fix \"New OS Window\" dock action not working when kitty is not focused\n  (:iss:`1312`)\n\n- macOS: Add aliases for close window and new tab actions that conform to common\n  Apple shortcuts for these actions (:iss:`1313`)\n\n- macOS: Fix some kittens causing 100% CPU usage\n\n\n0.13.2 [2019-01-04]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a new option :opt:`tab_title_template` to control how tab titles\n  are formatted. In particular the template can be used to display\n  the tab number next to the title (:iss:`1223`)\n\n- Report the current foreground processes as well as the original child process,\n  when using `kitty @ ls`\n\n- Use the current working directory of the foreground process for the\n  `*_with_cwd` actions that open a new window with the current working\n  directory.\n\n- Add a new ``copy_or_interrupt`` action that can be mapped to kbd:`ctrl+c`. It\n  will copy if there is a selection and interrupt otherwise (:iss:`1286`)\n\n- Fix setting :opt:`background_opacity` causing window margins/padding to be slightly\n  different shade from background (:iss:`1221`)\n\n- Handle keyboards with a \"+\" key (:iss:`1224`)\n\n- Fix Private use Unicode area characters followed by spaces at the end of text\n  not being rendered correctly (:iss:`1210`)\n\n- macOS: Add an entry to the dock menu to open a new OS window (:iss:`1242`)\n\n- macOS: Fix scrolling very slowly with wheel mice not working (:iss:`1238`)\n\n- Fix changing :opt:`cursor_text_color` via remote control not working\n  (:iss:`1229`)\n\n- Add an action to resize windows that can be mapped to shortcuts in :file:`kitty.conf`\n  (:pull:`1245`)\n\n- Fix using the ``new_tab !neighbor`` action changing the order of the\n  non-neighboring tabs (:iss:`1256`)\n\n- macOS: Fix momentum scrolling continuing when changing the active window/tab\n  (:iss:`1267`)\n\n\n0.13.1 [2018-12-06]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix passing input via the pipe action to a program without a window not\n  working.\n\n- Linux: Fix a regression in the previous release that caused automatic\n  selection of bold/italic fonts when using aliases such as \"monospace\" to not\n  work (:iss:`1209`)\n\n- Fix resizing window smaller and then restoring causing some wrapped lines to not\n  be properly unwrapped (:iss:`1206`)\n\n0.13.0 [2018-12-05]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option :opt:`scrollback_pager_history_size` to tell kitty to store\n  extended scrollback to use when viewing the scrollback buffer in a pager\n  (:iss:`970`)\n\n- Modify the kittens sub-system to allow creating custom kittens without any\n  user interface. This is useful for creating more complex actions that can\n  be bound to key presses in :file:`kitty.conf`. See\n  doc:`kittens/custom`. (:iss:`870`)\n\n- Add a new ``nth_window`` action that can be used to go to the nth window and\n  also previously active windows, using negative numbers. Similarly,\n  ``goto_tab`` now accepts negative numbers to go to previously active tabs\n  (:iss:`1040`)\n\n- Allow hiding the tab bar completely, by setting :opt:`tab_bar_style` to\n  ``hidden``. (:iss:`1014`)\n\n- Allow private use unicode characters to stretch over more than a single\n  neighboring space (:pull:`1036`)\n\n- Add a new :opt:`touch_scroll_multiplier` option to modify the amount\n  scrolled by high precision scrolling devices such as touchpads (:pull:`1129`)\n\n- icat kitten: Implement reading image data from STDIN, if STDIN is not\n  connected to a terminal (:iss:`1130`)\n\n- hints kitten: Insert trailing spaces after matches when using the\n  ``--multiple`` option. Also add a separate ``--add-trailing-space``\n  option to control this behavior (:pull:`1132`)\n\n- Fix the ``*_with_cwd`` actions using the cwd of the overlay window rather\n  than the underlying window's cwd (:iss:`1045`)\n\n- Fix incorrect key repeat rate on wayland (:pull:`1055`)\n\n- macOS: Fix drag and drop of files not working on Mojave (:iss:`1058`)\n\n- macOS: Fix IME input for East Asian languages (:iss:`910`)\n\n- macOS: Fix rendering frames-per-second very low when processing\n  large amounts of input in small chunks (:pull:`1082`)\n\n- macOS: Fix incorrect text sizes calculated when using an external display\n  that is set to mirror the main display (:iss:`1056`)\n\n- macOS: Use the system default double click interval (:pull:`1090`)\n\n- macOS: Fix touch scrolling sensitivity low on retina screens (:iss:`1112`)\n\n- Linux: Fix incorrect rendering of some fonts when hinting is disabled at\n  small sizes (:iss:`1173`)\n\n- Linux: Fix match rules used as aliases in Fontconfig configuration not being\n  respected (:iss:`1085`)\n\n- Linux: Fix a crash when using the GNU Unifont as a fallback font\n  (:iss:`1087`)\n\n- Wayland: Fix copying from hidden kitty windows hanging (:iss:`1051`)\n\n- Wayland: Add support for the primary selection protocol\n  implemented by some compositors (:pull:`1095`)\n\n- Fix expansion of env vars not working in the :opt:`env` directive\n  (:iss:`1075`)\n\n- Fix :opt:`mouse_hide_wait` only taking effect after an event such as cursor\n  blink or key press (:iss:`1073`)\n\n- Fix the ``set_background_opacity`` action not working correctly\n  (:pull:`1147`)\n\n- Fix second cell of emoji created using variation selectors not having\n  the same attributes as the first cell (:iss:`1109`)\n\n- Fix focusing neighboring windows in the grid layout with less than 4 windows\n  not working (:iss:`1115`)\n\n- Fix :kbd:`ctrl+shift+special` key not working in normal and application keyboard\n  modes (:iss:`1114`)\n\n- Add a terminfo entry for full keyboard mode.\n\n- Fix incorrect text-antialiasing when using very low background opacity\n  (:iss:`1005`)\n\n- When double or triple clicking ignore clicks if they are \"far\" from each\n  other (:iss:`1093`)\n\n- Follow xterm's behavior for the menu key (:iss:`597`)\n\n- Fix hover detection of URLs not working when hovering over the first colon\n  and slash characters in short URLs (:iss:`1201`)\n\n0.12.3 [2018-09-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix kitty window not being rendered on macOS Mojave until the window is\n  moved or resized at least once (:iss:`887`)\n\n- Unicode input: Fix an error when searching for the string 'fir' (:iss:`1035`)\n\n\n0.12.2 [2018-09-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new ``last_used_layout`` function that can be mapped to a shortcut to\n  switch to the previously used window layout (:iss:`870`)\n\n- New ``neighboring_window`` and ``move_window`` functions to switch to\n  neighboring windows in the current layout, and move them around, similar to\n  window movement in vim (:iss:`916`)\n\n- A new ``pipe`` function that can be used to pipe the contents of the screen\n  and scrollback buffer to any desired program running in a new window, tab or\n  overlay window. (:iss:`933`)\n\n- Add a new :option:`kitty --start-as` command line flag to start kitty\n  full-screen/maximized/minimized. This replaces the ``--start-in-fullscreen``\n  flag introduced in the previous release (:iss:`935`)\n\n- When mapping the ``new_tab`` action allow specifying that the tab should open\n  next to the current tab instead of at the end of the tabs list (:iss:`979`)\n\n- macOS: Add a new :opt:`macos_thicken_font` to make text rendering\n  on macs thicker, which makes it similar to the result of\n  sub-pixel antialiasing (:pull:`950`)\n\n- macOS: Add an option :opt:`macos_traditional_fullscreen` to make\n  full-screening of kitty windows much faster, but less pretty. (:iss:`911`)\n\n- Fix a bug causing incorrect line ordering when viewing the scrollback buffer\n  if the scrollback buffer is full (:iss:`960`)\n\n- Fix drag-scrolling not working when the mouse leaves the window confines\n  (:iss:`917`)\n\n- Workaround for broken editors like nano that cannot handle newlines in pasted text\n  (:iss:`994`)\n\n- Linux: Ensure that the python embedded in the kitty binary build uses\n  UTF-8 mode to process command-line arguments (:iss:`924`)\n\n- Linux: Handle fonts that contain monochrome bitmaps (such as the Terminus TTF\n  font) (:pull:`934`)\n\n- Have the :option:`kitty --title` flag apply to all windows created\n  using :option:`kitty --session` (:iss:`921`)\n\n- Revert change for backspacing of wide characters in the previous release,\n  as it breaks backspacing in some wide character aware programs (:iss:`875`)\n\n- Fix kitty @set-colors not working for tab backgrounds when using the `fade` tabbar style\n  (:iss:`937`)\n\n- macOS: Fix resizing semi-transparent windows causing the windows to be\n  invisible during the resize (:iss:`941`)\n\n- Linux: Fix window icon not set on X11 for the first OS window (:iss:`961`)\n\n- macOS: Add an :opt:`macos_custom_beam_cursor` option to use a special\n  mouse cursor image that can be seen on both light and dark backgrounds\n  (:iss:`359`)\n\n- Remote control: Fix the ``focus_window`` command not focusing the\n  top-level OS window of the specified kitty window (:iss:`1003`)\n\n- Fix using :opt:`focus_follows_mouse` causing text selection with the\n  mouse to malfunction when using multiple kitty windows (:iss:`1002`)\n\n0.12.1 [2018-09-08]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a new ``--start-in-fullscreen`` command line flag to start\n  kitty in full screen mode (:iss:`856`)\n\n- macOS: Fix a character that cannot be rendered in any font causing\n  font fallback for all subsequent characters that cannot be rendered in the\n  main font to fail (:iss:`799`)\n\n- Linux: Do not enable IME input via ibus unless the ``GLFW_IM_MODULE=ibus``\n  environment variable is set. IME causes key processing latency and even\n  missed keystrokes for many people, so it is now off by default.\n\n- Fix backspacing of wide characters in wide-character unaware programs not working (:iss:`875`)\n\n- Linux: Fix number pad arrow keys not working when Numlock is off (:iss:`857`)\n\n- Wayland: Implement support for clipboard copy/paste (:iss:`855`)\n\n- Allow mapping shortcuts using the raw key code from the OS (:iss:`848`)\n\n- Allow mapping of individual key-presses without modifiers as shortcuts\n\n- Fix legacy invocation of icat as `kitty icat` not working (:iss:`850`)\n\n- Improve rendering of wavy underline at small font sizes (:iss:`853`)\n\n- Fix a regression in 0.12.0 that broke dynamic resizing of layouts (:iss:`860`)\n\n- Wayland: Allow using the :code:`kitty --class` command line flag\n  to set the app id (:iss:`862`)\n\n- Add completion of the kitty command for the fish shell (:pull:`829`)\n\n- Linux: Fix XCompose rules with no defined symbol not working (:iss:`880`)\n\n- Linux: Fix crash with some Nvidia drivers when creating tabs in the first\n  top level-window after creating a second top-level window. (:iss:`873`)\n\n- macOS: Diff kitten: Fix syntax highlighting not working because of\n  a bug in the 0.12.0 macOS package\n\n0.12.0 [2018-09-01]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Preserve the mouse selection even when the contents of the screen are\n  scrolled or overwritten provided the new text does not intersect the\n  selected lines.\n\n- Linux: Implement support for Input Method Extensions (multilingual input\n  using standard keyboards) via `IBus\n  <https://github.com/ibus/ibus/wiki/ReadMe>`_ (:iss:`469`)\n\n- Implement completion for the kitty command in bash and zsh. See\n  :ref:`shell_integration`.\n\n- Render the text under the cursor in a fixed color, configurable via\n  the option :opt:`cursor_text_color` (:iss:`126`)\n\n- Add an option :opt:`env` to set environment variables in child processes\n  from kitty.conf\n\n- Add an action to the ``clear_terminal`` function to scroll the screen\n  contents into the scrollback buffer (:iss:`1113`)\n\n- Implement high precision scrolling with the trackpad on platforms such as\n  macOS and Wayland that implement it. (:pull:`819`)\n\n- macOS: Allow scrolling window contents using mouse wheel/trackpad even when the\n  window is not the active window (:iss:`729`)\n\n- Remote control: Allow changing the current window layout with a new\n  :ref:`at-goto-layout` command (:iss:`845`)\n\n- Remote control: Allow matching windows by the environment variables of their\n  child process as well\n\n- Allow running kittens via the remote control system (:iss:`738`)\n\n- Allow enabling remote control in only some kitty windows\n\n- Add a keyboard shortcut to reset the terminal (:sc:`reset_terminal`). It\n  takes parameters so you can define your own shortcuts to clear the\n  screen/scrollback also (:iss:`747`)\n\n- Fix one-pixel line appearing at window edges at some window sizes when\n  displaying images with background opacity enabled (:iss:`741`)\n\n- diff kitten: Fix error when right hand side file is binary and left hand side\n  file is text (:pull:`752`)\n\n- kitty @ new-window: Add a new option :option:`kitty @ new-window --window-type`\n  to create top-level OS windows (:iss:`770`)\n\n- macOS: The :opt:`focus_follows_mouse` option now also works across top-level kitty OS windows\n  (:iss:`754`)\n\n- Fix detection of URLs in HTML source code (URLs inside quotes) (:iss:`785`)\n\n- Implement support for emoji skin tone modifiers (:iss:`787`)\n\n- Round-trip the zwj unicode character. Rendering of sequences containing zwj\n  is still not implemented, since it can cause the collapse of an unbounded\n  number of characters into a single cell. However, kitty at least preserves\n  the zwj by storing it as a combining character.\n\n- macOS: Disable the custom mouse cursor. Using a custom cursor fails on dual\n  GPU machines. I give up, Apple users will just have to live with the\n  limitations of their choice of OS. (:iss:`794`)\n\n- macOS: Fix control+tab key combination not working (:iss:`801`)\n\n- Linux: Fix slow startup on some systems caused by GLFW searching for\n  joysticks. Since kitty does not use joysticks, disable joystick support.\n  (:iss:`830`)\n\n\n0.11.3 [2018-07-10]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Draw only the minimum borders needed for inactive windows. That is only the borders\n  that separate the inactive window from a neighbor. Note that setting\n  a non-zero window margin overrides this and causes all borders to be drawn.\n  The old behavior of drawing all borders can be restored via the\n  :opt:`draw_minimal_borders` setting in kitty.conf. (:iss:`699`)\n\n- macOS: Add an option :opt:`macos_window_resizable` to control if kitty\n  top-level windows are resizable using the mouse or not (:iss:`698`)\n\n- macOS: Use a custom mouse cursor that shows up well on both light and dark backgrounds\n  (:iss:`359`)\n\n- macOS: Workaround for switching from fullscreen to windowed mode with the\n  titlebar hidden causing window resizing to not work. (:iss:`711`)\n\n- Fix triple-click to select line not working when the entire line is filled\n  (:iss:`703`)\n\n- When dragging to select with the mouse \"grab\" the mouse so that if it strays\n  into neighboring windows, the selection is still updated (:pull:`624`)\n\n- When clicking in the margin/border area of a window, map the click to the\n  nearest cell in the window. Avoids selection with the mouse failing when\n  starting the selection just outside the window.\n\n- When drag-scrolling stop the scroll when the mouse button is released.\n\n- Fix a regression in the previous release that caused pasting large amounts\n  of text to be duplicated (:iss:`709`)\n\n\n0.11.2 [2018-07-01]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Linux: Allow using XKB key names to bind shortcuts to keys not supported by GLFW (:pull:`665`)\n\n- kitty shell: Ignore failure to read readline history file. Happens if the\n  user migrates their kitty cache directory between systems with incompatible\n  readline implementations.\n\n- macOS: Fix an error in remote control when using --listen-on (:iss:`679`)\n\n- hints kitten: Add a :option:`kitty +kitten hints --multiple` option to select\n  multiple items (:iss:`687`)\n\n- Fix pasting large amounts of text very slow (:iss:`682`)\n\n- Add an option :opt:`single_window_margin_width` to allow different margins\n  when only a single window is visible in the layout (:iss:`688`)\n\n- Add a :option:`kitty --hold` command line option to stay open after the child process exits (:iss:`667`)\n\n- diff kitten: When triggering a search scroll to the first match automatically\n\n- :option:`kitty --debug-font-fallback` also prints out what basic fonts were matched\n\n- When closing a kitty window reset the mouse cursor to its default shape and ensure it is visible (:iss:`655`).\n\n- Remote control: Speed-up reading of command responses\n\n- Linux installer: Fix installer failing on systems with python < 3.5\n\n- Support \"-T\" as an alias for \"--title\" (:pull:`659`)\n\n- Fix a regression in the previous release that broke using\n  ``--debug-config`` with custom key mappings (:iss:`695`)\n\n\n0.11.1 [2018-06-17]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- diff kitten: Implement searching for text in the diff (:iss:`574`)\n\n- Add an option :opt:`startup_session` to :file:`kitty.conf` to specify a\n  default startup session (:iss:`641`)\n\n- Add a command line option :option:`kitty --wait-for-single-instance-window-close`\n  to make :option:`kitty --single-instance` wait for the closing of the newly opened\n  window before quitting (:iss:`630`)\n\n- diff kitten: Allow theming the selection background/foreground as well\n\n- diff kitten: Display CRLF line endings using the unicode return symbol\n  instead of <d> as it is less intrusive (:iss:`638`)\n\n- diff kitten: Fix default foreground/background colors not being restored when\n  kitten quits (:iss:`637`)\n\n- Fix :option:`kitty @ set-colors --all` not working when more than one window\n  present (:iss:`632`)\n\n- Fix a regression that broke the legacy increase/decrease_font_size actions\n\n- Clear scrollback on reset (:iss:`631`)\n\n\n0.11.0 [2018-06-12]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new tab bar style \"fade\" in which each tab's edges fade into the background.\n  See :opt:`tab_bar_style` and :opt:`tab_fade` for details. The old look can be\n  restored by setting :opt:`tab_bar_style` to :code:`separator`.\n\n- :doc:`Pre-compiled binaries <binary>` with all bundled dependencies for Linux\n  (:iss:`595`)\n\n- A :doc:`new kitten <kittens/panel>` to create dock panels on X11 desktops\n  showing the output from arbitrary terminal programs.\n\n- Reduce data sent to the GPU per render by 30% (:commit:`8dea5b3`)\n\n- Implement changing the font size for individual top level (OS) windows\n  (:iss:`408`)\n\n- When viewing the scrollback in less using :sc:`show_scrollback` and kitty\n  is currently scrolled, position the scrollback in less to match kitty's\n  scroll position. (:iss:`148`)\n\n- ssh kitten: Support all SSH options. It can now be aliased directly to ssh\n  for convenience. (:pull:`591`)\n\n- icat kitten: Add :option:`kitty +kitten icat --print-window-size` to easily\n  detect the window size in pixels from scripting languages (:iss:`581`)\n\n- hints kitten: Allow selecting hashes from the terminal with\n  :sc:`insert_selected_hash` useful for git commits. (:pull:`604`)\n\n- Allow specifying initial window size in number of cells in addition to pixels\n  (:iss:`436`)\n\n- Add a setting to control the margins to the left and right of the tab-bar\n  (:iss:`584`)\n\n- When closing a tab switch to the last active tab instead of the right-most\n  tab (:iss:`585`)\n\n- Wayland: Fix kitty not starting when using wl_roots based compositors\n  (:iss:`157`)\n\n- Wayland: Fix mouse wheel/touchpad scrolling in opposite direction to other apps (:iss:`594`)\n\n- macOS: Fix the new OS window keyboard shortcut (:sc:`new_os_window`) not\n  working if no kitty window currently has focus. (:iss:`524`)\n\n- macOS: Keep kitty running even when the last window is closed. This is in\n  line with how applications are supposed to behave on macOS (:iss:`543`).\n  There is a new option (:opt:`macos_quit_when_last_window_closed`) to control\n  this.\n\n- macOS: Add macOS standard shortcuts for copy, paste and new OS window\n  (\u2318+C, \u2318+V, \u2318+N)\n\n- Add a config option (:opt:`editor`) to set the EDITOR kitty uses (:iss:`580`)\n\n- Add a config option (``x11_hide_window_decorations``) to hide window\n  decorations under X11/Wayland (:iss:`607`)\n\n- Add an option to @set-window-title to make the title change non-permanent\n  (:iss:`592`)\n\n- Add support for the CSI t escape code to query window and cell sizes\n  (:iss:`581`)\n\n- Linux: When using layouts that map the keys to non-ascii characters,\n  map shortcuts using the ascii equivalents, from the default layout.\n  (:iss:`606`)\n\n- Linux: Fix fonts not being correctly read from TrueType Collection\n  (.ttc) files (:iss:`577`)\n\n- Fix :opt:`inactive_text_alpha` also applying to the tab bar (:iss:`612`)\n\n- :doc:`hints kitten <kittens/hints>`: Fix a regression that caused some blank lines to be not\n  be displayed.\n\n- Linux: Include a man page and the HTML docs when building the linux-package\n\n- Remote control: Fix kitty @ sometimes failing to read the response from\n  kitty. (:iss:`614`)\n\n- Fix `kitty @ set-colors` not working with the window border colors.\n  (:iss:`623`)\n\n- Fix a regression in 0.10 that caused incorrect rendering of the status bar in\n  irssi when used inside screen. (:iss:`621`)\n\n\n0.10.1 [2018-05-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a kitten to easily ssh into servers that automatically copies the\n  terminfo files over. ``kitty +kitten ssh myserver``.\n\n- diff kitten: Make the keyboard shortcuts configurable (:iss:`563`)\n\n- Allow controlling *background_opacity* via either keyboard shortcuts or\n  remote control. Note that you must set *dynamic_background_opacity yes* in\n  kitty.conf first. (:iss:`569`)\n\n- diff kitten: Add keybindings to scroll by page\n\n- diff kitten: Fix incorrect syntax highlighting for a few file formats such as\n  yaml\n\n- macOS: Fix regression that caused the *macos_option_as_alt* setting to always\n  be disabled for all OS windows in a kitty instance after the first window\n  (:iss:`571`)\n\n- Fix Ctrl+Alt+Space not working in normal and application keyboard modes\n  (:iss:`562`)\n\n\n0.10.0 [2018-05-21]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A diff kitten to show side-by-side diffs with syntax highlighting and support\n  for images. See :doc:`diff kitten <kittens/diff>`.\n\n- Make windows in the various kitty layouts manually resizable. See\n  :ref:`layouts` for details.\n\n- Implement support for the SGR *faint* escape code to make text blend\n  into the background (:iss:`446`).\n\n- Make the hints kitten a little smarter (:commit:`ad1109b`)\n  so that URLs that stretch over multiple lines are detected. Also improve\n  detection of surrounding brackets/quotes.\n\n- Make the kitty window id available as the environment variable\n  ``KITTY_WINDOW_ID`` (:iss:`532`).\n\n- Add a \"fat\" layout that is similar to the \"tall\" layout but vertically\n  oriented.\n\n- Expand environment variables in config file include directives\n\n- Allow programs running in kitty to read/write from the clipboard (:commit:`889ca77`).\n  By default only writing is allowed. This feature is supported in many\n  terminals, search for `OSC 52 clipboard` to find out more about using it.\n\n- Fix moving cursor outside a defined page area incorrectly causing the cursor\n  to be placed inside the page area. Caused incorrect rendering in neovim, in\n  some situations (:iss:`542`).\n\n- Render a couple more powerline symbols directly, bypassing the font\n  (:iss:`550`).\n\n- Fix ctrl+alt+<special> not working in normal and application keyboard (:iss:`548`).\n\n- Partial fix for rendering Right-to-left languages like Arabic. Rendering of\n  Arabic is never going to be perfect, but now it is at least readable.\n\n- Fix Ctrl+backspace acting as plain backspace in normal and application\n  keyboard modes (:iss:`538`).\n\n- Have the paste_from_selection action paste from the clipboard on platforms\n  that do not have a primary selection such as Wayland and macOS\n  (:iss:`529`)\n\n- Fix cursor_stop_blinking_after=0 not working (:iss:`530`)\n\n\n0.9.1 [2018-05-05]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Show a bell symbol on the tab if a bell occurs in one of the windows in the tab and\n  the window is not the currently focused window\n\n- Change the window border color if a bell occurs in an unfocused window. Can\n  be disabled by setting the bell_border_color to be the same as the\n  inactive_border_color.\n\n- macOS: Add support for dead keys\n\n- Unicode input: When searching by name search for prefix matches as well as\n  whole word matches\n\n- Dynamically allocate the memory used for the scrollback history buffer.\n  Reduces startup memory consumption when using very large scrollback\n  buffer sizes.\n\n- Add an option to not request window attention on bell.\n\n- Remote control: Allow matching windows by number (visible position).\n\n- macOS: Fix changing tab title and kitty shell not working\n\n- When triple-clicking select all wrapped lines belonging to a single logical line.\n\n- hints kitten: Detect bracketed URLs and don't include the closing bracket in the URL.\n\n- When calling pass_selection_to_program use the current directory of the child\n  process as the cwd of the program.\n\n- Add macos_hide_from_tasks option to hide kitty from the macOS task switcher\n\n- macOS: When the macos_titlebar_color is set to background change the titlebar\n  colors to match the current background color of the active kitty window\n\n- Add a setting to clear all shortcuts defined up to that point in the config\n  file(s)\n\n- Add a setting (kitty_mod) to change the modifier used by all the default\n  kitty shortcuts, globally\n\n- Fix Shift+function key not working\n\n- Support the F13 to F25 function keys\n\n- Don't fail to start if the user deletes the hintstyle key from their\n  fontconfig configuration.\n\n- When rendering a private use unicode codepoint and a space as a two cell\n  ligature, set the foreground colors of the space cell to match the colors of\n  the first cell. Works around applications like powerline that use different\n  colors for the two cells.\n\n- Fix passing @text to other programs such as when viewing the scrollback\n  buffer not working correctly if kitty is itself scrolled up.\n\n- Fix window focus gained/lost events not being reported to child programs when\n  switching windows/tabs using the various keyboard shortcuts.\n\n- Fix tab title not changing to reflect the window title when switching between different windows in a tab\n\n- Ignore -e if it is specified on the command line. This is for compatibility\n  with broken software that assumes terminals should run with an -e option to\n  execute commands instead of just passing the commands as arguments.\n\n\n0.9.0 [2018-04-15]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new kitty command shell to allow controlling kitty via commands. Press\n  `ctrl+shift+escape` to run the shell.\n\n- The hints kitten has become much more powerful. Now in addition to URLs you\n  can use it to select word, paths, filenames, lines, etc. from the screen.\n  These can be inserted into the terminal, copied to clipboard or sent to\n  external programs.\n\n- Linux: Switch to libxkbcommon for keyboard handling. It allows kitty to\n  support XCompose and dead keys and also react to keyboard remapping/layout\n  change without needing a restart.\n\n- Add support for multiple-key-sequence shortcuts\n\n- A new remote control command `set-colors` to change the current and/or\n  configured colors.\n\n- When double-clicking to select a word, select words that continue onto the\n  next/prev line as well.\n\n- Add an `include` directive for the config files to read multiple config files\n\n- Improve mouse selection for windows with padding. Moving the mouse into the\n  padding area now acts as if the mouse is over the nearest cell.\n\n- Allow setting all 256 terminal colors in the config file\n\n- Fix using `kitty --single-instance` to open a new window in a running kitty\n  instance, not respecting the `--directory` flag\n\n- URL hints: Exclude trailing punctuation from URLs\n\n- URL hints: Launch the browser from the kitty parent process rather than the\n  hints kitten. Fixes launching on some systems where xdg-open doesn't like\n  being run from a kitten.\n\n- Allow using rectangle select mode by pressing shift in addition to the\n  rectangle select modifiers even when the terminal program has grabbed the\n  mouse.\n\n\n0.8.4 [2018-03-31]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix presence of XDG_CONFIG_DIRS and absence of XDG_CONFIG_HOME preventing\n  kitty from starting\n\n- Revert change in last release to cell width calculation. Instead just clip\n  the right edges of characters that overflow the cell by at most two pixels\n\n\n0.8.3 [2018-03-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix a regression that broke the visual bell and invert screen colors escape\n  code\n\n- Allow double-click and triple-click + drag to extend selections word at a\n  time or line at a time\n\n- Add a keyboard shortcut to set the tab title\n\n- Fix setting window title to empty via OSC escape code not working correctly\n\n- Linux: Fix cell width calculation incorrect for some fonts (cell widths are\n  now calculated by actually rendering bitmaps, which is slower but more\n  accurate)\n\n- Allow specifying a system wide kitty config file, for all users\n\n- Add a --debug-config command line flag to output data about the system and\n  kitty configuration.\n\n- Wayland: Fix auto-repeat of keys not working\n\n\n0.8.2 [2018-03-17]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow extending existing selections by right clicking\n\n- Add a configurable keyboard shortcut and remote command to set the font size to a specific value\n\n- Add an option to have kitty close the window when the main processes running in it exits, even if there are still background processes writing to that terminal\n\n- Add configurable keyboard shortcuts to switch to a specific layout\n\n- Add a keyboard shortcut to edit the kitty config file easily\n\n- macOS: Fix restoring of window size not correct on Retina screens\n\n- macOS: Add a facility to specify command line arguments when running kitty from the GUI\n\n- Add a focus-tab remote command\n\n- Fix screen not being refreshed immediately after moving a window.\n\n- Fix a crash when getting the contents of the scrollback buffer as text\n\n0.8.1 [2018-03-09]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Extend kitty's remote control feature to work over both UNIX and TCP sockets,\n  so now you can control kitty from across the internet, if you want to.\n\n- Render private use unicode characters that are followed by a space as a two\n  character ligature. This fixes rendering for applications that misuse\n  private-use characters to display square symbols.\n\n- Fix Unicode emoji presentation variant selector causing new a fallback font\n  instance to be created\n\n- Fix a rare error that prevented the Unicode input kitten from working\n  sometimes\n\n- Allow using Ctrl+Alt+letter in legacy keyboard modes by outputting them as Ctrl+letter and Alt+letter.\n  This matches other terminals' behavior.\n\n- Fix cursor position off-by-one on horizontal axis when resizing the terminal\n\n- Wayland: Fix auto-repeat of keys not working\n\n- Wayland: Add support for window decorations provided by the Wayland shell\n\n- macOS: Fix URL hints not working\n\n- macOS: Fix shell not starting in login mode on some computers\n\n- macOS: Output errors into console.app when running as a bundle\n\n\n0.8.0 [2018-02-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A framework for kittens, that is, small terminal programs designed to run\n  inside kitty and extend its capabilities. Examples include unicode input and\n  selecting URLs with the keyboard.\n\n- Input arbitrary unicode characters by pressing Ctrl+Shift+u. You can choose\n  characters by name, by hex code, by recently used, etc. There is even and\n  editable Favorites list.\n\n- Open URLs using only the keyboard. kitty has a new \"hints mode\". Press\n  Ctrl+Shift+e and all detected URLs on the screen are highlighted with a key\n  to press to open them. The facility is customizable so you can change\n  what is detected as a URL and which program is used to open it.\n\n- Add an option to change the titlebar color of kitty windows on macOS\n\n- Only consider Emoji characters with default Emoji presentation to be two\n  cells wide. This matches the standard. Also add support for the Unicode Emoji\n  variation presentation selector.\n\n- Prevent video tearing during high speed scrolling by syncing draws\n  to the monitor's refresh rate. There is a new configuration option to\n  control this ``sync_to_monitor``.\n\n- When displaying only a single window, use the default background color of the\n  window (which can be changed via escape codes) as the color for the margin\n  and padding of the window.\n\n- Add some non standard terminfo capabilities used by neovim and tmux.\n\n- Fix large drop in performance when using multiple top-level windows on macOS\n\n- Fix save/restore of window sizes not working correctly.\n\n- Remove option to use system wcwidth(). Now always use a wcwidth() based on\n  the Unicode standard. Only sane way.\n\n- Fix a regression that caused a few ligature glyphs to not render correctly in\n  rare circumstances.\n\n- Browsing the scrollback buffer now happens in an overlay window instead of a\n  new window/tab.\n\n0.7.1 [2018-01-31]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option to adjust the width of character cells\n\n- Fix selecting text with the mouse in the scrollback buffer selecting text\n  from the line above the actually selected line\n\n- Fix some italic fonts having the right edge of characters cut-off,\n  unnecessarily\n\n\n0.7.0 [2018-01-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow controlling kitty from the shell prompt/scripts. You can\n  open/close/rename windows and tabs and even send input to specific windows.\n  See the README for details.\n\n- Add option to put tab bar at the top instead of the bottom\n\n- Add option to override the default shell\n\n- Add \"Horizontal\" and \"Vertical\" window layouts\n\n- Sessions: Allow setting titles and working directories for individual windows\n\n- Option to copy to clipboard on mouse select\n\n- Fix incorrect reporting of mouse move events when using the SGR protocol\n\n- Make alt+backspace delete the previous word\n\n- Take the mouse wheel multiplier option in to account when generating fake key\n  scroll events\n\n- macOS: Fix closing top-level window does not transfer focus to other\n  top-level windows.\n\n- macOS: Fix alt+arrow keys not working when disabling the macos_option_as_alt\n  config option.\n\n- kitty icat: Workaround for bug in ImageMagick that would cause some images\n  to fail to display at certain sizes.\n\n- Fix rendering of text with ligature fonts that do not use dummy glyphs\n\n- Fix a regression that caused copying of the selection to clipboard to only\n  copy the visible part of the selection\n\n- Fix incorrect handling of some unicode combining marks that are not re-ordered\n\n- Fix handling on non-BMP combining characters\n\n- Drop the dependency on libunistring\n\n\n0.6.1 [2017-12-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option to fade the text in inactive windows\n\n- Add new actions to open windows/tabs/etc. with the working directory set to\n  the working directory of the current window.\n\n- Automatically adjust cell size when DPI changes, for example when kitty is\n  moved from one monitor to another with a different DPI\n\n- Ensure underlines are rendered even for fonts with very poor metrics\n\n- Fix some emoji glyphs not colored on Linux\n\n- Internal wcwidth() implementation is now auto-generated from the unicode\n  standard database\n\n- Allow configuring the modifiers to use for rectangular selection with the\n  mouse.\n\n- Fix incorrect minimum wayland version in the build script\n\n- Fix a crash when detecting a URL that ends at the end of the line\n\n- Fix regression that broke drawing of hollow cursor when window loses focus\n\n\n0.6.0 [2017-12-18]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Support background transparency via the background_opacity option. Provided\n  that your OS/window manager supports transparency, you can now have kitty\n  render pixels that have only the default background color as\n  semi-transparent.\n\n- Support multiple top level (OS) windows. These windows all share the sprite\n  texture cache on the GPU, further reducing overall resource usage. Use\n  the shortcut `ctrl+shift+n` to open a new top-level window.\n\n- Add support for a *daemon* mode using the `--single-instance` command line\n  option. With this option you can have only a single kitty instance running.\n  All future invocations simply open new top-level windows in the existing\n  instance.\n\n- Support colored emoji\n\n- Use CoreText instead of FreeType to render text on macOS\n\n- Support running on the \"low power\" GPU on dual GPU macOS machines\n\n- Add a new \"grid\" window layout\n\n- Drop the dependency on glfw (kitty now uses a modified, bundled copy of glfw)\n\n- Add an option to control the audio bell volume on X11 systems\n\n- Add a command line switch to set the name part of the WM_CLASS window\n  property independently.\n\n- Add a command line switch to set the window title.\n\n- Add more options to customize the tab-bar's appearance (font styles and\n  separator)\n\n- Allow drag and drop of files into kitty. On drop kitty will paste the\n  file path to the running program.\n\n- Add an option to control the underline style for URL highlighting on hover\n\n- X11: Set the WINDOWID environment variable\n\n- Fix middle and right buttons swapped when sending mouse events to child\n  processes\n\n- Allow selecting in a rectangle by holding down Ctrl+Alt while dragging with\n  the mouse.\n\n\n0.5.1 [2017-12-01]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option to control the thickness of lines in box drawing characters\n\n- Increase max. allowed ligature length to nine characters\n\n- Fix text not vertically centered when adjusting line height\n\n- Fix unicode block characters not being rendered properly\n\n- Fix shift+up/down not generating correct escape codes\n\n- Image display: Fix displaying images taller than two screen heights not\n  scrolling properly\n\n\n0.5.0 [2017-11-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add support for ligature fonts such as Fira Code, Hasklig, etc. kitty now\n  uses harfbuzz for text shaping which allow it to support advanced OpenType\n  features such as contextual alternates/ligatures/combining glyphs/etc.\n\n- Make it easy to select fonts by allowing listing of monospace fonts using:\n  kitty list-fonts\n\n- Add an option to have window focus follow mouse\n\n- Add a keyboard shortcut (ctrl+shift+f11) to toggle fullscreen mode\n\n- macOS: Fix handling of option key. It now behaves just like the alt key on\n  Linux. There is an option to make it type unicode characters instead.\n\n- Linux: Add support for startup notification on X11 desktops. kitty will\n  now inform the window manager when its startup is complete.\n\n- Fix shell prompt being duplicated when window is resized\n\n- Fix crash when displaying more than 64 images in the same session\n\n- Add support for colons in SGR color codes. These are generated by some\n  applications such as neovim when they mistakenly identify kitty as a libvte\n  based terminal.\n\n- Fix mouse interaction not working in apps using obsolete mouse interaction\n  protocols\n\n- Linux: no longer require glew as a dependency\n\n\n0.4.2 [2017-10-23]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix a regression in 0.4.0 that broke custom key mappings\n\n- Fix a regression in 0.4.0 that broke support for non-QWERTY keyboard layouts\n\n- Avoid using threads to reap zombie child processes. Also prevent kitty from\n  hanging if the open program hangs when clicking on a URL.\n\n\n0.4.0 [2017-10-22]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Support for drawing arbitrary raster graphics (images) in the terminal via a\n  new graphics protocol. kitty can draw images with full 32-bit color using both\n  ssh connections and files/shared memory (when available) for better\n  performance. The drawing primitives support alpha blending and z-index.\n  Images can be drawn both above and below text. See :doc:`graphics-protocol`.\n  for details.\n\n- Refactor kitty's internals to make it even faster and more efficient. The CPU\n  usage of kitty + X server while doing intensive tasks such as scrolling a\n  file continuously in less has been reduced by 50%. There are now two\n  configuration options ``repaint_delay`` and ``input_delay`` you can use to\n  fine tune kitty's performance vs CPU usage profile. The CPU usage of kitty +\n  X when scrolling in less is now significantly better than most (all?) other\n  terminals. See :doc:`performance`.\n\n- Hovering over URLs with the mouse now underlines them to indicate they\n  can be clicked. Hold down Ctrl+Shift while clicking to open the URL.\n\n- Selection using the mouse is now more intelligent. It does not add\n  blank cells (i.e. cells that have no content) after the end of text in a\n  line to the selection.\n\n- The block cursor in now fully opaque but renders the character under it in\n  the background color, for enhanced visibility.\n\n- Allow combining multiple independent actions into a single shortcut\n\n- Add a new shortcut to pass the current selection to an external program\n\n- Allow creating shortcuts to open new windows running arbitrary commands. You\n  can also pass the current selection to the command as an arguments and the\n  contents of the screen + scrollback buffer as stdin to the command.\n", "#!/usr/bin/env python3\n# License: GPLv3 Copyright: 2019, Kovid Goyal <kovid at kovidgoyal.net>\n\nfrom base64 import standard_b64decode\nfrom collections import OrderedDict\nfrom itertools import count\nfrom typing import Dict, Optional, Callable\n\nfrom .constants import is_macos, logo_png_file\nfrom .fast_data_types import get_boss\nfrom .utils import log_error\n\nNotifyImplementation = Callable[[str, str, str], None]\n\nif is_macos:\n    from .fast_data_types import cocoa_send_notification\n\n    def notify(\n        title: str,\n        body: str,\n        timeout: int = 5000,\n        application: str = 'kitty',\n        icon: bool = True,\n        identifier: Optional[str] = None,\n        subtitle: Optional[str] = None,\n    ) -> None:\n        cocoa_send_notification(identifier, title, body, subtitle)\n\nelse:\n\n    from .fast_data_types import dbus_send_notification\n\n    alloc_map: Dict[int, str] = {}\n    identifier_map: Dict[str, int] = {}\n\n    def dbus_notification_created(alloc_id: int, notification_id: int) -> None:\n        identifier = alloc_map.pop(alloc_id, None)\n        if identifier is not None:\n            identifier_map[identifier] = notification_id\n\n    def dbus_notification_activated(notification_id: int, action: str) -> None:\n        rmap = {v: k for k, v in identifier_map.items()}\n        identifier = rmap.get(notification_id)\n        if identifier is not None:\n            notification_activated(identifier)\n\n    def notify(\n        title: str,\n        body: str,\n        timeout: int = -1,\n        application: str = 'kitty',\n        icon: bool = True,\n        identifier: Optional[str] = None,\n        subtitle: Optional[str] = None,\n    ) -> None:\n        icf = ''\n        if icon is True:\n            icf = logo_png_file\n        alloc_id = dbus_send_notification(application, icf, title, body, 'Click to see changes', timeout)\n        if alloc_id and identifier is not None:\n            alloc_map[alloc_id] = identifier\n\n\ndef notify_implementation(title: str, body: str, identifier: str) -> None:\n    notify(title, body, identifier=identifier)\n\n\nclass NotificationCommand:\n\n    done: bool = True\n    identifier: str = '0'\n    title: str = ''\n    body: str = ''\n    actions: str = ''\n\n    def __repr__(self) -> str:\n        return f'NotificationCommand(identifier={self.identifier!r}, title={self.title!r}, body={self.body!r}, actions={self.actions!r}, done={self.done!r})'\n\n\ndef parse_osc_9(raw: str) -> NotificationCommand:\n    ans = NotificationCommand()\n    ans.title = raw\n    return ans\n\n\ndef parse_osc_777(raw: str) -> NotificationCommand:\n    parts = raw.split(';', 1)\n    ans = NotificationCommand()\n    ans.title = parts[0]\n    if len(parts) > 1:\n        ans.body = parts[1]\n    return ans\n\n\ndef parse_osc_99(raw: str) -> NotificationCommand:\n    cmd = NotificationCommand()\n    metadata, payload = raw.partition(';')[::2]\n    payload_is_encoded = False\n    payload_type = 'title'\n    if metadata:\n        for part in metadata.split(':'):\n            try:\n                k, v = part.split('=', 1)\n            except Exception:\n                log_error('Malformed OSC 99: metadata is not key=value pairs')\n                return cmd\n            if k == 'p':\n                payload_type = v\n            elif k == 'i':\n                cmd.identifier = v\n            elif k == 'e':\n                payload_is_encoded = v == '1'\n            elif k == 'd':\n                cmd.done = v != '0'\n            elif k == 'a':\n                cmd.actions += f',{v}'\n    if payload_type not in ('body', 'title'):\n        log_error(f'Malformed OSC 99: unknown payload type: {payload_type}')\n        return NotificationCommand()\n    if payload_is_encoded:\n        try:\n            payload = standard_b64decode(payload).decode('utf-8')\n        except Exception:\n            log_error('Malformed OSC 99: payload is not base64 encoded UTF-8 text')\n            return NotificationCommand()\n    if payload_type == 'title':\n        cmd.title = payload\n    else:\n        cmd.body = payload\n    return cmd\n\n\ndef limit_size(x: str) -> str:\n    if len(x) > 1024:\n        x = x[:1024]\n    return x\n\n\ndef merge_osc_99(prev: NotificationCommand, cmd: NotificationCommand) -> NotificationCommand:\n    if prev.done or prev.identifier != cmd.identifier:\n        return cmd\n    cmd.actions = limit_size(f'{prev.actions},{cmd.actions}')\n    cmd.title = limit_size(prev.title + cmd.title)\n    cmd.body = limit_size(prev.body + cmd.body)\n    return cmd\n\n\nidentifier_registry: \"OrderedDict[str, RegisteredNotification]\" = OrderedDict()\nid_counter = count()\n\n\nclass RegisteredNotification:\n    identifier: str\n    window_id: int\n    focus: bool = True\n    report: bool = False\n\n    def __init__(self, cmd: NotificationCommand, window_id: int):\n        self.window_id = window_id\n        for x in cmd.actions.strip(',').split(','):\n            val = not x.startswith('-')\n            x = x.lstrip('+-')\n            if x == 'focus':\n                self.focus = val\n            elif x == 'report':\n                self.report = val\n        self.identifier = cmd.identifier\n\n\ndef register_identifier(identifier: str, cmd: NotificationCommand, window_id: int) -> None:\n    identifier_registry[identifier] = RegisteredNotification(cmd, window_id)\n    if len(identifier_registry) > 100:\n        identifier_registry.popitem(False)\n\n\ndef notification_activated(identifier: str, activated_implementation: Optional[Callable[[str, int, bool, bool], None]] = None) -> None:\n    if identifier == 'new-version':\n        from .update_check import notification_activated as do\n        do()\n    elif identifier.startswith('test-notify-'):\n        log_error(f'Test notification {identifier} activated')\n    else:\n        r = identifier_registry.pop(identifier, None)\n        if r is not None and (r.focus or r.report):\n            if activated_implementation is None:\n                get_boss().notification_activated(r.identifier, r.window_id, r.focus, r.report)\n            else:\n                activated_implementation(r.identifier, r.window_id, r.focus, r.report)\n\n\ndef reset_registry() -> None:\n    global id_counter\n    identifier_registry.clear()\n    id_counter = count()\n\n\ndef notify_with_command(cmd: NotificationCommand, window_id: int, notify_implementation: NotifyImplementation = notify_implementation) -> None:\n    title = cmd.title or cmd.body\n    body = cmd.body if cmd.title else ''\n    if title:\n        identifier = f'i{next(id_counter)}'\n        notify_implementation(title, body, identifier)\n        register_identifier(identifier, cmd, window_id)\n\n\ndef handle_notification_cmd(\n    osc_code: int,\n    raw_data: str,\n    window_id: int,\n    prev_cmd: NotificationCommand,\n    notify_implementation: NotifyImplementation = notify_implementation\n) -> Optional[NotificationCommand]:\n    if osc_code == 99:\n        cmd = merge_osc_99(prev_cmd, parse_osc_99(raw_data))\n        if cmd.done:\n            notify_with_command(cmd, window_id, notify_implementation)\n            cmd = NotificationCommand()\n        return cmd\n    if osc_code == 9:\n        cmd = parse_osc_9(raw_data)\n        notify_with_command(cmd, window_id, notify_implementation)\n        return cmd\n    if osc_code == 777:\n        cmd = parse_osc_777(raw_data)\n        notify_with_command(cmd, window_id, notify_implementation)\n        return cmd\n    return None\n", "#!/usr/bin/env python3\n# License: GPL v3 Copyright: 2016, Kovid Goyal <kovid at kovidgoyal.net>\n\nimport json\nimport os\nimport re\nimport sys\nimport weakref\nfrom collections import deque\nfrom contextlib import suppress\nfrom enum import Enum, IntEnum, auto\nfrom functools import lru_cache, partial\nfrom gettext import gettext as _\nfrom itertools import chain\nfrom time import monotonic\nfrom typing import (\n    TYPE_CHECKING, Any, Callable, Deque, Dict, Iterable, List, NamedTuple,\n    Optional, Pattern, Sequence, Tuple, Union\n)\n\nfrom .child import ProcessDesc\nfrom .cli_stub import CLIOptions\nfrom .config import build_ansi_color_table\nfrom .constants import (\n    appname, clear_handled_signals, config_dir, is_macos, wakeup_io_loop\n)\nfrom .fast_data_types import (\n    BGIMAGE_PROGRAM, BLIT_PROGRAM, CELL_BG_PROGRAM, CELL_FG_PROGRAM,\n    CELL_PROGRAM, CELL_SPECIAL_PROGRAM, CURSOR_BEAM, CURSOR_BLOCK,\n    CURSOR_UNDERLINE, DCS, DECORATION, DECORATION_MASK, DIM, GLFW_MOD_CONTROL,\n    GRAPHICS_ALPHA_MASK_PROGRAM, GRAPHICS_PREMULT_PROGRAM, GRAPHICS_PROGRAM,\n    MARK, MARK_MASK, NO_CURSOR_SHAPE, NUM_UNDERLINE_STYLES, OSC, REVERSE,\n    SCROLL_FULL, SCROLL_LINE, SCROLL_PAGE, STRIKETHROUGH, TINT_PROGRAM, Color,\n    KeyEvent, Screen, add_timer, add_window, cell_size_for_window,\n    click_mouse_cmd_output, click_mouse_url, compile_program,\n    current_os_window, encode_key_for_tty, get_boss, get_click_interval,\n    get_clipboard_string, get_options, init_cell_program, mark_os_window_dirty,\n    mouse_selection, move_cursor_to_mouse_if_in_prompt, pt_to_px,\n    set_clipboard_string, set_titlebar_color, set_window_logo,\n    set_window_padding, set_window_render_data, update_ime_position_for_window,\n    update_window_title, update_window_visibility, wakeup_main_loop\n)\nfrom .keys import keyboard_mode_name, mod_mask\nfrom .notify import NotificationCommand, handle_notification_cmd\nfrom .options.types import Options\nfrom .rgb import to_color\nfrom .terminfo import get_capabilities\nfrom .types import MouseEvent, OverlayType, WindowGeometry, ac, run_once\nfrom .typing import BossType, ChildType, EdgeLiteral, TabType, TypedDict\nfrom .utils import (\n    docs_url, get_primary_selection, kitty_ansi_sanitizer_pat, load_shaders,\n    log_error, open_cmd, open_url, parse_color_set, path_from_osc7_url,\n    resolve_custom_file, resolved_shell, sanitize_title, set_primary_selection\n)\n\nMatchPatternType = Union[Pattern[str], Tuple[Pattern[str], Optional[Pattern[str]]]]\n\n\nif TYPE_CHECKING:\n    from .file_transmission import FileTransmission\n\n\nclass CwdRequestType(Enum):\n    current: int = auto()\n    last_reported: int = auto()\n    oldest: int = auto()\n\n\nclass CwdRequest:\n\n    def __init__(self, window: Optional['Window'] = None, request_type: CwdRequestType = CwdRequestType.current) -> None:\n        self.window_id = -1 if window is None else window.id\n        self.request_type = request_type\n\n    def __bool__(self) -> bool:\n        return self.window_id > -1\n\n    @property\n    def window(self) -> Optional['Window']:\n        return get_boss().window_id_map.get(self.window_id)\n\n    @property\n    def cwd_of_child(self) -> str:\n        window = self.window\n        if not window:\n            return ''\n        reported_cwd = path_from_osc7_url(window.screen.last_reported_cwd) if window.screen.last_reported_cwd else ''\n        if reported_cwd and not window.child_is_remote and (self.request_type is CwdRequestType.last_reported or window.at_prompt):\n            return reported_cwd\n        return window.get_cwd_of_child(oldest=self.request_type is CwdRequestType.oldest) or ''\n\n    def modify_argv_for_launch_with_cwd(self, argv: List[str]) -> str:\n        window = self.window\n        if not window:\n            return ''\n        reported_cwd = path_from_osc7_url(window.screen.last_reported_cwd) if window.screen.last_reported_cwd else ''\n        if reported_cwd:\n            # First check if we are running ssh kitten, and trying to open the configured login shell\n            if argv[0] == resolved_shell(get_options())[0]:\n                ssh_kitten_cmdline = window.ssh_kitten_cmdline()\n                if ssh_kitten_cmdline:\n                    from kittens.ssh.utils import set_cwd_in_cmdline\n                    argv[:] = ssh_kitten_cmdline\n                    set_cwd_in_cmdline(reported_cwd, argv)\n                    return ''\n            if not window.child_is_remote and (self.request_type is CwdRequestType.last_reported or window.at_prompt):\n                return reported_cwd\n        return window.get_cwd_of_child(oldest=self.request_type is CwdRequestType.oldest) or ''\n\n\ndef process_title_from_child(title: str, is_base64: bool) -> str:\n    if is_base64:\n        from base64 import standard_b64decode\n        try:\n            title = standard_b64decode(title).decode('utf-8', 'replace')\n        except Exception:\n            title = 'undecodeable title'\n    return sanitize_title(title)\n\n\n@lru_cache(maxsize=64)\ndef compile_match_query(exp: str, is_simple: bool = True) -> MatchPatternType:\n    if is_simple:\n        pat: MatchPatternType = re.compile(exp)\n    else:\n        kp, vp = exp.partition('=')[::2]\n        if vp:\n            pat = re.compile(kp), re.compile(vp)\n        else:\n            pat = re.compile(kp), None\n    return pat\n\n\nclass WindowDict(TypedDict):\n    id: int\n    is_focused: bool\n    title: str\n    pid: Optional[int]\n    cwd: str\n    cmdline: List[str]\n    env: Dict[str, str]\n    foreground_processes: List[ProcessDesc]\n    is_self: bool\n    lines: int\n    columns: int\n\n\nclass PipeData(TypedDict):\n    input_line_number: int\n    scrolled_by: int\n    cursor_x: int\n    cursor_y: int\n    lines: int\n    columns: int\n    text: str\n\n\nclass ClipboardPending(NamedTuple):\n    where: str\n    data: str\n    truncated: bool = False\n\n\nclass DynamicColor(IntEnum):\n    default_fg, default_bg, cursor_color, highlight_fg, highlight_bg = range(1, 6)\n\n\nclass CommandOutput(IntEnum):\n    last_run, first_on_screen, last_visited, last_non_empty = 0, 1, 2, 3\n\n\nDYNAMIC_COLOR_CODES = {\n    10: DynamicColor.default_fg,\n    11: DynamicColor.default_bg,\n    12: DynamicColor.cursor_color,\n    17: DynamicColor.highlight_bg,\n    19: DynamicColor.highlight_fg,\n}\nDYNAMIC_COLOR_CODES.update({k+100: v for k, v in DYNAMIC_COLOR_CODES.items()})\n\n\nclass Watcher:\n\n    def __call__(self, boss: BossType, window: 'Window', data: Dict[str, Any]) -> None:\n        pass\n\n\nclass Watchers:\n\n    on_resize: List[Watcher]\n    on_close: List[Watcher]\n    on_focus_change: List[Watcher]\n\n    def __init__(self) -> None:\n        self.on_resize = []\n        self.on_close = []\n        self.on_focus_change = []\n\n    def add(self, others: 'Watchers') -> None:\n        def merge(base: List[Watcher], other: List[Watcher]) -> None:\n            for x in other:\n                if x not in base:\n                    base.append(x)\n        merge(self.on_resize, others.on_resize)\n        merge(self.on_close, others.on_close)\n        merge(self.on_focus_change, others.on_focus_change)\n\n    def clear(self) -> None:\n        del self.on_close[:], self.on_resize[:], self.on_focus_change[:]\n\n    def copy(self) -> 'Watchers':\n        ans = Watchers()\n        ans.on_close = self.on_close[:]\n        ans.on_resize = self.on_resize[:]\n        ans.on_focus_change = self.on_focus_change[:]\n        return ans\n\n    @property\n    def has_watchers(self) -> bool:\n        return bool(self.on_close or self.on_resize or self.on_focus_change)\n\n\ndef call_watchers(windowref: Callable[[], Optional['Window']], which: str, data: Dict[str, Any]) -> None:\n\n    def callback(timer_id: Optional[int]) -> None:\n        w = windowref()\n        if w is not None:\n            watchers: List[Watcher] = getattr(w.watchers, which)\n            w.call_watchers(watchers, data)\n\n    add_timer(callback, 0, False)\n\n\ndef pagerhist(screen: Screen, as_ansi: bool = False, add_wrap_markers: bool = True, upto_output_start: bool = False) -> str:\n    pht = screen.historybuf.pagerhist_as_text(upto_output_start)\n    if pht and (not as_ansi or not add_wrap_markers):\n        sanitizer = text_sanitizer(as_ansi, add_wrap_markers)\n        pht = sanitizer(pht)\n    return pht\n\n\ndef as_text(\n    screen: Screen,\n    as_ansi: bool = False,\n    add_history: bool = False,\n    add_wrap_markers: bool = False,\n    alternate_screen: bool = False,\n    add_cursor: bool = False\n) -> str:\n    lines: List[str] = []\n    add_history = add_history and not (screen.is_using_alternate_linebuf() ^ alternate_screen)\n    if alternate_screen:\n        f = screen.as_text_alternate\n    else:\n        f = screen.as_text_non_visual if add_history else screen.as_text\n    f(lines.append, as_ansi, add_wrap_markers)\n    ctext = ''\n    if add_cursor:\n        ctext += '\\x1b[?25' + ('h' if screen.cursor_visible else 'l')\n        ctext += f'\\x1b[{screen.cursor.y + 1};{screen.cursor.x + 1}H'\n        shape = screen.cursor.shape\n        if shape == NO_CURSOR_SHAPE:\n            ctext += '\\x1b[?12' + ('h' if screen.cursor.blink else 'l')\n        else:\n            code = {CURSOR_BLOCK: 1, CURSOR_UNDERLINE: 3, CURSOR_BEAM: 5}[shape]\n            if not screen.cursor.blink:\n                code += 1\n            ctext += f'\\x1b[{code} q'\n\n    if add_history:\n        pht = pagerhist(screen, as_ansi, add_wrap_markers)\n        h: List[str] = [pht] if pht else []\n        screen.as_text_for_history_buf(h.append, as_ansi, add_wrap_markers)\n        if h:\n            if not screen.linebuf.is_continued(0):\n                h[-1] += '\\n'\n            if as_ansi:\n                h[-1] += '\\x1b[m'\n        ans = ''.join(chain(h, lines))\n        if ctext:\n            ans += ctext\n        return ans\n    ans = ''.join(lines)\n    if ctext:\n        ans += ctext\n    return ans\n\n\ndef multi_replace(src: str, **replacements: Any) -> str:\n    r = {k: str(v) for k, v in replacements.items()}\n\n    def sub(m: 're.Match[str]') -> str:\n        return r.get(m.group(1), m.group(1))\n\n    return re.sub(r'\\{([A-Z_]+)\\}', sub, src)\n\n\nclass LoadShaderPrograms:\n\n    def __call__(self, semi_transparent: bool = False) -> None:\n        compile_program(BLIT_PROGRAM, *load_shaders('blit'))\n        v, f = load_shaders('cell')\n\n        for which, p in {\n                'SIMPLE': CELL_PROGRAM,\n                'BACKGROUND': CELL_BG_PROGRAM,\n                'SPECIAL': CELL_SPECIAL_PROGRAM,\n                'FOREGROUND': CELL_FG_PROGRAM,\n        }.items():\n            ff = f.replace('{WHICH_PROGRAM}', which)\n            vv = multi_replace(\n                v,\n                WHICH_PROGRAM=which,\n                REVERSE_SHIFT=REVERSE,\n                STRIKE_SHIFT=STRIKETHROUGH,\n                DIM_SHIFT=DIM,\n                DECORATION_SHIFT=DECORATION,\n                MARK_SHIFT=MARK,\n                MARK_MASK=MARK_MASK,\n                DECORATION_MASK=DECORATION_MASK,\n                STRIKE_SPRITE_INDEX=NUM_UNDERLINE_STYLES + 1,\n            )\n            if semi_transparent:\n                vv = vv.replace('#define NOT_TRANSPARENT', '#define TRANSPARENT')\n                ff = ff.replace('#define NOT_TRANSPARENT', '#define TRANSPARENT')\n            compile_program(p, vv, ff)\n\n        v, f = load_shaders('graphics')\n        for which, p in {\n                'SIMPLE': GRAPHICS_PROGRAM,\n                'PREMULT': GRAPHICS_PREMULT_PROGRAM,\n                'ALPHA_MASK': GRAPHICS_ALPHA_MASK_PROGRAM,\n        }.items():\n            ff = f.replace('ALPHA_TYPE', which)\n            compile_program(p, v, ff)\n\n        v, f = load_shaders('bgimage')\n        compile_program(BGIMAGE_PROGRAM, v, f)\n        v, f = load_shaders('tint')\n        compile_program(TINT_PROGRAM, v, f)\n        init_cell_program()\n\n\nload_shader_programs = LoadShaderPrograms()\n\n\ndef setup_colors(screen: Screen, opts: Options) -> None:\n    screen.color_profile.update_ansi_color_table(build_ansi_color_table(opts))\n\n    def s(c: Optional[Color]) -> int:\n        return 0 if c is None else (0xff000000 | int(c))\n    screen.color_profile.set_configured_colors(\n        s(opts.foreground), s(opts.background),\n        s(opts.cursor), s(opts.cursor_text_color),\n        s(opts.selection_foreground), s(opts.selection_background),\n        s(opts.visual_bell_color)\n    )\n\n\n@run_once\ndef load_paste_filter() -> Callable[[str], str]:\n    import runpy\n    import traceback\n    try:\n        m = runpy.run_path(os.path.join(config_dir, 'paste-actions.py'))\n        func: Callable[[str], str] = m['filter_paste']\n    except Exception as e:\n        if not isinstance(e, FileNotFoundError):\n            traceback.print_exc()\n            log_error(f'Failed to load paste filter function with error: {e}')\n\n        def func(text: str) -> str:\n            return text\n    return func\n\n\ndef text_sanitizer(as_ansi: bool, add_wrap_markers: bool) -> Callable[[str], str]:\n    pat = kitty_ansi_sanitizer_pat()\n    ansi, wrap_markers = not as_ansi, not add_wrap_markers\n\n    def remove_wrap_markers(line: str) -> str:\n        return line.replace('\\r', '')\n\n    def remove_sgr(line: str) -> str:\n        return str(pat.sub('', line))\n\n    def remove_both(line: str) -> str:\n        return str(pat.sub('', line.replace('\\r', '')))\n\n    if ansi:\n        return remove_both if wrap_markers else remove_sgr\n    return remove_wrap_markers\n\n\ndef cmd_output(screen: Screen, which: CommandOutput = CommandOutput.last_run, as_ansi: bool = False, add_wrap_markers: bool = False) -> str:\n    lines: List[str] = []\n    search_in_pager_hist = screen.cmd_output(which, lines.append, as_ansi, add_wrap_markers)\n    if search_in_pager_hist:\n        pht = pagerhist(screen, as_ansi, add_wrap_markers, True)\n        if pht:\n            lines.insert(0, pht)\n    for i in range(min(len(lines), 3)):\n        x = lines[i]\n        if x.startswith('\\x1b]133;C'):\n            lines[i] = x.partition('\\\\')[-1]\n    return ''.join(lines)\n\n\ndef process_remote_print(msg: str) -> str:\n    from base64 import standard_b64decode\n\n    from .cli import green\n    text = standard_b64decode(msg).decode('utf-8', 'replace')\n    return text.replace('\\x1b', green(r'\\e')).replace('\\a', green(r'\\a')).replace('\\0', green(r'\\0'))\n\n\nclass EdgeWidths:\n    left: Optional[float]\n    top: Optional[float]\n    right: Optional[float]\n    bottom: Optional[float]\n\n    def __init__(self, serialized: Optional[Dict[str, Optional[float]]] = None):\n        if serialized is not None:\n            self.left = serialized['left']\n            self.right = serialized['right']\n            self.top = serialized['top']\n            self.bottom = serialized['bottom']\n        else:\n            self.left = self.top = self.right = self.bottom = None\n\n    def serialize(self) -> Dict[str, Optional[float]]:\n        return {'left': self.left, 'right': self.right, 'top': self.top, 'bottom': self.bottom}\n\n\nclass GlobalWatchers:\n\n    def __init__(self) -> None:\n        self.options_spec: Optional[Dict[str, str]] = None\n        self.ans = Watchers()\n        self.extra = ''\n\n    def __call__(self) -> Watchers:\n        spec = get_options().watcher\n        if spec == self.options_spec:\n            return self.ans\n        from .launch import load_watch_modules\n        if self.extra:\n            spec = spec.copy()\n            spec[self.extra] = self.extra\n        self.ans = load_watch_modules(spec.keys()) or self.ans\n        self.options_spec = spec.copy()\n        return self.ans\n\n    def set_extra(self, extra: str) -> None:\n        self.extra = extra\n\n\nglobal_watchers = GlobalWatchers()\n\n\nclass Window:\n\n    window_custom_type: str = ''\n    overlay_type = OverlayType.transient\n\n    def __init__(\n        self,\n        tab: TabType,\n        child: ChildType,\n        args: CLIOptions,\n        override_title: Optional[str] = None,\n        copy_colors_from: Optional['Window'] = None,\n        watchers: Optional[Watchers] = None,\n        allow_remote_control: bool = False,\n        remote_control_passwords: Optional[Dict[str, Sequence[str]]] = None,\n    ):\n        if watchers:\n            self.watchers = watchers\n            self.watchers.add(global_watchers())\n        else:\n            self.watchers = global_watchers().copy()\n        self.last_focused_at = 0.\n        self.started_at = monotonic()\n        self.current_remote_data: List[str] = []\n        self.current_mouse_event_button = 0\n        self.current_clipboard_read_ask: Optional[bool] = None\n        self.prev_osc99_cmd = NotificationCommand()\n        self.actions_on_close: List[Callable[['Window'], None]] = []\n        self.actions_on_focus_change: List[Callable[['Window', bool], None]] = []\n        self.actions_on_removal: List[Callable[['Window'], None]] = []\n        self.current_marker_spec: Optional[Tuple[str, Union[str, Tuple[Tuple[int, str], ...]]]] = None\n        self.kitten_result_processors: List[Callable[['Window', Any], None]] = []\n        self.pty_resized_once = False\n        self.last_reported_pty_size = (-1, -1, -1, -1)\n        self.needs_attention = False\n        self.override_title = override_title\n        self.default_title = os.path.basename(child.argv[0] or appname)\n        self.child_title = self.default_title\n        self.title_stack: Deque[str] = deque(maxlen=10)\n        self.id: int = add_window(tab.os_window_id, tab.id, self.title)\n        self.margin = EdgeWidths()\n        self.padding = EdgeWidths()\n        self.kitten_result: Optional[Dict[str, Any]] = None\n        if not self.id:\n            raise Exception(f'No tab with id: {tab.id} in OS Window: {tab.os_window_id} was found, or the window counter wrapped')\n        self.tab_id = tab.id\n        self.os_window_id = tab.os_window_id\n        self.tabref: Callable[[], Optional[TabType]] = weakref.ref(tab)\n        self.clipboard_pending: Optional[ClipboardPending] = None\n        self.destroyed = False\n        self.geometry: WindowGeometry = WindowGeometry(0, 0, 0, 0, 0, 0)\n        self.needs_layout = True\n        self.is_visible_in_layout: bool = True\n        self.child = child\n        cell_width, cell_height = cell_size_for_window(self.os_window_id)\n        opts = get_options()\n        self.screen: Screen = Screen(self, 24, 80, opts.scrollback_lines, cell_width, cell_height, self.id)\n        if copy_colors_from is not None:\n            self.screen.copy_colors_from(copy_colors_from.screen)\n        else:\n            setup_colors(self.screen, opts)\n        self.remote_control_passwords = remote_control_passwords\n        self.allow_remote_control = allow_remote_control\n\n    def remote_control_allowed(self, pcmd: Dict[str, Any], extra_data: Dict[str, Any]) -> bool:\n        if not self.allow_remote_control:\n            return False\n        if not self.remote_control_passwords:\n            return True\n        pw = pcmd.get('password', '')\n        auth_items = self.remote_control_passwords.get(pw)\n        if pw == '!':\n            auth_items = None\n        if auth_items is None:\n            if '!' in self.remote_control_passwords:\n                raise PermissionError()\n            return False\n        from .remote_control import password_authorizer\n        pa = password_authorizer(auth_items)\n        if not pa.is_cmd_allowed(pcmd, self, False, extra_data):\n            raise PermissionError()\n        return True\n\n    @property\n    def file_transmission_control(self) -> 'FileTransmission':\n        ans: Optional['FileTransmission'] = getattr(self, '_file_transmission', None)\n        if ans is None:\n            from .file_transmission import FileTransmission\n            ans = self._file_transmission = FileTransmission(self.id)\n        return ans\n\n    def on_dpi_change(self, font_sz: float) -> None:\n        self.update_effective_padding()\n\n    def change_tab(self, tab: TabType) -> None:\n        self.tab_id = tab.id\n        self.os_window_id = tab.os_window_id\n        self.tabref = weakref.ref(tab)\n\n    def effective_margin(self, edge: EdgeLiteral, is_single_window: bool = False) -> int:\n        q = getattr(self.margin, edge)\n        if q is not None:\n            return pt_to_px(q, self.os_window_id)\n        opts = get_options()\n        if is_single_window:\n            q = getattr(opts.single_window_margin_width, edge)\n            if q > -0.1:\n                return pt_to_px(q, self.os_window_id)\n        q = getattr(opts.window_margin_width, edge)\n        return pt_to_px(q, self.os_window_id)\n\n    def effective_padding(self, edge: EdgeLiteral) -> int:\n        q = getattr(self.padding, edge)\n        if q is not None:\n            return pt_to_px(q, self.os_window_id)\n        q = getattr(get_options().window_padding_width, edge)\n        return pt_to_px(q, self.os_window_id)\n\n    def update_effective_padding(self) -> None:\n        set_window_padding(\n            self.os_window_id, self.tab_id, self.id,\n            self.effective_padding('left'), self.effective_padding('top'),\n            self.effective_padding('right'), self.effective_padding('bottom'))\n\n    def patch_edge_width(self, which: str, edge: EdgeLiteral, val: Optional[float]) -> None:\n        q = self.padding if which == 'padding' else self.margin\n        setattr(q, edge, val)\n        if q is self.padding:\n            self.update_effective_padding()\n\n    def effective_border(self) -> int:\n        val, unit = get_options().window_border_width\n        if unit == 'pt':\n            val = max(1 if val > 0 else 0, pt_to_px(val, self.os_window_id))\n        else:\n            val = round(val)\n        return int(val)\n\n    def apply_options(self) -> None:\n        opts = get_options()\n        self.update_effective_padding()\n        self.change_titlebar_color()\n        setup_colors(self.screen, opts)\n\n    @property\n    def title(self) -> str:\n        return self.override_title or self.child_title\n\n    def __repr__(self) -> str:\n        return f'Window(title={self.title}, id={self.id})'\n\n    def as_dict(self, is_focused: bool = False, is_self: bool = False) -> WindowDict:\n        return dict(\n            id=self.id,\n            is_focused=is_focused,\n            title=self.title,\n            pid=self.child.pid,\n            cwd=self.child.current_cwd or self.child.cwd,\n            cmdline=self.child.cmdline,\n            env=self.child.environ,\n            foreground_processes=self.child.foreground_processes,\n            is_self=is_self,\n            lines=self.screen.lines,\n            columns=self.screen.columns,\n        )\n\n    def serialize_state(self) -> Dict[str, Any]:\n        ans = {\n            'version': 1,\n            'id': self.id,\n            'child_title': self.child_title,\n            'override_title': self.override_title,\n            'default_title': self.default_title,\n            'title_stack': list(self.title_stack),\n            'allow_remote_control': self.allow_remote_control,\n            'remote_control_passwords': self.remote_control_passwords,\n            'cwd': self.child.current_cwd or self.child.cwd,\n            'env': self.child.environ,\n            'cmdline': self.child.cmdline,\n            'margin': self.margin.serialize(),\n            'padding': self.padding.serialize(),\n        }\n        if self.window_custom_type:\n            ans['window_custom_type'] = self.window_custom_type\n        if self.overlay_type is not OverlayType.transient:\n            ans['overlay_type'] = self.overlay_type.value\n        return ans\n\n    @property\n    def current_colors(self) -> Dict[str, Optional[int]]:\n        return self.screen.color_profile.as_dict()\n\n    @property\n    def at_prompt(self) -> bool:\n        return self.screen.cursor_at_prompt()\n\n    @property\n    def has_running_program(self) -> bool:\n        return not self.at_prompt\n\n    def matches(self, field: str, pat: MatchPatternType) -> bool:\n        if not pat:\n            return False\n        if field == 'env':\n            assert isinstance(pat, tuple)\n            key_pat, val_pat = pat\n            for key, val in self.child.environ.items():\n                if key_pat.search(key) is not None and (\n                        val_pat is None or val_pat.search(val) is not None):\n                    return True\n            return False\n        assert not isinstance(pat, tuple)\n\n        if field in ('id', 'window_id'):\n            return pat.pattern == str(self.id)\n        if field == 'pid':\n            return pat.pattern == str(self.child.pid)\n        if field == 'title':\n            return pat.search(self.override_title or self.title) is not None\n        if field in 'cwd':\n            return pat.search(self.child.current_cwd or self.child.cwd) is not None\n        if field == 'cmdline':\n            for x in self.child.cmdline:\n                if pat.search(x) is not None:\n                    return True\n            return False\n        return False\n\n    def matches_query(self, field: str, query: str, active_tab: Optional[TabType] = None) -> bool:\n        if field in ('num', 'recent'):\n            if active_tab is not None:\n                try:\n                    q = int(query)\n                except Exception:\n                    return False\n                with suppress(Exception):\n                    if field == 'num':\n                        return active_tab.get_nth_window(q) is self\n                    return active_tab.nth_active_window_id(q) == self.id\n            return False\n        if field == 'state':\n            if query == 'active':\n                return active_tab is not None and self is active_tab.active_window\n            if query == 'focused':\n                return active_tab is not None and self is active_tab.active_window and current_os_window() == self.os_window_id\n            if query == 'needs_attention':\n                return self.needs_attention\n            if query == 'parent_active':\n                return active_tab is not None and self.tabref() is active_tab\n            if query == 'parent_focused':\n                return active_tab is not None and self.tabref() is active_tab and current_os_window() == self.os_window_id\n            return False\n        pat = compile_match_query(query, field != 'env')\n        return self.matches(field, pat)\n\n    def set_visible_in_layout(self, val: bool) -> None:\n        val = bool(val)\n        if val is not self.is_visible_in_layout:\n            self.is_visible_in_layout = val\n            update_window_visibility(self.os_window_id, self.tab_id, self.id, val)\n            if val:\n                self.refresh()\n\n    def refresh(self) -> None:\n        self.screen.mark_as_dirty()\n        wakeup_io_loop()\n        wakeup_main_loop()\n\n    def set_geometry(self, new_geometry: WindowGeometry) -> None:\n        if self.destroyed:\n            return\n        if self.needs_layout or new_geometry.xnum != self.screen.columns or new_geometry.ynum != self.screen.lines:\n            self.screen.resize(new_geometry.ynum, new_geometry.xnum)\n            self.needs_layout = False\n            call_watchers(weakref.ref(self), 'on_resize', {'old_geometry': self.geometry, 'new_geometry': new_geometry})\n        current_pty_size = (\n            self.screen.lines, self.screen.columns,\n            max(0, new_geometry.right - new_geometry.left), max(0, new_geometry.bottom - new_geometry.top))\n        update_ime_position = False\n        if current_pty_size != self.last_reported_pty_size:\n            get_boss().child_monitor.resize_pty(self.id, *current_pty_size)\n            if not self.pty_resized_once:\n                self.pty_resized_once = True\n                self.child.mark_terminal_ready()\n                update_ime_position = True\n            self.last_reported_pty_size = current_pty_size\n        else:\n            mark_os_window_dirty(self.os_window_id)\n\n        self.geometry = g = new_geometry\n        set_window_render_data(self.os_window_id, self.tab_id, self.id, self.screen, *g[:4])\n        self.update_effective_padding()\n        if update_ime_position:\n            update_ime_position_for_window(self.id, True)\n\n    def contains(self, x: int, y: int) -> bool:\n        g = self.geometry\n        return g.left <= x <= g.right and g.top <= y <= g.bottom\n\n    def close(self) -> None:\n        get_boss().mark_window_for_close(self)\n\n    @ac('misc', '''\n        Send the specified text to the active window\n\n        See :sc:`send_text <send_text>` for details.\n        ''')\n    def send_text(self, *args: str) -> bool:\n        mode = keyboard_mode_name(self.screen)\n        required_mode_, text = args[-2:]\n        required_mode = frozenset(required_mode_.split(','))\n        if not required_mode & {mode, 'all'}:\n            return True\n        if not text:\n            return True\n        self.write_to_child(text)\n        return False\n\n    @ac('debug', 'Show a dump of the current lines in the scrollback + screen with their line attributes')\n    def dump_lines_with_attrs(self) -> None:\n        strings: List[str] = []\n        self.screen.dump_lines_with_attrs(strings.append)\n        text = ''.join(strings)\n        get_boss().display_scrollback(self, text, title='Dump of lines', report_cursor=False)\n\n    def write_to_child(self, data: Union[str, bytes]) -> None:\n        if data:\n            if isinstance(data, str):\n                data = data.encode('utf-8')\n            if get_boss().child_monitor.needs_write(self.id, data) is not True:\n                log_error(f'Failed to write to child {self.id} as it does not exist')\n\n    def title_updated(self) -> None:\n        update_window_title(self.os_window_id, self.tab_id, self.id, self.title)\n        t = self.tabref()\n        if t is not None:\n            t.title_changed(self)\n\n    def set_title(self, title: Optional[str]) -> None:\n        if title:\n            title = sanitize_title(title)\n        self.override_title = title or None\n        self.title_updated()\n\n    def desktop_notify(self, osc_code: int, raw_data: str) -> None:\n        if osc_code == 777:\n            if not raw_data.startswith('notify;'):\n                log_error(f'Ignoring unknown OSC 777: {raw_data}')\n                return  # unknown OSC 777\n            raw_data = raw_data[len('notify;'):]\n        cmd = handle_notification_cmd(osc_code, raw_data, self.id, self.prev_osc99_cmd)\n        if cmd is not None and osc_code == 99:\n            self.prev_osc99_cmd = cmd\n\n    # screen callbacks {{{\n    def use_utf8(self, on: bool) -> None:\n        get_boss().child_monitor.set_iutf8_winid(self.id, on)\n\n    def on_mouse_event(self, event: Dict[str, Any]) -> bool:\n        event['mods'] = event.get('mods', 0) & mod_mask\n        ev = MouseEvent(**event)\n        self.current_mouse_event_button = ev.button\n        action = get_options().mousemap.get(ev)\n        if action is None:\n            return False\n        return get_boss().combine(action, window_for_dispatch=self, dispatch_type='MouseEvent')\n\n    def open_url(self, url: str, hyperlink_id: int, cwd: Optional[str] = None) -> None:\n        opts = get_options()\n        if hyperlink_id:\n            if not opts.allow_hyperlinks:\n                return\n            from urllib.parse import unquote, urlparse, urlunparse\n            try:\n                purl = urlparse(url)\n            except Exception:\n                return\n            if (not purl.scheme or purl.scheme == 'file'):\n                if purl.netloc:\n                    from socket import gethostname\n                    try:\n                        hostname = gethostname()\n                    except Exception:\n                        hostname = ''\n                    remote_hostname = purl.netloc.partition(':')[0]\n                    if remote_hostname and remote_hostname != hostname and remote_hostname != 'localhost':\n                        self.handle_remote_file(purl.netloc, unquote(purl.path))\n                        return\n                    url = urlunparse(purl._replace(netloc=''))\n            if opts.allow_hyperlinks & 0b10:\n                from kittens.tui.operations import styled\n                get_boss().choose(\n                    'What would you like to do with this URL:\\n' + styled(unquote(url), fg='yellow'),\n                    partial(self.hyperlink_open_confirmed, url, cwd),\n                    'o:Open', 'c:Copy to clipboard', 'n;red:Nothing', default='o',\n                    window=self,\n                )\n                return\n        get_boss().open_url(url, cwd=cwd)\n\n    def hyperlink_open_confirmed(self, url: str, cwd: Optional[str], q: str) -> None:\n        if q == 'o':\n            get_boss().open_url(url, cwd=cwd)\n        elif q == 'c':\n            set_clipboard_string(url)\n\n    def handle_remote_file(self, netloc: str, remote_path: str) -> None:\n        from kittens.remote_file.main import is_ssh_kitten_sentinel\n        from kittens.ssh.main import get_connection_data\n\n        from .utils import SSHConnectionData\n        args = self.ssh_kitten_cmdline()\n        conn_data: Union[None, List[str], SSHConnectionData] = None\n        if args:\n            ssh_cmdline = sorted(self.child.foreground_processes, key=lambda p: p['pid'])[-1]['cmdline'] or ['']\n            if 'ControlPath=' in ' '.join(ssh_cmdline):\n                idx = ssh_cmdline.index('--')\n                conn_data = [is_ssh_kitten_sentinel] + list(ssh_cmdline[:idx + 2])\n        if conn_data is None:\n            args = self.child.foreground_cmdline\n            conn_data = get_connection_data(args, self.child.foreground_cwd or self.child.current_cwd or '')\n            if conn_data is None:\n                get_boss().show_error('Could not handle remote file', f'No SSH connection data found in: {args}')\n                return\n        get_boss().run_kitten(\n            'remote_file', '--hostname', netloc.partition(':')[0], '--path', remote_path,\n            '--ssh-connection-data', json.dumps(conn_data)\n        )\n\n    def send_signal_for_key(self, key_num: int) -> bool:\n        try:\n            return self.child.send_signal_for_key(key_num)\n        except OSError as err:\n            log_error(f'Failed to send signal for key to child with err: {err}')\n            return False\n\n    def focus_changed(self, focused: bool) -> None:\n        if self.destroyed:\n            return\n        call_watchers(weakref.ref(self), 'on_focus_change', {'focused': focused})\n        for c in self.actions_on_focus_change:\n            try:\n                c(self, focused)\n            except Exception:\n                import traceback\n                traceback.print_exc()\n        self.screen.focus_changed(focused)\n        if focused:\n            self.last_focused_at = monotonic()\n            update_ime_position_for_window(self.id, False, 1)\n            changed = self.needs_attention\n            self.needs_attention = False\n            if changed:\n                tab = self.tabref()\n                if tab is not None:\n                    tab.relayout_borders()\n        elif self.os_window_id == current_os_window():\n            # Cancel IME composition after loses focus\n            update_ime_position_for_window(self.id, False, -1)\n\n    def title_changed(self, new_title: Optional[str], is_base64: bool = False) -> None:\n        self.child_title = process_title_from_child(new_title or self.default_title, is_base64)\n        if self.override_title is None:\n            self.title_updated()\n\n    def icon_changed(self, new_icon: object) -> None:\n        pass  # TODO: Implement this\n\n    @property\n    def is_active(self) -> bool:\n        return get_boss().active_window is self\n\n    @property\n    def has_activity_since_last_focus(self) -> bool:\n        return self.screen.has_activity_since_last_focus()\n\n    def on_activity_since_last_focus(self) -> None:\n        if get_options().tab_activity_symbol:\n            get_boss().on_activity_since_last_focus(self)\n\n    def on_bell(self) -> None:\n        cb = get_options().command_on_bell\n        if cb and cb != ['none']:\n            import shlex\n            import subprocess\n            env = self.child.foreground_environ\n            env['KITTY_CHILD_CMDLINE'] = ' '.join(map(shlex.quote, self.child.cmdline))\n            subprocess.Popen(cb, env=env, cwd=self.child.foreground_cwd, preexec_fn=clear_handled_signals)\n        if not self.is_active:\n            changed = not self.needs_attention\n            self.needs_attention = True\n            tab = self.tabref()\n            if tab is not None:\n                if changed:\n                    tab.relayout_borders()\n                tab.on_bell(self)\n\n    def change_titlebar_color(self) -> None:\n        opts = get_options()\n        val = opts.macos_titlebar_color if is_macos else opts.wayland_titlebar_color\n        if val > 0:\n            if (val & 0xff) == 1:\n                val = self.screen.color_profile.default_bg\n            else:\n                val = val >> 8\n            set_titlebar_color(self.os_window_id, val)\n        else:\n            set_titlebar_color(self.os_window_id, 0, True, -val)\n\n    def change_colors(self, changes: Dict[DynamicColor, Optional[str]]) -> None:\n        dirtied = default_bg_changed = False\n\n        def item(raw: Optional[str]) -> int:\n            if raw is None:\n                return 0\n            v = to_color(raw)\n            if v is None:\n                return 0\n            return 0xff000000 | int(v)\n\n        for which, val_ in changes.items():\n            val = item(val_)\n            dirtied = True\n            setattr(self.screen.color_profile, which.name, val)\n            if which.name == 'default_bg':\n                default_bg_changed = True\n        if dirtied:\n            self.screen.mark_as_dirty()\n        if default_bg_changed:\n            get_boss().default_bg_changed_for(self.id)\n\n    def color_profile_popped(self, bg_changed: bool) -> None:\n        if bg_changed:\n            get_boss().default_bg_changed_for(self.id)\n\n    def report_color(self, code: str, r: int, g: int, b: int) -> None:\n        r |= r << 8\n        g |= g << 8\n        b |= b << 8\n        self.screen.send_escape_code_to_child(OSC, f'{code};rgb:{r:04x}/{g:04x}/{b:04x}')\n\n    def report_notification_activated(self, identifier: str) -> None:\n        self.screen.send_escape_code_to_child(OSC, f'99;i={identifier};')\n\n    def set_dynamic_color(self, code: int, value: Union[str, bytes]) -> None:\n        if isinstance(value, bytes):\n            value = value.decode('utf-8')\n        color_changes: Dict[DynamicColor, Optional[str]] = {}\n        for val in value.split(';'):\n            w = DYNAMIC_COLOR_CODES.get(code)\n            if w is not None:\n                if val == '?':\n                    col = getattr(self.screen.color_profile, w.name)\n                    self.report_color(str(code), col >> 16, (col >> 8) & 0xff, col & 0xff)\n                else:\n                    q = None if code >= 100 else val\n                    color_changes[w] = q\n            code += 1\n        if color_changes:\n            self.change_colors(color_changes)\n\n    def set_color_table_color(self, code: int, value: str) -> None:\n        cp = self.screen.color_profile\n        if code == 4:\n            changed = False\n            for c, val in parse_color_set(value):\n                if val is None:  # color query\n                    qc = self.screen.color_profile.as_color((c << 8) | 1)\n                    assert qc is not None\n                    self.report_color(f'4;{c}', qc.red, qc.green, qc.blue)\n                else:\n                    changed = True\n                    cp.set_color(c, val)\n            if changed:\n                self.refresh()\n        elif code == 104:\n            if not value.strip():\n                cp.reset_color_table()\n            else:\n                for x in value.split(';'):\n                    try:\n                        y = int(x)\n                    except Exception:\n                        continue\n                    if 0 <= y <= 255:\n                        cp.reset_color(y)\n            self.refresh()\n\n    def request_capabilities(self, q: str) -> None:\n        for result in get_capabilities(q, get_options()):\n            self.screen.send_escape_code_to_child(DCS, result)\n\n    def handle_remote_cmd(self, cmd: str) -> None:\n        get_boss().handle_remote_cmd(cmd, self)\n\n    def handle_remote_echo(self, msg: str) -> None:\n        from base64 import standard_b64decode\n        data = standard_b64decode(msg)\n        self.write_to_child(data)\n\n    def handle_remote_ssh(self, msg: str) -> None:\n        from kittens.ssh.main import get_ssh_data\n        for line in get_ssh_data(msg, f'{os.getpid()}-{self.id}'):\n            self.write_to_child(line)\n\n    def handle_kitten_result(self, msg: str) -> None:\n        import base64\n        self.kitten_result = json.loads(base64.b85decode(msg))\n        for processor in self.kitten_result_processors:\n            try:\n                processor(self, self.kitten_result)\n            except Exception:\n                import traceback\n                traceback.print_exc()\n\n    def add_kitten_result_processor(self, callback: Callable[['Window', Any], None]) -> None:\n        self.kitten_result_processors.append(callback)\n\n    def handle_overlay_ready(self, msg: str) -> None:\n        boss = get_boss()\n        tab = boss.tab_for_window(self)\n        if tab is not None:\n            tab.move_window_to_top_of_group(self)\n\n    def append_remote_data(self, msg: str) -> str:\n        if not msg:\n            cdata = ''.join(self.current_remote_data)\n            self.current_remote_data = []\n            return cdata\n        num, rest = msg.split(':', 1)\n        max_size = get_options().clipboard_max_size * 1024 * 1024\n        if num == '0' or sum(map(len, self.current_remote_data)) > max_size:\n            self.current_remote_data = []\n        self.current_remote_data.append(rest)\n        return ''\n\n    def handle_remote_edit(self, msg: str) -> None:\n        cdata = self.append_remote_data(msg)\n        if cdata:\n            from .launch import remote_edit\n            remote_edit(cdata, self)\n\n    def handle_remote_clone(self, msg: str) -> None:\n        cdata = self.append_remote_data(msg)\n        if cdata:\n            ac = get_options().allow_cloning\n            if ac == 'ask':\n                get_boss().confirm(_(\n                    'A program running in this window wants to clone it into another window.'\n                    ' Allow it do so, once?'),\n                    partial(self.handle_remote_clone_confirmation, cdata), window=self,\n                )\n            elif ac in ('yes', 'y', 'true'):\n                self.handle_remote_clone_confirmation(cdata, True)\n\n    def handle_remote_clone_confirmation(self, cdata: str, confirmed: bool) -> None:\n        if confirmed:\n            from .launch import clone_and_launch\n            clone_and_launch(cdata, self)\n\n    def handle_remote_askpass(self, msg: str) -> None:\n        from .shm import SharedMemory\n        with SharedMemory(name=msg, readonly=True) as shm:\n            shm.seek(1)\n            data = json.loads(shm.read_data_with_size())\n\n        def callback(ans: Any) -> None:\n            data = json.dumps(ans)\n            with SharedMemory(name=msg) as shm:\n                shm.seek(1)\n                shm.write_data_with_size(data)\n                shm.flush()\n                shm.seek(0)\n                shm.write(b'\\x01')\n\n        message: str = data['message']\n        if data['type'] == 'confirm':\n            get_boss().confirm(\n                message, callback, window=self, confirm_on_cancel=bool(data.get('confirm_on_cancel')),\n                confirm_on_accept=bool(data.get('confirm_on_accept', True)))\n        elif data['type'] == 'choose':\n            get_boss().choose(\n                message, callback, *data['choices'], window=self, default=data.get('default', ''))\n        elif data['type'] == 'get_line':\n            get_boss().get_line(\n                message, callback, window=self, is_password=bool(data.get('is_password')), prompt=data.get('prompt', '> '))\n        else:\n            log_error(f'Ignoring ask request with unknown type: {data[\"type\"]}')\n\n    def handle_remote_print(self, msg: str) -> None:\n        text = process_remote_print(msg)\n        print(text, end='', file=sys.stderr)\n        sys.stderr.flush()\n\n    def send_cmd_response(self, response: Any) -> None:\n        self.screen.send_escape_code_to_child(DCS, '@kitty-cmd' + json.dumps(response))\n\n    def file_transmission(self, data: str) -> None:\n        self.file_transmission_control.handle_serialized_command(data)\n\n    def clipboard_control(self, data: str, is_partial: bool = False) -> None:\n        where, text = data.partition(';')[::2]\n        if is_partial:\n            if self.clipboard_pending is None:\n                self.clipboard_pending = ClipboardPending(where, text)\n            else:\n                self.clipboard_pending = self.clipboard_pending._replace(data=self.clipboard_pending[1] + text)\n                limit = get_options().clipboard_max_size\n                if limit and len(self.clipboard_pending.data) > limit * 1024 * 1024:\n                    log_error('Discarding part of too large OSC 52 paste request')\n                    self.clipboard_pending = self.clipboard_pending._replace(data='', truncated=True)\n            return\n\n        if not where:\n            if self.clipboard_pending is not None:\n                text = self.clipboard_pending.data + text\n                where = self.clipboard_pending.where\n                try:\n                    if self.clipboard_pending.truncated:\n                        return\n                finally:\n                    self.clipboard_pending = None\n            else:\n                where = 's0'\n        cc = get_options().clipboard_control\n        if text == '?':\n            response = None\n            if 's' in where or 'c' in where:\n                if 'read-clipboard-ask' in cc:\n                    return self.ask_to_read_clipboard(False)\n                response = get_clipboard_string() if 'read-clipboard' in cc else ''\n                loc = 'c'\n            elif 'p' in where:\n                if 'read-primary-ask' in cc:\n                    return self.ask_to_read_clipboard(True)\n                response = get_primary_selection() if 'read-primary' in cc else ''\n                loc = 'p'\n            response = response or ''\n            self.send_osc52(loc, response or '')\n\n        else:\n            from base64 import standard_b64decode\n            try:\n                text = standard_b64decode(text).decode('utf-8')\n            except Exception:\n                text = ''\n\n            if 's' in where or 'c' in where:\n                if 'write-clipboard' in cc:\n                    set_clipboard_string(text)\n            if 'p' in where:\n                if 'write-primary' in cc:\n                    set_primary_selection(text)\n        self.clipboard_pending = None\n\n    def send_osc52(self, loc: str, response: str) -> None:\n        from base64 import standard_b64encode\n        self.screen.send_escape_code_to_child(OSC, '52;{};{}'.format(\n            loc, standard_b64encode(response.encode('utf-8')).decode('ascii')))\n\n    def ask_to_read_clipboard(self, primary: bool = False) -> None:\n        if self.current_clipboard_read_ask is not None:\n            self.current_clipboard_read_ask = primary\n            return\n        self.current_clipboard_read_ask = primary\n        get_boss().confirm(_(\n            'A program running in this window wants to read from the system clipboard.'\n            ' Allow it do so, once?'),\n            self.handle_clipboard_confirmation, window=self,\n        )\n\n    def handle_clipboard_confirmation(self, confirmed: bool) -> None:\n        try:\n            loc = 'p' if self.current_clipboard_read_ask else 'c'\n            response = ''\n            if confirmed:\n                response = get_primary_selection() if self.current_clipboard_read_ask else get_clipboard_string()\n            self.send_osc52(loc, response)\n        finally:\n            self.current_clipboard_read_ask = None\n\n    def manipulate_title_stack(self, pop: bool, title: str, icon: Any) -> None:\n        if title:\n            if pop:\n                if self.title_stack:\n                    self.child_title = self.title_stack.pop()\n                    self.title_updated()\n            else:\n                if self.child_title:\n                    self.title_stack.append(self.child_title)\n    # }}}\n\n    # mouse actions {{{\n    @ac('mouse', '''\n        Handle a mouse click\n\n        Try to perform the specified actions one after the other till one of them is successful.\n        Supported actions are::\n\n            selection - check for a selection and if one exists abort processing\n            link - if a link exists under the mouse, click it\n            prompt - if the mouse click happens at a shell prompt move the cursor to the mouse location\n\n        For examples, see :ref:`conf-kitty-mouse.mousemap`\n        ''')\n    def mouse_handle_click(self, *actions: str) -> None:\n        for a in actions:\n            if a == 'selection':\n                if self.screen.has_selection():\n                    break\n            if a == 'link':\n                if click_mouse_url(self.os_window_id, self.tab_id, self.id):\n                    break\n            if a == 'prompt':\n                # Do not send move cursor events too soon after the window is\n                # focused, this is because there are people that click on\n                # windows and start typing immediately and the cursor event\n                # can interfere with that. See https://github.com/kovidgoyal/kitty/issues/4128\n                if monotonic() - self.last_focused_at < 1.5 * get_click_interval():\n                    return\n                if move_cursor_to_mouse_if_in_prompt(self.os_window_id, self.tab_id, self.id):\n                    self.screen.ignore_bells_for(1)\n                    break\n\n    @ac('mouse', 'Click the URL under the mouse')\n    def mouse_click_url(self) -> None:\n        self.mouse_handle_click('link')\n\n    @ac('mouse', 'Click the URL under the mouse only if the screen has no selection')\n    def mouse_click_url_or_select(self) -> None:\n        self.mouse_handle_click('selection', 'link')\n\n    @ac('mouse', '''\n        Manipulate the selection based on the current mouse position\n\n        For examples, see :ref:`conf-kitty-mouse.mousemap`\n        ''')\n    def mouse_selection(self, code: int) -> None:\n        mouse_selection(self.os_window_id, self.tab_id, self.id, code, self.current_mouse_event_button)\n\n    @ac('mouse', 'Paste the current primary selection')\n    def paste_selection(self) -> None:\n        txt = get_boss().current_primary_selection()\n        if txt:\n            self.paste_with_actions(txt)\n\n    @ac('mouse', 'Paste the current primary selection or the clipboard if no selection is present')\n    def paste_selection_or_clipboard(self) -> None:\n        txt = get_boss().current_primary_selection_or_clipboard()\n        if txt:\n            self.paste_with_actions(txt)\n\n    @ac('mouse', '''\n        Select clicked command output\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def mouse_select_command_output(self) -> None:\n        click_mouse_cmd_output(self.os_window_id, self.tab_id, self.id, True)\n\n    @ac('mouse', '''\n        Show clicked command output in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def mouse_show_command_output(self) -> None:\n        if click_mouse_cmd_output(self.os_window_id, self.tab_id, self.id, False):\n            self.show_cmd_output(CommandOutput.last_visited, 'Clicked command output')\n    # }}}\n\n    def text_for_selection(self, as_ansi: bool = False) -> str:\n        sts = get_options().strip_trailing_spaces\n        strip_trailing_spaces = sts == 'always' or (sts == 'smart' and not self.screen.is_rectangle_select())\n        lines = self.screen.text_for_selection(as_ansi, strip_trailing_spaces)\n        return ''.join(lines)\n\n    def call_watchers(self, which: Iterable[Watcher], data: Dict[str, Any]) -> None:\n        boss = get_boss()\n        for w in which:\n            try:\n                w(boss, self, data)\n            except Exception:\n                import traceback\n                traceback.print_exc()\n\n    def destroy(self) -> None:\n        self.call_watchers(self.watchers.on_close, {})\n        self.destroyed = True\n        del self.kitten_result_processors\n        if hasattr(self, 'screen'):\n            if self.is_active and self.os_window_id == current_os_window():\n                # Cancel IME composition when window is destroyed\n                update_ime_position_for_window(self.id, False, -1)\n            # Remove cycles so that screen is de-allocated immediately\n            self.screen.reset_callbacks()\n            del self.screen\n\n    def as_text(\n        self,\n        as_ansi: bool = False,\n        add_history: bool = False,\n        add_wrap_markers: bool = False,\n        alternate_screen: bool = False,\n        add_cursor: bool = False\n    ) -> str:\n        return as_text(self.screen, as_ansi, add_history, add_wrap_markers, alternate_screen, add_cursor)\n\n    def cmd_output(self, which: CommandOutput = CommandOutput.last_run, as_ansi: bool = False, add_wrap_markers: bool = False) -> str:\n        return cmd_output(self.screen, which, as_ansi, add_wrap_markers)\n\n    def get_cwd_of_child(self, oldest: bool = False) -> Optional[str]:\n        return self.child.get_foreground_cwd(oldest) or self.child.current_cwd\n\n    @property\n    def cwd_of_child(self) -> Optional[str]:\n        return self.get_cwd_of_child()\n\n    @property\n    def child_is_remote(self) -> bool:\n        for p in self.child.foreground_processes:\n            q = list(p['cmdline'] or ())\n            if q and q[0].lower() == 'ssh':\n                return True\n        return False\n\n    def ssh_kitten_cmdline(self) -> List[str]:\n        from kittens.ssh.utils import is_kitten_cmdline\n        for p in self.child.foreground_processes:\n            q = list(p['cmdline'] or ())\n            if is_kitten_cmdline(q):\n                return q\n        return []\n\n    def pipe_data(self, text: str, has_wrap_markers: bool = False) -> PipeData:\n        text = text or ''\n        if has_wrap_markers:\n            text = text.replace('\\r\\n', '\\n').replace('\\r', '\\n')\n        lines = text.count('\\n')\n        input_line_number = (lines - (self.screen.lines - 1) - self.screen.scrolled_by)\n        return {\n            'input_line_number': input_line_number,\n            'scrolled_by': self.screen.scrolled_by,\n            'cursor_x': self.screen.cursor.x + 1,\n            'cursor_y': self.screen.cursor.y + 1,\n            'lines': self.screen.lines,\n            'columns': self.screen.columns,\n            'text': text\n        }\n\n    def set_logo(self, path: str, position: str = '', alpha: float = -1) -> None:\n        path = resolve_custom_file(path) if path else ''\n        set_window_logo(self.os_window_id, self.tab_id, self.id, path, position or '', alpha)\n\n    def paste_with_actions(self, text: str) -> None:\n        if self.destroyed or not text:\n            return\n        opts = get_options()\n        if 'filter' in opts.paste_actions:\n            text = load_paste_filter()(text)\n            if not text:\n                return\n        if 'quote-urls-at-prompt' in opts.paste_actions and self.at_prompt:\n            prefixes = '|'.join(opts.url_prefixes)\n            m = re.match(f'({prefixes}):(.+)', text)\n            if m is not None:\n                scheme, rest = m.group(1), m.group(2)\n                if rest.startswith('//') or scheme in ('mailto', 'irc'):\n                    import shlex\n                    text = shlex.quote(text)\n        btext = text.encode('utf-8')\n        if 'confirm' in opts.paste_actions:\n            msg = ''\n            limit = 16 * 1024\n            if not self.screen.in_bracketed_paste_mode:\n                msg = _('Pasting text into shells that do not support bracketed paste can be dangerous.')\n            elif len(btext) > limit:\n                msg = _('Pasting very large amounts of text ({} bytes) can be slow.').format(len(btext))\n            if msg:\n                get_boss().confirm(msg + _(' Are you sure?'), partial(self.handle_paste_confirmation, btext), window=self)\n                return\n        self.paste_text(btext)\n\n    def handle_paste_confirmation(self, btext: bytes, confirmed: bool) -> None:\n        if confirmed:\n            self.paste_text(btext)\n\n    def paste_bytes(self, text: Union[str, bytes]) -> None:\n        # paste raw bytes without any processing\n        if isinstance(text, str):\n            text = text.encode('utf-8')\n        self.screen.paste_bytes(text)\n\n    def paste_text(self, text: Union[str, bytes]) -> None:\n        if text and not self.destroyed:\n            if isinstance(text, str):\n                text = text.encode('utf-8')\n            if self.screen.in_bracketed_paste_mode:\n                while True:\n                    new_text = text.replace(b'\\033[201~', b'').replace(b'\\x9b201~', b'')\n                    if len(text) == len(new_text):\n                        break\n                    text = new_text\n            else:\n                # Workaround for broken editors like nano that cannot handle\n                # newlines in pasted text see https://github.com/kovidgoyal/kitty/issues/994\n                text = text.replace(b'\\r\\n', b'\\n').replace(b'\\n', b'\\r')\n            self.screen.paste(text)\n\n    def clear_screen(self, reset: bool = False, scrollback: bool = False) -> None:\n        self.screen.cursor.x = self.screen.cursor.y = 0\n        if reset:\n            self.screen.reset()\n        else:\n            self.screen.erase_in_display(3 if scrollback else 2, False)\n\n    # actions {{{\n\n    @ac('cp', 'Show scrollback in a pager like less')\n    def show_scrollback(self) -> None:\n        text = self.as_text(as_ansi=True, add_history=True, add_wrap_markers=True)\n        data = self.pipe_data(text, has_wrap_markers=True)\n        cursor_on_screen = self.screen.scrolled_by < self.screen.lines - self.screen.cursor.y\n        get_boss().display_scrollback(self, data['text'], data['input_line_number'], report_cursor=cursor_on_screen)\n\n    def show_cmd_output(self, which: CommandOutput, title: str = 'Command output', as_ansi: bool = True, add_wrap_markers: bool = True) -> None:\n        text = self.cmd_output(which, as_ansi=as_ansi, add_wrap_markers=add_wrap_markers)\n        text = text.replace('\\r\\n', '\\n').replace('\\r', '\\n')\n        get_boss().display_scrollback(self, text, title=title, report_cursor=False)\n\n    @ac('cp', '''\n        Show output from the first shell command on screen in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def show_first_command_output_on_screen(self) -> None:\n        self.show_cmd_output(CommandOutput.first_on_screen, 'First command output on screen')\n\n    @ac('cp', '''\n        Show output from the last shell command in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def show_last_command_output(self) -> None:\n        self.show_cmd_output(CommandOutput.last_run, 'Last command output')\n\n    @ac('cp', '''\n        Show the first command output below the last scrolled position via scroll_to_prompt\n        or the last mouse clicked command output in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def show_last_visited_command_output(self) -> None:\n        self.show_cmd_output(CommandOutput.last_visited, 'Last visited command output')\n\n    @ac('cp', '''\n        Show the last non-empty output from a shell command in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def show_last_non_empty_command_output(self) -> None:\n        self.show_cmd_output(CommandOutput.last_non_empty, 'Last non-empty command output')\n\n    @ac('cp', 'Paste the specified text into the current window')\n    def paste(self, text: str) -> None:\n        self.paste_with_actions(text)\n\n    @ac('cp', 'Copy the selected text from the active window to the clipboard')\n    def copy_to_clipboard(self) -> None:\n        text = self.text_for_selection()\n        if text:\n            set_clipboard_string(text)\n\n    @ac('cp', 'Copy the selected text from the active window to the clipboard with ANSI formatting codes')\n    def copy_ansi_to_clipboard(self) -> None:\n        text = self.text_for_selection(as_ansi=True)\n        if text:\n            set_clipboard_string(text)\n\n    def encoded_key(self, key_event: KeyEvent) -> bytes:\n        return encode_key_for_tty(\n            key=key_event.key, shifted_key=key_event.shifted_key, alternate_key=key_event.alternate_key,\n            mods=key_event.mods, action=key_event.action, text=key_event.text,\n            key_encoding_flags=self.screen.current_key_encoding_flags(),\n            cursor_key_mode=self.screen.cursor_key_mode,\n        ).encode('ascii')\n\n    @ac('cp', 'Copy the selected text from the active window to the clipboard, if no selection, send SIGINT (aka :kbd:`ctrl+c`)')\n    def copy_or_interrupt(self) -> None:\n        text = self.text_for_selection()\n        if text:\n            set_clipboard_string(text)\n        else:\n            self.scroll_end()\n            self.write_to_child(self.encoded_key(KeyEvent(key=ord('c'), mods=GLFW_MOD_CONTROL)))\n\n    @ac('cp', 'Copy the selected text from the active window to the clipboard and clear selection, if no selection, send SIGINT (aka :kbd:`ctrl+c`)')\n    def copy_and_clear_or_interrupt(self) -> None:\n        self.copy_or_interrupt()\n        self.screen.clear_selection()\n\n    @ac('cp', 'Pass the selected text from the active window to the specified program')\n    def pass_selection_to_program(self, *args: str) -> None:\n        cwd = self.cwd_of_child\n        text = self.text_for_selection()\n        if text:\n            if args:\n                open_cmd(args, text, cwd=cwd)\n            else:\n                open_url(text, cwd=cwd)\n\n    @ac('cp', 'Clear the current selection')\n    def clear_selection(self) -> None:\n        self.screen.clear_selection()\n\n    @ac('sc', 'Scroll up by one line')\n    def scroll_line_up(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_LINE, True)\n\n    @ac('sc', 'Scroll down by one line')\n    def scroll_line_down(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_LINE, False)\n\n    @ac('sc', 'Scroll up by one page')\n    def scroll_page_up(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_PAGE, True)\n\n    @ac('sc', 'Scroll down by one page')\n    def scroll_page_down(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_PAGE, False)\n\n    @ac('sc', 'Scroll to the top of the scrollback buffer')\n    def scroll_home(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_FULL, True)\n\n    @ac('sc', 'Scroll to the bottom of the scrollback buffer')\n    def scroll_end(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_FULL, False)\n\n    @ac('sc', '''\n        Scroll to the previous/next shell command prompt\n        Allows easy jumping from one command to the next. Requires working\n        :ref:`shell_integration`. Takes a single, optional, number as argument which is\n        the number of prompts to jump, negative values jump up and positive values jump down.\n        A value of zero will jump to the last prompt visited by this action.\n        For example::\n\n            map ctrl+p scroll_to_prompt -1  # jump to previous\n            map ctrl+n scroll_to_prompt 1   # jump to next\n            map ctrl+o scroll_to_prompt 0   # jump to last visited\n        ''')\n    def scroll_to_prompt(self, num_of_prompts: int = -1) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll_to_prompt(num_of_prompts)\n\n    @ac('sc', 'Scroll prompt to the top of the screen, filling screen with empty lines')\n    def scroll_prompt_to_top(self, clear_scrollback: bool = False) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll_until_cursor_prompt()\n            if clear_scrollback:\n                self.screen.clear_scrollback()\n            elif self.screen.scrolled_by > 0:\n                self.screen.scroll(SCROLL_FULL, False)\n\n    @ac('sc', 'Scroll prompt to the bottom of the screen, filling in extra lines from the scrollback buffer')\n    def scroll_prompt_to_bottom(self) -> None:\n        self.screen.scroll_prompt_to_bottom()\n\n    @ac('mk', 'Toggle the current marker on/off')\n    def toggle_marker(self, ftype: str, spec: Union[str, Tuple[Tuple[int, str], ...]], flags: int) -> None:\n        from .marks import marker_from_spec\n        key = ftype, spec\n        if key == self.current_marker_spec:\n            self.remove_marker()\n            return\n        self.screen.set_marker(marker_from_spec(ftype, spec, flags))\n        self.current_marker_spec = key\n\n    def set_marker(self, spec: Union[str, Sequence[str]]) -> None:\n        from .marks import marker_from_spec\n        from .options.utils import parse_marker_spec, toggle_marker\n        if isinstance(spec, str):\n            func, (ftype, spec_, flags) = toggle_marker('toggle_marker', spec)\n        else:\n            ftype, spec_, flags = parse_marker_spec(spec[0], spec[1:])\n        key = ftype, spec_\n        self.screen.set_marker(marker_from_spec(ftype, spec_, flags))\n        self.current_marker_spec = key\n\n    @ac('mk', 'Remove a previously created marker')\n    def remove_marker(self) -> None:\n        if self.current_marker_spec is not None:\n            self.screen.set_marker()\n            self.current_marker_spec = None\n\n    @ac('mk', 'Scroll to the next or previous mark of the specified type')\n    def scroll_to_mark(self, prev: bool = True, mark: int = 0) -> None:\n        self.screen.scroll_to_next_mark(mark, prev)\n\n    @ac('misc', '''\n        Send the specified SIGNAL to the foreground process in the active window\n\n        For example::\n\n            map f1 signal_child SIGTERM\n        ''')\n    def signal_child(self, *signals: int) -> None:\n        pid = self.child.pid_for_cwd\n        if pid is not None:\n            for sig in signals:\n                os.kill(pid, sig)\n\n    @ac('misc', '''\n    Display the specified kitty documentation, preferring a local copy, if found.\n\n    For example::\n\n        # show the config docs\n        map f1 show_kitty_doc conf\n        # show the ssh kitten docs\n        map f1 show_kitty_doc kittens/ssh\n    ''')\n    def show_kitty_doc(self, which: str = '') -> None:\n        url = docs_url(which)\n        get_boss().open_url(url)\n    # }}}\n", "#!/usr/bin/env python3\n# License: GPL v3 Copyright: 2016, Kovid Goyal <kovid at kovidgoyal.net>\n\nimport os\nimport sys\nimport tempfile\n\nfrom kitty.config import build_ansi_color_table, defaults\nfrom kitty.fast_data_types import (\n    Color, ColorProfile, Cursor as C, HistoryBuf, LineBuf,\n    parse_input_from_terminal, strip_csi, truncate_point_for_length, wcswidth,\n    wcwidth\n)\nfrom kitty.rgb import to_color\nfrom kitty.utils import is_path_in_temp_dir, sanitize_title\n\nfrom . import BaseTest, filled_cursor, filled_history_buf, filled_line_buf\n\n\ndef create_lbuf(*lines):\n    maxw = max(map(len, lines))\n    ans = LineBuf(len(lines), maxw)\n    prev_full_length = False\n    for i, l0 in enumerate(lines):\n        ans.line(i).set_text(l0, 0, len(l0), C())\n        ans.set_continued(i, prev_full_length)\n        prev_full_length = len(l0) == maxw\n    return ans\n\n\nclass TestDataTypes(BaseTest):\n\n    def test_to_color(self):\n        for x in 'xxx #12 #1234 rgb:a/b'.split():\n            self.assertIsNone(to_color(x))\n\n        def c(spec, r=0, g=0, b=0, a=0):\n            c = to_color(spec)\n            self.ae(c.red, r)\n            self.ae(c.green, g)\n            self.ae(c.blue, b)\n            self.ae(c.alpha, a)\n\n        c('#eee', 0xee, 0xee, 0xee)\n        c('#234567', 0x23, 0x45, 0x67)\n        c('#abcabcdef', 0xab, 0xab, 0xde)\n        c('rgb:e/e/e', 0xee, 0xee, 0xee)\n        c('rgb:23/45/67', 0x23, 0x45, 0x67)\n        c('rgb:abc/abc/def', 0xab, 0xab, 0xde)\n        c('red', 0xff)\n        self.ae(int(Color(1, 2, 3)), 0x10203)\n        base = Color(12, 12, 12)\n        a = Color(23, 23, 23)\n        b = Color(100, 100, 100)\n        self.assertLess(base.contrast(a), base.contrast(b))\n        self.ae(Color(1, 2, 3).as_sgr, ':2:1:2:3')\n        self.ae(Color(1, 2, 3).as_sharp, '#010203')\n        self.ae(Color(1, 2, 3, 4).as_sharp, '#04010203')\n        self.ae(Color(1, 2, 3, 4).rgb, 0x10203)\n\n    def test_linebuf(self):\n        old = filled_line_buf(2, 3, filled_cursor())\n        new = LineBuf(1, 3)\n        new.copy_old(old)\n        self.ae(new.line(0), old.line(1))\n        new.clear()\n        self.ae(str(new.line(0)), '')\n        old.set_attribute('reverse', False)\n        for y in range(old.ynum):\n            for x in range(old.xnum):\n                l0 = old.line(y)\n                c = l0.cursor_from(x)\n                self.assertFalse(c.reverse)\n                self.assertTrue(c.bold)\n        self.assertFalse(old.is_continued(0))\n        old.set_continued(0, True)\n        self.assertTrue(old.is_continued(0))\n        self.assertFalse(old.is_continued(1))\n\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb2 = LineBuf(5, 5)\n        lb2.copy_old(lb)\n        lb.index(0, 4)\n        for i in range(0, 4):\n            self.ae(lb.line(i), lb2.line(i + 1))\n        self.ae(lb.line(4), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.index(1, 3)\n        self.ae(lb.line(0), lb2.line(0))\n        self.ae(lb.line(1), lb2.line(2))\n        self.ae(lb.line(2), lb2.line(3))\n        self.ae(lb.line(3), lb2.line(1))\n        self.ae(lb.line(4), lb2.line(4))\n        self.ae(lb.create_line_copy(1), lb2.line(2))\n        l2 = lb.create_line_copy(2)\n        lb.copy_line_to(1, l2)\n        self.ae(l2, lb2.line(2))\n        lb.clear_line(0)\n        self.ae(lb.line(0), LineBuf(1, lb.xnum).create_line_copy(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.reverse_index(0, 4)\n        self.ae(lb.line(0), lb2.line(4))\n        for i in range(1, 5):\n            self.ae(lb.line(i), lb2.line(i - 1))\n\n        lb = filled_line_buf(5, 5, filled_cursor())\n        clb = filled_line_buf(5, 5, filled_cursor())\n        lb2 = LineBuf(1, 5)\n        lb.insert_lines(2, 1, lb.ynum - 1)\n        self.ae(lb.line(0), clb.line(0))\n        self.ae(lb.line(3), clb.line(1))\n        self.ae(lb.line(4), clb.line(2))\n        self.ae(lb.line(1), lb2.line(0))\n        self.ae(lb.line(2), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.insert_lines(10, 0, lb.ynum - 1)\n        for i in range(lb.ynum):\n            self.ae(lb.line(i), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.insert_lines(10, 1, lb.ynum - 1)\n        self.ae(lb.line(0), clb.line(0))\n        for i in range(1, lb.ynum):\n            self.ae(lb.line(i), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.insert_lines(1, 1, 3)\n        self.ae(lb.line(0), clb.line(0))\n        self.ae(lb.line(1), lb2.line(0))\n        self.ae(lb.line(2), clb.line(1))\n        self.ae(lb.line(3), clb.line(2))\n        self.ae(lb.line(4), clb.line(4))\n\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.delete_lines(2, 1, lb.ynum - 1)\n        self.ae(lb.line(0), clb.line(0))\n        self.ae(lb.line(1), clb.line(3))\n        self.ae(lb.line(2), clb.line(4))\n        self.ae(lb.line(3), lb2.line(0))\n        self.ae(lb.line(4), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.delete_lines(10, 0, lb.ynum - 1)\n        for i in range(lb.ynum):\n            self.ae(lb.line(i), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.delete_lines(10, 1, lb.ynum - 1)\n        self.ae(lb.line(0), clb.line(0))\n        for i in range(1, lb.ynum):\n            self.ae(lb.line(i), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.delete_lines(1, 1, 3)\n        self.ae(lb.line(0), clb.line(0))\n        self.ae(lb.line(1), clb.line(2))\n        self.ae(lb.line(2), clb.line(3))\n        self.ae(lb.line(3), lb2.line(0))\n        self.ae(lb.line(4), clb.line(4))\n\n        lb = filled_line_buf(5, 5, filled_cursor())\n        l0 = lb.line(0)\n        l0.add_combining_char(1, '\\u0300')\n        l0.clear_text(1, 2)\n        self.ae(str(l0), '0  00')\n        self.assertEqualAttributes(l0.cursor_from(1), l0.cursor_from(0))\n\n        lb = filled_line_buf(10, 10, filled_cursor())\n        lb.clear()\n        lb2 = LineBuf(lb.ynum, lb.ynum)\n        for i in range(lb.ynum):\n            self.ae(lb.line(i), lb2.line(i))\n\n    def test_line(self):\n        lb = LineBuf(2, 3)\n        for y in range(lb.ynum):\n            line = lb.line(y)\n            self.ae(str(line), '')\n            for x in range(lb.xnum):\n                self.ae(line[x], '\\0')\n        with self.assertRaises(IndexError):\n            lb.line(lb.ynum)\n        with self.assertRaises(IndexError):\n            lb.line(0)[lb.xnum]\n        l0 = lb.line(0)\n        l0.set_text(' ', 0, len(' '), C())\n        l0.add_combining_char(0, '\\u0300')\n        self.ae(l0[0], ' \\u0300')\n        l0.add_combining_char(0, '\\U000e0100')\n        self.ae(l0[0], ' \\u0300\\U000e0100')\n        l0.add_combining_char(0, '\\u0302')\n        self.ae(l0[0], ' \\u0300\\U000e0100\\u0302')\n        l0.add_combining_char(0, '\\u0301')\n        self.ae(l0[0], ' \\u0300\\U000e0100\\u0301')\n        self.ae(l0[1], '\\0')\n        self.ae(str(l0), ' \\u0300\\U000e0100\\u0301')\n        t = 'Testing with simple text'\n        lb = LineBuf(2, len(t))\n        l0 = lb.line(0)\n        l0.set_text(t, 0, len(t), C())\n        self.ae(str(l0), t)\n        l0.set_text('a', 0, 1, C())\n        self.assertEqual(str(l0), 'a' + t[1:])\n\n        c = C(3, 5)\n        c.bold = c.italic = c.reverse = c.strikethrough = c.dim = True\n        c.fg = c.bg = c.decoration_fg = 0x0101\n        self.ae(c, c)\n        c2, c3 = c.copy(), c.copy()\n        self.ae(repr(c), repr(c2))\n        self.ae(c, c2)\n        c2.bold = False\n        self.assertNotEqual(c, c2)\n        l0.set_text(t, 0, len(t), C())\n        l0.apply_cursor(c2, 3)\n        self.assertEqualAttributes(c2, l0.cursor_from(3))\n        l0.apply_cursor(c2, 0, len(l0))\n        for i in range(len(l0)):\n            self.assertEqualAttributes(c2, l0.cursor_from(i))\n        l0.apply_cursor(c3, 0)\n        self.assertEqualAttributes(c3, l0.cursor_from(0))\n        l0.copy_char(0, l0, 1)\n        self.assertEqualAttributes(c3, l0.cursor_from(1))\n\n        t = '0123456789'\n        lb = LineBuf(1, len(t))\n        l3 = lb.line(0)\n        l3.set_text(t, 0, len(t), C())\n        self.ae(t, str(l3))\n        l3.right_shift(4, 2)\n        self.ae('0123454567', str(l3))\n        l3.set_text(t, 0, len(t), C())\n        l3.right_shift(0, 0)\n        self.ae(t, str(l3))\n        l3.right_shift(0, 1)\n        self.ae(str(l3), '0' + t[:-1])\n        l3.set_text(t, 0, len(t), C())\n        l3.left_shift(0, 2)\n        self.ae(str(l3), t[2:] + '89')\n        l3.set_text(t, 0, len(t), C())\n        l3.left_shift(7, 3)\n        self.ae(str(l3), t)\n\n        l3.set_text(t, 0, len(t), C())\n        q = C()\n        q.bold = q.italic = q.reverse = q.strikethrough = c.dim = True\n        q.decoration = 2\n        c = C()\n        c.x = 3\n        l3.set_text('axyb', 1, 2, c)\n        self.ae(str(l3), '012xy56789')\n        l3.set_char(0, 'x', 1, q)\n        self.assertEqualAttributes(l3.cursor_from(0), q)\n\n    def test_url_at(self):\n        self.set_options()\n\n        def create(t):\n            lb = create.lb = LineBuf(1, len(t))\n            lf = lb.line(0)\n            lf.set_text(t, 0, len(t), C())\n            return lf\n\n        l0 = create('file:///etc/test')\n        self.ae(l0.url_start_at(0), 0)\n\n        for trail in '.,\\\\':\n            lx = create(\"http://xyz.com\" + trail)\n            self.ae(lx.url_end_at(0), len(lx) - 2)\n        for trail in ')}]>':\n            lx = create(\"http://xyz.com\" + trail)\n            self.ae(lx.url_end_at(0), len(lx) - 1)\n        l0 = create(\"ftp://abc/\")\n        self.ae(l0.url_end_at(0), len(l0) - 1)\n        l2 = create(\"http://-abcd] \")\n        self.ae(l2.url_end_at(0), len(l2) - 2)\n        l3 = create(\"http://ab.de           \")\n        self.ae(l3.url_start_at(4), 0)\n        self.ae(l3.url_start_at(5), 0)\n\n        def lspace_test(n, scheme='http'):\n            lf = create(' ' * n + scheme + '://acme.com')\n            for i in range(0, n):\n                self.ae(lf.url_start_at(i), len(lf))\n            for i in range(n, len(lf)):\n                self.ae(lf.url_start_at(i), n)\n        for i in range(7):\n            for scheme in 'http https ftp file'.split():\n                lspace_test(i, scheme)\n        l3 = create('b https://testing.me a')\n        for s in (0, 1, len(l3) - 1, len(l3) - 2):\n            self.ae(l3.url_start_at(s), len(l3), 'failed with start at: %d' % s)\n        for s in range(2, len(l3) - 2):\n            self.ae(l3.url_start_at(s), 2, 'failed with start at: %d (%s)' % (s, str(l3)[s:]))\n\n        def no_url(t):\n            lf = create(t)\n            for s in range(len(lf)):\n                self.ae(lf.url_start_at(s), len(lf))\n        no_url('https:// testing.me a')\n        no_url('h ttp://acme.com')\n        no_url('http: //acme.com')\n        no_url('http:/ /acme.com')\n\n        l4 = create(' xxxxxtekljhgdkjgd')\n        self.ae(l4.url_end_at(0), 0)\n\n        for trail in '/-&':\n            l4 = create('http://a.b?q=1' + trail)\n            self.ae(l4.url_end_at(1), len(l4) - 1)\n\n        l4 = create('http://a.b.')\n        self.ae(l4.url_end_at(0), len(l4) - 2)\n        self.ae(l4.url_end_at(0, 0, True), len(l4) - 1)\n\n    def rewrap(self, lb, lb2):\n        hb = HistoryBuf(lb2.ynum, lb2.xnum)\n        cy = lb.rewrap(lb2, hb)\n        return hb, cy[1]\n\n    def test_rewrap_simple(self):\n        ' Same width buffers '\n        lb = filled_line_buf(5, 5)\n        lb2 = LineBuf(lb.ynum, lb.xnum)\n        self.rewrap(lb, lb2)\n        for i in range(lb.ynum):\n            self.ae(lb2.line(i), lb.line(i))\n        lb2 = LineBuf(8, 5)\n        cy = self.rewrap(lb, lb2)[1]\n        self.ae(cy, 5)\n        for i in range(lb.ynum):\n            self.ae(lb2.line(i), lb.line(i))\n        empty = LineBuf(1, lb2.xnum)\n        for i in range(lb.ynum, lb2.ynum):\n            self.ae(str(lb2.line(i)), str(empty.line(0)))\n        lb2 = LineBuf(3, 5)\n        cy = self.rewrap(lb, lb2)[1]\n        self.ae(cy, 3)\n        for i in range(lb2.ynum):\n            self.ae(lb2.line(i), lb.line(i + 2))\n        self.assertFalse(lb.dirty_lines())\n        self.ae(lb2.dirty_lines(), list(range(lb2.ynum)))\n\n    def line_comparison(self, buf, *lines):\n        for i, l0 in enumerate(lines):\n            l2 = buf.line(i)\n            self.ae(l0, str(l2))\n\n    def line_comparison_rewrap(self, lb, *lines):\n        lb2 = LineBuf(len(lines), max(map(len, lines)))\n        self.rewrap(lb, lb2)\n        self.line_comparison(lb2, *lines)\n        return lb2\n\n    def assertContinued(self, lb, *vals):\n        self.ae(list(vals), [lb.is_continued(i) for i in range(len(vals))])\n\n    def test_rewrap_wider(self):\n        ' New buffer wider '\n        lb = create_lbuf('0123 ', '56789')\n        lb2 = self.line_comparison_rewrap(lb, '0123 5', '6789', '')\n        self.assertContinued(lb2, False, True)\n        self.ae(lb2.dirty_lines(), [0, 1])\n\n        lb = create_lbuf('12', 'abc')\n        lb2 = self.line_comparison_rewrap(lb, '12', 'abc')\n        self.assertContinued(lb2, False, False)\n\n    def test_rewrap_narrower(self):\n        ' New buffer narrower '\n        lb = create_lbuf('123', 'abcde')\n        lb2 = self.line_comparison_rewrap(lb, '123', 'abc', 'de')\n        self.assertContinued(lb2, False, False, True)\n        lb = create_lbuf('123  ', 'abcde')\n        lb2 = self.line_comparison_rewrap(lb, '123', '  a', 'bcd', 'e')\n        self.assertContinued(lb2, False, True, True, True)\n\n    def test_utils(self):\n        def w(x):\n            return wcwidth(ord(x))\n        self.ae(wcswidth('a\\033[2mb'), 2)\n        self.ae(wcswidth('\\033a\\033[2mb'), 2)\n        self.ae(wcswidth('a\\033]8;id=moo;https://foo\\033\\\\a'), 2)\n        self.ae(wcswidth('a\\033x'), 2)\n        self.ae(tuple(map(w, 'a1\\0\u30b3\u30cb\u30c1 \u2714')), (1, 1, 0, 2, 2, 2, 1, 1))\n        self.ae(wcswidth('\\u2716\\u2716\\ufe0f\\U0001f337'), 5)\n        self.ae(wcswidth('\\u25b6\\ufe0f'), 2)\n        self.ae(wcswidth('\\U0001f610\\ufe0e'), 1)\n        self.ae(wcswidth('\\U0001f1e6a'), 3)\n        self.ae(wcswidth('\\U0001F1E6a\\U0001F1E8a'), 6)\n        self.ae(wcswidth('\\U0001F1E6\\U0001F1E8a'), 3)\n        self.ae(wcswidth('\\U0001F1E6\\U0001F1E8\\U0001F1E6'), 4)\n        self.ae(wcswidth('a\\u00adb'), 2)\n        # Regional indicator symbols (unicode flags) are defined as having\n        # Emoji_Presentation so must have width 2 but combined must have\n        # width 2 not 4\n        self.ae(tuple(map(w, '\\U0001f1ee\\U0001f1f3')), (2, 2))\n        self.ae(wcswidth('\\U0001f1ee\\U0001f1f3'), 2)\n        tpl = truncate_point_for_length\n        self.ae(tpl('abc', 4), 3)\n        self.ae(tpl('abc', 2), 2)\n        self.ae(tpl('abc', 0), 0)\n        self.ae(tpl('a\\U0001f337', 2), 1)\n        self.ae(tpl('a\\U0001f337', 3), 2)\n        self.ae(tpl('a\\U0001f337b', 4), 3)\n        self.ae(sanitize_title('a\\0\\01 \\t\\n\\f\\rb'), 'a b')\n        self.ae(tpl('a\\x1b[31mbc', 2), 7)\n\n        def tp(*data, leftover='', text='', csi='', apc='', ibp=False):\n            text_r, csi_r, apc_r, rest = [], [], [], []\n            left = ''\n            in_bp = ibp\n\n            def on_csi(x):\n                nonlocal in_bp\n                if x == '200~':\n                    in_bp = True\n                elif x == '201~':\n                    in_bp = False\n                csi_r.append(x)\n\n            for d in data:\n                left = parse_input_from_terminal(text_r.append, rest.append, on_csi, rest.append, rest.append, apc_r.append, left + d, in_bp)\n            self.ae(left, leftover)\n            self.ae(text, ' '.join(text_r))\n            self.ae(csi, ' '.join(csi_r))\n            self.ae(apc, ' '.join(apc_r))\n            self.assertFalse(rest)\n\n        tp('a\\033[200~\\033[32mxy\\033[201~\\033[33ma', text='a \\033[32m xy a', csi='200~ 201~ 33m')\n        tp('abc', text='abc')\n        tp('a\\033[38:5:12:32mb', text='a b', csi='38:5:12:32m')\n        tp('a\\033_x,;(\\033\\\\b', text='a b', apc='x,;(')\n        tp('a\\033', '[', 'mb', text='a b', csi='m')\n        tp('a\\033[', 'mb', text='a b', csi='m')\n        tp('a\\033', '_', 'x\\033', '\\\\b', text='a b', apc='x')\n        tp('a\\033_', 'x', '\\033', '\\\\', 'b', text='a b', apc='x')\n\n        for prefix in ('/tmp', tempfile.gettempdir()):\n            for path in ('a.png', 'x/b.jpg', 'y/../c.jpg'):\n                self.assertTrue(is_path_in_temp_dir(os.path.join(prefix, path)))\n        for path in ('/home/xy/d.png', '/tmp/../home/x.jpg'):\n            self.assertFalse(is_path_in_temp_dir(os.path.join(path)))\n\n    def test_color_profile(self):\n        c = ColorProfile()\n        c.update_ansi_color_table(build_ansi_color_table())\n        for i in range(8):\n            col = getattr(defaults, f'color{i}')\n            self.assertEqual(c.as_color(i << 8 | 1), col)\n        self.ae(c.as_color(255 << 8 | 1), Color(0xee, 0xee, 0xee))\n\n    def test_historybuf(self):\n        lb = filled_line_buf()\n        hb = HistoryBuf(5, 5)\n        hb.push(lb.line(1))\n        hb.push(lb.line(2))\n        self.ae(hb.count, 2)\n        self.ae(hb.line(0), lb.line(2))\n        self.ae(hb.line(1), lb.line(1))\n        hb = filled_history_buf()\n        self.ae(str(hb.line(0)), '4' * hb.xnum)\n        self.ae(str(hb.line(4)), '0' * hb.xnum)\n        hb.push(lb.line(2))\n        self.ae(str(hb.line(0)), '2' * hb.xnum)\n        self.ae(str(hb.line(4)), '1' * hb.xnum)\n        hb = large_hb = HistoryBuf(3000, 5)\n        c = filled_cursor()\n        for i in range(3000):\n            line = lb.line(1)\n            t = str(i).ljust(5)\n            line.set_text(t, 0, 5, c)\n            hb.push(line)\n        for i in range(3000):\n            self.ae(str(hb.line(i)).rstrip(), str(3000 - 1 - i))\n\n        # rewrap\n        hb = filled_history_buf(5, 5)\n        hb2 = HistoryBuf(hb.ynum, hb.xnum)\n        hb.rewrap(hb2)\n        for i in range(hb.ynum):\n            self.ae(hb2.line(i), hb.line(i))\n        hb2 = HistoryBuf(8, 5)\n        hb.rewrap(hb2)\n        for i in range(hb.ynum):\n            self.ae(hb2.line(i), hb.line(i))\n        for i in range(hb.ynum, hb2.ynum):\n            with self.assertRaises(IndexError):\n                hb2.line(i)\n        hb2 = HistoryBuf(3, 5)\n        hb.rewrap(hb2)\n        for i in range(hb2.ynum):\n            self.ae(hb2.line(i), hb.line(i))\n        self.ae(hb2.dirty_lines(), list(range(hb2.ynum)))\n        hb = filled_history_buf(5, 5)\n        hb2 = HistoryBuf(hb.ynum, hb.xnum * 2)\n        hb.rewrap(hb2)\n        hb3 = HistoryBuf(hb.ynum, hb.xnum)\n        hb2.rewrap(hb3)\n        for i in range(hb.ynum):\n            self.ae(hb.line(i), hb3.line(i))\n\n        hb2 = HistoryBuf(hb.ynum, hb.xnum)\n        large_hb.rewrap(hb2)\n        hb2 = HistoryBuf(large_hb.ynum, large_hb.xnum)\n        large_hb.rewrap(hb2)\n\n    def test_ansi_repr(self):\n        lb = filled_line_buf()\n        l0 = lb.line(0)\n        self.ae(l0.as_ansi(), '00000')\n        a = []\n        lb.as_ansi(a.append)\n        self.ae(a, [str(lb.line(i)) + '\\n' for i in range(lb.ynum)])\n        l2 = lb.line(0)\n        c = C()\n        c.bold = c.italic = c.reverse = c.strikethrough = c.dim = True\n        c.fg = (4 << 8) | 1\n        c.bg = (1 << 24) | (2 << 16) | (3 << 8) | 2\n        c.decoration_fg = (5 << 8) | 1\n        l2.set_text('1', 0, 1, c)\n        self.ae(l2.as_ansi(), '\\x1b[1;2;3;7;9;34;48:2:1:2:3;58:5:5m' '1'\n                '\\x1b[22;23;27;29;39;49;59m' '0000')\n        lb = filled_line_buf()\n        for i in range(lb.ynum):\n            lb.set_continued(i, True)\n        a = []\n        lb.as_ansi(a.append)\n        self.ae(a, [str(lb.line(i)) for i in range(lb.ynum)])\n        hb = filled_history_buf(5, 5)\n        a = []\n        hb.as_ansi(a.append)\n        self.ae(a, [str(hb.line(i)) + '\\n' for i in range(hb.count - 1, -1, -1)])\n\n    def test_strip_csi(self):\n        def q(x, y=''):\n            self.ae(y or x, strip_csi(x))\n        q('test')\n        q('a\\x1bbc', 'ac')\n        q('a\\x1b[bc', 'ac')\n        q('a\\x1b[12;34:43mbc', 'abc')\n\n    def test_single_key(self):\n        from kitty.fast_data_types import (\n            GLFW_MOD_KITTY, GLFW_MOD_SHIFT, SingleKey\n        )\n        for m in (GLFW_MOD_KITTY, GLFW_MOD_SHIFT):\n            s = SingleKey(mods=m)\n            self.ae(s.mods, m)\n        self.ae(tuple(iter(SingleKey())), (0, False, 0))\n        self.ae(tuple(SingleKey(key=sys.maxunicode, mods=GLFW_MOD_SHIFT, is_native=True)), (GLFW_MOD_SHIFT, True, sys.maxunicode))\n        self.ae(repr(SingleKey()), 'SingleKey()')\n        self.ae(repr(SingleKey(key=23, mods=2, is_native=True)), 'SingleKey(mods=2, is_native=True, key=23)')\n        self.ae(repr(SingleKey(key=23, mods=2)), 'SingleKey(mods=2, key=23)')\n        self.ae(repr(SingleKey(key=23)), 'SingleKey(key=23)')\n        self.ae(repr(SingleKey(key=0x1008ff57)), 'SingleKey(key=269025111)')\n        self.ae(repr(SingleKey(key=23)._replace(mods=2)), 'SingleKey(mods=2, key=23)')\n        self.ae(repr(SingleKey(key=23)._replace(key=-1, mods=GLFW_MOD_KITTY)), f'SingleKey(mods={GLFW_MOD_KITTY})')\n        self.assertEqual(SingleKey(key=1), SingleKey(key=1))\n        self.assertEqual(hash(SingleKey(key=1)), hash(SingleKey(key=1)))\n        self.assertNotEqual(hash(SingleKey(key=1, mods=2)), hash(SingleKey(key=1)))\n        self.assertNotEqual(SingleKey(key=1, mods=2), SingleKey(key=1))\n"], "fixing_code": ["Changelog\n==============\n\n|kitty| is a feature-rich, cross-platform, *fast*, GPU based terminal.\nTo update |kitty|, :doc:`follow the instructions <binary>`.\n\n.. recent major features {{{\n\nRecent major new features\n---------------------------\n\nTruly convenient SSH\n~~~~~~~~~~~~~~~~~~~~~~~~\n\nThe :doc:`ssh kitten <kittens/ssh>` is redesigned with powerful new features:\n\n* Automatic :ref:`shell_integration` on remote machines\n* Easily :ref:`clone local shell/editor config <real_world_ssh_kitten_config>` on remote machines\n* Easily :ref:`edit files in your local editor <edit_file>` on remote machines\n* Automatic :opt:`re-use of existing connections <kitten-ssh.share_connections>` to avoid connection setup latency\n\n\nShell integration\n~~~~~~~~~~~~~~~~~~~~~\n\nkitty automatically integrates with common shells to allow browsing the\noutput of the previous command in a pager by pressing\n:sc:`show_last_command_output`, jumping to previous prompt locations in the\nscrollback by pressing :sc:`scroll_to_previous_prompt` and clicking with the\nmouse anywhere in the current command to move the cursor there. See\n:doc:`shell-integration` for details.\n\n.. }}}\n\nDetailed list of changes\n-------------------------------------\n\n0.26.2 [future]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow creating :code:`overlay-main` windows, which are treated as the active window unlike normal overlays (:iss:`5392`)\n\n- hyperlinked_grep kitten: Allow control over which parts of rg output are hyperlinked (:pull:`5428`)\n\n- Fix regression in 0.26.0 that caused launching kitty without working STDIO handles to result in high CPU usage and prewarming failing (:iss:`5444`)\n\n- :doc:`/launch`: Allow setting the margin and padding for the newly created window (:iss:`5463`)\n\n- macOS: Fix regression in 0.26.0 that caused asking the user for a line of input such as for :ac:`set_tab_title` to not work (:iss:`5447`)\n\n- hints kitten: hyperlink matching: Fix hints occasionally matching text on subsequent line as part of hyperlink (:pull:`5450`)\n\n- hints kitten: Allow using :doc:`launch` as the program to run, to open the result in a new kitty tab/window/etc. (:iss:`5462`)\n\n- Fix a regression in 0.26.0 that broke mapping of native keys who key codes did not fit in 21 bits (:iss:`5452`)\n\n- Wayland: Fix remembering window size not accurate when client side decorations are present\n\n- Fix an issue where notification identifiers were not sanitized leading to\n  code execution if the user clicked on a notification popup from a malicious\n  source. Thanks to Carter Sande for discovering this vulnerability.\n\n0.26.1 [2022-08-30]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- ssh kitten: Fix executable permission missing from kitty bootstrap script (:iss:`5438`)\n\n- Fix a regression in 0.26.0 that caused kitty to no longer set the ``LANG`` environment variable on macOS (:iss:`5439`)\n\n- Allow specifying a title when using the :ac:`set_tab_title` action (:iss:`5441`)\n\n0.26.0 [2022-08-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new option :opt:`remote_control_password` to use fine grained permissions for what can be remote controlled (:disc:`5320`)\n\n- Reduce startup latency by ~30 milliseconds when running kittens via key bindings inside kitty (:iss:`5159`)\n\n- A new option :opt:`modify_font` to adjust various font metrics like underlines, cell sizes etc. (:pull:`5265`)\n\n- A new shortcut :sc:`show_kitty_doc` to display the kitty docs in a browser\n\n- Graphics protocol: Only delete temp files if they have the string\n  :code:`tty-graphics-protocol` in their file paths. This prevents deletion of arbitrary files in :file:`/tmp`.\n\n- Deprecate the ``adjust_baseline``, ``adjust_line_height`` and ``adjust_column_width`` options in favor of :opt:`modify_font`\n\n- Wayland: Fix a regression in the previous release that caused mouse cursor\n  animation and keyboard repeat to stop working when switching seats (:iss:`5188`)\n\n- Allow resizing windows created in session files (:pull:`5196`)\n\n- Fix horizontal wheel events not being reported to client programs when they grab the mouse (:iss:`2819`)\n\n- macOS: Remote control: Fix unable to launch a new OS window or background process when there is no OS window (:iss:`5210`)\n\n- macOS: Fix unable to open new tab or new window when there is no OS window (:iss:`5276`)\n\n- kitty @ set-colors: Fix changing inactive_tab_foreground not working (:iss:`5214`)\n\n- macOS: Fix a regression that caused switching keyboard input using Eisu and\n  Kana keys not working (:iss:`5232`)\n\n- Add a mappable action to toggle the mirrored setting for the tall and fat\n  layouts (:pull:`5344`)\n\n- Add a mappable action to switch between predefined bias values for the tall and fat\n  layouts (:pull:`5352`)\n\n- Wayland: Reduce flicker at startup by not using render frames immediately after a resize (:iss:`5235`)\n\n- Linux: Update cursor position after all key presses not just pre-edit text\n  changes (:iss:`5241`)\n\n- ssh kitten: Allow ssh kitten to work from inside tmux, provided the tmux\n  session inherits the correct KITTY env vars (:iss:`5227`)\n\n- ssh kitten: A new option :code:`--symlink-strategy` to control how symlinks\n  are copied to the remote machine (:iss:`5249`)\n\n- ssh kitten: Allow pressing :kbd:`Ctrl+C` to abort ssh before the connection is\n  completed (:iss:`5271`)\n\n- Bash integration: Fix declare not creating global variables in .bashrc (:iss:`5254`)\n\n- Bash integration: Fix the inherit_errexit option being set by shell integration (:iss:`5349`)\n\n- :command:`kitty @ scroll-window` allow scrolling by fractions of a screen\n  (:iss:`5294`)\n\n- remote files kitten: Fix working with files whose names have characters that\n  need to be quoted in shell scripts (:iss:`5313`)\n\n- Expand ~ in paths configured in :opt:`editor` and :opt:`exe_search_path` (:disc:`5298`)\n\n- Allow showing the working directory of the active window in tab titles\n  (:pull:`5314`)\n\n- ssh kitten: Allow completion of ssh options between the destination and command (:iss:`5322`)\n\n- macOS: Fix speaking selected text not working (:iss:`5357`)\n\n- Allow ignoring failure to close windows/tabs via rc commands (:disc:`5406`)\n\n- Fix hyperlinks not present when fetching text from the history buffer\n  (:iss:`5427`)\n\n\n0.25.2 [2022-06-07]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new command :command:`edit-in-kitty` to :ref:`edit_file`\n\n- Allow getting the last non-empty command output easily via an action or\n  remote control (:pull:`4973`)\n\n- Fix a bug that caused :opt:`macos_colorspace` to always be ``default`` regardless of its actual value (:iss:`5129`)\n\n- diff kitten: A new option :opt:`kitten-diff.ignore_name` to exclude files and directories from being scanned (:pull:`5171`)\n\n- ssh kitten: Fix bash not being executed as a login shell since kitty 0.25.0 (:iss:`5130`)\n\n- macOS: When pasting text and the clipboard has a filesystem path, paste the\n  full path instead of the text, which is sometimes just the file name (:pull:`5142`)\n\n- macOS: Allow opening executables without a file extension with kitty as well\n  (:iss:`5160`)\n\n- Themes kitten: Add a tab to show user defined custom color themes separately\n  (:pull:`5150`)\n\n- Iosevka: Fix incorrect rendering when there is a combining char that does not\n  group with its neighbors (:iss:`5153`)\n\n- Weston: Fix client side decorations flickering on slow computers during\n  window resize (:iss:`5162`)\n\n- Remote control: Fix commands with large or asynchronous payloads like\n  :command:`kitty @ set-backround-image`, :command:`kitty @ set-window-logo`\n  and :command:`kitty @ select-window` not working correctly\n  when using a socket (:iss:`5165`)\n\n- hints kitten: Fix surrounding quotes/brackets and embedded carriage returns\n  not being removed when using line number processing (:iss:`5170`)\n\n\n0.25.1 [2022-05-26]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Shell integration: Add a command to :ref:`clone_shell`\n\n- Remote control: Allow using :ref:`Boolean operators <search_syntax>` when constructing queries to match windows or tabs\n\n- Sessions: Fix :code:`os_window_size` and :code:`os_window_class` not applying to the first OS Window (:iss:`4957`)\n\n- Allow using the cwd of the oldest as well as the newest foreground process for :option:`launch --cwd` (:disc:`4869`)\n\n- Bash integration: Fix the value of :opt:`shell_integration` not taking effect if the integration script is sourced in bashrc (:pull:`4964`)\n\n- Fix a regression in the previous release that caused mouse move events to be incorrectly reported as drag events even when a button is not pressed (:iss:`4992`)\n\n- remote file kitten: Integrate with the ssh kitten for improved performance\n  and robustness. Re-uses the control master connection of the ssh kitten to\n  avoid round-trip latency.\n\n- Fix tab selection when closing a new tab not correct in some scenarios (:iss:`4987`)\n\n- A new action :ac:`open_url` to open the specified URL (:pull:`5004`)\n\n- A new option :opt:`select_by_word_characters_forward` that allows changing\n  which characters are considered part of a word to the right when double clicking to select\n  words (:pull:`5103`)\n\n- macOS: Make the global menu shortcut to open kitty website configurable (:pull:`5004`)\n\n- macOS: Add the :opt:`macos_colorspace` option to control what color space colors are rendered in (:iss:`4686`)\n\n- Fix reloading of config not working when :file:`kitty.conf` does not exist when kitty is launched (:iss:`5071`)\n\n- Fix deleting images by row not calculating image bounds correctly (:iss:`5081`)\n\n- Increase the max number of combining chars per cell from two to three, without increasing memory usage.\n\n- Linux: Load libfontconfig at runtime to allow the binaries to work for\n  running kittens on servers without FontConfig\n\n- GNOME: Fix for high CPU usage caused by GNOME's text input subsystem going\n  into an infinite loop when IME cursor position is updated after a done event\n  (:iss:`5105`)\n\n\n0.25.0 [2022-04-11]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- :doc:`kittens/ssh`: automatic shell integration when using SSH. Easily\n  clone local shell and editor configuration on remote machines, and automatic\n  re-use of existing connections to avoid connection setup latency.\n\n- When pasting URLs at shell prompts automatically quote them. Also allow filtering pasted text and confirm pastes. See :opt:`paste_actions` for details. (:iss:`4873`)\n\n- Change the default value of :opt:`confirm_os_window_close` to ask for confirmation when closing windows that are not sitting at shell prompts\n\n- A new value :code:`last_reported` for :option:`launch --cwd` to use the current working directory last reported by the program running in the terminal\n\n- macOS: When using Apple's less as the pager for viewing scrollback strip out OSC codes as it cant parse them (:iss:`4788`)\n\n- diff kitten: Fix incorrect rendering in rare circumstances when scrolling after changing the context size (:iss:`4831`)\n\n- icat kitten: Fix a regression that broke :option:`kitty +kitten icat --print-window-size` (:pull:`4818`)\n\n- Wayland: Fix :opt:`hide_window_decorations` causing docked windows to be resized on blur (:iss:`4797`)\n\n- Bash integration: Prevent shell integration code from running twice if user enables both automatic and manual integration\n\n- Bash integration: Handle existing PROMPT_COMMAND ending with a literal newline\n\n- Fix continued lines not having their continued status reset on line feed (:iss:`4837`)\n\n- macOS: Allow the New kitty Tab/Window Here services to open multiple selected folders.  (:pull:`4848`)\n\n- Wayland: Fix a regression that broke IME when changing windows/tabs (:iss:`4853`)\n\n- macOS: Fix Unicode paths not decoded correctly when dropping files (:pull:`4879`)\n\n- Avoid flicker when starting kittens such as the hints kitten (:iss:`4674`)\n\n- A new action :ac:`scroll_prompt_to_top` to move the current prompt to the top (:pull:`4891`)\n\n- :ac:`select_tab`: Use stable numbers when selecting the tab (:iss:`4792`)\n\n- Only check for updates in the official binary builds. Distro packages or source builds will no longer check for updates, regardless of the\n  value of :opt:`update_check_interval`.\n\n- Fix :opt:`inactive_text_alpha` still being applied to the cursor hidden window after focus (:iss:`4928`)\n\n- Fix resizing window that is extra tall/wide because of left-over cells not\n  working reliably (:iss:`4913`)\n\n- A new action :ac:`close_other_tabs_in_os_window` to close other tabs in the active OS window (:pull:`4944`)\n\n\n0.24.4 [2022-03-03]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Shell integration: Fix the default Bash :code:`$HISTFILE` changing to :file:`~/.sh_history` instead of :file:`~/.bash_history` (:iss:`4765`)\n\n- Linux binaries: Fix binaries not working on systems with older Wayland client libraries (:iss:`4760`)\n\n- Fix a regression in the previous release that broke kittens launched with :code:`STDIN` not connected to a terminal (:iss:`4763`)\n\n- Wayland: Fix surface configure events not being acknowledged before commit\n  the resized buffer (:pull:`4768`)\n\n\n0.24.3 [2022-02-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Bash integration: No longer modify :file:`~/.bashrc` to load :ref:`shell integration <shell_integration>`.\n  It is recommended to remove the lines used to load the shell integration from :file:`~/.bashrc` as they are no-ops.\n\n- macOS: Allow kitty to handle various URL types. Can be configured via\n  :ref:`launch_actions` (:pull:`4618`)\n\n- macOS: Add a new service ``Open with kitty`` to open file types that are not\n  recognized by the system (:pull:`4641`)\n\n- Splits layout: A new value for :option:`launch --location` to auto-select the split axis when splitting existing windows.\n  Wide windows are split side-by-side and tall windows are split one-above-the-other\n\n- hints kitten: Fix a regression that broke recognition of path:linenumber:colnumber (:iss:`4675`)\n\n- Fix a regression in the previous release that broke :opt:`active_tab_foreground` (:iss:`4620`)\n\n- Fix :ac:`show_last_command_output` not working when the output is stored\n  partially in the scrollback pager history buffer (:iss:`4435`)\n\n- When dropping URLs/files onto kitty at a shell prompt insert them appropriately quoted and space\n  separated (:iss:`4734`)\n\n- Improve CWD detection when there are multiple foreground processes in the TTY process group\n\n- A new option :opt:`narrow_symbols` to turn off opportunistic wide rendering of private use codepoints\n\n- ssh kitten: Fix location of generated terminfo files on NetBSD (:iss:`4622`)\n\n- A new action to clear the screen up to the line containing the cursor, see\n  :ac:`clear_terminal`\n\n- A new action :ac:`copy_ansi_to_clipboard` to copy the current selection with ANSI formatting codes\n  (:iss:`4665`)\n\n- Linux: Do not rescale fallback fonts to match the main font cell height, instead just\n  set the font size and let FreeType take care of it. This matches\n  rendering on macOS (:iss:`4707`)\n\n- macOS: Fix a regression in the previous release that broke switching input\n  sources by keyboard (:iss:`4621`)\n\n- macOS: Add the default shortcut :kbd:`cmd+k` to clear the terminal screen and\n  scrollback up to the cursor (:iss:`4625`)\n\n- Fix a regression in the previous release that broke strikethrough (:disc:`4632`)\n\n- A new action :ac:`scroll_prompt_to_bottom` to move the current prompt\n  to the bottom, filling in the window from the scrollback (:pull:`4634`)\n\n- Add two special arguments ``@first-line-on-screen`` and ``@last-line-on-screen``\n  for the :doc:`launch <launch>` command to be used for pager positioning.\n  (:iss:`4462`)\n\n- Linux: Fix rendering of emoji when using scalable fonts such as Segoe UI Emoji\n\n- Shell integration: bash: Dont fail if an existing PROMPT_COMMAND ends with a semi-colon (:iss:`4645`)\n\n- Shell integration: bash: Fix rendering of multiline prompts with more than two lines (:iss:`4681`)\n\n- Shell integration: fish: Check fish version 3.3.0+ and exit on outdated versions (:pull:`4745`)\n\n- Shell integration: fish: Fix pipestatus being overwritten (:pull:`4756`)\n\n- Linux: Fix fontconfig alias not being used if the aliased font is dual spaced instead of monospaced (:iss:`4649`)\n\n- macOS: Add an option :opt:`macos_menubar_title_max_length` to control the max length of the window title displayed in the global menubar (:iss:`2132`)\n\n- Fix :opt:`touch_scroll_multiplier` also taking effect in terminal programs such as vim that handle mouse events themselves (:iss:`4680`)\n\n- Fix symbol/PUA glyphs loaded via :opt:`symbol_map` instead of as fallbacks not using following spaces to render larger versions (:iss:`4670`)\n\n- macOS: Fix regression in previous release that caused Apple's global shortcuts to not work if they had never been configured on a particular machine (:iss:`4657`)\n\n- Fix a fast *click, move mouse, click* sequence causing the first click event to be discarded (:iss:`4603`)\n\n- Wayland: Fix wheel mice with line based scrolling being incorrectly handled as high precision devices (:iss:`4694`)\n\n- Wayland: Fix touchpads and high resolution wheels not scrolling at the same speed on monitors with different scales (:iss:`4703`)\n\n- Add an option :opt:`wheel_scroll_min_lines` to set the minimum number of lines for mouse wheel scrolling when using a mouse with a wheel that generates very small offsets when slow scrolling (:pull:`4710`)\n\n- macOS: Make the shortcut to toggle full screen configurable (:pull:`4714`)\n\n- macOS: Fix the mouse cursor being set to arrow after switching desktops or toggling full screen (:pull:`4716`)\n\n- Fix copying of selection after selection has been scrolled off history buffer raising an error (:iss:`4713`)\n\n\n0.24.2 [2022-02-03]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Allow opening text files, images and directories with kitty when\n  launched using \"Open with\" in Finder (:iss:`4460`)\n\n- Allow including config files matching glob patterns in :file:`kitty.conf`\n  (:iss:`4533`)\n\n- Shell integration: Fix bash integration not working when ``PROMPT_COMMAND``\n  is used to change the prompt variables (:iss:`4476`)\n\n- Shell integration: Fix cursor shape not being restored to default when\n  running commands in the shell\n\n- Improve the UI of the ask kitten (:iss:`4545`)\n\n- Allow customizing the placement and formatting of the\n  :opt:`tab_activity_symbol` and :opt:`bell_on_tab` symbols\n  by adding them to the :opt:`tab_title_template` (:iss:`4581`, :pull:`4507`)\n\n- macOS: Persist \"Secure Keyboard Entry\" across restarts to match the behavior\n  of Terminal.app (:iss:`4471`)\n\n- hints kitten: Fix common single letter extension files not being detected\n  (:iss:`4491`)\n\n- Support dotted and dashed underline styles (:pull:`4529`)\n\n- For the vertical and horizontal layouts have the windows arranged on a ring\n  rather than a plane. This means the first and last window are considered\n  neighbors (:iss:`4494`)\n\n- A new action to clear the current selection (:iss:`4600`)\n\n- Shell integration: fish: Fix cursor shape not working with fish's vi mode\n  (:iss:`4508`)\n\n- Shell integration: fish: Dont override fish's native title setting functionality.\n  See `discussion <https://github.com/fish-shell/fish-shell/issues/8641>`__.\n\n- macOS: Fix hiding via :kbd:`cmd+h` not working on macOS 10.15.7 (:iss:`4472`)\n\n- Draw the dots for braille characters more evenly spaced at all font sizes (:iss:`4499`)\n\n- icat kitten: Add options to mirror images and remove their transparency\n  before displaying them (:iss:`4513`)\n\n- macOS: Respect the users system-wide global keyboard shortcut preferences\n  (:iss:`4501`)\n\n- macOS: Fix a few key-presses causing beeps from Cocoa's text input system\n  (:iss:`4489`)\n\n- macOS: Fix using shortcuts from the global menu bar as subsequent key presses\n  in a multi key mapping not working (:iss:`4519`)\n\n- Fix getting last command output not working correctly when the screen is\n  scrolled (:pull:`4522`)\n\n- Show number of windows per tab in the :ac:`select_tab` action (:pull:`4523`)\n\n- macOS: Fix the shift key not clearing pre-edit text in IME (:iss:`4541`)\n\n- Fix clicking in a window to focus it and typing immediately sometimes having\n  unexpected effects if at a shell prompt (:iss:`4128`)\n\n- themes kitten: Allow writing to a different file than :file:`kitty.conf`.\n\n\n0.24.1 [2022-01-06]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Shell integration: Work around conflicts with some zsh plugins (:iss:`4428`)\n\n- Have the zero width space and various other characters from the *Other,\n  formatting* Unicode category be treated as combining characters (:iss:`4439`)\n\n- Fix using ``--shell-integration`` with :file:`setup.py` broken (:iss:`4434`)\n\n- Fix showing debug information not working if kitty's :file:`STDIN` is not a tty\n  (:iss:`4424`)\n\n- Linux: Fix a regression that broke rendering of emoji with variation selectors\n  (:iss:`4444`)\n\n\n0.24.0 [2022-01-04]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Integrate kitty closely with common shells such as zsh, fish and bash.\n  This allows lots of niceties such as jumping to previous prompts, opening the\n  output of the last command in a new window, etc. See :ref:`shell_integration`\n  for details. Packagers please read :ref:`packagers`.\n\n- A new shortcut :sc:`focus_visible_window` to visually focus a window using\n  the keyboard. Pressing it causes numbers to appear over each visible window\n  and you can press the number to focus the corresponding window (:iss:`4110`)\n\n- A new facility :opt:`window_logo_path` to draw an arbitrary PNG image as\n  logo in the corner of a kitty window (:pull:`4167`)\n\n- Allow rendering the cursor with a *reverse video* effect. See :opt:`cursor`\n  for details (:iss:`126`)\n\n- Allow rendering the mouse selection with a *reverse video* effect. See\n  :opt:`selection_foreground` (:iss:`646`)\n\n- A new option :opt:`tab_bar_align` to draw the tab bar centered or right\n  aligned (:iss:`3946`)\n\n- Allow the user to supply a custom Python function to draw tab bar. See\n  :opt:`tab_bar_style`\n\n- A new remote control command to :program:`change the tab color <kitty @\n  set-tab-color>` (:iss:`1287`)\n\n- A new remote control command to :program:`visually select a window <kitty @\n  select-window>` (:iss:`4165`)\n\n- Add support for reporting mouse events with pixel co-ordinates using the\n  ``SGR_PIXEL_PROTOCOL`` introduced in xterm 359\n\n- When programs ask to read from the clipboard prompt, ask the user to allow\n  the request by default instead of denying it by default. See\n  :opt:`clipboard_control` for details (:iss:`4022`)\n\n- A new mappable action ``swap_with_window`` to swap the current window with another window in the tab, visually\n\n- A new :program:`remote control command <kitty @ set-enabled-layouts>` to change\n  the enabled layouts in a tab (:iss:`4129`)\n\n- A new option :opt:`bell_path` to specify the path to a sound file\n  to use as the bell sound\n\n- A new option :opt:`exe_search_path` to modify the locations kitty searches\n  for executables to run (:iss:`4324`)\n\n- broadcast kitten: Show a \"fake\" cursor in all windows being broadcast too\n  (:iss:`4225`)\n\n- Allow defining :opt:`aliases <action_alias>` for more general actions, not just kittens\n  (:pull:`4260`)\n\n- Fix a regression that caused :option:`kitty --title` to not work when\n  opening new OS windows using :option:`kitty --single-instance` (:iss:`3893`)\n\n- icat kitten: Fix display of JPEG images that are rotated via EXIF data and\n  larger than available screen size (:iss:`3949`)\n\n- macOS: Fix SIGUSR1 quitting kitty instead of reloading the config file (:iss:`3952`)\n\n- Launch command: Allow specifying the OS window title\n\n- broadcast kitten: Allow broadcasting :kbd:`ctrl+c` (:pull:`3956`)\n\n- Fix space ligatures not working with Iosevka for some characters in the\n  Enclosed Alphanumeric Supplement (:iss:`3954`)\n\n- hints kitten: Fix a regression that caused using the default open program\n  to trigger open actions instead of running the program (:iss:`3968`)\n\n- Allow deleting environment variables in :opt:`env` by specifying\n  just the variable name, without a value\n\n- Fix :opt:`active_tab_foreground` not being honored when :opt:`tab_bar_style`\n  is ``slant`` (:iss:`4053`)\n\n- When a :opt:`tab_bar_background` is specified it should extend to the edges\n  of the OS window (:iss:`4054`)\n\n- Linux: Fix IME with fcitx5 not working after fcitx5 is restarted\n  (:pull:`4059`)\n\n- Various improvements to IME integration (:iss:`4219`)\n\n- Remote file transfer: Fix transfer not working if custom ssh port or identity\n  is specified on the command line (:iss:`4067`)\n\n- Unicode input kitten: Implement scrolling when more results are found than\n  the available display space (:pull:`4068`)\n\n- Allow middle clicking on a tab to close it (:iss:`4151`)\n\n- The command line option ``--watcher`` has been deprecated in favor of the\n  :opt:`watcher` option in :file:`kitty.conf`. It has the advantage of\n  applying to all windows, not just the initially created ones. Note that\n  ``--watcher`` now also applies to all windows, not just initially created ones.\n\n- **Backward incompatibility**: No longer turn on the kitty extended keyboard\n  protocol's disambiguate mode when the client sends the XTMODKEYS escape code.\n  Applications must use the dedicated escape code to turn on the protocol.\n  (:iss:`4075`)\n\n- Fix soft hyphens not being preserved when round tripping text through the\n  terminal\n\n- macOS: Fix :kbd:`ctrl+shift` with :kbd:`Esc` or :kbd:`F1` - :kbd:`F12` not working\n  (:iss:`4109`)\n\n- macOS: Fix :opt:`resize_in_steps` not working correctly on high DPI screens\n  (:iss:`4114`)\n\n- Fix the :program:`resize OS Windows <kitty @ resize-os-window>` setting a\n  slightly incorrect size on high DPI screens (:iss:`4114`)\n\n- :program:`kitty @ launch` - when creating tabs with the ``--match`` option create\n  the tab in the OS Window containing the result of the match rather than\n  the active OS Window (:iss:`4126`)\n\n- Linux X11: Add support for 10bit colors (:iss:`4150`)\n\n- Fix various issues with changing :opt:`tab_bar_background` by remote control\n  (:iss:`4152`)\n\n- A new option :opt:`tab_bar_margin_color` to control the color of the tab bar\n  margins\n\n- A new option :opt:`visual_bell_color` to customize the color of the visual bell\n  (:pull:`4181`)\n\n- Add support for OSC 777 based desktop notifications\n\n- Wayland: Fix pasting from applications that use a MIME type of \"text/plain\"\n  rather than \"text/plain;charset=utf-8\" not working (:iss:`4183`)\n\n- A new mappable action to close windows with a confirmation (:iss:`4195`)\n\n- When remembering OS window sizes for full screen windows use the size before\n  the window became fullscreen (:iss:`4221`)\n\n- macOS: Fix keyboard input not working after toggling fullscreen till the\n  window is clicked in\n\n- A new mappable action ``nth_os_window`` to to focus the specified nth OS\n  window. (:pull:`4316`)\n\n- macOS: The kitty window can be scrolled by the mouse wheel when OS window not\n  in focus. (:pull:`4371`)\n\n- macOS: Light or dark system appearance can be specified in\n  :opt:`macos_titlebar_color` and used in kitty themes. (:pull:`4378`)\n\n\n0.23.1 [2021-08-17]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix themes kitten failing to download themes because of missing SSL\n  root certificates (:iss:`3936`)\n\n- A new option :opt:`clipboard_max_size` to control the maximum size\n  of data that kitty will transmit to the system clipboard on behalf of\n  programs running inside it (:iss:`3937`)\n\n- When matching windows/tabs in kittens or using remote control, allow matching\n  by recency. ``recent:0`` matches the active window/tab, ``recent:1`` matches\n  the previous window/tab and so on\n\n- themes kitten: Fix only the first custom theme file being loaded correctly\n  (:iss:`3938`)\n\n\n0.23.0 [2021-08-16]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new :doc:`themes kitten </kittens/themes>` to easily change kitty themes.\n  Choose from almost two hundred themes in the `kitty themes repository\n  <https://github.com/kovidgoyal/kitty-themes>`_\n\n- A new style for the tab bar that makes tabs looks like the tabs in a physical\n  tabbed file, see :opt:`tab_bar_style`\n\n- Make the visual bell flash more gentle, especially on dark themes\n  (:pull:`2937`)\n\n- Fix :option:`kitty --title` not overriding the OS Window title when multiple\n  tabs are present. Also this option is no longer used as the default title for\n  windows, allowing individual tabs/windows to have their own titles, even when\n  the OS Window has a fixed overall title (:iss:`3893`)\n\n- Linux: Fix some very long ligatures being rendered incorrectly at some font\n  sizes (:iss:`3896`)\n\n- Fix shift+middle click to paste sending a mouse press event but no release\n  event which breaks some applications that grab the mouse but cant handle\n  mouse events (:iss:`3902`)\n\n- macOS: When the language is set to English and the country to one for which\n  an English locale does not exist, set :envvar:`LANG` to ``en_US.UTF-8``\n  (:iss:`3899`)\n\n- terminfo: Fix \"cnorm\" the property for setting the cursor to normal using a\n  solid block rather than a blinking block cursor (:iss:`3906`)\n\n- Add :opt:`clear_all_mouse_actions` to clear all mouse actions defined to\n  that point (:iss:`3907`)\n\n- Fix the remote file kitten not working when using -- with ssh. The ssh kitten\n  was recently changed to do this (:iss:`3929`)\n\n- When dragging word or line selections, ensure the initially selected item is\n  never deselected. This matches behavior in most other programs (:iss:`3930`)\n\n- hints kitten: Make copy/paste with the :option:`kitty +kitten hints\n  --program` option work when using the ``self``\n  :option:`kitty +kitten hints --linenum-action` (:iss:`3931`)\n\n\n0.22.2 [2021-08-02]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix a long standing bug that could cause kitty windows to stop\n  updating, that got worse in the previous release (:iss:`3890` and\n  :iss:`2016`)\n\n- Wayland: A better fix for compositors like sway that can toggle client side\n  decorations on and off (:iss:`3888`)\n\n\n0.22.1 [2021-07-31]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix a regression in the previous release that broke ``kitty --help`` (:iss:`3869`)\n\n- Graphics protocol: Fix composing onto currently displayed frame not updating the frame on the GPU (:iss:`3874`)\n\n- Fix switching to previously active tab after detaching a tab not working (:pull:`3871`)\n\n- macOS: Fix an error on Apple silicon when enumerating monitors (:pull:`3875`)\n\n- detach_window: Allow specifying the previously active tab or the tab to the left/right of\n  the active tab (:disc:`3877`)\n\n- broadcast kitten: Fix a regression in ``0.20.0`` that broke sending of some\n  keys, such as backspace\n\n- Linux binary: Remove any RPATH build artifacts from bundled libraries\n\n- Wayland: If the compositor turns off server side decorations after turning\n  them on do not draw client side decorations (:iss:`3888`)\n\n\n0.22.0 [2021-07-26]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a new :ac:`toggle_layout` action to easily zoom/unzoom a window\n\n- When right clicking to extend a selection, move the nearest selection\n  boundary rather than the end of the selection. To restore previous behavior\n  use ``mouse_map right press ungrabbed mouse_selection move-end``.\n\n- When opening hyperlinks, allow defining open actions for directories\n  (:pull:`3836`)\n\n- When using the OSC 52 escape code to copy to clipboard allow large\n  copies (up to 8MB) without needing a kitty specific chunking protocol.\n  Note that if you used the chunking protocol in the past, it will no longer\n  work and you should switch to using the unmodified protocol which has the\n  advantage of working with all terminal emulators.\n\n- Fix a bug in the implementation of the synchronized updates escape code that\n  could cause incorrect parsing if either the pending buffer capacity or the\n  pending timeout were exceeded (:iss:`3779`)\n\n- A new remote control command to :program:`resize the OS Window <kitty @\n  resize-os-window>`\n\n- Graphics protocol: Add support for composing rectangles from one animation\n  frame onto another (:iss:`3809`)\n\n- diff kitten: Remove limit on max line length of 4096 characters (:iss:`3806`)\n\n- Fix turning off cursor blink via escape codes not working (:iss:`3808`)\n\n- Allow using neighboring window operations in the stack layout. The previous\n  window is considered the left and top neighbor and the next window is\n  considered the bottom and right neighbor (:iss:`3778`)\n\n- macOS: Render colors in the sRGB colorspace to match other macOS terminal\n  applications (:iss:`2249`)\n\n- Add a new variable ``{num_window_groups}`` for the :opt:`tab_title_template`\n  (:iss:`3837`)\n\n- Wayland: Fix :opt:`initial_window_width/height <remember_window_size>` specified\n  in cells not working on High DPI screens (:iss:`3834`)\n\n- A new theme for the kitty website with support for dark mode.\n\n- Render \u2504 \u2505 \u2506 \u2507 \u2508 \u2509 \u250a \u250b with spaces at the edges. Matches rendering in\n  most other programs and allows long chains of them to look better\n  (:iss:`3844`)\n\n- hints kitten: Detect paths and hashes that appear over multiple lines.\n  Note that this means that all line breaks in the text are no longer \\n\n  soft breaks are instead \\r. If you use a custom regular expression that\n  is meant to match over line breaks, you will need to match over both.\n  (:iss:`3845`)\n\n- Allow leading or trailing spaces in :opt:`tab_activity_symbol`\n\n- Fix mouse actions not working when caps lock or num lock are engaged\n  (:iss:`3859`)\n\n- macOS: Fix automatic detection of bold/italic faces for fonts that\n  use the family name as the full face name of the regular font not working\n  (:iss:`3861`)\n\n- clipboard kitten: fix copies to clipboard not working without the\n  :option:`kitty +kitten clipboard --wait-for-completion` option\n\n\n0.21.2 [2021-06-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new ``adjust_baseline`` option to adjust the vertical alignment of text\n  inside a line (:pull:`3734`)\n\n- A new :opt:`url_excluded_characters` option to exclude additional characters\n  when detecting URLs under the mouse (:pull:`3738`)\n\n- Fix a regression in 0.21.0 that broke rendering of private use Unicode symbols followed\n  by spaces, when they also exist not followed by spaces (:iss:`3729`)\n\n- ssh kitten: Support systems where the login shell is a non-POSIX shell\n  (:iss:`3405`)\n\n- ssh kitten: Add completion (:iss:`3760`)\n\n- ssh kitten: Fix \"Connection closed\" message being printed by ssh when running\n  remote commands\n\n- Add support for the XTVERSION escape code\n\n- macOS: Fix a regression in 0.21.0 that broke middle-click to paste from clipboard (:iss:`3730`)\n\n- macOS: Fix shortcuts in the global menu bar responding slowly when cursor blink\n  is disabled/timed out (:iss:`3693`)\n\n- When displaying scrollback ensure that the window does not quit if the amount\n  of scrollback is less than a screen and the user has the ``--quit-if-one-screen``\n  option enabled for less (:iss:`3740`)\n\n- Linux: Fix Emoji/bitmapped fonts not use able in symbol_map\n\n- query terminal kitten: Allow querying font face and size information\n  (:iss:`3756`)\n\n- hyperlinked grep kitten: Fix context options not generating contextual output (:iss:`3759`)\n\n- Allow using superscripts in tab titles (:iss:`3763`)\n\n- Unicode input kitten: Fix searching when a word has more than 1024 matches (:iss:`3773`)\n\n\n0.21.1 [2021-06-14]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix a regression in the previous release that broke rendering of\n  strikeout (:iss:`3717`)\n\n- macOS: Fix a crash when rendering ligatures larger than 128 characters\n  (:iss:`3724`)\n\n- Fix a regression in the previous release that could cause a crash when\n  changing layouts and mousing (:iss:`3713`)\n\n\n0.21.0 [2021-06-12]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow reloading the :file:`kitty.conf` config file by pressing\n  :sc:`reload_config_file`. (:iss:`1292`)\n\n- Allow clicking URLs to open them without needing to also hold\n  :kbd:`ctrl+shift`\n\n- Allow remapping all mouse button press/release events to perform arbitrary\n  actions. :ref:`See details <conf-kitty-mouse.mousemap>` (:iss:`1033`)\n\n- Support infinite length ligatures (:iss:`3504`)\n\n- **Backward incompatibility**: The options to control which modifiers keys to\n  press for various mouse actions have been removed, if you used these options,\n  you will need to replace them with configuration using the new\n  :ref:`mouse actions framework <conf-kitty-mouse.mousemap>` as they will be\n  ignored. The options were: ``terminal_select_modifiers``,\n  ``rectangle_select_modifiers`` and ``open_url_modifiers``.\n\n- Add a configurable mouse action (:kbd:`ctrl+alt+triplepress` to select from the\n  clicked point to the end of the line. (:iss:`3585`)\n\n- Add the ability to un-scroll the screen to the ``kitty @ scroll-window``\n  remote control command (:iss:`3604`)\n\n- A new option, :opt:`tab_bar_margin_height` to add margins around the\n  top and bottom edges of the tab bar (:iss:`3247`)\n\n- Unicode input kitten: Fix a regression in 0.20.0 that broke keyboard handling\n  when the NumLock or CapsLock modifiers were engaged. (:iss:`3587`)\n\n- Fix a regression in 0.20.0 that sent incorrect bytes for the :kbd:`F1`-:kbd:`F4` keys\n  in rmkx mode (:iss:`3586`)\n\n- macOS: When the Apple Color Emoji font lacks an emoji glyph search for it in other\n  installed fonts (:iss:`3591`)\n\n- macOS: Fix rendering getting stuck on some machines after sleep/screensaver\n  (:iss:`2016`)\n\n- macOS: Add a new ``Shell`` menu to the global menubar with some commonly used\n  actions (:pull:`3653`)\n\n- macOS: Fix the baseline for text not matching other CoreText based\n  applications for some fonts (:iss:`2022`)\n\n- Add a few more special commandline arguments for the launch command. Now all\n  ``KITTY_PIPE_DATA`` is also available via command line argument substitution\n  (:iss:`3593`)\n\n- Fix dynamically changing the background color in a window causing rendering\n  artifacts in the tab bar (:iss:`3595`)\n\n- Fix passing STDIN to launched background processes causing them to not inherit\n  environment variables (:pull:`3603`)\n\n- Fix deleting windows that are not the last window via remote control leaving\n  no window focused (:iss:`3619`)\n\n- Add an option :option:`kitty @ get-text --add-cursor` to also get the current\n  cursor position and state as ANSI escape codes (:iss:`3625`)\n\n- Add an option :option:`kitty @ get-text --add-wrap-markers` to add line wrap\n  markers to the output (:pull:`3633`)\n\n- Improve rendering of curly underlines on HiDPI screens (:pull:`3637`)\n\n- ssh kitten: Mimic behavior of ssh command line client more closely by\n  executing any command specified on the command line via the users' shell\n  just as ssh does (:iss:`3638`)\n\n- Fix trailing parentheses in URLs not being detected (:iss:`3688`)\n\n- Tab bar: Use a lower contrast color for tab separators (:pull:`3666`)\n\n- Fix a regression that caused using the ``title`` command in session files\n  to stop working (:iss:`3676`)\n\n- macOS: Fix a rare crash on exit (:iss:`3686`)\n\n- Fix ligatures not working with the `Iosevka\n  <https://github.com/be5invis/Iosevka>`_ font (requires Iosevka >= 7.0.4)\n  (:iss:`297`)\n\n- Remote control: Allow matching tabs by index number in currently active OS\n  Window (:iss:`3708`)\n\n- ssh kitten: Fix non-standard properties in terminfo such as the ones used for\n  true color not being copied (:iss:`312`)\n\n\n0.20.3 [2021-05-06]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Distribute universal binaries with both ARM and Intel architectures\n\n- A new ``show_key`` kitten to easily see the bytes generated by the terminal\n  for key presses in the various keyboard modes (:pull:`3556`)\n\n- Linux: Fix keyboard layout change keys defined via compose rules not being\n  ignored\n\n- macOS: Fix Spotlight search of global menu not working in non-English locales\n  (:pull:`3567`)\n\n- Fix tab activity symbol not appearing if no other changes happen in tab bar even when\n  there is activity in a tab (:iss:`3571`)\n\n- Fix focus changes not being sent to windows when focused window changes\n  because of the previously focused window being closed (:iss:`3571`)\n\n\n0.20.2 [2021-04-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new protocol extension to :ref:`unscroll <unscroll>` text from the\n  scrollback buffer onto the screen. Useful, for example, to restore\n  the screen after showing completions below the shell prompt.\n\n- A new remote control command :ref:`at-env` to change the default\n  environment passed to newly created windows (:iss:`3529`)\n\n- Linux: Fix binary kitty builds not able to load fonts in WOFF2 format\n  (:iss:`3506`)\n\n- macOS: Prevent :kbd:`option` based shortcuts for being used for global menu\n  actions (:iss:`3515`)\n\n- Fix ``kitty @ close-tab`` not working with pipe based remote control\n  (:iss:`3510`)\n\n- Fix removal of inactive tab that is before the currently active tab causing\n  the highlighted tab to be incorrect (:iss:`3516`)\n\n- icat kitten: Respect EXIF orientation when displaying JPEG images\n  (:iss:`3518`)\n\n- GNOME: Fix maximize state not being remembered when focus changes and window\n  decorations are hidden (:iss:`3507`)\n\n- GNOME: Add a new :opt:`wayland_titlebar_color` option to control the color of the\n  kitty window title bar\n\n- Fix reading :option:`kitty --session` from ``STDIN`` not working when the\n  :code:`kitty --detach` option is used (:iss:`3523`)\n\n- Special case rendering of the few remaining Powerline box drawing chars\n  (:iss:`3535`)\n\n- Fix ``kitty @ set-colors`` not working for the :opt:`active_tab_foreground`.\n\n\n0.20.1 [2021-04-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- icat: Fix some broken GIF images with no frame delays not being animated\n  (:iss:`3498`)\n\n- hints kitten: Fix sending hyperlinks to their default handler not working\n  (:pull:`3500`)\n\n- Wayland: Fix regression in previous release causing window decorations to\n  be drawn even when compositor supports server side decorations (:iss:`3501`)\n\n\n0.20.0 [2021-04-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Support display of animated images ``kitty +kitten icat animation.gif``. See\n  :ref:`animation_protocol` for details on animation support in the kitty\n  graphics protocol.\n\n- A new keyboard reporting protocol with various advanced features that can be\n  used by full screen terminal programs and even games, see\n  :doc:`keyboard-protocol` (:iss:`3248`)\n\n- **Backward incompatibility**: Session files now use the full :doc:`launch <launch>`\n  command with all its capabilities. However, the syntax of the command is\n  slightly different from before. In particular watchers are now specified\n  directly on launch and environment variables are set using ``--env``.\n\n- Allow setting colors when creating windows using the :doc:`launch <launch>` command.\n\n- A new option :opt:`tab_powerline_style` to control the appearance of the tab\n  bar when using the powerline tab bar style.\n\n- A new option :opt:`scrollback_fill_enlarged_window` to fill extra lines in\n  the window when the window is expanded with lines from the scrollback\n  (:pull:`3371`)\n\n- diff kitten: Implement recursive diff over SSH (:iss:`3268`)\n\n- ssh kitten: Allow using python instead of the shell on the server, useful if\n  the shell used is a non-POSIX compliant one, such as fish (:iss:`3277`)\n\n- Add support for the color settings stack that XTerm copied from us without\n  acknowledgement and decided to use incompatible escape codes for.\n\n- Add entries to the terminfo file for some user capabilities that are shared\n  with XTerm (:pull:`3193`)\n\n- The launch command now does more sophisticated resolving of executables to\n  run. The system-wide PATH is used first, then system specific default paths,\n  and finally the PATH inside the shell.\n\n- Double clicking on empty tab bar area now opens a new tab (:iss:`3201`)\n\n- kitty @ ls: Show only environment variables that are different for each\n  window, by default.\n\n- When passing a directory or a non-executable file as the program to run to\n  kitty opens it with the shell or by parsing the shebang, instead of just failing.\n\n- Linux: Fix rendering of emoji followed by the graphics variation selector not\n  being colored with some fonts (:iss:`3211`)\n\n- Unicode input: Fix using index in select by name mode not working for indices\n  larger than 16. Also using an index does not filter the list of matches. (:pull:`3219`)\n\n- Wayland: Add support for the text input protocol (:iss:`3410`)\n\n- Wayland: Fix mouse handling when using client side decorations\n\n- Wayland: Fix un-maximizing a window not restoring its size to what it was\n  before being maximized\n\n- GNOME/Wayland: Improve window decorations the titlebar now shows the window\n  title. Allow running under Wayland on GNOME by default. (:iss:`3284`)\n\n- Panel kitten: Allow setting WM_CLASS (:iss:`3233`)\n\n- macOS: Add menu items to close the OS window and the current tab (:pull:`3240`, :iss:`3246`)\n\n- macOS: Allow opening script and command files with kitty (:iss:`3366`)\n\n- Also detect ``gemini://`` URLs when hovering with the mouse (:iss:`3370`)\n\n- When using a non-US keyboard layout and pressing :kbd:`ctrl+key` when\n  the key matches an English key, send that to the program running in the\n  terminal automatically (:iss:`2000`)\n\n- When matching shortcuts, also match on shifted keys, so a shortcut defined as\n  :kbd:`ctrl+plus` will match a keyboard where you have to press\n  :kbd:`shift+equal` to get the plus key (:iss:`2000`)\n\n- Fix extra space at bottom of OS window when using the fat layout with the tab bar at the\n  top (:iss:`3258`)\n\n- Fix window icon not working on X11 with 64bits (:iss:`3260`)\n\n- Fix OS window sizes under 100px resulting in scaled display (:iss:`3307`)\n\n- Fix rendering of ligatures in the latest release of Cascadia code, which for\n  some reason puts empty glyphs after the ligature glyph rather than before it\n  (:iss:`3313`)\n\n- Improve handling of infinite length ligatures in newer versions of FiraCode\n  and CascadiaCode. Now such ligatures are detected based on glyph naming\n  convention. This removes the gap in the ligatures at cell boundaries (:iss:`2695`)\n\n- macOS: Disable the native operating system tabs as they are non-functional\n  and can be confusing (:iss:`3325`)\n\n- hints kitten: When using the linenumber action with a background action,\n  preserve the working directory (:iss:`3352`)\n\n- Graphics protocol: Fix suppression of responses not working for chunked\n  transmission (:iss:`3375`)\n\n- Fix inactive tab closing causing active tab to change (:iss:`3398`)\n\n- Fix a crash on systems using musl as libc (:iss:`3395`)\n\n- Improve rendering of rounded corners by using a rectircle equation rather\n  than a cubic bezier (:iss:`3409`)\n\n- Graphics protocol: Add a control to allow clients to specify that the cursor\n  should not move when displaying an image (:iss:`3411`)\n\n- Fix marking of text not working on lines that contain zero cells\n  (:iss:`3403`)\n\n- Fix the selection getting changed if the screen contents scroll while\n  the selection is in progress (:iss:`3431`)\n\n- X11: Fix :opt:`resize_in_steps` being applied even when window is maximized\n  (:iss:`3473`)\n\n\n0.19.3 [2020-12-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Happy holidays to all kitty users!\n\n- A new :doc:`broadcast <kittens/broadcast>` kitten to type in all kitty windows\n  simultaneously (:iss:`1569`)\n\n- Add a new mappable `select_tab` action to choose a tab to switch to even\n  when the tab bar is hidden (:iss:`3115`)\n\n- Allow specifying text formatting in :opt:`tab_title_template` (:iss:`3146`)\n\n- Linux: Read :opt:`font_features` from the FontConfig database as well, so\n  that they can be configured in a single, central location (:pull:`3174`)\n\n- Graphics protocol: Add support for giving individual image placements their\n  own ids and for asking the terminal emulator to assign ids for images. Also\n  allow suppressing responses from the terminal to commands.\n  These are backwards compatible protocol extensions. (:iss:`3133`,\n  :iss:`3163`)\n\n- Distribute extra pixels among all eight-blocks rather than adding them\n  all to the last block (:iss:`3097`)\n\n- Fix drawing of a few sextant characters incorrect (:pull:`3105`)\n\n- macOS: Fix minimize not working for chromeless windows (:iss:`3112`)\n\n- Preserve lines in the scrollback if a scrolling region is defined that\n  is contiguous with the top of the screen (:iss:`3113`)\n\n- Wayland: Fix key repeat being stopped by the release of an unrelated key\n  (:iss:`2191`)\n\n- Add an option, :opt:`detect_urls` to control whether kitty will detect URLs\n  when the mouse moves over them (:pull:`3118`)\n\n- Graphics protocol: Dont return filename in the error message when opening file\n  fails, since filenames can contain control characters (:iss:`3128`)\n\n- macOS: Partial fix for traditional fullscreen not working on Big Sur\n  (:iss:`3100`)\n\n- Fix one ANSI formatting escape code not being removed from the pager history\n  buffer when piping it as plain text (:iss:`3132`)\n\n- Match the save/restore cursor behavior of other terminals, for the sake of\n  interoperability. This means that doing a DECRC without a prior DECSC is now\n  undefined (:iss:`1264`)\n\n- Fix mapping ``remote_control send-text`` not working (:iss:`3147`)\n\n- Add a ``right`` option for :opt:`tab_switch_strategy` (:pull:`3155`)\n\n- Fix a regression in 0.19.0 that caused a rare crash when using the optional\n  :opt:`scrollback_pager_history_size` (:iss:`3049`)\n\n- Full screen kittens: Fix incorrect cursor position after kitten quits\n  (:iss:`3176`)\n\n\n0.19.2 [2020-11-13]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new :doc:`kittens/query_terminal` kitten to easily query the running kitty\n  via escape codes to detect its version, and the values of\n  configuration options that enable or disable terminal features.\n\n- Options to control mouse pointer shape, :opt:`default_pointer_shape`, and\n  :opt:`pointer_shape_when_dragging` (:pull:`3041`)\n\n- Font independent rendering for braille characters, which ensures they are properly\n  aligned at all font sizes.\n\n- Fix a regression in 0.19.0 that caused borders not to be drawn when setting\n  :opt:`window_margin_width` and keeping :opt:`draw_minimal_borders` on\n  (:iss:`3017`)\n\n- Fix a regression in 0.19.0 that broke rendering of one-eight bar unicode\n  characters at very small font sizes (:iss:`3025`)\n\n- Wayland: Fix a crash under GNOME when using multiple OS windows\n  (:pull:`3066`)\n\n- Fix selections created by dragging upwards not being auto-cleared when\n  screen contents change (:pull:`3028`)\n\n- macOS: Fix kitty not being added to PATH automatically when using pre-built\n  binaries (:iss:`3063`)\n\n- Allow adding MIME definitions to kitty by placing a ``mime.types`` file in\n  the kitty config directory (:iss:`3056`)\n\n- Dont ignore :option:`--title` when using a session file that defines no\n  windows (:iss:`3055`)\n\n- Fix the send_text action not working in URL handlers (:iss:`3081`)\n\n- Fix last character of URL not being detected if it is the only character on a\n  new line (:iss:`3088`)\n\n- Don't restrict the ICH,DCH,REP control codes to only the current scroll region  (:iss:`3090`, :iss:`3096`)\n\n\n0.19.1 [2020-10-06]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- hints kitten: Add an ``ip`` type for easy selection of IP addresses\n  (:pull:`3009`)\n\n- Fix a regression that caused a segfault when using\n  :opt:`scrollback_pager_history_size` and it needs to be expanded (:iss:`3011`)\n\n- Fix update available notifications repeating (:pull:`3006`)\n\n\n0.19.0 [2020-10-04]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add support for `hyperlinks from terminal programs\n  <https://gist.github.com/egmontkob/eb114294efbcd5adb1944c9f3cb5feda>`_.\n  Controlled via :opt:`allow_hyperlinks` (:iss:`68`)\n\n- Add support for easily editing or downloading files over SSH sessions\n  without the need for any special software, see :doc:`kittens/remote_file`\n\n- A new :doc:`kittens/hyperlinked_grep` kitten to easily search files and open\n  the results at the matched line by clicking on them.\n\n- Allow customizing the :doc:`actions kitty takes <open_actions>` when clicking on URLs\n\n- Improve rendering of borders when using minimal borders. Use less space and\n  do not display a box around active windows\n\n- Add a new extensible escape code to allow terminal programs to trigger\n  desktop notifications. See :ref:`desktop_notifications` (:iss:`1474`)\n\n- Implement special rendering for various characters from the set of \"Symbols\n  for Legacy Computing\" from the Unicode 13 standard\n\n- Unicode input kitten: Allow choosing symbols from the NERD font as well.\n  These are mostly Private Use symbols not in any standard, however are common. (:iss:`2972`)\n\n- Allow specifying border sizes in either pts or pixels. Change the default to\n  0.5pt borders as this works best with the new minimal border style\n\n- Add support for displaying correct colors with non-sRGB PNG files (Adds a\n  dependency on liblcms2)\n\n- hints kitten: Add a new :option:`kitty +kitten hints --type` of ``hyperlink`` useful\n  for activating hyperlinks using just the keyboard\n\n- Allow tracking focus change events in watchers (:iss:`2918`)\n\n- Allow specifying watchers in session files and via a command line argument\n  (:iss:`2933`)\n\n- Add a setting :opt:`tab_activity_symbol` to show a symbol in the tab title\n  if one of the windows has some activity after it was last focused\n  (:iss:`2515`)\n\n- macOS: Switch to using the User Notifications framework for notifications.\n  The current notifications framework has been deprecated in Big Sur. The new\n  framework only allows notifications from signed and notarized applications,\n  so people using kitty from homebrew/source are out of luck. Complain to\n  Apple.\n\n- When in the main screen and a program grabs the mouse, do not use the scroll\n  wheel events to scroll the scrollback buffer, instead send them to the\n  program (:iss:`2939`)\n\n- Fix unfocused windows in which a bell occurs not changing their border color\n  to red until a relayout\n\n- Linux: Fix automatic detection of bold/italic faces for fonts such as IBM\n  Plex Mono that have the regular face with a full name that is the same as the\n  family name (:iss:`2951`)\n\n- Fix a regression that broke :opt:`kitten_alias` (:iss:`2952`)\n\n- Fix a regression that broke the ``move_window_to_top`` action (:pull:`2953`)\n\n- Fix a memory leak when changing font sizes\n\n- Fix some lines in the scrollback buffer not being properly rendered after a\n  window resize/font size change (:iss:`2619`)\n\n\n0.18.3 [2020-08-11]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- hints kitten: Allow customizing hint colors (:pull:`2894`)\n\n- Wayland: Fix a typo in the previous release that broke reading mouse cursor size (:iss:`2895`)\n\n- Fix a regression in the previous release that could cause an exception during\n  startup in rare circumstances (:iss:`2896`)\n\n- Fix image leaving behind a black rectangle when switch away and back to\n  alternate screen (:iss:`2901`)\n\n- Fix one pixel mis-alignment of rounded corners when either the cell\n  dimensions or the thickness of the line is an odd number of pixels\n  (:iss:`2907`)\n\n- Fix a regression that broke specifying OS window size in the session file\n  (:iss:`2908`)\n\n\n0.18.2 [2020-07-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- X11: Improve handling of multiple keyboards. Now pressing a modifier key in\n  one keyboard and a normal key in another works (:iss:`2362`). Don't rebuild\n  keymaps on new keyboard events that only change geometry (:iss:`2787`).\n  Better handling of multiple keyboards with incompatible layouts (:iss:`2726`)\n\n- Improve anti-aliasing of triangular box drawing characters, noticeable on\n  low-resolution screens (:iss:`2844`)\n\n- Fix ``kitty @ send-text`` not working reliably when using a socket for remote\n  control (:iss:`2852`)\n\n- Implement support for box drawing rounded-corners characters (:iss:`2240`)\n\n- Allow setting the class for new OS windows in a session file\n\n- When a character from the Unicode Dingbat block is followed by a space, use\n  the extra space to render a larger version of the character (:iss:`2850`)\n\n- macOS: Fix the LC_CTYPE env var being set to UTF-8 on systems in which the\n  language and country code do not form a valid locale (:iss:`1233`)\n\n- macOS: Fix :kbd:`cmd+plus` not changing font size (:iss:`2839`)\n\n- Make neighboring window selection in grid and splits layouts more intelligent\n  (:pull:`2840`)\n\n- Allow passing the current selection to kittens (:iss:`2796`)\n\n- Fix pre-edit text not always being cleared with ibus input (:iss:`2862`)\n\n- Allow setting the :opt:`background_opacity` of new OS windows created via\n  :option:`kitty --single-instance` using the :option:`kitty --override` command line\n  argument (:iss:`2806`)\n\n- Fix the CSI J (Erase in display ED) escape code not removing line continued\n  markers (:iss:`2809`)\n\n- hints kitten: In linenumber mode expand paths that starts with ~\n  (:iss:`2822`)\n\n- Fix ``launch --location=last`` not working (:iss:`2841`)\n\n- Fix incorrect centering when a PUA or symbol glyph is followed by more than one space\n\n- Have the :opt:`confirm_os_window_close` option also apply when closing tabs\n  with multiple windows (:iss:`2857`)\n\n- Add support for legacy DECSET codes 47, 1047 and 1048 (:pull:`2871`)\n\n- macOS: no longer render emoji 20% below the baseline. This caused some emoji\n  to be cut-off and also look misaligned with very high cells (:iss:`2873`)\n\n- macOS: Make the window id of OS windows available in the ``WINDOWID``\n  environment variable (:pull:`2877`)\n\n- Wayland: Fix a regression in 0.18.0 that could cause crashes related to mouse\n  cursors in some rare circumstances (:iss:`2810`)\n\n- Fix change in window size that does not change number of cells not being\n  reported to the kernel (:iss:`2880`)\n\n\n0.18.1 [2020-06-23]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix for diff kitten not working with python 3.8 (:iss:`2780`)\n\n\n0.18.0 [2020-06-20]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow multiple overlay windows per normal window\n\n- Add an option :opt:`confirm_os_window_close` to ask for confirmation\n  when closing an OS window with multiple kitty windows.\n\n- Tall and Fat layouts: Add a ``mirrored`` option to put the full size window\n  on the opposite edge of the screen (:iss:`2654`)\n\n- Tall and Fat layouts: Add mappable actions to increase or decrease the number\n  of full size windows (:iss:`2688`)\n\n- Allow sending arbitrary signals to the current foreground process in a window\n  using either a mapping in kitty.conf or via remote control (:iss:`2778`)\n\n- Allow sending the back and forward mouse buttons to terminal applications\n  (:pull:`2742`)\n\n- **Backwards incompatibility**: The numbers used to encode mouse buttons\n  for the ``send_mouse_event`` function that can be used in kittens have\n  been changed (see :ref:`send_mouse_event`).\n\n- Add a new mappable ``quit`` action to quit kitty completely.\n\n- Fix marks using different colors with regexes using only a single color\n  (:pull:`2663`)\n\n- Linux: Workaround for broken Nvidia drivers for old cards (:iss:`456`)\n\n- Wayland: Fix kitty being killed on some Wayland compositors if a hidden window\n  has a lot of output (:iss:`2329`)\n\n- BSD: Fix controlling terminal not being established (:pull:`2686`)\n\n- Add support for the CSI REP escape code (:pull:`2702`)\n\n- Wayland: Fix mouse cursor rendering on HiDPI screens (:pull:`2709`)\n\n- X11: Recompile keymaps on XkbNewKeyboardNotify events (:iss:`2726`)\n\n- X11: Reduce startup time by ~25% by only querying GLX for framebuffer\n  configurations once (:iss:`2754`)\n\n- macOS: Notarize the kitty application bundle (:iss:`2040`)\n\n- Fix the kitty shell launched via a mapping needlessly requiring\n  :opt:`allow_remote_control` to be turned on.\n\n\n0.17.4 [2020-05-09]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow showing the name of the current layout and the number of windows\n  in tab titles (:iss:`2634`)\n\n- macOS: Fix a regression in the previous release that caused ligatures to be\n  not be centered horizontally (:iss:`2591`)\n\n- By default, double clicking no longer considers the : as part of words, see\n  :opt:`select_by_word_characters` (:iss:`2602`)\n\n- Fix a regression that caused clicking in the padding/margins of windows in\n  the stack layout to switch the window to the first window (:iss:`2604`)\n\n- macOS: Fix a regression that broke drag and drop (:iss:`2605`)\n\n- Report modifier key state when sending wheel events to the terminal program\n\n- Fix kitty @ send-text not working with text larger than 1024 bytes when using\n  :option:`kitty --listen-on` (:iss:`2607`)\n\n- Wayland: Fix OS window title not updating for hidden windows (:iss:`2629`)\n\n- Fix :opt:`background_tint` making the window semi-transparent (:iss:`2618`)\n\n\n0.17.3 [2020-04-23]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow individually setting margins and padding for each edge (left, right,\n  top, bottom). Margins can also be controlled per window via remote control\n  (:iss:`2546`)\n\n- Fix reverse video not being rendered correctly when using transparency or a\n  background image (:iss:`2419`)\n\n- Allow mapping arbitrary remote control commands to key presses in\n  :file:`kitty.conf`\n\n- X11: Fix crash when doing drag and drop from some applications (:iss:`2505`)\n\n- Fix :option:`launch --stdin-add-formatting` not working (:iss:`2512`)\n\n- Update to Unicode 13.0 (:iss:`2513`)\n\n- Render country flags designated by a pair of unicode codepoints\n  in two cells instead of four.\n\n- diff kitten: New option to control the background color for filler lines in\n  the margin (:iss:`2518`)\n\n- Fix specifying options for layouts in the startup session file not working\n  (:iss:`2520`)\n\n- macOS: Fix incorrect horizontal positioning of some full-width East Asian characters\n  (:iss:`1457`)\n\n- macOS: Render multi-cell PUA characters centered, matching behavior on other\n  platforms\n\n- Linux: Ignore keys if they are designated as layout/group/mode switch keys\n  (:iss:`2519`)\n\n- Marks: Fix marks not handling wide characters and tab characters correctly\n  (:iss:`2534`)\n\n- Add a new :opt:`listen_on` option in kitty.conf to set :option:`kitty --listen-on`\n  globally. Also allow using environment variables in this option (:iss:`2569`).\n\n- Allow sending mouse events in kittens (:pull:`2538`)\n\n- icat kitten: Fix display of 16-bit depth images (:iss:`2542`)\n\n- Add ncurses specific terminfo definitions for strikethrough (:pull:`2567`)\n\n- Fix a regression in 0.17 that broke displaying graphics over SSH\n  (:iss:`2568`)\n\n- Fix :option:`--title` not being applied at window creation time (:iss:`2570`)\n\n0.17.2 [2020-03-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a :option:`launch --watcher` option that allows defining callbacks\n  that are called for various events in the window's life-cycle (:iss:`2440`)\n\n- Fix a regression in 0.17 that broke drawing of borders with non-minimal\n  borders (:iss:`2474`)\n\n- Hints kitten: Allow copying to primary selection as well as clipboard\n  (:pull:`2487`)\n\n- Add a new mappable action ``close_other_windows_in_tab`` to close all but the\n  active window (:iss:`2484`)\n\n- Hints kitten: Adjust the default regex used to detect line numbers to handle\n  line+column numbers (:iss:`2268`)\n\n- Fix blank space at the start of tab bar in the powerline style when first tab is\n  inactive (:iss:`2478`)\n\n- Fix regression causing incorrect rendering of separators in tab bar when\n  defining a tab bar background color (:pull:`2480`)\n\n- Fix a regression in 0.17 that broke the kitty @ launch remote command and\n  also broke the --tab-title option when creating a new tab. (:iss:`2488`)\n\n- Linux: Fix selection of fonts with multiple width variants not preferring\n  the normal width faces (:iss:`2491`)\n\n\n0.17.1 [2020-03-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix :opt:`cursor_underline_thickness` not working (:iss:`2465`)\n\n- Fix a regression in 0.17 that caused tab bar background to be rendered after\n  the last tab as well (:iss:`2464`)\n\n- macOS: Fix a regression in 0.17 that caused incorrect variants to be\n  automatically selected for some fonts (:iss:`2462`)\n\n- Fix a regression in 0.17 that caused kitty @ set-colors to require setting\n  cursor_text_color (:iss:`2470`)\n\n\n0.17.0 [2020-03-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- :ref:`splits_layout` to arrange windows in arbitrary splits\n  (:iss:`2308`)\n\n- Add support for specifying a background image, see :opt:`background_image`\n  (:iss:`163` and :pull:`2326`; thanks to Fredrick Brennan.)\n\n- A new :opt:`background_tint` option to darken the background under the text\n  area when using background images and/or transparent windows.\n\n- Allow selection of single cells with the mouse. Also improve mouse selection\n  to follow semantics common to most programs (:iss:`945`)\n\n- New options :opt:`cursor_beam_thickness` and :opt:`cursor_underline_thickness` to control the thickness of the\n  beam and underline cursors (:iss:`2337` and :pull:`2342`)\n\n- When the application running in the terminal grabs the mouse, pass middle\n  clicks to the application unless `terminal_select_modifiers` are\n  pressed (:iss:`2368`)\n\n- A new ``copy_and_clear_or_interrupt`` function (:iss:`2403`)\n\n- X11: Fix arrow mouse cursor using right pointing instead of the default left\n  pointing arrow (:iss:`2341`)\n\n- Allow passing the currently active kitty window id in the launch command\n  (:iss:`2391`)\n\n- unicode input kitten: Allow pressing :kbd:`ctrl+tab` to change the input mode\n  (:iss:`2343`)\n\n- Fix a bug that prevented using custom functions with the new marks feature\n  (:iss:`2344`)\n\n- Make the set of URL prefixes that are recognized while hovering with the\n  mouse configurable (:iss:`2416`)\n\n- Fix border/margin/padding sizes not being recalculated on DPI change\n  (:iss:`2346`)\n\n- diff kitten: Fix directory diffing with removed binary files failing\n  (:iss:`2378`)\n\n- macOS: Fix menubar title not updating on OS Window focus change (:iss:`2350`)\n\n- Fix rendering of combining characters with fonts that have glyphs for\n  precomposed characters but not decomposed versions (:iss:`2365`)\n\n- Fix incorrect rendering of selection when using rectangular select and\n  scrolling (:iss:`2351`)\n\n- Allow setting WM_CLASS and WM_NAME when creating new OS windows with the\n  launch command (:option:`launch --os-window-class`)\n\n- macOS: When switching input method while a pending multi-key input is in\n  progress, clear the pending input (:iss:`2358`)\n\n- Fix a regression in the previous release that broke switching to neighboring windows\n  in the Grid layout when there are less than four windows (:iss:`2377`)\n\n- Fix colors in scrollback pager off if the window has redefined terminal\n  colors using escape codes (:iss:`2381`)\n\n- Fix selection not updating properly while scrolling (:iss:`2442`)\n\n- Allow extending selections by dragging with right button pressed\n  (:iss:`2445`)\n\n- Workaround for bug in less that causes colors to reset at wrapped lines\n  (:iss:`2381`)\n\n- X11/Wayland: Allow drag and drop of text/plain in addition to text/uri-list\n  (:iss:`2441`)\n\n- Dont strip :code:`&` and :code:`-` from the end of URLs (:iss:`2436`)\n\n- Fix ``@selection`` placeholder not working with launch command (:iss:`2417`)\n\n- Drop support for python 3.5\n\n- Wayland: Fix a crash when drag and dropping into kitty (:iss:`2432`)\n\n- diff kitten: Fix images lingering as blank rectangles after the kitten quits\n  (:iss:`2449`)\n\n- diff kitten: Fix images losing position when scrolling using mouse\n  wheel/touchpad\n\n\n0.16.0 [2020-01-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new :doc:`marks` feature that allows highlighting and scrolling to arbitrary\n  text in the terminal window.\n\n- hints kitten: Allow pressing :sc:`goto_file_line` to quickly open\n  the selected file at the selected line in vim or a configurable editor (:iss:`2268`)\n\n- Allow having more than one full height window in the :code:`tall` layout\n  (:iss:`2276`)\n\n- Allow choosing OpenType features for individual fonts via the\n  :opt:`font_features` option. (:pull:`2248`)\n\n- Wayland: Fix a freeze in rare circumstances when having multiple OS Windows\n  (:iss:`2307` and :iss:`1722`)\n\n- Wayland: Fix window titles being set to very long strings on the order of 8KB\n  causing a crash (:iss:`1526`)\n\n- Add an option :opt:`force_ltr` to turn off the display of text in RTL scripts\n  in right-to-left order (:pull:`2293`)\n\n- Allow opening new tabs/windows before the current tab/window as well as after\n  it with the :option:`launch --location` option.\n\n- Add a :opt:`resize_in_steps` option that can be used to resize the OS window\n  in steps as large as character cells (:pull:`2131`)\n\n- When triple-click+dragging to select multiple lines, extend the selection\n  of the first line to match the rest on the left (:pull:`2284`)\n\n- macOS: Add a :code:`titlebar-only` setting to\n  :opt:`hide_window_decorations` to only hide the title bar (:pull:`2286`)\n\n- Fix a segfault when using ``--debug-config`` with maps (:iss:`2270`)\n\n- ``goto_tab`` now maps numbers larger than the last tab to the last tab\n  (:iss:`2291`)\n\n- Fix URL detection not working for urls of the form scheme:///url\n  (:iss:`2292`)\n\n- When windows are semi-transparent and all contain graphics, correctly render\n  them. (:iss:`2310`)\n\n0.15.1 [2019-12-21]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix a crash/incorrect rendering when detaching a window in some circumstances\n  (:iss:`2173`)\n\n- hints kitten: Add an option :option:`kitty +kitten hints --ascending` to\n  control if the hints numbers increase or decrease from top to bottom\n\n- Fix :opt:`background_opacity` incorrectly applying to selected text and\n  reverse video text (:iss:`2177`)\n\n- Add a new option :opt:`tab_bar_background` to specify a different color\n  for the tab bar (:iss:`2198`)\n\n- Add a new option :opt:`active_tab_title_template` to specify a different\n  template for active tab titles (:iss:`2198`)\n\n- Fix lines at the edge of the window at certain windows sizes when drawing\n  images on a transparent window (:iss:`2079`)\n\n- Fix window not being rendered for the first time until some input has been\n  received from child process (:iss:`2216`)\n\n\n0.15.0 [2019-11-27]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a new action :ref:`detach_window <detach_window>` that can be used to move the current\n  window into a different tab (:iss:`1310`)\n\n- Add a new action :doc:`launch <launch>` that unifies launching of processes\n  in new kitty windows/tabs.\n\n- Add a new style ``powerline`` for tab bar rendering, see :opt:`tab_bar_style` (:pull:`2021`)\n\n- Allow changing colors by mapping a keyboard shortcut to read a kitty config\n  file with color definitions. See the :doc:`FAQ <faq>` for details\n  (:iss:`2083`)\n\n- hints kitten: Allow completely customizing the matching and actions performed\n  by the kitten using your own script (:iss:`2124`)\n\n- Wayland: Fix key repeat not being stopped when focus leaves window. This is\n  expected behavior on Wayland, apparently (:iss:`2014`)\n\n- When drawing unicode symbols that are followed by spaces, use multiple cells\n  to avoid resized or cut-off glyphs (:iss:`1452`)\n\n- diff kitten: Allow diffing remote files easily via ssh (:iss:`727`)\n\n- unicode input kitten: Add an option :option:`kitty +kitten unicode_input\n  --emoji-variation` to control the presentation variant of selected emojis\n  (:iss:`2139`)\n\n- Add specialised rendering for a few more box powerline and unicode symbols\n  (:pull:`2074` and :pull:`2021`)\n\n- Add a new socket only mode for :opt:`allow_remote_control`. This makes\n  it possible for programs running on the local machine to control kitty\n  but not programs running over ssh.\n\n- hints kitten: Allow using named groups in the regular expression. The named\n  groups are passed to the invoked program for further processing.\n\n- Fix a regression in 0.14.5 that caused rendering of private use glyphs\n  with and without spaces to be identical (:iss:`2117`)\n\n- Wayland: Fix incorrect scale used when first creating an OS window\n  (:iss:`2133`)\n\n- macOS: Disable mouse hiding by default as getting it to work robustly\n  on Cocoa is too much effort (:iss:`2158`)\n\n\n0.14.6 [2019-09-25]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix a regression in the previous release that caused a crash when\n  pressing a unprintable key, such as the POWER key (:iss:`1997`)\n\n- Fix a regression in the previous release that caused kitty to not always\n  respond to DPI changes (:pull:`1999`)\n\n\n0.14.5 [2019-09-23]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Implement a hack to (mostly) preserve tabs when cat-ting a file with them and then\n  copying the text or passing screen contents to another program (:iss:`1829`)\n\n- When all visible windows have the same background color, use that as the\n  color for the global padding, instead of the configured background color\n  (:iss:`1957`)\n\n- When resetting the terminal, also reset parser state, this allows easy\n  recovery from incomplete escape codes (:iss:`1961`)\n\n- Allow mapping keys commonly found on European keyboards (:pull:`1928`)\n\n- Fix incorrect rendering of some symbols when followed by a space while using\n  the PowerLine font which does not have a space glyph (:iss:`1225`)\n\n- Linux: Allow using fonts with spacing=90 in addition to fonts with\n  spacing=100 (:iss:`1968`)\n\n- Use selection foreground color for underlines as well (:iss:`1982`)\n\n0.14.4 [2019-08-31]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- hints kitten: Add a :option:`kitty +kitten hints --alphabet` option to\n  control what alphabets are used for hints (:iss:`1879`)\n\n- hints kitten: Allow specifying :option:`kitty +kitten hints --program`\n  multiple times to run multiple programs  (:iss:`1879`)\n\n- Add a :opt:`kitten_alias` option that can be used to alias kitten invocation\n  for brevity and to change kitten option defaults globally (:iss:`1879`)\n\n- macOS: Add an option :opt:`macos_show_window_title_in` to control\n  showing the window title in the menubar/titlebar (:pull:`1837`)\n\n- macOS: Allow drag and drop of text from other applications into kitty\n  (:pull:`1921`)\n\n- When running kittens, use the colorscheme of the current window\n  rather than the configured colorscheme (:iss:`1906`)\n\n- Don't fail to start if running the shell to read the EDITOR env var fails\n  (:iss:`1869`)\n\n- Disable the ``liga`` and ``dlig`` OpenType features for broken fonts\n  such as Nimbus Mono.\n\n- Fix a regression that broke setting background_opacity via remote control\n  (:iss:`1895`)\n\n- Fix piping PNG images into the icat kitten not working (:iss:`1920`)\n\n- When the OS returns a fallback font that does not actually contain glyphs\n  for the text, do not exhaust the list of fallback fonts (:iss:`1918`)\n\n- Fix formatting attributes not reset across line boundaries when passing\n  buffer as ANSI (:iss:`1924`)\n\n\n0.14.3 [2019-07-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Remote control: Add a command `kitty @ scroll-window` to scroll windows\n\n- Allow passing a ``!neighbor`` argument to the new_window mapping to open a\n  new window next to the active window (:iss:`1746`)\n\n- Document the kitty remote control protocol (:iss:`1646`)\n\n- Add a new option :opt:`pointer_shape_when_grabbed` that allows you to control\n  the mouse pointer shape when the terminal programs grabs the pointer\n  (:iss:`1808`)\n\n- Add an option `terminal_select_modifiers` to control which modifiers\n  are used to override mouse selection even when a terminal application has\n  grabbed the mouse (:iss:`1774`)\n\n- When piping data to a child in the pipe command do it in a thread so as not\n  to block the UI (:iss:`1708`)\n\n- unicode_input kitten: Fix a regression that broke using indices to select\n  recently used symbols.\n\n- Fix a regression that caused closing an overlay window to focus\n  the previously focused window rather than the underlying window (:iss:`1720`)\n\n- macOS: Reduce energy consumption when idle by shutting down Apple's display\n  link thread after 30 second of inactivity (:iss:`1763`)\n\n- Linux: Fix incorrect scaling for fallback fonts when the font has an\n  underscore that renders out of bounds (:iss:`1713`)\n\n- macOS: Fix finding fallback font for private use unicode symbols not working\n  reliably (:iss:`1650`)\n\n- Fix an out of bounds read causing a crash when selecting text with the mouse\n  in the alternate screen mode (:iss:`1578`)\n\n- Linux: Use the system \"bell\" sound for the terminal bell. Adds libcanberra\n  as a new dependency to play the system sound.\n\n- macOS: Fix a rare deadlock causing kitty to hang (:iss:`1779`)\n\n- Linux: Fix a regression in 0.14.0 that caused the event loop to tick\n  continuously, wasting CPU even when idle (:iss:`1782`)\n\n- ssh kitten: Make argument parsing more like ssh (:iss:`1787`)\n\n- When using :opt:`strip_trailing_spaces` do not remove empty lines\n  (:iss:`1802`)\n\n- Fix a crash when displaying very large number of images (:iss:`1825`)\n\n\n0.14.2 [2019-06-09]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option :opt:`placement_strategy` to control how the cell area is\n  aligned inside the window when the window size is not an exact multiple\n  of the cell size (:pull:`1670`)\n\n- hints kitten: Add a :option:`kitty +kitten hints --multiple-joiner` option to\n  control how multiple selections are serialized when copying to clipboard\n  or inserting into the terminal. You can have them on separate lines,\n  separated by arbitrary characters, or even serialized as JSON (:iss:`1665`)\n\n- macOS: Fix a regression in the previous release that broke using\n  :kbd:`ctrl+shift+tab` (:iss:`1671`)\n\n- panel kitten: Fix the contents of the panel kitten not being positioned\n  correctly on the vertical axis\n\n- icat kitten: Fix a regression that broke passing directories to icat\n  (:iss:`1683`)\n\n- clipboard kitten: Add a :option:`kitty +kitten clipboard --wait-for-completion`\n  option to have the kitten wait till copying to clipboard is complete\n  (:iss:`1693`)\n\n- Allow using the :doc:`pipe <pipe>` command to send screen and scrollback\n  contents directly to the clipboard (:iss:`1693`)\n\n- Linux: Disable the Wayland backend on GNOME by default as GNOME has no\n  support for server side decorations. Can be controlled by\n  :opt:`linux_display_server`.\n\n- Add an option to control the default :opt:`update_check_interval` when\n  building kitty packages\n\n- Wayland: Fix resizing the window on a compositor that does not provide\n  server side window decorations, such a GNOME or Weston not working\n  correctly (:iss:`1659`)\n\n- Wayland: Fix crash when enabling disabling monitors on sway (:iss:`1696`)\n\n\n0.14.1 [2019-05-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option :opt:`command_on_bell` to run an arbitrary command when\n  a bell occurs (:iss:`1660`)\n\n- Add a shortcut to toggle maximized window state :sc:`toggle_maximized`\n\n- Add support for the underscore key found in some keyboard layouts\n  (:iss:`1639`)\n\n- Fix a missing newline when using the pipe command between the\n  scrollback and screen contents (:iss:`1642`)\n\n- Fix colors not being preserved when using the pipe command with\n  the pager history buffer (:pull:`1657`)\n\n- macOS: Fix a regression that could cause rendering of a kitty window\n  to occasionally freeze in certain situations, such as moving it between\n  monitors or transitioning from/to fullscreen (:iss:`1641`)\n\n- macOS: Fix a regression that caused :kbd:`cmd+v` to double up in the dvorak\n  keyboard layout (:iss:`1652`)\n\n- When resizing and only a single window is present in the current layout,\n  use that window's background color to fill in the blank areas.\n\n- Linux: Automatically increase cell height if the font being used is broken\n  and draws the underscore outside the bounding box (:iss:`690`)\n\n- Wayland: Fix maximizing the window on a compositor that does not provide\n  server side window decorations, such a GNOME or Weston not working\n  (:iss:`1662`)\n\n\n0.14.0 [2019-05-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: The default behavior of the Option key has changed. It now generates\n  unicode characters rather than acting as the :kbd:`Alt` modifier. See\n  :opt:`macos_option_as_alt`.\n\n- Support for an arbitrary number of internal clipboard buffers to copy/paste\n  from, see (:ref:`cpbuf`)\n\n- Allow using the new private internal clipboard buffers with the\n  :opt:`copy_on_select` option (:iss:`1390`)\n\n- macOS: Allow opening new kitty tabs/top-level windows from Finder\n  (:pull:`1350`)\n\n- Add an option :opt:`disable_ligatures` to disable\n  multi-character ligatures under the cursor to make editing easier\n  or disable them completely (:iss:`461`)\n\n- Allow creating new OS windows in session files (:iss:`1514`)\n\n- Allow setting OS window size in session files\n\n- Add an option :opt:`tab_switch_strategy` to control which\n  tab becomes active when the current tab is closed (:pull:`1524`)\n\n- Allow specifying a value of ``none`` for the :opt:`selection_foreground`\n  which will cause kitty to not change text color in selections (:iss:`1358`)\n\n- Make live resizing of OS windows smoother and add an option\n  :opt:`resize_draw_strategy` to control what is drawn while a\n  resize is in progress.\n\n- macOS: Improve handling of IME extended input. Compose characters\n  are now highlighted and the IME panel moves along with the text\n  (:pull:`1586`). Also fixes handling of delete key in Chinese IME\n  (:iss:`1461`)\n\n- When a window is closed, switch focus to the previously active window (if\n  any) instead of picking the previous window in the layout (:iss:`1450`)\n\n- icat kitten: Add support for displaying images at http(s) URLs (:iss:`1340`)\n\n- A new option :opt:`strip_trailing_spaces` to optionally remove trailing\n  spaces from lines when copying to clipboard.\n\n- A new option :opt:`tab_bar_min_tabs` to control how many tabs must be\n  present before the tab-bar is shown (:iss:`1382`)\n\n- Automatically check for new releases and notify when an update is available,\n  via the system notification facilities. Can be controlled by\n  :opt:`update_check_interval` (:iss:`1342`)\n\n- macOS: Fix :kbd:`cmd+period` key not working (:iss:`1318`)\n\n- macOS: Add an option `macos_show_window_title_in_menubar` to not\n  show the current window title in the menu-bar (:iss:`1066`)\n\n- macOS: Workaround for cocoa bug that could cause the mouse cursor to become\n  hidden in other applications in rare circumstances (:iss:`1218`)\n\n- macOS: Allow assigning only the left or right :kbd:`Option` key to work as the\n  :kbd:`Alt` key. See :opt:`macos_option_as_alt` for details (:iss:`1022`)\n\n- Fix using remote control to set cursor text color causing errors when\n  creating new windows (:iss:`1326`)\n\n- Fix window title for minimized windows not being updated (:iss:`1332`)\n\n- macOS: Fix using multi-key sequences to input text ignoring the\n  first few key presses if the sequence is aborted (:iss:`1311`)\n\n- macOS: Add a number of common macOS keyboard shortcuts\n\n- macOS: Reduce energy consumption by not rendering occluded windows\n\n- Fix scrollback pager history not being cleared when clearing the\n  main scrollback buffer (:iss:`1387`)\n\n- macOS: When closing a top-level window only switch focus to the previous kitty\n  window if it is on the same workspace (:iss:`1379`)\n\n- macOS: Fix :opt:`sync_to_monitor` not working on Mojave.\n\n- macOS: Use the system cursor blink interval by default\n  :opt:`cursor_blink_interval`.\n\n- Wayland: Use the kitty Wayland backend by default. Can be switched back\n  to using XWayland by setting the environment variable:\n  ``KITTY_DISABLE_WAYLAND=1``\n\n- Add a ``no-append`` setting to :opt:`clipboard_control` to disable\n  the kitty copy concatenation protocol extension for OSC 52.\n\n- Update to using the Unicode 12 standard\n\n- Unicode input kitten: Allow using the arrow keys in code mode to go to next\n  and previous unicode symbol.\n\n- macOS: Fix specifying initial window size in cells not working correctly on\n  Retina screens (:iss:`1444`)\n\n- Fix a regression in version 0.13.0 that caused background colors of space\n  characters after private use unicode characters to not be respected\n  (:iss:`1455`)\n\n- Only update the selected text to clipboard when the selection is finished,\n  not continuously as it is updated. (:iss:`1460`)\n\n- Allow setting :opt:`active_border_color` to ``none`` to not draw a border\n  around the active window (:iss:`805`)\n\n- Use negative values for :opt:`mouse_hide_wait` to hide the mouse cursor\n  immediately when pressing a key (:iss:`1534`)\n\n- When encountering errors in :file:`kitty.conf` report them to the user\n  instead of failing to start.\n\n- Allow the user to control the resize debounce time via\n  :opt:`resize_debounce_time`.\n\n- Remote control: Make the :ref:`at-set-font-size` command more capable.\n  It can now increment font size and reset it. It also only acts on the\n  active top-level window, by default (:iss:`1581`)\n\n- When launching child processes set the :code:`PWD` environment variable\n  (:iss:`1595`)\n\n- X11: use the window manager's native full-screen implementation when\n  making windows full-screen (:iss:`1605`)\n\n- Mouse selection: When extending by word, fix extending selection to non-word\n  characters not working well (:iss:`1616`)\n\n0.13.3 [2019-01-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- icat kitten: Add a ``--stdin`` option to control if image data is read from\n  STDIN (:iss:`1308`)\n\n- hints kitten: Start hints numbering at one instead of zero by default. Added\n  an option ``--hints-offset`` to control it. (:iss:`1289`)\n\n- Fix a regression in the previous release that broke using ``background`` for\n  :opt:`cursor_text_color` (:iss:`1288`)\n\n- macOS: Fix dragging kitty window tabs in traditional full screen mode causing\n  crashes (:iss:`1296`)\n\n- macOS: Ensure that when running from a bundle, the bundle kitty exe is\n  preferred over any kitty in PATH (:iss:`1280`)\n\n- macOS: Fix a regression that broke mapping of :kbd:`ctrl+tab` (:iss:`1304`)\n\n- Add a list of user-created kittens to the docs\n\n- Fix a regression that broke changing mouse wheel scroll direction with\n  negative :opt:`wheel_scroll_multiplier` values in full-screen applications\n  like vim (:iss:`1299`)\n\n- Fix :opt:`background_opacity` not working with pure white backgrounds\n  (:iss:`1285`)\n\n- macOS: Fix \"New OS Window\" dock action not working when kitty is not focused\n  (:iss:`1312`)\n\n- macOS: Add aliases for close window and new tab actions that conform to common\n  Apple shortcuts for these actions (:iss:`1313`)\n\n- macOS: Fix some kittens causing 100% CPU usage\n\n\n0.13.2 [2019-01-04]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a new option :opt:`tab_title_template` to control how tab titles\n  are formatted. In particular the template can be used to display\n  the tab number next to the title (:iss:`1223`)\n\n- Report the current foreground processes as well as the original child process,\n  when using `kitty @ ls`\n\n- Use the current working directory of the foreground process for the\n  `*_with_cwd` actions that open a new window with the current working\n  directory.\n\n- Add a new ``copy_or_interrupt`` action that can be mapped to kbd:`ctrl+c`. It\n  will copy if there is a selection and interrupt otherwise (:iss:`1286`)\n\n- Fix setting :opt:`background_opacity` causing window margins/padding to be slightly\n  different shade from background (:iss:`1221`)\n\n- Handle keyboards with a \"+\" key (:iss:`1224`)\n\n- Fix Private use Unicode area characters followed by spaces at the end of text\n  not being rendered correctly (:iss:`1210`)\n\n- macOS: Add an entry to the dock menu to open a new OS window (:iss:`1242`)\n\n- macOS: Fix scrolling very slowly with wheel mice not working (:iss:`1238`)\n\n- Fix changing :opt:`cursor_text_color` via remote control not working\n  (:iss:`1229`)\n\n- Add an action to resize windows that can be mapped to shortcuts in :file:`kitty.conf`\n  (:pull:`1245`)\n\n- Fix using the ``new_tab !neighbor`` action changing the order of the\n  non-neighboring tabs (:iss:`1256`)\n\n- macOS: Fix momentum scrolling continuing when changing the active window/tab\n  (:iss:`1267`)\n\n\n0.13.1 [2018-12-06]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix passing input via the pipe action to a program without a window not\n  working.\n\n- Linux: Fix a regression in the previous release that caused automatic\n  selection of bold/italic fonts when using aliases such as \"monospace\" to not\n  work (:iss:`1209`)\n\n- Fix resizing window smaller and then restoring causing some wrapped lines to not\n  be properly unwrapped (:iss:`1206`)\n\n0.13.0 [2018-12-05]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option :opt:`scrollback_pager_history_size` to tell kitty to store\n  extended scrollback to use when viewing the scrollback buffer in a pager\n  (:iss:`970`)\n\n- Modify the kittens sub-system to allow creating custom kittens without any\n  user interface. This is useful for creating more complex actions that can\n  be bound to key presses in :file:`kitty.conf`. See\n  doc:`kittens/custom`. (:iss:`870`)\n\n- Add a new ``nth_window`` action that can be used to go to the nth window and\n  also previously active windows, using negative numbers. Similarly,\n  ``goto_tab`` now accepts negative numbers to go to previously active tabs\n  (:iss:`1040`)\n\n- Allow hiding the tab bar completely, by setting :opt:`tab_bar_style` to\n  ``hidden``. (:iss:`1014`)\n\n- Allow private use unicode characters to stretch over more than a single\n  neighboring space (:pull:`1036`)\n\n- Add a new :opt:`touch_scroll_multiplier` option to modify the amount\n  scrolled by high precision scrolling devices such as touchpads (:pull:`1129`)\n\n- icat kitten: Implement reading image data from STDIN, if STDIN is not\n  connected to a terminal (:iss:`1130`)\n\n- hints kitten: Insert trailing spaces after matches when using the\n  ``--multiple`` option. Also add a separate ``--add-trailing-space``\n  option to control this behavior (:pull:`1132`)\n\n- Fix the ``*_with_cwd`` actions using the cwd of the overlay window rather\n  than the underlying window's cwd (:iss:`1045`)\n\n- Fix incorrect key repeat rate on wayland (:pull:`1055`)\n\n- macOS: Fix drag and drop of files not working on Mojave (:iss:`1058`)\n\n- macOS: Fix IME input for East Asian languages (:iss:`910`)\n\n- macOS: Fix rendering frames-per-second very low when processing\n  large amounts of input in small chunks (:pull:`1082`)\n\n- macOS: Fix incorrect text sizes calculated when using an external display\n  that is set to mirror the main display (:iss:`1056`)\n\n- macOS: Use the system default double click interval (:pull:`1090`)\n\n- macOS: Fix touch scrolling sensitivity low on retina screens (:iss:`1112`)\n\n- Linux: Fix incorrect rendering of some fonts when hinting is disabled at\n  small sizes (:iss:`1173`)\n\n- Linux: Fix match rules used as aliases in Fontconfig configuration not being\n  respected (:iss:`1085`)\n\n- Linux: Fix a crash when using the GNU Unifont as a fallback font\n  (:iss:`1087`)\n\n- Wayland: Fix copying from hidden kitty windows hanging (:iss:`1051`)\n\n- Wayland: Add support for the primary selection protocol\n  implemented by some compositors (:pull:`1095`)\n\n- Fix expansion of env vars not working in the :opt:`env` directive\n  (:iss:`1075`)\n\n- Fix :opt:`mouse_hide_wait` only taking effect after an event such as cursor\n  blink or key press (:iss:`1073`)\n\n- Fix the ``set_background_opacity`` action not working correctly\n  (:pull:`1147`)\n\n- Fix second cell of emoji created using variation selectors not having\n  the same attributes as the first cell (:iss:`1109`)\n\n- Fix focusing neighboring windows in the grid layout with less than 4 windows\n  not working (:iss:`1115`)\n\n- Fix :kbd:`ctrl+shift+special` key not working in normal and application keyboard\n  modes (:iss:`1114`)\n\n- Add a terminfo entry for full keyboard mode.\n\n- Fix incorrect text-antialiasing when using very low background opacity\n  (:iss:`1005`)\n\n- When double or triple clicking ignore clicks if they are \"far\" from each\n  other (:iss:`1093`)\n\n- Follow xterm's behavior for the menu key (:iss:`597`)\n\n- Fix hover detection of URLs not working when hovering over the first colon\n  and slash characters in short URLs (:iss:`1201`)\n\n0.12.3 [2018-09-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- macOS: Fix kitty window not being rendered on macOS Mojave until the window is\n  moved or resized at least once (:iss:`887`)\n\n- Unicode input: Fix an error when searching for the string 'fir' (:iss:`1035`)\n\n\n0.12.2 [2018-09-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new ``last_used_layout`` function that can be mapped to a shortcut to\n  switch to the previously used window layout (:iss:`870`)\n\n- New ``neighboring_window`` and ``move_window`` functions to switch to\n  neighboring windows in the current layout, and move them around, similar to\n  window movement in vim (:iss:`916`)\n\n- A new ``pipe`` function that can be used to pipe the contents of the screen\n  and scrollback buffer to any desired program running in a new window, tab or\n  overlay window. (:iss:`933`)\n\n- Add a new :option:`kitty --start-as` command line flag to start kitty\n  full-screen/maximized/minimized. This replaces the ``--start-in-fullscreen``\n  flag introduced in the previous release (:iss:`935`)\n\n- When mapping the ``new_tab`` action allow specifying that the tab should open\n  next to the current tab instead of at the end of the tabs list (:iss:`979`)\n\n- macOS: Add a new :opt:`macos_thicken_font` to make text rendering\n  on macs thicker, which makes it similar to the result of\n  sub-pixel antialiasing (:pull:`950`)\n\n- macOS: Add an option :opt:`macos_traditional_fullscreen` to make\n  full-screening of kitty windows much faster, but less pretty. (:iss:`911`)\n\n- Fix a bug causing incorrect line ordering when viewing the scrollback buffer\n  if the scrollback buffer is full (:iss:`960`)\n\n- Fix drag-scrolling not working when the mouse leaves the window confines\n  (:iss:`917`)\n\n- Workaround for broken editors like nano that cannot handle newlines in pasted text\n  (:iss:`994`)\n\n- Linux: Ensure that the python embedded in the kitty binary build uses\n  UTF-8 mode to process command-line arguments (:iss:`924`)\n\n- Linux: Handle fonts that contain monochrome bitmaps (such as the Terminus TTF\n  font) (:pull:`934`)\n\n- Have the :option:`kitty --title` flag apply to all windows created\n  using :option:`kitty --session` (:iss:`921`)\n\n- Revert change for backspacing of wide characters in the previous release,\n  as it breaks backspacing in some wide character aware programs (:iss:`875`)\n\n- Fix kitty @set-colors not working for tab backgrounds when using the `fade` tabbar style\n  (:iss:`937`)\n\n- macOS: Fix resizing semi-transparent windows causing the windows to be\n  invisible during the resize (:iss:`941`)\n\n- Linux: Fix window icon not set on X11 for the first OS window (:iss:`961`)\n\n- macOS: Add an :opt:`macos_custom_beam_cursor` option to use a special\n  mouse cursor image that can be seen on both light and dark backgrounds\n  (:iss:`359`)\n\n- Remote control: Fix the ``focus_window`` command not focusing the\n  top-level OS window of the specified kitty window (:iss:`1003`)\n\n- Fix using :opt:`focus_follows_mouse` causing text selection with the\n  mouse to malfunction when using multiple kitty windows (:iss:`1002`)\n\n0.12.1 [2018-09-08]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a new ``--start-in-fullscreen`` command line flag to start\n  kitty in full screen mode (:iss:`856`)\n\n- macOS: Fix a character that cannot be rendered in any font causing\n  font fallback for all subsequent characters that cannot be rendered in the\n  main font to fail (:iss:`799`)\n\n- Linux: Do not enable IME input via ibus unless the ``GLFW_IM_MODULE=ibus``\n  environment variable is set. IME causes key processing latency and even\n  missed keystrokes for many people, so it is now off by default.\n\n- Fix backspacing of wide characters in wide-character unaware programs not working (:iss:`875`)\n\n- Linux: Fix number pad arrow keys not working when Numlock is off (:iss:`857`)\n\n- Wayland: Implement support for clipboard copy/paste (:iss:`855`)\n\n- Allow mapping shortcuts using the raw key code from the OS (:iss:`848`)\n\n- Allow mapping of individual key-presses without modifiers as shortcuts\n\n- Fix legacy invocation of icat as `kitty icat` not working (:iss:`850`)\n\n- Improve rendering of wavy underline at small font sizes (:iss:`853`)\n\n- Fix a regression in 0.12.0 that broke dynamic resizing of layouts (:iss:`860`)\n\n- Wayland: Allow using the :code:`kitty --class` command line flag\n  to set the app id (:iss:`862`)\n\n- Add completion of the kitty command for the fish shell (:pull:`829`)\n\n- Linux: Fix XCompose rules with no defined symbol not working (:iss:`880`)\n\n- Linux: Fix crash with some Nvidia drivers when creating tabs in the first\n  top level-window after creating a second top-level window. (:iss:`873`)\n\n- macOS: Diff kitten: Fix syntax highlighting not working because of\n  a bug in the 0.12.0 macOS package\n\n0.12.0 [2018-09-01]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Preserve the mouse selection even when the contents of the screen are\n  scrolled or overwritten provided the new text does not intersect the\n  selected lines.\n\n- Linux: Implement support for Input Method Extensions (multilingual input\n  using standard keyboards) via `IBus\n  <https://github.com/ibus/ibus/wiki/ReadMe>`_ (:iss:`469`)\n\n- Implement completion for the kitty command in bash and zsh. See\n  :ref:`shell_integration`.\n\n- Render the text under the cursor in a fixed color, configurable via\n  the option :opt:`cursor_text_color` (:iss:`126`)\n\n- Add an option :opt:`env` to set environment variables in child processes\n  from kitty.conf\n\n- Add an action to the ``clear_terminal`` function to scroll the screen\n  contents into the scrollback buffer (:iss:`1113`)\n\n- Implement high precision scrolling with the trackpad on platforms such as\n  macOS and Wayland that implement it. (:pull:`819`)\n\n- macOS: Allow scrolling window contents using mouse wheel/trackpad even when the\n  window is not the active window (:iss:`729`)\n\n- Remote control: Allow changing the current window layout with a new\n  :ref:`at-goto-layout` command (:iss:`845`)\n\n- Remote control: Allow matching windows by the environment variables of their\n  child process as well\n\n- Allow running kittens via the remote control system (:iss:`738`)\n\n- Allow enabling remote control in only some kitty windows\n\n- Add a keyboard shortcut to reset the terminal (:sc:`reset_terminal`). It\n  takes parameters so you can define your own shortcuts to clear the\n  screen/scrollback also (:iss:`747`)\n\n- Fix one-pixel line appearing at window edges at some window sizes when\n  displaying images with background opacity enabled (:iss:`741`)\n\n- diff kitten: Fix error when right hand side file is binary and left hand side\n  file is text (:pull:`752`)\n\n- kitty @ new-window: Add a new option :option:`kitty @ new-window --window-type`\n  to create top-level OS windows (:iss:`770`)\n\n- macOS: The :opt:`focus_follows_mouse` option now also works across top-level kitty OS windows\n  (:iss:`754`)\n\n- Fix detection of URLs in HTML source code (URLs inside quotes) (:iss:`785`)\n\n- Implement support for emoji skin tone modifiers (:iss:`787`)\n\n- Round-trip the zwj unicode character. Rendering of sequences containing zwj\n  is still not implemented, since it can cause the collapse of an unbounded\n  number of characters into a single cell. However, kitty at least preserves\n  the zwj by storing it as a combining character.\n\n- macOS: Disable the custom mouse cursor. Using a custom cursor fails on dual\n  GPU machines. I give up, Apple users will just have to live with the\n  limitations of their choice of OS. (:iss:`794`)\n\n- macOS: Fix control+tab key combination not working (:iss:`801`)\n\n- Linux: Fix slow startup on some systems caused by GLFW searching for\n  joysticks. Since kitty does not use joysticks, disable joystick support.\n  (:iss:`830`)\n\n\n0.11.3 [2018-07-10]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Draw only the minimum borders needed for inactive windows. That is only the borders\n  that separate the inactive window from a neighbor. Note that setting\n  a non-zero window margin overrides this and causes all borders to be drawn.\n  The old behavior of drawing all borders can be restored via the\n  :opt:`draw_minimal_borders` setting in kitty.conf. (:iss:`699`)\n\n- macOS: Add an option :opt:`macos_window_resizable` to control if kitty\n  top-level windows are resizable using the mouse or not (:iss:`698`)\n\n- macOS: Use a custom mouse cursor that shows up well on both light and dark backgrounds\n  (:iss:`359`)\n\n- macOS: Workaround for switching from fullscreen to windowed mode with the\n  titlebar hidden causing window resizing to not work. (:iss:`711`)\n\n- Fix triple-click to select line not working when the entire line is filled\n  (:iss:`703`)\n\n- When dragging to select with the mouse \"grab\" the mouse so that if it strays\n  into neighboring windows, the selection is still updated (:pull:`624`)\n\n- When clicking in the margin/border area of a window, map the click to the\n  nearest cell in the window. Avoids selection with the mouse failing when\n  starting the selection just outside the window.\n\n- When drag-scrolling stop the scroll when the mouse button is released.\n\n- Fix a regression in the previous release that caused pasting large amounts\n  of text to be duplicated (:iss:`709`)\n\n\n0.11.2 [2018-07-01]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Linux: Allow using XKB key names to bind shortcuts to keys not supported by GLFW (:pull:`665`)\n\n- kitty shell: Ignore failure to read readline history file. Happens if the\n  user migrates their kitty cache directory between systems with incompatible\n  readline implementations.\n\n- macOS: Fix an error in remote control when using --listen-on (:iss:`679`)\n\n- hints kitten: Add a :option:`kitty +kitten hints --multiple` option to select\n  multiple items (:iss:`687`)\n\n- Fix pasting large amounts of text very slow (:iss:`682`)\n\n- Add an option :opt:`single_window_margin_width` to allow different margins\n  when only a single window is visible in the layout (:iss:`688`)\n\n- Add a :option:`kitty --hold` command line option to stay open after the child process exits (:iss:`667`)\n\n- diff kitten: When triggering a search scroll to the first match automatically\n\n- :option:`kitty --debug-font-fallback` also prints out what basic fonts were matched\n\n- When closing a kitty window reset the mouse cursor to its default shape and ensure it is visible (:iss:`655`).\n\n- Remote control: Speed-up reading of command responses\n\n- Linux installer: Fix installer failing on systems with python < 3.5\n\n- Support \"-T\" as an alias for \"--title\" (:pull:`659`)\n\n- Fix a regression in the previous release that broke using\n  ``--debug-config`` with custom key mappings (:iss:`695`)\n\n\n0.11.1 [2018-06-17]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- diff kitten: Implement searching for text in the diff (:iss:`574`)\n\n- Add an option :opt:`startup_session` to :file:`kitty.conf` to specify a\n  default startup session (:iss:`641`)\n\n- Add a command line option :option:`kitty --wait-for-single-instance-window-close`\n  to make :option:`kitty --single-instance` wait for the closing of the newly opened\n  window before quitting (:iss:`630`)\n\n- diff kitten: Allow theming the selection background/foreground as well\n\n- diff kitten: Display CRLF line endings using the unicode return symbol\n  instead of <d> as it is less intrusive (:iss:`638`)\n\n- diff kitten: Fix default foreground/background colors not being restored when\n  kitten quits (:iss:`637`)\n\n- Fix :option:`kitty @ set-colors --all` not working when more than one window\n  present (:iss:`632`)\n\n- Fix a regression that broke the legacy increase/decrease_font_size actions\n\n- Clear scrollback on reset (:iss:`631`)\n\n\n0.11.0 [2018-06-12]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new tab bar style \"fade\" in which each tab's edges fade into the background.\n  See :opt:`tab_bar_style` and :opt:`tab_fade` for details. The old look can be\n  restored by setting :opt:`tab_bar_style` to :code:`separator`.\n\n- :doc:`Pre-compiled binaries <binary>` with all bundled dependencies for Linux\n  (:iss:`595`)\n\n- A :doc:`new kitten <kittens/panel>` to create dock panels on X11 desktops\n  showing the output from arbitrary terminal programs.\n\n- Reduce data sent to the GPU per render by 30% (:commit:`8dea5b3`)\n\n- Implement changing the font size for individual top level (OS) windows\n  (:iss:`408`)\n\n- When viewing the scrollback in less using :sc:`show_scrollback` and kitty\n  is currently scrolled, position the scrollback in less to match kitty's\n  scroll position. (:iss:`148`)\n\n- ssh kitten: Support all SSH options. It can now be aliased directly to ssh\n  for convenience. (:pull:`591`)\n\n- icat kitten: Add :option:`kitty +kitten icat --print-window-size` to easily\n  detect the window size in pixels from scripting languages (:iss:`581`)\n\n- hints kitten: Allow selecting hashes from the terminal with\n  :sc:`insert_selected_hash` useful for git commits. (:pull:`604`)\n\n- Allow specifying initial window size in number of cells in addition to pixels\n  (:iss:`436`)\n\n- Add a setting to control the margins to the left and right of the tab-bar\n  (:iss:`584`)\n\n- When closing a tab switch to the last active tab instead of the right-most\n  tab (:iss:`585`)\n\n- Wayland: Fix kitty not starting when using wl_roots based compositors\n  (:iss:`157`)\n\n- Wayland: Fix mouse wheel/touchpad scrolling in opposite direction to other apps (:iss:`594`)\n\n- macOS: Fix the new OS window keyboard shortcut (:sc:`new_os_window`) not\n  working if no kitty window currently has focus. (:iss:`524`)\n\n- macOS: Keep kitty running even when the last window is closed. This is in\n  line with how applications are supposed to behave on macOS (:iss:`543`).\n  There is a new option (:opt:`macos_quit_when_last_window_closed`) to control\n  this.\n\n- macOS: Add macOS standard shortcuts for copy, paste and new OS window\n  (\u2318+C, \u2318+V, \u2318+N)\n\n- Add a config option (:opt:`editor`) to set the EDITOR kitty uses (:iss:`580`)\n\n- Add a config option (``x11_hide_window_decorations``) to hide window\n  decorations under X11/Wayland (:iss:`607`)\n\n- Add an option to @set-window-title to make the title change non-permanent\n  (:iss:`592`)\n\n- Add support for the CSI t escape code to query window and cell sizes\n  (:iss:`581`)\n\n- Linux: When using layouts that map the keys to non-ascii characters,\n  map shortcuts using the ascii equivalents, from the default layout.\n  (:iss:`606`)\n\n- Linux: Fix fonts not being correctly read from TrueType Collection\n  (.ttc) files (:iss:`577`)\n\n- Fix :opt:`inactive_text_alpha` also applying to the tab bar (:iss:`612`)\n\n- :doc:`hints kitten <kittens/hints>`: Fix a regression that caused some blank lines to be not\n  be displayed.\n\n- Linux: Include a man page and the HTML docs when building the linux-package\n\n- Remote control: Fix kitty @ sometimes failing to read the response from\n  kitty. (:iss:`614`)\n\n- Fix `kitty @ set-colors` not working with the window border colors.\n  (:iss:`623`)\n\n- Fix a regression in 0.10 that caused incorrect rendering of the status bar in\n  irssi when used inside screen. (:iss:`621`)\n\n\n0.10.1 [2018-05-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add a kitten to easily ssh into servers that automatically copies the\n  terminfo files over. ``kitty +kitten ssh myserver``.\n\n- diff kitten: Make the keyboard shortcuts configurable (:iss:`563`)\n\n- Allow controlling *background_opacity* via either keyboard shortcuts or\n  remote control. Note that you must set *dynamic_background_opacity yes* in\n  kitty.conf first. (:iss:`569`)\n\n- diff kitten: Add keybindings to scroll by page\n\n- diff kitten: Fix incorrect syntax highlighting for a few file formats such as\n  yaml\n\n- macOS: Fix regression that caused the *macos_option_as_alt* setting to always\n  be disabled for all OS windows in a kitty instance after the first window\n  (:iss:`571`)\n\n- Fix Ctrl+Alt+Space not working in normal and application keyboard modes\n  (:iss:`562`)\n\n\n0.10.0 [2018-05-21]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A diff kitten to show side-by-side diffs with syntax highlighting and support\n  for images. See :doc:`diff kitten <kittens/diff>`.\n\n- Make windows in the various kitty layouts manually resizable. See\n  :ref:`layouts` for details.\n\n- Implement support for the SGR *faint* escape code to make text blend\n  into the background (:iss:`446`).\n\n- Make the hints kitten a little smarter (:commit:`ad1109b`)\n  so that URLs that stretch over multiple lines are detected. Also improve\n  detection of surrounding brackets/quotes.\n\n- Make the kitty window id available as the environment variable\n  ``KITTY_WINDOW_ID`` (:iss:`532`).\n\n- Add a \"fat\" layout that is similar to the \"tall\" layout but vertically\n  oriented.\n\n- Expand environment variables in config file include directives\n\n- Allow programs running in kitty to read/write from the clipboard (:commit:`889ca77`).\n  By default only writing is allowed. This feature is supported in many\n  terminals, search for `OSC 52 clipboard` to find out more about using it.\n\n- Fix moving cursor outside a defined page area incorrectly causing the cursor\n  to be placed inside the page area. Caused incorrect rendering in neovim, in\n  some situations (:iss:`542`).\n\n- Render a couple more powerline symbols directly, bypassing the font\n  (:iss:`550`).\n\n- Fix ctrl+alt+<special> not working in normal and application keyboard (:iss:`548`).\n\n- Partial fix for rendering Right-to-left languages like Arabic. Rendering of\n  Arabic is never going to be perfect, but now it is at least readable.\n\n- Fix Ctrl+backspace acting as plain backspace in normal and application\n  keyboard modes (:iss:`538`).\n\n- Have the paste_from_selection action paste from the clipboard on platforms\n  that do not have a primary selection such as Wayland and macOS\n  (:iss:`529`)\n\n- Fix cursor_stop_blinking_after=0 not working (:iss:`530`)\n\n\n0.9.1 [2018-05-05]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Show a bell symbol on the tab if a bell occurs in one of the windows in the tab and\n  the window is not the currently focused window\n\n- Change the window border color if a bell occurs in an unfocused window. Can\n  be disabled by setting the bell_border_color to be the same as the\n  inactive_border_color.\n\n- macOS: Add support for dead keys\n\n- Unicode input: When searching by name search for prefix matches as well as\n  whole word matches\n\n- Dynamically allocate the memory used for the scrollback history buffer.\n  Reduces startup memory consumption when using very large scrollback\n  buffer sizes.\n\n- Add an option to not request window attention on bell.\n\n- Remote control: Allow matching windows by number (visible position).\n\n- macOS: Fix changing tab title and kitty shell not working\n\n- When triple-clicking select all wrapped lines belonging to a single logical line.\n\n- hints kitten: Detect bracketed URLs and don't include the closing bracket in the URL.\n\n- When calling pass_selection_to_program use the current directory of the child\n  process as the cwd of the program.\n\n- Add macos_hide_from_tasks option to hide kitty from the macOS task switcher\n\n- macOS: When the macos_titlebar_color is set to background change the titlebar\n  colors to match the current background color of the active kitty window\n\n- Add a setting to clear all shortcuts defined up to that point in the config\n  file(s)\n\n- Add a setting (kitty_mod) to change the modifier used by all the default\n  kitty shortcuts, globally\n\n- Fix Shift+function key not working\n\n- Support the F13 to F25 function keys\n\n- Don't fail to start if the user deletes the hintstyle key from their\n  fontconfig configuration.\n\n- When rendering a private use unicode codepoint and a space as a two cell\n  ligature, set the foreground colors of the space cell to match the colors of\n  the first cell. Works around applications like powerline that use different\n  colors for the two cells.\n\n- Fix passing @text to other programs such as when viewing the scrollback\n  buffer not working correctly if kitty is itself scrolled up.\n\n- Fix window focus gained/lost events not being reported to child programs when\n  switching windows/tabs using the various keyboard shortcuts.\n\n- Fix tab title not changing to reflect the window title when switching between different windows in a tab\n\n- Ignore -e if it is specified on the command line. This is for compatibility\n  with broken software that assumes terminals should run with an -e option to\n  execute commands instead of just passing the commands as arguments.\n\n\n0.9.0 [2018-04-15]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A new kitty command shell to allow controlling kitty via commands. Press\n  `ctrl+shift+escape` to run the shell.\n\n- The hints kitten has become much more powerful. Now in addition to URLs you\n  can use it to select word, paths, filenames, lines, etc. from the screen.\n  These can be inserted into the terminal, copied to clipboard or sent to\n  external programs.\n\n- Linux: Switch to libxkbcommon for keyboard handling. It allows kitty to\n  support XCompose and dead keys and also react to keyboard remapping/layout\n  change without needing a restart.\n\n- Add support for multiple-key-sequence shortcuts\n\n- A new remote control command `set-colors` to change the current and/or\n  configured colors.\n\n- When double-clicking to select a word, select words that continue onto the\n  next/prev line as well.\n\n- Add an `include` directive for the config files to read multiple config files\n\n- Improve mouse selection for windows with padding. Moving the mouse into the\n  padding area now acts as if the mouse is over the nearest cell.\n\n- Allow setting all 256 terminal colors in the config file\n\n- Fix using `kitty --single-instance` to open a new window in a running kitty\n  instance, not respecting the `--directory` flag\n\n- URL hints: Exclude trailing punctuation from URLs\n\n- URL hints: Launch the browser from the kitty parent process rather than the\n  hints kitten. Fixes launching on some systems where xdg-open doesn't like\n  being run from a kitten.\n\n- Allow using rectangle select mode by pressing shift in addition to the\n  rectangle select modifiers even when the terminal program has grabbed the\n  mouse.\n\n\n0.8.4 [2018-03-31]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix presence of XDG_CONFIG_DIRS and absence of XDG_CONFIG_HOME preventing\n  kitty from starting\n\n- Revert change in last release to cell width calculation. Instead just clip\n  the right edges of characters that overflow the cell by at most two pixels\n\n\n0.8.3 [2018-03-29]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix a regression that broke the visual bell and invert screen colors escape\n  code\n\n- Allow double-click and triple-click + drag to extend selections word at a\n  time or line at a time\n\n- Add a keyboard shortcut to set the tab title\n\n- Fix setting window title to empty via OSC escape code not working correctly\n\n- Linux: Fix cell width calculation incorrect for some fonts (cell widths are\n  now calculated by actually rendering bitmaps, which is slower but more\n  accurate)\n\n- Allow specifying a system wide kitty config file, for all users\n\n- Add a --debug-config command line flag to output data about the system and\n  kitty configuration.\n\n- Wayland: Fix auto-repeat of keys not working\n\n\n0.8.2 [2018-03-17]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow extending existing selections by right clicking\n\n- Add a configurable keyboard shortcut and remote command to set the font size to a specific value\n\n- Add an option to have kitty close the window when the main processes running in it exits, even if there are still background processes writing to that terminal\n\n- Add configurable keyboard shortcuts to switch to a specific layout\n\n- Add a keyboard shortcut to edit the kitty config file easily\n\n- macOS: Fix restoring of window size not correct on Retina screens\n\n- macOS: Add a facility to specify command line arguments when running kitty from the GUI\n\n- Add a focus-tab remote command\n\n- Fix screen not being refreshed immediately after moving a window.\n\n- Fix a crash when getting the contents of the scrollback buffer as text\n\n0.8.1 [2018-03-09]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Extend kitty's remote control feature to work over both UNIX and TCP sockets,\n  so now you can control kitty from across the internet, if you want to.\n\n- Render private use unicode characters that are followed by a space as a two\n  character ligature. This fixes rendering for applications that misuse\n  private-use characters to display square symbols.\n\n- Fix Unicode emoji presentation variant selector causing new a fallback font\n  instance to be created\n\n- Fix a rare error that prevented the Unicode input kitten from working\n  sometimes\n\n- Allow using Ctrl+Alt+letter in legacy keyboard modes by outputting them as Ctrl+letter and Alt+letter.\n  This matches other terminals' behavior.\n\n- Fix cursor position off-by-one on horizontal axis when resizing the terminal\n\n- Wayland: Fix auto-repeat of keys not working\n\n- Wayland: Add support for window decorations provided by the Wayland shell\n\n- macOS: Fix URL hints not working\n\n- macOS: Fix shell not starting in login mode on some computers\n\n- macOS: Output errors into console.app when running as a bundle\n\n\n0.8.0 [2018-02-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- A framework for kittens, that is, small terminal programs designed to run\n  inside kitty and extend its capabilities. Examples include unicode input and\n  selecting URLs with the keyboard.\n\n- Input arbitrary unicode characters by pressing Ctrl+Shift+u. You can choose\n  characters by name, by hex code, by recently used, etc. There is even and\n  editable Favorites list.\n\n- Open URLs using only the keyboard. kitty has a new \"hints mode\". Press\n  Ctrl+Shift+e and all detected URLs on the screen are highlighted with a key\n  to press to open them. The facility is customizable so you can change\n  what is detected as a URL and which program is used to open it.\n\n- Add an option to change the titlebar color of kitty windows on macOS\n\n- Only consider Emoji characters with default Emoji presentation to be two\n  cells wide. This matches the standard. Also add support for the Unicode Emoji\n  variation presentation selector.\n\n- Prevent video tearing during high speed scrolling by syncing draws\n  to the monitor's refresh rate. There is a new configuration option to\n  control this ``sync_to_monitor``.\n\n- When displaying only a single window, use the default background color of the\n  window (which can be changed via escape codes) as the color for the margin\n  and padding of the window.\n\n- Add some non standard terminfo capabilities used by neovim and tmux.\n\n- Fix large drop in performance when using multiple top-level windows on macOS\n\n- Fix save/restore of window sizes not working correctly.\n\n- Remove option to use system wcwidth(). Now always use a wcwidth() based on\n  the Unicode standard. Only sane way.\n\n- Fix a regression that caused a few ligature glyphs to not render correctly in\n  rare circumstances.\n\n- Browsing the scrollback buffer now happens in an overlay window instead of a\n  new window/tab.\n\n0.7.1 [2018-01-31]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option to adjust the width of character cells\n\n- Fix selecting text with the mouse in the scrollback buffer selecting text\n  from the line above the actually selected line\n\n- Fix some italic fonts having the right edge of characters cut-off,\n  unnecessarily\n\n\n0.7.0 [2018-01-24]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Allow controlling kitty from the shell prompt/scripts. You can\n  open/close/rename windows and tabs and even send input to specific windows.\n  See the README for details.\n\n- Add option to put tab bar at the top instead of the bottom\n\n- Add option to override the default shell\n\n- Add \"Horizontal\" and \"Vertical\" window layouts\n\n- Sessions: Allow setting titles and working directories for individual windows\n\n- Option to copy to clipboard on mouse select\n\n- Fix incorrect reporting of mouse move events when using the SGR protocol\n\n- Make alt+backspace delete the previous word\n\n- Take the mouse wheel multiplier option in to account when generating fake key\n  scroll events\n\n- macOS: Fix closing top-level window does not transfer focus to other\n  top-level windows.\n\n- macOS: Fix alt+arrow keys not working when disabling the macos_option_as_alt\n  config option.\n\n- kitty icat: Workaround for bug in ImageMagick that would cause some images\n  to fail to display at certain sizes.\n\n- Fix rendering of text with ligature fonts that do not use dummy glyphs\n\n- Fix a regression that caused copying of the selection to clipboard to only\n  copy the visible part of the selection\n\n- Fix incorrect handling of some unicode combining marks that are not re-ordered\n\n- Fix handling on non-BMP combining characters\n\n- Drop the dependency on libunistring\n\n\n0.6.1 [2017-12-28]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option to fade the text in inactive windows\n\n- Add new actions to open windows/tabs/etc. with the working directory set to\n  the working directory of the current window.\n\n- Automatically adjust cell size when DPI changes, for example when kitty is\n  moved from one monitor to another with a different DPI\n\n- Ensure underlines are rendered even for fonts with very poor metrics\n\n- Fix some emoji glyphs not colored on Linux\n\n- Internal wcwidth() implementation is now auto-generated from the unicode\n  standard database\n\n- Allow configuring the modifiers to use for rectangular selection with the\n  mouse.\n\n- Fix incorrect minimum wayland version in the build script\n\n- Fix a crash when detecting a URL that ends at the end of the line\n\n- Fix regression that broke drawing of hollow cursor when window loses focus\n\n\n0.6.0 [2017-12-18]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Support background transparency via the background_opacity option. Provided\n  that your OS/window manager supports transparency, you can now have kitty\n  render pixels that have only the default background color as\n  semi-transparent.\n\n- Support multiple top level (OS) windows. These windows all share the sprite\n  texture cache on the GPU, further reducing overall resource usage. Use\n  the shortcut `ctrl+shift+n` to open a new top-level window.\n\n- Add support for a *daemon* mode using the `--single-instance` command line\n  option. With this option you can have only a single kitty instance running.\n  All future invocations simply open new top-level windows in the existing\n  instance.\n\n- Support colored emoji\n\n- Use CoreText instead of FreeType to render text on macOS\n\n- Support running on the \"low power\" GPU on dual GPU macOS machines\n\n- Add a new \"grid\" window layout\n\n- Drop the dependency on glfw (kitty now uses a modified, bundled copy of glfw)\n\n- Add an option to control the audio bell volume on X11 systems\n\n- Add a command line switch to set the name part of the WM_CLASS window\n  property independently.\n\n- Add a command line switch to set the window title.\n\n- Add more options to customize the tab-bar's appearance (font styles and\n  separator)\n\n- Allow drag and drop of files into kitty. On drop kitty will paste the\n  file path to the running program.\n\n- Add an option to control the underline style for URL highlighting on hover\n\n- X11: Set the WINDOWID environment variable\n\n- Fix middle and right buttons swapped when sending mouse events to child\n  processes\n\n- Allow selecting in a rectangle by holding down Ctrl+Alt while dragging with\n  the mouse.\n\n\n0.5.1 [2017-12-01]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add an option to control the thickness of lines in box drawing characters\n\n- Increase max. allowed ligature length to nine characters\n\n- Fix text not vertically centered when adjusting line height\n\n- Fix unicode block characters not being rendered properly\n\n- Fix shift+up/down not generating correct escape codes\n\n- Image display: Fix displaying images taller than two screen heights not\n  scrolling properly\n\n\n0.5.0 [2017-11-19]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Add support for ligature fonts such as Fira Code, Hasklig, etc. kitty now\n  uses harfbuzz for text shaping which allow it to support advanced OpenType\n  features such as contextual alternates/ligatures/combining glyphs/etc.\n\n- Make it easy to select fonts by allowing listing of monospace fonts using:\n  kitty list-fonts\n\n- Add an option to have window focus follow mouse\n\n- Add a keyboard shortcut (ctrl+shift+f11) to toggle fullscreen mode\n\n- macOS: Fix handling of option key. It now behaves just like the alt key on\n  Linux. There is an option to make it type unicode characters instead.\n\n- Linux: Add support for startup notification on X11 desktops. kitty will\n  now inform the window manager when its startup is complete.\n\n- Fix shell prompt being duplicated when window is resized\n\n- Fix crash when displaying more than 64 images in the same session\n\n- Add support for colons in SGR color codes. These are generated by some\n  applications such as neovim when they mistakenly identify kitty as a libvte\n  based terminal.\n\n- Fix mouse interaction not working in apps using obsolete mouse interaction\n  protocols\n\n- Linux: no longer require glew as a dependency\n\n\n0.4.2 [2017-10-23]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Fix a regression in 0.4.0 that broke custom key mappings\n\n- Fix a regression in 0.4.0 that broke support for non-QWERTY keyboard layouts\n\n- Avoid using threads to reap zombie child processes. Also prevent kitty from\n  hanging if the open program hangs when clicking on a URL.\n\n\n0.4.0 [2017-10-22]\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\n- Support for drawing arbitrary raster graphics (images) in the terminal via a\n  new graphics protocol. kitty can draw images with full 32-bit color using both\n  ssh connections and files/shared memory (when available) for better\n  performance. The drawing primitives support alpha blending and z-index.\n  Images can be drawn both above and below text. See :doc:`graphics-protocol`.\n  for details.\n\n- Refactor kitty's internals to make it even faster and more efficient. The CPU\n  usage of kitty + X server while doing intensive tasks such as scrolling a\n  file continuously in less has been reduced by 50%. There are now two\n  configuration options ``repaint_delay`` and ``input_delay`` you can use to\n  fine tune kitty's performance vs CPU usage profile. The CPU usage of kitty +\n  X when scrolling in less is now significantly better than most (all?) other\n  terminals. See :doc:`performance`.\n\n- Hovering over URLs with the mouse now underlines them to indicate they\n  can be clicked. Hold down Ctrl+Shift while clicking to open the URL.\n\n- Selection using the mouse is now more intelligent. It does not add\n  blank cells (i.e. cells that have no content) after the end of text in a\n  line to the selection.\n\n- The block cursor in now fully opaque but renders the character under it in\n  the background color, for enhanced visibility.\n\n- Allow combining multiple independent actions into a single shortcut\n\n- Add a new shortcut to pass the current selection to an external program\n\n- Allow creating shortcuts to open new windows running arbitrary commands. You\n  can also pass the current selection to the command as an arguments and the\n  contents of the screen + scrollback buffer as stdin to the command.\n", "#!/usr/bin/env python3\n# License: GPLv3 Copyright: 2019, Kovid Goyal <kovid at kovidgoyal.net>\n\nimport re\nfrom base64 import standard_b64decode\nfrom collections import OrderedDict\nfrom itertools import count\nfrom typing import Callable, Dict, Optional\n\nfrom .constants import is_macos, logo_png_file\nfrom .fast_data_types import get_boss\nfrom .types import run_once\nfrom .utils import log_error\n\nNotifyImplementation = Callable[[str, str, str], None]\n\nif is_macos:\n    from .fast_data_types import cocoa_send_notification\n\n    def notify(\n        title: str,\n        body: str,\n        timeout: int = 5000,\n        application: str = 'kitty',\n        icon: bool = True,\n        identifier: Optional[str] = None,\n        subtitle: Optional[str] = None,\n    ) -> None:\n        cocoa_send_notification(identifier, title, body, subtitle)\n\nelse:\n\n    from .fast_data_types import dbus_send_notification\n\n    alloc_map: Dict[int, str] = {}\n    identifier_map: Dict[str, int] = {}\n\n    def dbus_notification_created(alloc_id: int, notification_id: int) -> None:\n        identifier = alloc_map.pop(alloc_id, None)\n        if identifier is not None:\n            identifier_map[identifier] = notification_id\n\n    def dbus_notification_activated(notification_id: int, action: str) -> None:\n        rmap = {v: k for k, v in identifier_map.items()}\n        identifier = rmap.get(notification_id)\n        if identifier is not None:\n            notification_activated(identifier)\n\n    def notify(\n        title: str,\n        body: str,\n        timeout: int = -1,\n        application: str = 'kitty',\n        icon: bool = True,\n        identifier: Optional[str] = None,\n        subtitle: Optional[str] = None,\n    ) -> None:\n        icf = ''\n        if icon is True:\n            icf = logo_png_file\n        alloc_id = dbus_send_notification(application, icf, title, body, 'Click to see changes', timeout)\n        if alloc_id and identifier is not None:\n            alloc_map[alloc_id] = identifier\n\n\ndef notify_implementation(title: str, body: str, identifier: str) -> None:\n    notify(title, body, identifier=identifier)\n\n\nclass NotificationCommand:\n\n    done: bool = True\n    identifier: str = '0'\n    title: str = ''\n    body: str = ''\n    actions: str = ''\n\n    def __repr__(self) -> str:\n        return f'NotificationCommand(identifier={self.identifier!r}, title={self.title!r}, body={self.body!r}, actions={self.actions!r}, done={self.done!r})'\n\n\ndef parse_osc_9(raw: str) -> NotificationCommand:\n    ans = NotificationCommand()\n    ans.title = raw\n    return ans\n\n\ndef parse_osc_777(raw: str) -> NotificationCommand:\n    parts = raw.split(';', 1)\n    ans = NotificationCommand()\n    ans.title = parts[0]\n    if len(parts) > 1:\n        ans.body = parts[1]\n    return ans\n\n\n@run_once\ndef sanitize_identifier_pat() -> 're.Pattern[str]':\n    return re.compile(r'[^a-zA-Z0-9-_+.]+')\n\n\ndef parse_osc_99(raw: str) -> NotificationCommand:\n    cmd = NotificationCommand()\n    metadata, payload = raw.partition(';')[::2]\n    payload_is_encoded = False\n    payload_type = 'title'\n    if metadata:\n        for part in metadata.split(':'):\n            try:\n                k, v = part.split('=', 1)\n            except Exception:\n                log_error('Malformed OSC 99: metadata is not key=value pairs')\n                return cmd\n            if k == 'p':\n                payload_type = v\n            elif k == 'i':\n                cmd.identifier = sanitize_identifier_pat().sub('', v)\n            elif k == 'e':\n                payload_is_encoded = v == '1'\n            elif k == 'd':\n                cmd.done = v != '0'\n            elif k == 'a':\n                cmd.actions += f',{v}'\n    if payload_type not in ('body', 'title'):\n        log_error(f'Malformed OSC 99: unknown payload type: {payload_type}')\n        return NotificationCommand()\n    if payload_is_encoded:\n        try:\n            payload = standard_b64decode(payload).decode('utf-8')\n        except Exception:\n            log_error('Malformed OSC 99: payload is not base64 encoded UTF-8 text')\n            return NotificationCommand()\n    if payload_type == 'title':\n        cmd.title = payload\n    else:\n        cmd.body = payload\n    return cmd\n\n\ndef limit_size(x: str) -> str:\n    if len(x) > 1024:\n        x = x[:1024]\n    return x\n\n\ndef merge_osc_99(prev: NotificationCommand, cmd: NotificationCommand) -> NotificationCommand:\n    if prev.done or prev.identifier != cmd.identifier:\n        return cmd\n    cmd.actions = limit_size(f'{prev.actions},{cmd.actions}')\n    cmd.title = limit_size(prev.title + cmd.title)\n    cmd.body = limit_size(prev.body + cmd.body)\n    return cmd\n\n\nidentifier_registry: \"OrderedDict[str, RegisteredNotification]\" = OrderedDict()\nid_counter = count()\n\n\nclass RegisteredNotification:\n    identifier: str\n    window_id: int\n    focus: bool = True\n    report: bool = False\n\n    def __init__(self, cmd: NotificationCommand, window_id: int):\n        self.window_id = window_id\n        for x in cmd.actions.strip(',').split(','):\n            val = not x.startswith('-')\n            x = x.lstrip('+-')\n            if x == 'focus':\n                self.focus = val\n            elif x == 'report':\n                self.report = val\n        self.identifier = cmd.identifier\n\n\ndef register_identifier(identifier: str, cmd: NotificationCommand, window_id: int) -> None:\n    identifier_registry[identifier] = RegisteredNotification(cmd, window_id)\n    if len(identifier_registry) > 100:\n        identifier_registry.popitem(False)\n\n\ndef notification_activated(identifier: str, activated_implementation: Optional[Callable[[str, int, bool, bool], None]] = None) -> None:\n    if identifier == 'new-version':\n        from .update_check import notification_activated as do\n        do()\n    elif identifier.startswith('test-notify-'):\n        log_error(f'Test notification {identifier} activated')\n    else:\n        r = identifier_registry.pop(identifier, None)\n        if r is not None and (r.focus or r.report):\n            if activated_implementation is None:\n                get_boss().notification_activated(r.identifier, r.window_id, r.focus, r.report)\n            else:\n                activated_implementation(r.identifier, r.window_id, r.focus, r.report)\n\n\ndef reset_registry() -> None:\n    global id_counter\n    identifier_registry.clear()\n    id_counter = count()\n\n\ndef notify_with_command(cmd: NotificationCommand, window_id: int, notify_implementation: NotifyImplementation = notify_implementation) -> None:\n    title = cmd.title or cmd.body\n    body = cmd.body if cmd.title else ''\n    if title:\n        identifier = f'i{next(id_counter)}'\n        notify_implementation(title, body, identifier)\n        register_identifier(identifier, cmd, window_id)\n\n\ndef handle_notification_cmd(\n    osc_code: int,\n    raw_data: str,\n    window_id: int,\n    prev_cmd: NotificationCommand,\n    notify_implementation: NotifyImplementation = notify_implementation\n) -> Optional[NotificationCommand]:\n    if osc_code == 99:\n        cmd = merge_osc_99(prev_cmd, parse_osc_99(raw_data))\n        if cmd.done:\n            notify_with_command(cmd, window_id, notify_implementation)\n            cmd = NotificationCommand()\n        return cmd\n    if osc_code == 9:\n        cmd = parse_osc_9(raw_data)\n        notify_with_command(cmd, window_id, notify_implementation)\n        return cmd\n    if osc_code == 777:\n        cmd = parse_osc_777(raw_data)\n        notify_with_command(cmd, window_id, notify_implementation)\n        return cmd\n    return None\n", "#!/usr/bin/env python3\n# License: GPL v3 Copyright: 2016, Kovid Goyal <kovid at kovidgoyal.net>\n\nimport json\nimport os\nimport re\nimport sys\nimport weakref\nfrom collections import deque\nfrom contextlib import suppress\nfrom enum import Enum, IntEnum, auto\nfrom functools import lru_cache, partial\nfrom gettext import gettext as _\nfrom itertools import chain\nfrom time import monotonic\nfrom typing import (\n    TYPE_CHECKING, Any, Callable, Deque, Dict, Iterable, List, NamedTuple,\n    Optional, Pattern, Sequence, Tuple, Union\n)\n\nfrom .child import ProcessDesc\nfrom .cli_stub import CLIOptions\nfrom .config import build_ansi_color_table\nfrom .constants import (\n    appname, clear_handled_signals, config_dir, is_macos, wakeup_io_loop\n)\nfrom .fast_data_types import (\n    BGIMAGE_PROGRAM, BLIT_PROGRAM, CELL_BG_PROGRAM, CELL_FG_PROGRAM,\n    CELL_PROGRAM, CELL_SPECIAL_PROGRAM, CURSOR_BEAM, CURSOR_BLOCK,\n    CURSOR_UNDERLINE, DCS, DECORATION, DECORATION_MASK, DIM, GLFW_MOD_CONTROL,\n    GRAPHICS_ALPHA_MASK_PROGRAM, GRAPHICS_PREMULT_PROGRAM, GRAPHICS_PROGRAM,\n    MARK, MARK_MASK, NO_CURSOR_SHAPE, NUM_UNDERLINE_STYLES, OSC, REVERSE,\n    SCROLL_FULL, SCROLL_LINE, SCROLL_PAGE, STRIKETHROUGH, TINT_PROGRAM, Color,\n    KeyEvent, Screen, add_timer, add_window, cell_size_for_window,\n    click_mouse_cmd_output, click_mouse_url, compile_program,\n    current_os_window, encode_key_for_tty, get_boss, get_click_interval,\n    get_clipboard_string, get_options, init_cell_program, mark_os_window_dirty,\n    mouse_selection, move_cursor_to_mouse_if_in_prompt, pt_to_px,\n    set_clipboard_string, set_titlebar_color, set_window_logo,\n    set_window_padding, set_window_render_data, update_ime_position_for_window,\n    update_window_title, update_window_visibility, wakeup_main_loop\n)\nfrom .keys import keyboard_mode_name, mod_mask\nfrom .notify import NotificationCommand, handle_notification_cmd, sanitize_identifier_pat\nfrom .options.types import Options\nfrom .rgb import to_color\nfrom .terminfo import get_capabilities\nfrom .types import MouseEvent, OverlayType, WindowGeometry, ac, run_once\nfrom .typing import BossType, ChildType, EdgeLiteral, TabType, TypedDict\nfrom .utils import (\n    docs_url, get_primary_selection, kitty_ansi_sanitizer_pat, load_shaders,\n    log_error, open_cmd, open_url, parse_color_set, path_from_osc7_url,\n    resolve_custom_file, resolved_shell, sanitize_title, set_primary_selection\n)\n\nMatchPatternType = Union[Pattern[str], Tuple[Pattern[str], Optional[Pattern[str]]]]\n\n\nif TYPE_CHECKING:\n    from .file_transmission import FileTransmission\n\n\nclass CwdRequestType(Enum):\n    current: int = auto()\n    last_reported: int = auto()\n    oldest: int = auto()\n\n\nclass CwdRequest:\n\n    def __init__(self, window: Optional['Window'] = None, request_type: CwdRequestType = CwdRequestType.current) -> None:\n        self.window_id = -1 if window is None else window.id\n        self.request_type = request_type\n\n    def __bool__(self) -> bool:\n        return self.window_id > -1\n\n    @property\n    def window(self) -> Optional['Window']:\n        return get_boss().window_id_map.get(self.window_id)\n\n    @property\n    def cwd_of_child(self) -> str:\n        window = self.window\n        if not window:\n            return ''\n        reported_cwd = path_from_osc7_url(window.screen.last_reported_cwd) if window.screen.last_reported_cwd else ''\n        if reported_cwd and not window.child_is_remote and (self.request_type is CwdRequestType.last_reported or window.at_prompt):\n            return reported_cwd\n        return window.get_cwd_of_child(oldest=self.request_type is CwdRequestType.oldest) or ''\n\n    def modify_argv_for_launch_with_cwd(self, argv: List[str]) -> str:\n        window = self.window\n        if not window:\n            return ''\n        reported_cwd = path_from_osc7_url(window.screen.last_reported_cwd) if window.screen.last_reported_cwd else ''\n        if reported_cwd:\n            # First check if we are running ssh kitten, and trying to open the configured login shell\n            if argv[0] == resolved_shell(get_options())[0]:\n                ssh_kitten_cmdline = window.ssh_kitten_cmdline()\n                if ssh_kitten_cmdline:\n                    from kittens.ssh.utils import set_cwd_in_cmdline\n                    argv[:] = ssh_kitten_cmdline\n                    set_cwd_in_cmdline(reported_cwd, argv)\n                    return ''\n            if not window.child_is_remote and (self.request_type is CwdRequestType.last_reported or window.at_prompt):\n                return reported_cwd\n        return window.get_cwd_of_child(oldest=self.request_type is CwdRequestType.oldest) or ''\n\n\ndef process_title_from_child(title: str, is_base64: bool) -> str:\n    if is_base64:\n        from base64 import standard_b64decode\n        try:\n            title = standard_b64decode(title).decode('utf-8', 'replace')\n        except Exception:\n            title = 'undecodeable title'\n    return sanitize_title(title)\n\n\n@lru_cache(maxsize=64)\ndef compile_match_query(exp: str, is_simple: bool = True) -> MatchPatternType:\n    if is_simple:\n        pat: MatchPatternType = re.compile(exp)\n    else:\n        kp, vp = exp.partition('=')[::2]\n        if vp:\n            pat = re.compile(kp), re.compile(vp)\n        else:\n            pat = re.compile(kp), None\n    return pat\n\n\nclass WindowDict(TypedDict):\n    id: int\n    is_focused: bool\n    title: str\n    pid: Optional[int]\n    cwd: str\n    cmdline: List[str]\n    env: Dict[str, str]\n    foreground_processes: List[ProcessDesc]\n    is_self: bool\n    lines: int\n    columns: int\n\n\nclass PipeData(TypedDict):\n    input_line_number: int\n    scrolled_by: int\n    cursor_x: int\n    cursor_y: int\n    lines: int\n    columns: int\n    text: str\n\n\nclass ClipboardPending(NamedTuple):\n    where: str\n    data: str\n    truncated: bool = False\n\n\nclass DynamicColor(IntEnum):\n    default_fg, default_bg, cursor_color, highlight_fg, highlight_bg = range(1, 6)\n\n\nclass CommandOutput(IntEnum):\n    last_run, first_on_screen, last_visited, last_non_empty = 0, 1, 2, 3\n\n\nDYNAMIC_COLOR_CODES = {\n    10: DynamicColor.default_fg,\n    11: DynamicColor.default_bg,\n    12: DynamicColor.cursor_color,\n    17: DynamicColor.highlight_bg,\n    19: DynamicColor.highlight_fg,\n}\nDYNAMIC_COLOR_CODES.update({k+100: v for k, v in DYNAMIC_COLOR_CODES.items()})\n\n\nclass Watcher:\n\n    def __call__(self, boss: BossType, window: 'Window', data: Dict[str, Any]) -> None:\n        pass\n\n\nclass Watchers:\n\n    on_resize: List[Watcher]\n    on_close: List[Watcher]\n    on_focus_change: List[Watcher]\n\n    def __init__(self) -> None:\n        self.on_resize = []\n        self.on_close = []\n        self.on_focus_change = []\n\n    def add(self, others: 'Watchers') -> None:\n        def merge(base: List[Watcher], other: List[Watcher]) -> None:\n            for x in other:\n                if x not in base:\n                    base.append(x)\n        merge(self.on_resize, others.on_resize)\n        merge(self.on_close, others.on_close)\n        merge(self.on_focus_change, others.on_focus_change)\n\n    def clear(self) -> None:\n        del self.on_close[:], self.on_resize[:], self.on_focus_change[:]\n\n    def copy(self) -> 'Watchers':\n        ans = Watchers()\n        ans.on_close = self.on_close[:]\n        ans.on_resize = self.on_resize[:]\n        ans.on_focus_change = self.on_focus_change[:]\n        return ans\n\n    @property\n    def has_watchers(self) -> bool:\n        return bool(self.on_close or self.on_resize or self.on_focus_change)\n\n\ndef call_watchers(windowref: Callable[[], Optional['Window']], which: str, data: Dict[str, Any]) -> None:\n\n    def callback(timer_id: Optional[int]) -> None:\n        w = windowref()\n        if w is not None:\n            watchers: List[Watcher] = getattr(w.watchers, which)\n            w.call_watchers(watchers, data)\n\n    add_timer(callback, 0, False)\n\n\ndef pagerhist(screen: Screen, as_ansi: bool = False, add_wrap_markers: bool = True, upto_output_start: bool = False) -> str:\n    pht = screen.historybuf.pagerhist_as_text(upto_output_start)\n    if pht and (not as_ansi or not add_wrap_markers):\n        sanitizer = text_sanitizer(as_ansi, add_wrap_markers)\n        pht = sanitizer(pht)\n    return pht\n\n\ndef as_text(\n    screen: Screen,\n    as_ansi: bool = False,\n    add_history: bool = False,\n    add_wrap_markers: bool = False,\n    alternate_screen: bool = False,\n    add_cursor: bool = False\n) -> str:\n    lines: List[str] = []\n    add_history = add_history and not (screen.is_using_alternate_linebuf() ^ alternate_screen)\n    if alternate_screen:\n        f = screen.as_text_alternate\n    else:\n        f = screen.as_text_non_visual if add_history else screen.as_text\n    f(lines.append, as_ansi, add_wrap_markers)\n    ctext = ''\n    if add_cursor:\n        ctext += '\\x1b[?25' + ('h' if screen.cursor_visible else 'l')\n        ctext += f'\\x1b[{screen.cursor.y + 1};{screen.cursor.x + 1}H'\n        shape = screen.cursor.shape\n        if shape == NO_CURSOR_SHAPE:\n            ctext += '\\x1b[?12' + ('h' if screen.cursor.blink else 'l')\n        else:\n            code = {CURSOR_BLOCK: 1, CURSOR_UNDERLINE: 3, CURSOR_BEAM: 5}[shape]\n            if not screen.cursor.blink:\n                code += 1\n            ctext += f'\\x1b[{code} q'\n\n    if add_history:\n        pht = pagerhist(screen, as_ansi, add_wrap_markers)\n        h: List[str] = [pht] if pht else []\n        screen.as_text_for_history_buf(h.append, as_ansi, add_wrap_markers)\n        if h:\n            if not screen.linebuf.is_continued(0):\n                h[-1] += '\\n'\n            if as_ansi:\n                h[-1] += '\\x1b[m'\n        ans = ''.join(chain(h, lines))\n        if ctext:\n            ans += ctext\n        return ans\n    ans = ''.join(lines)\n    if ctext:\n        ans += ctext\n    return ans\n\n\ndef multi_replace(src: str, **replacements: Any) -> str:\n    r = {k: str(v) for k, v in replacements.items()}\n\n    def sub(m: 're.Match[str]') -> str:\n        return r.get(m.group(1), m.group(1))\n\n    return re.sub(r'\\{([A-Z_]+)\\}', sub, src)\n\n\nclass LoadShaderPrograms:\n\n    def __call__(self, semi_transparent: bool = False) -> None:\n        compile_program(BLIT_PROGRAM, *load_shaders('blit'))\n        v, f = load_shaders('cell')\n\n        for which, p in {\n                'SIMPLE': CELL_PROGRAM,\n                'BACKGROUND': CELL_BG_PROGRAM,\n                'SPECIAL': CELL_SPECIAL_PROGRAM,\n                'FOREGROUND': CELL_FG_PROGRAM,\n        }.items():\n            ff = f.replace('{WHICH_PROGRAM}', which)\n            vv = multi_replace(\n                v,\n                WHICH_PROGRAM=which,\n                REVERSE_SHIFT=REVERSE,\n                STRIKE_SHIFT=STRIKETHROUGH,\n                DIM_SHIFT=DIM,\n                DECORATION_SHIFT=DECORATION,\n                MARK_SHIFT=MARK,\n                MARK_MASK=MARK_MASK,\n                DECORATION_MASK=DECORATION_MASK,\n                STRIKE_SPRITE_INDEX=NUM_UNDERLINE_STYLES + 1,\n            )\n            if semi_transparent:\n                vv = vv.replace('#define NOT_TRANSPARENT', '#define TRANSPARENT')\n                ff = ff.replace('#define NOT_TRANSPARENT', '#define TRANSPARENT')\n            compile_program(p, vv, ff)\n\n        v, f = load_shaders('graphics')\n        for which, p in {\n                'SIMPLE': GRAPHICS_PROGRAM,\n                'PREMULT': GRAPHICS_PREMULT_PROGRAM,\n                'ALPHA_MASK': GRAPHICS_ALPHA_MASK_PROGRAM,\n        }.items():\n            ff = f.replace('ALPHA_TYPE', which)\n            compile_program(p, v, ff)\n\n        v, f = load_shaders('bgimage')\n        compile_program(BGIMAGE_PROGRAM, v, f)\n        v, f = load_shaders('tint')\n        compile_program(TINT_PROGRAM, v, f)\n        init_cell_program()\n\n\nload_shader_programs = LoadShaderPrograms()\n\n\ndef setup_colors(screen: Screen, opts: Options) -> None:\n    screen.color_profile.update_ansi_color_table(build_ansi_color_table(opts))\n\n    def s(c: Optional[Color]) -> int:\n        return 0 if c is None else (0xff000000 | int(c))\n    screen.color_profile.set_configured_colors(\n        s(opts.foreground), s(opts.background),\n        s(opts.cursor), s(opts.cursor_text_color),\n        s(opts.selection_foreground), s(opts.selection_background),\n        s(opts.visual_bell_color)\n    )\n\n\n@run_once\ndef load_paste_filter() -> Callable[[str], str]:\n    import runpy\n    import traceback\n    try:\n        m = runpy.run_path(os.path.join(config_dir, 'paste-actions.py'))\n        func: Callable[[str], str] = m['filter_paste']\n    except Exception as e:\n        if not isinstance(e, FileNotFoundError):\n            traceback.print_exc()\n            log_error(f'Failed to load paste filter function with error: {e}')\n\n        def func(text: str) -> str:\n            return text\n    return func\n\n\ndef text_sanitizer(as_ansi: bool, add_wrap_markers: bool) -> Callable[[str], str]:\n    pat = kitty_ansi_sanitizer_pat()\n    ansi, wrap_markers = not as_ansi, not add_wrap_markers\n\n    def remove_wrap_markers(line: str) -> str:\n        return line.replace('\\r', '')\n\n    def remove_sgr(line: str) -> str:\n        return str(pat.sub('', line))\n\n    def remove_both(line: str) -> str:\n        return str(pat.sub('', line.replace('\\r', '')))\n\n    if ansi:\n        return remove_both if wrap_markers else remove_sgr\n    return remove_wrap_markers\n\n\ndef cmd_output(screen: Screen, which: CommandOutput = CommandOutput.last_run, as_ansi: bool = False, add_wrap_markers: bool = False) -> str:\n    lines: List[str] = []\n    search_in_pager_hist = screen.cmd_output(which, lines.append, as_ansi, add_wrap_markers)\n    if search_in_pager_hist:\n        pht = pagerhist(screen, as_ansi, add_wrap_markers, True)\n        if pht:\n            lines.insert(0, pht)\n    for i in range(min(len(lines), 3)):\n        x = lines[i]\n        if x.startswith('\\x1b]133;C'):\n            lines[i] = x.partition('\\\\')[-1]\n    return ''.join(lines)\n\n\ndef process_remote_print(msg: str) -> str:\n    from base64 import standard_b64decode\n\n    from .cli import green\n    text = standard_b64decode(msg).decode('utf-8', 'replace')\n    return text.replace('\\x1b', green(r'\\e')).replace('\\a', green(r'\\a')).replace('\\0', green(r'\\0'))\n\n\nclass EdgeWidths:\n    left: Optional[float]\n    top: Optional[float]\n    right: Optional[float]\n    bottom: Optional[float]\n\n    def __init__(self, serialized: Optional[Dict[str, Optional[float]]] = None):\n        if serialized is not None:\n            self.left = serialized['left']\n            self.right = serialized['right']\n            self.top = serialized['top']\n            self.bottom = serialized['bottom']\n        else:\n            self.left = self.top = self.right = self.bottom = None\n\n    def serialize(self) -> Dict[str, Optional[float]]:\n        return {'left': self.left, 'right': self.right, 'top': self.top, 'bottom': self.bottom}\n\n\nclass GlobalWatchers:\n\n    def __init__(self) -> None:\n        self.options_spec: Optional[Dict[str, str]] = None\n        self.ans = Watchers()\n        self.extra = ''\n\n    def __call__(self) -> Watchers:\n        spec = get_options().watcher\n        if spec == self.options_spec:\n            return self.ans\n        from .launch import load_watch_modules\n        if self.extra:\n            spec = spec.copy()\n            spec[self.extra] = self.extra\n        self.ans = load_watch_modules(spec.keys()) or self.ans\n        self.options_spec = spec.copy()\n        return self.ans\n\n    def set_extra(self, extra: str) -> None:\n        self.extra = extra\n\n\nglobal_watchers = GlobalWatchers()\n\n\nclass Window:\n\n    window_custom_type: str = ''\n    overlay_type = OverlayType.transient\n\n    def __init__(\n        self,\n        tab: TabType,\n        child: ChildType,\n        args: CLIOptions,\n        override_title: Optional[str] = None,\n        copy_colors_from: Optional['Window'] = None,\n        watchers: Optional[Watchers] = None,\n        allow_remote_control: bool = False,\n        remote_control_passwords: Optional[Dict[str, Sequence[str]]] = None,\n    ):\n        if watchers:\n            self.watchers = watchers\n            self.watchers.add(global_watchers())\n        else:\n            self.watchers = global_watchers().copy()\n        self.last_focused_at = 0.\n        self.started_at = monotonic()\n        self.current_remote_data: List[str] = []\n        self.current_mouse_event_button = 0\n        self.current_clipboard_read_ask: Optional[bool] = None\n        self.prev_osc99_cmd = NotificationCommand()\n        self.actions_on_close: List[Callable[['Window'], None]] = []\n        self.actions_on_focus_change: List[Callable[['Window', bool], None]] = []\n        self.actions_on_removal: List[Callable[['Window'], None]] = []\n        self.current_marker_spec: Optional[Tuple[str, Union[str, Tuple[Tuple[int, str], ...]]]] = None\n        self.kitten_result_processors: List[Callable[['Window', Any], None]] = []\n        self.pty_resized_once = False\n        self.last_reported_pty_size = (-1, -1, -1, -1)\n        self.needs_attention = False\n        self.override_title = override_title\n        self.default_title = os.path.basename(child.argv[0] or appname)\n        self.child_title = self.default_title\n        self.title_stack: Deque[str] = deque(maxlen=10)\n        self.id: int = add_window(tab.os_window_id, tab.id, self.title)\n        self.margin = EdgeWidths()\n        self.padding = EdgeWidths()\n        self.kitten_result: Optional[Dict[str, Any]] = None\n        if not self.id:\n            raise Exception(f'No tab with id: {tab.id} in OS Window: {tab.os_window_id} was found, or the window counter wrapped')\n        self.tab_id = tab.id\n        self.os_window_id = tab.os_window_id\n        self.tabref: Callable[[], Optional[TabType]] = weakref.ref(tab)\n        self.clipboard_pending: Optional[ClipboardPending] = None\n        self.destroyed = False\n        self.geometry: WindowGeometry = WindowGeometry(0, 0, 0, 0, 0, 0)\n        self.needs_layout = True\n        self.is_visible_in_layout: bool = True\n        self.child = child\n        cell_width, cell_height = cell_size_for_window(self.os_window_id)\n        opts = get_options()\n        self.screen: Screen = Screen(self, 24, 80, opts.scrollback_lines, cell_width, cell_height, self.id)\n        if copy_colors_from is not None:\n            self.screen.copy_colors_from(copy_colors_from.screen)\n        else:\n            setup_colors(self.screen, opts)\n        self.remote_control_passwords = remote_control_passwords\n        self.allow_remote_control = allow_remote_control\n\n    def remote_control_allowed(self, pcmd: Dict[str, Any], extra_data: Dict[str, Any]) -> bool:\n        if not self.allow_remote_control:\n            return False\n        if not self.remote_control_passwords:\n            return True\n        pw = pcmd.get('password', '')\n        auth_items = self.remote_control_passwords.get(pw)\n        if pw == '!':\n            auth_items = None\n        if auth_items is None:\n            if '!' in self.remote_control_passwords:\n                raise PermissionError()\n            return False\n        from .remote_control import password_authorizer\n        pa = password_authorizer(auth_items)\n        if not pa.is_cmd_allowed(pcmd, self, False, extra_data):\n            raise PermissionError()\n        return True\n\n    @property\n    def file_transmission_control(self) -> 'FileTransmission':\n        ans: Optional['FileTransmission'] = getattr(self, '_file_transmission', None)\n        if ans is None:\n            from .file_transmission import FileTransmission\n            ans = self._file_transmission = FileTransmission(self.id)\n        return ans\n\n    def on_dpi_change(self, font_sz: float) -> None:\n        self.update_effective_padding()\n\n    def change_tab(self, tab: TabType) -> None:\n        self.tab_id = tab.id\n        self.os_window_id = tab.os_window_id\n        self.tabref = weakref.ref(tab)\n\n    def effective_margin(self, edge: EdgeLiteral, is_single_window: bool = False) -> int:\n        q = getattr(self.margin, edge)\n        if q is not None:\n            return pt_to_px(q, self.os_window_id)\n        opts = get_options()\n        if is_single_window:\n            q = getattr(opts.single_window_margin_width, edge)\n            if q > -0.1:\n                return pt_to_px(q, self.os_window_id)\n        q = getattr(opts.window_margin_width, edge)\n        return pt_to_px(q, self.os_window_id)\n\n    def effective_padding(self, edge: EdgeLiteral) -> int:\n        q = getattr(self.padding, edge)\n        if q is not None:\n            return pt_to_px(q, self.os_window_id)\n        q = getattr(get_options().window_padding_width, edge)\n        return pt_to_px(q, self.os_window_id)\n\n    def update_effective_padding(self) -> None:\n        set_window_padding(\n            self.os_window_id, self.tab_id, self.id,\n            self.effective_padding('left'), self.effective_padding('top'),\n            self.effective_padding('right'), self.effective_padding('bottom'))\n\n    def patch_edge_width(self, which: str, edge: EdgeLiteral, val: Optional[float]) -> None:\n        q = self.padding if which == 'padding' else self.margin\n        setattr(q, edge, val)\n        if q is self.padding:\n            self.update_effective_padding()\n\n    def effective_border(self) -> int:\n        val, unit = get_options().window_border_width\n        if unit == 'pt':\n            val = max(1 if val > 0 else 0, pt_to_px(val, self.os_window_id))\n        else:\n            val = round(val)\n        return int(val)\n\n    def apply_options(self) -> None:\n        opts = get_options()\n        self.update_effective_padding()\n        self.change_titlebar_color()\n        setup_colors(self.screen, opts)\n\n    @property\n    def title(self) -> str:\n        return self.override_title or self.child_title\n\n    def __repr__(self) -> str:\n        return f'Window(title={self.title}, id={self.id})'\n\n    def as_dict(self, is_focused: bool = False, is_self: bool = False) -> WindowDict:\n        return dict(\n            id=self.id,\n            is_focused=is_focused,\n            title=self.title,\n            pid=self.child.pid,\n            cwd=self.child.current_cwd or self.child.cwd,\n            cmdline=self.child.cmdline,\n            env=self.child.environ,\n            foreground_processes=self.child.foreground_processes,\n            is_self=is_self,\n            lines=self.screen.lines,\n            columns=self.screen.columns,\n        )\n\n    def serialize_state(self) -> Dict[str, Any]:\n        ans = {\n            'version': 1,\n            'id': self.id,\n            'child_title': self.child_title,\n            'override_title': self.override_title,\n            'default_title': self.default_title,\n            'title_stack': list(self.title_stack),\n            'allow_remote_control': self.allow_remote_control,\n            'remote_control_passwords': self.remote_control_passwords,\n            'cwd': self.child.current_cwd or self.child.cwd,\n            'env': self.child.environ,\n            'cmdline': self.child.cmdline,\n            'margin': self.margin.serialize(),\n            'padding': self.padding.serialize(),\n        }\n        if self.window_custom_type:\n            ans['window_custom_type'] = self.window_custom_type\n        if self.overlay_type is not OverlayType.transient:\n            ans['overlay_type'] = self.overlay_type.value\n        return ans\n\n    @property\n    def current_colors(self) -> Dict[str, Optional[int]]:\n        return self.screen.color_profile.as_dict()\n\n    @property\n    def at_prompt(self) -> bool:\n        return self.screen.cursor_at_prompt()\n\n    @property\n    def has_running_program(self) -> bool:\n        return not self.at_prompt\n\n    def matches(self, field: str, pat: MatchPatternType) -> bool:\n        if not pat:\n            return False\n        if field == 'env':\n            assert isinstance(pat, tuple)\n            key_pat, val_pat = pat\n            for key, val in self.child.environ.items():\n                if key_pat.search(key) is not None and (\n                        val_pat is None or val_pat.search(val) is not None):\n                    return True\n            return False\n        assert not isinstance(pat, tuple)\n\n        if field in ('id', 'window_id'):\n            return pat.pattern == str(self.id)\n        if field == 'pid':\n            return pat.pattern == str(self.child.pid)\n        if field == 'title':\n            return pat.search(self.override_title or self.title) is not None\n        if field in 'cwd':\n            return pat.search(self.child.current_cwd or self.child.cwd) is not None\n        if field == 'cmdline':\n            for x in self.child.cmdline:\n                if pat.search(x) is not None:\n                    return True\n            return False\n        return False\n\n    def matches_query(self, field: str, query: str, active_tab: Optional[TabType] = None) -> bool:\n        if field in ('num', 'recent'):\n            if active_tab is not None:\n                try:\n                    q = int(query)\n                except Exception:\n                    return False\n                with suppress(Exception):\n                    if field == 'num':\n                        return active_tab.get_nth_window(q) is self\n                    return active_tab.nth_active_window_id(q) == self.id\n            return False\n        if field == 'state':\n            if query == 'active':\n                return active_tab is not None and self is active_tab.active_window\n            if query == 'focused':\n                return active_tab is not None and self is active_tab.active_window and current_os_window() == self.os_window_id\n            if query == 'needs_attention':\n                return self.needs_attention\n            if query == 'parent_active':\n                return active_tab is not None and self.tabref() is active_tab\n            if query == 'parent_focused':\n                return active_tab is not None and self.tabref() is active_tab and current_os_window() == self.os_window_id\n            return False\n        pat = compile_match_query(query, field != 'env')\n        return self.matches(field, pat)\n\n    def set_visible_in_layout(self, val: bool) -> None:\n        val = bool(val)\n        if val is not self.is_visible_in_layout:\n            self.is_visible_in_layout = val\n            update_window_visibility(self.os_window_id, self.tab_id, self.id, val)\n            if val:\n                self.refresh()\n\n    def refresh(self) -> None:\n        self.screen.mark_as_dirty()\n        wakeup_io_loop()\n        wakeup_main_loop()\n\n    def set_geometry(self, new_geometry: WindowGeometry) -> None:\n        if self.destroyed:\n            return\n        if self.needs_layout or new_geometry.xnum != self.screen.columns or new_geometry.ynum != self.screen.lines:\n            self.screen.resize(new_geometry.ynum, new_geometry.xnum)\n            self.needs_layout = False\n            call_watchers(weakref.ref(self), 'on_resize', {'old_geometry': self.geometry, 'new_geometry': new_geometry})\n        current_pty_size = (\n            self.screen.lines, self.screen.columns,\n            max(0, new_geometry.right - new_geometry.left), max(0, new_geometry.bottom - new_geometry.top))\n        update_ime_position = False\n        if current_pty_size != self.last_reported_pty_size:\n            get_boss().child_monitor.resize_pty(self.id, *current_pty_size)\n            if not self.pty_resized_once:\n                self.pty_resized_once = True\n                self.child.mark_terminal_ready()\n                update_ime_position = True\n            self.last_reported_pty_size = current_pty_size\n        else:\n            mark_os_window_dirty(self.os_window_id)\n\n        self.geometry = g = new_geometry\n        set_window_render_data(self.os_window_id, self.tab_id, self.id, self.screen, *g[:4])\n        self.update_effective_padding()\n        if update_ime_position:\n            update_ime_position_for_window(self.id, True)\n\n    def contains(self, x: int, y: int) -> bool:\n        g = self.geometry\n        return g.left <= x <= g.right and g.top <= y <= g.bottom\n\n    def close(self) -> None:\n        get_boss().mark_window_for_close(self)\n\n    @ac('misc', '''\n        Send the specified text to the active window\n\n        See :sc:`send_text <send_text>` for details.\n        ''')\n    def send_text(self, *args: str) -> bool:\n        mode = keyboard_mode_name(self.screen)\n        required_mode_, text = args[-2:]\n        required_mode = frozenset(required_mode_.split(','))\n        if not required_mode & {mode, 'all'}:\n            return True\n        if not text:\n            return True\n        self.write_to_child(text)\n        return False\n\n    @ac('debug', 'Show a dump of the current lines in the scrollback + screen with their line attributes')\n    def dump_lines_with_attrs(self) -> None:\n        strings: List[str] = []\n        self.screen.dump_lines_with_attrs(strings.append)\n        text = ''.join(strings)\n        get_boss().display_scrollback(self, text, title='Dump of lines', report_cursor=False)\n\n    def write_to_child(self, data: Union[str, bytes]) -> None:\n        if data:\n            if isinstance(data, str):\n                data = data.encode('utf-8')\n            if get_boss().child_monitor.needs_write(self.id, data) is not True:\n                log_error(f'Failed to write to child {self.id} as it does not exist')\n\n    def title_updated(self) -> None:\n        update_window_title(self.os_window_id, self.tab_id, self.id, self.title)\n        t = self.tabref()\n        if t is not None:\n            t.title_changed(self)\n\n    def set_title(self, title: Optional[str]) -> None:\n        if title:\n            title = sanitize_title(title)\n        self.override_title = title or None\n        self.title_updated()\n\n    def desktop_notify(self, osc_code: int, raw_data: str) -> None:\n        if osc_code == 777:\n            if not raw_data.startswith('notify;'):\n                log_error(f'Ignoring unknown OSC 777: {raw_data}')\n                return  # unknown OSC 777\n            raw_data = raw_data[len('notify;'):]\n        cmd = handle_notification_cmd(osc_code, raw_data, self.id, self.prev_osc99_cmd)\n        if cmd is not None and osc_code == 99:\n            self.prev_osc99_cmd = cmd\n\n    # screen callbacks {{{\n    def use_utf8(self, on: bool) -> None:\n        get_boss().child_monitor.set_iutf8_winid(self.id, on)\n\n    def on_mouse_event(self, event: Dict[str, Any]) -> bool:\n        event['mods'] = event.get('mods', 0) & mod_mask\n        ev = MouseEvent(**event)\n        self.current_mouse_event_button = ev.button\n        action = get_options().mousemap.get(ev)\n        if action is None:\n            return False\n        return get_boss().combine(action, window_for_dispatch=self, dispatch_type='MouseEvent')\n\n    def open_url(self, url: str, hyperlink_id: int, cwd: Optional[str] = None) -> None:\n        opts = get_options()\n        if hyperlink_id:\n            if not opts.allow_hyperlinks:\n                return\n            from urllib.parse import unquote, urlparse, urlunparse\n            try:\n                purl = urlparse(url)\n            except Exception:\n                return\n            if (not purl.scheme or purl.scheme == 'file'):\n                if purl.netloc:\n                    from socket import gethostname\n                    try:\n                        hostname = gethostname()\n                    except Exception:\n                        hostname = ''\n                    remote_hostname = purl.netloc.partition(':')[0]\n                    if remote_hostname and remote_hostname != hostname and remote_hostname != 'localhost':\n                        self.handle_remote_file(purl.netloc, unquote(purl.path))\n                        return\n                    url = urlunparse(purl._replace(netloc=''))\n            if opts.allow_hyperlinks & 0b10:\n                from kittens.tui.operations import styled\n                get_boss().choose(\n                    'What would you like to do with this URL:\\n' + styled(unquote(url), fg='yellow'),\n                    partial(self.hyperlink_open_confirmed, url, cwd),\n                    'o:Open', 'c:Copy to clipboard', 'n;red:Nothing', default='o',\n                    window=self,\n                )\n                return\n        get_boss().open_url(url, cwd=cwd)\n\n    def hyperlink_open_confirmed(self, url: str, cwd: Optional[str], q: str) -> None:\n        if q == 'o':\n            get_boss().open_url(url, cwd=cwd)\n        elif q == 'c':\n            set_clipboard_string(url)\n\n    def handle_remote_file(self, netloc: str, remote_path: str) -> None:\n        from kittens.remote_file.main import is_ssh_kitten_sentinel\n        from kittens.ssh.main import get_connection_data\n\n        from .utils import SSHConnectionData\n        args = self.ssh_kitten_cmdline()\n        conn_data: Union[None, List[str], SSHConnectionData] = None\n        if args:\n            ssh_cmdline = sorted(self.child.foreground_processes, key=lambda p: p['pid'])[-1]['cmdline'] or ['']\n            if 'ControlPath=' in ' '.join(ssh_cmdline):\n                idx = ssh_cmdline.index('--')\n                conn_data = [is_ssh_kitten_sentinel] + list(ssh_cmdline[:idx + 2])\n        if conn_data is None:\n            args = self.child.foreground_cmdline\n            conn_data = get_connection_data(args, self.child.foreground_cwd or self.child.current_cwd or '')\n            if conn_data is None:\n                get_boss().show_error('Could not handle remote file', f'No SSH connection data found in: {args}')\n                return\n        get_boss().run_kitten(\n            'remote_file', '--hostname', netloc.partition(':')[0], '--path', remote_path,\n            '--ssh-connection-data', json.dumps(conn_data)\n        )\n\n    def send_signal_for_key(self, key_num: int) -> bool:\n        try:\n            return self.child.send_signal_for_key(key_num)\n        except OSError as err:\n            log_error(f'Failed to send signal for key to child with err: {err}')\n            return False\n\n    def focus_changed(self, focused: bool) -> None:\n        if self.destroyed:\n            return\n        call_watchers(weakref.ref(self), 'on_focus_change', {'focused': focused})\n        for c in self.actions_on_focus_change:\n            try:\n                c(self, focused)\n            except Exception:\n                import traceback\n                traceback.print_exc()\n        self.screen.focus_changed(focused)\n        if focused:\n            self.last_focused_at = monotonic()\n            update_ime_position_for_window(self.id, False, 1)\n            changed = self.needs_attention\n            self.needs_attention = False\n            if changed:\n                tab = self.tabref()\n                if tab is not None:\n                    tab.relayout_borders()\n        elif self.os_window_id == current_os_window():\n            # Cancel IME composition after loses focus\n            update_ime_position_for_window(self.id, False, -1)\n\n    def title_changed(self, new_title: Optional[str], is_base64: bool = False) -> None:\n        self.child_title = process_title_from_child(new_title or self.default_title, is_base64)\n        if self.override_title is None:\n            self.title_updated()\n\n    def icon_changed(self, new_icon: object) -> None:\n        pass  # TODO: Implement this\n\n    @property\n    def is_active(self) -> bool:\n        return get_boss().active_window is self\n\n    @property\n    def has_activity_since_last_focus(self) -> bool:\n        return self.screen.has_activity_since_last_focus()\n\n    def on_activity_since_last_focus(self) -> None:\n        if get_options().tab_activity_symbol:\n            get_boss().on_activity_since_last_focus(self)\n\n    def on_bell(self) -> None:\n        cb = get_options().command_on_bell\n        if cb and cb != ['none']:\n            import shlex\n            import subprocess\n            env = self.child.foreground_environ\n            env['KITTY_CHILD_CMDLINE'] = ' '.join(map(shlex.quote, self.child.cmdline))\n            subprocess.Popen(cb, env=env, cwd=self.child.foreground_cwd, preexec_fn=clear_handled_signals)\n        if not self.is_active:\n            changed = not self.needs_attention\n            self.needs_attention = True\n            tab = self.tabref()\n            if tab is not None:\n                if changed:\n                    tab.relayout_borders()\n                tab.on_bell(self)\n\n    def change_titlebar_color(self) -> None:\n        opts = get_options()\n        val = opts.macos_titlebar_color if is_macos else opts.wayland_titlebar_color\n        if val > 0:\n            if (val & 0xff) == 1:\n                val = self.screen.color_profile.default_bg\n            else:\n                val = val >> 8\n            set_titlebar_color(self.os_window_id, val)\n        else:\n            set_titlebar_color(self.os_window_id, 0, True, -val)\n\n    def change_colors(self, changes: Dict[DynamicColor, Optional[str]]) -> None:\n        dirtied = default_bg_changed = False\n\n        def item(raw: Optional[str]) -> int:\n            if raw is None:\n                return 0\n            v = to_color(raw)\n            if v is None:\n                return 0\n            return 0xff000000 | int(v)\n\n        for which, val_ in changes.items():\n            val = item(val_)\n            dirtied = True\n            setattr(self.screen.color_profile, which.name, val)\n            if which.name == 'default_bg':\n                default_bg_changed = True\n        if dirtied:\n            self.screen.mark_as_dirty()\n        if default_bg_changed:\n            get_boss().default_bg_changed_for(self.id)\n\n    def color_profile_popped(self, bg_changed: bool) -> None:\n        if bg_changed:\n            get_boss().default_bg_changed_for(self.id)\n\n    def report_color(self, code: str, r: int, g: int, b: int) -> None:\n        r |= r << 8\n        g |= g << 8\n        b |= b << 8\n        self.screen.send_escape_code_to_child(OSC, f'{code};rgb:{r:04x}/{g:04x}/{b:04x}')\n\n    def report_notification_activated(self, identifier: str) -> None:\n        identifier = sanitize_identifier_pat().sub('', identifier)\n        self.screen.send_escape_code_to_child(OSC, f'99;i={identifier};')\n\n    def set_dynamic_color(self, code: int, value: Union[str, bytes]) -> None:\n        if isinstance(value, bytes):\n            value = value.decode('utf-8')\n        color_changes: Dict[DynamicColor, Optional[str]] = {}\n        for val in value.split(';'):\n            w = DYNAMIC_COLOR_CODES.get(code)\n            if w is not None:\n                if val == '?':\n                    col = getattr(self.screen.color_profile, w.name)\n                    self.report_color(str(code), col >> 16, (col >> 8) & 0xff, col & 0xff)\n                else:\n                    q = None if code >= 100 else val\n                    color_changes[w] = q\n            code += 1\n        if color_changes:\n            self.change_colors(color_changes)\n\n    def set_color_table_color(self, code: int, value: str) -> None:\n        cp = self.screen.color_profile\n        if code == 4:\n            changed = False\n            for c, val in parse_color_set(value):\n                if val is None:  # color query\n                    qc = self.screen.color_profile.as_color((c << 8) | 1)\n                    assert qc is not None\n                    self.report_color(f'4;{c}', qc.red, qc.green, qc.blue)\n                else:\n                    changed = True\n                    cp.set_color(c, val)\n            if changed:\n                self.refresh()\n        elif code == 104:\n            if not value.strip():\n                cp.reset_color_table()\n            else:\n                for x in value.split(';'):\n                    try:\n                        y = int(x)\n                    except Exception:\n                        continue\n                    if 0 <= y <= 255:\n                        cp.reset_color(y)\n            self.refresh()\n\n    def request_capabilities(self, q: str) -> None:\n        for result in get_capabilities(q, get_options()):\n            self.screen.send_escape_code_to_child(DCS, result)\n\n    def handle_remote_cmd(self, cmd: str) -> None:\n        get_boss().handle_remote_cmd(cmd, self)\n\n    def handle_remote_echo(self, msg: str) -> None:\n        from base64 import standard_b64decode\n        data = standard_b64decode(msg)\n        self.write_to_child(data)\n\n    def handle_remote_ssh(self, msg: str) -> None:\n        from kittens.ssh.main import get_ssh_data\n        for line in get_ssh_data(msg, f'{os.getpid()}-{self.id}'):\n            self.write_to_child(line)\n\n    def handle_kitten_result(self, msg: str) -> None:\n        import base64\n        self.kitten_result = json.loads(base64.b85decode(msg))\n        for processor in self.kitten_result_processors:\n            try:\n                processor(self, self.kitten_result)\n            except Exception:\n                import traceback\n                traceback.print_exc()\n\n    def add_kitten_result_processor(self, callback: Callable[['Window', Any], None]) -> None:\n        self.kitten_result_processors.append(callback)\n\n    def handle_overlay_ready(self, msg: str) -> None:\n        boss = get_boss()\n        tab = boss.tab_for_window(self)\n        if tab is not None:\n            tab.move_window_to_top_of_group(self)\n\n    def append_remote_data(self, msg: str) -> str:\n        if not msg:\n            cdata = ''.join(self.current_remote_data)\n            self.current_remote_data = []\n            return cdata\n        num, rest = msg.split(':', 1)\n        max_size = get_options().clipboard_max_size * 1024 * 1024\n        if num == '0' or sum(map(len, self.current_remote_data)) > max_size:\n            self.current_remote_data = []\n        self.current_remote_data.append(rest)\n        return ''\n\n    def handle_remote_edit(self, msg: str) -> None:\n        cdata = self.append_remote_data(msg)\n        if cdata:\n            from .launch import remote_edit\n            remote_edit(cdata, self)\n\n    def handle_remote_clone(self, msg: str) -> None:\n        cdata = self.append_remote_data(msg)\n        if cdata:\n            ac = get_options().allow_cloning\n            if ac == 'ask':\n                get_boss().confirm(_(\n                    'A program running in this window wants to clone it into another window.'\n                    ' Allow it do so, once?'),\n                    partial(self.handle_remote_clone_confirmation, cdata), window=self,\n                )\n            elif ac in ('yes', 'y', 'true'):\n                self.handle_remote_clone_confirmation(cdata, True)\n\n    def handle_remote_clone_confirmation(self, cdata: str, confirmed: bool) -> None:\n        if confirmed:\n            from .launch import clone_and_launch\n            clone_and_launch(cdata, self)\n\n    def handle_remote_askpass(self, msg: str) -> None:\n        from .shm import SharedMemory\n        with SharedMemory(name=msg, readonly=True) as shm:\n            shm.seek(1)\n            data = json.loads(shm.read_data_with_size())\n\n        def callback(ans: Any) -> None:\n            data = json.dumps(ans)\n            with SharedMemory(name=msg) as shm:\n                shm.seek(1)\n                shm.write_data_with_size(data)\n                shm.flush()\n                shm.seek(0)\n                shm.write(b'\\x01')\n\n        message: str = data['message']\n        if data['type'] == 'confirm':\n            get_boss().confirm(\n                message, callback, window=self, confirm_on_cancel=bool(data.get('confirm_on_cancel')),\n                confirm_on_accept=bool(data.get('confirm_on_accept', True)))\n        elif data['type'] == 'choose':\n            get_boss().choose(\n                message, callback, *data['choices'], window=self, default=data.get('default', ''))\n        elif data['type'] == 'get_line':\n            get_boss().get_line(\n                message, callback, window=self, is_password=bool(data.get('is_password')), prompt=data.get('prompt', '> '))\n        else:\n            log_error(f'Ignoring ask request with unknown type: {data[\"type\"]}')\n\n    def handle_remote_print(self, msg: str) -> None:\n        text = process_remote_print(msg)\n        print(text, end='', file=sys.stderr)\n        sys.stderr.flush()\n\n    def send_cmd_response(self, response: Any) -> None:\n        self.screen.send_escape_code_to_child(DCS, '@kitty-cmd' + json.dumps(response))\n\n    def file_transmission(self, data: str) -> None:\n        self.file_transmission_control.handle_serialized_command(data)\n\n    def clipboard_control(self, data: str, is_partial: bool = False) -> None:\n        where, text = data.partition(';')[::2]\n        if is_partial:\n            if self.clipboard_pending is None:\n                self.clipboard_pending = ClipboardPending(where, text)\n            else:\n                self.clipboard_pending = self.clipboard_pending._replace(data=self.clipboard_pending[1] + text)\n                limit = get_options().clipboard_max_size\n                if limit and len(self.clipboard_pending.data) > limit * 1024 * 1024:\n                    log_error('Discarding part of too large OSC 52 paste request')\n                    self.clipboard_pending = self.clipboard_pending._replace(data='', truncated=True)\n            return\n\n        if not where:\n            if self.clipboard_pending is not None:\n                text = self.clipboard_pending.data + text\n                where = self.clipboard_pending.where\n                try:\n                    if self.clipboard_pending.truncated:\n                        return\n                finally:\n                    self.clipboard_pending = None\n            else:\n                where = 's0'\n        cc = get_options().clipboard_control\n        if text == '?':\n            response = None\n            if 's' in where or 'c' in where:\n                if 'read-clipboard-ask' in cc:\n                    return self.ask_to_read_clipboard(False)\n                response = get_clipboard_string() if 'read-clipboard' in cc else ''\n                loc = 'c'\n            elif 'p' in where:\n                if 'read-primary-ask' in cc:\n                    return self.ask_to_read_clipboard(True)\n                response = get_primary_selection() if 'read-primary' in cc else ''\n                loc = 'p'\n            response = response or ''\n            self.send_osc52(loc, response or '')\n\n        else:\n            from base64 import standard_b64decode\n            try:\n                text = standard_b64decode(text).decode('utf-8')\n            except Exception:\n                text = ''\n\n            if 's' in where or 'c' in where:\n                if 'write-clipboard' in cc:\n                    set_clipboard_string(text)\n            if 'p' in where:\n                if 'write-primary' in cc:\n                    set_primary_selection(text)\n        self.clipboard_pending = None\n\n    def send_osc52(self, loc: str, response: str) -> None:\n        from base64 import standard_b64encode\n        self.screen.send_escape_code_to_child(OSC, '52;{};{}'.format(\n            loc, standard_b64encode(response.encode('utf-8')).decode('ascii')))\n\n    def ask_to_read_clipboard(self, primary: bool = False) -> None:\n        if self.current_clipboard_read_ask is not None:\n            self.current_clipboard_read_ask = primary\n            return\n        self.current_clipboard_read_ask = primary\n        get_boss().confirm(_(\n            'A program running in this window wants to read from the system clipboard.'\n            ' Allow it do so, once?'),\n            self.handle_clipboard_confirmation, window=self,\n        )\n\n    def handle_clipboard_confirmation(self, confirmed: bool) -> None:\n        try:\n            loc = 'p' if self.current_clipboard_read_ask else 'c'\n            response = ''\n            if confirmed:\n                response = get_primary_selection() if self.current_clipboard_read_ask else get_clipboard_string()\n            self.send_osc52(loc, response)\n        finally:\n            self.current_clipboard_read_ask = None\n\n    def manipulate_title_stack(self, pop: bool, title: str, icon: Any) -> None:\n        if title:\n            if pop:\n                if self.title_stack:\n                    self.child_title = self.title_stack.pop()\n                    self.title_updated()\n            else:\n                if self.child_title:\n                    self.title_stack.append(self.child_title)\n    # }}}\n\n    # mouse actions {{{\n    @ac('mouse', '''\n        Handle a mouse click\n\n        Try to perform the specified actions one after the other till one of them is successful.\n        Supported actions are::\n\n            selection - check for a selection and if one exists abort processing\n            link - if a link exists under the mouse, click it\n            prompt - if the mouse click happens at a shell prompt move the cursor to the mouse location\n\n        For examples, see :ref:`conf-kitty-mouse.mousemap`\n        ''')\n    def mouse_handle_click(self, *actions: str) -> None:\n        for a in actions:\n            if a == 'selection':\n                if self.screen.has_selection():\n                    break\n            if a == 'link':\n                if click_mouse_url(self.os_window_id, self.tab_id, self.id):\n                    break\n            if a == 'prompt':\n                # Do not send move cursor events too soon after the window is\n                # focused, this is because there are people that click on\n                # windows and start typing immediately and the cursor event\n                # can interfere with that. See https://github.com/kovidgoyal/kitty/issues/4128\n                if monotonic() - self.last_focused_at < 1.5 * get_click_interval():\n                    return\n                if move_cursor_to_mouse_if_in_prompt(self.os_window_id, self.tab_id, self.id):\n                    self.screen.ignore_bells_for(1)\n                    break\n\n    @ac('mouse', 'Click the URL under the mouse')\n    def mouse_click_url(self) -> None:\n        self.mouse_handle_click('link')\n\n    @ac('mouse', 'Click the URL under the mouse only if the screen has no selection')\n    def mouse_click_url_or_select(self) -> None:\n        self.mouse_handle_click('selection', 'link')\n\n    @ac('mouse', '''\n        Manipulate the selection based on the current mouse position\n\n        For examples, see :ref:`conf-kitty-mouse.mousemap`\n        ''')\n    def mouse_selection(self, code: int) -> None:\n        mouse_selection(self.os_window_id, self.tab_id, self.id, code, self.current_mouse_event_button)\n\n    @ac('mouse', 'Paste the current primary selection')\n    def paste_selection(self) -> None:\n        txt = get_boss().current_primary_selection()\n        if txt:\n            self.paste_with_actions(txt)\n\n    @ac('mouse', 'Paste the current primary selection or the clipboard if no selection is present')\n    def paste_selection_or_clipboard(self) -> None:\n        txt = get_boss().current_primary_selection_or_clipboard()\n        if txt:\n            self.paste_with_actions(txt)\n\n    @ac('mouse', '''\n        Select clicked command output\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def mouse_select_command_output(self) -> None:\n        click_mouse_cmd_output(self.os_window_id, self.tab_id, self.id, True)\n\n    @ac('mouse', '''\n        Show clicked command output in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def mouse_show_command_output(self) -> None:\n        if click_mouse_cmd_output(self.os_window_id, self.tab_id, self.id, False):\n            self.show_cmd_output(CommandOutput.last_visited, 'Clicked command output')\n    # }}}\n\n    def text_for_selection(self, as_ansi: bool = False) -> str:\n        sts = get_options().strip_trailing_spaces\n        strip_trailing_spaces = sts == 'always' or (sts == 'smart' and not self.screen.is_rectangle_select())\n        lines = self.screen.text_for_selection(as_ansi, strip_trailing_spaces)\n        return ''.join(lines)\n\n    def call_watchers(self, which: Iterable[Watcher], data: Dict[str, Any]) -> None:\n        boss = get_boss()\n        for w in which:\n            try:\n                w(boss, self, data)\n            except Exception:\n                import traceback\n                traceback.print_exc()\n\n    def destroy(self) -> None:\n        self.call_watchers(self.watchers.on_close, {})\n        self.destroyed = True\n        del self.kitten_result_processors\n        if hasattr(self, 'screen'):\n            if self.is_active and self.os_window_id == current_os_window():\n                # Cancel IME composition when window is destroyed\n                update_ime_position_for_window(self.id, False, -1)\n            # Remove cycles so that screen is de-allocated immediately\n            self.screen.reset_callbacks()\n            del self.screen\n\n    def as_text(\n        self,\n        as_ansi: bool = False,\n        add_history: bool = False,\n        add_wrap_markers: bool = False,\n        alternate_screen: bool = False,\n        add_cursor: bool = False\n    ) -> str:\n        return as_text(self.screen, as_ansi, add_history, add_wrap_markers, alternate_screen, add_cursor)\n\n    def cmd_output(self, which: CommandOutput = CommandOutput.last_run, as_ansi: bool = False, add_wrap_markers: bool = False) -> str:\n        return cmd_output(self.screen, which, as_ansi, add_wrap_markers)\n\n    def get_cwd_of_child(self, oldest: bool = False) -> Optional[str]:\n        return self.child.get_foreground_cwd(oldest) or self.child.current_cwd\n\n    @property\n    def cwd_of_child(self) -> Optional[str]:\n        return self.get_cwd_of_child()\n\n    @property\n    def child_is_remote(self) -> bool:\n        for p in self.child.foreground_processes:\n            q = list(p['cmdline'] or ())\n            if q and q[0].lower() == 'ssh':\n                return True\n        return False\n\n    def ssh_kitten_cmdline(self) -> List[str]:\n        from kittens.ssh.utils import is_kitten_cmdline\n        for p in self.child.foreground_processes:\n            q = list(p['cmdline'] or ())\n            if is_kitten_cmdline(q):\n                return q\n        return []\n\n    def pipe_data(self, text: str, has_wrap_markers: bool = False) -> PipeData:\n        text = text or ''\n        if has_wrap_markers:\n            text = text.replace('\\r\\n', '\\n').replace('\\r', '\\n')\n        lines = text.count('\\n')\n        input_line_number = (lines - (self.screen.lines - 1) - self.screen.scrolled_by)\n        return {\n            'input_line_number': input_line_number,\n            'scrolled_by': self.screen.scrolled_by,\n            'cursor_x': self.screen.cursor.x + 1,\n            'cursor_y': self.screen.cursor.y + 1,\n            'lines': self.screen.lines,\n            'columns': self.screen.columns,\n            'text': text\n        }\n\n    def set_logo(self, path: str, position: str = '', alpha: float = -1) -> None:\n        path = resolve_custom_file(path) if path else ''\n        set_window_logo(self.os_window_id, self.tab_id, self.id, path, position or '', alpha)\n\n    def paste_with_actions(self, text: str) -> None:\n        if self.destroyed or not text:\n            return\n        opts = get_options()\n        if 'filter' in opts.paste_actions:\n            text = load_paste_filter()(text)\n            if not text:\n                return\n        if 'quote-urls-at-prompt' in opts.paste_actions and self.at_prompt:\n            prefixes = '|'.join(opts.url_prefixes)\n            m = re.match(f'({prefixes}):(.+)', text)\n            if m is not None:\n                scheme, rest = m.group(1), m.group(2)\n                if rest.startswith('//') or scheme in ('mailto', 'irc'):\n                    import shlex\n                    text = shlex.quote(text)\n        btext = text.encode('utf-8')\n        if 'confirm' in opts.paste_actions:\n            msg = ''\n            limit = 16 * 1024\n            if not self.screen.in_bracketed_paste_mode:\n                msg = _('Pasting text into shells that do not support bracketed paste can be dangerous.')\n            elif len(btext) > limit:\n                msg = _('Pasting very large amounts of text ({} bytes) can be slow.').format(len(btext))\n            if msg:\n                get_boss().confirm(msg + _(' Are you sure?'), partial(self.handle_paste_confirmation, btext), window=self)\n                return\n        self.paste_text(btext)\n\n    def handle_paste_confirmation(self, btext: bytes, confirmed: bool) -> None:\n        if confirmed:\n            self.paste_text(btext)\n\n    def paste_bytes(self, text: Union[str, bytes]) -> None:\n        # paste raw bytes without any processing\n        if isinstance(text, str):\n            text = text.encode('utf-8')\n        self.screen.paste_bytes(text)\n\n    def paste_text(self, text: Union[str, bytes]) -> None:\n        if text and not self.destroyed:\n            if isinstance(text, str):\n                text = text.encode('utf-8')\n            if self.screen.in_bracketed_paste_mode:\n                while True:\n                    new_text = text.replace(b'\\033[201~', b'').replace(b'\\x9b201~', b'')\n                    if len(text) == len(new_text):\n                        break\n                    text = new_text\n            else:\n                # Workaround for broken editors like nano that cannot handle\n                # newlines in pasted text see https://github.com/kovidgoyal/kitty/issues/994\n                text = text.replace(b'\\r\\n', b'\\n').replace(b'\\n', b'\\r')\n            self.screen.paste(text)\n\n    def clear_screen(self, reset: bool = False, scrollback: bool = False) -> None:\n        self.screen.cursor.x = self.screen.cursor.y = 0\n        if reset:\n            self.screen.reset()\n        else:\n            self.screen.erase_in_display(3 if scrollback else 2, False)\n\n    # actions {{{\n\n    @ac('cp', 'Show scrollback in a pager like less')\n    def show_scrollback(self) -> None:\n        text = self.as_text(as_ansi=True, add_history=True, add_wrap_markers=True)\n        data = self.pipe_data(text, has_wrap_markers=True)\n        cursor_on_screen = self.screen.scrolled_by < self.screen.lines - self.screen.cursor.y\n        get_boss().display_scrollback(self, data['text'], data['input_line_number'], report_cursor=cursor_on_screen)\n\n    def show_cmd_output(self, which: CommandOutput, title: str = 'Command output', as_ansi: bool = True, add_wrap_markers: bool = True) -> None:\n        text = self.cmd_output(which, as_ansi=as_ansi, add_wrap_markers=add_wrap_markers)\n        text = text.replace('\\r\\n', '\\n').replace('\\r', '\\n')\n        get_boss().display_scrollback(self, text, title=title, report_cursor=False)\n\n    @ac('cp', '''\n        Show output from the first shell command on screen in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def show_first_command_output_on_screen(self) -> None:\n        self.show_cmd_output(CommandOutput.first_on_screen, 'First command output on screen')\n\n    @ac('cp', '''\n        Show output from the last shell command in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def show_last_command_output(self) -> None:\n        self.show_cmd_output(CommandOutput.last_run, 'Last command output')\n\n    @ac('cp', '''\n        Show the first command output below the last scrolled position via scroll_to_prompt\n        or the last mouse clicked command output in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def show_last_visited_command_output(self) -> None:\n        self.show_cmd_output(CommandOutput.last_visited, 'Last visited command output')\n\n    @ac('cp', '''\n        Show the last non-empty output from a shell command in a pager like less\n\n        Requires :ref:`shell_integration` to work\n        ''')\n    def show_last_non_empty_command_output(self) -> None:\n        self.show_cmd_output(CommandOutput.last_non_empty, 'Last non-empty command output')\n\n    @ac('cp', 'Paste the specified text into the current window')\n    def paste(self, text: str) -> None:\n        self.paste_with_actions(text)\n\n    @ac('cp', 'Copy the selected text from the active window to the clipboard')\n    def copy_to_clipboard(self) -> None:\n        text = self.text_for_selection()\n        if text:\n            set_clipboard_string(text)\n\n    @ac('cp', 'Copy the selected text from the active window to the clipboard with ANSI formatting codes')\n    def copy_ansi_to_clipboard(self) -> None:\n        text = self.text_for_selection(as_ansi=True)\n        if text:\n            set_clipboard_string(text)\n\n    def encoded_key(self, key_event: KeyEvent) -> bytes:\n        return encode_key_for_tty(\n            key=key_event.key, shifted_key=key_event.shifted_key, alternate_key=key_event.alternate_key,\n            mods=key_event.mods, action=key_event.action, text=key_event.text,\n            key_encoding_flags=self.screen.current_key_encoding_flags(),\n            cursor_key_mode=self.screen.cursor_key_mode,\n        ).encode('ascii')\n\n    @ac('cp', 'Copy the selected text from the active window to the clipboard, if no selection, send SIGINT (aka :kbd:`ctrl+c`)')\n    def copy_or_interrupt(self) -> None:\n        text = self.text_for_selection()\n        if text:\n            set_clipboard_string(text)\n        else:\n            self.scroll_end()\n            self.write_to_child(self.encoded_key(KeyEvent(key=ord('c'), mods=GLFW_MOD_CONTROL)))\n\n    @ac('cp', 'Copy the selected text from the active window to the clipboard and clear selection, if no selection, send SIGINT (aka :kbd:`ctrl+c`)')\n    def copy_and_clear_or_interrupt(self) -> None:\n        self.copy_or_interrupt()\n        self.screen.clear_selection()\n\n    @ac('cp', 'Pass the selected text from the active window to the specified program')\n    def pass_selection_to_program(self, *args: str) -> None:\n        cwd = self.cwd_of_child\n        text = self.text_for_selection()\n        if text:\n            if args:\n                open_cmd(args, text, cwd=cwd)\n            else:\n                open_url(text, cwd=cwd)\n\n    @ac('cp', 'Clear the current selection')\n    def clear_selection(self) -> None:\n        self.screen.clear_selection()\n\n    @ac('sc', 'Scroll up by one line')\n    def scroll_line_up(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_LINE, True)\n\n    @ac('sc', 'Scroll down by one line')\n    def scroll_line_down(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_LINE, False)\n\n    @ac('sc', 'Scroll up by one page')\n    def scroll_page_up(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_PAGE, True)\n\n    @ac('sc', 'Scroll down by one page')\n    def scroll_page_down(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_PAGE, False)\n\n    @ac('sc', 'Scroll to the top of the scrollback buffer')\n    def scroll_home(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_FULL, True)\n\n    @ac('sc', 'Scroll to the bottom of the scrollback buffer')\n    def scroll_end(self) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll(SCROLL_FULL, False)\n\n    @ac('sc', '''\n        Scroll to the previous/next shell command prompt\n        Allows easy jumping from one command to the next. Requires working\n        :ref:`shell_integration`. Takes a single, optional, number as argument which is\n        the number of prompts to jump, negative values jump up and positive values jump down.\n        A value of zero will jump to the last prompt visited by this action.\n        For example::\n\n            map ctrl+p scroll_to_prompt -1  # jump to previous\n            map ctrl+n scroll_to_prompt 1   # jump to next\n            map ctrl+o scroll_to_prompt 0   # jump to last visited\n        ''')\n    def scroll_to_prompt(self, num_of_prompts: int = -1) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll_to_prompt(num_of_prompts)\n\n    @ac('sc', 'Scroll prompt to the top of the screen, filling screen with empty lines')\n    def scroll_prompt_to_top(self, clear_scrollback: bool = False) -> None:\n        if self.screen.is_main_linebuf():\n            self.screen.scroll_until_cursor_prompt()\n            if clear_scrollback:\n                self.screen.clear_scrollback()\n            elif self.screen.scrolled_by > 0:\n                self.screen.scroll(SCROLL_FULL, False)\n\n    @ac('sc', 'Scroll prompt to the bottom of the screen, filling in extra lines from the scrollback buffer')\n    def scroll_prompt_to_bottom(self) -> None:\n        self.screen.scroll_prompt_to_bottom()\n\n    @ac('mk', 'Toggle the current marker on/off')\n    def toggle_marker(self, ftype: str, spec: Union[str, Tuple[Tuple[int, str], ...]], flags: int) -> None:\n        from .marks import marker_from_spec\n        key = ftype, spec\n        if key == self.current_marker_spec:\n            self.remove_marker()\n            return\n        self.screen.set_marker(marker_from_spec(ftype, spec, flags))\n        self.current_marker_spec = key\n\n    def set_marker(self, spec: Union[str, Sequence[str]]) -> None:\n        from .marks import marker_from_spec\n        from .options.utils import parse_marker_spec, toggle_marker\n        if isinstance(spec, str):\n            func, (ftype, spec_, flags) = toggle_marker('toggle_marker', spec)\n        else:\n            ftype, spec_, flags = parse_marker_spec(spec[0], spec[1:])\n        key = ftype, spec_\n        self.screen.set_marker(marker_from_spec(ftype, spec_, flags))\n        self.current_marker_spec = key\n\n    @ac('mk', 'Remove a previously created marker')\n    def remove_marker(self) -> None:\n        if self.current_marker_spec is not None:\n            self.screen.set_marker()\n            self.current_marker_spec = None\n\n    @ac('mk', 'Scroll to the next or previous mark of the specified type')\n    def scroll_to_mark(self, prev: bool = True, mark: int = 0) -> None:\n        self.screen.scroll_to_next_mark(mark, prev)\n\n    @ac('misc', '''\n        Send the specified SIGNAL to the foreground process in the active window\n\n        For example::\n\n            map f1 signal_child SIGTERM\n        ''')\n    def signal_child(self, *signals: int) -> None:\n        pid = self.child.pid_for_cwd\n        if pid is not None:\n            for sig in signals:\n                os.kill(pid, sig)\n\n    @ac('misc', '''\n    Display the specified kitty documentation, preferring a local copy, if found.\n\n    For example::\n\n        # show the config docs\n        map f1 show_kitty_doc conf\n        # show the ssh kitten docs\n        map f1 show_kitty_doc kittens/ssh\n    ''')\n    def show_kitty_doc(self, which: str = '') -> None:\n        url = docs_url(which)\n        get_boss().open_url(url)\n    # }}}\n", "#!/usr/bin/env python3\n# License: GPL v3 Copyright: 2016, Kovid Goyal <kovid at kovidgoyal.net>\n\nimport os\nimport sys\nimport tempfile\n\nfrom kitty.config import build_ansi_color_table, defaults\nfrom kitty.fast_data_types import (\n    Color, ColorProfile, Cursor as C, HistoryBuf, LineBuf,\n    parse_input_from_terminal, strip_csi, truncate_point_for_length, wcswidth,\n    wcwidth\n)\nfrom kitty.rgb import to_color\nfrom kitty.utils import is_path_in_temp_dir, sanitize_title\n\nfrom . import BaseTest, filled_cursor, filled_history_buf, filled_line_buf\n\n\ndef create_lbuf(*lines):\n    maxw = max(map(len, lines))\n    ans = LineBuf(len(lines), maxw)\n    prev_full_length = False\n    for i, l0 in enumerate(lines):\n        ans.line(i).set_text(l0, 0, len(l0), C())\n        ans.set_continued(i, prev_full_length)\n        prev_full_length = len(l0) == maxw\n    return ans\n\n\nclass TestDataTypes(BaseTest):\n\n    def test_to_color(self):\n        for x in 'xxx #12 #1234 rgb:a/b'.split():\n            self.assertIsNone(to_color(x))\n\n        def c(spec, r=0, g=0, b=0, a=0):\n            c = to_color(spec)\n            self.ae(c.red, r)\n            self.ae(c.green, g)\n            self.ae(c.blue, b)\n            self.ae(c.alpha, a)\n\n        c('#eee', 0xee, 0xee, 0xee)\n        c('#234567', 0x23, 0x45, 0x67)\n        c('#abcabcdef', 0xab, 0xab, 0xde)\n        c('rgb:e/e/e', 0xee, 0xee, 0xee)\n        c('rgb:23/45/67', 0x23, 0x45, 0x67)\n        c('rgb:abc/abc/def', 0xab, 0xab, 0xde)\n        c('red', 0xff)\n        self.ae(int(Color(1, 2, 3)), 0x10203)\n        base = Color(12, 12, 12)\n        a = Color(23, 23, 23)\n        b = Color(100, 100, 100)\n        self.assertLess(base.contrast(a), base.contrast(b))\n        self.ae(Color(1, 2, 3).as_sgr, ':2:1:2:3')\n        self.ae(Color(1, 2, 3).as_sharp, '#010203')\n        self.ae(Color(1, 2, 3, 4).as_sharp, '#04010203')\n        self.ae(Color(1, 2, 3, 4).rgb, 0x10203)\n\n    def test_linebuf(self):\n        old = filled_line_buf(2, 3, filled_cursor())\n        new = LineBuf(1, 3)\n        new.copy_old(old)\n        self.ae(new.line(0), old.line(1))\n        new.clear()\n        self.ae(str(new.line(0)), '')\n        old.set_attribute('reverse', False)\n        for y in range(old.ynum):\n            for x in range(old.xnum):\n                l0 = old.line(y)\n                c = l0.cursor_from(x)\n                self.assertFalse(c.reverse)\n                self.assertTrue(c.bold)\n        self.assertFalse(old.is_continued(0))\n        old.set_continued(0, True)\n        self.assertTrue(old.is_continued(0))\n        self.assertFalse(old.is_continued(1))\n\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb2 = LineBuf(5, 5)\n        lb2.copy_old(lb)\n        lb.index(0, 4)\n        for i in range(0, 4):\n            self.ae(lb.line(i), lb2.line(i + 1))\n        self.ae(lb.line(4), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.index(1, 3)\n        self.ae(lb.line(0), lb2.line(0))\n        self.ae(lb.line(1), lb2.line(2))\n        self.ae(lb.line(2), lb2.line(3))\n        self.ae(lb.line(3), lb2.line(1))\n        self.ae(lb.line(4), lb2.line(4))\n        self.ae(lb.create_line_copy(1), lb2.line(2))\n        l2 = lb.create_line_copy(2)\n        lb.copy_line_to(1, l2)\n        self.ae(l2, lb2.line(2))\n        lb.clear_line(0)\n        self.ae(lb.line(0), LineBuf(1, lb.xnum).create_line_copy(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.reverse_index(0, 4)\n        self.ae(lb.line(0), lb2.line(4))\n        for i in range(1, 5):\n            self.ae(lb.line(i), lb2.line(i - 1))\n\n        lb = filled_line_buf(5, 5, filled_cursor())\n        clb = filled_line_buf(5, 5, filled_cursor())\n        lb2 = LineBuf(1, 5)\n        lb.insert_lines(2, 1, lb.ynum - 1)\n        self.ae(lb.line(0), clb.line(0))\n        self.ae(lb.line(3), clb.line(1))\n        self.ae(lb.line(4), clb.line(2))\n        self.ae(lb.line(1), lb2.line(0))\n        self.ae(lb.line(2), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.insert_lines(10, 0, lb.ynum - 1)\n        for i in range(lb.ynum):\n            self.ae(lb.line(i), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.insert_lines(10, 1, lb.ynum - 1)\n        self.ae(lb.line(0), clb.line(0))\n        for i in range(1, lb.ynum):\n            self.ae(lb.line(i), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.insert_lines(1, 1, 3)\n        self.ae(lb.line(0), clb.line(0))\n        self.ae(lb.line(1), lb2.line(0))\n        self.ae(lb.line(2), clb.line(1))\n        self.ae(lb.line(3), clb.line(2))\n        self.ae(lb.line(4), clb.line(4))\n\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.delete_lines(2, 1, lb.ynum - 1)\n        self.ae(lb.line(0), clb.line(0))\n        self.ae(lb.line(1), clb.line(3))\n        self.ae(lb.line(2), clb.line(4))\n        self.ae(lb.line(3), lb2.line(0))\n        self.ae(lb.line(4), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.delete_lines(10, 0, lb.ynum - 1)\n        for i in range(lb.ynum):\n            self.ae(lb.line(i), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.delete_lines(10, 1, lb.ynum - 1)\n        self.ae(lb.line(0), clb.line(0))\n        for i in range(1, lb.ynum):\n            self.ae(lb.line(i), lb2.line(0))\n        lb = filled_line_buf(5, 5, filled_cursor())\n        lb.delete_lines(1, 1, 3)\n        self.ae(lb.line(0), clb.line(0))\n        self.ae(lb.line(1), clb.line(2))\n        self.ae(lb.line(2), clb.line(3))\n        self.ae(lb.line(3), lb2.line(0))\n        self.ae(lb.line(4), clb.line(4))\n\n        lb = filled_line_buf(5, 5, filled_cursor())\n        l0 = lb.line(0)\n        l0.add_combining_char(1, '\\u0300')\n        l0.clear_text(1, 2)\n        self.ae(str(l0), '0  00')\n        self.assertEqualAttributes(l0.cursor_from(1), l0.cursor_from(0))\n\n        lb = filled_line_buf(10, 10, filled_cursor())\n        lb.clear()\n        lb2 = LineBuf(lb.ynum, lb.ynum)\n        for i in range(lb.ynum):\n            self.ae(lb.line(i), lb2.line(i))\n\n    def test_line(self):\n        lb = LineBuf(2, 3)\n        for y in range(lb.ynum):\n            line = lb.line(y)\n            self.ae(str(line), '')\n            for x in range(lb.xnum):\n                self.ae(line[x], '\\0')\n        with self.assertRaises(IndexError):\n            lb.line(lb.ynum)\n        with self.assertRaises(IndexError):\n            lb.line(0)[lb.xnum]\n        l0 = lb.line(0)\n        l0.set_text(' ', 0, len(' '), C())\n        l0.add_combining_char(0, '\\u0300')\n        self.ae(l0[0], ' \\u0300')\n        l0.add_combining_char(0, '\\U000e0100')\n        self.ae(l0[0], ' \\u0300\\U000e0100')\n        l0.add_combining_char(0, '\\u0302')\n        self.ae(l0[0], ' \\u0300\\U000e0100\\u0302')\n        l0.add_combining_char(0, '\\u0301')\n        self.ae(l0[0], ' \\u0300\\U000e0100\\u0301')\n        self.ae(l0[1], '\\0')\n        self.ae(str(l0), ' \\u0300\\U000e0100\\u0301')\n        t = 'Testing with simple text'\n        lb = LineBuf(2, len(t))\n        l0 = lb.line(0)\n        l0.set_text(t, 0, len(t), C())\n        self.ae(str(l0), t)\n        l0.set_text('a', 0, 1, C())\n        self.assertEqual(str(l0), 'a' + t[1:])\n\n        c = C(3, 5)\n        c.bold = c.italic = c.reverse = c.strikethrough = c.dim = True\n        c.fg = c.bg = c.decoration_fg = 0x0101\n        self.ae(c, c)\n        c2, c3 = c.copy(), c.copy()\n        self.ae(repr(c), repr(c2))\n        self.ae(c, c2)\n        c2.bold = False\n        self.assertNotEqual(c, c2)\n        l0.set_text(t, 0, len(t), C())\n        l0.apply_cursor(c2, 3)\n        self.assertEqualAttributes(c2, l0.cursor_from(3))\n        l0.apply_cursor(c2, 0, len(l0))\n        for i in range(len(l0)):\n            self.assertEqualAttributes(c2, l0.cursor_from(i))\n        l0.apply_cursor(c3, 0)\n        self.assertEqualAttributes(c3, l0.cursor_from(0))\n        l0.copy_char(0, l0, 1)\n        self.assertEqualAttributes(c3, l0.cursor_from(1))\n\n        t = '0123456789'\n        lb = LineBuf(1, len(t))\n        l3 = lb.line(0)\n        l3.set_text(t, 0, len(t), C())\n        self.ae(t, str(l3))\n        l3.right_shift(4, 2)\n        self.ae('0123454567', str(l3))\n        l3.set_text(t, 0, len(t), C())\n        l3.right_shift(0, 0)\n        self.ae(t, str(l3))\n        l3.right_shift(0, 1)\n        self.ae(str(l3), '0' + t[:-1])\n        l3.set_text(t, 0, len(t), C())\n        l3.left_shift(0, 2)\n        self.ae(str(l3), t[2:] + '89')\n        l3.set_text(t, 0, len(t), C())\n        l3.left_shift(7, 3)\n        self.ae(str(l3), t)\n\n        l3.set_text(t, 0, len(t), C())\n        q = C()\n        q.bold = q.italic = q.reverse = q.strikethrough = c.dim = True\n        q.decoration = 2\n        c = C()\n        c.x = 3\n        l3.set_text('axyb', 1, 2, c)\n        self.ae(str(l3), '012xy56789')\n        l3.set_char(0, 'x', 1, q)\n        self.assertEqualAttributes(l3.cursor_from(0), q)\n\n    def test_url_at(self):\n        self.set_options()\n\n        def create(t):\n            lb = create.lb = LineBuf(1, len(t))\n            lf = lb.line(0)\n            lf.set_text(t, 0, len(t), C())\n            return lf\n\n        l0 = create('file:///etc/test')\n        self.ae(l0.url_start_at(0), 0)\n\n        for trail in '.,\\\\':\n            lx = create(\"http://xyz.com\" + trail)\n            self.ae(lx.url_end_at(0), len(lx) - 2)\n        for trail in ')}]>':\n            lx = create(\"http://xyz.com\" + trail)\n            self.ae(lx.url_end_at(0), len(lx) - 1)\n        l0 = create(\"ftp://abc/\")\n        self.ae(l0.url_end_at(0), len(l0) - 1)\n        l2 = create(\"http://-abcd] \")\n        self.ae(l2.url_end_at(0), len(l2) - 2)\n        l3 = create(\"http://ab.de           \")\n        self.ae(l3.url_start_at(4), 0)\n        self.ae(l3.url_start_at(5), 0)\n\n        def lspace_test(n, scheme='http'):\n            lf = create(' ' * n + scheme + '://acme.com')\n            for i in range(0, n):\n                self.ae(lf.url_start_at(i), len(lf))\n            for i in range(n, len(lf)):\n                self.ae(lf.url_start_at(i), n)\n        for i in range(7):\n            for scheme in 'http https ftp file'.split():\n                lspace_test(i, scheme)\n        l3 = create('b https://testing.me a')\n        for s in (0, 1, len(l3) - 1, len(l3) - 2):\n            self.ae(l3.url_start_at(s), len(l3), 'failed with start at: %d' % s)\n        for s in range(2, len(l3) - 2):\n            self.ae(l3.url_start_at(s), 2, 'failed with start at: %d (%s)' % (s, str(l3)[s:]))\n\n        def no_url(t):\n            lf = create(t)\n            for s in range(len(lf)):\n                self.ae(lf.url_start_at(s), len(lf))\n        no_url('https:// testing.me a')\n        no_url('h ttp://acme.com')\n        no_url('http: //acme.com')\n        no_url('http:/ /acme.com')\n\n        l4 = create(' xxxxxtekljhgdkjgd')\n        self.ae(l4.url_end_at(0), 0)\n\n        for trail in '/-&':\n            l4 = create('http://a.b?q=1' + trail)\n            self.ae(l4.url_end_at(1), len(l4) - 1)\n\n        l4 = create('http://a.b.')\n        self.ae(l4.url_end_at(0), len(l4) - 2)\n        self.ae(l4.url_end_at(0, 0, True), len(l4) - 1)\n\n    def rewrap(self, lb, lb2):\n        hb = HistoryBuf(lb2.ynum, lb2.xnum)\n        cy = lb.rewrap(lb2, hb)\n        return hb, cy[1]\n\n    def test_rewrap_simple(self):\n        ' Same width buffers '\n        lb = filled_line_buf(5, 5)\n        lb2 = LineBuf(lb.ynum, lb.xnum)\n        self.rewrap(lb, lb2)\n        for i in range(lb.ynum):\n            self.ae(lb2.line(i), lb.line(i))\n        lb2 = LineBuf(8, 5)\n        cy = self.rewrap(lb, lb2)[1]\n        self.ae(cy, 5)\n        for i in range(lb.ynum):\n            self.ae(lb2.line(i), lb.line(i))\n        empty = LineBuf(1, lb2.xnum)\n        for i in range(lb.ynum, lb2.ynum):\n            self.ae(str(lb2.line(i)), str(empty.line(0)))\n        lb2 = LineBuf(3, 5)\n        cy = self.rewrap(lb, lb2)[1]\n        self.ae(cy, 3)\n        for i in range(lb2.ynum):\n            self.ae(lb2.line(i), lb.line(i + 2))\n        self.assertFalse(lb.dirty_lines())\n        self.ae(lb2.dirty_lines(), list(range(lb2.ynum)))\n\n    def line_comparison(self, buf, *lines):\n        for i, l0 in enumerate(lines):\n            l2 = buf.line(i)\n            self.ae(l0, str(l2))\n\n    def line_comparison_rewrap(self, lb, *lines):\n        lb2 = LineBuf(len(lines), max(map(len, lines)))\n        self.rewrap(lb, lb2)\n        self.line_comparison(lb2, *lines)\n        return lb2\n\n    def assertContinued(self, lb, *vals):\n        self.ae(list(vals), [lb.is_continued(i) for i in range(len(vals))])\n\n    def test_rewrap_wider(self):\n        ' New buffer wider '\n        lb = create_lbuf('0123 ', '56789')\n        lb2 = self.line_comparison_rewrap(lb, '0123 5', '6789', '')\n        self.assertContinued(lb2, False, True)\n        self.ae(lb2.dirty_lines(), [0, 1])\n\n        lb = create_lbuf('12', 'abc')\n        lb2 = self.line_comparison_rewrap(lb, '12', 'abc')\n        self.assertContinued(lb2, False, False)\n\n    def test_rewrap_narrower(self):\n        ' New buffer narrower '\n        lb = create_lbuf('123', 'abcde')\n        lb2 = self.line_comparison_rewrap(lb, '123', 'abc', 'de')\n        self.assertContinued(lb2, False, False, True)\n        lb = create_lbuf('123  ', 'abcde')\n        lb2 = self.line_comparison_rewrap(lb, '123', '  a', 'bcd', 'e')\n        self.assertContinued(lb2, False, True, True, True)\n\n    def test_utils(self):\n        def w(x):\n            return wcwidth(ord(x))\n        self.ae(wcswidth('a\\033[2mb'), 2)\n        self.ae(wcswidth('\\033a\\033[2mb'), 2)\n        self.ae(wcswidth('a\\033]8;id=moo;https://foo\\033\\\\a'), 2)\n        self.ae(wcswidth('a\\033x'), 2)\n        self.ae(tuple(map(w, 'a1\\0\u30b3\u30cb\u30c1 \u2714')), (1, 1, 0, 2, 2, 2, 1, 1))\n        self.ae(wcswidth('\\u2716\\u2716\\ufe0f\\U0001f337'), 5)\n        self.ae(wcswidth('\\u25b6\\ufe0f'), 2)\n        self.ae(wcswidth('\\U0001f610\\ufe0e'), 1)\n        self.ae(wcswidth('\\U0001f1e6a'), 3)\n        self.ae(wcswidth('\\U0001F1E6a\\U0001F1E8a'), 6)\n        self.ae(wcswidth('\\U0001F1E6\\U0001F1E8a'), 3)\n        self.ae(wcswidth('\\U0001F1E6\\U0001F1E8\\U0001F1E6'), 4)\n        self.ae(wcswidth('a\\u00adb'), 2)\n        # Regional indicator symbols (unicode flags) are defined as having\n        # Emoji_Presentation so must have width 2 but combined must have\n        # width 2 not 4\n        self.ae(tuple(map(w, '\\U0001f1ee\\U0001f1f3')), (2, 2))\n        self.ae(wcswidth('\\U0001f1ee\\U0001f1f3'), 2)\n        tpl = truncate_point_for_length\n        self.ae(tpl('abc', 4), 3)\n        self.ae(tpl('abc', 2), 2)\n        self.ae(tpl('abc', 0), 0)\n        self.ae(tpl('a\\U0001f337', 2), 1)\n        self.ae(tpl('a\\U0001f337', 3), 2)\n        self.ae(tpl('a\\U0001f337b', 4), 3)\n        self.ae(sanitize_title('a\\0\\01 \\t\\n\\f\\rb'), 'a b')\n        self.ae(tpl('a\\x1b[31mbc', 2), 7)\n\n        def tp(*data, leftover='', text='', csi='', apc='', ibp=False):\n            text_r, csi_r, apc_r, rest = [], [], [], []\n            left = ''\n            in_bp = ibp\n\n            def on_csi(x):\n                nonlocal in_bp\n                if x == '200~':\n                    in_bp = True\n                elif x == '201~':\n                    in_bp = False\n                csi_r.append(x)\n\n            for d in data:\n                left = parse_input_from_terminal(text_r.append, rest.append, on_csi, rest.append, rest.append, apc_r.append, left + d, in_bp)\n            self.ae(left, leftover)\n            self.ae(text, ' '.join(text_r))\n            self.ae(csi, ' '.join(csi_r))\n            self.ae(apc, ' '.join(apc_r))\n            self.assertFalse(rest)\n\n        tp('a\\033[200~\\033[32mxy\\033[201~\\033[33ma', text='a \\033[32m xy a', csi='200~ 201~ 33m')\n        tp('abc', text='abc')\n        tp('a\\033[38:5:12:32mb', text='a b', csi='38:5:12:32m')\n        tp('a\\033_x,;(\\033\\\\b', text='a b', apc='x,;(')\n        tp('a\\033', '[', 'mb', text='a b', csi='m')\n        tp('a\\033[', 'mb', text='a b', csi='m')\n        tp('a\\033', '_', 'x\\033', '\\\\b', text='a b', apc='x')\n        tp('a\\033_', 'x', '\\033', '\\\\', 'b', text='a b', apc='x')\n\n        for prefix in ('/tmp', tempfile.gettempdir()):\n            for path in ('a.png', 'x/b.jpg', 'y/../c.jpg'):\n                self.assertTrue(is_path_in_temp_dir(os.path.join(prefix, path)))\n        for path in ('/home/xy/d.png', '/tmp/../home/x.jpg'):\n            self.assertFalse(is_path_in_temp_dir(os.path.join(path)))\n\n    def test_color_profile(self):\n        c = ColorProfile()\n        c.update_ansi_color_table(build_ansi_color_table())\n        for i in range(8):\n            col = getattr(defaults, f'color{i}')\n            self.assertEqual(c.as_color(i << 8 | 1), col)\n        self.ae(c.as_color(255 << 8 | 1), Color(0xee, 0xee, 0xee))\n\n    def test_historybuf(self):\n        lb = filled_line_buf()\n        hb = HistoryBuf(5, 5)\n        hb.push(lb.line(1))\n        hb.push(lb.line(2))\n        self.ae(hb.count, 2)\n        self.ae(hb.line(0), lb.line(2))\n        self.ae(hb.line(1), lb.line(1))\n        hb = filled_history_buf()\n        self.ae(str(hb.line(0)), '4' * hb.xnum)\n        self.ae(str(hb.line(4)), '0' * hb.xnum)\n        hb.push(lb.line(2))\n        self.ae(str(hb.line(0)), '2' * hb.xnum)\n        self.ae(str(hb.line(4)), '1' * hb.xnum)\n        hb = large_hb = HistoryBuf(3000, 5)\n        c = filled_cursor()\n        for i in range(3000):\n            line = lb.line(1)\n            t = str(i).ljust(5)\n            line.set_text(t, 0, 5, c)\n            hb.push(line)\n        for i in range(3000):\n            self.ae(str(hb.line(i)).rstrip(), str(3000 - 1 - i))\n\n        # rewrap\n        hb = filled_history_buf(5, 5)\n        hb2 = HistoryBuf(hb.ynum, hb.xnum)\n        hb.rewrap(hb2)\n        for i in range(hb.ynum):\n            self.ae(hb2.line(i), hb.line(i))\n        hb2 = HistoryBuf(8, 5)\n        hb.rewrap(hb2)\n        for i in range(hb.ynum):\n            self.ae(hb2.line(i), hb.line(i))\n        for i in range(hb.ynum, hb2.ynum):\n            with self.assertRaises(IndexError):\n                hb2.line(i)\n        hb2 = HistoryBuf(3, 5)\n        hb.rewrap(hb2)\n        for i in range(hb2.ynum):\n            self.ae(hb2.line(i), hb.line(i))\n        self.ae(hb2.dirty_lines(), list(range(hb2.ynum)))\n        hb = filled_history_buf(5, 5)\n        hb2 = HistoryBuf(hb.ynum, hb.xnum * 2)\n        hb.rewrap(hb2)\n        hb3 = HistoryBuf(hb.ynum, hb.xnum)\n        hb2.rewrap(hb3)\n        for i in range(hb.ynum):\n            self.ae(hb.line(i), hb3.line(i))\n\n        hb2 = HistoryBuf(hb.ynum, hb.xnum)\n        large_hb.rewrap(hb2)\n        hb2 = HistoryBuf(large_hb.ynum, large_hb.xnum)\n        large_hb.rewrap(hb2)\n\n    def test_ansi_repr(self):\n        lb = filled_line_buf()\n        l0 = lb.line(0)\n        self.ae(l0.as_ansi(), '00000')\n        a = []\n        lb.as_ansi(a.append)\n        self.ae(a, [str(lb.line(i)) + '\\n' for i in range(lb.ynum)])\n        l2 = lb.line(0)\n        c = C()\n        c.bold = c.italic = c.reverse = c.strikethrough = c.dim = True\n        c.fg = (4 << 8) | 1\n        c.bg = (1 << 24) | (2 << 16) | (3 << 8) | 2\n        c.decoration_fg = (5 << 8) | 1\n        l2.set_text('1', 0, 1, c)\n        self.ae(l2.as_ansi(), '\\x1b[1;2;3;7;9;34;48:2:1:2:3;58:5:5m' '1'\n                '\\x1b[22;23;27;29;39;49;59m' '0000')\n        lb = filled_line_buf()\n        for i in range(lb.ynum):\n            lb.set_continued(i, True)\n        a = []\n        lb.as_ansi(a.append)\n        self.ae(a, [str(lb.line(i)) for i in range(lb.ynum)])\n        hb = filled_history_buf(5, 5)\n        a = []\n        hb.as_ansi(a.append)\n        self.ae(a, [str(hb.line(i)) + '\\n' for i in range(hb.count - 1, -1, -1)])\n\n    def test_strip_csi(self):\n        def q(x, y=''):\n            self.ae(y or x, strip_csi(x))\n        q('test')\n        q('a\\x1bbc', 'ac')\n        q('a\\x1b[bc', 'ac')\n        q('a\\x1b[12;34:43mbc', 'abc')\n\n    def test_single_key(self):\n        from kitty.fast_data_types import (\n            GLFW_MOD_KITTY, GLFW_MOD_SHIFT, SingleKey\n        )\n        for m in (GLFW_MOD_KITTY, GLFW_MOD_SHIFT):\n            s = SingleKey(mods=m)\n            self.ae(s.mods, m)\n        self.ae(tuple(iter(SingleKey())), (0, False, 0))\n        self.ae(tuple(SingleKey(key=sys.maxunicode, mods=GLFW_MOD_SHIFT, is_native=True)), (GLFW_MOD_SHIFT, True, sys.maxunicode))\n        self.ae(repr(SingleKey()), 'SingleKey()')\n        self.ae(repr(SingleKey(key=23, mods=2, is_native=True)), 'SingleKey(mods=2, is_native=True, key=23)')\n        self.ae(repr(SingleKey(key=23, mods=2)), 'SingleKey(mods=2, key=23)')\n        self.ae(repr(SingleKey(key=23)), 'SingleKey(key=23)')\n        self.ae(repr(SingleKey(key=0x1008ff57)), 'SingleKey(key=269025111)')\n        self.ae(repr(SingleKey(key=23)._replace(mods=2)), 'SingleKey(mods=2, key=23)')\n        self.ae(repr(SingleKey(key=23)._replace(key=-1, mods=GLFW_MOD_KITTY)), f'SingleKey(mods={GLFW_MOD_KITTY})')\n        self.assertEqual(SingleKey(key=1), SingleKey(key=1))\n        self.assertEqual(hash(SingleKey(key=1)), hash(SingleKey(key=1)))\n        self.assertNotEqual(hash(SingleKey(key=1, mods=2)), hash(SingleKey(key=1)))\n        self.assertNotEqual(SingleKey(key=1, mods=2), SingleKey(key=1))\n\n    def test_notify_identifier_sanitization(self):\n        from kitty.notify import sanitize_identifier_pat\n        self.ae(sanitize_identifier_pat().sub('', '\\x1b\\nabc\\n[*'), 'abc')\n"], "filenames": ["docs/changelog.rst", "kitty/notify.py", "kitty/window.py", "kitty_tests/datatypes.py"], "buggy_code_start_loc": [57, 3, 44, 557], "buggy_code_end_loc": [57, 111, 1003, 557], "fixing_code_start_loc": [58, 4, 44, 558], "fixing_code_end_loc": [62, 118, 1005, 562], "type": "CWE-116", "message": "In Kitty before 0.26.2, insufficient validation in the desktop notification escape sequence can lead to arbitrary code execution. The user must display attacker-controlled content in the terminal, then click on a notification popup.", "other": {"cve": {"id": "CVE-2022-41322", "sourceIdentifier": "cve@mitre.org", "published": "2022-09-23T05:15:08.937", "lastModified": "2023-03-03T18:48:56.477", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In Kitty before 0.26.2, insufficient validation in the desktop notification escape sequence can lead to arbitrary code execution. The user must display attacker-controlled content in the terminal, then click on a notification popup."}, {"lang": "es", "value": "En Kitty versiones anteriores a 0.26.2, una comprobaci\u00f3n insuficiente en la secuencia de escape de la notificaci\u00f3n de escritorio puede conllevar a una ejecuci\u00f3n de c\u00f3digo arbitrario. El usuario debe mostrar contenido controlado por el atacante en el terminal y luego hacer clic en una ventana emergente de notificaci\u00f3n."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "LOCAL", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.8, "impactScore": 5.9}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-116"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:kitty_project:kitty:*:*:*:*:*:*:*:*", "versionEndExcluding": "0.26.2", "matchCriteriaId": "50C86F7E-9966-413D-A699-05F2E8C08D49"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:fedoraproject:fedora:36:*:*:*:*:*:*:*", "matchCriteriaId": "5C675112-476C-4D7C-BCB9-A2FB2D0BC9FD"}, {"vulnerable": true, "criteria": "cpe:2.3:o:fedoraproject:fedora:37:*:*:*:*:*:*:*", "matchCriteriaId": "E30D0E6F-4AE8-4284-8716-991DFA48CC5D"}]}]}], "references": [{"url": "https://bugs.gentoo.org/868543", "source": "cve@mitre.org", "tags": ["Exploit", "Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://github.com/kovidgoyal/kitty/commit/f05783e64d5fa62e1aed603e8d69aced5e49824f", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://github.com/kovidgoyal/kitty/compare/v0.26.1...v0.26.2", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/47RK7MBSVY5BWDUTYMJUFPBAYFSWMTOI/", "source": "cve@mitre.org", "tags": ["Mailing List", "Third Party Advisory"]}, {"url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/6RRNAPU33PHEH64P77YL3AJO6CTZGHTX/", "source": "cve@mitre.org", "tags": ["Mailing List", "Third Party Advisory"]}, {"url": "https://security.gentoo.org/glsa/202209-22", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "https://sw.kovidgoyal.net/kitty/changelog/#detailed-list-of-changes", "source": "cve@mitre.org", "tags": ["Release Notes", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/kovidgoyal/kitty/commit/f05783e64d5fa62e1aed603e8d69aced5e49824f"}}