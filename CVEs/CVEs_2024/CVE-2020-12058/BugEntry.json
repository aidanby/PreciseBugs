{"buggy_code": ["<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  $OSCOM_Hooks->call('advert_manager', 'advertPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'import':\n      $import_query = tep_db_query(\"select * from banners order by banners_id\");\n      while ($import = tep_db_fetch_array($import_query)) {\n        $sql_data_array = ['advert_title'       => $import['banners_title'],\n                           'advert_url'         => $import['banners_url'],\n                           'advert_image'       => $import['banners_image'],\n                           'advert_group'       => $import['banners_group'],\n                           'advert_html_text'   => $import['banners_html_text'],\n                           'date_added'         => $import['date_added'],\n                           'date_status_change' => $import['date_status_change'],\n                           'status'             => $import['status']];\n\n        tep_db_perform('advert', $sql_data_array);\n      }\n\n      $OSCOM_Hooks->call('advert_manager', 'advertActionImport');\n\n      $messageStack->add_session(SUCCESS_BANNERS_IMPORTED, 'success');\n\n      tep_redirect(tep_href_link('advert_manager.php'));\n      break;\n\n      case 'setflag':\n        if ( ($_GET['flag'] == '0') || ($_GET['flag'] == '1') ) {\n          tep_db_query(\"update advert set status = '\" . (int)$_GET['flag'] . \"', date_status_change = now() where advert_id = '\" . (int)$_GET['cID'] . \"'\");\n\n          $messageStack->add_session(SUCCESS_ADVERT_STATUS_UPDATED, 'success');\n        }\n\n        $OSCOM_Hooks->call('advert_manager', 'advertActionSetflag');\n\n        tep_redirect(tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$_GET['cID']));\n        break;\n      case 'insert':\n      case 'update':\n        if (isset($_POST['advert_id'])) $advert_id = tep_db_prepare_input($_POST['advert_id']);\n        $advert_title = tep_db_prepare_input($_POST['advert_title']);\n        $advert_url = tep_db_prepare_input($_POST['advert_url']);\n        $advert_fragment = tep_db_prepare_input($_POST['advert_fragment']);\n\n        $new_advert_group = tep_db_prepare_input($_POST['new_advert_group']);\n        $advert_group = (empty($new_advert_group)) ? tep_db_prepare_input($_POST['advert_group']) : $new_advert_group;\n        $sort_order = tep_db_prepare_input($_POST['sort_order']);\n\n        $advert_html_text = tep_db_prepare_input($_POST['advert_html_text']);\n        $advert_image_local = tep_db_prepare_input($_POST['advert_image_local']);\n        $advert_image_target = tep_db_prepare_input($_POST['advert_image_target']);\n        $db_image_location = '';\n\n        $advert_error = false;\n        if (empty($advert_title)) {\n          $messageStack->add(ERROR_ADVERT_TITLE_REQUIRED, 'error');\n          $advert_error = true;\n        }\n\n        if (empty($advert_group)) {\n          $messageStack->add(ERROR_ADVERT_GROUP_REQUIRED, 'error');\n          $advert_error = true;\n        }\n\n        $advert_image = new upload('advert_image');\n        $advert_image->parse();\n        \n        if (!empty($advert_image->filename)) {\n          $advert_image->set_destination(DIR_FS_CATALOG_IMAGES . $advert_image_target);\n          if ( $advert_image->save() == false ) {\n            $advert_error = true;\n          }\n        }\n        else {\n          if ( empty($advert_image_local) && empty($advert_html_text) ) {\n            $messageStack->add(ERROR_ADVERT_IMAGE_OR_TEXT_REQUIRED, 'error');\n            $advert_error = true;\n          }\n        }\n\n        if ($advert_error == false) {\n          $db_image_location = (tep_not_null($advert_image_local)) ? $advert_image_local : $advert_image_target . $advert_image->filename;\n          $sql_data_array = ['advert_title'     => $advert_title,\n                             'advert_url'       => $advert_url,\n                             'advert_fragment'  => $advert_fragment,\n                             'advert_image'     => $db_image_location,\n                             'advert_group'     => $advert_group,\n                             'sort_order'       => $sort_order,\n                             'advert_html_text' => $advert_html_text];\n\n          if ($action == 'insert') {\n            $insert_sql_data = ['date_added' => 'now()', 'status' => '1'];\n\n            $sql_data_array = array_merge($sql_data_array, $insert_sql_data);\n\n            tep_db_perform('advert', $sql_data_array);\n\n            $advert_id = tep_db_insert_id();\n\n            $messageStack->add_session(SUCCESS_IMAGE_INSERTED, 'success');\n          } elseif ($action == 'update') {\n            tep_db_perform('advert', $sql_data_array, 'update', \"advert_id = '\" . (int)$advert_id . \"'\");\n\n            $messageStack->add_session(SUCCESS_IMAGE_UPDATED, 'success');\n          }\n\n          $OSCOM_Hooks->call('advert_manager', 'advertActionSave');\n\n          tep_redirect(tep_href_link('advert_manager.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'cID=' . $advert_id));\n        } else {\n          $action = 'new';\n        }\n        break;\n      case 'deleteconfirm':\n        $advert_id = tep_db_prepare_input($_GET['cID']);\n\n        if (isset($_POST['delete_image']) && ($_POST['delete_image'] == 'on')) {\n          $advert_query = tep_db_query(\"select advert_image from advert where advert_id = '\" . (int)$advert_id . \"'\");\n          $advert = tep_db_fetch_array($advert_query);\n\n          if (is_file(DIR_FS_CATALOG_IMAGES . $advert['advert_image'])) {\n            if (tep_is_writable(DIR_FS_CATALOG_IMAGES . $advert['advert_image'])) {\n              unlink(DIR_FS_CATALOG_IMAGES . $advert['advert_image']);\n            } else {\n              $messageStack->add_session(ERROR_IMAGE_IS_NOT_WRITEABLE, 'error');\n            }\n          } else {\n            $messageStack->add_session(ERROR_IMAGE_DOES_NOT_EXIST, 'error');\n          }\n        }\n\n        tep_db_query(\"delete from advert where advert_id = '\" . (int)$advert_id . \"'\");\n\n        $OSCOM_Hooks->call('advert_manager', 'advertActionDelete');\n\n        $messageStack->add_session(SUCCESS_IMAGE_REMOVED, 'success');\n\n        tep_redirect(tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n\n  $OSCOM_Hooks->call('advert_manager', 'advertPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (isset($_GET['action']) && ($_GET['action'] == 'new')) {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('advert_manager.php'), null, null, 'btn-light');\n      } else {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_ADVERT, 'fas fa-map-marker-alt', tep_href_link('advert_manager.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      ?>\n    </div>\n  </div>\n\n<?php\n  if ($action == 'new') {\n    $form_action = 'insert';\n\n    $parameters = ['advert_title' => '', 'advert_url' => '', 'advert_fragment' => '', 'advert_group' => '', 'advert_image' => '', 'sort_order' => '', 'advert_html_text' => ''];\n\n    $cInfo = new objectInfo($parameters);\n\n    if (isset($_GET['cID'])) {\n      $form_action = 'update';\n\n      $cID = tep_db_prepare_input($_GET['cID']);\n\n      $advert_query = tep_db_query(\"select * from advert where advert_id = '\" . (int)$cID . \"'\");\n      $advert = tep_db_fetch_array($advert_query);\n\n      $cInfo->objectInfo($advert);\n    } elseif (tep_not_null($_POST)) {\n      $cInfo->objectInfo($_POST);\n    }\n\n    $groups_array = [];\n    $groups_query = tep_db_query(\"select distinct advert_group from advert order by advert_group\");\n    while ($groups = tep_db_fetch_array($groups_query)) {\n      $groups_array[] = ['id' => $groups['advert_group'], 'text' => $groups['advert_group']];\n    }\n\n    echo tep_draw_form('new_advert', 'advert_manager.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'action=' . $form_action, 'post', 'enctype=\"multipart/form-data\"'); if ($form_action == 'update') echo tep_draw_hidden_field('advert_id', $cID);\n    ?>\n\n      <div class=\"form-group row\">\n        <label for=\"cTitle\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_TITLE; ?></label>\n        <div class=\"col-sm-9\">\n          <?php echo tep_draw_input_field('advert_title', $cInfo->advert_title, 'class=\"form-control\" id=\"cTitle\" required aria-required=\"true\" aria-describedby=\"TitleHelp\"'); ?>\n          <small id=\"TitleHelp\" class=\"form-text text-muted\"><?php echo TEXT_ADVERT_TITLE_HELP; ?></small>\n        </div>\n      </div>\n\n      <div class=\"form-group row\">\n        <label for=\"cUrl\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_URL; ?></label>\n        <div class=\"col-sm-9\">\n          <div class=\"row\">\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('advert_url', $cInfo->advert_url, 'class=\"form-control\" id=\"cUrl\" aria-describedby=\"URLHelp\"'); ?>\n              <small id=\"URLHelp\" class=\"form-text text-muted\"><?php echo TEXT_ADVERT_URL_HELP; ?></small>\n            </div>\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('advert_fragment', $cInfo->advert_fragment, 'placeholder=\"' . TEXT_ADVERT_FRAGMENT . '\" class=\"form-control\" id=\"cFrag\" aria-describedby=\"FragmentHelp\"'); ?>\n              <small id=\"FragmentHelp\" class=\"form-text text-muted\"><?php echo TEXT_ADVERT_FRAGMENT_HELP; ?></small>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"form-group row\">\n        <label for=\"cSort\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_SORT_ORDER; ?></label>\n        <div class=\"col-sm-9\">\n          <?php echo tep_draw_input_field('sort_order', $cInfo->sort_order, 'class=\"form-control w-25\" id=\"cSort\" aria-describedby=\"SortHelp\"'); ?>\n          <small id=\"SortHelp\" class=\"form-text text-muted\"><?php echo TEXT_ADVERT_SORT_HELP; ?></small>\n        </div>\n      </div>\n\n      <hr>\n\n      <div class=\"form-group row\">\n        <label for=\"cGroup\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_GROUP; ?></label>\n        <div class=\"col-sm-9\">\n          <div class=\"row\">\n            <div class=\"col\">\n              <?php echo tep_draw_pull_down_menu('advert_group', $groups_array, $cInfo->advert_group, 'id=\"cGroup\" class=\"form-control\"'); ?>\n            </div>\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('new_advert_group', '', 'placeholder=\"' . TEXT_ADVERT_NEW_GROUP . '\" class=\"form-control\" id=\"cNewGroup\"'); ?>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <hr>\n\n      <div class=\"form-group row\">\n        <label for=\"cImage\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_IMAGE; ?></label>\n        <div class=\"col-sm-9\">\n          <div class=\"row\">\n            <div class=\"col\">\n              <div class=\"custom-file mb-2\">\n                <?php echo tep_draw_input_field('advert_image', '', 'id=\"advert_image\"', 'file', null, 'class=\"form-control-input\"'); ?>\n                <label class=\"custom-file-label\" for=\"advert_image\"></label>\n              </div>\n            </div>\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('advert_image_local', (isset($cInfo->advert_image) ? $cInfo->advert_image : ''), 'placeholder=\"' . TEXT_ADVERT_IMAGE_LOCAL . '\" class=\"form-control\" id=\"cNewImage\"'); ?>\n            </div>\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('advert_image_target', null, 'placeholder=\"' . TEXT_ADVERT_IMAGE_TARGET . '\" class=\"form-control\" id=\"cTarget\"'); ?>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <hr>\n\n      <div class=\"form-group row\">\n        <label for=\"cText\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_HTML_TEXT; ?></label>\n        <div class=\"col-sm-9\"><?php echo tep_draw_textarea_field('advert_html_text', 'soft', '60', '5', $cInfo->advert_html_text, 'class=\"form-control\" id=\"cText\"'); ?>\n        </div>\n      </div>\n\n      <div class=\"alert alert-info\">\n        <?php echo TEXT_ADVERT_NOTE . TEXT_INSERT_NOTE; ?>\n      </div>\n\n      <?php\n      echo $OSCOM_Hooks->call('advert_manager', 'advertForm');\n      ?>\n\n      <div class=\"buttonSet\">\n        <?php echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-images', null, null, null, 'btn-success btn-block btn-lg xxx text-white'); ?>\n      </div>\n\n    </form>\n    \n    <script>$(document).on('change', '#advert_image', function (event) { $(this).next('.custom-file-label').html(event.target.files[0].name); });</script>\n<?php\n  } else {\n?>\n\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_ADVERT; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_GROUP; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_SORT_ORDER; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $advert_query_raw = \"select * from advert order by advert_group, sort_order, advert_title\";\n            $advert_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $advert_query_raw, $advert_query_numrows);\n            $advert_query = tep_db_query($advert_query_raw);\n            while ($advert = tep_db_fetch_array($advert_query)) {\n              if ((!isset($_GET['cID']) || (isset($_GET['cID']) && ($_GET['cID'] == $advert['advert_id']))) && !isset($cInfo) && (substr($action, 0, 3) != 'new')) {\n                $cInfo = new objectInfo($advert);\n              }\n\n              if (isset($cInfo) && is_object($cInfo) && ($advert['advert_id'] == $cInfo->advert_id)) {\n                echo '<tr class=\"table-active\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$advert['advert_id']) . '\\'\">';\n              }\n?>\n                <td><?php echo $advert['advert_title']; ?></td>\n                <td class=\"text-right\"><?php echo $advert['advert_group']; ?></td>\n                <td class=\"text-right\"><?php echo $advert['sort_order'] ?? 0; ?></td>\n                <td class=\"text-right\"><?php if ($advert['status'] == '1') { echo '<i class=\"fas fa-check-circle text-success\"></i> <a href=\"' . tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$advert['advert_id'] . '&action=setflag&flag=0') . '\"><i class=\"fas fa-times-circle text-muted\"></i></a>'; } else { echo '<a href=\"' . tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . $advert['advert_id'] . '&action=setflag&flag=1') . '\"><i class=\"fas fa-check-circle text-muted\"></i></a> <i class=\"fas fa-times-circle text-danger\"></i>'; } ?></td>\n                <td class=\"text-right\"><?php if (isset($cInfo) && is_object($cInfo) && ($advert['advert_id'] == $cInfo->advert_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . $advert['advert_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $advert_split->display_count($advert_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, (int)$_GET['page'], TEXT_DISPLAY_NUMBER_OF_ADVERTS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $advert_split->display_links($advert_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, (int)$_GET['page']); ?></div>\n      </div>\n\n      <?php\n      $banner_table_query = tep_db_query(\"SHOW TABLES LIKE 'banners'\");\n      if ($advert_query_numrows == 0 && tep_db_num_rows($banner_table_query)) {\n        echo '<div class=\"alert alert-info mt-3\">';\n          echo '<div class=\"row align-items-center\">';\n            echo '<div class=\"col-4\">';\n              echo tep_draw_bootstrap_button(IMAGE_IMPORT_ADVERT, 'fas fa-database', tep_href_link('advert_manager.php', 'action=import'), null, null, 'btn-info btn-block xxx text-white');\n            echo '</div>';\n            echo '<div class=\"col\">';\n              echo IMAGE_IMPORT_ADVERT_EXPLANATION;\n            echo '</div>';\n          echo '</div>';\n        echo '</div>';\n      }\n      ?>\n\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n  switch ($action) {\n    case 'delete':\n      $heading[] = ['text' => $cInfo->advert_title];\n\n      $contents = ['form' => tep_draw_form('advert', 'advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$cInfo->advert_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $cInfo->advert_title];\n      if ($cInfo->advert_image) $contents[] = ['text' => tep_draw_checkbox_field('delete_image', 'on') . ' ' . TEXT_INFO_DELETE_IMAGE];\n      $contents[] = ['align' => 'center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$_GET['cID']), null, null, 'btn-light')];\n      break;\n    default:\n     if (isset($cInfo) && is_object($cInfo)) {\n        $heading[] = ['text' => $cInfo->advert_title];\n\n        $contents[] = ['align' => 'center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->advert_id . '&action=new'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->advert_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_ADVERT_DATE_ADDED, tep_date_short($cInfo->date_added))];\n\n        if (tep_not_null($cInfo->advert_url)) {\n          if (filter_var($cInfo->advert_url, FILTER_VALIDATE_URL)) {\n            $contents[] = ['text' => sprintf(TEXT_ADVERT_EXTERNAL_URL, $cInfo->advert_url)];\n          } else {\n            $fragment = $cInfo->advert_fragment ?? null;\n            $contents[] = ['text' => sprintf(TEXT_ADVERT_INTERNAL_URL, tep_catalog_href_link($cInfo->advert_url, $fragment))];\n          }\n        }\n        \n        if (tep_not_null($cInfo->advert_image)) $contents[] = ['text' => '<hr>' . tep_info_image($cInfo->advert_image, null)];\n        if (tep_not_null($cInfo->advert_html_text)) $contents[] = ['text' => '<hr>' . $cInfo->advert_html_text];\n\n        if ($cInfo->date_status_change) $contents[] = ['text' => sprintf(TEXT_ADVERT_STATUS_CHANGE, tep_date_short($cInfo->date_status_change))];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n     echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n\n  echo '</div>';\n}\n\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('countries', 'countriesPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        $countries_name = tep_db_prepare_input($_POST['countries_name']);\n        $countries_iso_code_2 = tep_db_prepare_input($_POST['countries_iso_code_2']);\n        $countries_iso_code_3 = tep_db_prepare_input($_POST['countries_iso_code_3']);\n        $address_format_id = tep_db_prepare_input($_POST['address_format_id']);\n\n        tep_db_query(\"insert into countries (countries_name, countries_iso_code_2, countries_iso_code_3, address_format_id) values ('\" . tep_db_input($countries_name) . \"', '\" . tep_db_input($countries_iso_code_2) . \"', '\" . tep_db_input($countries_iso_code_3) . \"', '\" . (int)$address_format_id . \"')\");\n        \n        $OSCOM_Hooks->call('countries', 'countriesActionInsert');\n\n        tep_redirect(tep_href_link('countries.php'));\n        break;\n      case 'save':\n        $countries_id = tep_db_prepare_input($_GET['cID']);\n        $countries_name = tep_db_prepare_input($_POST['countries_name']);\n        $countries_iso_code_2 = tep_db_prepare_input($_POST['countries_iso_code_2']);\n        $countries_iso_code_3 = tep_db_prepare_input($_POST['countries_iso_code_3']);\n        $address_format_id = tep_db_prepare_input($_POST['address_format_id']);\n\n        tep_db_query(\"update countries set countries_name = '\" . tep_db_input($countries_name) . \"', countries_iso_code_2 = '\" . tep_db_input($countries_iso_code_2) . \"', countries_iso_code_3 = '\" . tep_db_input($countries_iso_code_3) . \"', address_format_id = '\" . (int)$address_format_id . \"' where countries_id = '\" . (int)$countries_id . \"'\");\n        \n        $OSCOM_Hooks->call('countries', 'countriesActionSave');\n\n        tep_redirect(tep_href_link('countries.php', 'page=' . $_GET['page'] . '&cID=' . $countries_id));\n        break;\n      case 'deleteconfirm':\n        $countries_id = tep_db_prepare_input($_GET['cID']);\n\n        tep_db_query(\"delete from countries where countries_id = '\" . (int)$countries_id . \"'\");\n        \n        $OSCOM_Hooks->call('countries', 'countriesActionDelete');\n\n        tep_redirect(tep_href_link('countries.php', 'page=' . $_GET['page']));\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('countries', 'countriesPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_COUNTRY, 'fas fa-map-marker-alt', tep_href_link('countries.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('countries.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_COUNTRY_NAME; ?></th>\n              <th colspan=\"2\"><?php echo TABLE_HEADING_COUNTRY_CODES; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $countries_query_raw = \"select countries_id, countries_name, countries_iso_code_2, countries_iso_code_3, address_format_id from countries order by countries_name\";\n            $countries_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $countries_query_raw, $countries_query_numrows);\n            $countries_query = tep_db_query($countries_query_raw);\n            while ($countries = tep_db_fetch_array($countries_query)) {\n              if ((!isset($_GET['cID']) || (isset($_GET['cID']) && ($_GET['cID'] == $countries['countries_id']))) && !isset($cInfo) && (substr($action, 0, 3) != 'new')) {\n                $cInfo = new objectInfo($countries);\n              }\n\n              if (isset($cInfo) && is_object($cInfo) && ($countries['countries_id'] == $cInfo->countries_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('countries.php', 'page=' . $_GET['page'] . '&cID=' . (int)$cInfo->countries_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('countries.php', 'page=' . $_GET['page'] . '&cID=' . (int)$countries['countries_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $countries['countries_name']; ?></td>\n                <td><?php echo $countries['countries_iso_code_2']; ?></td>\n                <td><?php echo $countries['countries_iso_code_3']; ?></td>\n                <td class=\"text-right\"><?php if (isset($cInfo) && is_object($cInfo) && ($countries['countries_id'] == $cInfo->countries_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('countries.php', 'page=' . $_GET['page'] . '&cID=' . $countries['countries_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $countries_split->display_count($countries_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_COUNTRIES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $countries_split->display_links($countries_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_COUNTRY];\n\n      $contents = ['form' => tep_draw_form('countries', 'countries.php', 'page=' . $_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . '<br>' . tep_draw_input_field('countries_name')];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_CODE_2 . '<br>' . tep_draw_input_field('countries_iso_code_2')];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_CODE_3 . '<br>' . tep_draw_input_field('countries_iso_code_3')];\n      $contents[] = ['text' => TEXT_INFO_ADDRESS_FORMAT . '<br>' . tep_draw_pull_down_menu('address_format_id', tep_get_address_formats())];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('countries.php', 'page=' . $_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_COUNTRY];\n\n      $contents = ['form' => tep_draw_form('countries', 'countries.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->countries_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . '<br>' . tep_draw_input_field('countries_name', $cInfo->countries_name)];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_CODE_2 . '<br>' . tep_draw_input_field('countries_iso_code_2', $cInfo->countries_iso_code_2)];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_CODE_3 . '<br>' . tep_draw_input_field('countries_iso_code_3', $cInfo->countries_iso_code_3)];\n      $contents[] = ['text' => TEXT_INFO_ADDRESS_FORMAT . '<br>' . tep_draw_pull_down_menu('address_format_id', tep_get_address_formats(), $cInfo->address_format_id)];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('countries.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->countries_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_COUNTRY];\n\n      $contents = ['form' => tep_draw_form('countries', 'countries.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->countries_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $cInfo->countries_name];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('countries.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->countries_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($cInfo)) {\n        $heading[] = ['text' => $cInfo->countries_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('countries.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->countries_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('countries.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->countries_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_COUNTRY_NAME, $cInfo->countries_name)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_COUNTRY_CODE_2, $cInfo->countries_iso_code_2)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_COUNTRY_CODE_3, $cInfo->countries_iso_code_3)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_ADDRESS_FORMAT, $cInfo->address_format_id)];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  require('includes/classes/currencies.php');\n  $currencies = new currencies();\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('currencies', 'preAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n      case 'save':\n        if (isset($_GET['cID'])) $currency_id = tep_db_prepare_input($_GET['cID']);\n        $title = tep_db_prepare_input($_POST['title']);\n        $code = tep_db_prepare_input($_POST['code']);\n        $symbol_left = tep_db_prepare_input($_POST['symbol_left']);\n        $symbol_right = tep_db_prepare_input($_POST['symbol_right']);\n        $decimal_point = tep_db_prepare_input($_POST['decimal_point']);\n        $thousands_point = tep_db_prepare_input($_POST['thousands_point']);\n        $decimal_places = tep_db_prepare_input($_POST['decimal_places']);\n        $value = tep_db_prepare_input($_POST['value']);\n\n        $sql_data_array = ['title' => $title,\n                           'code' => $code,\n                           'symbol_left' => $symbol_left,\n                           'symbol_right' => $symbol_right,\n                           'decimal_point' => $decimal_point,\n                           'thousands_point' => $thousands_point,\n                           'decimal_places' => $decimal_places,\n                           'value' => $value];\n\n        if ($action == 'insert') {\n          tep_db_perform('currencies', $sql_data_array);\n          $currency_id = tep_db_insert_id();\n          \n          $OSCOM_Hooks->call('currencies', 'insert');\n          \n        } elseif ($action == 'save') {\n          tep_db_perform('currencies', $sql_data_array, 'update', \"currencies_id = '\" . (int)$currency_id . \"'\");\n          \n          $OSCOM_Hooks->call('currencies', 'save');\n        }\n\n        if (isset($_POST['default']) && ($_POST['default'] == 'on')) {\n          tep_db_query(\"update configuration set configuration_value = '\" . tep_db_input($code) . \"' where configuration_key = 'DEFAULT_CURRENCY'\");\n        }\n        \n        $OSCOM_Hooks->call('currencies', 'saveinsert');        \n\n        tep_redirect(tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $currency_id));\n        break;\n      case 'deleteconfirm':\n        $currencies_id = tep_db_prepare_input($_GET['cID']);\n\n        $currency_query = tep_db_query(\"select currencies_id from currencies where code = '\" . DEFAULT_CURRENCY . \"'\");\n        $currency = tep_db_fetch_array($currency_query);\n\n        if ($currency['currencies_id'] == $currencies_id) {\n          tep_db_query(\"update configuration set configuration_value = '' where configuration_key = 'DEFAULT_CURRENCY'\");\n        }\n\n        tep_db_query(\"delete from currencies where currencies_id = '\" . (int)$currencies_id . \"'\");\n        \n        $OSCOM_Hooks->call('currencies', 'deleteconfirm');\n\n        tep_redirect(tep_href_link('currencies.php', 'page=' . $_GET['page']));\n        break;\n      case 'update':\n        include_once('includes/languages/' . $language . '/modules/currencies/' . MODULE_ADMIN_CURRENCIES_INSTALLED);\n        include_once('includes/modules/currencies/' . MODULE_ADMIN_CURRENCIES_INSTALLED);\n        \n        $converter = basename(MODULE_ADMIN_CURRENCIES_INSTALLED, '.php');\n \n        call_user_func([$converter, 'execute']);\n        \n        $OSCOM_Hooks->call('currencies', 'update');\n\n        tep_redirect(tep_href_link('currencies.php'));\n        break;\n      case 'delete':\n        $currencies_id = tep_db_prepare_input($_GET['cID']);\n\n        $currency_query = tep_db_query(\"select code from currencies where currencies_id = '\" . (int)$currencies_id . \"'\");\n        $currency = tep_db_fetch_array($currency_query);\n\n        $remove_currency = true;\n        if ($currency['code'] == DEFAULT_CURRENCY) {\n          $remove_currency = false;\n          $messageStack->add(ERROR_REMOVE_DEFAULT_CURRENCY, 'error');\n        }\n        \n        $OSCOM_Hooks->call('currencies', 'delete');\n        break;\n    }\n  }\n\n  $currency_select = ['USD' => ['title' => 'U.S. Dollar', 'code' => 'USD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'EUR' =>['title' => 'Euro', 'code' => 'EUR', 'symbol_left' => '', 'symbol_right' => '\u20ac', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'JPY' => ['title' => 'Japanese Yen', 'code' => 'JPY', 'symbol_left' => '\u00a5', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'GBP' => ['title' => 'Pounds Sterling', 'code' => 'GBP', 'symbol_left' => '\u00a3', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'CHF' => ['title' => 'Swiss Franc', 'code' => 'CHF', 'symbol_left' => '', 'symbol_right' => 'CHF', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'AUD' => ['title' => 'Australian Dollar', 'code' => 'AUD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'CAD' => ['title' => 'Canadian Dollar', 'code' => 'CAD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'SEK' => ['title' => 'Swedish Krona', 'code' => 'SEK', 'symbol_left' => '', 'symbol_right' => 'kr', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'HKD' => ['title' => 'Hong Kong Dollar', 'code' => 'HKD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'NOK' => ['title' => 'Norwegian Krone', 'code' => 'NOK', 'symbol_left' => 'kr', 'symbol_right' => '', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'NZD' => ['title' => 'New Zealand Dollar', 'code' => 'NZD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'MXN' => ['title' => 'Mexican Peso', 'code' => 'MXN', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'SGD' => ['title' => 'Singapore Dollar', 'code' => 'SGD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'BRL' => ['title' => 'Brazilian Real', 'code' => 'BRL', 'symbol_left' => 'R$', 'symbol_right' => '', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'CNY' => ['title' => 'Chinese RMB', 'code' => 'CNY', 'symbol_left' => '\uffe5', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'CZK' => ['title' => 'Czech Koruna', 'code' => 'CZK', 'symbol_left' => '', 'symbol_right' => 'K\u010d', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'DKK' => ['title' => 'Danish Krone', 'code' => 'DKK', 'symbol_left' => '', 'symbol_right' => 'kr', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'HUF' => ['title' => 'Hungarian Forint', 'code' => 'HUF', 'symbol_left' => '', 'symbol_right' => 'Ft', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'ILS' => ['title' => 'Israeli New Shekel', 'code' => 'ILS', 'symbol_left' => '\u20aa', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'INR' => ['title' => 'Indian Rupee', 'code' => 'INR', 'symbol_left' => 'Rs.', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'MYR' => ['title' => 'Malaysian Ringgit', 'code' => 'MYR', 'symbol_left' => 'RM', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'PHP' => ['title' => 'Philippine Peso', 'code' => 'PHP', 'symbol_left' => 'Php', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'PLN' => ['title' => 'Polish Zloty', 'code' => 'PLN', 'symbol_left' => '', 'symbol_right' => 'z\u0142', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'THB' => ['title' => 'Thai Baht', 'code' => 'THB', 'symbol_left' => '', 'symbol_right' => '\u0e3f', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'TWD' => ['title' => 'Taiwan New Dollar', 'code' => 'TWD', 'symbol_left' => 'NT$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2']];\n\n  $currency_select_array = [['id' => '', 'text' => TEXT_INFO_COMMON_CURRENCIES]];\n  foreach ($currency_select as $cs) {\n    if (!isset($currencies->currencies[$cs['code']])) {\n      $currency_select_array[] = ['id' => $cs['code'], 'text' => '[' . $cs['code'] . '] ' . $cs['title']];\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n<script>\nvar currency_select = new Array();\n<?php\n  foreach ($currency_select_array as $cs) {\n    if (!empty($cs['id'])) {\n      echo 'currency_select[\"' . $cs['id'] . '\"] = new Array(\"' . $currency_select[$cs['id']]['title'] . '\", \"' . $currency_select[$cs['id']]['symbol_left'] . '\", \"' . $currency_select[$cs['id']]['symbol_right'] . '\", \"' . $currency_select[$cs['id']]['decimal_point'] . '\", \"' . $currency_select[$cs['id']]['thousands_point'] . '\", \"' . $currency_select[$cs['id']]['decimal_places'] . '\");' . \"\\n\";\n    }\n  }\n?>\n\nfunction updateForm() {\n  var cs = document.forms[\"currencies\"].cs[document.forms[\"currencies\"].cs.selectedIndex].value;\n\n  document.forms[\"currencies\"].title.value = currency_select[cs][0];\n  document.forms[\"currencies\"].code.value = cs;\n  document.forms[\"currencies\"].symbol_left.value = currency_select[cs][1];\n  document.forms[\"currencies\"].symbol_right.value = currency_select[cs][2];\n  document.forms[\"currencies\"].decimal_point.value = currency_select[cs][3];\n  document.forms[\"currencies\"].thousands_point.value = currency_select[cs][4];\n  document.forms[\"currencies\"].decimal_places.value = currency_select[cs][5];\n  document.forms[\"currencies\"].value.value = 1;\n}\n</script>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col-sm-4 text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_CURRENCY, 'fas fa-cogs', tep_href_link('currencies.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      } else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('currencies.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_CURRENCY_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_CURRENCY_CODES; ?></th>\n              <th><?php echo TABLE_HEADING_CURRENCY_VALUE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $currency_query_raw = \"SELECT * FROM currencies ORDER BY title\";\n            $currency_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $currency_query_raw, $currency_query_numrows);\n            $currency_query = tep_db_query($currency_query_raw);\n            while ($currency = tep_db_fetch_array($currency_query)) {\n              if ((!isset($_GET['cID']) || (isset($_GET['cID']) && ($_GET['cID'] == $currency['currencies_id']))) && !isset($cInfo) && (substr($action, 0, 3) != 'new')) {\n                $cInfo = new objectInfo($currency);\n              }\n\n              if (isset($cInfo) && is_object($cInfo) && ($currency['currencies_id'] == $cInfo->currencies_id) ) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $currency['currencies_id']) . '\\'\">';\n              }\n\n              if (DEFAULT_CURRENCY == $currency['code']) {\n                echo '<th>' . $currency['title'] . ' (' . TEXT_DEFAULT . ')</th>';\n              } else {\n                echo '<td>' . $currency['title'] . '</td>';\n              }\n              ?>\n                <td><?php echo $currency['code']; ?></td>\n                <td><?php echo number_format($currency['value'], 8); ?></td>\n                <td class=\"text-right\"><?php if (isset($cInfo) && is_object($cInfo) && ($currency['currencies_id'] == $cInfo->currencies_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $currency['currencies_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $currency_split->display_count($currency_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_CURRENCIES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $currency_split->display_links($currency_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n      <?php\n      if ( defined('MODULE_ADMIN_CURRENCIES_INSTALLED') && tep_not_null(MODULE_ADMIN_CURRENCIES_INSTALLED) ) {\n        echo '<p class=\"mr-2\">';\n          echo tep_draw_bootstrap_button(IMAGE_UPDATE_CURRENCIES, 'fas fa-money-bill-alt', tep_href_link('currencies.php', 'action=update'), null, null, 'btn-success btn-block xxx text-white');\n        echo '</p>';\n      }\n      else {\n        echo '<div class=\"alert alert-warning mr-2\">';\n          echo ERROR_INSTALL_CURRENCY_CONVERTER;\n        echo '</div>';\n      }\n      ?>\n\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_CURRENCY];\n\n      $contents = ['form' => tep_draw_form('currencies', 'currencies.php', 'page=' . $_GET['page'] . (isset($cInfo) ? '&cID=' . $cInfo->currencies_id : '') . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => tep_draw_pull_down_menu('cs', $currency_select_array, '', 'onchange=\"updateForm();\"')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_TITLE . '<br>' . tep_draw_input_field('title')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_CODE . '<br>' . tep_draw_input_field('code')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_SYMBOL_LEFT . '<br>' . tep_draw_input_field('symbol_left')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_SYMBOL_RIGHT . '<br>' . tep_draw_input_field('symbol_right')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_DECIMAL_POINT . '<br>' . tep_draw_input_field('decimal_point')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_THOUSANDS_POINT . '<br>' . tep_draw_input_field('thousands_point')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_DECIMAL_PLACES . '<br>' . tep_draw_input_field('decimal_places')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_VALUE . '<br>' . tep_draw_input_field('value')];\n      $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_INFO_SET_AS_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('currencies.php'), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_CURRENCY];\n\n      $contents = ['form' => tep_draw_form('currencies', 'currencies.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_TITLE . '<br>' . tep_draw_input_field('title', $cInfo->title)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_CODE . '<br>' . tep_draw_input_field('code', $cInfo->code)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_SYMBOL_LEFT . '<br>' . tep_draw_input_field('symbol_left', $cInfo->symbol_left)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_SYMBOL_RIGHT . '<br>' . tep_draw_input_field('symbol_right', $cInfo->symbol_right)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_DECIMAL_POINT . '<br>' . tep_draw_input_field('decimal_point', $cInfo->decimal_point)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_THOUSANDS_POINT . '<br>' . tep_draw_input_field('thousands_point', $cInfo->thousands_point)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_DECIMAL_PLACES . '<br>' . tep_draw_input_field('decimal_places', $cInfo->decimal_places)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_VALUE . '<br>' . tep_draw_input_field('value', $cInfo->value)];\n      if (DEFAULT_CURRENCY != $cInfo->code) $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_INFO_SET_AS_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->currencies_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_CURRENCY];\n\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $cInfo->title];\n      $contents[] = ['class' => 'text-center', 'text' => (($remove_currency) ? tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=deleteconfirm'), null, null, 'btn-danger xxx text-white mr-2') : '') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->currencies_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($cInfo)) {\n        $heading[] = ['text' => $cInfo->title];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('currencies.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_TITLE, $cInfo->title)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_CODE, $cInfo->code)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_SYMBOL_LEFT, $cInfo->symbol_left)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_SYMBOL_RIGHT, $cInfo->symbol_right)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_DECIMAL_POINT, $cInfo->decimal_point)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_THOUSANDS_POINT, $cInfo->thousands_point)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_DECIMAL_PLACES, $cInfo->decimal_places)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_LAST_UPDATED, tep_date_short($cInfo->last_updated))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_VALUE, number_format($cInfo->value, 8))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_EXAMPLE, $currencies->format('30', false, DEFAULT_CURRENCY), $currencies->format('30', true, $cInfo->code))];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n  \n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require 'includes/application_top.php';\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        tep_db_query(\"INSERT INTO customer_data_groups_sequence VALUES (NULL)\");\n        $customer_data_groups_id = tep_db_insert_id();\n      case 'save':\n        if (!isset($customer_data_groups_id)) {\n          $customer_data_groups_id = tep_db_prepare_input($_GET['cdgID']);\n        }\n\n        $first_language_id = key($_POST['customer_data_groups_name']);\n        foreach ($_POST['customer_data_groups_name'] as $language_id => $customer_data_groups_name) {\n          // if use_first was checked, get all the values other than the name from the first group\n          $index = (1 == $_POST['use_first']) ? $first_language_id : $language_id;\n\n          $sql_data_array = [\n            'customer_data_groups_name' => tep_db_prepare_input($customer_data_groups_name),\n            'cdg_vertical_sort_order' => tep_db_prepare_input($_POST['cdg_vertical_sort_order'][$index]),\n            'cdg_horizontal_sort_order' => tep_db_prepare_input($_POST['cdg_horizontal_sort_order'][$index]),\n            'customer_data_groups_width' => tep_db_prepare_input($_POST['customer_data_groups_width'][$index]),\n          ];\n\n          if ('insert' == $action) {\n            $sql_data_array['customer_data_groups_id'] = $customer_data_groups_id;\n            $sql_data_array['language_id'] = $language_id;\n\n            tep_db_perform('customer_data_groups', $sql_data_array);\n          } elseif ('save' == $action) {\n            tep_db_perform('customer_data_groups', $sql_data_array, 'update', \"customer_data_groups_id = \" . (int)$customer_data_groups_id . \" AND language_id = \" . (int)$language_id);\n          }\n        }\n\n        if ('insert' == $action) {\n          tep_redirect(tep_href_link('customer_data_groups.php'));\n        } elseif ('save' == $action) {\n          tep_redirect(tep_href_link('customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $customer_data_groups_id));\n        }\n        break;\n      case 'deleteconfirm':\n        $customer_data_groups_id = tep_db_prepare_input($_GET['cdgID']);\n\n        tep_db_query(\"DELETE FROM customer_data_groups WHERE customer_data_groups_id = \" . (int)$customer_data_groups_id);\n        tep_db_query(\"DELETE FROM customer_data_groups_sequence WHERE customer_data_groups_id = \" . (int)$customer_data_groups_id);\n\n        tep_redirect(tep_href_link('customer_data_groups.php', 'page=' . $_GET['page']));\n        break;\n    }\n  }\n\n  require 'includes/template_top.php';\n?>\n\n  <div class=\"row\">\n    <div class=\"col-8\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_CUSTOMER_DATA_GROUP, 'fas fa-id-card', tep_href_link('customer_data_groups.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('customer_data_groups.php'), null, null, 'btn-light');\n      }       \n      ?>\n    </div>\n  </div>\n\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover table-filter\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_CUSTOMER_DATA_GROUP_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_SORT_ORDER_V; ?></th>\n              <th><?php echo TABLE_HEADING_SORT_ORDER_H; ?></th>\n              <th><?php echo TABLE_HEADING_WIDTH; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $customer_data_groups_query_raw = <<<'EOSQL'\nselect customer_data_groups_id, customer_data_groups_name, cdg_vertical_sort_order, cdg_horizontal_sort_order, customer_data_groups_width\n from customer_data_groups\n where language_id =\nEOSQL\n. (int)$languages_id . \" order by cdg_vertical_sort_order, cdg_horizontal_sort_order\";\n            $customer_data_groups_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $customer_data_groups_query_raw, $customer_data_groups_query_numrows);\n            $customer_data_groups_query = tep_db_query($customer_data_groups_query_raw);\n            while ($customer_data_groups = tep_db_fetch_array($customer_data_groups_query)) {\n              if ((!isset($_GET['cdgID']) || (isset($_GET['cdgID']) && ($_GET['cdgID'] == $customer_data_groups['customer_data_groups_id']))) && !isset($cdgInfo) && (substr($action, 0, 3) != 'new')) {\n                $cdgInfo = new objectInfo($customer_data_groups);\n              }\n\n              if (isset($cdgInfo) && is_object($cdgInfo) && ($customer_data_groups['customer_data_groups_id'] == $cdgInfo->customer_data_groups_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $customer_data_groups['customer_data_groups_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $customer_data_groups['customer_data_groups_name']; ?></td>\n                <td><?php echo $customer_data_groups['cdg_vertical_sort_order']; ?></td>\n                <td><?php echo $customer_data_groups['cdg_horizontal_sort_order']; ?></td>\n                <td><?php echo $customer_data_groups['customer_data_groups_width']; ?></td>\n                <td class=\"text-right\"><?php if (isset($cdgInfo) && is_object($cdgInfo) && ($customer_data_groups['customer_data_groups_id'] == $cdgInfo->customer_data_groups_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $customer_data_groups['customer_data_groups_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n              }\n            ?>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $customer_data_groups_split->display_count($customer_data_groups_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_CUSTOMER_DATA_GROUPS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $customer_data_groups_split->display_links($customer_data_groups_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_CUSTOMER_DATA_GROUP];\n\n      $contents = ['form' => tep_draw_form('customer_data_groups', 'customer_data_groups.php', 'page=' . $_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => tep_draw_checkbox_field('use_first', '1', true) . TEXT_INFO_USE_FIRST_FOR_ALL];\n\n      foreach (tep_get_languages() as $lang) {\n        $contents[] = ['text' => TEXT_INFO_CUSTOMER_DATA_GROUP_NAME . '<br>' . tep_image(tep_catalog_href_link('includes/languages/' . $lang['directory'] . '/images/' . $lang['image'], '', 'SSL'), $lang['name']) . '&nbsp;' . tep_draw_input_field('customer_data_groups_name[' . $lang['id'] . ']')];\n        $contents[] = ['text' => TEXT_INFO_VERTICAL_SORT_ORDER . '<br>' . tep_draw_input_field('cdg_vertical_sort_order[' . $lang['id'] . ']')];\n        $contents[] = ['text' => TEXT_INFO_HORIZONTAL_SORT_ORDER . '<br>' . tep_draw_input_field('cdg_horizontal_sort_order[' . $lang['id'] . ']')];\n        $contents[] = ['text' => TEXT_INFO_WIDTH . '<br>' . tep_draw_input_field('customer_data_groups_width[' . $lang['id'] . ']', 12)];\n      }\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('customer_data_groups.php', 'page=' . $_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_CUSTOMER_DATA_GROUP];\n\n      $contents = ['form' => tep_draw_form('customer_data_groups', 'customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_USE_FIRST_FOR_ALL . '<br>' . tep_draw_checkbox_field('use_first', '1', true)];\n\n      $cdg_query = tep_db_query(<<<'EOSQL'\nSELECT\n  cdg.customer_data_groups_name,\n  cdg.cdg_vertical_sort_order,\n  cdg.cdg_horizontal_sort_order,\n  cdg.customer_data_groups_width,\n  l.directory,\n  l.image,\n  l.name,\n  l.languages_id AS id\n FROM customer_data_groups cdg INNER JOIN languages l ON cdg.language_id = l.languages_id\n WHERE customer_data_groups_id =\nEOSQL\n        . (int)$cdgInfo->customer_data_groups_id);\n      while ($cdg = tep_db_fetch_array($cdg_query)) {\n        $contents[] = ['text' => TEXT_INFO_CUSTOMER_DATA_GROUP_NAME . '<br>' . tep_image(tep_catalog_href_link('includes/languages/' . $cdg['directory'] . '/images/' . $cdg['image'], '', 'SSL'), $cdg['name']) . '&nbsp;' . tep_draw_input_field('customer_data_groups_name[' . $cdg['id'] . ']', $cdg['customer_data_groups_name'])];\n        $contents[] = ['text' => sprintf(TEXT_INFO_VERTICAL_SORT_ORDER, null) . '<br>' . tep_draw_input_field('cdg_vertical_sort_order[' . $cdg['id'] . ']', $cdg['cdg_vertical_sort_order'])];\n        $contents[] = ['text' => sprintf(TEXT_INFO_HORIZONTAL_SORT_ORDER, null) . '<br>' . tep_draw_input_field('cdg_horizontal_sort_order[' . $cdg['id'] . ']', $cdg['cdg_horizontal_sort_order'])];\n        $contents[] = ['text' => sprintf(TEXT_INFO_WIDTH, null) . '<br>' . tep_draw_input_field('customer_data_groups_width[' . $cdg['id'] . ']', $cdg['customer_data_groups_width'])];\n      }\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_CUSTOMER_DATA_GROUP];\n\n      $contents = ['form' => tep_draw_form('customer_data_groups', 'customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n\n      $cdg_query = tep_db_query(<<<'EOSQL'\nSELECT\n  cdg.customer_data_groups_name,\n  l.directory,\n  l.image,\n  l.name\n FROM customer_data_groups cdg INNER JOIN languages l ON cdg.language_id = l.languages_id\n WHERE customer_data_groups_id =\nEOSQL\n        . (int)$cdgInfo->customer_data_groups_id);\n      while ($cdg = tep_db_fetch_array($cdg_query)) {\n        $contents[] = ['text' => tep_image(tep_catalog_href_link('includes/languages/' . $cdg['directory'] . '/images/' . $cdg['image'], '', 'SSL'), $cdg['name']) . '&nbsp;<strong>' . $cdg['customer_data_groups_name'] . '</strong>'];\n      }\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($cdgInfo ?? null)) {\n        $heading[] = ['text' => $cdgInfo->customer_data_groups_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('customer_data_groups.php', 'page=' . $_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n\n        $cdg_query = tep_db_query(<<<'EOSQL'\nSELECT\n  cdg.customer_data_groups_name,\n  cdg.cdg_vertical_sort_order,\n  cdg.cdg_horizontal_sort_order,\n  cdg.customer_data_groups_width,\n  l.directory,\n  l.image,\n  l.name\n FROM customer_data_groups cdg INNER JOIN languages l ON cdg.language_id = l.languages_id\n WHERE customer_data_groups_id =\nEOSQL\n          . (int)$cdgInfo->customer_data_groups_id);\n        while ($cdg = tep_db_fetch_array($cdg_query)) {\n          $contents[] = ['text' => TEXT_INFO_CUSTOMER_DATA_GROUP_NAME . '<br>' . tep_image(tep_catalog_href_link('includes/languages/' . $cdg['directory'] . '/images/' . $cdg['image'], '', 'SSL'), $cdg['name']) . '&nbsp;' . $cdg['customer_data_groups_name']];\n          $contents[] = ['text' => sprintf(TEXT_INFO_VERTICAL_SORT_ORDER, $cdg['cdg_vertical_sort_order'])];\n          $contents[] = ['text' => sprintf(TEXT_INFO_HORIZONTAL_SORT_ORDER, $cdg['cdg_horizontal_sort_order'])];\n          $contents[] = ['text' => sprintf(TEXT_INFO_WIDTH, $cdg['customer_data_groups_width'])];\n        }\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require 'includes/template_bottom.php';\n  require 'includes/application_bottom.php';\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  class product_notification {\n\n    public $show_choose_audience = true;\n    public $title, $content;\n\n    function __construct($title, $content) {\n      $this->show_choose_audience = true;\n      $this->title = $title;\n      $this->content = $content;\n    }\n\n    function choose_audience() {\n      $products = [];\n      $products_query = tep_db_query(<<<'EOSQL'\nSELECT pd.products_id, pd.products_name\n  FROM products p INNER JOIN products_description pd ON pd.products_id = p.products_id\n  WHERE p.products_status = 1 AND pd.language_id = \nEOSQL\n        . (int)$GLOBALS['languages_id'] . ' ORDER BY pd.products_name');\n      while ($product = tep_db_fetch_array($products_query)) {\n        $products[] = [\n          'id' => $product['products_id'],\n          'text' => $product['products_name'],\n        ];\n      }\n\n$choose_audience_string = '<script><!--\nfunction mover(move) {\n  if (move == \\'remove\\') {\n    for (x=0; x<(document.notifications.products.length); x++) {\n      if (document.notifications.products.options[x].selected) {\n        with(document.notifications.elements[\\'chosen[]\\']) {\n          options[options.length] = new Option(document.notifications.products.options[x].text,document.notifications.products.options[x].value);\n        }\n        document.notifications.products.options[x] = null;\n        x = -1;\n      }\n    }\n  }\n  if (move == \\'add\\') {\n    for (x=0; x<(document.notifications.elements[\\'chosen[]\\'].length); x++) {\n      if (document.notifications.elements[\\'chosen[]\\'].options[x].selected) {\n        with(document.notifications.products) {\n          options[options.length] = new Option(document.notifications.elements[\\'chosen[]\\'].options[x].text,document.notifications.elements[\\'chosen[]\\'].options[x].value);\n        }\n        document.notifications.elements[\\'chosen[]\\'].options[x] = null;\n        x = -1;\n      }\n    }\n  }\n  return true;\n}\n\nfunction selectAll(FormName, SelectBox) {\n  temp = \"document.\" + FormName + \".elements[\\'\" + SelectBox + \"\\']\";\n  Source = eval(temp);\n\n  for (x=0; x<(Source.length); x++) {\n    Source.options[x].selected = \"true\";\n  }\n\n  if (x<1) {\n    alert(\\'' . JS_PLEASE_SELECT_PRODUCTS . '\\');\n    return false;\n  } else {\n    return true;\n  }\n}\n//--></script>';\n\n      $choose_audience_string .= '<form name=\"notifications\" action=\"' . tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID'] . '&action=confirm') . '\" method=\"post\" onsubmit=\"return selectAll(\\'notifications\\', \\'chosen[]\\')\">';\n        $choose_audience_string .= '<div class=\"row mb-3\">';\n          $choose_audience_string .= '<div class=\"col-5\">';\n            $choose_audience_string .= '<h6>' . TEXT_PRODUCTS . '</h6>';\n            $choose_audience_string .= tep_draw_pull_down_menu('products', $products, '', 'class=\"custom-select\" size=\"20\" multiple');\n          $choose_audience_string .= '</div>';\n          $choose_audience_string .= '<div class=\"col-2 align-self-center text-center\">';\n            $choose_audience_string .= tep_draw_bootstrap_button(BUTTON_GLOBAL, 'fas fa-globe', tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID'] . '&action=confirm&global=true'), 'primary', null, 'btn-info xxx text-white');\n            $choose_audience_string .= '<br><br>';\n            $choose_audience_string .= '<input type=\"button\" class=\"btn btn-secondary\" value=\"' . BUTTON_SELECT . '\" onClick=\"mover(\\'remove\\');\">';\n            $choose_audience_string .= '<br><br>';\n            $choose_audience_string .= '<input type=\"button\" class=\"btn btn-secondary\" value=\"' . BUTTON_UNSELECT . '\" onClick=\"mover(\\'add\\');\">';\n          $choose_audience_string .= '</div>';\n          $choose_audience_string .= '<div class=\"col-5\">';\n            $choose_audience_string .= '<h6>' . TEXT_SELECTED_PRODUCTS . '</h6>';\n            $choose_audience_string .= tep_draw_pull_down_menu('chosen[]', [], '', 'class=\"custom-select\" size=\"20\" multiple');\n          $choose_audience_string .= '</div>';\n        $choose_audience_string .= '</div>';\n\n        $choose_audience_string .= tep_draw_bootstrap_button(IMAGE_SEND, 'fas fa-paper-plane', null, 'primary', null, 'btn-success btn-lg btn-block xxx text-white');\n        $choose_audience_string .= tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID']), null, null, 'btn-light mt-2');\n      $choose_audience_string .= '</form>';\n\n      return $choose_audience_string;\n    }\n\n    function confirm() {\n      $audience = [];\n\n      $sql = \"SELECT distinct customers_id FROM products_notifications\";\n      if ('true' !== ($_GET['global'] ?? null)) {\n        $sql .= \" WHERE products_id in (\" . implode(', ', $_POST['chosen']) . \")\";\n      }\n\n      $products_query = tep_db_query($sql);\n      while ($products = tep_db_fetch_array($products_query)) {\n        $audience[$products['customers_id']] = '1';\n      }\n\n      $customers_query = tep_db_query(\"SELECT customers_info_id FROM customers_info WHERE global_product_notifications = 1\");\n      while ($customers = tep_db_fetch_array($customers_query)) {\n        $audience[$customers['customers_info_id']] = '1';\n      }\n\n      $confirm_string = '<div class=\"alert alert-danger\">' . sprintf(TEXT_COUNT_CUSTOMERS, count($audience)) . '</div>';\n\n        $confirm_string .= '<table class=\"table table-striped\">';\n          $confirm_string .= '<tr>';\n            $confirm_string .= '<th scope=\"row\">' . TEXT_TITLE . '</th>';\n            $confirm_string .= '<td>' . $this->title . '</td>';\n          $confirm_string .= '</tr>';\n          $confirm_string .= '<tr>';\n            $confirm_string .= '<th scope=\"row\">' . TEXT_CONTENT . '</th>';\n            $confirm_string .= '<td>' . $this->content . '</td>';\n          $confirm_string .= '</tr>';\n        $confirm_string .= '</table>';\n\n      if (count($audience) > 0) {\n        $confirm_string .= tep_draw_form('confirm', 'newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID'] . '&action=confirm_send');\n        if (is_array($_POST['chosen'] ?? null)) {\n          foreach ($_POST['chosen'] as $customer_id) {\n            $confirm_string .= tep_draw_hidden_field('chosen[]', $customer_id);\n          }\n        } else {\n          $confirm_string .= tep_draw_hidden_field('global', 'true');\n        }\n\n          $confirm_string .= tep_draw_bootstrap_button(IMAGE_SEND, 'fas fa-paper-plane', null, 'primary', null, 'btn-success btn-block btn-lg');\n        $confirm_string .= '</form>';\n      }\n\n      $confirm_string .= tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID'] . '&action=send'), 'primary', null, 'btn-light mt-2');\n\n      return $confirm_string;\n    }\n\n    function send($newsletter_id) {\n      global $customer_data;\n      $audience = [];\n\n      $db_tables = $customer_data->build_db_tables(['id', 'name', 'email_address'], 'customers');\n      tep_guarantee_subarray($db_tables, 'customers');\n      $db_tables['customers']['customers_id'] = null;\n      $built = query::rtrim_string_once(customer_query::build_specified_columns($db_tables), query::COLUMN_SEPARATOR)\n             . ' FROM' . customer_query::build_joins($db_tables, []);\n\n      $sql = 'SELECT DISTINCT ' . $built;\n      $sql .= ' INNER JOIN products_notifications pn ON c.customers_id = pn.customers_id';\n      if ('true' !== ($_POST['global'] ?? null)) {\n        $sql .= ' WHERE pn.products_id in (' . implode(',', $_POST['chosen']) . ')';\n      }\n\n      $products_query = tep_db_query($sql);\n      while ($products = tep_db_fetch_array($products_query)) {\n        $audience[$customer_data->get('id', $products)] = [\n          'name' => $customer_data->get('name', $products),\n          'email_address' => $customer_data->get('email_address', $products),\n        ];\n      }\n\n      $customers_query = tep_db_query('SELECT ' . $built . ' INNER JOIN customers_info ci ON c.customers_id = ci.customers_info_id WHERE ci.global_product_notifications = 1');\n      while ($customers = tep_db_fetch_array($customers_query)) {\n        $audience[$customer_data->get('id', $customers)] = [\n          'name' => $customer_data->get('name', $customers),\n          'email_address' => $customer_data->get('email_address', $customers),\n        ];\n      }\n\n      $mimemessage = new email();\n      $mimemessage->add_message($this->content);\n      $mimemessage->build_message();\n\n      foreach ($audience as $value) {\n        $mimemessage->send($value['name'], $value['email_address'], STORE_OWNER, STORE_OWNER_EMAIL_ADDRESS, $this->title);\n      }\n\n      $newsletter_id = tep_db_prepare_input($newsletter_id);\n      tep_db_query(\"UPDATE newsletters SET date_sent = NOW(), status = 1 WHERE newsletters_id = '\" . tep_db_input($newsletter_id) . \"'\");\n    }\n  }\n\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require 'includes/application_top.php';\n\n  $action = ($_GET['action'] ?? '');\n  \n  $OSCOM_Hooks->call('languages', 'languagesPreAction');\n\n  if (tep_not_null($action)) {\n    if ('insert' == $action || 'save' == $action) {\n      $sql_data = [\n        'name' => tep_db_prepare_input($_POST['name']),\n        'code' => tep_db_prepare_input(substr($_POST['code'], 0, 2)),\n        'image' => tep_db_prepare_input($_POST['image']),\n        'directory' => tep_db_prepare_input($_POST['directory']),\n        'sort_order' => (int)tep_db_prepare_input($_POST['sort_order']),\n      ];\n    }\n\n    switch ($action) {\n      case 'insert':\n        tep_db_perform('languages', $sql_data);\n        $lID = tep_db_insert_id();\n\n// create additional language-specific records\n        tep_db_query(\"INSERT INTO categories_description (categories_id, language_id, categories_name) SELECT categories_id, \" . (int)$lID . \", categories_name FROM categories_description WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO products_description (products_id, language_id, products_name, products_description, products_url) SELECT products_id, \" . (int)$lID . \", products_name, products_description, products_url FROM products_description WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO products_options (products_options_id, language_id, products_options_name) SELECT products_options_id, \" . (int)$lID . \", products_options_name FROM products_options WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO products_options_values (products_options_values_id, language_id, products_options_values_name) SELECT products_options_values_id, \" . (int)$lID . \", products_options_values_name FROM products_options_values WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO manufacturers_info (manufacturers_id, languages_id, manufacturers_url) SELECT manufacturers_id, \" . (int)$lID . \", manufacturers_url FROM manufacturers_info WHERE languages_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO orders_status (orders_status_id, language_id, orders_status_name) SELECT orders_status_id, \" . (int)$lID . \", orders_status_name FROM orders_status WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO customer_data_groups (customer_data_groups_id, language_id, customer_data_groups_name, cdg_vertical_sort_order, cdg_horizontal_sort_order, customer_data_groups_width) SELECT customer_data_groups_id, \" . (int)$lID . \", customer_data_groups_name, cdg_vertical_sort_order, cdg_horizontal_sort_order, customer_data_groups_width FROM customer_data_groups WHERE language_id = \" . (int)$languages_id);\n\n        if (isset($_POST['default']) && ($_POST['default'] == 'on')) {\n          tep_db_query(\"UPDATE configuration SET configuration_value = '\" . tep_db_input($code) . \"' WHERE configuration_key = 'DEFAULT_LANGUAGE'\");\n        }\n        \n        $OSCOM_Hooks->call('languages', 'languagesActionInsert');\n\n        tep_redirect(tep_href_link('languages.php', (isset($_GET['page']) ? 'page=' . $_GET['page'] . '&' : '') . 'lID=' . $lID));\n        break;\n      case 'save':\n        $lID = tep_db_prepare_input($_GET['lID']);\n        tep_db_perform('languages', $sql_data, 'update', \"languages_id = \" . (int)$lID);\n\n        if (isset($_POST['default']) && $_POST['default'] == 'on') {\n          tep_db_query(\"UPDATE configuration SET configuration_value = '\" . tep_db_input($sql_data['code']) . \"' WHERE configuration_key = 'DEFAULT_LANGUAGE'\");\n        }\n        \n        $OSCOM_Hooks->call('languages', 'languagesActionSave');\n\n        tep_redirect(tep_href_link('languages.php', (isset($_GET['page']) ? 'page=' . $_GET['page'] . '&' : '') . 'lID=' . $lID));\n        break;\n      case 'deleteconfirm':\n        $lID = tep_db_prepare_input($_GET['lID']);\n\n        $lng_query = tep_db_query(\"SELECT languages_id FROM languages WHERE code = '\" . DEFAULT_CURRENCY . \"'\");\n        $lng = tep_db_fetch_array($lng_query);\n        if ($lng['languages_id'] == $lID) {\n          $remove_language = false;\n          $messageStack->add(ERROR_REMOVE_DEFAULT_LANGUAGE, 'error');\n          $action = 'delete';\n          break;\n        }\n\n        tep_db_query(\"DELETE FROM categories_description WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM products_description WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM products_options WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM products_options_values WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM manufacturers_info WHERE languages_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM orders_status WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM customer_data_groups WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM languages WHERE languages_id = '\" . (int)$lID . \"'\");\n        \n        $OSCOM_Hooks->call('languages', 'languagesActionDeleteConfirm');\n\n        tep_redirect(tep_href_link('languages.php', (isset($_GET['page']) ? 'page=' . $_GET['page'] : '')));\n        break;\n      case 'delete':\n        $lID = tep_db_prepare_input($_GET['lID']);\n\n        $lng_query = tep_db_query(\"SELECT code FROM languages WHERE languages_id = '\" . (int)$lID . \"'\");\n        $lng = tep_db_fetch_array($lng_query);\n\n        $remove_language = true;\n        if ($lng['code'] == DEFAULT_LANGUAGE) {\n          $remove_language = false;\n          $messageStack->add(ERROR_REMOVE_DEFAULT_LANGUAGE, 'error');\n        }\n        \n        $OSCOM_Hooks->call('languages', 'languagesActionDelete');\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('languages', 'languagesPostAction');\n\n  require 'includes/template_top.php';\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_LANGUAGE, 'fas fa-comment-dots', tep_href_link('languages.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('languages.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_LANGUAGE_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_LANGUAGE_CODE; ?></th>\n              <th><?php echo TABLE_HEADING_LANGUAGE_IMAGE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $languages_query_raw = \"select * from languages order by sort_order\";\n            $languages_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $languages_query_raw, $languages_query_numrows);\n            $languages_query = tep_db_query($languages_query_raw);\n\n            while ($languages = tep_db_fetch_array($languages_query)) {\n              if ((!isset($_GET['lID']) || (isset($_GET['lID']) && ($_GET['lID'] == $languages['languages_id']))) && !isset($lInfo) && (substr($action, 0, 3) != 'new')) {\n                $lInfo = new objectInfo($languages);\n              }\n\n              if (isset($lInfo) && is_object($lInfo) && ($languages['languages_id'] == $lInfo->languages_id) ) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('languages.php', 'page=' . $_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('languages.php', 'page=' . $_GET['page'] . '&lID=' . $languages['languages_id']) . '\\'\">';\n              }\n\n              if (DEFAULT_LANGUAGE == $languages['code']) {\n                echo '<th>' . $languages['name'] . ' (' . TEXT_DEFAULT . ')</th>';\n              } else {\n                echo '<td>' . $languages['name'] . '</td>';\n              }\n              ?>\n                <td><?php echo $languages['code']; ?></td>\n                <td><?php echo tep_image(tep_catalog_href_link('includes/languages/' . $languages['directory'] . '/images/' . $languages['image'], '', 'SSL')); ?></td>\n                <td class=\"text-right\"><?php if (isset($lInfo) && is_object($lInfo) && ($languages['languages_id'] == $lInfo->languages_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('languages.php', 'page=' . $_GET['page'] . '&lID=' . $languages['languages_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $languages_split->display_count($languages_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_LANGUAGES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $languages_split->display_links($languages_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_LANGUAGE];\n\n      $contents = ['form' => tep_draw_form('languages', 'languages.php', 'action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_NAME, null) . '<br>' . tep_draw_input_field('name')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_CODE, null) . '<br>' . tep_draw_input_field('code')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_IMAGE, null) . '<br>' . tep_draw_input_field('image', 'icon.gif')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_DIRECTORY, null, null) . '<br>' . tep_draw_input_field('directory')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_SORT_ORDER, null) . '<br>' . tep_draw_input_field('sort_order')];\n      $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_SET_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('languages.php'), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_LANGUAGE];\n\n      $contents = ['form' => tep_draw_form('languages', 'languages.php', 'page=' . $_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_NAME, null) . '<br>' . tep_draw_input_field('name', $lInfo->name)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_CODE, null) . '<br>' . tep_draw_input_field('code', $lInfo->code)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_IMAGE, null) . '<br>' . tep_draw_input_field('image', $lInfo->image)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_DIRECTORY, null, null) . '<br>' . tep_draw_input_field('directory', $lInfo->directory)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_SORT_ORDER, null) . '<br>' . tep_draw_input_field('sort_order', $lInfo->sort_order)];\n      if (DEFAULT_LANGUAGE != $lInfo->code) $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_SET_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => '<br>' . tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('languages.php', 'page=' . $_GET['page'] . '&lID=' . $lInfo->languages_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_LANGUAGE];\n\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $lInfo->name];\n      $contents[] = ['class' => 'text-center', 'text' => (($remove_language) ? tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('languages.php', 'page=' . $_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=deleteconfirm'), null, null, 'btn-danger xxx text-white mr-2') : '') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('languages.php', 'page=' . $_GET['page'] . '&lID=' . $lInfo->languages_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($lInfo)) {\n        $heading[] = ['text' => $lInfo->name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('languages.php', 'page=' . $_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('languages.php', 'page=' . $_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2')]; \n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DETAILS, 'fas fa-eye', tep_href_link('define_language.php', 'lngdir=' . $lInfo->directory), null, null, 'btn-info xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_DIRECTORY, DIR_WS_CATALOG_LANGUAGES, $lInfo->directory)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_SORT_ORDER, $lInfo->sort_order)];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n  \n<?php\n  require 'includes/template_bottom.php';\n  require 'includes/application_bottom.php';\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('manufacturers', 'manufacturersPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n      case 'save':\n        if (isset($_GET['mID'])) $manufacturers_id = tep_db_prepare_input($_GET['mID']);\n        $manufacturers_name = tep_db_prepare_input($_POST['manufacturers_name']);\n\n        $sql_data_array = ['manufacturers_name' => $manufacturers_name];\n\n        if ($action == 'insert') {\n          $insert_sql_data = ['date_added' => 'now()'];\n\n          $sql_data_array = array_merge($sql_data_array, $insert_sql_data);\n\n          tep_db_perform('manufacturers', $sql_data_array);\n          $manufacturers_id = tep_db_insert_id();\n        } elseif ($action == 'save') {\n          $update_sql_data = ['last_modified' => 'now()'];\n\n          $sql_data_array = array_merge($sql_data_array, $update_sql_data);\n\n          tep_db_perform('manufacturers', $sql_data_array, 'update', \"manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n        }\n\n        $manufacturers_image = new upload('manufacturers_image');\n        $manufacturers_image->set_destination(DIR_FS_CATALOG_IMAGES);\n\n        if ($manufacturers_image->parse() && $manufacturers_image->save()) {\n          tep_db_query(\"update manufacturers set manufacturers_image = '\" . tep_db_input($manufacturers_image->filename) . \"' where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n        }\n\n        $languages = tep_get_languages();\n        for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n          $manufacturers_url_array = $_POST['manufacturers_url'];\n          $manufacturers_description_array = $_POST['manufacturers_description'];\n          $manufacturers_seo_description_array = $_POST['manufacturers_seo_description'];\n          $manufacturers_seo_keywords_array = $_POST['manufacturers_seo_keywords'];\n          $manufacturers_seo_title_array = $_POST['manufacturers_seo_title'];\n          $language_id = $languages[$i]['id'];\n\n          $sql_data_array = ['manufacturers_url' => tep_db_prepare_input($manufacturers_url_array[$language_id])];\n          $sql_data_array['manufacturers_description'] = tep_db_prepare_input($manufacturers_description_array[$language_id]);\n          $sql_data_array['manufacturers_seo_description'] = tep_db_prepare_input($manufacturers_seo_description_array[$language_id]);\n          $sql_data_array['manufacturers_seo_keywords'] = tep_db_prepare_input($manufacturers_seo_keywords_array[$language_id]);\n          $sql_data_array['manufacturers_seo_title'] = tep_db_prepare_input($manufacturers_seo_title_array[$language_id]);\n\n          if ($action == 'insert') {\n            $insert_sql_data = ['manufacturers_id' => $manufacturers_id, 'languages_id' => $language_id];\n\n            $sql_data_array = array_merge($sql_data_array, $insert_sql_data);\n\n            tep_db_perform('manufacturers_info', $sql_data_array);\n          } elseif ($action == 'save') {\n            tep_db_perform('manufacturers_info', $sql_data_array, 'update', \"manufacturers_id = '\" . (int)$manufacturers_id . \"' and languages_id = '\" . (int)$language_id . \"'\");\n          }\n        }\n        \n        $OSCOM_Hooks->call('manufacturers', 'manufacturersActionSave');\n\n        tep_redirect(tep_href_link('manufacturers.php', (isset($_GET['page']) ? 'page=' . $_GET['page'] . '&' : '') . 'mID=' . $manufacturers_id));\n        break;\n      case 'deleteconfirm':\n        $manufacturers_id = tep_db_prepare_input($_GET['mID']);\n\n        if (isset($_POST['delete_image']) && ($_POST['delete_image'] == 'on')) {\n          $manufacturer_query = tep_db_query(\"select manufacturers_image from manufacturers where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n          $manufacturer = tep_db_fetch_array($manufacturer_query);\n\n          $image_location = DIR_FS_DOCUMENT_ROOT . DIR_WS_CATALOG_IMAGES . $manufacturer['manufacturers_image'];\n\n          if (file_exists($image_location)) @unlink($image_location);\n        }\n\n        tep_db_query(\"delete from manufacturers where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n        tep_db_query(\"delete from manufacturers_info where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n\n        if (isset($_POST['delete_products']) && ($_POST['delete_products'] == 'on')) {\n          $products_query = tep_db_query(\"select products_id from products where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n          while ($products = tep_db_fetch_array($products_query)) {\n            tep_remove_product($products['products_id']);\n          }\n        } else {\n          tep_db_query(\"update products set manufacturers_id = '' where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n        }\n        \n        $OSCOM_Hooks->call('manufacturers', 'manufacturersActionDelete');\n\n        tep_redirect(tep_href_link('manufacturers.php', 'page=' . $_GET['page']));\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('manufacturers', 'manufacturersPostAction');\n\n  require('includes/template_top.php');\n?>\n  \n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(BUTTON_INSERT_NEW_MANUFACTURER, 'fas fa-id-card', tep_href_link('manufacturers.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('manufacturers.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_MANUFACTURERS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $manufacturers_query_raw = \"select * from manufacturers order by manufacturers_name\";\n            $manufacturers_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $manufacturers_query_raw, $manufacturers_query_numrows);\n            $manufacturers_query = tep_db_query($manufacturers_query_raw);\n            while ($manufacturers = tep_db_fetch_array($manufacturers_query)) {\n              if ((!isset($_GET['mID']) || (isset($_GET['mID']) && ($_GET['mID'] == $manufacturers['manufacturers_id']))) && !isset($mInfo) && (substr($action, 0, 3) != 'new')) {\n                $manufacturer_products_query = tep_db_query(\"select count(*) as products_count from products where manufacturers_id = '\" . (int)$manufacturers['manufacturers_id'] . \"'\");\n                $manufacturer_products = tep_db_fetch_array($manufacturer_products_query);\n\n                $mInfo_array = array_merge($manufacturers, $manufacturer_products);\n                $mInfo = new objectInfo($mInfo_array);\n              }\n\n              if (isset($mInfo) && is_object($mInfo) && ($manufacturers['manufacturers_id'] == $mInfo->manufacturers_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . (int)$manufacturers['manufacturers_id'] . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . (int)$manufacturers['manufacturers_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $manufacturers['manufacturers_name']; ?></td>\n                <td class=\"text-right\"><?php if (isset($mInfo) && is_object($mInfo) && ($manufacturers['manufacturers_id'] == $mInfo->manufacturers_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('manufacturers.php', 'page=' . $_GET['page'] . '&mID=' . $manufacturers['manufacturers_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n<?php\n  }\n?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $manufacturers_split->display_count($manufacturers_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_MANUFACTURERS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $manufacturers_split->display_links($manufacturers_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n  \n  $col = 6;\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_HEADING_NEW_MANUFACTURER];\n\n      $contents = ['form' => tep_draw_form('manufacturers', 'manufacturers.php', 'action=insert', 'post', 'enctype=\"multipart/form-data\"')];\n      $contents[] = ['text' => TEXT_NEW_INTRO];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_NAME . '<br>' . tep_draw_input_field('manufacturers_name')];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_IMAGE . '<br><div class=\"custom-file mb-2\">' . tep_draw_input_field('manufacturers_image', '', 'id=\"inputManufacturersImage\"', 'file', null, 'class=\"form-control-input\"') . '<label class=\"custom-file-label\" for=\"inputManufacturersImage\">' . TEXT_MANUFACTURERS_IMAGE_LABEL . '</label></div>'];\n\n      $manufacturer_inputs_string = $manufacturer_description_string = $manufacturer_seo_description_string = $manufacturer_seo_keywords_string = $manufacturer_seo_title_string = '';\n\n      $languages = tep_get_languages();\n      for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n        $manufacturer_inputs_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_url[' . $languages[$i]['id'] . ']') . '</div>';\n        $manufacturer_description_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name'], '', '', 'style=\"vertical-align: top;\"') . '</span></div>' . tep_draw_textarea_field('manufacturers_description[' . $languages[$i]['id'] . ']', 'soft', '80', '10') . '</div>';\n        $manufacturer_seo_description_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name'], '', '', 'style=\"vertical-align: top;\"') . '</span></div>' . tep_draw_textarea_field('manufacturers_seo_description[' . $languages[$i]['id'] . ']', 'soft', '80', '10') . '</div>';\n        $manufacturer_seo_keywords_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_seo_keywords[' . $languages[$i]['id'] . ']', NULL, 'placeholder=\"' . PLACEHOLDER_COMMA_SEPARATION . '\"') . '</div>';\n        $manufacturer_seo_title_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_seo_title[' . $languages[$i]['id'] . ']') . '</div>';\n      }\n\n      $contents[] = ['text' => TEXT_MANUFACTURERS_URL . $manufacturer_inputs_string];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_SEO_TITLE . $manufacturer_seo_title_string];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_DESCRIPTION . $manufacturer_description_string];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_SEO_DESCRIPTION . $manufacturer_seo_description_string];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_SEO_KEYWORDS . $manufacturer_seo_keywords_string];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('manufacturers.php'), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_HEADING_EDIT_MANUFACTURER . ' <small>' . TEXT_EDIT_INTRO . '</small>'];\n\n      $contents = ['form' => tep_draw_form('manufacturers', 'manufacturers.php', 'page=' . $_GET['page'] . '&mID=' . $mInfo->manufacturers_id . '&action=save', 'post', 'enctype=\"multipart/form-data\"')];\n      $contents[] = ['text' => TEXT_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_NAME . '<br>' . tep_draw_input_field('manufacturers_name', $mInfo->manufacturers_name)];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_IMAGE . '<br><div class=\"custom-file mb-2\">' . tep_draw_input_field('manufacturers_image', '', 'id=\"inputManufacturersImage\"', 'file', null, 'class=\"form-control-input\"') . '<label class=\"custom-file-label\" for=\"inputManufacturersImage\">' . $mInfo->manufacturers_image . '</label></div>'];\n      \n      $manufacturer_inputs_string = $manufacturer_description_string = $manufacturer_seo_description_string = $manufacturer_seo_keywords_string = $manufacturer_seo_title_string = '';\n      $languages = tep_get_languages();\n      for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n        \n        $manufacturer_inputs_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_url[' . $languages[$i]['id'] . ']', tep_get_manufacturer_url($mInfo->manufacturers_id, $languages[$i]['id'])) . '</div>';\n        $manufacturer_seo_title_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_seo_title[' . $languages[$i]['id'] . ']', tep_get_manufacturer_seo_title($mInfo->manufacturers_id, $languages[$i]['id'])) . '</div>';\n        $manufacturer_description_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name'], '', '', 'style=\"vertical-align: top;\"') . '</span></div>' . tep_draw_textarea_field('manufacturers_description[' . $languages[$i]['id'] . ']', 'soft', '80', '10', tep_get_manufacturer_description($mInfo->manufacturers_id, $languages[$i]['id'])) . '</div>';\n        $manufacturer_seo_description_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name'], '', '', 'style=\"vertical-align: top;\"') . '</span></div>' . tep_draw_textarea_field('manufacturers_seo_description[' . $languages[$i]['id'] . ']', 'soft', '80', '10', tep_get_manufacturer_seo_description($mInfo->manufacturers_id, $languages[$i]['id'])) . '</div>';\n        $manufacturer_seo_keywords_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_seo_keywords[' . $languages[$i]['id'] . ']', tep_get_manufacturer_seo_keywords($mInfo->manufacturers_id, $languages[$i]['id']), 'placeholder=\"' . PLACEHOLDER_COMMA_SEPARATION . '\"') . '</div>';\n      }\n\n      $contents[] = ['text' => TEXT_MANUFACTURERS_URL . $manufacturer_inputs_string];\n      $contents[] = ['text' => TEXT_EDIT_MANUFACTURERS_SEO_TITLE . $manufacturer_seo_title_string];\n      $contents[] = ['text' => TEXT_EDIT_MANUFACTURERS_DESCRIPTION . $manufacturer_description_string];\n      $contents[] = ['text' => TEXT_EDIT_MANUFACTURERS_SEO_DESCRIPTION . $manufacturer_seo_description_string];\n      $contents[] = ['text' => TEXT_EDIT_MANUFACTURERS_SEO_KEYWORDS . $manufacturer_seo_keywords_string];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('manufacturers.php', 'page=' . $_GET['page'] . '&mID=' . (int)$mInfo->manufacturers_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $col = 3;\n      $heading[] = ['text' =>  TEXT_HEADING_DELETE_MANUFACTURER];\n\n      $contents = ['form' => tep_draw_form('manufacturers', 'manufacturers.php', 'page=' . $_GET['page'] . '&mID=' . $mInfo->manufacturers_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_DELETE_INTRO];\n      $contents[] = ['text' => '<strong>' . $mInfo->manufacturers_name . '</strong>'];\n      $contents[] = ['text' => tep_draw_checkbox_field('delete_image', '', true) . ' ' . TEXT_DELETE_IMAGE];\n\n      if ($mInfo->products_count > 0) {\n        $contents[] = ['text' => tep_draw_checkbox_field('delete_products') . ' ' . TEXT_DELETE_PRODUCTS];\n        $contents[] = ['text' => sprintf(TEXT_DELETE_WARNING_PRODUCTS, $mInfo->products_count)];\n      }\n\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('manufacturers.php', 'page=' . $_GET['page'] . '&mID=' . $mInfo->manufacturers_id), null, null, 'btn-light')];\n      break;\n    default:\n      $col = 3;\n      if (isset($mInfo) && is_object($mInfo)) {\n        $heading[] = ['text' => $mInfo->manufacturers_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('manufacturers.php', 'page=' . $_GET['page'] . '&mID=' . $mInfo->manufacturers_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('manufacturers.php', 'page=' . $_GET['page'] . '&mID=' . $mInfo->manufacturers_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_DATE_ADDED, tep_date_short($mInfo->date_added))];\n        if (tep_not_null($mInfo->last_modified)) $contents[] = ['text' => sprintf(TEXT_LAST_MODIFIED, tep_date_short($mInfo->last_modified))];\n        $contents[] = ['text' => tep_info_image($mInfo->manufacturers_image, $mInfo->manufacturers_name)];\n        $contents[] = ['text' => sprintf(TEXT_PRODUCTS, $mInfo->products_count)];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-' . $col . '\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n  \n  <script>$(document).on('change', '#inputManufacturersImage', function (event) { $(this).next('.custom-file-label').html(event.target.files[0].name); });</script>  \n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'lock':\n      case 'unlock':\n        $newsletter_id = tep_db_prepare_input($_GET['nID']);\n        $status = (($action == 'lock') ? '1' : '0');\n\n        tep_db_query(\"update newsletters set locked = '\" . $status . \"' where newsletters_id = '\" . (int)$newsletter_id . \"'\");\n\n        tep_redirect(tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID']));\n        break;\n      case 'insert':\n      case 'update':\n        if (isset($_POST['newsletter_id'])) $newsletter_id = tep_db_prepare_input($_POST['newsletter_id']);\n        $newsletter_module = tep_db_prepare_input($_POST['module']);\n        \n        $allowed = array_map(function($v) {return basename($v, '.php');}, glob('includes/modules/newsletters/*.php'));\n        if (!in_array($newsletter_module, $allowed)) {\n          $messageStack->add(ERROR_NEWSLETTER_MODULE_NOT_EXISTS, 'error');\n          $newsletter_error = true;\n        }\n        \n        $title = tep_db_prepare_input($_POST['title']);\n        $content = tep_db_prepare_input($_POST['content']);\n\n        $newsletter_error = false;\n        if (empty($title)) {\n          $messageStack->add(ERROR_NEWSLETTER_TITLE, 'error');\n          $newsletter_error = true;\n        }\n\n        if (empty($newsletter_module)) {\n          $messageStack->add(ERROR_NEWSLETTER_MODULE, 'error');\n          $newsletter_error = true;\n        }\n\n        if ($newsletter_error == false) {\n          $sql_data_array = ['title' => $title,\n                             'content' => $content,\n                             'module' => $newsletter_module];\n\n          if ($action == 'insert') {\n            $sql_data_array['date_added'] = 'now()';\n            $sql_data_array['status'] = '0';\n            $sql_data_array['locked'] = '0';\n\n            tep_db_perform('newsletters', $sql_data_array);\n            $newsletter_id = tep_db_insert_id();\n          } elseif ($action == 'update') {\n            tep_db_perform('newsletters', $sql_data_array, 'update', \"newsletters_id = '\" . (int)$newsletter_id . \"'\");\n          }\n\n          tep_redirect(tep_href_link('newsletters.php', (isset($_GET['page']) ? 'page=' . $_GET['page'] . '&' : '') . 'nID=' . $newsletter_id));\n        } else {\n          $action = 'new';\n        }\n        break;\n      case 'deleteconfirm':\n        $newsletter_id = tep_db_prepare_input($_GET['nID']);\n\n        tep_db_query(\"delete from newsletters where newsletters_id = '\" . (int)$newsletter_id . \"'\");\n\n        tep_redirect(tep_href_link('newsletters.php', 'page=' . $_GET['page']));\n        break;\n      case 'delete':\n      case 'new': if (!isset($_GET['nID'])) break;\n      case 'send':\n      case 'confirm_send':\n        $newsletter_id = tep_db_prepare_input($_GET['nID']);\n\n        $check_query = tep_db_query(\"select locked from newsletters where newsletters_id = '\" . (int)$newsletter_id . \"'\");\n        $check = tep_db_fetch_array($check_query);\n\n        if ($check['locked'] < 1) {\n          switch ($action) {\n            case 'delete': $error = ERROR_REMOVE_UNLOCKED_NEWSLETTER; break;\n            case 'new': $error = ERROR_EDIT_UNLOCKED_NEWSLETTER; break;\n            case 'send': $error = ERROR_SEND_UNLOCKED_NEWSLETTER; break;\n            case 'confirm_send': $error = ERROR_SEND_UNLOCKED_NEWSLETTER; break;\n          }\n\n          $messageStack->add_session($error, 'error');\n\n          tep_redirect(tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID']));\n        }\n        break;\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_NEWSLETTER, 'fas fa-newspaper', tep_href_link('newsletters.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      } else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('newsletters.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n\n  <?php\n  if ($action == 'new') {\n    $form_action = 'insert';\n\n    $parameters = ['title' => '', 'content' => '', 'module' => ''];\n\n    $nInfo = new objectInfo($parameters);\n\n    if (isset($_GET['nID'])) {\n      $form_action = 'update';\n\n      $nID = tep_db_prepare_input($_GET['nID']);\n\n      $newsletter_query = tep_db_query(\"select title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n      $newsletter = tep_db_fetch_array($newsletter_query);\n\n      $nInfo->objectInfo($newsletter);\n    } elseif ($_POST) {\n      $nInfo->objectInfo($_POST);\n    }\n\n    $file_extension = substr($PHP_SELF, strrpos($PHP_SELF, '.'));\n    $directory_array = [];\n    if ($dir = dir('includes/modules/newsletters/')) {\n      while ($file = $dir->read()) {\n        if (!is_dir('includes/modules/newsletters/' . $file)) {\n          if (substr($file, strrpos($file, '.')) == $file_extension) {\n            $directory_array[] = $file;\n          }\n        }\n      }\n      sort($directory_array);\n      $dir->close();\n    }\n\n    for ($i=0, $n=sizeof($directory_array); $i<$n; $i++) {\n      $modules_array[] = ['id' => substr($directory_array[$i], 0, strrpos($directory_array[$i], '.')), 'text' => substr($directory_array[$i], 0, strrpos($directory_array[$i], '.'))];\n    }\n\n    echo tep_draw_form('newsletter', 'newsletters.php', (isset($_GET['page']) ? 'page=' . $_GET['page'] . '&' : '') . 'action=' . $form_action); if ($form_action == 'update') echo tep_draw_hidden_field('newsletter_id', $nID); ?>\n\n    <div class=\"form-group row\">\n      <label for=\"Module\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_NEWSLETTER_MODULE; ?></label>\n      <div class=\"col-sm-9\">\n        <?php echo tep_draw_pull_down_menu('module', $modules_array, $nInfo->module, 'id=\"Module\" required aria-required=\"true\"'); ?>\n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"Title\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_NEWSLETTER_TITLE; ?></label>\n      <div class=\"col-sm-9\">\n        <?php echo tep_draw_input_field('title', $nInfo->title, 'id=\"Title\" required aria-required=\"true\"'); ?>\n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"Content\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_NEWSLETTER_CONTENT; ?></label>\n      <div class=\"col-sm-9\">\n        <?php echo tep_draw_textarea_field('content', 'soft', '60', '15', $nInfo->content, 'id=\"Content\" required aria-required=\"true\"'); ?>\n      </div>\n    </div>\n\n    <div class=\"buttonSet\">\n      <?php\n      echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success btn-block btn-lg');\n      echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('newsletters.php', (isset($_GET['page']) ? 'page=' . $_GET['page'] . '&' : '') . (isset($_GET['nID']) ? 'nID=' . (int)$_GET['nID'] : '')), null, null, 'btn-light mt-2');\n      ?>\n    </div>\n\n  </form>\n\n  <?php\n  } elseif ($action == 'preview') {\n    $nID = tep_db_prepare_input($_GET['nID']);\n\n    $newsletter_query = tep_db_query(\"select title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n    $newsletter = tep_db_fetch_array($newsletter_query);\n\n    $nInfo = new objectInfo($newsletter);\n    ?>\n\n    <table class=\"table table-striped\">\n      <tr>\n        <th class=\"w-25\"><?php echo TEXT_TITLE; ?></th>\n        <td><?php echo $nInfo->title; ?></td>\n      </tr>\n      <tr>\n        <th><?php echo TEXT_CONTENT; ?></th>\n        <td><?php echo nl2br($nInfo->content); ?></td>\n      </tr>\n    </table>\n\n    <div class=\"buttonSet\">\n      <?php\n      echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left',  tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID']), 'primary', null, 'btn-light');\n      ?>\n    </div>\n\n<?php\n  } elseif ($action == 'send') {\n    $nID = tep_db_prepare_input($_GET['nID']);\n\n    $newsletter_query = tep_db_query(\"select title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n    $newsletter = tep_db_fetch_array($newsletter_query);\n\n    $nInfo = new objectInfo($newsletter);\n\n    include('includes/languages/' . $language . '/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    include('includes/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    $module_name = $nInfo->module;\n    $module = new $module_name($nInfo->title, $nInfo->content);\n\n    if ($module->show_choose_audience) {\n      echo $module->choose_audience();\n    }\n    else {\n      echo $module->confirm();\n    }\n  } elseif ($action == 'confirm') {\n    $nID = tep_db_prepare_input($_GET['nID']);\n\n    $newsletter_query = tep_db_query(\"select title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n    $newsletter = tep_db_fetch_array($newsletter_query);\n\n    $nInfo = new objectInfo($newsletter);\n\n    include('includes/languages/' . $language . '/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    include('includes/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    $module_name = $nInfo->module;\n    $module = new $module_name($nInfo->title, $nInfo->content);\n\n    echo $module->confirm();\n  } elseif ($action == 'confirm_send') {\n    $nID = tep_db_prepare_input($_GET['nID']);\n\n    $newsletter_query = tep_db_query(\"select newsletters_id, title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n    $newsletter = tep_db_fetch_array($newsletter_query);\n\n    $nInfo = new objectInfo($newsletter);\n\n    include('includes/languages/' . $language . '/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    include('includes/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    $module_name = $nInfo->module;\n    $module = new $module_name($nInfo->title, $nInfo->content);\n?>\n\n  <div class=\"alert alert-info\">\n    <i class=\"fas fa-spinner fa-5x fa-spin float-left mr-4\"></i>\n    <?php echo TEXT_PLEASE_WAIT; ?>\n    <div class=\"clearfix\"></div>\n  </div>\n  \n  <?php\n  tep_set_time_limit(0);\n  flush();\n  $module->send($nInfo->newsletters_id);\n  ?>\n  \n  <div class=\"alert alert-success\">\n    <i class=\"fas fa-thumbs-up fa-5x float-left mr-4\"></i>\n    <?php echo TEXT_FINISHED_SENDING_EMAILS; ?>\n    <div class=\"clearfix\"></div>\n  </div>\n  \n  <div class=\"buttonSet\">\n    <?php\n    echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $_GET['nID']), 'primary', null, 'btn-light mt-2');\n    ?>\n  </div>\n\n<?php\n  } else {\n?>\n\n   <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_NEWSLETTERS; ?></th>\n              <th><?php echo TABLE_HEADING_MODULE; ?></th>\n              <th><?php echo TABLE_HEADING_DATE_ADDED; ?></th>\n              <th><?php echo TABLE_HEADING_SIZE; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_SENT; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n          <?php\n          $newsletters_query_raw = \"select *, length(content) as content_length from newsletters order by date_added desc\";\n          $newsletters_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $newsletters_query_raw, $newsletters_query_numrows);\n          $newsletters_query = tep_db_query($newsletters_query_raw);\n          while ($newsletters = tep_db_fetch_array($newsletters_query)) {\n          if ((!isset($_GET['nID']) || (isset($_GET['nID']) && ($_GET['nID'] == $newsletters['newsletters_id']))) && !isset($nInfo) && (substr($action, 0, 3) != 'new')) {\n              $nInfo = new objectInfo($newsletters);\n            }\n\n            if (isset($nInfo) && is_object($nInfo) && ($newsletters['newsletters_id'] == $nInfo->newsletters_id) ) {\n              echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=preview') . '\\'\">';\n            } else {\n              echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$newsletters['newsletters_id']) . '\\'\">';\n            }\n            ?>\n              <th><?php echo $newsletters['title']; ?></th>\n              <td><?php echo $newsletters['module']; ?></td>\n              <td><?php echo tep_date_short($newsletters['date_added']); ?></td>\n              <td><?php echo number_format($newsletters['content_length']) . ' bytes'; ?></td>\n              <td class=\"text-center\"><?php if ($newsletters['status'] == '1') { echo '<i class=\"fas fa-check-circle text-success\"></i>'; } else { echo '<i class=\"fas fa-times-circle text-danger\"></i>'; } ?></td>\n              <td class=\"text-center\"><?php if ($newsletters['locked'] > 0) { echo '<i class=\"fas fa-lock text-success\"></i>'; } else { echo '<i class=\"fas fa-lock-open text-danger\"></i>'; } ?></td>\n              <td class=\"text-right\"><?php if (isset($nInfo) && is_object($nInfo) && ($newsletters['newsletters_id'] == $nInfo->newsletters_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('newsletters.php', 'page=' . $_GET['page'] . '&nID=' . $newsletters['newsletters_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n            </tr>\n            <?php\n          }\n          ?>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $newsletters_split->display_count($newsletters_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_NEWSLETTERS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $newsletters_split->display_links($newsletters_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'delete':\n      $heading[] = ['text' => $nInfo->title];\n\n      $contents = ['form' => tep_draw_form('newsletters', 'newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['text' => '<strong>' . $nInfo->title . '</strong>'];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$_GET['nID']), null, null, 'btn-light')];\n      break;\n    default:\n      if (isset($nInfo) && is_object($nInfo)) {\n        $heading[] = ['text' => $nInfo->title];\n\n        if ($nInfo->locked > 0) {\n          $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=new'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_PREVIEW, 'fas fa-eye', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=preview'), null, null, 'btn-info xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_SEND, 'fas fa-paper-plane', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=send'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_UNLOCK, 'fas fa-lock-open', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=unlock'), null, null, 'btn-warning')];\n        } else {\n          $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_PREVIEW, 'fas fa-eye', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=preview'), null, null, 'bt-info xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_LOCK, 'fas fa-lock', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=lock'), null, null, 'btn-warning')];\n        }\n        $contents[] = ['text' => sprintf(TEXT_NEWSLETTER_DATE_ADDED, tep_date_short($nInfo->date_added))];\n        if ($nInfo->status == '1') $contents[] = ['text' => sprintf(TEXT_NEWSLETTER_DATE_SENT, tep_date_short($nInfo->date_sent))];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  }\n\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2013 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('orders_status', 'PreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n      case 'save':\n        if (isset($_GET['oID'])) $orders_status_id = tep_db_prepare_input($_GET['oID']);\n\n        $languages = tep_get_languages();\n        for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n          $orders_status_name_array = $_POST['orders_status_name'];\n          $language_id = $languages[$i]['id'];\n\n          $sql_data_array = ['orders_status_name' => tep_db_prepare_input($orders_status_name_array[$language_id]),\n                             'public_flag' => ((isset($_POST['public_flag']) && ($_POST['public_flag'] == '1')) ? '1' : '0'),\n                             'downloads_flag' => ((isset($_POST['downloads_flag']) && ($_POST['downloads_flag'] == '1')) ? '1' : '0')];\n\n          if ($action == 'insert') {\n            if (empty($orders_status_id)) {\n              $next_id_query = tep_db_query(\"select max(orders_status_id) as orders_status_id from orders_status\");\n              $next_id = tep_db_fetch_array($next_id_query);\n              $orders_status_id = $next_id['orders_status_id'] + 1;\n            }\n\n            $insert_sql_data = ['orders_status_id' => $orders_status_id, 'language_id' => $language_id];\n\n            $sql_data_array = array_merge($sql_data_array, $insert_sql_data);\n\n            tep_db_perform('orders_status', $sql_data_array);\n          } elseif ($action == 'save') {\n            tep_db_perform('orders_status', $sql_data_array, 'update', \"orders_status_id = '\" . (int)$orders_status_id . \"' and language_id = '\" . (int)$language_id . \"'\");\n          }\n        }\n\n        if (isset($_POST['default']) && ($_POST['default'] == 'on')) {\n          tep_db_query(\"update configuration set configuration_value = '\" . tep_db_input($orders_status_id) . \"' where configuration_key = 'DEFAULT_ORDERS_STATUS_ID'\");\n        }\n        \n        $OSCOM_Hooks->call('orders_status', 'InsertSave');\n\n        tep_redirect(tep_href_link('orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $orders_status_id));\n        break;\n      case 'deleteconfirm':\n        $oID = tep_db_prepare_input($_GET['oID']);\n\n        $orders_status_query = tep_db_query(\"select configuration_value from configuration where configuration_key = 'DEFAULT_ORDERS_STATUS_ID'\");\n        $orders_status = tep_db_fetch_array($orders_status_query);\n\n        if ($orders_status['configuration_value'] == $oID) {\n          tep_db_query(\"update configuration set configuration_value = '' where configuration_key = 'DEFAULT_ORDERS_STATUS_ID'\");\n        }\n\n        tep_db_query(\"delete from orders_status where orders_status_id = '\" . tep_db_input($oID) . \"'\");\n        \n        $OSCOM_Hooks->call('orders_status', 'DeleteConfirm');\n\n        tep_redirect(tep_href_link('orders_status.php', 'page=' . $_GET['page']));\n        break;\n      case 'delete':\n        $oID = tep_db_prepare_input($_GET['oID']);\n\n        $status_query = tep_db_query(\"select count(*) as count from orders where orders_status = '\" . (int)$oID . \"'\");\n        $status = tep_db_fetch_array($status_query);\n\n        $remove_status = true;\n        if ($oID == DEFAULT_ORDERS_STATUS_ID) {\n          $remove_status = false;\n          $messageStack->add(ERROR_REMOVE_DEFAULT_ORDER_STATUS, 'error');\n        } elseif ($status['count'] > 0) {\n          $remove_status = false;\n          $messageStack->add(ERROR_STATUS_USED_IN_ORDERS, 'error');\n        } else {\n          $history_query = tep_db_query(\"select count(*) as count from orders_status_history where orders_status_id = '\" . (int)$oID . \"'\");\n          $history = tep_db_fetch_array($history_query);\n          if ($history['count'] > 0) {\n            $remove_status = false;\n            $messageStack->add(ERROR_STATUS_USED_IN_HISTORY, 'error');\n          }\n        }\n        \n        $OSCOM_Hooks->call('orders_status', 'Delete');\n        \n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('orders_status', 'PostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_INSERT, 'fas fa-cogs', tep_href_link('orders_status.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('orders_status.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_ORDERS_STATUS; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_PUBLIC_STATUS; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_DOWNLOADS_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $orders_status_query_raw = \"select * from orders_status where language_id = '\" . (int)$languages_id . \"' order by orders_status_id\";\n            $orders_status_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $orders_status_query_raw, $orders_status_query_numrows);\n            $orders_status_query = tep_db_query($orders_status_query_raw);\n            while ($orders_status = tep_db_fetch_array($orders_status_query)) {\n              if ((!isset($_GET['oID']) || (isset($_GET['oID']) && ($_GET['oID'] == $orders_status['orders_status_id']))) && !isset($oInfo) && (substr($action, 0, 3) != 'new')) {\n                $oInfo = new objectInfo($orders_status);\n              }\n\n              if (isset($oInfo) && is_object($oInfo) && ($orders_status['orders_status_id'] == $oInfo->orders_status_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $oInfo->orders_status_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $orders_status['orders_status_id']) . '\\'\">';\n              }\n\n              if (DEFAULT_ORDERS_STATUS_ID == $orders_status['orders_status_id']) {\n                echo '<th>' . $orders_status['orders_status_name'] . ' (' . TEXT_DEFAULT . ')</th>';\n              } else {\n                echo '<td>' . $orders_status['orders_status_name'] . '</td>';\n              }\n              ?>\n                <td class=\"text-center\"><?php echo ($orders_status['public_flag'] == '1') ? '<i class=\"fas fa-check-circle text-success\"></i>' : '<i class=\"fas fa-times-circle text-danger\"></i>'; ?></td>\n                <td class=\"text-center\"><?php echo ($orders_status['downloads_flag'] == '1') ? '<i class=\"fas fa-check-circle text-success\"></i>' : '<i class=\"fas fa-times-circle text-danger\"></i>'; ?></td>\n                <td class=\"text-right\"><?php if (isset($oInfo) && is_object($oInfo) && ($orders_status['orders_status_id'] == $oInfo->orders_status_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $orders_status['orders_status_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $orders_status_split->display_count($orders_status_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_ORDERS_STATUS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $orders_status_split->display_links($orders_status_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_ORDERS_STATUS];\n\n      $contents = ['form' => tep_draw_form('status', 'orders_status.php', 'page=' . $_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n\n      $orders_status_inputs_string = '';\n      $languages = tep_get_languages();\n      for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n        $orders_status_inputs_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('orders_status_name[' . $languages[$i]['id'] . ']') . '</div>';\n      }\n\n      $contents[] = ['text' => TEXT_INFO_ORDERS_STATUS_NAME . $orders_status_inputs_string];\n      $contents[] = ['text' => tep_draw_checkbox_field('public_flag', '1') . ' ' . TEXT_SET_PUBLIC_STATUS];\n      $contents[] = ['text' => tep_draw_checkbox_field('downloads_flag', '1') . ' ' . TEXT_SET_DOWNLOADS_STATUS];\n      $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_SET_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('orders_status.php', 'page=' . $_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_ORDERS_STATUS];\n\n      $contents = ['form' => tep_draw_form('status', 'orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $oInfo->orders_status_id  . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n\n      $orders_status_inputs_string = '';\n      $languages = tep_get_languages();\n      for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n        $orders_status_inputs_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('orders_status_name[' . $languages[$i]['id'] . ']', tep_get_orders_status_name($oInfo->orders_status_id, $languages[$i]['id'])) . '</div>';\n      }\n\n      $contents[] = ['text' => TEXT_INFO_ORDERS_STATUS_NAME . $orders_status_inputs_string];\n      $contents[] = ['text' => tep_draw_checkbox_field('public_flag', '1', $oInfo->public_flag) . ' ' . TEXT_SET_PUBLIC_STATUS];\n      $contents[] = ['text' => tep_draw_checkbox_field('downloads_flag', '1', $oInfo->downloads_flag) . ' ' . TEXT_SET_DOWNLOADS_STATUS];\n      if (DEFAULT_ORDERS_STATUS_ID != $oInfo->orders_status_id) $contents[] = ['text' => '<br>' . tep_draw_checkbox_field('default') . ' ' . TEXT_SET_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $oInfo->orders_status_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_ORDERS_STATUS];\n\n      $contents = ['form' => tep_draw_form('status', 'orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $oInfo->orders_status_id  . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $oInfo->orders_status_name];\n      if ($remove_status) $contents[] = ['class' => 'text-center', 'text' => '<br>' . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, null, null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $oInfo->orders_status_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (isset($oInfo) && is_object($oInfo)) {\n        $heading[] = ['text' => $oInfo->orders_status_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs',  tep_href_link('orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $oInfo->orders_status_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('orders_status.php', 'page=' . $_GET['page'] . '&oID=' . $oInfo->orders_status_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n\n        $orders_status_inputs_string = '';\n        $languages = tep_get_languages();\n        for ($i = 0, $n = sizeof($languages); $i < $n; $i++) {\n          $orders_status_inputs_string .= '<br>' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '&nbsp;' . tep_get_orders_status_name($oInfo->orders_status_id, $languages[$i]['id']);\n        }\n\n        $contents[] = ['text' => $orders_status_inputs_string];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n  \n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('reviews', 'reviewPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'setflag':\n        tep_set_review_status($_GET['rID'], $_GET['flag']);\n        \n        $OSCOM_Hooks->call('reviews', 'reviewActionStatus');\n\n        tep_redirect(tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $_GET['rID']));\n        break;\n      case 'update':\n        $reviews_id = tep_db_prepare_input($_GET['rID']);\n        $reviews_rating = tep_db_prepare_input($_POST['reviews_rating']);\n        $reviews_text = tep_db_prepare_input($_POST['reviews_text']);\n        $reviews_status = tep_db_prepare_input($_POST['reviews_status']);\n\n        tep_db_query(\"update reviews set reviews_rating = '\" . tep_db_input($reviews_rating) . \"', reviews_status = '\" . tep_db_input($reviews_status) . \"', last_modified = now() where reviews_id = '\" . (int)$reviews_id . \"'\");\n        tep_db_query(\"update reviews_description set reviews_text = '\" . tep_db_input($reviews_text) . \"' where reviews_id = '\" . (int)$reviews_id . \"'\");\n        \n        $OSCOM_Hooks->call('reviews', 'reviewActionUpdate');\n\n        tep_redirect(tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $reviews_id));\n        break;\n      case 'deleteconfirm':\n        $reviews_id = tep_db_prepare_input($_GET['rID']);\n\n        tep_db_query(\"delete from reviews where reviews_id = '\" . (int)$reviews_id . \"'\");\n        tep_db_query(\"delete from reviews_description where reviews_id = '\" . (int)$reviews_id . \"'\");\n        \n        $OSCOM_Hooks->call('reviews', 'reviewActionDelete');\n\n        tep_redirect(tep_href_link('reviews.php', 'page=' . $_GET['page']));\n        break;\n      case 'addnew':\n        $products_id = tep_db_prepare_input($_POST['products_id']);\n        $customers_id = tep_db_prepare_input($_POST['customer_id']);\n        $review = tep_db_prepare_input($_POST['reviews_text']);\n        $rating = tep_db_prepare_input($_POST['reviews_rating']);\n\n        tep_db_query(\"insert into reviews (products_id, customers_id, customers_name, reviews_rating, date_added, reviews_status) values ('\" . (int)$products_id . \"', '\" . (int)$customers_id . \"', '\" . tep_customers_name($customers_id) . \"', '\" . (int)$rating . \"', now(), 1)\");\n        $insert_id = tep_db_insert_id();\n        tep_db_query(\"insert into reviews_description (reviews_id, languages_id, reviews_text) values ('\" . (int)$insert_id . \"', '\" . (int)$languages_id . \"', '\" . $review . \"')\");\n        \n        $OSCOM_Hooks->call('reviews', 'reviewActionSave');\n\n        tep_redirect(tep_href_link('reviews.php', tep_get_all_get_params(['action'])));\n        break;   \n    }\n  }\n  \n  $OSCOM_Hooks->call('reviews', 'reviewPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_BUTTON_ADD_REVIEW, 'fas fa-star', tep_href_link('reviews.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else if ($action == \"new\") {\n        echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('reviews.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n\n  <?php\n  if ( ($action == 'new') || ($action == 'edit') ) {\n    $form_action = 'addnew';\n    if ( ($action == 'edit') && isset($_GET['rID']) ) {\n      $form_action = 'preview';\n\n      $rID = tep_db_prepare_input($_GET['rID']);\n\n      $reviews_query = tep_db_query(\"select r.*, rd.* from reviews r, reviews_description rd where r.reviews_id = '\" . (int)$rID . \"' and r.reviews_id = rd.reviews_id\");\n      $reviews = tep_db_fetch_array($reviews_query);\n\n      $products_query = tep_db_query(\"select products_image from products where products_id = '\" . (int)$reviews['products_id'] . \"'\");\n      $products = tep_db_fetch_array($products_query);\n\n      $products_name_query = tep_db_query(\"select products_name from products_description where products_id = '\" . (int)$reviews['products_id'] . \"' and language_id = '\" . (int)$languages_id . \"'\");\n      $products_name = tep_db_fetch_array($products_name_query);\n\n      $rInfo_array = array_merge($reviews, $products, $products_name);\n      $rInfo = new objectInfo($rInfo_array);\n\n      if (!isset($rInfo->reviews_status)) $rInfo->reviews_status = '1';\n      switch ($rInfo->reviews_status) {\n        case '0': $in_status = false; $out_status = true; break;\n        case '1':\n        default: $in_status = true; $out_status = false;\n      }\n    } else {\n      $rInfo = new objectInfo([]);\n    }\n    \n    if ($form_action == 'preview') {\n      echo tep_draw_form('review', 'reviews.php', 'page=' . $_GET['page'] . '&rID=' . $_GET['rID'] . '&action=' . $form_action);\n      echo tep_draw_hidden_field('reviews_id', $rInfo->reviews_id) . tep_draw_hidden_field('reviews_status', $rInfo->reviews_status) . tep_draw_hidden_field('products_id', $rInfo->products_id) . tep_draw_hidden_field('products_image', $rInfo->products_image) . tep_draw_hidden_field('date_added', $rInfo->date_added); \n    } else {\n      echo tep_draw_form('review', 'reviews.php', 'action=' . $form_action);\n    }\n?>\n    <div class=\"form-group row\">\n      <label for=\"reviewProduct\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_PRODUCT; ?></label>\n      <div class=\"col-sm-9\">\n        <?php \n        if (isset($rInfo->products_name)) { \n          echo tep_draw_input_field('products_name', $rInfo->products_name, 'readonly class=\"form-control-plaintext\"'); \n        } \n        else { \n          echo tep_draw_products('products_id', 'id=\"reviewProduct\" class=\"form-control\" required aria-required=\"true\"'); \n        } \n        ?>     \n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"reviewCustomer\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM; ?></label>\n      <div class=\"col-sm-9\">\n        <?php \n        if (isset($rInfo->customers_name)) { \n          echo tep_draw_input_field('customers_name', $rInfo->customers_name, 'readonly class=\"form-control-plaintext\"'); \n        } \n        else { \n          echo tep_draw_customers('customer_id', 'id=\"reviewCustomer\" class=\"form-control\" required aria-required=\"true\"'); \n        } \n        ?>     \n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"reviewRating\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_RATING; ?></label>\n      <div class=\"col-sm-9\"><div class=\"form-check form-check-inline\">\n        <label class=\"form-check-label font-weight-bold text-danger mr-1\" for=\"rating_1\"><?php echo TEXT_BAD; ?></label>\n        <?php \n        for ($i=1; $i<=5; $i++) { \n          echo tep_draw_selection_field('reviews_rating', 'radio', $i, (isset($rInfo->reviews_rating)?(($i == $rInfo->reviews_rating) ? true : false) : ($i == 5) ? true : false), 'class=\"form-check-input\" id=\"rating_' . $i . '\"'); \n        } \n        ?>\n        <label class=\"form-check-label font-weight-bold text-danger\" for=\"rating_5\"><?php echo TEXT_GOOD; ?></label></div>   \n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"reviewReview\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_REVIEW; ?></label>\n      <div class=\"col-sm-9\"><?php echo tep_draw_textarea_field('reviews_text', null, null, '5', $rInfo->reviews_text ?? '', 'class=\"form-control\" required aria-required=\"true\"') . ENTRY_REVIEW_TEXT; ?>     \n      </div>\n    </div>\n\n    <?php\n    echo $OSCOM_Hooks->call('reviews', 'reviewFormEdit');\n    echo $OSCOM_Hooks->call('reviews', 'reviewFormNew');\n    ?>\n \n    <div class=\"text-right\">\n      <?php \n      if ($action != 'new') {\n        echo tep_draw_bootstrap_button(IMAGE_PREVIEW, 'fas fa-eye', null, null, null, 'btn-info mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $_GET['rID']), null, null, 'btn-light');\n      } else {\n        echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2');\n      }\n      ?>\n    </div>\n    \n  </form>\n<?php\n  } elseif ($action == 'preview') {\n    if (tep_not_null($_POST)) {\n      $rInfo = new objectInfo($_POST);\n      echo tep_draw_form('update', 'reviews.php', 'page=' . $_GET['page'] . '&rID=' . $_GET['rID'] . '&action=update', 'post', 'enctype=\"multipart/form-data\"');\n    } else {\n      $rID = tep_db_prepare_input($_GET['rID']);\n\n      $reviews_query = tep_db_query(\"select r.*, rd.* from reviews r, reviews_description rd where r.reviews_id = '\" . (int)$rID . \"' and r.reviews_id = rd.reviews_id\");\n      $reviews = tep_db_fetch_array($reviews_query);\n\n      $products_query = tep_db_query(\"select products_image from products where products_id = '\" . (int)$reviews['products_id'] . \"'\");\n      $products = tep_db_fetch_array($products_query);\n\n      $products_name_query = tep_db_query(\"select products_name from products_description where products_id = '\" . (int)$reviews['products_id'] . \"' and language_id = '\" . (int)$languages_id . \"'\");\n      $products_name = tep_db_fetch_array($products_name_query);\n\n      $rInfo_array = array_merge($reviews, $products, $products_name);\n      $rInfo = new objectInfo($rInfo_array);\n    }\n?>\n    <div class=\"row\">\n      <div class=\"col-sm-10\">\n        <div class=\"form-group row\">\n          <label for=\"reviewProduct\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_PRODUCT; ?></label>\n          <div class=\"col-sm-9\"><?php echo $rInfo->products_name; ?></div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label for=\"reviewCustomer\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM; ?></label>\n          <div class=\"col-sm-9\"><?php echo $rInfo->customers_name; ?></div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label for=\"reviewDate\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_DATE; ?></label>\n          <div class=\"col-sm-9\"><?php echo tep_date_short($rInfo->date_added); ?></div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label for=\"reviewRating\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_RATING; ?></label>\n          <div class=\"col-sm-9\"><?php echo tep_draw_stars($rInfo->reviews_rating); ?></div>   \n        </div>\n\n        <div class=\"form-group row\">\n          <label for=\"reviewReview\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_REVIEW; ?></label>\n          <div class=\"col-sm-9\"><?php echo $rInfo->reviews_text; ?></div>\n        </div>\n      </div>\n      <div class=\"col-sm-2 text-right\"><?php echo tep_image(HTTP_CATALOG_SERVER . DIR_WS_CATALOG_IMAGES . $rInfo->products_image, $rInfo->products_name, SMALL_IMAGE_WIDTH, SMALL_IMAGE_HEIGHT); ?></div>\n    </div>\n\n<?php\n    echo $OSCOM_Hooks->call('reviews', 'reviewFormPreview');\n    \n    if (tep_not_null($_POST)) {\n/* Re-Post all POST'ed variables */\n      foreach($_POST as $key => $value) {\n        echo tep_draw_hidden_field($key, htmlspecialchars(stripslashes($value)));\n      }\n?>\n    <div class=\"text-right\">\n        <?php echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $rInfo->reviews_id), null, null, 'btn-light'); ?>\n    </div>\n  </form>\n<?php\n    } else {\n      if (isset($_GET['origin'])) {\n        $back_url = $_GET['origin'];\n        $back_url_params = '';\n      } else {\n        $back_url = 'reviews.php';\n        $back_url_params = 'page=' . $_GET['page'] . '&rID=' . $rInfo->reviews_id;\n      }\n?>\n    <div class=\"text-right\">\n      <?php echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link($back_url, $back_url_params), null, null, 'btn-light'); ?>\n    </div>\n<?php\n    }\n  } else {\n?>\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_PRODUCTS; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_RATING; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_DATE_ADDED; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $reviews_query_raw = \"select * from reviews order by date_added DESC\";\n            $reviews_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $reviews_query_raw, $reviews_query_numrows);\n            $reviews_query = tep_db_query($reviews_query_raw);\n            while ($reviews = tep_db_fetch_array($reviews_query)) {\n              if ((!isset($_GET['rID']) || (isset($_GET['rID']) && ($_GET['rID'] == $reviews['reviews_id']))) && !isset($rInfo)) {\n                $reviews_text_query = tep_db_query(\"select r.*, rd.*, length(rd.reviews_text) as reviews_text_size from reviews r, reviews_description rd where r.reviews_id = '\" . (int)$reviews['reviews_id'] . \"' and r.reviews_id = rd.reviews_id\");\n                $reviews_text = tep_db_fetch_array($reviews_text_query);\n\n                $products_image_query = tep_db_query(\"select products_image from products where products_id = '\" . (int)$reviews['products_id'] . \"'\");\n                $products_image = tep_db_fetch_array($products_image_query);\n\n                $products_name_query = tep_db_query(\"select products_name from products_description where products_id = '\" . (int)$reviews['products_id'] . \"' and language_id = '\" . (int)$languages_id . \"'\");\n                $products_name = tep_db_fetch_array($products_name_query);\n\n                $reviews_average_query = tep_db_query(\"select (avg(reviews_rating) / 5 * 100) as average_rating from reviews where products_id = '\" . (int)$reviews['products_id'] . \"'\");\n                $reviews_average = tep_db_fetch_array($reviews_average_query);\n\n                $review_info = array_merge($reviews_text, $reviews_average, $products_name);\n                $rInfo_array = array_merge($reviews, $review_info, $products_image);\n                $rInfo = new objectInfo($rInfo_array);\n              }\n\n              if (isset($rInfo) && is_object($rInfo) && ($reviews['reviews_id'] == $rInfo->reviews_id) ) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $rInfo->reviews_id . '&action=preview') . '\\'\">' . \"\\n\";\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $reviews['reviews_id']) . '\\'\">' . \"\\n\";\n              }\n              ?>\n                <td><?php echo tep_get_products_name($reviews['products_id']); ?></td>\n                <td class=\"text-center\"><?php echo tep_draw_stars($reviews['reviews_rating']); ?></td>\n                <td class=\"text-right\"><?php echo tep_date_short($reviews['date_added']); ?></td>\n                <td class=\"text-center\"><?php if ($reviews['reviews_status'] == '1') { echo '<i class=\"fas fa-check-circle text-success\"></i> <a href=\"' . tep_href_link('reviews.php', 'action=setflag&flag=0&rID=' . $reviews['reviews_id'] . '&page=' . $_GET['page']) . '\"><i class=\"fas fa-times-circle text-muted\"></i></a>'; } else { echo '<a href=\"' . tep_href_link('reviews.php', 'action=setflag&flag=1&rID=' . $reviews['reviews_id'] . '&page=' . $_GET['page']) . '\"><i class=\"fas fa-check-circle text-muted\"></i></a> <i class=\"fas fa-times-circle text-danger\"></i>'; } ?></td>\n                <td class=\"text-right\"><?php if (isset($rInfo) && is_object($rInfo) && ($reviews['reviews_id'] == $rInfo->reviews_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $reviews['reviews_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $reviews_split->display_count($reviews_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_REVIEWS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $reviews_split->display_links($reviews_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n    \n<?php\n    $heading = [];\n    $contents = [];\n\n    switch ($action) {\n      case 'delete':\n        $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_REVIEW];\n\n        $contents = ['form' => tep_draw_form('reviews', 'reviews.php', 'page=' . $_GET['page'] . '&rID=' . $rInfo->reviews_id . '&action=deleteconfirm')];\n        $contents[] = ['text' => TEXT_INFO_DELETE_REVIEW_INTRO];\n        $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $rInfo->products_name];\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $rInfo->reviews_id), null, null, 'btn-light')];\n        break;\n      default:\n      if (isset($rInfo) && is_object($rInfo)) {\n        $heading[] = ['text' => $rInfo->products_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $rInfo->reviews_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('reviews.php', 'page=' . $_GET['page'] . '&rID=' . $rInfo->reviews_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_DATE_ADDED, tep_date_short($rInfo->date_added))];\n        if (tep_not_null($rInfo->last_modified)) $contents[] = ['text' => sprintf(TEXT_INFO_LAST_MODIFIED, tep_date_short($rInfo->last_modified))];\n        $contents[] = ['text' => tep_info_image($rInfo->products_image, $rInfo->products_name, SMALL_IMAGE_WIDTH, SMALL_IMAGE_HEIGHT)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_REVIEW_AUTHOR, $rInfo->customers_name)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_REVIEW_RATING, tep_draw_stars($rInfo->reviews_rating))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_REVIEW_READ, $rInfo->reviews_read)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_REVIEW_SIZE, $rInfo->reviews_text_size)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_PRODUCTS_AVERAGE_RATING, number_format($rInfo->average_rating, 2))];\n      }\n        break;\n    }\n\n    if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n      echo '<div class=\"col-12 col-sm-3\">';\n        $box = new box;\n        echo $box->infoBox($heading, $contents);\n      echo '</div>';\n    }\n  echo '</div>';  \n}\n\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2019 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  require('includes/classes/currencies.php');\n  $currencies = new currencies();\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('specials', 'specialsPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'setflag':\n        tep_set_specials_status($_GET['id'], $_GET['flag']);\n\n        tep_redirect(tep_href_link('specials.php', (isset($_GET['page']) ? 'page=' . $_GET['page'] . '&' : '') . 'sID=' . $_GET['id']));\n        break;\n      case 'insert':\n        $products_id = tep_db_prepare_input($_POST['products_id']);\n        $products_price = tep_db_prepare_input($_POST['products_price']);\n        $specials_price = tep_db_prepare_input($_POST['specials_price']);\n        $expdate = tep_db_prepare_input($_POST['expdate']);\n\n        if (substr($specials_price, -1) == '%') {\n          $new_special_insert_query = tep_db_query(\"select products_id, products_price from products where products_id = '\" . (int)$products_id . \"'\");\n          $new_special_insert = tep_db_fetch_array($new_special_insert_query);\n\n          $products_price = $new_special_insert['products_price'];\n          $specials_price = ($products_price - (($specials_price / 100) * $products_price));\n        }\n\n        $expires_date = '';\n        if (tep_not_null($expdate)) {\n          $expires_date = substr($expdate, 0, 4) . substr($expdate, 5, 2) . substr($expdate, 8, 2);\n        }\n\n        tep_db_query(\"insert into specials (products_id, specials_new_products_price, specials_date_added, expires_date, status) values ('\" . (int)$products_id . \"', '\" . tep_db_input($specials_price) . \"', now(), \" . (tep_not_null($expires_date) ? \"'\" . tep_db_input($expires_date) . \"'\" : 'null') . \", '1')\");\n        \n        $OSCOM_Hooks->call('specials', 'specialsActionInsert');\n\n        tep_redirect(tep_href_link('specials.php', 'page=' . $_GET['page']));\n        break;\n      case 'update':\n        $specials_id = tep_db_prepare_input($_POST['specials_id']);\n        $products_price = tep_db_prepare_input($_POST['products_price']);\n        $specials_price = tep_db_prepare_input($_POST['specials_price']);\n        $expdate = tep_db_prepare_input($_POST['expdate']);\n\n        if (substr($specials_price, -1) == '%') $specials_price = ($products_price - (($specials_price / 100) * $products_price));\n\n        $expires_date = '';\n        if (tep_not_null($expdate)) {\n          $expires_date = substr($expdate, 0, 4) . substr($expdate, 5, 2) . substr($expdate, 8, 2);\n        }\n\n        tep_db_query(\"update specials set specials_new_products_price = '\" . tep_db_input($specials_price) . \"', specials_last_modified = now(), expires_date = \" . (tep_not_null($expires_date) ? \"'\" . tep_db_input($expires_date) . \"'\" : 'null') . \" where specials_id = '\" . (int)$specials_id . \"'\");\n        \n        $OSCOM_Hooks->call('specials', 'specialsActionUpdate');\n\n        tep_redirect(tep_href_link('specials.php', 'page=' . $_GET['page'] . '&sID=' . $specials_id));\n        break;\n      case 'deleteconfirm':\n        $specials_id = tep_db_prepare_input($_GET['sID']);\n\n        tep_db_query(\"delete from specials where specials_id = '\" . (int)$specials_id . \"'\");\n        \n        $OSCOM_Hooks->call('specials', 'specialsActionDelete');\n\n        tep_redirect(tep_href_link('specials.php', 'page=' . $_GET['page']));\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('specials', 'specialsPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(BUTTON_INSERT_SPECIAL, 'fas fa-funnel-dollar', tep_href_link('specials.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('specials.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n\n<?php\n  if ( ($action == 'new') || ($action == 'edit') ) {\n    $form_action = 'insert';\n    if ( ($action == 'edit') && isset($_GET['sID']) ) {\n      $form_action = 'update';\n\n      $product_query = tep_db_query(\"select p.products_id, pd.products_name, p.products_price, s.specials_new_products_price, s.expires_date from products p, products_description pd, specials s where p.products_id = pd.products_id and pd.language_id = '\" . (int)$languages_id . \"' and p.products_id = s.products_id and s.specials_id = '\" . (int)$_GET['sID'] . \"'\");\n      $product = tep_db_fetch_array($product_query);\n\n      $sInfo = new objectInfo($product);\n    } else {\n      $sInfo = new objectInfo([]);\n\n// create an array of products on special, which will be excluded from the pull down menu of products\n// (when creating a new product on special)\n      $specials_array = [];\n      $specials_query = tep_db_query(\"select p.products_id from products p, specials s where s.products_id = p.products_id\");\n      while ($specials = tep_db_fetch_array($specials_query)) {\n        $specials_array[] = $specials['products_id'];\n      }\n    }\n?>\n\n  <form name=\"new_special\" <?php echo 'action=\"' . tep_href_link('specials.php', tep_get_all_get_params(['action', 'info', 'sID']) . 'action=' . $form_action) . '\"'; ?> method=\"post\">\n  <?php \n  if ($form_action == 'update') echo tep_draw_hidden_field('specials_id', $_GET['sID']); \n  ?>\n  \n    <div class=\"form-group row\">\n      <label for=\"specialProduct\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_SPECIALS_PRODUCT; ?></label>\n      <div class=\"col-sm-9\"><?php if (isset($sInfo->products_name)) { echo tep_draw_input_field('n', $sInfo->products_name . ' (' . $currencies->format($sInfo->products_price) . ')', 'readonly class=\"form-control-plaintext\"'); } else { echo tep_draw_products_pull_down('products_id', 'id=\"specialProduct\" required aria-required=\"true\"', $specials_array); } echo tep_draw_hidden_field('products_price', (isset($sInfo->products_price) ? $sInfo->products_price : '')); ?>     \n      </div>\n    </div>\n    \n    <div class=\"form-group row\">\n      <label for=\"specialPrice\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_SPECIALS_SPECIAL_PRICE; ?></label>\n      <div class=\"col-sm-9\">\n        <?php \n        echo tep_draw_input_field('specials_price', (isset($sInfo->specials_new_products_price) ? $sInfo->specials_new_products_price : ''), 'required aria-required=\"true\" class=\"form-control\" id=\"specialPrice\"', null, 'tel'); \n        ?>    \n      </div>\n    </div>\n    \n    <div class=\"form-group row\">\n      <label for=\"expdate\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_SPECIALS_EXPIRES_DATE; ?></label>\n      <div class=\"col-sm-9\">\n        <?php \n        echo tep_draw_input_field('expdate', (isset($sInfo->expires_date) ? substr($sInfo->expires_date, 0, 4) . '-' . substr($sInfo->expires_date, 5, 2) . '-' . substr($sInfo->expires_date, 8, 2) : ''), 'class=\"form-control\" id=\"expdate\"'); \n        ?>    \n      </div>\n    </div>\n    \n    <div class=\"alert alert-info\">\n      <?php echo TEXT_SPECIALS_PRICE_TIP; ?>\n    </div>\n    \n    <?php \n    echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success btn-block btn-lg');\n    ?>\n\n  </form>\n\n  <script>$('#expdate').datepicker({ dateFormat: 'yy-mm-dd' });</script>\n\n<?php\n  } else {\n?>\n\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_PRODUCTS; ?></th>\n              <th><?php echo TABLE_HEADING_PRODUCTS_PRICE; ?></th>\n              <th><?php echo TABLE_HEADING_SPECIAL_PRICE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $specials_query_raw = \"select p.*, pd.*, s.* from products p, specials s, products_description pd where p.products_id = pd.products_id and pd.language_id = '\" . (int)$languages_id . \"' and p.products_id = s.products_id order by pd.products_name\";\n            $specials_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $specials_query_raw, $specials_query_numrows);\n            $specials_query = tep_db_query($specials_query_raw);\n            while ($specials = tep_db_fetch_array($specials_query)) {\n              if ((!isset($_GET['sID']) || (isset($_GET['sID']) && ($_GET['sID'] == $specials['specials_id']))) && !isset($sInfo)) {\n                $products_query = tep_db_query(\"select products_image from products where products_id = '\" . (int)$specials['products_id'] . \"'\");\n                $products = tep_db_fetch_array($products_query);\n                $sInfo_array = array_merge($specials, $products);\n                $sInfo = new objectInfo($sInfo_array);\n              }\n\n              if (isset($sInfo) && is_object($sInfo) && ($specials['specials_id'] == $sInfo->specials_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . (int)$sInfo->specials_id . '&action=edit') . '\\'\">' . \"\\n\";\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . (int)$specials['specials_id']) . '\\'\">' . \"\\n\";\n              }\n              ?>\n                <td><?php echo $specials['products_name']; ?></td>\n                <td><?php echo $currencies->format($specials['products_price']); ?></td>\n                <td class=\"text-danger\"><?php echo $currencies->format($specials['specials_new_products_price']); ?></td>\n                <td class=\"text-right\"><?php if ($specials['status'] == '1') { echo '<i class=\"fas fa-check-circle text-success\"></i> <a href=\"' . tep_href_link('specials.php', 'action=setflag&flag=0&id=' . (int)$specials['specials_id']) . '\"><i class=\"fas fa-times-circle text-muted\"></i></a>'; } else { echo '<a href=\"' . tep_href_link('specials.php', 'action=setflag&flag=1&id=' . (int)$specials['specials_id']) . '\"><i class=\"fas fa-check-circle text-muted\"></i></a> <i class=\"fas fa-times-circle text-danger\"></i>'; } ?></td>\n                <td class=\"text-right\"><?php if (isset($sInfo) && is_object($sInfo) && ($specials['specials_id'] == $sInfo->specials_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('specials.php', 'page=' . $_GET['page'] . '&sID=' . $specials['specials_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n<?php\n    }\n?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $specials_split->display_count($specials_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_SPECIALS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $specials_split->display_links($specials_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_SPECIALS];\n\n      $contents = ['form' => tep_draw_form('specials', 'specials.php', 'page=' . $_GET['page'] . '&sID=' . $sInfo->specials_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['text' => '<strong>' . $sInfo->products_name . '</strong>'];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('specials.php', 'page=' . $_GET['page'] . '&sID=' . $sInfo->specials_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($sInfo ?? null)) {\n        $heading[] = ['text' => $sInfo->products_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('specials.php', 'page=' . $_GET['page'] . '&sID=' . $sInfo->specials_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('specials.php', 'page=' . $_GET['page'] . '&sID=' . $sInfo->specials_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2')];\n        $contents[] = ['text' => TEXT_INFO_DATE_ADDED . ' ' . tep_date_short($sInfo->specials_date_added)];\n        $contents[] = ['text' => TEXT_INFO_LAST_MODIFIED . ' ' . tep_date_short($sInfo->specials_last_modified)];\n        $contents[] = ['class' => 'text-center', 'text' => tep_info_image($sInfo->products_image, $sInfo->products_name, SMALL_IMAGE_WIDTH, SMALL_IMAGE_HEIGHT)];\n        $contents[] = ['text' => TEXT_INFO_ORIGINAL_PRICE . ' ' . $currencies->format($sInfo->products_price)];\n        $contents[] = ['text' => TEXT_INFO_NEW_PRICE . ' ' . $currencies->format($sInfo->specials_new_products_price)];\n        $contents[] = ['text' => TEXT_INFO_PERCENTAGE . ' ' . number_format(100 - (($sInfo->specials_new_products_price / $sInfo->products_price) * 100)) . '%'];\n\n        $contents[] = ['text' => TEXT_INFO_EXPIRES_DATE . ' <strong>' . tep_date_short($sInfo->expires_date) . '</strong>'];\n        $contents[] = ['text' => TEXT_INFO_STATUS_CHANGE . ' ' . tep_date_short($sInfo->date_status_change)];\n      }\n      break;\n  }\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n  \n  echo '</div>';  \n}\n?>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require 'includes/application_top.php';\n\n  $currencies = new currencies();\n\n  require 'includes/template_top.php';\n?>\n\n  <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n\n  <div class=\"table-responsive\">\n    <table class=\"table table-striped table-hover\">\n      <thead class=\"thead-dark\">\n        <tr>\n          <th><?php echo TABLE_HEADING_NUMBER; ?></th>\n          <th><?php echo TABLE_HEADING_CUSTOMERS; ?></th>\n          <th class=\"text-right\"><?php echo TABLE_HEADING_TOTAL_PURCHASED; ?></th>\n        </tr>\n      </thead>\n      <tbody>\n        <?php\n        $db_tables = $customer_data->build_db_tables(['id', 'name'], 'customers');\n        $customers_query_raw = \"SELECT \" . customer_query::build_columns($db_tables);\n        $customers_query_raw .= \"o.customers_id, sum(op.products_quantity * op.final_price) AS ordersum FROM \" . customer_query::build_joins($db_tables, []);\n        $customers_query_raw .= \", orders_products op, orders o WHERE \" . customer_query::TABLE_ALIASES['customers'];\n        $customers_query_raw .= \".customers_id = o.customers_id AND o.orders_id = op.orders_id GROUP BY o.customers_id ORDER BY ordersum DESC\";\n        $customers_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $customers_query_raw, $customers_query_numrows);\n\n        $row = 0;\n        $customers_query = tep_db_query($customers_query_raw);\n\n        while ($customer = tep_db_fetch_array($customers_query)) {\n          $row++;\n          ?>\n          <tr onclick=\"document.location.href='<?php echo tep_href_link('customers.php', 'cID=' . $customer['customers_id']); ?>'\">\n            <td><?php echo str_pad($row, 2, '0', STR_PAD_LEFT); ?>.</td>\n            <td><?php echo '<a href=\"' . tep_href_link('customers.php', 'cID=' . $customer['customers_id']) . '\">' . $customer_data->get('name', $customer) . '</a>'; ?></td>\n            <td class=\"text-right\"><?php echo $currencies->format($customer['ordersum']); ?>&nbsp;</td>\n          </tr>\n          <?php\n        }\n        ?>\n      </tbody>\n    </table>\n  </div>\n\n  <div class=\"row\">\n    <div class=\"col-sm-6\"><?php echo $customers_split->display_count($customers_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, (int)$_GET['page'], TEXT_DISPLAY_NUMBER_OF_CUSTOMERS); ?></div>\n    <div class=\"col-sm-6 text-sm-right\"><?php echo $customers_split->display_links($customers_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, (int)$_GET['page']); ?></div>\n  </div>\n\n<?php\n  require 'includes/template_bottom.php';\n  require 'includes/application_bottom.php';\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2019 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  require('includes/template_top.php');\n?>\n\n  <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n\n  <div class=\"table-responsive\">\n    <table class=\"table table-striped table-hover\">\n      <thead class=\"thead-dark\">\n        <tr>\n          <th><?php echo TABLE_HEADING_NUMBER; ?></th>\n          <th><?php echo TABLE_HEADING_PRODUCTS; ?></th>\n          <th class=\"text-right\"><?php echo TABLE_HEADING_PURCHASED; ?></th>\n        </tr>\n      </thead>\n      <tbody>\n        <?php\n        if (isset($_GET['page']) && ($_GET['page'] > 1)) $rows = $_GET['page'] * MAX_DISPLAY_SEARCH_RESULTS - MAX_DISPLAY_SEARCH_RESULTS;\n        $products_query_raw = \"select p.products_id, p.products_ordered, pd.products_name from products p, products_description pd where pd.products_id = p.products_id and pd.language_id = '\" . (int)$languages_id. \"' and p.products_ordered > 0 group by pd.products_id order by p.products_ordered DESC, pd.products_name\";\n        $products_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $products_query_raw, $products_query_numrows);\n\n        $rows = 0;\n        $products_query = tep_db_query($products_query_raw);\n        while ($products = tep_db_fetch_array($products_query)) {\n          $rows++;\n          ?>\n          <tr onclick=\"document.location.href='<?php echo tep_href_link('categories.php', 'action=new_product_preview&read=only&pID=' . $products['products_id'] . '&origin=stats_products_purchased.php?page=' . (int)$_GET['page']); ?>'\">\n            <td><?php echo str_pad($rows, 2, '0', STR_PAD_LEFT); ?>.</td>\n            <td><?php echo '<a href=\"' . tep_href_link('categories.php', 'action=new_product_preview&read=only&pID=' . (int)$products['products_id'] . '&origin=stats_products_purchased.php?page=' . (int)$_GET['page']) . '\">' . $products['products_name'] . '</a>'; ?></td>\n            <td class=\"text-right\"><?php echo $products['products_ordered']; ?></td>\n          </tr>\n          <?php\n        }\n        ?>\n      </tbody>\n    </table>\n  </div>\n  \n  <div class=\"row\">\n    <div class=\"col-sm-6\"><?php echo $products_split->display_count($products_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, (int)$_GET['page'], TEXT_DISPLAY_NUMBER_OF_PRODUCTS); ?></div>\n    <div class=\"col-sm-6 text-sm-right\"><?php echo $products_split->display_links($products_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, (int)$_GET['page']); ?></div>\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2019 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  require('includes/template_top.php');\n?>\n\n  <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n\n  <div class=\"table-responsive\">\n    <table class=\"table table-striped table-hover\">\n      <thead class=\"thead-dark\">\n        <tr>\n          <th><?php echo TABLE_HEADING_NUMBER; ?></th>\n          <th><?php echo TABLE_HEADING_PRODUCTS; ?></th>\n          <th class=\"text-right\"><?php echo TABLE_HEADING_VIEWED; ?></th>\n        </tr>\n      </thead>\n      <tbody>\n        <?php\n        if (isset($_GET['page']) && ($_GET['page'] > 1)) $rows = $_GET['page'] * MAX_DISPLAY_SEARCH_RESULTS - MAX_DISPLAY_SEARCH_RESULTS;\n        $rows = 0;\n        $products_query_raw = \"select p.products_id, pd.products_name, pd.products_viewed, l.name from products p, products_description pd, languages l where p.products_id = pd.products_id and l.languages_id = pd.language_id order by pd.products_viewed DESC\";\n        $products_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $products_query_raw, $products_query_numrows);\n        $products_query = tep_db_query($products_query_raw);\n        while ($products = tep_db_fetch_array($products_query)) {\n          $rows++;\n          ?>\n          <tr onclick=\"document.location.href='<?php echo tep_href_link('categories.php', 'action=new_product_preview&read=only&pID=' . (int)$products['products_id'] . '&origin=stats_products_viewed.php?page=' . (int)$_GET['page']); ?>'\">\n            <td><?php echo str_pad($rows, 2, '0', STR_PAD_LEFT); ?>.</td>\n            <td><?php echo '<a href=\"' . tep_href_link('categories.php', 'action=new_product_preview&read=only&pID=' . $products['products_id'] . '&origin=stats_products_viewed.php?page=' . $_GET['page']) . '\">' . $products['products_name'] . '</a> (' . $products['name'] . ')'; ?></td>\n            <td class=\"text-right\"><?php echo $products['products_viewed']; ?></td>\n          </tr>\n          <?php\n        }\n        ?>\n      </tbody>\n    </table>\n  </div>\n  \n  <div class=\"row\">\n    <div class=\"col-sm-6\"><?php echo $products_split->display_count($products_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, (int)$_GET['page'], TEXT_DISPLAY_NUMBER_OF_PRODUCTS); ?></div>\n    <div class=\"col-sm-6 text-sm-right\"><?php echo $products_split->display_links($products_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, (int)$_GET['page']); ?></div>\n  </div>    \n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        $tax_class_title = tep_db_prepare_input($_POST['tax_class_title']);\n        $tax_class_description = tep_db_prepare_input($_POST['tax_class_description']);\n\n        tep_db_query(\"insert into tax_class (tax_class_title, tax_class_description, date_added) values ('\" . tep_db_input($tax_class_title) . \"', '\" . tep_db_input($tax_class_description) . \"', now())\");\n\n        tep_redirect(tep_href_link('tax_classes.php'));\n        break;\n      case 'save':\n        $tax_class_id = tep_db_prepare_input($_GET['tID']);\n        $tax_class_title = tep_db_prepare_input($_POST['tax_class_title']);\n        $tax_class_description = tep_db_prepare_input($_POST['tax_class_description']);\n\n        tep_db_query(\"update tax_class set tax_class_id = '\" . (int)$tax_class_id . \"', tax_class_title = '\" . tep_db_input($tax_class_title) . \"', tax_class_description = '\" . tep_db_input($tax_class_description) . \"', last_modified = now() where tax_class_id = '\" . (int)$tax_class_id . \"'\");\n\n        tep_redirect(tep_href_link('tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $tax_class_id));\n        break;\n      case 'deleteconfirm':\n        $tax_class_id = tep_db_prepare_input($_GET['tID']);\n\n        tep_db_query(\"delete from tax_class where tax_class_id = '\" . (int)$tax_class_id . \"'\");\n\n        tep_redirect(tep_href_link('tax_classes.php', 'page=' . $_GET['page']));\n        break;\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_TAX_CLASS, 'fas fa-funnel-dollar', tep_href_link('tax_classes.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('tax_classes.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_TAX_CLASSES; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $classes_query_raw = \"select * from tax_class order by tax_class_title\";\n            $classes_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $classes_query_raw, $classes_query_numrows);\n            $classes_query = tep_db_query($classes_query_raw);\n            while ($classes = tep_db_fetch_array($classes_query)) {\n              if ((!isset($_GET['tID']) || (isset($_GET['tID']) && ($_GET['tID'] == $classes['tax_class_id']))) && !isset($tcInfo) && (substr($action, 0, 3) != 'new')) {\n                $tcInfo = new objectInfo($classes);\n              }\n\n              if (isset($tcInfo) && is_object($tcInfo) && ($classes['tax_class_id'] == $tcInfo->tax_class_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $classes['tax_class_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $classes['tax_class_title']; ?></td>\n                <td class=\"text-right\"><?php if (isset($tcInfo) && is_object($tcInfo) && ($classes['tax_class_id'] == $tcInfo->tax_class_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $classes['tax_class_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $classes_split->display_count($classes_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_TAX_CLASSES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $classes_split->display_links($classes_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_TAX_CLASS];\n\n      $contents = ['form' => tep_draw_form('classes', 'tax_classes.php', 'page=' . $_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CLASS_TITLE . '<br>' . tep_draw_input_field('tax_class_title')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_CLASS_DESCRIPTION, null) . '<br>' . tep_draw_input_field('tax_class_description')];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, null, null, 'btn-success xxx text-white mr-2') .  tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_classes.php', 'page=' . $_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_TAX_CLASS];\n\n      $contents = ['form' => tep_draw_form('classes', 'tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CLASS_TITLE . '<br>' . tep_draw_input_field('tax_class_title', $tcInfo->tax_class_title)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_CLASS_DESCRIPTION, null) . '<br>' . tep_draw_input_field('tax_class_description', $tcInfo->tax_class_description)];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $tcInfo->tax_class_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_TAX_CLASS];\n\n      $contents = ['form' => tep_draw_form('classes', 'tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $tcInfo->tax_class_title];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $tcInfo->tax_class_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (isset($tcInfo) && is_object($tcInfo)) {\n        $heading[] = ['text' => $tcInfo->tax_class_title];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('tax_classes.php', 'page=' . $_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_DATE_ADDED, tep_date_short($tcInfo->date_added))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_LAST_MODIFIED, tep_date_short($tcInfo->last_modified))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CLASS_DESCRIPTION, $tcInfo->tax_class_description)];\n      }\n      break;\n  }\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        $tax_zone_id = tep_db_prepare_input($_POST['tax_zone_id']);\n        $tax_class_id = tep_db_prepare_input($_POST['tax_class_id']);\n        $tax_rate = tep_db_prepare_input($_POST['tax_rate']);\n        $tax_description = tep_db_prepare_input($_POST['tax_description']);\n        $tax_priority = tep_db_prepare_input($_POST['tax_priority']);\n\n        tep_db_query(\"insert into tax_rates (tax_zone_id, tax_class_id, tax_rate, tax_description, tax_priority, date_added) values ('\" . (int)$tax_zone_id . \"', '\" . (int)$tax_class_id . \"', '\" . tep_db_input($tax_rate) . \"', '\" . tep_db_input($tax_description) . \"', '\" . tep_db_input($tax_priority) . \"', now())\");\n\n        tep_redirect(tep_href_link('tax_rates.php'));\n        break;\n      case 'save':\n        $tax_rates_id = tep_db_prepare_input($_GET['tID']);\n        $tax_zone_id = tep_db_prepare_input($_POST['tax_zone_id']);\n        $tax_class_id = tep_db_prepare_input($_POST['tax_class_id']);\n        $tax_rate = tep_db_prepare_input($_POST['tax_rate']);\n        $tax_description = tep_db_prepare_input($_POST['tax_description']);\n        $tax_priority = tep_db_prepare_input($_POST['tax_priority']);\n\n        tep_db_query(\"update tax_rates set tax_rates_id = '\" . (int)$tax_rates_id . \"', tax_zone_id = '\" . (int)$tax_zone_id . \"', tax_class_id = '\" . (int)$tax_class_id . \"', tax_rate = '\" . tep_db_input($tax_rate) . \"', tax_description = '\" . tep_db_input($tax_description) . \"', tax_priority = '\" . tep_db_input($tax_priority) . \"', last_modified = now() where tax_rates_id = '\" . (int)$tax_rates_id . \"'\");\n\n        tep_redirect(tep_href_link('tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $tax_rates_id));\n        break;\n      case 'deleteconfirm':\n        $tax_rates_id = tep_db_prepare_input($_GET['tID']);\n\n        tep_db_query(\"delete from tax_rates where tax_rates_id = '\" . (int)$tax_rates_id . \"'\");\n\n        tep_redirect(tep_href_link('tax_rates.php', 'page=' . $_GET['page']));\n        break;\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_TAX_RATE, 'fas fa-percent', tep_href_link('tax_rates.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('tax_rates.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_TAX_RATE_PRIORITY; ?></th>\n              <th><?php echo TABLE_HEADING_TAX_CLASS_TITLE; ?></th>\n              <th><?php echo TABLE_HEADING_ZONE; ?></th>\n              <th><?php echo TABLE_HEADING_TAX_RATE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $rates_query_raw = \"select r.*, z.*, tc.* from tax_class tc, tax_rates r left join geo_zones z on r.tax_zone_id = z.geo_zone_id where r.tax_class_id = tc.tax_class_id\";\n            $rates_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $rates_query_raw, $rates_query_numrows);\n            $rates_query = tep_db_query($rates_query_raw);\n            while ($rates = tep_db_fetch_array($rates_query)) {\n              if ((!isset($_GET['tID']) || (isset($_GET['tID']) && ($_GET['tID'] == $rates['tax_rates_id']))) && !isset($trInfo) && (substr($action, 0, 3) != 'new')) {\n                $trInfo = new objectInfo($rates);\n              }\n\n              if (isset($trInfo) && is_object($trInfo) && ($rates['tax_rates_id'] == $trInfo->tax_rates_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $trInfo->tax_rates_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $rates['tax_rates_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $rates['tax_priority']; ?></td>\n                <td><?php echo $rates['tax_class_title']; ?></td>\n                <td><?php echo $rates['geo_zone_name']; ?></td>\n                <td><?php echo tep_display_tax_value($rates['tax_rate']); ?>%</td>\n                <td class=\"text-right\"><?php if (isset($trInfo) && is_object($trInfo) && ($rates['tax_rates_id'] == $trInfo->tax_rates_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $rates['tax_rates_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n              }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $rates_split->display_count($rates_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_TAX_RATES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $rates_split->display_links($rates_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_TAX_RATE];\n\n      $contents = ['form' => tep_draw_form('rates', 'tax_rates.php', 'page=' . $_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CLASS_TITLE . '<br>' . tep_tax_classes_pull_down('name=\"tax_class_id\" class=\"form-control\"')];\n      $contents[] = ['text' => TEXT_INFO_ZONE_NAME . '<br>' . tep_geo_zones_pull_down('name=\"tax_zone_id\" class=\"form-control\"')];\n      $contents[] = ['text' => TEXT_INFO_TAX_RATE . '<br>' . tep_draw_input_field('tax_rate')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_RATE_DESCRIPTION, null) . '<br>' . tep_draw_input_field('tax_description')];\n      $contents[] = ['text' => TEXT_INFO_TAX_RATE_PRIORITY . '<br>' . tep_draw_input_field('tax_priority')];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_rates.php', 'page=' . $_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_TAX_RATE];\n\n      $contents = ['form' => tep_draw_form('rates', 'tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $trInfo->tax_rates_id  . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CLASS_TITLE . '<br>' . tep_tax_classes_pull_down('name=\"tax_class_id\" class=\"form-control\"', $trInfo->tax_class_id)];\n      $contents[] = ['text' => TEXT_INFO_ZONE_NAME . '<br>' . tep_geo_zones_pull_down('name=\"tax_zone_id\" class=\"form-control\"', $trInfo->geo_zone_id)];\n      $contents[] = ['text' => TEXT_INFO_TAX_RATE . '<br>' . tep_draw_input_field('tax_rate', $trInfo->tax_rate)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_RATE_DESCRIPTION, null) . '<br>' . tep_draw_input_field('tax_description', $trInfo->tax_description)];\n      $contents[] = ['text' => TEXT_INFO_TAX_RATE_PRIORITY . '<br>' . tep_draw_input_field('tax_priority', $trInfo->tax_priority)];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $trInfo->tax_rates_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_TAX_RATE];\n\n      $contents = ['form' => tep_draw_form('rates', 'tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $trInfo->tax_rates_id  . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $trInfo->tax_class_title . ' ' . number_format($trInfo->tax_rate, TAX_DECIMAL_PLACES) . '%'];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $trInfo->tax_rates_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($trInfo)) {\n        $heading[] = ['text' => $trInfo->tax_class_title];\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $trInfo->tax_rates_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('tax_rates.php', 'page=' . $_GET['page'] . '&tID=' . $trInfo->tax_rates_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_DATE_ADDED, tep_date_short($trInfo->date_added))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_LAST_MODIFIED, tep_date_short($trInfo->last_modified))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_RATE_DESCRIPTION, $trInfo->tax_description)];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('testimonials', 'testimonialsPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'setflag':\n        if ( ($_GET['flag'] == '0') || ($_GET['flag'] == '1') ) {\n          if (isset($_GET['tID'])) {\n            tep_db_query(\"update testimonials set testimonials_status = '\" . (int)$_GET['flag'] . \"' where testimonials_id = '\" . (int)$_GET['tID'] . \"'\");\n          }\n        }\n        \n        $OSCOM_Hooks->call('testimonials', 'testimonialsActionSetFlag');\n\n        tep_redirect(tep_href_link('testimonials.php', 'page=' . $_GET['page'] . '&tID=' . $_GET['tID']));\n        break;\n      case 'update':\n        $customers_id = (int)$_POST['customers_id'];\n        $customers_name = tep_db_prepare_input($_POST['customer_name']);\n        $testimonials_id = tep_db_prepare_input($_GET['tID']);\n        $testimonials_text = tep_db_prepare_input($_POST['testimonials_text']);\n        $testimonials_status = tep_db_prepare_input($_POST['testimonials_status']);\n\n        tep_db_query(\"update testimonials set customers_id = '\" . (int)$customers_id . \"', customers_name  = '\" . tep_db_input($customers_name) . \"', testimonials_status = '\" . tep_db_input($testimonials_status) . \"', last_modified = now() where testimonials_id = '\" . (int)$testimonials_id . \"'\");\n        tep_db_query(\"update testimonials_description set testimonials_text = '\" . tep_db_input($testimonials_text) . \"' where testimonials_id = '\" . (int)$testimonials_id . \"'\");\n\n        $OSCOM_Hooks->call('testimonials', 'testimonialsActionUpdate');\n        \n        tep_redirect(tep_href_link('testimonials.php', 'page=' . $_GET['page'] . '&tID=' . $testimonials_id));\n        break;\n      case 'deleteconfirm':\n        $testimonials_id = tep_db_prepare_input($_GET['tID']);\n\n        tep_db_query(\"delete from testimonials where testimonials_id = '\" . (int)$testimonials_id . \"'\");\n        tep_db_query(\"delete from testimonials_description where testimonials_id = '\" . (int)$testimonials_id . \"'\");\n        \n        $OSCOM_Hooks->call('testimonials', 'testimonialsActionDelete');\n\n        tep_redirect(tep_href_link('testimonials.php', 'page=' . $_GET['page']));\n        break;\n        \n      case 'addnew':\n        $customers_id = (int)$_POST['customers_id'];\n        $customers_name = tep_db_prepare_input($_POST['customer_name']);\n        $testimonial = tep_db_prepare_input($_POST['testimonials_text']);\n\n        tep_db_query(\"insert into testimonials (customers_id, customers_name, date_added, testimonials_status) values ('\" . $customers_id . \"', '\" . tep_db_input($customers_name) . \"', now(), 1)\");\n        $insert_id = tep_db_insert_id();\n        tep_db_query(\"insert into testimonials_description (testimonials_id, languages_id, testimonials_text) values ('\" . (int)$insert_id . \"', '\" . (int)$languages_id . \"', '\" . tep_db_input($testimonial) . \"')\");\n        \n        $OSCOM_Hooks->call('testimonials', 'testimonialsActionSave');\n\n        tep_redirect(tep_href_link('testimonials.php', tep_get_all_get_params(array('action'))));\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('testimonials', 'testimonialsPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\"><h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1></div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_BUTTON_ADD_TESTIMONIAL, 'fas fa-pen', tep_href_link('testimonials.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('testimonials.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n\n<?php\n  if ($action == 'edit') {\n    $tID = tep_db_prepare_input($_GET['tID']);\n\n    $testimonials_query = tep_db_query(\"select t.*, td.* from testimonials t, testimonials_description td where t.testimonials_id = '\" . (int)$tID . \"' and t.testimonials_id = td.testimonials_id\");\n    $testimonials = tep_db_fetch_array($testimonials_query);\n\n    $tInfo = new objectInfo($testimonials);\n\n    if (!isset($tInfo->testimonials_status)) $tInfo->testimonials_status = '1';\n    switch ($tInfo->testimonials_status) {\n      case '0': $in_status = false; $out_status = true; break;\n      case '1':\n      default: $in_status = true; $out_status = false;\n    }\n?>\n      <?php echo tep_draw_form('testimonial', 'testimonials.php', 'page=' . $_GET['page'] . '&tID=' . $_GET['tID'] . '&action=update', 'post', 'enctype=\"multipart/form-data\"'); ?>\n        \n        <div class=\"form-group row align-items-center\">\n          <label class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_INFO_TESTIMONIAL_STATUS; ?></label>\n          <div class=\"col-sm-9\">\n            <div class=\"custom-control custom-radio custom-control-inline\">\n              <?php echo tep_draw_selection_field('testimonials_status', 'radio', '1', $in_status, 'id=\"inStatus\" class=\"custom-control-input\"'); ?>\n              <label class=\"custom-control-label\" for=\"inStatus\"><?php echo TEXT_TESTIMONIAL_PUBLISHED; ?></label>\n            </div>\n            <div class=\"custom-control custom-radio custom-control-inline\">\n              <?php echo tep_draw_selection_field('testimonials_status', 'radio', '0', $out_status, 'id=\"outStatus\" class=\"custom-control-input\"'); ?>\n              <label class=\"custom-control-label\" for=\"outStatus\"><?php echo TEXT_TESTIMONIAL_NOT_PUBLISHED; ?></label>\n            </div>    \n          </div>\n        </div>\n          \n        <div class=\"form-group row\">\n          <label for=\"inputFrom\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_customers('customers_id', 'id=\"inputFrom\"', $tInfo->customers_id); ?>\n          </div>\n        </div>\n        \n        <div class=\"form-group row\">\n          <label for=\"inputNick\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM_NICKNAME; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_input_field('customer_name', $tInfo->customers_name, 'required aria-required=\"true\" id=\"inputNick\"'); \n            ?>\n          </div>\n        </div>\n        \n        <div class=\"form-group row\">\n          <label for=\"inputText\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_TESTIMONIAL; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_textarea_field('testimonials_text', 'soft', '60', '15', $tInfo->testimonials_text, 'required aria-required=\"true\" id=\"inputText\"'); ?>\n          </div>\n        </div>\n        \n        <?php\n        echo $OSCOM_Hooks->call('testimonials', 'testimonialsFormEdit');\n\n        echo tep_draw_hidden_field('testimonials_id', $tInfo->testimonials_id);\n        echo tep_draw_hidden_field('customers_name', $tInfo->customers_name);\n        echo tep_draw_hidden_field('date_added', $tInfo->date_added);\n        \n        echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success btn-block btn-lg');\n        ?>\n\n      </form>\n<?php\n  } elseif ($action == 'new') {\n    \n      echo tep_draw_form('review', 'testimonials.php', 'action=addnew', 'post', 'enctype=\"multipart/form-data\"'); \n      ?>\n      \n        <div class=\"form-group row\">\n          <label for=\"inputFrom\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_customers('customers_id', 'id=\"inputFrom\"'); ?>\n          </div>\n        </div>\n        \n        <div class=\"form-group row\">\n          <label for=\"inputNick\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM_NICKNAME; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_input_field('customer_name', '', 'required aria-required=\"true\" id=\"inputNick\"'); \n            ?>\n          </div>\n        </div>\n        \n        <div class=\"form-group row\">\n          <label for=\"inputText\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_TESTIMONIAL; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_textarea_field('testimonials_text', 'soft', '60', '15', '', 'required aria-required=\"true\" id=\"inputText\"'); ?>\n          </div>\n        </div>\n        \n        <?php\n        echo $OSCOM_Hooks->call('testimonials', 'testimonialsFormNew');\n        \n        echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-pen', null, 'primary', null, 'btn-success btn-block btn-lg'); \n        ?>\n\n      </form>\n       <?php\n     } else {\n?>\n      \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_CUSTOMER_ID; ?></th>\n              <th><?php echo TABLE_HEADING_CUSTOMER_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_DATE_ADDED; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $testimonials_query_raw = \"select * from testimonials order by testimonials_id DESC\";\n            $testimonials_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $testimonials_query_raw, $testimonials_query_numrows);\n            $testimonials_query = tep_db_query($testimonials_query_raw);\n            while ($testimonials = tep_db_fetch_array($testimonials_query)) {\n              if ((!isset($_GET['tID']) || (isset($_GET['tID']) && ($_GET['tID'] == $testimonials['testimonials_id']))) && !isset($tInfo)) {\n                $testimonials_text_query = tep_db_query(\"select t.customers_name, td.testimonials_text from testimonials t, testimonials_description td where t.testimonials_id = '\" . (int)$testimonials['testimonials_id'] . \"' and t.testimonials_id = td.testimonials_id\");\n                $testimonials_text = tep_db_fetch_array($testimonials_text_query);\n\n                $tInfo_array = array_merge($testimonials, $testimonials_text);\n                $tInfo = new objectInfo($tInfo_array);\n              }\n\n              if (isset($tInfo) && is_object($tInfo) && ($testimonials['testimonials_id'] == $tInfo->testimonials_id) ) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('testimonials.php', 'page=' . $_GET['page'] . '&tID=' . (int)$tInfo->testimonials_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('testimonials.php', 'page=' . $_GET['page'] . '&tID=' . (int)$testimonials['testimonials_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo (int)$testimonials['customers_id']; ?></td>\n                <td><?php echo $testimonials['customers_name']; ?></td>\n                <td><?php echo tep_date_short($testimonials['date_added']); ?></td>\n                <td class=\"text-center\"><?php\n                if ($testimonials['testimonials_status'] == '1') {\n                  echo '<i class=\"fas fa-check-circle text-success\"></i> <a href=\"' . tep_href_link('testimonials.php', 'action=setflag&flag=0&tID=' . $testimonials['testimonials_id'] . '&page=' . $_GET['page']) . '\"><i class=\"fas fa-times-circle text-muted\"></i></a>';\n                } else {\n                  echo '<a href=\"' . tep_href_link('testimonials.php', 'action=setflag&flag=1&tID=' . $testimonials['testimonials_id'] . '&page=' . $_GET['page']) . '\"><i class=\"fas fa-check-circle text-muted\"></i></a>  <i class=\"fas fa-times-circle text-danger\"></i>';\n                }\n                ?></td>\n                <td class=\"text-right\"><?php if ( (is_object($tInfo)) && ($testimonials['testimonials_id'] == $tInfo->testimonials_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('testimonials.php', 'page=' . $_GET['page'] . '&tID=' . $testimonials['testimonials_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n<?php\n    }\n?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $testimonials_split->display_count($testimonials_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_TESTIMONIALS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $testimonials_split->display_links($testimonials_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n    </div>\n\n<?php\n    $heading = [];\n    $contents = [];\n\n    switch ($action) {\n      case 'delete':\n        $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_TESTIMONIAL];\n\n        $contents = ['form' => tep_draw_form('testimonials', 'testimonials.php', 'page=' . $_GET['page'] . '&tID=' . $tInfo->testimonials_id . '&action=deleteconfirm')];\n        $contents[] = ['text' => TEXT_INFO_DELETE_TESTIMONIAL_INTRO];\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('testimonials.php', 'page=' . $_GET['page'] . '&tID=' . $tInfo->testimonials_id), null, null, 'btn-light')];\n        break;\n      default:\n      if (isset($tInfo) && is_object($tInfo)) {\n        $heading[] = ['text' => $tInfo->customers_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('testimonials.php', 'page=' . $_GET['page'] . '&tID=' . $tInfo->testimonials_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('testimonials.php', 'page=' . $_GET['page'] . '&tID=' . $tInfo->testimonials_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_DATE_ADDED, tep_date_short($tInfo->date_added))];\n        if (tep_not_null($tInfo->last_modified)) $contents[] = ['text' => sprintf(TEXT_INFO_LAST_MODIFIED, tep_date_short($tInfo->last_modified))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_TESTIMONIAL_AUTHOR, $tInfo->customers_name)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_TESTIMONIAL_SIZE, str_word_count($tInfo->testimonials_text))];\n      }\n        break;\n    }\n\n    if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n      echo '<div class=\"col-12 col-sm-3\">';\n        $box = new box;\n        echo $box->infoBox($heading, $contents);\n      echo '</div>';\n    }\n    \n    echo '</div>';\n    \n  }\n\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2010 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        $zone_country_id = tep_db_prepare_input($_POST['zone_country_id']);\n        $zone_code = tep_db_prepare_input($_POST['zone_code']);\n        $zone_name = tep_db_prepare_input($_POST['zone_name']);\n\n        tep_db_query(\"insert into \" . TABLE_ZONES . \" (zone_country_id, zone_code, zone_name) values ('\" . (int)$zone_country_id . \"', '\" . tep_db_input($zone_code) . \"', '\" . tep_db_input($zone_name) . \"')\");\n\n        tep_redirect(tep_href_link('zones.php'));\n        break;\n      case 'save':\n        $zone_id = tep_db_prepare_input($_GET['cID']);\n        $zone_country_id = tep_db_prepare_input($_POST['zone_country_id']);\n        $zone_code = tep_db_prepare_input($_POST['zone_code']);\n        $zone_name = tep_db_prepare_input($_POST['zone_name']);\n\n        tep_db_query(\"update \" . TABLE_ZONES . \" set zone_country_id = '\" . (int)$zone_country_id . \"', zone_code = '\" . tep_db_input($zone_code) . \"', zone_name = '\" . tep_db_input($zone_name) . \"' where zone_id = '\" . (int)$zone_id . \"'\");\n\n        tep_redirect(tep_href_link('zones.php', 'page=' . $_GET['page'] . '&cID=' . $zone_id));\n        break;\n      case 'deleteconfirm':\n        $zone_id = tep_db_prepare_input($_GET['cID']);\n\n        tep_db_query(\"delete from \" . TABLE_ZONES . \" where zone_id = '\" . (int)$zone_id . \"'\");\n\n        tep_redirect(tep_href_link('zones.php', 'page=' . $_GET['page']));\n        break;\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\"><h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1></div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_ZONE, 'fas fa-map-marker-alt', tep_href_link('zones.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('zones.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_COUNTRY_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_ZONE_NAME; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ZONE_CODE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $zones_query_raw = \"select z.zone_id, c.countries_id, c.countries_name, z.zone_name, z.zone_code, z.zone_country_id from \" . TABLE_ZONES . \" z, \" . TABLE_COUNTRIES . \" c where z.zone_country_id = c.countries_id order by c.countries_name, z.zone_name\";\n            $zones_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $zones_query_raw, $zones_query_numrows);\n            $zones_query = tep_db_query($zones_query_raw);\n            while ($zones = tep_db_fetch_array($zones_query)) {\n              if ((!isset($_GET['cID']) || (isset($_GET['cID']) && ($_GET['cID'] == $zones['zone_id']))) && !isset($cInfo) && (substr($action, 0, 3) != 'new')) {\n                $cInfo = new objectInfo($zones);\n              }\n\n              if (isset($cInfo) && is_object($cInfo) && ($zones['zone_id'] == $cInfo->zone_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('zones.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('zones.php', 'page=' . $_GET['page'] . '&cID=' . $zones['zone_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $zones['countries_name']; ?></td>\n                <td><?php echo $zones['zone_name']; ?></td>\n                <td class=\"text-right\"><?php echo $zones['zone_code']; ?></td>\n                <td class=\"text-right\"><?php if (isset($cInfo) && is_object($cInfo) && ($zones['zone_id'] == $cInfo->zone_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('zones.php', 'page=' . $_GET['page'] . '&cID=' . $zones['zone_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n              }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $zones_split->display_count($zones_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_ZONES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $zones_split->display_links($zones_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_ZONE];\n\n      $contents = ['form' => tep_draw_form('zones', 'zones.php', 'page=' . $_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_ZONES_NAME . '<br>' . tep_draw_input_field('zone_name')];\n      $contents[] = ['text' => TEXT_INFO_ZONES_CODE . '<br>' . tep_draw_input_field('zone_code')];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . '<br>' . tep_draw_pull_down_menu('zone_country_id', tep_get_countries())];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('zones.php', 'page=' . $_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_ZONE];\n\n      $contents = ['form' => tep_draw_form('zones', 'zones.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_ZONES_NAME . '<br>' . tep_draw_input_field('zone_name', $cInfo->zone_name)];\n      $contents[] = ['text' => TEXT_INFO_ZONES_CODE . '<br>' . tep_draw_input_field('zone_code', $cInfo->zone_code)];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . '<br>' . tep_draw_pull_down_menu('zone_country_id', tep_get_countries(), $cInfo->countries_id)];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('zones.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->zone_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_ZONE];\n\n      $contents = ['form' => tep_draw_form('zones', 'zones.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['text' => '<strong>' . $cInfo->zone_name . '</strong>'];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('zones.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->zone_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (isset($cInfo) && is_object($cInfo)) {\n        $heading[] = ['text' => $cInfo->zone_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('zones.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('zones.php', 'page=' . $_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => TEXT_INFO_ZONES_NAME . '<br>' . $cInfo->zone_name . ' (' . $cInfo->zone_code . ')'];\n        $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . ' ' . $cInfo->countries_name];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n"], "fixing_code": ["<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  $OSCOM_Hooks->call('advert_manager', 'advertPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'import':\n      $import_query = tep_db_query(\"select * from banners order by banners_id\");\n      while ($import = tep_db_fetch_array($import_query)) {\n        $sql_data_array = ['advert_title'       => $import['banners_title'],\n                           'advert_url'         => $import['banners_url'],\n                           'advert_image'       => $import['banners_image'],\n                           'advert_group'       => $import['banners_group'],\n                           'advert_html_text'   => $import['banners_html_text'],\n                           'date_added'         => $import['date_added'],\n                           'date_status_change' => $import['date_status_change'],\n                           'status'             => $import['status']];\n\n        tep_db_perform('advert', $sql_data_array);\n      }\n\n      $OSCOM_Hooks->call('advert_manager', 'advertActionImport');\n\n      $messageStack->add_session(SUCCESS_BANNERS_IMPORTED, 'success');\n\n      tep_redirect(tep_href_link('advert_manager.php'));\n      break;\n\n      case 'setflag':\n        if ( ($_GET['flag'] == '0') || ($_GET['flag'] == '1') ) {\n          tep_db_query(\"update advert set status = '\" . (int)$_GET['flag'] . \"', date_status_change = now() where advert_id = '\" . (int)$_GET['cID'] . \"'\");\n\n          $messageStack->add_session(SUCCESS_ADVERT_STATUS_UPDATED, 'success');\n        }\n\n        $OSCOM_Hooks->call('advert_manager', 'advertActionSetflag');\n\n        tep_redirect(tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$_GET['cID']));\n        break;\n      case 'insert':\n      case 'update':\n        if (isset($_POST['advert_id'])) $advert_id = tep_db_prepare_input($_POST['advert_id']);\n        $advert_title = tep_db_prepare_input($_POST['advert_title']);\n        $advert_url = tep_db_prepare_input($_POST['advert_url']);\n        $advert_fragment = tep_db_prepare_input($_POST['advert_fragment']);\n\n        $new_advert_group = tep_db_prepare_input($_POST['new_advert_group']);\n        $advert_group = (empty($new_advert_group)) ? tep_db_prepare_input($_POST['advert_group']) : $new_advert_group;\n        $sort_order = tep_db_prepare_input($_POST['sort_order']);\n\n        $advert_html_text = tep_db_prepare_input($_POST['advert_html_text']);\n        $advert_image_local = tep_db_prepare_input($_POST['advert_image_local']);\n        $advert_image_target = tep_db_prepare_input($_POST['advert_image_target']);\n        $db_image_location = '';\n\n        $advert_error = false;\n        if (empty($advert_title)) {\n          $messageStack->add(ERROR_ADVERT_TITLE_REQUIRED, 'error');\n          $advert_error = true;\n        }\n\n        if (empty($advert_group)) {\n          $messageStack->add(ERROR_ADVERT_GROUP_REQUIRED, 'error');\n          $advert_error = true;\n        }\n\n        $advert_image = new upload('advert_image');\n        $advert_image->parse();\n        \n        if (!empty($advert_image->filename)) {\n          $advert_image->set_destination(DIR_FS_CATALOG_IMAGES . $advert_image_target);\n          if ( $advert_image->save() == false ) {\n            $advert_error = true;\n          }\n        }\n        else {\n          if ( empty($advert_image_local) && empty($advert_html_text) ) {\n            $messageStack->add(ERROR_ADVERT_IMAGE_OR_TEXT_REQUIRED, 'error');\n            $advert_error = true;\n          }\n        }\n\n        if ($advert_error == false) {\n          $db_image_location = (tep_not_null($advert_image_local)) ? $advert_image_local : $advert_image_target . $advert_image->filename;\n          $sql_data_array = ['advert_title'     => $advert_title,\n                             'advert_url'       => $advert_url,\n                             'advert_fragment'  => $advert_fragment,\n                             'advert_image'     => $db_image_location,\n                             'advert_group'     => $advert_group,\n                             'sort_order'       => $sort_order,\n                             'advert_html_text' => $advert_html_text];\n\n          if ($action == 'insert') {\n            $insert_sql_data = ['date_added' => 'now()', 'status' => '1'];\n\n            $sql_data_array = array_merge($sql_data_array, $insert_sql_data);\n\n            tep_db_perform('advert', $sql_data_array);\n\n            $advert_id = tep_db_insert_id();\n\n            $messageStack->add_session(SUCCESS_IMAGE_INSERTED, 'success');\n          } elseif ($action == 'update') {\n            tep_db_perform('advert', $sql_data_array, 'update', \"advert_id = '\" . (int)$advert_id . \"'\");\n\n            $messageStack->add_session(SUCCESS_IMAGE_UPDATED, 'success');\n          }\n\n          $OSCOM_Hooks->call('advert_manager', 'advertActionSave');\n\n          tep_redirect(tep_href_link('advert_manager.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'cID=' . $advert_id));\n        } else {\n          $action = 'new';\n        }\n        break;\n      case 'deleteconfirm':\n        $advert_id = tep_db_prepare_input($_GET['cID']);\n\n        if (isset($_POST['delete_image']) && ($_POST['delete_image'] == 'on')) {\n          $advert_query = tep_db_query(\"select advert_image from advert where advert_id = '\" . (int)$advert_id . \"'\");\n          $advert = tep_db_fetch_array($advert_query);\n\n          if (is_file(DIR_FS_CATALOG_IMAGES . $advert['advert_image'])) {\n            if (tep_is_writable(DIR_FS_CATALOG_IMAGES . $advert['advert_image'])) {\n              unlink(DIR_FS_CATALOG_IMAGES . $advert['advert_image']);\n            } else {\n              $messageStack->add_session(ERROR_IMAGE_IS_NOT_WRITEABLE, 'error');\n            }\n          } else {\n            $messageStack->add_session(ERROR_IMAGE_DOES_NOT_EXIST, 'error');\n          }\n        }\n\n        tep_db_query(\"delete from advert where advert_id = '\" . (int)$advert_id . \"'\");\n\n        $OSCOM_Hooks->call('advert_manager', 'advertActionDelete');\n\n        $messageStack->add_session(SUCCESS_IMAGE_REMOVED, 'success');\n\n        tep_redirect(tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n\n  $OSCOM_Hooks->call('advert_manager', 'advertPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (isset($_GET['action']) && ($_GET['action'] == 'new')) {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('advert_manager.php'), null, null, 'btn-light');\n      } else {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_ADVERT, 'fas fa-map-marker-alt', tep_href_link('advert_manager.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      ?>\n    </div>\n  </div>\n\n<?php\n  if ($action == 'new') {\n    $form_action = 'insert';\n\n    $parameters = ['advert_title' => '', 'advert_url' => '', 'advert_fragment' => '', 'advert_group' => '', 'advert_image' => '', 'sort_order' => '', 'advert_html_text' => ''];\n\n    $cInfo = new objectInfo($parameters);\n\n    if (isset($_GET['cID'])) {\n      $form_action = 'update';\n\n      $cID = tep_db_prepare_input($_GET['cID']);\n\n      $advert_query = tep_db_query(\"select * from advert where advert_id = '\" . (int)$cID . \"'\");\n      $advert = tep_db_fetch_array($advert_query);\n\n      $cInfo->objectInfo($advert);\n    } elseif (tep_not_null($_POST)) {\n      $cInfo->objectInfo($_POST);\n    }\n\n    $groups_array = [];\n    $groups_query = tep_db_query(\"select distinct advert_group from advert order by advert_group\");\n    while ($groups = tep_db_fetch_array($groups_query)) {\n      $groups_array[] = ['id' => $groups['advert_group'], 'text' => $groups['advert_group']];\n    }\n\n    echo tep_draw_form('new_advert', 'advert_manager.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'action=' . $form_action, 'post', 'enctype=\"multipart/form-data\"'); if ($form_action == 'update') echo tep_draw_hidden_field('advert_id', $cID);\n    ?>\n\n      <div class=\"form-group row\">\n        <label for=\"cTitle\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_TITLE; ?></label>\n        <div class=\"col-sm-9\">\n          <?php echo tep_draw_input_field('advert_title', $cInfo->advert_title, 'class=\"form-control\" id=\"cTitle\" required aria-required=\"true\" aria-describedby=\"TitleHelp\"'); ?>\n          <small id=\"TitleHelp\" class=\"form-text text-muted\"><?php echo TEXT_ADVERT_TITLE_HELP; ?></small>\n        </div>\n      </div>\n\n      <div class=\"form-group row\">\n        <label for=\"cUrl\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_URL; ?></label>\n        <div class=\"col-sm-9\">\n          <div class=\"row\">\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('advert_url', $cInfo->advert_url, 'class=\"form-control\" id=\"cUrl\" aria-describedby=\"URLHelp\"'); ?>\n              <small id=\"URLHelp\" class=\"form-text text-muted\"><?php echo TEXT_ADVERT_URL_HELP; ?></small>\n            </div>\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('advert_fragment', $cInfo->advert_fragment, 'placeholder=\"' . TEXT_ADVERT_FRAGMENT . '\" class=\"form-control\" id=\"cFrag\" aria-describedby=\"FragmentHelp\"'); ?>\n              <small id=\"FragmentHelp\" class=\"form-text text-muted\"><?php echo TEXT_ADVERT_FRAGMENT_HELP; ?></small>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"form-group row\">\n        <label for=\"cSort\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_SORT_ORDER; ?></label>\n        <div class=\"col-sm-9\">\n          <?php echo tep_draw_input_field('sort_order', $cInfo->sort_order, 'class=\"form-control w-25\" id=\"cSort\" aria-describedby=\"SortHelp\"'); ?>\n          <small id=\"SortHelp\" class=\"form-text text-muted\"><?php echo TEXT_ADVERT_SORT_HELP; ?></small>\n        </div>\n      </div>\n\n      <hr>\n\n      <div class=\"form-group row\">\n        <label for=\"cGroup\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_GROUP; ?></label>\n        <div class=\"col-sm-9\">\n          <div class=\"row\">\n            <div class=\"col\">\n              <?php echo tep_draw_pull_down_menu('advert_group', $groups_array, $cInfo->advert_group, 'id=\"cGroup\" class=\"form-control\"'); ?>\n            </div>\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('new_advert_group', '', 'placeholder=\"' . TEXT_ADVERT_NEW_GROUP . '\" class=\"form-control\" id=\"cNewGroup\"'); ?>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <hr>\n\n      <div class=\"form-group row\">\n        <label for=\"cImage\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_IMAGE; ?></label>\n        <div class=\"col-sm-9\">\n          <div class=\"row\">\n            <div class=\"col\">\n              <div class=\"custom-file mb-2\">\n                <?php echo tep_draw_input_field('advert_image', '', 'id=\"advert_image\"', 'file', null, 'class=\"form-control-input\"'); ?>\n                <label class=\"custom-file-label\" for=\"advert_image\"></label>\n              </div>\n            </div>\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('advert_image_local', (isset($cInfo->advert_image) ? $cInfo->advert_image : ''), 'placeholder=\"' . TEXT_ADVERT_IMAGE_LOCAL . '\" class=\"form-control\" id=\"cNewImage\"'); ?>\n            </div>\n            <div class=\"col\">\n              <?php echo tep_draw_input_field('advert_image_target', null, 'placeholder=\"' . TEXT_ADVERT_IMAGE_TARGET . '\" class=\"form-control\" id=\"cTarget\"'); ?>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <hr>\n\n      <div class=\"form-group row\">\n        <label for=\"cText\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_ADVERT_HTML_TEXT; ?></label>\n        <div class=\"col-sm-9\"><?php echo tep_draw_textarea_field('advert_html_text', 'soft', '60', '5', $cInfo->advert_html_text, 'class=\"form-control\" id=\"cText\"'); ?>\n        </div>\n      </div>\n\n      <div class=\"alert alert-info\">\n        <?php echo TEXT_ADVERT_NOTE . TEXT_INSERT_NOTE; ?>\n      </div>\n\n      <?php\n      echo $OSCOM_Hooks->call('advert_manager', 'advertForm');\n      ?>\n\n      <div class=\"buttonSet\">\n        <?php echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-images', null, null, null, 'btn-success btn-block btn-lg xxx text-white'); ?>\n      </div>\n\n    </form>\n    \n    <script>$(document).on('change', '#advert_image', function (event) { $(this).next('.custom-file-label').html(event.target.files[0].name); });</script>\n<?php\n  } else {\n?>\n\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_ADVERT; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_GROUP; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_SORT_ORDER; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $advert_query_raw = \"select * from advert order by advert_group, sort_order, advert_title\";\n            $advert_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $advert_query_raw, $advert_query_numrows);\n            $advert_query = tep_db_query($advert_query_raw);\n            while ($advert = tep_db_fetch_array($advert_query)) {\n              if ((!isset($_GET['cID']) || (isset($_GET['cID']) && ($_GET['cID'] == $advert['advert_id']))) && !isset($cInfo) && (substr($action, 0, 3) != 'new')) {\n                $cInfo = new objectInfo($advert);\n              }\n\n              if (isset($cInfo) && is_object($cInfo) && ($advert['advert_id'] == $cInfo->advert_id)) {\n                echo '<tr class=\"table-active\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$advert['advert_id']) . '\\'\">';\n              }\n?>\n                <td><?php echo $advert['advert_title']; ?></td>\n                <td class=\"text-right\"><?php echo $advert['advert_group']; ?></td>\n                <td class=\"text-right\"><?php echo $advert['sort_order'] ?? 0; ?></td>\n                <td class=\"text-right\"><?php if ($advert['status'] == '1') { echo '<i class=\"fas fa-check-circle text-success\"></i> <a href=\"' . tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$advert['advert_id'] . '&action=setflag&flag=0') . '\"><i class=\"fas fa-times-circle text-muted\"></i></a>'; } else { echo '<a href=\"' . tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . $advert['advert_id'] . '&action=setflag&flag=1') . '\"><i class=\"fas fa-check-circle text-muted\"></i></a> <i class=\"fas fa-times-circle text-danger\"></i>'; } ?></td>\n                <td class=\"text-right\"><?php if (isset($cInfo) && is_object($cInfo) && ($advert['advert_id'] == $cInfo->advert_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . $advert['advert_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $advert_split->display_count($advert_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_ADVERTS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $advert_split->display_links($advert_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n\n      <?php\n      $banner_table_query = tep_db_query(\"SHOW TABLES LIKE 'banners'\");\n      if ($advert_query_numrows == 0 && tep_db_num_rows($banner_table_query)) {\n        echo '<div class=\"alert alert-info mt-3\">';\n          echo '<div class=\"row align-items-center\">';\n            echo '<div class=\"col-4\">';\n              echo tep_draw_bootstrap_button(IMAGE_IMPORT_ADVERT, 'fas fa-database', tep_href_link('advert_manager.php', 'action=import'), null, null, 'btn-info btn-block xxx text-white');\n            echo '</div>';\n            echo '<div class=\"col\">';\n              echo IMAGE_IMPORT_ADVERT_EXPLANATION;\n            echo '</div>';\n          echo '</div>';\n        echo '</div>';\n      }\n      ?>\n\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n  switch ($action) {\n    case 'delete':\n      $heading[] = ['text' => $cInfo->advert_title];\n\n      $contents = ['form' => tep_draw_form('advert', 'advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$cInfo->advert_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $cInfo->advert_title];\n      if ($cInfo->advert_image) $contents[] = ['text' => tep_draw_checkbox_field('delete_image', 'on') . ' ' . TEXT_INFO_DELETE_IMAGE];\n      $contents[] = ['align' => 'center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$_GET['cID']), null, null, 'btn-light')];\n      break;\n    default:\n     if (isset($cInfo) && is_object($cInfo)) {\n        $heading[] = ['text' => $cInfo->advert_title];\n\n        $contents[] = ['align' => 'center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->advert_id . '&action=new'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('advert_manager.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->advert_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_ADVERT_DATE_ADDED, tep_date_short($cInfo->date_added))];\n\n        if (tep_not_null($cInfo->advert_url)) {\n          if (filter_var($cInfo->advert_url, FILTER_VALIDATE_URL)) {\n            $contents[] = ['text' => sprintf(TEXT_ADVERT_EXTERNAL_URL, $cInfo->advert_url)];\n          } else {\n            $fragment = $cInfo->advert_fragment ?? null;\n            $contents[] = ['text' => sprintf(TEXT_ADVERT_INTERNAL_URL, tep_catalog_href_link($cInfo->advert_url, $fragment))];\n          }\n        }\n        \n        if (tep_not_null($cInfo->advert_image)) $contents[] = ['text' => '<hr>' . tep_info_image($cInfo->advert_image, null)];\n        if (tep_not_null($cInfo->advert_html_text)) $contents[] = ['text' => '<hr>' . $cInfo->advert_html_text];\n\n        if ($cInfo->date_status_change) $contents[] = ['text' => sprintf(TEXT_ADVERT_STATUS_CHANGE, tep_date_short($cInfo->date_status_change))];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n     echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n\n  echo '</div>';\n}\n\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('countries', 'countriesPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        $countries_name = tep_db_prepare_input($_POST['countries_name']);\n        $countries_iso_code_2 = tep_db_prepare_input($_POST['countries_iso_code_2']);\n        $countries_iso_code_3 = tep_db_prepare_input($_POST['countries_iso_code_3']);\n        $address_format_id = tep_db_prepare_input($_POST['address_format_id']);\n\n        tep_db_query(\"insert into countries (countries_name, countries_iso_code_2, countries_iso_code_3, address_format_id) values ('\" . tep_db_input($countries_name) . \"', '\" . tep_db_input($countries_iso_code_2) . \"', '\" . tep_db_input($countries_iso_code_3) . \"', '\" . (int)$address_format_id . \"')\");\n        \n        $OSCOM_Hooks->call('countries', 'countriesActionInsert');\n\n        tep_redirect(tep_href_link('countries.php'));\n        break;\n      case 'save':\n        $countries_id = tep_db_prepare_input($_GET['cID']);\n        $countries_name = tep_db_prepare_input($_POST['countries_name']);\n        $countries_iso_code_2 = tep_db_prepare_input($_POST['countries_iso_code_2']);\n        $countries_iso_code_3 = tep_db_prepare_input($_POST['countries_iso_code_3']);\n        $address_format_id = tep_db_prepare_input($_POST['address_format_id']);\n\n        tep_db_query(\"update countries set countries_name = '\" . tep_db_input($countries_name) . \"', countries_iso_code_2 = '\" . tep_db_input($countries_iso_code_2) . \"', countries_iso_code_3 = '\" . tep_db_input($countries_iso_code_3) . \"', address_format_id = '\" . (int)$address_format_id . \"' where countries_id = '\" . (int)$countries_id . \"'\");\n        \n        $OSCOM_Hooks->call('countries', 'countriesActionSave');\n\n        tep_redirect(tep_href_link('countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . $countries_id));\n        break;\n      case 'deleteconfirm':\n        $countries_id = tep_db_prepare_input($_GET['cID']);\n\n        tep_db_query(\"delete from countries where countries_id = '\" . (int)$countries_id . \"'\");\n        \n        $OSCOM_Hooks->call('countries', 'countriesActionDelete');\n\n        tep_redirect(tep_href_link('countries.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('countries', 'countriesPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_COUNTRY, 'fas fa-map-marker-alt', tep_href_link('countries.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('countries.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_COUNTRY_NAME; ?></th>\n              <th colspan=\"2\"><?php echo TABLE_HEADING_COUNTRY_CODES; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $countries_query_raw = \"select countries_id, countries_name, countries_iso_code_2, countries_iso_code_3, address_format_id from countries order by countries_name\";\n            $countries_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $countries_query_raw, $countries_query_numrows);\n            $countries_query = tep_db_query($countries_query_raw);\n            while ($countries = tep_db_fetch_array($countries_query)) {\n              if ((!isset($_GET['cID']) || (isset($_GET['cID']) && ($_GET['cID'] == $countries['countries_id']))) && !isset($cInfo) && (substr($action, 0, 3) != 'new')) {\n                $cInfo = new objectInfo($countries);\n              }\n\n              if (isset($cInfo) && is_object($cInfo) && ($countries['countries_id'] == $cInfo->countries_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$cInfo->countries_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . (int)$countries['countries_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $countries['countries_name']; ?></td>\n                <td><?php echo $countries['countries_iso_code_2']; ?></td>\n                <td><?php echo $countries['countries_iso_code_3']; ?></td>\n                <td class=\"text-right\"><?php if (isset($cInfo) && is_object($cInfo) && ($countries['countries_id'] == $cInfo->countries_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . $countries['countries_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $countries_split->display_count($countries_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_COUNTRIES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $countries_split->display_links($countries_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_COUNTRY];\n\n      $contents = ['form' => tep_draw_form('countries', 'countries.php', 'page=' . (int)$_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . '<br>' . tep_draw_input_field('countries_name')];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_CODE_2 . '<br>' . tep_draw_input_field('countries_iso_code_2')];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_CODE_3 . '<br>' . tep_draw_input_field('countries_iso_code_3')];\n      $contents[] = ['text' => TEXT_INFO_ADDRESS_FORMAT . '<br>' . tep_draw_pull_down_menu('address_format_id', tep_get_address_formats())];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('countries.php', 'page=' . (int)$_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_COUNTRY];\n\n      $contents = ['form' => tep_draw_form('countries', 'countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->countries_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . '<br>' . tep_draw_input_field('countries_name', $cInfo->countries_name)];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_CODE_2 . '<br>' . tep_draw_input_field('countries_iso_code_2', $cInfo->countries_iso_code_2)];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_CODE_3 . '<br>' . tep_draw_input_field('countries_iso_code_3', $cInfo->countries_iso_code_3)];\n      $contents[] = ['text' => TEXT_INFO_ADDRESS_FORMAT . '<br>' . tep_draw_pull_down_menu('address_format_id', tep_get_address_formats(), $cInfo->address_format_id)];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->countries_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_COUNTRY];\n\n      $contents = ['form' => tep_draw_form('countries', 'countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->countries_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $cInfo->countries_name];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->countries_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($cInfo)) {\n        $heading[] = ['text' => $cInfo->countries_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->countries_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('countries.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->countries_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_COUNTRY_NAME, $cInfo->countries_name)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_COUNTRY_CODE_2, $cInfo->countries_iso_code_2)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_COUNTRY_CODE_3, $cInfo->countries_iso_code_3)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_ADDRESS_FORMAT, $cInfo->address_format_id)];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  require('includes/classes/currencies.php');\n  $currencies = new currencies();\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('currencies', 'preAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n      case 'save':\n        if (isset($_GET['cID'])) $currency_id = tep_db_prepare_input($_GET['cID']);\n        $title = tep_db_prepare_input($_POST['title']);\n        $code = tep_db_prepare_input($_POST['code']);\n        $symbol_left = tep_db_prepare_input($_POST['symbol_left']);\n        $symbol_right = tep_db_prepare_input($_POST['symbol_right']);\n        $decimal_point = tep_db_prepare_input($_POST['decimal_point']);\n        $thousands_point = tep_db_prepare_input($_POST['thousands_point']);\n        $decimal_places = tep_db_prepare_input($_POST['decimal_places']);\n        $value = tep_db_prepare_input($_POST['value']);\n\n        $sql_data_array = ['title' => $title,\n                           'code' => $code,\n                           'symbol_left' => $symbol_left,\n                           'symbol_right' => $symbol_right,\n                           'decimal_point' => $decimal_point,\n                           'thousands_point' => $thousands_point,\n                           'decimal_places' => $decimal_places,\n                           'value' => $value];\n\n        if ($action == 'insert') {\n          tep_db_perform('currencies', $sql_data_array);\n          $currency_id = tep_db_insert_id();\n          \n          $OSCOM_Hooks->call('currencies', 'insert');\n          \n        } elseif ($action == 'save') {\n          tep_db_perform('currencies', $sql_data_array, 'update', \"currencies_id = '\" . (int)$currency_id . \"'\");\n          \n          $OSCOM_Hooks->call('currencies', 'save');\n        }\n\n        if (isset($_POST['default']) && ($_POST['default'] == 'on')) {\n          tep_db_query(\"update configuration set configuration_value = '\" . tep_db_input($code) . \"' where configuration_key = 'DEFAULT_CURRENCY'\");\n        }\n        \n        $OSCOM_Hooks->call('currencies', 'saveinsert');        \n\n        tep_redirect(tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $currency_id));\n        break;\n      case 'deleteconfirm':\n        $currencies_id = tep_db_prepare_input($_GET['cID']);\n\n        $currency_query = tep_db_query(\"select currencies_id from currencies where code = '\" . DEFAULT_CURRENCY . \"'\");\n        $currency = tep_db_fetch_array($currency_query);\n\n        if ($currency['currencies_id'] == $currencies_id) {\n          tep_db_query(\"update configuration set configuration_value = '' where configuration_key = 'DEFAULT_CURRENCY'\");\n        }\n\n        tep_db_query(\"delete from currencies where currencies_id = '\" . (int)$currencies_id . \"'\");\n        \n        $OSCOM_Hooks->call('currencies', 'deleteconfirm');\n\n        tep_redirect(tep_href_link('currencies.php', 'page=' . (int)$_GET['page']));\n        break;\n      case 'update':\n        include_once('includes/languages/' . $language . '/modules/currencies/' . MODULE_ADMIN_CURRENCIES_INSTALLED);\n        include_once('includes/modules/currencies/' . MODULE_ADMIN_CURRENCIES_INSTALLED);\n        \n        $converter = basename(MODULE_ADMIN_CURRENCIES_INSTALLED, '.php');\n \n        call_user_func([$converter, 'execute']);\n        \n        $OSCOM_Hooks->call('currencies', 'update');\n\n        tep_redirect(tep_href_link('currencies.php'));\n        break;\n      case 'delete':\n        $currencies_id = tep_db_prepare_input($_GET['cID']);\n\n        $currency_query = tep_db_query(\"select code from currencies where currencies_id = '\" . (int)$currencies_id . \"'\");\n        $currency = tep_db_fetch_array($currency_query);\n\n        $remove_currency = true;\n        if ($currency['code'] == DEFAULT_CURRENCY) {\n          $remove_currency = false;\n          $messageStack->add(ERROR_REMOVE_DEFAULT_CURRENCY, 'error');\n        }\n        \n        $OSCOM_Hooks->call('currencies', 'delete');\n        break;\n    }\n  }\n\n  $currency_select = ['USD' => ['title' => 'U.S. Dollar', 'code' => 'USD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'EUR' =>['title' => 'Euro', 'code' => 'EUR', 'symbol_left' => '', 'symbol_right' => '\u20ac', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'JPY' => ['title' => 'Japanese Yen', 'code' => 'JPY', 'symbol_left' => '\u00a5', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'GBP' => ['title' => 'Pounds Sterling', 'code' => 'GBP', 'symbol_left' => '\u00a3', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'CHF' => ['title' => 'Swiss Franc', 'code' => 'CHF', 'symbol_left' => '', 'symbol_right' => 'CHF', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'AUD' => ['title' => 'Australian Dollar', 'code' => 'AUD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'CAD' => ['title' => 'Canadian Dollar', 'code' => 'CAD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'SEK' => ['title' => 'Swedish Krona', 'code' => 'SEK', 'symbol_left' => '', 'symbol_right' => 'kr', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'HKD' => ['title' => 'Hong Kong Dollar', 'code' => 'HKD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'NOK' => ['title' => 'Norwegian Krone', 'code' => 'NOK', 'symbol_left' => 'kr', 'symbol_right' => '', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'NZD' => ['title' => 'New Zealand Dollar', 'code' => 'NZD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'MXN' => ['title' => 'Mexican Peso', 'code' => 'MXN', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'SGD' => ['title' => 'Singapore Dollar', 'code' => 'SGD', 'symbol_left' => '$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'BRL' => ['title' => 'Brazilian Real', 'code' => 'BRL', 'symbol_left' => 'R$', 'symbol_right' => '', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'CNY' => ['title' => 'Chinese RMB', 'code' => 'CNY', 'symbol_left' => '\uffe5', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'CZK' => ['title' => 'Czech Koruna', 'code' => 'CZK', 'symbol_left' => '', 'symbol_right' => 'K\u010d', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'DKK' => ['title' => 'Danish Krone', 'code' => 'DKK', 'symbol_left' => '', 'symbol_right' => 'kr', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'HUF' => ['title' => 'Hungarian Forint', 'code' => 'HUF', 'symbol_left' => '', 'symbol_right' => 'Ft', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'ILS' => ['title' => 'Israeli New Shekel', 'code' => 'ILS', 'symbol_left' => '\u20aa', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'INR' => ['title' => 'Indian Rupee', 'code' => 'INR', 'symbol_left' => 'Rs.', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'MYR' => ['title' => 'Malaysian Ringgit', 'code' => 'MYR', 'symbol_left' => 'RM', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'PHP' => ['title' => 'Philippine Peso', 'code' => 'PHP', 'symbol_left' => 'Php', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'PLN' => ['title' => 'Polish Zloty', 'code' => 'PLN', 'symbol_left' => '', 'symbol_right' => 'z\u0142', 'decimal_point' => ',', 'thousands_point' => '.', 'decimal_places' => '2'],\n                      'THB' => ['title' => 'Thai Baht', 'code' => 'THB', 'symbol_left' => '', 'symbol_right' => '\u0e3f', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2'],\n                      'TWD' => ['title' => 'Taiwan New Dollar', 'code' => 'TWD', 'symbol_left' => 'NT$', 'symbol_right' => '', 'decimal_point' => '.', 'thousands_point' => ',', 'decimal_places' => '2']];\n\n  $currency_select_array = [['id' => '', 'text' => TEXT_INFO_COMMON_CURRENCIES]];\n  foreach ($currency_select as $cs) {\n    if (!isset($currencies->currencies[$cs['code']])) {\n      $currency_select_array[] = ['id' => $cs['code'], 'text' => '[' . $cs['code'] . '] ' . $cs['title']];\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n<script>\nvar currency_select = new Array();\n<?php\n  foreach ($currency_select_array as $cs) {\n    if (!empty($cs['id'])) {\n      echo 'currency_select[\"' . $cs['id'] . '\"] = new Array(\"' . $currency_select[$cs['id']]['title'] . '\", \"' . $currency_select[$cs['id']]['symbol_left'] . '\", \"' . $currency_select[$cs['id']]['symbol_right'] . '\", \"' . $currency_select[$cs['id']]['decimal_point'] . '\", \"' . $currency_select[$cs['id']]['thousands_point'] . '\", \"' . $currency_select[$cs['id']]['decimal_places'] . '\");' . \"\\n\";\n    }\n  }\n?>\n\nfunction updateForm() {\n  var cs = document.forms[\"currencies\"].cs[document.forms[\"currencies\"].cs.selectedIndex].value;\n\n  document.forms[\"currencies\"].title.value = currency_select[cs][0];\n  document.forms[\"currencies\"].code.value = cs;\n  document.forms[\"currencies\"].symbol_left.value = currency_select[cs][1];\n  document.forms[\"currencies\"].symbol_right.value = currency_select[cs][2];\n  document.forms[\"currencies\"].decimal_point.value = currency_select[cs][3];\n  document.forms[\"currencies\"].thousands_point.value = currency_select[cs][4];\n  document.forms[\"currencies\"].decimal_places.value = currency_select[cs][5];\n  document.forms[\"currencies\"].value.value = 1;\n}\n</script>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col-sm-4 text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_CURRENCY, 'fas fa-cogs', tep_href_link('currencies.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      } else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('currencies.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_CURRENCY_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_CURRENCY_CODES; ?></th>\n              <th><?php echo TABLE_HEADING_CURRENCY_VALUE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $currency_query_raw = \"SELECT * FROM currencies ORDER BY title\";\n            $currency_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $currency_query_raw, $currency_query_numrows);\n            $currency_query = tep_db_query($currency_query_raw);\n            while ($currency = tep_db_fetch_array($currency_query)) {\n              if ((!isset($_GET['cID']) || (isset($_GET['cID']) && ($_GET['cID'] == $currency['currencies_id']))) && !isset($cInfo) && (substr($action, 0, 3) != 'new')) {\n                $cInfo = new objectInfo($currency);\n              }\n\n              if (isset($cInfo) && is_object($cInfo) && ($currency['currencies_id'] == $cInfo->currencies_id) ) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $currency['currencies_id']) . '\\'\">';\n              }\n\n              if (DEFAULT_CURRENCY == $currency['code']) {\n                echo '<th>' . $currency['title'] . ' (' . TEXT_DEFAULT . ')</th>';\n              } else {\n                echo '<td>' . $currency['title'] . '</td>';\n              }\n              ?>\n                <td><?php echo $currency['code']; ?></td>\n                <td><?php echo number_format($currency['value'], 8); ?></td>\n                <td class=\"text-right\"><?php if (isset($cInfo) && is_object($cInfo) && ($currency['currencies_id'] == $cInfo->currencies_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $currency['currencies_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $currency_split->display_count($currency_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_CURRENCIES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $currency_split->display_links($currency_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n      <?php\n      if ( defined('MODULE_ADMIN_CURRENCIES_INSTALLED') && tep_not_null(MODULE_ADMIN_CURRENCIES_INSTALLED) ) {\n        echo '<p class=\"mr-2\">';\n          echo tep_draw_bootstrap_button(IMAGE_UPDATE_CURRENCIES, 'fas fa-money-bill-alt', tep_href_link('currencies.php', 'action=update'), null, null, 'btn-success btn-block xxx text-white');\n        echo '</p>';\n      }\n      else {\n        echo '<div class=\"alert alert-warning mr-2\">';\n          echo ERROR_INSTALL_CURRENCY_CONVERTER;\n        echo '</div>';\n      }\n      ?>\n\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_CURRENCY];\n\n      $contents = ['form' => tep_draw_form('currencies', 'currencies.php', 'page=' . (int)$_GET['page'] . (isset($cInfo) ? '&cID=' . $cInfo->currencies_id : '') . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => tep_draw_pull_down_menu('cs', $currency_select_array, '', 'onchange=\"updateForm();\"')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_TITLE . '<br>' . tep_draw_input_field('title')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_CODE . '<br>' . tep_draw_input_field('code')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_SYMBOL_LEFT . '<br>' . tep_draw_input_field('symbol_left')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_SYMBOL_RIGHT . '<br>' . tep_draw_input_field('symbol_right')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_DECIMAL_POINT . '<br>' . tep_draw_input_field('decimal_point')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_THOUSANDS_POINT . '<br>' . tep_draw_input_field('thousands_point')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_DECIMAL_PLACES . '<br>' . tep_draw_input_field('decimal_places')];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_VALUE . '<br>' . tep_draw_input_field('value')];\n      $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_INFO_SET_AS_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('currencies.php'), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_CURRENCY];\n\n      $contents = ['form' => tep_draw_form('currencies', 'currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_TITLE . '<br>' . tep_draw_input_field('title', $cInfo->title)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_CODE . '<br>' . tep_draw_input_field('code', $cInfo->code)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_SYMBOL_LEFT . '<br>' . tep_draw_input_field('symbol_left', $cInfo->symbol_left)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_SYMBOL_RIGHT . '<br>' . tep_draw_input_field('symbol_right', $cInfo->symbol_right)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_DECIMAL_POINT . '<br>' . tep_draw_input_field('decimal_point', $cInfo->decimal_point)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_THOUSANDS_POINT . '<br>' . tep_draw_input_field('thousands_point', $cInfo->thousands_point)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_DECIMAL_PLACES . '<br>' . tep_draw_input_field('decimal_places', $cInfo->decimal_places)];\n      $contents[] = ['text' => TEXT_INFO_CURRENCY_VALUE . '<br>' . tep_draw_input_field('value', $cInfo->value)];\n      if (DEFAULT_CURRENCY != $cInfo->code) $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_INFO_SET_AS_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->currencies_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_CURRENCY];\n\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $cInfo->title];\n      $contents[] = ['class' => 'text-center', 'text' => (($remove_currency) ? tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=deleteconfirm'), null, null, 'btn-danger xxx text-white mr-2') : '') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->currencies_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($cInfo)) {\n        $heading[] = ['text' => $cInfo->title];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('currencies.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->currencies_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_TITLE, $cInfo->title)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_CODE, $cInfo->code)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_SYMBOL_LEFT, $cInfo->symbol_left)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_SYMBOL_RIGHT, $cInfo->symbol_right)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_DECIMAL_POINT, $cInfo->decimal_point)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_THOUSANDS_POINT, $cInfo->thousands_point)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_DECIMAL_PLACES, $cInfo->decimal_places)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_LAST_UPDATED, tep_date_short($cInfo->last_updated))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_VALUE, number_format($cInfo->value, 8))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CURRENCY_EXAMPLE, $currencies->format('30', false, DEFAULT_CURRENCY), $currencies->format('30', true, $cInfo->code))];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n  \n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require 'includes/application_top.php';\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        tep_db_query(\"INSERT INTO customer_data_groups_sequence VALUES (NULL)\");\n        $customer_data_groups_id = tep_db_insert_id();\n      case 'save':\n        if (!isset($customer_data_groups_id)) {\n          $customer_data_groups_id = tep_db_prepare_input($_GET['cdgID']);\n        }\n\n        $first_language_id = key($_POST['customer_data_groups_name']);\n        foreach ($_POST['customer_data_groups_name'] as $language_id => $customer_data_groups_name) {\n          // if use_first was checked, get all the values other than the name from the first group\n          $index = (1 == $_POST['use_first']) ? $first_language_id : $language_id;\n\n          $sql_data_array = [\n            'customer_data_groups_name' => tep_db_prepare_input($customer_data_groups_name),\n            'cdg_vertical_sort_order' => tep_db_prepare_input($_POST['cdg_vertical_sort_order'][$index]),\n            'cdg_horizontal_sort_order' => tep_db_prepare_input($_POST['cdg_horizontal_sort_order'][$index]),\n            'customer_data_groups_width' => tep_db_prepare_input($_POST['customer_data_groups_width'][$index]),\n          ];\n\n          if ('insert' == $action) {\n            $sql_data_array['customer_data_groups_id'] = $customer_data_groups_id;\n            $sql_data_array['language_id'] = $language_id;\n\n            tep_db_perform('customer_data_groups', $sql_data_array);\n          } elseif ('save' == $action) {\n            tep_db_perform('customer_data_groups', $sql_data_array, 'update', \"customer_data_groups_id = \" . (int)$customer_data_groups_id . \" AND language_id = \" . (int)$language_id);\n          }\n        }\n\n        if ('insert' == $action) {\n          tep_redirect(tep_href_link('customer_data_groups.php'));\n        } elseif ('save' == $action) {\n          tep_redirect(tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $customer_data_groups_id));\n        }\n        break;\n      case 'deleteconfirm':\n        $customer_data_groups_id = tep_db_prepare_input($_GET['cdgID']);\n\n        tep_db_query(\"DELETE FROM customer_data_groups WHERE customer_data_groups_id = \" . (int)$customer_data_groups_id);\n        tep_db_query(\"DELETE FROM customer_data_groups_sequence WHERE customer_data_groups_id = \" . (int)$customer_data_groups_id);\n\n        tep_redirect(tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n\n  require 'includes/template_top.php';\n?>\n\n  <div class=\"row\">\n    <div class=\"col-8\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_CUSTOMER_DATA_GROUP, 'fas fa-id-card', tep_href_link('customer_data_groups.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('customer_data_groups.php'), null, null, 'btn-light');\n      }       \n      ?>\n    </div>\n  </div>\n\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover table-filter\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_CUSTOMER_DATA_GROUP_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_SORT_ORDER_V; ?></th>\n              <th><?php echo TABLE_HEADING_SORT_ORDER_H; ?></th>\n              <th><?php echo TABLE_HEADING_WIDTH; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $customer_data_groups_query_raw = <<<'EOSQL'\nselect customer_data_groups_id, customer_data_groups_name, cdg_vertical_sort_order, cdg_horizontal_sort_order, customer_data_groups_width\n from customer_data_groups\n where language_id =\nEOSQL\n. (int)$languages_id . \" order by cdg_vertical_sort_order, cdg_horizontal_sort_order\";\n            $customer_data_groups_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $customer_data_groups_query_raw, $customer_data_groups_query_numrows);\n            $customer_data_groups_query = tep_db_query($customer_data_groups_query_raw);\n            while ($customer_data_groups = tep_db_fetch_array($customer_data_groups_query)) {\n              if ((!isset($_GET['cdgID']) || (isset($_GET['cdgID']) && ($_GET['cdgID'] == $customer_data_groups['customer_data_groups_id']))) && !isset($cdgInfo) && (substr($action, 0, 3) != 'new')) {\n                $cdgInfo = new objectInfo($customer_data_groups);\n              }\n\n              if (isset($cdgInfo) && is_object($cdgInfo) && ($customer_data_groups['customer_data_groups_id'] == $cdgInfo->customer_data_groups_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $customer_data_groups['customer_data_groups_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $customer_data_groups['customer_data_groups_name']; ?></td>\n                <td><?php echo $customer_data_groups['cdg_vertical_sort_order']; ?></td>\n                <td><?php echo $customer_data_groups['cdg_horizontal_sort_order']; ?></td>\n                <td><?php echo $customer_data_groups['customer_data_groups_width']; ?></td>\n                <td class=\"text-right\"><?php if (isset($cdgInfo) && is_object($cdgInfo) && ($customer_data_groups['customer_data_groups_id'] == $cdgInfo->customer_data_groups_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $customer_data_groups['customer_data_groups_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n              }\n            ?>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $customer_data_groups_split->display_count($customer_data_groups_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_CUSTOMER_DATA_GROUPS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $customer_data_groups_split->display_links($customer_data_groups_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_CUSTOMER_DATA_GROUP];\n\n      $contents = ['form' => tep_draw_form('customer_data_groups', 'customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => tep_draw_checkbox_field('use_first', '1', true) . TEXT_INFO_USE_FIRST_FOR_ALL];\n\n      foreach (tep_get_languages() as $lang) {\n        $contents[] = ['text' => TEXT_INFO_CUSTOMER_DATA_GROUP_NAME . '<br>' . tep_image(tep_catalog_href_link('includes/languages/' . $lang['directory'] . '/images/' . $lang['image'], '', 'SSL'), $lang['name']) . '&nbsp;' . tep_draw_input_field('customer_data_groups_name[' . $lang['id'] . ']')];\n        $contents[] = ['text' => TEXT_INFO_VERTICAL_SORT_ORDER . '<br>' . tep_draw_input_field('cdg_vertical_sort_order[' . $lang['id'] . ']')];\n        $contents[] = ['text' => TEXT_INFO_HORIZONTAL_SORT_ORDER . '<br>' . tep_draw_input_field('cdg_horizontal_sort_order[' . $lang['id'] . ']')];\n        $contents[] = ['text' => TEXT_INFO_WIDTH . '<br>' . tep_draw_input_field('customer_data_groups_width[' . $lang['id'] . ']', 12)];\n      }\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_CUSTOMER_DATA_GROUP];\n\n      $contents = ['form' => tep_draw_form('customer_data_groups', 'customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_USE_FIRST_FOR_ALL . '<br>' . tep_draw_checkbox_field('use_first', '1', true)];\n\n      $cdg_query = tep_db_query(<<<'EOSQL'\nSELECT\n  cdg.customer_data_groups_name,\n  cdg.cdg_vertical_sort_order,\n  cdg.cdg_horizontal_sort_order,\n  cdg.customer_data_groups_width,\n  l.directory,\n  l.image,\n  l.name,\n  l.languages_id AS id\n FROM customer_data_groups cdg INNER JOIN languages l ON cdg.language_id = l.languages_id\n WHERE customer_data_groups_id =\nEOSQL\n        . (int)$cdgInfo->customer_data_groups_id);\n      while ($cdg = tep_db_fetch_array($cdg_query)) {\n        $contents[] = ['text' => TEXT_INFO_CUSTOMER_DATA_GROUP_NAME . '<br>' . tep_image(tep_catalog_href_link('includes/languages/' . $cdg['directory'] . '/images/' . $cdg['image'], '', 'SSL'), $cdg['name']) . '&nbsp;' . tep_draw_input_field('customer_data_groups_name[' . $cdg['id'] . ']', $cdg['customer_data_groups_name'])];\n        $contents[] = ['text' => sprintf(TEXT_INFO_VERTICAL_SORT_ORDER, null) . '<br>' . tep_draw_input_field('cdg_vertical_sort_order[' . $cdg['id'] . ']', $cdg['cdg_vertical_sort_order'])];\n        $contents[] = ['text' => sprintf(TEXT_INFO_HORIZONTAL_SORT_ORDER, null) . '<br>' . tep_draw_input_field('cdg_horizontal_sort_order[' . $cdg['id'] . ']', $cdg['cdg_horizontal_sort_order'])];\n        $contents[] = ['text' => sprintf(TEXT_INFO_WIDTH, null) . '<br>' . tep_draw_input_field('customer_data_groups_width[' . $cdg['id'] . ']', $cdg['customer_data_groups_width'])];\n      }\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_CUSTOMER_DATA_GROUP];\n\n      $contents = ['form' => tep_draw_form('customer_data_groups', 'customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n\n      $cdg_query = tep_db_query(<<<'EOSQL'\nSELECT\n  cdg.customer_data_groups_name,\n  l.directory,\n  l.image,\n  l.name\n FROM customer_data_groups cdg INNER JOIN languages l ON cdg.language_id = l.languages_id\n WHERE customer_data_groups_id =\nEOSQL\n        . (int)$cdgInfo->customer_data_groups_id);\n      while ($cdg = tep_db_fetch_array($cdg_query)) {\n        $contents[] = ['text' => tep_image(tep_catalog_href_link('includes/languages/' . $cdg['directory'] . '/images/' . $cdg['image'], '', 'SSL'), $cdg['name']) . '&nbsp;<strong>' . $cdg['customer_data_groups_name'] . '</strong>'];\n      }\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($cdgInfo ?? null)) {\n        $heading[] = ['text' => $cdgInfo->customer_data_groups_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('customer_data_groups.php', 'page=' . (int)$_GET['page'] . '&cdgID=' . $cdgInfo->customer_data_groups_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n\n        $cdg_query = tep_db_query(<<<'EOSQL'\nSELECT\n  cdg.customer_data_groups_name,\n  cdg.cdg_vertical_sort_order,\n  cdg.cdg_horizontal_sort_order,\n  cdg.customer_data_groups_width,\n  l.directory,\n  l.image,\n  l.name\n FROM customer_data_groups cdg INNER JOIN languages l ON cdg.language_id = l.languages_id\n WHERE customer_data_groups_id =\nEOSQL\n          . (int)$cdgInfo->customer_data_groups_id);\n        while ($cdg = tep_db_fetch_array($cdg_query)) {\n          $contents[] = ['text' => TEXT_INFO_CUSTOMER_DATA_GROUP_NAME . '<br>' . tep_image(tep_catalog_href_link('includes/languages/' . $cdg['directory'] . '/images/' . $cdg['image'], '', 'SSL'), $cdg['name']) . '&nbsp;' . $cdg['customer_data_groups_name']];\n          $contents[] = ['text' => sprintf(TEXT_INFO_VERTICAL_SORT_ORDER, $cdg['cdg_vertical_sort_order'])];\n          $contents[] = ['text' => sprintf(TEXT_INFO_HORIZONTAL_SORT_ORDER, $cdg['cdg_horizontal_sort_order'])];\n          $contents[] = ['text' => sprintf(TEXT_INFO_WIDTH, $cdg['customer_data_groups_width'])];\n        }\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require 'includes/template_bottom.php';\n  require 'includes/application_bottom.php';\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  class product_notification {\n\n    public $show_choose_audience = true;\n    public $title, $content;\n\n    function __construct($title, $content) {\n      $this->show_choose_audience = true;\n      $this->title = $title;\n      $this->content = $content;\n    }\n\n    function choose_audience() {\n      $products = [];\n      $products_query = tep_db_query(<<<'EOSQL'\nSELECT pd.products_id, pd.products_name\n  FROM products p INNER JOIN products_description pd ON pd.products_id = p.products_id\n  WHERE p.products_status = 1 AND pd.language_id = \nEOSQL\n        . (int)$GLOBALS['languages_id'] . ' ORDER BY pd.products_name');\n      while ($product = tep_db_fetch_array($products_query)) {\n        $products[] = [\n          'id' => $product['products_id'],\n          'text' => $product['products_name'],\n        ];\n      }\n\n$choose_audience_string = '<script><!--\nfunction mover(move) {\n  if (move == \\'remove\\') {\n    for (x=0; x<(document.notifications.products.length); x++) {\n      if (document.notifications.products.options[x].selected) {\n        with(document.notifications.elements[\\'chosen[]\\']) {\n          options[options.length] = new Option(document.notifications.products.options[x].text,document.notifications.products.options[x].value);\n        }\n        document.notifications.products.options[x] = null;\n        x = -1;\n      }\n    }\n  }\n  if (move == \\'add\\') {\n    for (x=0; x<(document.notifications.elements[\\'chosen[]\\'].length); x++) {\n      if (document.notifications.elements[\\'chosen[]\\'].options[x].selected) {\n        with(document.notifications.products) {\n          options[options.length] = new Option(document.notifications.elements[\\'chosen[]\\'].options[x].text,document.notifications.elements[\\'chosen[]\\'].options[x].value);\n        }\n        document.notifications.elements[\\'chosen[]\\'].options[x] = null;\n        x = -1;\n      }\n    }\n  }\n  return true;\n}\n\nfunction selectAll(FormName, SelectBox) {\n  temp = \"document.\" + FormName + \".elements[\\'\" + SelectBox + \"\\']\";\n  Source = eval(temp);\n\n  for (x=0; x<(Source.length); x++) {\n    Source.options[x].selected = \"true\";\n  }\n\n  if (x<1) {\n    alert(\\'' . JS_PLEASE_SELECT_PRODUCTS . '\\');\n    return false;\n  } else {\n    return true;\n  }\n}\n//--></script>';\n\n      $choose_audience_string .= '<form name=\"notifications\" action=\"' . tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID'] . '&action=confirm') . '\" method=\"post\" onsubmit=\"return selectAll(\\'notifications\\', \\'chosen[]\\')\">';\n        $choose_audience_string .= '<div class=\"row mb-3\">';\n          $choose_audience_string .= '<div class=\"col-5\">';\n            $choose_audience_string .= '<h6>' . TEXT_PRODUCTS . '</h6>';\n            $choose_audience_string .= tep_draw_pull_down_menu('products', $products, '', 'class=\"custom-select\" size=\"20\" multiple');\n          $choose_audience_string .= '</div>';\n          $choose_audience_string .= '<div class=\"col-2 align-self-center text-center\">';\n            $choose_audience_string .= tep_draw_bootstrap_button(BUTTON_GLOBAL, 'fas fa-globe', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID'] . '&action=confirm&global=true'), 'primary', null, 'btn-info xxx text-white');\n            $choose_audience_string .= '<br><br>';\n            $choose_audience_string .= '<input type=\"button\" class=\"btn btn-secondary\" value=\"' . BUTTON_SELECT . '\" onClick=\"mover(\\'remove\\');\">';\n            $choose_audience_string .= '<br><br>';\n            $choose_audience_string .= '<input type=\"button\" class=\"btn btn-secondary\" value=\"' . BUTTON_UNSELECT . '\" onClick=\"mover(\\'add\\');\">';\n          $choose_audience_string .= '</div>';\n          $choose_audience_string .= '<div class=\"col-5\">';\n            $choose_audience_string .= '<h6>' . TEXT_SELECTED_PRODUCTS . '</h6>';\n            $choose_audience_string .= tep_draw_pull_down_menu('chosen[]', [], '', 'class=\"custom-select\" size=\"20\" multiple');\n          $choose_audience_string .= '</div>';\n        $choose_audience_string .= '</div>';\n\n        $choose_audience_string .= tep_draw_bootstrap_button(IMAGE_SEND, 'fas fa-paper-plane', null, 'primary', null, 'btn-success btn-lg btn-block xxx text-white');\n        $choose_audience_string .= tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID']), null, null, 'btn-light mt-2');\n      $choose_audience_string .= '</form>';\n\n      return $choose_audience_string;\n    }\n\n    function confirm() {\n      $audience = [];\n\n      $sql = \"SELECT distinct customers_id FROM products_notifications\";\n      if ('true' !== ($_GET['global'] ?? null)) {\n        $sql .= \" WHERE products_id in (\" . implode(', ', $_POST['chosen']) . \")\";\n      }\n\n      $products_query = tep_db_query($sql);\n      while ($products = tep_db_fetch_array($products_query)) {\n        $audience[$products['customers_id']] = '1';\n      }\n\n      $customers_query = tep_db_query(\"SELECT customers_info_id FROM customers_info WHERE global_product_notifications = 1\");\n      while ($customers = tep_db_fetch_array($customers_query)) {\n        $audience[$customers['customers_info_id']] = '1';\n      }\n\n      $confirm_string = '<div class=\"alert alert-danger\">' . sprintf(TEXT_COUNT_CUSTOMERS, count($audience)) . '</div>';\n\n        $confirm_string .= '<table class=\"table table-striped\">';\n          $confirm_string .= '<tr>';\n            $confirm_string .= '<th scope=\"row\">' . TEXT_TITLE . '</th>';\n            $confirm_string .= '<td>' . $this->title . '</td>';\n          $confirm_string .= '</tr>';\n          $confirm_string .= '<tr>';\n            $confirm_string .= '<th scope=\"row\">' . TEXT_CONTENT . '</th>';\n            $confirm_string .= '<td>' . $this->content . '</td>';\n          $confirm_string .= '</tr>';\n        $confirm_string .= '</table>';\n\n      if (count($audience) > 0) {\n        $confirm_string .= tep_draw_form('confirm', 'newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID'] . '&action=confirm_send');\n        if (is_array($_POST['chosen'] ?? null)) {\n          foreach ($_POST['chosen'] as $customer_id) {\n            $confirm_string .= tep_draw_hidden_field('chosen[]', $customer_id);\n          }\n        } else {\n          $confirm_string .= tep_draw_hidden_field('global', 'true');\n        }\n\n          $confirm_string .= tep_draw_bootstrap_button(IMAGE_SEND, 'fas fa-paper-plane', null, 'primary', null, 'btn-success btn-block btn-lg');\n        $confirm_string .= '</form>';\n      }\n\n      $confirm_string .= tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID'] . '&action=send'), 'primary', null, 'btn-light mt-2');\n\n      return $confirm_string;\n    }\n\n    function send($newsletter_id) {\n      global $customer_data;\n      $audience = [];\n\n      $db_tables = $customer_data->build_db_tables(['id', 'name', 'email_address'], 'customers');\n      tep_guarantee_subarray($db_tables, 'customers');\n      $db_tables['customers']['customers_id'] = null;\n      $built = query::rtrim_string_once(customer_query::build_specified_columns($db_tables), query::COLUMN_SEPARATOR)\n             . ' FROM' . customer_query::build_joins($db_tables, []);\n\n      $sql = 'SELECT DISTINCT ' . $built;\n      $sql .= ' INNER JOIN products_notifications pn ON c.customers_id = pn.customers_id';\n      if ('true' !== ($_POST['global'] ?? null)) {\n        $sql .= ' WHERE pn.products_id in (' . implode(',', $_POST['chosen']) . ')';\n      }\n\n      $products_query = tep_db_query($sql);\n      while ($products = tep_db_fetch_array($products_query)) {\n        $audience[$customer_data->get('id', $products)] = [\n          'name' => $customer_data->get('name', $products),\n          'email_address' => $customer_data->get('email_address', $products),\n        ];\n      }\n\n      $customers_query = tep_db_query('SELECT ' . $built . ' INNER JOIN customers_info ci ON c.customers_id = ci.customers_info_id WHERE ci.global_product_notifications = 1');\n      while ($customers = tep_db_fetch_array($customers_query)) {\n        $audience[$customer_data->get('id', $customers)] = [\n          'name' => $customer_data->get('name', $customers),\n          'email_address' => $customer_data->get('email_address', $customers),\n        ];\n      }\n\n      $mimemessage = new email();\n      $mimemessage->add_message($this->content);\n      $mimemessage->build_message();\n\n      foreach ($audience as $value) {\n        $mimemessage->send($value['name'], $value['email_address'], STORE_OWNER, STORE_OWNER_EMAIL_ADDRESS, $this->title);\n      }\n\n      $newsletter_id = tep_db_prepare_input($newsletter_id);\n      tep_db_query(\"UPDATE newsletters SET date_sent = NOW(), status = 1 WHERE newsletters_id = '\" . tep_db_input($newsletter_id) . \"'\");\n    }\n  }\n\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require 'includes/application_top.php';\n\n  $action = ($_GET['action'] ?? '');\n  \n  $OSCOM_Hooks->call('languages', 'languagesPreAction');\n\n  if (tep_not_null($action)) {\n    if ('insert' == $action || 'save' == $action) {\n      $sql_data = [\n        'name' => tep_db_prepare_input($_POST['name']),\n        'code' => tep_db_prepare_input(substr($_POST['code'], 0, 2)),\n        'image' => tep_db_prepare_input($_POST['image']),\n        'directory' => tep_db_prepare_input($_POST['directory']),\n        'sort_order' => (int)tep_db_prepare_input($_POST['sort_order']),\n      ];\n    }\n\n    switch ($action) {\n      case 'insert':\n        tep_db_perform('languages', $sql_data);\n        $lID = tep_db_insert_id();\n\n// create additional language-specific records\n        tep_db_query(\"INSERT INTO categories_description (categories_id, language_id, categories_name) SELECT categories_id, \" . (int)$lID . \", categories_name FROM categories_description WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO products_description (products_id, language_id, products_name, products_description, products_url) SELECT products_id, \" . (int)$lID . \", products_name, products_description, products_url FROM products_description WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO products_options (products_options_id, language_id, products_options_name) SELECT products_options_id, \" . (int)$lID . \", products_options_name FROM products_options WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO products_options_values (products_options_values_id, language_id, products_options_values_name) SELECT products_options_values_id, \" . (int)$lID . \", products_options_values_name FROM products_options_values WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO manufacturers_info (manufacturers_id, languages_id, manufacturers_url) SELECT manufacturers_id, \" . (int)$lID . \", manufacturers_url FROM manufacturers_info WHERE languages_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO orders_status (orders_status_id, language_id, orders_status_name) SELECT orders_status_id, \" . (int)$lID . \", orders_status_name FROM orders_status WHERE language_id = \" . (int)$languages_id);\n        tep_db_query(\"INSERT INTO customer_data_groups (customer_data_groups_id, language_id, customer_data_groups_name, cdg_vertical_sort_order, cdg_horizontal_sort_order, customer_data_groups_width) SELECT customer_data_groups_id, \" . (int)$lID . \", customer_data_groups_name, cdg_vertical_sort_order, cdg_horizontal_sort_order, customer_data_groups_width FROM customer_data_groups WHERE language_id = \" . (int)$languages_id);\n\n        if (isset($_POST['default']) && ($_POST['default'] == 'on')) {\n          tep_db_query(\"UPDATE configuration SET configuration_value = '\" . tep_db_input($code) . \"' WHERE configuration_key = 'DEFAULT_LANGUAGE'\");\n        }\n        \n        $OSCOM_Hooks->call('languages', 'languagesActionInsert');\n\n        tep_redirect(tep_href_link('languages.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'lID=' . $lID));\n        break;\n      case 'save':\n        $lID = tep_db_prepare_input($_GET['lID']);\n        tep_db_perform('languages', $sql_data, 'update', \"languages_id = \" . (int)$lID);\n\n        if (isset($_POST['default']) && $_POST['default'] == 'on') {\n          tep_db_query(\"UPDATE configuration SET configuration_value = '\" . tep_db_input($sql_data['code']) . \"' WHERE configuration_key = 'DEFAULT_LANGUAGE'\");\n        }\n        \n        $OSCOM_Hooks->call('languages', 'languagesActionSave');\n\n        tep_redirect(tep_href_link('languages.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'lID=' . $lID));\n        break;\n      case 'deleteconfirm':\n        $lID = tep_db_prepare_input($_GET['lID']);\n\n        $lng_query = tep_db_query(\"SELECT languages_id FROM languages WHERE code = '\" . DEFAULT_CURRENCY . \"'\");\n        $lng = tep_db_fetch_array($lng_query);\n        if ($lng['languages_id'] == $lID) {\n          $remove_language = false;\n          $messageStack->add(ERROR_REMOVE_DEFAULT_LANGUAGE, 'error');\n          $action = 'delete';\n          break;\n        }\n\n        tep_db_query(\"DELETE FROM categories_description WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM products_description WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM products_options WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM products_options_values WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM manufacturers_info WHERE languages_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM orders_status WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM customer_data_groups WHERE language_id = '\" . (int)$lID . \"'\");\n        tep_db_query(\"DELETE FROM languages WHERE languages_id = '\" . (int)$lID . \"'\");\n        \n        $OSCOM_Hooks->call('languages', 'languagesActionDeleteConfirm');\n\n        tep_redirect(tep_href_link('languages.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] : '')));\n        break;\n      case 'delete':\n        $lID = tep_db_prepare_input($_GET['lID']);\n\n        $lng_query = tep_db_query(\"SELECT code FROM languages WHERE languages_id = '\" . (int)$lID . \"'\");\n        $lng = tep_db_fetch_array($lng_query);\n\n        $remove_language = true;\n        if ($lng['code'] == DEFAULT_LANGUAGE) {\n          $remove_language = false;\n          $messageStack->add(ERROR_REMOVE_DEFAULT_LANGUAGE, 'error');\n        }\n        \n        $OSCOM_Hooks->call('languages', 'languagesActionDelete');\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('languages', 'languagesPostAction');\n\n  require 'includes/template_top.php';\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_LANGUAGE, 'fas fa-comment-dots', tep_href_link('languages.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('languages.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_LANGUAGE_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_LANGUAGE_CODE; ?></th>\n              <th><?php echo TABLE_HEADING_LANGUAGE_IMAGE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $languages_query_raw = \"select * from languages order by sort_order\";\n            $languages_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $languages_query_raw, $languages_query_numrows);\n            $languages_query = tep_db_query($languages_query_raw);\n\n            while ($languages = tep_db_fetch_array($languages_query)) {\n              if ((!isset($_GET['lID']) || (isset($_GET['lID']) && ($_GET['lID'] == $languages['languages_id']))) && !isset($lInfo) && (substr($action, 0, 3) != 'new')) {\n                $lInfo = new objectInfo($languages);\n              }\n\n              if (isset($lInfo) && is_object($lInfo) && ($languages['languages_id'] == $lInfo->languages_id) ) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $languages['languages_id']) . '\\'\">';\n              }\n\n              if (DEFAULT_LANGUAGE == $languages['code']) {\n                echo '<th>' . $languages['name'] . ' (' . TEXT_DEFAULT . ')</th>';\n              } else {\n                echo '<td>' . $languages['name'] . '</td>';\n              }\n              ?>\n                <td><?php echo $languages['code']; ?></td>\n                <td><?php echo tep_image(tep_catalog_href_link('includes/languages/' . $languages['directory'] . '/images/' . $languages['image'], '', 'SSL')); ?></td>\n                <td class=\"text-right\"><?php if (isset($lInfo) && is_object($lInfo) && ($languages['languages_id'] == $lInfo->languages_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $languages['languages_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $languages_split->display_count($languages_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_LANGUAGES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $languages_split->display_links($languages_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_LANGUAGE];\n\n      $contents = ['form' => tep_draw_form('languages', 'languages.php', 'action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_NAME, null) . '<br>' . tep_draw_input_field('name')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_CODE, null) . '<br>' . tep_draw_input_field('code')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_IMAGE, null) . '<br>' . tep_draw_input_field('image', 'icon.gif')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_DIRECTORY, null, null) . '<br>' . tep_draw_input_field('directory')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_SORT_ORDER, null) . '<br>' . tep_draw_input_field('sort_order')];\n      $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_SET_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('languages.php'), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_LANGUAGE];\n\n      $contents = ['form' => tep_draw_form('languages', 'languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_NAME, null) . '<br>' . tep_draw_input_field('name', $lInfo->name)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_CODE, null) . '<br>' . tep_draw_input_field('code', $lInfo->code)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_IMAGE, null) . '<br>' . tep_draw_input_field('image', $lInfo->image)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_DIRECTORY, null, null) . '<br>' . tep_draw_input_field('directory', $lInfo->directory)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_SORT_ORDER, null) . '<br>' . tep_draw_input_field('sort_order', $lInfo->sort_order)];\n      if (DEFAULT_LANGUAGE != $lInfo->code) $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_SET_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => '<br>' . tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $lInfo->languages_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_LANGUAGE];\n\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $lInfo->name];\n      $contents[] = ['class' => 'text-center', 'text' => (($remove_language) ? tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=deleteconfirm'), null, null, 'btn-danger xxx text-white mr-2') : '') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $lInfo->languages_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($lInfo)) {\n        $heading[] = ['text' => $lInfo->name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('languages.php', 'page=' . (int)$_GET['page'] . '&lID=' . $lInfo->languages_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2')]; \n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DETAILS, 'fas fa-eye', tep_href_link('define_language.php', 'lngdir=' . $lInfo->directory), null, null, 'btn-info xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_DIRECTORY, DIR_WS_CATALOG_LANGUAGES, $lInfo->directory)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_LANGUAGE_SORT_ORDER, $lInfo->sort_order)];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n  \n<?php\n  require 'includes/template_bottom.php';\n  require 'includes/application_bottom.php';\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('manufacturers', 'manufacturersPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n      case 'save':\n        if (isset($_GET['mID'])) $manufacturers_id = tep_db_prepare_input($_GET['mID']);\n        $manufacturers_name = tep_db_prepare_input($_POST['manufacturers_name']);\n\n        $sql_data_array = ['manufacturers_name' => $manufacturers_name];\n\n        if ($action == 'insert') {\n          $insert_sql_data = ['date_added' => 'now()'];\n\n          $sql_data_array = array_merge($sql_data_array, $insert_sql_data);\n\n          tep_db_perform('manufacturers', $sql_data_array);\n          $manufacturers_id = tep_db_insert_id();\n        } elseif ($action == 'save') {\n          $update_sql_data = ['last_modified' => 'now()'];\n\n          $sql_data_array = array_merge($sql_data_array, $update_sql_data);\n\n          tep_db_perform('manufacturers', $sql_data_array, 'update', \"manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n        }\n\n        $manufacturers_image = new upload('manufacturers_image');\n        $manufacturers_image->set_destination(DIR_FS_CATALOG_IMAGES);\n\n        if ($manufacturers_image->parse() && $manufacturers_image->save()) {\n          tep_db_query(\"update manufacturers set manufacturers_image = '\" . tep_db_input($manufacturers_image->filename) . \"' where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n        }\n\n        $languages = tep_get_languages();\n        for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n          $manufacturers_url_array = $_POST['manufacturers_url'];\n          $manufacturers_description_array = $_POST['manufacturers_description'];\n          $manufacturers_seo_description_array = $_POST['manufacturers_seo_description'];\n          $manufacturers_seo_keywords_array = $_POST['manufacturers_seo_keywords'];\n          $manufacturers_seo_title_array = $_POST['manufacturers_seo_title'];\n          $language_id = $languages[$i]['id'];\n\n          $sql_data_array = ['manufacturers_url' => tep_db_prepare_input($manufacturers_url_array[$language_id])];\n          $sql_data_array['manufacturers_description'] = tep_db_prepare_input($manufacturers_description_array[$language_id]);\n          $sql_data_array['manufacturers_seo_description'] = tep_db_prepare_input($manufacturers_seo_description_array[$language_id]);\n          $sql_data_array['manufacturers_seo_keywords'] = tep_db_prepare_input($manufacturers_seo_keywords_array[$language_id]);\n          $sql_data_array['manufacturers_seo_title'] = tep_db_prepare_input($manufacturers_seo_title_array[$language_id]);\n\n          if ($action == 'insert') {\n            $insert_sql_data = ['manufacturers_id' => $manufacturers_id, 'languages_id' => $language_id];\n\n            $sql_data_array = array_merge($sql_data_array, $insert_sql_data);\n\n            tep_db_perform('manufacturers_info', $sql_data_array);\n          } elseif ($action == 'save') {\n            tep_db_perform('manufacturers_info', $sql_data_array, 'update', \"manufacturers_id = '\" . (int)$manufacturers_id . \"' and languages_id = '\" . (int)$language_id . \"'\");\n          }\n        }\n        \n        $OSCOM_Hooks->call('manufacturers', 'manufacturersActionSave');\n\n        tep_redirect(tep_href_link('manufacturers.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'mID=' . $manufacturers_id));\n        break;\n      case 'deleteconfirm':\n        $manufacturers_id = tep_db_prepare_input($_GET['mID']);\n\n        if (isset($_POST['delete_image']) && ($_POST['delete_image'] == 'on')) {\n          $manufacturer_query = tep_db_query(\"select manufacturers_image from manufacturers where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n          $manufacturer = tep_db_fetch_array($manufacturer_query);\n\n          $image_location = DIR_FS_DOCUMENT_ROOT . DIR_WS_CATALOG_IMAGES . $manufacturer['manufacturers_image'];\n\n          if (file_exists($image_location)) @unlink($image_location);\n        }\n\n        tep_db_query(\"delete from manufacturers where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n        tep_db_query(\"delete from manufacturers_info where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n\n        if (isset($_POST['delete_products']) && ($_POST['delete_products'] == 'on')) {\n          $products_query = tep_db_query(\"select products_id from products where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n          while ($products = tep_db_fetch_array($products_query)) {\n            tep_remove_product($products['products_id']);\n          }\n        } else {\n          tep_db_query(\"update products set manufacturers_id = '' where manufacturers_id = '\" . (int)$manufacturers_id . \"'\");\n        }\n        \n        $OSCOM_Hooks->call('manufacturers', 'manufacturersActionDelete');\n\n        tep_redirect(tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('manufacturers', 'manufacturersPostAction');\n\n  require('includes/template_top.php');\n?>\n  \n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(BUTTON_INSERT_NEW_MANUFACTURER, 'fas fa-id-card', tep_href_link('manufacturers.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('manufacturers.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_MANUFACTURERS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $manufacturers_query_raw = \"select * from manufacturers order by manufacturers_name\";\n            $manufacturers_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $manufacturers_query_raw, $manufacturers_query_numrows);\n            $manufacturers_query = tep_db_query($manufacturers_query_raw);\n            while ($manufacturers = tep_db_fetch_array($manufacturers_query)) {\n              if ((!isset($_GET['mID']) || (isset($_GET['mID']) && ($_GET['mID'] == $manufacturers['manufacturers_id']))) && !isset($mInfo) && (substr($action, 0, 3) != 'new')) {\n                $manufacturer_products_query = tep_db_query(\"select count(*) as products_count from products where manufacturers_id = '\" . (int)$manufacturers['manufacturers_id'] . \"'\");\n                $manufacturer_products = tep_db_fetch_array($manufacturer_products_query);\n\n                $mInfo_array = array_merge($manufacturers, $manufacturer_products);\n                $mInfo = new objectInfo($mInfo_array);\n              }\n\n              if (isset($mInfo) && is_object($mInfo) && ($manufacturers['manufacturers_id'] == $mInfo->manufacturers_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . (int)$manufacturers['manufacturers_id'] . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . (int)$manufacturers['manufacturers_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $manufacturers['manufacturers_name']; ?></td>\n                <td class=\"text-right\"><?php if (isset($mInfo) && is_object($mInfo) && ($manufacturers['manufacturers_id'] == $mInfo->manufacturers_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . $manufacturers['manufacturers_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n<?php\n  }\n?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $manufacturers_split->display_count($manufacturers_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_MANUFACTURERS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $manufacturers_split->display_links($manufacturers_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n  \n  $col = 6;\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_HEADING_NEW_MANUFACTURER];\n\n      $contents = ['form' => tep_draw_form('manufacturers', 'manufacturers.php', 'action=insert', 'post', 'enctype=\"multipart/form-data\"')];\n      $contents[] = ['text' => TEXT_NEW_INTRO];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_NAME . '<br>' . tep_draw_input_field('manufacturers_name')];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_IMAGE . '<br><div class=\"custom-file mb-2\">' . tep_draw_input_field('manufacturers_image', '', 'id=\"inputManufacturersImage\"', 'file', null, 'class=\"form-control-input\"') . '<label class=\"custom-file-label\" for=\"inputManufacturersImage\">' . TEXT_MANUFACTURERS_IMAGE_LABEL . '</label></div>'];\n\n      $manufacturer_inputs_string = $manufacturer_description_string = $manufacturer_seo_description_string = $manufacturer_seo_keywords_string = $manufacturer_seo_title_string = '';\n\n      $languages = tep_get_languages();\n      for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n        $manufacturer_inputs_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_url[' . $languages[$i]['id'] . ']') . '</div>';\n        $manufacturer_description_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name'], '', '', 'style=\"vertical-align: top;\"') . '</span></div>' . tep_draw_textarea_field('manufacturers_description[' . $languages[$i]['id'] . ']', 'soft', '80', '10') . '</div>';\n        $manufacturer_seo_description_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name'], '', '', 'style=\"vertical-align: top;\"') . '</span></div>' . tep_draw_textarea_field('manufacturers_seo_description[' . $languages[$i]['id'] . ']', 'soft', '80', '10') . '</div>';\n        $manufacturer_seo_keywords_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_seo_keywords[' . $languages[$i]['id'] . ']', NULL, 'placeholder=\"' . PLACEHOLDER_COMMA_SEPARATION . '\"') . '</div>';\n        $manufacturer_seo_title_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_seo_title[' . $languages[$i]['id'] . ']') . '</div>';\n      }\n\n      $contents[] = ['text' => TEXT_MANUFACTURERS_URL . $manufacturer_inputs_string];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_SEO_TITLE . $manufacturer_seo_title_string];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_DESCRIPTION . $manufacturer_description_string];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_SEO_DESCRIPTION . $manufacturer_seo_description_string];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_SEO_KEYWORDS . $manufacturer_seo_keywords_string];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('manufacturers.php'), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_HEADING_EDIT_MANUFACTURER . ' <small>' . TEXT_EDIT_INTRO . '</small>'];\n\n      $contents = ['form' => tep_draw_form('manufacturers', 'manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . $mInfo->manufacturers_id . '&action=save', 'post', 'enctype=\"multipart/form-data\"')];\n      $contents[] = ['text' => TEXT_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_NAME . '<br>' . tep_draw_input_field('manufacturers_name', $mInfo->manufacturers_name)];\n      $contents[] = ['text' => TEXT_MANUFACTURERS_IMAGE . '<br><div class=\"custom-file mb-2\">' . tep_draw_input_field('manufacturers_image', '', 'id=\"inputManufacturersImage\"', 'file', null, 'class=\"form-control-input\"') . '<label class=\"custom-file-label\" for=\"inputManufacturersImage\">' . $mInfo->manufacturers_image . '</label></div>'];\n      \n      $manufacturer_inputs_string = $manufacturer_description_string = $manufacturer_seo_description_string = $manufacturer_seo_keywords_string = $manufacturer_seo_title_string = '';\n      $languages = tep_get_languages();\n      for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n        \n        $manufacturer_inputs_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_url[' . $languages[$i]['id'] . ']', tep_get_manufacturer_url($mInfo->manufacturers_id, $languages[$i]['id'])) . '</div>';\n        $manufacturer_seo_title_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_seo_title[' . $languages[$i]['id'] . ']', tep_get_manufacturer_seo_title($mInfo->manufacturers_id, $languages[$i]['id'])) . '</div>';\n        $manufacturer_description_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name'], '', '', 'style=\"vertical-align: top;\"') . '</span></div>' . tep_draw_textarea_field('manufacturers_description[' . $languages[$i]['id'] . ']', 'soft', '80', '10', tep_get_manufacturer_description($mInfo->manufacturers_id, $languages[$i]['id'])) . '</div>';\n        $manufacturer_seo_description_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name'], '', '', 'style=\"vertical-align: top;\"') . '</span></div>' . tep_draw_textarea_field('manufacturers_seo_description[' . $languages[$i]['id'] . ']', 'soft', '80', '10', tep_get_manufacturer_seo_description($mInfo->manufacturers_id, $languages[$i]['id'])) . '</div>';\n        $manufacturer_seo_keywords_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('manufacturers_seo_keywords[' . $languages[$i]['id'] . ']', tep_get_manufacturer_seo_keywords($mInfo->manufacturers_id, $languages[$i]['id']), 'placeholder=\"' . PLACEHOLDER_COMMA_SEPARATION . '\"') . '</div>';\n      }\n\n      $contents[] = ['text' => TEXT_MANUFACTURERS_URL . $manufacturer_inputs_string];\n      $contents[] = ['text' => TEXT_EDIT_MANUFACTURERS_SEO_TITLE . $manufacturer_seo_title_string];\n      $contents[] = ['text' => TEXT_EDIT_MANUFACTURERS_DESCRIPTION . $manufacturer_description_string];\n      $contents[] = ['text' => TEXT_EDIT_MANUFACTURERS_SEO_DESCRIPTION . $manufacturer_seo_description_string];\n      $contents[] = ['text' => TEXT_EDIT_MANUFACTURERS_SEO_KEYWORDS . $manufacturer_seo_keywords_string];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . (int)$mInfo->manufacturers_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $col = 3;\n      $heading[] = ['text' =>  TEXT_HEADING_DELETE_MANUFACTURER];\n\n      $contents = ['form' => tep_draw_form('manufacturers', 'manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . $mInfo->manufacturers_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_DELETE_INTRO];\n      $contents[] = ['text' => '<strong>' . $mInfo->manufacturers_name . '</strong>'];\n      $contents[] = ['text' => tep_draw_checkbox_field('delete_image', '', true) . ' ' . TEXT_DELETE_IMAGE];\n\n      if ($mInfo->products_count > 0) {\n        $contents[] = ['text' => tep_draw_checkbox_field('delete_products') . ' ' . TEXT_DELETE_PRODUCTS];\n        $contents[] = ['text' => sprintf(TEXT_DELETE_WARNING_PRODUCTS, $mInfo->products_count)];\n      }\n\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . $mInfo->manufacturers_id), null, null, 'btn-light')];\n      break;\n    default:\n      $col = 3;\n      if (isset($mInfo) && is_object($mInfo)) {\n        $heading[] = ['text' => $mInfo->manufacturers_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . $mInfo->manufacturers_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('manufacturers.php', 'page=' . (int)$_GET['page'] . '&mID=' . $mInfo->manufacturers_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_DATE_ADDED, tep_date_short($mInfo->date_added))];\n        if (tep_not_null($mInfo->last_modified)) $contents[] = ['text' => sprintf(TEXT_LAST_MODIFIED, tep_date_short($mInfo->last_modified))];\n        $contents[] = ['text' => tep_info_image($mInfo->manufacturers_image, $mInfo->manufacturers_name)];\n        $contents[] = ['text' => sprintf(TEXT_PRODUCTS, $mInfo->products_count)];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-' . $col . '\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n  \n  <script>$(document).on('change', '#inputManufacturersImage', function (event) { $(this).next('.custom-file-label').html(event.target.files[0].name); });</script>  \n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'lock':\n      case 'unlock':\n        $newsletter_id = tep_db_prepare_input($_GET['nID']);\n        $status = (($action == 'lock') ? '1' : '0');\n\n        tep_db_query(\"update newsletters set locked = '\" . $status . \"' where newsletters_id = '\" . (int)$newsletter_id . \"'\");\n\n        tep_redirect(tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID']));\n        break;\n      case 'insert':\n      case 'update':\n        if (isset($_POST['newsletter_id'])) $newsletter_id = tep_db_prepare_input($_POST['newsletter_id']);\n        $newsletter_module = tep_db_prepare_input($_POST['module']);\n        \n        $allowed = array_map(function($v) {return basename($v, '.php');}, glob('includes/modules/newsletters/*.php'));\n        if (!in_array($newsletter_module, $allowed)) {\n          $messageStack->add(ERROR_NEWSLETTER_MODULE_NOT_EXISTS, 'error');\n          $newsletter_error = true;\n        }\n        \n        $title = tep_db_prepare_input($_POST['title']);\n        $content = tep_db_prepare_input($_POST['content']);\n\n        $newsletter_error = false;\n        if (empty($title)) {\n          $messageStack->add(ERROR_NEWSLETTER_TITLE, 'error');\n          $newsletter_error = true;\n        }\n\n        if (empty($newsletter_module)) {\n          $messageStack->add(ERROR_NEWSLETTER_MODULE, 'error');\n          $newsletter_error = true;\n        }\n\n        if ($newsletter_error == false) {\n          $sql_data_array = ['title' => $title,\n                             'content' => $content,\n                             'module' => $newsletter_module];\n\n          if ($action == 'insert') {\n            $sql_data_array['date_added'] = 'now()';\n            $sql_data_array['status'] = '0';\n            $sql_data_array['locked'] = '0';\n\n            tep_db_perform('newsletters', $sql_data_array);\n            $newsletter_id = tep_db_insert_id();\n          } elseif ($action == 'update') {\n            tep_db_perform('newsletters', $sql_data_array, 'update', \"newsletters_id = '\" . (int)$newsletter_id . \"'\");\n          }\n\n          tep_redirect(tep_href_link('newsletters.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'nID=' . $newsletter_id));\n        } else {\n          $action = 'new';\n        }\n        break;\n      case 'deleteconfirm':\n        $newsletter_id = tep_db_prepare_input($_GET['nID']);\n\n        tep_db_query(\"delete from newsletters where newsletters_id = '\" . (int)$newsletter_id . \"'\");\n\n        tep_redirect(tep_href_link('newsletters.php', 'page=' . (int)$_GET['page']));\n        break;\n      case 'delete':\n      case 'new': if (!isset($_GET['nID'])) break;\n      case 'send':\n      case 'confirm_send':\n        $newsletter_id = tep_db_prepare_input($_GET['nID']);\n\n        $check_query = tep_db_query(\"select locked from newsletters where newsletters_id = '\" . (int)$newsletter_id . \"'\");\n        $check = tep_db_fetch_array($check_query);\n\n        if ($check['locked'] < 1) {\n          switch ($action) {\n            case 'delete': $error = ERROR_REMOVE_UNLOCKED_NEWSLETTER; break;\n            case 'new': $error = ERROR_EDIT_UNLOCKED_NEWSLETTER; break;\n            case 'send': $error = ERROR_SEND_UNLOCKED_NEWSLETTER; break;\n            case 'confirm_send': $error = ERROR_SEND_UNLOCKED_NEWSLETTER; break;\n          }\n\n          $messageStack->add_session($error, 'error');\n\n          tep_redirect(tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID']));\n        }\n        break;\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_NEWSLETTER, 'fas fa-newspaper', tep_href_link('newsletters.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      } else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('newsletters.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n\n  <?php\n  if ($action == 'new') {\n    $form_action = 'insert';\n\n    $parameters = ['title' => '', 'content' => '', 'module' => ''];\n\n    $nInfo = new objectInfo($parameters);\n\n    if (isset($_GET['nID'])) {\n      $form_action = 'update';\n\n      $nID = tep_db_prepare_input($_GET['nID']);\n\n      $newsletter_query = tep_db_query(\"select title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n      $newsletter = tep_db_fetch_array($newsletter_query);\n\n      $nInfo->objectInfo($newsletter);\n    } elseif ($_POST) {\n      $nInfo->objectInfo($_POST);\n    }\n\n    $file_extension = substr($PHP_SELF, strrpos($PHP_SELF, '.'));\n    $directory_array = [];\n    if ($dir = dir('includes/modules/newsletters/')) {\n      while ($file = $dir->read()) {\n        if (!is_dir('includes/modules/newsletters/' . $file)) {\n          if (substr($file, strrpos($file, '.')) == $file_extension) {\n            $directory_array[] = $file;\n          }\n        }\n      }\n      sort($directory_array);\n      $dir->close();\n    }\n\n    for ($i=0, $n=sizeof($directory_array); $i<$n; $i++) {\n      $modules_array[] = ['id' => substr($directory_array[$i], 0, strrpos($directory_array[$i], '.')), 'text' => substr($directory_array[$i], 0, strrpos($directory_array[$i], '.'))];\n    }\n\n    echo tep_draw_form('newsletter', 'newsletters.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'action=' . $form_action); if ($form_action == 'update') echo tep_draw_hidden_field('newsletter_id', $nID); ?>\n\n    <div class=\"form-group row\">\n      <label for=\"Module\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_NEWSLETTER_MODULE; ?></label>\n      <div class=\"col-sm-9\">\n        <?php echo tep_draw_pull_down_menu('module', $modules_array, $nInfo->module, 'id=\"Module\" required aria-required=\"true\"'); ?>\n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"Title\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_NEWSLETTER_TITLE; ?></label>\n      <div class=\"col-sm-9\">\n        <?php echo tep_draw_input_field('title', $nInfo->title, 'id=\"Title\" required aria-required=\"true\"'); ?>\n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"Content\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_NEWSLETTER_CONTENT; ?></label>\n      <div class=\"col-sm-9\">\n        <?php echo tep_draw_textarea_field('content', 'soft', '60', '15', $nInfo->content, 'id=\"Content\" required aria-required=\"true\"'); ?>\n      </div>\n    </div>\n\n    <div class=\"buttonSet\">\n      <?php\n      echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success btn-block btn-lg');\n      echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('newsletters.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . (isset($_GET['nID']) ? 'nID=' . (int)$_GET['nID'] : '')), null, null, 'btn-light mt-2');\n      ?>\n    </div>\n\n  </form>\n\n  <?php\n  } elseif ($action == 'preview') {\n    $nID = tep_db_prepare_input($_GET['nID']);\n\n    $newsletter_query = tep_db_query(\"select title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n    $newsletter = tep_db_fetch_array($newsletter_query);\n\n    $nInfo = new objectInfo($newsletter);\n    ?>\n\n    <table class=\"table table-striped\">\n      <tr>\n        <th class=\"w-25\"><?php echo TEXT_TITLE; ?></th>\n        <td><?php echo $nInfo->title; ?></td>\n      </tr>\n      <tr>\n        <th><?php echo TEXT_CONTENT; ?></th>\n        <td><?php echo nl2br($nInfo->content); ?></td>\n      </tr>\n    </table>\n\n    <div class=\"buttonSet\">\n      <?php\n      echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left',  tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID']), 'primary', null, 'btn-light');\n      ?>\n    </div>\n\n<?php\n  } elseif ($action == 'send') {\n    $nID = tep_db_prepare_input($_GET['nID']);\n\n    $newsletter_query = tep_db_query(\"select title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n    $newsletter = tep_db_fetch_array($newsletter_query);\n\n    $nInfo = new objectInfo($newsletter);\n\n    include('includes/languages/' . $language . '/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    include('includes/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    $module_name = $nInfo->module;\n    $module = new $module_name($nInfo->title, $nInfo->content);\n\n    if ($module->show_choose_audience) {\n      echo $module->choose_audience();\n    }\n    else {\n      echo $module->confirm();\n    }\n  } elseif ($action == 'confirm') {\n    $nID = tep_db_prepare_input($_GET['nID']);\n\n    $newsletter_query = tep_db_query(\"select title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n    $newsletter = tep_db_fetch_array($newsletter_query);\n\n    $nInfo = new objectInfo($newsletter);\n\n    include('includes/languages/' . $language . '/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    include('includes/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    $module_name = $nInfo->module;\n    $module = new $module_name($nInfo->title, $nInfo->content);\n\n    echo $module->confirm();\n  } elseif ($action == 'confirm_send') {\n    $nID = tep_db_prepare_input($_GET['nID']);\n\n    $newsletter_query = tep_db_query(\"select newsletters_id, title, content, module from newsletters where newsletters_id = '\" . (int)$nID . \"'\");\n    $newsletter = tep_db_fetch_array($newsletter_query);\n\n    $nInfo = new objectInfo($newsletter);\n\n    include('includes/languages/' . $language . '/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    include('includes/modules/newsletters/' . $nInfo->module . substr($PHP_SELF, strrpos($PHP_SELF, '.')));\n    $module_name = $nInfo->module;\n    $module = new $module_name($nInfo->title, $nInfo->content);\n?>\n\n  <div class=\"alert alert-info\">\n    <i class=\"fas fa-spinner fa-5x fa-spin float-left mr-4\"></i>\n    <?php echo TEXT_PLEASE_WAIT; ?>\n    <div class=\"clearfix\"></div>\n  </div>\n  \n  <?php\n  tep_set_time_limit(0);\n  flush();\n  $module->send($nInfo->newsletters_id);\n  ?>\n  \n  <div class=\"alert alert-success\">\n    <i class=\"fas fa-thumbs-up fa-5x float-left mr-4\"></i>\n    <?php echo TEXT_FINISHED_SENDING_EMAILS; ?>\n    <div class=\"clearfix\"></div>\n  </div>\n  \n  <div class=\"buttonSet\">\n    <?php\n    echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $_GET['nID']), 'primary', null, 'btn-light mt-2');\n    ?>\n  </div>\n\n<?php\n  } else {\n?>\n\n   <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_NEWSLETTERS; ?></th>\n              <th><?php echo TABLE_HEADING_MODULE; ?></th>\n              <th><?php echo TABLE_HEADING_DATE_ADDED; ?></th>\n              <th><?php echo TABLE_HEADING_SIZE; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_SENT; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n          <?php\n          $newsletters_query_raw = \"select *, length(content) as content_length from newsletters order by date_added desc\";\n          $newsletters_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $newsletters_query_raw, $newsletters_query_numrows);\n          $newsletters_query = tep_db_query($newsletters_query_raw);\n          while ($newsletters = tep_db_fetch_array($newsletters_query)) {\n          if ((!isset($_GET['nID']) || (isset($_GET['nID']) && ($_GET['nID'] == $newsletters['newsletters_id']))) && !isset($nInfo) && (substr($action, 0, 3) != 'new')) {\n              $nInfo = new objectInfo($newsletters);\n            }\n\n            if (isset($nInfo) && is_object($nInfo) && ($newsletters['newsletters_id'] == $nInfo->newsletters_id) ) {\n              echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=preview') . '\\'\">';\n            } else {\n              echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$newsletters['newsletters_id']) . '\\'\">';\n            }\n            ?>\n              <th><?php echo $newsletters['title']; ?></th>\n              <td><?php echo $newsletters['module']; ?></td>\n              <td><?php echo tep_date_short($newsletters['date_added']); ?></td>\n              <td><?php echo number_format($newsletters['content_length']) . ' bytes'; ?></td>\n              <td class=\"text-center\"><?php if ($newsletters['status'] == '1') { echo '<i class=\"fas fa-check-circle text-success\"></i>'; } else { echo '<i class=\"fas fa-times-circle text-danger\"></i>'; } ?></td>\n              <td class=\"text-center\"><?php if ($newsletters['locked'] > 0) { echo '<i class=\"fas fa-lock text-success\"></i>'; } else { echo '<i class=\"fas fa-lock-open text-danger\"></i>'; } ?></td>\n              <td class=\"text-right\"><?php if (isset($nInfo) && is_object($nInfo) && ($newsletters['newsletters_id'] == $nInfo->newsletters_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . $newsletters['newsletters_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n            </tr>\n            <?php\n          }\n          ?>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $newsletters_split->display_count($newsletters_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_NEWSLETTERS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $newsletters_split->display_links($newsletters_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'delete':\n      $heading[] = ['text' => $nInfo->title];\n\n      $contents = ['form' => tep_draw_form('newsletters', 'newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['text' => '<strong>' . $nInfo->title . '</strong>'];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$_GET['nID']), null, null, 'btn-light')];\n      break;\n    default:\n      if (isset($nInfo) && is_object($nInfo)) {\n        $heading[] = ['text' => $nInfo->title];\n\n        if ($nInfo->locked > 0) {\n          $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=new'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_PREVIEW, 'fas fa-eye', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=preview'), null, null, 'btn-info xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_SEND, 'fas fa-paper-plane', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=send'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_UNLOCK, 'fas fa-lock-open', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=unlock'), null, null, 'btn-warning')];\n        } else {\n          $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_PREVIEW, 'fas fa-eye', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=preview'), null, null, 'bt-info xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_LOCK, 'fas fa-lock', tep_href_link('newsletters.php', 'page=' . (int)$_GET['page'] . '&nID=' . (int)$nInfo->newsletters_id . '&action=lock'), null, null, 'btn-warning')];\n        }\n        $contents[] = ['text' => sprintf(TEXT_NEWSLETTER_DATE_ADDED, tep_date_short($nInfo->date_added))];\n        if ($nInfo->status == '1') $contents[] = ['text' => sprintf(TEXT_NEWSLETTER_DATE_SENT, tep_date_short($nInfo->date_sent))];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  }\n\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2013 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('orders_status', 'PreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n      case 'save':\n        if (isset($_GET['oID'])) $orders_status_id = tep_db_prepare_input($_GET['oID']);\n\n        $languages = tep_get_languages();\n        for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n          $orders_status_name_array = $_POST['orders_status_name'];\n          $language_id = $languages[$i]['id'];\n\n          $sql_data_array = ['orders_status_name' => tep_db_prepare_input($orders_status_name_array[$language_id]),\n                             'public_flag' => ((isset($_POST['public_flag']) && ($_POST['public_flag'] == '1')) ? '1' : '0'),\n                             'downloads_flag' => ((isset($_POST['downloads_flag']) && ($_POST['downloads_flag'] == '1')) ? '1' : '0')];\n\n          if ($action == 'insert') {\n            if (empty($orders_status_id)) {\n              $next_id_query = tep_db_query(\"select max(orders_status_id) as orders_status_id from orders_status\");\n              $next_id = tep_db_fetch_array($next_id_query);\n              $orders_status_id = $next_id['orders_status_id'] + 1;\n            }\n\n            $insert_sql_data = ['orders_status_id' => $orders_status_id, 'language_id' => $language_id];\n\n            $sql_data_array = array_merge($sql_data_array, $insert_sql_data);\n\n            tep_db_perform('orders_status', $sql_data_array);\n          } elseif ($action == 'save') {\n            tep_db_perform('orders_status', $sql_data_array, 'update', \"orders_status_id = '\" . (int)$orders_status_id . \"' and language_id = '\" . (int)$language_id . \"'\");\n          }\n        }\n\n        if (isset($_POST['default']) && ($_POST['default'] == 'on')) {\n          tep_db_query(\"update configuration set configuration_value = '\" . tep_db_input($orders_status_id) . \"' where configuration_key = 'DEFAULT_ORDERS_STATUS_ID'\");\n        }\n        \n        $OSCOM_Hooks->call('orders_status', 'InsertSave');\n\n        tep_redirect(tep_href_link('orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $orders_status_id));\n        break;\n      case 'deleteconfirm':\n        $oID = tep_db_prepare_input($_GET['oID']);\n\n        $orders_status_query = tep_db_query(\"select configuration_value from configuration where configuration_key = 'DEFAULT_ORDERS_STATUS_ID'\");\n        $orders_status = tep_db_fetch_array($orders_status_query);\n\n        if ($orders_status['configuration_value'] == $oID) {\n          tep_db_query(\"update configuration set configuration_value = '' where configuration_key = 'DEFAULT_ORDERS_STATUS_ID'\");\n        }\n\n        tep_db_query(\"delete from orders_status where orders_status_id = '\" . tep_db_input($oID) . \"'\");\n        \n        $OSCOM_Hooks->call('orders_status', 'DeleteConfirm');\n\n        tep_redirect(tep_href_link('orders_status.php', 'page=' . (int)$_GET['page']));\n        break;\n      case 'delete':\n        $oID = tep_db_prepare_input($_GET['oID']);\n\n        $status_query = tep_db_query(\"select count(*) as count from orders where orders_status = '\" . (int)$oID . \"'\");\n        $status = tep_db_fetch_array($status_query);\n\n        $remove_status = true;\n        if ($oID == DEFAULT_ORDERS_STATUS_ID) {\n          $remove_status = false;\n          $messageStack->add(ERROR_REMOVE_DEFAULT_ORDER_STATUS, 'error');\n        } elseif ($status['count'] > 0) {\n          $remove_status = false;\n          $messageStack->add(ERROR_STATUS_USED_IN_ORDERS, 'error');\n        } else {\n          $history_query = tep_db_query(\"select count(*) as count from orders_status_history where orders_status_id = '\" . (int)$oID . \"'\");\n          $history = tep_db_fetch_array($history_query);\n          if ($history['count'] > 0) {\n            $remove_status = false;\n            $messageStack->add(ERROR_STATUS_USED_IN_HISTORY, 'error');\n          }\n        }\n        \n        $OSCOM_Hooks->call('orders_status', 'Delete');\n        \n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('orders_status', 'PostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_INSERT, 'fas fa-cogs', tep_href_link('orders_status.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('orders_status.php'), null, null, 'btn-light');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_ORDERS_STATUS; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_PUBLIC_STATUS; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_DOWNLOADS_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $orders_status_query_raw = \"select * from orders_status where language_id = '\" . (int)$languages_id . \"' order by orders_status_id\";\n            $orders_status_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $orders_status_query_raw, $orders_status_query_numrows);\n            $orders_status_query = tep_db_query($orders_status_query_raw);\n            while ($orders_status = tep_db_fetch_array($orders_status_query)) {\n              if ((!isset($_GET['oID']) || (isset($_GET['oID']) && ($_GET['oID'] == $orders_status['orders_status_id']))) && !isset($oInfo) && (substr($action, 0, 3) != 'new')) {\n                $oInfo = new objectInfo($orders_status);\n              }\n\n              if (isset($oInfo) && is_object($oInfo) && ($orders_status['orders_status_id'] == $oInfo->orders_status_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $oInfo->orders_status_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $orders_status['orders_status_id']) . '\\'\">';\n              }\n\n              if (DEFAULT_ORDERS_STATUS_ID == $orders_status['orders_status_id']) {\n                echo '<th>' . $orders_status['orders_status_name'] . ' (' . TEXT_DEFAULT . ')</th>';\n              } else {\n                echo '<td>' . $orders_status['orders_status_name'] . '</td>';\n              }\n              ?>\n                <td class=\"text-center\"><?php echo ($orders_status['public_flag'] == '1') ? '<i class=\"fas fa-check-circle text-success\"></i>' : '<i class=\"fas fa-times-circle text-danger\"></i>'; ?></td>\n                <td class=\"text-center\"><?php echo ($orders_status['downloads_flag'] == '1') ? '<i class=\"fas fa-check-circle text-success\"></i>' : '<i class=\"fas fa-times-circle text-danger\"></i>'; ?></td>\n                <td class=\"text-right\"><?php if (isset($oInfo) && is_object($oInfo) && ($orders_status['orders_status_id'] == $oInfo->orders_status_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $orders_status['orders_status_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $orders_status_split->display_count($orders_status_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_ORDERS_STATUS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $orders_status_split->display_links($orders_status_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_ORDERS_STATUS];\n\n      $contents = ['form' => tep_draw_form('status', 'orders_status.php', 'page=' . (int)$_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n\n      $orders_status_inputs_string = '';\n      $languages = tep_get_languages();\n      for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n        $orders_status_inputs_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('orders_status_name[' . $languages[$i]['id'] . ']') . '</div>';\n      }\n\n      $contents[] = ['text' => TEXT_INFO_ORDERS_STATUS_NAME . $orders_status_inputs_string];\n      $contents[] = ['text' => tep_draw_checkbox_field('public_flag', '1') . ' ' . TEXT_SET_PUBLIC_STATUS];\n      $contents[] = ['text' => tep_draw_checkbox_field('downloads_flag', '1') . ' ' . TEXT_SET_DOWNLOADS_STATUS];\n      $contents[] = ['text' => tep_draw_checkbox_field('default') . ' ' . TEXT_SET_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('orders_status.php', 'page=' . (int)$_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_ORDERS_STATUS];\n\n      $contents = ['form' => tep_draw_form('status', 'orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $oInfo->orders_status_id  . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n\n      $orders_status_inputs_string = '';\n      $languages = tep_get_languages();\n      for ($i=0, $n=sizeof($languages); $i<$n; $i++) {\n        $orders_status_inputs_string .= '<div class=\"input-group\"><div class=\"input-group-prepend\"><span class=\"input-group-text\">' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '</span></div>' . tep_draw_input_field('orders_status_name[' . $languages[$i]['id'] . ']', tep_get_orders_status_name($oInfo->orders_status_id, $languages[$i]['id'])) . '</div>';\n      }\n\n      $contents[] = ['text' => TEXT_INFO_ORDERS_STATUS_NAME . $orders_status_inputs_string];\n      $contents[] = ['text' => tep_draw_checkbox_field('public_flag', '1', $oInfo->public_flag) . ' ' . TEXT_SET_PUBLIC_STATUS];\n      $contents[] = ['text' => tep_draw_checkbox_field('downloads_flag', '1', $oInfo->downloads_flag) . ' ' . TEXT_SET_DOWNLOADS_STATUS];\n      if (DEFAULT_ORDERS_STATUS_ID != $oInfo->orders_status_id) $contents[] = ['text' => '<br>' . tep_draw_checkbox_field('default') . ' ' . TEXT_SET_DEFAULT];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $oInfo->orders_status_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_ORDERS_STATUS];\n\n      $contents = ['form' => tep_draw_form('status', 'orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $oInfo->orders_status_id  . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $oInfo->orders_status_name];\n      if ($remove_status) $contents[] = ['class' => 'text-center', 'text' => '<br>' . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, null, null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $oInfo->orders_status_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (isset($oInfo) && is_object($oInfo)) {\n        $heading[] = ['text' => $oInfo->orders_status_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs',  tep_href_link('orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $oInfo->orders_status_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('orders_status.php', 'page=' . (int)$_GET['page'] . '&oID=' . $oInfo->orders_status_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n\n        $orders_status_inputs_string = '';\n        $languages = tep_get_languages();\n        for ($i = 0, $n = sizeof($languages); $i < $n; $i++) {\n          $orders_status_inputs_string .= '<br>' . tep_image(tep_catalog_href_link('includes/languages/' . $languages[$i]['directory'] . '/images/' . $languages[$i]['image'], '', 'SSL'), $languages[$i]['name']) . '&nbsp;' . tep_get_orders_status_name($oInfo->orders_status_id, $languages[$i]['id']);\n        }\n\n        $contents[] = ['text' => $orders_status_inputs_string];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n  \n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('reviews', 'reviewPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'setflag':\n        tep_set_review_status($_GET['rID'], $_GET['flag']);\n        \n        $OSCOM_Hooks->call('reviews', 'reviewActionStatus');\n\n        tep_redirect(tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $_GET['rID']));\n        break;\n      case 'update':\n        $reviews_id = tep_db_prepare_input($_GET['rID']);\n        $reviews_rating = tep_db_prepare_input($_POST['reviews_rating']);\n        $reviews_text = tep_db_prepare_input($_POST['reviews_text']);\n        $reviews_status = tep_db_prepare_input($_POST['reviews_status']);\n\n        tep_db_query(\"update reviews set reviews_rating = '\" . tep_db_input($reviews_rating) . \"', reviews_status = '\" . tep_db_input($reviews_status) . \"', last_modified = now() where reviews_id = '\" . (int)$reviews_id . \"'\");\n        tep_db_query(\"update reviews_description set reviews_text = '\" . tep_db_input($reviews_text) . \"' where reviews_id = '\" . (int)$reviews_id . \"'\");\n        \n        $OSCOM_Hooks->call('reviews', 'reviewActionUpdate');\n\n        tep_redirect(tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $reviews_id));\n        break;\n      case 'deleteconfirm':\n        $reviews_id = tep_db_prepare_input($_GET['rID']);\n\n        tep_db_query(\"delete from reviews where reviews_id = '\" . (int)$reviews_id . \"'\");\n        tep_db_query(\"delete from reviews_description where reviews_id = '\" . (int)$reviews_id . \"'\");\n        \n        $OSCOM_Hooks->call('reviews', 'reviewActionDelete');\n\n        tep_redirect(tep_href_link('reviews.php', 'page=' . (int)$_GET['page']));\n        break;\n      case 'addnew':\n        $products_id = tep_db_prepare_input($_POST['products_id']);\n        $customers_id = tep_db_prepare_input($_POST['customer_id']);\n        $review = tep_db_prepare_input($_POST['reviews_text']);\n        $rating = tep_db_prepare_input($_POST['reviews_rating']);\n\n        tep_db_query(\"insert into reviews (products_id, customers_id, customers_name, reviews_rating, date_added, reviews_status) values ('\" . (int)$products_id . \"', '\" . (int)$customers_id . \"', '\" . tep_customers_name($customers_id) . \"', '\" . (int)$rating . \"', now(), 1)\");\n        $insert_id = tep_db_insert_id();\n        tep_db_query(\"insert into reviews_description (reviews_id, languages_id, reviews_text) values ('\" . (int)$insert_id . \"', '\" . (int)$languages_id . \"', '\" . $review . \"')\");\n        \n        $OSCOM_Hooks->call('reviews', 'reviewActionSave');\n\n        tep_redirect(tep_href_link('reviews.php', tep_get_all_get_params(['action'])));\n        break;   \n    }\n  }\n  \n  $OSCOM_Hooks->call('reviews', 'reviewPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_BUTTON_ADD_REVIEW, 'fas fa-star', tep_href_link('reviews.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else if ($action == \"new\") {\n        echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('reviews.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n\n  <?php\n  if ( ($action == 'new') || ($action == 'edit') ) {\n    $form_action = 'addnew';\n    if ( ($action == 'edit') && isset($_GET['rID']) ) {\n      $form_action = 'preview';\n\n      $rID = tep_db_prepare_input($_GET['rID']);\n\n      $reviews_query = tep_db_query(\"select r.*, rd.* from reviews r, reviews_description rd where r.reviews_id = '\" . (int)$rID . \"' and r.reviews_id = rd.reviews_id\");\n      $reviews = tep_db_fetch_array($reviews_query);\n\n      $products_query = tep_db_query(\"select products_image from products where products_id = '\" . (int)$reviews['products_id'] . \"'\");\n      $products = tep_db_fetch_array($products_query);\n\n      $products_name_query = tep_db_query(\"select products_name from products_description where products_id = '\" . (int)$reviews['products_id'] . \"' and language_id = '\" . (int)$languages_id . \"'\");\n      $products_name = tep_db_fetch_array($products_name_query);\n\n      $rInfo_array = array_merge($reviews, $products, $products_name);\n      $rInfo = new objectInfo($rInfo_array);\n\n      if (!isset($rInfo->reviews_status)) $rInfo->reviews_status = '1';\n      switch ($rInfo->reviews_status) {\n        case '0': $in_status = false; $out_status = true; break;\n        case '1':\n        default: $in_status = true; $out_status = false;\n      }\n    } else {\n      $rInfo = new objectInfo([]);\n    }\n    \n    if ($form_action == 'preview') {\n      echo tep_draw_form('review', 'reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $_GET['rID'] . '&action=' . $form_action);\n      echo tep_draw_hidden_field('reviews_id', $rInfo->reviews_id) . tep_draw_hidden_field('reviews_status', $rInfo->reviews_status) . tep_draw_hidden_field('products_id', $rInfo->products_id) . tep_draw_hidden_field('products_image', $rInfo->products_image) . tep_draw_hidden_field('date_added', $rInfo->date_added); \n    } else {\n      echo tep_draw_form('review', 'reviews.php', 'action=' . $form_action);\n    }\n?>\n    <div class=\"form-group row\">\n      <label for=\"reviewProduct\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_PRODUCT; ?></label>\n      <div class=\"col-sm-9\">\n        <?php \n        if (isset($rInfo->products_name)) { \n          echo tep_draw_input_field('products_name', $rInfo->products_name, 'readonly class=\"form-control-plaintext\"'); \n        } \n        else { \n          echo tep_draw_products('products_id', 'id=\"reviewProduct\" class=\"form-control\" required aria-required=\"true\"'); \n        } \n        ?>     \n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"reviewCustomer\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM; ?></label>\n      <div class=\"col-sm-9\">\n        <?php \n        if (isset($rInfo->customers_name)) { \n          echo tep_draw_input_field('customers_name', $rInfo->customers_name, 'readonly class=\"form-control-plaintext\"'); \n        } \n        else { \n          echo tep_draw_customers('customer_id', 'id=\"reviewCustomer\" class=\"form-control\" required aria-required=\"true\"'); \n        } \n        ?>     \n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"reviewRating\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_RATING; ?></label>\n      <div class=\"col-sm-9\"><div class=\"form-check form-check-inline\">\n        <label class=\"form-check-label font-weight-bold text-danger mr-1\" for=\"rating_1\"><?php echo TEXT_BAD; ?></label>\n        <?php \n        for ($i=1; $i<=5; $i++) { \n          echo tep_draw_selection_field('reviews_rating', 'radio', $i, (isset($rInfo->reviews_rating)?(($i == $rInfo->reviews_rating) ? true : false) : ($i == 5) ? true : false), 'class=\"form-check-input\" id=\"rating_' . $i . '\"'); \n        } \n        ?>\n        <label class=\"form-check-label font-weight-bold text-danger\" for=\"rating_5\"><?php echo TEXT_GOOD; ?></label></div>   \n      </div>\n    </div>\n\n    <div class=\"form-group row\">\n      <label for=\"reviewReview\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_REVIEW; ?></label>\n      <div class=\"col-sm-9\"><?php echo tep_draw_textarea_field('reviews_text', null, null, '5', $rInfo->reviews_text ?? '', 'class=\"form-control\" required aria-required=\"true\"') . ENTRY_REVIEW_TEXT; ?>     \n      </div>\n    </div>\n\n    <?php\n    echo $OSCOM_Hooks->call('reviews', 'reviewFormEdit');\n    echo $OSCOM_Hooks->call('reviews', 'reviewFormNew');\n    ?>\n \n    <div class=\"text-right\">\n      <?php \n      if ($action != 'new') {\n        echo tep_draw_bootstrap_button(IMAGE_PREVIEW, 'fas fa-eye', null, null, null, 'btn-info mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $_GET['rID']), null, null, 'btn-light');\n      } else {\n        echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2');\n      }\n      ?>\n    </div>\n    \n  </form>\n<?php\n  } elseif ($action == 'preview') {\n    if (tep_not_null($_POST)) {\n      $rInfo = new objectInfo($_POST);\n      echo tep_draw_form('update', 'reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $_GET['rID'] . '&action=update', 'post', 'enctype=\"multipart/form-data\"');\n    } else {\n      $rID = tep_db_prepare_input($_GET['rID']);\n\n      $reviews_query = tep_db_query(\"select r.*, rd.* from reviews r, reviews_description rd where r.reviews_id = '\" . (int)$rID . \"' and r.reviews_id = rd.reviews_id\");\n      $reviews = tep_db_fetch_array($reviews_query);\n\n      $products_query = tep_db_query(\"select products_image from products where products_id = '\" . (int)$reviews['products_id'] . \"'\");\n      $products = tep_db_fetch_array($products_query);\n\n      $products_name_query = tep_db_query(\"select products_name from products_description where products_id = '\" . (int)$reviews['products_id'] . \"' and language_id = '\" . (int)$languages_id . \"'\");\n      $products_name = tep_db_fetch_array($products_name_query);\n\n      $rInfo_array = array_merge($reviews, $products, $products_name);\n      $rInfo = new objectInfo($rInfo_array);\n    }\n?>\n    <div class=\"row\">\n      <div class=\"col-sm-10\">\n        <div class=\"form-group row\">\n          <label for=\"reviewProduct\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_PRODUCT; ?></label>\n          <div class=\"col-sm-9\"><?php echo $rInfo->products_name; ?></div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label for=\"reviewCustomer\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM; ?></label>\n          <div class=\"col-sm-9\"><?php echo $rInfo->customers_name; ?></div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label for=\"reviewDate\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_DATE; ?></label>\n          <div class=\"col-sm-9\"><?php echo tep_date_short($rInfo->date_added); ?></div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label for=\"reviewRating\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_RATING; ?></label>\n          <div class=\"col-sm-9\"><?php echo tep_draw_stars($rInfo->reviews_rating); ?></div>   \n        </div>\n\n        <div class=\"form-group row\">\n          <label for=\"reviewReview\" class=\"col-sm-3 text-left text-sm-right\"><?php echo ENTRY_REVIEW; ?></label>\n          <div class=\"col-sm-9\"><?php echo $rInfo->reviews_text; ?></div>\n        </div>\n      </div>\n      <div class=\"col-sm-2 text-right\"><?php echo tep_image(HTTP_CATALOG_SERVER . DIR_WS_CATALOG_IMAGES . $rInfo->products_image, $rInfo->products_name, SMALL_IMAGE_WIDTH, SMALL_IMAGE_HEIGHT); ?></div>\n    </div>\n\n<?php\n    echo $OSCOM_Hooks->call('reviews', 'reviewFormPreview');\n    \n    if (tep_not_null($_POST)) {\n/* Re-Post all POST'ed variables */\n      foreach($_POST as $key => $value) {\n        echo tep_draw_hidden_field($key, htmlspecialchars(stripslashes($value)));\n      }\n?>\n    <div class=\"text-right\">\n        <?php echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $rInfo->reviews_id), null, null, 'btn-light'); ?>\n    </div>\n  </form>\n<?php\n    } else {\n      if (isset($_GET['origin'])) {\n        $back_url = $_GET['origin'];\n        $back_url_params = '';\n      } else {\n        $back_url = 'reviews.php';\n        $back_url_params = 'page=' . (int)$_GET['page'] . '&rID=' . $rInfo->reviews_id;\n      }\n?>\n    <div class=\"text-right\">\n      <?php echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link($back_url, $back_url_params), null, null, 'btn-light'); ?>\n    </div>\n<?php\n    }\n  } else {\n?>\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_PRODUCTS; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_RATING; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_DATE_ADDED; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $reviews_query_raw = \"select * from reviews order by date_added DESC\";\n            $reviews_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $reviews_query_raw, $reviews_query_numrows);\n            $reviews_query = tep_db_query($reviews_query_raw);\n            while ($reviews = tep_db_fetch_array($reviews_query)) {\n              if ((!isset($_GET['rID']) || (isset($_GET['rID']) && ($_GET['rID'] == $reviews['reviews_id']))) && !isset($rInfo)) {\n                $reviews_text_query = tep_db_query(\"select r.*, rd.*, length(rd.reviews_text) as reviews_text_size from reviews r, reviews_description rd where r.reviews_id = '\" . (int)$reviews['reviews_id'] . \"' and r.reviews_id = rd.reviews_id\");\n                $reviews_text = tep_db_fetch_array($reviews_text_query);\n\n                $products_image_query = tep_db_query(\"select products_image from products where products_id = '\" . (int)$reviews['products_id'] . \"'\");\n                $products_image = tep_db_fetch_array($products_image_query);\n\n                $products_name_query = tep_db_query(\"select products_name from products_description where products_id = '\" . (int)$reviews['products_id'] . \"' and language_id = '\" . (int)$languages_id . \"'\");\n                $products_name = tep_db_fetch_array($products_name_query);\n\n                $reviews_average_query = tep_db_query(\"select (avg(reviews_rating) / 5 * 100) as average_rating from reviews where products_id = '\" . (int)$reviews['products_id'] . \"'\");\n                $reviews_average = tep_db_fetch_array($reviews_average_query);\n\n                $review_info = array_merge($reviews_text, $reviews_average, $products_name);\n                $rInfo_array = array_merge($reviews, $review_info, $products_image);\n                $rInfo = new objectInfo($rInfo_array);\n              }\n\n              if (isset($rInfo) && is_object($rInfo) && ($reviews['reviews_id'] == $rInfo->reviews_id) ) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $rInfo->reviews_id . '&action=preview') . '\\'\">' . \"\\n\";\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $reviews['reviews_id']) . '\\'\">' . \"\\n\";\n              }\n              ?>\n                <td><?php echo tep_get_products_name($reviews['products_id']); ?></td>\n                <td class=\"text-center\"><?php echo tep_draw_stars($reviews['reviews_rating']); ?></td>\n                <td class=\"text-right\"><?php echo tep_date_short($reviews['date_added']); ?></td>\n                <td class=\"text-center\"><?php if ($reviews['reviews_status'] == '1') { echo '<i class=\"fas fa-check-circle text-success\"></i> <a href=\"' . tep_href_link('reviews.php', 'action=setflag&flag=0&rID=' . $reviews['reviews_id'] . '&page=' . (int)$_GET['page']) . '\"><i class=\"fas fa-times-circle text-muted\"></i></a>'; } else { echo '<a href=\"' . tep_href_link('reviews.php', 'action=setflag&flag=1&rID=' . $reviews['reviews_id'] . '&page=' . (int)$_GET['page']) . '\"><i class=\"fas fa-check-circle text-muted\"></i></a> <i class=\"fas fa-times-circle text-danger\"></i>'; } ?></td>\n                <td class=\"text-right\"><?php if (isset($rInfo) && is_object($rInfo) && ($reviews['reviews_id'] == $rInfo->reviews_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $reviews['reviews_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $reviews_split->display_count($reviews_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_REVIEWS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $reviews_split->display_links($reviews_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n    \n<?php\n    $heading = [];\n    $contents = [];\n\n    switch ($action) {\n      case 'delete':\n        $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_REVIEW];\n\n        $contents = ['form' => tep_draw_form('reviews', 'reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $rInfo->reviews_id . '&action=deleteconfirm')];\n        $contents[] = ['text' => TEXT_INFO_DELETE_REVIEW_INTRO];\n        $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $rInfo->products_name];\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $rInfo->reviews_id), null, null, 'btn-light')];\n        break;\n      default:\n      if (isset($rInfo) && is_object($rInfo)) {\n        $heading[] = ['text' => $rInfo->products_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $rInfo->reviews_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('reviews.php', 'page=' . (int)$_GET['page'] . '&rID=' . $rInfo->reviews_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_DATE_ADDED, tep_date_short($rInfo->date_added))];\n        if (tep_not_null($rInfo->last_modified)) $contents[] = ['text' => sprintf(TEXT_INFO_LAST_MODIFIED, tep_date_short($rInfo->last_modified))];\n        $contents[] = ['text' => tep_info_image($rInfo->products_image, $rInfo->products_name, SMALL_IMAGE_WIDTH, SMALL_IMAGE_HEIGHT)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_REVIEW_AUTHOR, $rInfo->customers_name)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_REVIEW_RATING, tep_draw_stars($rInfo->reviews_rating))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_REVIEW_READ, $rInfo->reviews_read)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_REVIEW_SIZE, $rInfo->reviews_text_size)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_PRODUCTS_AVERAGE_RATING, number_format($rInfo->average_rating, 2))];\n      }\n        break;\n    }\n\n    if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n      echo '<div class=\"col-12 col-sm-3\">';\n        $box = new box;\n        echo $box->infoBox($heading, $contents);\n      echo '</div>';\n    }\n  echo '</div>';  \n}\n\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2019 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  require('includes/classes/currencies.php');\n  $currencies = new currencies();\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('specials', 'specialsPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'setflag':\n        tep_set_specials_status($_GET['id'], $_GET['flag']);\n\n        tep_redirect(tep_href_link('specials.php', (isset($_GET['page']) ? 'page=' . (int)$_GET['page'] . '&' : '') . 'sID=' . $_GET['id']));\n        break;\n      case 'insert':\n        $products_id = tep_db_prepare_input($_POST['products_id']);\n        $products_price = tep_db_prepare_input($_POST['products_price']);\n        $specials_price = tep_db_prepare_input($_POST['specials_price']);\n        $expdate = tep_db_prepare_input($_POST['expdate']);\n\n        if (substr($specials_price, -1) == '%') {\n          $new_special_insert_query = tep_db_query(\"select products_id, products_price from products where products_id = '\" . (int)$products_id . \"'\");\n          $new_special_insert = tep_db_fetch_array($new_special_insert_query);\n\n          $products_price = $new_special_insert['products_price'];\n          $specials_price = ($products_price - (($specials_price / 100) * $products_price));\n        }\n\n        $expires_date = '';\n        if (tep_not_null($expdate)) {\n          $expires_date = substr($expdate, 0, 4) . substr($expdate, 5, 2) . substr($expdate, 8, 2);\n        }\n\n        tep_db_query(\"insert into specials (products_id, specials_new_products_price, specials_date_added, expires_date, status) values ('\" . (int)$products_id . \"', '\" . tep_db_input($specials_price) . \"', now(), \" . (tep_not_null($expires_date) ? \"'\" . tep_db_input($expires_date) . \"'\" : 'null') . \", '1')\");\n        \n        $OSCOM_Hooks->call('specials', 'specialsActionInsert');\n\n        tep_redirect(tep_href_link('specials.php', 'page=' . (int)$_GET['page']));\n        break;\n      case 'update':\n        $specials_id = tep_db_prepare_input($_POST['specials_id']);\n        $products_price = tep_db_prepare_input($_POST['products_price']);\n        $specials_price = tep_db_prepare_input($_POST['specials_price']);\n        $expdate = tep_db_prepare_input($_POST['expdate']);\n\n        if (substr($specials_price, -1) == '%') $specials_price = ($products_price - (($specials_price / 100) * $products_price));\n\n        $expires_date = '';\n        if (tep_not_null($expdate)) {\n          $expires_date = substr($expdate, 0, 4) . substr($expdate, 5, 2) . substr($expdate, 8, 2);\n        }\n\n        tep_db_query(\"update specials set specials_new_products_price = '\" . tep_db_input($specials_price) . \"', specials_last_modified = now(), expires_date = \" . (tep_not_null($expires_date) ? \"'\" . tep_db_input($expires_date) . \"'\" : 'null') . \" where specials_id = '\" . (int)$specials_id . \"'\");\n        \n        $OSCOM_Hooks->call('specials', 'specialsActionUpdate');\n\n        tep_redirect(tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . $specials_id));\n        break;\n      case 'deleteconfirm':\n        $specials_id = tep_db_prepare_input($_GET['sID']);\n\n        tep_db_query(\"delete from specials where specials_id = '\" . (int)$specials_id . \"'\");\n        \n        $OSCOM_Hooks->call('specials', 'specialsActionDelete');\n\n        tep_redirect(tep_href_link('specials.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('specials', 'specialsPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(BUTTON_INSERT_SPECIAL, 'fas fa-funnel-dollar', tep_href_link('specials.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('specials.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n\n<?php\n  if ( ($action == 'new') || ($action == 'edit') ) {\n    $form_action = 'insert';\n    if ( ($action == 'edit') && isset($_GET['sID']) ) {\n      $form_action = 'update';\n\n      $product_query = tep_db_query(\"select p.products_id, pd.products_name, p.products_price, s.specials_new_products_price, s.expires_date from products p, products_description pd, specials s where p.products_id = pd.products_id and pd.language_id = '\" . (int)$languages_id . \"' and p.products_id = s.products_id and s.specials_id = '\" . (int)$_GET['sID'] . \"'\");\n      $product = tep_db_fetch_array($product_query);\n\n      $sInfo = new objectInfo($product);\n    } else {\n      $sInfo = new objectInfo([]);\n\n// create an array of products on special, which will be excluded from the pull down menu of products\n// (when creating a new product on special)\n      $specials_array = [];\n      $specials_query = tep_db_query(\"select p.products_id from products p, specials s where s.products_id = p.products_id\");\n      while ($specials = tep_db_fetch_array($specials_query)) {\n        $specials_array[] = $specials['products_id'];\n      }\n    }\n?>\n\n  <form name=\"new_special\" <?php echo 'action=\"' . tep_href_link('specials.php', tep_get_all_get_params(['action', 'info', 'sID']) . 'action=' . $form_action) . '\"'; ?> method=\"post\">\n  <?php \n  if ($form_action == 'update') echo tep_draw_hidden_field('specials_id', $_GET['sID']); \n  ?>\n  \n    <div class=\"form-group row\">\n      <label for=\"specialProduct\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_SPECIALS_PRODUCT; ?></label>\n      <div class=\"col-sm-9\"><?php if (isset($sInfo->products_name)) { echo tep_draw_input_field('n', $sInfo->products_name . ' (' . $currencies->format($sInfo->products_price) . ')', 'readonly class=\"form-control-plaintext\"'); } else { echo tep_draw_products_pull_down('products_id', 'id=\"specialProduct\" required aria-required=\"true\"', $specials_array); } echo tep_draw_hidden_field('products_price', (isset($sInfo->products_price) ? $sInfo->products_price : '')); ?>     \n      </div>\n    </div>\n    \n    <div class=\"form-group row\">\n      <label for=\"specialPrice\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_SPECIALS_SPECIAL_PRICE; ?></label>\n      <div class=\"col-sm-9\">\n        <?php \n        echo tep_draw_input_field('specials_price', (isset($sInfo->specials_new_products_price) ? $sInfo->specials_new_products_price : ''), 'required aria-required=\"true\" class=\"form-control\" id=\"specialPrice\"', null, 'tel'); \n        ?>    \n      </div>\n    </div>\n    \n    <div class=\"form-group row\">\n      <label for=\"expdate\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_SPECIALS_EXPIRES_DATE; ?></label>\n      <div class=\"col-sm-9\">\n        <?php \n        echo tep_draw_input_field('expdate', (isset($sInfo->expires_date) ? substr($sInfo->expires_date, 0, 4) . '-' . substr($sInfo->expires_date, 5, 2) . '-' . substr($sInfo->expires_date, 8, 2) : ''), 'class=\"form-control\" id=\"expdate\"'); \n        ?>    \n      </div>\n    </div>\n    \n    <div class=\"alert alert-info\">\n      <?php echo TEXT_SPECIALS_PRICE_TIP; ?>\n    </div>\n    \n    <?php \n    echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success btn-block btn-lg');\n    ?>\n\n  </form>\n\n  <script>$('#expdate').datepicker({ dateFormat: 'yy-mm-dd' });</script>\n\n<?php\n  } else {\n?>\n\n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_PRODUCTS; ?></th>\n              <th><?php echo TABLE_HEADING_PRODUCTS_PRICE; ?></th>\n              <th><?php echo TABLE_HEADING_SPECIAL_PRICE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $specials_query_raw = \"select p.*, pd.*, s.* from products p, specials s, products_description pd where p.products_id = pd.products_id and pd.language_id = '\" . (int)$languages_id . \"' and p.products_id = s.products_id order by pd.products_name\";\n            $specials_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $specials_query_raw, $specials_query_numrows);\n            $specials_query = tep_db_query($specials_query_raw);\n            while ($specials = tep_db_fetch_array($specials_query)) {\n              if ((!isset($_GET['sID']) || (isset($_GET['sID']) && ($_GET['sID'] == $specials['specials_id']))) && !isset($sInfo)) {\n                $products_query = tep_db_query(\"select products_image from products where products_id = '\" . (int)$specials['products_id'] . \"'\");\n                $products = tep_db_fetch_array($products_query);\n                $sInfo_array = array_merge($specials, $products);\n                $sInfo = new objectInfo($sInfo_array);\n              }\n\n              if (isset($sInfo) && is_object($sInfo) && ($specials['specials_id'] == $sInfo->specials_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . (int)$sInfo->specials_id . '&action=edit') . '\\'\">' . \"\\n\";\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . (int)$specials['specials_id']) . '\\'\">' . \"\\n\";\n              }\n              ?>\n                <td><?php echo $specials['products_name']; ?></td>\n                <td><?php echo $currencies->format($specials['products_price']); ?></td>\n                <td class=\"text-danger\"><?php echo $currencies->format($specials['specials_new_products_price']); ?></td>\n                <td class=\"text-right\"><?php if ($specials['status'] == '1') { echo '<i class=\"fas fa-check-circle text-success\"></i> <a href=\"' . tep_href_link('specials.php', 'action=setflag&flag=0&id=' . (int)$specials['specials_id']) . '\"><i class=\"fas fa-times-circle text-muted\"></i></a>'; } else { echo '<a href=\"' . tep_href_link('specials.php', 'action=setflag&flag=1&id=' . (int)$specials['specials_id']) . '\"><i class=\"fas fa-check-circle text-muted\"></i></a> <i class=\"fas fa-times-circle text-danger\"></i>'; } ?></td>\n                <td class=\"text-right\"><?php if (isset($sInfo) && is_object($sInfo) && ($specials['specials_id'] == $sInfo->specials_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . $specials['specials_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n<?php\n    }\n?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $specials_split->display_count($specials_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_SPECIALS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $specials_split->display_links($specials_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_SPECIALS];\n\n      $contents = ['form' => tep_draw_form('specials', 'specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . $sInfo->specials_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['text' => '<strong>' . $sInfo->products_name . '</strong>'];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . $sInfo->specials_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($sInfo ?? null)) {\n        $heading[] = ['text' => $sInfo->products_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . $sInfo->specials_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('specials.php', 'page=' . (int)$_GET['page'] . '&sID=' . $sInfo->specials_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2')];\n        $contents[] = ['text' => TEXT_INFO_DATE_ADDED . ' ' . tep_date_short($sInfo->specials_date_added)];\n        $contents[] = ['text' => TEXT_INFO_LAST_MODIFIED . ' ' . tep_date_short($sInfo->specials_last_modified)];\n        $contents[] = ['class' => 'text-center', 'text' => tep_info_image($sInfo->products_image, $sInfo->products_name, SMALL_IMAGE_WIDTH, SMALL_IMAGE_HEIGHT)];\n        $contents[] = ['text' => TEXT_INFO_ORIGINAL_PRICE . ' ' . $currencies->format($sInfo->products_price)];\n        $contents[] = ['text' => TEXT_INFO_NEW_PRICE . ' ' . $currencies->format($sInfo->specials_new_products_price)];\n        $contents[] = ['text' => TEXT_INFO_PERCENTAGE . ' ' . number_format(100 - (($sInfo->specials_new_products_price / $sInfo->products_price) * 100)) . '%'];\n\n        $contents[] = ['text' => TEXT_INFO_EXPIRES_DATE . ' <strong>' . tep_date_short($sInfo->expires_date) . '</strong>'];\n        $contents[] = ['text' => TEXT_INFO_STATUS_CHANGE . ' ' . tep_date_short($sInfo->date_status_change)];\n      }\n      break;\n  }\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n  \n  echo '</div>';  \n}\n?>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require 'includes/application_top.php';\n\n  $currencies = new currencies();\n\n  require 'includes/template_top.php';\n?>\n\n  <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n\n  <div class=\"table-responsive\">\n    <table class=\"table table-striped table-hover\">\n      <thead class=\"thead-dark\">\n        <tr>\n          <th><?php echo TABLE_HEADING_NUMBER; ?></th>\n          <th><?php echo TABLE_HEADING_CUSTOMERS; ?></th>\n          <th class=\"text-right\"><?php echo TABLE_HEADING_TOTAL_PURCHASED; ?></th>\n        </tr>\n      </thead>\n      <tbody>\n        <?php\n        $db_tables = $customer_data->build_db_tables(['id', 'name'], 'customers');\n        $customers_query_raw = \"SELECT \" . customer_query::build_columns($db_tables);\n        $customers_query_raw .= \"o.customers_id, sum(op.products_quantity * op.final_price) AS ordersum FROM \" . customer_query::build_joins($db_tables, []);\n        $customers_query_raw .= \", orders_products op, orders o WHERE \" . customer_query::TABLE_ALIASES['customers'];\n        $customers_query_raw .= \".customers_id = o.customers_id AND o.orders_id = op.orders_id GROUP BY o.customers_id ORDER BY ordersum DESC\";\n        $customers_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $customers_query_raw, $customers_query_numrows);\n\n        $row = 0;\n        $customers_query = tep_db_query($customers_query_raw);\n\n        while ($customer = tep_db_fetch_array($customers_query)) {\n          $row++;\n          ?>\n          <tr onclick=\"document.location.href='<?php echo tep_href_link('customers.php', 'cID=' . $customer['customers_id']); ?>'\">\n            <td><?php echo str_pad($row, 2, '0', STR_PAD_LEFT); ?>.</td>\n            <td><?php echo '<a href=\"' . tep_href_link('customers.php', 'cID=' . $customer['customers_id']) . '\">' . $customer_data->get('name', $customer) . '</a>'; ?></td>\n            <td class=\"text-right\"><?php echo $currencies->format($customer['ordersum']); ?>&nbsp;</td>\n          </tr>\n          <?php\n        }\n        ?>\n      </tbody>\n    </table>\n  </div>\n\n  <div class=\"row\">\n    <div class=\"col-sm-6\"><?php echo $customers_split->display_count($customers_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_CUSTOMERS); ?></div>\n    <div class=\"col-sm-6 text-sm-right\"><?php echo $customers_split->display_links($customers_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n  </div>\n\n<?php\n  require 'includes/template_bottom.php';\n  require 'includes/application_bottom.php';\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2019 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  require('includes/template_top.php');\n?>\n\n  <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n\n  <div class=\"table-responsive\">\n    <table class=\"table table-striped table-hover\">\n      <thead class=\"thead-dark\">\n        <tr>\n          <th><?php echo TABLE_HEADING_NUMBER; ?></th>\n          <th><?php echo TABLE_HEADING_PRODUCTS; ?></th>\n          <th class=\"text-right\"><?php echo TABLE_HEADING_PURCHASED; ?></th>\n        </tr>\n      </thead>\n      <tbody>\n        <?php\n        if (isset($_GET['page']) && ($_GET['page'] > 1)) $rows = (int)$_GET['page'] * MAX_DISPLAY_SEARCH_RESULTS - MAX_DISPLAY_SEARCH_RESULTS;\n        $products_query_raw = \"select p.products_id, p.products_ordered, pd.products_name from products p, products_description pd where pd.products_id = p.products_id and pd.language_id = '\" . (int)$languages_id. \"' and p.products_ordered > 0 group by pd.products_id order by p.products_ordered DESC, pd.products_name\";\n        $products_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $products_query_raw, $products_query_numrows);\n\n        $rows = 0;\n        $products_query = tep_db_query($products_query_raw);\n        while ($products = tep_db_fetch_array($products_query)) {\n          $rows++;\n          ?>\n          <tr onclick=\"document.location.href='<?php echo tep_href_link('categories.php', 'action=new_product_preview&read=only&pID=' . $products['products_id'] . '&origin=stats_products_purchased.php?page=' . (int)$_GET['page']); ?>'\">\n            <td><?php echo str_pad($rows, 2, '0', STR_PAD_LEFT); ?>.</td>\n            <td><?php echo '<a href=\"' . tep_href_link('categories.php', 'action=new_product_preview&read=only&pID=' . (int)$products['products_id'] . '&origin=stats_products_purchased.php?page=' . (int)$_GET['page']) . '\">' . $products['products_name'] . '</a>'; ?></td>\n            <td class=\"text-right\"><?php echo $products['products_ordered']; ?></td>\n          </tr>\n          <?php\n        }\n        ?>\n      </tbody>\n    </table>\n  </div>\n  \n  <div class=\"row\">\n    <div class=\"col-sm-6\"><?php echo $products_split->display_count($products_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_PRODUCTS); ?></div>\n    <div class=\"col-sm-6 text-sm-right\"><?php echo $products_split->display_links($products_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2019 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  require('includes/template_top.php');\n?>\n\n  <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n\n  <div class=\"table-responsive\">\n    <table class=\"table table-striped table-hover\">\n      <thead class=\"thead-dark\">\n        <tr>\n          <th><?php echo TABLE_HEADING_NUMBER; ?></th>\n          <th><?php echo TABLE_HEADING_PRODUCTS; ?></th>\n          <th class=\"text-right\"><?php echo TABLE_HEADING_VIEWED; ?></th>\n        </tr>\n      </thead>\n      <tbody>\n        <?php\n        if (isset($_GET['page']) && ($_GET['page'] > 1)) $rows = (int)$_GET['page'] * MAX_DISPLAY_SEARCH_RESULTS - MAX_DISPLAY_SEARCH_RESULTS;\n        $rows = 0;\n        $products_query_raw = \"select p.products_id, pd.products_name, pd.products_viewed, l.name from products p, products_description pd, languages l where p.products_id = pd.products_id and l.languages_id = pd.language_id order by pd.products_viewed DESC\";\n        $products_split = new splitPageResults(($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $products_query_raw, $products_query_numrows);\n        $products_query = tep_db_query($products_query_raw);\n        while ($products = tep_db_fetch_array($products_query)) {\n          $rows++;\n          ?>\n          <tr onclick=\"document.location.href='<?php echo tep_href_link('categories.php', 'action=new_product_preview&read=only&pID=' . (int)$products['products_id'] . '&origin=stats_products_viewed.php?page=' . (int)$_GET['page']); ?>'\">\n            <td><?php echo str_pad($rows, 2, '0', STR_PAD_LEFT); ?>.</td>\n            <td><?php echo '<a href=\"' . tep_href_link('categories.php', 'action=new_product_preview&read=only&pID=' . $products['products_id'] . '&origin=stats_products_viewed.php?page=' . (int)$_GET['page']) . '\">' . $products['products_name'] . '</a> (' . $products['name'] . ')'; ?></td>\n            <td class=\"text-right\"><?php echo $products['products_viewed']; ?></td>\n          </tr>\n          <?php\n        }\n        ?>\n      </tbody>\n    </table>\n  </div>\n  \n  <div class=\"row\">\n    <div class=\"col-sm-6\"><?php echo $products_split->display_count($products_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_PRODUCTS); ?></div>\n    <div class=\"col-sm-6 text-sm-right\"><?php echo $products_split->display_links($products_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n  </div>    \n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        $tax_class_title = tep_db_prepare_input($_POST['tax_class_title']);\n        $tax_class_description = tep_db_prepare_input($_POST['tax_class_description']);\n\n        tep_db_query(\"insert into tax_class (tax_class_title, tax_class_description, date_added) values ('\" . tep_db_input($tax_class_title) . \"', '\" . tep_db_input($tax_class_description) . \"', now())\");\n\n        tep_redirect(tep_href_link('tax_classes.php'));\n        break;\n      case 'save':\n        $tax_class_id = tep_db_prepare_input($_GET['tID']);\n        $tax_class_title = tep_db_prepare_input($_POST['tax_class_title']);\n        $tax_class_description = tep_db_prepare_input($_POST['tax_class_description']);\n\n        tep_db_query(\"update tax_class set tax_class_id = '\" . (int)$tax_class_id . \"', tax_class_title = '\" . tep_db_input($tax_class_title) . \"', tax_class_description = '\" . tep_db_input($tax_class_description) . \"', last_modified = now() where tax_class_id = '\" . (int)$tax_class_id . \"'\");\n\n        tep_redirect(tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tax_class_id));\n        break;\n      case 'deleteconfirm':\n        $tax_class_id = tep_db_prepare_input($_GET['tID']);\n\n        tep_db_query(\"delete from tax_class where tax_class_id = '\" . (int)$tax_class_id . \"'\");\n\n        tep_redirect(tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_TAX_CLASS, 'fas fa-funnel-dollar', tep_href_link('tax_classes.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('tax_classes.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_TAX_CLASSES; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $classes_query_raw = \"select * from tax_class order by tax_class_title\";\n            $classes_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $classes_query_raw, $classes_query_numrows);\n            $classes_query = tep_db_query($classes_query_raw);\n            while ($classes = tep_db_fetch_array($classes_query)) {\n              if ((!isset($_GET['tID']) || (isset($_GET['tID']) && ($_GET['tID'] == $classes['tax_class_id']))) && !isset($tcInfo) && (substr($action, 0, 3) != 'new')) {\n                $tcInfo = new objectInfo($classes);\n              }\n\n              if (isset($tcInfo) && is_object($tcInfo) && ($classes['tax_class_id'] == $tcInfo->tax_class_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $classes['tax_class_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $classes['tax_class_title']; ?></td>\n                <td class=\"text-right\"><?php if (isset($tcInfo) && is_object($tcInfo) && ($classes['tax_class_id'] == $tcInfo->tax_class_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $classes['tax_class_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n            }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $classes_split->display_count($classes_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_TAX_CLASSES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $classes_split->display_links($classes_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_TAX_CLASS];\n\n      $contents = ['form' => tep_draw_form('classes', 'tax_classes.php', 'page=' . (int)$_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CLASS_TITLE . '<br>' . tep_draw_input_field('tax_class_title')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_CLASS_DESCRIPTION, null) . '<br>' . tep_draw_input_field('tax_class_description')];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, null, null, 'btn-success xxx text-white mr-2') .  tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_TAX_CLASS];\n\n      $contents = ['form' => tep_draw_form('classes', 'tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CLASS_TITLE . '<br>' . tep_draw_input_field('tax_class_title', $tcInfo->tax_class_title)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_CLASS_DESCRIPTION, null) . '<br>' . tep_draw_input_field('tax_class_description', $tcInfo->tax_class_description)];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tcInfo->tax_class_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_TAX_CLASS];\n\n      $contents = ['form' => tep_draw_form('classes', 'tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $tcInfo->tax_class_title];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tcInfo->tax_class_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (isset($tcInfo) && is_object($tcInfo)) {\n        $heading[] = ['text' => $tcInfo->tax_class_title];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('tax_classes.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tcInfo->tax_class_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_DATE_ADDED, tep_date_short($tcInfo->date_added))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_LAST_MODIFIED, tep_date_short($tcInfo->last_modified))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_CLASS_DESCRIPTION, $tcInfo->tax_class_description)];\n      }\n      break;\n  }\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        $tax_zone_id = tep_db_prepare_input($_POST['tax_zone_id']);\n        $tax_class_id = tep_db_prepare_input($_POST['tax_class_id']);\n        $tax_rate = tep_db_prepare_input($_POST['tax_rate']);\n        $tax_description = tep_db_prepare_input($_POST['tax_description']);\n        $tax_priority = tep_db_prepare_input($_POST['tax_priority']);\n\n        tep_db_query(\"insert into tax_rates (tax_zone_id, tax_class_id, tax_rate, tax_description, tax_priority, date_added) values ('\" . (int)$tax_zone_id . \"', '\" . (int)$tax_class_id . \"', '\" . tep_db_input($tax_rate) . \"', '\" . tep_db_input($tax_description) . \"', '\" . tep_db_input($tax_priority) . \"', now())\");\n\n        tep_redirect(tep_href_link('tax_rates.php'));\n        break;\n      case 'save':\n        $tax_rates_id = tep_db_prepare_input($_GET['tID']);\n        $tax_zone_id = tep_db_prepare_input($_POST['tax_zone_id']);\n        $tax_class_id = tep_db_prepare_input($_POST['tax_class_id']);\n        $tax_rate = tep_db_prepare_input($_POST['tax_rate']);\n        $tax_description = tep_db_prepare_input($_POST['tax_description']);\n        $tax_priority = tep_db_prepare_input($_POST['tax_priority']);\n\n        tep_db_query(\"update tax_rates set tax_rates_id = '\" . (int)$tax_rates_id . \"', tax_zone_id = '\" . (int)$tax_zone_id . \"', tax_class_id = '\" . (int)$tax_class_id . \"', tax_rate = '\" . tep_db_input($tax_rate) . \"', tax_description = '\" . tep_db_input($tax_description) . \"', tax_priority = '\" . tep_db_input($tax_priority) . \"', last_modified = now() where tax_rates_id = '\" . (int)$tax_rates_id . \"'\");\n\n        tep_redirect(tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tax_rates_id));\n        break;\n      case 'deleteconfirm':\n        $tax_rates_id = tep_db_prepare_input($_GET['tID']);\n\n        tep_db_query(\"delete from tax_rates where tax_rates_id = '\" . (int)$tax_rates_id . \"'\");\n\n        tep_redirect(tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\">\n      <h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1>\n    </div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_TAX_RATE, 'fas fa-percent', tep_href_link('tax_rates.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_BACK, 'fas fa-angle-left', tep_href_link('tax_rates.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_TAX_RATE_PRIORITY; ?></th>\n              <th><?php echo TABLE_HEADING_TAX_CLASS_TITLE; ?></th>\n              <th><?php echo TABLE_HEADING_ZONE; ?></th>\n              <th><?php echo TABLE_HEADING_TAX_RATE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $rates_query_raw = \"select r.*, z.*, tc.* from tax_class tc, tax_rates r left join geo_zones z on r.tax_zone_id = z.geo_zone_id where r.tax_class_id = tc.tax_class_id\";\n            $rates_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $rates_query_raw, $rates_query_numrows);\n            $rates_query = tep_db_query($rates_query_raw);\n            while ($rates = tep_db_fetch_array($rates_query)) {\n              if ((!isset($_GET['tID']) || (isset($_GET['tID']) && ($_GET['tID'] == $rates['tax_rates_id']))) && !isset($trInfo) && (substr($action, 0, 3) != 'new')) {\n                $trInfo = new objectInfo($rates);\n              }\n\n              if (isset($trInfo) && is_object($trInfo) && ($rates['tax_rates_id'] == $trInfo->tax_rates_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $trInfo->tax_rates_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $rates['tax_rates_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $rates['tax_priority']; ?></td>\n                <td><?php echo $rates['tax_class_title']; ?></td>\n                <td><?php echo $rates['geo_zone_name']; ?></td>\n                <td><?php echo tep_display_tax_value($rates['tax_rate']); ?>%</td>\n                <td class=\"text-right\"><?php if (isset($trInfo) && is_object($trInfo) && ($rates['tax_rates_id'] == $trInfo->tax_rates_id)) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $rates['tax_rates_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n              }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $rates_split->display_count($rates_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_TAX_RATES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $rates_split->display_links($rates_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_TAX_RATE];\n\n      $contents = ['form' => tep_draw_form('rates', 'tax_rates.php', 'page=' . (int)$_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CLASS_TITLE . '<br>' . tep_tax_classes_pull_down('name=\"tax_class_id\" class=\"form-control\"')];\n      $contents[] = ['text' => TEXT_INFO_ZONE_NAME . '<br>' . tep_geo_zones_pull_down('name=\"tax_zone_id\" class=\"form-control\"')];\n      $contents[] = ['text' => TEXT_INFO_TAX_RATE . '<br>' . tep_draw_input_field('tax_rate')];\n      $contents[] = ['text' => sprintf(TEXT_INFO_RATE_DESCRIPTION, null) . '<br>' . tep_draw_input_field('tax_description')];\n      $contents[] = ['text' => TEXT_INFO_TAX_RATE_PRIORITY . '<br>' . tep_draw_input_field('tax_priority')];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_TAX_RATE];\n\n      $contents = ['form' => tep_draw_form('rates', 'tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $trInfo->tax_rates_id  . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_CLASS_TITLE . '<br>' . tep_tax_classes_pull_down('name=\"tax_class_id\" class=\"form-control\"', $trInfo->tax_class_id)];\n      $contents[] = ['text' => TEXT_INFO_ZONE_NAME . '<br>' . tep_geo_zones_pull_down('name=\"tax_zone_id\" class=\"form-control\"', $trInfo->geo_zone_id)];\n      $contents[] = ['text' => TEXT_INFO_TAX_RATE . '<br>' . tep_draw_input_field('tax_rate', $trInfo->tax_rate)];\n      $contents[] = ['text' => sprintf(TEXT_INFO_RATE_DESCRIPTION, null) . '<br>' . tep_draw_input_field('tax_description', $trInfo->tax_description)];\n      $contents[] = ['text' => TEXT_INFO_TAX_RATE_PRIORITY . '<br>' . tep_draw_input_field('tax_priority', $trInfo->tax_priority)];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $trInfo->tax_rates_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_TAX_RATE];\n\n      $contents = ['form' => tep_draw_form('rates', 'tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $trInfo->tax_rates_id  . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['class' => 'text-center text-uppercase font-weight-bold', 'text' => $trInfo->tax_class_title . ' ' . number_format($trInfo->tax_rate, TAX_DECIMAL_PLACES) . '%'];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $trInfo->tax_rates_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (is_object($trInfo)) {\n        $heading[] = ['text' => $trInfo->tax_class_title];\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $trInfo->tax_rates_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('tax_rates.php', 'page=' . (int)$_GET['page'] . '&tID=' . $trInfo->tax_rates_id . '&action=delete'), null, null, 'btn-danger xxx text-white mr-2')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_DATE_ADDED, tep_date_short($trInfo->date_added))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_LAST_MODIFIED, tep_date_short($trInfo->last_modified))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_RATE_DESCRIPTION, $trInfo->tax_description)];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2020 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n  \n  $OSCOM_Hooks->call('testimonials', 'testimonialsPreAction');\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'setflag':\n        if ( ($_GET['flag'] == '0') || ($_GET['flag'] == '1') ) {\n          if (isset($_GET['tID'])) {\n            tep_db_query(\"update testimonials set testimonials_status = '\" . (int)$_GET['flag'] . \"' where testimonials_id = '\" . (int)$_GET['tID'] . \"'\");\n          }\n        }\n        \n        $OSCOM_Hooks->call('testimonials', 'testimonialsActionSetFlag');\n\n        tep_redirect(tep_href_link('testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . $_GET['tID']));\n        break;\n      case 'update':\n        $customers_id = (int)$_POST['customers_id'];\n        $customers_name = tep_db_prepare_input($_POST['customer_name']);\n        $testimonials_id = tep_db_prepare_input($_GET['tID']);\n        $testimonials_text = tep_db_prepare_input($_POST['testimonials_text']);\n        $testimonials_status = tep_db_prepare_input($_POST['testimonials_status']);\n\n        tep_db_query(\"update testimonials set customers_id = '\" . (int)$customers_id . \"', customers_name  = '\" . tep_db_input($customers_name) . \"', testimonials_status = '\" . tep_db_input($testimonials_status) . \"', last_modified = now() where testimonials_id = '\" . (int)$testimonials_id . \"'\");\n        tep_db_query(\"update testimonials_description set testimonials_text = '\" . tep_db_input($testimonials_text) . \"' where testimonials_id = '\" . (int)$testimonials_id . \"'\");\n\n        $OSCOM_Hooks->call('testimonials', 'testimonialsActionUpdate');\n        \n        tep_redirect(tep_href_link('testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . $testimonials_id));\n        break;\n      case 'deleteconfirm':\n        $testimonials_id = tep_db_prepare_input($_GET['tID']);\n\n        tep_db_query(\"delete from testimonials where testimonials_id = '\" . (int)$testimonials_id . \"'\");\n        tep_db_query(\"delete from testimonials_description where testimonials_id = '\" . (int)$testimonials_id . \"'\");\n        \n        $OSCOM_Hooks->call('testimonials', 'testimonialsActionDelete');\n\n        tep_redirect(tep_href_link('testimonials.php', 'page=' . (int)$_GET['page']));\n        break;\n        \n      case 'addnew':\n        $customers_id = (int)$_POST['customers_id'];\n        $customers_name = tep_db_prepare_input($_POST['customer_name']);\n        $testimonial = tep_db_prepare_input($_POST['testimonials_text']);\n\n        tep_db_query(\"insert into testimonials (customers_id, customers_name, date_added, testimonials_status) values ('\" . $customers_id . \"', '\" . tep_db_input($customers_name) . \"', now(), 1)\");\n        $insert_id = tep_db_insert_id();\n        tep_db_query(\"insert into testimonials_description (testimonials_id, languages_id, testimonials_text) values ('\" . (int)$insert_id . \"', '\" . (int)$languages_id . \"', '\" . tep_db_input($testimonial) . \"')\");\n        \n        $OSCOM_Hooks->call('testimonials', 'testimonialsActionSave');\n\n        tep_redirect(tep_href_link('testimonials.php', tep_get_all_get_params(array('action'))));\n        break;\n    }\n  }\n  \n  $OSCOM_Hooks->call('testimonials', 'testimonialsPostAction');\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\"><h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1></div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_BUTTON_ADD_TESTIMONIAL, 'fas fa-pen', tep_href_link('testimonials.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('testimonials.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n\n<?php\n  if ($action == 'edit') {\n    $tID = tep_db_prepare_input($_GET['tID']);\n\n    $testimonials_query = tep_db_query(\"select t.*, td.* from testimonials t, testimonials_description td where t.testimonials_id = '\" . (int)$tID . \"' and t.testimonials_id = td.testimonials_id\");\n    $testimonials = tep_db_fetch_array($testimonials_query);\n\n    $tInfo = new objectInfo($testimonials);\n\n    if (!isset($tInfo->testimonials_status)) $tInfo->testimonials_status = '1';\n    switch ($tInfo->testimonials_status) {\n      case '0': $in_status = false; $out_status = true; break;\n      case '1':\n      default: $in_status = true; $out_status = false;\n    }\n?>\n      <?php echo tep_draw_form('testimonial', 'testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . $_GET['tID'] . '&action=update', 'post', 'enctype=\"multipart/form-data\"'); ?>\n        \n        <div class=\"form-group row align-items-center\">\n          <label class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo TEXT_INFO_TESTIMONIAL_STATUS; ?></label>\n          <div class=\"col-sm-9\">\n            <div class=\"custom-control custom-radio custom-control-inline\">\n              <?php echo tep_draw_selection_field('testimonials_status', 'radio', '1', $in_status, 'id=\"inStatus\" class=\"custom-control-input\"'); ?>\n              <label class=\"custom-control-label\" for=\"inStatus\"><?php echo TEXT_TESTIMONIAL_PUBLISHED; ?></label>\n            </div>\n            <div class=\"custom-control custom-radio custom-control-inline\">\n              <?php echo tep_draw_selection_field('testimonials_status', 'radio', '0', $out_status, 'id=\"outStatus\" class=\"custom-control-input\"'); ?>\n              <label class=\"custom-control-label\" for=\"outStatus\"><?php echo TEXT_TESTIMONIAL_NOT_PUBLISHED; ?></label>\n            </div>    \n          </div>\n        </div>\n          \n        <div class=\"form-group row\">\n          <label for=\"inputFrom\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_customers('customers_id', 'id=\"inputFrom\"', $tInfo->customers_id); ?>\n          </div>\n        </div>\n        \n        <div class=\"form-group row\">\n          <label for=\"inputNick\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM_NICKNAME; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_input_field('customer_name', $tInfo->customers_name, 'required aria-required=\"true\" id=\"inputNick\"'); \n            ?>\n          </div>\n        </div>\n        \n        <div class=\"form-group row\">\n          <label for=\"inputText\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_TESTIMONIAL; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_textarea_field('testimonials_text', 'soft', '60', '15', $tInfo->testimonials_text, 'required aria-required=\"true\" id=\"inputText\"'); ?>\n          </div>\n        </div>\n        \n        <?php\n        echo $OSCOM_Hooks->call('testimonials', 'testimonialsFormEdit');\n\n        echo tep_draw_hidden_field('testimonials_id', $tInfo->testimonials_id);\n        echo tep_draw_hidden_field('customers_name', $tInfo->customers_name);\n        echo tep_draw_hidden_field('date_added', $tInfo->date_added);\n        \n        echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success btn-block btn-lg');\n        ?>\n\n      </form>\n<?php\n  } elseif ($action == 'new') {\n    \n      echo tep_draw_form('review', 'testimonials.php', 'action=addnew', 'post', 'enctype=\"multipart/form-data\"'); \n      ?>\n      \n        <div class=\"form-group row\">\n          <label for=\"inputFrom\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_customers('customers_id', 'id=\"inputFrom\"'); ?>\n          </div>\n        </div>\n        \n        <div class=\"form-group row\">\n          <label for=\"inputNick\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_FROM_NICKNAME; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_input_field('customer_name', '', 'required aria-required=\"true\" id=\"inputNick\"'); \n            ?>\n          </div>\n        </div>\n        \n        <div class=\"form-group row\">\n          <label for=\"inputText\" class=\"col-form-label col-sm-3 text-left text-sm-right\"><?php echo ENTRY_TESTIMONIAL; ?></label>\n          <div class=\"col-sm-9\">\n            <?php echo tep_draw_textarea_field('testimonials_text', 'soft', '60', '15', '', 'required aria-required=\"true\" id=\"inputText\"'); ?>\n          </div>\n        </div>\n        \n        <?php\n        echo $OSCOM_Hooks->call('testimonials', 'testimonialsFormNew');\n        \n        echo tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-pen', null, 'primary', null, 'btn-success btn-block btn-lg'); \n        ?>\n\n      </form>\n       <?php\n     } else {\n?>\n      \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_CUSTOMER_ID; ?></th>\n              <th><?php echo TABLE_HEADING_CUSTOMER_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_DATE_ADDED; ?></th>\n              <th class=\"text-center\"><?php echo TABLE_HEADING_STATUS; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $testimonials_query_raw = \"select * from testimonials order by testimonials_id DESC\";\n            $testimonials_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $testimonials_query_raw, $testimonials_query_numrows);\n            $testimonials_query = tep_db_query($testimonials_query_raw);\n            while ($testimonials = tep_db_fetch_array($testimonials_query)) {\n              if ((!isset($_GET['tID']) || (isset($_GET['tID']) && ($_GET['tID'] == $testimonials['testimonials_id']))) && !isset($tInfo)) {\n                $testimonials_text_query = tep_db_query(\"select t.customers_name, td.testimonials_text from testimonials t, testimonials_description td where t.testimonials_id = '\" . (int)$testimonials['testimonials_id'] . \"' and t.testimonials_id = td.testimonials_id\");\n                $testimonials_text = tep_db_fetch_array($testimonials_text_query);\n\n                $tInfo_array = array_merge($testimonials, $testimonials_text);\n                $tInfo = new objectInfo($tInfo_array);\n              }\n\n              if (isset($tInfo) && is_object($tInfo) && ($testimonials['testimonials_id'] == $tInfo->testimonials_id) ) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . (int)$tInfo->testimonials_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . (int)$testimonials['testimonials_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo (int)$testimonials['customers_id']; ?></td>\n                <td><?php echo $testimonials['customers_name']; ?></td>\n                <td><?php echo tep_date_short($testimonials['date_added']); ?></td>\n                <td class=\"text-center\"><?php\n                if ($testimonials['testimonials_status'] == '1') {\n                  echo '<i class=\"fas fa-check-circle text-success\"></i> <a href=\"' . tep_href_link('testimonials.php', 'action=setflag&flag=0&tID=' . $testimonials['testimonials_id'] . '&page=' . (int)$_GET['page']) . '\"><i class=\"fas fa-times-circle text-muted\"></i></a>';\n                } else {\n                  echo '<a href=\"' . tep_href_link('testimonials.php', 'action=setflag&flag=1&tID=' . $testimonials['testimonials_id'] . '&page=' . (int)$_GET['page']) . '\"><i class=\"fas fa-check-circle text-muted\"></i></a>  <i class=\"fas fa-times-circle text-danger\"></i>';\n                }\n                ?></td>\n                <td class=\"text-right\"><?php if ( (is_object($tInfo)) && ($testimonials['testimonials_id'] == $tInfo->testimonials_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . $testimonials['testimonials_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n<?php\n    }\n?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $testimonials_split->display_count($testimonials_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_TESTIMONIALS); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $testimonials_split->display_links($testimonials_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n      \n    </div>\n\n<?php\n    $heading = [];\n    $contents = [];\n\n    switch ($action) {\n      case 'delete':\n        $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_TESTIMONIAL];\n\n        $contents = ['form' => tep_draw_form('testimonials', 'testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tInfo->testimonials_id . '&action=deleteconfirm')];\n        $contents[] = ['text' => TEXT_INFO_DELETE_TESTIMONIAL_INTRO];\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tInfo->testimonials_id), null, null, 'btn-light')];\n        break;\n      default:\n      if (isset($tInfo) && is_object($tInfo)) {\n        $heading[] = ['text' => $tInfo->customers_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tInfo->testimonials_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('testimonials.php', 'page=' . (int)$_GET['page'] . '&tID=' . $tInfo->testimonials_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => sprintf(TEXT_INFO_DATE_ADDED, tep_date_short($tInfo->date_added))];\n        if (tep_not_null($tInfo->last_modified)) $contents[] = ['text' => sprintf(TEXT_INFO_LAST_MODIFIED, tep_date_short($tInfo->last_modified))];\n        $contents[] = ['text' => sprintf(TEXT_INFO_TESTIMONIAL_AUTHOR, $tInfo->customers_name)];\n        $contents[] = ['text' => sprintf(TEXT_INFO_TESTIMONIAL_SIZE, str_word_count($tInfo->testimonials_text))];\n      }\n        break;\n    }\n\n    if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n      echo '<div class=\"col-12 col-sm-3\">';\n        $box = new box;\n        echo $box->infoBox($heading, $contents);\n      echo '</div>';\n    }\n    \n    echo '</div>';\n    \n  }\n\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n", "<?php\n/*\n  $Id$\n\n  osCommerce, Open Source E-Commerce Solutions\n  http://www.oscommerce.com\n\n  Copyright (c) 2010 osCommerce\n\n  Released under the GNU General Public License\n*/\n\n  require('includes/application_top.php');\n\n  $action = $_GET['action'] ?? '';\n\n  if (tep_not_null($action)) {\n    switch ($action) {\n      case 'insert':\n        $zone_country_id = tep_db_prepare_input($_POST['zone_country_id']);\n        $zone_code = tep_db_prepare_input($_POST['zone_code']);\n        $zone_name = tep_db_prepare_input($_POST['zone_name']);\n\n        tep_db_query(\"insert into \" . TABLE_ZONES . \" (zone_country_id, zone_code, zone_name) values ('\" . (int)$zone_country_id . \"', '\" . tep_db_input($zone_code) . \"', '\" . tep_db_input($zone_name) . \"')\");\n\n        tep_redirect(tep_href_link('zones.php'));\n        break;\n      case 'save':\n        $zone_id = tep_db_prepare_input($_GET['cID']);\n        $zone_country_id = tep_db_prepare_input($_POST['zone_country_id']);\n        $zone_code = tep_db_prepare_input($_POST['zone_code']);\n        $zone_name = tep_db_prepare_input($_POST['zone_name']);\n\n        tep_db_query(\"update \" . TABLE_ZONES . \" set zone_country_id = '\" . (int)$zone_country_id . \"', zone_code = '\" . tep_db_input($zone_code) . \"', zone_name = '\" . tep_db_input($zone_name) . \"' where zone_id = '\" . (int)$zone_id . \"'\");\n\n        tep_redirect(tep_href_link('zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $zone_id));\n        break;\n      case 'deleteconfirm':\n        $zone_id = tep_db_prepare_input($_GET['cID']);\n\n        tep_db_query(\"delete from \" . TABLE_ZONES . \" where zone_id = '\" . (int)$zone_id . \"'\");\n\n        tep_redirect(tep_href_link('zones.php', 'page=' . (int)$_GET['page']));\n        break;\n    }\n  }\n\n  require('includes/template_top.php');\n?>\n\n  <div class=\"row\">\n    <div class=\"col\"><h1 class=\"display-4 mb-2\"><?php echo HEADING_TITLE; ?></h1></div>\n    <div class=\"col text-right align-self-center\">\n      <?php\n      if (empty($action)) {\n        echo tep_draw_bootstrap_button(IMAGE_NEW_ZONE, 'fas fa-map-marker-alt', tep_href_link('zones.php', 'action=new'), null, null, 'btn-danger xxx text-white');\n      }\n      else {\n        echo tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-angle-left', tep_href_link('zones.php'), null, null, 'btn-light mt-2');\n      }\n      ?>\n    </div>\n  </div>\n  \n  <div class=\"row no-gutters\">\n    <div class=\"col\">\n      <div class=\"table-responsive\">\n        <table class=\"table table-striped table-hover\">\n          <thead class=\"thead-dark\">\n            <tr>\n              <th><?php echo TABLE_HEADING_COUNTRY_NAME; ?></th>\n              <th><?php echo TABLE_HEADING_ZONE_NAME; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ZONE_CODE; ?></th>\n              <th class=\"text-right\"><?php echo TABLE_HEADING_ACTION; ?></th>\n            </tr>\n          </thead>\n          <tbody>\n            <?php\n            $zones_query_raw = \"select z.zone_id, c.countries_id, c.countries_name, z.zone_name, z.zone_code, z.zone_country_id from \" . TABLE_ZONES . \" z, \" . TABLE_COUNTRIES . \" c where z.zone_country_id = c.countries_id order by c.countries_name, z.zone_name\";\n            $zones_split = new splitPageResults($_GET['page'], MAX_DISPLAY_SEARCH_RESULTS, $zones_query_raw, $zones_query_numrows);\n            $zones_query = tep_db_query($zones_query_raw);\n            while ($zones = tep_db_fetch_array($zones_query)) {\n              if ((!isset($_GET['cID']) || (isset($_GET['cID']) && ($_GET['cID'] == $zones['zone_id']))) && !isset($cInfo) && (substr($action, 0, 3) != 'new')) {\n                $cInfo = new objectInfo($zones);\n              }\n\n              if (isset($cInfo) && is_object($cInfo) && ($zones['zone_id'] == $cInfo->zone_id)) {\n                echo '<tr class=\"table-active\" onclick=\"document.location.href=\\'' . tep_href_link('zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=edit') . '\\'\">';\n              } else {\n                echo '<tr onclick=\"document.location.href=\\'' . tep_href_link('zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $zones['zone_id']) . '\\'\">';\n              }\n              ?>\n                <td><?php echo $zones['countries_name']; ?></td>\n                <td><?php echo $zones['zone_name']; ?></td>\n                <td class=\"text-right\"><?php echo $zones['zone_code']; ?></td>\n                <td class=\"text-right\"><?php if (isset($cInfo) && is_object($cInfo) && ($zones['zone_id'] == $cInfo->zone_id) ) { echo '<i class=\"fas fa-chevron-circle-right text-info\"></i>'; } else { echo '<a href=\"' . tep_href_link('zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $zones['zone_id']) . '\"><i class=\"fas fa-info-circle text-muted\"></i></a>'; } ?></td>\n              </tr>\n              <?php\n              }\n            ?>\n          </tbody>\n        </table>\n      </div>\n      \n      <div class=\"row my-1\">\n        <div class=\"col\"><?php echo $zones_split->display_count($zones_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, $_GET['page'], TEXT_DISPLAY_NUMBER_OF_ZONES); ?></div>\n        <div class=\"col text-right mr-2\"><?php echo $zones_split->display_links($zones_query_numrows, MAX_DISPLAY_SEARCH_RESULTS, MAX_DISPLAY_PAGE_LINKS, $_GET['page']); ?></div>\n      </div>\n    </div>\n\n<?php\n  $heading = [];\n  $contents = [];\n\n  switch ($action) {\n    case 'new':\n      $heading[] = ['text' => TEXT_INFO_HEADING_NEW_ZONE];\n\n      $contents = ['form' => tep_draw_form('zones', 'zones.php', 'page=' . (int)$_GET['page'] . '&action=insert')];\n      $contents[] = ['text' => TEXT_INFO_INSERT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_ZONES_NAME . '<br>' . tep_draw_input_field('zone_name')];\n      $contents[] = ['text' => TEXT_INFO_ZONES_CODE . '<br>' . tep_draw_input_field('zone_code')];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . '<br>' . tep_draw_pull_down_menu('zone_country_id', tep_get_countries())];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('zones.php', 'page=' . (int)$_GET['page']), null, null, 'btn-light')];\n      break;\n    case 'edit':\n      $heading[] = ['text' => TEXT_INFO_HEADING_EDIT_ZONE];\n\n      $contents = ['form' => tep_draw_form('zones', 'zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=save')];\n      $contents[] = ['text' => TEXT_INFO_EDIT_INTRO];\n      $contents[] = ['text' => TEXT_INFO_ZONES_NAME . '<br>' . tep_draw_input_field('zone_name', $cInfo->zone_name)];\n      $contents[] = ['text' => TEXT_INFO_ZONES_CODE . '<br>' . tep_draw_input_field('zone_code', $cInfo->zone_code)];\n      $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . '<br>' . tep_draw_pull_down_menu('zone_country_id', tep_get_countries(), $cInfo->countries_id)];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_SAVE, 'fas fa-save', null, 'primary', null, 'btn-success xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->zone_id), null, null, 'btn-light')];\n      break;\n    case 'delete':\n      $heading[] = ['text' => TEXT_INFO_HEADING_DELETE_ZONE];\n\n      $contents = ['form' => tep_draw_form('zones', 'zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=deleteconfirm')];\n      $contents[] = ['text' => TEXT_INFO_DELETE_INTRO];\n      $contents[] = ['text' => '<strong>' . $cInfo->zone_name . '</strong>'];\n      $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', null, 'primary', null, 'btn-danger xxx text-white mr-2') . tep_draw_bootstrap_button(IMAGE_CANCEL, 'fas fa-times', tep_href_link('zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->zone_id), null, null, 'btn-light')];\n      break;\n    default:\n      if (isset($cInfo) && is_object($cInfo)) {\n        $heading[] = ['text' => $cInfo->zone_name];\n\n        $contents[] = ['class' => 'text-center', 'text' => tep_draw_bootstrap_button(IMAGE_EDIT, 'fas fa-cogs', tep_href_link('zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=edit'), null, null, 'btn-warning mr-2') . tep_draw_bootstrap_button(IMAGE_DELETE, 'fas fa-trash', tep_href_link('zones.php', 'page=' . (int)$_GET['page'] . '&cID=' . $cInfo->zone_id . '&action=delete'), null, null, 'btn-danger xxx text-white')];\n        $contents[] = ['text' => TEXT_INFO_ZONES_NAME . '<br>' . $cInfo->zone_name . ' (' . $cInfo->zone_code . ')'];\n        $contents[] = ['text' => TEXT_INFO_COUNTRY_NAME . ' ' . $cInfo->countries_name];\n      }\n      break;\n  }\n\n  if ( (tep_not_null($heading)) && (tep_not_null($contents)) ) {\n    echo '<div class=\"col-12 col-sm-3\">';\n      $box = new box;\n      echo $box->infoBox($heading, $contents);\n    echo '</div>';\n  }\n?>\n\n  </div>\n\n<?php\n  require('includes/template_bottom.php');\n  require('includes/application_bottom.php');\n?>\n"], "filenames": ["admin/advert_manager.php", "admin/countries.php", "admin/currencies.php", "admin/customer_data_groups.php", "admin/includes/modules/newsletters/product_notification.php", "admin/languages.php", "admin/manufacturers.php", "admin/newsletters.php", "admin/orders_status.php", "admin/reviews.php", "admin/specials.php", "admin/stats_customers.php", "admin/stats_products_purchased.php", "admin/stats_products_viewed.php", "admin/tax_classes.php", "admin/tax_rates.php", "admin/testimonials.php", "admin/zones.php"], "buggy_code_start_loc": [349, 44, 63, 52, 83, 50, 78, 26, 57, 26, 27, 59, 31, 31, 34, 40, 30, 36], "buggy_code_end_loc": [351, 164, 300, 214, 155, 223, 259, 336, 230, 350, 244, 61, 55, 54, 143, 160, 272, 149], "fixing_code_start_loc": [349, 44, 63, 52, 83, 50, 78, 26, 57, 26, 27, 59, 31, 31, 34, 40, 30, 36], "fixing_code_end_loc": [351, 164, 300, 214, 155, 223, 259, 336, 230, 350, 244, 61, 55, 54, 143, 160, 272, 149], "type": "CWE-79", "message": "Several XSS vulnerabilities in osCommerce CE Phoenix before 1.0.6.0 allow an attacker to inject and execute arbitrary JavaScript code. The malicious code can be injected as follows: the page parameter to catalog/admin/order_status.php, catalog/admin/tax_rates.php, catalog/admin/languages.php, catalog/admin/countries.php, catalog/admin/tax_classes.php, catalog/admin/reviews.php, or catalog/admin/zones.php; or the zpage or spage parameter to catalog/admin/geo_zones.php.", "other": {"cve": {"id": "CVE-2020-12058", "sourceIdentifier": "cve@mitre.org", "published": "2020-09-03T14:15:10.527", "lastModified": "2020-09-11T14:55:53.173", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Several XSS vulnerabilities in osCommerce CE Phoenix before 1.0.6.0 allow an attacker to inject and execute arbitrary JavaScript code. The malicious code can be injected as follows: the page parameter to catalog/admin/order_status.php, catalog/admin/tax_rates.php, catalog/admin/languages.php, catalog/admin/countries.php, catalog/admin/tax_classes.php, catalog/admin/reviews.php, or catalog/admin/zones.php; or the zpage or spage parameter to catalog/admin/geo_zones.php."}, {"lang": "es", "value": "M\u00faltiples vulnerabilidades de tipo XSS en osCommerce CE Phoenix versiones anteriores a 1.0.6.0, permiten a un atacante inyectar y ejecutar c\u00f3digo JavaScript arbitrario.&#xa0;El c\u00f3digo malicioso puede ser inyectado de la siguiente manera: el par\u00e1metro page en los archivo catalog/admin/order_status.php, catalog/admin/tax_rates.php, catalog/admin/languages.php, catalog/admin/countries.php, catalog/admin/tax_classes.php, catalog/admin/reviews.php o catalog/admin/zones.php;&#xa0;o el par\u00e1metro zpage o spage en el archivo catalog/admin/geo_zones.php"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:oscommerce:ce_phoenix:1.0.6.0:*:*:*:*:*:*:*", "matchCriteriaId": "EA667E93-1722-4482-9007-24D5B6548A27"}]}]}], "references": [{"url": "https://github.com/gburton/CE-Phoenix/commit/8d0fb97810bc28880415a3a31607f473bfc5fec8", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://sisl.lab.uic.edu/projects/chess/cross-site-scripting-in-cephoenix/", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "https://www.oscommerce.com/Us&News=155", "source": "cve@mitre.org", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/gburton/CE-Phoenix/commit/8d0fb97810bc28880415a3a31607f473bfc5fec8"}}