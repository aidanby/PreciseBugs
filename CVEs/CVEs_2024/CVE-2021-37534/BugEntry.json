{"buggy_code": ["<?php\n    $modelForForm = 'GalaxyCluster';\n    $forkedCluster = isset($forkedCluster) ? $forkedCluster : array();\n    $forkedClusterHtmlPreview = '';\n    if (isset($forkedClusterMeta)) {\n        foreach ($forkedClusterMeta as $key => $value) {\n            if (is_array($value)) {\n                $forkedClusterHtmlPreview .= sprintf('<div><b>%s: </b><div data-toggle=\"json\" class=\"large-left-margin\">%s</div></div>', h($key), json_encode($value));\n            } else {\n                $forkedClusterHtmlPreview .= sprintf('<div><b>%s: </b>%s</div>', h($key), h($value));\n            }\n        }\n    }\n\n    echo $this->element('genericElements/Form/genericForm', array(\n        'form' => $this->Form,\n        'data' => array(\n            'title' => (\n                $action == 'add' ?\n                    (isset($forkedClusterMeta) ? __('Fork Galaxy Cluster') : __('Add Galaxy Cluster')) :\n                    __('Edit Galaxy Cluster')\n            ),\n            'model' => $modelForForm,\n            'fields' => array(\n                array(\n                    'field' => 'value',\n                    'label' => __('Name'),\n                    'type' => 'text',\n                    'stayInLine' => true\n                ),\n                array(\n                    'field' => 'distribution',\n                    'options' => $distributionLevels,\n                    'default' => isset($cluster['GalaxyCluster']['distribution']) ? $cluster['GalaxyCluster']['distribution'] : $initialDistribution,\n                    'stayInLine' => 1\n                ),\n                array(\n                    'field' => 'sharing_group_id',\n                    'options' => $sharingGroups,\n                    'label' => __(\"Sharing Group\")\n                ),\n                !isset($forkedClusterMeta) ? '' : sprintf('<div id=\"fork_galaxy_preview\" class=\"panel-container fork-cluster-preview\"><h5>%s %s</h5>%s</div>',\n                    __('Forked Cluster data'),\n                    sprintf('<a class=\"%s %s black\" href=\"%s\"></a>', $this->FontAwesome->findNamespace('view'), 'fa-eye', '/galaxy_clusters/view/' . h($forkedCluster['GalaxyCluster']['id'])),\n                    $forkedClusterHtmlPreview\n                ),\n                array(\n                    'field' => 'galaxy_id',\n                    'type' => 'hidden',\n                    'default' => $galaxy_id\n                ),\n                array(\n                    'field' => 'extends_uuid',\n                    'type' => 'hidden',\n                ),\n                array(\n                    'field' => 'extends_version',\n                    'type' => 'hidden',\n                ),\n                array(\n                    'field' => 'description',\n                    'type' => 'textarea',\n                    'class' => 'input span6',\n                    'div' => 'input clear'\n                ),\n                array(\n                    'field' => 'authors',\n                    'rows' => 1,\n                    'help' => __('Valid JSON array or comma separated'),\n                    'stayInLine' => true\n                ),\n                array(\n                    'field' => 'source'\n                ),\n                array(\n                    'field' => 'elements',\n                    'label' => __(\"Galaxy Cluster Elements\"),\n                    'type' => 'textarea',\n                    'class' => 'input span6',\n                    'div' => 'input clear',\n                    'picker' => array(\n                        'text' => __('Toggle UI'),\n                        'function' => 'initClusterElementUI'\n                    )\n                ),\n            ),\n            'metaFields' => array(\n                $this->element('/GalaxyClusters/clusterElementUI', array(\n                    'elements' => isset($this->request->data['GalaxyCluster']['elementsDict']) ? $this->request->data['GalaxyCluster']['elementsDict'] : array(),\n                    'drawToggleButton' => false,\n                ))\n            )\n        )\n    ));\n    echo $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'galaxies', 'menuItem' => $this->action === 'add' ? 'add_cluster' : 'edit_cluster'));\n?>\n\n<script type=\"text/javascript\">\n    var forkedCluster = <?php echo json_encode($forkedCluster); ?>;\n    $('#GalaxyClusterDistribution').change(function() {\n        checkSharingGroup('GalaxyCluster');\n    });\n\n    $(document).ready(function() {\n        checkSharingGroup('GalaxyCluster');\n        $('[data-toggle=\\\"json\\\"]').each(function() {\n        $(this).attr('data-toggle', '')\n            .html(syntaxHighlightJson($(this).text().trim()));\n        });\n    });\n</script>\n<?php echo $this->Js->writeBuffer(); // Write cached scripts\n"], "fixing_code": ["<?php\n    $modelForForm = 'GalaxyCluster';\n    $forkedCluster = isset($forkedCluster) ? $forkedCluster : array();\n    $forkedClusterHtmlPreview = '';\n    if (isset($forkedClusterMeta)) {\n        foreach ($forkedClusterMeta as $key => $value) {\n            if (is_array($value)) {\n                $forkedClusterHtmlPreview .= sprintf('<div><b>%s: </b><div data-toggle=\"json\" class=\"large-left-margin\">%s</div></div>', h($key), json_encode(h($value)));\n            } else {\n                $forkedClusterHtmlPreview .= sprintf('<div><b>%s: </b>%s</div>', h($key), h($value));\n            }\n        }\n    }\n\n    echo $this->element('genericElements/Form/genericForm', array(\n        'form' => $this->Form,\n        'data' => array(\n            'title' => (\n                $action == 'add' ?\n                    (isset($forkedClusterMeta) ? __('Fork Galaxy Cluster') : __('Add Galaxy Cluster')) :\n                    __('Edit Galaxy Cluster')\n            ),\n            'model' => $modelForForm,\n            'fields' => array(\n                array(\n                    'field' => 'value',\n                    'label' => __('Name'),\n                    'type' => 'text',\n                    'stayInLine' => true\n                ),\n                array(\n                    'field' => 'distribution',\n                    'options' => $distributionLevels,\n                    'default' => isset($cluster['GalaxyCluster']['distribution']) ? $cluster['GalaxyCluster']['distribution'] : $initialDistribution,\n                    'stayInLine' => 1\n                ),\n                array(\n                    'field' => 'sharing_group_id',\n                    'options' => $sharingGroups,\n                    'label' => __(\"Sharing Group\")\n                ),\n                !isset($forkedClusterMeta) ? '' : sprintf('<div id=\"fork_galaxy_preview\" class=\"panel-container fork-cluster-preview\"><h5>%s %s</h5>%s</div>',\n                    __('Forked Cluster data'),\n                    sprintf('<a class=\"%s %s black\" href=\"%s\"></a>', $this->FontAwesome->findNamespace('view'), 'fa-eye', '/galaxy_clusters/view/' . h($forkedCluster['GalaxyCluster']['id'])),\n                    $forkedClusterHtmlPreview\n                ),\n                array(\n                    'field' => 'galaxy_id',\n                    'type' => 'hidden',\n                    'default' => $galaxy_id\n                ),\n                array(\n                    'field' => 'extends_uuid',\n                    'type' => 'hidden',\n                ),\n                array(\n                    'field' => 'extends_version',\n                    'type' => 'hidden',\n                ),\n                array(\n                    'field' => 'description',\n                    'type' => 'textarea',\n                    'class' => 'input span6',\n                    'div' => 'input clear'\n                ),\n                array(\n                    'field' => 'authors',\n                    'rows' => 1,\n                    'help' => __('Valid JSON array or comma separated'),\n                    'stayInLine' => true\n                ),\n                array(\n                    'field' => 'source'\n                ),\n                array(\n                    'field' => 'elements',\n                    'label' => __(\"Galaxy Cluster Elements\"),\n                    'type' => 'textarea',\n                    'class' => 'input span6',\n                    'div' => 'input clear',\n                    'picker' => array(\n                        'text' => __('Toggle UI'),\n                        'function' => 'initClusterElementUI'\n                    )\n                ),\n            ),\n            'metaFields' => array(\n                $this->element('/GalaxyClusters/clusterElementUI', array(\n                    'elements' => isset($this->request->data['GalaxyCluster']['elementsDict']) ? $this->request->data['GalaxyCluster']['elementsDict'] : array(),\n                    'drawToggleButton' => false,\n                ))\n            )\n        )\n    ));\n    echo $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'galaxies', 'menuItem' => $this->action === 'add' ? 'add_cluster' : 'edit_cluster'));\n?>\n\n<script type=\"text/javascript\">\n    var forkedCluster = <?php echo json_encode($forkedCluster); ?>;\n    $('#GalaxyClusterDistribution').change(function() {\n        checkSharingGroup('GalaxyCluster');\n    });\n\n    $(document).ready(function() {\n        checkSharingGroup('GalaxyCluster');\n        $('[data-toggle=\\\"json\\\"]').each(function() {\n        $(this).attr('data-toggle', '')\n            .html(syntaxHighlightJson($(this).text().trim()));\n        });\n    });\n</script>\n<?php echo $this->Js->writeBuffer(); // Write cached scripts\n"], "filenames": ["app/View/GalaxyClusters/add.ctp"], "buggy_code_start_loc": [8], "buggy_code_end_loc": [9], "fixing_code_start_loc": [8], "fixing_code_end_loc": [9], "type": "CWE-79", "message": "app/View/GalaxyClusters/add.ctp in MISP 2.4.146 allows Stored XSS when forking a galaxy cluster.", "other": {"cve": {"id": "CVE-2021-37534", "sourceIdentifier": "cve@mitre.org", "published": "2021-07-26T14:15:07.920", "lastModified": "2021-08-03T20:36:07.897", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "app/View/GalaxyClusters/add.ctp in MISP 2.4.146 allows Stored XSS when forking a galaxy cluster."}, {"lang": "es", "value": "un archivo app/View/GalaxyClusters/add.ctp en MISP versi\u00f3n 2.4.146, permite un ataque de tipo XSS almacenado cuando se bifurca un cluster galaxy"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp:misp:2.4.146:*:*:*:*:*:*:*", "matchCriteriaId": "0DC9A466-8596-454D-A429-EA5004A71418"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/78edbbca64a1edc4390560cc106d0d418064355d", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/78edbbca64a1edc4390560cc106d0d418064355d"}}