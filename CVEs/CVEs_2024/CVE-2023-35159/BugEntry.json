{"buggy_code": ["## ---------------------------------------------------------------------------\n## See the NOTICE file distributed with this work for additional\n## information regarding copyright ownership.\n##\n## This is free software; you can redistribute it and/or modify it\n## under the terms of the GNU Lesser General Public License as\n## published by the Free Software Foundation; either version 2.1 of\n## the License, or (at your option) any later version.\n##\n## This software is distributed in the hope that it will be useful,\n## but WITHOUT ANY WARRANTY; without even the implied warranty of\n## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n## Lesser General Public License for more details.\n##\n## You should have received a copy of the GNU Lesser General Public\n## License along with this software; if not, write to the Free\n## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n## 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n## ---------------------------------------------------------------------------\n###\n### Delete space confirm message\n###\n###\n#template(\"startpage.vm\")\n<div class=\"main layoutsubsection\">\n  <div id=\"mainContentArea\">\n    #if ($message)\n      <div id=\"xwikimessage\">$message</div>\n    #end\n    #set ($cancelURL = $doc.getURL())\n    #if ($request.xredirect)\n      #set ($redirectparam = \"&amp;xredirect=$escapetool.url($request.xredirect)\")\n      #set ($cancelURL = $request.xredirect)\n    #end\n    #if ($xwiki.hasRecycleBin())\n      #set ($confirmationMessage = $services.localization.render('core.space.recyclebin.confirm', [\"<em>${escapetool.xml($doc.space)}</em>\"]))\n    #else\n      #set ($confirmationMessage = $services.localization.render('core.space.delete.confirm', [\"<em>${escapetool.xml($doc.space)}</em>\"]))\n    #end\n\n    ##\n    ## List the documents to be deleted using a livetable\n    ##\n    #set ($collist = ['doc.name','doc.date', 'doc.author'])\n    #set ($colprops = {\n      'doc.name' : { 'link' : 'view' },\n      'doc.author' : { 'link' : 'author' }\n    })\n    #set ($urlParameters = \"xpage=getdocuments&space=$escapetool.url($doc.space)&queryFilters=unique\")\n    #set ($options = { \n      'url' : \"$doc.getURL('get', $urlParameters)\",\n      'translationPrefix' : 'platform.index.',\n      'outputOnlyHtml' : true\n    })\n    ## Grab the output of the livetable macro so we can include it in the confirmation message below\n    #define ($spaceIndexLiveTable)\n    <div class='text-left'>\n      #livetable('deleteSpaceIndex' $collist $colprops $options)\n    </div>\n    #end\n\n    ## Build and show the final confirmation message containing the livetable\n    #set ($confirmationMessage = \"$confirmationMessage <br /> $spaceIndexLiveTable\")\n    #xwikimessagebox($services.localization.render('core.delete') $confirmationMessage $doc.getURL('deletespace', \"confirm=1$!{redirectparam}&amp;form_token=$!{services.csrf.getToken()}\") $escapetool.xml($cancelURL) $services.localization.render('yes') $services.localization.render('no'))\n    <div class=\"clearfloats\"></div>\n  </div>\n</div>\n#template(\"endpage.vm\")"], "fixing_code": ["## ---------------------------------------------------------------------------\n## See the NOTICE file distributed with this work for additional\n## information regarding copyright ownership.\n##\n## This is free software; you can redistribute it and/or modify it\n## under the terms of the GNU Lesser General Public License as\n## published by the Free Software Foundation; either version 2.1 of\n## the License, or (at your option) any later version.\n##\n## This software is distributed in the hope that it will be useful,\n## but WITHOUT ANY WARRANTY; without even the implied warranty of\n## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n## Lesser General Public License for more details.\n##\n## You should have received a copy of the GNU Lesser General Public\n## License along with this software; if not, write to the Free\n## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n## 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n## ---------------------------------------------------------------------------\n###\n### Delete space confirm message\n###\n###\n#template(\"startpage.vm\")\n<div class=\"main layoutsubsection\">\n  <div id=\"mainContentArea\">\n    #if ($message)\n      <div id=\"xwikimessage\">$message</div>\n    #end\n    #set ($cancelURL = $doc.getURL())\n    #if ($request.xredirect)\n      ## We don't sanitize this as it will be handled by the server\n      #set ($redirectparam = \"&amp;xredirect=$escapetool.url($request.xredirect)\")\n      #getSanitizedURLAttributeValue('a','href',$request.xredirect,$doc.getURL(),$cancelURL)\n    #end\n    #if ($xwiki.hasRecycleBin())\n      #set ($confirmationMessage = $services.localization.render('core.space.recyclebin.confirm', [\"<em>${escapetool.xml($doc.space)}</em>\"]))\n    #else\n      #set ($confirmationMessage = $services.localization.render('core.space.delete.confirm', [\"<em>${escapetool.xml($doc.space)}</em>\"]))\n    #end\n\n    ##\n    ## List the documents to be deleted using a livetable\n    ##\n    #set ($collist = ['doc.name','doc.date', 'doc.author'])\n    #set ($colprops = {\n      'doc.name' : { 'link' : 'view' },\n      'doc.author' : { 'link' : 'author' }\n    })\n    #set ($urlParameters = \"xpage=getdocuments&space=$escapetool.url($doc.space)&queryFilters=unique\")\n    #set ($options = { \n      'url' : \"$doc.getURL('get', $urlParameters)\",\n      'translationPrefix' : 'platform.index.',\n      'outputOnlyHtml' : true\n    })\n    ## Grab the output of the livetable macro so we can include it in the confirmation message below\n    #define ($spaceIndexLiveTable)\n    <div class='text-left'>\n      #livetable('deleteSpaceIndex' $collist $colprops $options)\n    </div>\n    #end\n\n    ## Build and show the final confirmation message containing the livetable\n    #set ($confirmationMessage = \"$confirmationMessage <br /> $spaceIndexLiveTable\")\n    #xwikimessagebox($services.localization.render('core.delete') $confirmationMessage $doc.getURL('deletespace', \"confirm=1$!{redirectparam}&amp;form_token=$!{services.csrf.getToken()}\") $escapetool.xml($cancelURL) $services.localization.render('yes') $services.localization.render('no'))\n    <div class=\"clearfloats\"></div>\n  </div>\n</div>\n#template(\"endpage.vm\")"], "filenames": ["xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/deletespace.vm"], "buggy_code_start_loc": [31], "buggy_code_end_loc": [34], "fixing_code_start_loc": [32], "fixing_code_end_loc": [35], "type": "CWE-79", "message": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. Users are able to forge an URL with a payload allowing to inject Javascript in the page (XSS). It's possible to exploit the deletespace template to perform a XSS, e.g. by using URL such as: > xwiki/bin/deletespace/Sandbox/?xredirect=javascript:alert(document.domain). This vulnerability exists since XWiki 3.4-milestone-1. The vulnerability has been patched in XWiki 14.10.5 and 15.1-rc-1.", "other": {"cve": {"id": "CVE-2023-35159", "sourceIdentifier": "security-advisories@github.com", "published": "2023-06-23T19:15:09.497", "lastModified": "2023-06-30T13:10:48.407", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. Users are able to forge an URL with a payload allowing to inject Javascript in the page (XSS). It's possible to exploit the deletespace template to perform a XSS, e.g. by using URL such as: > xwiki/bin/deletespace/Sandbox/?xredirect=javascript:alert(document.domain). This vulnerability exists since XWiki 3.4-milestone-1. The vulnerability has been patched in XWiki 14.10.5 and 15.1-rc-1."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.6, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.8, "impactScore": 6.0}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-87"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "3.5", "versionEndExcluding": "14.10.5", "matchCriteriaId": "F166D91A-7A3E-4244-AE9F-9EA0F25C8A37"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:3.4:milestone-1:*:*:*:*:*:*", "matchCriteriaId": "90C2E9CD-60B5-4E8D-A5B9-4703CFA049F1"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:3.5:rc-1:*:*:*:*:*:*", "matchCriteriaId": "2FDBC709-4A09-44D4-8E7C-C2DFB23201AA"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:15.0:*:*:*:*:*:*:*", "matchCriteriaId": "8F9D9551-B148-44B6-A5B3-889E6E7B72E8"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/5c20ff5e3bdea50f1053fe99a27e011b8d0e4b34", "source": "security-advisories@github.com", "tags": ["Patch", "Vendor Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-x234-mg7q-m8g8", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-20583", "source": "security-advisories@github.com", "tags": ["Issue Tracking", "Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-20612", "source": "security-advisories@github.com", "tags": ["Issue Tracking", "Permissions Required", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/5c20ff5e3bdea50f1053fe99a27e011b8d0e4b34"}}