{"buggy_code": ["<?php\n/*\nPlugin Name: Resend Welcome Email\nPlugin URI: http://www.twitter.com/atwellpub\nDescription: Adds option to regenerate and resend password to user. Adds this option to user profile edit screen. \nVersion: 1.0.1\nAuthor: adbox\nAuthor URI: http://www.twitter.com/atwellpub\n*\n*/\n\n\n\nif ( !class_exists( 'Resend_Welcome_Email' )) {\n\n\tclass Resend_Welcome_Email {\n\t\t\n\t\t/**\n\t\t*  initiates class\n\t\t*/\n\t\tpublic function __construct() {\n\n\t\t\tglobal $wpdb;\n\t\t\t\n\t\t\tif (!current_user_can('edit_user')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\t/* Define constants */\n\t\t\tself::define_constants();\n\t\t\t\n\t\t\t/* Define hooks and filters */\n\t\t\tself::load_hooks();\n\t\t\t\n\t\t\t/* adds admin listeners for processing actions */\t\t\t\n\t\t\tself::add_admin_listeners();\n\t\t\t\n\t\t}\n\t\t\n\n\t\t\n\t\t/**\n\t\t*  Defines constants\n\t\t*/\n\t\tpublic static function define_constants() {\n\t\t\tdefine('RESEND_WELCOME_EMAIL_CURRENT_VERSION', '1.0.1' ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_LABEL' , 'Resend Welcome Email' ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_SLUG' , plugin_basename( dirname(__FILE__) ) ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_FILE' ,  __FILE__ ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_URLPATH', plugins_url( ' ', __FILE__ ) ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_PATH', WP_PLUGIN_DIR.'/'.plugin_basename( dirname(__FILE__) ).'/' ); \n\t\t}\n\t\t\n\t\t/**\n\t\t*  Loads hooks and filters selectively\n\t\t*/\n\t\tpublic static function load_hooks() {\n\t\t\t\t\n\t\t\t//add_filter( 'user_row_actions',  array( __CLASS__ , 'filter_user_row_actions' ), 10, 2 );\n\t\t\tadd_filter( 'personal_options',  array( __CLASS__ , 'personal_options' ), 10, 2 );\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t\t/**\n\t\t *  Discovers which tests to run and runs them\n\t\t */\n\t\tpublic static function filter_user_row_actions(  array $actions, WP_User $user ) {\n\t\t\t\n\t\t\tif ( ! $link = self::send_welcome_email_url( $user ) ) {\n\t\t\t\treturn $actions;\n\t\t\t}\n\n\t\t\t$actions['send_welcome_email'] = '<a href=\"' . $link . '\">' . __( 'Resend Welcome Email', 'resend-welcome-email' ) . '</a>';\n\n\t\t\treturn $actions;\n\t\t}\n\t\t\n\t\tpublic static function personal_options(  WP_User $user ) {\n\t\t\tif ( ! $link = self::send_welcome_email_url( $user ) ) {\n\t\t\t\treturn $actions;\n\t\t\t}\n\t\t\t\n\t\t\t?>\n\t\t\t<tr>\n\t\t\t\t<th scope=\"row\"><?php _e( 'Reset Password and Send Welcome Email',  'user-switching' ); ?></th>\n\t\t\t\t<td><a href=\"<?php echo $link; ?>\"><?php _e( 'Reset Password and Send Welcome Email', 'user-switching' ); ?></a></td>\n\t\t\t</tr>\n\t\t\t<?php\n\t\t}\n\t\t\n\t\t/**\n\t\t *  Listens for email send commands and fires them\n\t\t */\n\t\tpublic static function add_admin_listeners() {\n\t\t\tif (!isset($_GET['action']) && $_GET['action'] != 'resend_welcome_email' ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\n\t\t\t/* Resend welcome email */\n\t\t\tself::resend_welcome_email();\t\n\t\t\t\n\t\t\t/* Register success notice */\n\t\t\tadd_action( 'admin_notices', array( __CLASS__ , 'define_notice') );\n\t\t\t\n\t\t}\n\t\t\n\t\t/** \n\t\t *  Register admin notice that email has been sent\n\t\t */\n\t\tpublic static function define_notice() {\n\t\t\t?>\n\t\t\t<div class=\"updated\">\n\t\t\t\t<p><?php _e( 'Welcome email sent!' , 'resend-welcome-email'); ?></p>\n\t\t\t</div>\n\t\t\t<?php\t\t\t\n\t\t}\n\t\t\n\t\t/**\n\t\t * Helper function. Returns the switch to or switch back URL for a given user.\n\t\t *\n\t\t * @param  WP_User $user The user to be switched to.\n\t\t * @return string|bool The required URL, or false if there's no old user or the user doesn't have the required capability.\n\t\t */\n\t\tpublic static function send_welcome_email_url( WP_User $user ) {\n\n\t\t\treturn wp_nonce_url( add_query_arg( array(\n\t\t\t\t'action'  => 'resend_welcome_email',\n\t\t\t\t'user_id' => $user->ID\n\t\t\t), '') , \"send_welcome_email_{$user->ID}\" );\n\n\t\t}\n\t\t\n\t\t/**\n\t\t * Resends the welcome email\n\t\t *\n\t\t * @param  int  $user_id      The ID of the user to re-send welcome email to\n\t\t * @return bool|WP_User WP_User object on success, false on failure.\n\t\t */\n\t\tpublic static function resend_welcome_email( ) {\n\t\t\t$user_id = $_GET['user_id'];\n\t\t\t\n\t\t\tif ( !$user = get_userdata( $user_id ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t// Generate a password\n\t\t\t$password = substr(md5(uniqid(microtime())), 0, 7);\n\t\t\t$user_info = get_userdata($user_id);\n\n\t\t\twp_update_user(array('ID' => $user_id, 'user_pass' => $password));\n\t\n\t\t\twp_new_user_notification($user_id, $password);\n\n\t\t}\n\t\t\n\t\t\n\t}\n\n\t/** \n\t*  Load Resend_Welcome_Email class in init\n\t*/\n\tfunction Load_Resend_Welcome_Email() {\n\t\t$Resend_Welcome_Email = new Resend_Welcome_Email();\n\t}\n\tadd_action( 'admin_init' , 'Load_Resend_Welcome_Email' , 99 );\n}"], "fixing_code": ["<?php\n/*\nPlugin Name: Resend Welcome Email\nPlugin URI: http://www.twitter.com/atwellpub\nDescription: Adds option to regenerate and resend password to user. Adds this option to user profile edit screen. \nVersion: 1.0.1\nAuthor: adbox\nAuthor URI: http://www.twitter.com/atwellpub\n*\n*/\n\n\n\nif ( !class_exists( 'Resend_Welcome_Email' )) {\n\n\tclass Resend_Welcome_Email {\n\t\t\n\t\t/**\n\t\t*  initiates class\n\t\t*/\n\t\tpublic function __construct() {\n\n\t\t\tglobal $wpdb;\n\t\t\t\n\t\t\tif (!current_user_can('edit_user')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\t/* Define constants */\n\t\t\tself::define_constants();\n\t\t\t\n\t\t\t/* Define hooks and filters */\n\t\t\tself::load_hooks();\n\t\t\t\n\t\t\t/* adds admin listeners for processing actions */\t\t\t\n\t\t\tself::add_admin_listeners();\n\t\t\t\n\t\t}\n\t\t\n\n\t\t\n\t\t/**\n\t\t*  Defines constants\n\t\t*/\n\t\tpublic static function define_constants() {\n\t\t\tdefine('RESEND_WELCOME_EMAIL_CURRENT_VERSION', '1.0.1' ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_LABEL' , 'Resend Welcome Email' ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_SLUG' , plugin_basename( dirname(__FILE__) ) ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_FILE' ,  __FILE__ ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_URLPATH', plugins_url( ' ', __FILE__ ) ); \n\t\t\tdefine('RESEND_WELCOME_EMAIL_PATH', WP_PLUGIN_DIR.'/'.plugin_basename( dirname(__FILE__) ).'/' ); \n\t\t}\n\t\t\n\t\t/**\n\t\t*  Loads hooks and filters selectively\n\t\t*/\n\t\tpublic static function load_hooks() {\n\t\t\t\t\n\t\t\t//add_filter( 'user_row_actions',  array( __CLASS__ , 'filter_user_row_actions' ), 10, 2 );\n\t\t\tadd_filter( 'personal_options',  array( __CLASS__ , 'personal_options' ), 10, 2 );\n\t\t\t\n\t\t}\n\t\t\n\t\t\n\t\t/**\n\t\t *  Discovers which tests to run and runs them\n\t\t */\n\t\tpublic static function filter_user_row_actions(  array $actions, WP_User $user ) {\n\t\t\t\n\t\t\tif ( ! $link = self::send_welcome_email_url( $user ) ) {\n\t\t\t\treturn $actions;\n\t\t\t}\n\n\t\t\t$actions['send_welcome_email'] = '<a href=\"' . $link . '\">' . __( 'Resend Welcome Email', 'resend-welcome-email' ) . '</a>';\n\n\t\t\treturn $actions;\n\t\t}\n\t\t\n\t\tpublic static function personal_options(  WP_User $user ) {\n\t\t\tif ( ! $link = self::send_welcome_email_url( $user ) ) {\n\t\t\t\treturn $actions;\n\t\t\t}\n\t\t\t\n\t\t\t?>\n\t\t\t<tr>\n\t\t\t\t<th scope=\"row\"><?php _e( 'Reset Password and Send Welcome Email',  'user-switching' ); ?></th>\n\t\t\t\t<td><a href=\"<?php echo $link; ?>\"><?php _e( 'Reset Password and Send Welcome Email', 'user-switching' ); ?></a></td>\n\t\t\t</tr>\n\t\t\t<?php\n\t\t}\n\t\t\n\t\t/**\n\t\t *  Listens for email send commands and fires them\n\t\t */\n\t\tpublic static function add_admin_listeners() {\n\t\t\tif (!isset($_GET['action']) && $_GET['action'] != 'resend_welcome_email' ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\n\t\t\t/* Resend welcome email */\n\t\t\tself::resend_welcome_email();\t\n\t\t\t\n\t\t\t/* Register success notice */\n\t\t\tadd_action( 'admin_notices', array( __CLASS__ , 'define_notice') );\n\t\t\t\n\t\t}\n\t\t\n\t\t/** \n\t\t *  Register admin notice that email has been sent\n\t\t */\n\t\tpublic static function define_notice() {\n\t\t\t?>\n\t\t\t<div class=\"updated\">\n\t\t\t\t<p><?php _e( 'Welcome email sent!' , 'resend-welcome-email'); ?></p>\n\t\t\t</div>\n\t\t\t<?php\t\t\t\n\t\t}\n\t\t\n\t\t/**\n\t\t * Helper function. Returns the switch to or switch back URL for a given user.\n\t\t *\n\t\t * @param  WP_User $user The user to be switched to.\n\t\t * @return string|bool The required URL, or false if there's no old user or the user doesn't have the required capability.\n\t\t */\n\t\tpublic static function send_welcome_email_url( WP_User $user ) {\n\n\t\t\treturn esc_url(wp_nonce_url( add_query_arg( array(\n\t\t\t\t'action'  => 'resend_welcome_email',\n\t\t\t\t'user_id' => $user->ID\n\t\t\t), '') , \"send_welcome_email_{$user->ID}\" ));\n\n\t\t}\n\t\t\n\t\t/**\n\t\t * Resends the welcome email\n\t\t *\n\t\t * @param  int  $user_id      The ID of the user to re-send welcome email to\n\t\t * @return bool|WP_User WP_User object on success, false on failure.\n\t\t */\n\t\tpublic static function resend_welcome_email( ) {\n\t\t\t$user_id = $_GET['user_id'];\n\t\t\t\n\t\t\tif ( !$user = get_userdata( $user_id ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t// Generate a password\n\t\t\t$password = substr(md5(uniqid(microtime())), 0, 7);\n\t\t\t$user_info = get_userdata($user_id);\n\n\t\t\twp_update_user(array('ID' => $user_id, 'user_pass' => $password));\n\t\n\t\t\twp_new_user_notification($user_id, $password);\n\n\t\t}\n\t\t\n\t\t\n\t}\n\n\t/** \n\t*  Load Resend_Welcome_Email class in init\n\t*/\n\tfunction Load_Resend_Welcome_Email() {\n\t\t$Resend_Welcome_Email = new Resend_Welcome_Email();\n\t}\n\tadd_action( 'admin_init' , 'Load_Resend_Welcome_Email' , 99 );\n}"], "filenames": ["resend-welcome-email.php"], "buggy_code_start_loc": [127], "buggy_code_end_loc": [131], "fixing_code_start_loc": [127], "fixing_code_end_loc": [131], "type": "CWE-79", "message": "A vulnerability, which was classified as problematic, has been found in atwellpub Resend Welcome Email Plugin 1.0.1. This issue affects the function send_welcome_email_url of the file resend-welcome-email.php. The manipulation leads to cross site scripting. The attack may be initiated remotely. Upgrading to version 1.0.2 is able to address this issue. The name of the patch is b14c1f66d307783f0ae74f88088a85999107695c. It is recommended to upgrade the affected component. The identifier VDB-220637 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2015-10078", "sourceIdentifier": "cna@vuldb.com", "published": "2023-02-12T14:15:10.427", "lastModified": "2023-02-22T14:25:27.360", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, has been found in atwellpub Resend Welcome Email Plugin 1.0.1. This issue affects the function send_welcome_email_url of the file resend-welcome-email.php. The manipulation leads to cross site scripting. The attack may be initiated remotely. Upgrading to version 1.0.2 is able to address this issue. The name of the patch is b14c1f66d307783f0ae74f88088a85999107695c. It is recommended to upgrade the affected component. The identifier VDB-220637 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:resend_welcome_email_project:resend_welcome_email:1.0.1:*:*:*:*:wordpress:*:*", "matchCriteriaId": "B3A24D53-4185-4125-B2A0-C7868D9D61A4"}]}]}], "references": [{"url": "https://github.com/atwellpub/resend-welcome-email/commit/b14c1f66d307783f0ae74f88088a85999107695c", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/atwellpub/resend-welcome-email/pull/1", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://vuldb.com/?ctiid.220637", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.220637", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/atwellpub/resend-welcome-email/commit/b14c1f66d307783f0ae74f88088a85999107695c"}}