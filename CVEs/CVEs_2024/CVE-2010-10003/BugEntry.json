{"buggy_code": ["<?php\r\n// Check to ensure this file is included in Joomla!\r\ndefined( '_JEXEC' ) or die('Direct Access to this location is not allowed.');\r\n\r\n?>\r\n\r\n2009-06-06:\r\n\r\n- [#16580] Exact Match as default or plugin option\r\n\r\n\r\n2009-05-27:\r\n\r\n- added plugin_jmovies (thanks to Onimaro)\r\n\r\n\r\n2008-11-13:\r\n\r\n- fixed creation of wrong content article links ... though they worked correctly in Joomla *phew*\r\n\r\n\r\n2008-11-10:\r\n\r\n- [#13627] link to the site-internal search\r\n- code cleanup\r\n\r\n\r\n2008-10-28:\r\n\r\n- corrections for new plugins (using new Joomla! 1.5.x API)\r\n- implemented new sorting of plugins\r\n- other plugins are disabled by default (only content and menuitem plugins are enabled) \r\n\r\n\r\n2008-10-26:\r\n\r\n- new plugins by external contributions, but there still needs to be a new option to sort plugins.\r\n\r\n\r\n2008-10-19:\r\n\r\n- updated documentation link http://www.gesellix.de/joomla/36-titlelink/46-titlelink-documentation.html\r\n\r\n\r\n2008-09-17:\r\n\r\n- fixes [#12606] TL 3.0.5 cannot find uncategorized articles\r\n- fixes missing links when Joomla table prefix isn't 'jos'\r\n\r\n\r\n2008-08-18:\r\n\r\n- fixed \"empty\" page issue, when plugin was called from other components\r\n\r\n\r\n2008-08-18:\r\n\r\n- [#10182] SEF don't work correctly\r\n- method=\"upgrade\" to enable users making updates without uninstall\r\n\r\n\r\n<?php\r\n?>", "<?php\r\n/**\r\n * @copyright Copyright (C) 2005 - 2007 Tobias Gesellchen. All rights reserved.\r\n * @license   GNU/GPL, see LICENSE.php\r\n * Joomla! is free software. This version may have been modified pursuant\r\n * to the GNU General Public License, and as distributed it includes or\r\n * is derivative of works licensed under the GNU General Public License or\r\n * other free or open source software licenses.\r\n * See COPYRIGHT.php for copyright notices and details.\r\n */\r\n\r\n// Check to ensure this file is included in Joomla!\r\ndefined( '_JEXEC' ) or die('Direct Access to this location is not allowed.');\r\n\r\njimport( 'joomla.plugin.plugin' );\r\n\r\nclass plgContentTitleLink extends JPlugin\r\n{\r\n  /**\r\n   * caches results of plugins\r\n   * index-key: phrase\r\n   * value: plugin result\r\n   */\r\n  //var $titlelink_cache = array();\r\n  var $plugin_cache;\r\n\r\n  var $title1_delim = \" '\";\r\n  var $title2_delim = \" ''\";\r\n\r\n  var $plugin_call = \"plugin_call\";\r\n  var $item_id = \"itemid-\";\r\n  var $limitstart = \"limitstart-\";\r\n  var $append_url = \"append-\";\r\n  var $css_class_pattern = \"css-\";\r\n  var $search_pattern = \"search-\";\r\n  var $newwindow = \"nw\";\r\n  var $open_tag = \"op\";  // don't close the anchor tag, like: '<a href=...>'\r\n  var $search_site = \"search\";\r\n  var $search_google = \"google\";\r\n  var $search_yahoo = \"yahoo\";\r\n  var $search_wikipedia = \"wikipedia\";\r\n  var $exact_match = \"em\";\r\n  var $replace_match = \"rep\";\r\n  var $link_http = \"http\";\r\n  var $enabled = \"enable\";\r\n  var $debug_mode = \"debug\";\r\n\r\n  var $dir        = 'plugins/content/titlelink_plugins';\r\n  var $pluginmask = 'plugin_';\r\n\r\n  /**\r\n   * see http://www.php.net/manual/en/reference.pcre.pattern.syntax.php\r\n   * for details: this special \"character\" is used as start/end tag\r\n   * for the preg_match functions.\r\n   */\r\n  var $pattern_start_end = \"\\x01\";\r\n\r\n  // configuration\r\n\r\n  var $trigger_prefix;\r\n  var $trigger_suffix;\r\n  var $separator;\r\n  var $enablenewcontent;\r\n  var $enablepartialmatch;\r\n  var $disp_link;\r\n  var $disp_tooltip;\r\n  var $linkr_enabled;\r\n\r\n  var $finalpattern;\r\n\r\n\r\n  /**\r\n   * Constructor\r\n   *\r\n   * For php4 compatability we must not use the __constructor as a constructor for plugins\r\n   * because func_get_args ( void ) returns a copy of all passed arguments NOT references.\r\n   * This causes problems with cross-referencing necessary for the observer design pattern.\r\n   *\r\n   * @param object $subject The object to observe\r\n   * @param object $params  The object that holds the plugin parameters\r\n   */\r\n  function plgContentTitleLink( &$subject, $params )\r\n  {\r\n    parent::__construct( $subject, $params );\r\n\r\n    $this->trigger_prefix = $this->params->get( 'trigger_prefix', \"{ln\" );\r\n    $this->trigger_suffix = $this->params->get( 'trigger_suffix', \"}\" );\r\n    $this->separator = $this->params->get( 'separator', \":\" );\r\n    $this->enablenewcontent = $this->params->get( 'enablenewcontent', 0 );\r\n    $this->enablepartialmatch = $this->params->get( 'enablepartialmatch', 1 );\r\n    $this->disp_link = $this->params->get( 'disp_link', 1 );\r\n    $this->disp_tooltip = $this->params->get( 'disp_tooltip', 1 );\r\n    $this->linkr_enabled = $this->params->get( 'linkr_enabled', 1 );\r\n\r\n    $this->finalpattern = $this->pattern_start_end.preg_quote($this->trigger_prefix).\".+?\".preg_quote($this->trigger_suffix).$this->pattern_start_end;\r\n\r\n    if ($this->plugin_cache == null || !is_array($this->plugin_cache))\r\n    {\r\n      $this->plugin_cache = $this->getPluginFunctions($this->dir, $this->pluginmask, $this->params);\r\n    }\r\n\r\n    //$this->titlelink_cache = array();\r\n  }\r\n\r\n  // Send links to Linkr\r\n  function onLinkrGetLinks( $version )\r\n  {\r\n    $result = array();\r\n\r\n    // This plugin doesn't actually do anything.\r\n    // It will only display the current version\r\n    // in a popup using the LinkrHelper.test()\r\n    // javascript function\r\n\r\n    if ($this->linkr_enabled && $version >= 2.2)\r\n    {\r\n      $msg = 'TitleLink plugin is working on Linkr '. $version;\r\n\r\n      // Since this will be added to the \"onclick\"\r\n      // attribute, use 'single quotes' instead\r\n      // of \"double quotes\"\r\n      //$js = 'LinkrHelper.test(\\''. $msg .'\\')';\r\n\r\n      // Return link title and javascript statement\r\n      $result = array(\r\n        'TitleLink' => 'LinkrHelper.layout(\\'link\\')'\r\n      );\r\n    }\r\n\r\n    return $result;\r\n  }\r\n\r\n  // Linkr Scripts\r\n  function onLinkrLoadJS( $version )\r\n  {\r\n    if ($this->linkr_enabled && $version >= 2.2 && 2==1)\r\n    {\r\n      $doc = & JFactory::getDocument();\r\n      $doc->addScript( 'plugins/content/titlelink_plugins/linkr_script.js' );\r\n\r\n      // URL for AJAX requests. Be sure to use full URLs\r\n      $r = JURI::base() .'index.php?option=com_foo&amp;tmpl=component&amp;view=foo&amp;'. JUtility::getToken() .'=1';\r\n\r\n      return 'LinkrFoo.init(\\''. $r .'\\');';\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Replaces TitleLinks with the correct html hyperlinks\r\n   *\r\n   * Method is called by the view\r\n   *\r\n   * @param   object    The article object.  Note $article->text is also available\r\n   * @param   object    The article params\r\n   * @param   int     The 'page' number\r\n   */\r\n  function onPrepareContent(&$article, &$params, $limitstart)\r\n  {\r\n    global $mainframe, $titlelink_cache;\r\n\r\n    $database = & JFactory::getDBO();\r\n\r\n    $content = $article->text;\r\n    $matches = array ();\r\n\r\n    if (preg_match_all($this->finalpattern, $content, $matches, PREG_PATTERN_ORDER))\r\n    {\r\n      $titlelink_disabled = false;\r\n      $titlelink_was_disabled = false;\r\n\r\n      foreach ($matches as $fmatch)\r\n      {\r\n        foreach ($fmatch as $match)\r\n        {\r\n          if ($match == \"\")\r\n          {\r\n            continue;\r\n          }\r\n\r\n          $match = str_replace($this->trigger_prefix, \"\", $match);\r\n          $match = str_replace($this->trigger_suffix, \"\", $match);\r\n\r\n          $match = html_entity_decode($match, ENT_QUOTES);\r\n\r\n          // split phrase and title\r\n          $title1 = null;\r\n          $title2 = null;\r\n          $delimpos = strpos($match, $this->title1_delim);\r\n          if ($delimpos !== false)\r\n          {\r\n            $title1 = substr($match, $delimpos + strlen($this->title1_delim));\r\n            $match = substr($match, 0, $delimpos);\r\n\r\n            $delimpos = strpos($title1, $this->title2_delim);\r\n            if ($delimpos !== false)\r\n            {\r\n              $title2 = substr($title1, $delimpos + strlen($this->title2_delim));\r\n              $title1 = substr($title1, 0, $delimpos);\r\n            }\r\n          }\r\n\r\n          $pieces = explode($this->separator, $match);\r\n          $phrase = trim($pieces[count($pieces) - 1]);\r\n\r\n          // Look for an anchor name in the phrase string (thanks to Federico Filipponi, 2006-11-10)\r\n          $anchor = null;\r\n          $anchorpos = strpos($phrase, \"#\");\r\n          if ($anchorpos !== false)\r\n          {\r\n            $anchor = substr($phrase, $anchorpos);\r\n            $phrase = substr($phrase, 0, $anchorpos);\r\n          }\r\n\r\n          $original_phrase = $phrase;\r\n          $phrase = html_entity_decode($phrase);\r\n\r\n          $link = null;\r\n          $css_class = null;\r\n          $plugin_call_name = null;\r\n          $name = null;\r\n          $title = null;\r\n          $search = null;\r\n          $external = null;\r\n          $debug_enabled = null;\r\n          $partial_match = $this->enablepartialmatch == 1;\r\n          $replace_partial_match = true;\r\n          $create_open_tag = false;\r\n          $my_item_id = null;\r\n          $limitstart_ix = null;\r\n          $to_append = null;\r\n\r\n          // get options\r\n          $count = count($pieces);\r\n          for ($i = 0; $i < $count - 1; $i++) // ignore the last piece - it's our phrase\r\n          {\r\n            switch($pieces[$i])\r\n            {\r\n              case $this->enabled:\r\n                // disable TitleLink for this text?\r\n                if ($phrase == \"false\")\r\n                {\r\n                  $titlelink_disabled = true;\r\n                  $titlelink_was_disabled = false;\r\n                }\r\n                else\r\n                {\r\n                  $titlelink_disabled = false;\r\n                  $titlelink_was_disabled = true;\r\n                }\r\n                break;\r\n              case $this->newwindow:     // open link in a new window?\r\n                $external = true;\r\n                break;\r\n              case $this->open_tag:\r\n                $create_open_tag = true;\r\n                break;\r\n              case $this->search_site:       // get a search link for the site\r\n              case $this->search_google:     // get a google search link\r\n              case $this->search_yahoo:      // get a yahoo search link\r\n              case $this->search_wikipedia:  // get a wikipedia search link\r\n                $link = $this->getSearchLink($pieces[$i], $phrase);\r\n                $name = $phrase;\r\n                break;\r\n              case $this->exact_match:   // disable partial matching?\r\n                $partial_match = false;\r\n                break;\r\n              case $this->replace_match: // don't replace phrase by complete match?\r\n                $replace_partial_match = false;\r\n                break;\r\n              case $this->link_http:     // is external link?\r\n              case $this->link_http.'s':     // is external link?\r\n                $link = $this->startswith($phrase, \"index.php\") ? $phrase : $pieces[$i].\":\".$phrase;\r\n                $name = $link;\r\n                break;\r\n              case $this->debug_mode:    // give some debug information?\r\n                $debug_enabled = true;\r\n                break;\r\n              default:\r\n                if ($this->startswith($pieces[$i], $this->plugin_call.\"-\") && empty($plugin_call_name))\r\n                {\r\n                  $plugin_call_name = substr($pieces[$i], strlen($this->plugin_call.\"-\"));\r\n                }\r\n                else if ($this->startswith($pieces[$i], $this->css_class_pattern) && empty($css_class))\r\n                {\r\n                  $css_class = \" class=\\\"\".substr($pieces[$i], strlen($this->css_class_pattern)).\"\\\" \";\r\n                }\r\n                else if ($this->startswith($pieces[$i], $this->item_id) && empty($my_item_id))\r\n                {\r\n                  $my_item_id = substr($pieces[$i], strlen($this->item_id));\r\n                }\r\n                else if ($this->startswith($pieces[$i], $this->limitstart) && empty($limitstart_ix))\r\n                {\r\n                  $limitstart_ix = substr($pieces[$i], strlen($this->limitstart));\r\n                }\r\n                else if ($this->startswith($pieces[$i], $this->search_pattern))\r\n                {\r\n                  $link = $this->getSearchLink(substr($pieces[$i], 0, strlen($this->search_pattern)), $phrase);\r\n                  $name = $phrase;\r\n                }\r\n                else if ($this->startswith($phrase, \"index.php\"))\r\n                {\r\n                  $link = $phrase;\r\n                  $name = $link;\r\n                }\r\n                else if (empty($to_append) && $this->startswith($pieces[$i], $this->append_url))\r\n                {\r\n                  $to_append = substr($pieces[$i], strlen($this->append_url));\r\n                }\r\n            }\r\n          }\r\n\r\n          if ($titlelink_disabled)\r\n          {\r\n            $content = preg_replace($this->finalpattern, $link, $content, 1);\r\n            $article->text = $content;\r\n            continue;\r\n          }\r\n          else if ($titlelink_was_disabled)\r\n          {\r\n            $content = preg_replace($this->finalpattern, $link, $content, 1);\r\n            $article->text = $content;\r\n            $titlelink_was_disabled = false;\r\n            continue;\r\n          }\r\n\r\n          // try to find a link by help of the plugins\r\n          // returns\r\n          // $link: the href\r\n          // $name: will be used as title and as the text for the visitor\r\n          if (empty($link))  // did the search functions already set a link?\r\n          {\r\n            // ask cache\r\n            if (!is_array($titlelink_cache))\r\n            {\r\n              $titlelink_cache = array();\r\n            }\r\n            if (!array_key_exists($phrase, $titlelink_cache))\r\n            {\r\n              // try to find an exact match\r\n              $result = $this->getByPlugins($database, $this->plugin_cache, $phrase, false);\r\n              if ((count($result) != 2) && ($partial_match))\r\n              {\r\n                // no exact match found --> try partial match\r\n                $result = $this->getByPlugins($database, $this->plugin_cache, $phrase, true);\r\n              }\r\n            }\r\n            else\r\n            {\r\n              $result = $titlelink_cache[$phrase];\r\n            }\r\n\r\n            // found something? --> save it\r\n            if (count($result) == 2)\r\n            {\r\n              // save result in cache\r\n              $titlelink_cache[$phrase] = $result;\r\n              $link = $result[0];\r\n              $name = $result[1];\r\n\r\n              if (!$replace_partial_match)\r\n              {\r\n                $name = $phrase;\r\n              }\r\n\r\n              if (!empty($my_item_id) && $this->endswith($link, 'Itemid='))\r\n              {\r\n                $link .= $my_item_id;\r\n              }\r\n            }\r\n          }\r\n\r\n          // if a working link was found, create the complete hyperlink with the given options\r\n          if (!empty($link))\r\n          {\r\n            if (!empty($to_append))\r\n            {\r\n              $link .= $to_append;\r\n            }\r\n\r\n            $options = \"\";\r\n\r\n            // append css-class (can be empty)\r\n            $options .= $css_class;\r\n\r\n            // if the user provided this parameter, overwrite the generic name from above\r\n            $link_title = $title2;\r\n            $link_text = $title1;\r\n\r\n            if (empty($link_title))\r\n            {\r\n              switch($this->disp_tooltip)\r\n              {\r\n                case 0: // Query String\r\n                  $link_title = $phrase;\r\n                  break;\r\n                case 1: // Query Result\r\n                  $link_title = $name;\r\n                  break;\r\n                case 2: // Explicit Title\r\n                  if (!(empty($title1) || $this->startswith($title1, \"<img \")))\r\n                  {\r\n                    $link_title = $title1;\r\n                  }\r\n                  else\r\n                  {\r\n                    $link_title = $name;\r\n                  }\r\n                  break;\r\n                default:\r\n                  $link_title = $name;\r\n              }\r\n            }\r\n\r\n            if (empty($link_text))\r\n            {\r\n              switch($this->disp_link)\r\n              {\r\n                case 0: // Query String\r\n                  $link_text = $phrase;\r\n                  break;\r\n                case 1: // Query Result\r\n                  $link_text = $name;\r\n                  break;\r\n                default:\r\n                  $link_title = $name;\r\n              }\r\n            }\r\n\r\n            // set title\r\n            if ($debug_enabled && $external)\r\n            {\r\n              $options .= \"title=\".$link_title.\"\\\" (open in new window)\\\"\";\r\n            }\r\n            else\r\n            {\r\n              $options .= \"title=\\\"\".$link_title.\"\\\"\";\r\n            }\r\n\r\n            // open the link in a new window?\r\n            if ($external)\r\n            {\r\n              $options .= \" target=\\\"_blank\\\"\";\r\n            }\r\n\r\n            // select page\r\n            if (!empty($limitstart_ix))\r\n            {\r\n              if (is_numeric($limitstart_ix))\r\n              {\r\n                //$link .= \"&start=\".($limitstart_ix-1);\r\n                $link .= \"&limitstart=\".($limitstart_ix-1);\r\n              }\r\n            }\r\n\r\n            // lets TitleLink call other plugins for the target content\r\n            if (!empty($plugin_call_name))\r\n            {\r\n              $link .= \"&\".$this->plugin_call.\"=\".$plugin_call_name;\r\n            }\r\n\r\n            if ($this->isExternal($link))\r\n            {\r\n              // external link\r\n              //$link = htmlentities($link);\r\n              $link = htmlspecialchars($link);\r\n            }\r\n            else\r\n            {\r\n              // internal link, make it sef\r\n              //$link = htmlentities($link);\r\n              $link = JRoute::_($link);\r\n            }\r\n\r\n            // add the anchor to the found link\r\n            if (!empty($anchor))\r\n            {\r\n              $link .= $anchor;\r\n            }\r\n\r\n            $link = \"<a href=\\\"\".$link.\"\\\" \".$options.\">\";\r\n\r\n            if (!$create_open_tag)\r\n            {\r\n              $link .= \"$link_text</a>\";\r\n            }\r\n          }\r\n          else\r\n          {\r\n            if ($this->enablenewcontent)\r\n            {\r\n              $link = \"<strong>\";\r\n              $link .= \"<a href=\\\"\";\r\n              $link .= \"index.php?option=com_content&view=article&layout=form\";\r\n              //$link .= \"index.php?option=com_content&task=new&sectionid=\";\r\n              // use current sectionid\r\n              //$link .= $article->sectionid;\r\n              // hinders Joomla from checking for a published menu entry (authorisation check)\r\n              //$link .= \"&Itemid=-1\";\r\n              $link .= \"\\\" title=\\\"Submit article\\\">\";\r\n              $link .= $phrase;\r\n              $link .= \"!</a>\";\r\n              $link .= \"</strong>\";\r\n            }\r\n            else\r\n            {\r\n              // show $phrase in bold font if no link could be built\r\n              $link = \"<strong>\";\r\n              $link .= $phrase;\r\n              $link .= \"</strong>\";\r\n            }\r\n\r\n            if ($debug_enabled)\r\n            {\r\n              $link .= \"<p>dump:\";\r\n\r\n              $link .= \"<br />new window: \".(($external) ? \"yes\" : \"no\");\r\n\r\n              $link .= \"<br />pieces:<ul>\";\r\n              $count = count($pieces);\r\n              for ($i = 0; $i < $count; $i++)\r\n              {\r\n                $link .= \"<li>\".$pieces[$i].\"</li>\";\r\n              }\r\n              $link .= \"</ul>\";\r\n\r\n              $link .= \"<br />plugin-results:<ul>\";\r\n              $count = count($result);\r\n              for ($i = 0; $i < $count; $i++)\r\n              {\r\n                $link .= \"<li>\".$result[$i].\"</li>\";\r\n              }\r\n              $link .= \"</ul>\";\r\n\r\n              $link .= \"<br />phrase=\".$phrase;\r\n              $link .= \"<br />title=\".$title;\r\n\r\n              $link .= \"<br />available plugins:<ul>\";\r\n              $count = count($this->plugin_cache);\r\n              for ($i = 0; $i < $count; $i++)\r\n              {\r\n                $link .= \"<li>\".$this->plugin_cache[$i].\"</li>\";\r\n              }\r\n              $link .= \"</ul>\";\r\n\r\n              $link .= \"</p>\";\r\n            }\r\n          }\r\n\r\n          $content = preg_replace($this->finalpattern, $link, $content, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    $article->text = $content;\r\n\r\n    $this->callExternalPlugin($article, $params, $limitstart);\r\n\r\n    return true;\r\n  }\r\n\r\n\r\n\r\n/////////////////////////////////////////////\r\n// internal functions\r\n\r\n  function callExternalPlugin($article, $params, $limitstart) {\r\n    $plugin_to_call = JRequest::getVar($this->plugin_call);\r\n    //$plugin_to_call = html_entity_decode(mosGetParam($_GET, $this->plugin_call), ENT_QUOTES);\r\n    $plugin_to_call = stripslashes($plugin_to_call);\r\n    if (!empty($plugin_to_call))\r\n    {\r\n      //$article->text .= \"<!-- plugincall5 key\".$this->plugin_call.\" value\".$plugin_to_call.\" --> <br /><br /><br />\".\"{\".$plugin_to_call.\"}\";\r\n      $article->text .= \"{\".$plugin_to_call.\"}\";\r\n\r\n// TODO call generic $_MAMBOTS\r\n//MAZ changed this to botMosEbayKit3\r\n      botMosEbayKit3(true, $article, $params, $limitstart);\r\n    }\r\n  }\r\n  \r\n  function isExternal($link)\r\n  {\r\n    $link_pattern='/^(http:\\/\\/|)(www.|)([^\\/]+)/i';\r\n\r\n    preg_match($link_pattern, $link, $domain);\r\n    preg_match($link_pattern, $_SERVER['HTTP_HOST'], $http);\r\n\r\n    return $this->startswith($link, \"http\") && ((isset($domain[3])) and (isset($http[3])) and ($domain[3]!==$http[3]));\r\n}\r\n\r\n  function getByPlugins($database, $plugins, $phrase, $partial_match)\r\n  {\r\n    $count = count($plugins);\r\n    for ($i = 0; $i < $count; $i++)\r\n    {\r\n      $result = call_user_func($plugins[$i], $database, $phrase, $partial_match);\r\n\r\n      // magix number '2' is the amount of strings we need as result\r\n      if (count($result) == 2)\r\n      {\r\n        return $result;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  function getPluginFunctions($dir, $pluginmask, &$pluginParams)\r\n  {\r\n    //$dir = $this->dir; $pluginmask = $this->pluginmask; $pluginParams = $this->params;\r\n\r\n    // load plugin params info\r\n    //$plugin =& JPluginHelper::getPlugin('content', 'titlelink');\r\n    //$pluginParams   = new JParameter( $plugin->params );\r\n\r\n    $files = null;\r\n    $dh  = opendir(JPATH_ROOT.DIRECTORY_SEPARATOR.$dir);\r\n    while (false !== ($filename = readdir($dh)))\r\n    {\r\n      $keyname = substr($filename, 0, strlen($filename) - strlen('.php'));\r\n\r\n      if ($this->startswith($filename, $pluginmask)\r\n          && $pluginParams->get($keyname, 0) > 0)\r\n      {\r\n        // found \"plugin\", include in list\r\n        $files[] = array('file' => $filename, 'order' => $pluginParams->get($keyname, 0));\r\n      }\r\n    }\r\n\r\n    if ($files == null)\r\n    {\r\n      // no plugin found\r\n      return null;\r\n    }\r\n\r\n    $filenames = array();\r\n    $orders = array();\r\n    \r\n\t// Obtain a list of columns\r\n\tforeach($files as $key => $row)\r\n\t{\r\n\t    $filenames[$key] = $row['file'];\r\n\t    $orders[$key] = $row['order'];\r\n\t}\r\n\t\r\n\tarray_multisort($orders, SORT_ASC, $filenames, SORT_ASC, $files);\r\n\r\n    // load plugins\r\n    foreach($files as $key => $row)\r\n    {\r\n      $file = $row['file'];\r\n      if (!empty($file))\r\n      {\r\n        include_once(JPATH_ROOT.DIRECTORY_SEPARATOR.$dir.DIRECTORY_SEPARATOR.$file);\r\n      }\r\n    }\r\n\r\n    // get only functions which are usable in this bot\r\n    $functions = get_defined_functions();\r\n    $functions = $functions[\"user\"];\r\n    $count = count($functions);\r\n    for ($i = 0; $i < $count; $i++)\r\n    {\r\n      if ($this->startswith($functions[$i], $pluginmask))\r\n      {\r\n        $plugin_fkt[] = $functions[$i];\r\n      }\r\n    }\r\n\r\n    return $plugin_fkt;\r\n  }\r\n\r\n  function startswith($source, $mask)\r\n  {\r\n    $pos = strpos($source, $mask);\r\n    return (($pos !== false) && ($pos == 0));\r\n  }\r\n\r\n  function endswith($source, $mask)\r\n  {\r\n    $pos = strpos($source, $mask);\r\n    return (($pos !== false) && ($pos == (strlen($source)-strlen($mask))));\r\n  }\r\n\r\n  function stringrpos($haystack,$needle,$offset=NULL)\r\n  {\r\n    return strlen($haystack)\r\n           - strpos( strrev($haystack) , strrev($needle) , $offset)\r\n           - strlen($needle);\r\n  }\r\n\r\n  function strrpos_string($haystack, $needle, $offset = 0)\r\n  {\r\n    if(trim($haystack) != \"\" && trim($needle) != \"\" && $offset <= strlen($haystack))\r\n    {\r\n      $last_pos = $offset;\r\n      $found = false;\r\n      while(($curr_pos = strpos($haystack, $needle, $last_pos)) !== false)\r\n      {\r\n        $found = true;\r\n        $last_pos = $curr_pos + 1;\r\n      }\r\n      if($found)\r\n      {\r\n        return $last_pos - 1;\r\n      }\r\n      else\r\n      {\r\n        return false;\r\n      }\r\n    }\r\n    else\r\n    {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function getSearchLink($engine, $phrase)\r\n  {\r\n    $space_replacement = \"%20\";\r\n    $search_link = null;\r\n\r\n    switch($engine)\r\n    {\r\n      case \"search\":\r\n        // local search\r\n        $search_link = \"index.php?option=com_search&ordering=&searchphrase=all&searchword=\".$phrase;\r\n        $space_replacement = \"+\";\r\n        break;\r\n\r\n      case \"abbenormal\":\r\n        $search_link = \"http://www.ourpla.net/cgi-bin/pikie.cgi?\".$phrase;\r\n         break;\r\n      case \"acronym\":\r\n        $search_link = \"http://www.acronymfinder.com/af-query.asp?String=exact&Acronym=\".$phrase;\r\n        break;\r\n      case \"advogato\":\r\n        $search_link = \"http://www.advogato.org/\".$phrase;\r\n        break;\r\n      case \"amazon_com\":\r\n        $search_link = \"http://www.amazon.com/s?url=search-alias%3Daps&field-keywords=\".$phrase;\r\n        $space_replacement = \"+\";\r\n        break;\r\n      case \"bible\":\r\n        $search_link = \"http://bible.gospelcom.net/bible?\".$phrase;\r\n        break;\r\n      case \"caffeinatedwiki\":\r\n        $search_link = \"http://socrates.yi.org/\".$phrase;\r\n        break;\r\n      case \"cliki\":\r\n        $search_link = \"http://www.cliki.net/\".$phrase;\r\n        break;\r\n      case \"cmwiki\":\r\n        $search_link = \"http://www.cmwiki.com/\".$phrase;\r\n        break;\r\n      case \"creationmatters\":\r\n        $search_link = \"http://www.ourpla.net/cgi-bin/wiki.pl?\".$phrase;\r\n        break;\r\n      case \"cssdiscusswiki\":\r\n        $search_link = \"http://css-discuss.incutio.com/?page=\".$phrase;\r\n        break;\r\n      case \"dictionary\":\r\n        $search_link = \"http://www.dictionary.com/cgi-bin/dict.pl?term=\".$phrase;\r\n        break;\r\n      case \"doiwalters\":\r\n        $search_link = \"http://www.doiwalters.com/wiki/\".$phrase;\r\n        break;\r\n      case \"emacswiki\":\r\n        $search_link = \"http://www.emacswiki.org/cgi-bin/wiki/\".$phrase;\r\n        break;\r\n      case \"everything2\":\r\n        $search_link = \"http://www.everything2.com/\".$phrase;\r\n        break;\r\n      case \"foldoc\":\r\n        $search_link = \"http://www.foldoc.org/foldoc/foldoc.cgi?\".$phrase;\r\n        break;\r\n      case \"foxwiki\":\r\n        $search_link = \"http://fox.wikis.com/wc.dll?Wiki~\".$phrase;\r\n        break;\r\n      case \"geekido\":\r\n        $search_link = \"http://geekido.org/index.php?page=\".$phrase;\r\n        break;\r\n      case \"google\":\r\n        $search_link = \"http://www.google.com/search?q=\".$phrase;\r\n        $space_replacement = \"+\";\r\n        break;\r\n      case \"googlegroups\":\r\n        $search_link = \"http://groups.google.com/groups?q=\".$phrase;\r\n        break;\r\n      case \"h2g2\":\r\n        $search_link = \"http://www.bbc.co.uk/h2g2/guide/Search?searchstring=\".$phrase;\r\n        break;\r\n      case \"hootoo\":\r\n        $search_link = \"http://www.bbc.co.uk/h2g2/guide/Search?searchstring=\".$phrase;\r\n        break;\r\n      case \"hhgg\":\r\n        $search_link = \"http://www.bbc.co.uk/dna/h2g2/\".$phrase;\r\n        break;\r\n      case \"iawiki\":\r\n        $search_link = \"http://www.IAwiki.net/\".$phrase;\r\n        break;\r\n      case \"icq\":\r\n        $search_link = \"http://wwp.icq.com/\".$phrase;\r\n        break;\r\n      case \"imdb\":\r\n        $search_link = \"http://us.imdb.com/Title?\".$phrase;\r\n        break;\r\n      case \"jargonfile\":\r\n        $search_link = \"http://sunir.org/apps/meta.pl?wiki=JargonFile&redirect=\".$phrase;\r\n        break;\r\n      case \"jtf\":\r\n        $search_link = \"http://www.justthefaqs.org/?page=\".$phrase;\r\n        break;\r\n      case \"knowhow\":\r\n        $search_link = \"http://www2.iro.umontreal.ca/~paquetse/cgi-bin/wiki.cgi?\".$phrase;\r\n        break;\r\n      case \"kwiki\":\r\n        $search_link = \"http://kwiki.org/?\".$phrase;\r\n        break;\r\n      case \"linuxquestions\":\r\n        $search_link = \"http://wiki.linuxquestions.org/wiki/\".$phrase;\r\n        break;\r\n      case \"livejournal\":\r\n        $search_link = \"http://www.livejournal.com/users/\".$phrase;\r\n        break;\r\n      case \"meatball\":\r\n        $search_link = \"http://www.usemod.com/cgi-bin/mb.pl?\".$phrase;\r\n        break;\r\n      case \"metawiki\":\r\n        $search_link = \"http://sunir.org/apps/meta.pl?words=\".$phrase;\r\n        break;\r\n      case \"moinmoin\":\r\n        $search_link = \"http://moinmoin.wikiwikiweb.de/\".$phrase;\r\n        break;\r\n      case \"openwiki\":\r\n        $search_link = \"http://openwiki.com/ow.asp?\".$phrase;\r\n        break;\r\n      case \"orgpatterns\":\r\n        $search_link = \"http://www.bell-labs.com/cgi-user/OrgPatterns/OrgPatterns?\".$phrase;\r\n        break;\r\n      case \"patent\":\r\n        $search_link = \"http://patft.uspto.gov/netacgi/nph-Parser?patentnumber=\".$phrase;\r\n        break;\r\n      case \"pgpkey\":\r\n        $search_link = \"http://keys.pgp.dk:11371/pks/lookup?op=get&search=\".$phrase;\r\n        break;\r\n      case \"phpwiki\":\r\n        $search_link = \"http://phpwiki.sourceforge.net/phpwiki/\".$phrase;\r\n        break;\r\n      case \"pikie\":\r\n        $search_link = \"http://pikie.webbing.nl/cgi-bin/pikie.cgi?\".$phrase;\r\n        break;\r\n      case \"ppr\":\r\n        $search_link = \"http://c2.com/cgi/wiki?\".$phrase;\r\n        break;\r\n      case \"pythoninfo\":\r\n        $search_link = \"http://www.python.org/cgi-bin/moinmoin/\".$phrase;\r\n        break;\r\n      case \"rfc\":\r\n        $search_link = \"http://www.rfc.org.uk/cgi-bin/lookup.cgi?rfc=\".$phrase;\r\n        break;\r\n      case \"sourceforge\":\r\n        $search_link = \"http://sourceforge.net/\".$phrase;\r\n        break;\r\n      case \"squeak\":\r\n        $search_link = \"http://minnow.cc.gatech.edu/squeak/\".$phrase;\r\n        break;\r\n      case \"squirrelmail\":\r\n        $search_link = \"http://squirrelmail.org/wiki/wiki.php?\".$phrase;\r\n        break;\r\n      case \"tavi\":\r\n        $search_link = \"http://tavi.sourceforge.net/\".$phrase;\r\n        break;\r\n      case \"thesaurus\":\r\n        $search_link = \"http://www.thesaurus.com/cgi-bin/search?config=roget&words=\".$phrase;\r\n        break;\r\n      case \"thinki\":\r\n        $search_link = \"http://www.thinkware.se/cgi-bin/thinki.cgi/\".$phrase;\r\n        break;\r\n      case \"twiki\":\r\n        $search_link = \"http://twiki.sourceforge.net/cgi-bin/view/\".$phrase;\r\n        break;\r\n      case \"usemod\":\r\n        $search_link = \"http://www.usemod.com/cgi-bin/wiki.pl?\".$phrase;\r\n        break;\r\n      case \"visualworks\":\r\n        $search_link = \"http://wiki.cs.uiuc.edu/VisualWorks/\".$phrase;\r\n        break;\r\n      case \"webster\":\r\n        $search_link = \"http://m-w.com/cgi-bin/dictionary?va=\".$phrase;\r\n        break;\r\n      case \"why\":\r\n        $search_link = \"http://clublet.com/c/c/why?\".$phrase;\r\n        break;\r\n      case \"wiki\":\r\n        $search_link = \"http://c2.com/cgi/wiki?\".$phrase;\r\n        break;\r\n      case \"wikifind\":\r\n        $search_link = \"http://c2.com/cgi/wiki?FindPage&value=\".$phrase;\r\n        break;\r\n      case \"wikipedia\":\r\n        $search_link = \"http://en.wikipedia.org/wiki/\".$phrase;\r\n        break;\r\n      case \"wiktionary\":\r\n        $search_link = \"http://en.wiktionary.org/wiki/\".$phrase;\r\n        break;\r\n      case \"wunderground\":\r\n        $search_link = \"http://www.wunderground.com/cgi-bin/findweather/getForecast?query=\".$phrase;\r\n        break;\r\n      case \"yahoo\":\r\n        $search_link = \"http://search.yahoo.com/search?p=\".$phrase;\r\n        $space_replacement = \"+\";\r\n        break;\r\n      case \"zwiki\":\r\n        $search_link = \"http://www.zwiki.org/\".$phrase;\r\n        break;\r\n      default:\r\n        // do nothing\r\n        $search_link = null;\r\n        break;\r\n    }\r\n\r\n    if (!empty($search_link))\r\n    {\r\n      $search_link = preg_replace($this->pattern_start_end.\"\\ \".$this->pattern_start_end, $space_replacement, $search_link);\r\n    }\r\n\r\n    return $search_link;\r\n  }\r\n}\r\n?>", "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<install version=\"1.5\" type=\"plugin\" group=\"content\" method=\"upgrade\">\n\t<name>Content - TitleLink</name>\n\t<author>Tobias Gesellchen</author>\n\t<creationDate>2008-06-03</creationDate>\n\t<copyright>(C) 2005-2009 Tobias Gesellchen. All rights reserved.</copyright>\n\t<license>http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL</license>\n\t<authorEmail>tobias@gesellix.de</authorEmail>\n\t<authorUrl>www.gesellix.de</authorUrl>\n\t<version>3.2.0 2009-06-06 stable</version>\n  <description>DESCTITLELINK</description>\n  <files>\n    <filename plugin=\"titlelink\">titlelink.php</filename>\n    <filename>titlelink_plugins/plugin_content_title.php</filename>\n    <filename>titlelink_plugins/plugin_menuitem.php</filename>\n    <filename>titlelink_plugins/plugin_remository.php</filename>\n    <filename>titlelink_plugins/plugin_shortlink.php</filename>\n    <filename>titlelink_plugins/plugin_virtuemart.php</filename>\n    <filename>titlelink_plugins/plugin_virtuemart_category.php</filename>\n    <filename>titlelink_plugins/plugin_alberghi.php</filename>\n    <filename>titlelink_plugins/plugin_artforms.php</filename>\n    <filename>titlelink_plugins/plugin_docman.php</filename>\n    <filename>titlelink_plugins/plugin_peoplebook.php</filename>\n    <filename>titlelink_plugins/plugin_jmovies.php</filename>\n  </files>\n  <!-- old method to describe language files \n       Generally works\n  -->\n<!--\n\t<languages>\n\t\t<language tag=\"en-GB\">administrator/language/en-GB.plg_content_titlelink.ini</language>\n\t\t<language tag=\"de-DE\">administrator/language/de-DE.plg_content_titlelink.ini</language>\n\t\t<language tag=\"es-ES\">administrator/language/es-ES.plg_content_titlelink.ini</language>\n    <language tag=\"fa-IR\">administrator/language/fa-IR.plg_content_titlelink.ini</language>\n    <language tag=\"nl-NL\">administrator/language/nl-NL.plg_content_titlelink.ini</language>\n\t\t<language tag=\"ru-RU\">administrator/language/ru-RU.plg_content_titlelink.ini</language>\n\t\t<language tag=\"tr-TR\">administrator/language/tr-TR.plg_content_titlelink.ini</language>\n\t</languages>\n-->\n  <!-- new method to describe language files\n       Doesn't work well :-(\n       2007-05-15 Installs only first language\n   -->\n  <languages folder=\"administrator/language\">\n    <language tag=\"en-GB\">en-GB.plg_content_titlelink.ini</language>\n  </languages>\n\n  <params name=\"\" description=\"\">\n    <param \n      name=\"separator\" \n      type=\"text\" \n      default=\":\" \n      label=\"Separator\"\n      description=\"Default is the colon ':'\" />\n    <param \n      name=\"trigger_prefix\" \n      type=\"text\" \n      default=\"{ln\" \n      label=\"Prefix\"\n      description=\"Default: {ln\" />\n    <param \n      name=\"trigger_suffix\" \n      type=\"text\" \n      default=\"}\" \n      label=\"Suffix\"\n      description=\"Default: }\" />\n\t<param name=\"@spacer\" type=\"spacer\" default=\"\" label=\"\" description=\"\" />\n    <param\n      name=\"enablepartialmatch\"\n      type=\"radio\"\n      default=\"1\"\n      label=\"Enable partial match\"\n      description=\"If no match is found with the exact search, try partial matching.\">\n      <option value=\"1\">Enabled</option>\n      <option value=\"0\">Disabled</option>\n    </param>\n    <param\n      name=\"enablenewcontent\"\n      type=\"radio\"\n      default=\"0\"\n      label=\"Link to create new article\"\n      description=\"If no match is found, create a link to add new content.\">\n      <option value=\"1\">Enabled</option>\n      <option value=\"0\">Disabled</option>\n    </param>\n    <param\n      name=\"disp_link\"\n      type=\"list\"\n      label=\"Displayed Link\"\n      default=\"1\"\n      description=\"Options for Displayed Link (if no explicit title entered after ')\">\n      <option value=\"0\">Query String</option>\n      <option value=\"1\">Query Result</option>\n    </param>\n    <param\n      name=\"disp_tooltip\"\n      type=\"list\"\n      label=\"Displayed ToolTip\"\n      default=\"1\"\n      description=\"Options for ToolTip (ALT Text)\">\n      <option value=\"0\">Query String</option>\n      <option value=\"1\">Query Result</option>\n      <option value=\"2\">Explicit Title</option>\n    </param>\n\t<param name=\"@spacer\" type=\"spacer\" default=\"\" label=\"\" description=\"\" />\n    <param\n      name=\"plugin_content_title\"\n      type=\"list\"\n      default=\"1\"\n      label=\"Content by Title or Alias\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_menuitem\"\n      type=\"list\"\n      default=\"1\"\n      label=\"Content by Menuitem\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_shortlink\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by Shortlink (needs com_shortlink)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_virtuemart\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by VirtueMart Product (needs com_virtuemart)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_virtuemart_category\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by VirtueMart Category (needs com_virtuemart)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_alberghi\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by Alberghi (needs com_alberghi)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_artforms\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by ArtForms (needs com_artforms)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_docman\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by DocMan (needs com_docman)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_remository\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by Remository (needs com_remository)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_peoplebook\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by PeopleBook (needs com_peoplebook)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_jmovies\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by JMovies (needs com_jmovies)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n  </params>\n</install>", "<?php\r\n\r\ndefined( '_JEXEC' ) or die('Direct Access to this location is not allowed.');\r\n\r\n/**\r\n * Get an article by searching for a matching 'title_alias' or 'title'\r\n */\r\nfunction plugin_contentTitle($database, $phrase, $partial_match = true)\r\n{\r\n  global $mainframe;\r\n\r\n  if(!class_exists('ContentHelperRoute'))\r\n  {\r\n    require_once( JPATH_SITE.DS.'components'.DS.'com_content'.DS.'helpers'.DS.'route.php' );\r\n  }\r\n\r\n  //$database = & JFactory::getDBO();\r\n\r\n  //$base_link = \"index.php?option=com_content&view=article&id=\";\r\n\r\n  $result = null;\r\n\r\n  $query  = \"SELECT a.id, a.title AS arttitle, a.alias AS artalias, c.id as catid, c.alias AS catalias, a.sectionid\";\r\n  $query .= \" FROM #__content AS a \";\r\n  $query .= \" LEFT JOIN #__categories AS c ON a.catid = c.id \";\r\n  $query .= \" LEFT JOIN #__sections AS s ON a.sectionid = s.id \";\r\n\r\n  $where_clause = \" WHERE a.state=1 \";\r\n\r\n  $where_variant = \" AND a.alias \" . (($partial_match) ? \" LIKE '%$phrase%'\" : \"= '$phrase'\");\r\n  $result = findContentInternal($database, $query.$where_clause.$where_variant, false);\r\n\r\n  if ($result == null)\r\n  {\r\n    $where_variant = \" AND a.title \" . (($partial_match) ? \" LIKE '%$phrase%'\" : \"= '$phrase'\");\r\n  \t$result = findContentInternal($database, $query.$where_clause.$where_variant, true);\r\n  }\r\n  \r\n  return $result;\r\n}\r\n\r\nfunction findContentInternal($database, $query_variant, $getTitle)\r\n{\r\n  $result = null;\r\n\t\r\n  $database->setQuery($query_variant);\r\n\r\n  $my = null;\r\n  $my = $database->loadObject();\r\n  if ($my)\r\n  {\r\n    if (empty($my->catid) || empty($my->catalias) || empty($my->sectionid))\r\n    {\r\n      $result[0] = ContentHelperRoute::getArticleRoute($my->id.':'.$my->artalias);\r\n    }\r\n    else\r\n    {\r\n      $result[0] = ContentHelperRoute::getArticleRoute($my->id.':'.$my->artalias, $my->catid.':'.$my->catalias, $my->sectionid);\r\n    }\r\n    \r\n    $result[1] = ($getTitle) ? $my->arttitle : $my->artalias;\r\n\r\n    if (strpos($result[0], '&Itemid=') < 0)\r\n    {\r\n\t  $itemid = $mainframe->getItemid( $my->id );\r\n      if ($itemid)\r\n      {\r\n        $result[0] .= \"&Itemid=\".$itemid;\r\n      }\r\n    }\r\n  }\r\n  \r\n  return $result;\r\n}\r\n\r\n?>"], "fixing_code": ["<?php\r\n// Check to ensure this file is included in Joomla!\r\ndefined( '_JEXEC' ) or die('Direct Access to this location is not allowed.');\r\n\r\n?>\r\n\r\n2010-08-08:\r\n\r\n- [#20653] SQL Injection: $phrase is escaped now, yet most of the plugins have to be updated according to plugin_content_title.php\r\n\r\n\r\n2009-06-06:\r\n\r\n- [#16580] Exact Match as default or plugin option\r\n\r\n\r\n2009-05-27:\r\n\r\n- added plugin_jmovies (thanks to Onimaro)\r\n\r\n\r\n2008-11-13:\r\n\r\n- fixed creation of wrong content article links ... though they worked correctly in Joomla *phew*\r\n\r\n\r\n2008-11-10:\r\n\r\n- [#13627] link to the site-internal search\r\n- code cleanup\r\n\r\n\r\n2008-10-28:\r\n\r\n- corrections for new plugins (using new Joomla! 1.5.x API)\r\n- implemented new sorting of plugins\r\n- other plugins are disabled by default (only content and menuitem plugins are enabled) \r\n\r\n\r\n2008-10-26:\r\n\r\n- new plugins by external contributions, but there still needs to be a new option to sort plugins.\r\n\r\n\r\n2008-10-19:\r\n\r\n- updated documentation link http://www.gesellix.de/joomla/36-titlelink/46-titlelink-documentation.html\r\n\r\n\r\n2008-09-17:\r\n\r\n- fixes [#12606] TL 3.0.5 cannot find uncategorized articles\r\n- fixes missing links when Joomla table prefix isn't 'jos'\r\n\r\n\r\n2008-08-18:\r\n\r\n- fixed \"empty\" page issue, when plugin was called from other components\r\n\r\n\r\n2008-08-18:\r\n\r\n- [#10182] SEF don't work correctly\r\n- method=\"upgrade\" to enable users making updates without uninstall\r\n\r\n\r\n<?php\r\n?>", "<?php\r\n/**\r\n * @copyright Copyright (C) 2005 - 2007 Tobias Gesellchen. All rights reserved.\r\n * @license   GNU/GPL, see LICENSE.php\r\n * Joomla! is free software. This version may have been modified pursuant\r\n * to the GNU General Public License, and as distributed it includes or\r\n * is derivative of works licensed under the GNU General Public License or\r\n * other free or open source software licenses.\r\n * See COPYRIGHT.php for copyright notices and details.\r\n */\r\n\r\n// Check to ensure this file is included in Joomla!\r\ndefined( '_JEXEC' ) or die('Direct Access to this location is not allowed.');\r\n\r\njimport( 'joomla.plugin.plugin' );\r\n\r\nclass plgContentTitleLink extends JPlugin\r\n{\r\n  /**\r\n   * caches results of plugins\r\n   * index-key: phrase\r\n   * value: plugin result\r\n   */\r\n  //var $titlelink_cache = array();\r\n  var $plugin_cache;\r\n\r\n  var $title1_delim = \" '\";\r\n  var $title2_delim = \" ''\";\r\n\r\n  var $plugin_call = \"plugin_call\";\r\n  var $item_id = \"itemid-\";\r\n  var $limitstart = \"limitstart-\";\r\n  var $append_url = \"append-\";\r\n  var $css_class_pattern = \"css-\";\r\n  var $search_pattern = \"search-\";\r\n  var $newwindow = \"nw\";\r\n  var $open_tag = \"op\";  // don't close the anchor tag, like: '<a href=...>'\r\n  var $search_site = \"search\";\r\n  var $search_google = \"google\";\r\n  var $search_yahoo = \"yahoo\";\r\n  var $search_wikipedia = \"wikipedia\";\r\n  var $exact_match = \"em\";\r\n  var $replace_match = \"rep\";\r\n  var $link_http = \"http\";\r\n  var $enabled = \"enable\";\r\n  var $debug_mode = \"debug\";\r\n\r\n  var $dir        = 'plugins/content/titlelink_plugins';\r\n  var $pluginmask = 'plugin_';\r\n\r\n  /**\r\n   * see http://www.php.net/manual/en/reference.pcre.pattern.syntax.php\r\n   * for details: this special \"character\" is used as start/end tag\r\n   * for the preg_match functions.\r\n   */\r\n  var $pattern_start_end = \"\\x01\";\r\n\r\n  // configuration\r\n\r\n  var $trigger_prefix;\r\n  var $trigger_suffix;\r\n  var $separator;\r\n  var $enablenewcontent;\r\n  var $enablepartialmatch;\r\n  var $disp_link;\r\n  var $disp_tooltip;\r\n  var $linkr_enabled;\r\n\r\n  var $finalpattern;\r\n\r\n\r\n  /**\r\n   * Constructor\r\n   *\r\n   * For php4 compatability we must not use the __constructor as a constructor for plugins\r\n   * because func_get_args ( void ) returns a copy of all passed arguments NOT references.\r\n   * This causes problems with cross-referencing necessary for the observer design pattern.\r\n   *\r\n   * @param object $subject The object to observe\r\n   * @param object $params  The object that holds the plugin parameters\r\n   */\r\n  function plgContentTitleLink( &$subject, $params )\r\n  {\r\n    parent::__construct( $subject, $params );\r\n\r\n    $this->trigger_prefix = $this->params->get( 'trigger_prefix', \"{ln\" );\r\n    $this->trigger_suffix = $this->params->get( 'trigger_suffix', \"}\" );\r\n    $this->separator = $this->params->get( 'separator', \":\" );\r\n    $this->enablenewcontent = $this->params->get( 'enablenewcontent', 0 );\r\n    $this->enablepartialmatch = $this->params->get( 'enablepartialmatch', 1 );\r\n    $this->disp_link = $this->params->get( 'disp_link', 1 );\r\n    $this->disp_tooltip = $this->params->get( 'disp_tooltip', 1 );\r\n    $this->linkr_enabled = $this->params->get( 'linkr_enabled', 1 );\r\n\r\n    $this->finalpattern = $this->pattern_start_end.preg_quote($this->trigger_prefix).\".+?\".preg_quote($this->trigger_suffix).$this->pattern_start_end;\r\n\r\n    if ($this->plugin_cache == null || !is_array($this->plugin_cache))\r\n    {\r\n      $this->plugin_cache = $this->getPluginFunctions($this->dir, $this->pluginmask, $this->params);\r\n    }\r\n\r\n    //$this->titlelink_cache = array();\r\n  }\r\n\r\n  // Send links to Linkr\r\n  function onLinkrGetLinks( $version )\r\n  {\r\n    $result = array();\r\n\r\n    // This plugin doesn't actually do anything.\r\n    // It will only display the current version\r\n    // in a popup using the LinkrHelper.test()\r\n    // javascript function\r\n\r\n    if ($this->linkr_enabled && $version >= 2.2)\r\n    {\r\n      $msg = 'TitleLink plugin is working on Linkr '. $version;\r\n\r\n      // Since this will be added to the \"onclick\"\r\n      // attribute, use 'single quotes' instead\r\n      // of \"double quotes\"\r\n      //$js = 'LinkrHelper.test(\\''. $msg .'\\')';\r\n\r\n      // Return link title and javascript statement\r\n      $result = array(\r\n        'TitleLink' => 'LinkrHelper.layout(\\'link\\')'\r\n      );\r\n    }\r\n\r\n    return $result;\r\n  }\r\n\r\n  // Linkr Scripts\r\n  function onLinkrLoadJS( $version )\r\n  {\r\n    if ($this->linkr_enabled && $version >= 2.2 && 2==1)\r\n    {\r\n      $doc = & JFactory::getDocument();\r\n      $doc->addScript( 'plugins/content/titlelink_plugins/linkr_script.js' );\r\n\r\n      // URL for AJAX requests. Be sure to use full URLs\r\n      $r = JURI::base() .'index.php?option=com_foo&amp;tmpl=component&amp;view=foo&amp;'. JUtility::getToken() .'=1';\r\n\r\n      return 'LinkrFoo.init(\\''. $r .'\\');';\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Replaces TitleLinks with the correct html hyperlinks\r\n   *\r\n   * Method is called by the view\r\n   *\r\n   * @param   object    The article object.  Note $article->text is also available\r\n   * @param   object    The article params\r\n   * @param   int     The 'page' number\r\n   */\r\n  function onPrepareContent(&$article, &$params, $limitstart)\r\n  {\r\n    global $mainframe, $titlelink_cache;\r\n\r\n    $database = & JFactory::getDBO();\r\n\r\n    $content = $article->text;\r\n    $matches = array ();\r\n\r\n    if (preg_match_all($this->finalpattern, $content, $matches, PREG_PATTERN_ORDER))\r\n    {\r\n      $titlelink_disabled = false;\r\n      $titlelink_was_disabled = false;\r\n\r\n      foreach ($matches as $fmatch)\r\n      {\r\n        foreach ($fmatch as $match)\r\n        {\r\n          if ($match == \"\")\r\n          {\r\n            continue;\r\n          }\r\n\r\n          $match = str_replace($this->trigger_prefix, \"\", $match);\r\n          $match = str_replace($this->trigger_suffix, \"\", $match);\r\n\r\n          $match = html_entity_decode($match, ENT_QUOTES);\r\n\r\n          // split phrase and title\r\n          $title1 = null;\r\n          $title2 = null;\r\n          $delimpos = strpos($match, $this->title1_delim);\r\n          if ($delimpos !== false)\r\n          {\r\n            $title1 = substr($match, $delimpos + strlen($this->title1_delim));\r\n            $match = substr($match, 0, $delimpos);\r\n\r\n            $delimpos = strpos($title1, $this->title2_delim);\r\n            if ($delimpos !== false)\r\n            {\r\n              $title2 = substr($title1, $delimpos + strlen($this->title2_delim));\r\n              $title1 = substr($title1, 0, $delimpos);\r\n            }\r\n          }\r\n\r\n          $pieces = explode($this->separator, $match);\r\n          $phrase = trim($pieces[count($pieces) - 1]);\r\n\r\n          // Look for an anchor name in the phrase string (thanks to Federico Filipponi, 2006-11-10)\r\n          $anchor = null;\r\n          $anchorpos = strpos($phrase, \"#\");\r\n          if ($anchorpos !== false)\r\n          {\r\n            $anchor = substr($phrase, $anchorpos);\r\n            $phrase = substr($phrase, 0, $anchorpos);\r\n          }\r\n\r\n          $original_phrase = $phrase;\r\n          $phrase = html_entity_decode($phrase);\r\n\r\n          $link = null;\r\n          $css_class = null;\r\n          $plugin_call_name = null;\r\n          $name = null;\r\n          $title = null;\r\n          $search = null;\r\n          $external = null;\r\n          $debug_enabled = null;\r\n          $partial_match = $this->enablepartialmatch == 1;\r\n          $replace_partial_match = true;\r\n          $create_open_tag = false;\r\n          $my_item_id = null;\r\n          $limitstart_ix = null;\r\n          $to_append = null;\r\n\r\n          // get options\r\n          $count = count($pieces);\r\n          for ($i = 0; $i < $count - 1; $i++) // ignore the last piece - it's our phrase\r\n          {\r\n            switch($pieces[$i])\r\n            {\r\n              case $this->enabled:\r\n                // disable TitleLink for this text?\r\n                if ($phrase == \"false\")\r\n                {\r\n                  $titlelink_disabled = true;\r\n                  $titlelink_was_disabled = false;\r\n                }\r\n                else\r\n                {\r\n                  $titlelink_disabled = false;\r\n                  $titlelink_was_disabled = true;\r\n                }\r\n                break;\r\n              case $this->newwindow:     // open link in a new window?\r\n                $external = true;\r\n                break;\r\n              case $this->open_tag:\r\n                $create_open_tag = true;\r\n                break;\r\n              case $this->search_site:       // get a search link for the site\r\n              case $this->search_google:     // get a google search link\r\n              case $this->search_yahoo:      // get a yahoo search link\r\n              case $this->search_wikipedia:  // get a wikipedia search link\r\n                $link = $this->getSearchLink($pieces[$i], $phrase);\r\n                $name = $phrase;\r\n                break;\r\n              case $this->exact_match:   // disable partial matching?\r\n                $partial_match = false;\r\n                break;\r\n              case $this->replace_match: // don't replace phrase by complete match?\r\n                $replace_partial_match = false;\r\n                break;\r\n              case $this->link_http:     // is external link?\r\n              case $this->link_http.'s':     // is external link?\r\n                $link = $this->startswith($phrase, \"index.php\") ? $phrase : $pieces[$i].\":\".$phrase;\r\n                $name = $link;\r\n                break;\r\n              case $this->debug_mode:    // give some debug information?\r\n                $debug_enabled = true;\r\n                break;\r\n              default:\r\n                if ($this->startswith($pieces[$i], $this->plugin_call.\"-\") && empty($plugin_call_name))\r\n                {\r\n                  $plugin_call_name = substr($pieces[$i], strlen($this->plugin_call.\"-\"));\r\n                }\r\n                else if ($this->startswith($pieces[$i], $this->css_class_pattern) && empty($css_class))\r\n                {\r\n                  $css_class = \" class=\\\"\".substr($pieces[$i], strlen($this->css_class_pattern)).\"\\\" \";\r\n                }\r\n                else if ($this->startswith($pieces[$i], $this->item_id) && empty($my_item_id))\r\n                {\r\n                  $my_item_id = substr($pieces[$i], strlen($this->item_id));\r\n                }\r\n                else if ($this->startswith($pieces[$i], $this->limitstart) && empty($limitstart_ix))\r\n                {\r\n                  $limitstart_ix = substr($pieces[$i], strlen($this->limitstart));\r\n                }\r\n                else if ($this->startswith($pieces[$i], $this->search_pattern))\r\n                {\r\n                  $link = $this->getSearchLink(substr($pieces[$i], 0, strlen($this->search_pattern)), $phrase);\r\n                  $name = $phrase;\r\n                }\r\n                else if ($this->startswith($phrase, \"index.php\"))\r\n                {\r\n                  $link = $phrase;\r\n                  $name = $link;\r\n                }\r\n                else if (empty($to_append) && $this->startswith($pieces[$i], $this->append_url))\r\n                {\r\n                  $to_append = substr($pieces[$i], strlen($this->append_url));\r\n                }\r\n            }\r\n          }\r\n\r\n          if ($titlelink_disabled)\r\n          {\r\n            $content = preg_replace($this->finalpattern, $link, $content, 1);\r\n            $article->text = $content;\r\n            continue;\r\n          }\r\n          else if ($titlelink_was_disabled)\r\n          {\r\n            $content = preg_replace($this->finalpattern, $link, $content, 1);\r\n            $article->text = $content;\r\n            $titlelink_was_disabled = false;\r\n            continue;\r\n          }\r\n\r\n          // try to find a link by help of the plugins\r\n          // returns\r\n          // $link: the href\r\n          // $name: will be used as title and as the text for the visitor\r\n          if (empty($link))  // did the search functions already set a link?\r\n          {\r\n            // ask cache\r\n            if (!is_array($titlelink_cache))\r\n            {\r\n              $titlelink_cache = array();\r\n            }\r\n            if (!array_key_exists($phrase, $titlelink_cache))\r\n            {\r\n              // try to find an exact match\r\n              $result = $this->getByPlugins($database, $this->plugin_cache, $phrase, false);\r\n              if ((count($result) != 2) && ($partial_match))\r\n              {\r\n                // no exact match found --> try partial match\r\n                $result = $this->getByPlugins($database, $this->plugin_cache, $phrase, true);\r\n              }\r\n            }\r\n            else\r\n            {\r\n              $result = $titlelink_cache[$phrase];\r\n            }\r\n\r\n            // found something? --> save it\r\n            if (count($result) == 2)\r\n            {\r\n              // save result in cache\r\n              $titlelink_cache[$phrase] = $result;\r\n              $link = $result[0];\r\n              $name = $result[1];\r\n\r\n              if (!$replace_partial_match)\r\n              {\r\n                $name = $phrase;\r\n              }\r\n\r\n              if (!empty($my_item_id) && $this->endswith($link, 'Itemid='))\r\n              {\r\n                $link .= $my_item_id;\r\n              }\r\n            }\r\n          }\r\n\r\n          // if a working link was found, create the complete hyperlink with the given options\r\n          if (!empty($link))\r\n          {\r\n            if (!empty($to_append))\r\n            {\r\n              $link .= $to_append;\r\n            }\r\n\r\n            $options = \"\";\r\n\r\n            // append css-class (can be empty)\r\n            $options .= $css_class;\r\n\r\n            // if the user provided this parameter, overwrite the generic name from above\r\n            $link_title = $title2;\r\n            $link_text = $title1;\r\n\r\n            if (empty($link_title))\r\n            {\r\n              switch($this->disp_tooltip)\r\n              {\r\n                case 0: // Query String\r\n                  $link_title = $phrase;\r\n                  break;\r\n                case 1: // Query Result\r\n                  $link_title = $name;\r\n                  break;\r\n                case 2: // Explicit Title\r\n                  if (!(empty($title1) || $this->startswith($title1, \"<img \")))\r\n                  {\r\n                    $link_title = $title1;\r\n                  }\r\n                  else\r\n                  {\r\n                    $link_title = $name;\r\n                  }\r\n                  break;\r\n                default:\r\n                  $link_title = $name;\r\n              }\r\n            }\r\n\r\n            if (empty($link_text))\r\n            {\r\n              switch($this->disp_link)\r\n              {\r\n                case 0: // Query String\r\n                  $link_text = $phrase;\r\n                  break;\r\n                case 1: // Query Result\r\n                  $link_text = $name;\r\n                  break;\r\n                default:\r\n                  $link_title = $name;\r\n              }\r\n            }\r\n\r\n            // set title\r\n            if ($debug_enabled && $external)\r\n            {\r\n              $options .= \"title=\".$link_title.\"\\\" (open in new window)\\\"\";\r\n            }\r\n            else\r\n            {\r\n              $options .= \"title=\\\"\".$link_title.\"\\\"\";\r\n            }\r\n\r\n            // open the link in a new window?\r\n            if ($external)\r\n            {\r\n              $options .= \" target=\\\"_blank\\\"\";\r\n            }\r\n\r\n            // select page\r\n            if (!empty($limitstart_ix))\r\n            {\r\n              if (is_numeric($limitstart_ix))\r\n              {\r\n                //$link .= \"&start=\".($limitstart_ix-1);\r\n                $link .= \"&limitstart=\".($limitstart_ix-1);\r\n              }\r\n            }\r\n\r\n            // lets TitleLink call other plugins for the target content\r\n            if (!empty($plugin_call_name))\r\n            {\r\n              $link .= \"&\".$this->plugin_call.\"=\".$plugin_call_name;\r\n            }\r\n\r\n            if ($this->isExternal($link))\r\n            {\r\n              // external link\r\n              //$link = htmlentities($link);\r\n              $link = htmlspecialchars($link);\r\n            }\r\n            else\r\n            {\r\n              // internal link, make it sef\r\n              //$link = htmlentities($link);\r\n              $link = JRoute::_($link);\r\n            }\r\n\r\n            // add the anchor to the found link\r\n            if (!empty($anchor))\r\n            {\r\n              $link .= $anchor;\r\n            }\r\n\r\n            $link = \"<a href=\\\"\".$link.\"\\\" \".$options.\">\";\r\n\r\n            if (!$create_open_tag)\r\n            {\r\n              $link .= \"$link_text</a>\";\r\n            }\r\n          }\r\n          else\r\n          {\r\n            if ($this->enablenewcontent)\r\n            {\r\n              $link = \"<strong>\";\r\n              $link .= \"<a href=\\\"\";\r\n              $link .= \"index.php?option=com_content&view=article&layout=form\";\r\n              //$link .= \"index.php?option=com_content&task=new&sectionid=\";\r\n              // use current sectionid\r\n              //$link .= $article->sectionid;\r\n              // hinders Joomla from checking for a published menu entry (authorisation check)\r\n              //$link .= \"&Itemid=-1\";\r\n              $link .= \"\\\" title=\\\"Submit article\\\">\";\r\n              $link .= $phrase;\r\n              $link .= \"!</a>\";\r\n              $link .= \"</strong>\";\r\n            }\r\n            else\r\n            {\r\n              // show $phrase in bold font if no link could be built\r\n              $link = \"<strong>\";\r\n              $link .= $phrase;\r\n              $link .= \"</strong>\";\r\n            }\r\n\r\n            if ($debug_enabled)\r\n            {\r\n              $link .= \"<p>dump:\";\r\n\r\n              $link .= \"<br />new window: \".(($external) ? \"yes\" : \"no\");\r\n\r\n              $link .= \"<br />pieces:<ul>\";\r\n              $count = count($pieces);\r\n              for ($i = 0; $i < $count; $i++)\r\n              {\r\n                $link .= \"<li>\".$pieces[$i].\"</li>\";\r\n              }\r\n              $link .= \"</ul>\";\r\n\r\n              $link .= \"<br />plugin-results:<ul>\";\r\n              $count = count($result);\r\n              for ($i = 0; $i < $count; $i++)\r\n              {\r\n                $link .= \"<li>\".$result[$i].\"</li>\";\r\n              }\r\n              $link .= \"</ul>\";\r\n\r\n              $link .= \"<br />phrase=\".$phrase;\r\n              $link .= \"<br />title=\".$title;\r\n\r\n              $link .= \"<br />available plugins:<ul>\";\r\n              $count = count($this->plugin_cache);\r\n              for ($i = 0; $i < $count; $i++)\r\n              {\r\n                $link .= \"<li>\".$this->plugin_cache[$i].\"</li>\";\r\n              }\r\n              $link .= \"</ul>\";\r\n\r\n              $link .= \"</p>\";\r\n            }\r\n          }\r\n\r\n          $content = preg_replace($this->finalpattern, $link, $content, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    $article->text = $content;\r\n\r\n    $this->callExternalPlugin($article, $params, $limitstart);\r\n\r\n    return true;\r\n  }\r\n\r\n\r\n\r\n/////////////////////////////////////////////\r\n// internal functions\r\n\r\n  function callExternalPlugin($article, $params, $limitstart) {\r\n    $plugin_to_call = JRequest::getVar($this->plugin_call);\r\n    //$plugin_to_call = html_entity_decode(mosGetParam($_GET, $this->plugin_call), ENT_QUOTES);\r\n    $plugin_to_call = stripslashes($plugin_to_call);\r\n    if (!empty($plugin_to_call))\r\n    {\r\n      //$article->text .= \"<!-- plugincall5 key\".$this->plugin_call.\" value\".$plugin_to_call.\" --> <br /><br /><br />\".\"{\".$plugin_to_call.\"}\";\r\n      $article->text .= \"{\".$plugin_to_call.\"}\";\r\n\r\n// TODO call generic $_MAMBOTS\r\n//MAZ changed this to botMosEbayKit3\r\n      botMosEbayKit3(true, $article, $params, $limitstart);\r\n    }\r\n  }\r\n  \r\n  function isExternal($link)\r\n  {\r\n    $link_pattern='/^(http:\\/\\/|)(www.|)([^\\/]+)/i';\r\n\r\n    preg_match($link_pattern, $link, $domain);\r\n    preg_match($link_pattern, $_SERVER['HTTP_HOST'], $http);\r\n\r\n    return $this->startswith($link, \"http\") && ((isset($domain[3])) and (isset($http[3])) and ($domain[3]!==$http[3]));\r\n}\r\n\r\n  function getByPlugins($database, $plugins, $phrase, $partial_match)\r\n  {\r\n    $phrase_escaped = $database->getEscaped($phrase, true);\r\n\r\n    $count = count($plugins);\r\n    for ($i = 0; $i < $count; $i++)\r\n    {\r\n      $result = call_user_func($plugins[$i], $database, $phrase_escaped, $partial_match);\r\n\r\n      // magix number '2' is the amount of strings we need as result\r\n      if (count($result) == 2)\r\n      {\r\n        return $result;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  function getPluginFunctions($dir, $pluginmask, &$pluginParams)\r\n  {\r\n    //$dir = $this->dir; $pluginmask = $this->pluginmask; $pluginParams = $this->params;\r\n\r\n    // load plugin params info\r\n    //$plugin =& JPluginHelper::getPlugin('content', 'titlelink');\r\n    //$pluginParams   = new JParameter( $plugin->params );\r\n\r\n    $files = null;\r\n    $dh  = opendir(JPATH_ROOT.DIRECTORY_SEPARATOR.$dir);\r\n    while (false !== ($filename = readdir($dh)))\r\n    {\r\n      $keyname = substr($filename, 0, strlen($filename) - strlen('.php'));\r\n\r\n      if ($this->startswith($filename, $pluginmask)\r\n          && $pluginParams->get($keyname, 0) > 0)\r\n      {\r\n        // found \"plugin\", include in list\r\n        $files[] = array('file' => $filename, 'order' => $pluginParams->get($keyname, 0));\r\n      }\r\n    }\r\n\r\n    if ($files == null)\r\n    {\r\n      // no plugin found\r\n      return null;\r\n    }\r\n\r\n    $filenames = array();\r\n    $orders = array();\r\n    \r\n\t// Obtain a list of columns\r\n\tforeach($files as $key => $row)\r\n\t{\r\n\t    $filenames[$key] = $row['file'];\r\n\t    $orders[$key] = $row['order'];\r\n\t}\r\n\t\r\n\tarray_multisort($orders, SORT_ASC, $filenames, SORT_ASC, $files);\r\n\r\n    // load plugins\r\n    foreach($files as $key => $row)\r\n    {\r\n      $file = $row['file'];\r\n      if (!empty($file))\r\n      {\r\n        include_once(JPATH_ROOT.DIRECTORY_SEPARATOR.$dir.DIRECTORY_SEPARATOR.$file);\r\n      }\r\n    }\r\n\r\n    // get only functions which are usable in this bot\r\n    $functions = get_defined_functions();\r\n    $functions = $functions[\"user\"];\r\n    $count = count($functions);\r\n    for ($i = 0; $i < $count; $i++)\r\n    {\r\n      if ($this->startswith($functions[$i], $pluginmask))\r\n      {\r\n        $plugin_fkt[] = $functions[$i];\r\n      }\r\n    }\r\n\r\n    return $plugin_fkt;\r\n  }\r\n\r\n  function startswith($source, $mask)\r\n  {\r\n    $pos = strpos($source, $mask);\r\n    return (($pos !== false) && ($pos == 0));\r\n  }\r\n\r\n  function endswith($source, $mask)\r\n  {\r\n    $pos = strpos($source, $mask);\r\n    return (($pos !== false) && ($pos == (strlen($source)-strlen($mask))));\r\n  }\r\n\r\n  function stringrpos($haystack,$needle,$offset=NULL)\r\n  {\r\n    return strlen($haystack)\r\n           - strpos( strrev($haystack) , strrev($needle) , $offset)\r\n           - strlen($needle);\r\n  }\r\n\r\n  function strrpos_string($haystack, $needle, $offset = 0)\r\n  {\r\n    if(trim($haystack) != \"\" && trim($needle) != \"\" && $offset <= strlen($haystack))\r\n    {\r\n      $last_pos = $offset;\r\n      $found = false;\r\n      while(($curr_pos = strpos($haystack, $needle, $last_pos)) !== false)\r\n      {\r\n        $found = true;\r\n        $last_pos = $curr_pos + 1;\r\n      }\r\n      if($found)\r\n      {\r\n        return $last_pos - 1;\r\n      }\r\n      else\r\n      {\r\n        return false;\r\n      }\r\n    }\r\n    else\r\n    {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function getSearchLink($engine, $phrase)\r\n  {\r\n    $space_replacement = \"%20\";\r\n    $search_link = null;\r\n\r\n    switch($engine)\r\n    {\r\n      case \"search\":\r\n        // local search\r\n        $search_link = \"index.php?option=com_search&ordering=&searchphrase=all&searchword=\".$phrase;\r\n        $space_replacement = \"+\";\r\n        break;\r\n\r\n      case \"abbenormal\":\r\n        $search_link = \"http://www.ourpla.net/cgi-bin/pikie.cgi?\".$phrase;\r\n         break;\r\n      case \"acronym\":\r\n        $search_link = \"http://www.acronymfinder.com/af-query.asp?String=exact&Acronym=\".$phrase;\r\n        break;\r\n      case \"advogato\":\r\n        $search_link = \"http://www.advogato.org/\".$phrase;\r\n        break;\r\n      case \"amazon_com\":\r\n        $search_link = \"http://www.amazon.com/s?url=search-alias%3Daps&field-keywords=\".$phrase;\r\n        $space_replacement = \"+\";\r\n        break;\r\n      case \"bible\":\r\n        $search_link = \"http://bible.gospelcom.net/bible?\".$phrase;\r\n        break;\r\n      case \"caffeinatedwiki\":\r\n        $search_link = \"http://socrates.yi.org/\".$phrase;\r\n        break;\r\n      case \"cliki\":\r\n        $search_link = \"http://www.cliki.net/\".$phrase;\r\n        break;\r\n      case \"cmwiki\":\r\n        $search_link = \"http://www.cmwiki.com/\".$phrase;\r\n        break;\r\n      case \"creationmatters\":\r\n        $search_link = \"http://www.ourpla.net/cgi-bin/wiki.pl?\".$phrase;\r\n        break;\r\n      case \"cssdiscusswiki\":\r\n        $search_link = \"http://css-discuss.incutio.com/?page=\".$phrase;\r\n        break;\r\n      case \"dictionary\":\r\n        $search_link = \"http://www.dictionary.com/cgi-bin/dict.pl?term=\".$phrase;\r\n        break;\r\n      case \"doiwalters\":\r\n        $search_link = \"http://www.doiwalters.com/wiki/\".$phrase;\r\n        break;\r\n      case \"emacswiki\":\r\n        $search_link = \"http://www.emacswiki.org/cgi-bin/wiki/\".$phrase;\r\n        break;\r\n      case \"everything2\":\r\n        $search_link = \"http://www.everything2.com/\".$phrase;\r\n        break;\r\n      case \"foldoc\":\r\n        $search_link = \"http://www.foldoc.org/foldoc/foldoc.cgi?\".$phrase;\r\n        break;\r\n      case \"foxwiki\":\r\n        $search_link = \"http://fox.wikis.com/wc.dll?Wiki~\".$phrase;\r\n        break;\r\n      case \"geekido\":\r\n        $search_link = \"http://geekido.org/index.php?page=\".$phrase;\r\n        break;\r\n      case \"google\":\r\n        $search_link = \"http://www.google.com/search?q=\".$phrase;\r\n        $space_replacement = \"+\";\r\n        break;\r\n      case \"googlegroups\":\r\n        $search_link = \"http://groups.google.com/groups?q=\".$phrase;\r\n        break;\r\n      case \"h2g2\":\r\n        $search_link = \"http://www.bbc.co.uk/h2g2/guide/Search?searchstring=\".$phrase;\r\n        break;\r\n      case \"hootoo\":\r\n        $search_link = \"http://www.bbc.co.uk/h2g2/guide/Search?searchstring=\".$phrase;\r\n        break;\r\n      case \"hhgg\":\r\n        $search_link = \"http://www.bbc.co.uk/dna/h2g2/\".$phrase;\r\n        break;\r\n      case \"iawiki\":\r\n        $search_link = \"http://www.IAwiki.net/\".$phrase;\r\n        break;\r\n      case \"icq\":\r\n        $search_link = \"http://wwp.icq.com/\".$phrase;\r\n        break;\r\n      case \"imdb\":\r\n        $search_link = \"http://us.imdb.com/Title?\".$phrase;\r\n        break;\r\n      case \"jargonfile\":\r\n        $search_link = \"http://sunir.org/apps/meta.pl?wiki=JargonFile&redirect=\".$phrase;\r\n        break;\r\n      case \"jtf\":\r\n        $search_link = \"http://www.justthefaqs.org/?page=\".$phrase;\r\n        break;\r\n      case \"knowhow\":\r\n        $search_link = \"http://www2.iro.umontreal.ca/~paquetse/cgi-bin/wiki.cgi?\".$phrase;\r\n        break;\r\n      case \"kwiki\":\r\n        $search_link = \"http://kwiki.org/?\".$phrase;\r\n        break;\r\n      case \"linuxquestions\":\r\n        $search_link = \"http://wiki.linuxquestions.org/wiki/\".$phrase;\r\n        break;\r\n      case \"livejournal\":\r\n        $search_link = \"http://www.livejournal.com/users/\".$phrase;\r\n        break;\r\n      case \"meatball\":\r\n        $search_link = \"http://www.usemod.com/cgi-bin/mb.pl?\".$phrase;\r\n        break;\r\n      case \"metawiki\":\r\n        $search_link = \"http://sunir.org/apps/meta.pl?words=\".$phrase;\r\n        break;\r\n      case \"moinmoin\":\r\n        $search_link = \"http://moinmoin.wikiwikiweb.de/\".$phrase;\r\n        break;\r\n      case \"openwiki\":\r\n        $search_link = \"http://openwiki.com/ow.asp?\".$phrase;\r\n        break;\r\n      case \"orgpatterns\":\r\n        $search_link = \"http://www.bell-labs.com/cgi-user/OrgPatterns/OrgPatterns?\".$phrase;\r\n        break;\r\n      case \"patent\":\r\n        $search_link = \"http://patft.uspto.gov/netacgi/nph-Parser?patentnumber=\".$phrase;\r\n        break;\r\n      case \"pgpkey\":\r\n        $search_link = \"http://keys.pgp.dk:11371/pks/lookup?op=get&search=\".$phrase;\r\n        break;\r\n      case \"phpwiki\":\r\n        $search_link = \"http://phpwiki.sourceforge.net/phpwiki/\".$phrase;\r\n        break;\r\n      case \"pikie\":\r\n        $search_link = \"http://pikie.webbing.nl/cgi-bin/pikie.cgi?\".$phrase;\r\n        break;\r\n      case \"ppr\":\r\n        $search_link = \"http://c2.com/cgi/wiki?\".$phrase;\r\n        break;\r\n      case \"pythoninfo\":\r\n        $search_link = \"http://www.python.org/cgi-bin/moinmoin/\".$phrase;\r\n        break;\r\n      case \"rfc\":\r\n        $search_link = \"http://www.rfc.org.uk/cgi-bin/lookup.cgi?rfc=\".$phrase;\r\n        break;\r\n      case \"sourceforge\":\r\n        $search_link = \"http://sourceforge.net/\".$phrase;\r\n        break;\r\n      case \"squeak\":\r\n        $search_link = \"http://minnow.cc.gatech.edu/squeak/\".$phrase;\r\n        break;\r\n      case \"squirrelmail\":\r\n        $search_link = \"http://squirrelmail.org/wiki/wiki.php?\".$phrase;\r\n        break;\r\n      case \"tavi\":\r\n        $search_link = \"http://tavi.sourceforge.net/\".$phrase;\r\n        break;\r\n      case \"thesaurus\":\r\n        $search_link = \"http://www.thesaurus.com/cgi-bin/search?config=roget&words=\".$phrase;\r\n        break;\r\n      case \"thinki\":\r\n        $search_link = \"http://www.thinkware.se/cgi-bin/thinki.cgi/\".$phrase;\r\n        break;\r\n      case \"twiki\":\r\n        $search_link = \"http://twiki.sourceforge.net/cgi-bin/view/\".$phrase;\r\n        break;\r\n      case \"usemod\":\r\n        $search_link = \"http://www.usemod.com/cgi-bin/wiki.pl?\".$phrase;\r\n        break;\r\n      case \"visualworks\":\r\n        $search_link = \"http://wiki.cs.uiuc.edu/VisualWorks/\".$phrase;\r\n        break;\r\n      case \"webster\":\r\n        $search_link = \"http://m-w.com/cgi-bin/dictionary?va=\".$phrase;\r\n        break;\r\n      case \"why\":\r\n        $search_link = \"http://clublet.com/c/c/why?\".$phrase;\r\n        break;\r\n      case \"wiki\":\r\n        $search_link = \"http://c2.com/cgi/wiki?\".$phrase;\r\n        break;\r\n      case \"wikifind\":\r\n        $search_link = \"http://c2.com/cgi/wiki?FindPage&value=\".$phrase;\r\n        break;\r\n      case \"wikipedia\":\r\n        $search_link = \"http://en.wikipedia.org/wiki/\".$phrase;\r\n        break;\r\n      case \"wiktionary\":\r\n        $search_link = \"http://en.wiktionary.org/wiki/\".$phrase;\r\n        break;\r\n      case \"wunderground\":\r\n        $search_link = \"http://www.wunderground.com/cgi-bin/findweather/getForecast?query=\".$phrase;\r\n        break;\r\n      case \"yahoo\":\r\n        $search_link = \"http://search.yahoo.com/search?p=\".$phrase;\r\n        $space_replacement = \"+\";\r\n        break;\r\n      case \"zwiki\":\r\n        $search_link = \"http://www.zwiki.org/\".$phrase;\r\n        break;\r\n      default:\r\n        // do nothing\r\n        $search_link = null;\r\n        break;\r\n    }\r\n\r\n    if (!empty($search_link))\r\n    {\r\n      $search_link = preg_replace($this->pattern_start_end.\"\\ \".$this->pattern_start_end, $space_replacement, $search_link);\r\n    }\r\n\r\n    return $search_link;\r\n  }\r\n}\r\n?>", "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<install version=\"1.5\" type=\"plugin\" group=\"content\" method=\"upgrade\">\n\t<name>Content - TitleLink</name>\n\t<author>Tobias Gesellchen</author>\n\t<creationDate>2008-06-03</creationDate>\n\t<copyright>(C) 2005-2010 Tobias Gesellchen. All rights reserved.</copyright>\n\t<license>http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL</license>\n\t<authorEmail>tobias@gesellix.de</authorEmail>\n\t<authorUrl>www.gesellix.de</authorUrl>\n\t<version>3.2.1 2010-08-08 stable</version>\n  <description>DESCTITLELINK</description>\n  <files>\n    <filename plugin=\"titlelink\">titlelink.php</filename>\n    <filename>titlelink_plugins/plugin_content_title.php</filename>\n    <filename>titlelink_plugins/plugin_menuitem.php</filename>\n    <filename>titlelink_plugins/plugin_remository.php</filename>\n    <filename>titlelink_plugins/plugin_shortlink.php</filename>\n    <filename>titlelink_plugins/plugin_virtuemart.php</filename>\n    <filename>titlelink_plugins/plugin_virtuemart_category.php</filename>\n    <filename>titlelink_plugins/plugin_alberghi.php</filename>\n    <filename>titlelink_plugins/plugin_artforms.php</filename>\n    <filename>titlelink_plugins/plugin_docman.php</filename>\n    <filename>titlelink_plugins/plugin_peoplebook.php</filename>\n    <filename>titlelink_plugins/plugin_jmovies.php</filename>\n  </files>\n  <!-- old method to describe language files \n       Generally works\n  -->\n<!--\n\t<languages>\n\t\t<language tag=\"en-GB\">administrator/language/en-GB.plg_content_titlelink.ini</language>\n\t\t<language tag=\"de-DE\">administrator/language/de-DE.plg_content_titlelink.ini</language>\n\t\t<language tag=\"es-ES\">administrator/language/es-ES.plg_content_titlelink.ini</language>\n    <language tag=\"fa-IR\">administrator/language/fa-IR.plg_content_titlelink.ini</language>\n    <language tag=\"nl-NL\">administrator/language/nl-NL.plg_content_titlelink.ini</language>\n\t\t<language tag=\"ru-RU\">administrator/language/ru-RU.plg_content_titlelink.ini</language>\n\t\t<language tag=\"tr-TR\">administrator/language/tr-TR.plg_content_titlelink.ini</language>\n\t</languages>\n-->\n  <!-- new method to describe language files\n       Doesn't work well :-(\n       2007-05-15 Installs only first language\n   -->\n  <languages folder=\"administrator/language\">\n    <language tag=\"en-GB\">en-GB.plg_content_titlelink.ini</language>\n  </languages>\n\n  <params name=\"\" description=\"\">\n    <param \n      name=\"separator\" \n      type=\"text\" \n      default=\":\" \n      label=\"Separator\"\n      description=\"Default is the colon ':'\" />\n    <param \n      name=\"trigger_prefix\" \n      type=\"text\" \n      default=\"{ln\" \n      label=\"Prefix\"\n      description=\"Default: {ln\" />\n    <param \n      name=\"trigger_suffix\" \n      type=\"text\" \n      default=\"}\" \n      label=\"Suffix\"\n      description=\"Default: }\" />\n\t<param name=\"@spacer\" type=\"spacer\" default=\"\" label=\"\" description=\"\" />\n    <param\n      name=\"enablepartialmatch\"\n      type=\"radio\"\n      default=\"1\"\n      label=\"Enable partial match\"\n      description=\"If no match is found with the exact search, try partial matching.\">\n      <option value=\"1\">Enabled</option>\n      <option value=\"0\">Disabled</option>\n    </param>\n    <param\n      name=\"enablenewcontent\"\n      type=\"radio\"\n      default=\"0\"\n      label=\"Link to create new article\"\n      description=\"If no match is found, create a link to add new content.\">\n      <option value=\"1\">Enabled</option>\n      <option value=\"0\">Disabled</option>\n    </param>\n    <param\n      name=\"disp_link\"\n      type=\"list\"\n      label=\"Displayed Link\"\n      default=\"1\"\n      description=\"Options for Displayed Link (if no explicit title entered after ')\">\n      <option value=\"0\">Query String</option>\n      <option value=\"1\">Query Result</option>\n    </param>\n    <param\n      name=\"disp_tooltip\"\n      type=\"list\"\n      label=\"Displayed ToolTip\"\n      default=\"1\"\n      description=\"Options for ToolTip (ALT Text)\">\n      <option value=\"0\">Query String</option>\n      <option value=\"1\">Query Result</option>\n      <option value=\"2\">Explicit Title</option>\n    </param>\n\t<param name=\"@spacer\" type=\"spacer\" default=\"\" label=\"\" description=\"\" />\n    <param\n      name=\"plugin_content_title\"\n      type=\"list\"\n      default=\"1\"\n      label=\"Content by Title or Alias\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_menuitem\"\n      type=\"list\"\n      default=\"1\"\n      label=\"Content by Menuitem\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_shortlink\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by Shortlink (needs com_shortlink)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_virtuemart\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by VirtueMart Product (needs com_virtuemart)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_virtuemart_category\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by VirtueMart Category (needs com_virtuemart)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_alberghi\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by Alberghi (needs com_alberghi)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_artforms\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by ArtForms (needs com_artforms)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_docman\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by DocMan (needs com_docman)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_remository\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by Remository (needs com_remository)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_peoplebook\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by PeopleBook (needs com_peoplebook)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n    <param\n      name=\"plugin_jmovies\"\n      type=\"list\"\n      default=\"0\"\n      label=\"Content by JMovies (needs com_jmovies)\"\n      description=\"TODO.\">\n      <option value=\"0\">Disabled</option>\n      <option value=\"1\">1</option>\n      <option value=\"2\">2</option>\n      <option value=\"3\">3</option>\n      <option value=\"4\">4</option>\n      <option value=\"5\">5</option>\n      <option value=\"6\">6</option>\n      <option value=\"7\">7</option>\n      <option value=\"8\">8</option>\n      <option value=\"9\">9</option>\n      <option value=\"10\">10</option>\n    </param>\n  </params>\n</install>", "<?php\r\n\r\ndefined( '_JEXEC' ) or die('Direct Access to this location is not allowed.');\r\n\r\n/**\r\n * Get an article by searching for a matching 'title_alias' or 'title'\r\n */\r\nfunction plugin_contentTitle($database, $phrase, $partial_match = true)\r\n{\r\n  global $mainframe;\r\n\r\n  if(!class_exists('ContentHelperRoute'))\r\n  {\r\n    require_once( JPATH_SITE.DS.'components'.DS.'com_content'.DS.'helpers'.DS.'route.php' );\r\n  }\r\n\r\n  //$database = & JFactory::getDBO();\r\n\r\n  //$base_link = \"index.php?option=com_content&view=article&id=\";\r\n\r\n  $result = null;\r\n\r\n  $query  = \"SELECT a.id, a.title AS arttitle, a.alias AS artalias, c.id as catid, c.alias AS catalias, a.sectionid\";\r\n  $query .= \" FROM #__content AS a \";\r\n  $query .= \" LEFT JOIN #__categories AS c ON a.catid = c.id \";\r\n  $query .= \" LEFT JOIN #__sections AS s ON a.sectionid = s.id \";\r\n\r\n  $where_clause = \" WHERE a.state=1 \";\r\n\r\n  $where_variant = \" AND a.alias \" .\r\n  \t\t\t\t(($partial_match)\r\n  \t\t\t\t\t? \" LIKE \".$database->quote('%'.$phrase.'%', false)\r\n    \t\t\t\t: \"= \".$database->quote($phrase, false));\r\n  $result = findContentInternal($database, $query.$where_clause.$where_variant, false);\r\n\r\n  if ($result == null)\r\n  {\r\n    $where_variant = \" AND a.title \" .\r\n  \t\t\t\t(($partial_match)\r\n  \t\t\t\t\t? \" LIKE \".$database->quote('%'.$phrase.'%', false)\r\n  \t\t\t\t\t: \"= \".$database->quote($phrase, false));\r\n  \t$result = findContentInternal($database, $query.$where_clause.$where_variant, true);\r\n  }\r\n  \r\n  return $result;\r\n}\r\n\r\nfunction findContentInternal($database, $query_variant, $getTitle)\r\n{\r\n  $result = null;\r\n\t\r\n  $database->setQuery($query_variant);\r\n\r\n  $my = null;\r\n  $my = $database->loadObject();\r\n  if ($my)\r\n  {\r\n    if (empty($my->catid) || empty($my->catalias) || empty($my->sectionid))\r\n    {\r\n      $result[0] = ContentHelperRoute::getArticleRoute($my->id.':'.$my->artalias);\r\n    }\r\n    else\r\n    {\r\n      $result[0] = ContentHelperRoute::getArticleRoute($my->id.':'.$my->artalias, $my->catid.':'.$my->catalias, $my->sectionid);\r\n    }\r\n    \r\n    $result[1] = ($getTitle) ? $my->arttitle : $my->artalias;\r\n\r\n    if (strpos($result[0], '&Itemid=') < 0)\r\n    {\r\n\t  $itemid = $mainframe->getItemid( $my->id );\r\n      if ($itemid)\r\n      {\r\n        $result[0] .= \"&Itemid=\".$itemid;\r\n      }\r\n    }\r\n  }\r\n  \r\n  return $result;\r\n}\r\n\r\n?>"], "filenames": ["j_1_5_x/plugin/changelog.php", "j_1_5_x/plugin/titlelink.php", "j_1_5_x/plugin/titlelink.xml", "j_1_5_x/plugin/titlelink_plugins/plugin_content_title.php"], "buggy_code_start_loc": [5, 594, 6, 30], "buggy_code_end_loc": [5, 599, 11, 36], "fixing_code_start_loc": [6, 595, 6, 30], "fixing_code_end_loc": [11, 601, 11, 42], "type": "CWE-89", "message": "A vulnerability classified as critical was found in gesellix titlelink. Affected by this vulnerability is an unknown functionality of the file plugin_content_title.php. The manipulation of the argument phrase leads to sql injection. The name of the patch is b4604e523853965fa981a4e79aef4b554a535db0. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-217351.", "other": {"cve": {"id": "CVE-2010-10003", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-04T10:15:09.577", "lastModified": "2023-01-10T15:46:32.020", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as critical was found in gesellix titlelink. Affected by this vulnerability is an unknown functionality of the file plugin_content_title.php. The manipulation of the argument phrase leads to sql injection. The name of the patch is b4604e523853965fa981a4e79aef4b554a535db0. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-217351."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:titlelink_project:titlelink:*:*:*:*:*:joomla\\!:*:*", "versionEndExcluding": "2010-08-08", "matchCriteriaId": "A9A6D4B0-9109-4943-996A-64FE223B7357"}]}]}], "references": [{"url": "https://github.com/gesellix/titlelink/commit/b4604e523853965fa981a4e79aef4b554a535db0", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217351", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.217351", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/gesellix/titlelink/commit/b4604e523853965fa981a4e79aef4b554a535db0"}}