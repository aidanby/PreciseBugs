{"buggy_code": ["<?php\n/*\n *********************************************************************************************************\n * daloRADIUS - RADIUS Web Platform\n * Copyright (C) 2007 - Liran Tal <liran@enginx.com> All Rights Reserved.\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n *\n *********************************************************************************************************\n *\n * Authors:    Liran Tal <liran@enginx.com>\n *             Filippo Lauria <filippo.lauria@iit.cnr.it>\n *\n *********************************************************************************************************\n */\n\n    include(\"library/checklogin.php\");\n    $operator = $_SESSION['operator_user'];\n        \n    include_once('library/config_read.php');\n    $log = \"visited page: \";\n\n    include_once(\"lang/main.php\");\n    \n    include(\"library/layout.php\");\n\n    // print HTML prologue\n    $title = t('Intro','configbackup.php');\n    $help = t('helpPage','configbackup');\n    \n    print_html_prologue($title, $langCode);\n\n    include(\"menu-config-backup.php\");\n\n    echo '<div id=\"contentnorightbar\">';\n    print_title_and_help($title, $help);\n?>\n\n        </div><!-- #contentnorightbar -->\n        \n        <div id=\"footer\">\n<?php\n    include('include/config/logging.php');\n    include('page-footer.php');\n?>\n        </div><!-- #footer -->\n    </div>\n</div>\n\n</body>\n</html>\n", "<?php \n/*\n *********************************************************************************************************\n * daloRADIUS - RADIUS Web Platform\n * Copyright (C) 2007 - Liran Tal <liran@enginx.com> All Rights Reserved.\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n *\n *********************************************************************************************************\n *\n * Authors:    Liran Tal <liran@enginx.com>\n *             Filippo Lauria <filippo.lauria@iit.cnr.it>\n *\n *********************************************************************************************************\n */\n\n    include (\"library/checklogin.php\");\n    $operator = $_SESSION['operator_user'];\n\n    include_once('library/config_read.php');\n    $log = \"visited page: \";\n\n    include_once(\"lang/main.php\");\n\n    $param_label = array(\n                            'CONFIG_LOG_PAGES' => t('all','PagesLogging'),\n                            'CONFIG_LOG_QUERIES' => t('all','QueriesLogging'),\n                            'CONFIG_LOG_ACTIONS' => t('all','ActionsLogging'),\n                            'CONFIG_DEBUG_SQL' => t('all','LoggingDebugInfo'),\n                            'CONFIG_DEBUG_SQL_ONPAGE' => t('all','LoggingDebugOnPages')\n                        );\n\n    // if the form has been submitted we validate and store the configuration\n    if (array_key_exists('submit', $_POST) && isset($_POST['submit'])) {\n        \n        foreach ($param_label as $param => $label) {\n            if (array_key_exists($param, $_POST) && isset($_POST[$param]) &&\n                in_array(strtolower($_POST[$param]), array(\"yes\", \"no\"))) {\n                $configValues[$param] = $_POST[$param];\n            }\n        }\n\n        if (array_key_exists('CONFIG_LOG_FILE', $_POST) && isset($_POST['CONFIG_LOG_FILE']) &&\n            is_writable($_POST['CONFIG_LOG_FILE'])) {\n            $configValues['CONFIG_LOG_FILE'] = $_POST['CONFIG_LOG_FILE'];\n        }\n\n        include(\"library/config_write.php\");\n    }    \n\n    include(\"library/layout.php\");\n\n    // print HTML prologue\n    $title = t('Intro','configlogging.php');\n    $help = t('helpPage','configlogging');\n    \n    print_html_prologue($title, $langCode);\n\n    include (\"menu-config.php\");\n\n    echo '<div id=\"contentnorightbar\">';\n    print_title_and_help($title, $help);\n\n    include_once('include/management/actionMessages.php');\n\n?>\n\n<form name=\"loggingsettings\" method=\"POST\">\n    <fieldset>\n        <h302><?= t('title','Settings'); ?></h302>\n        <br>\n        \n        <ul>\n<?php\n    foreach ($param_label as $name => $label) {\n        print_select_as_list_elem($name, $label, array(\"no\", \"yes\"), $configValues[$name]);\n    }\n?>\n\n            <li class=\"fieldset\">\n                <label for=\"CONFIG_LOG_FILE\" class=\"form\"><?= t('all','FilenameLogging') ?></label>\n                <input value=\"<?= $configValues['CONFIG_LOG_FILE'] ?>\" name=\"CONFIG_LOG_FILE\" id=\"CONFIG_LOG_FILE\">\n            </li>\n\n\n            <li class=\"fieldset\">\n                <br/><hr><br/>\n                <input type=\"submit\" name=\"submit\" value=\"<?= t('buttons','apply') ?>\" class=\"button\">\n            </li>\n        </ul>\n    </fieldset>\n</form>\n\n        </div><!-- #contentnorightbar -->\n        \n        <div id=\"footer\">\n<?php\n    include('include/config/logging.php');\n    include('page-footer.php');\n?>\n        </div><!-- #footer -->\n    </div>\n</div>\n\n</body>\n</html>\n"], "fixing_code": ["<?php\n/*\n *********************************************************************************************************\n * daloRADIUS - RADIUS Web Platform\n * Copyright (C) 2007 - Liran Tal <liran@enginx.com> All Rights Reserved.\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n *\n *********************************************************************************************************\n *\n * Authors:    Liran Tal <liran@enginx.com>\n *             Filippo Lauria <filippo.lauria@iit.cnr.it>\n *\n *********************************************************************************************************\n */\n\n    include(\"library/checklogin.php\");\n    $operator = $_SESSION['operator_user'];\n        \n    include_once('library/config_read.php');\n    $log = \"visited page: \";\n\n    include_once(\"lang/main.php\");\n    \n    include(\"library/layout.php\");\n\n    // print HTML prologue\n    $title = t('Intro','configbackup.php');\n    $help = t('helpPage','configbackup');\n    \n    print_html_prologue($title, $langCode);\n\n    include(\"menu-config-backup.php\");\n\n    echo '<div id=\"contentnorightbar\">';\n    print_title_and_help($title, $help);\n    \n    include('include/config/logging.php');\n    \n    print_footer_and_html_epilogue();\n?>\n", "<?php \n/*\n *********************************************************************************************************\n * daloRADIUS - RADIUS Web Platform\n * Copyright (C) 2007 - Liran Tal <liran@enginx.com> All Rights Reserved.\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; either version 2\n * of the License, or (at your option) any later version.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\n *\n *********************************************************************************************************\n *\n * Authors:    Liran Tal <liran@enginx.com>\n *             Filippo Lauria <filippo.lauria@iit.cnr.it>\n *\n *********************************************************************************************************\n */\n\n    include (\"library/checklogin.php\");\n    $operator = $_SESSION['operator_user'];\n\n    include('library/check_operator_perm.php');\n    include_once('library/config_read.php');\n    \n    // init logging variables\n    $log = \"visited page: \";\n    $logAction = \"\";\n    $logDebugSQL = \"\";\n    \n    include_once(\"lang/main.php\");\n    include(\"library/validation.php\");\n    include(\"library/layout.php\");\n\n    $param_label = array(\n                            'CONFIG_LOG_PAGES' => t('all','PagesLogging'),\n                            'CONFIG_LOG_QUERIES' => t('all','QueriesLogging'),\n                            'CONFIG_LOG_ACTIONS' => t('all','ActionsLogging'),\n                            'CONFIG_DEBUG_SQL' => t('all','LoggingDebugInfo'),\n                            'CONFIG_DEBUG_SQL_ONPAGE' => t('all','LoggingDebugOnPages')\n                        );\n\n    if ($_SERVER['REQUEST_METHOD'] === 'POST') {\n        if (array_key_exists('csrf_token', $_POST) && isset($_POST['csrf_token']) && dalo_check_csrf_token($_POST['csrf_token'])) {\n            \n            $isError = false;\n            \n            // validate yes/no params\n            foreach ($param_label as $param => $label) {\n                if (array_key_exists($param, $_POST) && !empty(strtolower(trim($_POST[$param]))) &&\n                    in_array(strtolower(trim($_POST[$param])), array(\"yes\", \"no\"))) {\n                    $configValues[$param] = $_POST[$param];\n                }\n            }\n            \n            // validate path\n            $log_path_prefix = $configValues['CONFIG_PATH_DALO_VARIABLE_DATA'] . \"/log\";\n            $log_file_suffix = \".log\";\n            \n            if (array_key_exists('CONFIG_LOG_FILE', $_POST) && !empty(trim($_POST['CONFIG_LOG_FILE']))) {\n                $candidate_log_file = trim($_POST['CONFIG_LOG_FILE']);\n                \n                if (\n                        // this ensure that the log_path_prefix is a directory\n                        is_dir($log_path_prefix) &&\n\n                        // this ensures that candidate_log_file starts with the log_path_prefix\n                        substr($candidate_log_file, 0, strlen($log_path_prefix)) === $log_path_prefix &&\n                        \n                        // this ensures that candidate_log_file does not contain \"..\"\n                        strpos($candidate_log_file, \"..\") === false &&\n                        \n                        // this ensures that candidate_log_file ends with the log_file_suffix\n                        substr($candidate_log_file, -strlen($log_file_suffix)) === $log_file_suffix &&\n                        \n                        // this ensures that candidate_log_file is at a writable location\n                        // or that at least it can be written inside the parent directory\n                        (is_writable($candidate_log_file) || is_writable(dirname($candidate_log_file)))\n                    ) {\n                    \n                    $configValues['CONFIG_LOG_FILE'] = $candidate_log_file;\n                    \n                } else {\n                    $isError = true;\n                }\n            } else {\n                $isError = true;\n            }\n            \n            // we write ONLY IF isError is false\n            if (!$isError) {\n                include(\"library/config_write.php\");\n            } else {\n                $failureMsg = sprintf(\"Log path not allowed. Ensure that log file name locates a writable %s file contained in %s\",\n                                      $log_file_suffix, $log_path_prefix);\n                $logAction .= \"$failureMsg on page: \";\n            }\n            \n        } else {\n            // csrf\n            $failureMsg = \"CSRF token error\";\n            $logAction .= \"$failureMsg on page: \";\n        }\n    }\n        \n\n    // print HTML prologue\n    $title = t('Intro','configlogging.php');\n    $help = t('helpPage','configlogging');\n    \n    print_html_prologue($title, $langCode);\n\n    include (\"menu-config.php\");\n\n    echo '<div id=\"contentnorightbar\">';\n    print_title_and_help($title, $help);\n\n    include_once('include/management/actionMessages.php');\n    \n    $fieldset0_descriptor = array(\n                                    \"title\" => t('title','Settings')\n                                 );\n    \n    \n    $input_descriptors0 = array();\n    \n    foreach ($param_label as $name => $label) {\n        $input_descriptors0[] = array(\n                                        \"type\" => \"select\",\n                                        \"options\" => array( \"yes\", \"no\" ),\n                                        \"caption\" => $label,\n                                        \"name\" => $name,\n                                        \"selected_value\" => $configValues[$name]\n                                     );\n    }\n    \n    $input_descriptors0[] = array(\n                                        \"type\" => \"text\",\n                                        \"caption\" => t('all','FilenameLogging'),\n                                        \"name\" => 'CONFIG_LOG_FILE',\n                                        \"value\" => $configValues['CONFIG_LOG_FILE']\n                                     );\n    \n    $input_descriptors0[] = array(\n                                    \"name\" => \"csrf_token\",\n                                    \"type\" => \"hidden\",\n                                    \"value\" => dalo_csrf_token(),\n                                 );\n\n    $input_descriptors0[] = array(\n                                    'type' => 'submit',\n                                    'name' => 'submit',\n                                    'value' => t('buttons','apply')\n                                 );\n    \n    open_form();\n    \n    // open 0-th fieldset\n    open_fieldset($fieldset0_descriptor);\n    \n    foreach ($input_descriptors0 as $input_descriptor) {\n        print_form_component($input_descriptor);\n    }\n    \n    close_fieldset();\n    \n    close_form();\n    \n    include('include/config/logging.php');\n    \n    print_footer_and_html_epilogue();\n\n?>\n"], "filenames": ["config-backup.php", "config-logging.php"], "buggy_code_start_loc": [43, 26], "buggy_code_end_loc": [59, 114], "fixing_code_start_loc": [44, 27], "fixing_code_end_loc": [48, 177], "type": "CWE-641", "message": "Improper Restriction of Names for Files and Other Resources in GitHub repository lirantal/daloradius prior to master-branch.", "other": {"cve": {"id": "CVE-2023-0046", "sourceIdentifier": "security@huntr.dev", "published": "2023-01-04T12:15:08.613", "lastModified": "2023-01-10T18:39:13.667", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Improper Restriction of Names for Files and Other Resources in GitHub repository lirantal/daloradius prior to master-branch."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.2, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.2, "impactScore": 5.9}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.2, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.2, "impactScore": 5.9}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-641"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:daloradius:daloradius:*:*:*:*:*:*:*:*", "versionEndExcluding": "2023-01-04", "matchCriteriaId": "7DD76224-4B00-4D98-80C7-66C46785EB22"}]}]}], "references": [{"url": "https://github.com/lirantal/daloradius/commit/2013c2d1231e99dac918247b69b198ded1f30a1c", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/2214dc41-f283-4342-95b1-34a2f4fea943", "source": "security@huntr.dev", "tags": ["Exploit", "Issue Tracking", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/lirantal/daloradius/commit/2013c2d1231e99dac918247b69b198ded1f30a1c"}}