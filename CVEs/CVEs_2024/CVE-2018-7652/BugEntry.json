{"buggy_code": ["package Zonemaster::GUI::Dancer::Export;\n\nuse warnings;\nuse 5.14.2;\n\nuse Dancer ':syntax';\nuse Plack::Builder;\nuse HTML::Entities;\nuse Zonemaster::GUI::Dancer::Client;\n\nour $VERSION = '1.0.7';\n\nmy $backend_port = 5000;\n$backend_port = $ENV{ZONEMASTER_BACKEND_PORT} if ($ENV{ZONEMASTER_BACKEND_PORT});\nmy $url = \"http://localhost:$backend_port\";\n\nany [ 'get', 'post' ] => '/export' => sub {\n    header( 'Cache-Control' => 'no-store, no-cache, must-revalidate' );\n    my %allparams = params;\n    no warnings 'uninitialized';\n\n    if ( $allparams{'type'} eq 'HTML' ) {\n\t\tmy $c = Zonemaster::GUI::Dancer::Client->new( { url => $url } );\n\t\tmy $test_result = $c->get_test_results( { id => $allparams{'test_id'}, language => $allparams{'lang'} } );\n\n\t\tmy @test_results;\n\t\tmy $previous_module = '';\n\t\tforeach my $result ( @{ $test_result->{results} } ) {\n\t\t\tif ( $previous_module ne $result->{module} ) {\n\t\t\t\tpush( @test_results, { is_module => 1, message => $result->{module} } );\n\t\t\t\t$previous_module = $result->{module};\n\t\t\t}\n\n\t\t\tpush( @test_results, { is_module => 0, message => $result->{message}, class => \"alert alert-$result->{level}\" } );\n\t\t}\n\n\t\tmy $template_params;\n\t\t$template_params->{test_results}  = \\@test_results;\n\t\ttemplate 'export', $template_params, { layout => undef };\n    }\n};\n\ntrue;\n"], "fixing_code": ["package Zonemaster::GUI::Dancer::Export;\n\nuse warnings;\nuse 5.14.2;\n\nuse Dancer ':syntax';\nuse Plack::Builder;\nuse HTML::Entities;\nuse Zonemaster::GUI::Dancer::Client;\n\nour $VERSION = '1.0.7';\n\nmy $backend_port = 5000;\n$backend_port = $ENV{ZONEMASTER_BACKEND_PORT} if ($ENV{ZONEMASTER_BACKEND_PORT});\nmy $url = \"http://localhost:$backend_port\";\n\nany [ 'get', 'post' ] => '/export' => sub {\n    header( 'Cache-Control' => 'no-store, no-cache, must-revalidate' );\n    my %allparams = params;\n    no warnings 'uninitialized';\n\n    if ( $allparams{'type'} eq 'HTML' ) {\n\t\tmy $c = Zonemaster::GUI::Dancer::Client->new( { url => $url } );\n\t\tmy $test_result = $c->get_test_results( { id => $allparams{'test_id'}, language => $allparams{'lang'} } );\n\n\t\tmy @test_results;\n\t\tmy $previous_module = '';\n\t\tforeach my $result ( @{ $test_result->{results} } ) {\n\t\t\tif ( $previous_module ne $result->{module} ) {\n\t\t\t\tpush( @test_results, { is_module => 1, message => $result->{module} } );\n\t\t\t\t$previous_module = $result->{module};\n\t\t\t}\n\n\t\t\tpush( @test_results, { is_module => 0, message => HTML::Entities::encode($result->{message}), class => \"alert alert-$result->{level}\" } );\n\t\t}\n\n\t\tmy $template_params;\n\t\t$template_params->{test_results}  = \\@test_results;\n\t\ttemplate 'export', $template_params, { layout => undef };\n    }\n};\n\ntrue;\n"], "filenames": ["lib/Zonemaster/GUI/Dancer/Export.pm"], "buggy_code_start_loc": [34], "buggy_code_end_loc": [35], "fixing_code_start_loc": [34], "fixing_code_end_loc": [35], "type": "CWE-79", "message": "lib/Zonemaster/GUI/Dancer/Export.pm in Zonemaster Web GUI before 1.0.11 has XSS.", "other": {"cve": {"id": "CVE-2018-7652", "sourceIdentifier": "cve@mitre.org", "published": "2018-03-04T01:29:00.407", "lastModified": "2020-04-30T20:04:58.960", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "lib/Zonemaster/GUI/Dancer/Export.pm in Zonemaster Web GUI before 1.0.11 has XSS."}, {"lang": "es", "value": "lib/Zonemaster/GUI/Dancer/Export.pm en Zonemaster Web GUI, en versiones anteriores a la 1.0.11 tiene Cross-Site Scripting (XSS)."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:zonemaster:zonemaster_web_gui:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.0.11", "matchCriteriaId": "9C8FEA3E-E821-4112-A539-A715F3979F68"}]}]}], "references": [{"url": "https://github.com/dotse/zonemaster-gui/commit/568e8db44930fda4563c1e708a2440909fd8e5fe", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/dotse/zonemaster-gui/issues/217", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Third Party Advisory"]}, {"url": "https://github.com/dotse/zonemaster-gui/pull/218", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/dotse/zonemaster-gui/releases/tag/v1.0.11", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/dotse/zonemaster-gui/commit/568e8db44930fda4563c1e708a2440909fd8e5fe"}}