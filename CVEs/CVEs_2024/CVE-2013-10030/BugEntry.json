{"buggy_code": ["<?php\r\n\r\n/**\r\n * @package Wordpress Exit Box Lite\r\n * @author Bouzid Nazim Zitouni\r\n * @version 1.06\r\n */\r\n/*\r\nPlugin Name: Wordpress Exit Box Lite\r\nPlugin URI: http://angrybyte.com/wordpress-plugins/wordpress-exit-box-finally-released/\r\nDescription: Wordpress exit box is used design and display your exit box, a ThickBox page that will be shown to your users when they click a external link.\r\nAuthor: Bouzid Nazim Zitouni\r\nVersion: 1.06\r\nAuthor URI: http://angrybyte.com\r\n*/\r\n\r\n\r\nadd_option(\"exitboxcontents\",\r\n    '<h2 style=\"text-align: center;\">It was nice having you! We hope you enjoyed your stay.</h2>',\r\n    'Contents of the Exit page', 'yes');\r\nadd_option(\"exitboxdelay\", '15', 'yes');\r\nadd_option(\"boxautoredirect\", '0', 'yes');\r\n\r\nadd_option(\"exitboxwidth\", '630', 'yes'); //just needed with thickbox\r\nadd_option(\"exitboxheight\", '440', 'yes'); //just needed with thickbox\r\n\r\nadd_filter('the_content', 'widgetreplacelinks');\r\nadd_action('wp_head', 'boxautoredirect');\r\nadd_action('admin_menu', 'exitboxadmin');\r\nadd_filter('query_vars', 'xtbx_queryvars');\r\n\r\nfunction exitboxes($what)\r\n{\r\n\r\n    $mypath = get_option('siteurl') . '/wp-content/plugins/' . plugin_basename(dirname\r\n        (__file__));\r\n    if ($what == 'list')\r\n    {\r\n        return array('thickbox');\r\n    }\r\n    if ($what == 'init')\r\n    {\r\n        if (!is_admin())\r\n        {\r\n\r\n            wp_enqueue_script('jquery');\r\n            wp_enqueue_script('thickbox', null, array('jquery'));\r\n            wp_enqueue_style('thickbox.css', '/' . WPINC . '/js/thickbox/thickbox.css', null,\r\n                '1.0');\r\n            return 1;\r\n\r\n\r\n        }\r\n    }\r\n    if ($what == 'link')\r\n    {\r\n        $exitboxwidth = get_option(\"exitboxwidth\");\r\n        $exitboxheight = get_option(\"exitboxheight\");\r\n\r\n        return array(\"href\" => \"&keepThis=true&width=$exitboxwidth&height=$exitboxheight\",\r\n            \"tag\" => 'class=\"thickbox\"');\r\n\r\n    }\r\n    if ($what == 'close')\r\n    {\r\n\r\n        return \"tb_remove()\";\r\n    }\r\n\r\n}\r\nfunction add_thickscript()\r\n{\r\n    exitboxes('init');\r\n}\r\nadd_action('init', 'add_thickscript');\r\nfunction xtbx_queryvars($qvars)\r\n{\r\n    $qvars[] = 'xb';\r\n\r\n    return $qvars;\r\n}\r\n\r\nfunction exitboxadmin()\r\n{\r\n\r\n    add_options_page('Wordpress Exit Box Lite', 'Wordpress Exit Box Lite', 8,\r\n        __file__, 'exit_box_admin');\r\n}\r\nfunction exit_box_admin()\r\n{\r\n\r\n    if ($_POST['xx'])\r\n    {\r\n\r\n        if (is_numeric($_POST['exitboxwidth']) || $_POST['exitboxwidth'] == \"auto\")\r\n            update_option('exitboxwidth', $_POST['exitboxwidth']);\r\n        if (is_numeric($_POST['exitboxheight']) || $_POST['exitboxheight'] == \"auto\")\r\n            update_option('exitboxheight', $_POST['exitboxheight']);\r\n\r\n        update_option('exitboxcontents', stripslashes($_POST['xx']));\r\n\r\n\r\n    }\r\n    $oldtemp = stripcslashes(get_option(\"exitboxcontents\"));\r\n    $exitboxwidth = get_option(\"exitboxwidth\");\r\n    $exitboxheight = get_option(\"exitboxheight\");\r\n\r\n    echo <<< EOFT\r\n    <h1> Wordpress Exit Box Lite</h1>\r\n    <table ><tr><td >\r\n    <div class=\"metabox-holder\" />\r\n    <div  class=\"postbox gdrgrid frontleft\">\r\n<h3 class=\"hndle\">\r\n<span>Exit Box Options</span>\r\n</h3>\r\n<div class=\"inside\">\r\n<div class=\"table\">\r\n<table>\r\n<tbody>\r\n<tr class=\"first\">\r\n<td class=\"first b\"><strong>Exit Box Design</strong></td>\r\n<td class=\"t options\"><Form method ='post' action='' ><input type='hidden' value='fit' name='fit' id='fit' />\r\nEOFT;\r\n    if (function_exists(wp_editor))\r\n    {\r\n        wp_editor($oldtemp, \"xx\", array('wpautop' => false, 'tabindex' => 1));\r\n\r\n    } else\r\n    {\r\n        echo \"<textarea name='xx' cols='150' rows='20'>$oldtemp</textarea>\";\r\n    }\r\n\r\n    echo <<< EOFT\r\n\r\n  <br/>\r\n  <br/>\r\n  <table><tbody>\r\n  <tr><td><strong>Shortcode</strong></td><td><strong>Used to insert:</strong></td></tr>\r\n  <tr><td><b>%n% </b></td><td>The Redirection Delay.</td></tr>\r\n  <tr><td><b>%link% </b></td><td>The Redirection URL.</td></tr>\r\n  <tr><td><strong><strike>%count%</strike> </strong></td><td>     <font color=\"#BFBDBD\">Redirection Count Down.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%site+1%</strike> </strong></td><td>  <font color=\"#BFBDBD\"> Google +1 Button For Your Site. (Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%post+1% </strike></strong></td><td>  <font color=\"#BFBDBD\"> Google +1 Button  For Your Post.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%sitelike%</strike> </strong></td><td> <font color=\"#BFBDBD\">Facebook Like Button for your site.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%postlike%</strike> </strong></td><td> <font color=\"#BFBDBD\">Facebook Like Button for your post.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%sitetweet%</strike></strong></td><td> <font color=\"#BFBDBD\">Twitter Button For Your Site.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%posttweet%</strike></strong></td><td> <font color=\"#BFBDBD\">Twitter Button For Your Post.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%follow%</strike></strong></td><td>    <font color=\"#BFBDBD\">Twitter Follow Button.(Not included in Lite version)</font></td></tr>\r\n</tbody></table>\r\n  \r\n\r\n<br />HTML and javascript are allowed<br />\r\n \r\n</tr>\r\n<tr>\r\n<td class=\"first b\"><strong>Redirection delay </strong></td><td class=\"t options\"><input type=\"text\" name='delay' disabled=\"disabled\" value='15' />in seconds (not editable in Lite)</td></tr><tr>\r\n<td> <strong> Auto Redirection.</strong></td><td class=\"t options\"><input type='checkbox' disabled=\"disabled\" value='1' $chkd name='boxautoredirect' /> Enable auto redirection after the end of the delay (Not optional in Lite version)</td></tr><tr>\r\n<tr><td>\r\n<strong>Exit Box Type.</strong></td><td class=\"t options\"><select name='exitboxtype' size=\"1\" style=\"width:120px\">\r\n    <option value='thickbox' >thickbox</option>(ColorBox, FancyBox, and Thickbox in full version)\r\n</select><br /> The width of your Exit Box, configure this based on the width of your exit box design. Default:630</td></tr>\r\n<tr><td>\r\n<strong>Exit Box Width.</strong></td><td class=\"t options\"><input type=\"text\" size='100' name='exitboxwidth' value='$exitboxwidth' /><br /> The width of your Exit Box, configure this based on the width of your exit box design. Default:630 (Only  ThickBox)</td></tr>\r\n<tr><td>\r\n\r\n<strong>Exit Box Height.</strong></td><td class=\"t options\"><input type=\"text\" size='100' name='exitboxheight' value='$exitboxheight' /><br /> The height of your Exit Box, configure this based on the height of your exit box design. Default:440 (Only needed when using ThickBox)</td></tr><tr><td>\r\n<strong>Open links in a new window</strong></td><td class=\"t options\"><input type='checkbox' disabled=\"disabled\" value='0'  name='exitboxnewwindow' /> Clicking the external link inside the exit box will open the link in a new page. (Not available in Lite)</td></tr><tr><td>\r\n <strong>Process entire pages</strong></td><td class=\"t options\"><input type='checkbox' disabled=\"disabled\" value='0'  name='boxprocesswholepages' /> redirect links in the entire page including widgets and footer, or just the post contents. (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<strong>End of count Message.</strong></td><td class=\"t options\"><input type=\"text\" size='100' disabled=\"disabled\" name='eoc' value='' /><br /> Display this message when the %count% counter runs out (HTML allowed , can include %link%) Generally &#60;a href=\"%link%\"&#62;Click here to continue&#60;/a&#62; (Not available in Lite)</td></tr><tr><td>\r\n<strong>Excluded pages.</strong></td><td class=\"t options\"><input type=\"text\" size='100' disabled=\"disabled\" name='excl' value='' /><br /> enter to post IDs to be excluded from your exit page, useful for your sales or affiliate pages. Separate by commas ex: 3,55,153 (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<strong>Twitter account.</strong></td><td class=\"t options\">@<input type=\"text\" size='100' disabled=\"disabled\" name='twitterboxname' value='' /><br /> This will be used with the Twitter follow button shortcode %follow% </td></tr>\r\n<tr><td>\r\n<strong>Facebook App Id.</strong></td><td class=\"t options\"><input type=\"text\" size='100' disabled=\"disabled\" name='facebookappid' value='' /><br /> If you dont have one for your website, <a href=\"https://developers.facebook.com/apps/\">get one here</a>. If you keep this blank, your facebook like buttons will fallback to iframe mode, which is not compatible with the Share&Pass feature (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<strong>Enable Share&Pass.</strong></td><td class=\"t options\"><input type='checkbox' disabled=\"disabled\" value='1'  name='socialpass' /> Skip the waiting timer when the user clicks the social sharing buttons (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<strong>Excluded Links</strong>.</td><td class=\"t options\"><textarea name='exitboxexcludedlinks' disabled=\"disabled\" cols='100' rows='20'></textarea><br /> Enter the links you wish to exclude from your exit strategy. each link is a separate line. Excluding a website will exclude all pages within it, and excluding a page will not exclude the rest of the website. (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<input type='submit' value='save' /></form></td></tr>\r\n</tbody>\r\n</table>\r\n</div></div>\r\n</div></td><td VALIGN=\"TOP\">\r\n <div class=\"metabox-holder\" />\r\n    <div  class=\"postbox gdrgrid frontleft\" >\r\n<h3 class=\"hndle\" ><span>WordPress Exit Box</span></h3>\r\n<div class=\"inside\">\r\n<div class=\"table\">\r\n<table><tr class=\"first\" ><td>\r\n<h4>Love Exit Box Lite? wait until you see the full version. it is now available with all these cool features:</h4>\r\n<ul style=\"color: #444444;\r\nfont: normal normal 400 13px/19px Tahoma;\r\n\r\nlist-style: square;\r\nmargin: 0px 0px 2px;\r\n\r\npadding: 0px 0px 0px 8px;\r\ntext-align: left; \">\r\n    <li>Design your Exit Box, or paste  HTML  from any source.</li>\r\n    <li>Pick your redirection method. Auto, count down timer, or a clickable static link.</li>\r\n    <li>Select your Box, use Wordpress&#8217;s bundled ThickBox, or go for a FancyBox or a ColorBox.</li>\r\n    <li>Customizable redirection delay</li>\r\n    <li>Exclude selected posts or pages, useful for sales pages.</li>\r\n    <li>Exclude any website or link, enter a list of URLs that will not be pass through your Exit Box.</li>\r\n    <li>Shortcodes for Facebook , Google+,  Tweet, and Follow buttons, for your post or entire site.</li>\r\n    <li>Share&#38;Pass! with this new feature, your visitors can skip the waiting time by clicking one of the social buttons, +1, Like, Tweet, or Follow</li>\r\n    <li>Only process links in post contents, or process every external link in WordPress.</li>\r\n    <li>Falls back to a standalone Exit Page if your visitor opens the external link in a new page.</li>\r\n</ul>\r\n<div style=\"text-align:center;font: normal normal 400 15px/19px Tahoma\"><a  href=\"http://codecanyon.net/item/wordpress-exit-box/2291033?ref=angrybyte\">Interested? learn more about WordPress Exit Box here!<br /><img title=\"Check some of the many cool thing you can do with Exit Box\" style=\"width:100%;align:center\" src=\"https://dl.dropbox.com/u/7048593/exitbox.png\" /></a></div>\r\n</td></tr></table></div></div>\r\n</tr></table>\r\nEOFT;\r\n}\r\nfunction boxautoredirect()\r\n{\r\n    global $post;\r\n    global $wp_query;\r\n\r\n    if (isset($wp_query->query_vars['xb']))\r\n    {\r\n        $d = get_option(\"exitboxcontents\");\r\n        $d = stripslashes($d);\r\n        $d = replacelinks($d);\r\n\r\n        $ender = exitboxes(\"close\");\r\n        $d = str_replace(\"<a \", '<a rel=\"nofollow\" onclick=\"cleanupbox()\" ', $d);\r\n\r\n\r\n        echo \"</head><body   >\r\n<div align='center' style='vertical-align: middle;'>\r\n<table  cellspacing='0' cellpadding='0 ' style='vertical-align: middle;width:auto;'>\r\n<tbody>\r\n<tr style='vertical-align: middle;'>\r\n<td valign='top' align='left' style='vertical-align: middle;'>$d</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n</div><div style='text-align:center'><a href='http://codecanyon.net/item/wordpress-exit-box/2291033?ref=angrybyte'>Get WordPress Exit Box Plugin for your website!</a></div></body></html>\";\r\n\r\n        die(); //mama I just shot a man down\r\n    }\r\n\r\n\r\n}\r\n\r\nfunction replacelinks($content)\r\n{\r\n    global $post;\r\n    global $wp_query;\r\n    $pageurl = get_permalink($post->ID);\r\n\r\n    if (isset($wp_query->query_vars['xb']))\r\n    {\r\n\r\n        $pageurl = get_permalink($post->ID);\r\n\r\n        $myurl = get_option('siteurl');\r\n\r\n        $url = $wp_query->query_vars['xb'];\r\n        $url = urldecode($url);\r\n\r\n        //block possible code injection attempts\r\n        $m2 = strpos(\" \" . $url, \"<\");\r\n        $m3 = strpos(\" \" . $url, \"$\");\r\n        $m4 = strpos(\" \" . $url, \"'\");\r\n        $m5 = strpos(\" \" . $url, '\"');\r\n\r\n        if ($m2 || $m3 || $m4 || $m5)\r\n        {\r\n            return $content;\r\n            //someone is trying to inject a code, return contents without modifications\r\n        }\r\n        $url = sanitize_text_field($url); //added security\r\n        $d = get_option(\"exitboxcontents\");\r\n        $c = 15;\r\n        $cc = $c * 1000;\r\n        $autoredirfun = \"var t=setTimeout(\\\"parent.location ='$url';\\\",$cc);\";\r\n        $reditrectit = 'boxskipit = -1;';\r\n        $stopredirect = 'boxskipit = -1;';\r\n        if (get_option('boxautoredirect'))\r\n        {\r\n            $reditrectit = \"window.open('$url');\";\r\n            $stopredirect = \"clearTimeout(t);\";\r\n        }\r\n        $mess = addslashes(get_option(\"boxcountmessage\"));\r\n        $mypath = get_option('siteurl') . '/wp-content/plugins/' . plugin_basename(dirname\r\n            (__file__));\r\n\r\n\r\n        $ender = exitboxes(\"close\");\r\n\r\n        $counter = <<< EOTX\r\n     <script language=\"JavaScript\">\r\ngsecs = $c;\r\nCountActive = true;\r\nCountStepper = -1;\r\nLeadingZero = true;\r\nDisplayFormat = \"%%S%%\";\r\nFinishMessage = '$mess';\r\n$autoredirfun\r\njQuery(document).ready(function(){\r\n    \r\n    jQuery(window).bind('tb_unload',function() {    cleanupbox();})\r\n});\r\nfunction cleanupbox(){\r\n    $stopredirect\r\n    $ender;\r\n}\r\nfunction plusClick(data){\r\n    $reditrectit\r\n}\r\n</script>\r\n  \r\nEOTX;\r\n\r\n        $d = $counter . str_ireplace(\"%n%\", $c, $d);\r\n\r\n        $d = str_ireplace(\"%link%\", $url, $d);\r\n\r\n        $content = stripcslashes($d);\r\n\r\n        return $content;\r\n\r\n\r\n    }\r\n    $content = widgetreplacelinks($content);\r\n\r\n    return $content;\r\n}\r\n\r\nfunction widgetreplacelinks($content)\r\n{\r\n    global $wp_query;\r\n    preg_match_all('/<a\\s[^>]*href\\s*=\\s*([\\\"\\']??)([^\\\" >]*?)\\\\1[^>]*>(.*)(?!<\\/a>)/siU',\r\n        $content, $matches);\r\n    $matches = $matches[0];\r\n    global $post;\r\n    $pageurl = get_permalink($post->ID);\r\n    $myurl = get_option('siteurl');\r\n    $serv = $_SERVER['PHP_SELF'];\r\n    foreach ($matches as $match)\r\n    {\r\n        $qref = strpos($match, $myurl);\r\n        $qref2 = strpos($match, \"http\");\r\n\r\n\r\n        if (($qref == '') && ($qref2 != ''))\r\n        {\r\n            preg_match_all('#\\bhttps?://[^\\s()<>]+(?:\\([\\w\\d]+\\)|([^[:punct:]\\s]|/))#', $match,\r\n                $xurl);\r\n            $xurl = $xurl[0][0];\r\n            $exitboxvals = exitboxes(\"link\");\r\n            if (strpos($myurl, \"?\"))\r\n            {\r\n\r\n                $xurl2 = $myurl . \"&xb=\" . urlencode($xurl) . $exitboxvals['href'];\r\n\r\n            } else\r\n            {\r\n                $xurl2 = $myurl . \"?xb=\" . urlencode($xurl) . $exitboxvals['href'];\r\n\r\n            }\r\n            $newlink = str_replace($xurl, $xurl2, $match);\r\n            \r\n            $newlink = str_replace(\"<a \", \"<a {$exitboxvals['tag']} \", $newlink);\r\n            if (!strpos($newlink, \"nofollow\"))\r\n            {\r\n                $newlink = str_replace(\"<a \", '<a rel=\"nofollow\" ', $newlink);\r\n            }\r\n            $content = str_ireplace($match, $newlink, $content);\r\n        }\r\n    }\r\n\r\n    return $content;\r\n}\r\n\r\n?>"], "fixing_code": ["<?php\r\n\r\n/**\r\n * @package Wordpress Exit Box Lite\r\n * @author Bouzid Nazim Zitouni\r\n * @version 1.10\r\n */\r\n/*\r\nPlugin Name: Wordpress Exit Box Lite\r\nPlugin URI: http://angrybyte.com/wordpress-plugins/wordpress-exit-box-finally-released/\r\nDescription: Wordpress exit box is used design and display your exit box, a ThickBox page that will be shown to your users when they click a external link.\r\nAuthor: Bouzid Nazim Zitouni\r\nVersion: 1.10\r\nAuthor URI: http://angrybyte.com\r\n*/\r\n\r\nif(!function_exists('add_action')){\r\n    echo \"\"; // someone is trying to run the plugin directly, added to avoid full path disclosure.\r\n    die;\r\n}\r\nadd_option(\"exitboxcontents\",\r\n    '<h2 style=\"text-align: center;\">It was nice having you! We hope you enjoyed your stay.</h2>',\r\n    'Contents of the Exit page', 'yes');\r\nadd_option(\"exitboxdelay\", '15', 'yes');\r\nadd_option(\"boxautoredirect\", '0', 'yes');\r\n\r\nadd_option(\"exitboxwidth\", '630', 'yes'); //just needed with thickbox\r\nadd_option(\"exitboxheight\", '440', 'yes'); //just needed with thickbox\r\n\r\nadd_filter('the_content', 'widgetreplacelinks');\r\nadd_action('wp_head', 'boxautoredirect');\r\nadd_action('admin_menu', 'exitboxadmin');\r\nadd_filter('query_vars', 'xtbx_queryvars');\r\n\r\nfunction exitboxes($what)\r\n{\r\n\r\n    $mypath = get_option('siteurl') . '/wp-content/plugins/' . plugin_basename(dirname\r\n        (__file__));\r\n    if ($what == 'list')\r\n    {\r\n        return array('thickbox');\r\n    }\r\n    if ($what == 'init')\r\n    {\r\n        if (!is_admin())\r\n        {\r\n\r\n            wp_enqueue_script('jquery');\r\n            wp_enqueue_script('thickbox', null, array('jquery'));\r\n            wp_enqueue_style('thickbox.css', '/' . WPINC . '/js/thickbox/thickbox.css', null,\r\n                '1.0');\r\n            return 1;\r\n\r\n\r\n        }\r\n    }\r\n    if ($what == 'link')\r\n    {\r\n        $exitboxwidth = get_option(\"exitboxwidth\");\r\n        $exitboxheight = get_option(\"exitboxheight\");\r\n\r\n        return array(\"href\" => \"&keepThis=true&width=$exitboxwidth&height=$exitboxheight\",\r\n            \"tag\" => 'class=\"thickbox\"');\r\n\r\n    }\r\n    if ($what == 'close')\r\n    {\r\n\r\n        return \"tb_remove()\";\r\n    }\r\n\r\n}\r\nfunction add_thickscript()\r\n{\r\n    exitboxes('init');\r\n}\r\nadd_action('init', 'add_thickscript');\r\nfunction xtbx_queryvars($qvars)\r\n{\r\n    $qvars[] = 'xb';\r\n\r\n    return $qvars;\r\n}\r\n\r\nfunction exitboxadmin()\r\n{\r\n\r\n    add_options_page('Wordpress Exit Box Lite', 'Wordpress Exit Box Lite', 8,\r\n        __file__, 'exit_box_admin');\r\n}\r\nfunction exit_box_admin()\r\n{\r\n     if (($_POST[\"xx\"])&& (is_admin())&& check_admin_referer( 'exit_box_save', 'exit_box_nonce' ))\r\n    {\r\n\r\n        if (is_numeric($_POST['exitboxwidth']) || $_POST['exitboxwidth'] == \"auto\")\r\n            update_option('exitboxwidth', $_POST['exitboxwidth']);\r\n        if (is_numeric($_POST['exitboxheight']) || $_POST['exitboxheight'] == \"auto\")\r\n            update_option('exitboxheight', $_POST['exitboxheight']);\r\n\r\n        update_option('exitboxcontents', stripslashes($_POST['xx']));\r\n\r\n\r\n    }\r\n    $oldtemp = stripcslashes(get_option(\"exitboxcontents\"));\r\n    $exitboxwidth = get_option(\"exitboxwidth\");\r\n    $exitboxheight = get_option(\"exitboxheight\");\r\n\r\n    echo <<< EOFT\r\n    <h1> Wordpress Exit Box Lite</h1>\r\n    <table ><tr><td >\r\n    <div class=\"metabox-holder\" />\r\n    <div  class=\"postbox gdrgrid frontleft\">\r\n<h3 class=\"hndle\">\r\n<span>Exit Box Options</span>\r\n</h3>\r\n<div class=\"inside\">\r\n<div class=\"table\">\r\n<table>\r\n<tbody>\r\n<tr class=\"first\">\r\n<td class=\"first b\"><strong>Exit Box Design</strong></td>\r\n<td class=\"t options\"><Form method ='post' action='' ><input type='hidden' value='fit' name='fit' id='fit' />\r\nEOFT;\r\n    if (function_exists(wp_editor))\r\n    {\r\n        wp_editor($oldtemp, \"xx\", array('wpautop' => false, 'tabindex' => 1));\r\n\r\n    } else\r\n    {\r\n        echo \"<textarea name='xx' cols='150' rows='20'>$oldtemp</textarea>\";\r\n    }\r\n    wp_nonce_field( 'exit_box_save','exit_box_nonce' ); \r\n    echo <<< EOFT\r\n\r\n  <br/>\r\n  <br/>\r\n  <table><tbody>\r\n  <tr><td><strong>Shortcode</strong></td><td><strong>Used to insert:</strong></td></tr>\r\n  <tr><td><b>%n% </b></td><td>The Redirection Delay.</td></tr>\r\n  <tr><td><b>%link% </b></td><td>The Redirection URL.</td></tr>\r\n  <tr><td><strong><strike>%count%</strike> </strong></td><td>     <font color=\"#BFBDBD\">Redirection Count Down.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%site+1%</strike> </strong></td><td>  <font color=\"#BFBDBD\"> Google +1 Button For Your Site. (Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%post+1% </strike></strong></td><td>  <font color=\"#BFBDBD\"> Google +1 Button  For Your Post.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%sitelike%</strike> </strong></td><td> <font color=\"#BFBDBD\">Facebook Like Button for your site.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%postlike%</strike> </strong></td><td> <font color=\"#BFBDBD\">Facebook Like Button for your post.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%sitetweet%</strike></strong></td><td> <font color=\"#BFBDBD\">Twitter Button For Your Site.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%posttweet%</strike></strong></td><td> <font color=\"#BFBDBD\">Twitter Button For Your Post.(Not included in Lite version)</font></td></tr>\r\n<tr><td><strong><strike>%follow%</strike></strong></td><td>    <font color=\"#BFBDBD\">Twitter Follow Button.(Not included in Lite version)</font></td></tr>\r\n</tbody></table>\r\n  \r\n\r\n<br />HTML and javascript are allowed<br />\r\n \r\n</tr>\r\n<tr>\r\n<td class=\"first b\"><strong>Redirection delay </strong></td><td class=\"t options\"><input type=\"text\" name='delay' disabled=\"disabled\" value='15' />in seconds (not editable in Lite)</td></tr><tr>\r\n<td> <strong> Auto Redirection.</strong></td><td class=\"t options\"><input type='checkbox' disabled=\"disabled\" value='1' $chkd name='boxautoredirect' /> Enable auto redirection after the end of the delay (Not optional in Lite version)</td></tr><tr>\r\n<tr><td>\r\n<strong>Exit Box Type.</strong></td><td class=\"t options\"><select name='exitboxtype' size=\"1\" style=\"width:120px\">\r\n    <option value='thickbox' >thickbox</option>(ColorBox, FancyBox, and Thickbox in full version)\r\n</select><br /> The width of your Exit Box, configure this based on the width of your exit box design. Default:630</td></tr>\r\n<tr><td>\r\n<strong>Exit Box Width.</strong></td><td class=\"t options\"><input type=\"text\" size='100' name='exitboxwidth' value='$exitboxwidth' /><br /> The width of your Exit Box, configure this based on the width of your exit box design. Default:630 (Only  ThickBox)</td></tr>\r\n<tr><td>\r\n\r\n<strong>Exit Box Height.</strong></td><td class=\"t options\"><input type=\"text\" size='100' name='exitboxheight' value='$exitboxheight' /><br /> The height of your Exit Box, configure this based on the height of your exit box design. Default:440 (Only needed when using ThickBox)</td></tr><tr><td>\r\n<strong>Open links in a new window</strong></td><td class=\"t options\"><input type='checkbox' disabled=\"disabled\" value='0'  name='exitboxnewwindow' /> Clicking the external link inside the exit box will open the link in a new page. (Not available in Lite)</td></tr><tr><td>\r\n <strong>Process entire pages</strong></td><td class=\"t options\"><input type='checkbox' disabled=\"disabled\" value='0'  name='boxprocesswholepages' /> redirect links in the entire page including widgets and footer, or just the post contents. (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<strong>End of count Message.</strong></td><td class=\"t options\"><input type=\"text\" size='100' disabled=\"disabled\" name='eoc' value='' /><br /> Display this message when the %count% counter runs out (HTML allowed , can include %link%) Generally &#60;a href=\"%link%\"&#62;Click here to continue&#60;/a&#62; (Not available in Lite)</td></tr><tr><td>\r\n<strong>Excluded pages.</strong></td><td class=\"t options\"><input type=\"text\" size='100' disabled=\"disabled\" name='excl' value='' /><br /> enter to post IDs to be excluded from your exit page, useful for your sales or affiliate pages. Separate by commas ex: 3,55,153 (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<strong>Twitter account.</strong></td><td class=\"t options\">@<input type=\"text\" size='100' disabled=\"disabled\" name='twitterboxname' value='' /><br /> This will be used with the Twitter follow button shortcode %follow% </td></tr>\r\n<tr><td>\r\n<strong>Facebook App Id.</strong></td><td class=\"t options\"><input type=\"text\" size='100' disabled=\"disabled\" name='facebookappid' value='' /><br /> If you dont have one for your website, <a href=\"https://developers.facebook.com/apps/\">get one here</a>. If you keep this blank, your facebook like buttons will fallback to iframe mode, which is not compatible with the Share&Pass feature (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<strong>Enable Share&Pass.</strong></td><td class=\"t options\"><input type='checkbox' disabled=\"disabled\" value='1'  name='socialpass' /> Skip the waiting timer when the user clicks the social sharing buttons (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<strong>Excluded Links</strong>.</td><td class=\"t options\"><textarea name='exitboxexcludedlinks' disabled=\"disabled\" cols='100' rows='20'></textarea><br /> Enter the links you wish to exclude from your exit strategy. each link is a separate line. Excluding a website will exclude all pages within it, and excluding a page will not exclude the rest of the website. (Not available in Lite)</td></tr>\r\n<tr><td>\r\n<input type='submit' value='save' /></form></td></tr>\r\n</tbody>\r\n</table>\r\n</div></div>\r\n</div></td><td VALIGN=\"TOP\">\r\n <div class=\"metabox-holder\" />\r\n    <div  class=\"postbox gdrgrid frontleft\" >\r\n<h3 class=\"hndle\" ><span>WordPress Exit Box</span></h3>\r\n<div class=\"inside\">\r\n<div class=\"table\">\r\n<table><tr class=\"first\" ><td>\r\n<h4>Love Exit Box Lite? wait until you see the full version. it is now available with all these cool features:</h4>\r\n<ul style=\"color: #444444;\r\nfont: normal normal 400 13px/19px Tahoma;\r\n\r\nlist-style: square;\r\nmargin: 0px 0px 2px;\r\n\r\npadding: 0px 0px 0px 8px;\r\ntext-align: left; \">\r\n    <li>Design your Exit Box, or paste  HTML  from any source.</li>\r\n    <li>Pick your redirection method. Auto, count down timer, or a clickable static link.</li>\r\n    <li>Select your Box, use Wordpress&#8217;s bundled ThickBox, or go for a FancyBox or a ColorBox.</li>\r\n    <li>Customizable redirection delay</li>\r\n    <li>Exclude selected posts or pages, useful for sales pages.</li>\r\n    <li>Exclude any website or link, enter a list of URLs that will not be pass through your Exit Box.</li>\r\n    <li>Shortcodes for Facebook , Google+,  Tweet, and Follow buttons, for your post or entire site.</li>\r\n    <li>Share&#38;Pass! with this new feature, your visitors can skip the waiting time by clicking one of the social buttons, +1, Like, Tweet, or Follow</li>\r\n    <li>Only process links in post contents, or process every external link in WordPress.</li>\r\n    <li>Falls back to a standalone Exit Page if your visitor opens the external link in a new page.</li>\r\n</ul>\r\n<div style=\"text-align:center;font: normal normal 400 15px/19px Tahoma\"><a  href=\"http://codecanyon.net/item/wordpress-exit-box/2291033?ref=angrybyte\">Interested? learn more about WordPress Exit Box here!<br /><img title=\"Check some of the many cool thing you can do with Exit Box\" style=\"width:100%;align:center\" src=\"https://dl.dropbox.com/u/7048593/exitbox.png\" /></a></div>\r\n</td></tr></table></div></div>\r\n</tr></table>\r\nEOFT;\r\n}\r\nfunction boxautoredirect()\r\n{\r\n    global $post;\r\n    global $wp_query;\r\n\r\n    if (isset($wp_query->query_vars['xb']))\r\n    {\r\n        $d = get_option(\"exitboxcontents\");\r\n        $d = stripslashes($d);\r\n        $d = replacelinks($d);\r\n\r\n        $ender = exitboxes(\"close\");\r\n        $d = str_replace(\"<a \", '<a rel=\"nofollow\" onclick=\"cleanupbox()\" ', $d);\r\n\r\n\r\n        echo \"</head><body   >\r\n<div align='center' style='vertical-align: middle;'>\r\n<table  cellspacing='0' cellpadding='0 ' style='vertical-align: middle;width:auto;'>\r\n<tbody>\r\n<tr style='vertical-align: middle;'>\r\n<td valign='top' align='left' style='vertical-align: middle;'>$d</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n</div><div style='text-align:center'><a href='http://codecanyon.net/item/wordpress-exit-box/2291033?ref=angrybyte'>Get WordPress Exit Box Plugin for your website!</a></div></body></html>\";\r\n\r\n        die(); //mama I just shot a man down\r\n    }\r\n\r\n\r\n}\r\n\r\nfunction replacelinks($content)\r\n{\r\n    global $post;\r\n    global $wp_query;\r\n    $pageurl = get_permalink($post->ID);\r\n\r\n    if (isset($wp_query->query_vars['xb']))\r\n    {\r\n\r\n        $pageurl = get_permalink($post->ID);\r\n\r\n        $myurl = get_option('siteurl');\r\n\r\n        $url = $wp_query->query_vars['xb'];\r\n        $url = urldecode($url);\r\n\r\n        //block possible code injection attempts\r\n        $m2 = strpos(\" \" . $url, \"<\");\r\n        $m3 = strpos(\" \" . $url, \"$\");\r\n        $m4 = strpos(\" \" . $url, \"'\");\r\n        $m5 = strpos(\" \" . $url, '\"');\r\n\r\n        if ($m2 || $m3 || $m4 || $m5)\r\n        {\r\n            return $content;\r\n            //someone is trying to inject a code, return contents without modifications\r\n        }\r\n        $url = sanitize_text_field($url); //added security\r\n        $d = get_option(\"exitboxcontents\");\r\n        $c = 15;\r\n        $cc = $c * 1000;\r\n        $autoredirfun = \"var t=setTimeout(\\\"parent.location ='$url';\\\",$cc);\";\r\n        $reditrectit = 'boxskipit = -1;';\r\n        $stopredirect = 'boxskipit = -1;';\r\n        if (get_option('boxautoredirect'))\r\n        {\r\n            $reditrectit = \"window.open('$url');\";\r\n            $stopredirect = \"clearTimeout(t);\";\r\n        }\r\n        $mess = addslashes(get_option(\"boxcountmessage\"));\r\n        $mypath = get_option('siteurl') . '/wp-content/plugins/' . plugin_basename(dirname\r\n            (__file__));\r\n\r\n\r\n        $ender = exitboxes(\"close\");\r\n\r\n        $counter = <<< EOTX\r\n     <script language=\"JavaScript\">\r\ngsecs = $c;\r\nCountActive = true;\r\nCountStepper = -1;\r\nLeadingZero = true;\r\nDisplayFormat = \"%%S%%\";\r\nFinishMessage = '$mess';\r\n$autoredirfun\r\njQuery(document).ready(function(){\r\n    \r\n    jQuery(window).bind('tb_unload',function() {    cleanupbox();})\r\n});\r\nfunction cleanupbox(){\r\n    $stopredirect\r\n    $ender;\r\n}\r\nfunction plusClick(data){\r\n    $reditrectit\r\n}\r\n</script>\r\n  \r\nEOTX;\r\n\r\n        $d = $counter . str_ireplace(\"%n%\", $c, $d);\r\n\r\n        $d = str_ireplace(\"%link%\", $url, $d);\r\n\r\n        $content = stripcslashes($d);\r\n\r\n        return $content;\r\n\r\n\r\n    }\r\n    $content = widgetreplacelinks($content);\r\n\r\n    return $content;\r\n}\r\n\r\nfunction widgetreplacelinks($content)\r\n{\r\n    global $wp_query;\r\n    preg_match_all('/<a\\s[^>]*href\\s*=\\s*([\\\"\\']??)([^\\\" >]*?)\\\\1[^>]*>(.*)(?!<\\/a>)/siU',\r\n        $content, $matches);\r\n    $matches = $matches[0];\r\n    global $post;\r\n    $pageurl = get_permalink($post->ID);\r\n    $myurl = get_option('siteurl');\r\n    $serv = $_SERVER['PHP_SELF'];\r\n    foreach ($matches as $match)\r\n    {\r\n        $qref = strpos($match, $myurl);\r\n        $qref2 = strpos($match, \"http\");\r\n\r\n\r\n        if (($qref == '') && ($qref2 != ''))\r\n        {\r\n            preg_match_all('#\\bhttps?://[^\\s()<>]+(?:\\([\\w\\d]+\\)|([^[:punct:]\\s]|/))#', $match,\r\n                $xurl);\r\n            $xurl = $xurl[0][0];\r\n            $exitboxvals = exitboxes(\"link\");\r\n            if (strpos($myurl, \"?\"))\r\n            {\r\n\r\n                $xurl2 = $myurl . \"&xb=\" . urlencode($xurl) . $exitboxvals['href'];\r\n\r\n            } else\r\n            {\r\n                $xurl2 = $myurl . \"?xb=\" . urlencode($xurl) . $exitboxvals['href'];\r\n\r\n            }\r\n            $newlink = str_replace($xurl, $xurl2, $match);\r\n            \r\n            $newlink = str_replace(\"<a \", \"<a {$exitboxvals['tag']} \", $newlink);\r\n            if (!strpos($newlink, \"nofollow\"))\r\n            {\r\n                $newlink = str_replace(\"<a \", '<a rel=\"nofollow\" ', $newlink);\r\n            }\r\n            $content = str_ireplace($match, $newlink, $content);\r\n        }\r\n    }\r\n\r\n    return $content;\r\n}\r\n\r\n?>"], "filenames": ["wordpress-exit-box-lite.php"], "buggy_code_start_loc": [6], "buggy_code_end_loc": [133], "fixing_code_start_loc": [6], "fixing_code_end_loc": [135], "type": "CWE-200", "message": "A vulnerability, which was classified as problematic, has been found in Exit Box Lite Plugin up to 1.06 on WordPress. Affected by this issue is some unknown functionality of the file wordpress-exit-box-lite.php. The manipulation leads to information disclosure. The attack may be launched remotely. Upgrading to version 1.10 is able to address this issue. The name of the patch is fad26701addb862c51baf85c6e3cc136aa79c309. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-230672.", "other": {"cve": {"id": "CVE-2013-10030", "sourceIdentifier": "cna@vuldb.com", "published": "2023-06-05T22:15:09.260", "lastModified": "2024-02-29T01:13:24.997", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, has been found in Exit Box Lite Plugin up to 1.06 on WordPress. Affected by this issue is some unknown functionality of the file wordpress-exit-box-lite.php. The manipulation leads to information disclosure. The attack may be launched remotely. Upgrading to version 1.10 is able to address this issue. The name of the patch is fad26701addb862c51baf85c6e3cc136aa79c309. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-230672."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:N/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-200"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:angrybyte:wordpress_exit_box_lite:*:*:*:*:*:wordpress:*:*", "versionEndIncluding": "1.06", "matchCriteriaId": "507831C8-49B6-4792-AEE9-17F1E9E9FC8A"}]}]}], "references": [{"url": "https://github.com/wp-plugins/wordpress-exit-box-lite/commit/fad26701addb862c51baf85c6e3cc136aa79c309", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://vuldb.com/?ctiid.230672", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.230672", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/wp-plugins/wordpress-exit-box-lite/commit/fad26701addb862c51baf85c6e3cc136aa79c309"}}