{"buggy_code": ["<%--\n/*******************************************************************************\n * This file is part of OpenNMS(R).\n *\n * Copyright (C) 2002-2014 The OpenNMS Group, Inc.\n * OpenNMS(R) is Copyright (C) 1999-2014 The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published\n * by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * OpenNMS(R) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with OpenNMS(R).  If not, see:\n *      http://www.gnu.org/licenses/\n *\n * For more information contact:\n *     OpenNMS(R) Licensing <license@opennms.org>\n *     http://www.opennms.org/\n *     http://www.opennms.com/\n *******************************************************************************/\n\n--%>\n\n<%@page language=\"java\"\n\tcontentType=\"text/html\"\n\tsession=\"true\"\n\timport=\"org.opennms.web.admin.notification.noticeWizard.*\"\n%>\n<%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\"%>\n<%@ taglib uri=\"http://java.sun.com/jsp/jstl/functions\" prefix=\"fn\"%>\n\n<jsp:include page=\"/includes/bootstrap.jsp\" flush=\"false\" >\n  <jsp:param name=\"title\" value=\"Event Notifications\" />\n  <jsp:param name=\"headTitle\" value=\"Event Notifications\" />\n  <jsp:param name=\"headTitle\" value=\"Admin\" />\n  <jsp:param name=\"breadcrumb\" value=\"<a href='admin/index.jsp'>Admin</a>\" />\n  <jsp:param name=\"breadcrumb\" value=\"<a href='admin/notification/index.jsp'>Configure Notifications</a>\" />\n  <jsp:param name=\"breadcrumb\" value=\"Event Notifications\" />\n</jsp:include>\n\n<script type=\"text/javascript\" >\n\n    function editNotice(name)\n    {\n        document.notices.userAction.value=\"edit\";\n        document.notices.notice.value=name;\n        document.notices.submit();\n    }\n    \n    function deleteNotice(name)\n    {\n        if (confirm(\"Are you sure you want to delete the notification \" + name + \"?\"))\n        {\n          document.notices.userAction.value=\"delete\";\n          document.notices.notice.value=name;\n          document.notices.submit();\n        }\n    }\n    \n    function setStatus(name, status)\n    {\n        document.notices.userAction.value=status;\n        document.notices.notice.value=name;\n        document.notices.submit();\n    }\n    \n    function newNotice()\n    {\n        document.notices.userAction.value=\"new\";\n        document.notices.submit();\n    }\n    \n</script>\n\n<form method=\"post\" name=\"notices\" action=\"admin/notification/noticeWizard/notificationWizard\">\n<input type=\"hidden\" name=\"userAction\" value=\"\"/>\n<input type=\"hidden\" name=\"notice\" value=\"\"/>\n<input type=\"hidden\" name=\"sourcePage\" value=\"<%=NotificationWizardServlet.SOURCE_PAGE_NOTICES%>\"/>\n\n<div class=\"card\">\n  <div class=\"card-header\">\n    <h4 class=\"pull-left\">Event Notifications</h4>\n    <button class=\"pull-right btn btn-secondary\" onclick=\"javascript:newNotice()\"><i class=\"fa fa-plus\"></i> Add New Event Notification</button>\n  </div>\n  <div class=\"card-body\">\n        <table class=\"table table-sm table-striped\">\n          <tr>\n            <th colspan=\"3\">\n              Actions\n            </th>\n            <th>\n              Notification\n            </th>\n            <th>\n              Event\n            </th>\n            <th>\n              UEI\n            </th>\n          </tr>\n          <c:forEach items=\"${notifications}\" var=\"notification\">\n          <tr>\n            <td>\n              <input type=\"button\" class=\"btn btn-secondary\" value=\"Edit\" onclick=\"javascript:editNotice('${notification.escapedName}')\"/>\n            </td>\n            <td>\n              <input type=\"button\" class=\"btn btn-secondary\" value=\"Delete\"  onclick=\"javascript:deleteNotice('${notification.escapedName}')\"/>\n            </td>\n            <td>\n            <c:choose>\n              <c:when test=\"${notification.isOn}\">\n                <input type=\"radio\" value=\"Off\" onclick=\"javascript:setStatus('${notification.escapedName}','off')\"/>Off\n                <input type=\"radio\" value=\"On\" CHECKED onclick=\"javascript:setStatus('${notification.escapedName}','on')\"/>On\n              </c:when>\n              <c:otherwise>\n                <input type=\"radio\" value=\"Off\" CHECKED onclick=\"javascript:setStatus('${notification.escapedName}','off')\"/>Off\n                <input type=\"radio\" value=\"On\" onclick=\"javascript:setStatus('${notification.escapedName}','on')\"/>On\n              </c:otherwise>\n            </c:choose>\n            </td>\n            <td>\n              ${notification.name}\n            </td>\n            <td>\n              ${notification.eventLabel}\n            </td>\n            <td>\n              ${notification.displayUei}\n            </td>\n          </tr>\n          </c:forEach>\n        </table>\n  </div>\n</div> <!-- card -->\n\n</form>\n\n<jsp:include page=\"/includes/bootstrap-footer.jsp\" flush=\"false\" />\n", "<%--\n/*******************************************************************************\n * This file is part of OpenNMS(R).\n *\n * Copyright (C) 2002-2017 The OpenNMS Group, Inc.\n * OpenNMS(R) is Copyright (C) 1999-2017 The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published\n * by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * OpenNMS(R) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with OpenNMS(R).  If not, see:\n *      http://www.gnu.org/licenses/\n *\n * For more information contact:\n *     OpenNMS(R) Licensing <license@opennms.org>\n *     http://www.opennms.org/\n *     http://www.opennms.com/\n *******************************************************************************/\n\n--%>\n\n<%@page language=\"java\"\n\tcontentType=\"text/html\"\n\tsession=\"true\"\n\timport=\"java.util.*,\n\t\torg.opennms.web.admin.notification.noticeWizard.*,\n\t\torg.opennms.netmgt.config.notifications.*,\n        org.opennms.netmgt.config.destinationPaths.*,\n\t\torg.opennms.netmgt.config.*\n\t\"\n%>\n\n<%!\n    public void init() throws ServletException {\n        try {\n            DestinationPathFactory.init();\n        }\n        catch( Exception e ) {\n            throw new ServletException( \"Cannot load configuration file\", e );\n        }\n    }\n%>\n\n<%\n    HttpSession user = request.getSession(true);\n    Notification newNotice = (Notification)user.getAttribute(\"newNotice\");\n    Varbind varbind=newNotice.getVarbind();\n    String varbindName=\"\";\n    String varbindValue=\"\";\n    if(varbind!=null) {\n        \n        if(varbind.getVbname()!=null) {\n            varbindName=varbind.getVbname();\n\t\t}\n        if(varbind.getVbvalue()!=null) {\n         \tvarbindValue=varbind.getVbvalue();\n        }\n    }\n%>\n\n<jsp:include page=\"/includes/bootstrap.jsp\" flush=\"false\" >\n  <jsp:param name=\"title\" value=\"Choose Path\" />\n  <jsp:param name=\"headTitle\" value=\"Choose Path\" />\n  <jsp:param name=\"headTitle\" value=\"Admin\" />\n  <jsp:param name=\"breadcrumb\" value=\"<a href='admin/index.jsp'>Admin</a>\" />\n  <jsp:param name=\"breadcrumb\" value=\"<a href='admin/notification/index.jsp'>Configure Notifications</a>\" />\n  <jsp:param name=\"breadcrumb\" value=\"Choose Path\" />\n</jsp:include>\n\n<script type=\"text/javascript\" >\n  \n    function trimString(str) \n    {\n        while (str.charAt(0)==\" \")\n        {\n          str = str.substring(1);\n        }\n        while (str.charAt(str.length - 1)==\" \")\n        {\n          str = str.substring(0, str.length - 1);\n        }\n        return str;\n    }\n    \n    function finish()\n    {\n        trimmedName = trimString(document.info.name.value);\n        trimmedText = trimString(document.info.textMsg.value);\n        if (trimmedName==\"\")\n        {\n            alert(\"Please give this notification a name.\");\n        }\n        else if (trimmedText==\"\")\n        {\n            alert(\"Please enter a text message for this notification.\");\n        }\n        else if (document.info.path.selectedIndex==-1)\n        {\n            alert(\"Please select a destination path for this notification.\");\n        }\n        else\n        {\n            document.info.submit();\n        }\n    }\n  \n</script>\n\n<h2><%=(newNotice.getName()!=null ? \"Editing notice: \" + newNotice.getName() + \"<br/>\" : \"\")%></h2>\n\n<form method=\"post\" name=\"info\"\n      action=\"admin/notification/noticeWizard/notificationWizard\">\n      <input type=\"hidden\" name=\"userAction\" value=\"\"/>\n      <input type=\"hidden\" name=\"sourcePage\" value=\"<%=NotificationWizardServlet.SOURCE_PAGE_PATH%>\"/>\n\n<div class=\"row\">\n  <div class=\"col-md-7\">\n    <div class=\"card\">\n      <div class=\"card-header\">\n        <span>Choose the destination path and enter the information to send via the notification</span>\n      </div>\n      <table class=\"table table-sm\">\n        <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Name:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <input type=\"text\" class=\"form-control\" name=\"name\" value='<%=(newNotice.getName()!=null ? newNotice.getName() : \"\")%>'/>\n          </td>\n        </tr>\n        <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Description:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <input type=\"text\" class=\"form-control\" name=\"description\" value='<%=newNotice.getDescription().orElse(\"\")%>'/>\n          </td>\n        </tr>\n        <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Parameter:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <div class=\"row\">\n              <div class=\"col-md-6\">\n                <label>Name:</label> <input type=\"text\" class=\"form-control\" size=\"30\" name=\"varbindName\" value='<%=varbindName%>'/>\n              </div>\n              <div class=\"col-md-6\">\n                <label>Value:</label> <input class=\"form-control\" type=\"text\" size=\"30\" name=\"varbindValue\" value='<%=varbindValue%>'/>\n              </div>\n            </div>\n          </td>\n        </tr>\n        <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Choose A Path:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <%=buildPathSelect(newNotice.getDestinationPath())%>\n          </td>\n         </tr>\n         <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Text Message:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <textarea rows=\"3\" class=\"form-control\" name=\"textMsg\"><%=(newNotice.getTextMessage()!=null ? newNotice.getTextMessage() : \"\")%></textarea>\n          </td>\n         </tr>\n         <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Short Message:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <textarea rows=\"1\" class=\"form-control\" name=\"numMsg\"><%=newNotice.getNumericMessage().orElse(\"\")%></textarea>\n          </td>\n         </tr>\n         <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Email Subject:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <input type=\"text\" class=\"form-control\" name=\"subject\" value='<%=newNotice.getSubject().orElse(\"\")%>'/>\n          </td>\n         </tr>\n         <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Special Values:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <table class=\"table table-sm\">\n              <tr>\n                <td colspan=\"3\">Can be used in both the text message and email subject:</td>\n              </tr>\n              <tr>\n                <td>%noticeid% = Notification ID number</td>\n                <td>%time% = Time sent</td>\n                <td>%severity% = Event severity</td>                          \n              </tr>\n              <tr>\n                <td>%nodelabel% = May be IP address or empty</td>\n                <td>%interface% = IP address, may be empty</td>\n                <td>%service% = Service name, may be empty</td>\n              </tr>\n              <tr>\n\t\t\t\t<td>%eventid% = Event ID, may be empty</td>\n\t\t\t\t<td>%parm[a_parm_name]% = Value of a named event parameter</td>\n\t\t\t\t<td>%parm[#N]% = Value of the event parameter at index N</td>\n\t\t\t  </tr>\n\t\t\t  <tr>\n\t\t\t    <td>%ifalias% = SNMP ifAlias of affected interface</td>\n\t\t\t    <td>%interfaceresolve% = Reverse DNS name of interface IP address</td>\n               <td>%operinstruct% = Operator instructions from event definition</td>\t\t     \n\t\t\t  </tr>\n            </table>\n          </td>\n         </tr>\n      </table>\n        <div class=\"card-footer\">\n              <a class=\"btn btn-secondary\" href=\"javascript:finish()\">Finish</a>\n        </div>\n    </div> <!-- panel -->\n  </div> <!-- column -->\n</div> <!-- row -->\n\n</form>\n\n<jsp:include page=\"/includes/bootstrap-footer.jsp\" flush=\"false\" />\n\n<%!\n    public String buildPathSelect(String currentPath)\n      throws ServletException\n    {\n         StringBuffer buffer = new StringBuffer(\"<select class=\\\"form-control custom-select\\\" NAME=\\\"path\\\">\");\n         \n         Map<String, Path> pathsMap = null;\n         \n         try {\n             pathsMap = new TreeMap<String, Path>(DestinationPathFactory.getInstance().getPaths());\n             for (String key : pathsMap.keySet()) {\n                 if (key.equals(currentPath))\n                 {\n                    buffer.append(\"<option SELECTED VALUE=\" + key + \">\" + key + \"</option>\");\n                 }\n                 else\n                 {\n                    buffer.append(\"<option VALUE=\" + key + \">\" + key + \"</option>\");\n                 }\n             }\n         } catch (Throwable e)\n         {\n            throw new ServletException(\"couldn't get destination path list.\", e);\n         }\n         buffer.append(\"</select>\");\n         \n         return buffer.toString();\n    }\n%>\n", "/*******************************************************************************\n * This file is part of OpenNMS(R).\n *\n * Copyright (C) 2011-2014 The OpenNMS Group, Inc.\n * OpenNMS(R) is Copyright (C) 1999-2014 The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published\n * by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * OpenNMS(R) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with OpenNMS(R).  If not, see:\n *      http://www.gnu.org/licenses/\n *\n * For more information contact:\n *     OpenNMS(R) Licensing <license@opennms.org>\n *     http://www.opennms.org/\n *     http://www.opennms.com/\n *******************************************************************************/\n\npackage org.opennms.smoketest;\n\nimport static org.junit.Assert.assertEquals;\n\nimport org.junit.Before;\nimport org.junit.FixMethodOrder;\nimport org.junit.Test;\nimport org.junit.runners.MethodSorters;\nimport org.openqa.selenium.By;\n\n@FixMethodOrder(MethodSorters.NAME_ASCENDING)\npublic class NotificationsPageIT extends OpenNMSSeleniumIT {\n    @Before\n    public void setUp() throws Exception {\n        notificationsPage();\n    }\n\n    @Test\n    public void testAllTextIsPresent() throws Exception {\n        assertEquals(3, countElementsMatchingCss(\"div.card-header\"));\n        findElementByXpath(\"//span[text()='Notification queries']\");\n        findElementByXpath(\"//span[text()='Outstanding and Acknowledged Notices']\");\n        findElementByXpath(\"//span[text()='Notification Escalation']\");\n    }\n\n    @Test\n    public void testAllLinksArePresent() {\n        findElementByLink(\"Your outstanding notices\");\n        findElementByLink(\"All outstanding notices\");\n        findElementByLink(\"All acknowledged notices\");\n    }\n\n    @Test\n    public void testAllFormsArePresent() {\n        findElementByXpath(\"//button[@id='btn_search_by_notice' and @type='submit']\");\n        findElementByXpath(\"//button[@id='btn_search_by_user' and @type='submit']\");\n    }\n\n    @Test\n    public void testAllLinks() {\n        findElementByLink(\"Your outstanding notices\").click();\n        findElementByXpath(\"//span[@class='label label-default' and contains(text(), 'admin was notified')]\");\n        findElementByLink(\"[Remove all]\");\n        findElementByLink(\"Sent Time\");\n        findElementByXpath(\"//button[@type='button' and text()='Acknowledge Notices']\");\n\n        notificationsPage();\n        findElementByLink(\"All outstanding notices\").click();\n        findElementByXpath(\"//p//strong[text()='outstanding']\");\n        findElementByLink(\"[Show acknowledged]\");\n        findElementByLink(\"Respond Time\");\n        assertElementDoesNotHaveText(By.xpath(\"//span[@class='label label-default']\"), \"admin was notified [-]\");\n\n        notificationsPage();\n        findElementByLink(\"All acknowledged notices\").click();\n        findElementByXpath(\"//p//strong[text()='acknowledged']\");\n        findElementByLink(\"[Show outstanding]\");\n        findElementByLink(\"Respond Time\");\n        assertElementDoesNotHaveText(By.xpath(\"//span[@class='label label-default']\"), \"admin was notified [-]\");\n    }\n\n}\n"], "fixing_code": ["<%--\n/*******************************************************************************\n * This file is part of OpenNMS(R).\n *\n * Copyright (C) 2002-2014 The OpenNMS Group, Inc.\n * OpenNMS(R) is Copyright (C) 1999-2014 The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published\n * by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * OpenNMS(R) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with OpenNMS(R).  If not, see:\n *      http://www.gnu.org/licenses/\n *\n * For more information contact:\n *     OpenNMS(R) Licensing <license@opennms.org>\n *     http://www.opennms.org/\n *     http://www.opennms.com/\n *******************************************************************************/\n\n--%>\n\n<%@page language=\"java\"\n\tcontentType=\"text/html\"\n\tsession=\"true\"\n\timport=\"org.opennms.web.admin.notification.noticeWizard.*\"\n%>\n<%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\"%>\n<%@ taglib uri=\"http://java.sun.com/jsp/jstl/functions\" prefix=\"fn\"%>\n<%@ taglib uri=\"https://www.owasp.org/index.php/OWASP_Java_Encoder_Project\" prefix=\"e\"%>\n\n<jsp:include page=\"/includes/bootstrap.jsp\" flush=\"false\" >\n  <jsp:param name=\"title\" value=\"Event Notifications\" />\n  <jsp:param name=\"headTitle\" value=\"Event Notifications\" />\n  <jsp:param name=\"headTitle\" value=\"Admin\" />\n  <jsp:param name=\"breadcrumb\" value=\"<a href='admin/index.jsp'>Admin</a>\" />\n  <jsp:param name=\"breadcrumb\" value=\"<a href='admin/notification/index.jsp'>Configure Notifications</a>\" />\n  <jsp:param name=\"breadcrumb\" value=\"Event Notifications\" />\n</jsp:include>\n\n<script type=\"text/javascript\" >\n\n    function editNotice(name)\n    {\n        document.notices.userAction.value=\"edit\";\n        document.notices.notice.value=name;\n        document.notices.submit();\n    }\n    \n    function deleteNotice(name)\n    {\n        if (confirm(\"Are you sure you want to delete the notification \" + name + \"?\"))\n        {\n          document.notices.userAction.value=\"delete\";\n          document.notices.notice.value=name;\n          document.notices.submit();\n        }\n    }\n    \n    function setStatus(name, status)\n    {\n        document.notices.userAction.value=status;\n        document.notices.notice.value=name;\n        document.notices.submit();\n    }\n    \n    function newNotice()\n    {\n        document.notices.userAction.value=\"new\";\n        document.notices.submit();\n    }\n    \n</script>\n\n<form method=\"post\" name=\"notices\" action=\"admin/notification/noticeWizard/notificationWizard\">\n<input type=\"hidden\" name=\"userAction\" value=\"\"/>\n<input type=\"hidden\" name=\"notice\" value=\"\"/>\n<input type=\"hidden\" name=\"sourcePage\" value=\"<%=NotificationWizardServlet.SOURCE_PAGE_NOTICES%>\"/>\n\n<div class=\"card\">\n  <div class=\"card-header\">\n    <h4 class=\"pull-left\">Event Notifications</h4>\n    <button class=\"pull-right btn btn-secondary\" onclick=\"javascript:newNotice()\"><i class=\"fa fa-plus\"></i> Add New Event Notification</button>\n  </div>\n  <div class=\"card-body\">\n        <table class=\"table table-sm table-striped\">\n          <tr>\n            <th colspan=\"3\">\n              Actions\n            </th>\n            <th>\n              Notification\n            </th>\n            <th>\n              Event\n            </th>\n            <th>\n              UEI\n            </th>\n          </tr>\n          <c:forEach items=\"${notifications}\" var=\"notification\">\n          <tr>\n            <td>\n              <input type=\"button\" class=\"btn btn-secondary\" value=\"Edit\" onclick=\"javascript:editNotice('${e:forJavaScript(notification.escapedName)}')\"/>\n            </td>\n            <td>\n              <input type=\"button\" class=\"btn btn-secondary\" value=\"Delete\"  onclick=\"javascript:deleteNotice('${e:forJavaScript(notification.escapedName)}')\"/>\n            </td>\n            <td>\n            <c:choose>\n              <c:when test=\"${notification.isOn}\">\n                <input type=\"radio\" value=\"Off\" onclick=\"javascript:setStatus('${e:forJavaScript(notification.escapedName)}','off')\"/>Off\n                <input type=\"radio\" value=\"On\" CHECKED onclick=\"javascript:setStatus('${e:forJavaScript(notification.escapedName)}','on')\"/>On\n              </c:when>\n              <c:otherwise>\n                <input type=\"radio\" value=\"Off\" CHECKED onclick=\"javascript:setStatus('${e:forJavaScript(notification.escapedName)}','off')\"/>Off\n                <input type=\"radio\" value=\"On\" onclick=\"javascript:setStatus('${e:forJavaScript(notification.escapedName)}','on')\"/>On\n              </c:otherwise>\n            </c:choose>\n            </td>\n            <td>\n            ${fn:escapeXml(notification.name)}\n            </td>\n            <td>\n              ${fn:escapeXml(notification.eventLabel)}\n            </td>\n            <td>\n              ${fn:escapeXml(notification.displayUei)}\n            </td>\n          </tr>\n          </c:forEach>\n        </table>\n  </div>\n</div> <!-- card -->\n\n</form>\n\n<jsp:include page=\"/includes/bootstrap-footer.jsp\" flush=\"false\" />\n", "<%--\n/*******************************************************************************\n * This file is part of OpenNMS(R).\n *\n * Copyright (C) 2002-2017 The OpenNMS Group, Inc.\n * OpenNMS(R) is Copyright (C) 1999-2017 The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published\n * by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * OpenNMS(R) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with OpenNMS(R).  If not, see:\n *      http://www.gnu.org/licenses/\n *\n * For more information contact:\n *     OpenNMS(R) Licensing <license@opennms.org>\n *     http://www.opennms.org/\n *     http://www.opennms.com/\n *******************************************************************************/\n\n--%>\n\n<%@page language=\"java\"\n\tcontentType=\"text/html\"\n\tsession=\"true\"\n\timport=\"java.util.*,\n\t\torg.opennms.web.admin.notification.noticeWizard.*,\n\t\torg.opennms.netmgt.config.notifications.*,\n        org.opennms.netmgt.config.destinationPaths.*,\n\t\torg.opennms.netmgt.config.*\n\t\"\n%>\n<%@ page import=\"org.opennms.core.utils.WebSecurityUtils\" %>\n\n<%@ taglib uri=\"http://java.sun.com/jsp/jstl/functions\" prefix=\"fn\"%>\n\n\n<%!\n    public void init() throws ServletException {\n        try {\n            DestinationPathFactory.init();\n        }\n        catch( Exception e ) {\n            throw new ServletException( \"Cannot load configuration file\", e );\n        }\n    }\n%>\n\n<%\n    HttpSession user = request.getSession(true);\n    Notification newNotice = (Notification)user.getAttribute(\"newNotice\");\n    Varbind varbind=newNotice.getVarbind();\n    String varbindName=\"\";\n    String varbindValue=\"\";\n    if(varbind!=null) {\n        \n        if(varbind.getVbname()!=null) {\n            varbindName=varbind.getVbname();\n\t\t}\n        if(varbind.getVbvalue()!=null) {\n         \tvarbindValue=varbind.getVbvalue();\n        }\n    }\n%>\n\n<jsp:include page=\"/includes/bootstrap.jsp\" flush=\"false\" >\n  <jsp:param name=\"title\" value=\"Choose Path\" />\n  <jsp:param name=\"headTitle\" value=\"Choose Path\" />\n  <jsp:param name=\"headTitle\" value=\"Admin\" />\n  <jsp:param name=\"breadcrumb\" value=\"<a href='admin/index.jsp'>Admin</a>\" />\n  <jsp:param name=\"breadcrumb\" value=\"<a href='admin/notification/index.jsp'>Configure Notifications</a>\" />\n  <jsp:param name=\"breadcrumb\" value=\"Choose Path\" />\n</jsp:include>\n\n<script type=\"text/javascript\" >\n  \n    function trimString(str) \n    {\n        while (str.charAt(0)==\" \")\n        {\n          str = str.substring(1);\n        }\n        while (str.charAt(str.length - 1)==\" \")\n        {\n          str = str.substring(0, str.length - 1);\n        }\n        return str;\n    }\n    \n    function finish()\n    {\n        trimmedName = trimString(document.info.name.value);\n        trimmedText = trimString(document.info.textMsg.value);\n        if (trimmedName==\"\")\n        {\n            alert(\"Please give this notification a name.\");\n        }\n        else if (trimmedText==\"\")\n        {\n            alert(\"Please enter a text message for this notification.\");\n        }\n        else if (document.info.path.selectedIndex==-1)\n        {\n            alert(\"Please select a destination path for this notification.\");\n        }\n        else\n        {\n            document.info.submit();\n        }\n    }\n  \n</script>\n\n<h2><%=(newNotice.getName()!=null ? \"Editing notice: \" + WebSecurityUtils.sanitizeString(newNotice.getName()) + \"<br/>\" : \"\")%></h2>\n\n<form method=\"post\" name=\"info\"\n      action=\"admin/notification/noticeWizard/notificationWizard\">\n      <input type=\"hidden\" name=\"userAction\" value=\"\"/>\n      <input type=\"hidden\" name=\"sourcePage\" value=\"<%=NotificationWizardServlet.SOURCE_PAGE_PATH%>\"/>\n\n<div class=\"row\">\n  <div class=\"col-md-7\">\n    <div class=\"card\">\n      <div class=\"card-header\">\n        <span>Choose the destination path and enter the information to send via the notification</span>\n      </div>\n      <table class=\"table table-sm\">\n        <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Name:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <input type=\"text\" class=\"form-control\" name=\"name\" value='<%=(newNotice.getName()!=null ? WebSecurityUtils.sanitizeString(newNotice.getName()) : \"\")%>'/>\n          </td>\n        </tr>\n        <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Description:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <input type=\"text\" class=\"form-control\" name=\"description\" value='<%=WebSecurityUtils.sanitizeString(newNotice.getDescription().orElse(\"\"))%>'/>\n          </td>\n        </tr>\n        <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Parameter:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <div class=\"row\">\n              <div class=\"col-md-6\">\n                <label>Name:</label> <input type=\"text\" class=\"form-control\" size=\"30\" name=\"varbindName\" value='<%=WebSecurityUtils.sanitizeString(varbindName)%>'/>\n              </div>\n              <div class=\"col-md-6\">\n                <label>Value:</label> <input class=\"form-control\" type=\"text\" size=\"30\" name=\"varbindValue\" value='<%=WebSecurityUtils.sanitizeString(varbindValue)%>'/>\n              </div>\n            </div>\n          </td>\n        </tr>\n        <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Choose A Path:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <%=buildPathSelect(newNotice.getDestinationPath())%>\n          </td>\n         </tr>\n         <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Text Message:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <textarea rows=\"3\" class=\"form-control\" name=\"textMsg\"><%=(newNotice.getTextMessage()!=null ? WebSecurityUtils.sanitizeString(newNotice.getTextMessage()) : \"\")%></textarea>\n          </td>\n         </tr>\n         <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Short Message:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <textarea rows=\"1\" class=\"form-control\" name=\"numMsg\"><%=WebSecurityUtils.sanitizeString(newNotice.getNumericMessage().orElse(\"\"))%></textarea>\n          </td>\n         </tr>\n         <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Email Subject:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <input type=\"text\" class=\"form-control\" name=\"subject\" value='<%=WebSecurityUtils.sanitizeString(newNotice.getSubject().orElse(\"\"))%>'/>\n          </td>\n         </tr>\n         <tr>\n          <td width=\"10%\" valign=\"top\" align=\"left\">\n            <label>Special Values:</label>\n          </td>\n          <td valign=\"top\" align=\"left\">\n            <table class=\"table table-sm\">\n              <tr>\n                <td colspan=\"3\">Can be used in both the text message and email subject:</td>\n              </tr>\n              <tr>\n                <td>%noticeid% = Notification ID number</td>\n                <td>%time% = Time sent</td>\n                <td>%severity% = Event severity</td>                          \n              </tr>\n              <tr>\n                <td>%nodelabel% = May be IP address or empty</td>\n                <td>%interface% = IP address, may be empty</td>\n                <td>%service% = Service name, may be empty</td>\n              </tr>\n              <tr>\n\t\t\t\t<td>%eventid% = Event ID, may be empty</td>\n\t\t\t\t<td>%parm[a_parm_name]% = Value of a named event parameter</td>\n\t\t\t\t<td>%parm[#N]% = Value of the event parameter at index N</td>\n\t\t\t  </tr>\n\t\t\t  <tr>\n\t\t\t    <td>%ifalias% = SNMP ifAlias of affected interface</td>\n\t\t\t    <td>%interfaceresolve% = Reverse DNS name of interface IP address</td>\n               <td>%operinstruct% = Operator instructions from event definition</td>\t\t     \n\t\t\t  </tr>\n            </table>\n          </td>\n         </tr>\n      </table>\n        <div class=\"card-footer\">\n              <a class=\"btn btn-secondary\" href=\"javascript:finish()\">Finish</a>\n        </div>\n    </div> <!-- panel -->\n  </div> <!-- column -->\n</div> <!-- row -->\n\n</form>\n\n<jsp:include page=\"/includes/bootstrap-footer.jsp\" flush=\"false\" />\n\n<%!\n    public String buildPathSelect(String currentPath)\n      throws ServletException\n    {\n         StringBuffer buffer = new StringBuffer(\"<select class=\\\"form-control custom-select\\\" NAME=\\\"path\\\">\");\n         \n         Map<String, Path> pathsMap = null;\n         \n         try {\n             pathsMap = new TreeMap<String, Path>(DestinationPathFactory.getInstance().getPaths());\n             for (String key : pathsMap.keySet()) {\n                 if (key.equals(currentPath))\n                 {\n                    buffer.append(\"<option SELECTED VALUE=\" + key + \">\" + key + \"</option>\");\n                 }\n                 else\n                 {\n                    buffer.append(\"<option VALUE=\" + key + \">\" + key + \"</option>\");\n                 }\n             }\n         } catch (Throwable e)\n         {\n            throw new ServletException(\"couldn't get destination path list.\", e);\n         }\n         buffer.append(\"</select>\");\n         \n         return buffer.toString();\n    }\n%>\n", "/*******************************************************************************\n * This file is part of OpenNMS(R).\n *\n * Copyright (C) 2011-2014 The OpenNMS Group, Inc.\n * OpenNMS(R) is Copyright (C) 1999-2014 The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n *\n * OpenNMS(R) is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published\n * by the Free Software Foundation, either version 3 of the License,\n * or (at your option) any later version.\n *\n * OpenNMS(R) is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with OpenNMS(R).  If not, see:\n *      http://www.gnu.org/licenses/\n *\n * For more information contact:\n *     OpenNMS(R) Licensing <license@opennms.org>\n *     http://www.opennms.org/\n *     http://www.opennms.com/\n *******************************************************************************/\n\npackage org.opennms.smoketest;\n\nimport static org.junit.Assert.assertEquals;\nimport static org.openqa.selenium.support.ui.ExpectedConditions.visibilityOfElementLocated;\n\nimport java.time.Duration;\nimport java.time.temporal.ChronoUnit;\n\nimport org.junit.Before;\nimport org.junit.FixMethodOrder;\nimport org.junit.Test;\nimport org.junit.runners.MethodSorters;\nimport org.openqa.selenium.Alert;\nimport org.openqa.selenium.By;\nimport org.openqa.selenium.support.ui.ExpectedConditions;\nimport org.openqa.selenium.support.ui.Select;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n@FixMethodOrder(MethodSorters.NAME_ASCENDING)\npublic class NotificationsPageIT extends OpenNMSSeleniumIT {\n    private static final Logger LOG = LoggerFactory.getLogger(NotificationsPageIT.class);\n\n    @Before\n    public void setUp() throws Exception {\n        notificationsPage();\n    }\n\n    @Test\n    public void testAllTextIsPresent() throws Exception {\n        assertEquals(3, countElementsMatchingCss(\"div.card-header\"));\n        findElementByXpath(\"//span[text()='Notification queries']\");\n        findElementByXpath(\"//span[text()='Outstanding and Acknowledged Notices']\");\n        findElementByXpath(\"//span[text()='Notification Escalation']\");\n    }\n\n    @Test\n    public void testAllLinksArePresent() {\n        findElementByLink(\"Your outstanding notices\");\n        findElementByLink(\"All outstanding notices\");\n        findElementByLink(\"All acknowledged notices\");\n    }\n\n    @Test\n    public void testAllFormsArePresent() {\n        findElementByXpath(\"//button[@id='btn_search_by_notice' and @type='submit']\");\n        findElementByXpath(\"//button[@id='btn_search_by_user' and @type='submit']\");\n    }\n\n    @Test\n    public void testAllLinks() {\n        findElementByLink(\"Your outstanding notices\").click();\n        findElementByXpath(\"//span[@class='label label-default' and contains(text(), 'admin was notified')]\");\n        findElementByLink(\"[Remove all]\");\n        findElementByLink(\"Sent Time\");\n        findElementByXpath(\"//button[@type='button' and text()='Acknowledge Notices']\");\n\n        notificationsPage();\n        findElementByLink(\"All outstanding notices\").click();\n        findElementByXpath(\"//p//strong[text()='outstanding']\");\n        findElementByLink(\"[Show acknowledged]\");\n        findElementByLink(\"Respond Time\");\n        assertElementDoesNotHaveText(By.xpath(\"//span[@class='label label-default']\"), \"admin was notified [-]\");\n\n        notificationsPage();\n        findElementByLink(\"All acknowledged notices\").click();\n        findElementByXpath(\"//p//strong[text()='acknowledged']\");\n        findElementByLink(\"[Show outstanding]\");\n        findElementByLink(\"Respond Time\");\n        assertElementDoesNotHaveText(By.xpath(\"//span[@class='label label-default']\"), \"admin was notified [-]\");\n    }\n}\n"], "filenames": ["opennms-webapp/src/main/webapp/WEB-INF/jsp/admin/notification/noticeWizard/eventNotices.jsp", "opennms-webapp/src/main/webapp/admin/notification/noticeWizard/choosePath.jsp", "smoke-test/src/test/java/org/opennms/smoketest/NotificationsPageIT.java"], "buggy_code_start_loc": [38, 41, 31], "buggy_code_end_loc": [137, 194, 90], "fixing_code_start_loc": [39, 42, 32], "fixing_code_end_loc": [138, 198, 99], "type": "CWE-79", "message": "In OpenNMS Horizon, versions opennms-1-0-stable through opennms-27.1.0-1; OpenNMS Meridian, versions meridian-foundation-2015.1.0-1 through meridian-foundation-2019.1.18-1; meridian-foundation-2020.1.0-1 through meridian-foundation-2020.1.6-1 are vulnerable to Stored Cross-Site Scripting since there is no validation on the input being sent to the `name` parameter in `noticeWizard` endpoint. Due to this flaw an authenticated attacker could inject arbitrary script and trick other admin users into downloading malicious files.", "other": {"cve": {"id": "CVE-2021-25929", "sourceIdentifier": "vulnerabilitylab@mend.io", "published": "2021-05-20T15:15:07.603", "lastModified": "2021-05-26T20:34:05.973", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In OpenNMS Horizon, versions opennms-1-0-stable through opennms-27.1.0-1; OpenNMS Meridian, versions meridian-foundation-2015.1.0-1 through meridian-foundation-2019.1.18-1; meridian-foundation-2020.1.0-1 through meridian-foundation-2020.1.6-1 are vulnerable to Stored Cross-Site Scripting since there is no validation on the input being sent to the `name` parameter in `noticeWizard` endpoint. Due to this flaw an authenticated attacker could inject arbitrary script and trick other admin users into downloading malicious files."}, {"lang": "es", "value": "En OpenNMS Horizon, versiones opennms-1-0-stable hasta opennms-27.1.0-1;&#xa0;OpenNMS Meridian, versiones meridian-foundation-2015.1.0-1 hasta meridian-foundation-2019.1.18-1; versiones&#xa0;meridian-foundation-2020.1.0-1 hasta meridian-foundation-2020.1.6-1, son vulnerables a ataque de tipo Cross-Site Scripting almacenado, ya que no presenta comprobaci\u00f3n en la entrada que ha sido enviada al par\u00e1metro \"name\" en el endpoint \"noticeWizard\".&#xa0;Debido a este fallo, un atacante autenticado podr\u00eda inyectar un script arbitrario y enga\u00f1ar a otros usuarios administradores para que descarguen archivos maliciosos"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:opennms:horizon:*:*:*:*:*:*:*:*", "versionStartIncluding": "1.0", "versionEndExcluding": "27.1.1", "matchCriteriaId": "B38D9FCC-AF2B-46B6-9573-04EE36A2BAEB"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opennms:meridian:*:*:*:*:*:*:*:*", "versionStartIncluding": "2015.1.0", "versionEndExcluding": "2019.1.19", "matchCriteriaId": "CBFB1241-8D42-4F61-B855-210D963B4B4E"}, {"vulnerable": true, "criteria": "cpe:2.3:a:opennms:meridian:*:*:*:*:*:*:*:*", "versionStartIncluding": "2020.1.0", "versionEndExcluding": "2020.1.7", "matchCriteriaId": "492F27E1-43CF-4823-B132-DC2730CB8CEA"}]}]}], "references": [{"url": "https://github.com/OpenNMS/opennms/commit/66c1f626bf38a7d1a9530b4d68598269ee5245a2", "source": "vulnerabilitylab@mend.io", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/OpenNMS/opennms/commit/eb08b5ed4c5548f3e941a1f0d0363ae4439fa98c", "source": "vulnerabilitylab@mend.io", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25929", "source": "vulnerabilitylab@mend.io", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/OpenNMS/opennms/commit/66c1f626bf38a7d1a9530b4d68598269ee5245a2"}}