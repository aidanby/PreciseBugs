{"buggy_code": ["<?php\r\n/**\r\n * Plugin installation and activation for WordPress themes.\r\n *\r\n * @package   TGM-Plugin-Activation\r\n * @version   2.3.3\r\n * @author    Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n * @author    Gary Jones <gamajo@gamajo.com>\r\n * @copyright Copyright (c) 2012, Thomas Griffin\r\n * @license   http://opensource.org/licenses/gpl-2.0.php GPL v2 or later\r\n * @link      https://github.com/thomasgriffin/TGM-Plugin-Activation\r\n */\r\n\r\n/*\r\n    Copyright 2012  Thomas Griffin  (email : thomas@thomasgriffinmedia.com)\r\n\r\n    This program is free software; you can redistribute it and/or modify\r\n    it under the terms of the GNU General Public License, version 3, as\r\n    published by the Free Software Foundation.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n    GNU General Public License for more details.\r\n\r\n    You should have received a copy of the GNU General Public License\r\n    along with this program; if not, write to the Free Software\r\n    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA\r\n*/\r\n\r\nif ( ! class_exists( 'TGM_Plugin_Activation' ) ) {\r\n    /**\r\n \t * Automatic plugin installation and activation library.\r\n \t *\r\n \t * Creates a way to automatically install and activate plugins from within themes.\r\n \t * The plugins can be either pre-packaged, downloaded from the WordPress\r\n \t * Plugin Repository or downloaded from a private repository.\r\n \t *\r\n \t * @since 1.0.0\r\n \t *\r\n \t * @package TGM-Plugin-Activation\r\n \t * @author Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n \t * @author Gary Jones <gamajo@gamajo.com>\r\n \t */\r\n    class TGM_Plugin_Activation {\r\n\r\n        /**\r\n     \t * Holds a copy of itself, so it can be referenced by the class name.\r\n     \t *\r\n     \t * @since 1.0.0\r\n     \t *\r\n     \t * @var TGM_Plugin_Activation\r\n     \t */\r\n        static $instance;\r\n\r\n        /**\r\n     \t * Holds arrays of plugin details.\r\n     \t *\r\n     \t * @since 1.0.0\r\n     \t *\r\n     \t * @var array\r\n     \t */\r\n        public $plugins = array();\r\n\r\n        /**\r\n     \t * Parent menu slug for plugins page.\r\n     \t *\r\n     \t * @since 2.2.0\r\n     \t *\r\n     \t * @var string Parent menu slug. Defaults to 'themes.php'.\r\n     \t */\r\n        public $parent_menu_slug = 'themes.php';\r\n\r\n        /**\r\n     \t * Parent URL slug for URL references.\r\n     \t *\r\n     \t * This is useful if you want to place the custom plugins page as a\r\n     \t * submenu item under a custom parent menu.\r\n     \t *\r\n     \t * @since 2.2.0\r\n     \t *\r\n     \t * @var string Parent URL slug. Defaults to 'themes.php'.\r\n     \t */\r\n        public $parent_url_slug = 'themes.php';\r\n\r\n        /**\r\n     \t * Name of the querystring argument for the admin page.\r\n     \t *\r\n     \t * @since 1.0.0\r\n     \t *\r\n     \t * @var string\r\n     \t */\r\n        public $menu = 'install-required-plugins';\r\n\r\n        /**\r\n         * Text domain for localization support.\r\n         *\r\n         * @since 1.1.0\r\n         *\r\n         * @var string\r\n         */\r\n        public $domain = 'tgmpa';\r\n\r\n        /**\r\n         * Default absolute path to folder containing pre-packaged plugin zip files.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @var string Absolute path prefix to packaged zip file location. Default is empty string.\r\n         */\r\n        public $default_path = '';\r\n\r\n        /**\r\n         * Flag to show admin notices or not.\r\n         *\r\n         * @since 2.1.0\r\n         *\r\n         * @var boolean\r\n         */\r\n        public $has_notices = true;\r\n\r\n        /**\r\n         * Flag to set automatic activation of plugins. Off by default.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @var boolean\r\n         */\r\n        public $is_automatic = false;\r\n\r\n        /**\r\n         * Optional message to display before the plugins table.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @var string Message filtered by wp_kses_post(). Default is empty string.\r\n         */\r\n        public $message = '';\r\n\r\n        /**\r\n         * Holds configurable array of strings.\r\n         *\r\n         * Default values are added in the constructor.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @var array\r\n         */\r\n        public $strings = array();\r\n\r\n        /**\r\n         * Adds a reference of this object to $instance, populates default strings,\r\n         * does the tgmpa_init action hook, and hooks in the interactions to init.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @see TGM_Plugin_Activation::init()\r\n         */\r\n        public function __construct() {\r\n\r\n            self::$instance =& $this;\r\n\r\n            $this->strings = array(\r\n                'page_title'                      => __( 'Install Required Plugins', $this->domain ),\r\n                'menu_title'                      => __( 'Install Plugins', $this->domain ),\r\n                'installing'                      => __( 'Installing Plugin: %s', $this->domain ),\r\n                'oops'                            => __( 'Something went wrong.', $this->domain ),\r\n                'notice_can_install_required'     => _n_noop( 'This theme requires the following plugin: %1$s.', 'This theme requires the following plugins: %1$s.' ),\r\n                'notice_can_install_recommended'  => _n_noop( 'This theme recommends the following plugin: %1$s.', 'This theme recommends the following plugins: %1$s.' ),\r\n                'notice_cannot_install'           => _n_noop( 'Sorry, but you do not have the correct permissions to install the %s plugin. Contact the administrator of this site for help on getting the plugin installed.', 'Sorry, but you do not have the correct permissions to install the %s plugins. Contact the administrator of this site for help on getting the plugins installed.' ),\r\n                'notice_can_activate_required'    => _n_noop( 'The following required plugin is currently inactive: %1$s.', 'The following required plugins are currently inactive: %1$s.' ),\r\n                'notice_can_activate_recommended' => _n_noop( 'The following recommended plugin is currently inactive: %1$s.', 'The following recommended plugins are currently inactive: %1$s.' ),\r\n                'notice_cannot_activate'          => _n_noop( 'Sorry, but you do not have the correct permissions to activate the %s plugin. Contact the administrator of this site for help on getting the plugin activated.', 'Sorry, but you do not have the correct permissions to activate the %s plugins. Contact the administrator of this site for help on getting the plugins activated.' ),\r\n                'notice_ask_to_update'            => _n_noop( 'The following plugin needs to be updated to its latest version to ensure maximum compatibility with this theme: %1$s.', 'The following plugins need to be updated to their latest version to ensure maximum compatibility with this theme: %1$s.' ),\r\n                'notice_cannot_update'            => _n_noop( 'Sorry, but you do not have the correct permissions to update the %s plugin. Contact the administrator of this site for help on getting the plugin updated.', 'Sorry, but you do not have the correct permissions to update the %s plugins. Contact the administrator of this site for help on getting the plugins updated.' ),\r\n                'install_link' \t\t\t\t\t  => _n_noop( 'Begin installing plugin', 'Begin installing plugins' ),\r\n                'activate_link' \t\t\t\t  => _n_noop( 'Activate installed plugin', 'Activate installed plugins' ),\r\n                'return'                          => __( 'Return to Required Plugins Installer', $this->domain ),\r\n                'plugin_activated'                => __( 'Plugin activated successfully.', $this->domain ),\r\n                'complete'                        => __( 'All plugins installed and activated successfully. %1$s', $this->domain ),\r\n            );\r\n\r\n            /** Annouce that the class is ready, and pass the object (for advanced use) */\r\n            do_action_ref_array( 'tgmpa_init', array( &$this ) );\r\n\r\n            /** When the rest of WP has loaded, kick-start the rest of the class */\r\n            add_action( 'init', array( &$this, 'init' ) );\r\n\r\n        }\r\n\r\n        /**\r\n         * Initialise the interactions between this class and WordPress.\r\n         *\r\n         * Hooks in three new methods for the class: admin_menu, notices and styles.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @see TGM_Plugin_Activation::admin_menu()\r\n         * @see TGM_Plugin_Activation::notices()\r\n         * @see TGM_Plugin_Activation::styles()\r\n         */\r\n        public function init() {\r\n\r\n            do_action( 'tgmpa_register' );\r\n            /** After this point, the plugins should be registered and the configuration set */\r\n\r\n            /** Proceed only if we have plugins to handle */\r\n            if ( $this->plugins ) {\r\n                $sorted = array(); // Prepare variable for sorting\r\n\r\n                foreach ( $this->plugins as $plugin )\r\n                    $sorted[] = $plugin['name'];\r\n\r\n                array_multisort( $sorted, SORT_ASC, $this->plugins ); // Sort plugins alphabetically by name\r\n\r\n                add_action( 'admin_menu', array( &$this, 'admin_menu' ) );\r\n                add_action( 'admin_head', array( &$this, 'dismiss' ) );\r\n                add_filter( 'install_plugin_complete_actions', array( &$this, 'actions' ) );\r\n\r\n                /** Load admin bar in the header to remove flash when installing plugins */\r\n                if ( $this->is_tgmpa_page() ) {\r\n                    remove_action( 'wp_footer', 'wp_admin_bar_render', 1000 );\r\n                    remove_action( 'admin_footer', 'wp_admin_bar_render', 1000 );\r\n                    add_action( 'wp_head', 'wp_admin_bar_render', 1000 );\r\n                    add_action( 'admin_head', 'wp_admin_bar_render', 1000 );\r\n                }\r\n\r\n                if ( $this->has_notices ) {\r\n                    add_action( 'admin_notices', array( &$this, 'notices' ) );\r\n                    add_action( 'admin_init', array( &$this, 'admin_init' ), 1 );\r\n                    add_action( 'admin_enqueue_scripts', array( &$this, 'thickbox' ) );\r\n                    add_action( 'switch_theme', array( &$this, 'update_dismiss' ) );\r\n                }\r\n\r\n                /** Setup the force activation hook */\r\n                foreach ( $this->plugins as $plugin ) {\r\n                    if ( isset( $plugin['force_activation'] ) && true === $plugin['force_activation'] ) {\r\n                        add_action( 'admin_init', array( &$this, 'force_activation' ) );\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                /** Setup the force deactivation hook */\r\n                foreach ( $this->plugins as $plugin ) {\r\n                    if ( isset( $plugin['force_deactivation'] ) && true === $plugin['force_deactivation'] ) {\r\n                        add_action( 'switch_theme', array( &$this, 'force_deactivation' ) );\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Handles calls to show plugin information via links in the notices.\r\n         *\r\n         * We get the links in the admin notices to point to the TGMPA page, rather\r\n         * than the typical plugin-install.php file, so we can prepare everything\r\n         * beforehand.\r\n         *\r\n         * WP doesn't make it easy to show the plugin information in the thickbox -\r\n         * here we have to require a file that includes a function that does the\r\n         * main work of displaying it, enqueue some styles, set up some globals and\r\n         * finally call that function before exiting.\r\n         *\r\n         * Down right easy once you know how...\r\n         *\r\n         * @since 2.1.0\r\n         *\r\n         * @global string $tab Used as iframe div class names, helps with styling\r\n         * @global string $body_id Used as the iframe body ID, helps with styling\r\n         * @return null Returns early if not the TGMPA page.\r\n         */\r\n        public function admin_init() {\r\n\r\n            if ( ! $this->is_tgmpa_page() )\r\n                return;\r\n\r\n            if ( isset( $_REQUEST['tab'] ) && 'plugin-information' == $_REQUEST['tab'] ) {\r\n                require_once ABSPATH . 'wp-admin/includes/plugin-install.php'; // Need for install_plugin_information()\r\n\r\n                wp_enqueue_style( 'plugin-install' );\r\n\r\n                global $tab, $body_id;\r\n                $body_id = $tab = 'plugin-information';\r\n\r\n                install_plugin_information();\r\n\r\n                exit;\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Enqueues thickbox scripts/styles for plugin info.\r\n         *\r\n         * Thickbox is not automatically included on all admin pages, so we must\r\n         * manually enqueue it for those pages.\r\n         *\r\n         * Thickbox is only loaded if the user has not dismissed the admin\r\n         * notice or if there are any plugins left to install and activate.\r\n         *\r\n         * @since 2.1.0\r\n         */\r\n        public function thickbox() {\r\n\r\n            if ( ! get_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice', true ) )\r\n                add_thickbox();\r\n\r\n        }\r\n\r\n        /**\r\n         * Adds submenu page under 'Appearance' tab.\r\n         *\r\n         * This method adds the submenu page letting users know that a required\r\n         * plugin needs to be installed.\r\n         *\r\n         * This page disappears once the plugin has been installed and activated.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @see TGM_Plugin_Activation::init()\r\n         * @see TGM_Plugin_Activation::install_plugins_page()\r\n         */\r\n        public function admin_menu() {\r\n\r\n            // Make sure privileges are correct to see the page\r\n            if ( ! current_user_can( 'install_plugins' ) )\r\n                return;\r\n\r\n            $this->populate_file_path();\r\n\r\n            foreach ( $this->plugins as $plugin ) {\r\n                if ( ! is_plugin_active( $plugin['file_path'] ) ) {\r\n                    add_submenu_page(\r\n                        $this->parent_menu_slug,\t\t\t\t// Parent menu slug\r\n                        $this->strings['page_title'],           // Page title\r\n                        $this->strings['menu_title'],           // Menu title\r\n                        'edit_theme_options',                   // Capability\r\n                        $this->menu,                            // Menu slug\r\n                        array( &$this, 'install_plugins_page' ) // Callback\r\n                    );\r\n                break;\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Echoes plugin installation form.\r\n         *\r\n         * This method is the callback for the admin_menu method function.\r\n         * This displays the admin page and form area where the user can select to install and activate the plugin.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @return null Aborts early if we're processing a plugin installation action\r\n         */\r\n        public function install_plugins_page() {\r\n\r\n            /** Store new instance of plugin table in object */\r\n            $plugin_table = new TGMPA_List_Table;\r\n\r\n            /** Return early if processing a plugin installation action */\r\n            if ( isset( $_POST[sanitize_key( 'action' )] ) && 'tgmpa-bulk-install' == $_POST[sanitize_key( 'action' )] && $plugin_table->process_bulk_actions() || $this->do_plugin_install() )\r\n                return;\r\n\r\n            ?>\r\n            <div class=\"tgmpa wrap\">\r\n\r\n                <?php screen_icon( apply_filters( 'tgmpa_default_screen_icon', 'themes' ) ); ?>\r\n                <h2><?php echo esc_html( get_admin_page_title() ); ?></h2>\r\n                <?php $plugin_table->prepare_items(); ?>\r\n\r\n                <?php if ( isset( $this->message ) ) _e( wp_kses_post( $this->message ), $this->domain ); ?>\r\n\r\n                <form id=\"tgmpa-plugins\" action=\"\" method=\"post\">\r\n            \t\t<input type=\"hidden\" name=\"tgmpa-page\" value=\"<?php echo $this->menu; ?>\" />\r\n            \t\t<?php $plugin_table->display(); ?>\r\n        \t\t</form>\r\n\r\n            </div>\r\n            <?php\r\n\r\n        }\r\n\r\n        /**\r\n         * Installs a plugin or activates a plugin depending on the hover\r\n         * link clicked by the user.\r\n         *\r\n         * Checks the $_GET variable to see which actions have been\r\n         * passed and responds with the appropriate method.\r\n         *\r\n         * Uses WP_Filesystem to process and handle the plugin installation\r\n         * method.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @uses WP_Filesystem\r\n         * @uses WP_Error\r\n         * @uses WP_Upgrader\r\n         * @uses Plugin_Upgrader\r\n         * @uses Plugin_Installer_Skin\r\n         *\r\n         * @return boolean True on success, false on failure\r\n         */\r\n        protected function do_plugin_install() {\r\n\r\n            /** All plugin information will be stored in an array for processing */\r\n            $plugin = array();\r\n\r\n            /** Checks for actions from hover links to process the installation */\r\n            if ( isset( $_GET[sanitize_key( 'plugin' )] ) && ( isset( $_GET[sanitize_key( 'tgmpa-install' )] ) && 'install-plugin' == $_GET[sanitize_key( 'tgmpa-install' )] ) ) {\r\n                check_admin_referer( 'tgmpa-install' );\r\n\r\n                $plugin['name']   = $_GET[sanitize_key( 'plugin_name' )]; // Plugin name\r\n                $plugin['slug']   = $_GET[sanitize_key( 'plugin' )]; // Plugin slug\r\n                $plugin['source'] = $_GET[sanitize_key( 'plugin_source' )]; // Plugin source\r\n\r\n                /** Pass all necessary information via URL if WP_Filesystem is needed */\r\n                $url = wp_nonce_url(\r\n                    add_query_arg(\r\n                        array(\r\n                            'page'          => $this->menu,\r\n                            'plugin'        => $plugin['slug'],\r\n                            'plugin_name'   => $plugin['name'],\r\n                            'plugin_source' => $plugin['source'],\r\n                            'tgmpa-install' => 'install-plugin',\r\n                        ),\r\n                        admin_url( $this->parent_url_slug )\r\n                    ),\r\n                    'tgmpa-install'\r\n                );\r\n                $method = ''; // Leave blank so WP_Filesystem can populate it as necessary\r\n                $fields = array( sanitize_key( 'tgmpa-install' ) ); // Extra fields to pass to WP_Filesystem\r\n\r\n                if ( false === ( $creds = request_filesystem_credentials( $url, $method, false, false, $fields ) ) )\r\n                    return true;\r\n\r\n                if ( ! WP_Filesystem( $creds ) ) {\r\n                    request_filesystem_credentials( $url, $method, true, false, $fields ); // Setup WP_Filesystem\r\n                    return true;\r\n                }\r\n\r\n                require_once ABSPATH . 'wp-admin/includes/plugin-install.php'; // Need for plugins_api\r\n                require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'; // Need for upgrade classes\r\n\r\n                $api = plugins_api( 'plugin_information', array( 'slug' => $plugin['slug'], 'fields' => array( 'sections' => false ) ) );\r\n\r\n                if ( is_wp_error( $api ) )\r\n                    wp_die( $this->strings['oops'] . var_dump( $api ) );\r\n\r\n                /** Set plugin source to WordPress API link if available */\r\n                if ( isset( $plugin['source'] ) && 'repo' == $plugin['source'] && isset( $api->download_link ) )\r\n                    $plugin['source'] = $api->download_link;\r\n\r\n                /** Set type, based on whether the source starts with http:// or https:// */\r\n                $type = preg_match( '|^http(s)?://|', $plugin['source'] ) ? 'web' : 'upload';\r\n\r\n                /** Prep variables for Plugin_Installer_Skin class */\r\n                $title = sprintf( $this->strings['installing'], $plugin['name'] );\r\n                $url   = add_query_arg( array( 'action' => 'install-plugin', 'plugin' => $plugin['slug'] ), 'update.php' );\r\n                if ( isset( $_GET['from'] ) )\r\n                    $url .= add_query_arg( 'from', urlencode( stripslashes( $_GET['from'] ) ), $url );\r\n\r\n                $nonce = 'install-plugin_' . $plugin['slug'];\r\n\r\n                /** Prefix a default path to pre-packaged plugins */\r\n                $source = ( 'upload' == $type ) ? $this->default_path . $plugin['source'] : $plugin['source'];\r\n\r\n                /** Create a new instance of Plugin_Upgrader */\r\n                $upgrader = new Plugin_Upgrader( $skin = new Plugin_Installer_Skin( compact( 'type', 'title', 'url', 'nonce', 'plugin', 'api' ) ) );\r\n\r\n                /** Perform the action and install the plugin from the $source urldecode() */\r\n                $upgrader->install( $source );\r\n\r\n                /** Flush plugins cache so we can make sure that the installed plugins list is always up to date */\r\n                wp_cache_flush();\r\n\r\n                /** Only activate plugins if the config option is set to true */\r\n                if ( $this->is_automatic ) {\r\n                    $plugin_activate = $upgrader->plugin_info(); // Grab the plugin info from the Plugin_Upgrader method\r\n                    $activate = activate_plugin( $plugin_activate ); // Activate the plugin\r\n                    $this->populate_file_path(); // Re-populate the file path now that the plugin has been installed and activated\r\n\r\n                    if ( is_wp_error( $activate ) ) {\r\n                        echo '<div id=\"message\" class=\"error\"><p>' . $activate->get_error_message() . '</p></div>';\r\n                        echo '<p><a href=\"' . add_query_arg( 'page', $this->menu, admin_url( $this->parent_url_slug ) ) . '\" title=\"' . esc_attr( $this->strings['return'] ) . '\" target=\"_parent\">' . __( 'Return to Required Plugins Installer', $this->domain ) . '</a></p>';\r\n                        return true; // End it here if there is an error with automatic activation\r\n                    }\r\n                    else {\r\n                        echo '<p>' . $this->strings['plugin_activated'] . '</p>';\r\n                    }\r\n                }\r\n\r\n                /** Display message based on if all plugins are now active or not */\r\n                $complete = array();\r\n                foreach ( $this->plugins as $plugin ) {\r\n                    if ( ! is_plugin_active( $plugin['file_path'] ) ) {\r\n                        echo '<p><a href=\"' . add_query_arg( 'page', $this->menu, admin_url( $this->parent_url_slug ) ) . '\" title=\"' . esc_attr( $this->strings['return'] ) . '\" target=\"_parent\">' . __( $this->strings['return'], $this->domain ) . '</a></p>';\r\n                        $complete[] = $plugin;\r\n                        break;\r\n                    }\r\n                    /** Nothing to store */\r\n                    else {\r\n                        $complete[] = '';\r\n                    }\r\n                }\r\n\r\n                /** Filter out any empty entries */\r\n                $complete = array_filter( $complete );\r\n\r\n\r\n                /** All plugins are active, so we display the complete string and hide the plugin menu */\r\n                if ( empty( $complete ) ) {\r\n                    $complete_link_text = apply_filters( 'tgmpa_complete_link_text', __( 'Return to the Dashboard', $this->domain ) );\r\n                    $complete_link_url = apply_filters( 'tgmpa_complete_link_url', admin_url() );\r\n                    echo '<p>' .  sprintf( $this->strings['complete'], '<a href=\"' . $complete_link_url . '\" title=\"' . $complete_link_text . '\">' . $complete_link_text . '</a>' ) . '</p>';\r\n                    echo '<style type=\"text/css\">#adminmenu .wp-submenu li.current { display: none !important; }</style>';\r\n                }\r\n\r\n                return true;\r\n            }\r\n            /** Checks for actions from hover links to process the activation */\r\n            elseif ( isset( $_GET[sanitize_key( 'plugin' )] ) && ( isset( $_GET[sanitize_key( 'tgmpa-activate' )] ) && 'activate-plugin' == $_GET[sanitize_key( 'tgmpa-activate' )] ) ) {\r\n                check_admin_referer( 'tgmpa-activate', 'tgmpa-activate-nonce' );\r\n\r\n                /** Populate $plugin array with necessary information */\r\n                $plugin['name']   = $_GET[sanitize_key( 'plugin_name' )];\r\n                $plugin['slug']   = $_GET[sanitize_key( 'plugin' )];\r\n                $plugin['source'] = $_GET[sanitize_key( 'plugin_source' )];\r\n\r\n                $plugin_data = get_plugins( '/' . $plugin['slug'] ); // Retrieve all plugins\r\n                $plugin_file = array_keys( $plugin_data ); // Retrieve all plugin files from installed plugins\r\n                $plugin_to_activate = $plugin['slug'] . '/' . $plugin_file[0]; // Match plugin slug with appropriate plugin file\r\n                $activate = activate_plugin( $plugin_to_activate ); // Activate the plugin\r\n\r\n                if ( is_wp_error( $activate ) ) {\r\n                    echo '<div id=\"message\" class=\"error\"><p>' . $activate->get_error_message() . '</p></div>';\r\n                    echo '<p><a href=\"' . add_query_arg( 'page', $this->menu, admin_url( $this->parent_url_slug ) ) . '\" title=\"' . esc_attr( $this->strings['return'] ) . '\" target=\"_parent\">' . __( $this->strings['return'], $this->domain ) . '</a></p>';\r\n                    return true; // End it here if there is an error with activation\r\n                }\r\n                else {\r\n                    /** Make sure message doesn't display again if bulk activation is performed immediately after a single activation */\r\n                    if ( ! isset( $_POST[sanitize_key( 'action' )] ) ) {\r\n                        $msg = sprintf( __( 'The following plugin was activated successfully: %s.', $this->domain ), '<strong>' . $plugin['name'] . '</strong>' );\r\n                        echo '<div id=\"message\" class=\"updated\"><p>' . $msg . '</p></div>';\r\n                    }\r\n                }\r\n            }\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n        /**\r\n         * Echoes required plugin notice.\r\n         *\r\n         * Outputs a message telling users that a specific plugin is required for\r\n         * their theme. If appropriate, it includes a link to the form page where\r\n         * users can install and activate the plugin.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @global object $current_screen\r\n         * @return null Returns early if we're on the Install page\r\n         */\r\n        public function notices() {\r\n\r\n            global $current_screen;\r\n\r\n            /** Remove nag on the install page */\r\n            if ( $this->is_tgmpa_page() )\r\n                return;\r\n\r\n            $installed_plugins = get_plugins(); // Retrieve a list of all the plugins\r\n            $this->populate_file_path();\r\n\r\n            $message              = array(); // Store the messages in an array to be outputted after plugins have looped through\r\n            $install_link         = false; // Set to false, change to true in loop if conditions exist, used for action link 'install'\r\n            $install_link_count   = 0; // Used to determine plurality of install action link text\r\n            $activate_link        = false; // Set to false, change to true in loop if conditions exist, used for action link 'activate'\r\n            $activate_link_count  = 0; // Used to determine plurality of activate action link text\r\n\r\n            foreach ( $this->plugins as $plugin ) {\r\n                /** If the plugin is installed and active, check for minimum version argument before moving forward */\r\n                if ( is_plugin_active( $plugin['file_path'] ) ) {\r\n                    /** A minimum version has been specified */\r\n                    if ( isset( $plugin['version'] ) ) {\r\n                        if ( isset( $installed_plugins[$plugin['file_path']]['Version'] ) ) {\r\n                            /** If the current version is less than the minimum required version, we display a message */\r\n                            if ( version_compare( $installed_plugins[$plugin['file_path']]['Version'], $plugin['version'], '<' ) ) {\r\n                                if ( current_user_can( 'install_plugins' ) )\r\n                                    $message['notice_ask_to_update'][] = $plugin['name'];\r\n                                else\r\n                                    $message['notice_cannot_update'][] = $plugin['name'];\r\n                            }\r\n                        }\r\n                        /** Can't find the plugin, so iterate to the next condition */\r\n                        else {\r\n                            continue;\r\n                        }\r\n                    }\r\n                    /** No minimum version specified, so iterate over the plugin */\r\n                    else {\r\n                        continue;\r\n                    }\r\n                }\r\n\r\n                /** Not installed */\r\n                if ( ! isset( $installed_plugins[$plugin['file_path']] ) ) {\r\n                    $install_link = true; // We need to display the 'install' action link\r\n                    $install_link_count++; // Increment the install link count\r\n                    if ( current_user_can( 'install_plugins' ) ) {\r\n                        if ( $plugin['required'] )\r\n                            $message['notice_can_install_required'][] = $plugin['name'];\r\n                        /** This plugin is only recommended */\r\n                        else\r\n                            $message['notice_can_install_recommended'][] = $plugin['name'];\r\n                    }\r\n                    /** Need higher privileges to install the plugin */\r\n                    else {\r\n                        $message['notice_cannot_install'][] = $plugin['name'];\r\n                    }\r\n                }\r\n                /** Installed but not active */\r\n                elseif ( is_plugin_inactive( $plugin['file_path'] ) ) {\r\n                    $activate_link = true; // We need to display the 'activate' action link\r\n                    $activate_link_count++; // Increment the activate link count\r\n                    if ( current_user_can( 'activate_plugins' ) ) {\r\n                        if ( $plugin['required'] )\r\n                            $message['notice_can_activate_required'][] = $plugin['name'];\r\n                        /** This plugin is only recommended */\r\n                        else {\r\n                            $message['notice_can_activate_recommended'][] = $plugin['name'];\r\n                        }\r\n                    }\r\n                    /** Need higher privileges to activate the plugin */\r\n                    else {\r\n                        $message['notice_cannot_activate'][] = $plugin['name'];\r\n                    }\r\n                }\r\n            }\r\n\r\n            /** Only process the nag messages if the user has not dismissed them already */\r\n            if ( ! get_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice', true ) ) {\r\n                /** If we have notices to display, we move forward */\r\n                if ( ! empty( $message ) ) {\r\n                    krsort( $message ); // Sort messages\r\n                    $rendered = ''; // Display all nag messages as strings\r\n\r\n                    /** Grab all plugin names */\r\n                    foreach ( $message as $type => $plugin_groups ) {\r\n                        $linked_plugin_groups = array();\r\n\r\n                        /** Count number of plugins in each message group to calculate singular/plural message */\r\n                        $count = count( $plugin_groups );\r\n\r\n                        /** Loop through the plugin names to make the ones pulled from the .org repo linked */\r\n                        foreach ( $plugin_groups as $plugin_group_single_name ) {\r\n                            $external_url = $this->_get_plugin_data_from_name( $plugin_group_single_name, 'external_url' );\r\n                            $source = $this->_get_plugin_data_from_name( $plugin_group_single_name, 'source' );\r\n\r\n                            if ( $external_url && preg_match( '|^http(s)?://|', $external_url ) ) {\r\n                                $linked_plugin_groups[] = '<a href=\"' . esc_url( $external_url ) . '\" title=\"' . $plugin_group_single_name . '\" target=\"_blank\">' . $plugin_group_single_name . '</a>';\r\n                            }\r\n                            elseif ( ! $source || preg_match( '|^http://wordpress.org/extend/plugins/|', $source ) ) {\r\n                                $url = add_query_arg(\r\n                                    array(\r\n                                        'tab'       => 'plugin-information',\r\n                                        'plugin'    => $this->_get_plugin_data_from_name( $plugin_group_single_name ),\r\n                                        'TB_iframe' => 'true',\r\n                                        'width'     => '640',\r\n                                        'height'    => '500',\r\n                                    ),\r\n                                    admin_url( 'plugin-install.php' )\r\n                                );\r\n\r\n                                $linked_plugin_groups[] = '<a href=\"' . esc_url( $url ) . '\" class=\"thickbox\" title=\"' . $plugin_group_single_name . '\">' . $plugin_group_single_name . '</a>';\r\n                            }\r\n                            else {\r\n                                $linked_plugin_groups[] = $plugin_group_single_name; // No hyperlink\r\n                            }\r\n\r\n                            if ( isset( $linked_plugin_groups ) && (array) $linked_plugin_groups )\r\n                                $plugin_groups = $linked_plugin_groups;\r\n                        }\r\n\r\n                        $last_plugin = array_pop( $plugin_groups ); // Pop off last name to prep for readability\r\n                        $imploded    = empty( $plugin_groups ) ? '<em>' . $last_plugin . '</em>' : '<em>' . ( implode( ', ', $plugin_groups ) . '</em> and <em>' . $last_plugin . '</em>' );\r\n\r\n                        $rendered .= '<p>' . sprintf( translate_nooped_plural( $this->strings[$type], $count, $this->domain ), $imploded, $count ) . '</p>'; // All messages now stored\r\n                    }\r\n\r\n                    /** Setup variables to determine if action links are needed */\r\n                    $show_install_link  = $install_link ? '<a href=\"' . add_query_arg( 'page', $this->menu, admin_url( $this->parent_url_slug ) ) . '\">' . translate_nooped_plural( $this->strings['install_link'], $install_link_count, $this->domain ) . '</a>' : '';\r\n                    $show_activate_link = $activate_link ? '<a href=\"' . admin_url( 'plugins.php' ) . '\">' . translate_nooped_plural( $this->strings['activate_link'], $activate_link_count, $this->domain ) . '</a>'  : '';\r\n\r\n                    /** Define all of the action links */\r\n                    $action_links = apply_filters(\r\n                        'tgmpa_notice_action_links',\r\n                        array(\r\n                            'install'  => ( current_user_can( 'install_plugins' ) ) ? $show_install_link : '',\r\n                            'activate' => ( current_user_can( 'activate_plugins' ) ) ? $show_activate_link : '',\r\n                            'dismiss'  => '<a class=\"dismiss-notice\" href=\"' . add_query_arg( 'tgmpa-dismiss', 'dismiss_admin_notices' ) . '\" target=\"_parent\">' . __( 'Dismiss this notice', $this->domain ) . '</a>',\r\n                        )\r\n                    );\r\n\r\n                    $action_links = array_filter( $action_links ); // Remove any empty array items\r\n                    if ( $action_links )\r\n                        $rendered .= '<p>' . implode( ' | ', $action_links ) . '</p>';\r\n\r\n                    /** Register the nag messages and prepare them to be processed */\r\n                    add_settings_error( 'tgmpa', 'tgmpa', $rendered, 'updated' );\r\n                }\r\n            }\r\n\r\n            /** Admin options pages already output settings_errors, so this is to avoid duplication */\r\n            if ( 'options-general' !== $current_screen->parent_base )\r\n                settings_errors( 'tgmpa' );\r\n\r\n        }\r\n\r\n        /**\r\n         * Add dismissable admin notices.\r\n         *\r\n         * Appends a link to the admin nag messages. If clicked, the admin notice disappears and no longer is visible to users.\r\n         *\r\n         * @since 2.1.0\r\n         */\r\n        public function dismiss() {\r\n\r\n            if ( isset( $_GET[sanitize_key( 'tgmpa-dismiss' )] ) )\r\n                update_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice', 1 );\r\n\r\n        }\r\n\r\n        /**\r\n         * Add individual plugin to our collection of plugins.\r\n         *\r\n         * If the required keys are not set, the plugin is not added.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @param array $plugin Array of plugin arguments.\r\n         */\r\n        public function register( $plugin ) {\r\n\r\n            if ( ! isset( $plugin['slug'] ) || ! isset( $plugin['name'] ) )\r\n                return;\r\n\r\n            $this->plugins[] = $plugin;\r\n\r\n        }\r\n\r\n        /**\r\n         * Amend default configuration settings.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @param array $config\r\n         */\r\n        public function config( $config ) {\r\n\r\n            $keys = array( 'default_path', 'parent_menu_slug', 'parent_url_slug', 'domain', 'has_notices', 'menu', 'is_automatic', 'message', 'strings' );\r\n\r\n            foreach ( $keys as $key ) {\r\n                if ( isset( $config[$key] ) ) {\r\n                    if ( is_array( $config[$key] ) ) {\r\n                        foreach ( $config[$key] as $subkey => $value )\r\n                            $this->{$key}[$subkey] = $value;\r\n                    } else {\r\n                        $this->$key = $config[$key];\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Amend action link after plugin installation.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @param array $install_actions Existing array of actions\r\n         * @return array Amended array of actions\r\n         */\r\n        public function actions( $install_actions ) {\r\n\r\n            /** Remove action links on the TGMPA install page */\r\n            if ( $this->is_tgmpa_page() )\r\n                return false;\r\n\r\n            return $install_actions;\r\n\r\n        }\r\n\r\n        /**\r\n         * Set file_path key for each installed plugin.\r\n         *\r\n         * @since 2.1.0\r\n         */\r\n        public function populate_file_path() {\r\n\r\n            /** Add file_path key for all plugins */\r\n            foreach ( $this->plugins as $plugin => $values )\r\n                $this->plugins[$plugin]['file_path'] = $this->_get_plugin_basename_from_slug( $values['slug'] );\r\n\r\n        }\r\n\r\n        /**\r\n         * Helper function to extract the file path of the plugin file from the\r\n         * plugin slug, if the plugin is installed.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @param string $slug Plugin slug (typically folder name) as provided by the developer\r\n         * @return string Either file path for plugin if installed, or just the plugin slug\r\n         */\r\n        protected function _get_plugin_basename_from_slug( $slug ) {\r\n\r\n            $keys = array_keys( get_plugins() );\r\n\r\n            foreach ( $keys as $key ) {\r\n                if ( preg_match( '|^' . $slug .'|', $key ) )\r\n                    return $key;\r\n            }\r\n\r\n            return $slug;\r\n\r\n        }\r\n\r\n        /**\r\n         * Retrieve plugin data, given the plugin name.\r\n         *\r\n         * Loops through the registered plugins looking for $name. If it finds it,\r\n         * it returns the $data from that plugin. Otherwise, returns false.\r\n         *\r\n         * @since 2.1.0\r\n         *\r\n         * @param string $name Name of the plugin, as it was registered\r\n         * @param string $data Optional. Array key of plugin data to return. Default is slug\r\n         * @return string|boolean Plugin slug if found, false otherwise.\r\n         */\r\n        protected function _get_plugin_data_from_name( $name, $data = 'slug' ) {\r\n\r\n            foreach ( $this->plugins as $plugin => $values ) {\r\n                if ( $name == $values['name'] && isset( $values[$data] ) )\r\n                    return $values[$data];\r\n            }\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n        /**\r\n         * Determine if we're on the TGMPA Install page.\r\n         *\r\n         * We use $current_screen when it is available, and a slightly less ideal\r\n         * conditional when it isn't (like when displaying the plugin information\r\n         * thickbox).\r\n         *\r\n         * @since 2.1.0\r\n         *\r\n         * @global object $current_screen\r\n         * @return boolean True when on the TGMPA page, false otherwise.\r\n         */\r\n        protected function is_tgmpa_page() {\r\n\r\n            global $current_screen;\r\n\r\n            if ( ! is_null( $current_screen ) && $this->parent_menu_slug == $current_screen->parent_file && isset( $_GET['page'] ) && $this->menu === $_GET['page'] )\r\n                return true;\r\n\r\n            if ( isset( $_GET['page'] ) && $this->menu === $_GET['page'] )\r\n                return true;\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n        /**\r\n         * Delete dismissable nag option when theme is switched.\r\n         *\r\n         * This ensures that the user is again reminded via nag of required\r\n         * and/or recommended plugins if they re-activate the theme.\r\n         *\r\n         * @since 2.1.1\r\n         */\r\n        public function update_dismiss() {\r\n\r\n            delete_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice' );\r\n\r\n        }\r\n\r\n        /**\r\n         * Forces plugin activation if the parameter 'force_activation' is\r\n         * set to true.\r\n         *\r\n         * This allows theme authors to specify certain plugins that must be\r\n         * active at all times while using the current theme.\r\n         *\r\n         * Please take special care when using this parameter as it has the\r\n         * potential to be harmful if not used correctly. Setting this parameter\r\n         * to true will not allow the specified plugin to be deactivated unless\r\n         * the user switches themes.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function force_activation() {\r\n\r\n            /** Set file_path parameter for any installed plugins */\r\n            $this->populate_file_path();\r\n            \r\n            $installed_plugins = get_plugins();\r\n\r\n            foreach ( $this->plugins as $plugin ) {\r\n                /** Oops, plugin isn't there so iterate to next condition */\r\n                if ( isset( $plugin['force_activation'] ) && $plugin['force_activation'] && ! isset( $installed_plugins[$plugin['file_path']] ) )\r\n                    continue;\r\n                /** There we go, activate the plugin */\r\n                elseif ( isset( $plugin['force_activation'] ) && $plugin['force_activation'] && is_plugin_inactive( $plugin['file_path'] ) )\r\n                    activate_plugin( $plugin['file_path'] );\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Forces plugin deactivation if the parameter 'force_deactivation'\r\n         * is set to true.\r\n         *\r\n         * This allows theme authors to specify certain plugins that must be\r\n         * deactived upon switching from the current theme to another.\r\n         *\r\n         * Please take special care when using this parameter as it has the\r\n         * potential to be harmful if not used correctly.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function force_deactivation() {\r\n\r\n            /** Set file_path parameter for any installed plugins */\r\n            $this->populate_file_path();\r\n\r\n            foreach ( $this->plugins as $plugin ) {\r\n                /** Only proceed forward if the paramter is set to true and plugin is active */\r\n                if ( isset( $plugin['force_deactivation'] ) && $plugin['force_deactivation'] && is_plugin_active( $plugin['file_path'] ) )\r\n                    deactivate_plugins( $plugin['file_path'] );\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/** Create a new instance of the class */\r\nnew TGM_Plugin_Activation;\r\n\r\nif ( ! function_exists( 'tgmpa' ) ) {\r\n    /**\r\n     * Helper function to register a collection of required plugins.\r\n     *\r\n     * @since 2.0.0\r\n     * @api\r\n     *\r\n     * @param array $plugins An array of plugin arrays\r\n     * @param array $config Optional. An array of configuration values\r\n     */\r\n    function tgmpa( $plugins, $config = array() ) {\r\n\r\n        foreach ( $plugins as $plugin )\r\n            TGM_Plugin_Activation::$instance->register( $plugin );\r\n\r\n        if ( $config )\r\n            TGM_Plugin_Activation::$instance->config( $config );\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * WP_List_Table isn't always available. If it isn't available,\r\n * we load it here.\r\n *\r\n * @since 2.2.0\r\n */\r\nif ( ! class_exists( 'WP_List_Table' ) )\r\n    require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' );\r\n\r\nif ( ! class_exists( 'TGMPA_List_Table' ) ) {\r\n    /**\r\n     * List table class for handling plugins.\r\n     *\r\n     * Extends the WP_List_Table class to provide a future-compatible\r\n     * way of listing out all required/recommended plugins.\r\n     *\r\n     * Gives users an interface similar to the Plugin Administration\r\n     * area with similar (albeit stripped down) capabilities.\r\n     *\r\n     * This class also allows for the bulk install of plugins.\r\n     *\r\n     * @since 2.2.0\r\n     *\r\n     * @package TGM-Plugin-Activation\r\n     * @author Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n     * @author Gary Jones <gamajo@gamajo.com>\r\n     */\r\n    class TGMPA_List_Table extends WP_List_Table {\r\n\r\n        /**\r\n         * References parent constructor and sets defaults for class.\r\n         *\r\n         * The constructor also grabs a copy of $instance from the TGMPA class\r\n         * and stores it in the global object TGM_Plugin_Activation::$instance.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @global unknown $status\r\n         * @global string $page\r\n         */\r\n        public function __construct() {\r\n\r\n            global $status, $page;\r\n\r\n            parent::__construct(\r\n                array(\r\n                    'singular' => 'plugin',\r\n                    'plural'   => 'plugins',\r\n                    'ajax'     => false,\r\n                )\r\n            );\r\n\r\n        }\r\n\r\n        /**\r\n         * Gathers and renames all of our plugin information to be used by\r\n         * WP_List_Table to create our table.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @return array $table_data Information for use in table\r\n         */\r\n        protected function _gather_plugin_data() {\r\n\r\n            /** Load thickbox for plugin links */\r\n            TGM_Plugin_Activation::$instance->admin_init();\r\n            TGM_Plugin_Activation::$instance->thickbox();\r\n\r\n            /** Prep variables for use and grab list of all installed plugins */\r\n            $table_data = array();\r\n            $i = 0;\r\n            $installed_plugins = get_plugins();\r\n\r\n            foreach ( TGM_Plugin_Activation::$instance->plugins as $plugin ) {\r\n                if ( is_plugin_active( $plugin['file_path'] ) )\r\n                    continue; // No need to display plugins if they are installed and activated\r\n\r\n                $table_data[$i]['sanitized_plugin'] = $plugin['name'];\r\n                $table_data[$i]['slug'] = $this->_get_plugin_data_from_name( $plugin['name'] );\r\n\r\n                $external_url = $this->_get_plugin_data_from_name( $plugin['name'], 'external_url' );\r\n                $source = $this->_get_plugin_data_from_name( $plugin['name'], 'source' );\r\n\r\n                if ( $external_url && preg_match( '|^http(s)?://|', $external_url ) ) {\r\n                    $table_data[$i]['plugin'] = '<strong><a href=\"' . esc_url( $external_url ) . '\" title=\"' . $plugin['name'] . '\" target=\"_blank\">' . $plugin['name'] . '</a></strong>';\r\n                }\r\n                elseif ( ! $source || preg_match( '|^http://wordpress.org/extend/plugins/|', $source ) ) {\r\n                    $url = add_query_arg(\r\n                        array(\r\n                            'tab'       => 'plugin-information',\r\n                            'plugin'    => $this->_get_plugin_data_from_name( $plugin['name'] ),\r\n                            'TB_iframe' => 'true',\r\n                            'width'     => '640',\r\n                            'height'    => '500',\r\n                        ),\r\n                        admin_url( 'plugin-install.php' )\r\n                    );\r\n\r\n                    $table_data[$i]['plugin'] = '<strong><a href=\"' . esc_url( $url ) . '\" class=\"thickbox\" title=\"' . $plugin['name'] . '\">' . $plugin['name'] . '</a></strong>';\r\n                }\r\n                else {\r\n                    $table_data[$i]['plugin'] = '<strong>' . $plugin['name'] . '</strong>'; // No hyperlink\r\n                }\r\n\r\n                if ( isset( $table_data[$i]['plugin'] ) && (array) $table_data[$i]['plugin'] )\r\n                    $plugin['name'] = $table_data[$i]['plugin'];\r\n\r\n                if ( isset( $plugin['external_url'] ) ) {\r\n                    /** The plugin is linked to an external source */\r\n                    $table_data[$i]['source'] = __( 'External Link', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n                elseif ( isset( $plugin['source'] ) ) {\r\n                    /** The plugin must be from a private repository */\r\n                    if ( preg_match( '|^http(s)?://|', $plugin['source'] ) )\r\n                        $table_data[$i]['source'] = __( 'Private Repository', TGM_Plugin_Activation::$instance->domain );\r\n                    /** The plugin is pre-packaged with the theme */\r\n                    else\r\n                        $table_data[$i]['source'] = __( 'Pre-Packaged', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n                /** The plugin is from the WordPress repository */\r\n                else {\r\n                    $table_data[$i]['source'] = __( 'WordPress Repository', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n\r\n                $table_data[$i]['type'] = $plugin['required'] ? __( 'Required', TGM_Plugin_Activation::$instance->domain ) : __( 'Recommended', TGM_Plugin_Activation::$instance->domain );\r\n\r\n                if ( ! isset( $installed_plugins[$plugin['file_path']] ) )\r\n                    $table_data[$i]['status'] = sprintf( '%1$s', __( 'Not Installed', TGM_Plugin_Activation::$instance->domain ) );\r\n                elseif ( is_plugin_inactive( $plugin['file_path'] ) )\r\n                    $table_data[$i]['status'] = sprintf( '%1$s', __( 'Installed But Not Activated', TGM_Plugin_Activation::$instance->domain ) );\r\n\r\n                $table_data[$i]['file_path'] = $plugin['file_path'];\r\n                $table_data[$i]['url'] = isset( $plugin['source'] ) ? $plugin['source'] : 'repo';\r\n\r\n                $i++;\r\n            }\r\n            \r\n            /** Sort plugins by Required/Recommended type and by alphabetical listing within each type */\r\n            $resort = array();\r\n            $req = array();\r\n            $rec = array();\r\n            \r\n            /** Grab all the plugin types */\r\n            foreach ( $table_data as $plugin )\r\n                $resort[] = $plugin['type'];\r\n            \r\n            /** Sort each plugin by type */\r\n            foreach ( $resort as $type )\r\n                if ( 'Required' == $type )\r\n                    $req[] = $type;\r\n                else\r\n                    $rec[] = $type;\r\n            \r\n            /** Sort alphabetically each plugin type array, merge them and then sort in reverse\t(lists Required plugins first) */\t\r\n            sort( $req );\r\n            sort( $rec );\r\n            array_merge( $resort, $req, $rec );\r\n            array_multisort( $resort, SORT_DESC, $table_data );\r\n\r\n            return $table_data;\r\n\r\n        }\r\n\r\n        /**\r\n         * Retrieve plugin data, given the plugin name. Taken from the\r\n         * TGM_Plugin_Activation class.\r\n         *\r\n         * Loops through the registered plugins looking for $name. If it finds it,\r\n         * it returns the $data from that plugin. Otherwise, returns false.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @param string $name Name of the plugin, as it was registered\r\n         * @param string $data Optional. Array key of plugin data to return. Default is slug\r\n         * @return string|boolean Plugin slug if found, false otherwise\r\n         */\r\n        protected function _get_plugin_data_from_name( $name, $data = 'slug' ) {\r\n\r\n            foreach ( TGM_Plugin_Activation::$instance->plugins as $plugin => $values ) {\r\n                if ( $name == $values['name'] && isset( $values[$data] ) )\r\n                    return $values[$data];\r\n            }\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n        /**\r\n         * Create default columns to display important plugin information\r\n         * like type, action and status.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @param array $item\r\n         * @param string $column_name\r\n         */\r\n        public function column_default( $item, $column_name ) {\r\n\r\n            switch ( $column_name ) {\r\n                case 'source':\r\n                case 'type':\r\n                case 'status':\r\n                    return $item[$column_name];\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Create default title column along with action links of 'Install'\r\n         * and 'Activate'.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @param array $item\r\n         * @return string The action hover links\r\n         */\r\n        public function column_plugin( $item ) {\r\n\r\n            $installed_plugins = get_plugins();\r\n\r\n            /** No need to display any hover links */\r\n            if ( is_plugin_active( $item['file_path'] ) )\r\n                $actions = array();\r\n\r\n            /** We need to display the 'Install' hover link */\r\n            if ( ! isset( $installed_plugins[$item['file_path']] ) ) {\r\n                $actions = array(\r\n                    'install' => sprintf(\r\n                        '<a href=\"%1$s\" title=\"Install %2$s\">Install</a>',\r\n                        wp_nonce_url(\r\n                            add_query_arg(\r\n                                array(\r\n                                    'page'          => TGM_Plugin_Activation::$instance->menu,\r\n                                    'plugin'        => $item['slug'],\r\n                                    'plugin_name'   => $item['sanitized_plugin'],\r\n                                    'plugin_source' => $item['url'],\r\n                                    'tgmpa-install' => 'install-plugin',\r\n                                ),\r\n                                admin_url( TGM_Plugin_Activation::$instance->parent_url_slug )\r\n                            ),\r\n                            'tgmpa-install'\r\n                        ),\r\n                        $item['sanitized_plugin']\r\n                    ),\r\n                );\r\n            }\r\n            /** We need to display the 'Activate' hover link */\r\n            elseif ( is_plugin_inactive( $item['file_path'] ) ) {\r\n                $actions = array(\r\n                    'activate' => sprintf(\r\n                        '<a href=\"%1$s\" title=\"Activate %2$s\">Activate</a>',\r\n                        add_query_arg(\r\n                            array(\r\n                                'page'                 => TGM_Plugin_Activation::$instance->menu,\r\n                                'plugin'               => $item['slug'],\r\n                                'plugin_name'          => $item['sanitized_plugin'],\r\n                                'plugin_source'        => $item['url'],\r\n                                'tgmpa-activate'       => 'activate-plugin',\r\n                                'tgmpa-activate-nonce' => wp_create_nonce( 'tgmpa-activate' ),\r\n                            ),\r\n                            admin_url( TGM_Plugin_Activation::$instance->parent_url_slug )\r\n                        ),\r\n                        $item['sanitized_plugin']\r\n                    ),\r\n                );\r\n            }\r\n\r\n            return sprintf( '%1$s %2$s', $item['plugin'], $this->row_actions( $actions ) );\r\n\r\n        }\r\n\r\n        /**\r\n         * Required for bulk installing.\r\n         *\r\n         * Adds a checkbox for each plugin.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @param array $item\r\n         * @return string The input checkbox with all necessary info\r\n         */\r\n        public function column_cb( $item ) {\r\n\r\n            $value = $item['file_path'] . ',' . $item['url'] . ',' . $item['sanitized_plugin'];\r\n            return sprintf( '<input type=\"checkbox\" name=\"%1$s[]\" value=\"%2$s\" id=\"%3$s\" />', $this->_args['singular'], $value, $item['sanitized_plugin'] );\r\n\r\n        }\r\n\r\n        /**\r\n         * Sets default message within the plugins table if no plugins\r\n         * are left for interaction.\r\n         *\r\n         * Hides the menu item to prevent the user from clicking and\r\n         * getting a permissions error.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function no_items() {\r\n\r\n            printf( __( 'No plugins to install or activate. <a href=\"%1$s\" title=\"Return to the Dashboard\">Return to the Dashboard</a>', TGM_Plugin_Activation::$instance->domain ), admin_url() );\r\n            echo '<style type=\"text/css\">#adminmenu .wp-submenu li.current { display: none !important; }</style>';\r\n\r\n        }\r\n\r\n        /**\r\n         * Output all the column information within the table.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @return array $columns The column names\r\n         */\r\n        public function get_columns() {\r\n\r\n            $columns = array(\r\n                'cb'     => '<input type=\"checkbox\" />',\r\n                'plugin' => __( 'Plugin', TGM_Plugin_Activation::$instance->domain ),\r\n                'source' => __( 'Source', TGM_Plugin_Activation::$instance->domain ),\r\n                'type'   => __( 'Type', TGM_Plugin_Activation::$instance->domain ),\r\n                'status' => __( 'Status', TGM_Plugin_Activation::$instance->domain )\r\n            );\r\n\r\n            return $columns;\r\n\r\n        }\r\n\r\n        /**\r\n         * Defines all types of bulk actions for handling\r\n         * registered plugins.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @return array $actions The bulk actions for the plugin install table\r\n         */\r\n        public function get_bulk_actions() {\r\n\r\n            $actions = array(\r\n                'tgmpa-bulk-install'  => __( 'Install', TGM_Plugin_Activation::$instance->domain ),\r\n                'tgmpa-bulk-activate' => __( 'Activate', TGM_Plugin_Activation::$instance->domain ),\r\n            );\r\n\r\n            return $actions;\r\n\r\n        }\r\n\r\n        /**\r\n         * Processes bulk installation and activation actions.\r\n         *\r\n         * The bulk installation process looks either for the $_POST\r\n         * information or for the plugin info within the $_GET variable if\r\n         * a user has to use WP_Filesystem to enter their credentials.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function process_bulk_actions() {\r\n\r\n            /** Bulk installation process */\r\n            if ( 'tgmpa-bulk-install' === $this->current_action() ) {\r\n                check_admin_referer( 'bulk-' . $this->_args['plural'] );\r\n\r\n                /** Prep variables to be populated */\r\n                $plugins_to_install = array();\r\n                $plugin_installs    = array();\r\n                $plugin_path        = array();\r\n                $plugin_name        = array();\r\n\r\n                /** Look first to see if information has been passed via WP_Filesystem */\r\n                if ( isset( $_GET[sanitize_key( 'plugins' )] ) )\r\n                    $plugins = explode( ',', stripslashes( $_GET[sanitize_key( 'plugins' )] ) );\r\n                /** Looks like the user can use the direct method, take from $_POST */\r\n                elseif ( isset( $_POST[sanitize_key( 'plugin' )] ) )\r\n                    $plugins = (array) $_POST[sanitize_key( 'plugin' )];\r\n                /** Nothing has been submitted */\r\n                else\r\n                    $plugins = array();\r\n\r\n                $a = 0; // Incremental variable\r\n\r\n                /** Grab information from $_POST if available */\r\n                if ( isset( $_POST[sanitize_key( 'plugin' )] ) ) {\r\n                    foreach ( $plugins as $plugin_data )\r\n                        $plugins_to_install[] = explode( ',', $plugin_data );\r\n\r\n                    foreach ( $plugins_to_install as $plugin_data ) {\r\n                        $plugin_installs[] = $plugin_data[0];\r\n                        $plugin_path[]     = $plugin_data[1];\r\n                        $plugin_name[]     = $plugin_data[2];\r\n                    }\r\n                }\r\n                /** Information has been passed via $_GET */\r\n                else {\r\n                    foreach ( $plugins as $key => $value ) {\r\n                        /** Grab plugin slug for each plugin */\r\n                        if ( 0 == $key % 3 || 0 == $key ) {\r\n                            $plugins_to_install[] = $value;\r\n                            $plugin_installs[]    = $value;\r\n                        }\r\n                        $a++;\r\n                    }\r\n                }\r\n\r\n                /** Look first to see if information has been passed via WP_Filesystem */\r\n                if ( isset( $_GET[sanitize_key( 'plugin_paths' )] ) )\r\n                    $plugin_paths = explode( ',', stripslashes( $_GET[sanitize_key( 'plugin_paths' )] ) );\r\n                /** Looks like the user doesn't need to enter his FTP creds */\r\n                elseif ( isset( $_POST[sanitize_key( 'plugin' )] ) )\r\n                    $plugin_paths = (array) $plugin_path;\r\n                /** Nothing has been submitted */\r\n                else\r\n                    $plugin_paths = array();\r\n\r\n                /** Look first to see if information has been passed via WP_Filesystem */\r\n                if ( isset( $_GET[sanitize_key( 'plugin_names' )] ) )\r\n                    $plugin_names = explode( ',', stripslashes( $_GET[sanitize_key( 'plugin_names' )] ) );\r\n                /** Looks like the user doesn't need to enter his FTP creds */\r\n                elseif ( isset( $_POST[sanitize_key( 'plugin' )] ) )\r\n                    $plugin_names = (array) $plugin_name;\r\n                /** Nothing has been submitted */\r\n                else\r\n                    $plugin_names = array();\r\n\r\n                $b = 0; // Incremental variable\r\n\r\n                /** Loop through plugin slugs and remove already installed plugins from the list */\r\n                foreach ( $plugin_installs as $key => $plugin ) {\r\n                    if ( preg_match( '|.php$|', $plugin ) ) {\r\n                        unset( $plugin_installs[$key] );\r\n\r\n                        /** If the plugin path isn't in the $_GET variable, we can unset the corresponding path */\r\n                        if ( ! isset( $_GET[sanitize_key( 'plugin_paths' )] ) )\r\n                            unset( $plugin_paths[$b] );\r\n\r\n                        /** If the plugin name isn't in the $_GET variable, we can unset the corresponding name */\r\n                        if ( ! isset( $_GET[sanitize_key( 'plugin_names' )] ) )\r\n                            unset( $plugin_names[$b] );\r\n                    }\r\n                    $b++;\r\n                }\r\n\r\n                /** No need to proceed further if we have no plugins to install */\r\n                if ( empty( $plugin_installs ) )\r\n                    return false;\r\n\r\n                /** Reset array indexes in case we removed already installed plugins */\r\n                $plugin_installs = array_values( $plugin_installs );\r\n                $plugin_paths    = array_values( $plugin_paths );\r\n                $plugin_names    = array_values( $plugin_names );\r\n\r\n                /** If we grabbed our plugin info from $_GET, we need to decode it for use */\r\n                $plugin_installs = array_map( 'urldecode', $plugin_installs );\r\n                $plugin_paths    = array_map( 'urldecode', $plugin_paths );\r\n                $plugin_names    = array_map( 'urldecode', $plugin_names );\r\n\r\n                /** Pass all necessary information via URL if WP_Filesystem is needed */\r\n                $url = wp_nonce_url(\r\n                    add_query_arg(\r\n                        array(\r\n                            'page' \t\t\t=> TGM_Plugin_Activation::$instance->menu,\r\n                            'tgmpa-action' \t=> 'install-selected',\r\n                            'plugins' \t\t=> urlencode( implode( ',', $plugins ) ),\r\n                            'plugin_paths' \t=> urlencode( implode( ',', $plugin_paths ) ),\r\n                            'plugin_names' \t=> urlencode( implode( ',', $plugin_names ) ),\r\n                        ),\r\n                        admin_url( TGM_Plugin_Activation::$instance->parent_url_slug )\r\n                    ),\r\n                    'bulk-plugins'\r\n                );\r\n                $method = ''; // Leave blank so WP_Filesystem can populate it as necessary\r\n                $fields = array( sanitize_key( 'action' ), sanitize_key( '_wp_http_referer' ), sanitize_key( '_wpnonce' ) ); // Extra fields to pass to WP_Filesystem\r\n\r\n                if ( false === ( $creds = request_filesystem_credentials( $url, $method, false, false, $fields ) ) )\r\n                    return true;\r\n\r\n                if ( ! WP_Filesystem( $creds ) ) {\r\n                    request_filesystem_credentials( $url, $method, true, false, $fields ); // Setup WP_Filesystem\r\n                    return true;\r\n                }\r\n\r\n                require_once ABSPATH . 'wp-admin/includes/plugin-install.php'; // Need for plugins_api\r\n                require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'; // Need for upgrade classes\r\n\r\n                /** Store all information in arrays since we are processing a bulk installation */\r\n                $api          = array();\r\n                $sources      = array();\r\n                $install_path = array();\r\n\r\n                $c = 0; // Incremental variable\r\n\r\n                /** Loop through each plugin to install and try to grab information from WordPress API, if not create 'tgmpa-empty' scalar */\r\n                foreach ( $plugin_installs as $plugin ) {\r\n                    $api[$c] = plugins_api( 'plugin_information', array( 'slug' => $plugin, 'fields' => array( 'sections' => false ) ) ) ? plugins_api( 'plugin_information', array( 'slug' => $plugin, 'fields' => array( 'sections' => false ) ) ) : (object) $api[$c] = 'tgmpa-empty';\r\n                    $c++;\r\n                }\r\n\r\n                if ( is_wp_error( $api ) )\r\n                    wp_die( TGM_Plugin_Activation::$instance->strings['oops'] . var_dump( $api ) );\r\n\r\n                $d = 0;\t// Incremental variable\r\n\r\n                /** Capture download links from $api or set install link to pre-packaged/private repo */\r\n                foreach ( $api as $object ) {\r\n                    $sources[$d] = isset( $object->download_link ) ? $object->download_link : $plugin_paths[$d];\r\n                    $d++;\r\n                }\r\n\r\n                /** Finally, all the data is prepared to be sent to the installer */\r\n                $url   = add_query_arg( array( 'page' => TGM_Plugin_Activation::$instance->menu ), admin_url( TGM_Plugin_Activation::$instance->parent_url_slug ) );\r\n                $nonce = 'bulk-plugins';\r\n                $names = $plugin_names;\r\n\r\n                /** Create a new instance of TGM_Bulk_Installer */\r\n                $installer = new TGM_Bulk_Installer( $skin = new TGM_Bulk_Installer_Skin( compact( 'url', 'nonce', 'names' ) ) );\r\n\r\n                /** Wrap the install process with the appropriate HTML */\r\n                echo '<div class=\"tgmpa wrap\">';\r\n                    screen_icon( apply_filters( 'tgmpa_default_screen_icon', 'themes' ) );\r\n                    echo '<h2>' . esc_html( get_admin_page_title() ) . '</h2>';\r\n                    /** Process the bulk installation submissions */\r\n                    $installer->bulk_install( $sources );\r\n                echo '</div>';\r\n\r\n                return true;\r\n            }\r\n\r\n            /** Bulk activation process */\r\n            if ( 'tgmpa-bulk-activate' === $this->current_action() ) {\r\n                check_admin_referer( 'bulk-' . $this->_args['plural'] );\r\n\r\n                /** Grab plugin data from $_POST */\r\n                $plugins             = isset( $_POST[sanitize_key( 'plugin' )] ) ? (array) $_POST[sanitize_key( 'plugin' )] : array();\r\n                $plugins_to_activate = array();\r\n\r\n                /** Split plugin value into array with plugin file path, plugin source and plugin name */\r\n                foreach ( $plugins as $i => $plugin )\r\n                    $plugins_to_activate[] = explode( ',', $plugin );\r\n\r\n                foreach ( $plugins_to_activate as $i => $array ) {\r\n                    if ( ! preg_match( '|.php$|', $array[0] ) ) // Plugins that haven't been installed yet won't have the correct file path\r\n                        unset( $plugins_to_activate[$i] );\r\n                }\r\n\r\n                /** Return early if there are no plugins to activate */\r\n                if ( empty( $plugins_to_activate ) )\r\n                    return;\r\n\r\n                $plugins      = array();\r\n                $plugin_names = array();\r\n\r\n                foreach ( $plugins_to_activate as $plugin_string ) {\r\n                    $plugins[] = $plugin_string[0];\r\n                    $plugin_names[] = $plugin_string[2];\r\n                }\r\n\r\n                $count = count( $plugin_names ); // Count so we can use _n function\r\n                $last_plugin = array_pop( $plugin_names ); // Pop off last name to prep for readability\r\n                $imploded    = empty( $plugin_names ) ? '<strong>' . $last_plugin . '</strong>' : '<strong>' . ( implode( ', ', $plugin_names ) . '</strong> and <strong>' . $last_plugin . '</strong>.' );\r\n\r\n                /** Now we are good to go - let's start activating plugins */\r\n                $activate = activate_plugins( $plugins );\r\n\r\n                if ( is_wp_error( $activate ) )\r\n                    echo '<div id=\"message\" class=\"error\"><p>' . $activate->get_error_message() . '</p></div>';\r\n                else\r\n                    printf( '<div id=\"message\" class=\"updated\"><p>%1$s %2$s</p></div>', _n( 'The following plugin was activated successfully:', 'The following plugins were activated successfully:', $count, TGM_Plugin_Activation::$instance->domain ), $imploded );\r\n\r\n \t\t\t\t/** Update recently activated plugins option */\r\n                $recent = (array) get_option( 'recently_activated' );\r\n\r\n                foreach ( $plugins as $plugin => $time )\r\n                    if ( isset( $recent[$plugin] ) )\r\n                        unset( $recent[$plugin] );\r\n\r\n                update_option( 'recently_activated', $recent );\r\n\r\n                unset( $_POST ); // Reset the $_POST variable in case user wants to perform one action after another\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Prepares all of our information to be outputted into a usable table.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function prepare_items() {\r\n\r\n            $per_page              = 100; // Set it high so we shouldn't have to worry about pagination\r\n            $columns               = $this->get_columns(); // Get all necessary column information\r\n            $hidden                = array(); // No columns to hide, but we must set as an array\r\n            $sortable              = array(); // No reason to make sortable columns\r\n            $this->_column_headers = array( $columns, $hidden, $sortable ); // Get all necessary column headers\r\n\r\n            /** Process our bulk actions here */\r\n            $this->process_bulk_actions();\r\n\r\n            /** Store all of our plugin data into $items array so WP_List_Table can use it */\r\n            $this->items = $this->_gather_plugin_data();\r\n\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * The WP_Upgrader file isn't always available. If it isn't available,\r\n * we load it here.\r\n *\r\n * We check to make sure no action or activation keys are set so that WordPress\r\n * doesn't try to re-include the class when processing upgrades or installs outside\r\n * of the class.\r\n *\r\n * @since 2.2.0\r\n */\r\nif ( ! class_exists( 'WP_Upgrader' ) && ( isset( $_GET[sanitize_key( 'page' )] ) && TGM_Plugin_Activation::$instance->menu = $_GET[sanitize_key( 'page' )] ) ) {\r\n    require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php';\r\n\r\n    if ( ! class_exists( 'TGM_Bulk_Installer' ) ) {\r\n        /**\r\n         * Installer class to handle bulk plugin installations.\r\n         *\r\n         * Extends WP_Upgrader and customizes to suit the installation of multiple\r\n         * plugins.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @package TGM-Plugin-Activation\r\n         * @author Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n         * @author Gary Jones <gamajo@gamajo.com>\r\n         */\r\n        class TGM_Bulk_Installer extends WP_Upgrader {\r\n\r\n            /**\r\n     \t\t * Holds result of bulk plugin installation.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var string\r\n     \t\t */\r\n            public $result;\r\n\r\n            /**\r\n     \t\t * Flag to check if bulk installation is occurring or not.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var boolean\r\n     \t\t */\r\n            public $bulk = false;\r\n\r\n            /**\r\n     \t\t * Processes the bulk installation of plugins.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @param array $packages The plugin sources needed for installation\r\n     \t\t * @return string|boolean Install confirmation messages on success, false on failure\r\n     \t\t */\r\n            public function bulk_install( $packages ) {\r\n\r\n                /** Pass installer skin object and set bulk property to true */\r\n                $this->init();\r\n                $this->bulk = true;\r\n\r\n                /** Set install strings and automatic activation strings (if config option is set to true) */\r\n                $this->install_strings();\r\n                if ( TGM_Plugin_Activation::$instance->is_automatic )\r\n                    $this->activate_strings();\r\n\r\n                /** Run the header string to notify user that the process has begun */\r\n                $this->skin->header();\r\n\r\n                /** Connect to the Filesystem */\r\n                $res = $this->fs_connect( array( WP_CONTENT_DIR, WP_PLUGIN_DIR ) );\r\n                if ( ! $res ) {\r\n                    $this->skin->footer();\r\n                    return false;\r\n                }\r\n\r\n                /** Set the bulk header and prepare results array */\r\n                $this->skin->bulk_header();\r\n                $results = array();\r\n\r\n                /** Get the total number of packages being processed and iterate as each package is successfully installed */\r\n                $this->update_count   = count( $packages );\r\n                $this->update_current = 0;\r\n\r\n                /** Loop through each plugin and process the installation */\r\n                foreach ( $packages as $plugin ) {\r\n                    $this->update_current++; // Increment counter\r\n\r\n                    /** Do the plugin install */\r\n                    $result = $this->run(\r\n                        array(\r\n                            'package'           => $plugin, // The plugin source\r\n                            'destination'       => WP_PLUGIN_DIR, // The destination dir\r\n                            'clear_destination' => false, // Do we want to clear the destination or not?\r\n                            'clear_working'     => true, // Remove original install file\r\n                            'is_multi'          => true, // Are we processing multiple installs?\r\n                            'hook_extra'        => array( 'plugin' => $plugin, ), // Pass plugin source as extra data\r\n                        )\r\n                    );\r\n\r\n                    /** Store installation results in result property */\r\n                    $results[$plugin] = $this->result;\r\n\r\n                    /** Prevent credentials auth screen from displaying multiple times */\r\n                    if ( false === $result )\r\n                        break;\r\n                }\r\n\r\n                /** Pass footer skin strings */\r\n                $this->skin->bulk_footer();\r\n                $this->skin->footer();\r\n\r\n                /** Return our results */\r\n                return $results;\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Performs the actual installation of each plugin.\r\n     \t\t *\r\n     \t\t * This method also activates the plugin in the automatic flag has been\r\n     \t\t * set to true for the TGMPA class.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @param array $options The installation cofig options\r\n     \t\t * @return null/array Return early if error, array of installation data on success\r\n     \t\t */\r\n            public function run( $options ) {\r\n\r\n                /** Default config options */\r\n                $defaults = array(\r\n                    'package'           => '',\r\n                    'destination'       => '',\r\n                    'clear_destination' => false,\r\n                    'clear_working'     => true,\r\n                    'is_multi'          => false,\r\n                    'hook_extra'        => array(),\r\n                );\r\n\r\n                /** Parse default options with config options from $this->bulk_upgrade and extract them */\r\n                $options = wp_parse_args( $options, $defaults );\r\n                extract( $options );\r\n\r\n                /** Connect to the Filesystem */\r\n                $res = $this->fs_connect( array( WP_CONTENT_DIR, $destination ) );\r\n                if ( ! $res )\r\n                    return false;\r\n\r\n                /** Return early if there is an error connecting to the Filesystem */\r\n                if ( is_wp_error( $res ) ) {\r\n                    $this->skin->error( $res );\r\n                    return $res;\r\n                }\r\n\r\n                /** Call $this->header separately if running multiple times */\r\n                if ( ! $is_multi )\r\n                    $this->skin->header();\r\n\r\n                /** Set strings before the package is installed */\r\n                $this->skin->before();\r\n\r\n                /** Download the package (this just returns the filename of the file if the package is a local file) */\r\n                $download = $this->download_package( $package );\r\n                if ( is_wp_error( $download ) ) {\r\n                    $this->skin->error( $download );\r\n                    $this->skin->after();\r\n                    return $download;\r\n                }\r\n\r\n                /** Don't accidentally delete a local file */\r\n                $delete_package = ( $download != $package );\r\n\r\n                /** Unzip file into a temporary working directory */\r\n                $working_dir = $this->unpack_package( $download, $delete_package );\r\n                if ( is_wp_error( $working_dir ) ) {\r\n                    $this->skin->error( $working_dir );\r\n                    $this->skin->after();\r\n                    return $working_dir;\r\n                }\r\n\r\n                /** Install the package into the working directory with all passed config options */\r\n                $result = $this->install_package(\r\n                    array(\r\n                        'source'            => $working_dir,\r\n                        'destination'       => $destination,\r\n                        'clear_destination' => $clear_destination,\r\n                        'clear_working'     => $clear_working,\r\n                        'hook_extra'        => $hook_extra,\r\n                    )\r\n                );\r\n\r\n                /** Pass the result of the installation */\r\n                $this->skin->set_result( $result );\r\n\r\n                /** Set correct strings based on results */\r\n                if ( is_wp_error( $result ) ) {\r\n                    $this->skin->error( $result );\r\n                    $this->skin->feedback( 'process_failed' );\r\n                }\r\n                /** The plugin install is successful */\r\n                else {\r\n                    $this->skin->feedback( 'process_success' );\r\n                }\r\n\r\n                /** Only process the activation of installed plugins if the automatic flag is set to true */\r\n                if ( TGM_Plugin_Activation::$instance->is_automatic ) {\r\n                    /** Flush plugins cache so we can make sure that the installed plugins list is always up to date */\r\n                    wp_cache_flush();\r\n\r\n                    /** Get the installed plugin file and activate it */\r\n                    $plugin_info = $this->plugin_info( $package );\r\n                    $activate    = activate_plugin( $plugin_info );\r\n\r\n                    /** Re-populate the file path now that the plugin has been installed and activated */\r\n                    TGM_Plugin_Activation::$instance->populate_file_path();\r\n\r\n                    /** Set correct strings based on results */\r\n                    if ( is_wp_error( $activate ) ) {\r\n                        $this->skin->error( $activate );\r\n                        $this->skin->feedback( 'activation_failed' );\r\n                    }\r\n                    /** The plugin activation is successful */\r\n                    else {\r\n                        $this->skin->feedback( 'activation_success' );\r\n                    }\r\n                }\r\n\r\n                /** Flush plugins cache so we can make sure that the installed plugins list is always up to date */\r\n                wp_cache_flush();\r\n\r\n                /** Set install footer strings */\r\n                $this->skin->after();\r\n                if ( ! $is_multi )\r\n                    $this->skin->footer();\r\n\r\n                return $result;\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Sets the correct install strings for the installer skin to use.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function install_strings() {\r\n\r\n                $this->strings['no_package']          = __( 'Install package not available.', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['downloading_package'] = __( 'Downloading install package from <span class=\"code\">%s</span>&#8230;', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['unpack_package']      = __( 'Unpacking the package&#8230;', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['installing_package']  = __( 'Installing the plugin&#8230;', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['process_failed']      = __( 'Plugin install failed.', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['process_success']     = __( 'Plugin installed successfully.', TGM_Plugin_Activation::$instance->domain );\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Sets the correct activation strings for the installer skin to use.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function activate_strings() {\r\n\r\n                $this->strings['activation_failed']  = __( 'Plugin activation failed.', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['activation_success'] = __( 'Plugin activated successfully.', TGM_Plugin_Activation::$instance->domain );\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Grabs the plugin file from an installed plugin.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @return string|boolean Return plugin file on success, false on failure\r\n     \t\t */\r\n            public function plugin_info() {\r\n\r\n                /** Return false if installation result isn't an array or the destination name isn't set */\r\n                if ( ! is_array( $this->result ) )\r\n                    return false;\r\n                if ( empty( $this->result['destination_name'] ) )\r\n                    return false;\r\n\r\n                /** Get the installed plugin file or return false if it isn't set */\r\n                $plugin = get_plugins( '/' . $this->result['destination_name'] );\r\n                if ( empty( $plugin ) )\r\n                    return false;\r\n\r\n                /** Assume the requested plugin is the first in the list */\r\n                $pluginfiles = array_keys( $plugin );\r\n\r\n                return $this->result['destination_name'] . '/' . $pluginfiles[0];\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    if ( ! class_exists( 'TGM_Bulk_Installer_Skin' ) ) {\r\n        /**\r\n         * Installer skin to set strings for the bulk plugin installations..\r\n         *\r\n         * Extends Bulk_Upgrader_Skin and customizes to suit the installation of multiple\r\n         * plugins.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @package TGM-Plugin-Activation\r\n         * @author Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n         * @author Gary Jones <gamajo@gamajo.com>\r\n         */\r\n        class TGM_Bulk_Installer_Skin extends Bulk_Upgrader_Skin {\r\n\r\n            /**\r\n     \t\t * Holds plugin info for each individual plugin installation.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var array\r\n     \t\t */\r\n            public $plugin_info = array();\r\n\r\n            /**\r\n     \t\t * Holds names of plugins that are undergoing bulk installations.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var array\r\n     \t\t */\r\n            public $plugin_names = array();\r\n\r\n            /**\r\n     \t\t * Integer to use for iteration through each plugin installation.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var integer\r\n     \t\t */\r\n            public $i = 0;\r\n\r\n            /**\r\n     \t\t * Constructor. Parses default args with new ones and extracts them for use.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @param array $args Arguments to pass for use within the class\r\n     \t\t */\r\n            public function __construct( $args = array() ) {\r\n\r\n                /** Parse default and new args */\r\n                $defaults = array( 'url' => '', 'nonce' => '', 'names' => array() );\r\n                $args = wp_parse_args( $args, $defaults );\r\n\r\n                /** Set plugin names to $this->plugin_names property */\r\n                $this->plugin_names = $args['names'];\r\n\r\n                /** Extract the new args */\r\n                parent::__construct( $args );\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Sets install skin strings for each individual plugin.\r\n     \t\t *\r\n     \t\t * Checks to see if the automatic activation flag is set and uses the\r\n     \t\t * the proper strings accordingly.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function add_strings() {\r\n\r\n                /** Automatic activation strings */\r\n                if ( TGM_Plugin_Activation::$instance->is_automatic ) {\r\n                    $this->upgrader->strings['skin_upgrade_start']        = __( 'The installation and activation process is starting. This process may take a while on some hosts, so please be patient.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_update_successful']    = __( '%1$s installed and activated successfully.', TGM_Plugin_Activation::$instance->domain ) . ' <a onclick=\"%2$s\" href=\"#\" class=\"hide-if-no-js\"><span>' . __( 'Show Details', TGM_Plugin_Activation::$instance->domain ) . '</span><span class=\"hidden\">' . __( 'Hide Details', TGM_Plugin_Activation::$instance->domain ) . '</span>.</a>';\r\n                    $this->upgrader->strings['skin_upgrade_end']          = __( 'All installations and activations have been completed.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_before_update_header'] = __( 'Installing and Activating Plugin %1$s (%2$d/%3$d)', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n                /** Default installation strings */\r\n                else {\r\n                    $this->upgrader->strings['skin_upgrade_start']        = __( 'The installation process is starting. This process may take a while on some hosts, so please be patient.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_update_failed_error']  = __( 'An error occurred while installing %1$s: <strong>%2$s</strong>.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_update_failed']        = __( 'The installation of %1$s failed.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_update_successful']    = __( '%1$s installed successfully.', TGM_Plugin_Activation::$instance->domain ) . ' <a onclick=\"%2$s\" href=\"#\" class=\"hide-if-no-js\"><span>' . __( 'Show Details', TGM_Plugin_Activation::$instance->domain ) . '</span><span class=\"hidden\">' . __( 'Hide Details', TGM_Plugin_Activation::$instance->domain ) . '</span>.</a>';\r\n                    $this->upgrader->strings['skin_upgrade_end']          = __( 'All installations have been completed.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_before_update_header'] = __( 'Installing Plugin %1$s (%2$d/%3$d)', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Outputs the header strings and necessary JS before each plugin installation.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function before() {\r\n\r\n                /** We are currently in the plugin installation loop, so set to true */\r\n                $this->in_loop = true;\r\n\r\n                printf( '<h4>' . $this->upgrader->strings['skin_before_update_header'] . ' <img alt=\"\" src=\"' . admin_url( 'images/wpspin_light.gif' ) . '\" class=\"hidden waiting-' . $this->upgrader->update_current . '\" style=\"vertical-align:middle;\" /></h4>', $this->plugin_names[$this->i], $this->upgrader->update_current, $this->upgrader->update_count );\r\n                echo '<script type=\"text/javascript\">jQuery(\\'.waiting-' . esc_js( $this->upgrader->update_current ) . '\\').show();</script>';\r\n                echo '<div class=\"update-messages hide-if-js\" id=\"progress-' . esc_attr( $this->upgrader->update_current ) . '\"><p>';\r\n\r\n                /** Flush header output buffer */\r\n                $this->before_flush_output();\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Outputs the footer strings and necessary JS after each plugin installation.\r\n     \t\t *\r\n     \t\t * Checks for any errors and outputs them if they exist, else output\r\n     \t\t * success strings.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function after() {\r\n\r\n                /** Close install strings */\r\n                echo '</p></div>';\r\n\r\n                /** Output error strings if an error has occurred */\r\n                if ( $this->error || ! $this->result ) {\r\n                    if ( $this->error )\r\n                        echo '<div class=\"error\"><p>' . sprintf( $this->upgrader->strings['skin_update_failed_error'], $this->plugin_names[$this->i], $this->error ) . '</p></div>';\r\n                    else\r\n                        echo '<div class=\"error\"><p>' . sprintf( $this->upgrader->strings['skin_update_failed'], $this->plugin_names[$this->i] ) . '</p></div>';\r\n\r\n                    echo '<script type=\"text/javascript\">jQuery(\\'#progress-' . esc_js( $this->upgrader->update_current ) . '\\').show();</script>';\r\n                }\r\n\r\n                /** If the result is set and there are no errors, success! */\r\n                if ( ! empty( $this->result ) && ! is_wp_error( $this->result ) ) {\r\n                    echo '<div class=\"updated\"><p>' . sprintf( $this->upgrader->strings['skin_update_successful'], $this->plugin_names[$this->i], 'jQuery(\\'#progress-' . esc_js( $this->upgrader->update_current ) . '\\').toggle();jQuery(\\'span\\', this).toggle(); return false;' ) . '</p></div>';\r\n                    echo '<script type=\"text/javascript\">jQuery(\\'.waiting-' . esc_js( $this->upgrader->update_current ) . '\\').hide();</script>';\r\n                }\r\n\r\n                /** Set in_loop and error to false and flush footer output buffer */\r\n                $this->reset();\r\n                $this->after_flush_output();\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Outputs links after bulk plugin installation is complete.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function bulk_footer() {\r\n\r\n                /** Serve up the string to say installations (and possibly activations) are complete */\r\n                parent::bulk_footer();\r\n\r\n                /** Flush plugins cache so we can make sure that the installed plugins list is always up to date */\r\n                wp_cache_flush();\r\n\r\n                /** Display message based on if all plugins are now active or not */\r\n                $complete = array();\r\n                foreach ( TGM_Plugin_Activation::$instance->plugins as $plugin ) {\r\n                    if ( ! is_plugin_active( $plugin['file_path'] ) ) {\r\n                        echo '<p><a href=\"' . add_query_arg( 'page', TGM_Plugin_Activation::$instance->menu, admin_url( TGM_Plugin_Activation::$instance->parent_url_slug ) ) . '\" title=\"' . esc_attr( TGM_Plugin_Activation::$instance->strings['return'] ) . '\" target=\"_parent\">' . __( TGM_Plugin_Activation::$instance->strings['return'], TGM_Plugin_Activation::$instance->domain ) . '</a></p>';\r\n                        $complete[] = $plugin;\r\n                        break;\r\n                    }\r\n                    /** Nothing to store */\r\n                    else {\r\n                        $complete[] = '';\r\n                    }\r\n                }\r\n\r\n                /** Filter out any empty entries */\r\n                $complete = array_filter( $complete );\r\n\r\n                /** All plugins are active, so we display the complete string and hide the menu to protect users */\r\n                if ( empty( $complete ) ) {\r\n                    $complete_link_text = apply_filters( 'tgmpa_complete_link_text', __( 'Return to the Dashboard', TGM_Plugin_Activation::$instance->domain ) );\r\n                    $complete_link_url = apply_filters( 'tgmpa_complete_link_url', admin_url() );\r\n                    echo '<p>' .  sprintf( TGM_Plugin_Activation::$instance->strings['complete'], '<a href=\"' . $complete_link_url . '\" title=\"' . $complete_link_text . '\">' . $complete_link_text . '</a>' ) . '</p>';\r\n                    echo '<style type=\"text/css\">#adminmenu .wp-submenu li.current { display: none !important; }</style>';\r\n                }\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Flush header output buffer.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function before_flush_output() {\r\n\r\n                wp_ob_end_flush_all();\r\n                flush();\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Flush footer output buffer and iterate $this->i to make sure the\r\n     \t\t * installation strings reference the correct plugin.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function after_flush_output() {\r\n\r\n                wp_ob_end_flush_all();\r\n                flush();\r\n                $this->i++;\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n}", "<?php\r\n/*\r\nPlugin Name:  Google Analytics Top Content Widget\r\nDescription: Widget and shortcode to display top content according to Google Analytics. (\"Google Analytics Dashboard\" plugin required)\r\nPlugin URI: http://j.ustin.co/yWTtmy\r\nAuthor: Jtsternberg\r\nAuthor URI: http://jtsternberg.com/about\r\nDonate link: http://j.ustin.co/rYL89n\r\nVersion: 1.5.6\r\n*/\r\n\r\n\r\nadd_action( 'widgets_init', 'dsgnwrks_register_google_top_posts_widget' );\r\n/**\r\n * Register Top Content widgets\r\n */\r\nfunction dsgnwrks_register_google_top_posts_widget() {\r\n\tregister_widget( 'dsgnwrks_google_top_posts_widgets' );\r\n}\r\n\r\nclass GA_Top_Content {\r\n\r\n\tpublic function __construct() {\r\n\r\n\t\t$this->defaults = array(\r\n\t\t\t'title'           => 'Top Viewed Content',\r\n\t\t\t'pageviews'       => 20,\r\n\t\t\t'number'          => 5,\r\n\t\t\t'timeval'         => '1',\r\n\t\t\t'time'            => '2628000',\r\n\t\t\t'showhome'        => 0,\r\n\t\t\t'titleremove'     => '',\r\n\t\t\t'contentfilter'   => '',\r\n\t\t\t'catlimit'        => '',\r\n\t\t\t'catfilter'       => '',\r\n\t\t\t'thumb_size'      => '',\r\n\t\t\t'thumb_alignment' => '',\r\n\t\t\t'postfilter'      => '',\r\n\t\t\t'update'          => false\r\n\t\t);\r\n\r\n\t\trequire_once dirname( __FILE__ ) . '/class-tgm-plugin-activation.php';\r\n\t\tadd_action( 'tgmpa_register', array( $this, 'register_required_plugins' ) );\r\n\r\n\t\tadd_filter( 'tgmpa_complete_link_text', array( $this, 'change_link_text' ) );\r\n\t\tadd_filter( 'tgmpa_complete_link_url', array( $this, 'change_link_url' ) );\r\n\r\n\t\t// Top Content Shortcode\r\n\t\tadd_shortcode( 'google_top_content', array( $this, 'top_content_shortcode' ) );\r\n\t\tadd_shortcode( 'google_analytics_views', array( $this, 'views_shortcode' ) );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Register the required plugins for The \"Google Analytics Top Content\" plugin.\r\n\t */\r\n\tpublic function register_required_plugins() {\r\n\r\n\t\t$plugins = array( array(\r\n\t\t\t'name'     => 'Google Analytics Dashboard',\r\n\t\t\t'slug'     => 'google-analytics-dashboard',\r\n\t\t\t'required' => true,\r\n\t\t) );\r\n\r\n\t\t$plugin_text_domain = 'top-google-posts';\r\n\r\n\t\t$widgets_url = '<a href=\"' . get_admin_url( '', 'widgets.php' ) . '\" title=\"' . __( 'Setup Widget', $plugin_text_domain ) . '\">' . __( 'Setup Widget', $plugin_text_domain ) . '</a>';\r\n\r\n\r\n\t\t$config = array(\r\n\t\t\t'domain'           => $plugin_text_domain,\r\n\t\t\t'default_path'     => '',\r\n\t\t\t'parent_menu_slug' => 'plugins.php',\r\n\t\t\t'parent_url_slug'  => 'plugins.php',\r\n\t\t\t'menu'             => 'install-required-plugins',\r\n\t\t\t'has_notices'      => true,\r\n\t\t\t'is_automatic'     => true,\r\n\t\t\t'message'          => '',\r\n\t\t\t'strings'          => array(\r\n\t\t\t\t'page_title'                      => __( 'Install Required Plugins', $plugin_text_domain ),\r\n\t\t\t\t'menu_title'                      => __( 'Install Plugins', $plugin_text_domain ),\r\n\t\t\t\t'installing'                      => __( 'Installing Plugin: %s', $plugin_text_domain ), // %1$s = plugin name\r\n\t\t\t\t'oops'                            => __( 'Something went wrong with the plugin API.', $plugin_text_domain ),\r\n\t\t\t\t'notice_can_install_required'     => _n_noop( 'The \"Google Analytics Top Content\" plugin requires the following plugin: %1$s.', 'This plugin requires the following plugins: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_can_install_recommended'  => _n_noop( 'This plugin recommends the following plugin: %1$s.', 'This plugin recommends the following plugins: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_cannot_install'           => _n_noop( 'Sorry, but you do not have the correct permissions to install the %s plugin. Contact the administrator of this site for help on getting the plugin installed.', 'Sorry, but you do not have the correct permissions to install the %s plugins. Contact the administrator of this site for help on getting the plugins installed.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_can_activate_required'    => _n_noop( 'The following required plugin is currently inactive: %1$s.', 'The following required plugins are currently inactive: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_can_activate_recommended' => _n_noop( 'The following recommended plugin is currently inactive: %1$s.', 'The following recommended plugins are currently inactive: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_cannot_activate'          => _n_noop( 'Sorry, but you do not have the correct permissions to activate the %s plugin. Contact the administrator of this site for help on getting the plugin activated.', 'Sorry, but you do not have the correct permissions to activate the %s plugins. Contact the administrator of this site for help on getting the plugins activated.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_ask_to_update'            => _n_noop( 'The following plugin needs to be updated to its latest version to ensure maximum compatibility with this plugin: %1$s.', 'The following plugins need to be updated to their latest version to ensure maximum compatibility with this plugin: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_cannot_update'            => _n_noop( 'Sorry, but you do not have the correct permissions to update the %s plugin. Contact the administrator of this site for help on getting the plugin updated.', 'Sorry, but you do not have the correct permissions to update the %s plugins. Contact the administrator of this site for help on getting the plugins updated.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'install_link'                    => _n_noop( 'Begin installing plugin', 'Begin installing plugins' ),\r\n\t\t\t\t'activate_link'                   => _n_noop( 'Activate installed plugin', 'Activate installed plugins' ),\r\n\t\t\t\t'return'                          => __( 'Return to Required Plugins Installer', $plugin_text_domain ),\r\n\t\t\t\t'plugin_activated'                => __( 'Plugin activated successfully.', $plugin_text_domain ),\r\n\t\t\t\t'complete'                        => __( 'All plugins installed and activated successfully. %s', $plugin_text_domain ) // %1$s = dashboard link\r\n\t\t) );\r\n\r\n\t\ttgmpa( $plugins, $config );\r\n\r\n\t}\r\n\r\n\tpublic function message_one() {\r\n\t\treturn sprintf(\r\n\t\t\t'<p><strong>%s</strong></p><p><a href=\"%s\" class=\"thickbox\" title=\"%s\">%s</a> | <a href=\"%s\" class=\"thickbox\" title=\"%s\">%s</a>.</p>',\r\n\t\t\tsprintf( __( 'The \"Google Analytics Top Content\" widget requires the plugin, %s, to be installed and activated.', 'gatpw' ), '<em>\"Google Analytics Dashboard\"</em>' ),\r\n\t\t\tadmin_url( 'plugins.php?page=install-required-plugins' ),\r\n\t\t\t__( 'Install Google Analytics Dashboard', 'gatpw' ),\r\n\t\t\t__( 'Install plugin', 'gatpw' ),\r\n\t\t\tadmin_url( 'plugins.php' ),\r\n\t\t\t__( 'Activate Google Analytics Dashboard', 'gatpw' ),\r\n\t\t\t__( 'Activate plugin', 'gatpw' )\r\n\t\t);\r\n\t}\r\n\r\n\tpublic function message_two() {\r\n\t\treturn sprintf(\r\n\t\t\t'<p>%s</p><p><a href=\"%s\">%s</a>.</p>',\r\n\t\t\t__( 'You must first login to Google Analytics in the \"Google Analytics Dashboard\" settings for this widget to work.', 'gatpw' ),\r\n\t\t\tadmin_url( 'options-general.php?page=google-analytics-dashboard/gad-admin-options.php' ),\r\n\t\t\t__( 'Go to plugin settings', 'gatpw' )\r\n\t\t);\r\n\t}\r\n\r\n\tpublic function change_link_text( $complete_link_text ) {\r\n\t\treturn 'Go to \"Google Analytics Dashboard\" plugin settings';\r\n\t}\r\n\r\n\tpublic function change_link_url( $complete_link_url ) {\r\n\t\treturn admin_url( 'options-general.php?page=google-analytics-dashboard/gad-admin-options.php' );\r\n\t}\r\n\r\n\tpublic function top_content_shortcode( $atts, $context = 'shortcode', $number = 0 ) {\r\n\t\tstatic $inline_style = false;\r\n\t\tstatic $inline_style_done = false;\r\n\r\n\t\tif ( ! class_exists( 'GADWidgetData' ) ) {\r\n\t\t\treturn $this->message_one();\r\n\t\t}\r\n\t\tif ( ! $this->token() ) {\r\n\t\t\treturn $this->message_two();\r\n\t\t}\r\n\r\n\t\t$atts = shortcode_atts( $this->defaults, $atts, 'google_top_content' );\r\n\t\t$atts = apply_filters( 'gtc_atts_filter', $atts );\r\n\t\t$unique = md5( serialize( $atts ) );\r\n\t\t$trans_id = 'dw-gtc-list-'. $number . $unique;\r\n\r\n\t\t$trans = '';\r\n\t\t// @Dev\r\n\t\t// $atts['update'] = true;\r\n\t\tif ( empty( $atts['update'] ) ) {\r\n\t\t\t$trans = get_transient( $trans_id );\r\n\t\t\t$transuse = \"\\n<!-- using transient - {$trans_id} -->\\n\";\r\n\t\t}\r\n\r\n\t\tif ( ! empty( $trans ) ) {\r\n\t\t\treturn $transuse . apply_filters( 'gtc_list_output', $trans ) . $transuse;\r\n\t\t}\r\n\r\n\r\n\t\t$transuse = \"\\n<!-- not using transient - {$trans_id} -->\\n\";\r\n\r\n\t\t$time = ( $atts['timeval'] * $atts['time'] );\r\n\t\t$time_diff = abs( time() - $time );\r\n\r\n\t\tif ( strpos( $atts['time'], 'month' ) ) {\r\n\t\t\t$time = str_replace( '-month', '', $atts['time'] );\r\n\t\t\t$month = $time * 60 * 60 * 24 * 30.416666667;\r\n\t\t\t$time_diff = abs( time() - $month );\r\n\t\t}\r\n\r\n\t\t$pages = $this->get_ga()->complex_report_query(\r\n\t\t\tdate( 'Y-m-d', $time_diff ),\r\n\t\t\tdate( 'Y-m-d' ),\r\n\t\t\tarray( 'ga:pagePath', 'ga:pageTitle' ),\r\n\t\t\tarray( 'ga:pageviews' ),\r\n\t\t\tarray( '-ga:pageviews' ),\r\n\t\t\tarray( 'ga:pageviews>' . $atts['pageviews'] )\r\n\t\t);\r\n\t\t$atts['context'] = ( $context ) ? $context : 'shortcode';\r\n\t\t$pages = apply_filters( 'gtc_pages_filter', $pages, $atts );\r\n\r\n\t\t$list = '';\r\n\t\tif ( ! $pages )\r\n\t\t\treturn $list;\r\n\r\n\t\t$urlarray = array();\r\n\t\t$list .= '<ol class=\"gtc-list\">';\r\n\t\t$counter = 1;\r\n\t\tforeach( $pages as $page ) {\r\n\t\t\t$url = $page['value'];\r\n\t\t\t// Url is index and we don't want the homepage, skip\r\n\t\t\tif ( $url == '/' && ! in_array( $atts['showhome'], array( 'no', '0', 0, false ), true ) ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// We need to check if there are duplicates with query vars\r\n\t\t\t$path = pathinfo( $url );\r\n\t\t\t$query_var = strpos( $url, '?' );\r\n\t\t\t$default_permalink = strpos( $path['filename'], '?p=' );\r\n\t\t\t// Strip the query var off the url (if not using default permalinks)\r\n\t\t\t$url = ( ! ( isset( $atts['keep_query_vars'] ) && $atts['keep_query_vars'] ) && false !== $query_var && false === $default_permalink )\r\n\t\t\t\t? substr( $url, 0, $query_var )\r\n\t\t\t\t: $url;\r\n\r\n\t\t\t// Allow modification of the URL\r\n\t\t\t$url = apply_filters( 'gtc_page_url', $url );\r\n\r\n\t\t\t// Url already exists? skip it\r\n\t\t\tif ( in_array( $url, $urlarray ) )\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t$urlarray[] = $url;\r\n\t\t\t$wppost = null;\r\n\t\t\t$thumb = '';\r\n\r\n\t\t\tif ( $atts['contentfilter'] != 'allcontent' || $atts['catlimit'] != '' || $atts['catfilter'] != '' || $atts['postfilter'] != '' || ! empty( $atts['thumb_size'] ) ) {\r\n\r\n\t\t\t\tif ( false !== $default_permalink ) {\r\n\t\t\t\t\t$wppost = get_post( (int) str_replace( '?p=', '', $path['filename'] ) );\r\n\t\t\t\t}\r\n\t\t\t\tif ( !$wppost && !empty( $url ) && trim( $url ) != '/' ) {\r\n\t\t\t\t\t$content_types = get_post_types( array( 'public' => true ) );\r\n\t\t\t\t\tforeach( $content_types as $type ) {\r\n\t\t\t\t\tif ( $type == 'attachment' )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t$object_name = is_post_type_hierarchical( $type ) ? $url : @end( @array_filter( @explode( '/', $url ) ) );\r\n\t\t\t\t\tif ( $wppost = get_page_by_path( $object_name, OBJECT, $type ) )\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( $atts['contentfilter'] && $atts['contentfilter'] != 'allcontent' ) {\r\n\t\t\t\t\tif ( empty( $wppost ) ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( $wppost->post_type != $atts['contentfilter'] ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( $atts['contentfilter'] == 'allcontent' || $atts['contentfilter'] == 'post' ) {\r\n\r\n\t\t\t\t\tif ( $atts['catlimit'] != '' ) {\r\n\t\t\t\t\t\t$limit_array = array();\r\n\t\t\t\t\t\t$catlimits = esc_attr( $atts['catlimit'] );\r\n\t\t\t\t\t\t$catlimits = explode( ', ', $catlimits );\r\n\t\t\t\t\t\tforeach ( $catlimits as $catlimit ) {\r\n\t\t\t\t\t\t\tif ( in_category( $catlimit, $wppost ) ) $limit_array[] = $wppost->ID;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( !in_array( $wppost->ID, $limit_array ) ) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( $atts['catfilter'] != '' ) {\r\n\t\t\t\t\t\t$filter_array = array();\r\n\t\t\t\t\t\t$catfilters = esc_attr( $atts['catfilter'] );\r\n\t\t\t\t\t\t$catfilters = explode( ', ', $catfilters );\r\n\t\t\t\t\t\tforeach ( $catfilters as $catfilter ) {\r\n\t\t\t\t\t\t\tif ( in_category( $catfilter, $wppost ) ) $filter_array[] = $wppost->ID;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( in_array( $wppost->ID, $filter_array ) ) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( $atts['postfilter'] != '' ) {\r\n\t\t\t\t\t$postfilter_array = array();\r\n\t\t\t\t\t$postfilters = esc_attr( $atts['postfilter'] );\r\n\t\t\t\t\t$postfilters = explode( ', ', $postfilters );\r\n\t\t\t\t\tforeach ( $postfilters as $postfilter ) {\r\n\t\t\t\t\t\tif ( $postfilter == $wppost->ID ) $postfilter_array[] = $wppost->ID;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( in_array( $wppost->ID, $postfilter_array ) ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$title = stripslashes( wp_filter_post_kses( apply_filters( 'gtc_page_title', $page['children']['value'], $page, $wppost ) ) );\r\n\r\n\t\t\tif ( ! empty( $atts['thumb_size'] ) && $wppost && isset( $wppost->ID ) ) {\r\n\t\t\t\t$class = 'attachment-'. $atts['thumb_size'] .' wp-post-image';\r\n\t\t\t\tif ( ! empty( $atts['thumb_alignment'] ) ) {\r\n\t\t\t\t\t$class .= ' '. $atts['thumb_alignment'];\r\n\t\t\t\t\t$inline_style = true;\r\n\t\t\t\t}\r\n\t\t\t\t$thumb = get_the_post_thumbnail( $wppost->ID, $atts['thumb_size'], array( 'class' => $class ) );\r\n\t\t\t\t$thumb = apply_filters( 'gtc_list_item_thumb', '<a class=\"gtc-content-thumb\" href=\"'. $url .'\">' . $thumb . '</a>', $url, $thumb, $wppost, $counter, $title, $url, $atts );\r\n\t\t\t}\r\n\r\n\t\t\tif ( !empty( $atts['titleremove'] ) ) {\r\n\t\t\t\t$removes = explode( ',', sanitize_text_field( $atts['titleremove'] ) );\r\n\t\t\t\tforeach ( $removes as $remove ) {\r\n\t\t\t\t\t$title = str_ireplace( trim( $remove ), '', $title );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$list .= apply_filters( 'gtc_list_item', '<li>'. $thumb .'<a class=\"gtc-link\" href=\"'. $url .'\">' . $title . '</a></li>', $page, $wppost, $counter, $title, $url );\r\n\t\t\t$counter++;\r\n\t\t\tif ( $counter > $atts['number'] ) break;\r\n\t\t}\r\n\t\t$list .= '</ol>';\r\n\r\n\t\tif ( $inline_style && ! $inline_style_done ) {\r\n\t\t\t$list = '<style type=\"text/css\">.gtc-list li:after{content:\"\";display: block;clear:both;}</style>'. $list;\r\n\t\t\t$inline_style_done = true;\r\n\t\t}\r\n\r\n\t\t$list = apply_filters( 'gtc_list_output', $list );\r\n\t\tset_transient( $trans_id, $list, 86400 );\r\n\t\treturn $transuse . $list . $transuse;\r\n\r\n\t}\r\n\r\n\tpublic function views_shortcode( $atts, $content ) {\r\n\r\n\t\tif ( ! $this->token() || ! class_exists( 'GADWidgetData' ) )\r\n\t\t\treturn '';\r\n\r\n\t\t$defaults = array(\r\n\t\t\t'post_id' => get_the_ID(),\r\n\t\t\t'start_date' => date( 'Y-m-d', time() - (60 * 60 * 24 * 30) ),\r\n\t\t\t'end_date' => date( 'Y-m-d' ),\r\n\t\t);\r\n\t\t$atts = shortcode_atts( $defaults, $atts, 'google_analytics_views' );\r\n\t\t$atts = apply_filters( 'gtc_atts_filter_analytics_views', $atts );\r\n\t\t$unique = md5( serialize( $atts ) );\r\n\t\t$trans_id = 'dw-gtc-views-' . $atts['post_id'] . $unique;\r\n\r\n\t\t$count = '';\r\n\t\t// @Dev\r\n\t\t// $atts['update'] = true;\r\n\t\tif ( empty( $atts['update'] ) ) {\r\n\t\t\t$count = get_transient( $trans_id );\r\n\t\t\t$transuse = \"\\n<!-- using transient - {$trans_id} -->\\n\";\r\n\t\t}\r\n\r\n\t\tif ( empty( $count ) ) {\r\n\t\t\t$transuse = \"\\n<!-- not using transient - {$trans_id} -->\\n\";\r\n\r\n\t\t\t$permalink   = get_permalink( $atts['post_id'] );\r\n\t\t\t$post_status = get_post_status( $atts['post_id'] );\r\n\t\t\t$is_draft    = $post_status && 'draft' == $post_status;\r\n\t\t\t$url_data    = parse_url( $permalink );\r\n\t\t\t$link_uri    = substr( $url_data['path'] . ( isset( $url_data['query'] ) ? ( '?' . $url_data['query'] ) : '' ), -20 );\r\n\r\n\t\t\tif ( empty( $link_uri ) || $is_draft )\r\n\t\t\t\treturn '';\r\n\r\n\t\t\t$data = $this->get_ga()->total_uri_pageviews_for_date_period( $link_uri, $atts['start_date'], $atts['end_date'] );\r\n\r\n\t\t\t$count = isset( $data['value'] ) ? $data['value'] : 0;\r\n\r\n\t\t\tif ( $count ) {\r\n\t\t\t\tset_transient( $trans_id, $count, 86400 );\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! $count )\r\n\t\t\treturn;\r\n\r\n\r\n\t\tif ( $content ) {\r\n\t\t\t$clean_content = wp_kses_post( $content );\r\n\t\t\t$replaced_content = str_ireplace( '**count**', '<span class=\"gtc-count\">'. $count .'</span>', $clean_content );\r\n\t\t\treturn $transuse . $replaced_content . $transuse;\r\n\t\t}\r\n\r\n\t\treturn $count;\r\n\r\n\t}\r\n\r\n\tpublic function get_ga() {\r\n\t\tif ( isset( $this->ga ) )\r\n\t\t\treturn $this->ga;\r\n\r\n\t\t$this->ga = false;\r\n\t\tif ( class_exists( 'GADWidgetData' ) ) {\r\n\r\n\t\t\t$login = new GADWidgetData();\r\n\t\t\t$this->ga = new GALib( $login->auth_type, NULL, $login->oauth_token, $login->oauth_secret, $login->account_id );\r\n\t\t}\r\n\r\n\t\treturn $this->ga;\r\n\t}\r\n\r\n\tpublic function token() {\r\n\t\t$this->token = isset( $this->token ) ? $this->token : get_option( 'gad_auth_token' );\r\n\t\treturn $this->token;\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * Top Content widget\r\n */\r\nclass dsgnwrks_google_top_posts_widgets extends WP_Widget {\r\n\r\n\tpublic function __construct() {\r\n\t\t$this->gatc = new GA_Top_Content();\r\n\r\n\t\tparent::__construct( 'dsgnwrks_google_top_posts_widgets', 'Google Analytics Top Content', array(\r\n\t\t\t'classname' => 'google_top_posts',\r\n\t\t\t'description' => 'Show top posts from Google Analytics'\r\n\t\t) );\r\n\t}\r\n\r\n\t //build the widget settings form\r\n\tpublic function form( $instance ) {\r\n\r\n\t\tif ( ! class_exists( 'GADWidgetData' ) ) {\r\n\t\t\techo $this->gatc->message_one();\r\n\t\t\techo '<style type=\"text/css\"> #widget-'. $this->id .'-savewidget { display: none !important; } </style>';\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! $this->gatc->token() ) {\r\n\t\t\techo $this->gatc->message_two();\r\n\t\t\techo '<style type=\"text/css\"> #widget-'. $this->id .'-savewidget { display: none !important; } </style>';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$instance = wp_parse_args( (array) $instance, $this->gatc->defaults );\r\n\t\textract( $instance, EXTR_SKIP );\r\n\r\n\t\t?>\r\n\t\t<p><label><b>Title:</b><input class=\"widefat\" name=\"<?php echo $this->get_field_name( 'title' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $title ); ?>\" /></label></p>\r\n\r\n\t\t<p><label><b>Show pages with at least __ number of page views:</b> <input class=\"widefat\" name=\"<?php echo $this->get_field_name( 'pageviews' ); ?>\"  type=\"text\" value=\"<?php echo absint( $pageviews ); ?>\" /></label></p>\r\n\r\n\t\t<p><label><b>Number to Show:</b> <input class=\"widefat\" name=\"<?php echo $this->get_field_name( 'number' ); ?>\"  type=\"text\" value=\"<?php echo absint( $number ); ?>\" /></label></p>\r\n\r\n\t\t<p><label><b>Select how far back you would like analytics to pull from:</b>\r\n\r\n\t\t\t<div class=\"timestamp-wrap\">\r\n\t\t\t\t<?php\r\n\r\n\t\t\t\techo '<select style=\"margin-right: 5px;\" id=\"'. $this->get_field_name( 'timeval' ) .'\" name=\"'. $this->get_field_name( 'timeval' ) .'\">';\r\n\r\n\t\t\t\tfor ( $i = 1; $i <= 30; $i = $i +1 ) {\r\n\t\t\t\t\techo '<option value=\"'. $i .'\"';\r\n\t\t\t\t\techo selected( $i, $instance['timeval'], false );\r\n\t\t\t\t\techo '>' . $i;\r\n\t\t\t\t\techo '</option>';\r\n\t\t\t\t}\r\n\r\n\t\t\t\techo '</select>';\r\n\r\n\t\t\t\techo '<select style=\"width: 50%;\" id=\"'. $this->get_field_name( 'time' ) .'\" name=\"'. $this->get_field_name( 'time' ) .'\">';\r\n\r\n\t\t\t\techo '<option value=\"3600\"', selected( '3600', $time ) ,'>hour(s)</option>';\r\n\t\t\t\techo '<option value=\"86400\"', selected( '86400', $time ) ,'>day(s)</option>';\r\n\t\t\t\techo '<option value=\"2628000\"', selected( '2628000', $time ) ,'>month(s)</option>';\r\n\t\t\t\techo '<option value=\"31536000\"', selected( '31536000', $time ) ,'>year(s)</option>';\r\n\r\n\t\t\t\techo '</select>';\r\n\t\t\t\t?>\r\n\t\t\t</div>\r\n\t\t</label></p>\r\n\r\n\t\t<p><label>\r\n\t\t\t<span style=\"width: 80%; float: left; margin-right: 10px;\"><b>Remove home page from list:</b> (usually \"<i>yoursite.com</i>\" is the highest viewed page)<br/></span>\r\n\t\t\t<input style=\"margin-top: 15px;\" id=\"<?php echo $this->get_field_id( 'showhome' ); ?>\" type=\"checkbox\" name=\"<?php echo $this->get_field_name( 'showhome' ); ?>\" value=\"1\" <?php checked(1, $showhome); ?>/>\r\n\t\t</label></p>\r\n\r\n\t\t<p style=\"clear: both; padding-top: 15px;\"><label><b>Remove Site Title From Listings:</b><br/>Your listings will usually be returned with the page/post name as well as the site title. To remove the site title from the listings, place the exact text you would like removed (i.e. <i>- Site Title</i>) here. If there is more than one phrase to be removed, separate them by commas (i.e. <i>- Site Title, | Site Title</i>). <b>Unless your site doesn't output the site titles, then you will need to add this in order for the filter settings below to work.</b> <input class=\"widefat\" style=\"margin-top:2px;\" name=\"<?php echo $this->get_field_name( 'titleremove' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $titleremove ); ?>\" /></label></p>\r\n\r\n\t\t<p><label>\r\n\t\t<b>Limit Listings To:</b>\r\n\t\t<select name=\"<?php echo $this->get_field_name( 'contentfilter' ); ?>\">\r\n\t\t<?php\r\n\t\techo '<option value=\"allcontent\" '. selected( esc_attr( $instance['contentfilter'] ), '' ) .'>Not Limited</option>';\r\n\r\n\t\t$content_types = get_post_types( array( 'public' => true ) );\r\n\t\tforeach( $content_types as $key => $value ) {\r\n\t\t\tif ( $value == 'attachment' )\r\n\t\t\t\tcontinue;\r\n\t\t\t$selected_value = esc_attr( $instance['contentfilter'] ) == $key ? 'selected' : '';\r\n\t\t\techo \"<option value='$key' $selected_value>$value</option>\";\r\n\t\t}\r\n\t\t?>\r\n\t\t</select>\r\n\r\n\t\t</label>\r\n\t\t</p>\r\n\r\n\t\t<?php if ( $instance['contentfilter'] == 'allcontent' || $instance['contentfilter'] == 'post' ) { ?>\r\n\r\n\t\t\t<p><label><b>Limit Listings To Category:</b><br/>To limit to specific categories, place comma separated category ID's.<input class=\"widefat\" style=\"margin-top:2px;\" name=\"<?php echo $this->get_field_name( 'catlimit' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $catlimit ); ?>\" /></label></p>\r\n\r\n\t\t\t<p><label><b>Filter Out Category:</b><br/>To remove specific categories, place comma separated category ID's.<input class=\"widefat\" style=\"margin-top:2px;\" name=\"<?php echo $this->get_field_name( 'catfilter' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $catfilter ); ?>\" /></label></p>\r\n\r\n\t\t<?php } ?>\r\n\r\n\t\t<p><label><b>Filter Out Post/Page IDs:</b><br/>To remove specific posts/pages, place comma separated post/page ID's.<input class=\"widefat\" style=\"margin-top:2px;\" name=\"<?php echo $this->get_field_name( 'postfilter' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $postfilter ); ?>\" /></label></p>\r\n\r\n\t\t<p><label><b>Thumbnail Size:</b><br/>Optionally display a thumbnail next to the post title (if the post has a thumbnail).<br>\r\n\t\t<select style=\"margin-top:2px;max-width:100%;\" name=\"<?php echo $this->get_field_name( 'thumb_size' ); ?>\">\r\n\t\t<?php\r\n\t\techo '<option value=\"\" ', selected( empty( $instance['thumb_size'] ), true ) ,'>No Thumbnail</option>';\r\n\t\tforeach ( $this->get_image_size_options() as $size => $label ) {\r\n\t\t\techo '<option value=\"', $size ,'\" ', selected( ! empty( $instance['thumb_size'] ) && $size == $instance['thumb_size'] ) ,'>', $label ,'</option>';\r\n\t\t}\r\n\t\t?>\r\n\t\t</select>\r\n\r\n\t\t<p><label><b>Thumbnail Alignment:</b><br/>Will only apply if choosing a thumbnail size.<br>\r\n\t\t<select style=\"margin-top:2px;max-width:100%;\" name=\"<?php echo $this->get_field_name( 'thumb_alignment' ); ?>\">\r\n\t\t\t<option value=\"\" <?php selected( empty( $instance['thumb_alignment'] ), true ); ?>>None</option>\r\n\t\t\t<option value=\"alignleft\" <?php selected( $instance['thumb_alignment'], 'alignleft' ); ?>>Left Align</option>\r\n\t\t\t<option value=\"alignright\" <?php selected( $instance['thumb_alignment'], 'alignright' ); ?>>Right Align</option>\r\n\t\t\t<option value=\"aligncenter\" <?php selected( $instance['thumb_alignment'], 'aligncenter' ); ?>>Centered</option>\r\n\t\t</select>\r\n\t\t<?php\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get list of registered image sizes\r\n\t *\r\n\t * @since  1.5.6\r\n\t *\r\n\t * @return array  Array of image sizes\r\n\t */\r\n\tpublic function get_image_size_options() {\r\n\t\tglobal $_wp_additional_image_sizes;\r\n\r\n\t\t$image_sizes = array();\r\n\t\tforeach ( get_intermediate_image_sizes() as $size ) {\r\n\t\t\t$size_name = $size;\r\n\t\t\tif ( array_key_exists( $size, $_wp_additional_image_sizes ) ) {\r\n\t\t\t\t$size_info = $_wp_additional_image_sizes[ $size ];\r\n\t\t\t\t$size_name = $size_info['width'] .' x '. $size_info['height'] .' &mdash; '. $size_name;\r\n\r\n\t\t\t\tif ( is_array( $size_info['crop'] ) ) {\r\n\t\t\t\t\t$size_name .= ' ('. implode( ', ', $size_info['crop']) .')';\r\n\t\t\t\t} elseif ( $size_info['crop'] ) {\r\n\t\t\t\t\t$size_name .= ' (cropped)';\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\t$image_sizes[ $size ] = $size_name;\r\n\t\t}\r\n\r\n\t\treturn $image_sizes;\r\n\t}\r\n\r\n\t// save the widget settings\r\n\tpublic function update( $new_instance, $old_instance ) {\r\n\t\t$cleaned = $old_instance;\r\n\r\n\t\t$to_clean = array(\r\n\t\t\t'esc_attr' => array(\r\n\t\t\t\t'title',\r\n\t\t\t\t'time',\r\n\t\t\t\t'contentfilter',\r\n\t\t\t\t'catlimit',\r\n\t\t\t\t'catfilter',\r\n\t\t\t\t'postfilter',\r\n\t\t\t\t'thumb_size',\r\n\t\t\t\t'thumb_alignment',\r\n\t\t\t),\r\n\t\t\t'absint' => array(\r\n\t\t\t\t'pageviews',\r\n\t\t\t\t'number',\r\n\t\t\t\t'showhome',\r\n\t\t\t\t'timeval',\r\n\t\t\t),\r\n\t\t\t'sanitize_text_field' => array(\r\n\t\t\t\t'titleremove',\r\n\t\t\t),\r\n\t\t);\r\n\r\n\t\tforeach ( $to_clean as $callback => $fields ) {\r\n\t\t\tforeach ( $fields as $field ) {\r\n\t\t\t\t$cleaned[ $field ] = $callback( isset( $new_instance[ $field ] ) ? $new_instance[ $field ] : '' );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$atts = shortcode_atts( $this->gatc->defaults, $cleaned, 'google_top_content' );\r\n\t\t$atts = apply_filters( 'gtc_atts_filter', $atts );\r\n\t\t$unique = md5( serialize( $atts ) );\r\n\t\tdelete_transient( 'dw-gtc-list-'. $this->number . $unique );\r\n\r\n\t\treturn $cleaned;\r\n\t}\r\n\r\n\t// display the widget\r\n\tpublic function widget($args, $instance) {\r\n\r\n\t\textract($args);\r\n\t\techo $before_widget;\r\n\r\n\t\t$title = apply_filters( 'widget_title', $instance['title'] );\r\n\t\tif ( !empty( $title ) ) { echo $before_title . $title . $after_title; };\r\n\r\n\t\techo $this->gatc->top_content_shortcode( $instance, 'widget', $this->number );\r\n\r\n\t\techo $after_widget;\r\n\r\n\t}\r\n\r\n}\r\n", "=== Plugin Name ===  \nGoogle Analytics Top Content Widget\n\nContributors: jtsternberg\nPlugin Name:  Google Analytics Top Content Widget  \nPlugin URI: http://j.ustin.co/yWTtmy  \nTags: google analytics, google, top posts, top content, display rank, page rank, page views, widget, sidebar, sidebar widget, Google Analytics Dashboard, shortcode, site stats, statistics, stats  \nAuthor: Jtsternberg  \nAuthor URI: http://jtsternberg.com/about  \nDonate link: http://j.ustin.co/rYL89n  \nRequires at least: 3.0  \nTested up to: 4.1  \nStable tag: 1.5.6  \nVersion: 1.5.6  \nLicense: GPLv2 or later  \nLicense URI: http://www.gnu.org/licenses/gpl-2.0.html  \n\nWidget and shortcode to display top content according to Google Analytics. (\"Google Analytics Dashboard\" plugin required)\n\n== Description ==\n\nAdds a widget that allows you to display top pages/posts in your sidebar based on google analytics data.\n\nRequires a Google Analytics account, and the plugin, [\"Google Analytics Dashboard\"](http://wordpress.org/extend/plugins/google-analytics-dashboard/) (which will be auto-installed by this plugin, thanks to [@jthomasgriffin](http://twitter.com/jthomasgriffin)'s awesome [TGM Plugin Activation Class](http://j.ustin.co/yZPKXw)).\n\nAlso includes a shortcode to display the top content in your posts and pages.\n\n= Shortcodes with options supported: =\n\n* Companion shortcode to widget\n`[google_top_content pageviews=5 number=10 showhome=no time=2628000 timeval=2]`\n* Display a post's/page's number of views\n`[google_analytics_views]`\n* Conditional text where \\*\\*count\\*\\* will be replaced\n`[google_analytics_views]This page has received **count** views.[/google_analytics_views]`\n\n= Shortcode attributes definitions: =\n\n* Pageviews: Show pages with at least __ number of page views\n* Number: Number of pages to show in the list\n* Showhome: Will remove home page from list: (usually \"yoursite.com\" is the highest viewed page)\n* Time: Selects how far back you would like analytics to pull from. needs to be in seconds. (1 hour - 3600, 1 day - 86400, 1 month - 2628000, 1 year - 31536000).\n* Time Value: time=2628000 timeval=2 like in the example above would be 2 months.\n* titleremove: Remove site title from listings. (Unless your site doesn't output the site titles, then you will need to add this in order for the filter settings below to work.)\n* contentfilter: Limit listings to a particular post-type (post, page, etc)\n* catlimit: Limit listings to specific categories. (comma separated category ID's)\n* catfilter: Remove listings in specific categories. (comma separated category ID's)\n* postfilter: Remove specific posts/pages, etc by ID. (comma separated post ID's)\n* thumb_size: Optionally display a thumbnail next to the post title (if the post has a thumbnail)\n* thumb_alignment: Thumbnail alignment -- only applies if specifying a thumbnail size\n\nAll of the widget options are exactly that.. optional. If you don't include them it will pick some defaults.\n\n= Plugin Features: =\n\n* Plugin uses WordPress transients to cache the Google results so you're not running the update from Google every time. cache updates every 24 hours.\n* Developer Friendly. Many filters built in to allow you to filter the results to dispay how you want.  One example of that would be to remove your Site's title from the results. (now unnecessary, as the widget/shortcode has the option built in)\n** [Example using a filter to add view counts after the title](http://wordpress.org/support/topic/top-viewed-content-couple-of-tweeks-needed?replies=9#post-3816989) -\n`add_filter( 'gtc_pages_filter', 'gtc_add_viewcount_title' );\nfunction gtc_add_viewcount_title( $pages ) {\n\n\tif ( !$pages )\n\t\treturn false;\n\t// loop through the pages\n\tforeach ( $pages as $key => $page ) {\n\t\t// and add the page count to the title value\n\t\t$pages[$key]['children']['value'] = $pages[$key]['children']['value'] . ' ['. $pages[$key]['children']['children']['ga:pageviews'] .' Views]';\n\t}\n\treturn $pages;\n}`\n\nFeel free to [fork or contribute on Github](https://github.com/jtsternberg/Google-Analytics-Top-Content-Widget).\n\n== Installation ==\n\n1. Upload the `google-analytics-top-posts-widget` directory to the `/wp-content/plugins/` directory.\n2. Activate the plugin through the 'Plugins' menu in WordPress.\n3. Plugin will prompt you to install the \"Google Analytics Dashboard\" plugin. Install and activate it.\n4. Use the \"Google Analytics Dashboard\" plugin's settings page to login to your google analytics account.\n5. On the widgets page, drag the \"Google Analytics Top Posts\" widget to the desired sidebar.\n6. Update the widget settings and save.\n\n== Frequently Asked Questions ==\n\n= After Upgrading to 1.4, my widget stopped working =\nI updated the widget options for the date picker, and as a result, it broke any widgets that were saved with the old options. 1.4.1 solves that, but either way, re-saving the widget will correct the issue.\n\nIf you were using the shortcode and it broke, you will need to switch to using the shortcode with the new format (described [here](http://wordpress.org/extend/plugins/google-analytics-top-posts-widget/))\n\n= ?? =\nIf you run into a problem or have a question, contact me ([contact form](http://j.ustin.co/scbo43) or [@jtsternberg on twitter](http://j.ustin.co/wUfBD3)). I'll add them here.\n\n\n== Screenshots ==\n\n1. Widget options.\n2. Widget display (in an ordered list).\n\n== Changelog ==\n\n= 1.5.6 =\n* Feature: Add thumbnail option to widget.\n\n= 1.5.5 =\n* Bug Fix: Fix a few logic issues causing debug.log notices.\n\n= 1.5.4 =\n* Bug Fix: Use a unique transient ID for every shortcode instance.\n\n= 1.5.3 =\n* Bug Fix: `update=true` shortcode parameter (used for busting the cache) did not work properly.\n\n= 1.5.2 =\n* Bug Fix: Fix a couple filters that were getting false-postives.\n\n= 1.5.1 =\n* Bug Fix: Renamed the widget in 1.5.0 which would cause it to be unregistered in any sidebars. Quickly pushed up an update to put it back, but this release makes it final. Apologies for the inconvenience.\n\n= 1.5.0 =\n* Enhancement: New shortcode, `google_analytics_views` for displaying a view count on a single post/page.\n\n= 1.4.8 =\n* Bug fix: Now there is a unique transient for each widget instance.\n\n= 1.4.7 =\n* Improvement: By default won't list duplicate urls with query variable strings (often generated by sharing applications).\n\n= 1.4.6 =\n* Bug fix: Listings wouldn't show when using 'post' as the contentfilter.\n\n= 1.4.5 =\n* Enhancement: More output filters, and check for '?p=' permalinks\n\n= 1.4.4 =\n* Enhancement: Allow html in list item output\n\n= 1.4.3 =\n* Bug fix: Some entities would break the \"remove site name\" filter.\n\n= 1.4.2 =\n* Fixed the number value select for the \"Select how far back you would like analytics to pull from:\" selector.\n\n= 1.4.1 =\n* I updated the widget options for the date picker, and as a result, it broke any widgets that were saved with the old options. 1.4.1 solves that, but either way, re-saving the widget will correct the issue.\n\nIf you were using the shortcode and it broke, you will need to switch to using the shortcode with the new format (described [here](http://wordpress.org/extend/plugins/google-analytics-top-posts-widget/))\n\n= 1.4 =\n* Added more flexibilty to the time select dropdown. Now with options to select hours and days.\n\n= 1.3 =\n* Added more widget options to modify the list output. Added field to enter repeating elements in the titles to remove from the listings. Also, now limit or filter by post-type, by category, or by post/page ID.\n\n= 1.2 =\n* Increased page-speed with use of transients caching. Also added a few more developer friendly filters.\n\n= 1.1 =\n* Add a pages filter for developers, remove site title from page title, change date picker to use relative dates.\n\n= 1.0 =\n* Launch.\n\n\n== Upgrade Notice ==\n\n= 1.5.6 =\n* Feature: Add thumbnail option to widget.\n\n= 1.5.5 =\n* Bug Fix: Fix a few logic issues causing debug.log notices.\n\n= 1.5.4 =\n* Bug Fix: Use a unique transient ID for every shortcode instance.\n\n= 1.5.3 =\n* Bug Fix: `update=true` shortcode parameter (used for busting the cache) did not work properly.\n\n= 1.5.2 =\n* Bug Fix: Fix a couple filters that were getting false-postives.\n\n= 1.5.1 =\n* Bug Fix: Renamed the widget in 1.5.0 which would cause it to be unregistered in any sidebars. Quickly pushed up an update to put it back, but this release makes it final. Apologies for the inconvenience.\n\n= 1.5.0 =\n* Enhancement: New shortcode, `google_analytics_views` for displaying a view count on a single post/page.\n\n= 1.4.8 =\n* Bug fix: Now there is a unique transient for each widget instance.\n\n= 1.4.7 =\n* Improvement: By default won't list duplicate urls with query variable strings (often generated by sharing applications).\n\n= 1.4.6 =\n* Bug fix: Listings wouldn't show when using 'post' as the contentfilter.\n\n= 1.4.5 =\n* Enhancement: More output filters, and check for '?p=' permalinks\n\n= 1.4.4 =\n* Enhancement: Allow html in list item output\n\n= 1.4.3 =\n* Bug fix: Some entities would break the \"remove site name\" filter.\n\n= 1.4.2 =\n* Fixed the number value select for the \"Select how far back you would like analytics to pull from:\" selector.\n\n= 1.4.1 =\nI updated the widget options for the date picker, and as a result, it broke any widgets that were saved with the old options. 1.4.1 solves that, but either way, re-saving the widget will correct the issue.\n\nIf you were using the shortcode and it broke, you will need to switch to using the shortcode with the new format (described [here](http://wordpress.org/extend/plugins/google-analytics-top-posts-widget/))\n\n= 1.4 =\nAdded more flexibilty to the time select dropdown. Now with options to select hours and days.\n\n= 1.3 =\nAdded more widget options to modify the list output. Added field to enter repeating elements in the titles to remove from the listings. Also, now limit or filter by post-type, by category, or by post/page ID.\n\n= 1.2 =\nIncreased page-speed with use of transients caching. Also added a few more developer friendly filters.\n\n= 1.1 =\nAdd a pages filter for developers, remove site title from page title, change date picker to use relative dates.\n\n= 1.0 =\nLaunch\n"], "fixing_code": ["<?php\r\n/**\r\n * Plugin installation and activation for WordPress themes.\r\n *\r\n * @package   TGM-Plugin-Activation\r\n * @version   2.3.3\r\n * @author    Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n * @author    Gary Jones <gamajo@gamajo.com>\r\n * @copyright Copyright (c) 2012, Thomas Griffin\r\n * @license   http://opensource.org/licenses/gpl-2.0.php GPL v2 or later\r\n * @link      https://github.com/thomasgriffin/TGM-Plugin-Activation\r\n */\r\n\r\n/*\r\n    Copyright 2012  Thomas Griffin  (email : thomas@thomasgriffinmedia.com)\r\n\r\n    This program is free software; you can redistribute it and/or modify\r\n    it under the terms of the GNU General Public License, version 3, as\r\n    published by the Free Software Foundation.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n    GNU General Public License for more details.\r\n\r\n    You should have received a copy of the GNU General Public License\r\n    along with this program; if not, write to the Free Software\r\n    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA\r\n*/\r\n\r\nif ( ! class_exists( 'TGM_Plugin_Activation' ) ) {\r\n    /**\r\n \t * Automatic plugin installation and activation library.\r\n \t *\r\n \t * Creates a way to automatically install and activate plugins from within themes.\r\n \t * The plugins can be either pre-packaged, downloaded from the WordPress\r\n \t * Plugin Repository or downloaded from a private repository.\r\n \t *\r\n \t * @since 1.0.0\r\n \t *\r\n \t * @package TGM-Plugin-Activation\r\n \t * @author Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n \t * @author Gary Jones <gamajo@gamajo.com>\r\n \t */\r\n    class TGM_Plugin_Activation {\r\n\r\n        /**\r\n     \t * Holds a copy of itself, so it can be referenced by the class name.\r\n     \t *\r\n     \t * @since 1.0.0\r\n     \t *\r\n     \t * @var TGM_Plugin_Activation\r\n     \t */\r\n        static $instance;\r\n\r\n        /**\r\n     \t * Holds arrays of plugin details.\r\n     \t *\r\n     \t * @since 1.0.0\r\n     \t *\r\n     \t * @var array\r\n     \t */\r\n        public $plugins = array();\r\n\r\n        /**\r\n     \t * Parent menu slug for plugins page.\r\n     \t *\r\n     \t * @since 2.2.0\r\n     \t *\r\n     \t * @var string Parent menu slug. Defaults to 'themes.php'.\r\n     \t */\r\n        public $parent_menu_slug = 'themes.php';\r\n\r\n        /**\r\n     \t * Parent URL slug for URL references.\r\n     \t *\r\n     \t * This is useful if you want to place the custom plugins page as a\r\n     \t * submenu item under a custom parent menu.\r\n     \t *\r\n     \t * @since 2.2.0\r\n     \t *\r\n     \t * @var string Parent URL slug. Defaults to 'themes.php'.\r\n     \t */\r\n        public $parent_url_slug = 'themes.php';\r\n\r\n        /**\r\n     \t * Name of the querystring argument for the admin page.\r\n     \t *\r\n     \t * @since 1.0.0\r\n     \t *\r\n     \t * @var string\r\n     \t */\r\n        public $menu = 'install-required-plugins';\r\n\r\n        /**\r\n         * Text domain for localization support.\r\n         *\r\n         * @since 1.1.0\r\n         *\r\n         * @var string\r\n         */\r\n        public $domain = 'tgmpa';\r\n\r\n        /**\r\n         * Default absolute path to folder containing pre-packaged plugin zip files.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @var string Absolute path prefix to packaged zip file location. Default is empty string.\r\n         */\r\n        public $default_path = '';\r\n\r\n        /**\r\n         * Flag to show admin notices or not.\r\n         *\r\n         * @since 2.1.0\r\n         *\r\n         * @var boolean\r\n         */\r\n        public $has_notices = true;\r\n\r\n        /**\r\n         * Flag to set automatic activation of plugins. Off by default.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @var boolean\r\n         */\r\n        public $is_automatic = false;\r\n\r\n        /**\r\n         * Optional message to display before the plugins table.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @var string Message filtered by wp_kses_post(). Default is empty string.\r\n         */\r\n        public $message = '';\r\n\r\n        /**\r\n         * Holds configurable array of strings.\r\n         *\r\n         * Default values are added in the constructor.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @var array\r\n         */\r\n        public $strings = array();\r\n\r\n        /**\r\n         * Adds a reference of this object to $instance, populates default strings,\r\n         * does the tgmpa_init action hook, and hooks in the interactions to init.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @see TGM_Plugin_Activation::init()\r\n         */\r\n        public function __construct() {\r\n\r\n            self::$instance =& $this;\r\n\r\n            $this->strings = array(\r\n                'page_title'                      => __( 'Install Required Plugins', $this->domain ),\r\n                'menu_title'                      => __( 'Install Plugins', $this->domain ),\r\n                'installing'                      => __( 'Installing Plugin: %s', $this->domain ),\r\n                'oops'                            => __( 'Something went wrong.', $this->domain ),\r\n                'notice_can_install_required'     => _n_noop( 'This theme requires the following plugin: %1$s.', 'This theme requires the following plugins: %1$s.' ),\r\n                'notice_can_install_recommended'  => _n_noop( 'This theme recommends the following plugin: %1$s.', 'This theme recommends the following plugins: %1$s.' ),\r\n                'notice_cannot_install'           => _n_noop( 'Sorry, but you do not have the correct permissions to install the %s plugin. Contact the administrator of this site for help on getting the plugin installed.', 'Sorry, but you do not have the correct permissions to install the %s plugins. Contact the administrator of this site for help on getting the plugins installed.' ),\r\n                'notice_can_activate_required'    => _n_noop( 'The following required plugin is currently inactive: %1$s.', 'The following required plugins are currently inactive: %1$s.' ),\r\n                'notice_can_activate_recommended' => _n_noop( 'The following recommended plugin is currently inactive: %1$s.', 'The following recommended plugins are currently inactive: %1$s.' ),\r\n                'notice_cannot_activate'          => _n_noop( 'Sorry, but you do not have the correct permissions to activate the %s plugin. Contact the administrator of this site for help on getting the plugin activated.', 'Sorry, but you do not have the correct permissions to activate the %s plugins. Contact the administrator of this site for help on getting the plugins activated.' ),\r\n                'notice_ask_to_update'            => _n_noop( 'The following plugin needs to be updated to its latest version to ensure maximum compatibility with this theme: %1$s.', 'The following plugins need to be updated to their latest version to ensure maximum compatibility with this theme: %1$s.' ),\r\n                'notice_cannot_update'            => _n_noop( 'Sorry, but you do not have the correct permissions to update the %s plugin. Contact the administrator of this site for help on getting the plugin updated.', 'Sorry, but you do not have the correct permissions to update the %s plugins. Contact the administrator of this site for help on getting the plugins updated.' ),\r\n                'install_link' \t\t\t\t\t  => _n_noop( 'Begin installing plugin', 'Begin installing plugins' ),\r\n                'activate_link' \t\t\t\t  => _n_noop( 'Activate installed plugin', 'Activate installed plugins' ),\r\n                'return'                          => __( 'Return to Required Plugins Installer', $this->domain ),\r\n                'plugin_activated'                => __( 'Plugin activated successfully.', $this->domain ),\r\n                'complete'                        => __( 'All plugins installed and activated successfully. %1$s', $this->domain ),\r\n            );\r\n\r\n            /** Annouce that the class is ready, and pass the object (for advanced use) */\r\n            do_action_ref_array( 'tgmpa_init', array( &$this ) );\r\n\r\n            /** When the rest of WP has loaded, kick-start the rest of the class */\r\n            add_action( 'init', array( &$this, 'init' ) );\r\n\r\n        }\r\n\r\n        /**\r\n         * Initialise the interactions between this class and WordPress.\r\n         *\r\n         * Hooks in three new methods for the class: admin_menu, notices and styles.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @see TGM_Plugin_Activation::admin_menu()\r\n         * @see TGM_Plugin_Activation::notices()\r\n         * @see TGM_Plugin_Activation::styles()\r\n         */\r\n        public function init() {\r\n\r\n            do_action( 'tgmpa_register' );\r\n            /** After this point, the plugins should be registered and the configuration set */\r\n\r\n            /** Proceed only if we have plugins to handle */\r\n            if ( $this->plugins ) {\r\n                $sorted = array(); // Prepare variable for sorting\r\n\r\n                foreach ( $this->plugins as $plugin )\r\n                    $sorted[] = $plugin['name'];\r\n\r\n                array_multisort( $sorted, SORT_ASC, $this->plugins ); // Sort plugins alphabetically by name\r\n\r\n                add_action( 'admin_menu', array( &$this, 'admin_menu' ) );\r\n                add_action( 'admin_head', array( &$this, 'dismiss' ) );\r\n                add_filter( 'install_plugin_complete_actions', array( &$this, 'actions' ) );\r\n\r\n                /** Load admin bar in the header to remove flash when installing plugins */\r\n                if ( $this->is_tgmpa_page() ) {\r\n                    remove_action( 'wp_footer', 'wp_admin_bar_render', 1000 );\r\n                    remove_action( 'admin_footer', 'wp_admin_bar_render', 1000 );\r\n                    add_action( 'wp_head', 'wp_admin_bar_render', 1000 );\r\n                    add_action( 'admin_head', 'wp_admin_bar_render', 1000 );\r\n                }\r\n\r\n                if ( $this->has_notices ) {\r\n                    add_action( 'admin_notices', array( &$this, 'notices' ) );\r\n                    add_action( 'admin_init', array( &$this, 'admin_init' ), 1 );\r\n                    add_action( 'admin_enqueue_scripts', array( &$this, 'thickbox' ) );\r\n                    add_action( 'switch_theme', array( &$this, 'update_dismiss' ) );\r\n                }\r\n\r\n                /** Setup the force activation hook */\r\n                foreach ( $this->plugins as $plugin ) {\r\n                    if ( isset( $plugin['force_activation'] ) && true === $plugin['force_activation'] ) {\r\n                        add_action( 'admin_init', array( &$this, 'force_activation' ) );\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                /** Setup the force deactivation hook */\r\n                foreach ( $this->plugins as $plugin ) {\r\n                    if ( isset( $plugin['force_deactivation'] ) && true === $plugin['force_deactivation'] ) {\r\n                        add_action( 'switch_theme', array( &$this, 'force_deactivation' ) );\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Handles calls to show plugin information via links in the notices.\r\n         *\r\n         * We get the links in the admin notices to point to the TGMPA page, rather\r\n         * than the typical plugin-install.php file, so we can prepare everything\r\n         * beforehand.\r\n         *\r\n         * WP doesn't make it easy to show the plugin information in the thickbox -\r\n         * here we have to require a file that includes a function that does the\r\n         * main work of displaying it, enqueue some styles, set up some globals and\r\n         * finally call that function before exiting.\r\n         *\r\n         * Down right easy once you know how...\r\n         *\r\n         * @since 2.1.0\r\n         *\r\n         * @global string $tab Used as iframe div class names, helps with styling\r\n         * @global string $body_id Used as the iframe body ID, helps with styling\r\n         * @return null Returns early if not the TGMPA page.\r\n         */\r\n        public function admin_init() {\r\n\r\n            if ( ! $this->is_tgmpa_page() )\r\n                return;\r\n\r\n            if ( isset( $_REQUEST['tab'] ) && 'plugin-information' == $_REQUEST['tab'] ) {\r\n                require_once ABSPATH . 'wp-admin/includes/plugin-install.php'; // Need for install_plugin_information()\r\n\r\n                wp_enqueue_style( 'plugin-install' );\r\n\r\n                global $tab, $body_id;\r\n                $body_id = $tab = 'plugin-information';\r\n\r\n                install_plugin_information();\r\n\r\n                exit;\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Enqueues thickbox scripts/styles for plugin info.\r\n         *\r\n         * Thickbox is not automatically included on all admin pages, so we must\r\n         * manually enqueue it for those pages.\r\n         *\r\n         * Thickbox is only loaded if the user has not dismissed the admin\r\n         * notice or if there are any plugins left to install and activate.\r\n         *\r\n         * @since 2.1.0\r\n         */\r\n        public function thickbox() {\r\n\r\n            if ( ! get_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice', true ) )\r\n                add_thickbox();\r\n\r\n        }\r\n\r\n        /**\r\n         * Adds submenu page under 'Appearance' tab.\r\n         *\r\n         * This method adds the submenu page letting users know that a required\r\n         * plugin needs to be installed.\r\n         *\r\n         * This page disappears once the plugin has been installed and activated.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @see TGM_Plugin_Activation::init()\r\n         * @see TGM_Plugin_Activation::install_plugins_page()\r\n         */\r\n        public function admin_menu() {\r\n\r\n            // Make sure privileges are correct to see the page\r\n            if ( ! current_user_can( 'install_plugins' ) )\r\n                return;\r\n\r\n            $this->populate_file_path();\r\n\r\n            foreach ( $this->plugins as $plugin ) {\r\n                if ( ! is_plugin_active( $plugin['file_path'] ) ) {\r\n                    add_submenu_page(\r\n                        $this->parent_menu_slug,\t\t\t\t// Parent menu slug\r\n                        $this->strings['page_title'],           // Page title\r\n                        $this->strings['menu_title'],           // Menu title\r\n                        'edit_theme_options',                   // Capability\r\n                        $this->menu,                            // Menu slug\r\n                        array( &$this, 'install_plugins_page' ) // Callback\r\n                    );\r\n                break;\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Echoes plugin installation form.\r\n         *\r\n         * This method is the callback for the admin_menu method function.\r\n         * This displays the admin page and form area where the user can select to install and activate the plugin.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @return null Aborts early if we're processing a plugin installation action\r\n         */\r\n        public function install_plugins_page() {\r\n\r\n            /** Store new instance of plugin table in object */\r\n            $plugin_table = new TGMPA_List_Table;\r\n\r\n            /** Return early if processing a plugin installation action */\r\n            if ( isset( $_POST[sanitize_key( 'action' )] ) && 'tgmpa-bulk-install' == $_POST[sanitize_key( 'action' )] && $plugin_table->process_bulk_actions() || $this->do_plugin_install() )\r\n                return;\r\n\r\n            ?>\r\n            <div class=\"tgmpa wrap\">\r\n\r\n                <?php screen_icon( apply_filters( 'tgmpa_default_screen_icon', 'themes' ) ); ?>\r\n                <h2><?php echo esc_html( get_admin_page_title() ); ?></h2>\r\n                <?php $plugin_table->prepare_items(); ?>\r\n\r\n                <?php if ( isset( $this->message ) ) _e( wp_kses_post( $this->message ), $this->domain ); ?>\r\n\r\n                <form id=\"tgmpa-plugins\" action=\"\" method=\"post\">\r\n            \t\t<input type=\"hidden\" name=\"tgmpa-page\" value=\"<?php echo $this->menu; ?>\" />\r\n            \t\t<?php $plugin_table->display(); ?>\r\n        \t\t</form>\r\n\r\n            </div>\r\n            <?php\r\n\r\n        }\r\n\r\n        /**\r\n         * Installs a plugin or activates a plugin depending on the hover\r\n         * link clicked by the user.\r\n         *\r\n         * Checks the $_GET variable to see which actions have been\r\n         * passed and responds with the appropriate method.\r\n         *\r\n         * Uses WP_Filesystem to process and handle the plugin installation\r\n         * method.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @uses WP_Filesystem\r\n         * @uses WP_Error\r\n         * @uses WP_Upgrader\r\n         * @uses Plugin_Upgrader\r\n         * @uses Plugin_Installer_Skin\r\n         *\r\n         * @return boolean True on success, false on failure\r\n         */\r\n        protected function do_plugin_install() {\r\n\r\n            /** All plugin information will be stored in an array for processing */\r\n            $plugin = array();\r\n\r\n            /** Checks for actions from hover links to process the installation */\r\n            if ( isset( $_GET[sanitize_key( 'plugin' )] ) && ( isset( $_GET[sanitize_key( 'tgmpa-install' )] ) && 'install-plugin' == $_GET[sanitize_key( 'tgmpa-install' )] ) ) {\r\n                check_admin_referer( 'tgmpa-install' );\r\n\r\n                $plugin['name']   = $_GET[sanitize_key( 'plugin_name' )]; // Plugin name\r\n                $plugin['slug']   = $_GET[sanitize_key( 'plugin' )]; // Plugin slug\r\n                $plugin['source'] = $_GET[sanitize_key( 'plugin_source' )]; // Plugin source\r\n\r\n                /** Pass all necessary information via URL if WP_Filesystem is needed */\r\n                $url = wp_nonce_url(\r\n                    add_query_arg(\r\n                        array(\r\n                            'page'          => $this->menu,\r\n                            'plugin'        => $plugin['slug'],\r\n                            'plugin_name'   => $plugin['name'],\r\n                            'plugin_source' => $plugin['source'],\r\n                            'tgmpa-install' => 'install-plugin',\r\n                        ),\r\n                        admin_url( $this->parent_url_slug )\r\n                    ),\r\n                    'tgmpa-install'\r\n                );\r\n                $method = ''; // Leave blank so WP_Filesystem can populate it as necessary\r\n                $fields = array( sanitize_key( 'tgmpa-install' ) ); // Extra fields to pass to WP_Filesystem\r\n\r\n                if ( false === ( $creds = request_filesystem_credentials( $url, $method, false, false, $fields ) ) )\r\n                    return true;\r\n\r\n                if ( ! WP_Filesystem( $creds ) ) {\r\n                    request_filesystem_credentials( $url, $method, true, false, $fields ); // Setup WP_Filesystem\r\n                    return true;\r\n                }\r\n\r\n                require_once ABSPATH . 'wp-admin/includes/plugin-install.php'; // Need for plugins_api\r\n                require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'; // Need for upgrade classes\r\n\r\n                $api = plugins_api( 'plugin_information', array( 'slug' => $plugin['slug'], 'fields' => array( 'sections' => false ) ) );\r\n\r\n                if ( is_wp_error( $api ) )\r\n                    wp_die( $this->strings['oops'] . var_dump( $api ) );\r\n\r\n                /** Set plugin source to WordPress API link if available */\r\n                if ( isset( $plugin['source'] ) && 'repo' == $plugin['source'] && isset( $api->download_link ) )\r\n                    $plugin['source'] = $api->download_link;\r\n\r\n                /** Set type, based on whether the source starts with http:// or https:// */\r\n                $type = preg_match( '|^http(s)?://|', $plugin['source'] ) ? 'web' : 'upload';\r\n\r\n                /** Prep variables for Plugin_Installer_Skin class */\r\n                $title = sprintf( $this->strings['installing'], $plugin['name'] );\r\n                $url   = add_query_arg( array( 'action' => 'install-plugin', 'plugin' => $plugin['slug'] ), 'update.php' );\r\n                if ( isset( $_GET['from'] ) )\r\n                    $url .= add_query_arg( 'from', urlencode( stripslashes( $_GET['from'] ) ), $url );\r\n\r\n                $nonce = 'install-plugin_' . $plugin['slug'];\r\n\r\n                /** Prefix a default path to pre-packaged plugins */\r\n                $source = ( 'upload' == $type ) ? $this->default_path . $plugin['source'] : $plugin['source'];\r\n\r\n                /** Create a new instance of Plugin_Upgrader */\r\n                $upgrader = new Plugin_Upgrader( $skin = new Plugin_Installer_Skin( compact( 'type', 'title', 'url', 'nonce', 'plugin', 'api' ) ) );\r\n\r\n                /** Perform the action and install the plugin from the $source urldecode() */\r\n                $upgrader->install( $source );\r\n\r\n                /** Flush plugins cache so we can make sure that the installed plugins list is always up to date */\r\n                wp_cache_flush();\r\n\r\n                /** Only activate plugins if the config option is set to true */\r\n                if ( $this->is_automatic ) {\r\n                    $plugin_activate = $upgrader->plugin_info(); // Grab the plugin info from the Plugin_Upgrader method\r\n                    $activate = activate_plugin( $plugin_activate ); // Activate the plugin\r\n                    $this->populate_file_path(); // Re-populate the file path now that the plugin has been installed and activated\r\n\r\n                    if ( is_wp_error( $activate ) ) {\r\n                        echo '<div id=\"message\" class=\"error\"><p>' . $activate->get_error_message() . '</p></div>';\r\n                        echo '<p><a href=\"' . add_query_arg( 'page', $this->menu, admin_url( $this->parent_url_slug ) ) . '\" title=\"' . esc_attr( $this->strings['return'] ) . '\" target=\"_parent\">' . __( 'Return to Required Plugins Installer', $this->domain ) . '</a></p>';\r\n                        return true; // End it here if there is an error with automatic activation\r\n                    }\r\n                    else {\r\n                        echo '<p>' . $this->strings['plugin_activated'] . '</p>';\r\n                    }\r\n                }\r\n\r\n                /** Display message based on if all plugins are now active or not */\r\n                $complete = array();\r\n                foreach ( $this->plugins as $plugin ) {\r\n                    if ( ! is_plugin_active( $plugin['file_path'] ) ) {\r\n                        echo '<p><a href=\"' . add_query_arg( 'page', $this->menu, admin_url( $this->parent_url_slug ) ) . '\" title=\"' . esc_attr( $this->strings['return'] ) . '\" target=\"_parent\">' . __( $this->strings['return'], $this->domain ) . '</a></p>';\r\n                        $complete[] = $plugin;\r\n                        break;\r\n                    }\r\n                    /** Nothing to store */\r\n                    else {\r\n                        $complete[] = '';\r\n                    }\r\n                }\r\n\r\n                /** Filter out any empty entries */\r\n                $complete = array_filter( $complete );\r\n\r\n\r\n                /** All plugins are active, so we display the complete string and hide the plugin menu */\r\n                if ( empty( $complete ) ) {\r\n                    $complete_link_text = apply_filters( 'tgmpa_complete_link_text', __( 'Return to the Dashboard', $this->domain ) );\r\n                    $complete_link_url = apply_filters( 'tgmpa_complete_link_url', admin_url() );\r\n                    echo '<p>' .  sprintf( $this->strings['complete'], '<a href=\"' . $complete_link_url . '\" title=\"' . $complete_link_text . '\">' . $complete_link_text . '</a>' ) . '</p>';\r\n                    echo '<style type=\"text/css\">#adminmenu .wp-submenu li.current { display: none !important; }</style>';\r\n                }\r\n\r\n                return true;\r\n            }\r\n            /** Checks for actions from hover links to process the activation */\r\n            elseif ( isset( $_GET[sanitize_key( 'plugin' )] ) && ( isset( $_GET[sanitize_key( 'tgmpa-activate' )] ) && 'activate-plugin' == $_GET[sanitize_key( 'tgmpa-activate' )] ) ) {\r\n                check_admin_referer( 'tgmpa-activate', 'tgmpa-activate-nonce' );\r\n\r\n                /** Populate $plugin array with necessary information */\r\n                $plugin['name']   = $_GET[sanitize_key( 'plugin_name' )];\r\n                $plugin['slug']   = $_GET[sanitize_key( 'plugin' )];\r\n                $plugin['source'] = $_GET[sanitize_key( 'plugin_source' )];\r\n\r\n                $plugin_data = get_plugins( '/' . $plugin['slug'] ); // Retrieve all plugins\r\n                $plugin_file = array_keys( $plugin_data ); // Retrieve all plugin files from installed plugins\r\n                $plugin_to_activate = $plugin['slug'] . '/' . $plugin_file[0]; // Match plugin slug with appropriate plugin file\r\n                $activate = activate_plugin( $plugin_to_activate ); // Activate the plugin\r\n\r\n                if ( is_wp_error( $activate ) ) {\r\n                    echo '<div id=\"message\" class=\"error\"><p>' . $activate->get_error_message() . '</p></div>';\r\n                    echo '<p><a href=\"' . add_query_arg( 'page', $this->menu, admin_url( $this->parent_url_slug ) ) . '\" title=\"' . esc_attr( $this->strings['return'] ) . '\" target=\"_parent\">' . __( $this->strings['return'], $this->domain ) . '</a></p>';\r\n                    return true; // End it here if there is an error with activation\r\n                }\r\n                else {\r\n                    /** Make sure message doesn't display again if bulk activation is performed immediately after a single activation */\r\n                    if ( ! isset( $_POST[sanitize_key( 'action' )] ) ) {\r\n                        $msg = sprintf( __( 'The following plugin was activated successfully: %s.', $this->domain ), '<strong>' . $plugin['name'] . '</strong>' );\r\n                        echo '<div id=\"message\" class=\"updated\"><p>' . $msg . '</p></div>';\r\n                    }\r\n                }\r\n            }\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n        /**\r\n         * Echoes required plugin notice.\r\n         *\r\n         * Outputs a message telling users that a specific plugin is required for\r\n         * their theme. If appropriate, it includes a link to the form page where\r\n         * users can install and activate the plugin.\r\n         *\r\n         * @since 1.0.0\r\n         *\r\n         * @global object $current_screen\r\n         * @return null Returns early if we're on the Install page\r\n         */\r\n        public function notices() {\r\n\r\n            global $current_screen;\r\n\r\n            /** Remove nag on the install page */\r\n            if ( $this->is_tgmpa_page() )\r\n                return;\r\n\r\n            $installed_plugins = get_plugins(); // Retrieve a list of all the plugins\r\n            $this->populate_file_path();\r\n\r\n            $message              = array(); // Store the messages in an array to be outputted after plugins have looped through\r\n            $install_link         = false; // Set to false, change to true in loop if conditions exist, used for action link 'install'\r\n            $install_link_count   = 0; // Used to determine plurality of install action link text\r\n            $activate_link        = false; // Set to false, change to true in loop if conditions exist, used for action link 'activate'\r\n            $activate_link_count  = 0; // Used to determine plurality of activate action link text\r\n\r\n            foreach ( $this->plugins as $plugin ) {\r\n                /** If the plugin is installed and active, check for minimum version argument before moving forward */\r\n                if ( is_plugin_active( $plugin['file_path'] ) ) {\r\n                    /** A minimum version has been specified */\r\n                    if ( isset( $plugin['version'] ) ) {\r\n                        if ( isset( $installed_plugins[$plugin['file_path']]['Version'] ) ) {\r\n                            /** If the current version is less than the minimum required version, we display a message */\r\n                            if ( version_compare( $installed_plugins[$plugin['file_path']]['Version'], $plugin['version'], '<' ) ) {\r\n                                if ( current_user_can( 'install_plugins' ) )\r\n                                    $message['notice_ask_to_update'][] = $plugin['name'];\r\n                                else\r\n                                    $message['notice_cannot_update'][] = $plugin['name'];\r\n                            }\r\n                        }\r\n                        /** Can't find the plugin, so iterate to the next condition */\r\n                        else {\r\n                            continue;\r\n                        }\r\n                    }\r\n                    /** No minimum version specified, so iterate over the plugin */\r\n                    else {\r\n                        continue;\r\n                    }\r\n                }\r\n\r\n                /** Not installed */\r\n                if ( ! isset( $installed_plugins[$plugin['file_path']] ) ) {\r\n                    $install_link = true; // We need to display the 'install' action link\r\n                    $install_link_count++; // Increment the install link count\r\n                    if ( current_user_can( 'install_plugins' ) ) {\r\n                        if ( $plugin['required'] )\r\n                            $message['notice_can_install_required'][] = $plugin['name'];\r\n                        /** This plugin is only recommended */\r\n                        else\r\n                            $message['notice_can_install_recommended'][] = $plugin['name'];\r\n                    }\r\n                    /** Need higher privileges to install the plugin */\r\n                    else {\r\n                        $message['notice_cannot_install'][] = $plugin['name'];\r\n                    }\r\n                }\r\n                /** Installed but not active */\r\n                elseif ( is_plugin_inactive( $plugin['file_path'] ) ) {\r\n                    $activate_link = true; // We need to display the 'activate' action link\r\n                    $activate_link_count++; // Increment the activate link count\r\n                    if ( current_user_can( 'activate_plugins' ) ) {\r\n                        if ( $plugin['required'] )\r\n                            $message['notice_can_activate_required'][] = $plugin['name'];\r\n                        /** This plugin is only recommended */\r\n                        else {\r\n                            $message['notice_can_activate_recommended'][] = $plugin['name'];\r\n                        }\r\n                    }\r\n                    /** Need higher privileges to activate the plugin */\r\n                    else {\r\n                        $message['notice_cannot_activate'][] = $plugin['name'];\r\n                    }\r\n                }\r\n            }\r\n\r\n            /** Only process the nag messages if the user has not dismissed them already */\r\n            if ( ! get_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice', true ) ) {\r\n                /** If we have notices to display, we move forward */\r\n                if ( ! empty( $message ) ) {\r\n                    krsort( $message ); // Sort messages\r\n                    $rendered = ''; // Display all nag messages as strings\r\n\r\n                    /** Grab all plugin names */\r\n                    foreach ( $message as $type => $plugin_groups ) {\r\n                        $linked_plugin_groups = array();\r\n\r\n                        /** Count number of plugins in each message group to calculate singular/plural message */\r\n                        $count = count( $plugin_groups );\r\n\r\n                        /** Loop through the plugin names to make the ones pulled from the .org repo linked */\r\n                        foreach ( $plugin_groups as $plugin_group_single_name ) {\r\n                            $external_url = $this->_get_plugin_data_from_name( $plugin_group_single_name, 'external_url' );\r\n                            $source = $this->_get_plugin_data_from_name( $plugin_group_single_name, 'source' );\r\n\r\n                            if ( $external_url && preg_match( '|^http(s)?://|', $external_url ) ) {\r\n                                $linked_plugin_groups[] = '<a href=\"' . esc_url( $external_url ) . '\" title=\"' . $plugin_group_single_name . '\" target=\"_blank\">' . $plugin_group_single_name . '</a>';\r\n                            }\r\n                            elseif ( ! $source || preg_match( '|^http://wordpress.org/extend/plugins/|', $source ) ) {\r\n                                $url = add_query_arg(\r\n                                    array(\r\n                                        'tab'       => 'plugin-information',\r\n                                        'plugin'    => $this->_get_plugin_data_from_name( $plugin_group_single_name ),\r\n                                        'TB_iframe' => 'true',\r\n                                        'width'     => '640',\r\n                                        'height'    => '500',\r\n                                    ),\r\n                                    admin_url( 'plugin-install.php' )\r\n                                );\r\n\r\n                                $linked_plugin_groups[] = '<a href=\"' . esc_url( $url ) . '\" class=\"thickbox\" title=\"' . $plugin_group_single_name . '\">' . $plugin_group_single_name . '</a>';\r\n                            }\r\n                            else {\r\n                                $linked_plugin_groups[] = $plugin_group_single_name; // No hyperlink\r\n                            }\r\n\r\n                            if ( isset( $linked_plugin_groups ) && (array) $linked_plugin_groups )\r\n                                $plugin_groups = $linked_plugin_groups;\r\n                        }\r\n\r\n                        $last_plugin = array_pop( $plugin_groups ); // Pop off last name to prep for readability\r\n                        $imploded    = empty( $plugin_groups ) ? '<em>' . $last_plugin . '</em>' : '<em>' . ( implode( ', ', $plugin_groups ) . '</em> and <em>' . $last_plugin . '</em>' );\r\n\r\n                        $rendered .= '<p>' . sprintf( translate_nooped_plural( $this->strings[$type], $count, $this->domain ), $imploded, $count ) . '</p>'; // All messages now stored\r\n                    }\r\n\r\n                    /** Setup variables to determine if action links are needed */\r\n                    $show_install_link  = $install_link ? '<a href=\"' . add_query_arg( 'page', $this->menu, admin_url( $this->parent_url_slug ) ) . '\">' . translate_nooped_plural( $this->strings['install_link'], $install_link_count, $this->domain ) . '</a>' : '';\r\n                    $show_activate_link = $activate_link ? '<a href=\"' . admin_url( 'plugins.php' ) . '\">' . translate_nooped_plural( $this->strings['activate_link'], $activate_link_count, $this->domain ) . '</a>'  : '';\r\n\r\n                    /** Define all of the action links */\r\n                    $action_links = apply_filters(\r\n                        'tgmpa_notice_action_links',\r\n                        array(\r\n                            'install'  => ( current_user_can( 'install_plugins' ) ) ? $show_install_link : '',\r\n                            'activate' => ( current_user_can( 'activate_plugins' ) ) ? $show_activate_link : '',\r\n                            'dismiss'  => '<a class=\"dismiss-notice\" href=\"' . esc_url( add_query_arg( 'tgmpa-dismiss', 'dismiss_admin_notices' ) ) . '\" target=\"_parent\">' . __( 'Dismiss this notice', $this->domain ) . '</a>',\r\n                        )\r\n                    );\r\n\r\n                    $action_links = array_filter( $action_links ); // Remove any empty array items\r\n                    if ( $action_links )\r\n                        $rendered .= '<p>' . implode( ' | ', $action_links ) . '</p>';\r\n\r\n                    /** Register the nag messages and prepare them to be processed */\r\n                    add_settings_error( 'tgmpa', 'tgmpa', $rendered, 'updated' );\r\n                }\r\n            }\r\n\r\n            /** Admin options pages already output settings_errors, so this is to avoid duplication */\r\n            if ( 'options-general' !== $current_screen->parent_base )\r\n                settings_errors( 'tgmpa' );\r\n\r\n        }\r\n\r\n        /**\r\n         * Add dismissable admin notices.\r\n         *\r\n         * Appends a link to the admin nag messages. If clicked, the admin notice disappears and no longer is visible to users.\r\n         *\r\n         * @since 2.1.0\r\n         */\r\n        public function dismiss() {\r\n\r\n            if ( isset( $_GET[sanitize_key( 'tgmpa-dismiss' )] ) )\r\n                update_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice', 1 );\r\n\r\n        }\r\n\r\n        /**\r\n         * Add individual plugin to our collection of plugins.\r\n         *\r\n         * If the required keys are not set, the plugin is not added.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @param array $plugin Array of plugin arguments.\r\n         */\r\n        public function register( $plugin ) {\r\n\r\n            if ( ! isset( $plugin['slug'] ) || ! isset( $plugin['name'] ) )\r\n                return;\r\n\r\n            $this->plugins[] = $plugin;\r\n\r\n        }\r\n\r\n        /**\r\n         * Amend default configuration settings.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @param array $config\r\n         */\r\n        public function config( $config ) {\r\n\r\n            $keys = array( 'default_path', 'parent_menu_slug', 'parent_url_slug', 'domain', 'has_notices', 'menu', 'is_automatic', 'message', 'strings' );\r\n\r\n            foreach ( $keys as $key ) {\r\n                if ( isset( $config[$key] ) ) {\r\n                    if ( is_array( $config[$key] ) ) {\r\n                        foreach ( $config[$key] as $subkey => $value )\r\n                            $this->{$key}[$subkey] = $value;\r\n                    } else {\r\n                        $this->$key = $config[$key];\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Amend action link after plugin installation.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @param array $install_actions Existing array of actions\r\n         * @return array Amended array of actions\r\n         */\r\n        public function actions( $install_actions ) {\r\n\r\n            /** Remove action links on the TGMPA install page */\r\n            if ( $this->is_tgmpa_page() )\r\n                return false;\r\n\r\n            return $install_actions;\r\n\r\n        }\r\n\r\n        /**\r\n         * Set file_path key for each installed plugin.\r\n         *\r\n         * @since 2.1.0\r\n         */\r\n        public function populate_file_path() {\r\n\r\n            /** Add file_path key for all plugins */\r\n            foreach ( $this->plugins as $plugin => $values )\r\n                $this->plugins[$plugin]['file_path'] = $this->_get_plugin_basename_from_slug( $values['slug'] );\r\n\r\n        }\r\n\r\n        /**\r\n         * Helper function to extract the file path of the plugin file from the\r\n         * plugin slug, if the plugin is installed.\r\n         *\r\n         * @since 2.0.0\r\n         *\r\n         * @param string $slug Plugin slug (typically folder name) as provided by the developer\r\n         * @return string Either file path for plugin if installed, or just the plugin slug\r\n         */\r\n        protected function _get_plugin_basename_from_slug( $slug ) {\r\n\r\n            $keys = array_keys( get_plugins() );\r\n\r\n            foreach ( $keys as $key ) {\r\n                if ( preg_match( '|^' . $slug .'|', $key ) )\r\n                    return $key;\r\n            }\r\n\r\n            return $slug;\r\n\r\n        }\r\n\r\n        /**\r\n         * Retrieve plugin data, given the plugin name.\r\n         *\r\n         * Loops through the registered plugins looking for $name. If it finds it,\r\n         * it returns the $data from that plugin. Otherwise, returns false.\r\n         *\r\n         * @since 2.1.0\r\n         *\r\n         * @param string $name Name of the plugin, as it was registered\r\n         * @param string $data Optional. Array key of plugin data to return. Default is slug\r\n         * @return string|boolean Plugin slug if found, false otherwise.\r\n         */\r\n        protected function _get_plugin_data_from_name( $name, $data = 'slug' ) {\r\n\r\n            foreach ( $this->plugins as $plugin => $values ) {\r\n                if ( $name == $values['name'] && isset( $values[$data] ) )\r\n                    return $values[$data];\r\n            }\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n        /**\r\n         * Determine if we're on the TGMPA Install page.\r\n         *\r\n         * We use $current_screen when it is available, and a slightly less ideal\r\n         * conditional when it isn't (like when displaying the plugin information\r\n         * thickbox).\r\n         *\r\n         * @since 2.1.0\r\n         *\r\n         * @global object $current_screen\r\n         * @return boolean True when on the TGMPA page, false otherwise.\r\n         */\r\n        protected function is_tgmpa_page() {\r\n\r\n            global $current_screen;\r\n\r\n            if ( ! is_null( $current_screen ) && $this->parent_menu_slug == $current_screen->parent_file && isset( $_GET['page'] ) && $this->menu === $_GET['page'] )\r\n                return true;\r\n\r\n            if ( isset( $_GET['page'] ) && $this->menu === $_GET['page'] )\r\n                return true;\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n        /**\r\n         * Delete dismissable nag option when theme is switched.\r\n         *\r\n         * This ensures that the user is again reminded via nag of required\r\n         * and/or recommended plugins if they re-activate the theme.\r\n         *\r\n         * @since 2.1.1\r\n         */\r\n        public function update_dismiss() {\r\n\r\n            delete_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice' );\r\n\r\n        }\r\n\r\n        /**\r\n         * Forces plugin activation if the parameter 'force_activation' is\r\n         * set to true.\r\n         *\r\n         * This allows theme authors to specify certain plugins that must be\r\n         * active at all times while using the current theme.\r\n         *\r\n         * Please take special care when using this parameter as it has the\r\n         * potential to be harmful if not used correctly. Setting this parameter\r\n         * to true will not allow the specified plugin to be deactivated unless\r\n         * the user switches themes.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function force_activation() {\r\n\r\n            /** Set file_path parameter for any installed plugins */\r\n            $this->populate_file_path();\r\n\r\n            $installed_plugins = get_plugins();\r\n\r\n            foreach ( $this->plugins as $plugin ) {\r\n                /** Oops, plugin isn't there so iterate to next condition */\r\n                if ( isset( $plugin['force_activation'] ) && $plugin['force_activation'] && ! isset( $installed_plugins[$plugin['file_path']] ) )\r\n                    continue;\r\n                /** There we go, activate the plugin */\r\n                elseif ( isset( $plugin['force_activation'] ) && $plugin['force_activation'] && is_plugin_inactive( $plugin['file_path'] ) )\r\n                    activate_plugin( $plugin['file_path'] );\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Forces plugin deactivation if the parameter 'force_deactivation'\r\n         * is set to true.\r\n         *\r\n         * This allows theme authors to specify certain plugins that must be\r\n         * deactived upon switching from the current theme to another.\r\n         *\r\n         * Please take special care when using this parameter as it has the\r\n         * potential to be harmful if not used correctly.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function force_deactivation() {\r\n\r\n            /** Set file_path parameter for any installed plugins */\r\n            $this->populate_file_path();\r\n\r\n            foreach ( $this->plugins as $plugin ) {\r\n                /** Only proceed forward if the paramter is set to true and plugin is active */\r\n                if ( isset( $plugin['force_deactivation'] ) && $plugin['force_deactivation'] && is_plugin_active( $plugin['file_path'] ) )\r\n                    deactivate_plugins( $plugin['file_path'] );\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/** Create a new instance of the class */\r\nnew TGM_Plugin_Activation;\r\n\r\nif ( ! function_exists( 'tgmpa' ) ) {\r\n    /**\r\n     * Helper function to register a collection of required plugins.\r\n     *\r\n     * @since 2.0.0\r\n     * @api\r\n     *\r\n     * @param array $plugins An array of plugin arrays\r\n     * @param array $config Optional. An array of configuration values\r\n     */\r\n    function tgmpa( $plugins, $config = array() ) {\r\n\r\n        foreach ( $plugins as $plugin )\r\n            TGM_Plugin_Activation::$instance->register( $plugin );\r\n\r\n        if ( $config )\r\n            TGM_Plugin_Activation::$instance->config( $config );\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * WP_List_Table isn't always available. If it isn't available,\r\n * we load it here.\r\n *\r\n * @since 2.2.0\r\n */\r\nif ( ! class_exists( 'WP_List_Table' ) )\r\n    require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' );\r\n\r\nif ( ! class_exists( 'TGMPA_List_Table' ) ) {\r\n    /**\r\n     * List table class for handling plugins.\r\n     *\r\n     * Extends the WP_List_Table class to provide a future-compatible\r\n     * way of listing out all required/recommended plugins.\r\n     *\r\n     * Gives users an interface similar to the Plugin Administration\r\n     * area with similar (albeit stripped down) capabilities.\r\n     *\r\n     * This class also allows for the bulk install of plugins.\r\n     *\r\n     * @since 2.2.0\r\n     *\r\n     * @package TGM-Plugin-Activation\r\n     * @author Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n     * @author Gary Jones <gamajo@gamajo.com>\r\n     */\r\n    class TGMPA_List_Table extends WP_List_Table {\r\n\r\n        /**\r\n         * References parent constructor and sets defaults for class.\r\n         *\r\n         * The constructor also grabs a copy of $instance from the TGMPA class\r\n         * and stores it in the global object TGM_Plugin_Activation::$instance.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @global unknown $status\r\n         * @global string $page\r\n         */\r\n        public function __construct() {\r\n\r\n            global $status, $page;\r\n\r\n            parent::__construct(\r\n                array(\r\n                    'singular' => 'plugin',\r\n                    'plural'   => 'plugins',\r\n                    'ajax'     => false,\r\n                )\r\n            );\r\n\r\n        }\r\n\r\n        /**\r\n         * Gathers and renames all of our plugin information to be used by\r\n         * WP_List_Table to create our table.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @return array $table_data Information for use in table\r\n         */\r\n        protected function _gather_plugin_data() {\r\n\r\n            /** Load thickbox for plugin links */\r\n            TGM_Plugin_Activation::$instance->admin_init();\r\n            TGM_Plugin_Activation::$instance->thickbox();\r\n\r\n            /** Prep variables for use and grab list of all installed plugins */\r\n            $table_data = array();\r\n            $i = 0;\r\n            $installed_plugins = get_plugins();\r\n\r\n            foreach ( TGM_Plugin_Activation::$instance->plugins as $plugin ) {\r\n                if ( is_plugin_active( $plugin['file_path'] ) )\r\n                    continue; // No need to display plugins if they are installed and activated\r\n\r\n                $table_data[$i]['sanitized_plugin'] = $plugin['name'];\r\n                $table_data[$i]['slug'] = $this->_get_plugin_data_from_name( $plugin['name'] );\r\n\r\n                $external_url = $this->_get_plugin_data_from_name( $plugin['name'], 'external_url' );\r\n                $source = $this->_get_plugin_data_from_name( $plugin['name'], 'source' );\r\n\r\n                if ( $external_url && preg_match( '|^http(s)?://|', $external_url ) ) {\r\n                    $table_data[$i]['plugin'] = '<strong><a href=\"' . esc_url( $external_url ) . '\" title=\"' . $plugin['name'] . '\" target=\"_blank\">' . $plugin['name'] . '</a></strong>';\r\n                }\r\n                elseif ( ! $source || preg_match( '|^http://wordpress.org/extend/plugins/|', $source ) ) {\r\n                    $url = add_query_arg(\r\n                        array(\r\n                            'tab'       => 'plugin-information',\r\n                            'plugin'    => $this->_get_plugin_data_from_name( $plugin['name'] ),\r\n                            'TB_iframe' => 'true',\r\n                            'width'     => '640',\r\n                            'height'    => '500',\r\n                        ),\r\n                        admin_url( 'plugin-install.php' )\r\n                    );\r\n\r\n                    $table_data[$i]['plugin'] = '<strong><a href=\"' . esc_url( $url ) . '\" class=\"thickbox\" title=\"' . $plugin['name'] . '\">' . $plugin['name'] . '</a></strong>';\r\n                }\r\n                else {\r\n                    $table_data[$i]['plugin'] = '<strong>' . $plugin['name'] . '</strong>'; // No hyperlink\r\n                }\r\n\r\n                if ( isset( $table_data[$i]['plugin'] ) && (array) $table_data[$i]['plugin'] )\r\n                    $plugin['name'] = $table_data[$i]['plugin'];\r\n\r\n                if ( isset( $plugin['external_url'] ) ) {\r\n                    /** The plugin is linked to an external source */\r\n                    $table_data[$i]['source'] = __( 'External Link', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n                elseif ( isset( $plugin['source'] ) ) {\r\n                    /** The plugin must be from a private repository */\r\n                    if ( preg_match( '|^http(s)?://|', $plugin['source'] ) )\r\n                        $table_data[$i]['source'] = __( 'Private Repository', TGM_Plugin_Activation::$instance->domain );\r\n                    /** The plugin is pre-packaged with the theme */\r\n                    else\r\n                        $table_data[$i]['source'] = __( 'Pre-Packaged', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n                /** The plugin is from the WordPress repository */\r\n                else {\r\n                    $table_data[$i]['source'] = __( 'WordPress Repository', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n\r\n                $table_data[$i]['type'] = $plugin['required'] ? __( 'Required', TGM_Plugin_Activation::$instance->domain ) : __( 'Recommended', TGM_Plugin_Activation::$instance->domain );\r\n\r\n                if ( ! isset( $installed_plugins[$plugin['file_path']] ) )\r\n                    $table_data[$i]['status'] = sprintf( '%1$s', __( 'Not Installed', TGM_Plugin_Activation::$instance->domain ) );\r\n                elseif ( is_plugin_inactive( $plugin['file_path'] ) )\r\n                    $table_data[$i]['status'] = sprintf( '%1$s', __( 'Installed But Not Activated', TGM_Plugin_Activation::$instance->domain ) );\r\n\r\n                $table_data[$i]['file_path'] = $plugin['file_path'];\r\n                $table_data[$i]['url'] = isset( $plugin['source'] ) ? $plugin['source'] : 'repo';\r\n\r\n                $i++;\r\n            }\r\n\r\n            /** Sort plugins by Required/Recommended type and by alphabetical listing within each type */\r\n            $resort = array();\r\n            $req = array();\r\n            $rec = array();\r\n\r\n            /** Grab all the plugin types */\r\n            foreach ( $table_data as $plugin )\r\n                $resort[] = $plugin['type'];\r\n\r\n            /** Sort each plugin by type */\r\n            foreach ( $resort as $type )\r\n                if ( 'Required' == $type )\r\n                    $req[] = $type;\r\n                else\r\n                    $rec[] = $type;\r\n\r\n            /** Sort alphabetically each plugin type array, merge them and then sort in reverse\t(lists Required plugins first) */\r\n            sort( $req );\r\n            sort( $rec );\r\n            array_merge( $resort, $req, $rec );\r\n            array_multisort( $resort, SORT_DESC, $table_data );\r\n\r\n            return $table_data;\r\n\r\n        }\r\n\r\n        /**\r\n         * Retrieve plugin data, given the plugin name. Taken from the\r\n         * TGM_Plugin_Activation class.\r\n         *\r\n         * Loops through the registered plugins looking for $name. If it finds it,\r\n         * it returns the $data from that plugin. Otherwise, returns false.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @param string $name Name of the plugin, as it was registered\r\n         * @param string $data Optional. Array key of plugin data to return. Default is slug\r\n         * @return string|boolean Plugin slug if found, false otherwise\r\n         */\r\n        protected function _get_plugin_data_from_name( $name, $data = 'slug' ) {\r\n\r\n            foreach ( TGM_Plugin_Activation::$instance->plugins as $plugin => $values ) {\r\n                if ( $name == $values['name'] && isset( $values[$data] ) )\r\n                    return $values[$data];\r\n            }\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n        /**\r\n         * Create default columns to display important plugin information\r\n         * like type, action and status.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @param array $item\r\n         * @param string $column_name\r\n         */\r\n        public function column_default( $item, $column_name ) {\r\n\r\n            switch ( $column_name ) {\r\n                case 'source':\r\n                case 'type':\r\n                case 'status':\r\n                    return $item[$column_name];\r\n            }\r\n\r\n        }\r\n\r\n        /**\r\n         * Create default title column along with action links of 'Install'\r\n         * and 'Activate'.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @param array $item\r\n         * @return string The action hover links\r\n         */\r\n        public function column_plugin( $item ) {\r\n\r\n            $installed_plugins = get_plugins();\r\n\r\n            /** No need to display any hover links */\r\n            if ( is_plugin_active( $item['file_path'] ) )\r\n                $actions = array();\r\n\r\n            /** We need to display the 'Install' hover link */\r\n            if ( ! isset( $installed_plugins[$item['file_path']] ) ) {\r\n                $actions = array(\r\n                    'install' => sprintf(\r\n                        '<a href=\"%1$s\" title=\"Install %2$s\">Install</a>',\r\n                        wp_nonce_url(\r\n                            add_query_arg(\r\n                                array(\r\n                                    'page'          => TGM_Plugin_Activation::$instance->menu,\r\n                                    'plugin'        => $item['slug'],\r\n                                    'plugin_name'   => $item['sanitized_plugin'],\r\n                                    'plugin_source' => $item['url'],\r\n                                    'tgmpa-install' => 'install-plugin',\r\n                                ),\r\n                                admin_url( TGM_Plugin_Activation::$instance->parent_url_slug )\r\n                            ),\r\n                            'tgmpa-install'\r\n                        ),\r\n                        $item['sanitized_plugin']\r\n                    ),\r\n                );\r\n            }\r\n            /** We need to display the 'Activate' hover link */\r\n            elseif ( is_plugin_inactive( $item['file_path'] ) ) {\r\n                $actions = array(\r\n                    'activate' => sprintf(\r\n                        '<a href=\"%1$s\" title=\"Activate %2$s\">Activate</a>',\r\n                        add_query_arg(\r\n                            array(\r\n                                'page'                 => TGM_Plugin_Activation::$instance->menu,\r\n                                'plugin'               => $item['slug'],\r\n                                'plugin_name'          => $item['sanitized_plugin'],\r\n                                'plugin_source'        => $item['url'],\r\n                                'tgmpa-activate'       => 'activate-plugin',\r\n                                'tgmpa-activate-nonce' => wp_create_nonce( 'tgmpa-activate' ),\r\n                            ),\r\n                            admin_url( TGM_Plugin_Activation::$instance->parent_url_slug )\r\n                        ),\r\n                        $item['sanitized_plugin']\r\n                    ),\r\n                );\r\n            }\r\n\r\n            return sprintf( '%1$s %2$s', $item['plugin'], $this->row_actions( $actions ) );\r\n\r\n        }\r\n\r\n        /**\r\n         * Required for bulk installing.\r\n         *\r\n         * Adds a checkbox for each plugin.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @param array $item\r\n         * @return string The input checkbox with all necessary info\r\n         */\r\n        public function column_cb( $item ) {\r\n\r\n            $value = $item['file_path'] . ',' . $item['url'] . ',' . $item['sanitized_plugin'];\r\n            return sprintf( '<input type=\"checkbox\" name=\"%1$s[]\" value=\"%2$s\" id=\"%3$s\" />', $this->_args['singular'], $value, $item['sanitized_plugin'] );\r\n\r\n        }\r\n\r\n        /**\r\n         * Sets default message within the plugins table if no plugins\r\n         * are left for interaction.\r\n         *\r\n         * Hides the menu item to prevent the user from clicking and\r\n         * getting a permissions error.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function no_items() {\r\n\r\n            printf( __( 'No plugins to install or activate. <a href=\"%1$s\" title=\"Return to the Dashboard\">Return to the Dashboard</a>', TGM_Plugin_Activation::$instance->domain ), admin_url() );\r\n            echo '<style type=\"text/css\">#adminmenu .wp-submenu li.current { display: none !important; }</style>';\r\n\r\n        }\r\n\r\n        /**\r\n         * Output all the column information within the table.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @return array $columns The column names\r\n         */\r\n        public function get_columns() {\r\n\r\n            $columns = array(\r\n                'cb'     => '<input type=\"checkbox\" />',\r\n                'plugin' => __( 'Plugin', TGM_Plugin_Activation::$instance->domain ),\r\n                'source' => __( 'Source', TGM_Plugin_Activation::$instance->domain ),\r\n                'type'   => __( 'Type', TGM_Plugin_Activation::$instance->domain ),\r\n                'status' => __( 'Status', TGM_Plugin_Activation::$instance->domain )\r\n            );\r\n\r\n            return $columns;\r\n\r\n        }\r\n\r\n        /**\r\n         * Defines all types of bulk actions for handling\r\n         * registered plugins.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @return array $actions The bulk actions for the plugin install table\r\n         */\r\n        public function get_bulk_actions() {\r\n\r\n            $actions = array(\r\n                'tgmpa-bulk-install'  => __( 'Install', TGM_Plugin_Activation::$instance->domain ),\r\n                'tgmpa-bulk-activate' => __( 'Activate', TGM_Plugin_Activation::$instance->domain ),\r\n            );\r\n\r\n            return $actions;\r\n\r\n        }\r\n\r\n        /**\r\n         * Processes bulk installation and activation actions.\r\n         *\r\n         * The bulk installation process looks either for the $_POST\r\n         * information or for the plugin info within the $_GET variable if\r\n         * a user has to use WP_Filesystem to enter their credentials.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function process_bulk_actions() {\r\n\r\n            /** Bulk installation process */\r\n            if ( 'tgmpa-bulk-install' === $this->current_action() ) {\r\n                check_admin_referer( 'bulk-' . $this->_args['plural'] );\r\n\r\n                /** Prep variables to be populated */\r\n                $plugins_to_install = array();\r\n                $plugin_installs    = array();\r\n                $plugin_path        = array();\r\n                $plugin_name        = array();\r\n\r\n                /** Look first to see if information has been passed via WP_Filesystem */\r\n                if ( isset( $_GET[sanitize_key( 'plugins' )] ) )\r\n                    $plugins = explode( ',', stripslashes( $_GET[sanitize_key( 'plugins' )] ) );\r\n                /** Looks like the user can use the direct method, take from $_POST */\r\n                elseif ( isset( $_POST[sanitize_key( 'plugin' )] ) )\r\n                    $plugins = (array) $_POST[sanitize_key( 'plugin' )];\r\n                /** Nothing has been submitted */\r\n                else\r\n                    $plugins = array();\r\n\r\n                $a = 0; // Incremental variable\r\n\r\n                /** Grab information from $_POST if available */\r\n                if ( isset( $_POST[sanitize_key( 'plugin' )] ) ) {\r\n                    foreach ( $plugins as $plugin_data )\r\n                        $plugins_to_install[] = explode( ',', $plugin_data );\r\n\r\n                    foreach ( $plugins_to_install as $plugin_data ) {\r\n                        $plugin_installs[] = $plugin_data[0];\r\n                        $plugin_path[]     = $plugin_data[1];\r\n                        $plugin_name[]     = $plugin_data[2];\r\n                    }\r\n                }\r\n                /** Information has been passed via $_GET */\r\n                else {\r\n                    foreach ( $plugins as $key => $value ) {\r\n                        /** Grab plugin slug for each plugin */\r\n                        if ( 0 == $key % 3 || 0 == $key ) {\r\n                            $plugins_to_install[] = $value;\r\n                            $plugin_installs[]    = $value;\r\n                        }\r\n                        $a++;\r\n                    }\r\n                }\r\n\r\n                /** Look first to see if information has been passed via WP_Filesystem */\r\n                if ( isset( $_GET[sanitize_key( 'plugin_paths' )] ) )\r\n                    $plugin_paths = explode( ',', stripslashes( $_GET[sanitize_key( 'plugin_paths' )] ) );\r\n                /** Looks like the user doesn't need to enter his FTP creds */\r\n                elseif ( isset( $_POST[sanitize_key( 'plugin' )] ) )\r\n                    $plugin_paths = (array) $plugin_path;\r\n                /** Nothing has been submitted */\r\n                else\r\n                    $plugin_paths = array();\r\n\r\n                /** Look first to see if information has been passed via WP_Filesystem */\r\n                if ( isset( $_GET[sanitize_key( 'plugin_names' )] ) )\r\n                    $plugin_names = explode( ',', stripslashes( $_GET[sanitize_key( 'plugin_names' )] ) );\r\n                /** Looks like the user doesn't need to enter his FTP creds */\r\n                elseif ( isset( $_POST[sanitize_key( 'plugin' )] ) )\r\n                    $plugin_names = (array) $plugin_name;\r\n                /** Nothing has been submitted */\r\n                else\r\n                    $plugin_names = array();\r\n\r\n                $b = 0; // Incremental variable\r\n\r\n                /** Loop through plugin slugs and remove already installed plugins from the list */\r\n                foreach ( $plugin_installs as $key => $plugin ) {\r\n                    if ( preg_match( '|.php$|', $plugin ) ) {\r\n                        unset( $plugin_installs[$key] );\r\n\r\n                        /** If the plugin path isn't in the $_GET variable, we can unset the corresponding path */\r\n                        if ( ! isset( $_GET[sanitize_key( 'plugin_paths' )] ) )\r\n                            unset( $plugin_paths[$b] );\r\n\r\n                        /** If the plugin name isn't in the $_GET variable, we can unset the corresponding name */\r\n                        if ( ! isset( $_GET[sanitize_key( 'plugin_names' )] ) )\r\n                            unset( $plugin_names[$b] );\r\n                    }\r\n                    $b++;\r\n                }\r\n\r\n                /** No need to proceed further if we have no plugins to install */\r\n                if ( empty( $plugin_installs ) )\r\n                    return false;\r\n\r\n                /** Reset array indexes in case we removed already installed plugins */\r\n                $plugin_installs = array_values( $plugin_installs );\r\n                $plugin_paths    = array_values( $plugin_paths );\r\n                $plugin_names    = array_values( $plugin_names );\r\n\r\n                /** If we grabbed our plugin info from $_GET, we need to decode it for use */\r\n                $plugin_installs = array_map( 'urldecode', $plugin_installs );\r\n                $plugin_paths    = array_map( 'urldecode', $plugin_paths );\r\n                $plugin_names    = array_map( 'urldecode', $plugin_names );\r\n\r\n                /** Pass all necessary information via URL if WP_Filesystem is needed */\r\n                $url = wp_nonce_url(\r\n                    add_query_arg(\r\n                        array(\r\n                            'page' \t\t\t=> TGM_Plugin_Activation::$instance->menu,\r\n                            'tgmpa-action' \t=> 'install-selected',\r\n                            'plugins' \t\t=> urlencode( implode( ',', $plugins ) ),\r\n                            'plugin_paths' \t=> urlencode( implode( ',', $plugin_paths ) ),\r\n                            'plugin_names' \t=> urlencode( implode( ',', $plugin_names ) ),\r\n                        ),\r\n                        admin_url( TGM_Plugin_Activation::$instance->parent_url_slug )\r\n                    ),\r\n                    'bulk-plugins'\r\n                );\r\n                $method = ''; // Leave blank so WP_Filesystem can populate it as necessary\r\n                $fields = array( sanitize_key( 'action' ), sanitize_key( '_wp_http_referer' ), sanitize_key( '_wpnonce' ) ); // Extra fields to pass to WP_Filesystem\r\n\r\n                if ( false === ( $creds = request_filesystem_credentials( $url, $method, false, false, $fields ) ) )\r\n                    return true;\r\n\r\n                if ( ! WP_Filesystem( $creds ) ) {\r\n                    request_filesystem_credentials( $url, $method, true, false, $fields ); // Setup WP_Filesystem\r\n                    return true;\r\n                }\r\n\r\n                require_once ABSPATH . 'wp-admin/includes/plugin-install.php'; // Need for plugins_api\r\n                require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'; // Need for upgrade classes\r\n\r\n                /** Store all information in arrays since we are processing a bulk installation */\r\n                $api          = array();\r\n                $sources      = array();\r\n                $install_path = array();\r\n\r\n                $c = 0; // Incremental variable\r\n\r\n                /** Loop through each plugin to install and try to grab information from WordPress API, if not create 'tgmpa-empty' scalar */\r\n                foreach ( $plugin_installs as $plugin ) {\r\n                    $api[$c] = plugins_api( 'plugin_information', array( 'slug' => $plugin, 'fields' => array( 'sections' => false ) ) ) ? plugins_api( 'plugin_information', array( 'slug' => $plugin, 'fields' => array( 'sections' => false ) ) ) : (object) $api[$c] = 'tgmpa-empty';\r\n                    $c++;\r\n                }\r\n\r\n                if ( is_wp_error( $api ) )\r\n                    wp_die( TGM_Plugin_Activation::$instance->strings['oops'] . var_dump( $api ) );\r\n\r\n                $d = 0;\t// Incremental variable\r\n\r\n                /** Capture download links from $api or set install link to pre-packaged/private repo */\r\n                foreach ( $api as $object ) {\r\n                    $sources[$d] = isset( $object->download_link ) ? $object->download_link : $plugin_paths[$d];\r\n                    $d++;\r\n                }\r\n\r\n                /** Finally, all the data is prepared to be sent to the installer */\r\n                $url   = add_query_arg( array( 'page' => TGM_Plugin_Activation::$instance->menu ), admin_url( TGM_Plugin_Activation::$instance->parent_url_slug ) );\r\n                $nonce = 'bulk-plugins';\r\n                $names = $plugin_names;\r\n\r\n                /** Create a new instance of TGM_Bulk_Installer */\r\n                $installer = new TGM_Bulk_Installer( $skin = new TGM_Bulk_Installer_Skin( compact( 'url', 'nonce', 'names' ) ) );\r\n\r\n                /** Wrap the install process with the appropriate HTML */\r\n                echo '<div class=\"tgmpa wrap\">';\r\n                    screen_icon( apply_filters( 'tgmpa_default_screen_icon', 'themes' ) );\r\n                    echo '<h2>' . esc_html( get_admin_page_title() ) . '</h2>';\r\n                    /** Process the bulk installation submissions */\r\n                    $installer->bulk_install( $sources );\r\n                echo '</div>';\r\n\r\n                return true;\r\n            }\r\n\r\n            /** Bulk activation process */\r\n            if ( 'tgmpa-bulk-activate' === $this->current_action() ) {\r\n                check_admin_referer( 'bulk-' . $this->_args['plural'] );\r\n\r\n                /** Grab plugin data from $_POST */\r\n                $plugins             = isset( $_POST[sanitize_key( 'plugin' )] ) ? (array) $_POST[sanitize_key( 'plugin' )] : array();\r\n                $plugins_to_activate = array();\r\n\r\n                /** Split plugin value into array with plugin file path, plugin source and plugin name */\r\n                foreach ( $plugins as $i => $plugin )\r\n                    $plugins_to_activate[] = explode( ',', $plugin );\r\n\r\n                foreach ( $plugins_to_activate as $i => $array ) {\r\n                    if ( ! preg_match( '|.php$|', $array[0] ) ) // Plugins that haven't been installed yet won't have the correct file path\r\n                        unset( $plugins_to_activate[$i] );\r\n                }\r\n\r\n                /** Return early if there are no plugins to activate */\r\n                if ( empty( $plugins_to_activate ) )\r\n                    return;\r\n\r\n                $plugins      = array();\r\n                $plugin_names = array();\r\n\r\n                foreach ( $plugins_to_activate as $plugin_string ) {\r\n                    $plugins[] = $plugin_string[0];\r\n                    $plugin_names[] = $plugin_string[2];\r\n                }\r\n\r\n                $count = count( $plugin_names ); // Count so we can use _n function\r\n                $last_plugin = array_pop( $plugin_names ); // Pop off last name to prep for readability\r\n                $imploded    = empty( $plugin_names ) ? '<strong>' . $last_plugin . '</strong>' : '<strong>' . ( implode( ', ', $plugin_names ) . '</strong> and <strong>' . $last_plugin . '</strong>.' );\r\n\r\n                /** Now we are good to go - let's start activating plugins */\r\n                $activate = activate_plugins( $plugins );\r\n\r\n                if ( is_wp_error( $activate ) )\r\n                    echo '<div id=\"message\" class=\"error\"><p>' . $activate->get_error_message() . '</p></div>';\r\n                else\r\n                    printf( '<div id=\"message\" class=\"updated\"><p>%1$s %2$s</p></div>', _n( 'The following plugin was activated successfully:', 'The following plugins were activated successfully:', $count, TGM_Plugin_Activation::$instance->domain ), $imploded );\r\n\r\n \t\t\t\t/** Update recently activated plugins option */\r\n                $recent = (array) get_option( 'recently_activated' );\r\n\r\n                foreach ( $plugins as $plugin => $time )\r\n                    if ( isset( $recent[$plugin] ) )\r\n                        unset( $recent[$plugin] );\r\n\r\n                update_option( 'recently_activated', $recent );\r\n\r\n                unset( $_POST ); // Reset the $_POST variable in case user wants to perform one action after another\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Prepares all of our information to be outputted into a usable table.\r\n         *\r\n         * @since 2.2.0\r\n         */\r\n        public function prepare_items() {\r\n\r\n            $per_page              = 100; // Set it high so we shouldn't have to worry about pagination\r\n            $columns               = $this->get_columns(); // Get all necessary column information\r\n            $hidden                = array(); // No columns to hide, but we must set as an array\r\n            $sortable              = array(); // No reason to make sortable columns\r\n            $this->_column_headers = array( $columns, $hidden, $sortable ); // Get all necessary column headers\r\n\r\n            /** Process our bulk actions here */\r\n            $this->process_bulk_actions();\r\n\r\n            /** Store all of our plugin data into $items array so WP_List_Table can use it */\r\n            $this->items = $this->_gather_plugin_data();\r\n\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * The WP_Upgrader file isn't always available. If it isn't available,\r\n * we load it here.\r\n *\r\n * We check to make sure no action or activation keys are set so that WordPress\r\n * doesn't try to re-include the class when processing upgrades or installs outside\r\n * of the class.\r\n *\r\n * @since 2.2.0\r\n */\r\nif ( ! class_exists( 'WP_Upgrader' ) && ( isset( $_GET[sanitize_key( 'page' )] ) && TGM_Plugin_Activation::$instance->menu = $_GET[sanitize_key( 'page' )] ) ) {\r\n    require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php';\r\n\r\n    if ( ! class_exists( 'TGM_Bulk_Installer' ) ) {\r\n        /**\r\n         * Installer class to handle bulk plugin installations.\r\n         *\r\n         * Extends WP_Upgrader and customizes to suit the installation of multiple\r\n         * plugins.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @package TGM-Plugin-Activation\r\n         * @author Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n         * @author Gary Jones <gamajo@gamajo.com>\r\n         */\r\n        class TGM_Bulk_Installer extends WP_Upgrader {\r\n\r\n            /**\r\n     \t\t * Holds result of bulk plugin installation.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var string\r\n     \t\t */\r\n            public $result;\r\n\r\n            /**\r\n     \t\t * Flag to check if bulk installation is occurring or not.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var boolean\r\n     \t\t */\r\n            public $bulk = false;\r\n\r\n            /**\r\n     \t\t * Processes the bulk installation of plugins.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @param array $packages The plugin sources needed for installation\r\n     \t\t * @return string|boolean Install confirmation messages on success, false on failure\r\n     \t\t */\r\n            public function bulk_install( $packages ) {\r\n\r\n                /** Pass installer skin object and set bulk property to true */\r\n                $this->init();\r\n                $this->bulk = true;\r\n\r\n                /** Set install strings and automatic activation strings (if config option is set to true) */\r\n                $this->install_strings();\r\n                if ( TGM_Plugin_Activation::$instance->is_automatic )\r\n                    $this->activate_strings();\r\n\r\n                /** Run the header string to notify user that the process has begun */\r\n                $this->skin->header();\r\n\r\n                /** Connect to the Filesystem */\r\n                $res = $this->fs_connect( array( WP_CONTENT_DIR, WP_PLUGIN_DIR ) );\r\n                if ( ! $res ) {\r\n                    $this->skin->footer();\r\n                    return false;\r\n                }\r\n\r\n                /** Set the bulk header and prepare results array */\r\n                $this->skin->bulk_header();\r\n                $results = array();\r\n\r\n                /** Get the total number of packages being processed and iterate as each package is successfully installed */\r\n                $this->update_count   = count( $packages );\r\n                $this->update_current = 0;\r\n\r\n                /** Loop through each plugin and process the installation */\r\n                foreach ( $packages as $plugin ) {\r\n                    $this->update_current++; // Increment counter\r\n\r\n                    /** Do the plugin install */\r\n                    $result = $this->run(\r\n                        array(\r\n                            'package'           => $plugin, // The plugin source\r\n                            'destination'       => WP_PLUGIN_DIR, // The destination dir\r\n                            'clear_destination' => false, // Do we want to clear the destination or not?\r\n                            'clear_working'     => true, // Remove original install file\r\n                            'is_multi'          => true, // Are we processing multiple installs?\r\n                            'hook_extra'        => array( 'plugin' => $plugin, ), // Pass plugin source as extra data\r\n                        )\r\n                    );\r\n\r\n                    /** Store installation results in result property */\r\n                    $results[$plugin] = $this->result;\r\n\r\n                    /** Prevent credentials auth screen from displaying multiple times */\r\n                    if ( false === $result )\r\n                        break;\r\n                }\r\n\r\n                /** Pass footer skin strings */\r\n                $this->skin->bulk_footer();\r\n                $this->skin->footer();\r\n\r\n                /** Return our results */\r\n                return $results;\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Performs the actual installation of each plugin.\r\n     \t\t *\r\n     \t\t * This method also activates the plugin in the automatic flag has been\r\n     \t\t * set to true for the TGMPA class.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @param array $options The installation cofig options\r\n     \t\t * @return null/array Return early if error, array of installation data on success\r\n     \t\t */\r\n            public function run( $options ) {\r\n\r\n                /** Default config options */\r\n                $defaults = array(\r\n                    'package'           => '',\r\n                    'destination'       => '',\r\n                    'clear_destination' => false,\r\n                    'clear_working'     => true,\r\n                    'is_multi'          => false,\r\n                    'hook_extra'        => array(),\r\n                );\r\n\r\n                /** Parse default options with config options from $this->bulk_upgrade and extract them */\r\n                $options = wp_parse_args( $options, $defaults );\r\n                extract( $options );\r\n\r\n                /** Connect to the Filesystem */\r\n                $res = $this->fs_connect( array( WP_CONTENT_DIR, $destination ) );\r\n                if ( ! $res )\r\n                    return false;\r\n\r\n                /** Return early if there is an error connecting to the Filesystem */\r\n                if ( is_wp_error( $res ) ) {\r\n                    $this->skin->error( $res );\r\n                    return $res;\r\n                }\r\n\r\n                /** Call $this->header separately if running multiple times */\r\n                if ( ! $is_multi )\r\n                    $this->skin->header();\r\n\r\n                /** Set strings before the package is installed */\r\n                $this->skin->before();\r\n\r\n                /** Download the package (this just returns the filename of the file if the package is a local file) */\r\n                $download = $this->download_package( $package );\r\n                if ( is_wp_error( $download ) ) {\r\n                    $this->skin->error( $download );\r\n                    $this->skin->after();\r\n                    return $download;\r\n                }\r\n\r\n                /** Don't accidentally delete a local file */\r\n                $delete_package = ( $download != $package );\r\n\r\n                /** Unzip file into a temporary working directory */\r\n                $working_dir = $this->unpack_package( $download, $delete_package );\r\n                if ( is_wp_error( $working_dir ) ) {\r\n                    $this->skin->error( $working_dir );\r\n                    $this->skin->after();\r\n                    return $working_dir;\r\n                }\r\n\r\n                /** Install the package into the working directory with all passed config options */\r\n                $result = $this->install_package(\r\n                    array(\r\n                        'source'            => $working_dir,\r\n                        'destination'       => $destination,\r\n                        'clear_destination' => $clear_destination,\r\n                        'clear_working'     => $clear_working,\r\n                        'hook_extra'        => $hook_extra,\r\n                    )\r\n                );\r\n\r\n                /** Pass the result of the installation */\r\n                $this->skin->set_result( $result );\r\n\r\n                /** Set correct strings based on results */\r\n                if ( is_wp_error( $result ) ) {\r\n                    $this->skin->error( $result );\r\n                    $this->skin->feedback( 'process_failed' );\r\n                }\r\n                /** The plugin install is successful */\r\n                else {\r\n                    $this->skin->feedback( 'process_success' );\r\n                }\r\n\r\n                /** Only process the activation of installed plugins if the automatic flag is set to true */\r\n                if ( TGM_Plugin_Activation::$instance->is_automatic ) {\r\n                    /** Flush plugins cache so we can make sure that the installed plugins list is always up to date */\r\n                    wp_cache_flush();\r\n\r\n                    /** Get the installed plugin file and activate it */\r\n                    $plugin_info = $this->plugin_info( $package );\r\n                    $activate    = activate_plugin( $plugin_info );\r\n\r\n                    /** Re-populate the file path now that the plugin has been installed and activated */\r\n                    TGM_Plugin_Activation::$instance->populate_file_path();\r\n\r\n                    /** Set correct strings based on results */\r\n                    if ( is_wp_error( $activate ) ) {\r\n                        $this->skin->error( $activate );\r\n                        $this->skin->feedback( 'activation_failed' );\r\n                    }\r\n                    /** The plugin activation is successful */\r\n                    else {\r\n                        $this->skin->feedback( 'activation_success' );\r\n                    }\r\n                }\r\n\r\n                /** Flush plugins cache so we can make sure that the installed plugins list is always up to date */\r\n                wp_cache_flush();\r\n\r\n                /** Set install footer strings */\r\n                $this->skin->after();\r\n                if ( ! $is_multi )\r\n                    $this->skin->footer();\r\n\r\n                return $result;\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Sets the correct install strings for the installer skin to use.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function install_strings() {\r\n\r\n                $this->strings['no_package']          = __( 'Install package not available.', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['downloading_package'] = __( 'Downloading install package from <span class=\"code\">%s</span>&#8230;', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['unpack_package']      = __( 'Unpacking the package&#8230;', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['installing_package']  = __( 'Installing the plugin&#8230;', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['process_failed']      = __( 'Plugin install failed.', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['process_success']     = __( 'Plugin installed successfully.', TGM_Plugin_Activation::$instance->domain );\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Sets the correct activation strings for the installer skin to use.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function activate_strings() {\r\n\r\n                $this->strings['activation_failed']  = __( 'Plugin activation failed.', TGM_Plugin_Activation::$instance->domain );\r\n                $this->strings['activation_success'] = __( 'Plugin activated successfully.', TGM_Plugin_Activation::$instance->domain );\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Grabs the plugin file from an installed plugin.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @return string|boolean Return plugin file on success, false on failure\r\n     \t\t */\r\n            public function plugin_info() {\r\n\r\n                /** Return false if installation result isn't an array or the destination name isn't set */\r\n                if ( ! is_array( $this->result ) )\r\n                    return false;\r\n                if ( empty( $this->result['destination_name'] ) )\r\n                    return false;\r\n\r\n                /** Get the installed plugin file or return false if it isn't set */\r\n                $plugin = get_plugins( '/' . $this->result['destination_name'] );\r\n                if ( empty( $plugin ) )\r\n                    return false;\r\n\r\n                /** Assume the requested plugin is the first in the list */\r\n                $pluginfiles = array_keys( $plugin );\r\n\r\n                return $this->result['destination_name'] . '/' . $pluginfiles[0];\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    if ( ! class_exists( 'TGM_Bulk_Installer_Skin' ) ) {\r\n        /**\r\n         * Installer skin to set strings for the bulk plugin installations..\r\n         *\r\n         * Extends Bulk_Upgrader_Skin and customizes to suit the installation of multiple\r\n         * plugins.\r\n         *\r\n         * @since 2.2.0\r\n         *\r\n         * @package TGM-Plugin-Activation\r\n         * @author Thomas Griffin <thomas@thomasgriffinmedia.com>\r\n         * @author Gary Jones <gamajo@gamajo.com>\r\n         */\r\n        class TGM_Bulk_Installer_Skin extends Bulk_Upgrader_Skin {\r\n\r\n            /**\r\n     \t\t * Holds plugin info for each individual plugin installation.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var array\r\n     \t\t */\r\n            public $plugin_info = array();\r\n\r\n            /**\r\n     \t\t * Holds names of plugins that are undergoing bulk installations.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var array\r\n     \t\t */\r\n            public $plugin_names = array();\r\n\r\n            /**\r\n     \t\t * Integer to use for iteration through each plugin installation.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @var integer\r\n     \t\t */\r\n            public $i = 0;\r\n\r\n            /**\r\n     \t\t * Constructor. Parses default args with new ones and extracts them for use.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t *\r\n     \t\t * @param array $args Arguments to pass for use within the class\r\n     \t\t */\r\n            public function __construct( $args = array() ) {\r\n\r\n                /** Parse default and new args */\r\n                $defaults = array( 'url' => '', 'nonce' => '', 'names' => array() );\r\n                $args = wp_parse_args( $args, $defaults );\r\n\r\n                /** Set plugin names to $this->plugin_names property */\r\n                $this->plugin_names = $args['names'];\r\n\r\n                /** Extract the new args */\r\n                parent::__construct( $args );\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Sets install skin strings for each individual plugin.\r\n     \t\t *\r\n     \t\t * Checks to see if the automatic activation flag is set and uses the\r\n     \t\t * the proper strings accordingly.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function add_strings() {\r\n\r\n                /** Automatic activation strings */\r\n                if ( TGM_Plugin_Activation::$instance->is_automatic ) {\r\n                    $this->upgrader->strings['skin_upgrade_start']        = __( 'The installation and activation process is starting. This process may take a while on some hosts, so please be patient.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_update_successful']    = __( '%1$s installed and activated successfully.', TGM_Plugin_Activation::$instance->domain ) . ' <a onclick=\"%2$s\" href=\"#\" class=\"hide-if-no-js\"><span>' . __( 'Show Details', TGM_Plugin_Activation::$instance->domain ) . '</span><span class=\"hidden\">' . __( 'Hide Details', TGM_Plugin_Activation::$instance->domain ) . '</span>.</a>';\r\n                    $this->upgrader->strings['skin_upgrade_end']          = __( 'All installations and activations have been completed.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_before_update_header'] = __( 'Installing and Activating Plugin %1$s (%2$d/%3$d)', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n                /** Default installation strings */\r\n                else {\r\n                    $this->upgrader->strings['skin_upgrade_start']        = __( 'The installation process is starting. This process may take a while on some hosts, so please be patient.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_update_failed_error']  = __( 'An error occurred while installing %1$s: <strong>%2$s</strong>.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_update_failed']        = __( 'The installation of %1$s failed.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_update_successful']    = __( '%1$s installed successfully.', TGM_Plugin_Activation::$instance->domain ) . ' <a onclick=\"%2$s\" href=\"#\" class=\"hide-if-no-js\"><span>' . __( 'Show Details', TGM_Plugin_Activation::$instance->domain ) . '</span><span class=\"hidden\">' . __( 'Hide Details', TGM_Plugin_Activation::$instance->domain ) . '</span>.</a>';\r\n                    $this->upgrader->strings['skin_upgrade_end']          = __( 'All installations have been completed.', TGM_Plugin_Activation::$instance->domain );\r\n                    $this->upgrader->strings['skin_before_update_header'] = __( 'Installing Plugin %1$s (%2$d/%3$d)', TGM_Plugin_Activation::$instance->domain );\r\n                }\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Outputs the header strings and necessary JS before each plugin installation.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function before() {\r\n\r\n                /** We are currently in the plugin installation loop, so set to true */\r\n                $this->in_loop = true;\r\n\r\n                printf( '<h4>' . $this->upgrader->strings['skin_before_update_header'] . ' <img alt=\"\" src=\"' . admin_url( 'images/wpspin_light.gif' ) . '\" class=\"hidden waiting-' . $this->upgrader->update_current . '\" style=\"vertical-align:middle;\" /></h4>', $this->plugin_names[$this->i], $this->upgrader->update_current, $this->upgrader->update_count );\r\n                echo '<script type=\"text/javascript\">jQuery(\\'.waiting-' . esc_js( $this->upgrader->update_current ) . '\\').show();</script>';\r\n                echo '<div class=\"update-messages hide-if-js\" id=\"progress-' . esc_attr( $this->upgrader->update_current ) . '\"><p>';\r\n\r\n                /** Flush header output buffer */\r\n                $this->before_flush_output();\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Outputs the footer strings and necessary JS after each plugin installation.\r\n     \t\t *\r\n     \t\t * Checks for any errors and outputs them if they exist, else output\r\n     \t\t * success strings.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function after() {\r\n\r\n                /** Close install strings */\r\n                echo '</p></div>';\r\n\r\n                /** Output error strings if an error has occurred */\r\n                if ( $this->error || ! $this->result ) {\r\n                    if ( $this->error )\r\n                        echo '<div class=\"error\"><p>' . sprintf( $this->upgrader->strings['skin_update_failed_error'], $this->plugin_names[$this->i], $this->error ) . '</p></div>';\r\n                    else\r\n                        echo '<div class=\"error\"><p>' . sprintf( $this->upgrader->strings['skin_update_failed'], $this->plugin_names[$this->i] ) . '</p></div>';\r\n\r\n                    echo '<script type=\"text/javascript\">jQuery(\\'#progress-' . esc_js( $this->upgrader->update_current ) . '\\').show();</script>';\r\n                }\r\n\r\n                /** If the result is set and there are no errors, success! */\r\n                if ( ! empty( $this->result ) && ! is_wp_error( $this->result ) ) {\r\n                    echo '<div class=\"updated\"><p>' . sprintf( $this->upgrader->strings['skin_update_successful'], $this->plugin_names[$this->i], 'jQuery(\\'#progress-' . esc_js( $this->upgrader->update_current ) . '\\').toggle();jQuery(\\'span\\', this).toggle(); return false;' ) . '</p></div>';\r\n                    echo '<script type=\"text/javascript\">jQuery(\\'.waiting-' . esc_js( $this->upgrader->update_current ) . '\\').hide();</script>';\r\n                }\r\n\r\n                /** Set in_loop and error to false and flush footer output buffer */\r\n                $this->reset();\r\n                $this->after_flush_output();\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Outputs links after bulk plugin installation is complete.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function bulk_footer() {\r\n\r\n                /** Serve up the string to say installations (and possibly activations) are complete */\r\n                parent::bulk_footer();\r\n\r\n                /** Flush plugins cache so we can make sure that the installed plugins list is always up to date */\r\n                wp_cache_flush();\r\n\r\n                /** Display message based on if all plugins are now active or not */\r\n                $complete = array();\r\n                foreach ( TGM_Plugin_Activation::$instance->plugins as $plugin ) {\r\n                    if ( ! is_plugin_active( $plugin['file_path'] ) ) {\r\n                        echo '<p><a href=\"' . add_query_arg( 'page', TGM_Plugin_Activation::$instance->menu, admin_url( TGM_Plugin_Activation::$instance->parent_url_slug ) ) . '\" title=\"' . esc_attr( TGM_Plugin_Activation::$instance->strings['return'] ) . '\" target=\"_parent\">' . __( TGM_Plugin_Activation::$instance->strings['return'], TGM_Plugin_Activation::$instance->domain ) . '</a></p>';\r\n                        $complete[] = $plugin;\r\n                        break;\r\n                    }\r\n                    /** Nothing to store */\r\n                    else {\r\n                        $complete[] = '';\r\n                    }\r\n                }\r\n\r\n                /** Filter out any empty entries */\r\n                $complete = array_filter( $complete );\r\n\r\n                /** All plugins are active, so we display the complete string and hide the menu to protect users */\r\n                if ( empty( $complete ) ) {\r\n                    $complete_link_text = apply_filters( 'tgmpa_complete_link_text', __( 'Return to the Dashboard', TGM_Plugin_Activation::$instance->domain ) );\r\n                    $complete_link_url = apply_filters( 'tgmpa_complete_link_url', admin_url() );\r\n                    echo '<p>' .  sprintf( TGM_Plugin_Activation::$instance->strings['complete'], '<a href=\"' . $complete_link_url . '\" title=\"' . $complete_link_text . '\">' . $complete_link_text . '</a>' ) . '</p>';\r\n                    echo '<style type=\"text/css\">#adminmenu .wp-submenu li.current { display: none !important; }</style>';\r\n                }\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Flush header output buffer.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function before_flush_output() {\r\n\r\n                wp_ob_end_flush_all();\r\n                flush();\r\n\r\n            }\r\n\r\n            /**\r\n     \t\t * Flush footer output buffer and iterate $this->i to make sure the\r\n     \t\t * installation strings reference the correct plugin.\r\n     \t\t *\r\n     \t\t * @since 2.2.0\r\n     \t\t */\r\n            public function after_flush_output() {\r\n\r\n                wp_ob_end_flush_all();\r\n                flush();\r\n                $this->i++;\r\n\r\n            }\r\n\r\n        }\r\n    }\r\n}\r\n", "<?php\r\n/*\r\nPlugin Name:  Google Analytics Top Content Widget\r\nDescription: Widget and shortcode to display top content according to Google Analytics. (\"Google Analytics Dashboard\" plugin required)\r\nPlugin URI: http://j.ustin.co/yWTtmy\r\nAuthor: Jtsternberg\r\nAuthor URI: http://jtsternberg.com/about\r\nDonate link: http://j.ustin.co/rYL89n\r\nVersion: 1.5.7\r\n*/\r\n\r\n\r\nadd_action( 'widgets_init', 'dsgnwrks_register_google_top_posts_widget' );\r\n/**\r\n * Register Top Content widgets\r\n */\r\nfunction dsgnwrks_register_google_top_posts_widget() {\r\n\tregister_widget( 'dsgnwrks_google_top_posts_widgets' );\r\n}\r\n\r\nclass GA_Top_Content {\r\n\r\n\tpublic function __construct() {\r\n\r\n\t\t$this->defaults = array(\r\n\t\t\t'title'           => 'Top Viewed Content',\r\n\t\t\t'pageviews'       => 20,\r\n\t\t\t'number'          => 5,\r\n\t\t\t'timeval'         => '1',\r\n\t\t\t'time'            => '2628000',\r\n\t\t\t'showhome'        => 0,\r\n\t\t\t'titleremove'     => '',\r\n\t\t\t'contentfilter'   => '',\r\n\t\t\t'catlimit'        => '',\r\n\t\t\t'catfilter'       => '',\r\n\t\t\t'thumb_size'      => '',\r\n\t\t\t'thumb_alignment' => '',\r\n\t\t\t'postfilter'      => '',\r\n\t\t\t'update'          => false\r\n\t\t);\r\n\r\n\t\trequire_once dirname( __FILE__ ) . '/class-tgm-plugin-activation.php';\r\n\t\tadd_action( 'tgmpa_register', array( $this, 'register_required_plugins' ) );\r\n\r\n\t\tadd_filter( 'tgmpa_complete_link_text', array( $this, 'change_link_text' ) );\r\n\t\tadd_filter( 'tgmpa_complete_link_url', array( $this, 'change_link_url' ) );\r\n\r\n\t\t// Top Content Shortcode\r\n\t\tadd_shortcode( 'google_top_content', array( $this, 'top_content_shortcode' ) );\r\n\t\tadd_shortcode( 'google_analytics_views', array( $this, 'views_shortcode' ) );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Register the required plugins for The \"Google Analytics Top Content\" plugin.\r\n\t */\r\n\tpublic function register_required_plugins() {\r\n\r\n\t\t$plugins = array( array(\r\n\t\t\t'name'     => 'Google Analytics Dashboard',\r\n\t\t\t'slug'     => 'google-analytics-dashboard',\r\n\t\t\t'required' => true,\r\n\t\t) );\r\n\r\n\t\t$plugin_text_domain = 'top-google-posts';\r\n\r\n\t\t$widgets_url = '<a href=\"' . get_admin_url( '', 'widgets.php' ) . '\" title=\"' . __( 'Setup Widget', $plugin_text_domain ) . '\">' . __( 'Setup Widget', $plugin_text_domain ) . '</a>';\r\n\r\n\r\n\t\t$config = array(\r\n\t\t\t'domain'           => $plugin_text_domain,\r\n\t\t\t'default_path'     => '',\r\n\t\t\t'parent_menu_slug' => 'plugins.php',\r\n\t\t\t'parent_url_slug'  => 'plugins.php',\r\n\t\t\t'menu'             => 'install-required-plugins',\r\n\t\t\t'has_notices'      => true,\r\n\t\t\t'is_automatic'     => true,\r\n\t\t\t'message'          => '',\r\n\t\t\t'strings'          => array(\r\n\t\t\t\t'page_title'                      => __( 'Install Required Plugins', $plugin_text_domain ),\r\n\t\t\t\t'menu_title'                      => __( 'Install Plugins', $plugin_text_domain ),\r\n\t\t\t\t'installing'                      => __( 'Installing Plugin: %s', $plugin_text_domain ), // %1$s = plugin name\r\n\t\t\t\t'oops'                            => __( 'Something went wrong with the plugin API.', $plugin_text_domain ),\r\n\t\t\t\t'notice_can_install_required'     => _n_noop( 'The \"Google Analytics Top Content\" plugin requires the following plugin: %1$s.', 'This plugin requires the following plugins: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_can_install_recommended'  => _n_noop( 'This plugin recommends the following plugin: %1$s.', 'This plugin recommends the following plugins: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_cannot_install'           => _n_noop( 'Sorry, but you do not have the correct permissions to install the %s plugin. Contact the administrator of this site for help on getting the plugin installed.', 'Sorry, but you do not have the correct permissions to install the %s plugins. Contact the administrator of this site for help on getting the plugins installed.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_can_activate_required'    => _n_noop( 'The following required plugin is currently inactive: %1$s.', 'The following required plugins are currently inactive: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_can_activate_recommended' => _n_noop( 'The following recommended plugin is currently inactive: %1$s.', 'The following recommended plugins are currently inactive: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_cannot_activate'          => _n_noop( 'Sorry, but you do not have the correct permissions to activate the %s plugin. Contact the administrator of this site for help on getting the plugin activated.', 'Sorry, but you do not have the correct permissions to activate the %s plugins. Contact the administrator of this site for help on getting the plugins activated.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_ask_to_update'            => _n_noop( 'The following plugin needs to be updated to its latest version to ensure maximum compatibility with this plugin: %1$s.', 'The following plugins need to be updated to their latest version to ensure maximum compatibility with this plugin: %1$s.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'notice_cannot_update'            => _n_noop( 'Sorry, but you do not have the correct permissions to update the %s plugin. Contact the administrator of this site for help on getting the plugin updated.', 'Sorry, but you do not have the correct permissions to update the %s plugins. Contact the administrator of this site for help on getting the plugins updated.' ), // %1$s = plugin name(s)\r\n\t\t\t\t'install_link'                    => _n_noop( 'Begin installing plugin', 'Begin installing plugins' ),\r\n\t\t\t\t'activate_link'                   => _n_noop( 'Activate installed plugin', 'Activate installed plugins' ),\r\n\t\t\t\t'return'                          => __( 'Return to Required Plugins Installer', $plugin_text_domain ),\r\n\t\t\t\t'plugin_activated'                => __( 'Plugin activated successfully.', $plugin_text_domain ),\r\n\t\t\t\t'complete'                        => __( 'All plugins installed and activated successfully. %s', $plugin_text_domain ) // %1$s = dashboard link\r\n\t\t) );\r\n\r\n\t\ttgmpa( $plugins, $config );\r\n\r\n\t}\r\n\r\n\tpublic function message_one() {\r\n\t\treturn sprintf(\r\n\t\t\t'<p><strong>%s</strong></p><p><a href=\"%s\" class=\"thickbox\" title=\"%s\">%s</a> | <a href=\"%s\" class=\"thickbox\" title=\"%s\">%s</a>.</p>',\r\n\t\t\tsprintf( __( 'The \"Google Analytics Top Content\" widget requires the plugin, %s, to be installed and activated.', 'gatpw' ), '<em>\"Google Analytics Dashboard\"</em>' ),\r\n\t\t\tadmin_url( 'plugins.php?page=install-required-plugins' ),\r\n\t\t\t__( 'Install Google Analytics Dashboard', 'gatpw' ),\r\n\t\t\t__( 'Install plugin', 'gatpw' ),\r\n\t\t\tadmin_url( 'plugins.php' ),\r\n\t\t\t__( 'Activate Google Analytics Dashboard', 'gatpw' ),\r\n\t\t\t__( 'Activate plugin', 'gatpw' )\r\n\t\t);\r\n\t}\r\n\r\n\tpublic function message_two() {\r\n\t\treturn sprintf(\r\n\t\t\t'<p>%s</p><p><a href=\"%s\">%s</a>.</p>',\r\n\t\t\t__( 'You must first login to Google Analytics in the \"Google Analytics Dashboard\" settings for this widget to work.', 'gatpw' ),\r\n\t\t\tadmin_url( 'options-general.php?page=google-analytics-dashboard/gad-admin-options.php' ),\r\n\t\t\t__( 'Go to plugin settings', 'gatpw' )\r\n\t\t);\r\n\t}\r\n\r\n\tpublic function change_link_text( $complete_link_text ) {\r\n\t\treturn 'Go to \"Google Analytics Dashboard\" plugin settings';\r\n\t}\r\n\r\n\tpublic function change_link_url( $complete_link_url ) {\r\n\t\treturn admin_url( 'options-general.php?page=google-analytics-dashboard/gad-admin-options.php' );\r\n\t}\r\n\r\n\tpublic function top_content_shortcode( $atts, $context = 'shortcode', $number = 0 ) {\r\n\t\tstatic $inline_style = false;\r\n\t\tstatic $inline_style_done = false;\r\n\r\n\t\tif ( ! class_exists( 'GADWidgetData' ) ) {\r\n\t\t\treturn $this->message_one();\r\n\t\t}\r\n\t\tif ( ! $this->token() ) {\r\n\t\t\treturn $this->message_two();\r\n\t\t}\r\n\r\n\t\t$atts = shortcode_atts( $this->defaults, $atts, 'google_top_content' );\r\n\t\t$atts = apply_filters( 'gtc_atts_filter', $atts );\r\n\t\t$unique = md5( serialize( $atts ) );\r\n\t\t$trans_id = 'dw-gtc-list-'. $number . $unique;\r\n\r\n\t\t$trans = '';\r\n\t\t// @Dev\r\n\t\t// $atts['update'] = true;\r\n\t\tif ( empty( $atts['update'] ) ) {\r\n\t\t\t$trans = get_transient( $trans_id );\r\n\t\t\t$transuse = \"\\n<!-- using transient - {$trans_id} -->\\n\";\r\n\t\t}\r\n\r\n\t\tif ( ! empty( $trans ) ) {\r\n\t\t\treturn $transuse . apply_filters( 'gtc_list_output', $trans ) . $transuse;\r\n\t\t}\r\n\r\n\r\n\t\t$transuse = \"\\n<!-- not using transient - {$trans_id} -->\\n\";\r\n\r\n\t\t$time = ( $atts['timeval'] * $atts['time'] );\r\n\t\t$time_diff = abs( time() - $time );\r\n\r\n\t\tif ( strpos( $atts['time'], 'month' ) ) {\r\n\t\t\t$time = str_replace( '-month', '', $atts['time'] );\r\n\t\t\t$month = $time * 60 * 60 * 24 * 30.416666667;\r\n\t\t\t$time_diff = abs( time() - $month );\r\n\t\t}\r\n\r\n\t\t$pages = $this->get_ga()->complex_report_query(\r\n\t\t\tdate( 'Y-m-d', $time_diff ),\r\n\t\t\tdate( 'Y-m-d' ),\r\n\t\t\tarray( 'ga:pagePath', 'ga:pageTitle' ),\r\n\t\t\tarray( 'ga:pageviews' ),\r\n\t\t\tarray( '-ga:pageviews' ),\r\n\t\t\tarray( 'ga:pageviews>' . $atts['pageviews'] )\r\n\t\t);\r\n\t\t$atts['context'] = ( $context ) ? $context : 'shortcode';\r\n\t\t$pages = apply_filters( 'gtc_pages_filter', $pages, $atts );\r\n\r\n\t\t$list = '';\r\n\t\tif ( ! $pages )\r\n\t\t\treturn $list;\r\n\r\n\t\t$urlarray = array();\r\n\t\t$list .= '<ol class=\"gtc-list\">';\r\n\t\t$counter = 1;\r\n\t\tforeach( $pages as $page ) {\r\n\t\t\t$url = $page['value'];\r\n\t\t\t// Url is index and we don't want the homepage, skip\r\n\t\t\tif ( $url == '/' && ! in_array( $atts['showhome'], array( 'no', '0', 0, false ), true ) ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// We need to check if there are duplicates with query vars\r\n\t\t\t$path = pathinfo( $url );\r\n\t\t\t$query_var = strpos( $url, '?' );\r\n\t\t\t$default_permalink = strpos( $path['filename'], '?p=' );\r\n\t\t\t// Strip the query var off the url (if not using default permalinks)\r\n\t\t\t$url = ( ! ( isset( $atts['keep_query_vars'] ) && $atts['keep_query_vars'] ) && false !== $query_var && false === $default_permalink )\r\n\t\t\t\t? substr( $url, 0, $query_var )\r\n\t\t\t\t: $url;\r\n\r\n\t\t\t// Allow modification of the URL\r\n\t\t\t$url = apply_filters( 'gtc_page_url', $url );\r\n\r\n\t\t\t// Url already exists? skip it\r\n\t\t\tif ( in_array( $url, $urlarray ) )\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t$urlarray[] = $url;\r\n\t\t\t$wppost = null;\r\n\t\t\t$thumb = '';\r\n\r\n\t\t\tif ( $atts['contentfilter'] != 'allcontent' || $atts['catlimit'] != '' || $atts['catfilter'] != '' || $atts['postfilter'] != '' || ! empty( $atts['thumb_size'] ) ) {\r\n\r\n\t\t\t\tif ( false !== $default_permalink ) {\r\n\t\t\t\t\t$wppost = get_post( (int) str_replace( '?p=', '', $path['filename'] ) );\r\n\t\t\t\t}\r\n\t\t\t\tif ( !$wppost && !empty( $url ) && trim( $url ) != '/' ) {\r\n\t\t\t\t\t$content_types = get_post_types( array( 'public' => true ) );\r\n\t\t\t\t\tforeach( $content_types as $type ) {\r\n\t\t\t\t\tif ( $type == 'attachment' )\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t$object_name = is_post_type_hierarchical( $type ) ? $url : @end( @array_filter( @explode( '/', $url ) ) );\r\n\t\t\t\t\tif ( $wppost = get_page_by_path( $object_name, OBJECT, $type ) )\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( $atts['contentfilter'] && $atts['contentfilter'] != 'allcontent' ) {\r\n\t\t\t\t\tif ( empty( $wppost ) ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( $wppost->post_type != $atts['contentfilter'] ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( $atts['contentfilter'] == 'allcontent' || $atts['contentfilter'] == 'post' ) {\r\n\r\n\t\t\t\t\tif ( $atts['catlimit'] != '' ) {\r\n\t\t\t\t\t\t$limit_array = array();\r\n\t\t\t\t\t\t$catlimits = esc_attr( $atts['catlimit'] );\r\n\t\t\t\t\t\t$catlimits = explode( ', ', $catlimits );\r\n\t\t\t\t\t\tforeach ( $catlimits as $catlimit ) {\r\n\t\t\t\t\t\t\tif ( in_category( $catlimit, $wppost ) ) $limit_array[] = $wppost->ID;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( !in_array( $wppost->ID, $limit_array ) ) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( $atts['catfilter'] != '' ) {\r\n\t\t\t\t\t\t$filter_array = array();\r\n\t\t\t\t\t\t$catfilters = esc_attr( $atts['catfilter'] );\r\n\t\t\t\t\t\t$catfilters = explode( ', ', $catfilters );\r\n\t\t\t\t\t\tforeach ( $catfilters as $catfilter ) {\r\n\t\t\t\t\t\t\tif ( in_category( $catfilter, $wppost ) ) $filter_array[] = $wppost->ID;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( in_array( $wppost->ID, $filter_array ) ) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( $atts['postfilter'] != '' ) {\r\n\t\t\t\t\t$postfilter_array = array();\r\n\t\t\t\t\t$postfilters = esc_attr( $atts['postfilter'] );\r\n\t\t\t\t\t$postfilters = explode( ', ', $postfilters );\r\n\t\t\t\t\tforeach ( $postfilters as $postfilter ) {\r\n\t\t\t\t\t\tif ( $postfilter == $wppost->ID ) $postfilter_array[] = $wppost->ID;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( in_array( $wppost->ID, $postfilter_array ) ) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$title = stripslashes( wp_filter_post_kses( apply_filters( 'gtc_page_title', $page['children']['value'], $page, $wppost ) ) );\r\n\r\n\t\t\tif ( ! empty( $atts['thumb_size'] ) && $wppost && isset( $wppost->ID ) ) {\r\n\t\t\t\t$class = 'attachment-'. $atts['thumb_size'] .' wp-post-image';\r\n\t\t\t\tif ( ! empty( $atts['thumb_alignment'] ) ) {\r\n\t\t\t\t\t$class .= ' '. $atts['thumb_alignment'];\r\n\t\t\t\t\t$inline_style = true;\r\n\t\t\t\t}\r\n\t\t\t\t$thumb = get_the_post_thumbnail( $wppost->ID, $atts['thumb_size'], array( 'class' => $class ) );\r\n\t\t\t\t$thumb = apply_filters( 'gtc_list_item_thumb', '<a class=\"gtc-content-thumb\" href=\"'. $url .'\">' . $thumb . '</a>', $url, $thumb, $wppost, $counter, $title, $url, $atts );\r\n\t\t\t}\r\n\r\n\t\t\tif ( !empty( $atts['titleremove'] ) ) {\r\n\t\t\t\t$removes = explode( ',', sanitize_text_field( $atts['titleremove'] ) );\r\n\t\t\t\tforeach ( $removes as $remove ) {\r\n\t\t\t\t\t$title = str_ireplace( trim( $remove ), '', $title );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$list .= apply_filters( 'gtc_list_item', '<li>'. $thumb .'<a class=\"gtc-link\" href=\"'. $url .'\">' . $title . '</a></li>', $page, $wppost, $counter, $title, $url );\r\n\t\t\t$counter++;\r\n\t\t\tif ( $counter > $atts['number'] ) break;\r\n\t\t}\r\n\t\t$list .= '</ol>';\r\n\r\n\t\tif ( $inline_style && ! $inline_style_done ) {\r\n\t\t\t$list = '<style type=\"text/css\">.gtc-list li:after{content:\"\";display: block;clear:both;}</style>'. $list;\r\n\t\t\t$inline_style_done = true;\r\n\t\t}\r\n\r\n\t\t$list = apply_filters( 'gtc_list_output', $list );\r\n\t\tset_transient( $trans_id, $list, 86400 );\r\n\t\treturn $transuse . $list . $transuse;\r\n\r\n\t}\r\n\r\n\tpublic function views_shortcode( $atts, $content ) {\r\n\r\n\t\tif ( ! $this->token() || ! class_exists( 'GADWidgetData' ) )\r\n\t\t\treturn '';\r\n\r\n\t\t$defaults = array(\r\n\t\t\t'post_id' => get_the_ID(),\r\n\t\t\t'start_date' => date( 'Y-m-d', time() - (60 * 60 * 24 * 30) ),\r\n\t\t\t'end_date' => date( 'Y-m-d' ),\r\n\t\t);\r\n\t\t$atts = shortcode_atts( $defaults, $atts, 'google_analytics_views' );\r\n\t\t$atts = apply_filters( 'gtc_atts_filter_analytics_views', $atts );\r\n\t\t$unique = md5( serialize( $atts ) );\r\n\t\t$trans_id = 'dw-gtc-views-' . $atts['post_id'] . $unique;\r\n\r\n\t\t$count = '';\r\n\t\t// @Dev\r\n\t\t// $atts['update'] = true;\r\n\t\tif ( empty( $atts['update'] ) ) {\r\n\t\t\t$count = get_transient( $trans_id );\r\n\t\t\t$transuse = \"\\n<!-- using transient - {$trans_id} -->\\n\";\r\n\t\t}\r\n\r\n\t\tif ( empty( $count ) ) {\r\n\t\t\t$transuse = \"\\n<!-- not using transient - {$trans_id} -->\\n\";\r\n\r\n\t\t\t$permalink   = get_permalink( $atts['post_id'] );\r\n\t\t\t$post_status = get_post_status( $atts['post_id'] );\r\n\t\t\t$is_draft    = $post_status && 'draft' == $post_status;\r\n\t\t\t$url_data    = parse_url( $permalink );\r\n\t\t\t$link_uri    = substr( $url_data['path'] . ( isset( $url_data['query'] ) ? ( '?' . $url_data['query'] ) : '' ), -20 );\r\n\r\n\t\t\tif ( empty( $link_uri ) || $is_draft )\r\n\t\t\t\treturn '';\r\n\r\n\t\t\t$data = $this->get_ga()->total_uri_pageviews_for_date_period( $link_uri, $atts['start_date'], $atts['end_date'] );\r\n\r\n\t\t\t$count = isset( $data['value'] ) ? $data['value'] : 0;\r\n\r\n\t\t\tif ( $count ) {\r\n\t\t\t\tset_transient( $trans_id, $count, 86400 );\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! $count )\r\n\t\t\treturn;\r\n\r\n\r\n\t\tif ( $content ) {\r\n\t\t\t$clean_content = wp_kses_post( $content );\r\n\t\t\t$replaced_content = str_ireplace( '**count**', '<span class=\"gtc-count\">'. $count .'</span>', $clean_content );\r\n\t\t\treturn $transuse . $replaced_content . $transuse;\r\n\t\t}\r\n\r\n\t\treturn $count;\r\n\r\n\t}\r\n\r\n\tpublic function get_ga() {\r\n\t\tif ( isset( $this->ga ) )\r\n\t\t\treturn $this->ga;\r\n\r\n\t\t$this->ga = false;\r\n\t\tif ( class_exists( 'GADWidgetData' ) ) {\r\n\r\n\t\t\t$login = new GADWidgetData();\r\n\t\t\t$this->ga = new GALib( $login->auth_type, NULL, $login->oauth_token, $login->oauth_secret, $login->account_id );\r\n\t\t}\r\n\r\n\t\treturn $this->ga;\r\n\t}\r\n\r\n\tpublic function token() {\r\n\t\t$this->token = isset( $this->token ) ? $this->token : get_option( 'gad_auth_token' );\r\n\t\treturn $this->token;\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * Top Content widget\r\n */\r\nclass dsgnwrks_google_top_posts_widgets extends WP_Widget {\r\n\r\n\tpublic function __construct() {\r\n\t\t$this->gatc = new GA_Top_Content();\r\n\r\n\t\tparent::__construct( 'dsgnwrks_google_top_posts_widgets', 'Google Analytics Top Content', array(\r\n\t\t\t'classname' => 'google_top_posts',\r\n\t\t\t'description' => 'Show top posts from Google Analytics'\r\n\t\t) );\r\n\t}\r\n\r\n\t //build the widget settings form\r\n\tpublic function form( $instance ) {\r\n\r\n\t\tif ( ! class_exists( 'GADWidgetData' ) ) {\r\n\t\t\techo $this->gatc->message_one();\r\n\t\t\techo '<style type=\"text/css\"> #widget-'. $this->id .'-savewidget { display: none !important; } </style>';\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! $this->gatc->token() ) {\r\n\t\t\techo $this->gatc->message_two();\r\n\t\t\techo '<style type=\"text/css\"> #widget-'. $this->id .'-savewidget { display: none !important; } </style>';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$instance = wp_parse_args( (array) $instance, $this->gatc->defaults );\r\n\t\textract( $instance, EXTR_SKIP );\r\n\r\n\t\t?>\r\n\t\t<p><label><b>Title:</b><input class=\"widefat\" name=\"<?php echo $this->get_field_name( 'title' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $title ); ?>\" /></label></p>\r\n\r\n\t\t<p><label><b>Show pages with at least __ number of page views:</b> <input class=\"widefat\" name=\"<?php echo $this->get_field_name( 'pageviews' ); ?>\"  type=\"text\" value=\"<?php echo absint( $pageviews ); ?>\" /></label></p>\r\n\r\n\t\t<p><label><b>Number to Show:</b> <input class=\"widefat\" name=\"<?php echo $this->get_field_name( 'number' ); ?>\"  type=\"text\" value=\"<?php echo absint( $number ); ?>\" /></label></p>\r\n\r\n\t\t<p><label><b>Select how far back you would like analytics to pull from:</b>\r\n\r\n\t\t\t<div class=\"timestamp-wrap\">\r\n\t\t\t\t<?php\r\n\r\n\t\t\t\techo '<select style=\"margin-right: 5px;\" id=\"'. $this->get_field_name( 'timeval' ) .'\" name=\"'. $this->get_field_name( 'timeval' ) .'\">';\r\n\r\n\t\t\t\tfor ( $i = 1; $i <= 30; $i = $i +1 ) {\r\n\t\t\t\t\techo '<option value=\"'. $i .'\"';\r\n\t\t\t\t\techo selected( $i, $instance['timeval'], false );\r\n\t\t\t\t\techo '>' . $i;\r\n\t\t\t\t\techo '</option>';\r\n\t\t\t\t}\r\n\r\n\t\t\t\techo '</select>';\r\n\r\n\t\t\t\techo '<select style=\"width: 50%;\" id=\"'. $this->get_field_name( 'time' ) .'\" name=\"'. $this->get_field_name( 'time' ) .'\">';\r\n\r\n\t\t\t\techo '<option value=\"3600\"', selected( '3600', $time ) ,'>hour(s)</option>';\r\n\t\t\t\techo '<option value=\"86400\"', selected( '86400', $time ) ,'>day(s)</option>';\r\n\t\t\t\techo '<option value=\"2628000\"', selected( '2628000', $time ) ,'>month(s)</option>';\r\n\t\t\t\techo '<option value=\"31536000\"', selected( '31536000', $time ) ,'>year(s)</option>';\r\n\r\n\t\t\t\techo '</select>';\r\n\t\t\t\t?>\r\n\t\t\t</div>\r\n\t\t</label></p>\r\n\r\n\t\t<p><label>\r\n\t\t\t<span style=\"width: 80%; float: left; margin-right: 10px;\"><b>Remove home page from list:</b> (usually \"<i>yoursite.com</i>\" is the highest viewed page)<br/></span>\r\n\t\t\t<input style=\"margin-top: 15px;\" id=\"<?php echo $this->get_field_id( 'showhome' ); ?>\" type=\"checkbox\" name=\"<?php echo $this->get_field_name( 'showhome' ); ?>\" value=\"1\" <?php checked(1, $showhome); ?>/>\r\n\t\t</label></p>\r\n\r\n\t\t<p style=\"clear: both; padding-top: 15px;\"><label><b>Remove Site Title From Listings:</b><br/>Your listings will usually be returned with the page/post name as well as the site title. To remove the site title from the listings, place the exact text you would like removed (i.e. <i>- Site Title</i>) here. If there is more than one phrase to be removed, separate them by commas (i.e. <i>- Site Title, | Site Title</i>). <b>Unless your site doesn't output the site titles, then you will need to add this in order for the filter settings below to work.</b> <input class=\"widefat\" style=\"margin-top:2px;\" name=\"<?php echo $this->get_field_name( 'titleremove' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $titleremove ); ?>\" /></label></p>\r\n\r\n\t\t<p><label>\r\n\t\t<b>Limit Listings To:</b>\r\n\t\t<select name=\"<?php echo $this->get_field_name( 'contentfilter' ); ?>\">\r\n\t\t<?php\r\n\t\techo '<option value=\"allcontent\" '. selected( esc_attr( $instance['contentfilter'] ), '' ) .'>Not Limited</option>';\r\n\r\n\t\t$content_types = get_post_types( array( 'public' => true ) );\r\n\t\tforeach( $content_types as $key => $value ) {\r\n\t\t\tif ( $value == 'attachment' )\r\n\t\t\t\tcontinue;\r\n\t\t\t$selected_value = esc_attr( $instance['contentfilter'] ) == $key ? 'selected' : '';\r\n\t\t\techo \"<option value='$key' $selected_value>$value</option>\";\r\n\t\t}\r\n\t\t?>\r\n\t\t</select>\r\n\r\n\t\t</label>\r\n\t\t</p>\r\n\r\n\t\t<?php if ( $instance['contentfilter'] == 'allcontent' || $instance['contentfilter'] == 'post' ) { ?>\r\n\r\n\t\t\t<p><label><b>Limit Listings To Category:</b><br/>To limit to specific categories, place comma separated category ID's.<input class=\"widefat\" style=\"margin-top:2px;\" name=\"<?php echo $this->get_field_name( 'catlimit' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $catlimit ); ?>\" /></label></p>\r\n\r\n\t\t\t<p><label><b>Filter Out Category:</b><br/>To remove specific categories, place comma separated category ID's.<input class=\"widefat\" style=\"margin-top:2px;\" name=\"<?php echo $this->get_field_name( 'catfilter' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $catfilter ); ?>\" /></label></p>\r\n\r\n\t\t<?php } ?>\r\n\r\n\t\t<p><label><b>Filter Out Post/Page IDs:</b><br/>To remove specific posts/pages, place comma separated post/page ID's.<input class=\"widefat\" style=\"margin-top:2px;\" name=\"<?php echo $this->get_field_name( 'postfilter' ); ?>\"  type=\"text\" value=\"<?php echo esc_attr( $postfilter ); ?>\" /></label></p>\r\n\r\n\t\t<p><label><b>Thumbnail Size:</b><br/>Optionally display a thumbnail next to the post title (if the post has a thumbnail).<br>\r\n\t\t<select style=\"margin-top:2px;max-width:100%;\" name=\"<?php echo $this->get_field_name( 'thumb_size' ); ?>\">\r\n\t\t<?php\r\n\t\techo '<option value=\"\" ', selected( empty( $instance['thumb_size'] ), true ) ,'>No Thumbnail</option>';\r\n\t\tforeach ( $this->get_image_size_options() as $size => $label ) {\r\n\t\t\techo '<option value=\"', $size ,'\" ', selected( ! empty( $instance['thumb_size'] ) && $size == $instance['thumb_size'] ) ,'>', $label ,'</option>';\r\n\t\t}\r\n\t\t?>\r\n\t\t</select>\r\n\r\n\t\t<p><label><b>Thumbnail Alignment:</b><br/>Will only apply if choosing a thumbnail size.<br>\r\n\t\t<select style=\"margin-top:2px;max-width:100%;\" name=\"<?php echo $this->get_field_name( 'thumb_alignment' ); ?>\">\r\n\t\t\t<option value=\"\" <?php selected( empty( $instance['thumb_alignment'] ), true ); ?>>None</option>\r\n\t\t\t<option value=\"alignleft\" <?php selected( $instance['thumb_alignment'], 'alignleft' ); ?>>Left Align</option>\r\n\t\t\t<option value=\"alignright\" <?php selected( $instance['thumb_alignment'], 'alignright' ); ?>>Right Align</option>\r\n\t\t\t<option value=\"aligncenter\" <?php selected( $instance['thumb_alignment'], 'aligncenter' ); ?>>Centered</option>\r\n\t\t</select>\r\n\t\t<?php\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get list of registered image sizes\r\n\t *\r\n\t * @since  1.5.6\r\n\t *\r\n\t * @return array  Array of image sizes\r\n\t */\r\n\tpublic function get_image_size_options() {\r\n\t\tglobal $_wp_additional_image_sizes;\r\n\r\n\t\t$image_sizes = array();\r\n\t\tforeach ( get_intermediate_image_sizes() as $size ) {\r\n\t\t\t$size_name = $size;\r\n\t\t\tif ( array_key_exists( $size, $_wp_additional_image_sizes ) ) {\r\n\t\t\t\t$size_info = $_wp_additional_image_sizes[ $size ];\r\n\t\t\t\t$size_name = $size_info['width'] .' x '. $size_info['height'] .' &mdash; '. $size_name;\r\n\r\n\t\t\t\tif ( is_array( $size_info['crop'] ) ) {\r\n\t\t\t\t\t$size_name .= ' ('. implode( ', ', $size_info['crop']) .')';\r\n\t\t\t\t} elseif ( $size_info['crop'] ) {\r\n\t\t\t\t\t$size_name .= ' (cropped)';\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\t$image_sizes[ $size ] = $size_name;\r\n\t\t}\r\n\r\n\t\treturn $image_sizes;\r\n\t}\r\n\r\n\t// save the widget settings\r\n\tpublic function update( $new_instance, $old_instance ) {\r\n\t\t$cleaned = $old_instance;\r\n\r\n\t\t$to_clean = array(\r\n\t\t\t'esc_attr' => array(\r\n\t\t\t\t'title',\r\n\t\t\t\t'time',\r\n\t\t\t\t'contentfilter',\r\n\t\t\t\t'catlimit',\r\n\t\t\t\t'catfilter',\r\n\t\t\t\t'postfilter',\r\n\t\t\t\t'thumb_size',\r\n\t\t\t\t'thumb_alignment',\r\n\t\t\t),\r\n\t\t\t'absint' => array(\r\n\t\t\t\t'pageviews',\r\n\t\t\t\t'number',\r\n\t\t\t\t'showhome',\r\n\t\t\t\t'timeval',\r\n\t\t\t),\r\n\t\t\t'sanitize_text_field' => array(\r\n\t\t\t\t'titleremove',\r\n\t\t\t),\r\n\t\t);\r\n\r\n\t\tforeach ( $to_clean as $callback => $fields ) {\r\n\t\t\tforeach ( $fields as $field ) {\r\n\t\t\t\t$cleaned[ $field ] = $callback( isset( $new_instance[ $field ] ) ? $new_instance[ $field ] : '' );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$atts = shortcode_atts( $this->gatc->defaults, $cleaned, 'google_top_content' );\r\n\t\t$atts = apply_filters( 'gtc_atts_filter', $atts );\r\n\t\t$unique = md5( serialize( $atts ) );\r\n\t\tdelete_transient( 'dw-gtc-list-'. $this->number . $unique );\r\n\r\n\t\treturn $cleaned;\r\n\t}\r\n\r\n\t// display the widget\r\n\tpublic function widget($args, $instance) {\r\n\r\n\t\textract($args);\r\n\t\techo $before_widget;\r\n\r\n\t\t$title = apply_filters( 'widget_title', $instance['title'] );\r\n\t\tif ( !empty( $title ) ) { echo $before_title . $title . $after_title; };\r\n\r\n\t\techo $this->gatc->top_content_shortcode( $instance, 'widget', $this->number );\r\n\r\n\t\techo $after_widget;\r\n\r\n\t}\r\n\r\n}\r\n", "=== Plugin Name ===  \nGoogle Analytics Top Content Widget\n\nContributors: jtsternberg\nPlugin Name:  Google Analytics Top Content Widget  \nPlugin URI: http://j.ustin.co/yWTtmy  \nTags: google analytics, google, top posts, top content, display rank, page rank, page views, widget, sidebar, sidebar widget, Google Analytics Dashboard, shortcode, site stats, statistics, stats  \nAuthor: Jtsternberg  \nAuthor URI: http://jtsternberg.com/about  \nDonate link: http://j.ustin.co/rYL89n  \nRequires at least: 3.0  \nTested up to: 4.2  \nStable tag: 1.5.7  \nVersion: 1.5.7  \nLicense: GPLv2 or later  \nLicense URI: http://www.gnu.org/licenses/gpl-2.0.html  \n\nWidget and shortcode to display top content according to Google Analytics. (\"Google Analytics Dashboard\" plugin required)\n\n== Description ==\n\nAdds a widget that allows you to display top pages/posts in your sidebar based on google analytics data.\n\nRequires a Google Analytics account, and the plugin, [\"Google Analytics Dashboard\"](http://wordpress.org/extend/plugins/google-analytics-dashboard/) (which will be auto-installed by this plugin, thanks to [@jthomasgriffin](http://twitter.com/jthomasgriffin)'s awesome [TGM Plugin Activation Class](http://j.ustin.co/yZPKXw)).\n\nAlso includes a shortcode to display the top content in your posts and pages.\n\n= Shortcodes with options supported: =\n\n* Companion shortcode to widget\n`[google_top_content pageviews=5 number=10 showhome=no time=2628000 timeval=2]`\n* Display a post's/page's number of views\n`[google_analytics_views]`\n* Conditional text where \\*\\*count\\*\\* will be replaced\n`[google_analytics_views]This page has received **count** views.[/google_analytics_views]`\n\n= Shortcode attributes definitions: =\n\n* Pageviews: Show pages with at least __ number of page views\n* Number: Number of pages to show in the list\n* Showhome: Will remove home page from list: (usually \"yoursite.com\" is the highest viewed page)\n* Time: Selects how far back you would like analytics to pull from. needs to be in seconds. (1 hour - 3600, 1 day - 86400, 1 month - 2628000, 1 year - 31536000).\n* Time Value: time=2628000 timeval=2 like in the example above would be 2 months.\n* titleremove: Remove site title from listings. (Unless your site doesn't output the site titles, then you will need to add this in order for the filter settings below to work.)\n* contentfilter: Limit listings to a particular post-type (post, page, etc)\n* catlimit: Limit listings to specific categories. (comma separated category ID's)\n* catfilter: Remove listings in specific categories. (comma separated category ID's)\n* postfilter: Remove specific posts/pages, etc by ID. (comma separated post ID's)\n* thumb_size: Optionally display a thumbnail next to the post title (if the post has a thumbnail)\n* thumb_alignment: Thumbnail alignment -- only applies if specifying a thumbnail size\n\nAll of the widget options are exactly that.. optional. If you don't include them it will pick some defaults.\n\n= Plugin Features: =\n\n* Plugin uses WordPress transients to cache the Google results so you're not running the update from Google every time. cache updates every 24 hours.\n* Developer Friendly. Many filters built in to allow you to filter the results to dispay how you want.  One example of that would be to remove your Site's title from the results. (now unnecessary, as the widget/shortcode has the option built in)\n** [Example using a filter to add view counts after the title](http://wordpress.org/support/topic/top-viewed-content-couple-of-tweeks-needed?replies=9#post-3816989) -\n`add_filter( 'gtc_pages_filter', 'gtc_add_viewcount_title' );\nfunction gtc_add_viewcount_title( $pages ) {\n\n\tif ( !$pages )\n\t\treturn false;\n\t// loop through the pages\n\tforeach ( $pages as $key => $page ) {\n\t\t// and add the page count to the title value\n\t\t$pages[$key]['children']['value'] = $pages[$key]['children']['value'] . ' ['. $pages[$key]['children']['children']['ga:pageviews'] .' Views]';\n\t}\n\treturn $pages;\n}`\n\nFeel free to [fork or contribute on Github](https://github.com/jtsternberg/Google-Analytics-Top-Content-Widget).\n\n== Installation ==\n\n1. Upload the `google-analytics-top-posts-widget` directory to the `/wp-content/plugins/` directory.\n2. Activate the plugin through the 'Plugins' menu in WordPress.\n3. Plugin will prompt you to install the \"Google Analytics Dashboard\" plugin. Install and activate it.\n4. Use the \"Google Analytics Dashboard\" plugin's settings page to login to your google analytics account.\n5. On the widgets page, drag the \"Google Analytics Top Posts\" widget to the desired sidebar.\n6. Update the widget settings and save.\n\n== Frequently Asked Questions ==\n\n= After Upgrading to 1.4, my widget stopped working =\nI updated the widget options for the date picker, and as a result, it broke any widgets that were saved with the old options. 1.4.1 solves that, but either way, re-saving the widget will correct the issue.\n\nIf you were using the shortcode and it broke, you will need to switch to using the shortcode with the new format (described [here](http://wordpress.org/extend/plugins/google-analytics-top-posts-widget/))\n\n= ?? =\nIf you run into a problem or have a question, contact me ([contact form](http://j.ustin.co/scbo43) or [@jtsternberg on twitter](http://j.ustin.co/wUfBD3)). I'll add them here.\n\n\n== Screenshots ==\n\n1. Widget options.\n2. Widget display (in an ordered list).\n\n== Changelog ==\n\n= 1.5.7 =\n* Update for xss vulnerability, https://make.wordpress.org/plugins/2015/04/20/fixing-add_query_arg-and-remove_query_arg-usage\n\n= 1.5.6 =\n* Feature: Add thumbnail option to widget.\n\n= 1.5.5 =\n* Bug Fix: Fix a few logic issues causing debug.log notices.\n\n= 1.5.4 =\n* Bug Fix: Use a unique transient ID for every shortcode instance.\n\n= 1.5.3 =\n* Bug Fix: `update=true` shortcode parameter (used for busting the cache) did not work properly.\n\n= 1.5.2 =\n* Bug Fix: Fix a couple filters that were getting false-postives.\n\n= 1.5.1 =\n* Bug Fix: Renamed the widget in 1.5.0 which would cause it to be unregistered in any sidebars. Quickly pushed up an update to put it back, but this release makes it final. Apologies for the inconvenience.\n\n= 1.5.0 =\n* Enhancement: New shortcode, `google_analytics_views` for displaying a view count on a single post/page.\n\n= 1.4.8 =\n* Bug fix: Now there is a unique transient for each widget instance.\n\n= 1.4.7 =\n* Improvement: By default won't list duplicate urls with query variable strings (often generated by sharing applications).\n\n= 1.4.6 =\n* Bug fix: Listings wouldn't show when using 'post' as the contentfilter.\n\n= 1.4.5 =\n* Enhancement: More output filters, and check for '?p=' permalinks\n\n= 1.4.4 =\n* Enhancement: Allow html in list item output\n\n= 1.4.3 =\n* Bug fix: Some entities would break the \"remove site name\" filter.\n\n= 1.4.2 =\n* Fixed the number value select for the \"Select how far back you would like analytics to pull from:\" selector.\n\n= 1.4.1 =\n* I updated the widget options for the date picker, and as a result, it broke any widgets that were saved with the old options. 1.4.1 solves that, but either way, re-saving the widget will correct the issue.\n\nIf you were using the shortcode and it broke, you will need to switch to using the shortcode with the new format (described [here](http://wordpress.org/extend/plugins/google-analytics-top-posts-widget/))\n\n= 1.4 =\n* Added more flexibilty to the time select dropdown. Now with options to select hours and days.\n\n= 1.3 =\n* Added more widget options to modify the list output. Added field to enter repeating elements in the titles to remove from the listings. Also, now limit or filter by post-type, by category, or by post/page ID.\n\n= 1.2 =\n* Increased page-speed with use of transients caching. Also added a few more developer friendly filters.\n\n= 1.1 =\n* Add a pages filter for developers, remove site title from page title, change date picker to use relative dates.\n\n= 1.0 =\n* Launch.\n\n\n== Upgrade Notice ==\n\n= 1.5.7 =\n* Update for xss vulnerability, https://make.wordpress.org/plugins/2015/04/20/fixing-add_query_arg-and-remove_query_arg-usage\n\n= 1.5.6 =\n* Feature: Add thumbnail option to widget.\n\n= 1.5.5 =\n* Bug Fix: Fix a few logic issues causing debug.log notices.\n\n= 1.5.4 =\n* Bug Fix: Use a unique transient ID for every shortcode instance.\n\n= 1.5.3 =\n* Bug Fix: `update=true` shortcode parameter (used for busting the cache) did not work properly.\n\n= 1.5.2 =\n* Bug Fix: Fix a couple filters that were getting false-postives.\n\n= 1.5.1 =\n* Bug Fix: Renamed the widget in 1.5.0 which would cause it to be unregistered in any sidebars. Quickly pushed up an update to put it back, but this release makes it final. Apologies for the inconvenience.\n\n= 1.5.0 =\n* Enhancement: New shortcode, `google_analytics_views` for displaying a view count on a single post/page.\n\n= 1.4.8 =\n* Bug fix: Now there is a unique transient for each widget instance.\n\n= 1.4.7 =\n* Improvement: By default won't list duplicate urls with query variable strings (often generated by sharing applications).\n\n= 1.4.6 =\n* Bug fix: Listings wouldn't show when using 'post' as the contentfilter.\n\n= 1.4.5 =\n* Enhancement: More output filters, and check for '?p=' permalinks\n\n= 1.4.4 =\n* Enhancement: Allow html in list item output\n\n= 1.4.3 =\n* Bug fix: Some entities would break the \"remove site name\" filter.\n\n= 1.4.2 =\n* Fixed the number value select for the \"Select how far back you would like analytics to pull from:\" selector.\n\n= 1.4.1 =\nI updated the widget options for the date picker, and as a result, it broke any widgets that were saved with the old options. 1.4.1 solves that, but either way, re-saving the widget will correct the issue.\n\nIf you were using the shortcode and it broke, you will need to switch to using the shortcode with the new format (described [here](http://wordpress.org/extend/plugins/google-analytics-top-posts-widget/))\n\n= 1.4 =\nAdded more flexibilty to the time select dropdown. Now with options to select hours and days.\n\n= 1.3 =\nAdded more widget options to modify the list output. Added field to enter repeating elements in the titles to remove from the listings. Also, now limit or filter by post-type, by category, or by post/page ID.\n\n= 1.2 =\nIncreased page-speed with use of transients caching. Also added a few more developer friendly filters.\n\n= 1.1 =\nAdd a pages filter for developers, remove site title from page title, change date picker to use relative dates.\n\n= 1.0 =\nLaunch\n"], "filenames": ["class-tgm-plugin-activation.php", "google-analytics-top-posts-widget.php", "readme.txt"], "buggy_code_start_loc": [705, 9, 12], "buggy_code_end_loc": [2093, 10, 165], "fixing_code_start_loc": [705, 9, 12], "fixing_code_end_loc": [2093, 10, 172], "type": "CWE-79", "message": "A vulnerability classified as problematic was found in Google Analytics Top Content Widget Plugin up to 1.5.6 on WordPress. Affected by this vulnerability is an unknown functionality of the file class-tgm-plugin-activation.php. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 1.5.7 is able to address this issue. The name of the patch is 25bb1dea113716200a6f0f3135801d84a7a65540. It is recommended to upgrade the affected component. The identifier VDB-226117 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2015-10101", "sourceIdentifier": "cna@vuldb.com", "published": "2023-04-15T21:15:06.800", "lastModified": "2023-04-25T18:47:53.410", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as problematic was found in Google Analytics Top Content Widget Plugin up to 1.5.6 on WordPress. Affected by this vulnerability is an unknown functionality of the file class-tgm-plugin-activation.php. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 1.5.7 is able to address this issue. The name of the patch is 25bb1dea113716200a6f0f3135801d84a7a65540. It is recommended to upgrade the affected component. The identifier VDB-226117 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:google_analytics_top_content_widget_project:google_analytics_top_content_widget:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "1.5.7", "matchCriteriaId": "29369D72-6663-4EC6-89AF-C14F031F0B21"}]}]}], "references": [{"url": "https://github.com/wp-plugins/google-analytics-top-posts-widget/commit/25bb1dea113716200a6f0f3135801d84a7a65540", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://vuldb.com/?ctiid.226117", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.226117", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/wp-plugins/google-analytics-top-posts-widget/commit/25bb1dea113716200a6f0f3135801d84a7a65540"}}