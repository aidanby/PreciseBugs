{"buggy_code": ["<?php\n/**\n * DCRM Commercial Package API\n * Copyright (c) 2015 Hintay <hintay@me.com>\n *\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n//This file is vulnerable, PLEASE CHECK IT AT ONCE.\nexit();\nif(isset($_GET['action'])){\n\tswitch($_GET['action']){\n\t\t// \u652f\u4ed8\u5b9d\u8df3\u8f6c\n\t\tcase 'alipay_go':\n?>\n<form id=\"alipay\" accept-charset=\"GBK\" method=\"POST\" action=\"https://shenghuo.alipay.com/send/payment/fill.htm\">\n\t<?php if(isset($_GET['optEmail'])): ?><input type=\"hidden\" value=\"<?php echo($_GET['optEmail']); ?>\" name=\"optEmail\"><?php endif; ?>\n\t<?php if(isset($_GET['payAmount'])): ?><input type=\"hidden\" value=\"<?php echo($_GET['payAmount']); ?>\" name=\"payAmount\"><?php endif; ?>\n\t<?php if(isset($_GET['title'])): ?><input id=\"title\" type=\"hidden\" value=\"<?php echo($_GET['title']); ?>\" name=\"title\"><?php endif; ?>\n\t<?php if(isset($_GET['memo'])): ?><input name=\"memo\" type=\"hidden\" value=\"<?php echo($_GET['memo']); ?>\" /><?php endif; ?>\n</form>\n<script type=\"text/javascript\">\nvar postForm = document.getElementById('alipay');\npostForm.method = \"post\" ;   \npostForm.action = 'https://shenghuo.alipay.com/send/payment/fill.htm' ;  \npostForm.submit();\n</script>\n<?php\n\t\t\texit();\n\t\t\tbreak;\n\t}\n}\n\nif (!isset($package_info)) {\n\tif(!isset($_GET['Package']))\n\t\texit();\n\n\trequire_once('system/common.inc.php');\n\tif(!isset($detect)){\n\t\tclass_loader('Mobile_Detect');\n\t\t$detect = new Mobile_Detect;\n\t}\n\t$package_info = DB::fetch_first(\"SELECT `Package`, `Name`, `Tag`, `Level`, `Price`, `Purchase_Link` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `Package` = '\".$_GET['Package'].\"' AND `Stat` = '1'\");\n\tif(!$package_info)\n\t\texit();\n?>\n<!DOCTYPE html SYSTEM \"about:legacy-compat\">\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<title>Activation \u00b7 Cydia</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"./css/menes.min.css\">\n<meta name=\"viewport\" content=\"width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n<meta name=\"format-detection\" content=\"telephone=no\">\n<script type=\"text/javascript\" src=\"./js/fastclick.js\"></script>\n<script type=\"text/javascript\" src=\"./js/cytyle.js\"></script>\n<script type=\"text/javascript\" src=\"./js/menes.js\"></script>\n</head>\n<body class=\"pinstripe\">\n<?php\n}\nif(check_commercial_tag($package_info['Tag'])):\n\t$nowip = _ip2long(getIp());\n\n\tif(isset($_GET['udid']))\n\t\t$udid_status = DB::fetch_first(\"SELECT `Packages`, `Level`, `IP` FROM `\".DCRM_CON_PREFIX.\"UDID` WHERE `UDID` = '\".$_GET['udid'].\"' LIMIT 1\");\n\telse\n\t\t$udid_status = DB::fetch_first(\"SELECT `Packages`, `Level`, `IP` FROM `\".DCRM_CON_PREFIX.\"UDID` WHERE `IP` = '\".$nowip.\"' LIMIT 1\");\n\t$purchased = false;\n\tif(!empty($udid_status)){\n\t\tif(!empty($udid_status['Packages'])) {\n\t\t\t$udid_packages = TrimArray(explode(',', $udid_status['Packages']));\n\t\t\tif(in_array($package_info['Package'], $udid_packages, true))\n\t\t\t\t$purchased = true;\n\t\t} else {\n\t\t\t$udid_level = (int)$udid_status['Level'];\n\t\t\t$package_level = (int)$package_info['Level'];\n\t\t\tif($udid_level > $package_level)\n\t\t\t\t$purchased = true;\n\t\t}\n\t}\n\n\tif($purchased) {\n\t\t//$not_installed_button = 'null, null, null';\n\t\t$purchase_status = 'purchased';\n\t\t$fieldset_color = '#eefff0';\n\t\t$fieldset_icons = 'https://cache.saurik.com/crystal/256x256/actions/agt_action_success.png';\n\t\tif(empty($package_info['Price']))\n\t\t\t$purchase_status = 'candownload';\n\t} else {\n\t\t$fieldset_color = '#ffc040';\n\t\tif(!empty($package_info['Price'])):\n\t\t\t//$not_installed_button = '\"'.__('Purchase').'\", \"Highlighted\", function(){buy();}';\n\t\t\t$purchase_status = 'notpurchase';\n\t\t\t$fieldset_icons = 'https://cache.saurik.com/crystal/64x64/apps/kwallet.png';\n\t\telse:\n\t\t\t//$not_installed_button = '\"'.__('Recheck').'\", \"Highlighted\", function(){reload_();}';\n\t\t\t$purchase_status = 'protection';\n\t\t\t$fieldset_icons = 'https://cache.saurik.com/crystal/64x64/apps/alert.png';\n\t\tendif;\n\t}\n?>\n<panel>\n\t<fieldset style=\"background-color:<?php echo($fieldset_color); ?>\">\n\t\t<a target=\"_popup\" <?php if('notpurchase' == $purchase_status) echo('href=\"'.$package_info['Purchase_Link'].'\"'); ?>>\n\t\t\t<img class=\"icon\" src=\"<?php echo($fieldset_icons); ?>\">\n\t\t\t<div>\n\t\t\t\t<div>\n<?php \n\tswitch($purchase_status){\n\t\tcase 'notpurchase':\n?>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p><?php _e('Purchase Product'); ?></p>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"price\">\n\t\t\t\t\t\t<p><?php echo($package_info['Price']); ?></p>\n\t\t\t\t\t</label>\n<?php\n\t\t\tbreak;\n\t\tcase 'protection':\n?>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p><?php _e('Package Protected'); ?></p>\n\t\t\t\t\t</label>\n<?php\n\t\t\tbreak;\n\t\tcase 'purchased':\n?>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p><?php _e('Package Officially Purchased'); ?></p>\n\t\t\t\t\t</label>\n<?php\n\t\t\tbreak;\n\t\tcase 'candownload':\n?>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p><?php _e('Allowed To Download'); ?></p>\n\t\t\t\t\t</label>\n<?php\n\t\t\tbreak;\n}\n?>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</a>\n\t</fieldset>\n</panel>\n<?php\nendif;\n?>", "<?php\n/**\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/* DCRM Mobile Page */\n\nrequire_once('system/common.inc.php');\n\nclass_loader('Mobile_Detect');\n$detect = new Mobile_Detect;\nif(!$detect->isiOS()){\n\tif (DCRM_PCINDEX == 2) {\n\t\theader('Location: misc.php');\n\t\texit();\n\t} else {\n\t\t$isCydia = false;\n\t}\n} else {\n\tif (DCRM_MOBILE == 2) {\n\t\tif (!strpos($detect->getUserAgent(), 'Cydia')) {\n\t\t\t$isCydia = false;\n\t\t} else {\n\t\t\t$isCydia = true;\n\t\t}\n\t} else {\n\t\texit('Access Denied');\t\n\t}\n}\nif (file_exists('Release')) {\n\t$release = file('Release');\n\t$release_origin = __('No Name');\n\t$release_mtime = filemtime('Release');\n\t$release_time = date('Y-m-d H:i:s',$release_mtime);\n\tforeach ($release as $line) {\n\t\tif(preg_match('#^Origin#', $line)) {\n\t\t\t$release_origin = trim(preg_replace(\"#^(.+):\\\\s*(.+)#\",\"$2\", $line));\n\t\t}\n\t\tif(preg_match(\"#^Description#\", $line)) {\n\t\t\t$release_description = trim(preg_replace(\"#^(.+):\\\\s*(.+)#\",\"$2\", $line));\n\t\t}\n\t}\n} else {\n\t$release_origin = __('Empty Page');\n}\nif (isset($_GET['pid'])) {\n\tif (ctype_digit($_GET['pid']) && intval($_GET['pid']) <= 10000) {\n\t\tif (isset($_GET['method']) && $_GET['method'] == 'screenshot') {\n\t\t\t$index = 2;\n\t\t\t$title = __('View Screenshots');\n\t\t} elseif (isset($_GET['method']) && $_GET['method'] == 'report') {\n\t\t\t$device_type = array('iPhone','iPod','iPad');\n\t\t\tfor ($i = 0; $i < count($device_type); $i++) {\n\t\t\t\t$check = $detect->version($device_type[$i]);\n\t\t\t\tif ($check !== false) {\n\t\t\t\t\tif (isset($_SERVER['HTTP_X_MACHINE'])) {\n\t\t\t\t\t\t$DEVICE = substr($_SERVER['HTTP_X_MACHINE'],0,-3);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$DEVICE = 'Unknown';\n\t\t\t\t\t}\n\t\t\t\t\t$OS = str_replace('_', '.', $check);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!isset($_GET['support'])) {\n\t\t\t\t$index = 3;\n\t\t\t} else {\n\t\t\t\tif ($_GET['support'] == '1') {\n\t\t\t\t\t$support = 1;\n\t\t\t\t} elseif ($_GET['support'] == '2') {\n\t\t\t\t\t$support = 2;\n\t\t\t\t} elseif ($_GET['support'] == '3') {\n\t\t\t\t\t$support = 3;\n\t\t\t\t} else {\n\t\t\t\t\t$support = 0;\n\t\t\t\t}\n\t\t\t\t$index = 4;\n\t\t\t}\n\t\t\t$title = __('Report Problems');\n\t\t} elseif (isset($_GET['method']) && $_GET['method'] == 'history') {\n\t\t\t$index = 5;\n\t\t\t$title = __('Version History');\n\t\t} elseif (isset($_GET['method']) && $_GET['method'] == 'contact') {\n\t\t\t$index = 6;\n\t\t\t$title = __('Contact us');\n\t\t} elseif (isset($_GET['method']) && $_GET['method'] == 'section') {\n\t\t\t$index = 7;\n\t\t\t$title = __('Package Category');\n\t\t} elseif (!isset($_GET['method']) || (isset($_GET['method']) && $_GET['method'] == 'view')) {\n\t\t\t$index = 1;\n\t\t\t$title = __('View Package');\n\t\t} else {\n\t\t\thttpinfo(405);\n\t\t\texit();\n\t\t}\n\t} else {\n\t\thttpinfo(405);\n\t\texit();\n\t}\n} elseif (!isset($_GET['method'])) {\n\t$index = 0;\n\t$title = $release_origin;\n} else {\n\thttpinfo(405);\n\texit();\n}\n?>\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n\t<head>\n\t\t<title><?php echo($title); ?></title>\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\t\t<meta name=\"apple-mobile-web-app-title\" content=\"<?php echo($release_origin); ?>\" />\n\t\t<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\" />\n\t\t<meta name=\"viewport\" content=\"minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no\" />\n\t\t<meta name=\"HandheldFriendly\" content=\"true\" />\n\t\t<meta name=\"format-detection\" content=\"telephone=no\" />\n\t\t<meta name=\"robots\" content=\"index, follow\" />\n<?php\nif (defined(\"AUTOFILL_SEO\")) {\n?>\n\t\t<meta name=\"title\" content=\"<?php echo(AUTOFILL_SEO); ?>\" />\n<?php\n}\nif (!empty($release_description)) {\n?>\n\t\t<meta name=\"description\" content=\"<?php echo($release_description); ?>\" />\n<?php\n}\nif (defined(\"AUTOFILL_KEYWORDS\")) {\n?>\n\t\t<meta name =\"keywords\" content=\"<?php echo(AUTOFILL_KEYWORDS); ?>\" />\n<?php\n}\nif ($isCydia) {\n?>\n\t\t<base target=\"_blank\">\n<?php\n} else {\n?>\n\t\t<base target=\"_top\">\n<?php\n}\n?>\n\t\t<link rel=\"apple-touch-icon\" href=\"CydiaIcon.png\">\n\t\t<link rel=\"shortcut icon\" href=\"favicon.ico\">\n\t\t<link rel=\"stylesheet\" href=\"css/menes.min.css\">\n\t\t<link rel=\"stylesheet\" href=\"css/scroll.min.css\">\n<?php if(is_rtl()){ ?>\t\t<link rel=\"stylesheet\" href=\"css/menes-rtl.min.css\"><?php } ?>\n<?php if(file_exists(ROOT.'css/font/'.($local_css = substr($locale, 0, 2)).'.css') || file_exists(ROOT.'css/font/' . ($local_css = $locale) . '.css')): ?>\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./css/font/<?php echo $local_css; ?>.css\"><?php echo(\"\\n\"); endif; ?>\n\t\t<script src=\"js/fastclick.js\" type=\"text/javascript\"></script>\n\t\t<script src=\"js/menes.js\" type=\"text/javascript\"></script>\n\t\t<script src=\"js/cytyle.js\" type=\"text/javascript\"></script>\n\t\t<script src=\"http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js\"></script>\n\t</head>\n\t<body class=\"pinstripe\">\n\t\t<panel>\n<?php\nif ($index == 0) {\n\tif (!$isCydia) {\n?>\n\t\t\t<fieldset>\n\t\t\t\t<a href=\"cydia://sources/add\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/cydia.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Add in Cydia<sup><small>\u00e2\u201e\u02d8</small></sup>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t}\n\t$repo_url = base64_decode(DCRM_REPOURL);\n?>\n\t\t\t<fieldset>\n\t\t\t\t<div>\n\t\t\t\t\t<div style=\"float: right; vertical-align: middle; text-align: center; width: 200px\">\n\t\t\t\t\t\t<span style=\"font-size: 24px\">\n\t\t\t\t\t\t\t<?php echo($release_origin); ?>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t<span style=\"font-size: 16px\">\n\t\t\t\t\t\t\t<a class=\"panel\" href=\"<?php echo(AUTOFILL_SITE); ?>\"><?php echo(AUTOFILL_FULLNAME); ?></a>\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t<a class=\"panel\" href=\"mailto:<?php echo(AUTOFILL_EMAIL); ?>\"><?php echo(AUTOFILL_EMAIL); ?></a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img class=\"icon\" src=\"CydiaIcon.png\" style=\"width:64px; height:64px; vertical-align: top;\" />\n\t\t\t\t\t<hr />\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php _e('Add this URL via Cydia<sup><small>\u00e2\u201e\u02d8</small></sup>: '); ?>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<strong><a href=\"<?php echo($repo_url); ?>\"><?php echo($repo_url); ?></a></strong>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t$q_info = DB::query(\"SELECT count(*) FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `Stat` = '1'\");\n\t$info = mysql_fetch_row($q_info);\n\t$num = (int)$info[0];\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php printf( __( '<strong>%d</strong> packages in total.' ) , $num ); ?> \n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<?php printf( __( 'Last updated: <strong>%s</strong>' ) , $release_time ); ?> \n\t\t\t\t</p>\n\t\t\t</block>\n\t\t\t<fieldset>\n<?php\n\tif (defined(\"AUTOFILL_SITE\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_SITE); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"CydiaIcon.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Visit Home Page'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a><?php\n\t}\n\tif (defined(\"AUTOFILL_EMAIL\")) {\n?>\n\t\t\t\t<a href=\"mailto:<?php echo(AUTOFILL_EMAIL); ?>?subject=<?php echo($release_origin); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Contact us'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_TENCENT\") && defined(\"AUTOFILL_TENCENT_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_TENCENT); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/qq.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo(AUTOFILL_TENCENT_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_WEIBO\") && defined(\"AUTOFILL_WEIBO_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_WEIBO); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/weibo.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_WEIBO_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_TWITTER\") && defined(\"AUTOFILL_TWITTER_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_TWITTER); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/twitter.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_TWITTER_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_FACEBOOK\") && defined(\"AUTOFILL_FACEBOOK_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_FACEBOOK); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/facebook.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_FACEBOOK_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_PAYPAL\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_PAYPAL); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/paypal.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Donate via <span style=\"font-style: italic; font-weight: bold\"><span style=\"color: #1a3665\">Pay</span><span style=\"color: #32689a\">Pal</span><sup><small>\u00e2\u201e\u02d8</small></sup></span>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_ALIPAY\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_ALIPAY); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/alipay.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Donate via <span style=\"font-style: italic; font-weight: bold\"><img class=\"alipay\" src=\"icons/default/alipay_text_en.png\" /><sup><small >\u00e2\u201e\u02d8</small></sup></span>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n?>\n\n\t\t\t</fieldset>\n<?php\n\tif (DCRM_SHOWLIST == 2) {\n\t\t$section_query = DB::query(\"SELECT `ID`, `Name`, `Icon` FROM `\".DCRM_CON_PREFIX.\"Sections`\");\n\t\tif (!$section_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t} else {\n\t\t\twhile ($section_assoc = mysql_fetch_assoc($section_query)) {\n?>\n\t\t\t<label><p><?php echo($section_assoc['Name']); ?></p></label>\n\t\t\t<fieldset>\n<?php\n\t\t\t\t$package_query = DB::query(\"SELECT `ID`, `Name`, `Package` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE (`Stat` = '1' AND `Section` = '\".DB::real_escape_string($section_assoc['Name']).\"') ORDER BY `ID` DESC LIMIT \" . DCRM_SHOW_NUM);\n\t\t\t\twhile ($package_assoc = mysql_fetch_assoc($package_query)) {\n\t\t\t\t\tif ($isCydia) {\n?>\n\t\t\t\t<a href=\"cydia://package/<?php echo($package_assoc['Package']); ?>\" target=\"_blank\">\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($package_assoc['ID']); ?>\">\n<?php\n\t\t\t\t\t}\n\t\t\t\t\tif (!empty($section_assoc['Icon'])) {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/<?php echo($section_assoc['Icon']); ?>\" />\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/unknown.png\" />\n<?php\n\t\t\t\t\t}\n?>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo($package_assoc['Name']); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t\t\t}\n\t\t\t\tif (DCRM_ALLOW_FULLLIST == 2) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($section_assoc['ID']); ?>&amp;method=section\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/moreinfo.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('More...'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (DCRM_ALLOW_FULLLIST == 2) {\n\t\t\t$section_query = DB::query(\"SELECT `ID`, `Name`, `Icon` FROM `\".DCRM_CON_PREFIX.\"Sections`\");\n\t\t\tif (!$section_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t\t} else {\n?>\n\t\t\t<label><?php _e('Package Category'); ?></label>\n\t\t\t<fieldset>\n<?php\n\t\t\t\twhile ($section_assoc = mysql_fetch_assoc($section_query)) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($section_assoc['ID']); ?>&amp;method=section\">\n<?php\n\t\t\t\t\tif (!empty($section_assoc['Icon'])) {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/<?php echo($section_assoc['Icon']); ?>\" />\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/unknown.png\" />\n<?php\n\t\t\t\t\t}\n?>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo($section_assoc['Name']); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t}\n\t}\n\tif (!$isCydia) {\n?>\n\t\t\t<label class=\"source\">\n\t\t\t\t<p><?php _e('Source Info'); ?></p>\n\t\t\t</label>\n\t\t\t<fieldset class=\"source\">\n\t\t\t\t<a href=\"/\">\n\t\t\t\t\t<img class=\"icon\" src=\"CydiaIcon.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p id=\"source-name\">\n\t\t\t\t\t\t\t\t\t<?php echo($release_origin); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t\t<div class=\"source-description\" id=\"source-description\">\n\t\t\t\t\t<p><?php echo($release_description); ?></p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n\t\t\t<footer id=\"footer\" style=\"display: none;\">\n\t\t\t\t<p>\n\t\t\t\t\t<span id=\"id\"><?php _e('Index'); ?></span>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span class=\"source-name\"><?php echo( defined(\"AUTOFILL_FOOTER_NAME\") ? htmlspecialchars(stripslashes(AUTOFILL_FOOTER_NAME)) : $release_origin ); ?></span>\u00c2\u00b7\n\t\t\t\t\t<span id=\"section\"><?php printf( __( 'Copyright &copy; %s' ) , defined(\"AUTOFILL_FOOTER_YEAR\") ? htmlspecialchars(stripslashes(AUTOFILL_FOOTER_YEAR)).'-'.date(\"Y\") : date(\"Y\") ); ?></span>\n\t\t\t\t\t<?php if(defined(\"AUTOFILL_FOOTER_CODE\")){ ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span id=\"code\"><?php echo(stripslashes(AUTOFILL_FOOTER_CODE));?></span>\n\t\t\t\t\t<?php } ?>\n\t\t\t\t</p>\n\t\t\t</footer>\n<?php\n\t}\n} elseif ($index == 1) {\n\t\t$pkg = (int)DB::real_escape_string($_GET['pid']);\n\t\t$pkg_assoc = DB::fetch_first(\"SELECT `Name`, `Version`, `Author`, `Package`, `Description`, `DownloadTimes`, `Multi`, `CreateStamp`, `Size`, `Installed-Size`, `Section`, `Homepage`, `Tag`, `Level`, `Price`, `Purchase_Link`  FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `ID` = '\".$pkg.\"' LIMIT 1\");\n\tif (!$pkg_assoc) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('Invalid package!<br />Perhaps this package has been deleted by us.'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t} else {\n\t\tif (!$isCydia) {\n?>\n\t\t\t<fieldset id=\"cydialink\" style=\"display: none;\">\n\t\t\t\t<a href=\"cydia://package/<?php echo($pkg_assoc['Package']); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/cydia.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('View in Cydia<sup><small>\u00e2\u201e\u02d8</small></sup>'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t\tif (!empty($pkg_assoc['Section'])) {\n\t\t\t\t$section_icon = DB::result_first(\"SELECT `Icon` FROM `\".DCRM_CON_PREFIX.\"Sections` WHERE `Name` = '\".$pkg_assoc['Section'].\"' LIMIT 1\");\n\t\t\t}\n?>\n\t\t\t<div id=\"header\" style=\"display: none;\">\n<?php\n\t\t\tif (!empty($section_icon)) {\n?>\n\t\t\t\t<img class=\"icon\" src=\"icons/<?php echo($section_icon); ?>\" style=\"width: 64px; height: 64px; vertical-align: top;\" />\n<?php\n\t\t\t} else {\n?>\n\t\t\t\t<img class=\"icon\" src=\"icons/default/unknown.png\" style=\"width: 64px; height: 64px; vertical-align: top;\" />\n<?php\n\t\t\t}\n?>\n\t\t\t\t<div id=\"content\">\n\t\t\t\t\t<p id=\"name\"><?php echo($pkg_assoc['Name']); ?></p>\n\t\t\t\t\t<p id=\"latest\"><?php echo($pkg_assoc['Version']); ?></p>\n\t\t\t\t\t<div id=\"extra\">\n\t\t\t\t\t\t<p><?php if(!empty($pkg_assoc['Installed-Size'])){echo(sizeext($pkg_assoc['Installed-Size'] * 1024));} ?></p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n<?php\n\t\t\tif (!empty($pkg_assoc['Author'])) {\n\t\t\t\t$author_name = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$1\", $pkg_assoc['Author']));\n\t\t\t\t$author_mail = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$2\", $pkg_assoc['Author']));\n\t\t\t}\n?>\n\t\t\t<fieldset id=\"contact\" style=\"display: none;\">\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=contact\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Author'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t\t<p id=\"contact\">\n\t\t\t\t\t\t\t\t\t\t<?php echo($author_name); ?>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t}\n\t\tif (DCRM_DIRECT_DOWN == 1 && !$isCydia && !check_commercial_tag($pkg_assoc['Tag'])) {\n?>\n\t\t\t<fieldset>\n\t\t\t\t<a href=\"debs/<?php echo($_GET['pid']); ?>.deb\" id=\"downloadlink\" style=\"display: none;\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/packages.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Download'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php if(!empty($pkg_assoc['Size'])){echo(sizeext($pkg_assoc['Size']));} ?>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t}\n\t\t$package_info = $pkg_assoc;\n\t\t//require_once('commercial.php');\n?>\n\t\t\t<fieldset>\n<?php\n\t\tif (DCRM_SCREENSHOTS == 2) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=screenshot\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/screenshots.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('View Screenshots'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=history\" id=\"historylink\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/changelog.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Version History'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\tif ($isCydia && DCRM_REPORTING == 2) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report\" id=\"reportlink\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/report.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Report Problems'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_TENCENT\") && defined(\"AUTOFILL_TENCENT_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_TENCENT); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/qq.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo(AUTOFILL_TENCENT_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_WEIBO\") && defined(\"AUTOFILL_WEIBO_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_WEIBO); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/weibo.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_WEIBO_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_TWITTER\") && defined(\"AUTOFILL_TWITTER_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_TWITTER); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/twitter.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_TWITTER_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_FACEBOOK\") && defined(\"AUTOFILL_FACEBOOK_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_FACEBOOK); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/facebook.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_FACEBOOK_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_PAYPAL\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_PAYPAL); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/paypal.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Donate via <span style=\"font-style: italic; font-weight: bold\"><span style=\"color: #1a3665\">Pay</span><span style=\"color: #32689a\">Pal</span><sup><small>\u00e2\u201e\u02d8</small></sup></span>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_ALIPAY\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_ALIPAY); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/alipay.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Donate via <span style=\"font-style: italic; font-weight: bold\"><img class=\"alipay\" src=\"icons/default/alipay_text_en.png\" /><sup><small >\u00e2\u201e\u02d8</small></sup></span>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (!empty($pkg_assoc['Homepage']) && DCRM_MOREINFO == 2) {\n?>\n\t\t\t\t<a href=\"<?php echo($pkg_assoc['Homepage']); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/web.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('More Info'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"EMERGENCY\")) {\n?>\n\t\t\t\t<a>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<?php echo(EMERGENCY); ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t\tif (defined(\"AUTOFILL_ADVERTISEMENT\") && $isCydia) {\n?>\n\t\t\t<block id=\"advertisement\">\n\t\t\t\t<div style=\"position: relative; text-align: center;\">\n\t\t\t\t\t<div style=\"position: absolute; right: 10px; top: 2px;\">\n\t\t\t\t\t\t<img src=\"css/closebox@2x.png\" style=\"width: 30px; height: 29px;\" onclick=\"hide()\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php echo(AUTOFILL_ADVERTISEMENT); ?>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</block>\n<?php\t\n\t\t}\n?>\n\t\t\t<block>\n<?php\n\t\tif (DCRM_MOREINFO == 2) {\n?>\n\t\t\t\t\t<p><?php _e('Version'); ?> <strong><?php echo($pkg_assoc['Version']); ?></strong> | <?php _e('Downloads'); ?> <strong><?php echo($pkg_assoc['DownloadTimes']); ?></strong></p>\n\t\t\t\t\t<p><?php _e('Last Updated'); ?> <strong><?php echo($pkg_assoc['CreateStamp']); ?></strong></p>\n\t\t\t\t\t<hr />\n<?php\n\t\t}\n?>\n\t\t\t\t\t<p><?php echo(nl2br($pkg_assoc['Description'])); ?></p>\n\t\t\t</block>\n<?php\n\t\tif (!empty($pkg_assoc['Multi']) && DCRM_MULTIINFO == 2) {\n?>\n\t\t\t<fieldset>\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php echo($pkg_assoc['Multi']); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_DUOSHUO_KEY\")) {\n?>\n\t\t\t<fieldset>\n\t\t\t\t<div id=\"foldcomments\">\n\t\t\t\t\t<p style=\"height: 21px;\"><span class=\"cmsswitch\"><?php _e('Fold Comments'); ?></span></p>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"comments\">\n\t\t\t\t\t<div class=\"ds-thread\" data-thread-key=\"<?php echo($pkg_assoc['Package']); ?>\" data-title=\"<?php echo($pkg_assoc['Name']); ?>\" data-url=\"<?php echo('http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']); ?>\"></div>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n\t\t\t<script type=\"text/javascript\">\n\t\t\tvar duoshuoQuery = {short_name:\"<?php echo(AUTOFILL_DUOSHUO_KEY); ?>\"};\n\t\t\t(function() {\n\t\t\t\tvar ds = document.createElement('script');\n\t\t\t\tds.type = 'text/javascript';ds.async = true;\n\t\t\t\tds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';\n\t\t\t\tds.charset = 'UTF-8';\n\t\t\t\t(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);\n\t\t\t})();\n\n\t\t\t$(document).ready(function(){\n\t\t\t\tvar comments = $(\"#comments\");\n\t\t\t\tvar cmsswitch = $(\".cmsswitch\");\n\t\t\t\t$(\"#foldcomments\").click(function(){\n\t\t\t\t\tcmsswitch.fadeOut(400);\n\t\t\t\t\tif(comments.css(\"display\")==\"none\"){\n\t\t\t\t\t\tcomments.slideDown(800);\n\t\t\t\t\t\tsetTimeout(function(){cmsswitch.html('<?php _e('Fold Comments'); ?>').fadeIn(400);}, 400);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomments.slideUp(800);\n\t\t\t\t\t\tsetTimeout(function(){cmsswitch.html('<?php _e('Unfold Comments'); ?>').fadeIn(400);}, 400);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t</script>\n<?php\n\t\t}\n?>\n\t\t\t<label class=\"source\">\n\t\t\t\t<p><?php _e('Source Info'); ?></p>\n\t\t\t</label>\n\t\t\t<fieldset class=\"source\">\n\t\t\t\t<a href=\"/\">\n\t\t\t\t\t<img class=\"icon\" src=\"CydiaIcon.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p id=\"source-name\">\n\t\t\t\t\t\t\t\t\t<?php echo($release_origin); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t\t<div class=\"source-description\" id=\"source-description\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php echo($release_description); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t\tif (!$isCydia) {\n?>\n\t\t\t<footer id=\"footer\" style=\"display: none;\">\n\t\t\t\t<p>\n\t\t\t\t\t<span id=\"id\"><?php echo($pkg_assoc['Package']); ?></span>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span class=\"source-name\"><?php echo($release_origin); ?></span>\u00c2\u00b7\n\t\t\t\t\t<span id=\"section\"><?php echo($pkg_assoc['Section']); ?></span>\n\t\t\t\t\t<?php if(defined(\"AUTOFILL_FOOTER_CODE\")){ ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span id=\"code\"><?php echo(stripslashes(AUTOFILL_FOOTER_CODE));?></span>\n\t\t\t\t\t<?php } ?>\n\t\t\t\t</p>\n\t\t\t</footer>\n<?php\n\t\t}\n\t}\n} elseif ($index == 2) {\n\tif (DCRM_SCREENSHOTS == 2) {\n\t\t$pkg = (int)DB::real_escape_string($_GET['pid']);\n\t\t$pkg_query = DB::query(\"SELECT `PID`, `Image` FROM `\".DCRM_CON_PREFIX.\"ScreenShots` WHERE `PID` = '\".$pkg.\"'\");\n\t\tif (!$pkg_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t} else {\n\t\t\t$num = mysql_affected_rows();\n\t\t\tif ($num != 0) {\n\t\t\t\t$preview = array();\n\t\t\t\t$i = 0;\n\t\t\t\twhile ($pkg_assoc = mysql_fetch_assoc($pkg_query)) {\n\t\t\t\t\t$preview[$i] = $pkg_assoc['Image'];\n\t\t\t\t\t$i++;\n\t\t\t\t}\n?>\n\t\t\t<!--label><?php _e('View Screenshots'); ?></label-->\n\t\t\t<div class=\"horizontal-scroll-wrapper\" style=\"background: transparent; position: relative;\">\n\t\t\t\t<div class=\"horizontal-scroll-wrapper\" style=\"background: transparent url(<?php echo($preview[0]); ?>); background-size: 150%; background-position: center; -webkit-filter: blur(5px); position: absolute; z-index: 1;\"></div>\n\t\t\t\t<div class=\"horizontal-scroll-wrapper\" id=\"scroller\" style=\"background: transparent; position: absolute; z-index: 2;\">\n\t\t\t\t\t<div class=\"horizontal-scroll-area\" style=\"width:<?php echo($num * 240); ?>px;\">\n<?php\n\t\t\t\tfor ($t = 0; $t < count($preview); $t++) {\n?>\n\t\t\t\t\t\t<img src=\"<?php echo($preview[$t]); ?>\" />\n<?php\n\t\t\t\t}\n?>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"horizontal-scroll-pips\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n<?php\n\t\t\t} else {\n?>\n\t\t\t<label><?php _e('No screenshots now.'); ?></label>\n<?php\n\t\t\t}\n\t\t}\n\t} else {\n?>\n\t\t\t<label><?php printf( __( 'The %s function is disabled.' ) , __('View Screenshots') ); ?></label>\n<?php\n\t}\n} elseif ($index == 3) {\n?>\n\t\t\t<label><?php _e('Device Info'); ?></label>\n<?php\n\tif (DCRM_REPORTING == 2) {\n\t\t$q_count = DB::query(\"SELECT `Support`, COUNT(*) AS 'num' FROM `\".DCRM_CON_PREFIX.\"Reports` WHERE (`Device` = '\".$DEVICE.\"' AND `iOS` = '\".$OS.\"' AND `PID` = '\".$_GET['pid'].\"') GROUP BY `Support`\");\n\t\tif (mysql_affected_rows() > 0) {\n\t\t\twhile ($s_count = mysql_fetch_assoc($q_count)) {\n\t\t\t\tswitch ($s_count['Support']) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\t$s_1 = \" (\".$s_count['num'].\")\";\n\t\t\t\t\t\t$i_1 = $s_count['num'];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\t$s_2 = \" (\".$s_count['num'].\")\";\n\t\t\t\t\t\t$i_2 = $s_count['num'];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\t$s_0 = \" (\".$s_count['num'].\")\";\n\t\t\t\t\t\t$i_0 = $s_count['num'];\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$check_int = $i_1 * 3 + $i_2 - $i_0 * 2;\n\t\tif ($check_int >= 10) {\n?>\n\t\t\t<fieldset style=\"background-color: #ccffcc;\">\n<?php\n\t\t} elseif ($check_int <= -6) {\n?>\n\t\t\t<fieldset style=\"background-color: #ffdddd;\">\n<?php\n\t\t} else {\n?>\n\t\t\t<fieldset>\n<?php\n\t\t}\n?>\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong><?php _e('Current Device Info'); ?></strong>\n\t\t\t\t\t</p>\n\t\t\t\t\t<hr />\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php echo($DEVICE.\" &amp; \".$OS); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n\t\t\t<label><?php _e('Submit Your Request'); ?></label>\n\t\t\t<fieldset>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report&amp;support=3\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/support_3.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Request for updating'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n\t\t\t<label><?php _e('Compatibility Reports'); ?></label>\n\t\t\t<fieldset>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report&amp;support=1\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/support_1.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Fully Compatibile'); ?><?php echo($s_1); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report&amp;support=0\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/support_0.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Partly Compatibile'); ?><?php echo($s_0); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report&amp;support=2\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/support_2.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Not Compatibile'); ?><?php echo($s_2); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n\t\t\t<fieldset>\n\t\t\t\t<div>\n\t\t\t\t\t<?php _e('<p><strong>The software package compatibility report is voted by the majority of users, and we generated these statistical data, for reference only.</strong></p><hr /><p>If you have compatibility issues after installation, your vote, may be able to help tens of thousands of users from safe mode and many other threats.</p>'); ?>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t} else {\n?>\n\t\t\t<label><?php printf( __( 'The %s function is disabled.' ) , __('Report Problems') ); ?></label>\n<?php\n\t}\n} elseif ($index == 4) {\n\tif (DCRM_REPORTING == 2) {\n\t\t$result = DB::query(\"SELECT `ID` FROM `\".DCRM_CON_PREFIX.\"Reports` WHERE (`Remote` = '\".DB::real_escape_string($_SERVER['REMOTE_ADDR']).\"' AND `PID`='\".$_GET['pid'].\"') LIMIT 3\");\n\t\tif (mysql_affected_rows() < DCRM_REPORT_LIMIT) {\n\t\t\tif (!empty($_SERVER['REMOTE_ADDR']) && !empty($DEVICE) && !empty($OS) && $isCydia) {\n\t\t\t\t$result = DB::query(\"INSERT INTO `\".DCRM_CON_PREFIX.\"Reports`(`Remote`, `Device`, `iOS`, `Support`, `TimeStamp`, `PID`) VALUES('\".DB::real_escape_string($_SERVER['REMOTE_ADDR']).\"', '\".$DEVICE.\"', '\".$OS.\"', '\".$support.\"', '\".date('Y-m-d H:i:s').\"', '\".(int)$_GET['pid'].\"')\");\n?>\n\t\t\t<fieldset style=\"background-color: #ccffcc;\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t<?php _e('Your report has been submitted.<br />Thanks for your support!'); ?>\n\t\t\t\t\t\t</strong>\n\t\t\t\t\t</p>\n<?php\n\t\t\t} else {\n?>\n\t\t\t<fieldset style=\"background-color: #ffdddd;\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t<?php _e('Please use Cydia to vote.<br />Each device is limited to vote for 2 times!'); ?>\n\t\t\t\t\t\t</strong>\n\t\t\t\t\t</p>\n<?php\n\t\t\t}\n\t\t} else {\n?>\n\t\t\t<fieldset style=\"background-color: #ffdddd;\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t<?php _e('You have reached the voting limit.'); ?>\n\t\t\t\t\t\t</strong>\n\t\t\t\t\t</p>\n<?php\n\t\t}\n?>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t} else {\n?>\n\t\t\t<label><?php printf( __( 'The %s function is disabled.' ) , __('Report Problems') ); ?></label>\n<?php\n\t}\n} elseif ($index == 5) {\n\t$history_query = DB::query(\"SELECT `ID`, `Version` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `Package` = (SELECT `Package` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `ID` = '\".(int)$_GET['pid'].\"' LIMIT 1) ORDER BY `ID` DESC LIMIT 1,20\");\n\tif (mysql_affected_rows() > 0) {\n?>\n\t\t\t<label><?php _e('Version History'); ?></label>\n\t\t\t<fieldset>\n<?php\n\t\twhile ($history = mysql_fetch_assoc($history_query)) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($history['ID']); ?>&amp;addr=nohistory\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/changelog.png\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Version'); ?> <?php echo($history['Version']); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t} else {\n?>\n\t\t\t<label><?php _e('No version history now.'); ?></label>\n\t\t\t<br />\n<?php\n\t}\n} elseif ($index == 6) {\n\t\t$pkg = (int)DB::real_escape_string($_GET['pid']);\n\t\t$pkg_query = DB::query(\"SELECT `Name`, `Version`, `Author`, `Sponsor`, `Maintainer` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `ID` = '\".$pkg.\"' LIMIT 1\");\n\tif (!$pkg_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t} else {\n\t\t$pkg_assoc = mysql_fetch_assoc($pkg_query);\n\t\tif (!$pkg_assoc) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('Invalid package!<br />Perhaps this package has been deleted by us.'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t} else {\n\t\t\tif (!empty($pkg_assoc['Author'])) {\n\t\t\t\t$author_name = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$1\", $pkg_assoc['Author']));\n\t\t\t\t$author_mail = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$2\", $pkg_assoc['Author']));\n?>\n\t\t\t<fieldset class=\"author\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php _e('Source manager can <strong>NOT</strong> solve the function problem of package: you <strong>MUST</strong> contact the author.'); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<a href=\"mailto:<?php echo($author_mail); ?>?subject=<?php echo(urlencode(\"Cydia/APT(A): \".$pkg_assoc['Name'].\" (\".$pkg_assoc['Version'].\")\")); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label><p><?php _e('Author'); ?></p></label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t<p><?php echo($author_name); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t\tif (!empty($pkg_assoc['Sponsor'])) {\n\t\t\t\t$sponsor_name = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$1\", $pkg_assoc['Sponsor']));\n\t\t\t\t$sponsor_url = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$2\", $pkg_assoc['Sponsor']));\n?>\n\t\t\t<fieldset class=\"maintainer\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php _e('If the package is a commercial package, you can contact the sponsor to obtain commercial support.'); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<a href=\"<?php echo($sponsor_url); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label><p><?php _e('Sponsor'); ?></p></label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t<p><?php echo($sponsor_name); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t\tif (!empty($pkg_assoc['Maintainer'])) {\n\t\t\t\t$maintainer_name = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$1\", $pkg_assoc['Maintainer']));\n\t\t\t\t$maintainer_mail = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$2\", $pkg_assoc['Maintainer']));\n?>\n\t\t\t<fieldset class=\"maintainer\">\n\t\t\t\t<div>\n\t\t\t\t\t<p><?php _e('If you have questions when install or uninstall this package, please contact the maintainer.'); ?></p>\n\t\t\t\t</div>\n\t\t\t\t<a href=\"mailto:<?php echo($maintainer_mail); ?>?subject=<?php echo(urlencode(\"Cydia/APT(A): \".$pkg_assoc['Name'].\" (\".$pkg_assoc['Version'].\")\")); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label><p><?php _e('Maintainer'); ?></p></label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t<p><?php echo($maintainer_name); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t}\n\t}\n} elseif ($index == 7) {\n\tif (DCRM_ALLOW_FULLLIST == 2) {\n\t\t$section_query = DB::query(\"SELECT `Name`, `Icon`, `TimeStamp` FROM `\".DCRM_CON_PREFIX.\"Sections` WHERE `ID` = '\".(int)$_GET['pid'].\"'\");\n\t\tif (!$section_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t} else {\n\t\t\t$section_assoc = mysql_fetch_assoc($section_query);\n\t\t\tif (!$section_assoc) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('Invalid section!<br />Perhaps this section has been deleted by us.'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t\t} else {\n?>\n\t\t\t<label><p><?php echo($section_assoc['Name']); ?></p></label>\n<?php\n\t\t\t\t$package_query = DB::query(\"SELECT `ID`, `Name`, `Package` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE (`Stat` = '1' AND `Section` = '\".DB::real_escape_string($section_assoc['Name']).\"') ORDER BY `ID` DESC\");\n\t\t\t\t$s_num = mysql_affected_rows();\n?>\n\t\t\t<block>\n\t\t\t\t\t<p><?php printf( __( '<strong>%s</strong> packages in this section.' ) , $s_num ); ?></p>\n\t\t\t\t\t<p><?php printf( __( 'Create time: <strong>%s</strong>' ) , $section_assoc['TimeStamp'] ); ?></strong></p>\n\t\t\t</block>\n\t\t\t<fieldset>\n<?php\n\t\t\t\twhile ($package_assoc = mysql_fetch_assoc($package_query)) {\n\t\t\t\t\tif ($isCydia) {\n?>\n\t\t\t\t<a href=\"cydia://package/<?php echo($package_assoc['Package']); ?>\" target=\"_blank\">\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($package_assoc['ID']); ?>\">\n<?php\n\t\t\t\t\t}\n\t\t\t\t\tif (!empty($section_assoc['Icon'])) {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/<?php echo($section_assoc['Icon']); ?>\">\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/unknown.png\">\n<?php\n\t\t\t\t\t}\n?>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo($package_assoc['Name']); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t}\n\t} else {\n?>\n\t\t\t<label><?php printf( __( 'The %s function is disabled.' ) , __('Package Category') ); ?></label>\n<?php\n\t}\n}\n?>\n\t\t</panel>\n<?php\nif ($index == 2) {\n?>\n\t\t<script src=\"js/scroll.js\" type=\"text/javascript\"></script>\n<?php\n}\n?>\n\t\t<script src=\"js/main.js\" type=\"text/javascript\"></script>\n<?php\nif (defined(\"AUTOFILL_STATISTICS\")) {\n?>\n\t\t<div style=\"text-align: center; display: none;\">\n\t\t\t<?php echo(AUTOFILL_STATISTICS); ?>\n\t\t</div>\n<?php\n}\n?>\n\t</body>\n</html>\n", "<?php\n/**\n * DCRM Installer Functions\n * Copyright (c) 2015 Hintay <hintay@me.com>\n *\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n// \u8bbe\u5b9a\u53c2\u6570\ndefine('ABSPATH', dirname(dirname(__FILE__)).'/');\ndefine('CONF_PATH', ABSPATH.'system/config/');\ndefine('VERSION', '1.6.15.3.18');\n\n/* \u8f7d\u5165\u8bed\u8a00 */\n$localetype = 'install';\ninclude_once ABSPATH . 'system/languages/l10n.php';\n$step_language = localization_load();\n\n/**\n * \u73af\u5883\u68c0\u67e5\n */\nfunction check_env(&$result)\n{\n\t$env_vars = array();\n\n\t/// \u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\n\t$env_vars['php_os'] = array('required' => __( 'No Limit' ) , 'best' => __( 'Unix-like' ), 'curr' => PHP_OS, 'state' => true);\n\n\t/// \u68c0\u67e5php\u7248\u672c\n\t$env_vars['php_vers'] = array('required' => '5.3', 'best' => '5.3', 'curr' => PHP_VERSION);\n\tif ((int)$env_vars['php_vers']['required'] > (int)$env_vars['php_vers']['curr']) {\n\t\t$env_vars['php_vers']['state'] = false;\n\t\t$result = false;\n\t} else {\n\t\t$env_vars['php_vers']['state'] = true;\n\t}\n\n\t/// \u68c0\u67e5\u4e0a\u4f20\u9644\u4ef6\u5927\u5c0f\n\t/*\n\t$env_vars['upload'] = array('required' => '1M', 'best' => '2M', 'curr' => ini_get('upload_max_filesize'));\n\t$u = substr($env_vars['upload']['curr'], -1, 1);\n\t$max_upload = $u == 'M' ? (int)$env_vars['upload']['curr'] : ($u == 'K' ? (int)$env_vars['upload']['curr'] / 1024 : (int)$env_vars['upload']['curr'] / (1024 * 1024));\n\tif ((int)$env_vars['upload']['required'] > $max_upload) {\n\t\t$env_vars['upload']['state'] = false;\n\t\t$result = false;\n\t} else {\n\t\t$env_vars['upload']['state'] = true;\n\t}\n\t */\n\n\t/// \u68c0\u67e5gd\u5e93\u7248\u672c\n\tif (dcrm_function_exists('gd_info')) {\n\t\t$gd_info = gd_info();\n\t} else {\n\t\t$gd_info['GD Version'] = __( 'The GD module cannot be loaded' );\n\t}\n\t$env_vars['gd_vers'] = array('required' => __( 'No Limit' ) , 'best' => '2.0', 'curr' => $gd_info['GD Version']);\n\t$match = array();\n\tpreg_match('/\\d/', $env_vars['gd_vers']['curr'], $match);\n\t$gd_vers = $match[0];\n\t$env_vars['gd_vers']['state'] = true;\n\n\t/// \u68c0\u67e5\u53ef\u7528\u78c1\u76d8\u7a7a\u95f4\n\t$env_vars['disk'] = array('required' => '10M', 'best' => __( 'No Limit' ) , 'curr' => floor(diskfreespace(ABSPATH) / (1024 * 1024)).'M');\n\tif ((int)$env_vars['disk']['required'] > (int)$env_vars['disk']['curr']) {\n\t\t$env_vars['disk']['state'] = false;\n\t\t$result = false;\n\t} else {\n\t\t$env_vars['disk']['state'] = true;\n\t}\n\n\treturn $env_vars;\n}\n\n/**\n * \u68c0\u67e5\u76ee\u5f55\u6587\u4ef6\n */\nfunction check_dir(&$result) {\n\t/// \u9700\u8981\u68c0\u67e5\u7684\u76ee\u5f55\u548c\u6587\u4ef6\n\t$dir_files = array(\n\t\t\t\t\t'./',\n\t\t\t\t\t'./system/config');\n\n\t$check_dir_files = array();\n\tforeach ($dir_files as $var) {\n\t\tif (is_dir($var)) {\n\t\t\tif ($fp = @fopen(ABSPATH.$var.'/text.txt', 'w')) {\n\t\t\t\t@fclose($fp);\n\t\t\t\t@unlink(ABSPATH.$var.'/text.txt');\n\t\t\t\t$check_dir_files[$var] = array('w' => 'writeable', 'state' => true);\n\t\t\t} else {\n\t\t\t\t$check_dir_files[$var] = array('w' => 'unwriteable', 'state' => false);\n\t\t\t\t$result = false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (file_exists(ABSPATH.$var)) {\n\t\t\t\tif (is_writable(ABSPATH.$var)) {\n\t\t\t\t\t$check_dir_files[$var] = array('w' => 'writeable', 'state' => true);\n\t\t\t\t} else {\n\t\t\t\t\t$check_dir_files[$var] = array('w' => 'unwriteable', 'state' => false);\n\t\t\t\t\t$result = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$check_dir_files[$var] = array('w' => 'unwriteable', 'state' => false);\n\t\t\t\t$result = false;\n\t\t\t}\n\t\t}\n\t}\n\treturn $check_dir_files;\n}\n\n/**\n * \u68c0\u67e5\u51fd\u6570\u4f9d\u8d56\n */\nfunction check_func(&$result)\n{\n\t$func_items = array('mysql' => 'mysql_connect',\n\t\t\t\t\t\t'file' => 'file_get_contents',\n\t\t\t\t\t\t'bz2' => 'bzcompress',\n\t\t\t\t\t\t'zlib' => 'gzcompress',\n\t\t\t\t\t\t'mhash' => array('mhash', 'hash_hmac')\n\t\t\t\t\t\t);\n\t$check_func_items = array();\n\tforeach ($func_items as $key => $var) {\n\t\tif ('mhash' == $key) {\n\t\t\tif (!dcrm_function_exists($var[0]) && !dcrm_function_exists($var[1])) {\n\t\t\t\t$check_func_items[implode(',', $var).'( )'] = array('s' => 'unsupportted_both', 'state' => false);\n\t\t\t} else {\n\t\t\t\t$check_func_items[$var[0].'( ),'.$var[1].'( )'] = array('s' => 'supportted', 'state' => true);\n\t\t\t}\n\t\t} elseif('bz2' == $key || 'zlib' == $key){\n\t\t\tif (dcrm_function_exists($var)) {\n\t\t\t\t$check_func_items[$var.'( )'] = array('s' => 'supportted', 'state' => true);\n\t\t\t} else {\n\t\t\t\t$check_func_items[$var.'( )'] = array('s' => 'unsupportted', 'state' => false);\n\t\t\t\t//$result = false;\n\t\t\t}\n\t\t} else{\n\t\t\tif (dcrm_function_exists($var)) {\n\t\t\t\t$check_func_items[$var.'( )'] = array('s' => 'supportted', 'state' => true);\n\t\t\t} else {\n\t\t\t\t$check_func_items[$var.'( )'] = array('s' => 'unsupportted', 'state' => false);\n\t\t\t\t$result = false;\n\t\t\t}\n\t\t}\n\t}\n\treturn $check_func_items;\n}\n\n/**\n * \u68c0\u67e5\u65b9\u6cd5\u662f\u5426\u53ef\u7528\n *\n * @param string $func \u51fd\u6570\u540d\u6216\u6269\u5c55\u6a21\u5757\u540d\n * @param array $ext \u6269\u5c55\u6a21\u5757\uff0c\u5177\u4f53\u7684\u51fd\u6570\u6269\u5c55\u540d\uff0c\u53ef\u4ee5\u591a\u4e2a\n *\n * @return bool\n */\nfunction dcrm_function_exists($func, $ext = false) {\n\t/// \u83b7\u53d6\u88ab\u7981\u7528\u7684\u65b9\u6cd5\n\t$disable_functions = ini_get('disable_functions');\n\t$result = true;\n\tif ($ext) {\n\t\tforeach ($ext as $var) {\n\t\t\t$func_name = $func.'_'.$var;\n\t\t\tif (strpos($disable_functions, $func) !== false || !function_exists($func_name)) {\n\t\t\t\t$result = false;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (strpos($disable_functions, $func) !== false || !function_exists($func)) {\n\t\t\t$result = false;\n\t\t}\n\t}\n\n\treturn $result;\n}\n\n/**\n * https\u68c0\u6d4b\n */\nfunction is_https() {\n\tif (isset($_SERVER['HTTPS']) && (strtolower($_SERVER['HTTPS']) == 'on' || $_SERVER['HTTPS'] == 1)) {\n\t\treturn TRUE;\n\t}\n\n\t// Nginx \u4e13\u7528\u65b9\u6cd5\u68c0\u6d4b\n\tif (isset($_SERVER['SERVER_PORT']) && $_SERVER['SERVER_PORT'] == '443') {\n\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}\n\n/**\n * url\u68c0\u6d4b\n */\nfunction available($url) {\n\t$ch = curl_init();\n\tcurl_setopt($ch, CURLOPT_URL, $url);\n\tcurl_setopt($ch, CURLOPT_HEADER, TRUE);\n\tcurl_setopt($ch, CURLOPT_NOBODY, TRUE);\n\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);\n\tcurl_exec($ch);\n\t$code = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n\tcurl_close($ch);\n\n\treturn $code < 400;\n}\n\n/**\n * \u5934\u90e8\n */\nfunction display_header($n='') {\n\tglobal $header_title;\n\n?>\n<!doctype html>\n<meta charset=utf-8 /><title><?php echo $header_title; ?> - DCRM</title>\n<link rel=\"stylesheet\" href=\"css/main.css\" type=\"text/css\" />\n<h1 id=\"logo\">DCRM</h1>\n<h6 class=\"underline\">Darwin Cydia Repository Manager</h6>\n\n<?php if ($n != ''): ?>\n\t\t<div id=\"error\"><?php echo $n; ?></div>\n<?php endif;\n}\n\nfunction base_url(){\n\t$sitepath = str_replace($_SERVER['DOCUMENT_ROOT'], '', str_replace('\\\\', '/', ABSPATH));\n\t$siteurl = htmlspecialchars(($_SERVER['SERVER_PORT'] == '443' ? 'https://' : 'http://').$_SERVER['HTTP_HOST'].$sitepath);\n\tdefine('BASE_URL', $siteurl);\n}\n\nfunction check_notice( $install = false ) {\n\tbase_url();\n\t$notice = '';\n\tif (!function_exists(\"curl_init\")) {\n\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('The server does not support the cURL function, DCRM will not be able to use.');\n\t} elseif (!available(BASE_URL.'rewritetest')) {\n\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('The server does not support the URL Rewrite, DCRM will not be able to use.');\n\t}\n\tif( $notice == '' ){\n\t\tif( $install == false ){\n\t\t\tif (file_exists(CONF_PATH.'connect.inc.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('The file \\'/system/config/connect.inc.php\\' already exists. If you need to reset any of the configuration items in this file, please delete it first.');\n\t\t\t} elseif (!file_exists(CONF_PATH.'connect.inc.default.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('Sorry, I need a /system/config/connect.inc.default.php file to work from. Please re-upload this file from your DCRM installation.');\n\t\t\t} elseif (!is_writable(CONF_PATH)) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('<code>/system/config/</code> directory is not writable. Please change the directory properties or create the connect.inc.php manually (you can see connect.inc.default.php)');\n\t\t\t}\n\t\t} else {\n\t\t\tif (!file_exists(CONF_PATH.'config.inc.default.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('Sorry, I need a /system/config/config.inc.default.php file to work from. Please re-upload this file from your DCRM installation.');\n\t\t\t} elseif (!file_exists(CONF_PATH.'gnupg.inc.default.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('Sorry, I need a /system/config/gnupg.inc.default.php file to work from. Please re-upload this file from your DCRM installation.');\n\t\t\t} elseif (!file_exists(CONF_PATH.'autofill.inc.default.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('Sorry, I need a /system/config/autofill.inc.default.php file to work from. Please re-upload this file from your DCRM installation.');\n\t\t\t} elseif (!is_writable(CONF_PATH)) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('<code>/system/config/</code> directory is not writable. Please change the directory properties.');\n\t\t\t}\n\t\t}\n\t}\n\treturn $notice;\n}\n\n/** \n * utf-8 \u8f6cunicode \n * \n * @param string $name \n * @return string \n */  \nfunction utf8_unicode($name){  \n\t$name = iconv('UTF-8', 'UCS-2', $name);  \n\t$len  = strlen($name);  \n\t$str  = '';  \n\tfor ($i = 0; $i < $len - 1; $i = $i + 2){  \n\t\t$c  = $name[$i];  \n\t\t$c2 = $name[$i + 1];  \n\t\tif (ord($c) > 0){   //\u4e24\u4e2a\u5b57\u8282\u7684\u6587\u5b57  \n\t\t\t$str .= '\\u'.base_convert(ord($c), 10, 16).str_pad(base_convert(ord($c2), 10, 16), 2, 0, STR_PAD_LEFT);  \n\t\t\t//$str .= base_convert(ord($c), 10, 16).str_pad(base_convert(ord($c2), 10, 16), 2, 0, STR_PAD_LEFT);  \n\t\t} else {  \n\t\t\t$str .= '\\u'.str_pad(base_convert(ord($c2), 10, 16), 4, 0, STR_PAD_LEFT);  \n\t\t\t//$str .= str_pad(base_convert(ord($c2), 10, 16), 4, 0, STR_PAD_LEFT);  \n\t\t}  \n\t}  \n\t//$str = strtoupper($str);//\u8f6c\u6362\u4e3a\u5927\u5199  \n\treturn $str;  \n}\n\n/**\n * Properly strip all HTML tags including script and style\n *\n * This differs from strip_tags() because it removes the contents of\n * the `<script>` and `<style>` tags. E.g. `strip_tags( '<script>something</script>' )`\n * will return 'something'. wp_strip_all_tags will return ''\n *\n * @param string $string String containing HTML tags\n * @param bool $remove_breaks optional Whether to remove left over line breaks and white space chars\n * @return string The processed string.\n */\nfunction strip_all_tags($string, $remove_breaks = false) {\n\t$string = preg_replace( '@<(script|style)[^>]*?>.*?</\\\\1>@si', '', $string );\n\t$string = strip_tags($string);\n\n\tif ( $remove_breaks )\n\t\t$string = preg_replace('/[\\r\\n\\t ]+/', ' ', $string);\n\n\treturn trim( $string );\n}\n\n/**\n * Sanitizes a username, stripping out unsafe characters.\n *\n * Removes tags, octets, entities, and if strict is enabled, will only keep\n * alphanumeric, _, space, ., -, @. After sanitizing, it passes the username,\n * raw username (the username in the parameter), and the value of $strict as\n * parameters for the 'sanitize_user' filter.\n *\n * @param string $username The username to be sanitized.\n * @param bool $strict If set limits $username to specific characters. Default false.\n * @return string The sanitized username, after passing through filters.\n */\nfunction sanitize_user( $username, $strict = false ) {\n\t$raw_username = $username;\n\t$username = strip_all_tags( $username );\n\t// Kill octets\n\t$username = preg_replace( '|%([a-fA-F0-9][a-fA-F0-9])|', '', $username );\n\t$username = preg_replace( '/&.+?;/', '', $username ); // Kill entities\n\n\t// If strict, reduce to ASCII for max portability.\n\tif ( $strict )\n\t\t$username = preg_replace( '|[^a-z0-9 _.\\-@]|i', '', $username );\n\n\t$username = trim( $username );\n\t// Consolidate contiguous whitespace\n\t$username = preg_replace( '|\\s+|', ' ', $username );\n\n\treturn $raw_username;\n}\n\n/**\n * Verifies that an email is valid.\n *\n * Does not grok i18n domains. Not RFC compliant.\n *\n * @param string $email Email address to verify.\n * @return string|bool Either false or the valid email address.\n */\nfunction is_email( $email, $deprecated = false ) {\n\t// Test for the minimum length the email can be\n\tif ( strlen( $email ) < 3 ) {\n\t\treturn false; //email_too_short\n\t}\n\n\t// Test for an @ character after the first position\n\tif ( strpos( $email, '@', 1 ) === false ) {\n\t\treturn false; //email_no_at\n\t}\n\n\t// Split out the local and domain parts\n\tlist( $local, $domain ) = explode( '@', $email, 2 );\n\n\t// LOCAL PART\n\t// Test for invalid characters\n\tif ( !preg_match( '/^[a-zA-Z0-9!#$%&\\'*+\\/=?^_`{|}~\\.-]+$/', $local ) ) {\n\t\treturn false; //local_invalid_chars\n\t}\n\n\t// DOMAIN PART\n\t// Test for sequences of periods\n\tif ( preg_match( '/\\.{2,}/', $domain ) ) {\n\t\treturn false; //domain_period_sequence\n\t}\n\n\t// Test for leading and trailing periods and whitespace\n\tif ( trim( $domain, \" \\t\\n\\r\\0\\x0B.\" ) !== $domain ) {\n\t\treturn false; //domain_period_limits\n\t}\n\n\t// Split the domain into subs\n\t$subs = explode( '.', $domain );\n\n\t// Assume the domain will have at least two subs\n\tif ( 2 > count( $subs ) ) {\n\t\treturn false; //domain_no_periods\n\t}\n\n\t// Loop through each sub\n\tforeach ( $subs as $sub ) {\n\t\t// Test for leading and trailing hyphens and whitespace\n\t\tif ( trim( $sub, \" \\t\\n\\r\\0\\x0B-\" ) !== $sub ) {\n\t\t\treturn false; //sub_hyphen_limits\n\t\t}\n\n\t\t// Test for invalid characters\n\t\tif ( !preg_match('/^[a-z0-9-]+$/i', $sub ) ) {\n\t\t\treturn false; //sub_invalid_chars\n\t\t}\n\t}\n\n\t// Congratulations your email made it!\n\treturn true;\n}\n\nfunction dcrm_slash( $value ) {\n\tif ( is_array( $value ) ) {\n\t\tforeach ( $value as $k => $v ) {\n\t\t\tif ( is_array( $v ) ) {\n\t\t\t\t$value[$k] = dcrm_slash( $v );\n\t\t\t} else {\n\t\t\t\t$value[$k] = addslashes( $v );\n\t\t\t}\n\t\t}\n\t} else {\n\t\t$value = addslashes( $value );\n\t}\n\n\treturn $value;\n}\n\nfunction dcrm_unslash( $value ) {\n\tif ( is_array($value) ) {\n\t\t$value = array_map('dcrm_unslash', $value);\n\t} elseif ( is_object($value) ) {\n\t\t$vars = get_object_vars( $value );\n\t\tforeach ($vars as $key=>$data) {\n\t\t\t$value->{$key} = dcrm_unslash( $data );\n\t\t}\n\t} elseif ( is_string( $value ) ) {\n\t\t$value = stripslashes($value);\n\t}\n\n\treturn $value;\n}\n\nfunction dcrm_query( $sql ){\n\t$result = mysql_query($sql);\n\tif (!$result) {\n\t\t$inst_alert = mysql_error();\n\t\techo $inst_alert; \n\t\texit();\n\t}\n}\n\n/**\n * Generates a random number\n *\n * @param int $min Lower limit for the generated number\n * @param int $max Upper limit for the generated number\n * @return int A random number between min and max\n */\nfunction dcrm_rand( $min = 0, $max = 0 ) {\n\tglobal $rnd_value;\n\n\t// Reset $rnd_value after 14 uses\n\t// 32(md5) + 40(sha1) + 40(sha1) / 8 = 14 random numbers from $rnd_value\n\tif ( strlen($rnd_value) < 8 ) {\n\t\tstatic $seed = '';\n\t\t$rnd_value = md5( uniqid(microtime() . mt_rand(), true ) . $seed );\n\t\t$rnd_value .= sha1($rnd_value);\n\t\t$rnd_value .= sha1($rnd_value . $seed);\n\t\t$seed = md5($seed . $rnd_value);\n\t}\n\n\t// Take the first 8 digits for our value\n\t$value = substr($rnd_value, 0, 8);\n\n\t$rnd_value = substr($rnd_value, 8);\n\n\t$value = abs(hexdec($value));\n\n\t// Some misconfigured 32bit environments (Entropy PHP, for example) truncate integers larger than PHP_INT_MAX to PHP_INT_MAX rather than overflowing them to floats.\n\t$max_random_number = 3000000000 === 2147483647 ? (float) \"4294967295\" : 4294967295; // 4294967295 = 0xffffffff\n\n\t// Reduce the value to be within the min - max range\n\tif ( $max != 0 )\n\t\t$value = $min + ( $max - $min + 1 ) * $value / ( $max_random_number + 1 );\n\n\treturn abs(intval($value));\n}\n\n/**\n * Generates a random password drawn from the defined set of characters.\n *\n * @param int  $length              Optional. The length of password to generate. Default 12.\n * @param bool $special_chars       Optional. Whether to include standard special characters.\n *                                  Default true.\n * @param bool $extra_special_chars Optional. Whether to include other special characters.\n *                                  Used when generating secret keys and salts. Default false.\n * @return string The random password.\n */\nfunction dcrm_generate_password( $length = 12, $special_chars = true, $extra_special_chars = false ) {\n\t$chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n\tif ( $special_chars )\n\t\t$chars .= '!@#$%^&*()';\n\tif ( $extra_special_chars )\n\t\t$chars .= '-_ []{}<>~`+=,.;:/?|';\n\n\t$password = '';\n\tfor ( $i = 0; $i < $length; $i++ ) {\n\t\t$password .= substr($chars, dcrm_rand(0, strlen($chars) - 1), 1);\n\t}\n\n\treturn $password;\n}\n\n/**\n * Checks for invalid UTF8 in a string.\n *\n * @param string $string The text which is to be checked.\n * @param boolean $strip Optional. Whether to attempt to strip out invalid UTF8. Default is false.\n * @return string The checked text.\n */\nfunction check_invalid_utf8( $string, $strip = false ) {\n\t$string = (string) $string;\n\n\tif ( 0 === strlen( $string ) ) {\n\t\treturn '';\n\t}\n\n\t// Check for support for utf8 in the installed PCRE library once and store the result in a static\n\tstatic $utf8_pcre;\n\tif ( !isset( $utf8_pcre ) ) {\n\t\t$utf8_pcre = @preg_match( '/^./u', 'a' );\n\t}\n\t// We can't demand utf8 in the PCRE installation, so just return the string in those cases\n\tif ( !$utf8_pcre ) {\n\t\treturn $string;\n\t}\n\n\t// preg_match fails when it encounters invalid UTF8 in $string\n\tif ( 1 === @preg_match( '/^./us', $string ) ) {\n\t\treturn $string;\n\t}\n\n\t// Attempt to strip the bad chars if requested (not recommended)\n\tif ( $strip && function_exists( 'iconv' ) ) {\n\t\treturn iconv( 'utf-8', 'utf-8', $string );\n\t}\n\n\treturn '';\n}\n\n/**\n * Converts a number of HTML entities into their special characters.\n *\n * Specifically deals with: &, <, >, \", and '.\n *\n * $quote_style can be set to ENT_COMPAT to decode \" entities,\n * or ENT_QUOTES to do both \" and '. Default is ENT_NOQUOTES where no quotes are decoded.\n *\n * @param string $string The text which is to be decoded.\n * @param mixed $quote_style Optional. Converts double quotes if set to ENT_COMPAT, both single and double if set to ENT_QUOTES or none if set to ENT_NOQUOTES. Also compatible with old _wp_specialchars() values; converting single quotes if set to 'single', double if set to 'double' or both if otherwise set. Default is ENT_NOQUOTES.\n * @return string The decoded text without HTML entities.\n */\nfunction dcrm_specialchars_decode( $string, $quote_style = ENT_NOQUOTES ) {\n\t$string = (string) $string;\n\n\tif ( 0 === strlen( $string ) ) {\n\t\treturn '';\n\t}\n\n\t// Don't bother if there are no entities - saves a lot of processing\n\tif ( strpos( $string, '&' ) === false ) {\n\t\treturn $string;\n\t}\n\n\t// Match the previous behaviour of _wp_specialchars() when the $quote_style is not an accepted value\n\tif ( empty( $quote_style ) ) {\n\t\t$quote_style = ENT_NOQUOTES;\n\t} elseif ( !in_array( $quote_style, array( 0, 2, 3, 'single', 'double' ), true ) ) {\n\t\t$quote_style = ENT_QUOTES;\n\t}\n\n\t// More complete than get_html_translation_table( HTML_SPECIALCHARS )\n\t$single = array( '&#039;'  => '\\'', '&#x27;' => '\\'' );\n\t$single_preg = array( '/&#0*39;/'  => '&#039;', '/&#x0*27;/i' => '&#x27;' );\n\t$double = array( '&quot;' => '\"', '&#034;'  => '\"', '&#x22;' => '\"' );\n\t$double_preg = array( '/&#0*34;/'  => '&#034;', '/&#x0*22;/i' => '&#x22;' );\n\t$others = array( '&lt;'   => '<', '&#060;'  => '<', '&gt;'   => '>', '&#062;'  => '>', '&amp;'  => '&', '&#038;'  => '&', '&#x26;' => '&' );\n\t$others_preg = array( '/&#0*60;/'  => '&#060;', '/&#0*62;/'  => '&#062;', '/&#0*38;/'  => '&#038;', '/&#x0*26;/i' => '&#x26;' );\n\n\tif ( $quote_style === ENT_QUOTES ) {\n\t\t$translation = array_merge( $single, $double, $others );\n\t\t$translation_preg = array_merge( $single_preg, $double_preg, $others_preg );\n\t} elseif ( $quote_style === ENT_COMPAT || $quote_style === 'double' ) {\n\t\t$translation = array_merge( $double, $others );\n\t\t$translation_preg = array_merge( $double_preg, $others_preg );\n\t} elseif ( $quote_style === 'single' ) {\n\t\t$translation = array_merge( $single, $others );\n\t\t$translation_preg = array_merge( $single_preg, $others_preg );\n\t} elseif ( $quote_style === ENT_NOQUOTES ) {\n\t\t$translation = $others;\n\t\t$translation_preg = $others_preg;\n\t}\n\n\t// Remove zero padding on numeric entities\n\t$string = preg_replace( array_keys( $translation_preg ), array_values( $translation_preg ), $string );\n\n\t// Replace characters according to translation table\n\treturn strtr( $string, $translation );\n}\n\n/**\n * Converts a number of special characters into their HTML entities.\n *\n * Specifically deals with: &, <, >, \", and '.\n *\n * $quote_style can be set to ENT_COMPAT to encode \" to\n * &quot;, or ENT_QUOTES to do both. Default is ENT_NOQUOTES where no quotes are encoded.\n *\n * @access private\n *\n * @param string $string The text which is to be encoded.\n * @param int $quote_style Optional. Converts double quotes if set to ENT_COMPAT, both single and double if set to ENT_QUOTES or none if set to ENT_NOQUOTES. Also compatible with old values; converting single quotes if set to 'single', double if set to 'double' or both if otherwise set. Default is ENT_NOQUOTES.\n * @param string $charset Optional. The character encoding of the string. Default is false.\n * @param boolean $double_encode Optional. Whether to encode existing html entities. Default is false.\n * @return string The encoded text with HTML entities.\n */\nfunction _dcrm_specialchars( $string, $quote_style = ENT_NOQUOTES, $charset = false, $double_encode = false ) {\n\t$string = (string) $string;\n\n\tif ( 0 === strlen( $string ) )\n\t\treturn '';\n\n\t// Don't bother if there are no specialchars - saves some processing\n\tif ( ! preg_match( '/[&<>\"\\']/', $string ) )\n\t\treturn $string;\n\n\t// Account for the previous behaviour of the function when the $quote_style is not an accepted value\n\tif ( empty( $quote_style ) )\n\t\t$quote_style = ENT_NOQUOTES;\n\telseif ( ! in_array( $quote_style, array( 0, 2, 3, 'single', 'double' ), true ) )\n\t\t$quote_style = ENT_QUOTES;\n\n\t$charset = 'UTF-8';\n\n\t$_quote_style = $quote_style;\n\n\tif ( $quote_style === 'double' ) {\n\t\t$quote_style = ENT_COMPAT;\n\t\t$_quote_style = ENT_COMPAT;\n\t} elseif ( $quote_style === 'single' ) {\n\t\t$quote_style = ENT_NOQUOTES;\n\t}\n\n\t// Handle double encoding ourselves\n\tif ( $double_encode ) {\n\t\t$string = @htmlspecialchars( $string, $quote_style, $charset );\n\t} else {\n\t\t// Decode &amp; into &\n\t\t$string = dcrm_specialchars_decode( $string, $_quote_style );\n\n\t\t// Guarantee every &entity; is valid or re-encode the &\n\t\t$string = dcrm_kses_normalize_entities( $string );\n\n\t\t// Now re-encode everything except &entity;\n\t\t$string = preg_split( '/(&#?x?[0-9a-z]+;)/i', $string, -1, PREG_SPLIT_DELIM_CAPTURE );\n\n\t\tfor ( $i = 0; $i < count( $string ); $i += 2 )\n\t\t\t$string[$i] = @htmlspecialchars( $string[$i], $quote_style, $charset );\n\n\t\t$string = implode( '', $string );\n\t}\n\n\t// Backwards compatibility\n\tif ( 'single' === $_quote_style )\n\t\t$string = str_replace( \"'\", '&#039;', $string );\n\n\treturn $string;\n}\n\n$allowedentitynames = array(\n\t'nbsp',    'iexcl',  'cent',    'pound',  'curren', 'yen',\n\t'brvbar',  'sect',   'uml',     'copy',   'ordf',   'laquo',\n\t'not',     'shy',    'reg',     'macr',   'deg',    'plusmn',\n\t'acute',   'micro',  'para',    'middot', 'cedil',  'ordm',\n\t'raquo',   'iquest', 'Agrave',  'Aacute', 'Acirc',  'Atilde',\n\t'Auml',    'Aring',  'AElig',   'Ccedil', 'Egrave', 'Eacute',\n\t'Ecirc',   'Euml',   'Igrave',  'Iacute', 'Icirc',  'Iuml',\n\t'ETH',     'Ntilde', 'Ograve',  'Oacute', 'Ocirc',  'Otilde',\n\t'Ouml',    'times',  'Oslash',  'Ugrave', 'Uacute', 'Ucirc',\n\t'Uuml',    'Yacute', 'THORN',   'szlig',  'agrave', 'aacute',\n\t'acirc',   'atilde', 'auml',    'aring',  'aelig',  'ccedil',\n\t'egrave',  'eacute', 'ecirc',   'euml',   'igrave', 'iacute',\n\t'icirc',   'iuml',   'eth',     'ntilde', 'ograve', 'oacute',\n\t'ocirc',   'otilde', 'ouml',    'divide', 'oslash', 'ugrave',\n\t'uacute',  'ucirc',  'uuml',    'yacute', 'thorn',  'yuml',\n\t'quot',    'amp',    'lt',      'gt',     'apos',   'OElig',\n\t'oelig',   'Scaron', 'scaron',  'Yuml',   'circ',   'tilde',\n\t'ensp',    'emsp',   'thinsp',  'zwnj',   'zwj',    'lrm',\n\t'rlm',     'ndash',  'mdash',   'lsquo',  'rsquo',  'sbquo',\n\t'ldquo',   'rdquo',  'bdquo',   'dagger', 'Dagger', 'permil',\n\t'lsaquo',  'rsaquo', 'euro',    'fnof',   'Alpha',  'Beta',\n\t'Gamma',   'Delta',  'Epsilon', 'Zeta',   'Eta',    'Theta',\n\t'Iota',    'Kappa',  'Lambda',  'Mu',     'Nu',     'Xi',\n\t'Omicron', 'Pi',     'Rho',     'Sigma',  'Tau',    'Upsilon',\n\t'Phi',     'Chi',    'Psi',     'Omega',  'alpha',  'beta',\n\t'gamma',   'delta',  'epsilon', 'zeta',   'eta',    'theta',\n\t'iota',    'kappa',  'lambda',  'mu',     'nu',     'xi',\n\t'omicron', 'pi',     'rho',     'sigmaf', 'sigma',  'tau',\n\t'upsilon', 'phi',    'chi',     'psi',    'omega',  'thetasym',\n\t'upsih',   'piv',    'bull',    'hellip', 'prime',  'Prime',\n\t'oline',   'frasl',  'weierp',  'image',  'real',   'trade',\n\t'alefsym', 'larr',   'uarr',    'rarr',   'darr',   'harr',\n\t'crarr',   'lArr',   'uArr',    'rArr',   'dArr',   'hArr',\n\t'forall',  'part',   'exist',   'empty',  'nabla',  'isin',\n\t'notin',   'ni',     'prod',    'sum',    'minus',  'lowast',\n\t'radic',   'prop',   'infin',   'ang',    'and',    'or',\n\t'cap',     'cup',    'int',     'sim',    'cong',   'asymp',\n\t'ne',      'equiv',  'le',      'ge',     'sub',    'sup',\n\t'nsub',    'sube',   'supe',    'oplus',  'otimes', 'perp',\n\t'sdot',    'lceil',  'rceil',   'lfloor', 'rfloor', 'lang',\n\t'rang',    'loz',    'spades',  'clubs',  'hearts', 'diams',\n\t'sup1',    'sup2',   'sup3',    'frac14', 'frac12', 'frac34',\n\t'there4',\n);\n\n/**\n * Callback for dcrm_kses_normalize_entities() regular expression.\n *\n * This function only accepts valid named entity references, which are finite,\n * case-sensitive, and highly scrutinized by HTML and XML validators.\n *\n * @param array $matches preg_replace_callback() matches array\n * @return string Correctly encoded entity\n */\nfunction dcrm_kses_named_entities($matches) {\n\tglobal $allowedentitynames;\n\n\tif ( empty($matches[1]) )\n\t\treturn '';\n\n\t$i = $matches[1];\n\treturn ( ( ! in_array($i, $allowedentitynames) ) ? \"&amp;$i;\" : \"&$i;\" );\n}\n\n/**\n * Helper function to determine if a Unicode value is valid.\n *\n * @param int $i Unicode value\n * @return bool True if the value was a valid Unicode number\n */\nfunction valid_unicode($i) {\n\treturn ( $i == 0x9 || $i == 0xa || $i == 0xd ||\n\t\t\t($i >= 0x20 && $i <= 0xd7ff) ||\n\t\t\t($i >= 0xe000 && $i <= 0xfffd) ||\n\t\t\t($i >= 0x10000 && $i <= 0x10ffff) );\n}\n\n/**\n * Converts and fixes HTML entities.\n *\n * This function normalizes HTML entities. It will convert `AT&T` to the correct\n * `AT&amp;T`, `&#00058;` to `&#58;`, `&#XYZZY;` to `&amp;#XYZZY;` and so on.\n *\n * @param string $string Content to normalize entities\n * @return string Content with normalized entities\n */\nfunction dcrm_kses_normalize_entities($string) {\n\t# Disarm all entities by converting & to &amp;\n\n\t$string = str_replace('&', '&amp;', $string);\n\n\t# Change back the allowed entities in our entity whitelist\n\n\t$string = preg_replace_callback('/&amp;([A-Za-z]{2,8}[0-9]{0,2});/', 'dcrm_kses_named_entities', $string);\n\t$string = preg_replace_callback('/&amp;#(0*[0-9]{1,7});/', 'dcrm_kses_normalize_entities2', $string);\n\t$string = preg_replace_callback('/&amp;#[Xx](0*[0-9A-Fa-f]{1,6});/', 'dcrm_kses_normalize_entities3', $string);\n\n\treturn $string;\n}\n\n/**\n * Callback for dcrm_kses_normalize_entities() regular expression.\n *\n * This function helps {@see dcrm_kses_normalize_entities()} to only accept 16-bit\n * values and nothing more for `&#number;` entities.\n *\n * @access private\n *\n * @param array $matches preg_replace_callback() matches array\n * @return string Correctly encoded entity\n */\nfunction dcrm_kses_normalize_entities2($matches) {\n\tif ( empty($matches[1]) )\n\t\treturn '';\n\n\t$i = $matches[1];\n\tif (valid_unicode($i)) {\n\t\t$i = str_pad(ltrim($i,'0'), 3, '0', STR_PAD_LEFT);\n\t\t$i = \"&#$i;\";\n\t} else {\n\t\t$i = \"&amp;#$i;\";\n\t}\n\n\treturn $i;\n}\n\n/**\n * Callback for dcrm_kses_normalize_entities() for regular expression.\n *\n * This function helps dcrm_kses_normalize_entities() to only accept valid Unicode\n * numeric entities in hex form.\n *\n * @access private\n *\n * @param array $matches preg_replace_callback() matches array\n * @return string Correctly encoded entity\n */\nfunction dcrm_kses_normalize_entities3($matches) {\n\tif ( empty($matches[1]) )\n\t\treturn '';\n\n\t$hexchars = $matches[1];\n\treturn ( ( ! valid_unicode(hexdec($hexchars)) ) ? \"&amp;#x$hexchars;\" : '&#x'.ltrim($hexchars,'0').';' );\n}\n\n/**\n * Escaping for HTML blocks.\n *\n * @param string $text\n * @return string\n */\nfunction esc_html( $text ) {\n\t$safe_text = check_invalid_utf8( $text );\n\t$safe_text = _dcrm_specialchars( $safe_text, ENT_QUOTES );\n\n\treturn $safe_text;\n}\n?>\n", "<?php\n/**\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/* DCRM Manage Header */\n\nif (!defined(\"DCRM\")) {\n\theader('HTTP/1.1 403 Forbidden');\n\texit('HTTP/1.1 403 Forbidden');\n}\n\n$localetype = 'manage';\ndefine('MANAGE_ROOT', dirname(__FILE__).'/');\ndefine('ABSPATH', dirname(MANAGE_ROOT).'/');\nrequire_once ABSPATH.'system/common.inc.php';\n\n$sidebars = array(\n\tarray(\n        'title' => 'PACKAGES',\n        'type'  => 'title'\n    ),\n\tarray(\n        'name'  => __('Upload Packages'),\n        'id'    => 'upload',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('Import Packages'),\n        'id'    => 'manage',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('Manage Packages'),\n        'id'    => 'center',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('Manage UDID'),\n        'id'    => 'udid',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'title' => 'REPOSITORY',\n        'type'  => 'title'\n    ),\n\tarray(\n        'name'  => __('Manage Sections'),\n        'id'    => 'sections',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('Manage Repository'),\n        'id'    => 'release',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'title' => 'SYSTEM',\n        'type'  => 'title'\n    ),\n\tarray(\n        'name'  => __('Running Status'),\n        'id'    => 'stats',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('About'),\n        'id'    => 'about',\n        'type'  => 'subtitle',\n    )\n);\n?>\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\t<title>DCRM - <?php _e('Repository Manager');?></title>\n\t<meta name=\"viewport\" content=\"width=600px, minimal-ui\">\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"css/bootstrap.min.css\">\n<?php if(is_rtl()){ ?>\t<link rel=\"stylesheet\" type=\"text/css\" href=\"css/bootstrap-rtl.min.css\"><?php echo \"\\n\"; } ?>\n<?php if(file_exists(ROOT.'css/font/'.($local_css = substr($locale, 0, 2)).'.css') || file_exists(ROOT.'css/font/' . ($local_css = $locale) . '.css')): ?>\t<link rel=\"stylesheet\" type=\"text/css\" href=\"../css/font/<?php echo $local_css; ?>.css\"><?php echo(\"\\n\"); endif; ?>\n\t<script src=\"http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js\"></script>\n\t<script type=\"text/javascript\" src=\"./javascript/pace.min.js\"></script>\n\t<script type=\"text/javascript\">\n\t$(document).ready(function(){\n\t\tvar loaded = true;\n\t\tvar top = $(\"#sidebar\").offset().top;\n\t\tfunction Add_Data() {\n\t\t\tvar scrolla=$(window).scrollTop();\n\t\t\tvar cha=parseInt(top)-parseInt(scrolla)-10;\n\t\t\tif(loaded && cha<=0) {                \n\t\t\t\t$(\"#sidebar\").addClass(\"sticky\");\n\t\t\t\tloaded=false;\n\t\t\t}\n\t\t\tif(!loaded && cha>0) {\n\t\t\t\t$(\"#sidebar\").removeClass(\"sticky\");\n\t\t\t\tloaded=true;\n\t\t\t}\n\t\t}\n\t\t$(window).scroll(Add_Data);\n\t});\n\t$(document).ready(function setmargin(){\n\t\tvar div = document.getElementById('sidebar');\n\t\tvar width = div.style.width || div.clientWidth || div.offsetWidth || div.scrollWidth;\n\t\t<?php if(is_rtl()){ ?>document.getElementById('content').style.marginRight = width+1+'px';<?php } else { ?>document.getElementById('content').style.marginLeft = width+1+'px';<?php } ?>\n\t});\n\t</script>\n<?php\nif ( isset($activeid) && ( 'manage' == $activeid || 'sections' == $activeid || 'center' == $activeid) ) \n\techo '\t<link rel=\"stylesheet\" type=\"text/css\" href=\"css/corepage.css\">';\nif ( isset($activeid) && ( 'view' == $activeid || 'edit' == $activeid || 'center' == $activeid) ) \n\techo '\t<script src=\"javascript/backend/mbar.js\" type=\"text/javascript\"></script>';\n?>\n</head>\n<body class=\"manage\">\n\t<div class=\"container\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"span\" id=\"logo\">\n\t\t\t\t<p class=\"title\">DCRM</p>\n\t\t\t\t<h6 class=\"underline\">Darwin Cydia Repository Manager</h6>\n\t\t\t</div>\n\t\t\t<div class=\"top-secondary\">\n\t\t\t\t<div class=\"btn-group pull-right\">\n\t\t\t\t\t<a href=\"build.php\" class=\"btn btn-inverse\"><?php _e('Rebuild the list');?></a>\n\t\t\t\t\t<a href=\"settings.php\" class=\"btn btn-info<?php if ( isset($activeid) && 'settings' == $activeid ) echo ' disabled'; ?>\"><?php _ex('Preferences', 'Header');?></a>\n\t\t\t\t\t<a href=\"login.php?action=logout\" class=\"btn btn-info\"><?php _e('Logout');?></a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<br />\n\t\t<div class=\"row\">\n\t\t\t<div class=\"span2.5\" id=\"sidebar\" style=\"margin-left:0 !important;\">\n\t\t\t\t<div class=\"well sidebar-nav\">\n\t\t\t\t\t<ul class=\"nav nav-list\">\n<?php\nforeach ($sidebars as $value) {\n\tswitch ( $value['type'] ) {\n\t\tcase 'title':\n\t\t\techo \"\\t\\t\\t\\t\\t\\t<li class=\\\"nav-header\\\">\" . $value['title'] . \"</li>\\n\";\n\t\t\tbreak;\n\t\tcase 'subtitle':\n\t\t\tif( ( isset($activeid) && $value['id'] == $activeid ) || ( isset($highactiveid) && $value['id'] == $highactiveid ) ){\n\t\t\t\techo \"\\t\\t\\t\\t\\t\\t\\t<li class=\\\"active\\\">\";\n\t\t\t} else {\n\t\t\t\techo \"\\t\\t\\t\\t\\t\\t\\t<li>\";\n\t\t\t}\n\t\t\techo '<a href=\"' . $value['id'] . '.php\">' . $value['name'] . \"</a></li>\\n\";\n\t}\n}\n?>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n<?php\nif ( isset($activeid) && ( 'view' == $activeid || 'edit' == $activeid || 'center' == $activeid) ){\n?>\n\t\t\t\t<div class=\"well sidebar-nav\" id=\"mbar\" <?php if ( isset($activeid) && 'center' == $activeid ) echo 'style=\"display: none;\"'; ?>>\n\t\t\t\t\t<ul class=\"nav nav-list\">\n\t\t\t\t\t\t<li class=\"nav-header\">OPERATIONS</li>\n\t\t\t\t\t\t\t<li<?php if ( isset($activeid) && 'view' == $activeid ) echo ' class=\"active\"'; ?>><a href=\"javascript:opt(1)\"><?php _e('View Details'); ?></a></li>\n\t\t\t\t\t\t\t<li<?php if ( isset($activeid) && 'edit' == $activeid && !isset($_GET['action']) ) echo ' class=\"active\"'?>><a href=\"javascript:opt(2)\"><?php _e('General Editing'); ?></a></li>\n\t\t\t\t\t\t\t<li<?php if ( isset($activeid) && 'edit' == $activeid && isset($_GET['action']) && ($_GET['action'] == 'advance' || $_GET['action'] == 'advance_set') ) echo ' class=\"active\"'?>><a href=\"javascript:opt(3)\"><?php _e('Advance Editing'); ?></a></li>\n\t\t\t\t\t\t\t<li id=\"sli\"></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n<?php\n}\n?>\n\t\t\t</div>\n\t\t\t<div class=\"content\" id=\"content\">\n\t\t\t\t<div class=\"wrap\">\n", "<?php\n/**\n * DCRM Login Page\n * Copyright (c) 2015 Hintay <hintay@me.com>\n * Copyright (c) 2014 i_82 <i.82@me.com>\n *\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nsession_cache_expire(30);\nsession_cache_limiter(\"private\");\nsession_start();\nsession_regenerate_id(true);\n$localetype = 'manage';\ndefine('ROOT_PATH', dirname(__FILE__));\ndefine('ABSPATH', dirname(ROOT_PATH).'/');\ninclude_once ABSPATH.'system/common.inc.php';\nheader(\"Cache-Control: no-store\");\nclass_loader('ValidateCode');\n\nif (isset($_GET['authpic'])) {\n\tif (trim($_GET['authpic']) == 'png') {\n\t\t$_vc = new ValidateCode();\n\t\t$_vc->doimg();\n\t\t$_SESSION['VCODE'] = $_vc->getCode();\n\t\texit();\n\t} else {\n\t\texit();\n\t}\n} else {\n\theader(\"Content-Type: text/html; charset=UTF-8\");\n}\nif (!isset($_SESSION['try'])) {\n\t$_SESSION['try'] = 0;\n} elseif (isset($_SESSION['lasttry']) && $_SESSION['lasttry']+DCRM_LOGINFAILRESETTIME <= time()) {\n\t$_SESSION['try'] = 0;\n}\nif (isset($_GET['action']) AND $_GET['action'] == \"logout\") {\n\tsession_unset();\n\tsession_destroy();\n\tgoto endlabel;\n}\nif (isset($_SESSION['connected']) && $_SESSION['connected'] === true) {\n\theader(\"Location: center.php\");\n\texit();\n}\nif(isset($_POST['language']) && !empty($_POST['language'])) {\n\t$_SESSION['language'] = $_POST['language'];\n\tif(!isset($_POST['submit']))\n\t\texit();\n}\nif(isset($_POST['submit'])) {\n\tif (!empty($_POST['username']) AND !empty($_POST['password'])) {\n\t\tif (empty($_POST['authcode'])) {\n\t\t\tunset($_SESSION['VCODE']);\n\t\t\t$error = \"authcode\";\n\t\t\tgoto endlabel;\n\t\t}\n\t\tif (strtolower($_POST['authcode']) != strtolower($_SESSION['VCODE'])) {\n\t\t\tunset($_SESSION['VCODE']);\n\t\t\t$_SESSION['try'] = $_SESSION['try'] + 1;\n\t\t\t$error = \"authcode\";\n\t\t\tgoto endlabel;\n\t\t} else {\n\t\t\tunset($_SESSION['VCODE']);\n\t\t}\n\t\tif (!preg_match(\"#^[0-9a-zA-Z\\_]*$#i\", $_POST['username'])) {\n\t\t\t$_SESSION['try'] = $_SESSION['try'] + 1;\n\t\t\t$error = \"badlogin\";\n\t\t\tgoto endlabel;\n\t\t}\n\t\t$login_query = DB::query(\"SELECT * FROM `\".DCRM_CON_PREFIX.\"Users` WHERE `Username` = '\".DB::real_escape_string($_POST['username']).\"' LIMIT 1\");\n\t\tif (DB::affected_rows() > 0) {\n\t\t\t$login = mysql_fetch_assoc($login_query);\n\t\t\tif ($login['Username'] === $_POST['username'] AND strtoupper($login['SHA1']) === strtoupper(sha1($_POST['password']))) {\n\t\t\t\t$login_query = DB::query(\"UPDATE `\".DCRM_CON_PREFIX.\"Users` SET `LastLoginTime` = '\".date('Y-m-d H:i:s').\"' WHERE `ID` = '\".$login['ID'].\"'\");\n\t\t\t\t$_SESSION['power'] = $login['Power'];\n\t\t\t\t$_SESSION['userid'] = $login['ID'];\n\t\t\t\t$_SESSION['username'] = $login['Username'];\n\t\t\t\t$_SESSION['token'] = sha1(time()*rand(140,320));\n\t\t\t\t$_SESSION['try'] = 0;\n\t\t\t\t$_SESSION['connected'] = true;\n\t\t\t\theader(\"Location: center.php\");\n\t\t\t\texit();\n\t\t\t} else {\n\t\t\t\t$_SESSION['try'] = $_SESSION['try'] + 1;\n\t\t\t\t$_SESSION['lasttry'] = time();\n\t\t\t\t$error = \"badlogin\";\n\t\t\t\tgoto endlabel;\n\t\t\t}\n\t\t} else {\n\t\t\t$_SESSION['try'] = $_SESSION['try'] + 1;\n\t\t\t$_SESSION['lasttry'] = time();\n\t\t\t$error = \"badlogin\";\n\t\t\tgoto endlabel;\n\t\t}\n\t} else {\n\t\t$error = \"notenough\";\n\t\tgoto endlabel;\n\t}\n}\nendlabel:\n?>\n<!DOCTYPE html>\n<html class=\"backend\">\n\t<!-- \u5f00\u59cb \u5934\u90e8 -->\n\t<head>\n\t\t<!-- \u5f00\u59cb META \u6807\u7b7e -->\n\t\t<meta charset=\"utf-8\">\n\t\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n\t\t<title><?php _e('Login'); ?></title>\n\t\t<meta name=\"author\" content=\"WEIPDCRM\">\n\t\t<meta name=\"license\" content=\"AGPLv3\">\n\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\">\n\n\t\t<link rel=\"shortcut icon\" href=\"../favicon.ico\">\n\t\t<!--/ \u7ed3\u675f META \u6807\u7b7e -->\n\n\t\t<!-- \u5f00\u59cb \u6837\u5f0f\u8868 -->\n\t\t<!--  \u63d2\u4ef6\u6837\u5f0f\u8868\uff1a\u53ef\u9009 -->\n\t\t<!--/ \u63d2\u4ef6\u6837\u5f0f\u8868 -->\n\n\t\t<!-- \u5e94\u7528\u6837\u5f0f\u8868\uff1a\u5f3a\u5236 -->\n\t\t<link rel=\"stylesheet\" href=\"http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css\">\n\t\t<link rel=\"stylesheet\" href=\"./stylesheet/layout.min.css\">\n\t\t<link rel=\"stylesheet\" href=\"./stylesheet/uielement.min.css\">\n<?php if(is_rtl()){ ?>\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./stylesheet/uielement-rtl.min.css\"><?php } ?>\n<?php if(file_exists(ROOT.'css/font/'.($local_css = substr($locale, 0, 2)).'.css') || file_exists(ROOT.'css/font/' . ($local_css = $locale) . '.css')): ?>\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"../css/font/<?php echo $local_css; ?>.css\"><?php echo(\"\\n\"); endif; ?>\n\t\t<!--/ \u5e94\u7528\u6837\u5f0f\u8868 -->\n\n\t\t<!-- modernizr \u811a\u672c -->\n\t\t<script type=\"text/javascript\" src=\"./plugins/modernizr/modernizr.min.js\"></script>\n\t\t<!--/ modernizr \u811a\u672c-->\n\t\t<!-- \u7ed3\u675f \u6837\u5f0f\u8868 -->\n    </head>\n\t<!--/ \u7ed3\u675f \u5934\u90e8 -->\n\n\t<!-- \u5f00\u59cb \u9875\u9762\u4e3b\u4f53 -->\n\t<body>\n\t\t<!-- \u5f00\u59cb \u6a21\u677f\u4e3b\u5185\u5bb9 -->\n\t\t<section id=\"main\" role=\"main\">\n\t\t\t<!-- \u5f00\u59cb \u6a21\u677f\u5bb9\u5668 -->\n\t\t\t<section class=\"container\">\n\t\t\t\t<!-- \u5f00\u59cb \u884c -->\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<div class=\"col-lg-4 col-lg-offset-4\">\n\t\t\t\t\t\t<!-- \u5546\u6807 -->\n\t\t\t\t\t\t<div class=\"text-center\" style=\"margin-bottom:10px; margin-top:30px;\">\n<?php\nif (file_exists('../CydiaIcon.png')) :\n?>\n\t\t\t\t\t\t\t<img src=\"../CydiaIcon.png\" style=\"width: 72px; height: 72px; border-radius: 6px; margin-bottom:10px;\" />\n<?php\nendif;\n?>\n\t\t\t\t\t\t\t<h5 class=\"semibold text-muted mt-5\"><?php _e('Login'); ?></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<!--/ \u5546\u6807 -->\n\n\t\t\t\t\t\t<hr><!-- \u6c34\u5e73\u7ebf -->\n\n\t\t\t\t\t\t<!-- \u767b\u5f55\u8868\u5355 -->\n<?php\nif (!isset($_SESSION['try']) OR $_SESSION['try'] <= DCRM_MAXLOGINFAIL) {\n?>\n\t\t\t\t\t\t<div class=\"panel\">\n\t\t\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t<select name=\"language\" class=\"form-control\" onchange=\"set_language()\">\n<?php\n\t$languages = get_available_languages();\n\t$langtext = '<option value=\"Detect\"';\n\tif (!isset($_SESSION['language']) || $_SESSION['language'] == 'Detect')\n\t\t$langtext .= ' selected=\"selected\"';\n\t$langtext .= '>'._x( 'Select language', 'language' );\n\tif ( substr( $locale, 0, 2 ) != 'en' )\n\t\t$langtext .= ' - Languages';\n\t$langtext .= \"</option>\\n\";\n\n\t$languages_list = languages_list();\n\t$languages_self_list = languages_self_list();\n\tif(!in_array('en', $languages, true) && !in_array('en_US', $languages, true) && !in_array('en_GB', $languages, true)){\n\t\t$langtext .= '<option value=\"en_US\"';\n\t\tif ($_SESSION['language'] == 'en_US')\n\t\t\t$langtext .= ' selected=\"selected\"';\n\t\t$langtext .= '>' . _x('English', 'language') . \" - English</option>\\n\";\n\t}\n\n\tforeach( $languages as $language ) {\n\t\t$langtext .= \"<option value=\\\"$language\\\"\";\n\t\tif ($_SESSION['language'] == $language)\n\t\t\t$langtext .= ' selected=\"selected\"';;\n\t\t$langtext .= '>' . (isset($languages_list[$language]) ? $languages_list[$language] : $language);\n\t\t$langtext .= \" - \" . (isset($languages_self_list[$language]) ? $languages_self_list[$language] : $languages_list[$language]) . \"</option>\\n\";\n\t}\n\n\techo $langtext;\n?>\n\t\t\t\t\t\t\t\t\t</select>\n                                </div>\n\t\t\t\t\t\t\t\t<form name=\"form-login\" action=\"login.php\" method=\"POST\">\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-stack has-icon pull-left\">\n\t\t\t\t\t\t\t\t\t\t\t<input name=\"username\" type=\"text\" class=\"form-control input-lg\" placeholder=\"<?php _e('Username'); ?>\" data-parsley-errors-container=\"#error-container\" data-parsley-error-message=\"<?php _e('Please fill in your username'); ?>\" data-parsley-required>\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"ico-user2 form-control-icon\"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-stack has-icon pull-left\">\n\t\t\t\t\t\t\t\t\t\t\t<input name=\"password\" type=\"password\" class=\"form-control input-lg\" placeholder=\"<?php _e('Password'); ?>\" data-parsley-errors-container=\"#error-container\" data-parsley-error-message=\"<?php _e('Please fill in your password'); ?>\" data-parsley-required>\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"ico-lock2 form-control-icon\"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-stack has-icon pull-left\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"input-group image-input-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"authcode\" class=\"form-control input-lg\" placeholder=\"<?php _e('Verify Code'); ?>\" data-parsley-errors-container=\"#error-container\" data-parsley-error-message=\"<?php _e('Please fill in the verify code'); ?>\" data-parsley-required />\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"input-group-addon verifycode\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"login.php?authpic=png&amp;rand=<?php echo(time()); ?>\" style=\"height: 44px;\" onclick=\"this.src='login.php?authpic=png&amp;rand=' + new Date().getTime();\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"ico-quill3 form-control-icon\"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<!-- \u9519\u8bef\u5bb9\u5668 -->\n\t\t\t\t\t\t\t\t\t<div id=\"error-container\" class=\"mb15\">\n<?php\n\tif (isset($_GET['error'])) {\n\t\t$error = $_GET['error'];\n\t}\n\tif ($error == \"notenough\") {\n\t\techo '<ul class=\"parsley-errors-list filled\"><li>'.__('Please input your username and password!').'</li></ul>';\n\t} elseif ($error == \"badlogin\") {\n\t\techo '<ul class=\"parsley-errors-list filled\"><li>'.__('Unknown username or bad password!').'</li></ul>';\n\t} elseif ($error == \"bear\") {\n\t\techo '<ul class=\"parsley-errors-list filled\"><li>'.__('Bear!').'</li></ul>';\n\t} elseif ($error == \"authcode\") {\n\t\techo '<ul class=\"parsley-errors-list filled\"><li>'.__('Verification code error!').'</li></ul>';\n\t}\n?>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<!--/ \u9519\u8bef\u5bb9\u5668 -->\n\n\t\t\t\t\t\t\t\t\t<input name=\"submit\" style=\"display: none;\"/>\n\t\t\t\t\t\t\t\t\t<div class=\"form-group nm\">\n\t\t\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"btn btn-block btn-success\"><span class=\"semibold\"><?php _ex('Login', 'Buttom'); ?></span></button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</form>\n                            </div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<!-- \u767b\u5f55\u8868\u5355 -->\n<?php\n} else {\n?>\n\t\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t\t<h1 class=\"text-center\"><?php _e('Error'); ?></h1>\n\t\t\t\t\t\t\t<p><?php printf(__('Your login wrong too many times , close the session or wait %s minutes and try again later.'), ceil(($_SESSION['lasttry']+DCRM_LOGINFAILRESETTIME - time())/60)); ?></p>\n\t\t\t\t\t\t</div>\n<?php\n}\n?>\n\t\t\t\t\t\t<hr><!-- \u6c34\u5e73\u7ebf -->\n\n\t\t\t\t\t\t<p class=\"text-muted text-center\">Copyrght &copy; <?php echo(date('Y')); echo defined(\"AUTOFILL_SEO\") ? ' '.htmlspecialchars(AUTOFILL_SEO) : ''; ?></p>\n\t\t\t\t\t\t<p class=\"text-muted text-center\">Powered by WEIPDCRM</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<!--/ \u7ed3\u675f \u884c -->\n\t\t\t</section>\n\t\t\t<!--/ \u7ed3\u675f \u6a21\u677f\u5bb9\u5668 -->\n\t\t</section>\n\t\t<!--/ \u7ed3\u675f \u6a21\u677f\u4e3b\u5185\u5bb9 -->\n\n\t\t<!-- \u5f00\u59cb JAVASCRIPT \u90e8\u5206 (\u5e95\u90e8\u52a0\u8f7djavascript\u4ee5\u51cf\u5c11\u8f7d\u5165\u65f6\u95f4) -->\n\t\t<!-- \u5e94\u7528\u53ca\u5e95\u5c42\u811a\u672c\uff1a\u5f3a\u5236 -->\n\t\t<script src=\"http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js\"></script>\n\t\t<script src=\"http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js\"></script>\n\t\t<!--/ \u5e94\u7528\u53ca\u5e95\u5c42\u811a\u672c\uff1a\u5f3a\u5236 -->\n\n\t\t<!-- \u63d2\u4ef6\u53ca\u9875\u9762\u811a\u672c\uff1a\u53ef\u9009 -->\n\t\t<script type=\"text/javascript\" src=\"./javascript/pace.min.js\"></script>\n\t\t<script type=\"text/javascript\" src=\"./plugins/parsley/parsley.min.js\"></script>\n\t\t<script type=\"text/javascript\" src=\"./javascript/backend/login.js\"></script>\n<?php\nif(isset($error))\n\techo '<script type=\"text/javascript\">$(document).ready(function(){animation();});</script>'\n?>\n\t\t<!--/ \u63d2\u4ef6\u53ca\u9875\u9762\u811a\u672c\uff1a\u53ef\u9009 -->\n\t\t<!--/ \u7ed3\u675f JAVASCRIPT \u90e8\u5206 -->\n\t</body>\n\t<!--/ \u7ed3\u675f \u9875\u9762\u4e3b\u4f53 -->\n</html>", "<?php\nif (!defined('IN_DCRM')) exit();\nclass db_mysql {\n\tvar $curlink;\n\tvar $last_query;\n\tfunction connect() {\n\t\t$this->curlink = $this->_dbconnect(DCRM_CON_SERVER.':' . (defined(\"DCRM_CON_SERVER_PORT\") ? DCRM_CON_SERVER_PORT : '3306'), DCRM_CON_USERNAME, DCRM_CON_PASSWORD, 'utf8', DCRM_CON_DATABASE, (defined(\"DCRM_CON_PCONNECT\") ? DCRM_CON_PCONNECT : false));\n\t}\n\tfunction _dbconnect($dbhost, $dbuser, $dbpw, $dbcharset, $dbname, $pconnect) {\n\t\t$link = null;\n\t\t$func = empty($pconnect) ? 'mysql_connect' : 'mysql_pconnect';\n\t\tif (!$link = @$func($dbhost, $dbuser, $dbpw, 1)) {\n\t\t\t$this->halt('Couldn\\'t connect to MySQL Server');\n\t\t} else {\n\t\t\t$this->curlink = $link;\n\t\t\tif ($this->version() > '4.1') {\n\t\t\t\t$serverset = $dbcharset ? 'character_set_connection='.$dbcharset.', character_set_results='.$dbcharset.', character_set_client=binary' : '';\n\t\t\t\t$serverset .= $this->version() > '5.0.1' ? ((empty($serverset) ? '' : ',').'sql_mode=\\'\\'') : '';\n\t\t\t\t$serverset && mysql_query(\"SET $serverset\", $link);\n\t\t\t}\n\t\t\t$dbname && @mysql_select_db($dbname, $link);\n\t\t}\n\t\treturn $link;\n\t}\n\tfunction select_db($dbname) {\n\t\treturn mysql_select_db($dbname, $this->curlink);\n\t}\n\tfunction fetch_array($query, $result_type = MYSQL_ASSOC) {\n\t\treturn mysql_fetch_array($query, $result_type);\n\t}\n\tfunction fetch_first($sql) {\n\t\treturn $this->fetch_array($this->query($sql));\n\t}\n\tfunction result_first($sql) {\n\t\treturn $this->result($this->query($sql), 0);\n\t}\n\tfunction query($sql, $type = '') {\n\t\t$func = $type == 'UNBUFFERED' && @function_exists('mysql_unbuffered_query') ? 'mysql_unbuffered_query' : 'mysql_query';\n\t\tif (!$this->curlink) $this->connect();\n\t\tif (!($query = $func($sql, $this->curlink))) {\n\t\t\tif ($type != 'SILENT') {\n\t\t\t\t$this->halt('MySQL Query ERROR', $sql);\n\t\t\t}\n\t\t}\n\t\treturn $this->last_query = $query;\n\t}\n\tfunction affected_rows() {\n\t\treturn mysql_affected_rows($this->curlink);\n\t}\n\tfunction error() {\n\t\treturn (($this->curlink) ? mysql_error($this->curlink) : mysql_error());\n\t}\n\tfunction errno() {\n\t\treturn intval(($this->curlink) ? mysql_errno($this->curlink) : mysql_errno());\n\t}\n\tfunction result($query, $row = 0) {\n\t\t$query = @mysql_result($query, $row);\n\t\treturn $query;\n\t}\n\tfunction num_rows($query) {\n\t\t$query = mysql_num_rows($query);\n\t\treturn $query;\n\t}\n\tfunction num_fields($query) {\n\t\treturn mysql_num_fields($query);\n\t}\n\tfunction free_result($query) {\n\t\treturn mysql_free_result($query);\n\t}\n\tfunction insert_id() {\n\t\treturn ($id = mysql_insert_id($this->curlink)) >= 0 ? $id : $this->result($this->query(\"SELECT last_insert_id()\"), 0);\n\t}\n\tfunction fetch_row($query) {\n\t\t$query = mysql_fetch_row($query);\n\t\treturn $query;\n\t}\n\tfunction fetch_fields($query) {\n\t\treturn mysql_fetch_field($query);\n\t}\n\tfunction real_escape_string($query) {\n\t\tif (!$this->curlink) $this->connect();\n\t\treturn mysql_real_escape_string($query);\n\t}\n\tfunction version() {\n\t\tif (empty($this->version)) {\n\t\t\t$this->version = mysql_get_server_info($this->curlink);\n\t\t}\n\t\treturn $this->version;\n\t}\n\tfunction close() {\n\t\treturn mysql_close($this->curlink);\n\t}\n\tfunction stat() {\n\t\tif (!$this->curlink) $this->connect();\n\t\treturn mysql_stat($this->curlink);\n\t}\n\tfunction halt($message = '', $sql = '') {\n\t\terror::db_error($message, $sql);\n\t}\n\tfunction __destruct() {\n\t\t$this->close();\n\t}\n}\nclass DB {\n\tfunction delete($table, $condition, $limit = 0, $unbuffered = true) {\n\t\tif (empty($condition)) {\n\t\t\t$where = '1';\n\t\t} elseif (is_array($condition)) {\n\t\t\t$where = DB::implode_field_value($condition, ' AND ');\n\t\t} else {\n\t\t\t$where = $condition;\n\t\t}\n\t\t$sql = \"DELETE FROM {$table} WHERE $where \".($limit ? \"LIMIT $limit\" : '');\n\t\treturn DB::query($sql, ($unbuffered ? 'UNBUFFERED' : ''));\n\t}\n\tfunction insert($table, $data, $return_insert_id = true, $replace = false, $silent = false) {\n\t\t$sql = DB::implode_field_value($data);\n\t\t$cmd = $replace ? 'REPLACE INTO' : 'INSERT INTO';\n\t\t$silent = $silent ? 'SILENT' : '';\n\t\t$return = DB::query(\"$cmd $table SET $sql\", $silent);\n\t\treturn $return_insert_id ? DB::insert_id() : $return;\n\t}\n\tfunction update($table, $data, $condition, $unbuffered = false, $low_priority = false) {\n\t\t$sql = DB::implode_field_value($data);\n\t\t$cmd = \"UPDATE \".($low_priority ? 'LOW_PRIORITY' : '');\n\t\t$where = '';\n\t\tif (empty($condition)) {\n\t\t\t$where = '1';\n\t\t} elseif (is_array($condition)) {\n\t\t\t$where = DB::implode_field_value($condition, ' AND ');\n\t\t} else {\n\t\t\t$where = $condition;\n\t\t}\n\t\t$res = DB::query(\"$cmd $table SET $sql WHERE $where\", $unbuffered ? 'UNBUFFERED' : '');\n\t\treturn $res;\n\t}\n\tfunction implode_field_value($array, $glue = ',') {\n\t\t$sql = $comma = '';\n\t\tforeach ($array as $k => $v) {\n\t\t\t$k = DB::real_escape_string($k);\n\t\t\t$v = DB::real_escape_string($v);\n\t\t\tif ('NULL' == $v)\n\t\t\t\t$v = '';\n\t\t\t$sql .= $comma.\"`$k`='$v'\";\n\t\t\t$comma = $glue;\n\t\t}\n\t\treturn $sql;\n\t}\n\tfunction insert_id() {\n\t\treturn DB::_execute('insert_id');\n\t}\n\tfunction fetch($resourceid, $type = MYSQL_ASSOC) {\n\t\treturn DB::_execute('fetch_array', $resourceid, $type);\n\t}\n\tfunction fetch_first($sql) {\n\t\treturn DB::_execute('fetch_first', $sql);\n\t}\n\tfunction fetch_all($sql) {\n\t\t$query = DB::_execute('query', $sql);\n\t\t$return = array();\n\t\twhile ($result = DB::fetch($query)) {\n\t\t\t$return[] = $result;\n\t\t}\n\t\treturn $return;\n\t}\n\tfunction result($resourceid, $row = 0) {\n\t\treturn DB::_execute('result', $resourceid, $row);\n\t}\n\tfunction result_first($sql) {\n\t\treturn DB::_execute('result_first', $sql);\n\t}\n\tfunction query($sql, $type = '') {\n\t\treturn DB::_execute('query', $sql, $type);\n\t}\n\tfunction num_rows($resourceid) {\n\t\treturn DB::_execute('num_rows', $resourceid);\n\t}\n\tfunction affected_rows() {\n\t\treturn DB::_execute('affected_rows');\n\t}\n\tfunction free_result($query) {\n\t\treturn DB::_execute('free_result', $query);\n\t}\n\tfunction real_escape_string($query) {\n\t\treturn DB::_execute('real_escape_string', $query);\n\t}\n\tfunction fetch_row($query) {\n\t\treturn DB::_execute('fetch_row', $query);\n\t}\n\tfunction error() {\n\t\treturn DB::_execute('error');\n\t}\n\tfunction errno() {\n\t\treturn DB::_execute('errno');\n\t}\n\tfunction version() {\n\t\treturn DB::_execute('version');\n\t}\n\tfunction stat() {\n\t\treturn DB::_execute('stat');\n\t}\n\tfunction _execute($cmd , $arg1 = '', $arg2 = '') {\n\t\tstatic $db;\n\t\tif (empty($db)) $db = &DB::object();\n\t\t$res = $db->$cmd($arg1, $arg2);\n\t\treturn $res;\n\t}\n\tfunction &object() {\n\t\tstatic $db;\n\t\tif (empty($db)) $db = new db_mysql();\n\t\treturn $db;\n\t}\n\t/**\n\t * Prepares a SQL query for safe execution. Uses sprintf()-like syntax.\n\t *\n\t * The following directives can be used in the query format string:\n\t *   %d (integer)\n\t *   %f (float)\n\t *   %s (string)\n\t *   %% (literal percentage sign - no argument needed)\n\t *\n\t * All of %d, %f, and %s are to be left unquoted in the query string and they need an argument passed for them.\n\t * Literals (%) as parts of the query must be properly written as %%.\n\t *\n\t * This function only supports a small subset of the sprintf syntax; it only supports %d (integer), %f (float), and %s (string).\n\t * Does not support sign, padding, alignment, width or precision specifiers.\n\t * Does not support argument numbering/swapping.\n\t *\n\t * May be called like {@link http://php.net/sprintf sprintf()} or like {@link http://php.net/vsprintf vsprintf()}.\n\t *\n\t * Both %d and %s should be left unquoted in the query string.\n\t *\n\t *     DB::prepare( \"SELECT * FROM `table` WHERE `column` = %s AND `field` = %d\", 'foo', 1337 )\n\t *     DB::prepare( \"SELECT DATE_FORMAT(`field`, '%%c') FROM `table` WHERE `column` = %s\", 'foo' );\n\t *\n\t * @link http://php.net/sprintf Description of syntax.\n\t *\n\t * @param string $query Query statement with sprintf()-like placeholders\n\t * @param array|mixed $args The array of variables to substitute into the query's placeholders if being called like\n\t * \t{@link http://php.net/vsprintf vsprintf()}, or the first variable to substitute into the query's placeholders if\n\t * \tbeing called like {@link http://php.net/sprintf sprintf()}.\n\t * @param mixed $args,... further variables to substitute into the query's placeholders if being called like\n\t * \t{@link http://php.net/sprintf sprintf()}.\n\t * @return null|false|string Sanitized query string, null if there is no query, false if there is an error and string\n\t * \tif there was something to prepare\n\t */\n\tpublic function prepare( $query, $args ) {\n\t\tif ( is_null( $query ) )\n\t\t\treturn;\n\n\t\t// This is not meant to be foolproof -- but it will catch obviously incorrect usage.\n\t\tif ( strpos( $query, '%' ) === false ) {\n\t\t\tthrow new Exception(__( 'The query argument of DB::prepare() must have a placeholder.' ));\n\t\t}\n\n\t\t$args = func_get_args();\n\t\tarray_shift( $args );\n\t\t// If args were passed as an array (as in vsprintf), move them up\n\t\tif ( isset( $args[0] ) && is_array($args[0]) )\n\t\t\t$args = $args[0];\n\t\t$query = str_replace( \"'%s'\", '%s', $query ); // in case someone mistakenly already singlequoted it\n\t\t$query = str_replace( '\"%s\"', '%s', $query ); // doublequote unquoting\n\t\t$query = preg_replace( '|(?<!%)%f|' , '%F', $query ); // Force floats to be locale unaware\n\t\t$query = preg_replace( '|(?<!%)%s|', \"'%s'\", $query ); // quote the strings, avoiding escaped strings like %%s\n\t\treturn @vsprintf( $query, $args );\n\t}\n}\n?>", "<?php\nif(!defined('IN_DCRM')) exit();\nfunction showmessage($msg = '', $redirect = '', $delay = 3){\n\tglobal $siteurl;\n?>\n<!DOCTYPE html>\n<html>\n<meta charset=utf-8>\n<title><?php _e('System Message'); ?></title>\n<meta name=viewport content=\"initial-scale=1, minimum-scale=1, width=device-width\">\n<style>\n*{margin:0;padding:0}\nhtml,code{font:15px/22px arial,sans-serif}\nhtml{background:#fff;color:#222;padding:15px}\nbody{margin:7% auto 0;max-width:390px;min-height:220px;padding:75px 0 15px}\n* > body{background:url(<?php echo($siteurl); ?>icons/default/msg_bg.png) 100% 5px no-repeat;padding-right:205px}\np{margin:11px 0 22px;overflow:hidden}\nins, ins a{color:#777;text-decoration:none;font-size:10px;}\na img{border:0}\n@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}\n</style>\n<body>\n<p><b><?php _e('System Message'); ?> - DCRM</b></p>\n<?php\necho \"<p>{$msg}</p>\";\nif($redirect)\n\techo \"<ins><a href=\\\"{$redirect}\\\">\".__('If your browser does not automatically redirect, please click here.').\"</a></ins><meta http-equiv=\\\"refresh\\\" content=\\\"{$delay};url={$redirect}\\\" />\";\n?>\n</body>\n</html>\n<?php \n\texit();\n}\nfunction saveVersion($version){\n\tif (!$version) return;\n\t$content = '<?php'.PHP_EOL.'/* Auto-generated version file */'.PHP_EOL.'$_version = \\''.$version.'\\';'.PHP_EOL.'?>';\n\tif(!is_writable(SYSTEM_ROOT.'./version.inc.php')) throw new Exception('Version file is not writable!');\n\tif(!file_put_contents(SYSTEM_ROOT.'./version.inc.php', $content)) throw new Exception('Version file is not writable, please change $_version to '.$version.'in version.inc.php');\n}\nfunction update_final($version){\n\tsaveVersion($version);\n\tshowmessage(sprintf(__( 'Successfully updated to %s' ), $version), './');\n}\nfunction sizeext($size) {\n\treturn ($size < 1048576) ? round($size/1024,2).' KB' : round($size/1048576,2).' MB';\n}\nfunction httpinfo($info_type) {\n\tswitch ($info_type) {\n\t\tcase 304:\n\t\t\t$info = \"304 Not Modified\";\n\t\t\tbreak;\n\t\tcase 400:\n\t\t\t$info = \"400 Bad Request\";\n\t\t\tbreak;\n\t\tcase 404:\n\t\t\t$info = \"404 Not Found\";\n\t\t\tbreak;\n\t\tcase 4030:\n\t\t\t$info = \"403 Forbidden\";\n\t\t\tbreak;\n\t\tcase 4031:\n\t\t\t$info = \"403 Payment Required\";\n\t\t\tbreak;\n\t\tcase 4032:\n\t\t\tif(!defined(\"AUTOFILL_EMAIL\"))\n\t\t\t\trequire_once(CONF_PATH.'autofill.inc.php');\n\t\t\t$info = sprintf('403 Payment Required: This package is either paid or requires a paid package to function. If you already paid for this package, try again later, or email %s if this problem keeps happening.', AUTOFILL_EMAIL);\n\t\t\tbreak;\n\t\tcase 4033:\n\t\t\t$info = '403 Forbidden: This package protected.';\n\t\t\tbreak;\n\t\tcase 405:\n\t\t\t$info = \"405 Method Not Allowed\";\n\t\t\tbreak; \n\t\tcase 500:\n\t\t\t$info = \"500 Internal Server Error\";\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t$info = \"501 Not Implemented\";\n\t\t\tbreak;\n\t}\n\theader(\"HTTP/1.1 \".$info);\n\theader(\"Status: \".$info);\n\theader(\"Content-Type: text/html; charset=UTF-8\");\n?>\n<html>\n<head>\n\t<title><?php echo($info); ?></title>\n</head>\n<body bgcolor=\"white\">\n\t<center>\n\t\t<h1><?php echo($info); ?></h1>\n\t</center>\n<hr />\n\t<center>DCRM</center>\n</body>\n</html>\n<?php\n\texit();\n}\nfunction _ip2long( $ip_address ) {\n\treturn sprintf(\"%u\",ip2long($ip_address));\n}\nfunction getIp(){ \n\t$onlineip=''; \n\tif(getenv('HTTP_CLIENT_IP')&&strcasecmp(getenv('HTTP_CLIENT_IP'),'unknown')){ \n\t\t$onlineip=getenv('HTTP_CLIENT_IP'); \n\t} elseif(getenv('HTTP_X_FORWARDED_FOR')&&strcasecmp(getenv('HTTP_X_FORWARDED_FOR'),'unknown')){ \n\t\t$onlineip=getenv('HTTP_X_FORWARDED_FOR'); \n\t} elseif(getenv('REMOTE_ADDR')&&strcasecmp(getenv('REMOTE_ADDR'),'unknown')){ \n\t\t$onlineip=getenv('REMOTE_ADDR'); \n\t} elseif(isset($_SERVER['REMOTE_ADDR'])&&$_SERVER['REMOTE_ADDR']&&strcasecmp($_SERVER['REMOTE_ADDR'],'unknown')){ \n\t\t$onlineip=$_SERVER['REMOTE_ADDR']; \n\t}\n\treturn $onlineip; \n} \n/**\n * Check value to find if it was serialized.\n *\n * If $data is not an string, then returned value will always be false.\n * Serialized data is always a string.\n *\n * @param string $data   Value to check to see if was serialized.\n * @param bool   $strict Optional. Whether to be strict about the end of the string. Default true.\n * @return bool False if not serialized and true if it was.\n */\nfunction is_serialized( $data, $strict = true ) {\n\t// if it isn't a string, it isn't serialized.\n\tif ( ! is_string( $data ) ) {\n\t\treturn false;\n\t}\n\t$data = trim( $data );\n \tif ( 'N;' == $data ) {\n\t\treturn true;\n\t}\n\tif ( strlen( $data ) < 4 ) {\n\t\treturn false;\n\t}\n\tif ( ':' !== $data[1] ) {\n\t\treturn false;\n\t}\n\tif ( $strict ) {\n\t\t$lastc = substr( $data, -1 );\n\t\tif ( ';' !== $lastc && '}' !== $lastc ) {\n\t\t\treturn false;\n\t\t}\n\t} else {\n\t\t$semicolon = strpos( $data, ';' );\n\t\t$brace     = strpos( $data, '}' );\n\t\t// Either ; or } must exist.\n\t\tif ( false === $semicolon && false === $brace )\n\t\t\treturn false;\n\t\t// But neither must be in the first X characters.\n\t\tif ( false !== $semicolon && $semicolon < 3 )\n\t\t\treturn false;\n\t\tif ( false !== $brace && $brace < 4 )\n\t\t\treturn false;\n\t}\n\t$token = $data[0];\n\tswitch ( $token ) {\n\t\tcase 's' :\n\t\t\tif ( $strict ) {\n\t\t\t\tif ( '\"' !== substr( $data, -2, 1 ) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} elseif ( false === strpos( $data, '\"' ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// or else fall through\n\t\tcase 'a' :\n\t\tcase 'O' :\n\t\t\treturn (bool) preg_match( \"/^{$token}:[0-9]+:/s\", $data );\n\t\tcase 'b' :\n\t\tcase 'i' :\n\t\tcase 'd' :\n\t\t\t$end = $strict ? '$' : '';\n\t\t\treturn (bool) preg_match( \"/^{$token}:[0-9.E-]+;$end/\", $data );\n\t}\n\treturn false;\n}\n/**\n * Serialize data, if needed.\n *\n * @param string|array|object $data Data that might be serialized.\n * @return mixed A scalar data\n */\nfunction maybe_serialize( $data ) {\n\tif ( is_array( $data ) || is_object( $data ) )\n\t\treturn serialize( $data );\n\n\tif ( is_serialized( $data, false ) )\n\t\treturn serialize( $data );\n\n\treturn $data;\n}\n/**\n * Unserialize value only if it was serialized.\n *\n * @param string $original Maybe unserialized original, if is needed.\n * @return mixed Unserialized data can be any type.\n */\nfunction maybe_unserialize( $original ) {\n\tif ( is_serialized( $original ) ) // don't attempt to unserialize data that wasn't serialized going in\n\t\treturn @unserialize( $original );\n\treturn $original;\n}\n/**\n * Retrieve option value based on name of option.\n *\n * If the option does not exist or does not have a value, then the return value\n * will be false. This is useful to check whether you need to install an option\n * and is commonly used during installation of plugin options and to test\n * whether upgrading is required.\n *\n * If the option was serialized then it will be unserialized when it is returned.\n *\n * @param string $option Name of option to retrieve. Expected to not be SQL-escaped.\n * @param mixed $default Optional. Default value to return if the option does not exist.\n * @return mixed Value set for the option.\n */\nfunction get_option( $option, $default = false ) {\n\t$option = trim( $option );\n\tif ( empty( $option ) )\n\t\treturn false;\n\n\t//$row = mysql_fetch_object( DB::query( DB::prepare( \"SELECT option_value FROM `\".DCRM_CON_PREFIX.\"options` WHERE option_name = %s LIMIT 1\", $option ) ) );\n\t$row = DB::result_first( DB::prepare( \"SELECT option_value FROM `\".DCRM_CON_PREFIX.\"Options` WHERE option_name = %s LIMIT 1\", $option ) );\n\n\t/*if ( is_object( $row ) ) {\n\t\t$value = $row->option_value;\n\t} else { // option does not exist\n\t\treturn $default;\n\t}*/\n\tif ($row) {\n\t\t$value = $row;\n\t} else {\n\t\treturn $default;\n\t}\n\n\treturn maybe_unserialize( $value );\n}\n/**\n * Update the value of an option that was already added.\n *\n * You do not need to serialize values. If the value needs to be serialized, then\n * it will be serialized before it is inserted into the database. Remember,\n * resources can not be serialized or added as an option.\n *\n * If the option does not exist, then the option will be added with the option\n * value, but you will not be able to set whether it is autoloaded. If you want\n * to set whether an option is autoloaded, then you need to use the add_option().\n *\n * @param string $option Option name. Expected to not be SQL-escaped.\n * @param mixed $value Option value. Must be serializable if non-scalar. Expected to not be SQL-escaped.\n * @return bool False if value was not updated and true if value was updated.\n */\nfunction update_option( $option, $value ) {\n\t$option = trim($option);\n\tif ( empty($option) )\n\t\treturn false;\n\n\tif ( is_object( $value ) )\n\t\t$value = clone $value;\n\n\t$old_value = get_option( $option );\n\n\t// If the new and old values are the same, no need to update.\n\tif ( $value === $old_value )\n\t\treturn false;\n\n\tif ( false === $old_value )\n\t\treturn add_option( $option, $value );\n\n\t$serialized_value = maybe_serialize( $value );\n\n\t$result = DB::update( DCRM_CON_PREFIX.'Options', array( 'option_value' => $serialized_value ), array( 'option_name' => $option ) );\n\tif ( ! $result )\n\t\treturn false;\n\n\treturn true;\n}\n/**\n * Add a new option.\n *\n * You do not need to serialize values. If the value needs to be serialized, then\n * it will be serialized before it is inserted into the database. Remember,\n * resources can not be serialized or added as an option.\n *\n * You can create options without values and then update the values later.\n * Existing options will not be updated and checks are performed to ensure that you\n * aren't adding a protected WordPress option. Care should be taken to not name\n * options the same as the ones which are protected.\n *\n * @param string         $option      Name of option to add. Expected to not be SQL-escaped.\n * @param mixed          $value       Optional. Option value. Must be serializable if non-scalar. Expected to not be SQL-escaped.\n * @param string         $deprecated  Optional. Description. Not used anymore.\n * @return bool False if option was not added and true if option was added.\n */\nfunction add_option( $option, $value = '', $deprecated = '') {\n\t$option = trim($option);\n\tif ( empty($option) )\n\t\treturn false;\n\n\tif ( is_object($value) )\n\t\t$value = clone $value;\n\n\t//$value = sanitize_option( $option, $value );\n\n\t$serialized_value = maybe_serialize( $value );\n\n\t$result = DB::query( DB::prepare( \"INSERT INTO `\".DCRM_CON_PREFIX.\"Options` (`option_name`, `option_value`) VALUES (%s, %s) ON DUPLICATE KEY UPDATE `option_name` = VALUES(`option_name`), `option_value` = VALUES(`option_value`)\", $option, $serialized_value) );\n\tif ( ! $result )\n\t\treturn false;\n\n\treturn true;\n}\n// Function link\nfunction randstr($len = 40) {\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _randstr($len);\n}\nfunction deldir($dir) {\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _deldir($dir);\n}\nfunction dirsize($dirName) {\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _dirsize($dirName);\n}\nfunction execInBackground($cmd) {\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _execInBackground(cmd);\n}\nfunction utf8_unicode($name){\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _utf8_unicode($name);\n}\nfunction TrimArray($input){\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _TrimArray($input);\n}\nfunction string_handle($input, $switch, $switch_string = 'cydia::commercial', $separator = ' '){\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _string_handle($input, $switch, $switch_string, $separator);\n}\nfunction check_commercial_tag($tag){\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _check_commercial_tag($tag);\n}\nfunction downFile($fileName, $fancyName = '', $forceDownload = true, $speedLimit = DCRM_SPEED_LIMIT, $contentType = '') {\n\trequire_once SYSTEM_ROOT.'./function/downfile.php';\n\treturn _downFile($fileName, $fancyName, $forceDownload, $speedLimit, $contentType);\n}\n?>\n"], "fixing_code": ["<?php\n/**\n * DCRM Commercial Package API\n * Copyright (c) 2015 Hintay <hintay@me.com>\n *\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n\nif(isset($_GET['action'])){\n\tswitch($_GET['action']){\n\t\t// \u652f\u4ed8\u5b9d\u8df3\u8f6c\n\t\tcase 'alipay_go':\n\t\t\t// XSS\u8fc7\u6ee4\n\t\t\tforeach($_GET as $key => $value){\n\t\t\t\t$clan_data[$key] = xss_clean($value);\n\t\t\t}\n?>\n<form id=\"alipay\" accept-charset=\"GBK\" method=\"POST\" action=\"https://shenghuo.alipay.com/send/payment/fill.htm\">\n\t<?php if(isset($_GET['optEmail'])): ?><input type=\"hidden\" value=\"<?php echo($clan_data['optEmail']); ?>\" name=\"optEmail\"><?php endif; ?>\n\t<?php if(isset($_GET['payAmount'])): ?><input type=\"hidden\" value=\"<?php echo($clan_data['payAmount']); ?>\" name=\"payAmount\"><?php endif; ?>\n\t<?php if(isset($_GET['title'])): ?><input id=\"title\" type=\"hidden\" value=\"<?php echo($clan_data['title']); ?>\" name=\"title\"><?php endif; ?>\n\t<?php if(isset($_GET['memo'])): ?><input name=\"memo\" type=\"hidden\" value=\"<?php echo($clan_data['memo']); ?>\" /><?php endif; ?>\n</form>\n<script type=\"text/javascript\">\nvar postForm = document.getElementById('alipay');\npostForm.method = \"post\" ;   \npostForm.action = 'https://shenghuo.alipay.com/send/payment/fill.htm' ;  \npostForm.submit();\n</script>\n<?php\n\t\t\texit();\n\t\t\tbreak;\n\t}\n}\n\nif (!isset($package_info)) {\n\tif(!isset($_GET['Package']))\n\t\texit();\n\n\trequire_once('system/common.inc.php');\n\tif(!isset($detect)){\n\t\tclass_loader('Mobile_Detect');\n\t\t$detect = new Mobile_Detect;\n\t}\n\t$package_info = DB::fetch_first(DB::prepare(\"SELECT `Package`, `Name`, `Tag`, `Level`, `Price`, `Purchase_Link` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `Package` = '%s' AND `Stat` = '1'\", $_GET['Package']));\n\tif(!$package_info)\n\t\texit();\n?>\n<!DOCTYPE html SYSTEM \"about:legacy-compat\">\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n<title>Activation \u00b7 Cydia</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"./css/menes.min.css\">\n<meta name=\"viewport\" content=\"width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n<meta name=\"format-detection\" content=\"telephone=no\">\n<script type=\"text/javascript\" src=\"./js/fastclick.js\"></script>\n<script type=\"text/javascript\" src=\"./js/cytyle.js\"></script>\n<script type=\"text/javascript\" src=\"./js/menes.js\"></script>\n</head>\n<body class=\"pinstripe\">\n<?php\n}\nif(check_commercial_tag($package_info['Tag'])):\n\t$nowip = _ip2long(getIp());\n\n\tif(isset($_GET['udid']))\n\t\t$udid_status = DB::fetch_first(DB::prepare(\"SELECT `Packages`, `Level`, `IP` FROM `\".DCRM_CON_PREFIX.\"UDID` WHERE `UDID` = '%s' LIMIT 1\", $_GET['udid']));\n\telse\n\t\t$udid_status = DB::fetch_first(\"SELECT `Packages`, `Level`, `IP` FROM `\".DCRM_CON_PREFIX.\"UDID` WHERE `IP` = '\".$nowip.\"' LIMIT 1\");\n\t$purchased = false;\n\tif(!empty($udid_status)){\n\t\tif(!empty($udid_status['Packages'])) {\n\t\t\t$udid_packages = TrimArray(explode(',', $udid_status['Packages']));\n\t\t\tif(in_array($package_info['Package'], $udid_packages, true))\n\t\t\t\t$purchased = true;\n\t\t} else {\n\t\t\t$udid_level = (int)$udid_status['Level'];\n\t\t\t$package_level = (int)$package_info['Level'];\n\t\t\tif($udid_level > $package_level)\n\t\t\t\t$purchased = true;\n\t\t}\n\t}\n\n\tif($purchased) {\n\t\t//$not_installed_button = 'null, null, null';\n\t\t$purchase_status = 'purchased';\n\t\t$fieldset_color = '#eefff0';\n\t\t$fieldset_icons = 'https://cache.saurik.com/crystal/256x256/actions/agt_action_success.png';\n\t\tif(empty($package_info['Price']))\n\t\t\t$purchase_status = 'candownload';\n\t} else {\n\t\t$fieldset_color = '#ffc040';\n\t\tif(!empty($package_info['Price'])):\n\t\t\t//$not_installed_button = '\"'.__('Purchase').'\", \"Highlighted\", function(){buy();}';\n\t\t\t$purchase_status = 'notpurchase';\n\t\t\t$fieldset_icons = 'https://cache.saurik.com/crystal/64x64/apps/kwallet.png';\n\t\telse:\n\t\t\t//$not_installed_button = '\"'.__('Recheck').'\", \"Highlighted\", function(){reload_();}';\n\t\t\t$purchase_status = 'protection';\n\t\t\t$fieldset_icons = 'https://cache.saurik.com/crystal/64x64/apps/alert.png';\n\t\tendif;\n\t}\n?>\n<panel>\n\t<fieldset style=\"background-color:<?php echo($fieldset_color); ?>\">\n\t\t<a target=\"_popup\" <?php if('notpurchase' == $purchase_status) echo('href=\"'.$package_info['Purchase_Link'].'\"'); ?>>\n\t\t\t<img class=\"icon\" src=\"<?php echo($fieldset_icons); ?>\">\n\t\t\t<div>\n\t\t\t\t<div>\n<?php \n\tswitch($purchase_status){\n\t\tcase 'notpurchase':\n?>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p><?php _e('Purchase Product'); ?></p>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"price\">\n\t\t\t\t\t\t<p><?php echo($package_info['Price']); ?></p>\n\t\t\t\t\t</label>\n<?php\n\t\t\tbreak;\n\t\tcase 'protection':\n?>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p><?php _e('Package Protected'); ?></p>\n\t\t\t\t\t</label>\n<?php\n\t\t\tbreak;\n\t\tcase 'purchased':\n?>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p><?php _e('Package Officially Purchased'); ?></p>\n\t\t\t\t\t</label>\n<?php\n\t\t\tbreak;\n\t\tcase 'candownload':\n?>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<p><?php _e('Allowed To Download'); ?></p>\n\t\t\t\t\t</label>\n<?php\n\t\t\tbreak;\n}\n?>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</a>\n\t</fieldset>\n</panel>\n<?php\nendif;\n?>", "<?php\n/**\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/* DCRM Mobile Page */\n\nrequire_once('system/common.inc.php');\n\nclass_loader('Mobile_Detect');\n$detect = new Mobile_Detect;\nif(!$detect->isiOS()){\n\tif (DCRM_PCINDEX == 2) {\n\t\theader('Location: misc.php');\n\t\texit();\n\t} else {\n\t\t$isCydia = false;\n\t}\n} else {\n\tif (DCRM_MOBILE == 2) {\n\t\tif (!strpos($detect->getUserAgent(), 'Cydia')) {\n\t\t\t$isCydia = false;\n\t\t} else {\n\t\t\t$isCydia = true;\n\t\t}\n\t} else {\n\t\texit('Access Denied');\t\n\t}\n}\nif (file_exists('Release')) {\n\t$release = file('Release');\n\t$release_origin = __('No Name');\n\t$release_mtime = filemtime('Release');\n\t$release_time = date('Y-m-d H:i:s',$release_mtime);\n\tforeach ($release as $line) {\n\t\tif(preg_match('#^Origin#', $line)) {\n\t\t\t$release_origin = trim(preg_replace(\"#^(.+):\\\\s*(.+)#\",\"$2\", $line));\n\t\t}\n\t\tif(preg_match(\"#^Description#\", $line)) {\n\t\t\t$release_description = trim(preg_replace(\"#^(.+):\\\\s*(.+)#\",\"$2\", $line));\n\t\t}\n\t}\n} else {\n\t$release_origin = __('Empty Page');\n}\nif (isset($_GET['pid'])) {\n\tif (ctype_digit($_GET['pid']) && intval($_GET['pid']) <= 10000) {\n\t\tif (isset($_GET['method']) && $_GET['method'] == 'screenshot') {\n\t\t\t$index = 2;\n\t\t\t$title = __('View Screenshots');\n\t\t} elseif (isset($_GET['method']) && $_GET['method'] == 'report') {\n\t\t\t$device_type = array('iPhone','iPod','iPad');\n\t\t\tfor ($i = 0; $i < count($device_type); $i++) {\n\t\t\t\t$check = $detect->version($device_type[$i]);\n\t\t\t\tif ($check !== false) {\n\t\t\t\t\tif (isset($_SERVER['HTTP_X_MACHINE'])) {\n\t\t\t\t\t\t$DEVICE = substr($_SERVER['HTTP_X_MACHINE'],0,-3);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$DEVICE = 'Unknown';\n\t\t\t\t\t}\n\t\t\t\t\t$OS = str_replace('_', '.', $check);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!isset($_GET['support'])) {\n\t\t\t\t$index = 3;\n\t\t\t} else {\n\t\t\t\tif ($_GET['support'] == '1') {\n\t\t\t\t\t$support = 1;\n\t\t\t\t} elseif ($_GET['support'] == '2') {\n\t\t\t\t\t$support = 2;\n\t\t\t\t} elseif ($_GET['support'] == '3') {\n\t\t\t\t\t$support = 3;\n\t\t\t\t} else {\n\t\t\t\t\t$support = 0;\n\t\t\t\t}\n\t\t\t\t$index = 4;\n\t\t\t}\n\t\t\t$title = __('Report Problems');\n\t\t} elseif (isset($_GET['method']) && $_GET['method'] == 'history') {\n\t\t\t$index = 5;\n\t\t\t$title = __('Version History');\n\t\t} elseif (isset($_GET['method']) && $_GET['method'] == 'contact') {\n\t\t\t$index = 6;\n\t\t\t$title = __('Contact us');\n\t\t} elseif (isset($_GET['method']) && $_GET['method'] == 'section') {\n\t\t\t$index = 7;\n\t\t\t$title = __('Package Category');\n\t\t} elseif (!isset($_GET['method']) || (isset($_GET['method']) && $_GET['method'] == 'view')) {\n\t\t\t$index = 1;\n\t\t\t$title = __('View Package');\n\t\t} else {\n\t\t\thttpinfo(405);\n\t\t\texit();\n\t\t}\n\t} else {\n\t\thttpinfo(405);\n\t\texit();\n\t}\n} elseif (!isset($_GET['method'])) {\n\t$index = 0;\n\t$title = $release_origin;\n} else {\n\thttpinfo(405);\n\texit();\n}\n?>\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n\t<head>\n\t\t<title><?php echo($title); ?></title>\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\t\t<meta name=\"apple-mobile-web-app-title\" content=\"<?php echo($release_origin); ?>\" />\n\t\t<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\" />\n\t\t<meta name=\"viewport\" content=\"minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no\" />\n\t\t<meta name=\"HandheldFriendly\" content=\"true\" />\n\t\t<meta name=\"format-detection\" content=\"telephone=no\" />\n\t\t<meta name=\"robots\" content=\"index, follow\" />\n<?php\nif (defined(\"AUTOFILL_SEO\")) {\n?>\n\t\t<meta name=\"title\" content=\"<?php echo(AUTOFILL_SEO); ?>\" />\n<?php\n}\nif (!empty($release_description)) {\n?>\n\t\t<meta name=\"description\" content=\"<?php echo($release_description); ?>\" />\n<?php\n}\nif (defined(\"AUTOFILL_KEYWORDS\")) {\n?>\n\t\t<meta name =\"keywords\" content=\"<?php echo(AUTOFILL_KEYWORDS); ?>\" />\n<?php\n}\nif ($isCydia) {\n?>\n\t\t<base target=\"_blank\">\n<?php\n} else {\n?>\n\t\t<base target=\"_top\">\n<?php\n}\n?>\n\t\t<link rel=\"apple-touch-icon\" href=\"CydiaIcon.png\">\n\t\t<link rel=\"shortcut icon\" href=\"favicon.ico\">\n\t\t<link rel=\"stylesheet\" href=\"css/menes.min.css\">\n\t\t<link rel=\"stylesheet\" href=\"css/scroll.min.css\">\n<?php if(is_rtl()){ ?>\t\t<link rel=\"stylesheet\" href=\"css/menes-rtl.min.css\"><?php } ?>\n<?php if(file_exists(ROOT.'css/font/'.($local_css = substr($locale, 0, 2)).'.css') || file_exists(ROOT.'css/font/' . ($local_css = $locale) . '.css')): ?>\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./css/font/<?php echo $local_css; ?>.css\"><?php echo(\"\\n\"); endif; ?>\n\t\t<script src=\"js/fastclick.js\" type=\"text/javascript\"></script>\n\t\t<script src=\"js/menes.js\" type=\"text/javascript\"></script>\n\t\t<script src=\"js/cytyle.js\" type=\"text/javascript\"></script>\n\t\t<script src=\"http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js\"></script>\n\t</head>\n\t<body class=\"pinstripe\">\n\t\t<panel>\n<?php\nif ($index == 0) {\n\tif (!$isCydia) {\n?>\n\t\t\t<fieldset>\n\t\t\t\t<a href=\"cydia://sources/add\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/cydia.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Add in Cydia<sup><small>\u00e2\u201e\u02d8</small></sup>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t}\n\t$repo_url = base64_decode(DCRM_REPOURL);\n?>\n\t\t\t<fieldset>\n\t\t\t\t<div>\n\t\t\t\t\t<div style=\"float: right; vertical-align: middle; text-align: center; width: 200px\">\n\t\t\t\t\t\t<span style=\"font-size: 24px\">\n\t\t\t\t\t\t\t<?php echo($release_origin); ?>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<br/>\n\t\t\t\t\t\t<span style=\"font-size: 16px\">\n\t\t\t\t\t\t\t<a class=\"panel\" href=\"<?php echo(AUTOFILL_SITE); ?>\"><?php echo(AUTOFILL_FULLNAME); ?></a>\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t<a class=\"panel\" href=\"mailto:<?php echo(AUTOFILL_EMAIL); ?>\"><?php echo(AUTOFILL_EMAIL); ?></a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img class=\"icon\" src=\"CydiaIcon.png\" style=\"width:64px; height:64px; vertical-align: top;\" />\n\t\t\t\t\t<hr />\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php _e('Add this URL via Cydia<sup><small>\u00e2\u201e\u02d8</small></sup>: '); ?>\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<strong><a href=\"<?php echo($repo_url); ?>\"><?php echo($repo_url); ?></a></strong>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t$q_info = DB::query(\"SELECT count(*) FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `Stat` = '1'\");\n\t$info = mysql_fetch_row($q_info);\n\t$num = (int)$info[0];\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php printf( __( '<strong>%d</strong> packages in total.' ) , $num ); ?> \n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<?php printf( __( 'Last updated: <strong>%s</strong>' ) , $release_time ); ?> \n\t\t\t\t</p>\n\t\t\t</block>\n\t\t\t<fieldset>\n<?php\n\tif (defined(\"AUTOFILL_SITE\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_SITE); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"CydiaIcon.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Visit Home Page'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a><?php\n\t}\n\tif (defined(\"AUTOFILL_EMAIL\")) {\n?>\n\t\t\t\t<a href=\"mailto:<?php echo(AUTOFILL_EMAIL); ?>?subject=<?php echo($release_origin); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Contact us'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_TENCENT\") && defined(\"AUTOFILL_TENCENT_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_TENCENT); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/qq.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo(AUTOFILL_TENCENT_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_WEIBO\") && defined(\"AUTOFILL_WEIBO_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_WEIBO); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/weibo.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_WEIBO_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_TWITTER\") && defined(\"AUTOFILL_TWITTER_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_TWITTER); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/twitter.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_TWITTER_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_FACEBOOK\") && defined(\"AUTOFILL_FACEBOOK_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_FACEBOOK); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/facebook.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_FACEBOOK_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_PAYPAL\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_PAYPAL); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/paypal.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Donate via <span style=\"font-style: italic; font-weight: bold\"><span style=\"color: #1a3665\">Pay</span><span style=\"color: #32689a\">Pal</span><sup><small>\u00e2\u201e\u02d8</small></sup></span>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n\tif (defined(\"AUTOFILL_ALIPAY\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_ALIPAY); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/alipay.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Donate via <span style=\"font-style: italic; font-weight: bold\"><img class=\"alipay\" src=\"icons/default/alipay_text_en.png\" /><sup><small >\u00e2\u201e\u02d8</small></sup></span>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t}\n?>\n\n\t\t\t</fieldset>\n<?php\n\tif (DCRM_SHOWLIST == 2) {\n\t\t$section_query = DB::query(\"SELECT `ID`, `Name`, `Icon` FROM `\".DCRM_CON_PREFIX.\"Sections`\");\n\t\tif (!$section_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t} else {\n\t\t\twhile ($section_assoc = mysql_fetch_assoc($section_query)) {\n?>\n\t\t\t<label><p><?php echo($section_assoc['Name']); ?></p></label>\n\t\t\t<fieldset>\n<?php\n\t\t\t\t$package_query = DB::query(\"SELECT `ID`, `Name`, `Package` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE (`Stat` = '1' AND `Section` = '\".DB::real_escape_string($section_assoc['Name']).\"') ORDER BY `ID` DESC LIMIT \" . DCRM_SHOW_NUM);\n\t\t\t\twhile ($package_assoc = mysql_fetch_assoc($package_query)) {\n\t\t\t\t\tif ($isCydia) {\n?>\n\t\t\t\t<a href=\"cydia://package/<?php echo($package_assoc['Package']); ?>\" target=\"_blank\">\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($package_assoc['ID']); ?>\">\n<?php\n\t\t\t\t\t}\n\t\t\t\t\tif (!empty($section_assoc['Icon'])) {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/<?php echo($section_assoc['Icon']); ?>\" />\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/unknown.png\" />\n<?php\n\t\t\t\t\t}\n?>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo($package_assoc['Name']); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t\t\t}\n\t\t\t\tif (DCRM_ALLOW_FULLLIST == 2) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($section_assoc['ID']); ?>&amp;method=section\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/moreinfo.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('More...'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (DCRM_ALLOW_FULLLIST == 2) {\n\t\t\t$section_query = DB::query(\"SELECT `ID`, `Name`, `Icon` FROM `\".DCRM_CON_PREFIX.\"Sections`\");\n\t\t\tif (!$section_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t\t} else {\n?>\n\t\t\t<label><?php _e('Package Category'); ?></label>\n\t\t\t<fieldset>\n<?php\n\t\t\t\twhile ($section_assoc = mysql_fetch_assoc($section_query)) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($section_assoc['ID']); ?>&amp;method=section\">\n<?php\n\t\t\t\t\tif (!empty($section_assoc['Icon'])) {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/<?php echo($section_assoc['Icon']); ?>\" />\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/unknown.png\" />\n<?php\n\t\t\t\t\t}\n?>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo($section_assoc['Name']); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t}\n\t}\n\tif (!$isCydia) {\n?>\n\t\t\t<label class=\"source\">\n\t\t\t\t<p><?php _e('Source Info'); ?></p>\n\t\t\t</label>\n\t\t\t<fieldset class=\"source\">\n\t\t\t\t<a href=\"/\">\n\t\t\t\t\t<img class=\"icon\" src=\"CydiaIcon.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p id=\"source-name\">\n\t\t\t\t\t\t\t\t\t<?php echo($release_origin); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t\t<div class=\"source-description\" id=\"source-description\">\n\t\t\t\t\t<p><?php echo($release_description); ?></p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n\t\t\t<footer id=\"footer\" style=\"display: none;\">\n\t\t\t\t<p>\n\t\t\t\t\t<span id=\"id\"><?php _e('Index'); ?></span>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span class=\"source-name\"><?php echo( defined(\"AUTOFILL_FOOTER_NAME\") ? htmlspecialchars(stripslashes(AUTOFILL_FOOTER_NAME)) : $release_origin ); ?></span>\u00c2\u00b7\n\t\t\t\t\t<span id=\"section\"><?php printf( __( 'Copyright &copy; %s' ) , defined(\"AUTOFILL_FOOTER_YEAR\") ? htmlspecialchars(stripslashes(AUTOFILL_FOOTER_YEAR)).'-'.date(\"Y\") : date(\"Y\") ); ?></span>\n\t\t\t\t\t<?php if(defined(\"AUTOFILL_FOOTER_CODE\")){ ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span id=\"code\"><?php echo(stripslashes(AUTOFILL_FOOTER_CODE));?></span>\n\t\t\t\t\t<?php } ?>\n\t\t\t\t</p>\n\t\t\t</footer>\n<?php\n\t}\n} elseif ($index == 1) {\n\t\t$pkg = (int)DB::real_escape_string($_GET['pid']);\n\t\t$pkg_assoc = DB::fetch_first(\"SELECT `Name`, `Version`, `Author`, `Package`, `Description`, `DownloadTimes`, `Multi`, `CreateStamp`, `Size`, `Installed-Size`, `Section`, `Homepage`, `Tag`, `Level`, `Price`, `Purchase_Link`  FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `ID` = '\".$pkg.\"' LIMIT 1\");\n\tif (!$pkg_assoc) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('Invalid package!<br />Perhaps this package has been deleted by us.'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t} else {\n\t\tif (!$isCydia) {\n?>\n\t\t\t<fieldset id=\"cydialink\" style=\"display: none;\">\n\t\t\t\t<a href=\"cydia://package/<?php echo($pkg_assoc['Package']); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/cydia.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('View in Cydia<sup><small>\u00e2\u201e\u02d8</small></sup>'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t\tif (!empty($pkg_assoc['Section'])) {\n\t\t\t\t$section_icon = DB::result_first(\"SELECT `Icon` FROM `\".DCRM_CON_PREFIX.\"Sections` WHERE `Name` = '\".$pkg_assoc['Section'].\"' LIMIT 1\");\n\t\t\t}\n?>\n\t\t\t<div id=\"header\" style=\"display: none;\">\n<?php\n\t\t\tif (!empty($section_icon)) {\n?>\n\t\t\t\t<img class=\"icon\" src=\"icons/<?php echo($section_icon); ?>\" style=\"width: 64px; height: 64px; vertical-align: top;\" />\n<?php\n\t\t\t} else {\n?>\n\t\t\t\t<img class=\"icon\" src=\"icons/default/unknown.png\" style=\"width: 64px; height: 64px; vertical-align: top;\" />\n<?php\n\t\t\t}\n?>\n\t\t\t\t<div id=\"content\">\n\t\t\t\t\t<p id=\"name\"><?php echo($pkg_assoc['Name']); ?></p>\n\t\t\t\t\t<p id=\"latest\"><?php echo($pkg_assoc['Version']); ?></p>\n\t\t\t\t\t<div id=\"extra\">\n\t\t\t\t\t\t<p><?php if(!empty($pkg_assoc['Installed-Size'])){echo(sizeext($pkg_assoc['Installed-Size'] * 1024));} ?></p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n<?php\n\t\t\tif (!empty($pkg_assoc['Author'])) {\n\t\t\t\t$author_name = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$1\", $pkg_assoc['Author']));\n\t\t\t\t$author_mail = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$2\", $pkg_assoc['Author']));\n\t\t\t}\n?>\n\t\t\t<fieldset id=\"contact\" style=\"display: none;\">\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=contact\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Author'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t\t<p id=\"contact\">\n\t\t\t\t\t\t\t\t\t\t<?php echo($author_name); ?>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t}\n\t\tif (DCRM_DIRECT_DOWN == 1 && !$isCydia && !check_commercial_tag($pkg_assoc['Tag'])) {\n?>\n\t\t\t<fieldset>\n\t\t\t\t<a href=\"debs/<?php echo($_GET['pid']); ?>.deb\" id=\"downloadlink\" style=\"display: none;\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/packages.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Download'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<?php if(!empty($pkg_assoc['Size'])){echo(sizeext($pkg_assoc['Size']));} ?>\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t}\n\t\t$package_info = $pkg_assoc;\n\t\trequire_once('commercial.php');\n?>\n\t\t\t<fieldset>\n<?php\n\t\tif (DCRM_SCREENSHOTS == 2) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=screenshot\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/screenshots.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('View Screenshots'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=history\" id=\"historylink\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/changelog.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Version History'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\tif ($isCydia && DCRM_REPORTING == 2) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report\" id=\"reportlink\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/report.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Report Problems'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_TENCENT\") && defined(\"AUTOFILL_TENCENT_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_TENCENT); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/qq.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo(AUTOFILL_TENCENT_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_WEIBO\") && defined(\"AUTOFILL_WEIBO_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_WEIBO); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/weibo.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_WEIBO_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_TWITTER\") && defined(\"AUTOFILL_TWITTER_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_TWITTER); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/twitter.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_TWITTER_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_FACEBOOK\") && defined(\"AUTOFILL_FACEBOOK_NAME\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_FACEBOOK); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/facebook.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>@<?php echo(AUTOFILL_FACEBOOK_NAME); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_PAYPAL\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_PAYPAL); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/paypal.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Donate via <span style=\"font-style: italic; font-weight: bold\"><span style=\"color: #1a3665\">Pay</span><span style=\"color: #32689a\">Pal</span><sup><small>\u00e2\u201e\u02d8</small></sup></span>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_ALIPAY\")) {\n?>\n\t\t\t\t<a href=\"<?php echo(AUTOFILL_ALIPAY); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/alipay.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Donate via <span style=\"font-style: italic; font-weight: bold\"><img class=\"alipay\" src=\"icons/default/alipay_text_en.png\" /><sup><small >\u00e2\u201e\u02d8</small></sup></span>'); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (!empty($pkg_assoc['Homepage']) && DCRM_MOREINFO == 2) {\n?>\n\t\t\t\t<a href=\"<?php echo($pkg_assoc['Homepage']); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/web.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('More Info'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n\t\tif (defined(\"EMERGENCY\")) {\n?>\n\t\t\t\t<a>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<?php echo(EMERGENCY); ?>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t\tif (defined(\"AUTOFILL_ADVERTISEMENT\") && $isCydia) {\n?>\n\t\t\t<block id=\"advertisement\">\n\t\t\t\t<div style=\"position: relative; text-align: center;\">\n\t\t\t\t\t<div style=\"position: absolute; right: 10px; top: 2px;\">\n\t\t\t\t\t\t<img src=\"css/closebox@2x.png\" style=\"width: 30px; height: 29px;\" onclick=\"hide()\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<?php echo(AUTOFILL_ADVERTISEMENT); ?>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</block>\n<?php\t\n\t\t}\n?>\n\t\t\t<block>\n<?php\n\t\tif (DCRM_MOREINFO == 2) {\n?>\n\t\t\t\t\t<p><?php _e('Version'); ?> <strong><?php echo($pkg_assoc['Version']); ?></strong> | <?php _e('Downloads'); ?> <strong><?php echo($pkg_assoc['DownloadTimes']); ?></strong></p>\n\t\t\t\t\t<p><?php _e('Last Updated'); ?> <strong><?php echo($pkg_assoc['CreateStamp']); ?></strong></p>\n\t\t\t\t\t<hr />\n<?php\n\t\t}\n?>\n\t\t\t\t\t<p><?php echo(nl2br($pkg_assoc['Description'])); ?></p>\n\t\t\t</block>\n<?php\n\t\tif (!empty($pkg_assoc['Multi']) && DCRM_MULTIINFO == 2) {\n?>\n\t\t\t<fieldset>\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php echo($pkg_assoc['Multi']); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t\t}\n\t\tif (defined(\"AUTOFILL_DUOSHUO_KEY\")) {\n?>\n\t\t\t<fieldset>\n\t\t\t\t<div id=\"foldcomments\">\n\t\t\t\t\t<p style=\"height: 21px;\"><span class=\"cmsswitch\"><?php _e('Fold Comments'); ?></span></p>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"comments\">\n\t\t\t\t\t<div class=\"ds-thread\" data-thread-key=\"<?php echo($pkg_assoc['Package']); ?>\" data-title=\"<?php echo($pkg_assoc['Name']); ?>\" data-url=\"<?php echo('http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']); ?>\"></div>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n\t\t\t<script type=\"text/javascript\">\n\t\t\tvar duoshuoQuery = {short_name:\"<?php echo(AUTOFILL_DUOSHUO_KEY); ?>\"};\n\t\t\t(function() {\n\t\t\t\tvar ds = document.createElement('script');\n\t\t\t\tds.type = 'text/javascript';ds.async = true;\n\t\t\t\tds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';\n\t\t\t\tds.charset = 'UTF-8';\n\t\t\t\t(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);\n\t\t\t})();\n\n\t\t\t$(document).ready(function(){\n\t\t\t\tvar comments = $(\"#comments\");\n\t\t\t\tvar cmsswitch = $(\".cmsswitch\");\n\t\t\t\t$(\"#foldcomments\").click(function(){\n\t\t\t\t\tcmsswitch.fadeOut(400);\n\t\t\t\t\tif(comments.css(\"display\")==\"none\"){\n\t\t\t\t\t\tcomments.slideDown(800);\n\t\t\t\t\t\tsetTimeout(function(){cmsswitch.html('<?php _e('Fold Comments'); ?>').fadeIn(400);}, 400);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomments.slideUp(800);\n\t\t\t\t\t\tsetTimeout(function(){cmsswitch.html('<?php _e('Unfold Comments'); ?>').fadeIn(400);}, 400);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t</script>\n<?php\n\t\t}\n?>\n\t\t\t<label class=\"source\">\n\t\t\t\t<p><?php _e('Source Info'); ?></p>\n\t\t\t</label>\n\t\t\t<fieldset class=\"source\">\n\t\t\t\t<a href=\"/\">\n\t\t\t\t\t<img class=\"icon\" src=\"CydiaIcon.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p id=\"source-name\">\n\t\t\t\t\t\t\t\t\t<?php echo($release_origin); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t\t<div class=\"source-description\" id=\"source-description\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php echo($release_description); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t\tif (!$isCydia) {\n?>\n\t\t\t<footer id=\"footer\" style=\"display: none;\">\n\t\t\t\t<p>\n\t\t\t\t\t<span id=\"id\"><?php echo($pkg_assoc['Package']); ?></span>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span class=\"source-name\"><?php echo($release_origin); ?></span>\u00c2\u00b7\n\t\t\t\t\t<span id=\"section\"><?php echo($pkg_assoc['Section']); ?></span>\n\t\t\t\t\t<?php if(defined(\"AUTOFILL_FOOTER_CODE\")){ ?>\n\t\t\t\t\t<br />\n\t\t\t\t\t<span id=\"code\"><?php echo(stripslashes(AUTOFILL_FOOTER_CODE));?></span>\n\t\t\t\t\t<?php } ?>\n\t\t\t\t</p>\n\t\t\t</footer>\n<?php\n\t\t}\n\t}\n} elseif ($index == 2) {\n\tif (DCRM_SCREENSHOTS == 2) {\n\t\t$pkg = (int)DB::real_escape_string($_GET['pid']);\n\t\t$pkg_query = DB::query(\"SELECT `PID`, `Image` FROM `\".DCRM_CON_PREFIX.\"ScreenShots` WHERE `PID` = '\".$pkg.\"'\");\n\t\tif (!$pkg_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t} else {\n\t\t\t$num = mysql_affected_rows();\n\t\t\tif ($num != 0) {\n\t\t\t\t$preview = array();\n\t\t\t\t$i = 0;\n\t\t\t\twhile ($pkg_assoc = mysql_fetch_assoc($pkg_query)) {\n\t\t\t\t\t$preview[$i] = $pkg_assoc['Image'];\n\t\t\t\t\t$i++;\n\t\t\t\t}\n?>\n\t\t\t<!--label><?php _e('View Screenshots'); ?></label-->\n\t\t\t<div class=\"horizontal-scroll-wrapper\" style=\"background: transparent; position: relative;\">\n\t\t\t\t<div class=\"horizontal-scroll-wrapper\" style=\"background: transparent url(<?php echo($preview[0]); ?>); background-size: 150%; background-position: center; -webkit-filter: blur(5px); position: absolute; z-index: 1;\"></div>\n\t\t\t\t<div class=\"horizontal-scroll-wrapper\" id=\"scroller\" style=\"background: transparent; position: absolute; z-index: 2;\">\n\t\t\t\t\t<div class=\"horizontal-scroll-area\" style=\"width:<?php echo($num * 240); ?>px;\">\n<?php\n\t\t\t\tfor ($t = 0; $t < count($preview); $t++) {\n?>\n\t\t\t\t\t\t<img src=\"<?php echo($preview[$t]); ?>\" />\n<?php\n\t\t\t\t}\n?>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"horizontal-scroll-pips\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n<?php\n\t\t\t} else {\n?>\n\t\t\t<label><?php _e('No screenshots now.'); ?></label>\n<?php\n\t\t\t}\n\t\t}\n\t} else {\n?>\n\t\t\t<label><?php printf( __( 'The %s function is disabled.' ) , __('View Screenshots') ); ?></label>\n<?php\n\t}\n} elseif ($index == 3) {\n?>\n\t\t\t<label><?php _e('Device Info'); ?></label>\n<?php\n\tif (DCRM_REPORTING == 2) {\n\t\t$q_count = DB::query(\"SELECT `Support`, COUNT(*) AS 'num' FROM `\".DCRM_CON_PREFIX.\"Reports` WHERE (`Device` = '\".$DEVICE.\"' AND `iOS` = '\".$OS.\"' AND `PID` = '\".$_GET['pid'].\"') GROUP BY `Support`\");\n\t\tif (mysql_affected_rows() > 0) {\n\t\t\twhile ($s_count = mysql_fetch_assoc($q_count)) {\n\t\t\t\tswitch ($s_count['Support']) {\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\t$s_1 = \" (\".$s_count['num'].\")\";\n\t\t\t\t\t\t$i_1 = $s_count['num'];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\t$s_2 = \" (\".$s_count['num'].\")\";\n\t\t\t\t\t\t$i_2 = $s_count['num'];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\t$s_0 = \" (\".$s_count['num'].\")\";\n\t\t\t\t\t\t$i_0 = $s_count['num'];\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$check_int = $i_1 * 3 + $i_2 - $i_0 * 2;\n\t\tif ($check_int >= 10) {\n?>\n\t\t\t<fieldset style=\"background-color: #ccffcc;\">\n<?php\n\t\t} elseif ($check_int <= -6) {\n?>\n\t\t\t<fieldset style=\"background-color: #ffdddd;\">\n<?php\n\t\t} else {\n?>\n\t\t\t<fieldset>\n<?php\n\t\t}\n?>\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong><?php _e('Current Device Info'); ?></strong>\n\t\t\t\t\t</p>\n\t\t\t\t\t<hr />\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php echo($DEVICE.\" &amp; \".$OS); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n\t\t\t<label><?php _e('Submit Your Request'); ?></label>\n\t\t\t<fieldset>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report&amp;support=3\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/support_3.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Request for updating'); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n\t\t\t<label><?php _e('Compatibility Reports'); ?></label>\n\t\t\t<fieldset>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report&amp;support=1\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/support_1.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Fully Compatibile'); ?><?php echo($s_1); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report&amp;support=0\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/support_0.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Partly Compatibile'); ?><?php echo($s_0); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($_GET['pid']); ?>&amp;method=report&amp;support=2\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/support_2.png\" />\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php _e('Not Compatibile'); ?><?php echo($s_2); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n\t\t\t<fieldset>\n\t\t\t\t<div>\n\t\t\t\t\t<?php _e('<p><strong>The software package compatibility report is voted by the majority of users, and we generated these statistical data, for reference only.</strong></p><hr /><p>If you have compatibility issues after installation, your vote, may be able to help tens of thousands of users from safe mode and many other threats.</p>'); ?>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t} else {\n?>\n\t\t\t<label><?php printf( __( 'The %s function is disabled.' ) , __('Report Problems') ); ?></label>\n<?php\n\t}\n} elseif ($index == 4) {\n\tif (DCRM_REPORTING == 2) {\n\t\t$result = DB::query(\"SELECT `ID` FROM `\".DCRM_CON_PREFIX.\"Reports` WHERE (`Remote` = '\".DB::real_escape_string($_SERVER['REMOTE_ADDR']).\"' AND `PID`='\".$_GET['pid'].\"') LIMIT 3\");\n\t\tif (mysql_affected_rows() < DCRM_REPORT_LIMIT) {\n\t\t\tif (!empty($_SERVER['REMOTE_ADDR']) && !empty($DEVICE) && !empty($OS) && $isCydia) {\n\t\t\t\t$result = DB::query(\"INSERT INTO `\".DCRM_CON_PREFIX.\"Reports`(`Remote`, `Device`, `iOS`, `Support`, `TimeStamp`, `PID`) VALUES('\".DB::real_escape_string($_SERVER['REMOTE_ADDR']).\"', '\".$DEVICE.\"', '\".$OS.\"', '\".$support.\"', '\".date('Y-m-d H:i:s').\"', '\".(int)$_GET['pid'].\"')\");\n?>\n\t\t\t<fieldset style=\"background-color: #ccffcc;\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t<?php _e('Your report has been submitted.<br />Thanks for your support!'); ?>\n\t\t\t\t\t\t</strong>\n\t\t\t\t\t</p>\n<?php\n\t\t\t} else {\n?>\n\t\t\t<fieldset style=\"background-color: #ffdddd;\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t<?php _e('Please use Cydia to vote.<br />Each device is limited to vote for 2 times!'); ?>\n\t\t\t\t\t\t</strong>\n\t\t\t\t\t</p>\n<?php\n\t\t\t}\n\t\t} else {\n?>\n\t\t\t<fieldset style=\"background-color: #ffdddd;\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t<?php _e('You have reached the voting limit.'); ?>\n\t\t\t\t\t\t</strong>\n\t\t\t\t\t</p>\n<?php\n\t\t}\n?>\n\t\t\t\t</div>\n\t\t\t</fieldset>\n<?php\n\t} else {\n?>\n\t\t\t<label><?php printf( __( 'The %s function is disabled.' ) , __('Report Problems') ); ?></label>\n<?php\n\t}\n} elseif ($index == 5) {\n\t$history_query = DB::query(\"SELECT `ID`, `Version` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `Package` = (SELECT `Package` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `ID` = '\".(int)$_GET['pid'].\"' LIMIT 1) ORDER BY `ID` DESC LIMIT 1,20\");\n\tif (mysql_affected_rows() > 0) {\n?>\n\t\t\t<label><?php _e('Version History'); ?></label>\n\t\t\t<fieldset>\n<?php\n\t\twhile ($history = mysql_fetch_assoc($history_query)) {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($history['ID']); ?>&amp;addr=nohistory\">\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/changelog.png\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t<?php _e('Version'); ?> <?php echo($history['Version']); ?>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t} else {\n?>\n\t\t\t<label><?php _e('No version history now.'); ?></label>\n\t\t\t<br />\n<?php\n\t}\n} elseif ($index == 6) {\n\t\t$pkg = (int)DB::real_escape_string($_GET['pid']);\n\t\t$pkg_query = DB::query(\"SELECT `Name`, `Version`, `Author`, `Sponsor`, `Maintainer` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE `ID` = '\".$pkg.\"' LIMIT 1\");\n\tif (!$pkg_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t} else {\n\t\t$pkg_assoc = mysql_fetch_assoc($pkg_query);\n\t\tif (!$pkg_assoc) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('Invalid package!<br />Perhaps this package has been deleted by us.'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t} else {\n\t\t\tif (!empty($pkg_assoc['Author'])) {\n\t\t\t\t$author_name = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$1\", $pkg_assoc['Author']));\n\t\t\t\t$author_mail = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$2\", $pkg_assoc['Author']));\n?>\n\t\t\t<fieldset class=\"author\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php _e('Source manager can <strong>NOT</strong> solve the function problem of package: you <strong>MUST</strong> contact the author.'); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<a href=\"mailto:<?php echo($author_mail); ?>?subject=<?php echo(urlencode(\"Cydia/APT(A): \".$pkg_assoc['Name'].\" (\".$pkg_assoc['Version'].\")\")); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label><p><?php _e('Author'); ?></p></label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t<p><?php echo($author_name); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t\tif (!empty($pkg_assoc['Sponsor'])) {\n\t\t\t\t$sponsor_name = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$1\", $pkg_assoc['Sponsor']));\n\t\t\t\t$sponsor_url = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$2\", $pkg_assoc['Sponsor']));\n?>\n\t\t\t<fieldset class=\"maintainer\">\n\t\t\t\t<div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<?php _e('If the package is a commercial package, you can contact the sponsor to obtain commercial support.'); ?>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<a href=\"<?php echo($sponsor_url); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label><p><?php _e('Sponsor'); ?></p></label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t<p><?php echo($sponsor_name); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t\tif (!empty($pkg_assoc['Maintainer'])) {\n\t\t\t\t$maintainer_name = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$1\", $pkg_assoc['Maintainer']));\n\t\t\t\t$maintainer_mail = trim(preg_replace(\"#^(.+)<(.+)>#\",\"$2\", $pkg_assoc['Maintainer']));\n?>\n\t\t\t<fieldset class=\"maintainer\">\n\t\t\t\t<div>\n\t\t\t\t\t<p><?php _e('If you have questions when install or uninstall this package, please contact the maintainer.'); ?></p>\n\t\t\t\t</div>\n\t\t\t\t<a href=\"mailto:<?php echo($maintainer_mail); ?>?subject=<?php echo(urlencode(\"Cydia/APT(A): \".$pkg_assoc['Name'].\" (\".$pkg_assoc['Version'].\")\")); ?>\" target=\"_blank\">\n\t\t\t\t<img class=\"icon\" src=\"icons/default/email.png\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label><p><?php _e('Maintainer'); ?></p></label>\n\t\t\t\t\t\t\t<label class=\"detail\">\n\t\t\t\t\t\t\t\t<p><?php echo($maintainer_name); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t}\n\t}\n} elseif ($index == 7) {\n\tif (DCRM_ALLOW_FULLLIST == 2) {\n\t\t$section_query = DB::query(\"SELECT `Name`, `Icon`, `TimeStamp` FROM `\".DCRM_CON_PREFIX.\"Sections` WHERE `ID` = '\".(int)$_GET['pid'].\"'\");\n\t\tif (!$section_query) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('MySQL Error!'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t} else {\n\t\t\t$section_assoc = mysql_fetch_assoc($section_query);\n\t\t\tif (!$section_assoc) {\n?>\n\t\t\t<block>\n\t\t\t\t<p>\n\t\t\t\t\t<?php _e('Invalid section!<br />Perhaps this section has been deleted by us.'); ?>\n\t\t\t\t</p>\n\t\t\t</block>\n<?php\n\t\t\t} else {\n?>\n\t\t\t<label><p><?php echo($section_assoc['Name']); ?></p></label>\n<?php\n\t\t\t\t$package_query = DB::query(\"SELECT `ID`, `Name`, `Package` FROM `\".DCRM_CON_PREFIX.\"Packages` WHERE (`Stat` = '1' AND `Section` = '\".DB::real_escape_string($section_assoc['Name']).\"') ORDER BY `ID` DESC\");\n\t\t\t\t$s_num = mysql_affected_rows();\n?>\n\t\t\t<block>\n\t\t\t\t\t<p><?php printf( __( '<strong>%s</strong> packages in this section.' ) , $s_num ); ?></p>\n\t\t\t\t\t<p><?php printf( __( 'Create time: <strong>%s</strong>' ) , $section_assoc['TimeStamp'] ); ?></strong></p>\n\t\t\t</block>\n\t\t\t<fieldset>\n<?php\n\t\t\t\twhile ($package_assoc = mysql_fetch_assoc($package_query)) {\n\t\t\t\t\tif ($isCydia) {\n?>\n\t\t\t\t<a href=\"cydia://package/<?php echo($package_assoc['Package']); ?>\" target=\"_blank\">\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t<a href=\"index.php?pid=<?php echo($package_assoc['ID']); ?>\">\n<?php\n\t\t\t\t\t}\n\t\t\t\t\tif (!empty($section_assoc['Icon'])) {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/<?php echo($section_assoc['Icon']); ?>\">\n<?php\n\t\t\t\t\t} else {\n?>\n\t\t\t\t\t<img class=\"icon\" src=\"icons/default/unknown.png\">\n<?php\n\t\t\t\t\t}\n?>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t<p><?php echo($package_assoc['Name']); ?></p>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n<?php\n\t\t\t\t}\n?>\n\t\t\t</fieldset>\n<?php\n\t\t\t}\n\t\t}\n\t} else {\n?>\n\t\t\t<label><?php printf( __( 'The %s function is disabled.' ) , __('Package Category') ); ?></label>\n<?php\n\t}\n}\n?>\n\t\t</panel>\n<?php\nif ($index == 2) {\n?>\n\t\t<script src=\"js/scroll.js\" type=\"text/javascript\"></script>\n<?php\n}\n?>\n\t\t<script src=\"js/main.js\" type=\"text/javascript\"></script>\n<?php\nif (defined(\"AUTOFILL_STATISTICS\")) {\n?>\n\t\t<div style=\"text-align: center; display: none;\">\n\t\t\t<?php echo(AUTOFILL_STATISTICS); ?>\n\t\t</div>\n<?php\n}\n?>\n\t</body>\n</html>\n", "<?php\n/**\n * DCRM Installer Functions\n * Copyright (c) 2015 Hintay <hintay@me.com>\n *\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n// \u8bbe\u5b9a\u53c2\u6570\ndefine('ABSPATH', dirname(dirname(__FILE__)).'/');\ndefine('CONF_PATH', ABSPATH.'system/config/');\ndefine('VERSION', '1.6.15.3.18');\n\n// \u9519\u8bef\u6291\u5236\ndefine('DEBUG_ENABLED', isset($_GET['debug']));\nerror_reporting(DEBUG_ENABLED ? E_ALL & !E_NOTICE & !E_STRICT : E_ERROR | E_PARSE);\n@ini_set('display_errors', DEBUG_ENABLED);\n\n/* \u8f7d\u5165\u8bed\u8a00 */\n$localetype = 'install';\ninclude_once ABSPATH . 'system/languages/l10n.php';\n$step_language = localization_load();\n\n/**\n * \u73af\u5883\u68c0\u67e5\n */\nfunction check_env(&$result)\n{\n\t$env_vars = array();\n\n\t/// \u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\n\t$env_vars['php_os'] = array('required' => __( 'No Limit' ) , 'best' => __( 'Unix-like' ), 'curr' => PHP_OS, 'state' => true);\n\n\t/// \u68c0\u67e5php\u7248\u672c\n\t$env_vars['php_vers'] = array('required' => '5.3', 'best' => '5.3', 'curr' => PHP_VERSION);\n\tif ((int)$env_vars['php_vers']['required'] > (int)$env_vars['php_vers']['curr']) {\n\t\t$env_vars['php_vers']['state'] = false;\n\t\t$result = false;\n\t} else {\n\t\t$env_vars['php_vers']['state'] = true;\n\t}\n\n\t/// \u68c0\u67e5\u4e0a\u4f20\u9644\u4ef6\u5927\u5c0f\n\t/*\n\t$env_vars['upload'] = array('required' => '1M', 'best' => '2M', 'curr' => ini_get('upload_max_filesize'));\n\t$u = substr($env_vars['upload']['curr'], -1, 1);\n\t$max_upload = $u == 'M' ? (int)$env_vars['upload']['curr'] : ($u == 'K' ? (int)$env_vars['upload']['curr'] / 1024 : (int)$env_vars['upload']['curr'] / (1024 * 1024));\n\tif ((int)$env_vars['upload']['required'] > $max_upload) {\n\t\t$env_vars['upload']['state'] = false;\n\t\t$result = false;\n\t} else {\n\t\t$env_vars['upload']['state'] = true;\n\t}\n\t */\n\n\t/// \u68c0\u67e5gd\u5e93\u7248\u672c\n\tif (dcrm_function_exists('gd_info')) {\n\t\t$gd_info = gd_info();\n\t} else {\n\t\t$gd_info['GD Version'] = __( 'The GD module cannot be loaded' );\n\t}\n\t$env_vars['gd_vers'] = array('required' => __( 'No Limit' ) , 'best' => '2.0', 'curr' => $gd_info['GD Version']);\n\t$match = array();\n\tpreg_match('/\\d/', $env_vars['gd_vers']['curr'], $match);\n\t$gd_vers = $match[0];\n\t$env_vars['gd_vers']['state'] = true;\n\n\t/// \u68c0\u67e5\u53ef\u7528\u78c1\u76d8\u7a7a\u95f4\n\t$env_vars['disk'] = array('required' => '10M', 'best' => __( 'No Limit' ) , 'curr' => floor(diskfreespace(ABSPATH) / (1024 * 1024)).'M');\n\tif ((int)$env_vars['disk']['required'] > (int)$env_vars['disk']['curr']) {\n\t\t$env_vars['disk']['state'] = false;\n\t\t$result = false;\n\t} else {\n\t\t$env_vars['disk']['state'] = true;\n\t}\n\n\treturn $env_vars;\n}\n\n/**\n * \u68c0\u67e5\u76ee\u5f55\u6587\u4ef6\n */\nfunction check_dir(&$result) {\n\t/// \u9700\u8981\u68c0\u67e5\u7684\u76ee\u5f55\u548c\u6587\u4ef6\n\t$dir_files = array(\n\t\t\t\t\t'./',\n\t\t\t\t\t'./system/config');\n\n\t$check_dir_files = array();\n\tforeach ($dir_files as $var) {\n\t\tif (is_dir($var)) {\n\t\t\tif ($fp = @fopen(ABSPATH.$var.'/text.txt', 'w')) {\n\t\t\t\t@fclose($fp);\n\t\t\t\t@unlink(ABSPATH.$var.'/text.txt');\n\t\t\t\t$check_dir_files[$var] = array('w' => 'writeable', 'state' => true);\n\t\t\t} else {\n\t\t\t\t$check_dir_files[$var] = array('w' => 'unwriteable', 'state' => false);\n\t\t\t\t$result = false;\n\t\t\t}\n\t\t} else {\n\t\t\tif (file_exists(ABSPATH.$var)) {\n\t\t\t\tif (is_writable(ABSPATH.$var)) {\n\t\t\t\t\t$check_dir_files[$var] = array('w' => 'writeable', 'state' => true);\n\t\t\t\t} else {\n\t\t\t\t\t$check_dir_files[$var] = array('w' => 'unwriteable', 'state' => false);\n\t\t\t\t\t$result = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$check_dir_files[$var] = array('w' => 'unwriteable', 'state' => false);\n\t\t\t\t$result = false;\n\t\t\t}\n\t\t}\n\t}\n\treturn $check_dir_files;\n}\n\n/**\n * \u68c0\u67e5\u51fd\u6570\u4f9d\u8d56\n */\nfunction check_func(&$result)\n{\n\t$func_items = array('mysql' => 'mysql_connect',\n\t\t\t\t\t\t'file' => 'file_get_contents',\n\t\t\t\t\t\t'bz2' => 'bzcompress',\n\t\t\t\t\t\t'zlib' => 'gzcompress',\n\t\t\t\t\t\t'mhash' => array('mhash', 'hash_hmac')\n\t\t\t\t\t\t);\n\t$check_func_items = array();\n\tforeach ($func_items as $key => $var) {\n\t\tif ('mhash' == $key) {\n\t\t\tif (!dcrm_function_exists($var[0]) && !dcrm_function_exists($var[1])) {\n\t\t\t\t$check_func_items[implode(',', $var).'( )'] = array('s' => 'unsupportted_both', 'state' => false);\n\t\t\t} else {\n\t\t\t\t$check_func_items[$var[0].'( ),'.$var[1].'( )'] = array('s' => 'supportted', 'state' => true);\n\t\t\t}\n\t\t} elseif('bz2' == $key || 'zlib' == $key){\n\t\t\tif (dcrm_function_exists($var)) {\n\t\t\t\t$check_func_items[$var.'( )'] = array('s' => 'supportted', 'state' => true);\n\t\t\t} else {\n\t\t\t\t$check_func_items[$var.'( )'] = array('s' => 'unsupportted', 'state' => false);\n\t\t\t\t//$result = false;\n\t\t\t}\n\t\t} else{\n\t\t\tif (dcrm_function_exists($var)) {\n\t\t\t\t$check_func_items[$var.'( )'] = array('s' => 'supportted', 'state' => true);\n\t\t\t} else {\n\t\t\t\t$check_func_items[$var.'( )'] = array('s' => 'unsupportted', 'state' => false);\n\t\t\t\t$result = false;\n\t\t\t}\n\t\t}\n\t}\n\treturn $check_func_items;\n}\n\n/**\n * \u68c0\u67e5\u65b9\u6cd5\u662f\u5426\u53ef\u7528\n *\n * @param string $func \u51fd\u6570\u540d\u6216\u6269\u5c55\u6a21\u5757\u540d\n * @param array $ext \u6269\u5c55\u6a21\u5757\uff0c\u5177\u4f53\u7684\u51fd\u6570\u6269\u5c55\u540d\uff0c\u53ef\u4ee5\u591a\u4e2a\n *\n * @return bool\n */\nfunction dcrm_function_exists($func, $ext = false) {\n\t/// \u83b7\u53d6\u88ab\u7981\u7528\u7684\u65b9\u6cd5\n\t$disable_functions = ini_get('disable_functions');\n\t$result = true;\n\tif ($ext) {\n\t\tforeach ($ext as $var) {\n\t\t\t$func_name = $func.'_'.$var;\n\t\t\tif (strpos($disable_functions, $func) !== false || !function_exists($func_name)) {\n\t\t\t\t$result = false;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif (strpos($disable_functions, $func) !== false || !function_exists($func)) {\n\t\t\t$result = false;\n\t\t}\n\t}\n\n\treturn $result;\n}\n\n/**\n * https\u68c0\u6d4b\n */\nfunction is_https() {\n\tif (isset($_SERVER['HTTPS']) && (strtolower($_SERVER['HTTPS']) == 'on' || $_SERVER['HTTPS'] == 1)) {\n\t\treturn TRUE;\n\t}\n\n\t// Nginx \u4e13\u7528\u65b9\u6cd5\u68c0\u6d4b\n\tif (isset($_SERVER['SERVER_PORT']) && $_SERVER['SERVER_PORT'] == '443') {\n\t\treturn TRUE;\n\t}\n\n\treturn FALSE;\n}\n\n/**\n * url\u68c0\u6d4b\n */\nfunction available($url) {\n\t$ch = curl_init();\n\tcurl_setopt($ch, CURLOPT_URL, $url);\n\tcurl_setopt($ch, CURLOPT_HEADER, TRUE);\n\tcurl_setopt($ch, CURLOPT_NOBODY, TRUE);\n\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);\n\tcurl_exec($ch);\n\t$code = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n\tcurl_close($ch);\n\n\treturn $code < 400;\n}\n\n/**\n * \u5934\u90e8\n */\nfunction display_header($n='') {\n\tglobal $header_title;\n\n?>\n<!doctype html>\n<meta charset=utf-8 /><title><?php echo $header_title; ?> - DCRM</title>\n<link rel=\"stylesheet\" href=\"css/main.css\" type=\"text/css\" />\n<h1 id=\"logo\">DCRM</h1>\n<h6 class=\"underline\">Darwin Cydia Repository Manager</h6>\n\n<?php if ($n != ''): ?>\n\t\t<div id=\"error\"><?php echo $n; ?></div>\n<?php endif;\n}\n\nfunction base_url(){\n\t$sitepath = str_replace($_SERVER['DOCUMENT_ROOT'], '', str_replace('\\\\', '/', ABSPATH));\n\t$siteurl = htmlspecialchars(($_SERVER['SERVER_PORT'] == '443' ? 'https://' : 'http://').$_SERVER['HTTP_HOST'].$sitepath);\n\tdefine('BASE_URL', $siteurl);\n}\n\nfunction check_notice( $install = false ) {\n\tbase_url();\n\t$notice = '';\n\tif (!function_exists(\"curl_init\")) {\n\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('The server does not support the cURL function, DCRM will not be able to use.');\n\t} elseif (!available(BASE_URL.'rewritetest')) {\n\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('The server does not support the URL Rewrite, DCRM will not be able to use.');\n\t}\n\tif( $notice == '' ){\n\t\tif( $install == false ){\n\t\t\tif (file_exists(CONF_PATH.'connect.inc.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('The file \\'/system/config/connect.inc.php\\' already exists. If you need to reset any of the configuration items in this file, please delete it first.');\n\t\t\t} elseif (!file_exists(CONF_PATH.'connect.inc.default.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('Sorry, I need a /system/config/connect.inc.default.php file to work from. Please re-upload this file from your DCRM installation.');\n\t\t\t} elseif (!is_writable(CONF_PATH)) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('<code>/system/config/</code> directory is not writable. Please change the directory properties or create the connect.inc.php manually (you can see connect.inc.default.php)');\n\t\t\t}\n\t\t} else {\n\t\t\tif (!file_exists(CONF_PATH.'config.inc.default.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('Sorry, I need a /system/config/config.inc.default.php file to work from. Please re-upload this file from your DCRM installation.');\n\t\t\t} elseif (!file_exists(CONF_PATH.'gnupg.inc.default.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('Sorry, I need a /system/config/gnupg.inc.default.php file to work from. Please re-upload this file from your DCRM installation.');\n\t\t\t} elseif (!file_exists(CONF_PATH.'autofill.inc.default.php')) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('Sorry, I need a /system/config/autofill.inc.default.php file to work from. Please re-upload this file from your DCRM installation.');\n\t\t\t} elseif (!is_writable(CONF_PATH)) {\n\t\t\t\t$notice = '<strong>'.__('Warning: ').'</strong>'.__('<code>/system/config/</code> directory is not writable. Please change the directory properties.');\n\t\t\t}\n\t\t}\n\t}\n\treturn $notice;\n}\n\n/** \n * utf-8 \u8f6cunicode \n * \n * @param string $name \n * @return string \n */  \nfunction utf8_unicode($name){  \n\t$name = iconv('UTF-8', 'UCS-2', $name);  \n\t$len  = strlen($name);  \n\t$str  = '';  \n\tfor ($i = 0; $i < $len - 1; $i = $i + 2){  \n\t\t$c  = $name[$i];  \n\t\t$c2 = $name[$i + 1];  \n\t\tif (ord($c) > 0){   //\u4e24\u4e2a\u5b57\u8282\u7684\u6587\u5b57  \n\t\t\t$str .= '\\u'.base_convert(ord($c), 10, 16).str_pad(base_convert(ord($c2), 10, 16), 2, 0, STR_PAD_LEFT);  \n\t\t\t//$str .= base_convert(ord($c), 10, 16).str_pad(base_convert(ord($c2), 10, 16), 2, 0, STR_PAD_LEFT);  \n\t\t} else {  \n\t\t\t$str .= '\\u'.str_pad(base_convert(ord($c2), 10, 16), 4, 0, STR_PAD_LEFT);  \n\t\t\t//$str .= str_pad(base_convert(ord($c2), 10, 16), 4, 0, STR_PAD_LEFT);  \n\t\t}  \n\t}  \n\t//$str = strtoupper($str);//\u8f6c\u6362\u4e3a\u5927\u5199  \n\treturn $str;  \n}\n\n/**\n * Properly strip all HTML tags including script and style\n *\n * This differs from strip_tags() because it removes the contents of\n * the `<script>` and `<style>` tags. E.g. `strip_tags( '<script>something</script>' )`\n * will return 'something'. wp_strip_all_tags will return ''\n *\n * @param string $string String containing HTML tags\n * @param bool $remove_breaks optional Whether to remove left over line breaks and white space chars\n * @return string The processed string.\n */\nfunction strip_all_tags($string, $remove_breaks = false) {\n\t$string = preg_replace( '@<(script|style)[^>]*?>.*?</\\\\1>@si', '', $string );\n\t$string = strip_tags($string);\n\n\tif ( $remove_breaks )\n\t\t$string = preg_replace('/[\\r\\n\\t ]+/', ' ', $string);\n\n\treturn trim( $string );\n}\n\n/**\n * Sanitizes a username, stripping out unsafe characters.\n *\n * Removes tags, octets, entities, and if strict is enabled, will only keep\n * alphanumeric, _, space, ., -, @. After sanitizing, it passes the username,\n * raw username (the username in the parameter), and the value of $strict as\n * parameters for the 'sanitize_user' filter.\n *\n * @param string $username The username to be sanitized.\n * @param bool $strict If set limits $username to specific characters. Default false.\n * @return string The sanitized username, after passing through filters.\n */\nfunction sanitize_user( $username, $strict = false ) {\n\t$raw_username = $username;\n\t$username = strip_all_tags( $username );\n\t// Kill octets\n\t$username = preg_replace( '|%([a-fA-F0-9][a-fA-F0-9])|', '', $username );\n\t$username = preg_replace( '/&.+?;/', '', $username ); // Kill entities\n\n\t// If strict, reduce to ASCII for max portability.\n\tif ( $strict )\n\t\t$username = preg_replace( '|[^a-z0-9 _.\\-@]|i', '', $username );\n\n\t$username = trim( $username );\n\t// Consolidate contiguous whitespace\n\t$username = preg_replace( '|\\s+|', ' ', $username );\n\n\treturn $raw_username;\n}\n\n/**\n * Verifies that an email is valid.\n *\n * Does not grok i18n domains. Not RFC compliant.\n *\n * @param string $email Email address to verify.\n * @return string|bool Either false or the valid email address.\n */\nfunction is_email( $email, $deprecated = false ) {\n\t// Test for the minimum length the email can be\n\tif ( strlen( $email ) < 3 ) {\n\t\treturn false; //email_too_short\n\t}\n\n\t// Test for an @ character after the first position\n\tif ( strpos( $email, '@', 1 ) === false ) {\n\t\treturn false; //email_no_at\n\t}\n\n\t// Split out the local and domain parts\n\tlist( $local, $domain ) = explode( '@', $email, 2 );\n\n\t// LOCAL PART\n\t// Test for invalid characters\n\tif ( !preg_match( '/^[a-zA-Z0-9!#$%&\\'*+\\/=?^_`{|}~\\.-]+$/', $local ) ) {\n\t\treturn false; //local_invalid_chars\n\t}\n\n\t// DOMAIN PART\n\t// Test for sequences of periods\n\tif ( preg_match( '/\\.{2,}/', $domain ) ) {\n\t\treturn false; //domain_period_sequence\n\t}\n\n\t// Test for leading and trailing periods and whitespace\n\tif ( trim( $domain, \" \\t\\n\\r\\0\\x0B.\" ) !== $domain ) {\n\t\treturn false; //domain_period_limits\n\t}\n\n\t// Split the domain into subs\n\t$subs = explode( '.', $domain );\n\n\t// Assume the domain will have at least two subs\n\tif ( 2 > count( $subs ) ) {\n\t\treturn false; //domain_no_periods\n\t}\n\n\t// Loop through each sub\n\tforeach ( $subs as $sub ) {\n\t\t// Test for leading and trailing hyphens and whitespace\n\t\tif ( trim( $sub, \" \\t\\n\\r\\0\\x0B-\" ) !== $sub ) {\n\t\t\treturn false; //sub_hyphen_limits\n\t\t}\n\n\t\t// Test for invalid characters\n\t\tif ( !preg_match('/^[a-z0-9-]+$/i', $sub ) ) {\n\t\t\treturn false; //sub_invalid_chars\n\t\t}\n\t}\n\n\t// Congratulations your email made it!\n\treturn true;\n}\n\nfunction dcrm_slash( $value ) {\n\tif ( is_array( $value ) ) {\n\t\tforeach ( $value as $k => $v ) {\n\t\t\tif ( is_array( $v ) ) {\n\t\t\t\t$value[$k] = dcrm_slash( $v );\n\t\t\t} else {\n\t\t\t\t$value[$k] = addslashes( $v );\n\t\t\t}\n\t\t}\n\t} else {\n\t\t$value = addslashes( $value );\n\t}\n\n\treturn $value;\n}\n\nfunction dcrm_unslash( $value ) {\n\tif ( is_array($value) ) {\n\t\t$value = array_map('dcrm_unslash', $value);\n\t} elseif ( is_object($value) ) {\n\t\t$vars = get_object_vars( $value );\n\t\tforeach ($vars as $key=>$data) {\n\t\t\t$value->{$key} = dcrm_unslash( $data );\n\t\t}\n\t} elseif ( is_string( $value ) ) {\n\t\t$value = stripslashes($value);\n\t}\n\n\treturn $value;\n}\n\nfunction dcrm_query( $sql ){\n\t$result = mysql_query($sql);\n\tif (!$result) {\n\t\t$inst_alert = mysql_error();\n\t\techo $inst_alert; \n\t\texit();\n\t}\n}\n\n/**\n * Generates a random number\n *\n * @param int $min Lower limit for the generated number\n * @param int $max Upper limit for the generated number\n * @return int A random number between min and max\n */\nfunction dcrm_rand( $min = 0, $max = 0 ) {\n\tglobal $rnd_value;\n\n\t// Reset $rnd_value after 14 uses\n\t// 32(md5) + 40(sha1) + 40(sha1) / 8 = 14 random numbers from $rnd_value\n\tif ( strlen($rnd_value) < 8 ) {\n\t\tstatic $seed = '';\n\t\t$rnd_value = md5( uniqid(microtime() . mt_rand(), true ) . $seed );\n\t\t$rnd_value .= sha1($rnd_value);\n\t\t$rnd_value .= sha1($rnd_value . $seed);\n\t\t$seed = md5($seed . $rnd_value);\n\t}\n\n\t// Take the first 8 digits for our value\n\t$value = substr($rnd_value, 0, 8);\n\n\t$rnd_value = substr($rnd_value, 8);\n\n\t$value = abs(hexdec($value));\n\n\t// Some misconfigured 32bit environments (Entropy PHP, for example) truncate integers larger than PHP_INT_MAX to PHP_INT_MAX rather than overflowing them to floats.\n\t$max_random_number = 3000000000 === 2147483647 ? (float) \"4294967295\" : 4294967295; // 4294967295 = 0xffffffff\n\n\t// Reduce the value to be within the min - max range\n\tif ( $max != 0 )\n\t\t$value = $min + ( $max - $min + 1 ) * $value / ( $max_random_number + 1 );\n\n\treturn abs(intval($value));\n}\n\n/**\n * Generates a random password drawn from the defined set of characters.\n *\n * @param int  $length              Optional. The length of password to generate. Default 12.\n * @param bool $special_chars       Optional. Whether to include standard special characters.\n *                                  Default true.\n * @param bool $extra_special_chars Optional. Whether to include other special characters.\n *                                  Used when generating secret keys and salts. Default false.\n * @return string The random password.\n */\nfunction dcrm_generate_password( $length = 12, $special_chars = true, $extra_special_chars = false ) {\n\t$chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n\tif ( $special_chars )\n\t\t$chars .= '!@#$%^&*()';\n\tif ( $extra_special_chars )\n\t\t$chars .= '-_ []{}<>~`+=,.;:/?|';\n\n\t$password = '';\n\tfor ( $i = 0; $i < $length; $i++ ) {\n\t\t$password .= substr($chars, dcrm_rand(0, strlen($chars) - 1), 1);\n\t}\n\n\treturn $password;\n}\n\n/**\n * Checks for invalid UTF8 in a string.\n *\n * @param string $string The text which is to be checked.\n * @param boolean $strip Optional. Whether to attempt to strip out invalid UTF8. Default is false.\n * @return string The checked text.\n */\nfunction check_invalid_utf8( $string, $strip = false ) {\n\t$string = (string) $string;\n\n\tif ( 0 === strlen( $string ) ) {\n\t\treturn '';\n\t}\n\n\t// Check for support for utf8 in the installed PCRE library once and store the result in a static\n\tstatic $utf8_pcre;\n\tif ( !isset( $utf8_pcre ) ) {\n\t\t$utf8_pcre = @preg_match( '/^./u', 'a' );\n\t}\n\t// We can't demand utf8 in the PCRE installation, so just return the string in those cases\n\tif ( !$utf8_pcre ) {\n\t\treturn $string;\n\t}\n\n\t// preg_match fails when it encounters invalid UTF8 in $string\n\tif ( 1 === @preg_match( '/^./us', $string ) ) {\n\t\treturn $string;\n\t}\n\n\t// Attempt to strip the bad chars if requested (not recommended)\n\tif ( $strip && function_exists( 'iconv' ) ) {\n\t\treturn iconv( 'utf-8', 'utf-8', $string );\n\t}\n\n\treturn '';\n}\n\n/**\n * Converts a number of HTML entities into their special characters.\n *\n * Specifically deals with: &, <, >, \", and '.\n *\n * $quote_style can be set to ENT_COMPAT to decode \" entities,\n * or ENT_QUOTES to do both \" and '. Default is ENT_NOQUOTES where no quotes are decoded.\n *\n * @param string $string The text which is to be decoded.\n * @param mixed $quote_style Optional. Converts double quotes if set to ENT_COMPAT, both single and double if set to ENT_QUOTES or none if set to ENT_NOQUOTES. Also compatible with old _wp_specialchars() values; converting single quotes if set to 'single', double if set to 'double' or both if otherwise set. Default is ENT_NOQUOTES.\n * @return string The decoded text without HTML entities.\n */\nfunction dcrm_specialchars_decode( $string, $quote_style = ENT_NOQUOTES ) {\n\t$string = (string) $string;\n\n\tif ( 0 === strlen( $string ) ) {\n\t\treturn '';\n\t}\n\n\t// Don't bother if there are no entities - saves a lot of processing\n\tif ( strpos( $string, '&' ) === false ) {\n\t\treturn $string;\n\t}\n\n\t// Match the previous behaviour of _wp_specialchars() when the $quote_style is not an accepted value\n\tif ( empty( $quote_style ) ) {\n\t\t$quote_style = ENT_NOQUOTES;\n\t} elseif ( !in_array( $quote_style, array( 0, 2, 3, 'single', 'double' ), true ) ) {\n\t\t$quote_style = ENT_QUOTES;\n\t}\n\n\t// More complete than get_html_translation_table( HTML_SPECIALCHARS )\n\t$single = array( '&#039;'  => '\\'', '&#x27;' => '\\'' );\n\t$single_preg = array( '/&#0*39;/'  => '&#039;', '/&#x0*27;/i' => '&#x27;' );\n\t$double = array( '&quot;' => '\"', '&#034;'  => '\"', '&#x22;' => '\"' );\n\t$double_preg = array( '/&#0*34;/'  => '&#034;', '/&#x0*22;/i' => '&#x22;' );\n\t$others = array( '&lt;'   => '<', '&#060;'  => '<', '&gt;'   => '>', '&#062;'  => '>', '&amp;'  => '&', '&#038;'  => '&', '&#x26;' => '&' );\n\t$others_preg = array( '/&#0*60;/'  => '&#060;', '/&#0*62;/'  => '&#062;', '/&#0*38;/'  => '&#038;', '/&#x0*26;/i' => '&#x26;' );\n\n\tif ( $quote_style === ENT_QUOTES ) {\n\t\t$translation = array_merge( $single, $double, $others );\n\t\t$translation_preg = array_merge( $single_preg, $double_preg, $others_preg );\n\t} elseif ( $quote_style === ENT_COMPAT || $quote_style === 'double' ) {\n\t\t$translation = array_merge( $double, $others );\n\t\t$translation_preg = array_merge( $double_preg, $others_preg );\n\t} elseif ( $quote_style === 'single' ) {\n\t\t$translation = array_merge( $single, $others );\n\t\t$translation_preg = array_merge( $single_preg, $others_preg );\n\t} elseif ( $quote_style === ENT_NOQUOTES ) {\n\t\t$translation = $others;\n\t\t$translation_preg = $others_preg;\n\t}\n\n\t// Remove zero padding on numeric entities\n\t$string = preg_replace( array_keys( $translation_preg ), array_values( $translation_preg ), $string );\n\n\t// Replace characters according to translation table\n\treturn strtr( $string, $translation );\n}\n\n/**\n * Converts a number of special characters into their HTML entities.\n *\n * Specifically deals with: &, <, >, \", and '.\n *\n * $quote_style can be set to ENT_COMPAT to encode \" to\n * &quot;, or ENT_QUOTES to do both. Default is ENT_NOQUOTES where no quotes are encoded.\n *\n * @access private\n *\n * @param string $string The text which is to be encoded.\n * @param int $quote_style Optional. Converts double quotes if set to ENT_COMPAT, both single and double if set to ENT_QUOTES or none if set to ENT_NOQUOTES. Also compatible with old values; converting single quotes if set to 'single', double if set to 'double' or both if otherwise set. Default is ENT_NOQUOTES.\n * @param string $charset Optional. The character encoding of the string. Default is false.\n * @param boolean $double_encode Optional. Whether to encode existing html entities. Default is false.\n * @return string The encoded text with HTML entities.\n */\nfunction _dcrm_specialchars( $string, $quote_style = ENT_NOQUOTES, $charset = false, $double_encode = false ) {\n\t$string = (string) $string;\n\n\tif ( 0 === strlen( $string ) )\n\t\treturn '';\n\n\t// Don't bother if there are no specialchars - saves some processing\n\tif ( ! preg_match( '/[&<>\"\\']/', $string ) )\n\t\treturn $string;\n\n\t// Account for the previous behaviour of the function when the $quote_style is not an accepted value\n\tif ( empty( $quote_style ) )\n\t\t$quote_style = ENT_NOQUOTES;\n\telseif ( ! in_array( $quote_style, array( 0, 2, 3, 'single', 'double' ), true ) )\n\t\t$quote_style = ENT_QUOTES;\n\n\t$charset = 'UTF-8';\n\n\t$_quote_style = $quote_style;\n\n\tif ( $quote_style === 'double' ) {\n\t\t$quote_style = ENT_COMPAT;\n\t\t$_quote_style = ENT_COMPAT;\n\t} elseif ( $quote_style === 'single' ) {\n\t\t$quote_style = ENT_NOQUOTES;\n\t}\n\n\t// Handle double encoding ourselves\n\tif ( $double_encode ) {\n\t\t$string = @htmlspecialchars( $string, $quote_style, $charset );\n\t} else {\n\t\t// Decode &amp; into &\n\t\t$string = dcrm_specialchars_decode( $string, $_quote_style );\n\n\t\t// Guarantee every &entity; is valid or re-encode the &\n\t\t$string = dcrm_kses_normalize_entities( $string );\n\n\t\t// Now re-encode everything except &entity;\n\t\t$string = preg_split( '/(&#?x?[0-9a-z]+;)/i', $string, -1, PREG_SPLIT_DELIM_CAPTURE );\n\n\t\tfor ( $i = 0; $i < count( $string ); $i += 2 )\n\t\t\t$string[$i] = @htmlspecialchars( $string[$i], $quote_style, $charset );\n\n\t\t$string = implode( '', $string );\n\t}\n\n\t// Backwards compatibility\n\tif ( 'single' === $_quote_style )\n\t\t$string = str_replace( \"'\", '&#039;', $string );\n\n\treturn $string;\n}\n\n$allowedentitynames = array(\n\t'nbsp',    'iexcl',  'cent',    'pound',  'curren', 'yen',\n\t'brvbar',  'sect',   'uml',     'copy',   'ordf',   'laquo',\n\t'not',     'shy',    'reg',     'macr',   'deg',    'plusmn',\n\t'acute',   'micro',  'para',    'middot', 'cedil',  'ordm',\n\t'raquo',   'iquest', 'Agrave',  'Aacute', 'Acirc',  'Atilde',\n\t'Auml',    'Aring',  'AElig',   'Ccedil', 'Egrave', 'Eacute',\n\t'Ecirc',   'Euml',   'Igrave',  'Iacute', 'Icirc',  'Iuml',\n\t'ETH',     'Ntilde', 'Ograve',  'Oacute', 'Ocirc',  'Otilde',\n\t'Ouml',    'times',  'Oslash',  'Ugrave', 'Uacute', 'Ucirc',\n\t'Uuml',    'Yacute', 'THORN',   'szlig',  'agrave', 'aacute',\n\t'acirc',   'atilde', 'auml',    'aring',  'aelig',  'ccedil',\n\t'egrave',  'eacute', 'ecirc',   'euml',   'igrave', 'iacute',\n\t'icirc',   'iuml',   'eth',     'ntilde', 'ograve', 'oacute',\n\t'ocirc',   'otilde', 'ouml',    'divide', 'oslash', 'ugrave',\n\t'uacute',  'ucirc',  'uuml',    'yacute', 'thorn',  'yuml',\n\t'quot',    'amp',    'lt',      'gt',     'apos',   'OElig',\n\t'oelig',   'Scaron', 'scaron',  'Yuml',   'circ',   'tilde',\n\t'ensp',    'emsp',   'thinsp',  'zwnj',   'zwj',    'lrm',\n\t'rlm',     'ndash',  'mdash',   'lsquo',  'rsquo',  'sbquo',\n\t'ldquo',   'rdquo',  'bdquo',   'dagger', 'Dagger', 'permil',\n\t'lsaquo',  'rsaquo', 'euro',    'fnof',   'Alpha',  'Beta',\n\t'Gamma',   'Delta',  'Epsilon', 'Zeta',   'Eta',    'Theta',\n\t'Iota',    'Kappa',  'Lambda',  'Mu',     'Nu',     'Xi',\n\t'Omicron', 'Pi',     'Rho',     'Sigma',  'Tau',    'Upsilon',\n\t'Phi',     'Chi',    'Psi',     'Omega',  'alpha',  'beta',\n\t'gamma',   'delta',  'epsilon', 'zeta',   'eta',    'theta',\n\t'iota',    'kappa',  'lambda',  'mu',     'nu',     'xi',\n\t'omicron', 'pi',     'rho',     'sigmaf', 'sigma',  'tau',\n\t'upsilon', 'phi',    'chi',     'psi',    'omega',  'thetasym',\n\t'upsih',   'piv',    'bull',    'hellip', 'prime',  'Prime',\n\t'oline',   'frasl',  'weierp',  'image',  'real',   'trade',\n\t'alefsym', 'larr',   'uarr',    'rarr',   'darr',   'harr',\n\t'crarr',   'lArr',   'uArr',    'rArr',   'dArr',   'hArr',\n\t'forall',  'part',   'exist',   'empty',  'nabla',  'isin',\n\t'notin',   'ni',     'prod',    'sum',    'minus',  'lowast',\n\t'radic',   'prop',   'infin',   'ang',    'and',    'or',\n\t'cap',     'cup',    'int',     'sim',    'cong',   'asymp',\n\t'ne',      'equiv',  'le',      'ge',     'sub',    'sup',\n\t'nsub',    'sube',   'supe',    'oplus',  'otimes', 'perp',\n\t'sdot',    'lceil',  'rceil',   'lfloor', 'rfloor', 'lang',\n\t'rang',    'loz',    'spades',  'clubs',  'hearts', 'diams',\n\t'sup1',    'sup2',   'sup3',    'frac14', 'frac12', 'frac34',\n\t'there4',\n);\n\n/**\n * Callback for dcrm_kses_normalize_entities() regular expression.\n *\n * This function only accepts valid named entity references, which are finite,\n * case-sensitive, and highly scrutinized by HTML and XML validators.\n *\n * @param array $matches preg_replace_callback() matches array\n * @return string Correctly encoded entity\n */\nfunction dcrm_kses_named_entities($matches) {\n\tglobal $allowedentitynames;\n\n\tif ( empty($matches[1]) )\n\t\treturn '';\n\n\t$i = $matches[1];\n\treturn ( ( ! in_array($i, $allowedentitynames) ) ? \"&amp;$i;\" : \"&$i;\" );\n}\n\n/**\n * Helper function to determine if a Unicode value is valid.\n *\n * @param int $i Unicode value\n * @return bool True if the value was a valid Unicode number\n */\nfunction valid_unicode($i) {\n\treturn ( $i == 0x9 || $i == 0xa || $i == 0xd ||\n\t\t\t($i >= 0x20 && $i <= 0xd7ff) ||\n\t\t\t($i >= 0xe000 && $i <= 0xfffd) ||\n\t\t\t($i >= 0x10000 && $i <= 0x10ffff) );\n}\n\n/**\n * Converts and fixes HTML entities.\n *\n * This function normalizes HTML entities. It will convert `AT&T` to the correct\n * `AT&amp;T`, `&#00058;` to `&#58;`, `&#XYZZY;` to `&amp;#XYZZY;` and so on.\n *\n * @param string $string Content to normalize entities\n * @return string Content with normalized entities\n */\nfunction dcrm_kses_normalize_entities($string) {\n\t# Disarm all entities by converting & to &amp;\n\n\t$string = str_replace('&', '&amp;', $string);\n\n\t# Change back the allowed entities in our entity whitelist\n\n\t$string = preg_replace_callback('/&amp;([A-Za-z]{2,8}[0-9]{0,2});/', 'dcrm_kses_named_entities', $string);\n\t$string = preg_replace_callback('/&amp;#(0*[0-9]{1,7});/', 'dcrm_kses_normalize_entities2', $string);\n\t$string = preg_replace_callback('/&amp;#[Xx](0*[0-9A-Fa-f]{1,6});/', 'dcrm_kses_normalize_entities3', $string);\n\n\treturn $string;\n}\n\n/**\n * Callback for dcrm_kses_normalize_entities() regular expression.\n *\n * This function helps {@see dcrm_kses_normalize_entities()} to only accept 16-bit\n * values and nothing more for `&#number;` entities.\n *\n * @access private\n *\n * @param array $matches preg_replace_callback() matches array\n * @return string Correctly encoded entity\n */\nfunction dcrm_kses_normalize_entities2($matches) {\n\tif ( empty($matches[1]) )\n\t\treturn '';\n\n\t$i = $matches[1];\n\tif (valid_unicode($i)) {\n\t\t$i = str_pad(ltrim($i,'0'), 3, '0', STR_PAD_LEFT);\n\t\t$i = \"&#$i;\";\n\t} else {\n\t\t$i = \"&amp;#$i;\";\n\t}\n\n\treturn $i;\n}\n\n/**\n * Callback for dcrm_kses_normalize_entities() for regular expression.\n *\n * This function helps dcrm_kses_normalize_entities() to only accept valid Unicode\n * numeric entities in hex form.\n *\n * @access private\n *\n * @param array $matches preg_replace_callback() matches array\n * @return string Correctly encoded entity\n */\nfunction dcrm_kses_normalize_entities3($matches) {\n\tif ( empty($matches[1]) )\n\t\treturn '';\n\n\t$hexchars = $matches[1];\n\treturn ( ( ! valid_unicode(hexdec($hexchars)) ) ? \"&amp;#x$hexchars;\" : '&#x'.ltrim($hexchars,'0').';' );\n}\n\n/**\n * Escaping for HTML blocks.\n *\n * @param string $text\n * @return string\n */\nfunction esc_html( $text ) {\n\t$safe_text = check_invalid_utf8( $text );\n\t$safe_text = _dcrm_specialchars( $safe_text, ENT_QUOTES );\n\n\treturn $safe_text;\n}\n?>\n", "<?php\n/**\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/* DCRM Manage Header */\n\nif (!defined(\"DCRM\")) {\n\theader('HTTP/1.1 403 Forbidden');\n\texit('HTTP/1.1 403 Forbidden');\n}\n\n$localetype = 'manage';\ndefine('MANAGE_ROOT', dirname(__FILE__).'/');\ndefine('ABSPATH', dirname(MANAGE_ROOT).'/');\nrequire_once ABSPATH.'system/common.inc.php';\nheader('Content-type: text/html; charset=utf-8');\n\n$sidebars = array(\n\tarray(\n        'title' => 'PACKAGES',\n        'type'  => 'title'\n    ),\n\tarray(\n        'name'  => __('Upload Packages'),\n        'id'    => 'upload',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('Import Packages'),\n        'id'    => 'manage',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('Manage Packages'),\n        'id'    => 'center',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('Manage UDID'),\n        'id'    => 'udid',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'title' => 'REPOSITORY',\n        'type'  => 'title'\n    ),\n\tarray(\n        'name'  => __('Manage Sections'),\n        'id'    => 'sections',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('Manage Repository'),\n        'id'    => 'release',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'title' => 'SYSTEM',\n        'type'  => 'title'\n    ),\n\tarray(\n        'name'  => __('Running Status'),\n        'id'    => 'stats',\n        'type'  => 'subtitle',\n    ),\n\tarray(\n        'name'  => __('About'),\n        'id'    => 'about',\n        'type'  => 'subtitle',\n    )\n);\n?>\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\t<title>DCRM - <?php _e('Repository Manager');?></title>\n\t<meta name=\"viewport\" content=\"width=600px, minimal-ui\">\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"css/bootstrap.min.css\">\n<?php if(is_rtl()){ ?>\t<link rel=\"stylesheet\" type=\"text/css\" href=\"css/bootstrap-rtl.min.css\"><?php echo \"\\n\"; } ?>\n<?php if(file_exists(ROOT.'css/font/'.($local_css = substr($locale, 0, 2)).'.css') || file_exists(ROOT.'css/font/' . ($local_css = $locale) . '.css')): ?>\t<link rel=\"stylesheet\" type=\"text/css\" href=\"../css/font/<?php echo $local_css; ?>.css\"><?php echo(\"\\n\"); endif; ?>\n\t<script src=\"http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js\"></script>\n\t<script type=\"text/javascript\" src=\"./javascript/pace.min.js\"></script>\n\t<script type=\"text/javascript\">\n\t$(document).ready(function(){\n\t\tvar loaded = true;\n\t\tvar top = $(\"#sidebar\").offset().top;\n\t\tfunction Add_Data() {\n\t\t\tvar scrolla=$(window).scrollTop();\n\t\t\tvar cha=parseInt(top)-parseInt(scrolla)-10;\n\t\t\tif(loaded && cha<=0) {                \n\t\t\t\t$(\"#sidebar\").addClass(\"sticky\");\n\t\t\t\tloaded=false;\n\t\t\t}\n\t\t\tif(!loaded && cha>0) {\n\t\t\t\t$(\"#sidebar\").removeClass(\"sticky\");\n\t\t\t\tloaded=true;\n\t\t\t}\n\t\t}\n\t\t$(window).scroll(Add_Data);\n\t});\n\t$(document).ready(function setmargin(){\n\t\tvar div = document.getElementById('sidebar');\n\t\tvar width = div.style.width || div.clientWidth || div.offsetWidth || div.scrollWidth;\n\t\t<?php if(is_rtl()){ ?>document.getElementById('content').style.marginRight = width+1+'px';<?php } else { ?>document.getElementById('content').style.marginLeft = width+1+'px';<?php } ?>\n\t});\n\t</script>\n<?php\nif ( isset($activeid) && ( 'manage' == $activeid || 'sections' == $activeid || 'center' == $activeid) ) \n\techo '\t<link rel=\"stylesheet\" type=\"text/css\" href=\"css/corepage.css\">';\nif ( isset($activeid) && ( 'view' == $activeid || 'edit' == $activeid || 'center' == $activeid) ) \n\techo '\t<script src=\"javascript/backend/mbar.js\" type=\"text/javascript\"></script>';\n?>\n</head>\n<body class=\"manage\">\n\t<div class=\"container\">\n\t\t<div class=\"row\">\n\t\t\t<div class=\"span\" id=\"logo\">\n\t\t\t\t<p class=\"title\">DCRM</p>\n\t\t\t\t<h6 class=\"underline\">Darwin Cydia Repository Manager</h6>\n\t\t\t</div>\n\t\t\t<div class=\"top-secondary\">\n\t\t\t\t<div class=\"btn-group pull-right\">\n\t\t\t\t\t<a href=\"build.php\" class=\"btn btn-inverse\"><?php _e('Rebuild the list');?></a>\n\t\t\t\t\t<a href=\"settings.php\" class=\"btn btn-info<?php if ( isset($activeid) && 'settings' == $activeid ) echo ' disabled'; ?>\"><?php _ex('Preferences', 'Header');?></a>\n\t\t\t\t\t<a href=\"login.php?action=logout\" class=\"btn btn-info\"><?php _e('Logout');?></a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<br />\n\t\t<div class=\"row\">\n\t\t\t<div class=\"span2.5\" id=\"sidebar\" style=\"margin-left:0 !important;\">\n\t\t\t\t<div class=\"well sidebar-nav\">\n\t\t\t\t\t<ul class=\"nav nav-list\">\n<?php\nforeach ($sidebars as $value) {\n\tswitch ( $value['type'] ) {\n\t\tcase 'title':\n\t\t\techo \"\\t\\t\\t\\t\\t\\t<li class=\\\"nav-header\\\">\" . $value['title'] . \"</li>\\n\";\n\t\t\tbreak;\n\t\tcase 'subtitle':\n\t\t\tif( ( isset($activeid) && $value['id'] == $activeid ) || ( isset($highactiveid) && $value['id'] == $highactiveid ) ){\n\t\t\t\techo \"\\t\\t\\t\\t\\t\\t\\t<li class=\\\"active\\\">\";\n\t\t\t} else {\n\t\t\t\techo \"\\t\\t\\t\\t\\t\\t\\t<li>\";\n\t\t\t}\n\t\t\techo '<a href=\"' . $value['id'] . '.php\">' . $value['name'] . \"</a></li>\\n\";\n\t}\n}\n?>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n<?php\nif ( isset($activeid) && ( 'view' == $activeid || 'edit' == $activeid || 'center' == $activeid) ){\n?>\n\t\t\t\t<div class=\"well sidebar-nav\" id=\"mbar\" <?php if ( isset($activeid) && 'center' == $activeid ) echo 'style=\"display: none;\"'; ?>>\n\t\t\t\t\t<ul class=\"nav nav-list\">\n\t\t\t\t\t\t<li class=\"nav-header\">OPERATIONS</li>\n\t\t\t\t\t\t\t<li<?php if ( isset($activeid) && 'view' == $activeid ) echo ' class=\"active\"'; ?>><a href=\"javascript:opt(1)\"><?php _e('View Details'); ?></a></li>\n\t\t\t\t\t\t\t<li<?php if ( isset($activeid) && 'edit' == $activeid && !isset($_GET['action']) ) echo ' class=\"active\"'?>><a href=\"javascript:opt(2)\"><?php _e('General Editing'); ?></a></li>\n\t\t\t\t\t\t\t<li<?php if ( isset($activeid) && 'edit' == $activeid && isset($_GET['action']) && ($_GET['action'] == 'advance' || $_GET['action'] == 'advance_set') ) echo ' class=\"active\"'?>><a href=\"javascript:opt(3)\"><?php _e('Advance Editing'); ?></a></li>\n\t\t\t\t\t\t\t<li id=\"sli\"></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n<?php\n}\n?>\n\t\t\t</div>\n\t\t\t<div class=\"content\" id=\"content\">\n\t\t\t\t<div class=\"wrap\">\n", "<?php\n/**\n * DCRM Login Page\n * Copyright (c) 2015 Hintay <hintay@me.com>\n * Copyright (c) 2014 i_82 <i.82@me.com>\n *\n * This file is part of WEIPDCRM.\n * \n * WEIPDCRM is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * WEIPDCRM is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n * \n * You should have received a copy of the GNU Affero General Public License\n * along with WEIPDCRM.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nsession_cache_expire(30);\nsession_cache_limiter(\"private\");\nsession_start();\nsession_regenerate_id(true);\n$localetype = 'manage';\ndefine('ROOT_PATH', dirname(__FILE__));\ndefine('ABSPATH', dirname(ROOT_PATH).'/');\ninclude_once ABSPATH.'system/common.inc.php';\nheader(\"Cache-Control: no-store\");\nclass_loader('ValidateCode');\n\nif (isset($_GET['authpic'])) {\n\tif (trim($_GET['authpic']) == 'png') {\n\t\t$_vc = new ValidateCode();\n\t\t$_vc->doimg();\n\t\t$_SESSION['VCODE'] = $_vc->getCode();\n\t\texit();\n\t} else {\n\t\texit();\n\t}\n} else {\n\theader(\"Content-Type: text/html; charset=UTF-8\");\n}\nif (!isset($_SESSION['try'])) {\n\t$_SESSION['try'] = 0;\n} elseif (isset($_SESSION['lasttry']) && $_SESSION['lasttry']+DCRM_LOGINFAILRESETTIME <= time()) {\n\t$_SESSION['try'] = 0;\n}\nif (isset($_GET['action']) AND $_GET['action'] == \"logout\") {\n\tsession_unset();\n\tsession_destroy();\n\tgoto endlabel;\n}\nif (isset($_SESSION['connected']) && $_SESSION['connected'] === true) {\n\theader(\"Location: center.php\");\n\texit();\n}\nif(isset($_POST['language']) && !empty($_POST['language'])) {\n\t$_SESSION['language'] = $_POST['language'];\n\tif(!isset($_POST['submit']))\n\t\texit();\n}\nif(isset($_POST['submit'])) {\n\tif (!empty($_POST['username']) AND !empty($_POST['password'])) {\n\t\tif (empty($_POST['authcode'])) {\n\t\t\tunset($_SESSION['VCODE']);\n\t\t\t$error = \"authcode\";\n\t\t\tgoto endlabel;\n\t\t}\n\t\tif (strtolower($_POST['authcode']) != strtolower($_SESSION['VCODE'])) {\n\t\t\tunset($_SESSION['VCODE']);\n\t\t\t$_SESSION['try'] = $_SESSION['try'] + 1;\n\t\t\t$_SESSION['lasttry'] = time();\n\t\t\t$error = \"authcode\";\n\t\t\tgoto endlabel;\n\t\t} else {\n\t\t\tunset($_SESSION['VCODE']);\n\t\t}\n\t\tif (!preg_match(\"#^[0-9a-zA-Z\\_]*$#i\", $_POST['username'])) {\n\t\t\t$_SESSION['try'] = $_SESSION['try'] + 1;\n\t\t\t$_SESSION['lasttry'] = time();\n\t\t\t$error = \"badlogin\";\n\t\t\tgoto endlabel;\n\t\t}\n\t\t$login_query = DB::query(\"SELECT * FROM `\".DCRM_CON_PREFIX.\"Users` WHERE `Username` = '\".DB::real_escape_string($_POST['username']).\"' LIMIT 1\");\n\t\tif (DB::affected_rows() > 0) {\n\t\t\t$login = mysql_fetch_assoc($login_query);\n\t\t\tif ($login['Username'] === $_POST['username'] AND strtoupper($login['SHA1']) === strtoupper(sha1($_POST['password']))) {\n\t\t\t\t$login_query = DB::update(DCRM_CON_PREFIX.'Users', array('LastLoginTime' => date('Y-m-d H:i:s')), array('ID' => $login['ID']));\n\t\t\t\t$_SESSION['power'] = $login['Power'];\n\t\t\t\t$_SESSION['userid'] = $login['ID'];\n\t\t\t\t$_SESSION['username'] = $login['Username'];\n\t\t\t\t$_SESSION['token'] = sha1(time()*rand(140,320));\n\t\t\t\t$_SESSION['try'] = 0;\n\t\t\t\t$_SESSION['connected'] = true;\n\t\t\t\theader(\"Location: center.php\");\n\t\t\t\texit();\n\t\t\t} else {\n\t\t\t\t$_SESSION['try'] = $_SESSION['try'] + 1;\n\t\t\t\t$_SESSION['lasttry'] = time();\n\t\t\t\t$error = \"badlogin\";\n\t\t\t\tgoto endlabel;\n\t\t\t}\n\t\t} else {\n\t\t\t$_SESSION['try'] = $_SESSION['try'] + 1;\n\t\t\t$_SESSION['lasttry'] = time();\n\t\t\t$error = \"badlogin\";\n\t\t\tgoto endlabel;\n\t\t}\n\t} else {\n\t\t$error = \"notenough\";\n\t\tgoto endlabel;\n\t}\n}\nendlabel:\n?>\n<!DOCTYPE html>\n<html class=\"backend\">\n\t<!-- \u5f00\u59cb \u5934\u90e8 -->\n\t<head>\n\t\t<!-- \u5f00\u59cb META \u6807\u7b7e -->\n\t\t<meta charset=\"utf-8\">\n\t\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n\t\t<title><?php _e('Login'); ?></title>\n\t\t<meta name=\"author\" content=\"WEIPDCRM\">\n\t\t<meta name=\"license\" content=\"AGPLv3\">\n\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\">\n\n\t\t<link rel=\"shortcut icon\" href=\"../favicon.ico\">\n\t\t<!--/ \u7ed3\u675f META \u6807\u7b7e -->\n\n\t\t<!-- \u5f00\u59cb \u6837\u5f0f\u8868 -->\n\t\t<!--  \u63d2\u4ef6\u6837\u5f0f\u8868\uff1a\u53ef\u9009 -->\n\t\t<!--/ \u63d2\u4ef6\u6837\u5f0f\u8868 -->\n\n\t\t<!-- \u5e94\u7528\u6837\u5f0f\u8868\uff1a\u5f3a\u5236 -->\n\t\t<link rel=\"stylesheet\" href=\"http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css\">\n\t\t<link rel=\"stylesheet\" href=\"./stylesheet/layout.min.css\">\n\t\t<link rel=\"stylesheet\" href=\"./stylesheet/uielement.min.css\">\n<?php if(is_rtl()){ ?>\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./stylesheet/uielement-rtl.min.css\"><?php } ?>\n<?php if(file_exists(ROOT.'css/font/'.($local_css = substr($locale, 0, 2)).'.css') || file_exists(ROOT.'css/font/' . ($local_css = $locale) . '.css')): ?>\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"../css/font/<?php echo $local_css; ?>.css\"><?php echo(\"\\n\"); endif; ?>\n\t\t<!--/ \u5e94\u7528\u6837\u5f0f\u8868 -->\n\n\t\t<!-- modernizr \u811a\u672c -->\n\t\t<script type=\"text/javascript\" src=\"./plugins/modernizr/modernizr.min.js\"></script>\n\t\t<!--/ modernizr \u811a\u672c-->\n\t\t<!-- \u7ed3\u675f \u6837\u5f0f\u8868 -->\n    </head>\n\t<!--/ \u7ed3\u675f \u5934\u90e8 -->\n\n\t<!-- \u5f00\u59cb \u9875\u9762\u4e3b\u4f53 -->\n\t<body>\n\t\t<!-- \u5f00\u59cb \u6a21\u677f\u4e3b\u5185\u5bb9 -->\n\t\t<section id=\"main\" role=\"main\">\n\t\t\t<!-- \u5f00\u59cb \u6a21\u677f\u5bb9\u5668 -->\n\t\t\t<section class=\"container\">\n\t\t\t\t<!-- \u5f00\u59cb \u884c -->\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<div class=\"col-lg-4 col-lg-offset-4\">\n\t\t\t\t\t\t<!-- \u5546\u6807 -->\n\t\t\t\t\t\t<div class=\"text-center\" style=\"margin-bottom:10px; margin-top:30px;\">\n<?php\nif (file_exists('../CydiaIcon.png')) :\n?>\n\t\t\t\t\t\t\t<img src=\"../CydiaIcon.png\" style=\"width: 72px; height: 72px; border-radius: 6px; margin-bottom:10px;\" />\n<?php\nendif;\n?>\n\t\t\t\t\t\t\t<h5 class=\"semibold text-muted mt-5\"><?php _e('Login'); ?></h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<!--/ \u5546\u6807 -->\n\n\t\t\t\t\t\t<hr><!-- \u6c34\u5e73\u7ebf -->\n\n\t\t\t\t\t\t<!-- \u767b\u5f55\u8868\u5355 -->\n<?php\nif (!isset($_SESSION['try']) OR $_SESSION['try'] <= DCRM_MAXLOGINFAIL) {\n?>\n\t\t\t\t\t\t<div class=\"panel\">\n\t\t\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t<select name=\"language\" class=\"form-control\" onchange=\"set_language()\">\n<?php\n\t$languages = get_available_languages();\n\t$langtext = '<option value=\"Detect\"';\n\tif (!isset($_SESSION['language']) || $_SESSION['language'] == 'Detect')\n\t\t$langtext .= ' selected=\"selected\"';\n\t$langtext .= '>'._x( 'Select language', 'language' );\n\tif ( substr( $locale, 0, 2 ) != 'en' )\n\t\t$langtext .= ' - Languages';\n\t$langtext .= \"</option>\\n\";\n\n\t$languages_list = languages_list();\n\t$languages_self_list = languages_self_list();\n\tif(!in_array('en', $languages, true) && !in_array('en_US', $languages, true) && !in_array('en_GB', $languages, true)){\n\t\t$langtext .= '<option value=\"en_US\"';\n\t\tif ($_SESSION['language'] == 'en_US')\n\t\t\t$langtext .= ' selected=\"selected\"';\n\t\t$langtext .= '>' . _x('English', 'language') . \" - English</option>\\n\";\n\t}\n\n\tforeach( $languages as $language ) {\n\t\t$langtext .= \"<option value=\\\"$language\\\"\";\n\t\tif ($_SESSION['language'] == $language)\n\t\t\t$langtext .= ' selected=\"selected\"';;\n\t\t$langtext .= '>' . (isset($languages_list[$language]) ? $languages_list[$language] : $language);\n\t\t$langtext .= \" - \" . (isset($languages_self_list[$language]) ? $languages_self_list[$language] : $languages_list[$language]) . \"</option>\\n\";\n\t}\n\n\techo $langtext;\n?>\n\t\t\t\t\t\t\t\t\t</select>\n                                </div>\n\t\t\t\t\t\t\t\t<form name=\"form-login\" action=\"login.php\" method=\"POST\">\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-stack has-icon pull-left\">\n\t\t\t\t\t\t\t\t\t\t\t<input name=\"username\" type=\"text\" class=\"form-control input-lg\" placeholder=\"<?php _e('Username'); ?>\" data-parsley-errors-container=\"#error-container\" data-parsley-error-message=\"<?php _e('Please fill in your username'); ?>\" data-parsley-required>\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"ico-user2 form-control-icon\"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-stack has-icon pull-left\">\n\t\t\t\t\t\t\t\t\t\t\t<input name=\"password\" type=\"password\" class=\"form-control input-lg\" placeholder=\"<?php _e('Password'); ?>\" data-parsley-errors-container=\"#error-container\" data-parsley-error-message=\"<?php _e('Please fill in your password'); ?>\" data-parsley-required>\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"ico-lock2 form-control-icon\"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-stack has-icon pull-left\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"input-group image-input-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"authcode\" class=\"form-control input-lg\" placeholder=\"<?php _e('Verify Code'); ?>\" data-parsley-errors-container=\"#error-container\" data-parsley-error-message=\"<?php _e('Please fill in the verify code'); ?>\" data-parsley-required />\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"input-group-addon verifycode\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"login.php?authpic=png&amp;rand=<?php echo(time()); ?>\" style=\"height: 44px;\" onclick=\"this.src='login.php?authpic=png&amp;rand=' + new Date().getTime();\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"ico-quill3 form-control-icon\"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<!-- \u9519\u8bef\u5bb9\u5668 -->\n\t\t\t\t\t\t\t\t\t<div id=\"error-container\" class=\"mb15\">\n<?php\n\tif (isset($_GET['error'])) {\n\t\t$error = $_GET['error'];\n\t}\n\tif ($error == \"notenough\") {\n\t\techo '<ul class=\"parsley-errors-list filled\"><li>'.__('Please input your username and password!').'</li></ul>';\n\t} elseif ($error == \"badlogin\") {\n\t\techo '<ul class=\"parsley-errors-list filled\"><li>'.__('Unknown username or bad password!').'</li></ul>';\n\t} elseif ($error == \"bear\") {\n\t\techo '<ul class=\"parsley-errors-list filled\"><li>'.__('Bear!').'</li></ul>';\n\t} elseif ($error == \"authcode\") {\n\t\techo '<ul class=\"parsley-errors-list filled\"><li>'.__('Verification code error!').'</li></ul>';\n\t}\n?>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<!--/ \u9519\u8bef\u5bb9\u5668 -->\n\n\t\t\t\t\t\t\t\t\t<input name=\"submit\" style=\"display: none;\"/>\n\t\t\t\t\t\t\t\t\t<div class=\"form-group nm\">\n\t\t\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"btn btn-block btn-success\"><span class=\"semibold\"><?php _ex('Login', 'Buttom'); ?></span></button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</form>\n                            </div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<!-- \u767b\u5f55\u8868\u5355 -->\n<?php\n} else {\n?>\n\t\t\t\t\t\t<div class=\"panel-body\">\n\t\t\t\t\t\t\t<h1 class=\"text-center\"><?php _e('Error'); ?></h1>\n\t\t\t\t\t\t\t<p><?php printf(__('Your login wrong too many times , close the session or wait %s minutes and try again later.'), ceil(($_SESSION['lasttry']+DCRM_LOGINFAILRESETTIME - time())/60)); ?></p>\n\t\t\t\t\t\t</div>\n<?php\n}\n?>\n\t\t\t\t\t\t<hr><!-- \u6c34\u5e73\u7ebf -->\n\n\t\t\t\t\t\t<p class=\"text-muted text-center\">Copyrght &copy; <?php echo(date('Y')); echo defined(\"AUTOFILL_SEO\") ? ' '.htmlspecialchars(AUTOFILL_SEO) : ''; ?></p>\n\t\t\t\t\t\t<p class=\"text-muted text-center\">Powered by WEIPDCRM</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<!--/ \u7ed3\u675f \u884c -->\n\t\t\t</section>\n\t\t\t<!--/ \u7ed3\u675f \u6a21\u677f\u5bb9\u5668 -->\n\t\t</section>\n\t\t<!--/ \u7ed3\u675f \u6a21\u677f\u4e3b\u5185\u5bb9 -->\n\n\t\t<!-- \u5f00\u59cb JAVASCRIPT \u90e8\u5206 (\u5e95\u90e8\u52a0\u8f7djavascript\u4ee5\u51cf\u5c11\u8f7d\u5165\u65f6\u95f4) -->\n\t\t<!-- \u5e94\u7528\u53ca\u5e95\u5c42\u811a\u672c\uff1a\u5f3a\u5236 -->\n\t\t<script src=\"http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js\"></script>\n\t\t<script src=\"http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js\"></script>\n\t\t<!--/ \u5e94\u7528\u53ca\u5e95\u5c42\u811a\u672c\uff1a\u5f3a\u5236 -->\n\n\t\t<!-- \u63d2\u4ef6\u53ca\u9875\u9762\u811a\u672c\uff1a\u53ef\u9009 -->\n\t\t<script type=\"text/javascript\" src=\"./javascript/pace.min.js\"></script>\n\t\t<script type=\"text/javascript\" src=\"./plugins/parsley/parsley.min.js\"></script>\n\t\t<script type=\"text/javascript\" src=\"./javascript/backend/login.js\"></script>\n<?php\nif(isset($error))\n\techo '<script type=\"text/javascript\">$(document).ready(function(){animation();});</script>'\n?>\n\t\t<!--/ \u63d2\u4ef6\u53ca\u9875\u9762\u811a\u672c\uff1a\u53ef\u9009 -->\n\t\t<!--/ \u7ed3\u675f JAVASCRIPT \u90e8\u5206 -->\n\t</body>\n\t<!--/ \u7ed3\u675f \u9875\u9762\u4e3b\u4f53 -->\n</html>", "<?php\nif (!defined('IN_DCRM')) exit();\nclass db_mysql {\n\tvar $curlink;\n\tvar $last_query;\n\tfunction connect() {\n\t\t$this->curlink = $this->_dbconnect(DCRM_CON_SERVER.':' . (defined(\"DCRM_CON_SERVER_PORT\") ? DCRM_CON_SERVER_PORT : '3306'), DCRM_CON_USERNAME, DCRM_CON_PASSWORD, 'utf8', DCRM_CON_DATABASE, (defined(\"DCRM_CON_PCONNECT\") ? DCRM_CON_PCONNECT : false));\n\t}\n\tfunction _dbconnect($dbhost, $dbuser, $dbpw, $dbcharset, $dbname, $pconnect) {\n\t\t$link = null;\n\t\t$func = empty($pconnect) ? 'mysql_connect' : 'mysql_pconnect';\n\t\tif (!$link = @$func($dbhost, $dbuser, $dbpw, 1)) {\n\t\t\t$this->halt('Couldn\\'t connect to MySQL Server');\n\t\t} else {\n\t\t\t$this->curlink = $link;\n\t\t\tif ($this->version() > '4.1') {\n\t\t\t\t$serverset = $dbcharset ? 'character_set_connection='.$dbcharset.', character_set_results='.$dbcharset.', character_set_client=binary' : '';\n\t\t\t\t$serverset .= $this->version() > '5.0.1' ? ((empty($serverset) ? '' : ',').'sql_mode=\\'\\'') : '';\n\t\t\t\t$serverset && mysql_query(\"SET $serverset\", $link);\n\t\t\t}\n\t\t\t$dbname && @mysql_select_db($dbname, $link);\n\t\t}\n\t\treturn $link;\n\t}\n\tfunction select_db($dbname) {\n\t\treturn mysql_select_db($dbname, $this->curlink);\n\t}\n\tfunction fetch_array($query, $result_type = MYSQL_ASSOC) {\n\t\treturn mysql_fetch_array($query, $result_type);\n\t}\n\tfunction fetch_first($sql) {\n\t\treturn $this->fetch_array($this->query($sql));\n\t}\n\tfunction result_first($sql) {\n\t\treturn $this->result($this->query($sql), 0);\n\t}\n\tfunction query($sql, $type = '') {\n\t\t$func = $type == 'UNBUFFERED' && @function_exists('mysql_unbuffered_query') ? 'mysql_unbuffered_query' : 'mysql_query';\n\t\tif (!$this->curlink) $this->connect();\n\t\tif (!($query = $func($sql, $this->curlink))) {\n\t\t\tif ($type != 'SILENT') {\n\t\t\t\t$this->halt('MySQL Query ERROR', $sql);\n\t\t\t}\n\t\t}\n\t\treturn $this->last_query = $query;\n\t}\n\tfunction affected_rows() {\n\t\treturn mysql_affected_rows($this->curlink);\n\t}\n\tfunction error() {\n\t\treturn (($this->curlink) ? mysql_error($this->curlink) : mysql_error());\n\t}\n\tfunction errno() {\n\t\treturn intval(($this->curlink) ? mysql_errno($this->curlink) : mysql_errno());\n\t}\n\tfunction result($query, $row = 0) {\n\t\t$query = @mysql_result($query, $row);\n\t\treturn $query;\n\t}\n\tfunction num_rows($query) {\n\t\t$query = mysql_num_rows($query);\n\t\treturn $query;\n\t}\n\tfunction num_fields($query) {\n\t\treturn mysql_num_fields($query);\n\t}\n\tfunction free_result($query) {\n\t\treturn mysql_free_result($query);\n\t}\n\tfunction insert_id() {\n\t\treturn ($id = mysql_insert_id($this->curlink)) >= 0 ? $id : $this->result($this->query(\"SELECT last_insert_id()\"), 0);\n\t}\n\tfunction fetch_row($query) {\n\t\t$query = mysql_fetch_row($query);\n\t\treturn $query;\n\t}\n\tfunction fetch_fields($query) {\n\t\treturn mysql_fetch_field($query);\n\t}\n\tfunction real_escape_string($query) {\n\t\tif (!$this->curlink) $this->connect();\n\t\treturn mysql_real_escape_string($query);\n\t}\n\tfunction version() {\n\t\tif (empty($this->version)) {\n\t\t\t$this->version = mysql_get_server_info($this->curlink);\n\t\t}\n\t\treturn $this->version;\n\t}\n\tfunction close() {\n\t\treturn mysql_close($this->curlink);\n\t}\n\tfunction stat() {\n\t\tif (!$this->curlink) $this->connect();\n\t\treturn mysql_stat($this->curlink);\n\t}\n\tfunction halt($message = '', $sql = '') {\n\t\terror::db_error($message, $sql);\n\t}\n\tfunction __destruct() {\n\t\t$this->close();\n\t}\n}\nclass DB {\n\tfunction delete($table, $condition, $limit = 0, $unbuffered = true) {\n\t\tif (empty($condition)) {\n\t\t\t$where = '1';\n\t\t} elseif (is_array($condition)) {\n\t\t\t$where = DB::implode_field_value($condition, ' AND ');\n\t\t} else {\n\t\t\t$where = $condition;\n\t\t}\n\t\t$sql = \"DELETE FROM {$table} WHERE $where \".($limit ? \"LIMIT $limit\" : '');\n\t\treturn DB::query($sql, ($unbuffered ? 'UNBUFFERED' : ''));\n\t}\n\tfunction insert($table, $data, $return_insert_id = true, $replace = false, $silent = false) {\n\t\t$sql = DB::implode_field_value($data);\n\t\t$cmd = $replace ? 'REPLACE INTO' : 'INSERT INTO';\n\t\t$silent = $silent ? 'SILENT' : '';\n\t\t$return = DB::query(\"$cmd $table SET $sql\", $silent);\n\t\treturn $return_insert_id ? DB::insert_id() : $return;\n\t}\n\tfunction update($table, $data, $condition, $unbuffered = false, $low_priority = false) {\n\t\t$sql = DB::implode_field_value($data);\n\t\t$cmd = \"UPDATE \".($low_priority ? 'LOW_PRIORITY' : '');\n\t\t$where = '';\n\t\tif (empty($condition)) {\n\t\t\t$where = '1';\n\t\t} elseif (is_array($condition)) {\n\t\t\t$where = DB::implode_field_value($condition, ' AND ');\n\t\t} else {\n\t\t\t$where = $condition;\n\t\t}\n\t\t$res = DB::query(\"$cmd $table SET $sql WHERE $where\", $unbuffered ? 'UNBUFFERED' : '');\n\t\treturn $res;\n\t}\n\tfunction implode_field_value($array, $glue = ',') {\n\t\t$sql = $comma = '';\n\t\tforeach ($array as $k => $v) {\n\t\t\t$k = DB::real_escape_string($k);\n\t\t\t$v = DB::real_escape_string($v);\n\t\t\tif ('NULL' == $v)\n\t\t\t\t$v = '';\n\t\t\t$sql .= $comma.\"`$k`='$v'\";\n\t\t\t$comma = $glue;\n\t\t}\n\t\treturn $sql;\n\t}\n\tfunction insert_id() {\n\t\treturn DB::_execute('insert_id');\n\t}\n\tfunction fetch($resourceid, $type = MYSQL_ASSOC) {\n\t\treturn DB::_execute('fetch_array', $resourceid, $type);\n\t}\n\tfunction fetch_first($sql) {\n\t\treturn DB::_execute('fetch_first', $sql);\n\t}\n\tfunction fetch_all($sql) {\n\t\t$query = DB::_execute('query', $sql);\n\t\t$return = array();\n\t\twhile ($result = DB::fetch($query)) {\n\t\t\t$return[] = $result;\n\t\t}\n\t\treturn $return;\n\t}\n\tfunction result($resourceid, $row = 0) {\n\t\treturn DB::_execute('result', $resourceid, $row);\n\t}\n\tfunction result_first($sql) {\n\t\treturn DB::_execute('result_first', $sql);\n\t}\n\tfunction query($sql, $type = '') {\n\t\treturn DB::_execute('query', $sql, $type);\n\t}\n\tfunction num_rows($resourceid) {\n\t\treturn DB::_execute('num_rows', $resourceid);\n\t}\n\tfunction affected_rows() {\n\t\treturn DB::_execute('affected_rows');\n\t}\n\tfunction free_result($query) {\n\t\treturn DB::_execute('free_result', $query);\n\t}\n\tfunction real_escape_string($query) {\n\t\treturn DB::_execute('real_escape_string', $query);\n\t}\n\tfunction fetch_row($query) {\n\t\treturn DB::_execute('fetch_row', $query);\n\t}\n\tfunction error() {\n\t\treturn DB::_execute('error');\n\t}\n\tfunction errno() {\n\t\treturn DB::_execute('errno');\n\t}\n\tfunction version() {\n\t\treturn DB::_execute('version');\n\t}\n\tfunction stat() {\n\t\treturn DB::_execute('stat');\n\t}\n\tfunction _execute($cmd , $arg1 = '', $arg2 = '') {\n\t\tstatic $db;\n\t\tif (empty($db)) $db = &DB::object();\n\t\t$res = $db->$cmd($arg1, $arg2);\n\t\treturn $res;\n\t}\n\tfunction &object() {\n\t\tstatic $db;\n\t\tif (empty($db)) $db = new db_mysql();\n\t\treturn $db;\n\t}\n\tpublic function escape_by_ref( &$string ) {\n\t\tif ( ! is_float( $string ) )\n\t\t\t$string = DB::real_escape_string( $string );\n\t}\n\t/**\n\t * Prepares a SQL query for safe execution. Uses sprintf()-like syntax.\n\t *\n\t * The following directives can be used in the query format string:\n\t *   %d (integer)\n\t *   %f (float)\n\t *   %s (string)\n\t *   %% (literal percentage sign - no argument needed)\n\t *\n\t * All of %d, %f, and %s are to be left unquoted in the query string and they need an argument passed for them.\n\t * Literals (%) as parts of the query must be properly written as %%.\n\t *\n\t * This function only supports a small subset of the sprintf syntax; it only supports %d (integer), %f (float), and %s (string).\n\t * Does not support sign, padding, alignment, width or precision specifiers.\n\t * Does not support argument numbering/swapping.\n\t *\n\t * May be called like {@link http://php.net/sprintf sprintf()} or like {@link http://php.net/vsprintf vsprintf()}.\n\t *\n\t * Both %d and %s should be left unquoted in the query string.\n\t *\n\t *     DB::prepare( \"SELECT * FROM `table` WHERE `column` = %s AND `field` = %d\", 'foo', 1337 )\n\t *     DB::prepare( \"SELECT DATE_FORMAT(`field`, '%%c') FROM `table` WHERE `column` = %s\", 'foo' );\n\t *\n\t * @link http://php.net/sprintf Description of syntax.\n\t *\n\t * @param string $query Query statement with sprintf()-like placeholders\n\t * @param array|mixed $args The array of variables to substitute into the query's placeholders if being called like\n\t * \t{@link http://php.net/vsprintf vsprintf()}, or the first variable to substitute into the query's placeholders if\n\t * \tbeing called like {@link http://php.net/sprintf sprintf()}.\n\t * @param mixed $args,... further variables to substitute into the query's placeholders if being called like\n\t * \t{@link http://php.net/sprintf sprintf()}.\n\t * @return null|false|string Sanitized query string, null if there is no query, false if there is an error and string\n\t * \tif there was something to prepare\n\t */\n\tpublic function prepare( $query, $args ) {\n\t\tif ( is_null( $query ) )\n\t\t\treturn;\n\n\t\t// This is not meant to be foolproof -- but it will catch obviously incorrect usage.\n\t\tif ( strpos( $query, '%' ) === false ) {\n\t\t\tthrow new Exception(__( 'The query argument of DB::prepare() must have a placeholder.' ));\n\t\t}\n\n\t\t$args = func_get_args();\n\t\tarray_shift( $args );\n\t\t// If args were passed as an array (as in vsprintf), move them up\n\t\tif ( isset( $args[0] ) && is_array($args[0]) )\n\t\t\t$args = $args[0];\n\t\t$query = str_replace( \"'%s'\", '%s', $query ); // in case someone mistakenly already singlequoted it\n\t\t$query = str_replace( '\"%s\"', '%s', $query ); // doublequote unquoting\n\t\t$query = preg_replace( '|(?<!%)%f|' , '%F', $query ); // Force floats to be locale unaware\n\t\t$query = preg_replace( '|(?<!%)%s|', \"'%s'\", $query ); // quote the strings, avoiding escaped strings like %%s\n\t\tarray_walk( $args, \"DB::escape_by_ref\" );\n\t\treturn @vsprintf( $query, $args );\n\t}\n}\n?>", "<?php\nif(!defined('IN_DCRM')) exit();\nfunction showmessage($msg = '', $redirect = '', $delay = 3){\n\tglobal $siteurl;\n?>\n<!DOCTYPE html>\n<html>\n<meta charset=utf-8>\n<title><?php _e('System Message'); ?></title>\n<meta name=viewport content=\"initial-scale=1, minimum-scale=1, width=device-width\">\n<style>\n*{margin:0;padding:0}\nhtml,code{font:15px/22px arial,sans-serif}\nhtml{background:#fff;color:#222;padding:15px}\nbody{margin:7% auto 0;max-width:390px;min-height:220px;padding:75px 0 15px}\n* > body{background:url(<?php echo($siteurl); ?>icons/default/msg_bg.png) 100% 5px no-repeat;padding-right:205px}\np{margin:11px 0 22px;overflow:hidden}\nins, ins a{color:#777;text-decoration:none;font-size:10px;}\na img{border:0}\n@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}\n</style>\n<body>\n<p><b><?php _e('System Message'); ?> - DCRM</b></p>\n<?php\necho \"<p>{$msg}</p>\";\nif($redirect)\n\techo \"<ins><a href=\\\"{$redirect}\\\">\".__('If your browser does not automatically redirect, please click here.').\"</a></ins><meta http-equiv=\\\"refresh\\\" content=\\\"{$delay};url={$redirect}\\\" />\";\n?>\n</body>\n</html>\n<?php \n\texit();\n}\nfunction saveVersion($version){\n\tif (!$version) return;\n\t$content = '<?php'.PHP_EOL.'/* Auto-generated version file */'.PHP_EOL.'$_version = \\''.$version.'\\';'.PHP_EOL.'?>';\n\tif(!is_writable(SYSTEM_ROOT.'./version.inc.php')) throw new Exception('Version file is not writable!');\n\tif(!file_put_contents(SYSTEM_ROOT.'./version.inc.php', $content)) throw new Exception('Version file is not writable, please change $_version to '.$version.'in version.inc.php');\n}\nfunction update_final($version){\n\tsaveVersion($version);\n\tshowmessage(sprintf(__( 'Successfully updated to %s' ), $version), './');\n}\nfunction sizeext($size) {\n\treturn ($size < 1048576) ? round($size/1024,2).' KB' : round($size/1048576,2).' MB';\n}\nfunction httpinfo($info_type) {\n\tswitch ($info_type) {\n\t\tcase 304:\n\t\t\t$info = \"304 Not Modified\";\n\t\t\tbreak;\n\t\tcase 400:\n\t\t\t$info = \"400 Bad Request\";\n\t\t\tbreak;\n\t\tcase 404:\n\t\t\t$info = \"404 Not Found\";\n\t\t\tbreak;\n\t\tcase 4030:\n\t\t\t$info = \"403 Forbidden\";\n\t\t\tbreak;\n\t\tcase 4031:\n\t\t\t$info = \"403 Payment Required\";\n\t\t\tbreak;\n\t\tcase 4032:\n\t\t\tif(!defined(\"AUTOFILL_EMAIL\"))\n\t\t\t\trequire_once(CONF_PATH.'autofill.inc.php');\n\t\t\t$info = sprintf('403 Payment Required: This package is either paid or requires a paid package to function. If you already paid for this package, try again later, or email %s if this problem keeps happening.', AUTOFILL_EMAIL);\n\t\t\tbreak;\n\t\tcase 4033:\n\t\t\t$info = '403 Forbidden: This package protected.';\n\t\t\tbreak;\n\t\tcase 405:\n\t\t\t$info = \"405 Method Not Allowed\";\n\t\t\tbreak; \n\t\tcase 500:\n\t\t\t$info = \"500 Internal Server Error\";\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t$info = \"501 Not Implemented\";\n\t\t\tbreak;\n\t}\n\theader(\"HTTP/1.1 \".$info);\n\theader(\"Status: \".$info);\n\theader(\"Content-Type: text/html; charset=UTF-8\");\n?>\n<html>\n<head>\n\t<title><?php echo($info); ?></title>\n</head>\n<body bgcolor=\"white\">\n\t<center>\n\t\t<h1><?php echo($info); ?></h1>\n\t</center>\n<hr />\n\t<center>DCRM</center>\n</body>\n</html>\n<?php\n\texit();\n}\nfunction _ip2long( $ip_address ) {\n\treturn sprintf(\"%u\",ip2long($ip_address));\n}\nfunction getIp(){ \n\t$onlineip=''; \n\tif(getenv('HTTP_CLIENT_IP')&&strcasecmp(getenv('HTTP_CLIENT_IP'),'unknown')){ \n\t\t$onlineip=getenv('HTTP_CLIENT_IP'); \n\t} elseif(getenv('HTTP_X_FORWARDED_FOR')&&strcasecmp(getenv('HTTP_X_FORWARDED_FOR'),'unknown')){ \n\t\t$onlineip=getenv('HTTP_X_FORWARDED_FOR'); \n\t} elseif(getenv('REMOTE_ADDR')&&strcasecmp(getenv('REMOTE_ADDR'),'unknown')){ \n\t\t$onlineip=getenv('REMOTE_ADDR'); \n\t} elseif(isset($_SERVER['REMOTE_ADDR'])&&$_SERVER['REMOTE_ADDR']&&strcasecmp($_SERVER['REMOTE_ADDR'],'unknown')){ \n\t\t$onlineip=$_SERVER['REMOTE_ADDR']; \n\t}\n\treturn $onlineip; \n} \n/**\n * Check value to find if it was serialized.\n *\n * If $data is not an string, then returned value will always be false.\n * Serialized data is always a string.\n *\n * @param string $data   Value to check to see if was serialized.\n * @param bool   $strict Optional. Whether to be strict about the end of the string. Default true.\n * @return bool False if not serialized and true if it was.\n */\nfunction is_serialized( $data, $strict = true ) {\n\t// if it isn't a string, it isn't serialized.\n\tif ( ! is_string( $data ) ) {\n\t\treturn false;\n\t}\n\t$data = trim( $data );\n \tif ( 'N;' == $data ) {\n\t\treturn true;\n\t}\n\tif ( strlen( $data ) < 4 ) {\n\t\treturn false;\n\t}\n\tif ( ':' !== $data[1] ) {\n\t\treturn false;\n\t}\n\tif ( $strict ) {\n\t\t$lastc = substr( $data, -1 );\n\t\tif ( ';' !== $lastc && '}' !== $lastc ) {\n\t\t\treturn false;\n\t\t}\n\t} else {\n\t\t$semicolon = strpos( $data, ';' );\n\t\t$brace     = strpos( $data, '}' );\n\t\t// Either ; or } must exist.\n\t\tif ( false === $semicolon && false === $brace )\n\t\t\treturn false;\n\t\t// But neither must be in the first X characters.\n\t\tif ( false !== $semicolon && $semicolon < 3 )\n\t\t\treturn false;\n\t\tif ( false !== $brace && $brace < 4 )\n\t\t\treturn false;\n\t}\n\t$token = $data[0];\n\tswitch ( $token ) {\n\t\tcase 's' :\n\t\t\tif ( $strict ) {\n\t\t\t\tif ( '\"' !== substr( $data, -2, 1 ) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} elseif ( false === strpos( $data, '\"' ) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// or else fall through\n\t\tcase 'a' :\n\t\tcase 'O' :\n\t\t\treturn (bool) preg_match( \"/^{$token}:[0-9]+:/s\", $data );\n\t\tcase 'b' :\n\t\tcase 'i' :\n\t\tcase 'd' :\n\t\t\t$end = $strict ? '$' : '';\n\t\t\treturn (bool) preg_match( \"/^{$token}:[0-9.E-]+;$end/\", $data );\n\t}\n\treturn false;\n}\n/**\n * Serialize data, if needed.\n *\n * @param string|array|object $data Data that might be serialized.\n * @return mixed A scalar data\n */\nfunction maybe_serialize( $data ) {\n\tif ( is_array( $data ) || is_object( $data ) )\n\t\treturn serialize( $data );\n\n\tif ( is_serialized( $data, false ) )\n\t\treturn serialize( $data );\n\n\treturn $data;\n}\n/**\n * Unserialize value only if it was serialized.\n *\n * @param string $original Maybe unserialized original, if is needed.\n * @return mixed Unserialized data can be any type.\n */\nfunction maybe_unserialize( $original ) {\n\tif ( is_serialized( $original ) ) // don't attempt to unserialize data that wasn't serialized going in\n\t\treturn @unserialize( $original );\n\treturn $original;\n}\n/**\n * Retrieve option value based on name of option.\n *\n * If the option does not exist or does not have a value, then the return value\n * will be false. This is useful to check whether you need to install an option\n * and is commonly used during installation of plugin options and to test\n * whether upgrading is required.\n *\n * If the option was serialized then it will be unserialized when it is returned.\n *\n * @param string $option Name of option to retrieve. Expected to not be SQL-escaped.\n * @param mixed $default Optional. Default value to return if the option does not exist.\n * @return mixed Value set for the option.\n */\nfunction get_option( $option, $default = false ) {\n\t$option = trim( $option );\n\tif ( empty( $option ) )\n\t\treturn false;\n\n\t//$row = mysql_fetch_object( DB::query( DB::prepare( \"SELECT option_value FROM `\".DCRM_CON_PREFIX.\"options` WHERE option_name = %s LIMIT 1\", $option ) ) );\n\t$row = DB::result_first( DB::prepare( \"SELECT option_value FROM `\".DCRM_CON_PREFIX.\"Options` WHERE option_name = %s LIMIT 1\", $option ) );\n\n\t/*if ( is_object( $row ) ) {\n\t\t$value = $row->option_value;\n\t} else { // option does not exist\n\t\treturn $default;\n\t}*/\n\tif ($row) {\n\t\t$value = $row;\n\t} else {\n\t\treturn $default;\n\t}\n\n\treturn maybe_unserialize( $value );\n}\n/**\n * Update the value of an option that was already added.\n *\n * You do not need to serialize values. If the value needs to be serialized, then\n * it will be serialized before it is inserted into the database. Remember,\n * resources can not be serialized or added as an option.\n *\n * If the option does not exist, then the option will be added with the option\n * value, but you will not be able to set whether it is autoloaded. If you want\n * to set whether an option is autoloaded, then you need to use the add_option().\n *\n * @param string $option Option name. Expected to not be SQL-escaped.\n * @param mixed $value Option value. Must be serializable if non-scalar. Expected to not be SQL-escaped.\n * @return bool False if value was not updated and true if value was updated.\n */\nfunction update_option( $option, $value ) {\n\t$option = trim($option);\n\tif ( empty($option) )\n\t\treturn false;\n\n\tif ( is_object( $value ) )\n\t\t$value = clone $value;\n\n\t$old_value = get_option( $option );\n\n\t// If the new and old values are the same, no need to update.\n\tif ( $value === $old_value )\n\t\treturn false;\n\n\tif ( false === $old_value )\n\t\treturn add_option( $option, $value );\n\n\t$serialized_value = maybe_serialize( $value );\n\n\t$result = DB::update( DCRM_CON_PREFIX.'Options', array( 'option_value' => $serialized_value ), array( 'option_name' => $option ) );\n\tif ( ! $result )\n\t\treturn false;\n\n\treturn true;\n}\n/**\n * Add a new option.\n *\n * You do not need to serialize values. If the value needs to be serialized, then\n * it will be serialized before it is inserted into the database. Remember,\n * resources can not be serialized or added as an option.\n *\n * You can create options without values and then update the values later.\n * Existing options will not be updated and checks are performed to ensure that you\n * aren't adding a protected WordPress option. Care should be taken to not name\n * options the same as the ones which are protected.\n *\n * @param string         $option      Name of option to add. Expected to not be SQL-escaped.\n * @param mixed          $value       Optional. Option value. Must be serializable if non-scalar. Expected to not be SQL-escaped.\n * @param string         $deprecated  Optional. Description. Not used anymore.\n * @return bool False if option was not added and true if option was added.\n */\nfunction add_option( $option, $value = '', $deprecated = '') {\n\t$option = trim($option);\n\tif ( empty($option) )\n\t\treturn false;\n\n\tif ( is_object($value) )\n\t\t$value = clone $value;\n\n\t//$value = sanitize_option( $option, $value );\n\n\t$serialized_value = maybe_serialize( $value );\n\n\t$result = DB::query( DB::prepare( \"INSERT INTO `\".DCRM_CON_PREFIX.\"Options` (`option_name`, `option_value`) VALUES (%s, %s) ON DUPLICATE KEY UPDATE `option_name` = VALUES(`option_name`), `option_value` = VALUES(`option_value`)\", $option, $serialized_value) );\n\tif ( ! $result )\n\t\treturn false;\n\n\treturn true;\n}\nfunction xss_clean($data) {\n\t// Fix &entity\\n;\n\t$data = str_replace(array('&amp;','&lt;','&gt;'), array('&amp;amp;','&amp;lt;','&amp;gt;'), $data);\n\t$data = preg_replace('/(&#*\\w+)[\\x00-\\x20]+;/u', '$1;', $data);\n\t$data = preg_replace('/(&#x*[0-9A-F]+);*/iu', '$1;', $data);\n\t$data = html_entity_decode($data, ENT_COMPAT, 'UTF-8');\n\n\t// Remove any attribute starting with \"on\" or xmlns\n\t$data = preg_replace('#(<[^>]+?[\\x00-\\x20\"\\'])(?:on|xmlns)[^>]*+>#iu', '$1>', $data);\n\n\t// Remove javascript: and vbscript: protocols\n\t$data = preg_replace('#([a-z]*)[\\x00-\\x20]*=[\\x00-\\x20]*([`\\'\"]*)[\\x00-\\x20]*j[\\x00-\\x20]*a[\\x00-\\x20]*v[\\x00-\\x20]*a[\\x00-\\x20]*s[\\x00-\\x20]*c[\\x00-\\x20]*r[\\x00-\\x20]*i[\\x00-\\x20]*p[\\x00-\\x20]*t[\\x00-\\x20]*:#iu', '$1=$2nojavascript...', $data);\n\t$data = preg_replace('#([a-z]*)[\\x00-\\x20]*=([\\'\"]*)[\\x00-\\x20]*v[\\x00-\\x20]*b[\\x00-\\x20]*s[\\x00-\\x20]*c[\\x00-\\x20]*r[\\x00-\\x20]*i[\\x00-\\x20]*p[\\x00-\\x20]*t[\\x00-\\x20]*:#iu', '$1=$2novbscript...', $data);\n\t$data = preg_replace('#([a-z]*)[\\x00-\\x20]*=([\\'\"]*)[\\x00-\\x20]*-moz-binding[\\x00-\\x20]*:#u', '$1=$2nomozbinding...', $data);\n\n\t// Only works in IE: <span style=\"width: expression(alert('Ping!'));\"></span>\n\t$data = preg_replace('#(<[^>]+?)style[\\x00-\\x20]*=[\\x00-\\x20]*[`\\'\"]*.*?expression[\\x00-\\x20]*\\([^>]*+>#i', '$1>', $data);\n\t$data = preg_replace('#(<[^>]+?)style[\\x00-\\x20]*=[\\x00-\\x20]*[`\\'\"]*.*?behaviour[\\x00-\\x20]*\\([^>]*+>#i', '$1>', $data);\n\t$data = preg_replace('#(<[^>]+?)style[\\x00-\\x20]*=[\\x00-\\x20]*[`\\'\"]*.*?s[\\x00-\\x20]*c[\\x00-\\x20]*r[\\x00-\\x20]*i[\\x00-\\x20]*p[\\x00-\\x20]*t[\\x00-\\x20]*:*[^>]*+>#iu', '$1>', $data);\n\n\t// Remove namespaced elements (we do not need them)\n\t$data = preg_replace('#</*\\w+:\\w[^>]*+>#i', '', $data);\n\tdo{\n\t\t// Remove really unwanted tags\n\t\t$old_data = $data;\n\t\t$data = preg_replace('#</*(?:applet|b(?:ase|gsound|link)|embed|frame(?:set)?|i(?:frame|layer)|l(?:ayer|ink)|meta|object|s(?:cript|tyle)|title|xml)[^>]*+>#i', '', $data);\n\t}\n\twhile ($old_data !== $data);\n\t// we are done...\n\treturn $data;\n}\n// Function link\nfunction randstr($len = 40) {\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _randstr($len);\n}\nfunction deldir($dir) {\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _deldir($dir);\n}\nfunction dirsize($dirName) {\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _dirsize($dirName);\n}\nfunction execInBackground($cmd) {\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _execInBackground(cmd);\n}\nfunction utf8_unicode($name){\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _utf8_unicode($name);\n}\nfunction TrimArray($input){\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _TrimArray($input);\n}\nfunction string_handle($input, $switch, $switch_string = 'cydia::commercial', $separator = ' '){\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _string_handle($input, $switch, $switch_string, $separator);\n}\nfunction check_commercial_tag($tag){\n\trequire_once SYSTEM_ROOT.'./function/manage.php';\n\treturn _check_commercial_tag($tag);\n}\nfunction downFile($fileName, $fancyName = '', $forceDownload = true, $speedLimit = DCRM_SPEED_LIMIT, $contentType = '') {\n\trequire_once SYSTEM_ROOT.'./function/downfile.php';\n\treturn _downFile($fileName, $fancyName, $forceDownload, $speedLimit, $contentType);\n}\n?>\n"], "filenames": ["main/commercial.php", "main/index.php", "main/install/function.php", "main/manage/header.php", "main/manage/login.php", "main/system/class/db.php", "main/system/function/core.php"], "buggy_code_start_loc": [21, 595, 25, 29, 74, 211, 316], "buggy_code_end_loc": [79, 596, 25, 29, 90, 264, 316], "fixing_code_start_loc": [21, 595, 26, 30, 75, 212, 317], "fixing_code_end_loc": [83, 596, 31, 31, 92, 270, 348], "type": "CWE-89", "message": "** UNSUPPPORTED WHEN ASSIGNED **** UNSUPPORTED WHEN ASSIGNED ** A vulnerability was found in 82Flex WEIPDCRM. It has been classified as critical. This affects an unknown part. The manipulation leads to sql injection. It is possible to initiate the attack remotely. The name of the patch is 43bad79392332fa39e31b95268e76fbda9fec3a4. It is recommended to apply a patch to fix this issue. The identifier VDB-217185 was assigned to this vulnerability. NOTE: This vulnerability only affects products that are no longer supported by the maintainer.", "other": {"cve": {"id": "CVE-2015-10008", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-02T11:15:10.623", "lastModified": "2023-01-09T18:08:11.130", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "** UNSUPPPORTED WHEN ASSIGNED **** UNSUPPORTED WHEN ASSIGNED ** A vulnerability was found in 82Flex WEIPDCRM. It has been classified as critical. This affects an unknown part. The manipulation leads to sql injection. It is possible to initiate the attack remotely. The name of the patch is 43bad79392332fa39e31b95268e76fbda9fec3a4. It is recommended to apply a patch to fix this issue. The identifier VDB-217185 was assigned to this vulnerability. NOTE: This vulnerability only affects products that are no longer supported by the maintainer."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:weipdcrm_project:weipdcrm:*:*:*:*:*:*:*:*", "versionEndExcluding": "2015-04-01", "matchCriteriaId": "3409EFF4-B04A-4CDA-8059-454F6849960A"}]}]}], "references": [{"url": "https://github.com/82Flex/WEIPDCRM/commit/43bad79392332fa39e31b95268e76fbda9fec3a4", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217185", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.217185", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/82Flex/WEIPDCRM/commit/43bad79392332fa39e31b95268e76fbda9fec3a4"}}