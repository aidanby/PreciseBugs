{"buggy_code": ["<?\r\nif (!$wpdb) {\r\n\t// get our db settings without loading all of wordpress every time\r\n\t$html = implode('', file(\"../../../wp-config.php\"));\r\n\t$html = str_replace (\"require_once\", \"// \", $html);\r\n\t$html = str_replace (\"<?php\", \"\", $html);\r\n\t$html = str_replace (\"?>\", \"\", $html);\r\n\teval($html);\r\n\r\n\tmysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\r\n\tmysql_select_db(DB_NAME);\r\n\r\n\t$user_id = $_POST[\"user\"];\r\n} else {\r\n\t$user_id = $user_ID;\r\n}\r\n\r\nrequire_once(dirname(__FILE__).'/hackersdiet_lib.php');\r\n\r\n$options = hackdiet_get_options($user_id);\r\n\r\nif ($_GET[\"start_date\"] and $_GET[\"end_date\"]) {\r\n\t$stats = generate_stats($user_id, $_GET[\"start_date\"], $_GET[\"end_date\"], $options[\"unit\"], $options[\"goal_weight\"], $options[\"goal_date\"]);\r\n} else {\r\n\t$stats = generate_stats($user_id, date(\"Y-m-d\", strtotime(\"2 weeks ago\")), date(\"Y-m-d\", strtotime(\"today\")), $options[\"unit\"], $options[\"goal_weight\"], $options[\"goal_date\"]);\r\n}\r\n\r\nif ($stats) {\r\n\techo \"Weekly \".($stats[\"weekly_change\"] > 0?\"gain\":\"loss\").\": \".abs($stats[\"weekly_change\"]).\" \".$options[\"unit\"].\"s.\";\r\n\techo \" - \";\r\n\techo \"Daily \".($stats[\"daily_variance\"] > 0?\"excess\":\"deficit\").\": \".abs($stats[\"daily_variance\"]).\" calories.\";\r\n\techo \"<br>\";\r\n\tif (!$options[\"maint_mode\"] && $options[\"goal_weight\"]) {\r\n\t\tif ($stats[\"on_target\"]) {\r\n            // going good\r\n\t\t\techo \"You will reach your goal of \".$options[\"goal_weight\"].\" \".$options[\"unit\"].\"s on \".$stats[\"new_date\"].\".\";\r\n\t\t\tif ($options[\"goal_date\"]) {\r\n\t\t\t\t$days_early = round((strtotime($options[\"goal_date\"])-strtotime($stats[\"new_date\"]))/60/60/24);\r\n\r\n\t\t\t\tif ($days_early > 0) {\r\n\t\t\t\t\techo \" (\".$days_early.\" days early!)\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo \" (Exactly!)\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if ($options[\"goal_date\"]) {\r\n            // gaining weight and we have a point of reference\r\n\t\t\tif ($stats[\"new_date\"]) {\r\n\t\t\t\techo \"You won't reach your goal of \".$options[\"goal_weight\"].\" \".$options[\"unit\"].\"s until \".date(\"F jS, Y\", strtotime($stats[\"new_date\"])).\".\";\r\n\t\t\t} else {\r\n\t\t\t\techo \"You will never reach your goal of \".$options[\"goal_weight\"].\" \".$options[\"unit\"].\"s at this rate.\";\r\n\t\t\t}\r\n\t\t\techo \"<br>\";\r\n\t\t\techo \"Adjust to a \".abs($stats[\"daily_variance\"] + $stats[\"extra_variance\"]).\" daily calorie \".($stats[\"daily_variance\"] + $stats[\"extra_variance\"] > 0?\"excess\":\"deficit\").\" to meet your goal.\";\r\n\t\t\tif ($stats[\"new_date\"]) {\r\n\t\t\t\techo \".. or just wait longer!\";\r\n\t\t\t}\r\n\t\t} else {\r\n            // gaining weight in general\r\n            echo \"Warning: You are moving away from your goal.  Change your daily excess into a deficit in order to get back on track!\";\r\n        }\r\n\t}\r\n}\r\n?>", "<?\r\nif (!$wpdb) {\r\n\t// get our db settings without loading all of wordpress every time\r\n\t$html = implode('', file(\"../../../wp-config.php\"));\r\n\t$html = str_replace (\"require_once\", \"// \", $html);\r\n\t$html = str_replace (\"<?php\", \"\", $html);\r\n\t$html = str_replace (\"?>\", \"\", $html);\r\n\teval($html);\r\n\r\n\tmysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\r\n\tmysql_select_db(DB_NAME);\r\n\r\n\t$user_id = $_POST[\"user\"];\r\n} else {\r\n\t$user_id = $user_ID;\r\n}\r\n\r\nrequire_once(dirname(__FILE__).'/hackersdiet_lib.php');\r\n\r\n$options = hackdiet_get_options($user_id);\r\n\r\nif ($options[\"maint_mode\"]){\r\n       echo \"Maintenance Mode\";\r\n} else {\r\n    if ($options[\"goal_weight\"]) {\r\n        $query = \"select trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_id order by date desc limit 1\";\r\n        $result = mysql_query($query);\r\n        if (mysql_num_rows($result) == 1) {\r\n            $current_trend = mysql_result($result, 0);\r\n            if ($current_trend) {\r\n                $diff = $current_trend - $options[\"goal_weight\"];\r\n                if ($diff > 0) {\r\n                    echo \"<h3 class=\\\"title\\\">Keep going! \" . ($diff) . \" \" . $options[\"unit\"] . \"s to go!</h3>\";\r\n                } else {\r\n                    echo \"<h3 class=\\\"title\\\">YOU DID IT!</h3>\";\r\n                }\r\n            }\r\n        }        \r\n    }\r\n}\r\n?>", "<?php\r\n/*\r\nPlugin Name: The Hacker's Diet\r\nPlugin URI: http://www.afex2win.com/stuff/hackersdiet/\r\nDescription: Track your weight loss online via your blog.  Inspired by John Walker's <a href=\"http://www.fourmilab.ch/hackdiet/\">The Hacker's Diet</a>.  This plugin replaces the Excel files supplied for his original system.\r\nVersion: 0.9.6b\r\nAuthor: Keith 'afex' Thornhill\r\nAuthor URI: http://www.afex2win.com/\r\n*/\r\n$hd_version = \"0.9.6b\";\r\n$hackdiet_user_level = 1;\t// feel free to change this value (1-10) if you want to restrict lower users from using the plugin\r\n\r\n// find URI to plugin dir so ajax calls have correct path\r\npreg_match(\"/.*(\\/wp-content\\/plugins\\/.*)\\/hackersdiet.php$/\", __FILE__, $hd_matches);\r\ndefine(\"PLUGIN_FOLDER_URL\", get_bloginfo('wpurl') . $hd_matches[1]);\r\n$hd_parsed_url = parse_url(PLUGIN_FOLDER_URL);\r\ndefine(\"PLUGIN_PATH\",  $hd_parsed_url['path'] . \"/\");\r\nrequire_once(dirname(__FILE__).'/hackersdiet_lib.php');\r\n\r\nfunction hackdiet_install() {\r\n\tglobal $table_prefix, $wpdb;\r\n\r\n\trequire_once(ABSPATH . 'wp-admin/upgrade-functions.php');\r\n\r\n\t$table_name = $table_prefix . \"hackdiet_weightlog\";\r\n\tif ($wpdb->get_var(\"show tables like '$table_name'\") != $table_name) {\r\n        $sql = \"CREATE TABLE \".$table_name.\" (wp_id BIGINT( 20 ) UNSIGNED NOT NULL, date DATE NOT NULL, weight DOUBLE UNSIGNED NOT NULL DEFAULT '0', trend DOUBLE UNSIGNED NOT NULL DEFAULT '0', rung SMALLINT UNSIGNED NOT NULL DEFAULT '0', PRIMARY KEY ( wp_id, date ))\";\r\n\t\tdbDelta($sql);\r\n\t}\r\n\r\n\t$table_name = $table_prefix . \"hackdiet_settings\";\r\n\tif ($wpdb->get_var(\"show tables like '$table_name'\") != $table_name) {\r\n        $sql = \"CREATE TABLE \".$table_name.\" (wp_id BIGINT UNSIGNED NOT NULL, name VARCHAR( 50 ) NOT NULL, value TEXT NOT NULL, PRIMARY KEY ( wp_id , name ) )\";\r\n\t\tdbDelta($sql);\r\n\t}\r\n}\r\n\r\nfunction hackdiet_add_dashboard_page() {\r\n\tglobal $hackdiet_user_level;\r\n\r\n\tif (function_exists('add_submenu_page')) {\r\n\t\tadd_submenu_page('index.php', 'hackersdiet', 'Hacker\\'s Diet', $hackdiet_user_level, basename(__FILE__), 'hackdiet_option_page');\r\n\t}\r\n}\r\n\r\nfunction hackdiet_js() {\r\n\tglobal $plugin_page;\r\n\tif (basename(__FILE__) == $plugin_page) {\r\n\t\t?>\r\n\t\t<script src=\"<?= PLUGIN_FOLDER_URL?>/prototype.js\" type=\"text/javascript\"></script>\r\n\t\t<script src=\"<?= PLUGIN_FOLDER_URL?>/editinplace.js\" type=\"text/javascript\"></script>\r\n\t\t<script src=\"<?= PLUGIN_FOLDER_URL?>/date-picker/js/datepicker.js\" type=\"text/javascript\"></script>\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"<?= PLUGIN_FOLDER_URL?>/date-picker/css/datepicker.css\" /> \r\n\t\t<?\r\n\t}\r\n}\r\n\r\nfunction hackdiet_option_page() {\r\n\tglobal $table_prefix, $wpdb, $user_ID;\r\n    global $hd_version;\r\n\r\n\t$options = hackdiet_get_options($user_ID);\r\n\r\n\t// first time they open the page, we need to set default unit\r\n\tif (!$options[\"unit\"]) {\r\n\t\t$options[\"unit\"] = \"lb\";\r\n\t\thackdiet_save_options($user_ID, $options);\r\n\t}\r\n\r\n\tif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\r\n\r\n\t\tif ($_POST[\"goal_date\"] && !$_POST[\"goal_weight\"]) {\r\n\t\t\t// can't plan without a plan\r\n\t\t\t$error = \"So exactly how much would you like to weigh on \" . $_POST[\"goal_date\"] . \"?\";\r\n\t\t} else {\r\n//\t\t\t$options[\"unit\"] = $_POST[\"unit\"];\r\n\r\n\t\t\t$options[\"goal_weight\"] = $_POST[\"goal_weight\"];\r\n\t\t\t$options[\"goal_date\"] = $_POST[\"goal_date\"];\r\n            if ($_POST[\"maint_mode\"]) {\r\n                $options[\"maint_mode\"] = true;\r\n            } else {\r\n                $options[\"maint_mode\"] = \"\";\r\n            }\r\n\r\n\t\t\thackdiet_save_options($user_ID, $options);\r\n\r\n\t\t\tif ($_POST[\"unit\"] != $_POST[\"old_unit\"]) {\r\n\t\t\t\tconvert_weights($_POST[\"old_unit\"], $_POST[\"unit\"]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t?>\r\n\t<?php if ($error):?>\r\n\t<div id=\"message\" class=\"error fade\"><p><strong><?php echo $error?></strong></p></div>\r\n\t<?php elseif ($message):?>\r\n\t<div id=\"message\" class=\"updated fade\"><p><strong><?php echo $message?></strong></p></div>\r\n\t<?php endif;?>\r\n\r\n\t<style>\r\n\t\tfieldset.options {\r\n\t\t    clear:both;\r\n\t\t    border:1px solid #ccc;\r\n\t\t}\r\n\t\tfieldset.options legend {\r\n\t\t    font-family: Georgia,\"Times New Roman\",Times,serif;\r\n\t\t    font-size: 22px;\r\n\t\t}\r\n\t\t.editable {\r\n\t\t\tcolor: #000;\r\n\t\t\tbackground-color: #ffffd3;\r\n\t\t}\r\n\t\t.blankedit {\r\n\t\t\tcolor: #ccc;\r\n\t\t\tfont-size: 9px!important;\r\n\t\t\tfont-style: italic!important;\r\n\t\t\tfont-weight: none!important;\r\n\t\t}\r\n\t\t.weightedit {\r\n\t\t\twidth: 200px;\r\n\t\t\tfont-size: 18px;\r\n\t\t\tfont-weight: bold;\r\n\t\t}\r\n\r\n        .trend_dif {\r\n            font-size: small;\r\n            vertical-align: 50%;\r\n        }\r\n\r\n        .good_trend {\r\n            color: green;\r\n        }\r\n\r\n        .bad_trend {\r\n            color: red;\r\n        }\r\n\r\n\t\t.hackdiet_edit_text {\r\n\t\t\twidth: 50px;\r\n\t\t}\r\n\t\t.hackdiet_edit_button {\r\n\r\n\t\t}\r\n\t\t.hackdiet_cancel_button {\r\n\r\n\t\t}\r\n\t\th3.title {\r\n\t\t\tfont: 100 186%/1.1 constantia, georgia, serif;\r\n\t\t\tcolor: #75C20F;\r\n\t\t\tletter-spacing:-0.02em;\r\n\t\t}\r\n\t\t#hackdiet_zeitgeist {\r\n\t\t\tbackground: #eee;\r\n\t\t\tborder: 1px solid #69c;\r\n\t\t\tfont-size: 90%;\r\n\t\t\tmargin-right: 1em;\r\n\t\t\tmargin-top: 4em;\r\n\t\t\tpadding: 1em;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist h2, fieldset legend a {\r\n\t\t\tborder-bottom: none;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist h2 {\r\n\t\t\tmargin-top: .4em;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist h3 {\r\n\t\t\tborder-bottom: 1px solid #ccc;\r\n\t\t\tfont-size: 16px;\r\n\t\t\tmargin: 1em 0 0;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist h3 cite {\r\n\t\t\tfont-size: 12px;\r\n\t\t\tfont-style: normal;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist li, #zeitgeist p {\r\n\t\t\tmargin: .2em 0;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist ul {\r\n\t\t\tmargin: 0 0 .3em .6em;\r\n\t\t\tpadding: 0 0 0 .6em;\r\n\t\t}\r\n\t</style>\r\n\t\r\n\t<div id=\"file_path\" style=\"display: none;\"><?= PLUGIN_PATH ?></div>\r\n    \r\n\t<div class=\"wrap\">\r\n\t\t<h2 id=\"write-post\">The Hacker's Diet</h2>\r\n\r\n\t\t<?\r\n\t\tif ($_GET[\"section\"] == \"reports\") {\r\n\t\t\t/*********************************************\r\n\t\t\t*                                            *\r\n\t\t\t*                                            *\r\n\t\t\t*              REPORTING SCREEN              *\r\n\t\t\t*                                            *\r\n\t\t\t*                                            *\r\n\t\t\t*********************************************/\r\n\r\n\t\t\tif ($_GET[\"show\"] == \"all\") {\r\n\t\t\t\t$query = \"select min(date) as max, max(date) as min from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_ID\";\r\n\t\t\t\t$row = $wpdb->get_row($query);\r\n\t\t\t\t$_GET['start_date'] = $row->max;\r\n\t\t\t\t$_GET['end_date']= $row->min;\r\n\t\t\t}\r\n\r\n\t\t\t?>\r\n\t\t\t<table width=\"100%\">\r\n\t\t\t\t<form method=\"get\" action=\"<?=$_SERVER[\"PHP_SELF\"]?>\">\r\n\t\t\t\t<input type=\"hidden\" name=\"page\" value=\"<?=$_GET[\"page\"]?>\">\r\n\t\t\t\t<input type=\"hidden\" name=\"section\" value=\"<?=$_GET[\"section\"]?>\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td width=\"33%\" align=\"center\">\r\n\t\t\t\t\t\tFrom: <input type=\"text\" id=\"start_date\" name=\"start_date\" class=\"format-y-m-d divider-dash\" value=\"<?=$_GET['start_date']?>\">\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td width=\"33%\" align=\"center\">\r\n\t\t\t\t\t\tTo: <input type=\"text\" id=\"end_date\" name=\"end_date\" class=\"format-y-m-d divider-dash\" value=\"<?=$_GET['end_date']?>\">\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td align=\"center\">\r\n\t\t\t\t\t\t<input type=\"submit\" value=\"run report &gt;\" />\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t</form>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"3\" align=\"center\">\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t<img id=\"main_graph\" src=\"<?=PLUGIN_FOLDER_URL?>/hackersdiet_chart.php?user=<?=$user_ID?>&start_date=<?=$_GET['start_date']?>&end_date=<?=$_GET['end_date']?>&goal=<?=$options[\"goal_weight\"]?>&maint_mode=<?=$options[\"maint_mode\"]?>\">\r\n\t\t\t\t\t\t<div id=\"blurb\">\r\n\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\tinclude(dirname(__FILE__).'/ajax_blurb.php');\r\n\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t\t<?\r\n\t\t} else {\r\n\t\t\t/**********************************************\r\n\t\t\t*                                             *\r\n\t\t\t*                                             *\r\n\t\t\t*                  MAIN PAGE                  *\r\n\t\t\t*                                             *\r\n\t\t\t*                                             *\r\n\t\t\t**********************************************/\r\n\t\t\t?>\r\n\t\t\t<table width=\"100%\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td rowspan=\"2\" width=\"30%\" valign=\"top\">\r\n\t\t\t\t\t\t<input type=\"hidden\" id=\"user_id\" name=\"user_id\" value=\"<?=$user_ID?>\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<th>Date</th>\r\n\t\t\t\t\t\t\t\t<th>Weight (<?=$options[\"unit\"]?>s)</th>\r\n\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t$date_index = strtotime(\"now\");\r\n\t\t\t\t\t\t\t\tfor ($i = 0; $i < 14; ++$i) {\r\n\t\t\t\t\t\t\t\t\t$weight_array[date(\"Y-m-d\", $date_index)] = array(\"weight\" => \"\", \"trend\" => \"\", \"rung\" => \"\");\r\n\t\t\t\t\t\t\t\t\t$date_index = strtotime(\"yesterday\", $date_index);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t$query = \"select date, weight, trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_ID and date > '\".date(\"Y-m-d\", strtotime(\"2 weeks ago\")).\"' order by date desc\";\r\n\t\t\t\t\t\t\t\t$dbweights = $wpdb->get_results($query);\r\n\t\t\t\t\t\t\t\tif ($dbweights) {\r\n\t\t\t\t\t\t\t\t\tforeach ($dbweights as $weight) {\r\n\t\t\t\t\t\t\t\t\t\t$weight_array[$weight->date][\"weight\"] = $weight->weight;\r\n\t\t\t\t\t\t\t\t\t\t$weight_array[$weight->date][\"trend\"] = $weight->trend;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tforeach ($weight_array as $date => $weight) {\r\n                                    $dif = round($weight[\"weight\"] - $weight[\"trend\"], 1);\r\n\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td nowrap align=\"right\"><?=date(\"D n/j\", strtotime($date))?></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><div class=\"weightedit <?=($weight[\"weight\"]?\"\":\"blankedit\")?>\" id=\"weight_<?=strtotime($date)?>\"><?=($weight[\"weight\"]?round($weight[\"weight\"], 1) . \"<span class=\\\"trend_dif \".(($dif < 0)?\"good_trend\":\"bad_trend\").\"\\\">$dif</span>\":\"click here to add a weight\")?></div></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td align=\"center\" valign=\"top\">\r\n                        <div id=\"togo\">\r\n                        <?\r\n\t\t\t\t\t\t\tinclude(dirname(__FILE__).'/ajax_togo.php');\r\n\t\t\t\t\t\t?>\r\n                        </div>\r\n\t\t\t\t\t\t<img id=\"main_graph\" src=\"<?=PLUGIN_FOLDER_URL?>/hackersdiet_chart.php?user=<?=$user_ID?>&weeks=2&goal=<?=$options[\"goal_weight\"]?>&maint_mode=<?=$options[\"maint_mode\"]?>\">\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td align=\"center\" valign=\"top\" height=\"100%\">\r\n\t\t\t\t\t\t<div id=\"blurb\">\r\n\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\tinclude(dirname(__FILE__).'/ajax_blurb.php');\r\n\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t\t<table width=\"100%\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td width=\"25%\">\r\n\t\t\t\t\t\t<div id=\"hackdiet_zeitgeist\" align=\"left\">\r\n\t\t\t\t\t\t\t<h2><?php _e('More &raquo;'); ?></h2>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h3><?php _e('Charts'); ?></h3>\r\n\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t$report_url = $_SERVER['PHP_SELF'].\"?page=hackersdiet.php&section=reports\";\r\n\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"<?=$report_url . \"&start_date=\".date(\"Y-m-01\").\"&end_date=\".date(\"Y-m-t\")?>\">Monthly</a></li>\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"<?=$report_url . \"&start_date=\".date(\"Y-m-01\", strtotime(\"-2 months\")).\"&end_date=\".date(\"Y-m-t\")?>\">Quarterly</a></li>\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"<?=$report_url . \"&start_date=\".date(\"Y-01-01\").\"&end_date=\".date(\"Y-m-d\")?>\">Year to date</a></li>\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"<?=$report_url . \"&show=all\"?>\">Complete history</a></li>\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h3><?php _e('Updates'); ?></h3>\r\n\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t\tif ( file_exists(ABSPATH . WPINC . '/rss.php') )\r\n\t\t\t\t\t\t\t\t\t\trequire_once(ABSPATH . WPINC . '/rss.php');\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\trequire_once(ABSPATH . WPINC . '/rss-functions.php');\r\n\r\n\t\t\t\t\t\t\t\t\t$rss = fetch_rss('http://www.afex2win.com/stuff/hackersdiet/feed/');\r\n\t\t\t\t\t\t\t\t\tif ( isset($rss->items) && 0 != count($rss->items) ) {\r\n\t\t\t\t\t\t\t\t\t\t$rss->items = array_slice($rss->items, 0, 3);\r\n\t\t\t\t\t\t\t\t\t\techo \"<ul>\";\r\n\t\t\t\t\t\t\t\t\t\tforeach ($rss->items as $item ) {\r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t\t\t<li><a href='<?php echo wp_filter_kses($item['link']); ?>'><?php echo wp_specialchars($item['title']); ?></a> &#8212; <?php printf(__('%s ago'), human_time_diff(strtotime($item['pubdate'], time() ) ) ); ?></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\techo \"</ul>\";\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t?>\r\n                                <br/><br/>(Your version is <?= $hd_version ?>)\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<fieldset class=\"options\">\r\n\t\t\t\t\t\t\t<legend>Settings</legend>\r\n\t\t\t\t\t\t\t<form method=\"post\">\r\n\t\t\t\t\t\t\t\t<table id=\"weighttable\" width=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<colgroup width=\"20%\" align=\"right\"></colgroup>\r\n                                    <colgroup width=\"30%\" align=\"left\"></colgroup>\r\n                                    <colgroup width=\"20%\" align=\"right\"></colgroup>\r\n                                    <colgroup width=\"30%\" align=\"left\"></colgroup>\r\n                                    <!--\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><b>Unit:</b></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" id=\"old_unit\" name=\"old_unit\" value=\"<?=$options[\"unit\"]?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" id=\"unit\" name=\"unit\" value=\"lb\" <?=($options[\"unit\"]==\"lb\"?\"checked\":\"\")?>>&nbsp;Pounds (lb)&nbsp;\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" id=\"unit\" name=\"unit\" value=\"kg\" <?=($options[\"unit\"]==\"kg\"?\"checked\":\"\")?>>&nbsp;Kilograms (kg)\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n                                    -->\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><b>Goal Weight:</b></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><input type=\"text\" id=\"goal_weight\" name=\"goal_weight\" value=\"<?=$options[\"goal_weight\"]?>\"></td>\r\n                                        <td>Maintenance mode?</td>\r\n                                        <td>\r\n                                            <input type=\"checkbox\" id=\"maint_mode\" name=\"maint_mode\" <?= ($options[\"maint_mode\"]?\"checked\":\"\") ?>><br />\r\n                                            <?\r\n                                            if ($options[\"goal_weight\"] && $current_trend <= $options[\"goal_weight\"] && !$options[\"maint_mode\"]) {\r\n                                                echo \"<span class=\\\"bad_trend\\\">Just hit your goal? Select Maintenance mode.</span>\";\r\n                                            }\r\n                                            ?>\r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><b>Goal Date:</b></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><input type=\"text\" id=\"goal_date\" name=\"goal_date\" value=\"<?=($_POST[\"goal_date\"] ? $_POST[\"goal_date\"] : $options[\"goal_date\"])?>\" class=\"format-y-m-d divider-dash range-low-<?= date(\"Y-m-d\") ?>\"></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td colspan=\"4\">\r\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"submit\"><input type=\"submit\" value=\"save settings &gt;\" /></p>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t</fieldset>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t\t<?\r\n\t\t}\r\n        ?>\r\n\r\n\t</div>\r\n\t<?\r\n}\r\n\r\nfunction hackdiet_widget_init() {\r\n\tif ( !function_exists('register_sidebar_widget') )\r\n\t\treturn;\r\n\r\n\tfunction widget_hackdiet($args) {\r\n\t\textract($args);\r\n\r\n\t\t// replace this with option from db\r\n\t\t$options = get_option('widget_hackdiet');\r\n\t\t$title = $options['title'];\r\n\r\n\t\techo $before_widget . $before_title . $title . $after_title;\r\n\t\t?>\r\n\t\tHacker's Diet widget not yet designed.\r\n\t\t<?\r\n\t\techo $after_widget;\r\n\t}\r\n\r\n\tfunction widget_hackdiet_control() {\r\n\t\t$options = get_option('widget_hackdiet');\r\n\r\n\t\tif ( !is_array($options) )\r\n\t\t\t$options = array('title'=>'');\r\n\r\n\t\tif ( $_POST['hackdiet-submit'] ) {\r\n\t\t\t$options['title'] = strip_tags(stripslashes($_POST['hackdiet-title']));\r\n\t\t\tupdate_option('widget_hackdiet', $options);\r\n\t\t}\r\n\r\n\t\t$title = htmlspecialchars($options['title'], ENT_QUOTES);\r\n\r\n\t\techo '<p style=\"text-align:right;\"><label for=\"hackdiet-title\">' . __('Title:') . ' <input style=\"width: 200px;\" id=\"hackdiet-title\" name=\"hackdiet-title\" type=\"text\" value=\"'.$title.'\" /></label></p>';\r\n\t\techo '<input type=\"hidden\" id=\"hackdiet-submit\" name=\"hackdiet-submit\" value=\"1\" />';\r\n\t}\r\n\r\n\tregister_sidebar_widget(array('The Hacker\\'s Diet', 'widgets'), 'widget_hackdiet');\r\n\r\n\tregister_widget_control(array('The Hacker\\'s Diet', 'widgets'), 'widget_hackdiet_control', 300, 100);\r\n}\r\n\r\n// hooks\r\nadd_action('admin_menu',                           'hackdiet_add_dashboard_page');\r\nadd_action('admin_head',                           'hackdiet_js');\r\nadd_action('widgets_init',                         'hackdiet_widget_init');\r\n\r\nregister_activation_hook(__FILE__, 'hackdiet_install');\r\n?>", "<?php\r\ninclude (dirname(__FILE__).\"/jpgraph/jpgraph.php\");\r\ninclude (dirname(__FILE__).\"/jpgraph/jpgraph_line.php\");\r\ninclude (dirname(__FILE__).\"/jpgraph/jpgraph_scatter.php\");\r\n\r\n// get our db settings without loading all of wordpress every save\r\n$html = implode('', file(\"../../../wp-config.php\"));\r\n$html = str_replace (\"require_once\", \"// \", $html);\r\n$html = str_replace (\"<?php\", \"\", $html);\r\n$html = str_replace (\"?>\", \"\", $html);\r\neval($html);\r\n\r\nmysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\r\nmysql_select_db(DB_NAME);\r\n\r\n$weeks = $_GET[\"weeks\"];\r\n$start_date = $_GET[\"start_date\"];\r\n$end_date = $_GET[\"end_date\"];\r\n$goal = $_GET[\"goal\"];\r\n$user_id = $_GET[\"user\"];\r\n$maint_mode = $_GET[\"maint_mode\"];\r\n\r\nif ($weeks) {\r\n\t$query = \"select date, weight, trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_id and date > \\\"\".date(\"Y-m-d\", strtotime(\"$weeks weeks ago\")).\"\\\" order by date asc\";\r\n} else if ($start_date and $end_date) {\r\n\t$query = \"select date, weight, trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_id and date >= \\\"$start_date\\\" and date <= \\\"$end_date\\\" order by date asc\";\r\n}\r\n\r\n$result = mysql_query($query);\r\nif (mysql_num_rows($result)) {\r\n\tif (mysql_num_rows($result) == 1) {\r\n\t\t// only one day, gotta finagle the display\r\n\r\n\t\t$row = mysql_fetch_assoc($result);\r\n\r\n\t\t// fake day before\r\n\t\t$weight_data[] = 0;\r\n\t\tif ($goal > 0) {\r\n\t\t\t$goal_data[] = $goal;\r\n\t\t}\r\n\t\t$x_data[] = date(\"n/j\", strtotime(\"yesterday\", strtotime($row[\"date\"])));\r\n\r\n\t\t// data\r\n\t\t$weight_data[] = $row[\"weight\"];\r\n\t\tif ($goal > 0) {\r\n\t\t\t$goal_data[] = $goal;\r\n\t\t}\r\n\t\t$x_data[] = date(\"n/j\", strtotime($row[\"date\"]));\r\n\t\t\r\n\t\t// fake day after\r\n\t\t$weight_data[] = 0;\r\n\t\tif ($goal > 0) {\r\n\t\t\t$goal_data[] = $goal;\r\n\t\t}\r\n\t\t$x_data[] = date(\"n/j\", strtotime(\"tomorrow\", strtotime($row[\"date\"])));\r\n\t} else {\r\n\t\t$num_rows = mysql_num_rows($result);\r\n\t\tif ($num_rows <= 7 * 2) { // 0-2 weeks\r\n\t\t\t$ticks = \"daily\";\r\n\t\t} else if ($num_rows <= 31 * 4) { // 2 weeks - 4 months\r\n\t\t\t$ticks = \"weekly\";\r\n\t\t} else { // 4 months +\r\n\t\t\t$ticks = \"monthly\";\r\n\t\t}\r\n\r\n\t\t$count = 1;\r\n\t\twhile ($row = mysql_fetch_assoc($result)) {\r\n\t\t\t$weight_data[] = $row[\"weight\"];\r\n\t\t\t$trend_data[] = $row[\"trend\"];\r\n\t\t\tif ($goal > 0) {\r\n\t\t\t\t$goal_data[] = $goal;\r\n\t\t\t}\r\n\t\t\tswitch ($ticks) {\r\n\t\t\t\tcase \"weekly\":\r\n\t\t\t\t\tif ($count == 1) {\r\n\t\t\t\t\t\t$x_data[] = date(\"n/j\", strtotime($row[\"date\"]));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$x_data[] = \"\";\r\n\t\t\t\t\t\tif ($count == 7) {\r\n\t\t\t\t\t\t\t$count = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"monthly\":\r\n\t\t\t\t\tif (date(\"j\", strtotime($row[\"date\"])) == \"1\") {\r\n\t\t\t\t\t\t$x_data[] = date(\"n/j\", strtotime($row[\"date\"]));\t\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$x_data[] = \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"daily\":\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t$x_data[] = date(\"n/j\", strtotime($row[\"date\"]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t$count++;\r\n\t\t}\r\n\t}\r\n} else {\r\n\t$trend_data[] = 0;\r\n\t$trend_data[] = 0;\r\n\t$x_data[] = date(\"n/j\", strtotime(\"yesterday\"));\r\n\t$x_data[] = date(\"n/j\", strtotime(\"today\"));\r\n}\r\n\r\nif ($weight_data) {\r\n\t$lowest_weight = $weight_data[0];\r\n\tforeach ($weight_data as $weight_entry) {\r\n\t\tif ($goal) {\r\n\t\t\tif ($weight_entry < $goal) {\r\n\t\t\t\t$to_check = $weight_entry;\r\n\t\t\t} else {\r\n\t\t\t\t$to_check = $goal;\r\n\t\t\t}\r\n\t\t\tif ($to_check < $lowest_weight) {\r\n\t\t\t\t$lowest_weight = $to_check;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif ($weight_entry < $lowest_weight) {\r\n\t\t\t\t$lowest_weight = $weight_entry;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n} else {\r\n\t$lowest_weight = $trend_data[0] + 1;\r\n}\r\n\r\n\r\n$graph = new Graph(600,300,\"auto\");\r\n$graph->SetScale(\"textlin\");\r\n$graph->legend->SetLayout(LEGEND_HOR);\r\n$graph->legend->Pos(0.5, 0.1, \"center\", \"bottom\");\r\n$graph->SetClipping();\r\n\r\nif ($x_data) {\r\n\t$graph->xaxis->SetTickLabels($x_data); \r\n}\r\n\r\nif ($weight_data) {\r\n\t$sp1 = new ScatterPlot($weight_data);\r\n    $sp1->SetLegend(\"Daily Weight\");\r\n\t$graph->Add($sp1);\r\n}\r\n\r\nif ($trend_data) {\r\n\t$trendplot=new LinePlot($trend_data);\r\n\t$trendplot->SetColor(\"red\");\r\n    $trendplot->SetLegend(\"Trend\");\r\n\t$graph->Add($trendplot);\r\n}\r\n\r\nif ($goal > 0) {\r\n\t$graph->yaxis->scale->SetAutoMin($lowest_weight - 1); \r\n\r\n\t$goalplot = new PlotLine (HORIZONTAL, $goal, \"green\" ,2);\r\n\t$graph->Add($goalplot);\r\n\r\n    // PlotLine don't support SetLegend, so we fake it thusly\r\n\t$fakegoal=new LinePlot($temp = 0);\r\n\t$fakegoal->SetColor(\"green\");\r\n    $fakegoal->SetLegend(\"Goal\");\r\n    $graph->Add($fakegoal);\r\n\r\n    if ($maint_mode) {\r\n\t\tif ($graph->yscale->autoscale_max == null || $graph->yscale->autoscale_max > $goal + 2) {\r\n\t        $upperplot = new PlotLine (HORIZONTAL, $goal + 2.5, \"blue\", 1);\r\n\t        $graph->AddLine($upperplot);\t\t\t\r\n\t\t}\r\n\t\tif ($graph->yscale->autoscale_min == null || $graph->yscale->autoscale_min < $goal - 2) {\r\n\t        $lowerplot = new PlotLine (HORIZONTAL, $goal - 2.5, \"blue\", 1); \r\n\t        $graph->AddLine($lowerplot);\r\n\t\t}\r\n\r\n      \t$bound=new LinePlot($temp = 0);\r\n        $bound->SetColor(\"blue\");\r\n        $bound->SetLegend(\"Boundaries\");\r\n        $graph->Add($bound);\r\n    }\r\n}\r\n\r\n$graph->Stroke();\r\n?>", "=== The Hacker's Diet ===\r\nContributors: afex\r\nTags: diet, weight loss\r\nRequires at least: 2.0.7\r\nTested up to: 2.1.3\r\nStable tag: 0.9.6b\r\n\r\nHelps you track and predict weight loss using your Wordpress blog.  Daily weight entry, trend calculations, and more.\r\n\r\n== Description ==\r\n\r\nWant to lose weight?  Need help?  Use Wordpress? (of course you do!)\r\n\r\nThe Hacker's Diet is a simple way to count calories and track your weight to make sure you are really losing the pounds.  By calculating your average weight, you don't have to be scared of those days when you \"gain\" 2 pounds overnight.  You'll see exactly your rate of weight loss and be able to predict when you will hit your weight goal.\r\n\r\nThis plugin serves to provide a web-based version of the Excel spreadsheets provided by the diet plan.  This lets you use the familiar interface of your blog to keep up-to-date on your diet.  After you hit your weight goal, it helps you maintain your weight by keeping you within a set window around your goal.\r\n\r\n== Installation ==\r\n\r\n1. Extract and upload the contents of the zip file to the `/wp-content/plugins/` directory\r\n1. Activate the plugin through the 'Plugins' menu in WordPress\r\n1. Click the menu link on the Dashboard home page\r\n\r\n== Frequently Asked Questions ==\r\n\r\n= Do I *have* to weigh myself everyday? =\r\n\r\nNope.  If you skip a day (or 6) your trend will just be calculated based off whenever your last weigh-in was.  Obviously, weighing yourself everyday will give you the most accurate trend.\r\n\n= Can multiple users log their weights? =\n\nYes! Weight entries are saved per user, so anybody that has access to your blog's dashboard can log their weights.  Note: edit the `$hackdiet_user_level` variable at the top of `hackersdiet.php` to restrict access.\n\r\n= What does the sidebar widget do? =\r\n\r\nNothing yet.  Got a good idea?  Let me know.\r\n\n= Why isn't the plugin version 1.0 yet? =\n\nI don't consider my plugin complete until I have a story in place for viewing and editing historical weight entries.  Once I have that, I can consider it \"feature complete\".\n\r\n== Screenshots ==\r\n\r\n1. Dashboard integration\r\n2. Daily weight entry\r\n3. Flickr-style \"edit in place\"\r\n4. Main graph.  Weight history over the last two weeks.\r\n5. Settings\r\n6. Reporting and plugin update notifications\r\n7. Custom timespan charts", "The Hacker's Diet - A Wordpress Plugin\r\nWritten By: Keith 'afex' Thornhill - www.afex2win.com\r\n\r\n\r\nInstallation:\r\n-------------\r\n\r\n1. Unzip\r\n2. Upload (wp-content/plugins)\r\n3. Activate\r\n4. Lose Weight\r\n5. ???\r\n6. Profit!\r\n\r\n\r\nVersions:\r\n---------\nv0.9.6b - 4/10/2007\n---\nFigured out how to activate and reference paths in a general way so plugin directory name can be arbitrary.\n\nv0.9.5b - 4/3/2007\n---\nUpdated installation instructions to specify plugin directory name.  Hopefully this limitation can be worked around in a future version.\n\r\nv0.9.4b - 4/1/2007\r\n---\r\nAdded legend and boundary lines to weight chart\r\n\r\nv0.9.3b - 1/31/2007\r\n---\r\nChanged use of SCRIPT_NAME server var to PHP_SELF in order to support PHP as CGI installs\r\n\r\nv0.9.2b - 1/24/2007\r\n---\r\nChanged use of innerText to innerHTML for IE/Firefox compatibility\r\nAdded current version number below updates RSS feed\r\n\"X lbs to go\" code assumed you had at least one trend in the db, for new installations this isn't the case.\r\n\r\nv0.9.1b - 1/19/2007\r\n---\r\nFixed table creation SQL to be compatible with MySQL 3.23\r\nFixed table name for setting table to use defined prefix\r\nAdded support for wordpress being installed in a subdirectory other than '/wp' (oops)\r\n\r\nv0.9b - 1/17/2007\r\n---\r\nPublic release\r\n\r\n\r\nThird party code:\r\n-----------------\r\nJpgraph - http://www.aditus.nu/jpgraph/\r\nDatePicker v2.7 - frequency-decoder.com", "<?\r\n// get our db settings without loading all of wordpress every save\r\n$html = implode('', file(\"../../../wp-config.php\"));\r\n$html = str_replace (\"require_once\", \"// \", $html);\r\n$html = str_replace (\"<?php\", \"\", $html);\r\n$html = str_replace (\"?>\", \"\", $html);\r\neval($html);\r\n\r\nif (isset($_POST[\"id\"]) && isset($_POST[\"user\"]) && is_numeric($_POST[\"user\"]) && isset($_POST[\"content\"]) && is_numeric($_POST[\"content\"])) {\r\n\t$date = substr($_POST[\"id\"], 7);\r\n\t$user_id = $_POST[\"user\"];\r\n\t$weight = round($_POST[\"content\"], 1);\r\n} else {\r\n\tprint_r($_POST);\r\n\techo \"Please enter a valid number for your weight.\";\r\n\texit;\r\n}\r\n\r\nmysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\r\nmysql_select_db(DB_NAME);\r\n\r\n$query = \"update \".$table_prefix.\"hackdiet_weightlog set weight = $weight where wp_id = $user_id and date = \\\"\".date(\"Y-m-d\", $date).\"\\\"\";\r\nmysql_query($query);\r\nif (mysql_affected_rows() != 1) {\r\n\t// record doesn't exist yet, lets create it\r\n\t$query = \"insert into \".$table_prefix.\"hackdiet_weightlog set date = \\\"\".date(\"Y-m-d\", $date).\"\\\", weight = $weight, wp_id = $user_id\";\r\n\tmysql_query($query);\r\n\tif (mysql_affected_rows() != 1) {\r\n\t\techo \"Save failed. - \" . mysql_error();\r\n\t\texit();\r\n\t} else {\r\n\t\techo htmlspecialchars($weight);\r\n\t}\r\n} else {\r\n\techo htmlspecialchars($weight);\r\n}\r\n\r\n$query = \"select trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_id and date < \\\"\".date(\"Y-m-d\", $date).\"\\\" order by date desc limit 1\";\r\n$result = mysql_query($query);\r\nif (mysql_num_rows($result) == 1) {\r\n\t$trend = mysql_result($result, 0);\r\n\t$use_first_weight_as_trend = false;\r\n} else {\r\n\t// no trends exist below this entry, we must be first.  so in next query, we need to grab today's weight to be trend 1\r\n\t$use_first_weight_as_trend = true;\r\n}\r\n\r\n$query = \"select date, weight, trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_id and date >= \\\"\".date(\"Y-m-d\", $date).\"\\\" order by date asc\";\r\n$result = mysql_query($query);\r\nwhile ($entry = mysql_fetch_assoc($result)) {\r\n\tif ($use_first_weight_as_trend) {\r\n\t\t$trend = $entry[\"weight\"];\r\n\t\t$use_first_weight_as_trend = false;\r\n\t} else {\r\n\t\t// exponentially smoothed moving average with 10% smoothing\r\n\t\t$trend = $trend + 0.1 * ($entry[\"weight\"] - $trend);\r\n\t}\r\n\t$entry[\"trend\"] = $trend;\r\n\t$weights[] = $entry;\r\n}\r\n\r\nforeach ($weights as $entry) {\r\n\t$query = \"update \".$table_prefix.\"hackdiet_weightlog set trend = \".round($entry[\"trend\"], 1).\" where wp_id = $user_id and date = \\\"\".$entry[\"date\"].\"\\\"\";\r\n\tmysql_query($query);\r\n}\r\n\r\n// 0 will always be the edited date, since the list contains the edited entry + all the ones after it, sorted asc.\r\n$dif = round($weights[0][\"weight\"] - $weights[0][\"trend\"], 1);\r\n\r\necho \"<span class=\\\"trend_dif \".(($dif < 0)?\"good_trend\":\"bad_trend\").\"\\\">$dif</span>\";\r\n?>"], "fixing_code": ["<?\r\nif (!$wpdb) {\r\n\t// get our db settings without loading all of wordpress every time\r\n\t$html = implode('', file(\"../../../wp-config.php\"));\r\n\t$html = str_replace (\"require_once\", \"// \", $html);\r\n\t$html = str_replace (\"<?php\", \"\", $html);\r\n\t$html = str_replace (\"?>\", \"\", $html);\r\n\teval($html);\r\n\r\n\tmysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\r\n\tmysql_select_db(DB_NAME);\r\n\r\n\tif (is_numeric($_POST['user'])) {\r\n    \t$user_id = $_POST[\"user\"];   \r\n    } else {\r\n        exit;\r\n    }\r\n} else {\r\n\t$user_id = $user_ID;\r\n}\r\n\r\nrequire_once(dirname(__FILE__).'/hackersdiet_lib.php');\r\n\r\n$options = hackdiet_get_options($user_id);\r\n\r\nif ($_GET[\"start_date\"] and $_GET[\"end_date\"]) {\r\n\t$stats = generate_stats($user_id, $_GET[\"start_date\"], $_GET[\"end_date\"], $options[\"unit\"], $options[\"goal_weight\"], $options[\"goal_date\"]);\r\n} else {\r\n\t$stats = generate_stats($user_id, date(\"Y-m-d\", strtotime(\"2 weeks ago\")), date(\"Y-m-d\", strtotime(\"today\")), $options[\"unit\"], $options[\"goal_weight\"], $options[\"goal_date\"]);\r\n}\r\n\r\nif ($stats) {\r\n\techo \"Weekly \".($stats[\"weekly_change\"] > 0?\"gain\":\"loss\").\": \".abs($stats[\"weekly_change\"]).\" \".$options[\"unit\"].\"s.\";\r\n\techo \" - \";\r\n\techo \"Daily \".($stats[\"daily_variance\"] > 0?\"excess\":\"deficit\").\": \".abs($stats[\"daily_variance\"]).\" calories.\";\r\n\techo \"<br>\";\r\n\tif (!$options[\"maint_mode\"] && $options[\"goal_weight\"]) {\r\n\t\tif ($stats[\"on_target\"]) {\r\n            // going good\r\n\t\t\techo \"You will reach your goal of \".$options[\"goal_weight\"].\" \".$options[\"unit\"].\"s on \".$stats[\"new_date\"].\".\";\r\n\t\t\tif ($options[\"goal_date\"]) {\r\n\t\t\t\t$days_early = round((strtotime($options[\"goal_date\"])-strtotime($stats[\"new_date\"]))/60/60/24);\r\n\r\n\t\t\t\tif ($days_early > 0) {\r\n\t\t\t\t\techo \" (\".$days_early.\" days early!)\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\techo \" (Exactly!)\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if ($options[\"goal_date\"]) {\r\n            // gaining weight and we have a point of reference\r\n\t\t\tif ($stats[\"new_date\"]) {\r\n\t\t\t\techo \"You won't reach your goal of \".$options[\"goal_weight\"].\" \".$options[\"unit\"].\"s until \".date(\"F jS, Y\", strtotime($stats[\"new_date\"])).\".\";\r\n\t\t\t} else {\r\n\t\t\t\techo \"You will never reach your goal of \".$options[\"goal_weight\"].\" \".$options[\"unit\"].\"s at this rate.\";\r\n\t\t\t}\r\n\t\t\techo \"<br>\";\r\n\t\t\techo \"Adjust to a \".abs($stats[\"daily_variance\"] + $stats[\"extra_variance\"]).\" daily calorie \".($stats[\"daily_variance\"] + $stats[\"extra_variance\"] > 0?\"excess\":\"deficit\").\" to meet your goal.\";\r\n\t\t\tif ($stats[\"new_date\"]) {\r\n\t\t\t\techo \".. or just wait longer!\";\r\n\t\t\t}\r\n\t\t} else {\r\n            // gaining weight in general\r\n            echo \"Warning: You are moving away from your goal.  Change your daily excess into a deficit in order to get back on track!\";\r\n        }\r\n\t}\r\n}\r\n?>", "<?\r\nif (!$wpdb) {\r\n\t// get our db settings without loading all of wordpress every time\r\n\t$html = implode('', file(\"../../../wp-config.php\"));\r\n\t$html = str_replace (\"require_once\", \"// \", $html);\r\n\t$html = str_replace (\"<?php\", \"\", $html);\r\n\t$html = str_replace (\"?>\", \"\", $html);\r\n\teval($html);\r\n\r\n\tmysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\r\n\tmysql_select_db(DB_NAME);\r\n\r\n    if (is_numeric($_POST['user'])) {\r\n    \t$user_id = $_POST[\"user\"];   \r\n    } else {\r\n        exit;\r\n    }\r\n} else {\r\n\t$user_id = $user_ID;\r\n}\r\n\r\nrequire_once(dirname(__FILE__).'/hackersdiet_lib.php');\r\n\r\n$options = hackdiet_get_options($user_id);\r\n\r\nif ($options[\"maint_mode\"]){\r\n       echo \"Maintenance Mode\";\r\n} else {\r\n    if ($options[\"goal_weight\"]) {\r\n        $query = \"select trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_id order by date desc limit 1\";\r\n        $result = mysql_query($query);\r\n        if (mysql_num_rows($result) == 1) {\r\n            $current_trend = mysql_result($result, 0);\r\n            if ($current_trend) {\r\n                $diff = $current_trend - $options[\"goal_weight\"];\r\n                if ($diff > 0) {\r\n                    echo \"<h3 class=\\\"title\\\">Keep going! \" . ($diff) . \" \" . $options[\"unit\"] . \"s to go!</h3>\";\r\n                } else {\r\n                    echo \"<h3 class=\\\"title\\\">YOU DID IT!</h3>\";\r\n                }\r\n            }\r\n        }        \r\n    }\r\n}\r\n?>", "<?php\r\n/*\r\nPlugin Name: The Hacker's Diet\r\nPlugin URI: http://www.afex2win.com/stuff/hackersdiet/\r\nDescription: Track your weight loss online via your blog.  Inspired by John Walker's <a href=\"http://www.fourmilab.ch/hackdiet/\">The Hacker's Diet</a>.  This plugin replaces the Excel files supplied for his original system.\r\nVersion: 0.9.6b\r\nAuthor: Keith 'afex' Thornhill\r\nAuthor URI: http://www.afex2win.com/\r\n*/\r\n$hd_version = \"0.9.6b\";\r\n$hackdiet_user_level = 1;\t// feel free to change this value (1-10) if you want to restrict lower users from using the plugin\r\n\r\n// find URI to plugin dir so ajax calls have correct path\r\npreg_match(\"/.*(\\/wp-content\\/plugins\\/.*)\\/hackersdiet.php$/\", __FILE__, $hd_matches);\r\ndefine(\"PLUGIN_FOLDER_URL\", get_bloginfo('wpurl') . $hd_matches[1]);\r\n$hd_parsed_url = parse_url(PLUGIN_FOLDER_URL);\r\ndefine(\"PLUGIN_PATH\",  $hd_parsed_url['path'] . \"/\");\r\nrequire_once(dirname(__FILE__).'/hackersdiet_lib.php');\r\n\r\nfunction hackdiet_install() {\r\n\tglobal $table_prefix, $wpdb;\r\n\r\n\trequire_once(ABSPATH . 'wp-admin/upgrade-functions.php');\r\n\r\n\t$table_name = $table_prefix . \"hackdiet_weightlog\";\r\n\tif ($wpdb->get_var(\"show tables like '$table_name'\") != $table_name) {\r\n        $sql = \"CREATE TABLE \".$table_name.\" (wp_id BIGINT( 20 ) UNSIGNED NOT NULL, date DATE NOT NULL, weight DOUBLE UNSIGNED NOT NULL DEFAULT '0', trend DOUBLE UNSIGNED NOT NULL DEFAULT '0', rung SMALLINT UNSIGNED NOT NULL DEFAULT '0', PRIMARY KEY ( wp_id, date ))\";\r\n\t\tdbDelta($sql);\r\n\t}\r\n\r\n\t$table_name = $table_prefix . \"hackdiet_settings\";\r\n\tif ($wpdb->get_var(\"show tables like '$table_name'\") != $table_name) {\r\n        $sql = \"CREATE TABLE \".$table_name.\" (wp_id BIGINT UNSIGNED NOT NULL, name VARCHAR( 50 ) NOT NULL, value TEXT NOT NULL, PRIMARY KEY ( wp_id , name ) )\";\r\n\t\tdbDelta($sql);\r\n\t}\r\n}\r\n\r\nfunction hackdiet_add_dashboard_page() {\r\n\tglobal $hackdiet_user_level;\r\n\r\n\tif (function_exists('add_submenu_page')) {\r\n\t\tadd_submenu_page('index.php', 'hackersdiet', 'Hacker\\'s Diet', $hackdiet_user_level, basename(__FILE__), 'hackdiet_option_page');\r\n\t}\r\n}\r\n\r\nfunction hackdiet_js() {\r\n\tglobal $plugin_page;\r\n\tif (basename(__FILE__) == $plugin_page) {\r\n\t\t?>\r\n\t\t<script src=\"<?= PLUGIN_FOLDER_URL?>/prototype.js\" type=\"text/javascript\"></script>\r\n\t\t<script src=\"<?= PLUGIN_FOLDER_URL?>/editinplace.js\" type=\"text/javascript\"></script>\r\n\t\t<script src=\"<?= PLUGIN_FOLDER_URL?>/date-picker/js/datepicker.js\" type=\"text/javascript\"></script>\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"<?= PLUGIN_FOLDER_URL?>/date-picker/css/datepicker.css\" /> \r\n\t\t<?\r\n\t}\r\n}\r\n\r\nfunction hackdiet_option_page() {\r\n\tglobal $table_prefix, $wpdb, $user_ID;\r\n    global $hd_version;\r\n\r\n\t$options = hackdiet_get_options($user_ID);\r\n\r\n\t// first time they open the page, we need to set default unit\r\n\tif (!$options[\"unit\"]) {\r\n\t\t$options[\"unit\"] = \"lb\";\r\n\t\thackdiet_save_options($user_ID, $options);\r\n\t}\r\n\r\n\tif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {\r\n\r\n\t\tif ($_POST[\"goal_date\"] && !$_POST[\"goal_weight\"]) {\r\n\t\t\t// can't plan without a plan\r\n\t\t\t$error = \"So exactly how much would you like to weigh on \" . $_POST[\"goal_date\"] . \"?\";\r\n\t\t} else {\r\n//\t\t\t$options[\"unit\"] = $_POST[\"unit\"];\r\n\r\n\t\t\t$options[\"goal_weight\"] = $_POST[\"goal_weight\"];\r\n\t\t\t$options[\"goal_date\"] = $_POST[\"goal_date\"];\r\n            if ($_POST[\"maint_mode\"]) {\r\n                $options[\"maint_mode\"] = true;\r\n            } else {\r\n                $options[\"maint_mode\"] = \"\";\r\n            }\r\n\r\n\t\t\thackdiet_save_options($user_ID, $options);\r\n\r\n\t\t\tif ($_POST[\"unit\"] != $_POST[\"old_unit\"]) {\r\n\t\t\t\tconvert_weights($_POST[\"old_unit\"], $_POST[\"unit\"]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t?>\r\n\t<?php if ($error):?>\r\n\t<div id=\"message\" class=\"error fade\"><p><strong><?php echo $error?></strong></p></div>\r\n\t<?php elseif ($message):?>\r\n\t<div id=\"message\" class=\"updated fade\"><p><strong><?php echo $message?></strong></p></div>\r\n\t<?php endif;?>\r\n\r\n\t<style>\r\n\t\tfieldset.options {\r\n\t\t    clear:both;\r\n\t\t    border:1px solid #ccc;\r\n\t\t}\r\n\t\tfieldset.options legend {\r\n\t\t    font-family: Georgia,\"Times New Roman\",Times,serif;\r\n\t\t    font-size: 22px;\r\n\t\t}\r\n\t\t.editable {\r\n\t\t\tcolor: #000;\r\n\t\t\tbackground-color: #ffffd3;\r\n\t\t}\r\n\t\t.blankedit {\r\n\t\t\tcolor: #ccc;\r\n\t\t\tfont-size: 9px!important;\r\n\t\t\tfont-style: italic!important;\r\n\t\t\tfont-weight: none!important;\r\n\t\t}\r\n\t\t.weightedit {\r\n\t\t\twidth: 200px;\r\n\t\t\tfont-size: 18px;\r\n\t\t\tfont-weight: bold;\r\n\t\t}\r\n\r\n        .trend_dif {\r\n            font-size: small;\r\n            vertical-align: 50%;\r\n        }\r\n\r\n        .good_trend {\r\n            color: green;\r\n        }\r\n\r\n        .bad_trend {\r\n            color: red;\r\n        }\r\n\r\n\t\t.hackdiet_edit_text {\r\n\t\t\twidth: 50px;\r\n\t\t}\r\n\t\t.hackdiet_edit_button {\r\n\r\n\t\t}\r\n\t\t.hackdiet_cancel_button {\r\n\r\n\t\t}\r\n\t\th3.title {\r\n\t\t\tfont: 100 186%/1.1 constantia, georgia, serif;\r\n\t\t\tcolor: #75C20F;\r\n\t\t\tletter-spacing:-0.02em;\r\n\t\t}\r\n\t\t#hackdiet_zeitgeist {\r\n\t\t\tbackground: #eee;\r\n\t\t\tborder: 1px solid #69c;\r\n\t\t\tfont-size: 90%;\r\n\t\t\tmargin-right: 1em;\r\n\t\t\tmargin-top: 4em;\r\n\t\t\tpadding: 1em;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist h2, fieldset legend a {\r\n\t\t\tborder-bottom: none;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist h2 {\r\n\t\t\tmargin-top: .4em;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist h3 {\r\n\t\t\tborder-bottom: 1px solid #ccc;\r\n\t\t\tfont-size: 16px;\r\n\t\t\tmargin: 1em 0 0;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist h3 cite {\r\n\t\t\tfont-size: 12px;\r\n\t\t\tfont-style: normal;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist li, #zeitgeist p {\r\n\t\t\tmargin: .2em 0;\r\n\t\t}\r\n\r\n\t\t#hackdiet_zeitgeist ul {\r\n\t\t\tmargin: 0 0 .3em .6em;\r\n\t\t\tpadding: 0 0 0 .6em;\r\n\t\t}\r\n\t</style>\r\n\t\r\n\t<div id=\"file_path\" style=\"display: none;\"><?= PLUGIN_PATH ?></div>\r\n    \r\n\t<div class=\"wrap\">\r\n\t\t<h2 id=\"write-post\">The Hacker's Diet</h2>\r\n\r\n\t\t<?\r\n\t\tif ($_GET[\"section\"] == \"reports\") {\r\n\t\t\t/*********************************************\r\n\t\t\t*                                            *\r\n\t\t\t*                                            *\r\n\t\t\t*              REPORTING SCREEN              *\r\n\t\t\t*                                            *\r\n\t\t\t*                                            *\r\n\t\t\t*********************************************/\r\n\r\n\t\t\tif ($_GET[\"show\"] == \"all\") {\r\n\t\t\t\t$query = \"select min(date) as max, max(date) as min from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_ID\";\r\n\t\t\t\t$row = $wpdb->get_row($query);\r\n\t\t\t\t$_GET['start_date'] = $row->max;\r\n\t\t\t\t$_GET['end_date']= $row->min;\r\n\t\t\t}\r\n\r\n\t\t\t?>\r\n\t\t\t<table width=\"100%\">\r\n\t\t\t\t<form method=\"get\" action=\"<?=$_SERVER[\"PHP_SELF\"]?>\">\r\n\t\t\t\t<input type=\"hidden\" name=\"page\" value=\"<?=$_GET[\"page\"]?>\">\r\n\t\t\t\t<input type=\"hidden\" name=\"section\" value=\"<?=$_GET[\"section\"]?>\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td width=\"33%\" align=\"center\">\r\n\t\t\t\t\t\tFrom: <input type=\"text\" id=\"start_date\" name=\"start_date\" class=\"format-y-m-d divider-dash\" value=\"<?=$_GET['start_date']?>\">\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td width=\"33%\" align=\"center\">\r\n\t\t\t\t\t\tTo: <input type=\"text\" id=\"end_date\" name=\"end_date\" class=\"format-y-m-d divider-dash\" value=\"<?=$_GET['end_date']?>\">\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td align=\"center\">\r\n\t\t\t\t\t\t<input type=\"submit\" value=\"run report &gt;\" />\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t</form>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td colspan=\"3\" align=\"center\">\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t\t<img id=\"main_graph\" src=\"<?=PLUGIN_FOLDER_URL?>/hackersdiet_chart.php?user=<?=$user_ID?>&start_date=<?=$_GET['start_date']?>&end_date=<?=$_GET['end_date']?>&goal=<?=$options[\"goal_weight\"]?>&maint_mode=<?=$options[\"maint_mode\"]?>\">\r\n\t\t\t\t\t\t<div id=\"blurb\">\r\n\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\tinclude(dirname(__FILE__).'/ajax_blurb.php');\r\n\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t\t<?\r\n\t\t\t\r\n  \t} else if ($_GET[\"section\"] == \"edit\") {\r\n      /*********************************************\r\n      *                                            *\r\n      *                                            *\r\n      *                 EDIT SCREEN                *\r\n      *                                            *\r\n      *                                            *\r\n      *********************************************/\r\n      echo \"Edit screen not yet implemented... it's next on my list, I promise! :]\";\r\n\t\t} else {\r\n\t\t\t/**********************************************\r\n\t\t\t*                                             *\r\n\t\t\t*                                             *\r\n\t\t\t*                  MAIN PAGE                  *\r\n\t\t\t*                                             *\r\n\t\t\t*                                             *\r\n\t\t\t**********************************************/\r\n\t\t\t?>\r\n\t\t\t<table width=\"100%\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td rowspan=\"2\" width=\"30%\" valign=\"top\">\r\n\t\t\t\t\t\t<input type=\"hidden\" id=\"user_id\" name=\"user_id\" value=\"<?=$user_ID?>\">\r\n\t\t\t\t\t\t<table>\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<th>Date</th>\r\n\t\t\t\t\t\t\t\t<th>Weight (<?=$options[\"unit\"]?>s)</th>\r\n\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t$date_index = strtotime(\"now\");\r\n\t\t\t\t\t\t\t\tfor ($i = 0; $i < 14; ++$i) {\r\n\t\t\t\t\t\t\t\t\t$weight_array[date(\"Y-m-d\", $date_index)] = array(\"weight\" => \"\", \"trend\" => \"\", \"rung\" => \"\");\r\n\t\t\t\t\t\t\t\t\t$date_index = strtotime(\"yesterday\", $date_index);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t$query = \"select date, weight, trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_ID and date > '\".date(\"Y-m-d\", strtotime(\"2 weeks ago\")).\"' order by date desc\";\r\n\t\t\t\t\t\t\t\t$dbweights = $wpdb->get_results($query);\r\n\t\t\t\t\t\t\t\tif ($dbweights) {\r\n\t\t\t\t\t\t\t\t\tforeach ($dbweights as $weight) {\r\n\t\t\t\t\t\t\t\t\t\t$weight_array[$weight->date][\"weight\"] = $weight->weight;\r\n\t\t\t\t\t\t\t\t\t\t$weight_array[$weight->date][\"trend\"] = $weight->trend;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tforeach ($weight_array as $date => $weight) {\r\n                                    $dif = round($weight[\"weight\"] - $weight[\"trend\"], 1);\r\n\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td nowrap align=\"right\"><?=date(\"D n/j\", strtotime($date))?></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><div class=\"weightedit <?=($weight[\"weight\"]?\"\":\"blankedit\")?>\" id=\"weight_<?=strtotime($date)?>\"><?=($weight[\"weight\"]?round($weight[\"weight\"], 1) . \"<span class=\\\"trend_dif \".(($dif < 0)?\"good_trend\":\"bad_trend\").\"\\\">$dif</span>\":\"click here to add a weight\")?></div></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</table>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td align=\"center\" valign=\"top\">\r\n                        <div id=\"togo\">\r\n                        <?\r\n\t\t\t\t\t\t\tinclude(dirname(__FILE__).'/ajax_togo.php');\r\n\t\t\t\t\t\t?>\r\n                        </div>\r\n\t\t\t\t\t\t<img id=\"main_graph\" src=\"<?=PLUGIN_FOLDER_URL?>/hackersdiet_chart.php?user=<?=$user_ID?>&weeks=2&goal=<?=$options[\"goal_weight\"]?>&maint_mode=<?=$options[\"maint_mode\"]?>\">\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td align=\"center\" valign=\"top\" height=\"100%\">\r\n\t\t\t\t\t\t<div id=\"blurb\">\r\n\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\tinclude(dirname(__FILE__).'/ajax_blurb.php');\r\n\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<br>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t\t<table width=\"100%\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td width=\"25%\">\r\n\t\t\t\t\t\t<div id=\"hackdiet_zeitgeist\" align=\"left\">\r\n\t\t\t\t\t\t\t<h2><?php _e('More &raquo;'); ?></h2>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h3><?php _e('Charts'); ?></h3>\r\n\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t$report_url = $_SERVER['PHP_SELF'].\"?page=hackersdiet.php&section=reports\";\r\n\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"<?=$report_url . \"&start_date=\".date(\"Y-m-01\").\"&end_date=\".date(\"Y-m-t\")?>\">Monthly</a></li>\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"<?=$report_url . \"&start_date=\".date(\"Y-m-01\", strtotime(\"-2 months\")).\"&end_date=\".date(\"Y-m-t\")?>\">Quarterly</a></li>\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"<?=$report_url . \"&start_date=\".date(\"Y-01-01\").\"&end_date=\".date(\"Y-m-d\")?>\">Year to date</a></li>\r\n\t\t\t\t\t\t\t\t\t<li><a href=\"<?=$report_url . \"&show=all\"?>\">Complete history</a></li>\r\n\t\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t  <h3><?php _e('Actions') ?></h3>\r\n\t\t\t\t\t\t\t  <ul>\r\n\t\t\t\t\t\t\t    <li><a href=\"<?= $_SERVER['PHP_SELF'].\"?page=hackersdiet.php&section=edit\" ?>\">Edit older weights</a></li>\r\n\t\t\t\t\t\t\t  </ul>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h3><?php _e('Updates'); ?></h3>\r\n\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t\tif ( file_exists(ABSPATH . WPINC . '/rss.php') )\r\n\t\t\t\t\t\t\t\t\t\trequire_once(ABSPATH . WPINC . '/rss.php');\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\trequire_once(ABSPATH . WPINC . '/rss-functions.php');\r\n\r\n\t\t\t\t\t\t\t\t\t$rss = fetch_rss('http://www.afex2win.com/stuff/hackersdiet/feed/');\r\n\t\t\t\t\t\t\t\t\tif ( isset($rss->items) && 0 != count($rss->items) ) {\r\n\t\t\t\t\t\t\t\t\t\t$rss->items = array_slice($rss->items, 0, 3);\r\n\t\t\t\t\t\t\t\t\t\techo \"<ul>\";\r\n\t\t\t\t\t\t\t\t\t\tforeach ($rss->items as $item ) {\r\n\t\t\t\t\t\t\t\t\t\t\t?>\r\n\t\t\t\t\t\t\t\t\t\t\t<li><a href='<?php echo wp_filter_kses($item['link']); ?>'><?php echo wp_specialchars($item['title']); ?></a> &#8212; <?php printf(__('%s ago'), human_time_diff(strtotime($item['pubdate'], time() ) ) ); ?></li>\r\n\t\t\t\t\t\t\t\t\t\t\t<?\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\techo \"</ul>\";\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t?>\r\n                                <br/><br/>(Your version is <?= $hd_version ?>)\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t\t<td>\r\n\t\t\t\t\t\t<fieldset class=\"options\">\r\n\t\t\t\t\t\t\t<legend>Settings</legend>\r\n\t\t\t\t\t\t\t<form method=\"post\">\r\n\t\t\t\t\t\t\t\t<table id=\"weighttable\" width=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<colgroup width=\"20%\" align=\"right\"></colgroup>\r\n                                    <colgroup width=\"30%\" align=\"left\"></colgroup>\r\n                                    <colgroup width=\"20%\" align=\"right\"></colgroup>\r\n                                    <colgroup width=\"30%\" align=\"left\"></colgroup>\r\n                                    <!--\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><b>Unit:</b></td>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" id=\"old_unit\" name=\"old_unit\" value=\"<?=$options[\"unit\"]?>\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" id=\"unit\" name=\"unit\" value=\"lb\" <?=($options[\"unit\"]==\"lb\"?\"checked\":\"\")?>>&nbsp;Pounds (lb)&nbsp;\r\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"radio\" id=\"unit\" name=\"unit\" value=\"kg\" <?=($options[\"unit\"]==\"kg\"?\"checked\":\"\")?>>&nbsp;Kilograms (kg)\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n                                    -->\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><b>Goal Weight:</b></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><input type=\"text\" id=\"goal_weight\" name=\"goal_weight\" value=\"<?=$options[\"goal_weight\"]?>\"></td>\r\n                                        <td>Maintenance mode?</td>\r\n                                        <td>\r\n                                            <input type=\"checkbox\" id=\"maint_mode\" name=\"maint_mode\" <?= ($options[\"maint_mode\"]?\"checked\":\"\") ?>>\r\n                                            <?\r\n                                            if ($options[\"goal_weight\"] && $current_trend <= $options[\"goal_weight\"] && !$options[\"maint_mode\"]) {\r\n                                                echo \"<span class=\\\"bad_trend\\\">Just hit your goal?<br/>Select Maintenance mode.</span>\";\r\n                                            }\r\n                                            ?>\r\n                                        </td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td><b>Goal Date:</b></td>\r\n\t\t\t\t\t\t\t\t\t\t<td><input type=\"text\" id=\"goal_date\" name=\"goal_date\" value=\"<?=($_POST[\"goal_date\"] ? $_POST[\"goal_date\"] : $options[\"goal_date\"])?>\" class=\"format-y-m-d divider-dash range-low-<?= date(\"Y-m-d\") ?>\"></td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td colspan=\"4\">\r\n\t\t\t\t\t\t\t\t\t\t\t<p class=\"submit\"><input type=\"submit\" value=\"save settings &gt;\" /></p>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</form>\r\n\t\t\t\t\t\t</fieldset>\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t\t<?\r\n\t\t}\r\n        ?>\r\n\r\n\t</div>\r\n\t<?\r\n}\r\n\r\nfunction hackdiet_widget_init() {\r\n\tif ( !function_exists('register_sidebar_widget') )\r\n\t\treturn;\r\n\r\n\tfunction widget_hackdiet($args) {\r\n\t\textract($args);\r\n\r\n\t\t// replace this with option from db\r\n\t\t$options = get_option('widget_hackdiet');\r\n\t\t$title = $options['title'];\r\n\r\n\t\techo $before_widget . $before_title . $title . $after_title;\r\n\t\t?>\r\n\t\tHacker's Diet widget not yet designed.\r\n\t\t<?\r\n\t\techo $after_widget;\r\n\t}\r\n\r\n\tfunction widget_hackdiet_control() {\r\n\t\t$options = get_option('widget_hackdiet');\r\n\r\n\t\tif ( !is_array($options) )\r\n\t\t\t$options = array('title'=>'');\r\n\r\n\t\tif ( $_POST['hackdiet-submit'] ) {\r\n\t\t\t$options['title'] = strip_tags(stripslashes($_POST['hackdiet-title']));\r\n\t\t\tupdate_option('widget_hackdiet', $options);\r\n\t\t}\r\n\r\n\t\t$title = htmlspecialchars($options['title'], ENT_QUOTES);\r\n\r\n\t\techo '<p style=\"text-align:right;\"><label for=\"hackdiet-title\">' . __('Title:') . ' <input style=\"width: 200px;\" id=\"hackdiet-title\" name=\"hackdiet-title\" type=\"text\" value=\"'.$title.'\" /></label></p>';\r\n\t\techo '<input type=\"hidden\" id=\"hackdiet-submit\" name=\"hackdiet-submit\" value=\"1\" />';\r\n\t}\r\n\r\n\tregister_sidebar_widget(array('The Hacker\\'s Diet', 'widgets'), 'widget_hackdiet');\r\n\r\n\tregister_widget_control(array('The Hacker\\'s Diet', 'widgets'), 'widget_hackdiet_control', 300, 100);\r\n}\r\n\r\n// hooks\r\nadd_action('admin_menu',                           'hackdiet_add_dashboard_page');\r\nadd_action('admin_head',                           'hackdiet_js');\r\nadd_action('widgets_init',                         'hackdiet_widget_init');\r\n\r\nregister_activation_hook(__FILE__, 'hackdiet_install');\r\n?>", "<?php\r\ninclude (dirname(__FILE__).\"/jpgraph/jpgraph.php\");\r\ninclude (dirname(__FILE__).\"/jpgraph/jpgraph_line.php\");\r\ninclude (dirname(__FILE__).\"/jpgraph/jpgraph_scatter.php\");\r\n\r\n// get our db settings without loading all of wordpress every save\r\n$html = implode('', file(\"../../../wp-config.php\"));\r\n$html = str_replace (\"require_once\", \"// \", $html);\r\n$html = str_replace (\"<?php\", \"\", $html);\r\n$html = str_replace (\"?>\", \"\", $html);\r\neval($html);\r\n\r\nmysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\r\nmysql_select_db(DB_NAME);\r\n\r\nif (!is_numeric($_GET[\"user\"]) || !is_numeric($_GET[\"weeks\"])) {\r\n  exit;\r\n}\r\n\r\n$weeks = $_GET[\"weeks\"];\r\n$start_date = $_GET[\"start_date\"];\r\n$end_date = $_GET[\"end_date\"];\r\n$goal = $_GET[\"goal\"];\r\n$user_id = $_GET[\"user\"];\r\n$maint_mode = $_GET[\"maint_mode\"];\r\n\r\nif ($weeks) {\r\n\t$query = \"select date, weight, trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = \\\"\" . $user_id . \"\\\" and date > \\\"\".date(\"Y-m-d\", strtotime(\"$weeks weeks ago\")).\"\\\" order by date asc\";\r\n} else if ($start_date and $end_date) {\r\n\t$query = \"select date, weight, trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = \\\"\" . $user_id . \"\\\" and date >= \\\"$start_date\\\" and date <= \\\"$end_date\\\" order by date asc\";\r\n}\r\n\r\n$result = mysql_query($query);\r\nif (mysql_num_rows($result)) {\r\n\tif (mysql_num_rows($result) == 1) {\r\n\t\t// only one day, gotta finagle the display\r\n\r\n\t\t$row = mysql_fetch_assoc($result);\r\n\r\n\t\t// fake day before\r\n\t\t$weight_data[] = 0;\r\n\t\tif ($goal > 0) {\r\n\t\t\t$goal_data[] = $goal;\r\n\t\t}\r\n\t\t$x_data[] = date(\"n/j\", strtotime(\"yesterday\", strtotime($row[\"date\"])));\r\n\r\n\t\t// data\r\n\t\t$weight_data[] = $row[\"weight\"];\r\n\t\tif ($goal > 0) {\r\n\t\t\t$goal_data[] = $goal;\r\n\t\t}\r\n\t\t$x_data[] = date(\"n/j\", strtotime($row[\"date\"]));\r\n\t\t\r\n\t\t// fake day after\r\n\t\t$weight_data[] = 0;\r\n\t\tif ($goal > 0) {\r\n\t\t\t$goal_data[] = $goal;\r\n\t\t}\r\n\t\t$x_data[] = date(\"n/j\", strtotime(\"tomorrow\", strtotime($row[\"date\"])));\r\n\t} else {\r\n\t\t$num_rows = mysql_num_rows($result);\r\n\t\tif ($num_rows <= 7 * 2) { // 0-2 weeks\r\n\t\t\t$ticks = \"daily\";\r\n\t\t} else if ($num_rows <= 31 * 4) { // 2 weeks - 4 months\r\n\t\t\t$ticks = \"weekly\";\r\n\t\t} else { // 4 months +\r\n\t\t\t$ticks = \"monthly\";\r\n\t\t}\r\n\r\n\t\t$count = 1;\r\n\t\twhile ($row = mysql_fetch_assoc($result)) {\r\n\t\t\t$weight_data[] = $row[\"weight\"];\r\n\t\t\t$trend_data[] = $row[\"trend\"];\r\n\t\t\tif ($goal > 0) {\r\n\t\t\t\t$goal_data[] = $goal;\r\n\t\t\t}\r\n\t\t\tswitch ($ticks) {\r\n\t\t\t\tcase \"weekly\":\r\n\t\t\t\t\tif ($count == 1) {\r\n\t\t\t\t\t\t$x_data[] = date(\"n/j\", strtotime($row[\"date\"]));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$x_data[] = \"\";\r\n\t\t\t\t\t\tif ($count == 7) {\r\n\t\t\t\t\t\t\t$count = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"monthly\":\r\n\t\t\t\t\tif (date(\"j\", strtotime($row[\"date\"])) == \"1\") {\r\n\t\t\t\t\t\t$x_data[] = date(\"n/j\", strtotime($row[\"date\"]));\t\t\t\t\t\t\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$x_data[] = \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"daily\":\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t$x_data[] = date(\"n/j\", strtotime($row[\"date\"]));\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t$count++;\r\n\t\t}\r\n\t}\r\n} else {\r\n\t$trend_data[] = 0;\r\n\t$trend_data[] = 0;\r\n\t$x_data[] = date(\"n/j\", strtotime(\"yesterday\"));\r\n\t$x_data[] = date(\"n/j\", strtotime(\"today\"));\r\n}\r\n\r\nif ($weight_data) {\r\n\t$lowest_weight = $weight_data[0];\r\n\tforeach ($weight_data as $weight_entry) {\r\n\t\tif ($goal) {\r\n\t\t\tif ($weight_entry < $goal) {\r\n\t\t\t\t$to_check = $weight_entry;\r\n\t\t\t} else {\r\n\t\t\t\t$to_check = $goal;\r\n\t\t\t}\r\n\t\t\tif ($to_check < $lowest_weight) {\r\n\t\t\t\t$lowest_weight = $to_check;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif ($weight_entry < $lowest_weight) {\r\n\t\t\t\t$lowest_weight = $weight_entry;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n} else {\r\n\t$lowest_weight = $trend_data[0] + 1;\r\n}\r\n\r\n\r\n$graph = new Graph(600,300,\"auto\");\r\n$graph->SetScale(\"textlin\");\r\n$graph->legend->SetLayout(LEGEND_HOR);\r\n$graph->legend->Pos(0.5, 0.1, \"center\", \"bottom\");\r\n$graph->SetClipping();\r\n\r\nif ($x_data) {\r\n\t$graph->xaxis->SetTickLabels($x_data); \r\n}\r\n\r\nif ($weight_data) {\r\n\t$sp1 = new ScatterPlot($weight_data);\r\n    $sp1->SetLegend(\"Daily Weight\");\r\n\t$graph->Add($sp1);\r\n}\r\n\r\nif ($trend_data) {\r\n\t$trendplot=new LinePlot($trend_data);\r\n\t$trendplot->SetColor(\"red\");\r\n    $trendplot->SetLegend(\"Trend\");\r\n\t$graph->Add($trendplot);\r\n}\r\n\r\nif ($goal > 0) {\r\n\t$graph->yaxis->scale->SetAutoMin($lowest_weight - 1); \r\n\r\n\t$goalplot = new PlotLine (HORIZONTAL, $goal, \"green\" ,2);\r\n\t$graph->Add($goalplot);\r\n\r\n    // PlotLine don't support SetLegend, so we fake it thusly\r\n\t$fakegoal=new LinePlot($temp = 0);\r\n\t$fakegoal->SetColor(\"green\");\r\n    $fakegoal->SetLegend(\"Goal\");\r\n    $graph->Add($fakegoal);\r\n\r\n    if ($maint_mode) {\r\n\t\tif ($graph->yscale->autoscale_max == null || $graph->yscale->autoscale_max > $goal + 2) {\r\n\t        $upperplot = new PlotLine (HORIZONTAL, $goal + 2.5, \"blue\", 1);\r\n\t        $graph->AddLine($upperplot);\t\t\t\r\n\t\t}\r\n\t\tif ($graph->yscale->autoscale_min == null || $graph->yscale->autoscale_min < $goal - 2) {\r\n\t        $lowerplot = new PlotLine (HORIZONTAL, $goal - 2.5, \"blue\", 1); \r\n\t        $graph->AddLine($lowerplot);\r\n\t\t}\r\n\r\n      \t$bound=new LinePlot($temp = 0);\r\n        $bound->SetColor(\"blue\");\r\n        $bound->SetLegend(\"Boundaries\");\r\n        $graph->Add($bound);\r\n    }\r\n}\r\n\r\n$graph->Stroke();\r\n?>", "=== The Hacker's Diet ===\r\nContributors: afex\r\nTags: diet, weight loss, graph, chart\nRequires at least: 2.0.7\r\nTested up to: 2.1.3\r\nStable tag: 0.9.7b\r\n\r\nHelps you track and predict weight loss using your Wordpress blog.  Daily weight entry, trend calculations, and more.\r\n\r\n== Description ==\r\n\r\nWant to lose weight?  Need help?  Use Wordpress? (of course you do!)\r\n\r\nThe Hacker's Diet is a simple way to count calories and track your weight to make sure you are really losing the pounds.  By calculating your average weight, you don't have to be scared of those days when you \"gain\" 2 pounds overnight.  You'll see exactly your rate of weight loss and be able to predict when you will hit your weight goal.\r\n\r\nThis plugin serves to provide a web-based version of the Excel spreadsheets provided by the diet plan.  This lets you use the familiar interface of your blog to keep up-to-date on your diet.  After you hit your weight goal, it helps you maintain your weight by keeping you within a set window around your goal.\r\n\r\n== Installation ==\r\n\r\n1. Extract and upload the contents of the zip file to the `/wp-content/plugins/` directory\r\n1. Activate the plugin through the 'Plugins' menu in WordPress\r\n1. Click the menu link on the Dashboard home page\r\n\r\n== Frequently Asked Questions ==\r\n\r\n= Do I *have* to weigh myself everyday? =\r\n\r\nNope.  If you skip a day (or 6) your trend will just be calculated based off whenever your last weigh-in was.  Obviously, weighing yourself everyday will give you the most accurate trend.\r\n\n= Can multiple users log their weights? =\n\nYes! Weight entries are saved per user, so anybody that has access to your blog's dashboard can log their weights.  Note: edit the `$hackdiet_user_level` variable at the top of `hackersdiet.php` to restrict access.\n\r\n= What does the sidebar widget do? =\r\n\r\nNothing yet.  Got a good idea?  Let me know.\r\n\n= Why isn't the plugin version 1.0 yet? =\n\nI don't consider my plugin complete until I have a story in place for viewing and editing historical weight entries.  Once I have that, I can consider it \"feature complete\".\n\r\n== Screenshots ==\r\n\r\n1. Dashboard integration\r\n2. Daily weight entry\r\n3. Flickr-style \"edit in place\"\r\n4. Main graph.  Weight history over the last two weeks.\r\n5. Settings\r\n6. Reporting and plugin update notifications\r\n7. Custom timespan charts", "The Hacker's Diet - A Wordpress Plugin\r\nWritten By: Keith 'afex' Thornhill - www.afex2win.com\r\n\r\n\r\nInstallation:\r\n-------------\r\n\r\n1. Unzip\r\n2. Upload (wp-content/plugins)\r\n3. Activate\r\n4. Lose Weight\r\n5. ???\r\n6. Profit!\r\n\r\n\r\nVersions:\r\n---------\nv0.9.7b - 4/30/2007\n---\nStubbed out editor section in code, hopefully will find time to implement in near future.\nCleaned up some code so the plugin is safer for public exposure\n\nv0.9.6b - 4/10/2007\n---\nFigured out how to activate and reference paths in a general way so plugin directory name can be arbitrary.\n\nv0.9.5b - 4/3/2007\n---\nUpdated installation instructions to specify plugin directory name.  Hopefully this limitation can be worked around in a future version.\n\r\nv0.9.4b - 4/1/2007\r\n---\r\nAdded legend and boundary lines to weight chart\r\n\r\nv0.9.3b - 1/31/2007\r\n---\r\nChanged use of SCRIPT_NAME server var to PHP_SELF in order to support PHP as CGI installs\r\n\r\nv0.9.2b - 1/24/2007\r\n---\r\nChanged use of innerText to innerHTML for IE/Firefox compatibility\r\nAdded current version number below updates RSS feed\r\n\"X lbs to go\" code assumed you had at least one trend in the db, for new installations this isn't the case.\r\n\r\nv0.9.1b - 1/19/2007\r\n---\r\nFixed table creation SQL to be compatible with MySQL 3.23\r\nFixed table name for setting table to use defined prefix\r\nAdded support for wordpress being installed in a subdirectory other than '/wp' (oops)\r\n\r\nv0.9b - 1/17/2007\r\n---\r\nPublic release\r\n\r\n\r\nThird party code:\r\n-----------------\r\nJpgraph - http://www.aditus.nu/jpgraph/\r\nDatePicker v2.7 - frequency-decoder.com", "<?\r\n// get our db settings without loading all of wordpress every save\r\n$html = implode('', file(\"../../../wp-config.php\"));\r\n$html = str_replace (\"require_once\", \"// \", $html);\r\n$html = str_replace (\"<?php\", \"\", $html);\r\n$html = str_replace (\"?>\", \"\", $html);\r\neval($html);\r\n\r\nif (isset($_POST[\"id\"]) && isset($_POST[\"user\"]) && is_numeric($_POST[\"user\"]) && isset($_POST[\"content\"]) && is_numeric($_POST[\"content\"])) {\r\n\t$date = substr($_POST[\"id\"], 7);\r\n\t$user_id = $_POST[\"user\"];\r\n\t$weight = round($_POST[\"content\"], 1);\r\n} else {\r\n\t//print_r($_POST);\r\n\techo \"Please enter a valid number for your weight.\";\r\n\texit;\r\n}\r\n\r\nmysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\r\nmysql_select_db(DB_NAME);\r\n\r\n$query = \"update \".$table_prefix.\"hackdiet_weightlog set weight = $weight where wp_id = $user_id and date = \\\"\".date(\"Y-m-d\", $date).\"\\\"\";\r\nmysql_query($query);\r\nif (mysql_affected_rows() != 1) {\r\n\t// record doesn't exist yet, lets create it\r\n\t$query = \"insert into \".$table_prefix.\"hackdiet_weightlog set date = \\\"\".date(\"Y-m-d\", $date).\"\\\", weight = $weight, wp_id = $user_id\";\r\n\tmysql_query($query);\r\n\tif (mysql_affected_rows() != 1) {\r\n\t\techo \"Save failed. - \" . mysql_error();\r\n\t\texit();\r\n\t} else {\r\n\t\techo htmlspecialchars($weight);\r\n\t}\r\n} else {\r\n\techo htmlspecialchars($weight);\r\n}\r\n\r\n$query = \"select trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_id and date < \\\"\".date(\"Y-m-d\", $date).\"\\\" order by date desc limit 1\";\r\n$result = mysql_query($query);\r\nif (mysql_num_rows($result) == 1) {\r\n\t$trend = mysql_result($result, 0);\r\n\t$use_first_weight_as_trend = false;\r\n} else {\r\n\t// no trends exist below this entry, we must be first.  so in next query, we need to grab today's weight to be trend 1\r\n\t$use_first_weight_as_trend = true;\r\n}\r\n\r\n$query = \"select date, weight, trend from \".$table_prefix.\"hackdiet_weightlog where wp_id = $user_id and date >= \\\"\".date(\"Y-m-d\", $date).\"\\\" order by date asc\";\r\n$result = mysql_query($query);\r\nwhile ($entry = mysql_fetch_assoc($result)) {\r\n\tif ($use_first_weight_as_trend) {\r\n\t\t$trend = $entry[\"weight\"];\r\n\t\t$use_first_weight_as_trend = false;\r\n\t} else {\r\n\t\t// exponentially smoothed moving average with 10% smoothing\r\n\t\t$trend = $trend + 0.1 * ($entry[\"weight\"] - $trend);\r\n\t}\r\n\t$entry[\"trend\"] = $trend;\r\n\t$weights[] = $entry;\r\n}\r\n\r\nforeach ($weights as $entry) {\r\n\t$query = \"update \".$table_prefix.\"hackdiet_weightlog set trend = \".round($entry[\"trend\"], 1).\" where wp_id = $user_id and date = \\\"\".$entry[\"date\"].\"\\\"\";\r\n\tmysql_query($query);\r\n}\r\n\r\n// 0 will always be the edited date, since the list contains the edited entry + all the ones after it, sorted asc.\r\n$dif = round($weights[0][\"weight\"] - $weights[0][\"trend\"], 1);\r\n\r\necho \"<span class=\\\"trend_dif \".(($dif < 0)?\"good_trend\":\"bad_trend\").\"\\\">$dif</span>\";\r\n?>"], "filenames": ["ajax_blurb.php", "ajax_togo.php", "hackersdiet.php", "hackersdiet_chart.php", "readme.txt", "release.txt", "weight_save.php"], "buggy_code_start_loc": [13, 13, 243, 15, 3, 17, 14], "buggy_code_end_loc": [14, 14, 379, 27, 7, 17, 15], "fixing_code_start_loc": [13, 13, 244, 16, 3, 18, 14], "fixing_code_end_loc": [18, 18, 395, 31, 7, 23, 15], "type": "CWE-89", "message": "A vulnerability, which was classified as critical, has been found in The Hackers Diet Plugin up to 0.9.6b on WordPress. This issue affects some unknown processing of the file ajax_blurb.php of the component HTTP POST Request Handler. The manipulation of the argument user leads to sql injection. The attack may be initiated remotely. Upgrading to version 0.9.7b is able to address this issue. The patch is named 7dd8acf7cd8442609840037121074425d363b694. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-243803.", "other": {"cve": {"id": "CVE-2007-10003", "sourceIdentifier": "cna@vuldb.com", "published": "2023-10-29T18:15:38.687", "lastModified": "2024-02-29T01:07:49.613", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as critical, has been found in The Hackers Diet Plugin up to 0.9.6b on WordPress. This issue affects some unknown processing of the file ajax_blurb.php of the component HTTP POST Request Handler. The manipulation of the argument user leads to sql injection. The attack may be initiated remotely. Upgrading to version 0.9.7b is able to address this issue. The patch is named 7dd8acf7cd8442609840037121074425d363b694. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-243803."}, {"lang": "es", "value": "Una vulnerabilidad clasificada como cr\u00edtica ha sido encontrada en The Hackers Diet Plugin hasta 0.9.6b en WordPress. Este problema afecta un procesamiento desconocido del archivo ajax_blurb.php del componente HTTP POST Request Handler. La manipulaci\u00f3n del argumento usuario conduce a la inyecci\u00f3n SQL. El ataque puede iniciarse de forma remota. La actualizaci\u00f3n a la versi\u00f3n 0.9.7b puede solucionar este problema. El parche se llama 7dd8acf7cd8442609840037121074425d363b694. Se recomienda actualizar el componente afectado. El identificador asociado de esta vulnerabilidad es VDB-243803."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:wp-plugins:the_hackers_diet:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "0.9.7b", "matchCriteriaId": "AA2AC298-3E4D-4DC7-89F9-95A3DD26E58F"}]}]}], "references": [{"url": "https://github.com/wp-plugins/the-hackers-diet/commit/7dd8acf7cd8442609840037121074425d363b694", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/wp-plugins/the-hackers-diet/releases/tag/0.9.7b", "source": "cna@vuldb.com", "tags": ["Release Notes"]}, {"url": "https://vuldb.com/?ctiid.243803", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.243803", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/wp-plugins/the-hackers-diet/commit/7dd8acf7cd8442609840037121074425d363b694"}}