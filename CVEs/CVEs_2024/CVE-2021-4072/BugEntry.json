{"buggy_code": ["<?php\n/**\n * Elgg report action\n */\n$title = get_input('title');\n$description = get_input('description');\n$address = get_input('address');\n$access = ACCESS_PRIVATE; //this is private and only admins can see it\n\n$fail = function () use ($address) {\n\treturn elgg_error_response(elgg_echo('reportedcontent:failed'), $address);\n};\n\nif (!$title || !$address) {\n\t$fail();\n}\n\n$report = new ElggReportedContent();\n$report->owner_guid = elgg_get_logged_in_user_guid();\n$report->title = $title;\n$report->address = $address;\n$report->description = $description;\n$report->access_id = $access;\n\nif (!$report->save()) {\n\t$fail();\n}\n\nif (!elgg_trigger_plugin_hook('reportedcontent:add', 'system', ['report' => $report], true)) {\n\t$report->delete();\n\t$fail();\n}\n\n$report->state = 'active';\n\nreturn elgg_ok_response('', elgg_echo('reportedcontent:success'), $address);\n"], "fixing_code": ["<?php\n/**\n * Elgg report action\n */\n$title = get_input('title');\n$description = get_input('description');\n$address = get_input('address');\n$access = ACCESS_PRIVATE; //this is private and only admins can see it\n\n$fail = function () use ($address) {\n\treturn elgg_error_response(elgg_echo('reportedcontent:failed'), $address);\n};\n\nif (!$title || !$address) {\n\t$fail();\n}\n\n$report = new ElggReportedContent();\n$report->owner_guid = elgg_get_logged_in_user_guid();\n$report->title = $title;\n$report->address = elgg_normalize_site_url($address);\n$report->description = $description;\n$report->access_id = $access;\n\nif (!$report->save()) {\n\t$fail();\n}\n\nif (!elgg_trigger_plugin_hook('reportedcontent:add', 'system', ['report' => $report], true)) {\n\t$report->delete();\n\t$fail();\n}\n\n$report->state = 'active';\n\nreturn elgg_ok_response('', elgg_echo('reportedcontent:success'), $address);\n"], "filenames": ["mod/reportedcontent/actions/reportedcontent/add.php"], "buggy_code_start_loc": [21], "buggy_code_end_loc": [22], "fixing_code_start_loc": [21], "fixing_code_end_loc": [22], "type": "CWE-79", "message": "elgg is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')", "other": {"cve": {"id": "CVE-2021-4072", "sourceIdentifier": "security@huntr.dev", "published": "2021-12-24T14:15:07.327", "lastModified": "2022-01-03T20:45:56.577", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "elgg is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"}, {"lang": "es", "value": "elgg es vulnerable a una Neutralizaci\u00f3n Inapropiada de Entradas Durante la Generaci\u00f3n de P\u00e1ginas Web (\"Cross-site Scripting\")"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.0, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.3, "impactScore": 6.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security@huntr.dev", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:elgg:elgg:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.3.24", "matchCriteriaId": "70C7A42D-7B0A-4E60-B21A-6545A72F3B30"}]}]}], "references": [{"url": "https://github.com/elgg/elgg/commit/c30b17bf75256ed3fcc84e2083147cc3951423d0", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/74034253-732a-4251-a0f9-eca5f576c955", "source": "security@huntr.dev", "tags": ["Exploit", "Issue Tracking", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/elgg/elgg/commit/c30b17bf75256ed3fcc84e2083147cc3951423d0"}}