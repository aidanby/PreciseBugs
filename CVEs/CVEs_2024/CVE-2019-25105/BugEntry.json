{"buggy_code": ["<?php \n\trequire('api/dbconn.php');\n\trequire('api/functions.php');\n\n\tif (!isset($_FILES['f'])) {\n\t\theader(\"HTTP/1.1 400 Bad Request\");\n\t\tdie(\"No file given?\");\n\t}\n\n\t$retval = \"1\";\n\n\t$expireAfterDownload = '0';\n\tif (isset($_GET['expireAfterDownload']) && $_GET['expireAfterDownload'] == 'true') {\n\t\t$expireAfterDownload = '1';\n\t}\n\n\tif (empty($_GET['secret'])) {\n\t\tif ($_SERVER['HTTP_USER_AGENT'] == 'cli' || $_SERVER['HTTP_USER_AGENT'] == 'dro.pm-androidapp') {\n\t\t\tlist($secret, $key) = allocate();\n\t\t\t$retval = \"$secret dro.pm/$key\";\n\t\t}\n\t\telse {\n\t\t\tdie('Missing required parameter.');\n\t\t}\n\t}\n\telse {\n\t\t$secret = $db->escape_string($_GET['secret']);\n\t\t\n\t\t$key = $db->query('SELECT `key` FROM `shorts` WHERE `secret` = \"' . $secret . '\"') or die('Database error 3984');\n\t\tif ($key->num_rows != 1) {\n\t\t\tdie(\"?secret=$secret not found\");\n\t\t}\n\t\t$key = $key->fetch_row()[0];\n\t}\n\n\t$success = move_uploaded_file($_FILES['f']['tmp_name'], 'uploads/' . $key);\n\tif (!$success) {\n\t\tdie('Error moving file.<script>alert(\"Error 500 uploading file.\");</script>');\n\t}\n\n\t$data = array('original_filename' => $_FILES['f']['name'], 'filename' => $key);\n\t$data = $db->escape_string(serialize($data));\n\t$db->query('UPDATE `shorts` SET `expires` = ' . (time() + (12*3600)) . ', `type` = 2, `value` = \"' . $data . '\", expireAfterDownload = ' . $expireAfterDownload . ' WHERE `secret` = \"' . $secret . '\"') or die('Database error 29348');\n\n\tdie($retval);\n\n"], "fixing_code": ["<?php \n\trequire('api/dbconn.php');\n\trequire('api/functions.php');\n\n\tif (!isset($_FILES['f'])) {\n\t\theader(\"HTTP/1.1 400 Bad Request\");\n\t\tdie(\"No file given?\");\n\t}\n\n\t$retval = \"1\";\n\n\t$expireAfterDownload = '0';\n\tif (isset($_GET['expireAfterDownload']) && $_GET['expireAfterDownload'] == 'true') {\n\t\t$expireAfterDownload = '1';\n\t}\n\n\tif (empty($_GET['secret'])) {\n\t\tif ($_SERVER['HTTP_USER_AGENT'] == 'cli' || $_SERVER['HTTP_USER_AGENT'] == 'dro.pm-androidapp') {\n\t\t\tlist($secret, $key) = allocate();\n\t\t\t$retval = htmlspecialchars($secret) . ' dro.pm/' . htmlspecialchars($key);\n\t\t}\n\t\telse {\n\t\t\tdie('Missing required parameter.');\n\t\t}\n\t}\n\telse {\n\t\t$secret = $_GET['secret'];\n\n\t\t$key = $db->query('SELECT `key` FROM `shorts` WHERE `secret` = \"' . $db->escape_string($secret) . '\"') or die('Database error 3984');\n\t\tif ($key->num_rows != 1) {\n\t\t\tdie('?secret=' . htmlspecialchars($secret) . ' not found');\n\t\t}\n\t\t$key = $key->fetch_row()[0];\n\t}\n\n\t$success = move_uploaded_file($_FILES['f']['tmp_name'], 'uploads/' . $key);\n\tif (!$success) {\n\t\tdie('Error moving file.<script>alert(\"Error 500 uploading file.\");</script>');\n\t}\n\n\t$data = ['original_filename' => $_FILES['f']['name'], 'filename' => $key];\n\t$data = $db->escape_string(serialize($data));\n\t$db->query('UPDATE `shorts` SET `expires` = ' . (time() + (12*3600)) . ', `type` = 2, `value` = \"' . $data . '\", expireAfterDownload = ' . $expireAfterDownload\n\t\t. ' WHERE `secret` = \"' . $db->escape_string($secret) . '\"') or die('Database error 29348');\n\n\tdie($retval);\n\n"], "filenames": ["web/fileman.php"], "buggy_code_start_loc": [20], "buggy_code_end_loc": [44], "fixing_code_start_loc": [20], "fixing_code_end_loc": [45], "type": "CWE-79", "message": "A vulnerability, which was classified as problematic, was found in dro.pm. This affects an unknown part of the file web/fileman.php. The manipulation of the argument secret/key leads to cross site scripting. It is possible to initiate the attack remotely. This product does not use versioning. This is why information about affected and unaffected releases are unavailable. The name of the patch is fa73c3a42bc5c246a1b8f815699ea241aef154bb. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-221763.", "other": {"cve": {"id": "CVE-2019-25105", "sourceIdentifier": "cna@vuldb.com", "published": "2023-02-26T08:15:09.547", "lastModified": "2023-03-07T19:08:35.110", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, was found in dro.pm. This affects an unknown part of the file web/fileman.php. The manipulation of the argument secret/key leads to cross site scripting. It is possible to initiate the attack remotely. This product does not use versioning. This is why information about affected and unaffected releases are unavailable. The name of the patch is fa73c3a42bc5c246a1b8f815699ea241aef154bb. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-221763."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:dro.pm_project:dro.pm:-:*:*:*:*:*:*:*", "matchCriteriaId": "7405BD41-B2CE-4E81-8E23-527A7AA9C8D1"}]}]}], "references": [{"url": "https://github.com/lgommans/dro.pm/commit/fa73c3a42bc5c246a1b8f815699ea241aef154bb", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://vuldb.com/?ctiid.221763", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.221763", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/lgommans/dro.pm/commit/fa73c3a42bc5c246a1b8f815699ea241aef154bb"}}