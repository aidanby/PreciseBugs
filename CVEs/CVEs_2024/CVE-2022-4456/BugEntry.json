{"buggy_code": ["<p>\n  <b><%= translate(\"changes.recent_changes\") %></b>\n</p>\n\n<%\nlast_days_ago = nil\n@changes.each do |c|\n  next if c[\"description\"] == \"grafted\" and (not user_signed_in? or not current_user.is? :grafter)\n  types = c[\"type_title\"]\n  unless c[\"country\"].nil?\n    city = [c[\"city\"],c[\"state\"],c[\"country\"]].compact.join(\", \")\n  end\n  # i18n-tasks-use t('changes.type.added') t('changes.type.edited') t('changes.type.grafted') t('changes.type.visited')\n  action = translate(\"changes.type.#{c['description']}\")\n  c[\"days_ago\"] = c[\"days_ago\"].to_i\n  if last_days_ago.nil? or c[\"days_ago\"] > last_days_ago\n    if c[\"days_ago\"] <= 0\n      header = translate(\"time.last_24_hours\")\n    else\n      header = translate(\"time.time_ago\", :time => (translate(\"time.days\", :count => c[\"days_ago\"])))\n    end\n    if last_days_ago.nil?\n      header = \"<span>\" + header + \"</span><blockquote>\"\n    else\n      header = \"</blockquote><span>\" + header + \"</span><blockquote>\"\n    end\n    last_days_ago = c[\"days_ago\"]\n  end\n  %>\n  <%= raw header %>\n  <% unless c[\"location_id\"].nil? %>\n    <%= link_to location_path(c[\"location_id\"]) do %>\n      <span><%= types.nil? ? translate(\"glossary.unknown\") : types %></span>\n    <% end %>\n    (#<%= c[\"location_id\"] %>)\n    <% unless city.nil? %>\n      <span><%= translate(\"changes.change_in_city\", :type => action, :city => city) %></span>\n    <% else %>\n      <span><%= action %></span>\n    <% end %>\n    <% if user_signed_in? and current_user.is? :admin %>\n      &middot; <span style=\"color: #E35809;\">\n      <% if c[\"user_id\"].nil? %>\n        <%= c[\"remote_ip\"] %>\n      <% else %>\n        <span><%= translate(\"glossary.user\") %> #<%= c[\"user_id\"] %></span>\n      <% end %>\n      </span>\n    <% end %>\n    <br>\n  <% end %>\n<% end %>\n<% if @changes.length > 0 %>\n  </blockquote>\n<% end %>\n", "<%= link_to(\"[+] \" + translate(\"layouts.application.menu.list_imports\"), datasets_path) %>\n\n<table style=\"border-collapse:separate;border-spacing:0 2em;\">\n<tr>\n  <td style=\"vertical-align:top;text-align:right;padding:2em 1.5em 0 0;\">\n    #<%= @import.id %>\n    <% if user_signed_in? and current_user.is? :admin %>\n      <br/><%= link_to(translate(\"glossary.edit\"),edit_import_path(@import.id)) %>\n    <% end %>\n  </td>\n  <td style=\"padding:2em;background-color:#fafafa;\">\n\n  <!-- Name, URL -->\n  <b><%= @import.name %></b><br />\n  <% unless @import.url.blank? %>\n    <%= link_to @import.url do %>\n    <%= !@import.url.match('google.com/maps|maps.google').nil? ? translate(\"pages.datasets.google_map\") : (!@import.url.match('google.com/fusiontables').nil? ? translate(\"pages.datasets.google_fusion_table\") : (!@import.url.match('mapsengine.google').nil? ? translate(\"pages.datasets.google_maps_engine\") : @import.url)) %>\n    <% end %><br />\n  <% end %>\n\n  <!-- Type, Date -->\n  <%= @import.muni ? translate(\"glossary.tree_inventory\", :count => 1) : translate(\"pages.datasets.community_map\") %> | <%= translate(\"glossary.imported\") %> <i><%= @import.created_at.to_s %></i><br />\n\n  <hr style=\"border:1px solid #eee;margin:1.5em 0;\">\n\n  <span style=\"font-size:100%;\">\n  <!-- Comments -->\n  <% unless @import.comments.blank? %>\n    <%= raw @import.comments.gsub(\"\\n\",\"<br>\") %><br /><br />\n  <% end %>\n\n  <!-- License -->\n  <% unless @import.license.blank? %>\n    <%= raw @import.license.gsub(\"\\n\",\"<br>\") %>\n  <% else %>\n    <i><%= translate(\"pages.datasets.no_license\").html_safe %></i>\n  <% end %>\n  </span>\n\n  </td>\n</tr>\n</table>\n", "<!DOCTYPE html>\n<html xmlns:fb=\"http://ogp.me/ns/fb#\">\n<head>\n\n  <!-- Metadata -->\n  <title>Falling Fruit</title>\n  <meta name=\"keywords\" content=\"map, urban, harvest, edible, forage, glean, tree, inventory, plant, fruit, nut, berry, food, freegan, dumpster, community, Falling Fruit, Ethan Welty, Caleb Phillips, Jeff Wanner\" />\n  <meta property=\"og:site_name\" content=\"Falling Fruit\" />\n  <meta property=\"og:type\" content=\"website\" />\n  <meta property=\"fb:admins\" content=\"10708811\" /><!-- Ethan Welty -->\n  <meta property=\"fb:admins\" content=\"42001954\" /><!-- Caleb Phillips -->\n  <meta property=\"fb:admins\" content=\"5246945\" /><!-- Jeff Wanner -->\n\n  <% if (I18n.locale == :en) %>\n    <meta property=\"og:locale\" content=\"en_US\" />\n  <% elsif (I18n.locale == :\"es\") %>\n    <meta property=\"og:locale\" content=\"es_LA\" />\n  <% elsif (I18n.locale == :es) %>\n    <meta property=\"og:locale\" content=\"de_DE\" />\n  <% elsif (I18n.locale == :fr) %>\n    <meta property=\"og:locale\" content=\"fr_FR\" />\n  <% elsif (I18n.locale == :\"pt-br\") %>\n    <meta property=\"og:locale\" content=\"pt_BR\" />\n  <% elsif (I18n.locale == :\"it\") %>\n    <meta property=\"og:locale\" content=\"it_IT\" />\n  <% elsif (I18n.locale == :\"el\") %>\n    <meta property=\"og:locale\" content=\"el_GR\" />\n  <% elsif (I18n.locale == :\"pl\") %>\n    <meta property=\"og:locale\" content=\"pl_PL\" />\n  <% elsif (I18n.locale == :\"nl\") %>\n    <meta property=\"og:locale\" content=\"nl_NL\" />\n  <% end %>\n  <meta property=\"og:locale:alternate\" content=\"en_US\" />\n  <meta property=\"og:locale:alternate\" content=\"es_LA\" />\n  <meta property=\"og:locale:alternate\" content=\"de_DE\" />\n  <meta property=\"og:locale:alternate\" content=\"fr_FR\" />\n  <meta property=\"og:locale:alternate\" content=\"pt_BR\" />\n  <meta property=\"og:locale:alternate\" content=\"it_IT\" />\n  <meta property=\"og:locale:alternate\" content=\"el_GR\" />\n  <meta property=\"og:locale:alternate\" content=\"pl_PL\" />\n  <meta property=\"og:locale:alternate\" content=\"nl_NL\" />\n\n  <% if @freegan %>\n    <meta property=\"og:title\" content=\"<%= translate(\"meta.freegan_title\") %>\" />\n    <meta property=\"og:url\" content=\"http://fallingfruit.org/dumpsters?locale=<%= I18n.locale %>\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/dumpster-sticker.png\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/dumpster-sticker-01.jpg\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/dumpster-haul.jpg\" />\n    <meta property=\"og:description\" content=\"<%= translate(\"meta.freegan_description\") %>\" />\n    <meta name=\"description\" content=\"<%= translate(\"meta.freegan_description\") %>\" />\n  <% else %>\n    <meta property=\"og:title\" content=\"Falling Fruit\" />\n    <meta property=\"og:url\" content=\"http://fallingfruit.org/?locale=<%= I18n.locale %>\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/amittai.jpg\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/apple-haul.jpg\" />\n    <meta property=\"og:description\" content=\"<%= translate(\"meta.forager_description\") %>\" />\n    <meta name=\"description\" content=\"<%= translate(\"meta.forager_description\") %>\" />\n  <% end %>\n\n  <!-- Stylesheets -->\n  <%= stylesheet_link_tag \"application\" %>\n  <% if @freegan %>\n    <%= stylesheet_link_tag \"freegan\" %>\n  <% end %>\n\n  <!-- Javascript -->\n  <%= javascript_include_tag \"application\" %>\n  <%= csrf_meta_tags %>\n\n  <!-- app globals -->\n  <% host = request.local? ? \"localhost\" : \"fallingfruit.org\" %>\n  <% if host == \"localhost\" %>\n    <meta name=\"google\" value=\"notranslate\">\n  <% end %>\n  <script type=\"text/javascript\">\n    host = \"<%= host %>\";\n    cats = <%= raw @categories %>;\n    // load I18n\n    I18n.defaultLocale = \"<%= I18n.default_locale %>\";\n    I18n.locale = \"<%= I18n.locale %>\";\n    I18n.fallbacks = true;\n    // resize content on header resize\n    $(window).resize(function() {\n      resize_content();\n    });\n    // set I18nViz external urls (initializer didn't work)\n    if (I18nViz) {\n      I18nViz.external_tool_url = \"https://phraseapp.com/accounts/falling-fruit/projects/falling-fruit-web/locales/\" + I18n.locale + \"/translations?translation_search%5Bquery%5D=\";\n    }\n  </script>\n\n  <!-- Load infowindow only after locale is set -->\n  <%= javascript_include_tag \"shadowbox-i18n\" %>\n  <%= javascript_include_tag \"shadowbox-infowindow\" %>\n\n  <!-- Helper JS functions -->\n  <script type=\"text/javascript\">\n    // Resize below-header content on window resize\n    function resize_content() {\n      var siteHeaderHeight = document.getElementById('menubar').offsetHeight + document.getElementById('logobar').offsetHeight;\n      if (document.getElementById('content_container') != undefined) {\n        document.getElementById('content_container').style.top = siteHeaderHeight + 'px';\n      } else {\n        if(document.getElementById('searchbar') != undefined){\n          var mapHeaderHeight = siteHeaderHeight + document.getElementById('searchbar').offsetHeight;\n          if (document.getElementById('mainmap_container') != undefined) {\n            document.getElementById('mainmap_container').style.top = mapHeaderHeight + 'px';\n            google.maps.event.trigger(map,'resize');\n          }\n          if (document.getElementById('sidebar_container') != undefined) {\n            document.getElementById('sidebar_container').style.top = mapHeaderHeight + 'px';\n          }\n        }\n      }\n    }\n    // URL parameter add/edit\n    function add_url_parameter(url, name, value) {\n      var pattern = new RegExp('(' + name + '=).*?(&|$|\\/|^)')\n      if (url.search(pattern) > -1) {\n        url = url.replace(pattern, '$1' + value + '$2');\n      } else {\n        url += (url.indexOf('?') > 0 ? '&' : '?') + name + '=' + value;\n      }\n      return url\n    }\n  </script>\n\n</head>\n<body onload=\"resize_content();\">\n\n<!-- Problems modal -->\n <div id=\"problem_modal\" title=\"<%= translate(\"glossary.report_a_problem\") %>\"></div>\n\n <!-- Alerts -->\n <% if notice or alert %>\n <div id=\"warnings_dialog\" style=\"display:none;\" ></div>\n<% content_for :page_scripts do %>\n<script type=\"text/javascript\">\n  var w1 = '<%= notice %>';\n  var w2 = '<%= alert %>';\n  $('#warnings_dialog').dialog({\n    closeText: \"close\",\n    minHeight: '5em',\n    resizable: false,\n    draggable: false,\n    position: { my: \"center top\" },\n    title: w1 + \"\\n\\n\" + w2,\n    dialogClass: \"dialog_yellow\"\n    });\n</script>\n <% end %>\n <% end %>\n\n<!-- Logo Bar -->\n<div id=\"logobar\">\n\n  <!-- Locale -->\n  <div id=\"locale\">\n    <select id=\"locale_select\">\n      <option value=\"de\" <%= (I18n.locale == :de) ? \"selected\" : \"\" %>>Deutsch</option>\n      <option value=\"en\" <%= (I18n.locale == :en) ? \"selected\" : \"\" %>>English</option>\n      <option value=\"el\" <%= (I18n.locale == :el) ? \"selected\" : \"\" %>>\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac</option>\n      <option value=\"es\" <%= (I18n.locale == :es) ? \"selected\" : \"\" %>>Espa\u00f1ol</option>\n      <option value=\"fr\" <%= (I18n.locale == :fr) ? \"selected\" : \"\" %>>Fran\u00e7ais</option>\n      <option value=\"it\" <%= (I18n.locale == :it) ? \"selected\" : \"\" %>>Italiano</option>\n      <!-- <option value=\"he\" <%= (I18n.locale == :he) ? \"selected\" : \"\" %>>\u05e2\u05d1\u05e8\u05d9\u05ea</option> -->\n      <option value=\"nl\" <%= (I18n.locale == :nl) ? \"selected\" : \"\" %>>Nederlands</option>\n      <option value=\"pl\" <%= (I18n.locale == :pl) ? \"selected\" : \"\" %>>Polski</option>\n      <option value=\"pt-br\" <%= (I18n.locale == :\"pt-BR\") ? \"selected\" : \"\" %>>Portugu\u00eas</option>\n    </select>\n  </div>\n\n <!-- Sharing -->\n   <script type=\"text/javascript\">\n    var addthis_config = {\n      // list at http://support.addthis.com/customer/portal/articles/381240-languages\n      ui_language: I18n.locale.substring(0,2)\n    }\n  </script>\n  <div id=\"share_controls\" class=\"addthis_32x32_style addthis_default_style nowrap\">\n    <a href=\"https://www.facebook.com/FallingFruit\" title=\"Facebook\" >\n      <img src=\"/social/facebook.svg\" alt=\"Facebook\" />\n    </a>\n    <a href=\"https://twitter.com/Falling_Fruit\" title=\"Twitter\">\n      <img src=\"/social/twitter.svg\" alt=\"Twitter\" />\n    </a>\n    <a href=\"http://instagram.com/fallingfruit\" title=\"Instagram\">\n      <img src=\"/social/instagram.svg\" alt=\"Instagram\" />\n    </a>\n    <a class=\"addthis_button_compact\" addthis:url=\"https://fallingfruit.org\">\n      <img src=\"/social/addthis.png\" />\n    </a>\n  </div>\n  <script type=\"text/javascript\" src=\"//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51390d312330c4fe\"></script>\n\n <!-- Title -->\n <%= link_to(\"falling fruit\", root_path, id: \"falling_fruit\") %>\n <span id=\"subtitle\">\n &ndash;\n <% if @freegan %>\n   <%= translate(\"layouts.application.feed_people_not_landfills\") %>\n <% else %>\n   <%= translate(\"layouts.application.mapping_the_urban_harvest\") %>\n <% end %>\n </span>\n <!--\n <% ['forager', 'freegan', 'grafter'].each do |c| %>\n     <% if @categories.include?(c) %>\n       <b><%= c %></b>\n     <% else %>\n       <%= c %>\n     <% end %>\n <% end %>\n -->\n</div>\n\n<!-- Menu Bar -->\n<div id=\"menubar\">\n <div id=\"rightcontrols\">\n   <% path = request.fullpath %>\n    <% if user_signed_in? %>\n      <span id=\"user_email\"><%= current_user.email %></span>\n     <%= link_to(translate(\"glossary.account\"), edit_user_registration_path, :class => (path == '/users/edit') ? 'currentpage' : 'notcurrentpage') %>\n     <%= link_to(translate(\"glossary.logout\"), destroy_user_session_path, :method => :delete) %>\n    <% else %>\n      <%= link_to(translate(\"glossary.login\"), new_user_session_path, :class => (path == '/users/sign_in') ? 'currentpage' : 'notcurrentpage') %><%= link_to(translate(\"glossary.sign_up\"), new_user_registration_path, :class => (path == '/users/sign_up') ? 'currentpage' : 'notcurrentpage') %>\n    <% end %>\n </div>\n\n <!-- Menu -->\n <% basepath = path.split('?')[0] %>\n <div id=\"menu\">\n    <ul>\n\n    <!-- Map -->\n    <% unless user_signed_in? %>\n      <li><%= link_to(translate(\"glossary.map\"), root_path, :id => \"maplink\", :class => (['/','/observations/new','/dumpsters','/freegan'].include?(basepath) or (path.include? '/locations' and not path.include? '/locations/new')) ? \"currentpage\" : \"notcurrentpage\") %></li>\n    <% else %>\n      <li><%= link_to(translate(\"glossary.home\"), home_path, :id => \"maplink\", :class => (['/locations/home','/home'].include?(path.split('?')[0])) ? \"currentpage\" : \"notcurrentpage\") %></li>\n      <li><%= link_to(translate(\"glossary.world\"), root_path, :class => (['/','/observations/new'].include?(path.split('?')[0]) or (path.include? '/locations' and path != new_location_path and path != home_locations_path) or path.include? '/dumpsters' or path.include? '/freegan') ? \"currentpage\" : \"notcurrentpage\") %></li>\n    <% end %>\n\n    <!-- About -->\n    <li><%= link_to(translate(\"glossary.about\"), about_path, :class => (['/about','/datasets','/sharing','/press'].include?(basepath)) ? \"currentpage\" : \"notcurrentpage\") %>\n    <ul>\n      <li><%= link_to(translate(\"layouts.application.menu.the_project\"), about_path, :class => (basepath == '/about') ? 'currentpage' : 'notcurrentpage') %>\n      <li><%= link_to(translate(\"glossary.imported_datasets\"), datasets_path, :class => (basepath == '/datasets') ? 'currentpage' : 'notcurrentpage') %></li>\n      <li><%= link_to(translate(\"layouts.application.menu.sharing_the_harvest\"), sharing_path, :class => (basepath == '/sharing') ? 'currentpage' : 'notcurrentpage') %></li>\n      <li><%= link_to(translate(\"layouts.application.menu.in_the_press\"), press_path, :class => (basepath == '/press') ? 'currentpage' : 'notcurrentpage') %></li>\n    </ul>\n\n    <!-- Data -->\n    <li><%= link_to(translate(\"glossary.data\"), data_path, :class => (basepath == '/data') ? \"currentpage\" : \"notcurrentpage\") %></li>\n\n    <!-- Activity -->\n    <li><%= link_to(translate(\"glossary.activity\"), changes_path, :class => (basepath == '/changes') ? \"currentpage\" : \"notcurrentpage\") %></li>\n\n    <!-- Routes -->\n    <% if user_signed_in? %>\n      <li><%= link_to(translate(\"glossary.routes\"), routes_path, :class => ((basepath == '/routes' or not path.match('/routes/[0-9]+').nil?) ? \"currentpage\" : \"notcurrentpage\")) %></li>\n\n      <% if current_user.is? :admin %>\n\n        <!-- Problems -->\n        <li><%= link_to(translate(\"glossary.problems\"), problems_path, :class => (path.include? '/problems') ? \"currentpage\" : \"notcurrentpage\") %></li>\n\n        <!-- Types -->\n        <li><%= link_to(translate(\"glossary.types\"), types_path, :class => (path.include? '/types') ? \"currentpage\" : \"notcurrentpage\") %>\n        <ul>\n            <li><%= link_to(translate(\"layouts.application.menu.approved_types\"), types_path, :class => (basepath == '/types') ? \"currentpage\" : \"notcurrentpage\") %></li>\n            <li><%= link_to(translate(\"glossary.pending_types\"), grow_types_path, :class => (basepath == '/types/grow') ? \"currentpage\" : \"notcurrentpage\") %></li>\n            <li><%= link_to(translate(\"layouts.application.menu.new_type\"), new_type_path, :class => (basepath == '/types/new') ? \"currentpage\" : \"notcurrentpage\") %></li>\n        </ul>\n        </li>\n\n        <!-- Imports -->\n        <li><%= link_to(translate(\"glossary.imports\"), imports_path, :class => (basepath == '/imports' or basepath == '/locations/import') ? \"currentpage\" : \"notcurrentpage\") %>\n        <ul>\n            <li><%= link_to(translate(\"layouts.application.menu.list_imports\"), imports_path, :class => (basepath == '/imports') ? \"currentpage\" : \"notcurrentpage\") %></li>\n            <li><%= link_to(translate(\"layouts.application.menu.new_import\"), import_locations_path, :class => (basepath == '/locations/import') ? \"currentpage\" : \"notcurrentpage\") %></li>\n        </ul>\n        </li>\n\n        <!-- Users -->\n        <li><%= link_to(translate(\"glossary.users\"), users_path, :class => (basepath == '/users') ? \"currentpage\" : \"notcurrentpage\") %></li>\n      <% end %>\n    <% end %>\n\n    <!-- Add Source -->\n    <li><%= link_to(\"+ \" + translate(\"glossary.add_source\"), new_location_path, :class => (basepath == '/locations/new') ? \"currentpage\" : \"notcurrentpage\") %>\n    <% if (request.fullpath.split('?')[0] == root_path or not request.fullpath.match('/locations/[0-9]+').nil?) and !user_signed_in? %>\n      <span>(<%= translate(\"layouts.application.or_right-click_on_map\") %>)</span>\n    <% end %>\n    </li>\n\n    </ul>\n\n </div>\n</div>\n\n<!-- Unverified? -->\n<div id=\"unverified_help\" style=\"display:none;\" title=\"<%= translate(\"layouts.application.unverified_help_title\") %>\">\n<%= translate(\"layouts.application.unverified_help\") %>\n</div>\n\n<!-- Pending Types -->\n<div id=\"pending_types_help\" style=\"display:none;\" title=\"<%= translate(\"glossary.pending_types\") %>\">\n<%= translate(\"layouts.application.pending_types_help\") %>\n</div>\n\n<!-- Content -->\n<% unless ((@current_controller == \"locations\") and !(@current_action == \"import\")) or (@current_controller == \"routes\" and @current_action == \"show\")  or (@current_controller == \"observations\") %>\n\n<div id=\"content_container\">\n  <!-- Allow full-width content for very large tables in admin views -->\n  <div id=\"content\" <% if (@current_controller == \"types\" and @current_action == \"index\") or (@current_controller == \"users\" and @current_action == \"index\") %>style=\"max-width:100%;\"<% end %>>\n   <%= yield %>\n\n   <!-- Footer -->\n   <div id=\"footer\">\n    <a href=\"http://www.gnu.org/copyleft/gpl.html\" />Copyleft</a> \u00a9 <%= Time.now.year %> Falling Fruit\n   </div>\n  </div>\n</div>\n\n<% else %>\n\n  <%= yield %>\n\n<% end %>\n\n<script type=\"text/javascript\">\n  jQuery(document).ready(function(){\n    $(\"#locale_select\").change(function(){\n      url = add_url_parameter(window.location.href, 'locale', $(\"#locale_select\").val())\n      window.location.href = url;\n    });\n  });\n</script>\n\n<!-- Per Page Javascripts -->\n<%= yield :page_scripts %>\n\n<!-- Form Partial Javascripts -->\n<%= yield :form_scripts %>\n\n<!-- Google Analytics -->\n<script type=\"text/javascript\">\n  var _gaq = _gaq || [];\n  _gaq.push(['_setAccount', 'UA-39120529-1']);\n  _gaq.push(['_setDomainName', 'fallingfruit.org']);\n  _gaq.push(['_trackPageview']);\n\n  (function() {\n    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n  })();\n</script>\n\n<!-- AddThis Javascript -->\n<!-- URL tracking <script type=\"text/javascript\">var addthis_config = {\"data_track_addressbar\":true};</script>-->\n<script type=\"text/javascript\" src=\"//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51390d312330c4fe\"></script>\n\n</body>\n</html>\n", "<p>\n  <%= translate(\"pages.datasets.intro_html\").html_safe %>\n</p>\n\n<h2><%= translate(\"glossary.imported_datasets\") %></h2>\n\n<p>\n  <%= translate(\"pages.datasets.types_of_data\") %>\n</p>\n\n<p>\n  <%= translate(\"pages.datasets.table_info\") %>\n</p>\n\n<table id=\"import_list\">\n<thead>\n  <tr>\n    <th></th>\n    <th><%= translate(\"glossary.details\") %></th>\n    <th><%= translate(\"pages.datasets.type\") %></th>\n    <th><%= translate(\"glossary.name\") %></th>\n    <th><%= translate(\"glossary.locations\", :count => 2) %></th>\n    <th><%= translate(\"pages.datasets.date_imported\") %></th>\n  </tr>\n</thead>\n<tbody>\n<%\nlcounts = {}\nLocation.select(\"count(*), import_id\").joins(:import).group(:import_id).each{ |l|\n  lcounts[l.import_id] = l.count\n}\nImport.order(\"id\").reverse.each do |import|\n  ofile = File.join(\"public\",\"import\",\"#{import.id}.csv\")\n  ifile = File.join(\"public\",\"import\",\"#{import.id}_done.csv\")\n  efile = File.join(\"public\",\"import\",\"#{import.id}_error.csv\")\n  next if File.exists? efile or (File.exists? ofile and !File.exists? ifile)\n%>\n  <tr>\n    <td style=\"text-align:center;width:25px;\">\n      <img src=\"/details_open.png\" style=\"cursor:pointer;\"/>\n    </td>\n    <td style=\"display:none;\">\n      <!-- Comments -->\n      <% unless import.comments.blank? %>\n        <%= raw import.comments.gsub(\"\\n\",\"<br/>\") %><br /><br />\n      <% end %>\n      <!-- License -->\n      <% unless import.license.blank? %>\n        <%= raw import.license.gsub(\"\\n\",\"<br/>\") %>\n      <% else %>\n        <i><%= translate(\"pages.datasets.no_license\").html_safe %></i>\n      <% end %>\n    </td>\n    <td>\n      <%= import.muni ? translate(\"glossary.tree_inventory\", :count => 1) : translate(\"pages.datasets.community_map\") %>\n    </td>\n    <td>\n      <% unless import.url.blank? %>\n        <a href=\"<%= import.url %>\"><%= import.name %></a>\n      <% else %>\n        <%= import.name %>\n      <% end %>\n    </td>\n    <td><%= lcounts[import.id] %></td>\n    <td><%= import.created_at.strftime(\"%Y-%m-%d\") %></td>\n  </tr>\n<% end %>\n</tbody>\n</table>\n\n<style>\n.details {\n  padding-bottom: 1em !important;\n  background-color: #FAFAFA;\n}\n</style>\n\n<script type=\"text/javascript\" charset=\"utf-8\">\nfunction fnFormatDetails ( oTable, nTr )\n{\n    var aData = oTable.fnGetData( nTr );\n\n    var sOut = '<div style=\"margin:0 auto 0 42px;padding:10px;\">';\n    if (aData[1].length > 0) {\n      sOut += aData[1];\n    }\n    sOut += '</div>';\n    return sOut;\n}\n\njQuery(document).ready(function(){\n    var oTable = jQuery('#import_list').dataTable({\n      \"aaSorting\": [[5,\"desc\"]],\n      \"bPaginate\": false,\n      \"aoColumnDefs\": [\n            { \"bSortable\": false, \"aTargets\": [ 0 ] },\n            { \"bVisible\": false, \"aTargets\": [ 1 ] }\n        ]\n    });\n\n    $('#import_list tbody td').on('click', 'img', function () {\n        var nTr = $(this).parents('tr')[0];\n        if ( oTable.fnIsOpen(nTr) )\n        {\n            /* This row is already open - close it */\n            this.src = \"/details_open.png\";\n            oTable.fnClose( nTr );\n        }\n        else\n        {\n            /* Open this row */\n            this.src = \"/details_close.png\";\n            oTable.fnOpen( nTr, fnFormatDetails(oTable, nTr), 'details' );\n        }\n    } );\n\n});\n</script>\n", "<h1>Pending types</h1>\n\n<table id=\"types_table\">\n<thead>\n<tr>\n <th>ID</th>\n <th>Name</th>\n <th>Scientific</th>\n <th>Categories</th>\n <th>Edit</th>\n <th>Delete</th>\n</tr>\n</thead>\n<tbody>\n<% @types.each do |type| %>\n<tr>\n<td style=\"text-align:right\"><%= type.id %></td>\n<td>\n <% unless type.wikipedia_url.blank? %>\n  <a href=\"<%= raw type.wikipedia_url %>\" target=\"_blank\"><%= h type.en_name %></a>\n <% else %>\n  <%= type.en_name %>\n <% end %>\n <%= \"(#{type.en_synonyms})\" unless type.en_synonyms.blank? %>\n</td>\n<td>\n  <%= type.scientific_name %>\n</td>\n<td><%= mask_to_array(type.category_mask,Type::Categories).join(\", \") %></td>\n<td><%= link_to 'Edit', edit_type_path(type) %></td>\n<td><%= link_to 'Delete', type, method: :delete, data: { confirm: 'Are you sure?' } %></td>\n</tr>\n<% end %>\n</tbody>\n</table>\n\n<script type=\"text/javascript\" charset=\"utf-8\">\njQuery(document).ready(function(){\n    jQuery('#types_table').dataTable({\n      \"aaSorting\": [[0,\"desc\"]],\n      \"bPaginate\": false\n    });\n});\n</script>\n", "<h1>Approved types</h1>\n\n<%= link_to '[+] Add type', new_type_path %>\n\n<table id=\"types_table\">\n  <thead>\n    <tr>\n     <th>ID</th>\n     <th>PID</th>\n     <th>Rank</th>\n     <th>Latin</th>\n     <th>en</th>\n     <th>Cats</th>\n     <th>W</th>\n     <th>Edit</th>\n     <th>Delete</th>\n    </tr>\n  </thead>\n  <tbody>\n  <% @types.each do |type| %>\n    <tr>\n      <td style=\"text-align:right\"><%= type.id %></td>\n      <td style=\"text-align:right\"><%= type.parent_id %></td>\n      <td>\n      <% unless type.taxonomic_rank.blank? %>\n        <%= type.taxonomic_rank.to_s + \" \" + Type::Ranks[type.taxonomic_rank] %>\n      <% end %>\n      </td>\n      <td><%= type.scientific_name %> <%= \"(#{type.scientific_synonyms})\" unless type.scientific_synonyms.blank? %></td>\n      <td>\n       <%= type.en_name %>\n       <%= \"(#{type.en_synonyms})\" unless type.en_synonyms.blank? %>\n      </td>\n      <td><%= mask_to_array(type.category_mask,Type::Categories).join(\", \") %></td>\n      <td style=\"text-align:center;\">\n      <% unless type.wikipedia_url.blank? %>\n        <a href=\"<%= raw type.wikipedia_url %>\" target=\"_blank\">W</a>\n      <% end %>\n      </td>\n      <td><%= link_to 'Edit', edit_type_path(type) %></td>\n      <td><%= link_to 'Delete', type, method: :delete, data: { confirm: 'Are you sure?' } %></td>\n    </tr>\n  <% end %>\n  </tbody>\n</table>\n\n<script type=\"text/javascript\" charset=\"utf-8\">\n  jQuery(document).ready(function(){\n    jQuery('#types_table').dataTable({\n      \"aaSorting\": [[3, \"asc\"], [2, \"asc\"], [4, \"asc\"]],\n      \"bPaginate\": false\n    });\n  });\n</script>\n"], "fixing_code": ["<p>\n  <b><%= translate(\"changes.recent_changes\") %></b>\n</p>\n\n<%\nlast_days_ago = nil\n@changes.each do |c|\n  next if c[\"description\"] == \"grafted\" and (not user_signed_in? or not current_user.is? :grafter)\n  types = c[\"type_title\"]\n  unless c[\"country\"].nil?\n    city = [c[\"city\"],c[\"state\"],c[\"country\"]].compact.join(\", \")\n  end\n  # i18n-tasks-use t('changes.type.added') t('changes.type.edited') t('changes.type.grafted') t('changes.type.visited')\n  action = translate(\"changes.type.#{c['description']}\")\n  c[\"days_ago\"] = c[\"days_ago\"].to_i\n  if last_days_ago.nil? or c[\"days_ago\"] > last_days_ago\n    if c[\"days_ago\"] <= 0\n      header = translate(\"time.last_24_hours\")\n    else\n      header = translate(\"time.time_ago\", :time => (translate(\"time.days\", :count => c[\"days_ago\"])))\n    end\n    if last_days_ago.nil?\n      header = \"<span>\" + header + \"</span><blockquote>\"\n    else\n      header = \"</blockquote><span>\" + header + \"</span><blockquote>\"\n    end\n    last_days_ago = c[\"days_ago\"]\n  end\n  %>\n  <%= header.html_safe %>\n  <% unless c[\"location_id\"].nil? %>\n    <%= link_to location_path(c[\"location_id\"]) do %>\n      <span><%= types.nil? ? translate(\"glossary.unknown\") : types %></span>\n    <% end %>\n    (#<%= c[\"location_id\"] %>)\n    <% unless city.nil? %>\n      <span><%= translate(\"changes.change_in_city\", :type => action, :city => city) %></span>\n    <% else %>\n      <span><%= action %></span>\n    <% end %>\n    <% if user_signed_in? and current_user.is? :admin %>\n      &middot; <span style=\"color: #E35809;\">\n      <% if c[\"user_id\"].nil? %>\n        <%= c[\"remote_ip\"] %>\n      <% else %>\n        <span><%= translate(\"glossary.user\") %> #<%= c[\"user_id\"] %></span>\n      <% end %>\n      </span>\n    <% end %>\n    <br>\n  <% end %>\n<% end %>\n<% if @changes.length > 0 %>\n  </blockquote>\n<% end %>\n", "<%= link_to(\"[+] \" + translate(\"layouts.application.menu.list_imports\"), datasets_path) %>\n\n<table style=\"border-collapse:separate;border-spacing:0 2em;\">\n<tr>\n  <td style=\"vertical-align:top;text-align:right;padding:2em 1.5em 0 0;\">\n    #<%= @import.id %>\n    <% if user_signed_in? and current_user.is? :admin %>\n      <br/><%= link_to(translate(\"glossary.edit\"),edit_import_path(@import.id)) %>\n    <% end %>\n  </td>\n  <td style=\"padding:2em;background-color:#fafafa;\">\n\n  <!-- Name, URL -->\n  <b><%= @import.name %></b><br />\n  <% unless @import.url.blank? %>\n    <%= link_to @import.url do %>\n    <%= !@import.url.match('google.com/maps|maps.google').nil? ? translate(\"pages.datasets.google_map\") : (!@import.url.match('google.com/fusiontables').nil? ? translate(\"pages.datasets.google_fusion_table\") : (!@import.url.match('mapsengine.google').nil? ? translate(\"pages.datasets.google_maps_engine\") : @import.url)) %>\n    <% end %><br />\n  <% end %>\n\n  <!-- Type, Date -->\n  <%= @import.muni ? translate(\"glossary.tree_inventory\", :count => 1) : translate(\"pages.datasets.community_map\") %> | <%= translate(\"glossary.imported\") %> <i><%= @import.created_at.to_s %></i><br />\n\n  <hr style=\"border:1px solid #eee;margin:1.5em 0;\">\n\n  <span style=\"font-size:100%;\">\n  <!-- Comments -->\n  <% unless @import.comments.blank? %>\n    <%= ERB::Util.html_escape(@import.comments).gsub(\"\\n\", \"<br/>\").html_safe %><br /><br />\n  <% end %>\n\n  <!-- License -->\n  <% unless @import.license.blank? %>\n    <%= ERB::Util.html_escape(@import.license).gsub(\"\\n\", \"<br/>\").html_safe %>\n  <% else %>\n    <i><%= translate(\"pages.datasets.no_license\").html_safe %></i>\n  <% end %>\n  </span>\n\n  </td>\n</tr>\n</table>\n", "<!DOCTYPE html>\n<html xmlns:fb=\"http://ogp.me/ns/fb#\">\n<head>\n\n  <!-- Metadata -->\n  <title>Falling Fruit</title>\n  <meta name=\"keywords\" content=\"map, urban, harvest, edible, forage, glean, tree, inventory, plant, fruit, nut, berry, food, freegan, dumpster, community, Falling Fruit, Ethan Welty, Caleb Phillips, Jeff Wanner\" />\n  <meta property=\"og:site_name\" content=\"Falling Fruit\" />\n  <meta property=\"og:type\" content=\"website\" />\n  <meta property=\"fb:admins\" content=\"10708811\" /><!-- Ethan Welty -->\n  <meta property=\"fb:admins\" content=\"42001954\" /><!-- Caleb Phillips -->\n  <meta property=\"fb:admins\" content=\"5246945\" /><!-- Jeff Wanner -->\n\n  <% if (I18n.locale == :en) %>\n    <meta property=\"og:locale\" content=\"en_US\" />\n  <% elsif (I18n.locale == :\"es\") %>\n    <meta property=\"og:locale\" content=\"es_LA\" />\n  <% elsif (I18n.locale == :es) %>\n    <meta property=\"og:locale\" content=\"de_DE\" />\n  <% elsif (I18n.locale == :fr) %>\n    <meta property=\"og:locale\" content=\"fr_FR\" />\n  <% elsif (I18n.locale == :\"pt-br\") %>\n    <meta property=\"og:locale\" content=\"pt_BR\" />\n  <% elsif (I18n.locale == :\"it\") %>\n    <meta property=\"og:locale\" content=\"it_IT\" />\n  <% elsif (I18n.locale == :\"el\") %>\n    <meta property=\"og:locale\" content=\"el_GR\" />\n  <% elsif (I18n.locale == :\"pl\") %>\n    <meta property=\"og:locale\" content=\"pl_PL\" />\n  <% elsif (I18n.locale == :\"nl\") %>\n    <meta property=\"og:locale\" content=\"nl_NL\" />\n  <% end %>\n  <meta property=\"og:locale:alternate\" content=\"en_US\" />\n  <meta property=\"og:locale:alternate\" content=\"es_LA\" />\n  <meta property=\"og:locale:alternate\" content=\"de_DE\" />\n  <meta property=\"og:locale:alternate\" content=\"fr_FR\" />\n  <meta property=\"og:locale:alternate\" content=\"pt_BR\" />\n  <meta property=\"og:locale:alternate\" content=\"it_IT\" />\n  <meta property=\"og:locale:alternate\" content=\"el_GR\" />\n  <meta property=\"og:locale:alternate\" content=\"pl_PL\" />\n  <meta property=\"og:locale:alternate\" content=\"nl_NL\" />\n\n  <% if @freegan %>\n    <meta property=\"og:title\" content=\"<%= translate(\"meta.freegan_title\") %>\" />\n    <meta property=\"og:url\" content=\"http://fallingfruit.org/dumpsters?locale=<%= I18n.locale %>\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/dumpster-sticker.png\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/dumpster-sticker-01.jpg\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/dumpster-haul.jpg\" />\n    <meta property=\"og:description\" content=\"<%= translate(\"meta.freegan_description\") %>\" />\n    <meta name=\"description\" content=\"<%= translate(\"meta.freegan_description\") %>\" />\n  <% else %>\n    <meta property=\"og:title\" content=\"Falling Fruit\" />\n    <meta property=\"og:url\" content=\"http://fallingfruit.org/?locale=<%= I18n.locale %>\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/amittai.jpg\" />\n    <meta property=\"og:image\" content=\"http://fallingfruit.org/og/apple-haul.jpg\" />\n    <meta property=\"og:description\" content=\"<%= translate(\"meta.forager_description\") %>\" />\n    <meta name=\"description\" content=\"<%= translate(\"meta.forager_description\") %>\" />\n  <% end %>\n\n  <!-- Stylesheets -->\n  <%= stylesheet_link_tag \"application\" %>\n  <% if @freegan %>\n    <%= stylesheet_link_tag \"freegan\" %>\n  <% end %>\n\n  <!-- Javascript -->\n  <%= javascript_include_tag \"application\" %>\n  <%= csrf_meta_tags %>\n\n  <!-- app globals -->\n  <% host = request.local? ? \"localhost\" : \"fallingfruit.org\" %>\n  <% if host == \"localhost\" %>\n    <meta name=\"google\" value=\"notranslate\">\n  <% end %>\n  <script type=\"text/javascript\">\n    host = \"<%= host %>\";\n    cats = <%= @categories.map{|c| ERB::Util.html_escape(c)}.to_json.html_safe %>;\n    // load I18n\n    I18n.defaultLocale = \"<%= I18n.default_locale %>\";\n    I18n.locale = \"<%= I18n.locale %>\";\n    I18n.fallbacks = true;\n    // resize content on header resize\n    $(window).resize(function() {\n      resize_content();\n    });\n    // set I18nViz external urls (initializer didn't work)\n    if (I18nViz) {\n      I18nViz.external_tool_url = \"https://phraseapp.com/accounts/falling-fruit/projects/falling-fruit-web/locales/\" + I18n.locale + \"/translations?translation_search%5Bquery%5D=\";\n    }\n  </script>\n\n  <!-- Load infowindow only after locale is set -->\n  <%= javascript_include_tag \"shadowbox-i18n\" %>\n  <%= javascript_include_tag \"shadowbox-infowindow\" %>\n\n  <!-- Helper JS functions -->\n  <script type=\"text/javascript\">\n    // Resize below-header content on window resize\n    function resize_content() {\n      var siteHeaderHeight = document.getElementById('menubar').offsetHeight + document.getElementById('logobar').offsetHeight;\n      if (document.getElementById('content_container') != undefined) {\n        document.getElementById('content_container').style.top = siteHeaderHeight + 'px';\n      } else {\n        if(document.getElementById('searchbar') != undefined){\n          var mapHeaderHeight = siteHeaderHeight + document.getElementById('searchbar').offsetHeight;\n          if (document.getElementById('mainmap_container') != undefined) {\n            document.getElementById('mainmap_container').style.top = mapHeaderHeight + 'px';\n            google.maps.event.trigger(map,'resize');\n          }\n          if (document.getElementById('sidebar_container') != undefined) {\n            document.getElementById('sidebar_container').style.top = mapHeaderHeight + 'px';\n          }\n        }\n      }\n    }\n    // URL parameter add/edit\n    function add_url_parameter(url, name, value) {\n      var pattern = new RegExp('(' + name + '=).*?(&|$|\\/|^)')\n      if (url.search(pattern) > -1) {\n        url = url.replace(pattern, '$1' + value + '$2');\n      } else {\n        url += (url.indexOf('?') > 0 ? '&' : '?') + name + '=' + value;\n      }\n      return url\n    }\n  </script>\n\n</head>\n<body onload=\"resize_content();\">\n\n<!-- Problems modal -->\n <div id=\"problem_modal\" title=\"<%= translate(\"glossary.report_a_problem\") %>\"></div>\n\n <!-- Alerts -->\n <% if notice or alert %>\n <div id=\"warnings_dialog\" style=\"display:none;\" ></div>\n<% content_for :page_scripts do %>\n<script type=\"text/javascript\">\n  var w1 = '<%= notice %>';\n  var w2 = '<%= alert %>';\n  $('#warnings_dialog').dialog({\n    closeText: \"close\",\n    minHeight: '5em',\n    resizable: false,\n    draggable: false,\n    position: { my: \"center top\" },\n    title: w1 + \"\\n\\n\" + w2,\n    dialogClass: \"dialog_yellow\"\n    });\n</script>\n <% end %>\n <% end %>\n\n<!-- Logo Bar -->\n<div id=\"logobar\">\n\n  <!-- Locale -->\n  <div id=\"locale\">\n    <select id=\"locale_select\">\n      <option value=\"de\" <%= (I18n.locale == :de) ? \"selected\" : \"\" %>>Deutsch</option>\n      <option value=\"en\" <%= (I18n.locale == :en) ? \"selected\" : \"\" %>>English</option>\n      <option value=\"el\" <%= (I18n.locale == :el) ? \"selected\" : \"\" %>>\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac</option>\n      <option value=\"es\" <%= (I18n.locale == :es) ? \"selected\" : \"\" %>>Espa\u00f1ol</option>\n      <option value=\"fr\" <%= (I18n.locale == :fr) ? \"selected\" : \"\" %>>Fran\u00e7ais</option>\n      <option value=\"it\" <%= (I18n.locale == :it) ? \"selected\" : \"\" %>>Italiano</option>\n      <!-- <option value=\"he\" <%= (I18n.locale == :he) ? \"selected\" : \"\" %>>\u05e2\u05d1\u05e8\u05d9\u05ea</option> -->\n      <option value=\"nl\" <%= (I18n.locale == :nl) ? \"selected\" : \"\" %>>Nederlands</option>\n      <option value=\"pl\" <%= (I18n.locale == :pl) ? \"selected\" : \"\" %>>Polski</option>\n      <option value=\"pt-br\" <%= (I18n.locale == :\"pt-BR\") ? \"selected\" : \"\" %>>Portugu\u00eas</option>\n    </select>\n  </div>\n\n <!-- Sharing -->\n   <script type=\"text/javascript\">\n    var addthis_config = {\n      // list at http://support.addthis.com/customer/portal/articles/381240-languages\n      ui_language: I18n.locale.substring(0,2)\n    }\n  </script>\n  <div id=\"share_controls\" class=\"addthis_32x32_style addthis_default_style nowrap\">\n    <a href=\"https://www.facebook.com/FallingFruit\" title=\"Facebook\" >\n      <img src=\"/social/facebook.svg\" alt=\"Facebook\" />\n    </a>\n    <a href=\"https://twitter.com/Falling_Fruit\" title=\"Twitter\">\n      <img src=\"/social/twitter.svg\" alt=\"Twitter\" />\n    </a>\n    <a href=\"http://instagram.com/fallingfruit\" title=\"Instagram\">\n      <img src=\"/social/instagram.svg\" alt=\"Instagram\" />\n    </a>\n    <a class=\"addthis_button_compact\" addthis:url=\"https://fallingfruit.org\">\n      <img src=\"/social/addthis.png\" />\n    </a>\n  </div>\n  <script type=\"text/javascript\" src=\"//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51390d312330c4fe\"></script>\n\n <!-- Title -->\n <%= link_to(\"falling fruit\", root_path, id: \"falling_fruit\") %>\n <span id=\"subtitle\">\n &ndash;\n <% if @freegan %>\n   <%= translate(\"layouts.application.feed_people_not_landfills\") %>\n <% else %>\n   <%= translate(\"layouts.application.mapping_the_urban_harvest\") %>\n <% end %>\n </span>\n <!--\n <% ['forager', 'freegan', 'grafter'].each do |c| %>\n     <% if @categories.include?(c) %>\n       <b><%= c %></b>\n     <% else %>\n       <%= c %>\n     <% end %>\n <% end %>\n -->\n</div>\n\n<!-- Menu Bar -->\n<div id=\"menubar\">\n <div id=\"rightcontrols\">\n   <% path = request.fullpath %>\n    <% if user_signed_in? %>\n      <span id=\"user_email\"><%= current_user.email %></span>\n     <%= link_to(translate(\"glossary.account\"), edit_user_registration_path, :class => (path == '/users/edit') ? 'currentpage' : 'notcurrentpage') %>\n     <%= link_to(translate(\"glossary.logout\"), destroy_user_session_path, :method => :delete) %>\n    <% else %>\n      <%= link_to(translate(\"glossary.login\"), new_user_session_path, :class => (path == '/users/sign_in') ? 'currentpage' : 'notcurrentpage') %><%= link_to(translate(\"glossary.sign_up\"), new_user_registration_path, :class => (path == '/users/sign_up') ? 'currentpage' : 'notcurrentpage') %>\n    <% end %>\n </div>\n\n <!-- Menu -->\n <% basepath = path.split('?')[0] %>\n <div id=\"menu\">\n    <ul>\n\n    <!-- Map -->\n    <% unless user_signed_in? %>\n      <li><%= link_to(translate(\"glossary.map\"), root_path, :id => \"maplink\", :class => (['/','/observations/new','/dumpsters','/freegan'].include?(basepath) or (path.include? '/locations' and not path.include? '/locations/new')) ? \"currentpage\" : \"notcurrentpage\") %></li>\n    <% else %>\n      <li><%= link_to(translate(\"glossary.home\"), home_path, :id => \"maplink\", :class => (['/locations/home','/home'].include?(path.split('?')[0])) ? \"currentpage\" : \"notcurrentpage\") %></li>\n      <li><%= link_to(translate(\"glossary.world\"), root_path, :class => (['/','/observations/new'].include?(path.split('?')[0]) or (path.include? '/locations' and path != new_location_path and path != home_locations_path) or path.include? '/dumpsters' or path.include? '/freegan') ? \"currentpage\" : \"notcurrentpage\") %></li>\n    <% end %>\n\n    <!-- About -->\n    <li><%= link_to(translate(\"glossary.about\"), about_path, :class => (['/about','/datasets','/sharing','/press'].include?(basepath)) ? \"currentpage\" : \"notcurrentpage\") %>\n    <ul>\n      <li><%= link_to(translate(\"layouts.application.menu.the_project\"), about_path, :class => (basepath == '/about') ? 'currentpage' : 'notcurrentpage') %>\n      <li><%= link_to(translate(\"glossary.imported_datasets\"), datasets_path, :class => (basepath == '/datasets') ? 'currentpage' : 'notcurrentpage') %></li>\n      <li><%= link_to(translate(\"layouts.application.menu.sharing_the_harvest\"), sharing_path, :class => (basepath == '/sharing') ? 'currentpage' : 'notcurrentpage') %></li>\n      <li><%= link_to(translate(\"layouts.application.menu.in_the_press\"), press_path, :class => (basepath == '/press') ? 'currentpage' : 'notcurrentpage') %></li>\n    </ul>\n\n    <!-- Data -->\n    <li><%= link_to(translate(\"glossary.data\"), data_path, :class => (basepath == '/data') ? \"currentpage\" : \"notcurrentpage\") %></li>\n\n    <!-- Activity -->\n    <li><%= link_to(translate(\"glossary.activity\"), changes_path, :class => (basepath == '/changes') ? \"currentpage\" : \"notcurrentpage\") %></li>\n\n    <!-- Routes -->\n    <% if user_signed_in? %>\n      <li><%= link_to(translate(\"glossary.routes\"), routes_path, :class => ((basepath == '/routes' or not path.match('/routes/[0-9]+').nil?) ? \"currentpage\" : \"notcurrentpage\")) %></li>\n\n      <% if current_user.is? :admin %>\n\n        <!-- Problems -->\n        <li><%= link_to(translate(\"glossary.problems\"), problems_path, :class => (path.include? '/problems') ? \"currentpage\" : \"notcurrentpage\") %></li>\n\n        <!-- Types -->\n        <li><%= link_to(translate(\"glossary.types\"), types_path, :class => (path.include? '/types') ? \"currentpage\" : \"notcurrentpage\") %>\n        <ul>\n            <li><%= link_to(translate(\"layouts.application.menu.approved_types\"), types_path, :class => (basepath == '/types') ? \"currentpage\" : \"notcurrentpage\") %></li>\n            <li><%= link_to(translate(\"glossary.pending_types\"), grow_types_path, :class => (basepath == '/types/grow') ? \"currentpage\" : \"notcurrentpage\") %></li>\n            <li><%= link_to(translate(\"layouts.application.menu.new_type\"), new_type_path, :class => (basepath == '/types/new') ? \"currentpage\" : \"notcurrentpage\") %></li>\n        </ul>\n        </li>\n\n        <!-- Imports -->\n        <li><%= link_to(translate(\"glossary.imports\"), imports_path, :class => (basepath == '/imports' or basepath == '/locations/import') ? \"currentpage\" : \"notcurrentpage\") %>\n        <ul>\n            <li><%= link_to(translate(\"layouts.application.menu.list_imports\"), imports_path, :class => (basepath == '/imports') ? \"currentpage\" : \"notcurrentpage\") %></li>\n            <li><%= link_to(translate(\"layouts.application.menu.new_import\"), import_locations_path, :class => (basepath == '/locations/import') ? \"currentpage\" : \"notcurrentpage\") %></li>\n        </ul>\n        </li>\n\n        <!-- Users -->\n        <li><%= link_to(translate(\"glossary.users\"), users_path, :class => (basepath == '/users') ? \"currentpage\" : \"notcurrentpage\") %></li>\n      <% end %>\n    <% end %>\n\n    <!-- Add Source -->\n    <li><%= link_to(\"+ \" + translate(\"glossary.add_source\"), new_location_path, :class => (basepath == '/locations/new') ? \"currentpage\" : \"notcurrentpage\") %>\n    <% if (request.fullpath.split('?')[0] == root_path or not request.fullpath.match('/locations/[0-9]+').nil?) and !user_signed_in? %>\n      <span>(<%= translate(\"layouts.application.or_right-click_on_map\") %>)</span>\n    <% end %>\n    </li>\n\n    </ul>\n\n </div>\n</div>\n\n<!-- Unverified? -->\n<div id=\"unverified_help\" style=\"display:none;\" title=\"<%= translate(\"layouts.application.unverified_help_title\") %>\">\n<%= translate(\"layouts.application.unverified_help\") %>\n</div>\n\n<!-- Pending Types -->\n<div id=\"pending_types_help\" style=\"display:none;\" title=\"<%= translate(\"glossary.pending_types\") %>\">\n<%= translate(\"layouts.application.pending_types_help\") %>\n</div>\n\n<!-- Content -->\n<% unless ((@current_controller == \"locations\") and !(@current_action == \"import\")) or (@current_controller == \"routes\" and @current_action == \"show\")  or (@current_controller == \"observations\") %>\n\n<div id=\"content_container\">\n  <!-- Allow full-width content for very large tables in admin views -->\n  <div id=\"content\" <% if (@current_controller == \"types\" and @current_action == \"index\") or (@current_controller == \"users\" and @current_action == \"index\") %>style=\"max-width:100%;\"<% end %>>\n   <%= yield %>\n\n   <!-- Footer -->\n   <div id=\"footer\">\n    <a href=\"http://www.gnu.org/copyleft/gpl.html\" />Copyleft</a> \u00a9 <%= Time.now.year %> Falling Fruit\n   </div>\n  </div>\n</div>\n\n<% else %>\n\n  <%= yield %>\n\n<% end %>\n\n<script type=\"text/javascript\">\n  jQuery(document).ready(function(){\n    $(\"#locale_select\").change(function(){\n      url = add_url_parameter(window.location.href, 'locale', $(\"#locale_select\").val())\n      window.location.href = url;\n    });\n  });\n</script>\n\n<!-- Per Page Javascripts -->\n<%= yield :page_scripts %>\n\n<!-- Form Partial Javascripts -->\n<%= yield :form_scripts %>\n\n<!-- Google Analytics -->\n<script type=\"text/javascript\">\n  var _gaq = _gaq || [];\n  _gaq.push(['_setAccount', 'UA-39120529-1']);\n  _gaq.push(['_setDomainName', 'fallingfruit.org']);\n  _gaq.push(['_trackPageview']);\n\n  (function() {\n    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n  })();\n</script>\n\n<!-- AddThis Javascript -->\n<!-- URL tracking <script type=\"text/javascript\">var addthis_config = {\"data_track_addressbar\":true};</script>-->\n<script type=\"text/javascript\" src=\"//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-51390d312330c4fe\"></script>\n\n</body>\n</html>\n", "<p>\n  <%= translate(\"pages.datasets.intro_html\").html_safe %>\n</p>\n\n<h2><%= translate(\"glossary.imported_datasets\") %></h2>\n\n<p>\n  <%= translate(\"pages.datasets.types_of_data\") %>\n</p>\n\n<p>\n  <%= translate(\"pages.datasets.table_info\") %>\n</p>\n\n<table id=\"import_list\">\n<thead>\n  <tr>\n    <th></th>\n    <th><%= translate(\"glossary.details\") %></th>\n    <th><%= translate(\"pages.datasets.type\") %></th>\n    <th><%= translate(\"glossary.name\") %></th>\n    <th><%= translate(\"glossary.locations\", :count => 2) %></th>\n    <th><%= translate(\"pages.datasets.date_imported\") %></th>\n  </tr>\n</thead>\n<tbody>\n<%\nlcounts = {}\nLocation.select(\"count(*), import_id\").joins(:import).group(:import_id).each{ |l|\n  lcounts[l.import_id] = l.count\n}\nImport.order(\"id\").reverse.each do |import|\n  ofile = File.join(\"public\",\"import\",\"#{import.id}.csv\")\n  ifile = File.join(\"public\",\"import\",\"#{import.id}_done.csv\")\n  efile = File.join(\"public\",\"import\",\"#{import.id}_error.csv\")\n  next if File.exists? efile or (File.exists? ofile and !File.exists? ifile)\n%>\n  <tr>\n    <td style=\"text-align:center;width:25px;\">\n      <img src=\"/details_open.png\" style=\"cursor:pointer;\"/>\n    </td>\n    <td style=\"display:none;\">\n      <!-- Comments -->\n      <% unless import.comments.blank? %>\n        <%= ERB::Util.html_escape(import.comments).gsub(\"\\n\", \"<br/>\").html_safe %><br /><br />\n      <% end %>\n      <!-- License -->\n      <% unless import.license.blank? %>\n        <%= ERB::Util.html_escape(import.license).gsub(\"\\n\", \"<br/>\").html_safe %>\n      <% else %>\n        <i><%= translate(\"pages.datasets.no_license\").html_safe %></i>\n      <% end %>\n    </td>\n    <td>\n      <%= import.muni ? translate(\"glossary.tree_inventory\", :count => 1) : translate(\"pages.datasets.community_map\") %>\n    </td>\n    <td>\n      <% unless import.url.blank? %>\n        <a href=\"<%= import.url %>\"><%= import.name %></a>\n      <% else %>\n        <%= import.name %>\n      <% end %>\n    </td>\n    <td><%= lcounts[import.id] %></td>\n    <td><%= import.created_at.strftime(\"%Y-%m-%d\") %></td>\n  </tr>\n<% end %>\n</tbody>\n</table>\n\n<style>\n.details {\n  padding-bottom: 1em !important;\n  background-color: #FAFAFA;\n}\n</style>\n\n<script type=\"text/javascript\" charset=\"utf-8\">\nfunction fnFormatDetails ( oTable, nTr )\n{\n    var aData = oTable.fnGetData( nTr );\n\n    var sOut = '<div style=\"margin:0 auto 0 42px;padding:10px;\">';\n    if (aData[1].length > 0) {\n      sOut += aData[1];\n    }\n    sOut += '</div>';\n    return sOut;\n}\n\njQuery(document).ready(function(){\n    var oTable = jQuery('#import_list').dataTable({\n      \"aaSorting\": [[5,\"desc\"]],\n      \"bPaginate\": false,\n      \"aoColumnDefs\": [\n            { \"bSortable\": false, \"aTargets\": [ 0 ] },\n            { \"bVisible\": false, \"aTargets\": [ 1 ] }\n        ]\n    });\n\n    $('#import_list tbody td').on('click', 'img', function () {\n        var nTr = $(this).parents('tr')[0];\n        if ( oTable.fnIsOpen(nTr) )\n        {\n            /* This row is already open - close it */\n            this.src = \"/details_open.png\";\n            oTable.fnClose( nTr );\n        }\n        else\n        {\n            /* Open this row */\n            this.src = \"/details_close.png\";\n            oTable.fnOpen( nTr, fnFormatDetails(oTable, nTr), 'details' );\n        }\n    } );\n\n});\n</script>\n", "<h1>Pending types</h1>\n\n<table id=\"types_table\">\n<thead>\n<tr>\n <th>ID</th>\n <th>Name</th>\n <th>Scientific</th>\n <th>Categories</th>\n <th>Edit</th>\n <th>Delete</th>\n</tr>\n</thead>\n<tbody>\n<% @types.each do |type| %>\n<tr>\n<td style=\"text-align:right\"><%= type.id %></td>\n<td>\n <% unless type.wikipedia_url.blank? %>\n  <a href=\"<%= type.wikipedia_url %>\" target=\"_blank\"><%= h type.en_name %></a>\n <% else %>\n  <%= type.en_name %>\n <% end %>\n <%= \"(#{type.en_synonyms})\" unless type.en_synonyms.blank? %>\n</td>\n<td>\n  <%= type.scientific_name %>\n</td>\n<td><%= mask_to_array(type.category_mask,Type::Categories).join(\", \") %></td>\n<td><%= link_to 'Edit', edit_type_path(type) %></td>\n<td><%= link_to 'Delete', type, method: :delete, data: { confirm: 'Are you sure?' } %></td>\n</tr>\n<% end %>\n</tbody>\n</table>\n\n<script type=\"text/javascript\" charset=\"utf-8\">\njQuery(document).ready(function(){\n    jQuery('#types_table').dataTable({\n      \"aaSorting\": [[0,\"desc\"]],\n      \"bPaginate\": false\n    });\n});\n</script>\n", "<h1>Approved types</h1>\n\n<%= link_to '[+] Add type', new_type_path %>\n\n<table id=\"types_table\">\n  <thead>\n    <tr>\n     <th>ID</th>\n     <th>PID</th>\n     <th>Rank</th>\n     <th>Latin</th>\n     <th>en</th>\n     <th>Cats</th>\n     <th>W</th>\n     <th>Edit</th>\n     <th>Delete</th>\n    </tr>\n  </thead>\n  <tbody>\n  <% @types.each do |type| %>\n    <tr>\n      <td style=\"text-align:right\"><%= type.id %></td>\n      <td style=\"text-align:right\"><%= type.parent_id %></td>\n      <td>\n      <% unless type.taxonomic_rank.blank? %>\n        <%= type.taxonomic_rank.to_s + \" \" + Type::Ranks[type.taxonomic_rank] %>\n      <% end %>\n      </td>\n      <td><%= type.scientific_name %> <%= \"(#{type.scientific_synonyms})\" unless type.scientific_synonyms.blank? %></td>\n      <td>\n       <%= type.en_name %>\n       <%= \"(#{type.en_synonyms})\" unless type.en_synonyms.blank? %>\n      </td>\n      <td><%= mask_to_array(type.category_mask,Type::Categories).join(\", \") %></td>\n      <td style=\"text-align:center;\">\n      <% unless type.wikipedia_url.blank? %>\n        <a href=\"<%= type.wikipedia_url %>\" target=\"_blank\">W</a>\n      <% end %>\n      </td>\n      <td><%= link_to 'Edit', edit_type_path(type) %></td>\n      <td><%= link_to 'Delete', type, method: :delete, data: { confirm: 'Are you sure?' } %></td>\n    </tr>\n  <% end %>\n  </tbody>\n</table>\n\n<script type=\"text/javascript\" charset=\"utf-8\">\n  jQuery(document).ready(function(){\n    jQuery('#types_table').dataTable({\n      \"aaSorting\": [[3, \"asc\"], [2, \"asc\"], [4, \"asc\"]],\n      \"bPaginate\": false\n    });\n  });\n</script>\n"], "filenames": ["app/views/changes/index.html.erb", "app/views/imports/show.html.erb", "app/views/layouts/application.html.erb", "app/views/pages/datasets.html.erb", "app/views/types/grow.html.erb", "app/views/types/index.html.erb"], "buggy_code_start_loc": [30, 29, 77, 45, 20, 37], "buggy_code_end_loc": [31, 35, 78, 50, 21, 38], "fixing_code_start_loc": [30, 29, 77, 45, 20, 37], "fixing_code_end_loc": [31, 35, 78, 50, 21, 38], "type": "CWE-79", "message": "A vulnerability has been found in falling-fruit and classified as problematic. This vulnerability affects unknown code. The manipulation leads to cross site scripting. The attack can be initiated remotely. The name of the patch is 15adb8e1ea1f1c3e3d152fc266071f621ef0c621. It is recommended to apply a patch to fix this issue. VDB-215446 is the identifier assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2022-4456", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-13T18:15:10.967", "lastModified": "2022-12-19T16:06:39.280", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability has been found in falling-fruit and classified as problematic. This vulnerability affects unknown code. The manipulation leads to cross site scripting. The attack can be initiated remotely. The name of the patch is 15adb8e1ea1f1c3e3d152fc266071f621ef0c621. It is recommended to apply a patch to fix this issue. VDB-215446 is the identifier assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "cna@vuldb.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fallingfruit:falling-fruit:*:*:*:*:*:*:*:*", "versionEndExcluding": "2022-03-07", "matchCriteriaId": "29109DF5-CADA-4CE7-82FD-6ECE5064199D"}]}]}], "references": [{"url": "https://github.com/falling-fruit/falling-fruit/commit/15adb8e1ea1f1c3e3d152fc266071f621ef0c621", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.215446", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/falling-fruit/falling-fruit/commit/15adb8e1ea1f1c3e3d152fc266071f621ef0c621"}}