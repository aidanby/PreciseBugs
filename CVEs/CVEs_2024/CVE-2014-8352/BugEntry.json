{"buggy_code": ["<?php\n/*Copyright (c) 2013, St\u00e9phane Petitcolas\nThis file is part of CookieViz\n\nCookieViz is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nCookieViz is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with CookieViz.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\nrequire \"connect.php\";\n\nif(isset($_GET[\"domain\"]))\n{\n\t$domain = $_GET[\"domain\"];\n}\necho '<table id=\"infos\">';\n echo \"<thead>\";\n echo \"<tr>\";\n echo \"<th>From</th>\";\n echo \"<th>To</th>\";\n echo \"<th>Cookies</th>\";\n echo \"</tr>\";\n echo \"</thead>\";\n echo \"<tbody>\";\n$query=\"SELECT * FROM url_referer WHERE referer_domains='\".$domain.\"'GROUP BY url_domains, referer_domains\";\n$result = mysql_query($query) or die (\"Echec de la requ\u00eate : \".$query.\" \". mysql_error());\nwhile ($line = mysql_fetch_assoc($result))\n{\n\techo \"<tr>\";\n\tif ($line[\"is_cookie\"] == 1)\n\t{\n\t\techo \"<td>\".$line[\"referer_domains\"];\n\t\techo \"<td>\".$line[\"url_domains\"];\n\t\techo \"<td>\".$line[\"cookie\"];\n\t}\n\techo \"</tr>\";\n}\n$query=\"SELECT * FROM url_referer WHERE url_domains='\".$domain.\"'GROUP BY url_domains, referer_domains\";\n$result = mysql_query($query) or die (\"Echec de la requ\u00eate : \".$query.\" \". mysql_error());\nwhile ($line = mysql_fetch_assoc($result))\n{\n\techo \"<tr>\";\n\tif ($line[\"is_cookie\"] == 1)\n\t{\n\t\techo \"<td>\".$line[\"referer_domains\"];\n\t\techo \"<td>\".$line[\"url_domains\"];\n\t\techo \"<td>\".$line[\"cookie\"];\n\t}\n\techo \"</tr>\";\n}\necho \"</tbody>\";\necho \"</table>\";\nrequire \"disconnect.php\";\n?>", "<?php\n/*Copyright (c) 2013, St\u00e9phane Petitcolas\nThis file is part of CookieViz\n\nCookieViz is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nCookieViz is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with CookieViz.  If not, see <http://www.gnu.org/licenses/>.*/\n\n\nrequire \"connect.php\";\nrequire \"load_point.php\";\n$domain=\"\";\n$init_max_date=0;\n\nif(isset($_GET[\"max_date\"]))\n{\n\t$init_max_date = $_GET[\"max_date\"];\n}\n\nif(isset($_GET[\"domain\"]))\n{\n\t$domain = $_GET[\"domain\"];\n}\n\n$max_date = $init_max_date;\n$point_map = new point_map($domain);\n$map = $point_map->get_map();\n$write_nodes='[';\n$write_links='[';\n$cpt_unique_nodes=0;\n$cpt_unique_links=0;\n$color = \"#00f0ff\";\n$min_date=0;\n$cpt=0;\nif (isset($map))\n{\n\tif (strcmp($domain, \"\") == 0)\n\t{\n\t\tforeach ($map as $url_domain => $point)\n\t\t{\n \t\tif ($point->date_time > $init_max_date)\n\t\t{\n\t\t\t$group=1;\n\t\tif ($cpt_unique_nodes == 0 && !isset($is_writen[$point->url_domains]))  \n\t\t{\n\t\t\t$write_nodes.='{\"name\":\"'.$point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$point->date_time.'\", \"size\":'.$point->size.', \"link\":\"0\"}';\n\t\t\t$is_writen[$point->url_domains] = TRUE;\n\t\t\tif ($max_date < $point->date_time)\n\t\t\t{\t\n\t\t\t\t$max_date=$point->date_time;\n\t\t\t}\t\n\t\t\t$cpt_unique_nodes = 1;\n\t\t\tif ($point->has_link != 0)\n\t\t\t{\n\t\t\t\tforeach ($point->link as $id => $name_to_link)\n\t\t\t\t{\n\t\t\t\t\t$point_to_link = $map[$name_to_link];\n\t\t\t\t\tif ($point->id != $point_to_link->id)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($cpt_unique_links == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$write_links.='{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\t\t\n\t\t\t\t\t\t\t$cpt_unique_links = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$write_links.=',{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif ($point->date_time >= $init_max_date)\n\t\t\t{\n\t\t\t\tif (!isset($is_writen[$point->url_domains]))\n\t\t\t\t{\n\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$point->date_time.'\", \"size\":'.$point->size.', \"link\":\"0\"}';\n\t\t\t\t\t$is_writen[$point->url_domains] = TRUE;\n\t\t\t\t}\n\t\t\t\tif ($max_date < $point->date_time)\n\t\t\t\t{\t\n\t\t\t\t\t$max_date=$point->date_time;\n\t\t\t\t}\t\t\t      \n\t\t\t\tif ($point->has_link != 0)\n\t\t\t\t{\n\t\t\t\t\tforeach ($point->link as $id => $name_to_link)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isset($map[$name_to_link]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$point_to_link = $map[$name_to_link];\n\t\t\t\t\t\t\tif ($point->id != $point_to_link->id)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($point->is_cookie == TRUE)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$color = \"#ff0000\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$color = \"#00f0ff\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ($cpt_unique_links == 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$write_links.='{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\t\t\t\n\t\t\t\t\t\t\t\t\t$cpt_unique_links = 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$write_links.=',{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\t}\n\t}\n\telse\n\t{\n\t\tforeach ($map as $url_domain => $point)\n\t\t{\n \t\tif ($point->date_time > $init_max_date)\n\t\t{\n\t\t\t$group=1;\n\t\tif ($cpt_unique_nodes == 0 && (strcmp($domain, $point->url_domains) == 0  || (strcmp($domain, $point->url_domains) != 0 && $point->as_link_with($domain) == TRUE) ))  \n\t\t{\n\t\t\tif (!isset($is_writen[$point->url_domains]))\n\t\t\t{\n\t\t\t\t$write_nodes.='{\"name\":\"'.$point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$point->date_time.'\", \"size\":'.$point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t$is_writen[$point->url_domains] =  TRUE;\n\t\t\t}\n\t\t\tif ($max_date < $point->date_time)\n\t\t\t{\t\n\t\t\t\t$max_date=$point->date_time;\n\t\t\t}\t\n\t\t\t$cpt_unique_nodes = 1;\n\t\t\tif ($point->has_link != 0)\n\t\t\t{\n\t\t\t\tforeach ($point->link as $id => $name_to_link)\n\t\t\t\t{\n\t\t\t\t\tif (isset($map[$name_to_link]))\n\t\t\t\t\t{\n\t\t\t\t\t\t$point_to_link = $map[$name_to_link];\n\t\t\t\t\t\tif ($point->id != $point_to_link->id)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (strcmp($point_to_link->url_domains, $domain) == 0 || strcmp($point->url_domains, $domain) == 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($cpt_unique_links == 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$tmp_point = $map[$point_to_link->url_domains];\n\t\t\t\t\t\t\t\t\tif (!isset($is_writen[$tmp_point->url_domains]))\n                        \t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$tmp_point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$tmp_point->date_time.'\", \"size\":'.$tmp_point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t\t\t\t\t\t$is_writen[$tmp_point->url_domains] = TRUE;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$write_links.='{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\t\t\t\n\t\t\t\t\t\t\t\t\t$cpt_unique_links = 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$tmp_point = $map[$point_to_link->url_domains];\n\t\t\t\t\t\t\t\t\tif (!isset($is_writen[$tmp_point->url_domains]))\n                                                                        {\n\t\t\t\t\t\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$tmp_point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$tmp_point->date_time.'\", \"size\":'.$tmp_point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t\t\t\t\t\t$is_writen[$tmp_point->url_domains] = TRUE;\n                                                                        }\n\t\t\t\t\t\t\t\t\t$write_links.=',{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif ($point->date_time >= $init_max_date && (strcmp($domain, $point->url_domains) == 0  || (strcmp($domain, $point->url_domains) != 0 && $point->as_link_with($domain) != 0) ))  \n\t\t\t{\n\t\t\t\tif (!isset($is_writen[$point->url_domains]))\n                        \t{\t\t\t\n\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$point->date_time.'\", \"size\":'.$point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t$is_writen[$point->url_domains] =  TRUE;\n\t\t\t\t}\n\t\t\t\tif ($max_date > $point->date_time)\n\t\t\t\t{\t\n\t\t\t\t\t$max_date=$point->date_time;\n\t\t\t\t}\t\t\t      \n\t\t\t\tif ($point->has_link != 0)\n\t\t\t\t{\n\t\t\t\t\tforeach ($point->link as $id => $name_to_link)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isset($map[$name_to_link]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$point_to_link = $map[$name_to_link];\n\t\t\t\t\t\t\tif ($point->id != $point_to_link->id)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($point->is_cookie == TRUE)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$color = \"#ff0000\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$color = \"#00f0ff\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (strcmp($point_to_link->url_domains, $domain) == 0 || strcmp($point->url_domains, $domain) == 0)\n\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif ($cpt_unique_links == 0 )\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$tmp_point = $map[$point_to_link->url_domains];\n\t\t\t\t\t\t\t\t\t\tif (!isset($is_writen[$tmp_point->url_domains]))\n                                                                        \t{\n\t\t\t\t\t\t\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$tmp_point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$tmp_point->date_time.'\", \"size\":'.$tmp_point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t\t\t\t\t\t\t$is_writen[$tmp_point->url_domains] = TRUE;\n                                                                        \t}\n\t\t\t\t\t\t\t\t\t\t$write_links.='{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\t\t\t\n\t\t\t\t\t\t\t\t\t\t$cpt_unique_links = 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$tmp_point = $map[$point_to_link->url_domains];\n\t\t\t\t\t\t\t\t\t\tif (!isset($is_writen[$tmp_point->url_domains]))\n                                                                                {\n\t\t\t\t\t\t\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$tmp_point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$tmp_point->date_time.'\", \"size\":'.$tmp_point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t\t\t\t\t\t\t$is_writen[$tmp_point->url_domains] = TRUE;\n                                                                                }\n\t\t\t\t\t\t\t\t\t\t$write_links.=',{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\t}\n\t}\n}\n$write_nodes.=']';\n$write_links.=']';\n\nrequire \"disconnect.php\";\nprint '{\"inf_nodes\":'.$write_nodes.',\"inf_links\":'.$write_links.',\"max_date\":\"'.$max_date.'\",\"cpt\":'.$cpt.'}';\n//print '{\"inf_nodes\":'.$write_nodes.',\"inf_links\":'.$write_links.'}';\n?>"], "fixing_code": ["<?php\n/*Copyright (c) 2013, St\u00e9phane Petitcolas\nThis file is part of CookieViz\n\nCookieViz is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nCookieViz is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with CookieViz.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\nrequire \"connect.php\";\n\nif(isset($_GET[\"domain\"]))\n{\n\t$domain = mysql_real_escape_string($_GET[\"domain\"]);\n\t\n}\nelse\n{\n\texit;\n}\n\necho '<table id=\"infos\">';\n echo \"<thead>\";\n echo \"<tr>\";\n echo \"<th>From</th>\";\n echo \"<th>To</th>\";\n echo \"<th>Cookies</th>\";\n echo \"</tr>\";\n echo \"</thead>\";\n echo \"<tbody>\";\n$query=\"SELECT * FROM url_referer WHERE referer_domains='\".$domain.\"'GROUP BY url_domains, referer_domains\";\n$result = mysql_query($query) or die (\"Echec de la requ\u00eate : \".$query.\" \". mysql_error());\nwhile ($line = mysql_fetch_assoc($result))\n{\n\techo \"<tr>\";\n\tif ($line[\"is_cookie\"] == 1)\n\t{\n\t\techo \"<td>\".$line[\"referer_domains\"];\n\t\techo \"<td>\".$line[\"url_domains\"];\n\t\techo \"<td>\".$line[\"cookie\"];\n\t}\n\techo \"</tr>\";\n}\n$query=\"SELECT * FROM url_referer WHERE url_domains='\".$domain.\"'GROUP BY url_domains, referer_domains\";\n$result = mysql_query($query) or die (\"Echec de la requ\u00eate : \".$query.\" \". mysql_error());\nwhile ($line = mysql_fetch_assoc($result))\n{\n\techo \"<tr>\";\n\tif ($line[\"is_cookie\"] == 1)\n\t{\n\t\techo \"<td>\".$line[\"referer_domains\"];\n\t\techo \"<td>\".$line[\"url_domains\"];\n\t\techo \"<td>\".$line[\"cookie\"];\n\t}\n\techo \"</tr>\";\n}\necho \"</tbody>\";\necho \"</table>\";\nrequire \"disconnect.php\";\n?>", "<?php\n/*Copyright (c) 2013, St\u00e9phane Petitcolas\nThis file is part of CookieViz\n\nCookieViz is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nCookieViz is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with CookieViz.  If not, see <http://www.gnu.org/licenses/>.*/\n\n\nrequire \"connect.php\";\nrequire \"load_point.php\";\n$domain=\"\";\n$init_max_date=0;\n\nif(isset($_GET[\"max_date\"]))\n{\n\t$init_max_date = \tmysql_real_escape_string($_GET[\"max_date\"]);\n\tif (!is_numeric($init_max_date))\n\t{\n\t\t$init_max_date=\"\";\n\t}\n}\n\nif(isset($_GET[\"domain\"]))\n{\n\t$domain = mysql_real_escape_string($_GET[\"domain\"]);\n}\n\n$max_date = $init_max_date;\n$point_map = new point_map($domain);\n$map = $point_map->get_map();\n$write_nodes='[';\n$write_links='[';\n$cpt_unique_nodes=0;\n$cpt_unique_links=0;\n$color = \"#00f0ff\";\n$min_date=0;\n$cpt=0;\nif (isset($map))\n{\n\tif (strcmp($domain, \"\") == 0)\n\t{\n\t\tforeach ($map as $url_domain => $point)\n\t\t{\n \t\tif ($point->date_time > $init_max_date)\n\t\t{\n\t\t\t$group=1;\n\t\tif ($cpt_unique_nodes == 0 && !isset($is_writen[$point->url_domains]))  \n\t\t{\n\t\t\t$write_nodes.='{\"name\":\"'.$point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$point->date_time.'\", \"size\":'.$point->size.', \"link\":\"0\"}';\n\t\t\t$is_writen[$point->url_domains] = TRUE;\n\t\t\tif ($max_date < $point->date_time)\n\t\t\t{\t\n\t\t\t\t$max_date=$point->date_time;\n\t\t\t}\t\n\t\t\t$cpt_unique_nodes = 1;\n\t\t\tif ($point->has_link != 0)\n\t\t\t{\n\t\t\t\tforeach ($point->link as $id => $name_to_link)\n\t\t\t\t{\n\t\t\t\t\t$point_to_link = $map[$name_to_link];\n\t\t\t\t\tif ($point->id != $point_to_link->id)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($cpt_unique_links == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$write_links.='{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\t\t\n\t\t\t\t\t\t\t$cpt_unique_links = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$write_links.=',{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif ($point->date_time >= $init_max_date)\n\t\t\t{\n\t\t\t\tif (!isset($is_writen[$point->url_domains]))\n\t\t\t\t{\n\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$point->date_time.'\", \"size\":'.$point->size.', \"link\":\"0\"}';\n\t\t\t\t\t$is_writen[$point->url_domains] = TRUE;\n\t\t\t\t}\n\t\t\t\tif ($max_date < $point->date_time)\n\t\t\t\t{\t\n\t\t\t\t\t$max_date=$point->date_time;\n\t\t\t\t}\t\t\t      \n\t\t\t\tif ($point->has_link != 0)\n\t\t\t\t{\n\t\t\t\t\tforeach ($point->link as $id => $name_to_link)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isset($map[$name_to_link]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$point_to_link = $map[$name_to_link];\n\t\t\t\t\t\t\tif ($point->id != $point_to_link->id)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($point->is_cookie == TRUE)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$color = \"#ff0000\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$color = \"#00f0ff\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ($cpt_unique_links == 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$write_links.='{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\t\t\t\n\t\t\t\t\t\t\t\t\t$cpt_unique_links = 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$write_links.=',{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\t}\n\t}\n\telse\n\t{\n\t\tforeach ($map as $url_domain => $point)\n\t\t{\n \t\tif ($point->date_time > $init_max_date)\n\t\t{\n\t\t\t$group=1;\n\t\tif ($cpt_unique_nodes == 0 && (strcmp($domain, $point->url_domains) == 0  || (strcmp($domain, $point->url_domains) != 0 && $point->as_link_with($domain) == TRUE) ))  \n\t\t{\n\t\t\tif (!isset($is_writen[$point->url_domains]))\n\t\t\t{\n\t\t\t\t$write_nodes.='{\"name\":\"'.$point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$point->date_time.'\", \"size\":'.$point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t$is_writen[$point->url_domains] =  TRUE;\n\t\t\t}\n\t\t\tif ($max_date < $point->date_time)\n\t\t\t{\t\n\t\t\t\t$max_date=$point->date_time;\n\t\t\t}\t\n\t\t\t$cpt_unique_nodes = 1;\n\t\t\tif ($point->has_link != 0)\n\t\t\t{\n\t\t\t\tforeach ($point->link as $id => $name_to_link)\n\t\t\t\t{\n\t\t\t\t\tif (isset($map[$name_to_link]))\n\t\t\t\t\t{\n\t\t\t\t\t\t$point_to_link = $map[$name_to_link];\n\t\t\t\t\t\tif ($point->id != $point_to_link->id)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (strcmp($point_to_link->url_domains, $domain) == 0 || strcmp($point->url_domains, $domain) == 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($cpt_unique_links == 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$tmp_point = $map[$point_to_link->url_domains];\n\t\t\t\t\t\t\t\t\tif (!isset($is_writen[$tmp_point->url_domains]))\n                        \t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$tmp_point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$tmp_point->date_time.'\", \"size\":'.$tmp_point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t\t\t\t\t\t$is_writen[$tmp_point->url_domains] = TRUE;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t$write_links.='{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\t\t\t\n\t\t\t\t\t\t\t\t\t$cpt_unique_links = 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$tmp_point = $map[$point_to_link->url_domains];\n\t\t\t\t\t\t\t\t\tif (!isset($is_writen[$tmp_point->url_domains]))\n                                                                        {\n\t\t\t\t\t\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$tmp_point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$tmp_point->date_time.'\", \"size\":'.$tmp_point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t\t\t\t\t\t$is_writen[$tmp_point->url_domains] = TRUE;\n                                                                        }\n\t\t\t\t\t\t\t\t\t$write_links.=',{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif ($point->date_time >= $init_max_date && (strcmp($domain, $point->url_domains) == 0  || (strcmp($domain, $point->url_domains) != 0 && $point->as_link_with($domain) != 0) ))  \n\t\t\t{\n\t\t\t\tif (!isset($is_writen[$point->url_domains]))\n                        \t{\t\t\t\n\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$point->date_time.'\", \"size\":'.$point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t$is_writen[$point->url_domains] =  TRUE;\n\t\t\t\t}\n\t\t\t\tif ($max_date > $point->date_time)\n\t\t\t\t{\t\n\t\t\t\t\t$max_date=$point->date_time;\n\t\t\t\t}\t\t\t      \n\t\t\t\tif ($point->has_link != 0)\n\t\t\t\t{\n\t\t\t\t\tforeach ($point->link as $id => $name_to_link)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isset($map[$name_to_link]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$point_to_link = $map[$name_to_link];\n\t\t\t\t\t\t\tif ($point->id != $point_to_link->id)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($point->is_cookie == TRUE)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$color = \"#ff0000\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$color = \"#00f0ff\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (strcmp($point_to_link->url_domains, $domain) == 0 || strcmp($point->url_domains, $domain) == 0)\n\t\t\t\t\t\t\t\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif ($cpt_unique_links == 0 )\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$tmp_point = $map[$point_to_link->url_domains];\n\t\t\t\t\t\t\t\t\t\tif (!isset($is_writen[$tmp_point->url_domains]))\n                                                                        \t{\n\t\t\t\t\t\t\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$tmp_point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$tmp_point->date_time.'\", \"size\":'.$tmp_point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t\t\t\t\t\t\t$is_writen[$tmp_point->url_domains] = TRUE;\n                                                                        \t}\n\t\t\t\t\t\t\t\t\t\t$write_links.='{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\t\t\t\n\t\t\t\t\t\t\t\t\t\t$cpt_unique_links = 1;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$tmp_point = $map[$point_to_link->url_domains];\n\t\t\t\t\t\t\t\t\t\tif (!isset($is_writen[$tmp_point->url_domains]))\n                                                                                {\n\t\t\t\t\t\t\t\t\t\t\t$write_nodes.=',{\"name\":\"'.$tmp_point->url_domains.'\",\"group\":'.$group.', \"date\":\"'.$tmp_point->date_time.'\", \"size\":'.$tmp_point->size.', \"link\":\"'.$point->has_link.'\"}';\n\t\t\t\t\t\t\t\t\t\t\t$is_writen[$tmp_point->url_domains] = TRUE;\n                                                                                }\n\t\t\t\t\t\t\t\t\t\t$write_links.=',{\"source\":\"'.$point_to_link->url_domains.'\",\"target\":\"'.$point->url_domains.'\",\"value\":'.$group.', \"cookie\":\"'.$point->is_cookie.'\"}';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\t}\n\t}\n}\n$write_nodes.=']';\n$write_links.=']';\n\nrequire \"disconnect.php\";\nprint '{\"inf_nodes\":'.$write_nodes.',\"inf_links\":'.$write_links.',\"max_date\":\"'.$max_date.'\",\"cpt\":'.$cpt.'}';\n//print '{\"inf_nodes\":'.$write_nodes.',\"inf_links\":'.$write_links.'}';\n?>"], "filenames": ["cookieviz/info.php", "cookieviz/json.php"], "buggy_code_start_loc": [23, 26], "buggy_code_end_loc": [24, 32], "fixing_code_start_loc": [23, 26], "fixing_code_end_loc": [31, 36], "type": "CWE-79", "message": "Cross-site scripting (XSS) vulnerability in json.php in French National Commission on Informatics and Liberty (aka CNIL) CookieViz allows remote we servers to inject arbitrary web script or HTML via the max_date parameter.", "other": {"cve": {"id": "CVE-2014-8352", "sourceIdentifier": "cve@mitre.org", "published": "2014-11-06T15:55:09.070", "lastModified": "2017-09-08T01:29:22.857", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "Cross-site scripting (XSS) vulnerability in json.php in French National Commission on Informatics and Liberty (aka CNIL) CookieViz allows remote we servers to inject arbitrary web script or HTML via the max_date parameter."}, {"lang": "es", "value": "Vulnerabilidad de XSS en json.php en French National Commission on Informatics and Liberty (tambi\u00e9n conocido como CNIL) CookieViz permite a servidores we remotos inyectar secuencias de comandos web o HTML arbitrarios a trav\u00e9s del par\u00e1metro max_date."}], "metrics": {"cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:french_national_commission_on_informatics_and_liberty:cookieviz:-:*:*:*:*:*:*:*", "matchCriteriaId": "A05E1C49-CB44-45F3-BD32-D89DEAA181F3"}]}]}], "references": [{"url": "http://packetstormsecurity.com/files/128960/CNIL-CookieViz-Cross-Site-Scripting-SQL-Injection.html", "source": "cve@mitre.org", "tags": ["Exploit"]}, {"url": "http://seclists.org/fulldisclosure/2014/Nov/3", "source": "cve@mitre.org", "tags": ["Exploit"]}, {"url": "https://exchange.xforce.ibmcloud.com/vulnerabilities/98452", "source": "cve@mitre.org"}, {"url": "https://github.com/LaboCNIL/CookieViz/commit/489b6050f6c53fe7b24c4bed3eeb9c25543960e2", "source": "cve@mitre.org", "tags": ["Patch"]}]}, "github_commit_url": "https://github.com/LaboCNIL/CookieViz/commit/489b6050f6c53fe7b24c4bed3eeb9c25543960e2"}}