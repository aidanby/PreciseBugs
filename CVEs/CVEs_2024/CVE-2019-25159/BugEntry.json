{"buggy_code": ["<?php\nrequire('../bootstrap.php');\n\nacl_acceso($_SESSION['cargo'], array('0', '1'));\n\ninclude (\"../menu.php\");\n?>\n<div class='container-fluid'>\n\n\t<div class=\"page-header\">\n\t  <h2>Administraci\u00f3n <small> Perfiles de Profesores</small></h2>\n\t</div>\n\n\t<?php\n\tif ($_GET['borrar']=='1') {\n\t\tmysqli_query($db_con, \"delete from departamentos where dni = '\".$_GET['dni_profe'].\"'\");\n\t\techo '<div class=\"alert alert-success\">\n\t            <button type=\"button\" class=\"close\" data-dismiss=\"alert\">&times;</button>\n\t            El profesor ha sido borrado de la base de datos..\n\t          </div>';\n\t}\n\tif (isset($_POST['enviar'])) {\n\n\tmysqli_query($db_con, \"update c_profes set telefono = ''\" );\n\tmysqli_query($db_con, \"truncate table FTUTORES\" );\n\tmysqli_query($db_con, \"truncate table cargos \" );\n\n\t\tforeach ( $_POST as $dni => $cargo_profe ) {\n\t\t\t// echo \"$dni => $cargo_profe<br>\";\n\t\t\tif ($cargo_profe == \"Enviar\") {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\telseif (is_numeric($cargo_profe) and strlen ( $cargo_profe ) == \"9\") {\n\t\t\t\t$dni = substr ( $dni, 1, -2 );\n\t\t\t\t$n_profe = mysqli_query($db_con, \"update c_profes set telefono = '$cargo_profe' where dni like '%$dni'\" );\n\t\t\t\t//echo \"update c_profes set telefono = '$cargo_profe' where dni like '%$dni'<br>\";\n\t\t\t}\n\t\t\telseif (strlen ( $cargo_profe ) > \"1\" and !(is_numeric($cargo_profe))) {\n\t\t\t\t$dni = substr ( $dni, 0, -2 );\n\t\t\t\t$n_profe = mysqli_query($db_con, \"select nombre from departamentos where dni='$dni'\" );\n\t\t\t\t$n_prof = mysqli_fetch_array ( $n_profe );\n\t\t\t\t$unidad = $cargo_profe;\n\t\t\t\t$n_tutor = mb_strtoupper ( $n_prof [0], 'UTF-8' );\n\n\t\t\t\tmysqli_query($db_con, \"insert INTO `FTUTORES` ( `unidad` , `tutor`, `observaciones1`, `observaciones2` ) VALUES ('$unidad', '$n_tutor', '', '')\" ) or die (mysqli_error($db_con));\n\n\t\t\t} elseif (strlen ( $cargo_profe ) < \"2\") {\n\t\t\t\t$dni=trim($dni);\n\t\t\t\tmysqli_query($db_con, \"update departamentos set cargo = ''\" );\n\t\t\t\t$dni = substr ($dni, 0, -1);\n\t\t\t\tmysqli_query($db_con, \"INSERT INTO `cargos` ( `dni` , `cargo` ) VALUES ('$dni', '$cargo_profe')\" );\n\t\t\t}\n\t\t}\n\n\t\t$n_cargo = mysqli_query($db_con, \"select dni from departamentos\" );\n\t\twhile ( $n_carg = mysqli_fetch_array ( $n_cargo ) ) {\n\t\t\t$num_cargos = \"\";\n\t\t\t$num_car = mysqli_query($db_con, \"select distinct cargo from cargos where dni = '$n_carg[0]'\" );\n\t\t\twhile ( $num_carg = mysqli_fetch_array ( $num_car ) ) {\n\t\t\t\t$num_cargos .= $num_carg [0];\n\t\t\t}\n\t\t\tmysqli_query($db_con, \"update departamentos set cargo='$num_cargos' where dni='$n_carg[0]'\" );\n\t\t}\n\techo '<div class=\"alert alert-success\">\n\tLos perfiles han sido asignados correctamente a los profesores.\n\t          </div>';\n\t}\n\t?>\n\n  <div class=\"row\">\n\n   <div class=\"col-sm-12\">\n\n   <style type=\"text/css\">\n   thead th {\n   \tfont-size: 0.8em;\n   }\n   </style>\n\n\t\t<?php\n\t\t$head = '<thead>\n\t\t\t<tr>\n\t\t\t<th>Profesor</th>';\n\t\t\tif ($_SESSION['ide'] == \"admin\") {\n\t\t\t$head .= '<th><span data-bs=\"tooltip\" title=\"Administradores de la Aplicaci\u00f3n\">Admin</span></th>';\n\t\t\t}\n\t\t\t$head .= '<th><span data-bs=\"tooltip\" title=\"Miembros del Equipo Directivo del Centro\">Direcci\u00f3n</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Tutores de Grupo de todos los niveles\">Tutor</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Jefes de los distintos Departamentos que el IES ha seleccionado.\">JD</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Miembros del Equipo T\u00e9cnico de Coordinaci\u00f3n Pedadg\u00f3gica\">ETCP</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Miembro del departamento de Actividades Complementarias y Extraescolares.\">DACE</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Miembros del personal de Administracci\u00f3n y Servicios: Conserjes.\">Conserje</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Miembros del personal de Administracci\u00f3n y Servicios: Administrativos\">Administ.</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Todos los profesores que pertenecen al Equipo de Orientaci\u00f3n, inclu\u00eddos ATAL, Apoyo, PCPI, etc.\">Orienta.</span></th>';\n\t\tif($config['mod_bilingue']) $head .= '<th><span data-bs=\"tooltip\" title=\"Profesores que participan en el Plan de Bilinguismo\">Biling\u00fce</span></th>';\n\n\t\tif ($config['mod_convivencia']==1) {\n\t\t$head .= '<th><span data-bs=\"tooltip\" title=\"Profesores encargados de atender a los alumnos en el Aula de Convivencia del Centro, si este cuenta con ella.\">Conv.</span></th>';\n\t\t}\n\t\tif($config['mod_biblioteca']) $head .= '<th><span data-bs=\"tooltip\" title=\"Profesores que participan en el Plan de Bibliotecas o se encargan de llevar la Biblioteca del Centro\">Biblio.</span></th>';\n\t\t$head .= '<th><span data-bs=\"tooltip\" title=\"Profesor encargado de las Relaciones de G\u00e9nero\">G\u00e9nero</span></th>\n\t\t\t\t  <th><span data-bs=\"tooltip\" title=\"Departamento de Formacci\u00f3n, Innovaci\u00f3n y Evaluaci\u00f3n\">DFEIE</span></th>\n\t\t\t\t  <th><span data-bs=\"tooltip\" title=\"Tel\u00e9fono m\u00f3vil del Profesor\">Tfno. M\u00f3vil</span></th>\n\t\t\t\t  <th>&nbsp;</th>\n\t\t\t</tr>\n\t\t\t</thead>';\n\t\t?>\n\n\t\t<form name=\"cargos\" action=\"cargos.php\" method=\"post\">\n\n\t\t<p class=\"help-block\">\n\t\t\tSi necesitas informaci\u00f3n sobre los distintos perfiles de los profesores, puedes conseguirla colocando el cursor del rat\u00f3n sobre los distintos tipos de perfiles.\n\t\t</p>\n\n\t\t<table class=\"table table-bordered table-striped table-condensed\">\n\t\t<?php echo $head;?>\n\t\t\t<tbody>\n\t\t<?php\n\t\t$carg0 = mysqli_query($db_con, \"select distinct departamentos.nombre, departamentos.cargo, departamentos.dni, departamentos.idea, c_profes.telefono from departamentos, c_profes where departamentos.idea=c_profes.idea order by departamentos.nombre\" );\n\t\t$num_profes = mysqli_num_rows ( $carg0 );\n\t\twhile ( $carg1 = mysqli_fetch_array ( $carg0 ) ) {\n\t\t\t$pro = $carg1 [0];\n\t\t\t$car = $carg1 [1];\n\t\t\t$dni = $carg1 [2];\n\t\t\t$idea = $carg1 [3];\n\t\t\t$telefono = $carg1 [4];\n\t\t\tif ($telefono=='0') {\n\t\t\t\t$telefono=\"\";\n\t\t\t}\n\t\t\t$n_i = $n_i + 10;\n\t\t\tif ($n_i % 100 == 0) {\n\t\t\t\techo $head;\n\t\t\t}\n\t\t\t?>\n\t\t<tr<?php echo ($idea == 'admin' && $_SESSION['ide'] != 'admin') ? ' style=\"display: none;\"' : ''; ?>>\n\t\t\t\t<td nowrap><small><?php\n\t\t\techo $pro;\n\t\t\t?></small>\n\t\t\t</td>\n\n\t\t\t<?php if ($_SESSION['ide'] == \"admin\"): ?>\n\t\t\t<td class=\"text-center\">\n\t\t\t\t<input type=\"checkbox\" name=\"<?php echo $dni; ?>0\" value=\"0\" <?php if (stristr ( $car, '0' ) == TRUE) { echo \"checked\"; } if ($idea == \"admin\") { echo \"checked disabled\"; } ?> />\n\t\t\t</td>\n\t\t\t<?php endif; ?>\n\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>1\"\n\t\t\t\t\tvalue=\"1\" <?php\n\t\t\tif (stristr ( $car, '1' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?>\n\t\t\t\t\t /></td>\n\t\t\t\t<td class=\"form-inline\" nowrap><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>2\"\n\t\t\t\t\tvalue=\"2\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '2' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /> <select class=\"form-control input-sm\" style=\"width: 100px;\"\n\t\t\t\t\tname=\"<?php\n\t\t\techo $dni;\n\t\t\t?>2t\">\n\t\t  <?php\n\t\t\t$curso_tut = mysqli_query($db_con, \"select unidad from FTUTORES, departamentos where tutor=nombre and dni='$dni'\" );\n\t\t\t$curso_tut0 = mysqli_fetch_array ( $curso_tut );\n\t\t\t$unidad = $curso_tut0 [0];\n\t\t\t?>\n\t\t  <option><?php\n\t\t  if (strlen($unidad) > '1') {\n\t\t  \t\techo $unidad;\n\t\t  }\n\t\t\t?></option>\n\t\t<?php\n\t\t\techo \"<option></option>\";\n\t\t\t$tipo = \"select distinct unidad from alma order by unidad\";\n\t\t\t$tipo1 = mysqli_query($db_con, $tipo );\n\t\t\twhile ( $tipo2 = mysqli_fetch_array ( $tipo1 ) ) {\n\t\t\t\techo \"<option value=\\\"\" . $tipo2[0] . \"\\\">\" . $tipo2 [0] . \"</option>\";\n\t\t\t}\n\n\t\t\t?>\n\t\t  </select></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>4\"\n\t\t\t\t\tvalue=\"4\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '4' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>15\"\n\t\t\t\t\tvalue=\"9\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '9' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>5\"\n\t\t\t\t\tvalue=\"5\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '5' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>6\"\n\t\t\t\t\tvalue=\"6\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '6' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>7\"\n\t\t\t\t\tvalue=\"7\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '7' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>8\"\n\t\t\t\t\tvalue=\"8\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '8' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<?php if($config['mod_bilingue']) { ?>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>9\"\n\t\t\t\t\tvalue=\"a\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'a' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<?php } ?>\n\t\t\t<?php if ($config['mod_convivencia']==1) { ?>\n\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>10\"\n\t\t\t\t\tvalue=\"b\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'b' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<?php } ?>\n\n\t\t\t<?php if($config['mod_biblioteca']) { ?>\n\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>11\"\n\t\t\t\t\tvalue=\"c\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'c' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<?php } ?>\n\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>12\"\n\t\t\t\t\tvalue=\"d\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'd' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>13\"\n\t\t\t\t\tvalue=\"f\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'f' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\n\t\t\t<td class=\"text-center\">\n\t\t\t<input type=\"tel\" class=\"form-control input-sm\" name=\"<?php echo $dni; ?>14\" value=\"<?php echo $telefono; ?>\" style=\"width:100px\" min=\"9\" max=\"9\"/>\n\t\t\t</td>\n\n\t\t\t<td class=\"text-center\"><a href=\"cargos.php?borrar=1&dni_profe=<?php echo $dni;?>\" data-bb='confirm-delete'><span class=\"far fa-trash-alt fa-lg fa-fw\"></span></a></td>\n\t\t\t</tr>\n\t\t<?php\n\t\t\t}\n\t\t?>\n\t\t</tbody>\n\t\t</table>\n\n\t<button type=\"submit\" class=\"btn btn-primary\" name=\"enviar\">Guardar cambios</button>\n\t<a class=\"btn btn-default\" href=\"../xml/index.php\">Volver</a>\n</form>\n            </div></div></div>\n<?php include(\"../pie.php\");?>\n</body>\n</html>\n"], "fixing_code": ["<?php\nrequire('../bootstrap.php');\n\nacl_acceso($_SESSION['cargo'], array('0', '1'));\n\ninclude (\"../menu.php\");\n?>\n<div class='container-fluid'>\n\n\t<div class=\"page-header\">\n\t  <h2>Administraci\u00f3n <small> Perfiles de Profesores</small></h2>\n\t</div>\n\n\t<?php\n\tif ($_GET['borrar']=='1') {\n\t\t$dni_profe = preg_replace('([^A-Za-z0-9])', '', $_GET['dni_profe']);\n\t\tmysqli_query($db_con, \"delete from departamentos where dni = '\".$dni_profe.\"'\");\n\t\techo '<div class=\"alert alert-success\">\n\t            <button type=\"button\" class=\"close\" data-dismiss=\"alert\">&times;</button>\n\t            El profesor ha sido borrado de la base de datos..\n\t          </div>';\n\t}\n\tif (isset($_POST['enviar'])) {\n\n\tmysqli_query($db_con, \"update c_profes set telefono = ''\" );\n\tmysqli_query($db_con, \"truncate table FTUTORES\" );\n\tmysqli_query($db_con, \"truncate table cargos \" );\n\n\t\tforeach ( $_POST as $dni => $cargo_profe ) {\n\t\t\t// echo \"$dni => $cargo_profe<br>\";\n\t\t\tif ($cargo_profe == \"Enviar\") {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\telseif (is_numeric($cargo_profe) and strlen ( $cargo_profe ) == \"9\") {\n\t\t\t\t$dni = substr ( $dni, 1, -2 );\n\t\t\t\t$n_profe = mysqli_query($db_con, \"update c_profes set telefono = '$cargo_profe' where dni like '%$dni'\" );\n\t\t\t\t//echo \"update c_profes set telefono = '$cargo_profe' where dni like '%$dni'<br>\";\n\t\t\t}\n\t\t\telseif (strlen ( $cargo_profe ) > \"1\" and !(is_numeric($cargo_profe))) {\n\t\t\t\t$dni = substr ( $dni, 0, -2 );\n\t\t\t\t$n_profe = mysqli_query($db_con, \"select nombre from departamentos where dni='$dni'\" );\n\t\t\t\t$n_prof = mysqli_fetch_array ( $n_profe );\n\t\t\t\t$unidad = $cargo_profe;\n\t\t\t\t$n_tutor = mb_strtoupper ( $n_prof [0], 'UTF-8' );\n\n\t\t\t\tmysqli_query($db_con, \"insert INTO `FTUTORES` ( `unidad` , `tutor`, `observaciones1`, `observaciones2` ) VALUES ('$unidad', '$n_tutor', '', '')\" ) or die (mysqli_error($db_con));\n\n\t\t\t} elseif (strlen ( $cargo_profe ) < \"2\") {\n\t\t\t\t$dni=trim($dni);\n\t\t\t\tmysqli_query($db_con, \"update departamentos set cargo = ''\" );\n\t\t\t\t$dni = substr ($dni, 0, -1);\n\t\t\t\tmysqli_query($db_con, \"INSERT INTO `cargos` ( `dni` , `cargo` ) VALUES ('$dni', '$cargo_profe')\" );\n\t\t\t}\n\t\t}\n\n\t\t$n_cargo = mysqli_query($db_con, \"select dni from departamentos\" );\n\t\twhile ( $n_carg = mysqli_fetch_array ( $n_cargo ) ) {\n\t\t\t$num_cargos = \"\";\n\t\t\t$num_car = mysqli_query($db_con, \"select distinct cargo from cargos where dni = '$n_carg[0]'\" );\n\t\t\twhile ( $num_carg = mysqli_fetch_array ( $num_car ) ) {\n\t\t\t\t$num_cargos .= $num_carg [0];\n\t\t\t}\n\t\t\tmysqli_query($db_con, \"update departamentos set cargo='$num_cargos' where dni='$n_carg[0]'\" );\n\t\t}\n\techo '<div class=\"alert alert-success\">\n\tLos perfiles han sido asignados correctamente a los profesores.\n\t          </div>';\n\t}\n\t?>\n\n  <div class=\"row\">\n\n   <div class=\"col-sm-12\">\n\n   <style type=\"text/css\">\n   thead th {\n   \tfont-size: 0.8em;\n   }\n   </style>\n\n\t\t<?php\n\t\t$head = '<thead>\n\t\t\t<tr>\n\t\t\t<th>Profesor</th>';\n\t\t\tif ($_SESSION['ide'] == \"admin\") {\n\t\t\t$head .= '<th><span data-bs=\"tooltip\" title=\"Administradores de la Aplicaci\u00f3n\">Admin</span></th>';\n\t\t\t}\n\t\t\t$head .= '<th><span data-bs=\"tooltip\" title=\"Miembros del Equipo Directivo del Centro\">Direcci\u00f3n</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Tutores de Grupo de todos los niveles\">Tutor</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Jefes de los distintos Departamentos que el IES ha seleccionado.\">JD</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Miembros del Equipo T\u00e9cnico de Coordinaci\u00f3n Pedadg\u00f3gica\">ETCP</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Miembro del departamento de Actividades Complementarias y Extraescolares.\">DACE</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Miembros del personal de Administracci\u00f3n y Servicios: Conserjes.\">Conserje</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Miembros del personal de Administracci\u00f3n y Servicios: Administrativos\">Administ.</span></th>\n\t\t\t<th><span data-bs=\"tooltip\" title=\"Todos los profesores que pertenecen al Equipo de Orientaci\u00f3n, inclu\u00eddos ATAL, Apoyo, PCPI, etc.\">Orienta.</span></th>';\n\t\tif($config['mod_bilingue']) $head .= '<th><span data-bs=\"tooltip\" title=\"Profesores que participan en el Plan de Bilinguismo\">Biling\u00fce</span></th>';\n\n\t\tif ($config['mod_convivencia']==1) {\n\t\t$head .= '<th><span data-bs=\"tooltip\" title=\"Profesores encargados de atender a los alumnos en el Aula de Convivencia del Centro, si este cuenta con ella.\">Conv.</span></th>';\n\t\t}\n\t\tif($config['mod_biblioteca']) $head .= '<th><span data-bs=\"tooltip\" title=\"Profesores que participan en el Plan de Bibliotecas o se encargan de llevar la Biblioteca del Centro\">Biblio.</span></th>';\n\t\t$head .= '<th><span data-bs=\"tooltip\" title=\"Profesor encargado de las Relaciones de G\u00e9nero\">G\u00e9nero</span></th>\n\t\t\t\t  <th><span data-bs=\"tooltip\" title=\"Departamento de Formacci\u00f3n, Innovaci\u00f3n y Evaluaci\u00f3n\">DFEIE</span></th>\n\t\t\t\t  <th><span data-bs=\"tooltip\" title=\"Tel\u00e9fono m\u00f3vil del Profesor\">Tfno. M\u00f3vil</span></th>\n\t\t\t\t  <th>&nbsp;</th>\n\t\t\t</tr>\n\t\t\t</thead>';\n\t\t?>\n\n\t\t<form name=\"cargos\" action=\"cargos.php\" method=\"post\">\n\n\t\t<p class=\"help-block\">\n\t\t\tSi necesitas informaci\u00f3n sobre los distintos perfiles de los profesores, puedes conseguirla colocando el cursor del rat\u00f3n sobre los distintos tipos de perfiles.\n\t\t</p>\n\n\t\t<table class=\"table table-bordered table-striped table-condensed\">\n\t\t<?php echo $head;?>\n\t\t\t<tbody>\n\t\t<?php\n\t\t$carg0 = mysqli_query($db_con, \"select distinct departamentos.nombre, departamentos.cargo, departamentos.dni, departamentos.idea, c_profes.telefono from departamentos, c_profes where departamentos.idea=c_profes.idea order by departamentos.nombre\" );\n\t\t$num_profes = mysqli_num_rows ( $carg0 );\n\t\twhile ( $carg1 = mysqli_fetch_array ( $carg0 ) ) {\n\t\t\t$pro = $carg1 [0];\n\t\t\t$car = $carg1 [1];\n\t\t\t$dni = $carg1 [2];\n\t\t\t$idea = $carg1 [3];\n\t\t\t$telefono = $carg1 [4];\n\t\t\tif ($telefono=='0') {\n\t\t\t\t$telefono=\"\";\n\t\t\t}\n\t\t\t$n_i = $n_i + 10;\n\t\t\tif ($n_i % 100 == 0) {\n\t\t\t\techo $head;\n\t\t\t}\n\t\t\t?>\n\t\t<tr<?php echo ($idea == 'admin' && $_SESSION['ide'] != 'admin') ? ' style=\"display: none;\"' : ''; ?>>\n\t\t\t\t<td nowrap><small><?php\n\t\t\techo $pro;\n\t\t\t?></small>\n\t\t\t</td>\n\n\t\t\t<?php if ($_SESSION['ide'] == \"admin\"): ?>\n\t\t\t<td class=\"text-center\">\n\t\t\t\t<input type=\"checkbox\" name=\"<?php echo $dni; ?>0\" value=\"0\" <?php if (stristr ( $car, '0' ) == TRUE) { echo \"checked\"; } if ($idea == \"admin\") { echo \"checked disabled\"; } ?> />\n\t\t\t</td>\n\t\t\t<?php endif; ?>\n\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>1\"\n\t\t\t\t\tvalue=\"1\" <?php\n\t\t\tif (stristr ( $car, '1' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?>\n\t\t\t\t\t /></td>\n\t\t\t\t<td class=\"form-inline\" nowrap><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>2\"\n\t\t\t\t\tvalue=\"2\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '2' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /> <select class=\"form-control input-sm\" style=\"width: 100px;\"\n\t\t\t\t\tname=\"<?php\n\t\t\techo $dni;\n\t\t\t?>2t\">\n\t\t  <?php\n\t\t\t$curso_tut = mysqli_query($db_con, \"select unidad from FTUTORES, departamentos where tutor=nombre and dni='$dni'\" );\n\t\t\t$curso_tut0 = mysqli_fetch_array ( $curso_tut );\n\t\t\t$unidad = $curso_tut0 [0];\n\t\t\t?>\n\t\t  <option><?php\n\t\t  if (strlen($unidad) > '1') {\n\t\t  \t\techo $unidad;\n\t\t  }\n\t\t\t?></option>\n\t\t<?php\n\t\t\techo \"<option></option>\";\n\t\t\t$tipo = \"select distinct unidad from alma order by unidad\";\n\t\t\t$tipo1 = mysqli_query($db_con, $tipo );\n\t\t\twhile ( $tipo2 = mysqli_fetch_array ( $tipo1 ) ) {\n\t\t\t\techo \"<option value=\\\"\" . $tipo2[0] . \"\\\">\" . $tipo2 [0] . \"</option>\";\n\t\t\t}\n\n\t\t\t?>\n\t\t  </select></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>4\"\n\t\t\t\t\tvalue=\"4\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '4' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>15\"\n\t\t\t\t\tvalue=\"9\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '9' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>5\"\n\t\t\t\t\tvalue=\"5\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '5' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>6\"\n\t\t\t\t\tvalue=\"6\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '6' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>7\"\n\t\t\t\t\tvalue=\"7\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '7' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>8\"\n\t\t\t\t\tvalue=\"8\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, '8' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<?php if($config['mod_bilingue']) { ?>\n\t\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>9\"\n\t\t\t\t\tvalue=\"a\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'a' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<?php } ?>\n\t\t\t<?php if ($config['mod_convivencia']==1) { ?>\n\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>10\"\n\t\t\t\t\tvalue=\"b\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'b' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<?php } ?>\n\n\t\t\t<?php if($config['mod_biblioteca']) { ?>\n\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>11\"\n\t\t\t\t\tvalue=\"c\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'c' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<?php } ?>\n\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>12\"\n\t\t\t\t\tvalue=\"d\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'd' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\t\t\t<td class=\"text-center\"><input type=\"checkbox\" name=\"<?php\n\t\t\techo $dni;\n\t\t\t?>13\"\n\t\t\t\t\tvalue=\"f\"\n\t\t\t\t\t<?php\n\t\t\tif (stristr ( $car, 'f' ) == TRUE) {\n\t\t\t\techo \"checked\";\n\t\t\t}\n\t\t\t?> /></td>\n\n\t\t\t<td class=\"text-center\">\n\t\t\t<input type=\"tel\" class=\"form-control input-sm\" name=\"<?php echo $dni; ?>14\" value=\"<?php echo $telefono; ?>\" style=\"width:100px\" min=\"9\" max=\"9\"/>\n\t\t\t</td>\n\n\t\t\t<td class=\"text-center\"><a href=\"cargos.php?borrar=1&dni_profe=<?php echo $dni;?>\" data-bb='confirm-delete'><span class=\"far fa-trash-alt fa-lg fa-fw\"></span></a></td>\n\t\t\t</tr>\n\t\t<?php\n\t\t\t}\n\t\t?>\n\t\t</tbody>\n\t\t</table>\n\n\t<button type=\"submit\" class=\"btn btn-primary\" name=\"enviar\">Guardar cambios</button>\n\t<a class=\"btn btn-default\" href=\"../xml/index.php\">Volver</a>\n</form>\n            </div></div></div>\n<?php include(\"../pie.php\");?>\n</body>\n</html>\n"], "filenames": ["config/cargos.php"], "buggy_code_start_loc": [16], "buggy_code_end_loc": [17], "fixing_code_start_loc": [16], "fixing_code_end_loc": [18], "type": "CWE-89", "message": "A vulnerability was found in mpedraza2020 Intranet del Monterroso up to 4.50.0. It has been classified as critical. This affects an unknown part of the file config/cargos.php. The manipulation of the argument dni_profe leads to sql injection. Upgrading to version 4.51.0 is able to address this issue. The identifier of the patch is 678190bee1dfd64b54a2b0e88abfd009e78adce8. It is recommended to upgrade the affected component. The identifier VDB-252717 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2019-25159", "sourceIdentifier": "cna@vuldb.com", "published": "2024-02-04T06:15:07.383", "lastModified": "2024-02-29T01:25:42.107", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "A vulnerability was found in mpedraza2020 Intranet del Monterroso up to 4.50.0. It has been classified as critical. This affects an unknown part of the file config/cargos.php. The manipulation of the argument dni_profe leads to sql injection. Upgrading to version 4.51.0 is able to address this issue. The identifier of the patch is 678190bee1dfd64b54a2b0e88abfd009e78adce8. It is recommended to upgrade the affected component. The identifier VDB-252717 was assigned to this vulnerability."}, {"lang": "es", "value": "Se encontr\u00f3 una vulnerabilidad en mpedraza2020 Intranet del Monterroso hasta 4.50.0. Ha sido clasificada como cr\u00edtica. Esto afecta a una parte desconocida del archivo config/cargos.php. La manipulaci\u00f3n del argumento dni_profe conduce a la inyecci\u00f3n sql. La actualizaci\u00f3n a la versi\u00f3n 4.51.0 puede solucionar este problema. El identificador del parche es 678190bee1dfd64b54a2b0e88abfd009e78adce8. Se recomienda actualizar el componente afectado. A esta vulnerabilidad se le asign\u00f3 el identificador VDB-252717."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:mpedraza2020:intranet_del_monterroso:*:*:*:*:*:*:*:*", "versionEndExcluding": "4.51.0", "matchCriteriaId": "4270450C-0892-4C8D-8068-868370F59ED9"}]}]}], "references": [{"url": "https://github.com/mpedraza2020/IESMONTEROSOINTRANET/commit/678190bee1dfd64b54a2b0e88abfd009e78adce8", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/mpedraza2020/IESMONTEROSOINTRANET/releases/tag/v4.51.0", "source": "cna@vuldb.com", "tags": ["Release Notes"]}, {"url": "https://vuldb.com/?ctiid.252717", "source": "cna@vuldb.com", "tags": ["Permissions Required"]}, {"url": "https://vuldb.com/?id.252717", "source": "cna@vuldb.com", "tags": ["Permissions Required"]}]}, "github_commit_url": "https://github.com/mpedraza2020/IESMONTEROSOINTRANET/commit/678190bee1dfd64b54a2b0e88abfd009e78adce8"}}