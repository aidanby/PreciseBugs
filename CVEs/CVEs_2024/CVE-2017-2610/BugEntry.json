{"buggy_code": ["/*\n * The MIT License\n * \n * Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi,\n * Daniel Dyer, Yahoo! Inc., Alan Harder, InfraDNA, Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n//\n//\n// JavaScript for Jenkins\n//     See http://www.ibm.com/developerworks/web/library/wa-memleak/?ca=dgr-lnxw97JavascriptLeaks\n//     for memory leak patterns and how to prevent them.\n//\n\nif (window.isRunAsTest) {\n    // Disable postMessage when running in test mode (HtmlUnit).\n    window.postMessage = false;\n}\n\n// create a new object whose prototype is the given object\nfunction object(o) {\n    function F() {}\n    F.prototype = o;\n    return new F();\n}\n\n/**\n * A function that returns false if the page is known to be invisible.\n */\nvar isPageVisible = (function(){\n    // @see https://developer.mozilla.org/en/DOM/Using_the_Page_Visibility_API\n    // Set the name of the hidden property and the change event for visibility\n    var hidden, visibilityChange;\n    if (typeof document.hidden !== \"undefined\") {\n        hidden = \"hidden\";\n        visibilityChange = \"visibilitychange\";\n    } else if (typeof document.mozHidden !== \"undefined\") {\n        hidden = \"mozHidden\";\n        visibilityChange = \"mozvisibilitychange\";\n    } else if (typeof document.msHidden !== \"undefined\") {\n        hidden = \"msHidden\";\n        visibilityChange = \"msvisibilitychange\";\n    } else if (typeof document.webkitHidden !== \"undefined\") {\n        hidden = \"webkitHidden\";\n        visibilityChange = \"webkitvisibilitychange\";\n    }\n\n    // By default, visibility set to true\n    var pageIsVisible = true;\n\n    // If the page is hidden, prevent any polling\n    // if the page is shown, restore pollings\n    function onVisibilityChange() {\n        pageIsVisible = !document[hidden];\n    }\n\n    // Warn if the browser doesn't support addEventListener or the Page Visibility API\n    if (typeof document.addEventListener !== \"undefined\" && typeof hidden !== \"undefined\") {\n        // Init the value to the real state of the page\n        pageIsVisible = !document[hidden];\n\n        // Handle page visibility change\n        document.addEventListener(visibilityChange, onVisibilityChange, false);\n    }\n\n    return function() {\n        return pageIsVisible;\n    }\n})();\n\n// id generator\nvar iota = 0;\n\n// crumb information\nvar crumb = {\n    fieldName: null,\n    value: null,\n\n    init: function(crumbField, crumbValue) {\n        if (crumbField==\"\") return; // layout.jelly passes in \"\" whereas it means null.\n        this.fieldName = crumbField;\n        this.value = crumbValue;\n    },\n\n    /**\n     * Adds the crumb value into the given hash or array and returns it.\n     */\n    wrap: function(headers) {\n        if (this.fieldName!=null) {\n            if (headers instanceof Array)\n                // TODO prototype.js only seems to interpret object\n                headers.push(this.fieldName, this.value);\n            else\n                headers[this.fieldName]=this.value;\n        }\n        // TODO return value unused\n        return headers;\n    },\n\n    /**\n     * Puts a hidden input field to the form so that the form submission will have the crumb value\n     */\n    appendToForm : function(form) {\n        if(this.fieldName==null)    return; // noop\n        var div = document.createElement(\"div\");\n        div.innerHTML = \"<input type=hidden name='\"+this.fieldName+\"' value='\"+this.value+\"'>\";\n        form.appendChild(div);\n        if (form.enctype == \"multipart/form-data\") {\n            if (form.action.indexOf(\"?\") != -1) {\n                form.action = form.action+\"&\"+this.fieldName+\"=\"+this.value;\n            } else {\n                form.action = form.action+\"?\"+this.fieldName+\"=\"+this.value;\n            }\n        }\n    }\n}\n\n// Form check code\n//========================================================\nvar FormChecker = {\n    // pending requests\n    queue : [],\n\n    // conceptually boolean, but doing so create concurrency problem.\n    // that is, during unit tests, the AJAX.send works synchronously, so\n    // the onComplete happens before the send method returns. On a real environment,\n    // more likely it's the other way around. So setting a boolean flag to true or false\n    // won't work.\n    inProgress : 0,\n\n    /**\n     * Schedules a form field check. Executions are serialized to reduce the bandwidth impact.\n     *\n     * @param url\n     *      Remote doXYZ URL that performs the check. Query string should include the field value.\n     * @param method\n     *      HTTP method. GET or POST. I haven't confirmed specifics, but some browsers seem to cache GET requests.\n     * @param target\n     *      HTML element whose innerHTML will be overwritten when the check is completed.\n     */\n    delayedCheck : function(url, method, target) {\n        if(url==null || method==null || target==null)\n            return; // don't know whether we should throw an exception or ignore this. some broken plugins have illegal parameters\n        this.queue.push({url:url, method:method, target:target});\n        this.schedule();\n    },\n\n    sendRequest : function(url, params) {\n        if (params.method == \"post\") {\n            var idx = url.indexOf('?');\n            params.parameters = url.substring(idx + 1);\n            url = url.substring(0, idx);\n        }\n        new Ajax.Request(url, params);\n    },\n\n    schedule : function() {\n        if (this.inProgress>0)  return;\n        if (this.queue.length == 0) return;\n\n        var next = this.queue.shift();\n        this.sendRequest(next.url, {\n            method : next.method,\n            onComplete : function(x) {\n                applyErrorMessage(next.target, x);\n                FormChecker.inProgress--;\n                FormChecker.schedule();\n                layoutUpdateCallback.call();\n            }\n        });\n        this.inProgress++;\n    }\n}\n\n/**\n * Find the sibling (in the sense of the structured form submission) form item of the given name,\n * and returns that DOM node.\n *\n * @param {HTMLElement} e\n * @param {string} name\n *      Name of the control to find. Can include \"../../\" etc in the prefix.\n *      See @RelativePath.\n *\n *      We assume that the name is normalized and doesn't contain any redundant component.\n *      That is, \"..\" can only appear as prefix, and \"foo/../bar\" is not OK (because it can be reduced to \"bar\")\n */\nfunction findNearBy(e,name) {\n    while (name.startsWith(\"../\")) {\n        name = name.substring(3);\n        e = findFormParent(e,null,true);\n    }\n\n    // name=\"foo/bar/zot\"  -> prefixes=[\"bar\",\"foo\"] & name=\"zot\"\n    var prefixes = name.split(\"/\");\n    name = prefixes.pop();\n    prefixes = prefixes.reverse();\n\n    // does 'e' itself match the criteria?\n    // as some plugins use the field name as a parameter value, instead of 'value'\n    var p = findFormItem(e,name,function(e,filter) {\n        return filter(e) ? e : null;\n    });\n    if (p!=null && prefixes.length==0)    return p;\n\n    var owner = findFormParent(e,null,true);\n\n    function locate(iterator,e) {// keep finding elements until we find the good match\n        while (true) {\n            e = iterator(e,name);\n            if (e==null)    return null;\n\n            // make sure this candidate element 'e' is in the right point in the hierarchy\n            var p = e;\n            for (var i=0; i<prefixes.length; i++) {\n                p = findFormParent(p,null,true);\n                if (p.getAttribute(\"name\")!=prefixes[i])\n                    return null;\n            }\n            if (findFormParent(p,null,true)==owner)\n                return e;\n        }\n    }\n\n    return locate(findPreviousFormItem,e) || locate(findNextFormItem,e);\n}\n\nfunction controlValue(e) {\n    if (e==null)    return null;\n    // compute the form validation value to be sent to the server\n    var type = e.getAttribute(\"type\");\n    if(type!=null && type.toLowerCase()==\"checkbox\")\n        return e.checked;\n    return e.value;\n}\n\nfunction toValue(e) {\n    return encodeURIComponent(controlValue(e));\n}\n\n/**\n * Builds a query string in a fluent API pattern.\n * @param {HTMLElement} owner\n *      The 'this' control.\n */\nfunction qs(owner) {\n    return {\n        params : \"\",\n\n        append : function(s) {\n            if (this.params.length==0)  this.params+='?';\n            else                        this.params+='&';\n            this.params += s;\n            return this;\n        },\n\n        nearBy : function(name) {\n            var e = findNearBy(owner,name);\n            if (e==null)    return this;    // skip\n            return this.append(Path.tail(name)+'='+toValue(e));\n        },\n\n        addThis : function() {\n            return this.append(\"value=\"+toValue(owner));\n        },\n\n        toString : function() {\n            return this.params;\n        }\n    };\n}\n\n// find the nearest ancestor node that has the given tag name\nfunction findAncestor(e, tagName) {\n    do {\n        e = e.parentNode;\n    } while (e != null && e.tagName != tagName);\n    return e;\n}\n\nfunction findAncestorClass(e, cssClass) {\n    do {\n        e = e.parentNode;\n    } while (e != null && !Element.hasClassName(e,cssClass));\n    return e;\n}\n\nfunction findFollowingTR(input, className) {\n    // identify the parent TR\n    var tr = input;\n    while (tr.tagName != \"TR\")\n        tr = tr.parentNode;\n\n    // then next TR that matches the CSS\n    do {\n        tr = $(tr).next();\n    } while (tr != null && (tr.tagName != \"TR\" || !Element.hasClassName(tr,className)));\n\n    return tr;\n}\n\nfunction find(src,filter,traversalF) {\n    while(src!=null) {\n        src = traversalF(src);\n        if(src!=null && filter(src))\n            return src;\n    }\n    return null;\n}\n\n/**\n * Traverses a form in the reverse document order starting from the given element (but excluding it),\n * until the given filter matches, or run out of an element.\n */\nfunction findPrevious(src,filter) {\n    return find(src,filter,function (e) {\n        var p = e.previousSibling;\n        if(p==null) return e.parentNode;\n        while(p.lastChild!=null)\n            p = p.lastChild;\n        return p;\n    });\n}\n\nfunction findNext(src,filter) {\n    return find(src,filter,function (e) {\n        var n = e.nextSibling;\n        if(n==null) return e.parentNode;\n        while(n.firstChild!=null)\n            n = n.firstChild;\n        return n;\n    });\n}\n\nfunction findFormItem(src,name,directionF) {\n    var name2 = \"_.\"+name; // handles <textbox field=\"...\" /> notation silently\n    return directionF(src,function(e){ return (e.tagName==\"INPUT\" || e.tagName==\"TEXTAREA\" || e.tagName==\"SELECT\") && (e.name==name || e.name==name2); });\n}\n\n/**\n * Traverses a form in the reverse document order and finds an INPUT element that matches the given name.\n */\nfunction findPreviousFormItem(src,name) {\n    return findFormItem(src,name,findPrevious);\n}\n\nfunction findNextFormItem(src,name) {\n    return findFormItem(src,name,findNext);\n}\n\n/**\n * Parse HTML into DOM.\n */\nfunction parseHtml(html) {\n    var c = document.createElement(\"div\");\n    c.innerHTML = html;\n    return c.firstChild;\n}\n\n/**\n * Evaluates the script in global context.\n */\nfunction geval(script) {\n    // execScript chokes on \"\" but eval doesn't, so we need to reject it first.\n    if (script==null || script==\"\") return;\n    // see http://perfectionkills.com/global-eval-what-are-the-options/\n    // note that execScript cannot return value\n    (this.execScript || eval)(script);\n}\n\n/**\n * Emulate the firing of an event.\n *\n * @param {HTMLElement} element\n *      The element that will fire the event\n * @param {String} event\n *      like 'change', 'blur', etc.\n */\nfunction fireEvent(element,event){\n    if (document.createEvent) {\n        // dispatch for firefox + others\n        var evt = document.createEvent(\"HTMLEvents\");\n        evt.initEvent(event, true, true ); // event type,bubbling,cancelable\n        return !element.dispatchEvent(evt);\n    } else {\n        // dispatch for IE\n        var evt = document.createEventObject();\n        return element.fireEvent('on'+event,evt)\n    }\n}\n\n// shared tooltip object\nvar tooltip;\n\n\n\n// Behavior rules\n//========================================================\n// using tag names in CSS selector makes the processing faster\nfunction registerValidator(e) {\n    e.targetElement = findFollowingTR(e, \"validation-error-area\").firstChild.nextSibling;\n    e.targetUrl = function() {\n        var url = this.getAttribute(\"checkUrl\");\n        var depends = this.getAttribute(\"checkDependsOn\");\n\n        if (depends==null) {// legacy behaviour where checkUrl is a JavaScript\n            try {\n                return eval(url); // need access to 'this', so no 'geval'\n            } catch (e) {\n                if (window.console!=null)  console.warn(\"Legacy checkUrl '\" + url + \"' is not valid Javascript: \"+e);\n                if (window.YUI!=null)      YUI.log(\"Legacy checkUrl '\" + url + \"' is not valid Javascript: \"+e,\"warn\");\n                return url; // return plain url as fallback\n            }\n        } else {\n            var q = qs(this).addThis();\n            if (depends.length>0)\n                depends.split(\" \").each(function (n) {\n                    q.nearBy(n);\n                });\n            return url+ q.toString();\n        }\n    };\n    var method = e.getAttribute(\"checkMethod\") || \"get\";\n\n    var url = e.targetUrl();\n    try {\n      FormChecker.delayedCheck(url, method, e.targetElement);\n    } catch (x) {\n        // this happens if the checkUrl refers to a non-existing element.\n        // don't let this kill off the entire JavaScript\n        YAHOO.log(\"Failed to register validation method: \"+e.getAttribute(\"checkUrl\")+\" : \"+e);\n        return;\n    }\n\n    var checker = function() {\n        var target = this.targetElement;\n        FormChecker.sendRequest(this.targetUrl(), {\n            method : method,\n            onComplete : function(x) {\n                target.innerHTML = x.responseText;\n                Behaviour.applySubtree(target);\n            }\n        });\n    }\n    var oldOnchange = e.onchange;\n    if(typeof oldOnchange==\"function\") {\n        e.onchange = function() { checker.call(this); oldOnchange.call(this); }\n    } else\n        e.onchange = checker;\n\n    var v = e.getAttribute(\"checkDependsOn\");\n    if (v) {\n        v.split(\" \").each(function (name) {\n            var c = findNearBy(e,name);\n            if (c==null) {\n                if (window.console!=null)  console.warn(\"Unable to find nearby \"+name);\n                if (window.YUI!=null)      YUI.log(\"Unable to find a nearby control of the name \"+name,\"warn\")\n                return;\n            }\n            $(c).observe(\"change\",checker.bind(e));\n        });\n    }\n\n    e = null; // avoid memory leak\n}\n\nfunction registerRegexpValidator(e,regexp,message) {\n    e.targetElement = findFollowingTR(e, \"validation-error-area\").firstChild.nextSibling;\n    var checkMessage = e.getAttribute('checkMessage');\n    if (checkMessage) message = checkMessage;\n    var oldOnchange = e.onchange;\n    e.onchange = function() {\n        var set = oldOnchange != null ? oldOnchange.call(this) : false;\n        if (this.value.match(regexp)) {\n            if (!set) this.targetElement.innerHTML = \"\";\n        } else {\n            this.targetElement.innerHTML = \"<div class=error>\" + message + \"</div>\";\n            set = true;\n        }\n        return set;\n    }\n    e.onchange.call(e);\n    e = null; // avoid memory leak\n}\n\n/**\n * Wraps a <button> into YUI button.\n *\n * @param e\n *      button element\n * @param onclick\n *      onclick handler\n * @return\n *      YUI Button widget.\n */\nfunction makeButton(e,onclick) {\n    var h = e.onclick;\n    var clsName = e.className;\n    var n = e.name;\n    var btn = new YAHOO.widget.Button(e,{});\n    if(onclick!=null)\n        btn.addListener(\"click\",onclick);\n    if(h!=null)\n        btn.addListener(\"click\",h);\n    var be = btn.get(\"element\");\n    Element.addClassName(be,clsName);\n    if(n) // copy the name\n        be.setAttribute(\"name\",n);\n    return btn;\n}\n\n/*\n    If we are inside 'to-be-removed' class, some HTML altering behaviors interact badly, because\n    the behavior re-executes when the removed master copy gets reinserted later.\n */\nfunction isInsideRemovable(e) {\n    return Element.ancestors(e).find(function(f){return f.hasClassName(\"to-be-removed\");});\n}\n\n/**\n * Render the template captured by &lt;l:renderOnDemand> at the element 'e' and replace 'e' by the content.\n *\n * @param {HTMLElement} e\n *      The place holder element to be lazy-rendered.\n * @param {boolean} noBehaviour\n *      if specified, skip the application of behaviour rule.\n */\nfunction renderOnDemand(e,callback,noBehaviour) {\n    if (!e || !Element.hasClassName(e,\"render-on-demand\")) return;\n    var proxy = eval(e.getAttribute(\"proxy\"));\n    proxy.render(function (t) {\n        var contextTagName = e.parentNode.tagName;\n        var c;\n        if (contextTagName==\"TBODY\") {\n            c = document.createElement(\"DIV\");\n            c.innerHTML = \"<TABLE><TBODY>\"+t.responseText+\"</TBODY></TABLE>\";\n            c = c./*JENKINS-15494*/lastChild.firstChild;\n        } else {\n            c = document.createElement(contextTagName);\n            c.innerHTML = t.responseText;\n        }\n\n        var elements = [];\n        while (c.firstChild!=null) {\n            var n = c.firstChild;\n            e.parentNode.insertBefore(n,e);\n            if (n.nodeType==1 && !noBehaviour)\n                elements.push(n);\n        }\n        Element.remove(e);\n\n        evalInnerHtmlScripts(t.responseText,function() {\n            Behaviour.applySubtree(elements,true);\n            if (callback)   callback(t);\n        });\n    });\n}\n\n/**\n * Finds all the script tags \n */\nfunction evalInnerHtmlScripts(text,callback) {\n    var q = [];\n    var matchAll = new RegExp('<script([^>]*)>([\\\\S\\\\s]*?)<\\/script>', 'img');\n    var matchOne = new RegExp('<script([^>]*)>([\\\\S\\\\s]*?)<\\/script>', 'im');\n    var srcAttr  = new RegExp('src=[\\'\\\"]([^\\'\\\"]+)[\\'\\\"]','i');\n    (text.match(matchAll)||[]).map(function(s) {\n        var m = s.match(srcAttr);\n        if (m) {\n            q.push(function(cont) {\n                loadScript(m[1],cont);\n            });\n        } else {\n            q.push(function(cont) {\n                geval(s.match(matchOne)[2]);\n                cont();\n            });\n        }\n    });\n    q.push(callback);\n    sequencer(q);\n}\n\n/**\n * Take an array of (typically async) functions and run them in a sequence.\n * Each of the function in the array takes one 'continuation' parameter, and upon the completion\n * of the function it needs to invoke \"continuation()\" to signal the execution of the next function.\n */\nfunction sequencer(fs) {\n    var nullFunction = function() {}\n    function next() {\n        if (fs.length>0) {\n            (fs.shift()||nullFunction)(next);\n        }\n    }\n    return next();\n}\n\n/** @deprecated Use {@link Behaviour.specify} instead. */\nvar jenkinsRules = {\n// TODO convert as many as possible to Behaviour.specify calls; some seem to have an implicit order dependency, but what?\n    \"BODY\" : function() {\n        tooltip = new YAHOO.widget.Tooltip(\"tt\", {context:[], zindex:999});\n    },\n\n    \"TABLE.sortable\" : function(e) {// sortable table\n        e.sortable = new Sortable.Sortable(e);\n    },\n\n    \"TABLE.progress-bar\" : function(e) { // progressBar.jelly\n        e.onclick = function() {\n            var href = this.getAttribute(\"href\");\n            if(href!=null)      window.location = href;\n        }\n        e = null; // avoid memory leak\n    },\n\n    \"INPUT.expand-button\" : function(e) {\n        makeButton(e,function(e) {\n            var link = e.target;\n            while(!Element.hasClassName(link,\"advancedLink\"))\n                link = link.parentNode;\n            link.style.display = \"none\";\n            $(link).next().style.display=\"block\";\n            layoutUpdateCallback.call();\n        });\n        e = null; // avoid memory leak\n    },\n\n// scripting for having default value in the input field\n    \"INPUT.has-default-text\" : function(e) {\n        var defaultValue = e.value;\n        Element.addClassName(e, \"defaulted\");\n        e.onfocus = function() {\n            if (this.value == defaultValue) {\n                this.value = \"\";\n                Element.removeClassName(this, \"defaulted\");\n            }\n        }\n        e.onblur = function() {\n            if (this.value == \"\") {\n                this.value = defaultValue;\n                Element.addClassName(this, \"defaulted\");\n            }\n        }\n        e = null; // avoid memory leak\n    },\n\n// <label> that doesn't use ID, so that it can be copied in <repeatable>\n    \"LABEL.attach-previous\" : function(e) {\n        e.onclick = function() {\n            var e = $(this).previous();\n            while (e!=null) {\n                if (e.tagName==\"INPUT\") {\n                    e.click();\n                    break;\n                }\n                e = e.previous();\n            }\n        }\n        e = null;\n    },\n\n// form fields that are validated via AJAX call to the server\n// elements with this class should have two attributes 'checkUrl' that evaluates to the server URL.\n    \"INPUT.validated\" : registerValidator,\n    \"SELECT.validated\" : registerValidator,\n    \"TEXTAREA.validated\" : registerValidator,\n\n// validate required form values\n    \"INPUT.required\" : function(e) { registerRegexpValidator(e,/./,\"Field is required\"); },\n\n// validate form values to be an integer\n    \"INPUT.number\" : function(e) { registerRegexpValidator(e,/^(\\d+|)$/,\"Not an integer\"); },\n    \"INPUT.positive-number\" : function(e) {\n        registerRegexpValidator(e,/^(\\d*[1-9]\\d*|)$/,\"Not a positive integer\");\n    },\n\n    \"INPUT.auto-complete\": function(e) {// form field with auto-completion support \n        // insert the auto-completion container\n        var div = document.createElement(\"DIV\");\n        e.parentNode.insertBefore(div,$(e).next()||null);\n        e.style.position = \"relative\"; // or else by default it's absolutely positioned, making \"width:100%\" break\n\n        var ds = new YAHOO.util.XHRDataSource(e.getAttribute(\"autoCompleteUrl\"));\n        ds.responseType = YAHOO.util.XHRDataSource.TYPE_JSON;\n        ds.responseSchema = {\n            resultsList: \"suggestions\",\n            fields: [\"name\"]\n        };\n        \n        // Instantiate the AutoComplete\n        var ac = new YAHOO.widget.AutoComplete(e, div, ds);\n        ac.generateRequest = function(query) {\n            return \"?value=\" + query;\n        };\n        ac.prehighlightClassName = \"yui-ac-prehighlight\";\n        ac.animSpeed = 0;\n        ac.useShadow = true;\n        ac.autoSnapContainer = true;\n        ac.delimChar = e.getAttribute(\"autoCompleteDelimChar\");\n        ac.doBeforeExpandContainer = function(textbox,container) {// adjust the width every time we show it\n            container.style.width=textbox.clientWidth+\"px\";\n            var Dom = YAHOO.util.Dom;\n            Dom.setXY(container, [Dom.getX(textbox), Dom.getY(textbox) + textbox.offsetHeight] );\n            return true;\n        }\n    },\n\n    \"A.help-button\" : function(e) {\n        e.onclick = function() {\n            var tr = findFollowingTR(this, \"help-area\");\n            var div = $(tr).down().next().down();\n\n            if (div.style.display != \"block\") {\n                div.style.display = \"block\";\n                // make it visible\n                new Ajax.Request(this.getAttribute(\"helpURL\"), {\n                    method : 'get',\n                    onSuccess : function(x) {\n                        var from = x.getResponseHeader(\"X-Plugin-From\");\n                        div.innerHTML = x.responseText+(from?\"<div class='from-plugin'>\"+from+\"</div>\":\"\");\n                        layoutUpdateCallback.call();\n                    },\n                    onFailure : function(x) {\n                        div.innerHTML = \"<b>ERROR</b>: Failed to load help file: \" + x.statusText;\n                        layoutUpdateCallback.call();\n                    }\n                });\n            } else {\n                div.style.display = \"none\";\n                layoutUpdateCallback.call();\n            }\n\n            return false;\n        };\n        e.tabIndex = 9999; // make help link unnavigable from keyboard\n        e = null; // avoid memory leak\n    },\n\n    // Script Console : settings and shortcut key\n    \"TEXTAREA.script\" : function(e) {\n        (function() {\n            var cmdKeyDown = false;\n            var mode = e.getAttribute(\"script-mode\") || \"text/x-groovy\";\n            var readOnly = eval(e.getAttribute(\"script-readOnly\")) || false;\n            \n            var w = CodeMirror.fromTextArea(e,{\n              mode: mode,\n              lineNumbers: true,\n              matchBrackets: true,\n              readOnly: readOnly,\n              onKeyEvent: function(editor, event){\n                function isGeckoCommandKey() {\n                    return Prototype.Browser.Gecko && event.keyCode == 224\n                }\n                function isOperaCommandKey() {\n                    return Prototype.Browser.Opera && event.keyCode == 17\n                }\n                function isWebKitCommandKey() {\n                    return Prototype.Browser.WebKit && (event.keyCode == 91 || event.keyCode == 93)\n                }\n                function isCommandKey() {\n                    return isGeckoCommandKey() || isOperaCommandKey() || isWebKitCommandKey();\n                }\n                function isReturnKeyDown() {\n                    return event.type == 'keydown' && event.keyCode == Event.KEY_RETURN;\n                }\n                function getParentForm(element) {\n                    if (element == null) throw 'not found a parent form';\n                    if (element instanceof HTMLFormElement) return element;\n                    \n                    return getParentForm(element.parentNode);\n                }\n                function saveAndSubmit() {\n                    editor.save();\n                    getParentForm(e).submit();\n                    event.stop();\n                }\n                \n                // Mac (Command + Enter)\n                if (navigator.userAgent.indexOf('Mac') > -1) {\n                    if (event.type == 'keydown' && isCommandKey()) {\n                        cmdKeyDown = true;\n                    }\n                    if (event.type == 'keyup' && isCommandKey()) {\n                        cmdKeyDown = false;\n                    }\n                    if (cmdKeyDown && isReturnKeyDown()) {\n                        saveAndSubmit();\n                        return true;\n                    }\n                  \n                // Windows, Linux (Ctrl + Enter)\n                } else {\n                    if (event.ctrlKey && isReturnKeyDown()) {\n                        saveAndSubmit();\n                        return true;\n                    }\n                }\n              }\n            }).getWrapperElement();\n            w.setAttribute(\"style\",\"border:1px solid black; margin-top: 1em; margin-bottom: 1em\")\n        })();\n\t},\n\n// deferred client-side clickable map.\n// this is useful where the generation of <map> element is time consuming\n    \"IMG[lazymap]\" : function(e) {\n        new Ajax.Request(\n            e.getAttribute(\"lazymap\"),\n            {\n                method : 'get',\n                onSuccess : function(x) {\n                    var div = document.createElement(\"div\");\n                    document.body.appendChild(div);\n                    div.innerHTML = x.responseText;\n                    var id = \"map\" + (iota++);\n                    div.firstChild.setAttribute(\"name\", id);\n                    e.setAttribute(\"usemap\", \"#\" + id);\n                }\n            });\n    },\n\n    // resizable text area\n    \"TEXTAREA\" : function(textarea) {\n        if(Element.hasClassName(textarea,\"rich-editor\")) {\n            // rich HTML editor\n            try {\n                var editor = new YAHOO.widget.Editor(textarea, {\n                    dompath: true,\n                    animate: true,\n                    handleSubmit: true\n                });\n                // probably due to the timing issue, we need to let the editor know\n                // that DOM is ready\n                editor.DOMReady=true;\n                editor.fireQueue();\n                editor.render();\n                layoutUpdateCallback.call();\n            } catch(e) {\n                alert(e);\n            }\n            return;\n        }\n\n        // CodeMirror inserts a wrapper element next to the textarea.\n        // textarea.nextSibling may not be the handle.\n        var handles = findElementsBySelector(textarea.parentNode, \".textarea-handle\");\n        if(handles.length != 1) return;\n        var handle = handles[0];\n\n        var Event = YAHOO.util.Event;\n\n        function getCodemirrorScrollerOrTextarea(){\n            return textarea.codemirrorObject ? textarea.codemirrorObject.getScrollerElement() : textarea;\n        }\n        handle.onmousedown = function(ev) {\n            ev = Event.getEvent(ev);\n            var s = getCodemirrorScrollerOrTextarea();\n            var offset = s.offsetHeight-Event.getPageY(ev);\n            s.style.opacity = 0.5;\n            document.onmousemove = function(ev) {\n                ev = Event.getEvent(ev);\n                function max(a,b) { if(a<b) return b; else return a; }\n                s.style.height = max(32, offset + Event.getPageY(ev)) + 'px';\n                layoutUpdateCallback.call();\n                return false;\n            };\n            document.onmouseup = function() {\n                document.onmousemove = null;\n                document.onmouseup = null;\n                var s = getCodemirrorScrollerOrTextarea();\n                s.style.opacity = 1;\n            }\n        };\n        handle.ondblclick = function() {\n            var s = getCodemirrorScrollerOrTextarea();\n            s.style.height = \"1px\"; // To get actual height of the textbox, shrink it and show its scrollbar\n            s.style.height = s.scrollHeight + 'px';\n        }\n    },\n\n    // structured form submission\n    \"FORM\" : function(form) {\n        crumb.appendToForm(form);\n        if(Element.hasClassName(form, \"no-json\"))\n            return;\n        // add the hidden 'json' input field, which receives the form structure in JSON\n        var div = document.createElement(\"div\");\n        div.innerHTML = \"<input type=hidden name=json value=init>\";\n        form.appendChild(div);\n\n        var oldOnsubmit = form.onsubmit;\n        if (typeof oldOnsubmit == \"function\") {\n            form.onsubmit = function() { return buildFormTree(this) && oldOnsubmit.call(this); }\n        } else {\n            form.onsubmit = function() { return buildFormTree(this); };\n        }\n\n        form = null; // memory leak prevention\n    },\n\n    // hook up tooltip.\n    //   add nodismiss=\"\" if you'd like to display the tooltip forever as long as the mouse is on the element.\n    \"[tooltip]\" : function(e) {\n        applyTooltip(e,e.getAttribute(\"tooltip\"));\n    },\n\n    \"INPUT.submit-button\" : function(e) {\n        makeButton(e);\n    },\n\n    \"INPUT.yui-button\" : function(e) {\n        makeButton(e);\n    },\n\n    \"TR.optional-block-start\": function(e) { // see optionalBlock.jelly\n        // set start.ref to checkbox in preparation of row-set-end processing\n        var checkbox = e.down().down();\n        e.setAttribute(\"ref\", checkbox.id = \"cb\"+(iota++));\n    },\n\n    // see RowVisibilityGroupTest\n    \"TR.rowvg-start\" : function(e) {\n        // figure out the corresponding end marker\n        function findEnd(e) {\n            for( var depth=0; ; e=$(e).next()) {\n                if(Element.hasClassName(e,\"rowvg-start\"))    depth++;\n                if(Element.hasClassName(e,\"rowvg-end\"))      depth--;\n                if(depth==0)    return e;\n            }\n        }\n\n        e.rowVisibilityGroup = {\n            outerVisible: true,\n            innerVisible: true,\n            /**\n             * TR that marks the beginning of this visibility group.\n             */\n            start: e,\n            /**\n             * TR that marks the end of this visibility group.\n             */\n            end: findEnd(e),\n\n            /**\n             * Considers the visibility of the row group from the point of view of outside.\n             * If you think of a row group like a logical DOM node, this is akin to its .style.display.\n             */\n            makeOuterVisisble : function(b) {\n                this.outerVisible = b;\n                this.updateVisibility();\n            },\n\n            /**\n             * Considers the visibility of the rows in this row group. Since all the rows in a rowvg\n             * shares the single visibility, this just needs to be one boolean, as opposed to many.\n             *\n             * If you think of a row group like a logical DOM node, this is akin to its children's .style.display.\n             */\n            makeInnerVisisble : function(b) {\n                this.innerVisible = b;\n                this.updateVisibility();\n            },\n\n            /**\n             * Based on innerVisible and outerVisible, update the relevant rows' actual CSS display attribute.\n             */\n            updateVisibility : function() {\n                var display = (this.outerVisible && this.innerVisible) ? \"\" : \"none\";\n                for (var e=this.start; e!=this.end; e=$(e).next()) {\n                    if (e.rowVisibilityGroup && e!=this.start) {\n                        e.rowVisibilityGroup.makeOuterVisisble(this.innerVisible);\n                        e = e.rowVisibilityGroup.end; // the above call updates visibility up to e.rowVisibilityGroup.end inclusive\n                    } else {\n                        e.style.display = display;\n                    }\n                }\n                layoutUpdateCallback.call();\n            },\n\n            /**\n             * Enumerate each row and pass that to the given function.\n             *\n             * @param {boolean} recursive\n             *      If true, this visits all the rows from nested visibility groups.\n             */\n            eachRow : function(recursive,f) {\n                if (recursive) {\n                    for (var e=this.start; e!=this.end; e=$(e).next())\n                        f(e);\n                } else {\n                    throw \"not implemented yet\";\n                }\n            }\n        };\n    },\n\n    \"TR.row-set-end\": function(e) { // see rowSet.jelly and optionalBlock.jelly\n        // figure out the corresponding start block\n        e = $(e);\n        var end = e;\n\n        for( var depth=0; ; e=e.previous()) {\n            if(e.hasClassName(\"row-set-end\"))        depth++;\n            if(e.hasClassName(\"row-set-start\"))      depth--;\n            if(depth==0)    break;\n        }\n        var start = e;\n\n        // @ref on start refers to the ID of the element that controls the JSON object created from these rows\n        // if we don't find it, turn the start node into the governing node (thus the end result is that you\n        // created an intermediate JSON object that's always on.)\n        var ref = start.getAttribute(\"ref\");\n        if(ref==null)\n            start.id = ref = \"rowSetStart\"+(iota++);\n\n        applyNameRef(start,end,ref);\n    },\n\n    \"TR.optional-block-start \": function(e) { // see optionalBlock.jelly\n        // this is suffixed by a pointless string so that two processing for optional-block-start\n        // can sandwitch row-set-end\n        // this requires \"TR.row-set-end\" to mark rows\n        var checkbox = e.down().down();\n        updateOptionalBlock(checkbox,false);\n    },\n\n    // image that shows [+] or [-], with hover effect.\n    // oncollapsed and onexpanded will be called when the button is triggered.\n    \"IMG.fold-control\" : function(e) {\n        function changeTo(e,img) {\n            var src = e.src;\n            e.src = src.substring(0,src.lastIndexOf('/'))+\"/\"+e.getAttribute(\"state\")+img;\n        }\n        e.onmouseover = function() {\n            changeTo(this,\"-hover.png\");\n        };\n        e.onmouseout = function() {\n            changeTo(this,\".png\");\n        };\n        e.parentNode.onclick = function(event) {\n            var e = this.firstChild;\n            var s = e.getAttribute(\"state\");\n            if(s==\"plus\") {\n                e.setAttribute(\"state\",\"minus\");\n                if(e.onexpanded)    e.onexpanded();\n            } else {\n                e.setAttribute(\"state\",\"plus\");\n                if(e.oncollapsed)    e.oncollapsed();\n            }\n            changeTo(e,\"-hover.png\");\n            YAHOO.util.Event.stopEvent(event);\n            return false;\n        };\n        e = null; // memory leak prevention\n    },\n\n    // editableComboBox.jelly\n    \"INPUT.combobox\" : function(c) {\n        // Next element after <input class=\"combobox\"/> should be <div class=\"combobox-values\">\n        var vdiv = $(c).next();\n        if (vdiv.hasClassName(\"combobox-values\")) {\n            createComboBox(c, function() {\n                return vdiv.childElements().collect(function(value) {\n                    return value.getAttribute('value');\n                });\n            });\n        }\n    },\n\n    // dropdownList.jelly\n    \"SELECT.dropdownList\" : function(e) {\n        if(isInsideRemovable(e))    return;\n\n        var subForms = [];\n        var start = $(findFollowingTR(e, 'dropdownList-container')).down().next(), end;\n        do { start = start.firstChild; } while (start && start.tagName != 'TR');\n\n        if (start && !Element.hasClassName(start,'dropdownList-start'))\n            start = findFollowingTR(start, 'dropdownList-start');\n        while (start != null) {\n            subForms.push(start);\n            start = findFollowingTR(start, 'dropdownList-start');\n        }\n\n        // control visibility\n        function updateDropDownList() {\n            for (var i = 0; i < subForms.length; i++) {\n                var show = e.selectedIndex == i;\n                var f = $(subForms[i]);\n\n                if (show)   renderOnDemand(f.next());\n                f.rowVisibilityGroup.makeInnerVisisble(show);\n\n                // TODO: this is actually incorrect in the general case if nested vg uses field-disabled\n                // so far dropdownList doesn't create such a situation.\n                f.rowVisibilityGroup.eachRow(true, show?function(e) {\n                    e.removeAttribute(\"field-disabled\");\n                } : function(e) {\n                    e.setAttribute(\"field-disabled\",\"true\");\n                });\n            }\n        }\n\n        e.onchange = updateDropDownList;\n\n        updateDropDownList();\n    },\n\n    \"A.showDetails\" : function(e) {\n        e.onclick = function() {\n            this.style.display = 'none';\n            $(this).next().style.display = 'block';\n            layoutUpdateCallback.call();\n            return false;\n        };\n        e = null; // avoid memory leak\n    },\n\n    \"DIV.behavior-loading\" : function(e) {\n        e.style.display = 'none';\n    },\n\n    \".button-with-dropdown\" : function (e) {\n        new YAHOO.widget.Button(e, { type: \"menu\", menu: $(e).next() });\n    },\n\n    \".track-mouse\" : function (element) {\n        var DOM = YAHOO.util.Dom;\n\n        $(element).observe(\"mouseenter\",function () {\n            element.addClassName(\"mouseover\");\n\n            var mousemoveTracker = function (event) {\n                var elementRegion = DOM.getRegion(element);\n                if (event.x < elementRegion.left || event.x > elementRegion.right ||\n                    event.y < elementRegion.top || event.y > elementRegion.bottom) {\n                    element.removeClassName(\"mouseover\");\n                    Element.stopObserving(document, \"mousemove\", mousemoveTracker);\n                }\n            };\n            Element.observe(document, \"mousemove\", mousemoveTracker);\n        });\n    },\n\n    /*\n        Use on div tag to make it sticky visible on the bottom of the page.\n        When page scrolls it remains in the bottom of the page\n        Convenient on \"OK\" button and etc for a long form page\n     */\n    \"#bottom-sticker\" : function(sticker) {\n        var DOM = YAHOO.util.Dom;\n\n        var shadow = document.createElement(\"div\");\n        sticker.parentNode.insertBefore(shadow,sticker);\n\n        var edge = document.createElement(\"div\");\n        edge.className = \"bottom-sticker-edge\";\n        sticker.insertBefore(edge,sticker.firstChild);\n\n        function adjustSticker() {\n            shadow.style.height = sticker.offsetHeight + \"px\";\n\n            var viewport = DOM.getClientRegion();\n            var pos = DOM.getRegion(shadow);\n\n            sticker.style.position = \"fixed\";\n\n            var bottomPos = Math.max(0, viewport.bottom - pos.bottom);\n\n            sticker.style.bottom = bottomPos + \"px\"\n            sticker.style.left = Math.max(0,pos.left-viewport.left) + \"px\"\n        }\n\n        // react to layout change\n        Element.observe(window,\"scroll\",adjustSticker);\n        Element.observe(window,\"resize\",adjustSticker);\n        // initial positioning\n        Element.observe(window,\"load\",adjustSticker);\n        adjustSticker();\n        layoutUpdateCallback.add(adjustSticker);\n    },\n\n    \"#top-sticker\" : function(sticker) {// legacy\n        this[\".top-sticker\"](sticker);\n    },\n\n    /**\n     * @param {HTMLElement} sticker\n     */\n    \".top-sticker\" : function(sticker) {\n        var DOM = YAHOO.util.Dom;\n\n        var shadow = document.createElement(\"div\");\n        sticker.parentNode.insertBefore(shadow,sticker);\n\n        var edge = document.createElement(\"div\");\n        edge.className = \"top-sticker-edge\";\n        sticker.insertBefore(edge,sticker.firstChild);\n\n        var initialBreadcrumbPosition = DOM.getRegion(shadow);\n        function adjustSticker() {\n            shadow.style.height = sticker.offsetHeight + \"px\";\n\n            var viewport = DOM.getClientRegion();\n            var pos = DOM.getRegion(shadow);\n\n            sticker.style.position = \"fixed\";\n            if(pos.top <= initialBreadcrumbPosition.top) {\n                sticker.style.top = Math.max(0, pos.top-viewport.top) + \"px\"\n            }\n            sticker.style.left = Math.max(0,pos.left-viewport.left) + \"px\"\n        }\n\n        // react to layout change\n        Element.observe(window,\"scroll\",adjustSticker);\n        Element.observe(window,\"resize\",adjustSticker);\n        // initial positioning\n        Element.observe(window,\"load\",adjustSticker);\n        adjustSticker();\n    }\n};\n/** @deprecated Use {@link Behaviour.specify} instead. */\nvar hudsonRules = jenkinsRules; // legacy name\n(function() {\n    var p = 20;\n    for (var selector in jenkinsRules) {\n        Behaviour.specify(selector, 'hudson-behavior', p++, jenkinsRules[selector]);\n        delete jenkinsRules[selector];\n    }\n})();\n// now empty, but plugins can stuff things in here later:\nBehaviour.register(hudsonRules);\n\nfunction applyTooltip(e,text) {\n        // copied from YAHOO.widget.Tooltip.prototype.configContext to efficiently add a new element\n        // event registration via YAHOO.util.Event.addListener leaks memory, so do it by ourselves here\n        e.onmouseover = function(ev) {\n            var delay = this.getAttribute(\"nodismiss\")!=null ? 99999999 : 5000;\n            tooltip.cfg.setProperty(\"autodismissdelay\",delay);\n            return tooltip.onContextMouseOver.call(this,YAHOO.util.Event.getEvent(ev),tooltip);\n        }\n        e.onmousemove = function(ev) { return tooltip.onContextMouseMove.call(this,YAHOO.util.Event.getEvent(ev),tooltip); }\n        e.onmouseout  = function(ev) { return tooltip.onContextMouseOut .call(this,YAHOO.util.Event.getEvent(ev),tooltip); }\n        e.title = text;\n        e = null; // avoid memory leak\n}\n\nvar Path = {\n  tail : function(p) {\n      var idx = p.lastIndexOf(\"/\");\n      if (idx<0)    return p;\n      return p.substring(idx+1);\n  }\n};\n\n/**\n * Install change handlers based on the 'fillDependsOn' attribute.\n */\nfunction refillOnChange(e,onChange) {\n    var deps = [];\n\n    function h() {\n        var params = {};\n        deps.each(function (d) {\n            params[d.name] = controlValue(d.control);\n        });\n        onChange(params);\n    }\n    var v = e.getAttribute(\"fillDependsOn\");\n    if (v!=null) {\n        v.split(\" \").each(function (name) {\n            var c = findNearBy(e,name);\n            if (c==null) {\n                if (window.console!=null)  console.warn(\"Unable to find nearby \"+name);\n                if (window.YUI!=null)      YUI.log(\"Unable to find a nearby control of the name \"+name,\"warn\")\n                return;\n            }\n            $(c).observe(\"change\",h);\n            deps.push({name:Path.tail(name),control:c});\n        });\n    }\n    h();   // initial fill\n}\n\nfunction xor(a,b) {\n    // convert both values to boolean by '!' and then do a!=b\n    return !a != !b;\n}\n\n// used by editableDescription.jelly to replace the description field with a form\nfunction replaceDescription() {\n    var d = document.getElementById(\"description\");\n    $(d).down().next().innerHTML = \"<div class='spinner-right'>loading...</div>\";\n    new Ajax.Request(\n        \"./descriptionForm\",\n        {\n          onComplete : function(x) {\n            d.innerHTML = x.responseText;\n            evalInnerHtmlScripts(x.responseText,function() {\n                Behaviour.applySubtree(d);\n                d.getElementsByTagName(\"TEXTAREA\")[0].focus();\n            });\n            layoutUpdateCallback.call();\n          }\n        }\n    );\n    return false;\n}\n\n/**\n * Indicates that form fields from rows [s,e) should be grouped into a JSON object,\n * and attached under the element identified by the specified id.\n */\nfunction applyNameRef(s,e,id) {\n    $(id).groupingNode = true;\n    // s contains the node itself\n    for(var x=$(s).next(); x!=e; x=x.next()) {\n        // to handle nested <f:rowSet> correctly, don't overwrite the existing value\n        if(x.getAttribute(\"nameRef\")==null)\n            x.setAttribute(\"nameRef\",id);\n    }\n}\n\n\n// used by optionalBlock.jelly to update the form status\n//   @param c     checkbox element\nfunction updateOptionalBlock(c,scroll) {\n    // find the start TR\n    var s = $(c);\n    while(!s.hasClassName(\"optional-block-start\"))\n        s = s.up();\n\n    // find the beginning of the rowvg\n    var vg =s;\n    while (!vg.hasClassName(\"rowvg-start\"))\n        vg = vg.next();\n\n    var checked = xor(c.checked,Element.hasClassName(c,\"negative\"));\n\n    vg.rowVisibilityGroup.makeInnerVisisble(checked);\n\n    if(checked && scroll) {\n        var D = YAHOO.util.Dom;\n\n        var r = D.getRegion(s);\n        r = r.union(D.getRegion(vg.rowVisibilityGroup.end));\n        scrollIntoView(r);\n    }\n\n    if (c.name == 'hudson-tools-InstallSourceProperty') {\n        // Hack to hide tool home when \"Install automatically\" is checked.\n        var homeField = findPreviousFormItem(c, 'home');\n        if (homeField != null && homeField.value == '') {\n            var tr = findAncestor(homeField, 'TR');\n            if (tr != null) {\n                tr.style.display = c.checked ? 'none' : '';\n                layoutUpdateCallback.call();\n            }\n        }\n    }\n}\n\n\n//\n// Auto-scroll support for progressive log output.\n//   See http://radio.javaranch.com/pascarello/2006/08/17/1155837038219.html\n//\nfunction AutoScroller(scrollContainer) {\n    // get the height of the viewport.\n    // See http://www.howtocreate.co.uk/tutorials/javascript/browserwindow\n    function getViewportHeight() {\n        if (typeof( window.innerWidth ) == 'number') {\n            //Non-IE\n            return window.innerHeight;\n        } else if (document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight )) {\n            //IE 6+ in 'standards compliant mode'\n            return document.documentElement.clientHeight;\n        } else if (document.body && ( document.body.clientWidth || document.body.clientHeight )) {\n            //IE 4 compatible\n            return document.body.clientHeight;\n        }\n        return null;\n    }\n\n    return {\n        bottomThreshold : 25,\n        scrollContainer: scrollContainer,\n\n        getCurrentHeight : function() {\n            var scrollDiv = $(this.scrollContainer);\n\n            if (scrollDiv.scrollHeight > 0)\n                return scrollDiv.scrollHeight;\n            else\n                if (scrollDiv.offsetHeight > 0)\n                    return scrollDiv.offsetHeight;\n\n            return null; // huh?\n        },\n\n        // return true if we are in the \"stick to bottom\" mode\n        isSticking : function() {\n            var scrollDiv = $(this.scrollContainer);\n            var currentHeight = this.getCurrentHeight();\n\n            // when used with the BODY tag, the height needs to be the viewport height, instead of\n            // the element height.\n            //var height = ((scrollDiv.style.pixelHeight) ? scrollDiv.style.pixelHeight : scrollDiv.offsetHeight);\n            var height = getViewportHeight();\n            var scrollPos = Math.max(scrollDiv.scrollTop, document.documentElement.scrollTop);\n            var diff = currentHeight - scrollPos - height;\n            // window.alert(\"currentHeight=\" + currentHeight + \",scrollTop=\" + scrollDiv.scrollTop + \",height=\" + height);\n\n            return diff < this.bottomThreshold;\n        },\n\n        scrollToBottom : function() {\n            var scrollDiv = $(this.scrollContainer);\n            var currentHeight = this.getCurrentHeight();\n            if(document.documentElement) document.documentElement.scrollTop = currentHeight\n            scrollDiv.scrollTop = currentHeight;\n        }\n    };\n}\n\n// scroll the current window to display the given element or the region.\nfunction scrollIntoView(e) {\n    function calcDelta(ex1,ex2,vx1,vw) {\n        var vx2=vx1+vw;\n        var a;\n        a = Math.min(vx1-ex1,vx2-ex2);\n        if(a>0)     return -a;\n        a = Math.min(ex1-vx1,ex2-vx2);\n        if(a>0)     return a;\n        return 0;\n    }\n\n    var D = YAHOO.util.Dom;\n\n    var r;\n    if(e.tagName!=null) r = D.getRegion(e);\n    else                r = e;\n\n    var dx = calcDelta(r.left,r.right, document.body.scrollLeft, D.getViewportWidth());\n    var dy = calcDelta(r.top, r.bottom,document.body.scrollTop,  D.getViewportHeight());\n    window.scrollBy(dx,dy);\n}\n\n// used in expandableTextbox.jelly to change a input field into a text area\nfunction expandTextArea(button,id) {\n    button.style.display=\"none\";\n    var field = button.parentNode.previousSibling.children[0];\n    var value = field.value.replace(/ +/g,'\\n');\n    \n    var n = button; \n    while (n.tagName != \"TABLE\")\n    {\n        n = n.parentNode;\n    }\n\n    n.parentNode.innerHTML = \n        \"<textarea rows=8 class='setting-input' name='\"+field.name+\"'>\"+value+\"</textarea>\";\n    layoutUpdateCallback.call();\n}\n\n// refresh a part of the HTML specified by the given ID,\n// by using the contents fetched from the given URL.\nfunction refreshPart(id,url) {\n    var f = function() {\n        if(isPageVisible()) {\n            new Ajax.Request(url, {\n                onSuccess: function(rsp) {\n                    var hist = $(id);\n                    if (hist == null) {\n                        console.log(\"There's no element that has ID of \" + id);\n                        return;\n                    }\n                    var p = hist.up();\n\n                    var div = document.createElement('div');\n                    div.innerHTML = rsp.responseText;\n\n                    var node = $(div).firstDescendant();\n                    p.replaceChild(node, hist);\n\n                    Behaviour.applySubtree(node);\n                    layoutUpdateCallback.call();\n\n                    if(isRunAsTest) return;\n                    refreshPart(id,url);\n                }\n            });    \n        } else {\n            // Reschedule\n            if(isRunAsTest) return;\n            refreshPart(id,url);\n        }\n        \n    };\n    // if run as test, just do it once and do it now to make sure it's working,\n    // but don't repeat.\n    if(isRunAsTest) f();\n    else    window.setTimeout(f, 5000);\n}\n\n\n/*\n    Perform URL encode.\n    Taken from http://www.cresc.co.jp/tech/java/URLencoding/JavaScript_URLEncoding.htm\n    @deprecated Use standard javascript method \"encodeURIComponent\" instead\n*/\nfunction encode(str){\n    var s, u;\n    var s0 = \"\";                // encoded str\n\n    for (var i = 0; i < str.length; i++){   // scan the source\n        s = str.charAt(i);\n        u = str.charCodeAt(i);          // get unicode of the char\n\n        if (s == \" \"){s0 += \"+\";}       // SP should be converted to \"+\"\n        else {\n            if ( u == 0x2a || u == 0x2d || u == 0x2e || u == 0x5f || ((u >= 0x30) && (u <= 0x39)) || ((u >= 0x41) && (u <= 0x5a)) || ((u >= 0x61) && (u <= 0x7a))){     // check for escape\n                s0 = s0 + s;           // don't escape\n            } else {                      // escape\n                if ((u >= 0x0) && (u <= 0x7f)){     // single byte format\n                    s = \"0\"+u.toString(16);\n                    s0 += \"%\"+ s.substr(s.length-2);\n                } else\n                if (u > 0x1fffff){     // quaternary byte format (extended)\n                    s0 += \"%\" + (0xF0 + ((u & 0x1c0000) >> 18)).toString(16);\n                    s0 += \"%\" + (0x80 + ((u & 0x3f000) >> 12)).toString(16);\n                    s0 += \"%\" + (0x80 + ((u & 0xfc0) >> 6)).toString(16);\n                    s0 += \"%\" + (0x80 + (u & 0x3f)).toString(16);\n                } else\n                if (u > 0x7ff){        // triple byte format\n                    s0 += \"%\" + (0xe0 + ((u & 0xf000) >> 12)).toString(16);\n                    s0 += \"%\" + (0x80 + ((u & 0xfc0) >> 6)).toString(16);\n                    s0 += \"%\" + (0x80 + (u & 0x3f)).toString(16);\n                } else {                      // double byte format\n                    s0 += \"%\" + (0xc0 + ((u & 0x7c0) >> 6)).toString(16);\n                    s0 += \"%\" + (0x80 + (u & 0x3f)).toString(16);\n                }\n            }\n        }\n    }\n    return s0;\n}\n\n// when there are multiple form elements of the same name,\n// this method returns the input field of the given name that pairs up\n// with the specified 'base' input element.\nForm.findMatchingInput = function(base, name) {\n    // find the FORM element that owns us\n    var f = base;\n    while (f.tagName != \"FORM\")\n        f = f.parentNode;\n\n    var bases = Form.getInputs(f, null, base.name);\n    var targets = Form.getInputs(f, null, name);\n\n    for (var i=0; i<bases.length; i++) {\n        if (bases[i] == base)\n            return targets[i];\n    }\n\n    return null;        // not found\n}\n\nfunction onBuildHistoryChange(handler) {\n    Event.observe(window, 'jenkins:buildHistoryChanged', handler);\n}\nfunction fireBuildHistoryChanged() {\n    Event.fire(window, 'jenkins:buildHistoryChanged');\n}\n\nfunction updateBuildHistory(ajaxUrl,nBuild) {\n    if(isRunAsTest) return;\n    var bh = $('buildHistory');\n\n    bh.headers = [\"n\",nBuild];\n\n    function getDataTable(buildHistoryDiv) {\n        return $(buildHistoryDiv).getElementsBySelector('table.pane')[0];\n    }\n\n    var leftRightPadding = 4;\n    function checkRowCellOverflows(row) {\n        if (!row) {\n            return;\n        }\n\n        if (Element.hasClassName(row, \"overflow-checked\")) {\n            // already done.\n            return;\n        }\n\n        function markSingleline() {\n            Element.addClassName(row, \"single-line\");\n            Element.removeClassName(row, \"multi-line\");\n        }\n        function markMultiline() {\n            Element.removeClassName(row, \"single-line\");\n            Element.addClassName(row, \"multi-line\");\n        }\n        function indentMultiline(element) {\n            Element.addClassName(element, \"indent-multiline\");\n        }\n\n        function blockWrap(el1, el2) {\n            var div = document.createElement('div');\n\n            Element.addClassName(div, \"block\");\n            Element.addClassName(div, \"wrap\");\n            Element.addClassName(el1, \"wrapped\");\n            Element.addClassName(el2, \"wrapped\");\n\n            el1.parentNode.insertBefore(div, el1);\n            el1.parentNode.removeChild(el1);\n            el2.parentNode.removeChild(el2);\n            div.appendChild(el1);\n            div.appendChild(el2);\n\n            return div;\n        }\n        function blockUnwrap(element) {\n            var wrapped = $(element).getElementsBySelector('.wrapped');\n            for (var i = 0; i < wrapped.length; i++) {\n                var wrappedEl = wrapped[i];\n                wrappedEl.parentNode.removeChild(wrappedEl);\n                element.parentNode.insertBefore(wrappedEl, element);\n                Element.removeClassName(wrappedEl, \"wrapped\");\n            }\n            element.parentNode.removeChild(element);\n        }\n\n        var buildName = $(row).getElementsBySelector('.build-name')[0];\n        var buildDetails = $(row).getElementsBySelector('.build-details')[0];\n\n        if (!buildName || !buildDetails) {\n            return;\n        }\n\n        var displayName = $(buildName).getElementsBySelector('.display-name')[0];\n        var buildControls = $(row).getElementsBySelector('.build-controls')[0];\n        var desc;\n\n        var descElements = $(row).getElementsBySelector('.desc');\n        if (descElements.length > 0) {\n            desc = descElements[0];\n        }\n\n        function resetCellOverflows() {\n            markSingleline();\n\n            // undo block wraps\n            var blockWraps = $(row).getElementsBySelector('.block.wrap');\n            for (var i = 0; i < blockWraps.length; i++) {\n                blockUnwrap(blockWraps[i]);\n            }\n\n            removeZeroWidthSpaces(displayName);\n            removeZeroWidthSpaces(desc);\n            Element.removeClassName(buildName, \"block\");\n            buildName.removeAttribute('style');\n            Element.removeClassName(buildDetails, \"block\");\n            buildDetails.removeAttribute('style');\n            if (buildControls) {\n                Element.removeClassName(buildControls, \"block\");\n                buildDetails.removeAttribute('style');\n            }\n        }\n\n        // Undo everything from the previous poll.\n        resetCellOverflows();\n\n        // Insert zero-width spaces so as to allow text to wrap, allowing us to get the true clientWidth.\n        insertZeroWidthSpacesInElementText(displayName, 2);\n        if (desc) {\n            insertZeroWidthSpacesInElementText(desc, 30);\n            markMultiline();\n        }\n\n        var rowWidth = bh.clientWidth;\n        var usableRowWidth = rowWidth - (leftRightPadding * 2);\n        var nameOverflowParams = getElementOverflowParams(buildName);\n        var detailsOverflowParams = getElementOverflowParams(buildDetails);\n\n        var controlsOverflowParams;\n        if (buildControls) {\n            controlsOverflowParams = getElementOverflowParams(buildControls);\n        }\n\n        if (nameOverflowParams.isOverflowed) {\n            // If the name is overflowed, lets remove the zero-width spaces we added above and\n            // re-add zero-width spaces with a bigger max word sizes.\n            removeZeroWidthSpaces(displayName);\n            insertZeroWidthSpacesInElementText(displayName, 20);\n        }\n\n        function fitToControlsHeight(element) {\n            if (buildControls) {\n                if (element.clientHeight < buildControls.clientHeight) {\n                    $(element).setStyle({height: buildControls.clientHeight.toString() + 'px'});\n                }\n            }\n        }\n\n        function setBuildControlWidths() {\n            if (buildControls) {\n                var buildBadge = $(buildControls).getElementsBySelector('.build-badge')[0];\n\n                if (buildBadge) {\n                    var buildControlsWidth = buildControls.clientWidth;\n                    var buildBadgeWidth;\n\n                    var buildStop = $(buildControls).getElementsBySelector('.build-stop')[0];\n                    if (buildStop) {\n                        $(buildStop).setStyle({width: '24px'});\n                        // Minus 24 for the buildStop width,\n                        // minus 4 for left+right padding in the controls container\n                        buildBadgeWidth = (buildControlsWidth - 24 - leftRightPadding);\n                        if (Element.hasClassName(buildControls, \"indent-multiline\")) {\n                            buildBadgeWidth = buildBadgeWidth - 20;\n                        }\n                        $(buildBadge).setStyle({width: (buildBadgeWidth) + 'px'});\n                    } else {\n                        $(buildBadge).setStyle({width: '100%'});\n                    }\n                }\n                controlsOverflowParams = getElementOverflowParams(buildControls);\n            }\n        }\n        setBuildControlWidths();\n\n        var controlsRepositioned = false;\n\n        if (nameOverflowParams.isOverflowed || detailsOverflowParams.isOverflowed) {\n            // At least one of the cells (name or details) needs to move to a row of its own.\n\n            markMultiline();\n\n            if (buildControls) {\n\n                // We have build controls. Lets see can we find a combination that allows the build controls\n                // to sit beside either the build name or the build details.\n\n                var badgesOverflowing = false;\n                var nameLessThanHalf = true;\n                var detailsLessThanHalf = true;\n                var buildBadge = $(buildControls).getElementsBySelector('.build-badge')[0];\n                if (buildBadge) {\n                    var badgeOverflowParams = getElementOverflowParams(buildBadge);\n\n                    if (badgeOverflowParams.isOverflowed) {\n                        // The badges are also overflowing. In this case, we will only attempt to\n                        // put the controls on the same line as the name or details (see below)\n                        // if the name or details is using less than half the width of the build history\n                        // widget.\n                        badgesOverflowing = true;\n                        nameLessThanHalf = (nameOverflowParams.scrollWidth < usableRowWidth/2);\n                        detailsLessThanHalf = (detailsOverflowParams.scrollWidth < usableRowWidth/2);\n                    }\n                }\n                function expandLeftWithRight(leftCellOverFlowParams, rightCellOverflowParams) {\n                    // Float them left and right...\n                    $(leftCellOverFlowParams.element).setStyle({float: 'left'});\n                    $(rightCellOverflowParams.element).setStyle({float: 'right'});\n\n                    if (!leftCellOverFlowParams.isOverflowed && !rightCellOverflowParams.isOverflowed) {\n                        // If neither left nor right are overflowed, just leave as is and let them float left and right.\n                        return;\n                    }\n                    if (leftCellOverFlowParams.isOverflowed && !rightCellOverflowParams.isOverflowed) {\n                        $(leftCellOverFlowParams.element).setStyle({width: leftCellOverFlowParams.scrollWidth + 'px'});\n                        return;\n                    }\n                    if (!leftCellOverFlowParams.isOverflowed && rightCellOverflowParams.isOverflowed) {\n                        $(rightCellOverflowParams.element).setStyle({width: rightCellOverflowParams.scrollWidth + 'px'});\n                        return;\n                    }\n                }\n\n                if ((!badgesOverflowing || nameLessThanHalf) &&\n                    (nameOverflowParams.scrollWidth + controlsOverflowParams.scrollWidth <= usableRowWidth)) {\n                    // Build name and controls can go on one row (first row). Need to move build details down\n                    // to a row of its own (second row) by making it a block element, forcing it to wrap. If there\n                    // are controls, we move them up to position them after the build name by inserting before the\n                    // build details.\n                    Element.addClassName(buildDetails, \"block\");\n                    buildControls.parentNode.removeChild(buildControls);\n                    buildDetails.parentNode.insertBefore(buildControls, buildDetails);\n                    var wrap = blockWrap(buildName, buildControls);\n                    Element.addClassName(wrap, \"build-name-controls\");\n                    indentMultiline(buildDetails);\n                    nameOverflowParams = getElementOverflowParams(buildName); // recalculate\n                    expandLeftWithRight(nameOverflowParams, controlsOverflowParams);\n                    setBuildControlWidths();\n                    fitToControlsHeight(buildName);\n                } else if ((!badgesOverflowing || detailsLessThanHalf) &&\n                    (detailsOverflowParams.scrollWidth + controlsOverflowParams.scrollWidth <= usableRowWidth)) {\n                    // Build details and controls can go on one row. Need to make the\n                    // build name (first field) a block element, forcing the details and controls to wrap\n                    // onto the next row (creating a second row).\n                    Element.addClassName(buildName, \"block\");\n                    var wrap = blockWrap(buildDetails, buildControls);\n                    indentMultiline(wrap);\n                    Element.addClassName(wrap, \"build-details-controls\");\n                    $(displayName).setStyle({width: '100%'});\n                    detailsOverflowParams = getElementOverflowParams(buildDetails); // recalculate\n                    expandLeftWithRight(detailsOverflowParams, controlsOverflowParams);\n                    setBuildControlWidths();\n                    fitToControlsHeight(buildDetails);\n                } else {\n                    // No suitable combo fits on a row. All need to go on rows of their own.\n                    Element.addClassName(buildName, \"block\");\n                    Element.addClassName(buildDetails, \"block\");\n                    Element.addClassName(buildControls, \"block\");\n                    indentMultiline(buildDetails);\n                    indentMultiline(buildControls);\n                    nameOverflowParams = getElementOverflowParams(buildName); // recalculate\n                    detailsOverflowParams = getElementOverflowParams(buildDetails); // recalculate\n                    setBuildControlWidths();\n                }\n                controlsRepositioned = true;\n            } else {\n                Element.addClassName(buildName, \"block\");\n                Element.addClassName(buildDetails, \"block\");\n                indentMultiline(buildDetails);\n            }\n        }\n\n        if (buildControls && !controlsRepositioned) {\n            var buildBadge = $(buildControls).getElementsBySelector('.build-badge')[0];\n            if (buildBadge) {\n                var badgeOverflowParams = getElementOverflowParams(buildBadge);\n\n                if (badgeOverflowParams.isOverflowed) {\n                    markMultiline();\n                    indentMultiline(buildControls);\n                    Element.addClassName(buildControls, \"block\");\n                    controlsRepositioned = true;\n                    setBuildControlWidths();\n                }\n            }\n        }\n\n        if (!nameOverflowParams.isOverflowed && !detailsOverflowParams.isOverflowed && !controlsRepositioned) {\n            fitToControlsHeight(buildName);\n            fitToControlsHeight(buildDetails);\n        }\n\n        Element.addClassName(row, \"overflow-checked\");\n    }\n\n    function checkAllRowCellOverflows() {\n        if(isRunAsTest) {\n            return;\n        }\n\n        var bh = $('buildHistory');\n        var dataTable = getDataTable(bh);\n        var rows = dataTable.rows;\n\n        // Insert zero-width spaces in text that may cause overflow distortions.\n        var displayNames = $(bh).getElementsBySelector('.display-name');\n        for (var i = 0; i < displayNames.length; i++) {\n            insertZeroWidthSpacesInElementText(displayNames[i], 2);\n        }\n        var descriptions = $(bh).getElementsBySelector('.desc');\n        for (var i = 0; i < descriptions.length; i++) {\n            insertZeroWidthSpacesInElementText(descriptions[i], 30);\n        }\n\n        for (var i = 0; i < rows.length; i++) {\n            var row = rows[i];\n            checkRowCellOverflows(row);\n        }\n    }\n\n    var updateBuildsRefreshInterval = 5000;\n    function updateBuilds() {\n        if(isPageVisible()){\n            if (bh.headers == null) {\n                // Yahoo.log(\"Missing headers in buildHistory element\");\n            }\n\n            new Ajax.Request(ajaxUrl, {\n                requestHeaders: bh.headers,\n                onSuccess: function(rsp) {\n                    var dataTable = getDataTable(bh);\n                    var rows = dataTable.rows;\n\n                    //delete rows with transitive data\n                    while (rows.length > 0 && Element.hasClassName(rows[0], \"transitive\")) {\n                        Element.remove(rows[0]);\n                    }\n\n                    // insert new rows\n                    var div = document.createElement('div');\n                    div.innerHTML = rsp.responseText;\n                    Behaviour.applySubtree(div);\n\n                    var pivot = rows[0];\n                    var newRows = getDataTable(div).rows;\n                    while (newRows.length > 0) {\n                        if (pivot !== undefined) {\n                            // The data table has rows.  Insert before a \"pivot\" row (first row).\n                            pivot.parentNode.insertBefore(newRows[0], pivot);\n                        } else {\n                            // The data table has no rows.  In this case, we just add all new rows directly to the\n                            // table, one after the other i.e. we don't insert before a \"pivot\" row (first row).\n                            dataTable.appendChild(newRows[0]);\n                        }\n                    }\n\n                    // next update\n                    bh.headers = [\"n\",rsp.getResponseHeader(\"n\")];\n                    window.setTimeout(updateBuilds, updateBuildsRefreshInterval);\n\n                    checkAllRowCellOverflows();\n                }\n            });\n        } else {\n            // Reschedule again\n            window.setTimeout(updateBuilds, updateBuildsRefreshInterval);\n        }\n    }\n\n    checkAllRowCellOverflows();\n    window.setTimeout(updateBuilds, updateBuildsRefreshInterval);\n\n    onBuildHistoryChange(function() {\n        checkAllRowCellOverflows();\n    });\n}\n\nfunction getElementOverflowParams(element) {\n    // First we force it to wrap so we can get those dimension.\n    // Then we force it to \"nowrap\", so we can get those dimension.\n    // We can then compare the two sets, which will indicate if\n    // wrapping is potentially happening, or not.\n\n    // Force it to wrap.\n    Element.addClassName(element, \"force-wrap\");\n    var wrappedClientWidth = element.clientWidth;\n    var wrappedClientHeight = element.clientHeight;\n    Element.removeClassName(element, \"force-wrap\");\n\n    // Force it to nowrap. Return the comparisons.\n    Element.addClassName(element, \"force-nowrap\");\n    var nowrapClientHeight = element.clientHeight;\n    try {\n        var overflowParams = {\n            element: element,\n            clientWidth: wrappedClientWidth,\n            scrollWidth: element.scrollWidth,\n            isOverflowed: wrappedClientHeight > nowrapClientHeight\n        };\n        return  overflowParams;\n    } finally {\n        Element.removeClassName(element, \"force-nowrap\");\n    }\n}\n\nvar zeroWidthSpace = String.fromCharCode(8203);\nvar ELEMENT_NODE = 1;\nvar TEXT_NODE = 3;\nfunction insertZeroWidthSpacesInText(textNode, maxWordSize) {\n    if (textNode.textContent.length < maxWordSize) {\n        return;\n    }\n\n    // capture the original text\n    textNode.preZWSText = textNode.textContent;\n\n    var words = textNode.textContent.split(/\\s+/);\n    var newTextContent = '';\n\n    var splitRegex = new RegExp('.{1,' + maxWordSize + '}', 'g');\n    for (var i = 0; i < words.length; i++) {\n        var word = words[i];\n        var wordTokens = word.match(splitRegex);\n        if (wordTokens) {\n            for (var ii = 0; ii < wordTokens.length; ii++) {\n                if (newTextContent.length === 0) {\n                    newTextContent += wordTokens[ii];\n                } else {\n                    newTextContent += zeroWidthSpace + wordTokens[ii];\n                }\n            }\n        } else {\n            newTextContent += word;\n        }\n        newTextContent += ' ';\n    }\n\n    textNode.textContent = newTextContent;\n}\nfunction insertZeroWidthSpacesInElementText(element, maxWordSize) {\n    if (Element.hasClassName(element, 'zws-inserted')) {\n        // already done.\n        return;\n    }\n    if (!element.hasChildNodes()) {\n        return;\n    }\n\n    var children = element.childNodes;\n    for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n        if (child.nodeType === TEXT_NODE) {\n            insertZeroWidthSpacesInText(child, maxWordSize);\n        } else if (child.nodeType === ELEMENT_NODE) {\n            insertZeroWidthSpacesInElementText(child, maxWordSize);\n        }\n    }\n\n    Element.addClassName(element, 'zws-inserted');\n}\nfunction removeZeroWidthSpaces(element) {\n    if (element) {\n        if (!Element.hasClassName(element, 'zws-inserted')) {\n            // Doesn't have ZWSed text.\n            return;\n        }\n        if (!element.hasChildNodes()) {\n            return;\n        }\n\n        var children = element.childNodes;\n        for (var i = 0; i < children.length; i++) {\n            var child = children[i];\n            if (child.nodeType === TEXT_NODE && child.preZWSText) {\n                child.textContent = child.preZWSText;\n            } else if (child.nodeType === ELEMENT_NODE) {\n                removeZeroWidthSpaces(child);\n            }\n        }\n\n        Element.removeClassName(element, 'zws-inserted');\n    }\n}\n\n// get the cascaded computed style value. 'a' is the style name like 'backgroundColor'\nfunction getStyle(e,a){\n  if(document.defaultView && document.defaultView.getComputedStyle)\n    return document.defaultView.getComputedStyle(e,null).getPropertyValue(a.replace(/([A-Z])/g, \"-$1\"));\n  if(e.currentStyle)\n    return e.currentStyle[a];\n  return null;\n}\n\nfunction ElementResizeTracker() {\n    this.trackedElements = [];\n\n    if(isRunAsTest) {\n        return;\n    }\n\n    var thisTracker = this;\n    function checkForResize() {\n        for (var i = 0; i < thisTracker.trackedElements.length; i++) {\n            var element = thisTracker.trackedElements[i];\n            var currDims = Element.getDimensions(element);\n            var lastDims = element.lastDimensions;\n            if (currDims.width !== lastDims.width || currDims.height !== lastDims.height) {\n                Event.fire(element, 'jenkins:resize');\n            }\n            element.lastDimensions = currDims;\n        }\n    }\n    Event.observe(window, 'jenkins:resizeCheck', checkForResize);\n\n    function checkForResizeLoop() {\n        checkForResize();\n        setTimeout(checkForResizeLoop, 200);\n    }\n    checkForResizeLoop();\n}\nElementResizeTracker.prototype.addElement = function(element) {\n    for (var i = 0; i < this.trackedElements.length; i++) {\n        if (this.trackedElements[i] === element) {\n            // we're already tracking it so no need to add it.\n            return;\n        }\n    }\n    this.trackedElements.push(element);\n}\nElementResizeTracker.prototype.onResize = function(element, handler) {\n    element.lastDimensions = Element.getDimensions(element);\n    Event.observe(element, 'jenkins:resize', handler);\n    this.addElement(element);\n}\nElementResizeTracker.fireResizeCheck = function() {\n    Event.fire(window, 'jenkins:resizeCheck');\n}\nvar elementResizeTracker = new ElementResizeTracker();\n\n/**\n * Makes sure the given element is within the viewport.\n *\n * @param {HTMLElement} e\n *      The element to bring into the viewport.\n */\nfunction ensureVisible(e) {\n    var viewport = YAHOO.util.Dom.getClientRegion();\n    var pos      = YAHOO.util.Dom.getRegion(e);\n\n    var Y = viewport.top;\n    var H = viewport.height;\n\n    function handleStickers(name,f) {\n        var e = $(name);\n        if (e) f(e);\n        document.getElementsBySelector(\".\"+name).each(f);\n    }\n\n    // if there are any stickers around, subtract them from the viewport\n    handleStickers(\"top-sticker\",function (t) {\n        t = t.clientHeight;\n        Y+=t; H-=t;\n    });\n\n    handleStickers(\"bottom-sticker\",function (b) {\n        b = b.clientHeight;\n        H-=b;\n    });\n\n    var y = pos.top;\n    var h = pos.height;\n\n    var d = (y+h)-(Y+H);\n    if (d>0) {\n        document.body.scrollTop += d;\n    } else {\n        var d = Y-y;\n        if (d>0)    document.body.scrollTop -= d;\n    }\n}\n\n// set up logic behind the search box\nfunction createSearchBox(searchURL) {\n    var ds = new YAHOO.util.XHRDataSource(searchURL+\"suggest\");\n    ds.responseType = YAHOO.util.XHRDataSource.TYPE_JSON;\n    ds.responseSchema = {\n        resultsList: \"suggestions\",\n        fields: [\"name\"]\n    };\n    var ac = new YAHOO.widget.AutoComplete(\"search-box\",\"search-box-completion\",ds);\n    ac.typeAhead = false;\n    ac.autoHighlight = false;\n\n    var box   = $(\"search-box\");\n    var sizer = $(\"search-box-sizer\");\n    var comp  = $(\"search-box-completion\");\n    var minW  = $(\"search-box-minWidth\");\n\n    Behaviour.addLoadEvent(function(){\n        // make sure all three components have the same font settings\n        function copyFontStyle(s,d) {\n            var ds = d.style;\n            ds.fontFamily = getStyle(s,\"fontFamily\");\n            ds.fontSize = getStyle(s,\"fontSize\");\n            ds.fontStyle = getStyle(s,\"fontStyle\");\n            ds.fontWeight = getStyle(s,\"fontWeight\");\n        }\n\n        copyFontStyle(box,sizer);\n        copyFontStyle(box,minW);\n    });\n\n    // update positions and sizes of the components relevant to search\n    function updatePos() {\n        function max(a,b) { if(a>b) return a; else return b; }\n\n        sizer.innerHTML = box.value.escapeHTML();\n        var w = max(sizer.offsetWidth,minW.offsetWidth);\n        box.style.width =\n        comp.style.width = \n        comp.firstChild.style.width = (w+60)+\"px\";\n\n        var pos = YAHOO.util.Dom.getXY(box);\n        pos[1] += YAHOO.util.Dom.get(box).offsetHeight + 2;\n        YAHOO.util.Dom.setXY(comp, pos);\n    }\n\n    updatePos();\n    box.onkeyup = updatePos;\n}\n\n\n/**\n * Finds the DOM node of the given DOM node that acts as a parent in the form submission.\n *\n * @param {HTMLElement} e\n *      The node whose parent we are looking for.\n * @param {HTMLFormElement} form\n *      The form element that owns 'e'. Passed in as a performance improvement. Can be null.\n * @return null\n *      if the given element shouldn't be a part of the final submission.\n */\nfunction findFormParent(e,form,isStatic) {\n    isStatic = isStatic || false;\n\n    if (form==null) // caller can pass in null to have this method compute the owning form\n        form = findAncestor(e,\"FORM\");\n\n    while(e!=form) {\n        // this is used to create a group where no single containing parent node exists,\n        // like <optionalBlock>\n        var nameRef = e.getAttribute(\"nameRef\");\n        if(nameRef!=null)\n            e = $(nameRef);\n        else\n            e = e.parentNode;\n\n        if(!isStatic && e.getAttribute(\"field-disabled\")!=null)\n            return null;  // this field shouldn't contribute to the final result\n\n        var name = e.getAttribute(\"name\");\n        if(name!=null && name.length>0) {\n            if(e.tagName==\"INPUT\" && !isStatic && !xor(e.checked,Element.hasClassName(e,\"negative\")))\n                return null;  // field is not active\n\n            return e;\n        }\n    }\n\n    return form;\n}\n\n// compute the form field name from the control name\nfunction shortenName(name) {\n    // [abc.def.ghi] -> abc.def.ghi\n    if(name.startsWith('['))\n        return name.substring(1,name.length-1);\n\n    // abc.def.ghi -> ghi\n    var idx = name.lastIndexOf('.');\n    if(idx>=0)  name = name.substring(idx+1);\n    return name;\n}\n\n\n\n//\n// structured form submission handling\n//   see http://wiki.jenkins-ci.org/display/JENKINS/Structured+Form+Submission\nfunction buildFormTree(form) {\n    try {\n        // I initially tried to use an associative array with DOM elements as keys\n        // but that doesn't seem to work neither on IE nor Firefox.\n        // so I switch back to adding a dynamic property on DOM.\n        form.formDom = {}; // root object\n\n        var doms = []; // DOMs that we added 'formDom' for.\n        doms.push(form);\n\n        function addProperty(parent,name,value) {\n            name = shortenName(name);\n            if(parent[name]!=null) {\n                if(parent[name].push==null) // is this array?\n                    parent[name] = [ parent[name] ];\n                parent[name].push(value);\n            } else {\n                parent[name] = value;\n            }\n        }\n\n        // find the grouping parent node, which will have @name.\n        // then return the corresponding object in the map\n        function findParent(e) {\n            var p = findFormParent(e,form);\n            if (p==null)    return {};\n\n            var m = p.formDom;\n            if(m==null) {\n                // this is a new grouping node\n                doms.push(p);\n                p.formDom = m = {};\n                addProperty(findParent(p), p.getAttribute(\"name\"), m);\n            }\n            return m;\n        }\n\n        var jsonElement = null;\n\n        for( var i=0; i<form.elements.length; i++ ) {\n            var e = form.elements[i];\n            if(e.name==\"json\") {\n                jsonElement = e;\n                continue;\n            }\n            if(e.tagName==\"FIELDSET\")\n                continue;\n            if(e.tagName==\"SELECT\" && e.multiple) {\n                var values = [];\n                for( var o=0; o<e.options.length; o++ ) {\n                    var opt = e.options.item(o);\n                    if(opt.selected)\n                        values.push(opt.value);\n                }\n                addProperty(findParent(e),e.name,values);\n                continue;\n            }\n                \n            var p;\n            var r;\n            var type = e.getAttribute(\"type\");\n            if(type==null)  type=\"\";\n            switch(type.toLowerCase()) {\n            case \"button\":\n            case \"submit\":\n                break;\n            case \"checkbox\":\n                p = findParent(e);\n                var checked = xor(e.checked,Element.hasClassName(e,\"negative\"));\n                if(!e.groupingNode) {\n                    v = e.getAttribute(\"json\");\n                    if (v) {\n                        // if the special attribute is present, we'll either set the value or not. useful for an array of checkboxes\n                        // we can't use @value because IE6 sets the value to be \"on\" if it's left unspecified.\n                        if (checked)\n                            addProperty(p, e.name, v);\n                    } else {// otherwise it'll bind to boolean\n                        addProperty(p, e.name, checked);\n                    }\n                } else {\n                    if(checked)\n                        addProperty(p, e.name, e.formDom = {});\n                }\n                break;\n            case \"file\":\n                // to support structured form submission with file uploads,\n                // rename form field names to unique ones, and leave this name mapping information\n                // in JSON. this behavior is backward incompatible, so only do\n                // this when\n                p = findParent(e);\n                if(e.getAttribute(\"jsonAware\")!=null) {\n                    var on = e.getAttribute(\"originalName\");\n                    if(on!=null) {\n                        addProperty(p,on,e.name);\n                    } else {\n                        var uniqName = \"file\"+(iota++);\n                        addProperty(p,e.name,uniqName);\n                        e.setAttribute(\"originalName\",e.name);\n                        e.name = uniqName;\n                    }\n                }\n                // switch to multipart/form-data to support file submission\n                // @enctype is the standard, but IE needs @encoding.\n                form.enctype = form.encoding = \"multipart/form-data\";\n                crumb.appendToForm(form);\n                break;\n            case \"radio\":\n                if(!e.checked)  break;\n                r=0;\n                while (e.name.substring(r,r+8)=='removeme')\n                    r = e.name.indexOf('_',r+8)+1;\n                p = findParent(e);\n                if(e.groupingNode) {\n                    addProperty(p, e.name.substring(r), e.formDom = { value: e.value });\n                } else {\n                    addProperty(p, e.name.substring(r), e.value);\n                }\n                break;\n\n            default:\n                p = findParent(e);\n                addProperty(p, e.name, e.value);\n                break;\n            }\n        }\n\n        jsonElement.value = Object.toJSON(form.formDom);\n\n        // clean up\n        for( i=0; i<doms.length; i++ )\n            doms[i].formDom = null;\n\n        return true;\n    } catch(e) {\n        alert(e+'\\n(form not submitted)');\n        return false;\n    }\n}\n\n/**\n * @param {boolean} toggle\n *      When true, will check all checkboxes in the page. When false, unchecks them all.\n */\nvar toggleCheckboxes = function(toggle) {\n    var inputs = document.getElementsByTagName(\"input\");\n    for(var i=0; i<inputs.length; i++) {\n        if(inputs[i].type === \"checkbox\") {\n            inputs[i].checked = toggle;\n        }\n    }\n};\n\n// this used to be in prototype.js but it must have been removed somewhere between 1.4.0 to 1.5.1\nString.prototype.trim = function() {\n    var temp = this;\n    var obj = /^(\\s*)([\\W\\w]*)(\\b\\s*$)/;\n    if (obj.test(temp))\n        temp = temp.replace(obj, '$2');\n    obj = /  /g;\n    while (temp.match(obj))\n        temp = temp.replace(obj, \" \");\n    return temp;\n}\n\n\n\nvar hoverNotification = (function() {\n    var msgBox;\n    var body;\n\n    // animation effect that automatically hide the message box\n    var effect = function(overlay, dur) {\n        var o = YAHOO.widget.ContainerEffect.FADE(overlay, dur);\n        o.animateInCompleteEvent.subscribe(function() {\n            window.setTimeout(function() {\n                msgBox.hide()\n            }, 1500);\n        });\n        return o;\n    }\n\n    function init() {\n        if(msgBox!=null)  return;   // already initialized\n\n        var div = document.createElement(\"DIV\");\n        document.body.appendChild(div);\n        div.innerHTML = \"<div id=hoverNotification><div class=bd></div></div>\";\n        body = $('hoverNotification');\n        \n        msgBox = new YAHOO.widget.Overlay(body, {\n          visible:false,\n          width:\"10em\",\n          zIndex:1000,\n          effect:{\n            effect:effect,\n            duration:0.25\n          }\n        });\n        msgBox.render();\n    }\n\n    return function(title, anchor, offset) {\n        if (typeof offset === 'undefined') {\n            offset = 48;\n        }\n        init();\n        body.innerHTML = title;\n        var xy = YAHOO.util.Dom.getXY(anchor);\n        xy[0] += offset;\n        xy[1] += anchor.offsetHeight;\n        msgBox.cfg.setProperty(\"xy\",xy);\n        msgBox.show();\n    };\n})();\n\n/**\n * Loads the script specified by the URL.\n *\n * @param href\n *      The URL of the script to load.\n * @param callback\n *      If specified, this function will be invoked after the script is loaded.\n * @see http://stackoverflow.com/questions/4845762/onload-handler-for-script-tag-in-internet-explorer\n */\nfunction loadScript(href,callback) {\n    var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\n    var script = document.createElement(\"script\");\n    script.src = href;\n\n    if (callback) {\n        // Handle Script loading\n        var done = false;\n\n        // Attach handlers for all browsers\n        script.onload = script.onreadystatechange = function() {\n            if ( !done && (!this.readyState ||\n                    this.readyState === \"loaded\" || this.readyState === \"complete\") ) {\n                done = true;\n                callback();\n\n                // Handle memory leak in IE\n                script.onload = script.onreadystatechange = null;\n                if ( head && script.parentNode ) {\n                    head.removeChild( script );\n                }\n            }\n        };\n    }\n\n    // Use insertBefore instead of appendChild  to circumvent an IE6 bug.\n    // This arises when a base node is used (#2709 and #4378).\n    head.insertBefore( script, head.firstChild );\n}\n\n/**\n * Loads a dynamically created invisible IFRAME.\n */\nfunction createIframe(src,callback) {\n    var iframe = document.createElement(\"iframe\");\n    iframe.src = src;\n    iframe.style.display = \"none\";\n\n    var done = false;\n    iframe.onload = iframe.onreadystatechange = function() {\n        if ( !done && (!this.readyState ||\n                this.readyState === \"loaded\" || this.readyState === \"complete\") ) {\n            done = true;\n            callback();\n        }\n    };\n\n    document.body.appendChild(iframe);\n    return iframe;\n}\n\nvar downloadService = {\n    continuations: {},\n\n    download : function(id,url,info, postBack,completionHandler) {\n        var tag = {id:id,postBack:postBack,completionHandler:completionHandler,received:false};\n        this.continuations[id] = tag;\n\n        // use JSONP to download the data\n        function fallback() {\n            loadScript(url+\"?id=\"+id+'&'+Hash.toQueryString(info));\n        }\n\n        if (window.postMessage) {\n            // try downloading the postMessage version of the data,\n            // if we don't receive postMessage (which probably means the server isn't ready with these new datasets),\n            // fallback to JSONP\n            tag.iframe = createIframe(url+\".html?id=\"+id+'&'+Hash.toQueryString(info),function() {\n                window.setTimeout(function() {\n                    if (!tag.received)\n                        fallback();\n                },100); // bit of delay in case onload on our side fires first\n            });\n        } else {\n            // this browser doesn't support postMessage\n            fallback();\n        }\n\n        // NOTE:\n        //   the only reason we even try fallback() is in case our server accepts the submission without a signature\n        //   (which it really shouldn't)\n    },\n\n    /**\n     * Call back to postMessage\n     */\n    receiveMessage : function(ev) {\n        var self = this;\n        Object.values(this.continuations).each(function(tag) {\n            if (tag.iframe.contentWindow==ev.source) {\n                self.post(tag.id,JSON.parse(ev.data));\n            }\n        })\n    },\n\n    post : function(id,data) {\n        if (data==undefined) {\n            // default to id in data\n            data = id;\n            id = data.id;\n        }\n        var tag = this.continuations[id];\n        if (tag==undefined) {\n            console.log(\"Submission from update center that we don't know: \"+id);\n            console.log(\"Likely mismatch between the registered ID vs ID in JSON\");\n            return;\n        }\n        tag.received = true;\n\n        // send the payload back in the body. We used to send this in as a form submission, but that hits the form size check in Jetty.\n        new Ajax.Request(tag.postBack, {\n            contentType:\"application/json\",\n            encoding:\"UTF-8\",\n            postBody:Object.toJSON(data),\n            onSuccess: function() {\n                if(tag.completionHandler!=null)\n                    tag.completionHandler();\n                else if(downloadService.completionHandler!=null)\n                    downloadService.completionHandler();\n            }\n        });\n    }\n};\n\n// update center service. to remain compatible with earlier version of Jenkins, aliased.\nvar updateCenter = downloadService;\n\nYAHOO.util.Event.addListener(window, \"message\", function(ev) { downloadService.receiveMessage(ev); })\n\n/*\nredirects to a page once the page is ready.\n\n    @param url\n        Specifies the URL to redirect the user.\n*/\nfunction applySafeRedirector(url) {\n    var i=0;\n    new PeriodicalExecuter(function() {\n      i = (i+1)%4;\n      var s = \"\";\n      var j=0;\n      for( j=0; j<i; j++ )\n        s+='.';\n      // put the rest of dots as hidden so that the layout doesn't change\n      // depending on the # of dots.\n      s+=\"<span style='visibility:hidden'>\";\n      for( ; j<4; j++ )\n        s+='.';\n      s+=\"</span>\";\n      $('progress').innerHTML = s;\n    },1);\n\n    window.setTimeout(function() {\n      var statusChecker = arguments.callee;\n        new Ajax.Request(url, {\n            method: \"get\",\n            onFailure: function(rsp) {\n                if(rsp.status==503 && rsp.getHeader(\"X-Jenkins-Interactive\")==null) {\n                  // redirect as long as we are still loading\n                  window.setTimeout(statusChecker,5000);\n                } else {\n                  window.location.replace(url);\n                }\n            },\n            onSuccess: function(rsp) {\n                if(rsp.status!=200) {\n                    // if connection fails, somehow Prototype thinks it's a success\n                    window.setTimeout(statusChecker,5000);\n                } else {\n                    window.location.replace(url);\n                }\n            }\n        });\n    }, 5000);\n}\n\n// logic behind <f:validateButton />\nfunction validateButton(checkUrl,paramList,button) {\n  button = button._button;\n\n  var parameters = {};\n\n  paramList.split(',').each(function(name) {\n      var p = findPreviousFormItem(button,name);\n      if(p!=null) {\n        if(p.type==\"checkbox\")  parameters[name] = p.checked;\n        else                    parameters[name] = p.value;\n      }\n  });\n\n  var spinner = $(button).up(\"DIV\").next();\n  var target = spinner.next();\n  spinner.style.display=\"block\";\n\n  new Ajax.Request(checkUrl, {\n      parameters: parameters,\n      onComplete: function(rsp) {\n          spinner.style.display=\"none\";\n          applyErrorMessage(target, rsp);\n          layoutUpdateCallback.call();\n          var s = rsp.getResponseHeader(\"script\");\n          try {\n              geval(s);\n          } catch(e) {\n              window.alert(\"failed to evaluate \"+s+\"\\n\"+e.message);\n          }\n      }\n  });\n}\n\nfunction applyErrorMessage(elt, rsp) {\n    if (rsp.status == 200) {\n        elt.innerHTML = rsp.responseText;\n    } else {\n        var id = 'valerr' + (iota++);\n        elt.innerHTML = '<a href=\"\" onclick=\"document.getElementById(\\'' + id\n        + '\\').style.display=\\'block\\';return false\">ERROR</a><div id=\"'\n        + id + '\" style=\"display:none\">' + rsp.responseText + '</div>';\n        var error = document.getElementById('error-description'); // cf. oops.jelly\n        if (error) {\n            var div = document.getElementById(id);\n            while (div.firstChild) {\n                div.removeChild(div.firstChild);\n            }\n            div.appendChild(error);\n        }\n    }\n    Behaviour.applySubtree(elt);\n}\n\n// create a combobox.\n// @param idOrField\n//      ID of the <input type=text> element that becomes a combobox, or the field itself.\n//      Passing an ID is @deprecated since 1.350; use <input class=\"combobox\"/> instead.\n// @param valueFunction\n//      Function that returns all the candidates as an array\nfunction createComboBox(idOrField,valueFunction) {\n    var candidates = valueFunction();\n    var creator = function() {\n        if (typeof idOrField == \"string\")\n          idOrField = document.getElementById(idOrField);\n        if (!idOrField) return;\n        new ComboBox(idOrField, function(value /*, comboBox*/) {\n          var items = new Array();\n          if (value.length > 0) { // if no value, we'll not provide anything\n            value = value.toLowerCase();\n            for (var i = 0; i<candidates.length; i++) {\n              if (candidates[i].toLowerCase().indexOf(value) >= 0) {\n                items.push(candidates[i]);\n                if(items.length>20)\n                  break; // 20 items in the list should be enough\n              }\n            }\n          }\n          return items; // equiv to: comboBox.setItems(items);\n        });\n    };\n    // If an ID given, create when page has loaded (backward compatibility); otherwise now.\n    if (typeof idOrField == \"string\") Behaviour.addLoadEvent(creator); else creator();\n}\n\n\n// Exception in code during the AJAX processing should be reported,\n// so that our users can find them more easily.\nAjax.Request.prototype.dispatchException = function(e) {\n    throw e;\n}\n\n// event callback when layouts/visibility are updated and elements might have moved around\nvar layoutUpdateCallback = {\n    callbacks : [],\n    add : function (f) {\n        this.callbacks.push(f);\n    },\n    call : function() {\n        for (var i = 0, length = this.callbacks.length; i < length; i++)\n            this.callbacks[i]();\n    }\n}\n\n// Notification bar\n// ==============================\n// this control displays a single line message at the top of the page, like StackOverflow does\n// see ui-samples for more details\nvar notificationBar = {\n    OPACITY : 0.8,\n    DELAY : 3000,   // milliseconds to auto-close the notification\n    div : null,     // the main 'notification-bar' DIV\n    token : null,   // timer for cancelling auto-close\n\n    OK : {// standard option values for typical OK notification\n        icon: \"accept.png\",\n        backgroundColor: \"#8ae234\"\n    },\n    WARNING : {// likewise, for warning\n        icon: \"yellow.png\",\n        backgroundColor: \"#fce94f\"\n    },\n    ERROR : {// likewise, for error\n        icon: \"red.png\",\n        backgroundColor: \"#ef2929\",\n        sticky: true\n    },\n\n    init : function() {\n        if (this.div==null) {\n            this.div = document.createElement(\"div\");\n            YAHOO.util.Dom.setStyle(this.div,\"opacity\",0);\n            this.div.id=\"notification-bar\";\n            this.div.style.backgroundColor=\"#fff\";\n            document.body.insertBefore(this.div, document.body.firstChild);\n\n            var self = this;\n            this.div.onclick = function() {\n                self.hide();\n            };\n        }\n    },\n    // cancel pending auto-hide timeout\n    clearTimeout : function() {\n        if (this.token)\n            window.clearTimeout(this.token);\n        this.token = null;\n    },\n    // hide the current notification bar, if it's displayed\n    hide : function () {\n        this.clearTimeout();\n        var self = this;\n        var out = new YAHOO.util.ColorAnim(this.div, {\n            opacity: { to:0 },\n            backgroundColor: {to:\"#fff\"}\n        }, 0.3, YAHOO.util.Easing.easeIn);\n        out.onComplete.subscribe(function() {\n            self.div.style.display = \"none\";\n        })\n        out.animate();\n    },\n    // show a notification bar\n    show : function (text,options) {\n        options = options || {}\n\n        this.init();\n        this.div.style.height = this.div.style.lineHeight = options.height || \"40px\";\n        this.div.style.display = \"block\";\n\n        if (options.icon)\n            text = \"<img src='\"+rootURL+\"/images/24x24/\"+options.icon+\"'> \"+text;\n        this.div.innerHTML = text;\n\n        new YAHOO.util.ColorAnim(this.div, {\n            opacity: { to:this.OPACITY },\n            backgroundColor : { to: options.backgroundColor || \"#fff\" }\n        }, 1, YAHOO.util.Easing.easeOut).animate();\n\n        this.clearTimeout();\n        var self = this;\n        if (!options.sticky)\n            this.token = window.setTimeout(function(){self.hide();},this.DELAY);\n    }\n};\n"], "fixing_code": ["/*\n * The MIT License\n * \n * Copyright (c) 2004-2010, Sun Microsystems, Inc., Kohsuke Kawaguchi,\n * Daniel Dyer, Yahoo! Inc., Alan Harder, InfraDNA, Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n//\n//\n// JavaScript for Jenkins\n//     See http://www.ibm.com/developerworks/web/library/wa-memleak/?ca=dgr-lnxw97JavascriptLeaks\n//     for memory leak patterns and how to prevent them.\n//\n\nif (window.isRunAsTest) {\n    // Disable postMessage when running in test mode (HtmlUnit).\n    window.postMessage = false;\n}\n\n// create a new object whose prototype is the given object\nfunction object(o) {\n    function F() {}\n    F.prototype = o;\n    return new F();\n}\n\n/**\n * A function that returns false if the page is known to be invisible.\n */\nvar isPageVisible = (function(){\n    // @see https://developer.mozilla.org/en/DOM/Using_the_Page_Visibility_API\n    // Set the name of the hidden property and the change event for visibility\n    var hidden, visibilityChange;\n    if (typeof document.hidden !== \"undefined\") {\n        hidden = \"hidden\";\n        visibilityChange = \"visibilitychange\";\n    } else if (typeof document.mozHidden !== \"undefined\") {\n        hidden = \"mozHidden\";\n        visibilityChange = \"mozvisibilitychange\";\n    } else if (typeof document.msHidden !== \"undefined\") {\n        hidden = \"msHidden\";\n        visibilityChange = \"msvisibilitychange\";\n    } else if (typeof document.webkitHidden !== \"undefined\") {\n        hidden = \"webkitHidden\";\n        visibilityChange = \"webkitvisibilitychange\";\n    }\n\n    // By default, visibility set to true\n    var pageIsVisible = true;\n\n    // If the page is hidden, prevent any polling\n    // if the page is shown, restore pollings\n    function onVisibilityChange() {\n        pageIsVisible = !document[hidden];\n    }\n\n    // Warn if the browser doesn't support addEventListener or the Page Visibility API\n    if (typeof document.addEventListener !== \"undefined\" && typeof hidden !== \"undefined\") {\n        // Init the value to the real state of the page\n        pageIsVisible = !document[hidden];\n\n        // Handle page visibility change\n        document.addEventListener(visibilityChange, onVisibilityChange, false);\n    }\n\n    return function() {\n        return pageIsVisible;\n    }\n})();\n\n// id generator\nvar iota = 0;\n\n// crumb information\nvar crumb = {\n    fieldName: null,\n    value: null,\n\n    init: function(crumbField, crumbValue) {\n        if (crumbField==\"\") return; // layout.jelly passes in \"\" whereas it means null.\n        this.fieldName = crumbField;\n        this.value = crumbValue;\n    },\n\n    /**\n     * Adds the crumb value into the given hash or array and returns it.\n     */\n    wrap: function(headers) {\n        if (this.fieldName!=null) {\n            if (headers instanceof Array)\n                // TODO prototype.js only seems to interpret object\n                headers.push(this.fieldName, this.value);\n            else\n                headers[this.fieldName]=this.value;\n        }\n        // TODO return value unused\n        return headers;\n    },\n\n    /**\n     * Puts a hidden input field to the form so that the form submission will have the crumb value\n     */\n    appendToForm : function(form) {\n        if(this.fieldName==null)    return; // noop\n        var div = document.createElement(\"div\");\n        div.innerHTML = \"<input type=hidden name='\"+this.fieldName+\"' value='\"+this.value+\"'>\";\n        form.appendChild(div);\n        if (form.enctype == \"multipart/form-data\") {\n            if (form.action.indexOf(\"?\") != -1) {\n                form.action = form.action+\"&\"+this.fieldName+\"=\"+this.value;\n            } else {\n                form.action = form.action+\"?\"+this.fieldName+\"=\"+this.value;\n            }\n        }\n    }\n}\n\n// Form check code\n//========================================================\nvar FormChecker = {\n    // pending requests\n    queue : [],\n\n    // conceptually boolean, but doing so create concurrency problem.\n    // that is, during unit tests, the AJAX.send works synchronously, so\n    // the onComplete happens before the send method returns. On a real environment,\n    // more likely it's the other way around. So setting a boolean flag to true or false\n    // won't work.\n    inProgress : 0,\n\n    /**\n     * Schedules a form field check. Executions are serialized to reduce the bandwidth impact.\n     *\n     * @param url\n     *      Remote doXYZ URL that performs the check. Query string should include the field value.\n     * @param method\n     *      HTTP method. GET or POST. I haven't confirmed specifics, but some browsers seem to cache GET requests.\n     * @param target\n     *      HTML element whose innerHTML will be overwritten when the check is completed.\n     */\n    delayedCheck : function(url, method, target) {\n        if(url==null || method==null || target==null)\n            return; // don't know whether we should throw an exception or ignore this. some broken plugins have illegal parameters\n        this.queue.push({url:url, method:method, target:target});\n        this.schedule();\n    },\n\n    sendRequest : function(url, params) {\n        if (params.method == \"post\") {\n            var idx = url.indexOf('?');\n            params.parameters = url.substring(idx + 1);\n            url = url.substring(0, idx);\n        }\n        new Ajax.Request(url, params);\n    },\n\n    schedule : function() {\n        if (this.inProgress>0)  return;\n        if (this.queue.length == 0) return;\n\n        var next = this.queue.shift();\n        this.sendRequest(next.url, {\n            method : next.method,\n            onComplete : function(x) {\n                applyErrorMessage(next.target, x);\n                FormChecker.inProgress--;\n                FormChecker.schedule();\n                layoutUpdateCallback.call();\n            }\n        });\n        this.inProgress++;\n    }\n}\n\n/**\n * Find the sibling (in the sense of the structured form submission) form item of the given name,\n * and returns that DOM node.\n *\n * @param {HTMLElement} e\n * @param {string} name\n *      Name of the control to find. Can include \"../../\" etc in the prefix.\n *      See @RelativePath.\n *\n *      We assume that the name is normalized and doesn't contain any redundant component.\n *      That is, \"..\" can only appear as prefix, and \"foo/../bar\" is not OK (because it can be reduced to \"bar\")\n */\nfunction findNearBy(e,name) {\n    while (name.startsWith(\"../\")) {\n        name = name.substring(3);\n        e = findFormParent(e,null,true);\n    }\n\n    // name=\"foo/bar/zot\"  -> prefixes=[\"bar\",\"foo\"] & name=\"zot\"\n    var prefixes = name.split(\"/\");\n    name = prefixes.pop();\n    prefixes = prefixes.reverse();\n\n    // does 'e' itself match the criteria?\n    // as some plugins use the field name as a parameter value, instead of 'value'\n    var p = findFormItem(e,name,function(e,filter) {\n        return filter(e) ? e : null;\n    });\n    if (p!=null && prefixes.length==0)    return p;\n\n    var owner = findFormParent(e,null,true);\n\n    function locate(iterator,e) {// keep finding elements until we find the good match\n        while (true) {\n            e = iterator(e,name);\n            if (e==null)    return null;\n\n            // make sure this candidate element 'e' is in the right point in the hierarchy\n            var p = e;\n            for (var i=0; i<prefixes.length; i++) {\n                p = findFormParent(p,null,true);\n                if (p.getAttribute(\"name\")!=prefixes[i])\n                    return null;\n            }\n            if (findFormParent(p,null,true)==owner)\n                return e;\n        }\n    }\n\n    return locate(findPreviousFormItem,e) || locate(findNextFormItem,e);\n}\n\nfunction controlValue(e) {\n    if (e==null)    return null;\n    // compute the form validation value to be sent to the server\n    var type = e.getAttribute(\"type\");\n    if(type!=null && type.toLowerCase()==\"checkbox\")\n        return e.checked;\n    return e.value;\n}\n\nfunction toValue(e) {\n    return encodeURIComponent(controlValue(e));\n}\n\n/**\n * Builds a query string in a fluent API pattern.\n * @param {HTMLElement} owner\n *      The 'this' control.\n */\nfunction qs(owner) {\n    return {\n        params : \"\",\n\n        append : function(s) {\n            if (this.params.length==0)  this.params+='?';\n            else                        this.params+='&';\n            this.params += s;\n            return this;\n        },\n\n        nearBy : function(name) {\n            var e = findNearBy(owner,name);\n            if (e==null)    return this;    // skip\n            return this.append(Path.tail(name)+'='+toValue(e));\n        },\n\n        addThis : function() {\n            return this.append(\"value=\"+toValue(owner));\n        },\n\n        toString : function() {\n            return this.params;\n        }\n    };\n}\n\n// find the nearest ancestor node that has the given tag name\nfunction findAncestor(e, tagName) {\n    do {\n        e = e.parentNode;\n    } while (e != null && e.tagName != tagName);\n    return e;\n}\n\nfunction findAncestorClass(e, cssClass) {\n    do {\n        e = e.parentNode;\n    } while (e != null && !Element.hasClassName(e,cssClass));\n    return e;\n}\n\nfunction findFollowingTR(input, className) {\n    // identify the parent TR\n    var tr = input;\n    while (tr.tagName != \"TR\")\n        tr = tr.parentNode;\n\n    // then next TR that matches the CSS\n    do {\n        tr = $(tr).next();\n    } while (tr != null && (tr.tagName != \"TR\" || !Element.hasClassName(tr,className)));\n\n    return tr;\n}\n\nfunction find(src,filter,traversalF) {\n    while(src!=null) {\n        src = traversalF(src);\n        if(src!=null && filter(src))\n            return src;\n    }\n    return null;\n}\n\n/**\n * Traverses a form in the reverse document order starting from the given element (but excluding it),\n * until the given filter matches, or run out of an element.\n */\nfunction findPrevious(src,filter) {\n    return find(src,filter,function (e) {\n        var p = e.previousSibling;\n        if(p==null) return e.parentNode;\n        while(p.lastChild!=null)\n            p = p.lastChild;\n        return p;\n    });\n}\n\nfunction findNext(src,filter) {\n    return find(src,filter,function (e) {\n        var n = e.nextSibling;\n        if(n==null) return e.parentNode;\n        while(n.firstChild!=null)\n            n = n.firstChild;\n        return n;\n    });\n}\n\nfunction findFormItem(src,name,directionF) {\n    var name2 = \"_.\"+name; // handles <textbox field=\"...\" /> notation silently\n    return directionF(src,function(e){ return (e.tagName==\"INPUT\" || e.tagName==\"TEXTAREA\" || e.tagName==\"SELECT\") && (e.name==name || e.name==name2); });\n}\n\n/**\n * Traverses a form in the reverse document order and finds an INPUT element that matches the given name.\n */\nfunction findPreviousFormItem(src,name) {\n    return findFormItem(src,name,findPrevious);\n}\n\nfunction findNextFormItem(src,name) {\n    return findFormItem(src,name,findNext);\n}\n\n/**\n * Parse HTML into DOM.\n */\nfunction parseHtml(html) {\n    var c = document.createElement(\"div\");\n    c.innerHTML = html;\n    return c.firstChild;\n}\n\n/**\n * Evaluates the script in global context.\n */\nfunction geval(script) {\n    // execScript chokes on \"\" but eval doesn't, so we need to reject it first.\n    if (script==null || script==\"\") return;\n    // see http://perfectionkills.com/global-eval-what-are-the-options/\n    // note that execScript cannot return value\n    (this.execScript || eval)(script);\n}\n\n/**\n * Emulate the firing of an event.\n *\n * @param {HTMLElement} element\n *      The element that will fire the event\n * @param {String} event\n *      like 'change', 'blur', etc.\n */\nfunction fireEvent(element,event){\n    if (document.createEvent) {\n        // dispatch for firefox + others\n        var evt = document.createEvent(\"HTMLEvents\");\n        evt.initEvent(event, true, true ); // event type,bubbling,cancelable\n        return !element.dispatchEvent(evt);\n    } else {\n        // dispatch for IE\n        var evt = document.createEventObject();\n        return element.fireEvent('on'+event,evt)\n    }\n}\n\n// shared tooltip object\nvar tooltip;\n\n\n\n// Behavior rules\n//========================================================\n// using tag names in CSS selector makes the processing faster\nfunction registerValidator(e) {\n    e.targetElement = findFollowingTR(e, \"validation-error-area\").firstChild.nextSibling;\n    e.targetUrl = function() {\n        var url = this.getAttribute(\"checkUrl\");\n        var depends = this.getAttribute(\"checkDependsOn\");\n\n        if (depends==null) {// legacy behaviour where checkUrl is a JavaScript\n            try {\n                return eval(url); // need access to 'this', so no 'geval'\n            } catch (e) {\n                if (window.console!=null)  console.warn(\"Legacy checkUrl '\" + url + \"' is not valid Javascript: \"+e);\n                if (window.YUI!=null)      YUI.log(\"Legacy checkUrl '\" + url + \"' is not valid Javascript: \"+e,\"warn\");\n                return url; // return plain url as fallback\n            }\n        } else {\n            var q = qs(this).addThis();\n            if (depends.length>0)\n                depends.split(\" \").each(function (n) {\n                    q.nearBy(n);\n                });\n            return url+ q.toString();\n        }\n    };\n    var method = e.getAttribute(\"checkMethod\") || \"get\";\n\n    var url = e.targetUrl();\n    try {\n      FormChecker.delayedCheck(url, method, e.targetElement);\n    } catch (x) {\n        // this happens if the checkUrl refers to a non-existing element.\n        // don't let this kill off the entire JavaScript\n        YAHOO.log(\"Failed to register validation method: \"+e.getAttribute(\"checkUrl\")+\" : \"+e);\n        return;\n    }\n\n    var checker = function() {\n        var target = this.targetElement;\n        FormChecker.sendRequest(this.targetUrl(), {\n            method : method,\n            onComplete : function(x) {\n                target.innerHTML = x.responseText;\n                Behaviour.applySubtree(target);\n            }\n        });\n    }\n    var oldOnchange = e.onchange;\n    if(typeof oldOnchange==\"function\") {\n        e.onchange = function() { checker.call(this); oldOnchange.call(this); }\n    } else\n        e.onchange = checker;\n\n    var v = e.getAttribute(\"checkDependsOn\");\n    if (v) {\n        v.split(\" \").each(function (name) {\n            var c = findNearBy(e,name);\n            if (c==null) {\n                if (window.console!=null)  console.warn(\"Unable to find nearby \"+name);\n                if (window.YUI!=null)      YUI.log(\"Unable to find a nearby control of the name \"+name,\"warn\")\n                return;\n            }\n            $(c).observe(\"change\",checker.bind(e));\n        });\n    }\n\n    e = null; // avoid memory leak\n}\n\nfunction registerRegexpValidator(e,regexp,message) {\n    e.targetElement = findFollowingTR(e, \"validation-error-area\").firstChild.nextSibling;\n    var checkMessage = e.getAttribute('checkMessage');\n    if (checkMessage) message = checkMessage;\n    var oldOnchange = e.onchange;\n    e.onchange = function() {\n        var set = oldOnchange != null ? oldOnchange.call(this) : false;\n        if (this.value.match(regexp)) {\n            if (!set) this.targetElement.innerHTML = \"\";\n        } else {\n            this.targetElement.innerHTML = \"<div class=error>\" + message + \"</div>\";\n            set = true;\n        }\n        return set;\n    }\n    e.onchange.call(e);\n    e = null; // avoid memory leak\n}\n\n/**\n * Wraps a <button> into YUI button.\n *\n * @param e\n *      button element\n * @param onclick\n *      onclick handler\n * @return\n *      YUI Button widget.\n */\nfunction makeButton(e,onclick) {\n    var h = e.onclick;\n    var clsName = e.className;\n    var n = e.name;\n    var btn = new YAHOO.widget.Button(e,{});\n    if(onclick!=null)\n        btn.addListener(\"click\",onclick);\n    if(h!=null)\n        btn.addListener(\"click\",h);\n    var be = btn.get(\"element\");\n    Element.addClassName(be,clsName);\n    if(n) // copy the name\n        be.setAttribute(\"name\",n);\n    return btn;\n}\n\n/*\n    If we are inside 'to-be-removed' class, some HTML altering behaviors interact badly, because\n    the behavior re-executes when the removed master copy gets reinserted later.\n */\nfunction isInsideRemovable(e) {\n    return Element.ancestors(e).find(function(f){return f.hasClassName(\"to-be-removed\");});\n}\n\n/**\n * Render the template captured by &lt;l:renderOnDemand> at the element 'e' and replace 'e' by the content.\n *\n * @param {HTMLElement} e\n *      The place holder element to be lazy-rendered.\n * @param {boolean} noBehaviour\n *      if specified, skip the application of behaviour rule.\n */\nfunction renderOnDemand(e,callback,noBehaviour) {\n    if (!e || !Element.hasClassName(e,\"render-on-demand\")) return;\n    var proxy = eval(e.getAttribute(\"proxy\"));\n    proxy.render(function (t) {\n        var contextTagName = e.parentNode.tagName;\n        var c;\n        if (contextTagName==\"TBODY\") {\n            c = document.createElement(\"DIV\");\n            c.innerHTML = \"<TABLE><TBODY>\"+t.responseText+\"</TBODY></TABLE>\";\n            c = c./*JENKINS-15494*/lastChild.firstChild;\n        } else {\n            c = document.createElement(contextTagName);\n            c.innerHTML = t.responseText;\n        }\n\n        var elements = [];\n        while (c.firstChild!=null) {\n            var n = c.firstChild;\n            e.parentNode.insertBefore(n,e);\n            if (n.nodeType==1 && !noBehaviour)\n                elements.push(n);\n        }\n        Element.remove(e);\n\n        evalInnerHtmlScripts(t.responseText,function() {\n            Behaviour.applySubtree(elements,true);\n            if (callback)   callback(t);\n        });\n    });\n}\n\n/**\n * Finds all the script tags \n */\nfunction evalInnerHtmlScripts(text,callback) {\n    var q = [];\n    var matchAll = new RegExp('<script([^>]*)>([\\\\S\\\\s]*?)<\\/script>', 'img');\n    var matchOne = new RegExp('<script([^>]*)>([\\\\S\\\\s]*?)<\\/script>', 'im');\n    var srcAttr  = new RegExp('src=[\\'\\\"]([^\\'\\\"]+)[\\'\\\"]','i');\n    (text.match(matchAll)||[]).map(function(s) {\n        var m = s.match(srcAttr);\n        if (m) {\n            q.push(function(cont) {\n                loadScript(m[1],cont);\n            });\n        } else {\n            q.push(function(cont) {\n                geval(s.match(matchOne)[2]);\n                cont();\n            });\n        }\n    });\n    q.push(callback);\n    sequencer(q);\n}\n\n/**\n * Take an array of (typically async) functions and run them in a sequence.\n * Each of the function in the array takes one 'continuation' parameter, and upon the completion\n * of the function it needs to invoke \"continuation()\" to signal the execution of the next function.\n */\nfunction sequencer(fs) {\n    var nullFunction = function() {}\n    function next() {\n        if (fs.length>0) {\n            (fs.shift()||nullFunction)(next);\n        }\n    }\n    return next();\n}\n\n/** @deprecated Use {@link Behaviour.specify} instead. */\nvar jenkinsRules = {\n// TODO convert as many as possible to Behaviour.specify calls; some seem to have an implicit order dependency, but what?\n    \"BODY\" : function() {\n        tooltip = new YAHOO.widget.Tooltip(\"tt\", {context:[], zindex:999});\n    },\n\n    \"TABLE.sortable\" : function(e) {// sortable table\n        e.sortable = new Sortable.Sortable(e);\n    },\n\n    \"TABLE.progress-bar\" : function(e) { // progressBar.jelly\n        e.onclick = function() {\n            var href = this.getAttribute(\"href\");\n            if(href!=null)      window.location = href;\n        }\n        e = null; // avoid memory leak\n    },\n\n    \"INPUT.expand-button\" : function(e) {\n        makeButton(e,function(e) {\n            var link = e.target;\n            while(!Element.hasClassName(link,\"advancedLink\"))\n                link = link.parentNode;\n            link.style.display = \"none\";\n            $(link).next().style.display=\"block\";\n            layoutUpdateCallback.call();\n        });\n        e = null; // avoid memory leak\n    },\n\n// scripting for having default value in the input field\n    \"INPUT.has-default-text\" : function(e) {\n        var defaultValue = e.value;\n        Element.addClassName(e, \"defaulted\");\n        e.onfocus = function() {\n            if (this.value == defaultValue) {\n                this.value = \"\";\n                Element.removeClassName(this, \"defaulted\");\n            }\n        }\n        e.onblur = function() {\n            if (this.value == \"\") {\n                this.value = defaultValue;\n                Element.addClassName(this, \"defaulted\");\n            }\n        }\n        e = null; // avoid memory leak\n    },\n\n// <label> that doesn't use ID, so that it can be copied in <repeatable>\n    \"LABEL.attach-previous\" : function(e) {\n        e.onclick = function() {\n            var e = $(this).previous();\n            while (e!=null) {\n                if (e.tagName==\"INPUT\") {\n                    e.click();\n                    break;\n                }\n                e = e.previous();\n            }\n        }\n        e = null;\n    },\n\n// form fields that are validated via AJAX call to the server\n// elements with this class should have two attributes 'checkUrl' that evaluates to the server URL.\n    \"INPUT.validated\" : registerValidator,\n    \"SELECT.validated\" : registerValidator,\n    \"TEXTAREA.validated\" : registerValidator,\n\n// validate required form values\n    \"INPUT.required\" : function(e) { registerRegexpValidator(e,/./,\"Field is required\"); },\n\n// validate form values to be an integer\n    \"INPUT.number\" : function(e) { registerRegexpValidator(e,/^(\\d+|)$/,\"Not an integer\"); },\n    \"INPUT.positive-number\" : function(e) {\n        registerRegexpValidator(e,/^(\\d*[1-9]\\d*|)$/,\"Not a positive integer\");\n    },\n\n    \"INPUT.auto-complete\": function(e) {// form field with auto-completion support \n        // insert the auto-completion container\n        var div = document.createElement(\"DIV\");\n        e.parentNode.insertBefore(div,$(e).next()||null);\n        e.style.position = \"relative\"; // or else by default it's absolutely positioned, making \"width:100%\" break\n\n        var ds = new YAHOO.util.XHRDataSource(e.getAttribute(\"autoCompleteUrl\"));\n        ds.responseType = YAHOO.util.XHRDataSource.TYPE_JSON;\n        ds.responseSchema = {\n            resultsList: \"suggestions\",\n            fields: [\"name\"]\n        };\n        \n        // Instantiate the AutoComplete\n        var ac = new YAHOO.widget.AutoComplete(e, div, ds);\n        ac.generateRequest = function(query) {\n            return \"?value=\" + query;\n        };\n        ac.prehighlightClassName = \"yui-ac-prehighlight\";\n        ac.animSpeed = 0;\n        ac.useShadow = true;\n        ac.autoSnapContainer = true;\n        ac.delimChar = e.getAttribute(\"autoCompleteDelimChar\");\n        ac.doBeforeExpandContainer = function(textbox,container) {// adjust the width every time we show it\n            container.style.width=textbox.clientWidth+\"px\";\n            var Dom = YAHOO.util.Dom;\n            Dom.setXY(container, [Dom.getX(textbox), Dom.getY(textbox) + textbox.offsetHeight] );\n            return true;\n        }\n    },\n\n    \"A.help-button\" : function(e) {\n        e.onclick = function() {\n            var tr = findFollowingTR(this, \"help-area\");\n            var div = $(tr).down().next().down();\n\n            if (div.style.display != \"block\") {\n                div.style.display = \"block\";\n                // make it visible\n                new Ajax.Request(this.getAttribute(\"helpURL\"), {\n                    method : 'get',\n                    onSuccess : function(x) {\n                        var from = x.getResponseHeader(\"X-Plugin-From\");\n                        div.innerHTML = x.responseText+(from?\"<div class='from-plugin'>\"+from+\"</div>\":\"\");\n                        layoutUpdateCallback.call();\n                    },\n                    onFailure : function(x) {\n                        div.innerHTML = \"<b>ERROR</b>: Failed to load help file: \" + x.statusText;\n                        layoutUpdateCallback.call();\n                    }\n                });\n            } else {\n                div.style.display = \"none\";\n                layoutUpdateCallback.call();\n            }\n\n            return false;\n        };\n        e.tabIndex = 9999; // make help link unnavigable from keyboard\n        e = null; // avoid memory leak\n    },\n\n    // Script Console : settings and shortcut key\n    \"TEXTAREA.script\" : function(e) {\n        (function() {\n            var cmdKeyDown = false;\n            var mode = e.getAttribute(\"script-mode\") || \"text/x-groovy\";\n            var readOnly = eval(e.getAttribute(\"script-readOnly\")) || false;\n            \n            var w = CodeMirror.fromTextArea(e,{\n              mode: mode,\n              lineNumbers: true,\n              matchBrackets: true,\n              readOnly: readOnly,\n              onKeyEvent: function(editor, event){\n                function isGeckoCommandKey() {\n                    return Prototype.Browser.Gecko && event.keyCode == 224\n                }\n                function isOperaCommandKey() {\n                    return Prototype.Browser.Opera && event.keyCode == 17\n                }\n                function isWebKitCommandKey() {\n                    return Prototype.Browser.WebKit && (event.keyCode == 91 || event.keyCode == 93)\n                }\n                function isCommandKey() {\n                    return isGeckoCommandKey() || isOperaCommandKey() || isWebKitCommandKey();\n                }\n                function isReturnKeyDown() {\n                    return event.type == 'keydown' && event.keyCode == Event.KEY_RETURN;\n                }\n                function getParentForm(element) {\n                    if (element == null) throw 'not found a parent form';\n                    if (element instanceof HTMLFormElement) return element;\n                    \n                    return getParentForm(element.parentNode);\n                }\n                function saveAndSubmit() {\n                    editor.save();\n                    getParentForm(e).submit();\n                    event.stop();\n                }\n                \n                // Mac (Command + Enter)\n                if (navigator.userAgent.indexOf('Mac') > -1) {\n                    if (event.type == 'keydown' && isCommandKey()) {\n                        cmdKeyDown = true;\n                    }\n                    if (event.type == 'keyup' && isCommandKey()) {\n                        cmdKeyDown = false;\n                    }\n                    if (cmdKeyDown && isReturnKeyDown()) {\n                        saveAndSubmit();\n                        return true;\n                    }\n                  \n                // Windows, Linux (Ctrl + Enter)\n                } else {\n                    if (event.ctrlKey && isReturnKeyDown()) {\n                        saveAndSubmit();\n                        return true;\n                    }\n                }\n              }\n            }).getWrapperElement();\n            w.setAttribute(\"style\",\"border:1px solid black; margin-top: 1em; margin-bottom: 1em\")\n        })();\n\t},\n\n// deferred client-side clickable map.\n// this is useful where the generation of <map> element is time consuming\n    \"IMG[lazymap]\" : function(e) {\n        new Ajax.Request(\n            e.getAttribute(\"lazymap\"),\n            {\n                method : 'get',\n                onSuccess : function(x) {\n                    var div = document.createElement(\"div\");\n                    document.body.appendChild(div);\n                    div.innerHTML = x.responseText;\n                    var id = \"map\" + (iota++);\n                    div.firstChild.setAttribute(\"name\", id);\n                    e.setAttribute(\"usemap\", \"#\" + id);\n                }\n            });\n    },\n\n    // resizable text area\n    \"TEXTAREA\" : function(textarea) {\n        if(Element.hasClassName(textarea,\"rich-editor\")) {\n            // rich HTML editor\n            try {\n                var editor = new YAHOO.widget.Editor(textarea, {\n                    dompath: true,\n                    animate: true,\n                    handleSubmit: true\n                });\n                // probably due to the timing issue, we need to let the editor know\n                // that DOM is ready\n                editor.DOMReady=true;\n                editor.fireQueue();\n                editor.render();\n                layoutUpdateCallback.call();\n            } catch(e) {\n                alert(e);\n            }\n            return;\n        }\n\n        // CodeMirror inserts a wrapper element next to the textarea.\n        // textarea.nextSibling may not be the handle.\n        var handles = findElementsBySelector(textarea.parentNode, \".textarea-handle\");\n        if(handles.length != 1) return;\n        var handle = handles[0];\n\n        var Event = YAHOO.util.Event;\n\n        function getCodemirrorScrollerOrTextarea(){\n            return textarea.codemirrorObject ? textarea.codemirrorObject.getScrollerElement() : textarea;\n        }\n        handle.onmousedown = function(ev) {\n            ev = Event.getEvent(ev);\n            var s = getCodemirrorScrollerOrTextarea();\n            var offset = s.offsetHeight-Event.getPageY(ev);\n            s.style.opacity = 0.5;\n            document.onmousemove = function(ev) {\n                ev = Event.getEvent(ev);\n                function max(a,b) { if(a<b) return b; else return a; }\n                s.style.height = max(32, offset + Event.getPageY(ev)) + 'px';\n                layoutUpdateCallback.call();\n                return false;\n            };\n            document.onmouseup = function() {\n                document.onmousemove = null;\n                document.onmouseup = null;\n                var s = getCodemirrorScrollerOrTextarea();\n                s.style.opacity = 1;\n            }\n        };\n        handle.ondblclick = function() {\n            var s = getCodemirrorScrollerOrTextarea();\n            s.style.height = \"1px\"; // To get actual height of the textbox, shrink it and show its scrollbar\n            s.style.height = s.scrollHeight + 'px';\n        }\n    },\n\n    // structured form submission\n    \"FORM\" : function(form) {\n        crumb.appendToForm(form);\n        if(Element.hasClassName(form, \"no-json\"))\n            return;\n        // add the hidden 'json' input field, which receives the form structure in JSON\n        var div = document.createElement(\"div\");\n        div.innerHTML = \"<input type=hidden name=json value=init>\";\n        form.appendChild(div);\n\n        var oldOnsubmit = form.onsubmit;\n        if (typeof oldOnsubmit == \"function\") {\n            form.onsubmit = function() { return buildFormTree(this) && oldOnsubmit.call(this); }\n        } else {\n            form.onsubmit = function() { return buildFormTree(this); };\n        }\n\n        form = null; // memory leak prevention\n    },\n\n    // hook up tooltip.\n    //   add nodismiss=\"\" if you'd like to display the tooltip forever as long as the mouse is on the element.\n    \"[tooltip]\" : function(e) {\n        applyTooltip(e,e.getAttribute(\"tooltip\"));\n    },\n\n    \"INPUT.submit-button\" : function(e) {\n        makeButton(e);\n    },\n\n    \"INPUT.yui-button\" : function(e) {\n        makeButton(e);\n    },\n\n    \"TR.optional-block-start\": function(e) { // see optionalBlock.jelly\n        // set start.ref to checkbox in preparation of row-set-end processing\n        var checkbox = e.down().down();\n        e.setAttribute(\"ref\", checkbox.id = \"cb\"+(iota++));\n    },\n\n    // see RowVisibilityGroupTest\n    \"TR.rowvg-start\" : function(e) {\n        // figure out the corresponding end marker\n        function findEnd(e) {\n            for( var depth=0; ; e=$(e).next()) {\n                if(Element.hasClassName(e,\"rowvg-start\"))    depth++;\n                if(Element.hasClassName(e,\"rowvg-end\"))      depth--;\n                if(depth==0)    return e;\n            }\n        }\n\n        e.rowVisibilityGroup = {\n            outerVisible: true,\n            innerVisible: true,\n            /**\n             * TR that marks the beginning of this visibility group.\n             */\n            start: e,\n            /**\n             * TR that marks the end of this visibility group.\n             */\n            end: findEnd(e),\n\n            /**\n             * Considers the visibility of the row group from the point of view of outside.\n             * If you think of a row group like a logical DOM node, this is akin to its .style.display.\n             */\n            makeOuterVisisble : function(b) {\n                this.outerVisible = b;\n                this.updateVisibility();\n            },\n\n            /**\n             * Considers the visibility of the rows in this row group. Since all the rows in a rowvg\n             * shares the single visibility, this just needs to be one boolean, as opposed to many.\n             *\n             * If you think of a row group like a logical DOM node, this is akin to its children's .style.display.\n             */\n            makeInnerVisisble : function(b) {\n                this.innerVisible = b;\n                this.updateVisibility();\n            },\n\n            /**\n             * Based on innerVisible and outerVisible, update the relevant rows' actual CSS display attribute.\n             */\n            updateVisibility : function() {\n                var display = (this.outerVisible && this.innerVisible) ? \"\" : \"none\";\n                for (var e=this.start; e!=this.end; e=$(e).next()) {\n                    if (e.rowVisibilityGroup && e!=this.start) {\n                        e.rowVisibilityGroup.makeOuterVisisble(this.innerVisible);\n                        e = e.rowVisibilityGroup.end; // the above call updates visibility up to e.rowVisibilityGroup.end inclusive\n                    } else {\n                        e.style.display = display;\n                    }\n                }\n                layoutUpdateCallback.call();\n            },\n\n            /**\n             * Enumerate each row and pass that to the given function.\n             *\n             * @param {boolean} recursive\n             *      If true, this visits all the rows from nested visibility groups.\n             */\n            eachRow : function(recursive,f) {\n                if (recursive) {\n                    for (var e=this.start; e!=this.end; e=$(e).next())\n                        f(e);\n                } else {\n                    throw \"not implemented yet\";\n                }\n            }\n        };\n    },\n\n    \"TR.row-set-end\": function(e) { // see rowSet.jelly and optionalBlock.jelly\n        // figure out the corresponding start block\n        e = $(e);\n        var end = e;\n\n        for( var depth=0; ; e=e.previous()) {\n            if(e.hasClassName(\"row-set-end\"))        depth++;\n            if(e.hasClassName(\"row-set-start\"))      depth--;\n            if(depth==0)    break;\n        }\n        var start = e;\n\n        // @ref on start refers to the ID of the element that controls the JSON object created from these rows\n        // if we don't find it, turn the start node into the governing node (thus the end result is that you\n        // created an intermediate JSON object that's always on.)\n        var ref = start.getAttribute(\"ref\");\n        if(ref==null)\n            start.id = ref = \"rowSetStart\"+(iota++);\n\n        applyNameRef(start,end,ref);\n    },\n\n    \"TR.optional-block-start \": function(e) { // see optionalBlock.jelly\n        // this is suffixed by a pointless string so that two processing for optional-block-start\n        // can sandwitch row-set-end\n        // this requires \"TR.row-set-end\" to mark rows\n        var checkbox = e.down().down();\n        updateOptionalBlock(checkbox,false);\n    },\n\n    // image that shows [+] or [-], with hover effect.\n    // oncollapsed and onexpanded will be called when the button is triggered.\n    \"IMG.fold-control\" : function(e) {\n        function changeTo(e,img) {\n            var src = e.src;\n            e.src = src.substring(0,src.lastIndexOf('/'))+\"/\"+e.getAttribute(\"state\")+img;\n        }\n        e.onmouseover = function() {\n            changeTo(this,\"-hover.png\");\n        };\n        e.onmouseout = function() {\n            changeTo(this,\".png\");\n        };\n        e.parentNode.onclick = function(event) {\n            var e = this.firstChild;\n            var s = e.getAttribute(\"state\");\n            if(s==\"plus\") {\n                e.setAttribute(\"state\",\"minus\");\n                if(e.onexpanded)    e.onexpanded();\n            } else {\n                e.setAttribute(\"state\",\"plus\");\n                if(e.oncollapsed)    e.oncollapsed();\n            }\n            changeTo(e,\"-hover.png\");\n            YAHOO.util.Event.stopEvent(event);\n            return false;\n        };\n        e = null; // memory leak prevention\n    },\n\n    // editableComboBox.jelly\n    \"INPUT.combobox\" : function(c) {\n        // Next element after <input class=\"combobox\"/> should be <div class=\"combobox-values\">\n        var vdiv = $(c).next();\n        if (vdiv.hasClassName(\"combobox-values\")) {\n            createComboBox(c, function() {\n                return vdiv.childElements().collect(function(value) {\n                    return value.getAttribute('value');\n                });\n            });\n        }\n    },\n\n    // dropdownList.jelly\n    \"SELECT.dropdownList\" : function(e) {\n        if(isInsideRemovable(e))    return;\n\n        var subForms = [];\n        var start = $(findFollowingTR(e, 'dropdownList-container')).down().next(), end;\n        do { start = start.firstChild; } while (start && start.tagName != 'TR');\n\n        if (start && !Element.hasClassName(start,'dropdownList-start'))\n            start = findFollowingTR(start, 'dropdownList-start');\n        while (start != null) {\n            subForms.push(start);\n            start = findFollowingTR(start, 'dropdownList-start');\n        }\n\n        // control visibility\n        function updateDropDownList() {\n            for (var i = 0; i < subForms.length; i++) {\n                var show = e.selectedIndex == i;\n                var f = $(subForms[i]);\n\n                if (show)   renderOnDemand(f.next());\n                f.rowVisibilityGroup.makeInnerVisisble(show);\n\n                // TODO: this is actually incorrect in the general case if nested vg uses field-disabled\n                // so far dropdownList doesn't create such a situation.\n                f.rowVisibilityGroup.eachRow(true, show?function(e) {\n                    e.removeAttribute(\"field-disabled\");\n                } : function(e) {\n                    e.setAttribute(\"field-disabled\",\"true\");\n                });\n            }\n        }\n\n        e.onchange = updateDropDownList;\n\n        updateDropDownList();\n    },\n\n    \"A.showDetails\" : function(e) {\n        e.onclick = function() {\n            this.style.display = 'none';\n            $(this).next().style.display = 'block';\n            layoutUpdateCallback.call();\n            return false;\n        };\n        e = null; // avoid memory leak\n    },\n\n    \"DIV.behavior-loading\" : function(e) {\n        e.style.display = 'none';\n    },\n\n    \".button-with-dropdown\" : function (e) {\n        new YAHOO.widget.Button(e, { type: \"menu\", menu: $(e).next() });\n    },\n\n    \".track-mouse\" : function (element) {\n        var DOM = YAHOO.util.Dom;\n\n        $(element).observe(\"mouseenter\",function () {\n            element.addClassName(\"mouseover\");\n\n            var mousemoveTracker = function (event) {\n                var elementRegion = DOM.getRegion(element);\n                if (event.x < elementRegion.left || event.x > elementRegion.right ||\n                    event.y < elementRegion.top || event.y > elementRegion.bottom) {\n                    element.removeClassName(\"mouseover\");\n                    Element.stopObserving(document, \"mousemove\", mousemoveTracker);\n                }\n            };\n            Element.observe(document, \"mousemove\", mousemoveTracker);\n        });\n    },\n\n    /*\n        Use on div tag to make it sticky visible on the bottom of the page.\n        When page scrolls it remains in the bottom of the page\n        Convenient on \"OK\" button and etc for a long form page\n     */\n    \"#bottom-sticker\" : function(sticker) {\n        var DOM = YAHOO.util.Dom;\n\n        var shadow = document.createElement(\"div\");\n        sticker.parentNode.insertBefore(shadow,sticker);\n\n        var edge = document.createElement(\"div\");\n        edge.className = \"bottom-sticker-edge\";\n        sticker.insertBefore(edge,sticker.firstChild);\n\n        function adjustSticker() {\n            shadow.style.height = sticker.offsetHeight + \"px\";\n\n            var viewport = DOM.getClientRegion();\n            var pos = DOM.getRegion(shadow);\n\n            sticker.style.position = \"fixed\";\n\n            var bottomPos = Math.max(0, viewport.bottom - pos.bottom);\n\n            sticker.style.bottom = bottomPos + \"px\"\n            sticker.style.left = Math.max(0,pos.left-viewport.left) + \"px\"\n        }\n\n        // react to layout change\n        Element.observe(window,\"scroll\",adjustSticker);\n        Element.observe(window,\"resize\",adjustSticker);\n        // initial positioning\n        Element.observe(window,\"load\",adjustSticker);\n        adjustSticker();\n        layoutUpdateCallback.add(adjustSticker);\n    },\n\n    \"#top-sticker\" : function(sticker) {// legacy\n        this[\".top-sticker\"](sticker);\n    },\n\n    /**\n     * @param {HTMLElement} sticker\n     */\n    \".top-sticker\" : function(sticker) {\n        var DOM = YAHOO.util.Dom;\n\n        var shadow = document.createElement(\"div\");\n        sticker.parentNode.insertBefore(shadow,sticker);\n\n        var edge = document.createElement(\"div\");\n        edge.className = \"top-sticker-edge\";\n        sticker.insertBefore(edge,sticker.firstChild);\n\n        var initialBreadcrumbPosition = DOM.getRegion(shadow);\n        function adjustSticker() {\n            shadow.style.height = sticker.offsetHeight + \"px\";\n\n            var viewport = DOM.getClientRegion();\n            var pos = DOM.getRegion(shadow);\n\n            sticker.style.position = \"fixed\";\n            if(pos.top <= initialBreadcrumbPosition.top) {\n                sticker.style.top = Math.max(0, pos.top-viewport.top) + \"px\"\n            }\n            sticker.style.left = Math.max(0,pos.left-viewport.left) + \"px\"\n        }\n\n        // react to layout change\n        Element.observe(window,\"scroll\",adjustSticker);\n        Element.observe(window,\"resize\",adjustSticker);\n        // initial positioning\n        Element.observe(window,\"load\",adjustSticker);\n        adjustSticker();\n    }\n};\n/** @deprecated Use {@link Behaviour.specify} instead. */\nvar hudsonRules = jenkinsRules; // legacy name\n(function() {\n    var p = 20;\n    for (var selector in jenkinsRules) {\n        Behaviour.specify(selector, 'hudson-behavior', p++, jenkinsRules[selector]);\n        delete jenkinsRules[selector];\n    }\n})();\n// now empty, but plugins can stuff things in here later:\nBehaviour.register(hudsonRules);\n\nfunction applyTooltip(e,text) {\n        // copied from YAHOO.widget.Tooltip.prototype.configContext to efficiently add a new element\n        // event registration via YAHOO.util.Event.addListener leaks memory, so do it by ourselves here\n        e.onmouseover = function(ev) {\n            var delay = this.getAttribute(\"nodismiss\")!=null ? 99999999 : 5000;\n            tooltip.cfg.setProperty(\"autodismissdelay\",delay);\n            return tooltip.onContextMouseOver.call(this,YAHOO.util.Event.getEvent(ev),tooltip);\n        }\n        e.onmousemove = function(ev) { return tooltip.onContextMouseMove.call(this,YAHOO.util.Event.getEvent(ev),tooltip); }\n        e.onmouseout  = function(ev) { return tooltip.onContextMouseOut .call(this,YAHOO.util.Event.getEvent(ev),tooltip); }\n        e.title = text;\n        e = null; // avoid memory leak\n}\n\nvar Path = {\n  tail : function(p) {\n      var idx = p.lastIndexOf(\"/\");\n      if (idx<0)    return p;\n      return p.substring(idx+1);\n  }\n};\n\n/**\n * Install change handlers based on the 'fillDependsOn' attribute.\n */\nfunction refillOnChange(e,onChange) {\n    var deps = [];\n\n    function h() {\n        var params = {};\n        deps.each(function (d) {\n            params[d.name] = controlValue(d.control);\n        });\n        onChange(params);\n    }\n    var v = e.getAttribute(\"fillDependsOn\");\n    if (v!=null) {\n        v.split(\" \").each(function (name) {\n            var c = findNearBy(e,name);\n            if (c==null) {\n                if (window.console!=null)  console.warn(\"Unable to find nearby \"+name);\n                if (window.YUI!=null)      YUI.log(\"Unable to find a nearby control of the name \"+name,\"warn\")\n                return;\n            }\n            $(c).observe(\"change\",h);\n            deps.push({name:Path.tail(name),control:c});\n        });\n    }\n    h();   // initial fill\n}\n\nfunction xor(a,b) {\n    // convert both values to boolean by '!' and then do a!=b\n    return !a != !b;\n}\n\n// used by editableDescription.jelly to replace the description field with a form\nfunction replaceDescription() {\n    var d = document.getElementById(\"description\");\n    $(d).down().next().innerHTML = \"<div class='spinner-right'>loading...</div>\";\n    new Ajax.Request(\n        \"./descriptionForm\",\n        {\n          onComplete : function(x) {\n            d.innerHTML = x.responseText;\n            evalInnerHtmlScripts(x.responseText,function() {\n                Behaviour.applySubtree(d);\n                d.getElementsByTagName(\"TEXTAREA\")[0].focus();\n            });\n            layoutUpdateCallback.call();\n          }\n        }\n    );\n    return false;\n}\n\n/**\n * Indicates that form fields from rows [s,e) should be grouped into a JSON object,\n * and attached under the element identified by the specified id.\n */\nfunction applyNameRef(s,e,id) {\n    $(id).groupingNode = true;\n    // s contains the node itself\n    for(var x=$(s).next(); x!=e; x=x.next()) {\n        // to handle nested <f:rowSet> correctly, don't overwrite the existing value\n        if(x.getAttribute(\"nameRef\")==null)\n            x.setAttribute(\"nameRef\",id);\n    }\n}\n\n\n// used by optionalBlock.jelly to update the form status\n//   @param c     checkbox element\nfunction updateOptionalBlock(c,scroll) {\n    // find the start TR\n    var s = $(c);\n    while(!s.hasClassName(\"optional-block-start\"))\n        s = s.up();\n\n    // find the beginning of the rowvg\n    var vg =s;\n    while (!vg.hasClassName(\"rowvg-start\"))\n        vg = vg.next();\n\n    var checked = xor(c.checked,Element.hasClassName(c,\"negative\"));\n\n    vg.rowVisibilityGroup.makeInnerVisisble(checked);\n\n    if(checked && scroll) {\n        var D = YAHOO.util.Dom;\n\n        var r = D.getRegion(s);\n        r = r.union(D.getRegion(vg.rowVisibilityGroup.end));\n        scrollIntoView(r);\n    }\n\n    if (c.name == 'hudson-tools-InstallSourceProperty') {\n        // Hack to hide tool home when \"Install automatically\" is checked.\n        var homeField = findPreviousFormItem(c, 'home');\n        if (homeField != null && homeField.value == '') {\n            var tr = findAncestor(homeField, 'TR');\n            if (tr != null) {\n                tr.style.display = c.checked ? 'none' : '';\n                layoutUpdateCallback.call();\n            }\n        }\n    }\n}\n\n\n//\n// Auto-scroll support for progressive log output.\n//   See http://radio.javaranch.com/pascarello/2006/08/17/1155837038219.html\n//\nfunction AutoScroller(scrollContainer) {\n    // get the height of the viewport.\n    // See http://www.howtocreate.co.uk/tutorials/javascript/browserwindow\n    function getViewportHeight() {\n        if (typeof( window.innerWidth ) == 'number') {\n            //Non-IE\n            return window.innerHeight;\n        } else if (document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight )) {\n            //IE 6+ in 'standards compliant mode'\n            return document.documentElement.clientHeight;\n        } else if (document.body && ( document.body.clientWidth || document.body.clientHeight )) {\n            //IE 4 compatible\n            return document.body.clientHeight;\n        }\n        return null;\n    }\n\n    return {\n        bottomThreshold : 25,\n        scrollContainer: scrollContainer,\n\n        getCurrentHeight : function() {\n            var scrollDiv = $(this.scrollContainer);\n\n            if (scrollDiv.scrollHeight > 0)\n                return scrollDiv.scrollHeight;\n            else\n                if (scrollDiv.offsetHeight > 0)\n                    return scrollDiv.offsetHeight;\n\n            return null; // huh?\n        },\n\n        // return true if we are in the \"stick to bottom\" mode\n        isSticking : function() {\n            var scrollDiv = $(this.scrollContainer);\n            var currentHeight = this.getCurrentHeight();\n\n            // when used with the BODY tag, the height needs to be the viewport height, instead of\n            // the element height.\n            //var height = ((scrollDiv.style.pixelHeight) ? scrollDiv.style.pixelHeight : scrollDiv.offsetHeight);\n            var height = getViewportHeight();\n            var scrollPos = Math.max(scrollDiv.scrollTop, document.documentElement.scrollTop);\n            var diff = currentHeight - scrollPos - height;\n            // window.alert(\"currentHeight=\" + currentHeight + \",scrollTop=\" + scrollDiv.scrollTop + \",height=\" + height);\n\n            return diff < this.bottomThreshold;\n        },\n\n        scrollToBottom : function() {\n            var scrollDiv = $(this.scrollContainer);\n            var currentHeight = this.getCurrentHeight();\n            if(document.documentElement) document.documentElement.scrollTop = currentHeight\n            scrollDiv.scrollTop = currentHeight;\n        }\n    };\n}\n\n// scroll the current window to display the given element or the region.\nfunction scrollIntoView(e) {\n    function calcDelta(ex1,ex2,vx1,vw) {\n        var vx2=vx1+vw;\n        var a;\n        a = Math.min(vx1-ex1,vx2-ex2);\n        if(a>0)     return -a;\n        a = Math.min(ex1-vx1,ex2-vx2);\n        if(a>0)     return a;\n        return 0;\n    }\n\n    var D = YAHOO.util.Dom;\n\n    var r;\n    if(e.tagName!=null) r = D.getRegion(e);\n    else                r = e;\n\n    var dx = calcDelta(r.left,r.right, document.body.scrollLeft, D.getViewportWidth());\n    var dy = calcDelta(r.top, r.bottom,document.body.scrollTop,  D.getViewportHeight());\n    window.scrollBy(dx,dy);\n}\n\n// used in expandableTextbox.jelly to change a input field into a text area\nfunction expandTextArea(button,id) {\n    button.style.display=\"none\";\n    var field = button.parentNode.previousSibling.children[0];\n    var value = field.value.replace(/ +/g,'\\n');\n    \n    var n = button; \n    while (n.tagName != \"TABLE\")\n    {\n        n = n.parentNode;\n    }\n\n    n.parentNode.innerHTML = \n        \"<textarea rows=8 class='setting-input' name='\"+field.name+\"'>\"+value+\"</textarea>\";\n    layoutUpdateCallback.call();\n}\n\n// refresh a part of the HTML specified by the given ID,\n// by using the contents fetched from the given URL.\nfunction refreshPart(id,url) {\n    var f = function() {\n        if(isPageVisible()) {\n            new Ajax.Request(url, {\n                onSuccess: function(rsp) {\n                    var hist = $(id);\n                    if (hist == null) {\n                        console.log(\"There's no element that has ID of \" + id);\n                        return;\n                    }\n                    var p = hist.up();\n\n                    var div = document.createElement('div');\n                    div.innerHTML = rsp.responseText;\n\n                    var node = $(div).firstDescendant();\n                    p.replaceChild(node, hist);\n\n                    Behaviour.applySubtree(node);\n                    layoutUpdateCallback.call();\n\n                    if(isRunAsTest) return;\n                    refreshPart(id,url);\n                }\n            });    \n        } else {\n            // Reschedule\n            if(isRunAsTest) return;\n            refreshPart(id,url);\n        }\n        \n    };\n    // if run as test, just do it once and do it now to make sure it's working,\n    // but don't repeat.\n    if(isRunAsTest) f();\n    else    window.setTimeout(f, 5000);\n}\n\n\n/*\n    Perform URL encode.\n    Taken from http://www.cresc.co.jp/tech/java/URLencoding/JavaScript_URLEncoding.htm\n    @deprecated Use standard javascript method \"encodeURIComponent\" instead\n*/\nfunction encode(str){\n    var s, u;\n    var s0 = \"\";                // encoded str\n\n    for (var i = 0; i < str.length; i++){   // scan the source\n        s = str.charAt(i);\n        u = str.charCodeAt(i);          // get unicode of the char\n\n        if (s == \" \"){s0 += \"+\";}       // SP should be converted to \"+\"\n        else {\n            if ( u == 0x2a || u == 0x2d || u == 0x2e || u == 0x5f || ((u >= 0x30) && (u <= 0x39)) || ((u >= 0x41) && (u <= 0x5a)) || ((u >= 0x61) && (u <= 0x7a))){     // check for escape\n                s0 = s0 + s;           // don't escape\n            } else {                      // escape\n                if ((u >= 0x0) && (u <= 0x7f)){     // single byte format\n                    s = \"0\"+u.toString(16);\n                    s0 += \"%\"+ s.substr(s.length-2);\n                } else\n                if (u > 0x1fffff){     // quaternary byte format (extended)\n                    s0 += \"%\" + (0xF0 + ((u & 0x1c0000) >> 18)).toString(16);\n                    s0 += \"%\" + (0x80 + ((u & 0x3f000) >> 12)).toString(16);\n                    s0 += \"%\" + (0x80 + ((u & 0xfc0) >> 6)).toString(16);\n                    s0 += \"%\" + (0x80 + (u & 0x3f)).toString(16);\n                } else\n                if (u > 0x7ff){        // triple byte format\n                    s0 += \"%\" + (0xe0 + ((u & 0xf000) >> 12)).toString(16);\n                    s0 += \"%\" + (0x80 + ((u & 0xfc0) >> 6)).toString(16);\n                    s0 += \"%\" + (0x80 + (u & 0x3f)).toString(16);\n                } else {                      // double byte format\n                    s0 += \"%\" + (0xc0 + ((u & 0x7c0) >> 6)).toString(16);\n                    s0 += \"%\" + (0x80 + (u & 0x3f)).toString(16);\n                }\n            }\n        }\n    }\n    return s0;\n}\n\n// when there are multiple form elements of the same name,\n// this method returns the input field of the given name that pairs up\n// with the specified 'base' input element.\nForm.findMatchingInput = function(base, name) {\n    // find the FORM element that owns us\n    var f = base;\n    while (f.tagName != \"FORM\")\n        f = f.parentNode;\n\n    var bases = Form.getInputs(f, null, base.name);\n    var targets = Form.getInputs(f, null, name);\n\n    for (var i=0; i<bases.length; i++) {\n        if (bases[i] == base)\n            return targets[i];\n    }\n\n    return null;        // not found\n}\n\nfunction onBuildHistoryChange(handler) {\n    Event.observe(window, 'jenkins:buildHistoryChanged', handler);\n}\nfunction fireBuildHistoryChanged() {\n    Event.fire(window, 'jenkins:buildHistoryChanged');\n}\n\nfunction updateBuildHistory(ajaxUrl,nBuild) {\n    if(isRunAsTest) return;\n    var bh = $('buildHistory');\n\n    bh.headers = [\"n\",nBuild];\n\n    function getDataTable(buildHistoryDiv) {\n        return $(buildHistoryDiv).getElementsBySelector('table.pane')[0];\n    }\n\n    var leftRightPadding = 4;\n    function checkRowCellOverflows(row) {\n        if (!row) {\n            return;\n        }\n\n        if (Element.hasClassName(row, \"overflow-checked\")) {\n            // already done.\n            return;\n        }\n\n        function markSingleline() {\n            Element.addClassName(row, \"single-line\");\n            Element.removeClassName(row, \"multi-line\");\n        }\n        function markMultiline() {\n            Element.removeClassName(row, \"single-line\");\n            Element.addClassName(row, \"multi-line\");\n        }\n        function indentMultiline(element) {\n            Element.addClassName(element, \"indent-multiline\");\n        }\n\n        function blockWrap(el1, el2) {\n            var div = document.createElement('div');\n\n            Element.addClassName(div, \"block\");\n            Element.addClassName(div, \"wrap\");\n            Element.addClassName(el1, \"wrapped\");\n            Element.addClassName(el2, \"wrapped\");\n\n            el1.parentNode.insertBefore(div, el1);\n            el1.parentNode.removeChild(el1);\n            el2.parentNode.removeChild(el2);\n            div.appendChild(el1);\n            div.appendChild(el2);\n\n            return div;\n        }\n        function blockUnwrap(element) {\n            var wrapped = $(element).getElementsBySelector('.wrapped');\n            for (var i = 0; i < wrapped.length; i++) {\n                var wrappedEl = wrapped[i];\n                wrappedEl.parentNode.removeChild(wrappedEl);\n                element.parentNode.insertBefore(wrappedEl, element);\n                Element.removeClassName(wrappedEl, \"wrapped\");\n            }\n            element.parentNode.removeChild(element);\n        }\n\n        var buildName = $(row).getElementsBySelector('.build-name')[0];\n        var buildDetails = $(row).getElementsBySelector('.build-details')[0];\n\n        if (!buildName || !buildDetails) {\n            return;\n        }\n\n        var displayName = $(buildName).getElementsBySelector('.display-name')[0];\n        var buildControls = $(row).getElementsBySelector('.build-controls')[0];\n        var desc;\n\n        var descElements = $(row).getElementsBySelector('.desc');\n        if (descElements.length > 0) {\n            desc = descElements[0];\n        }\n\n        function resetCellOverflows() {\n            markSingleline();\n\n            // undo block wraps\n            var blockWraps = $(row).getElementsBySelector('.block.wrap');\n            for (var i = 0; i < blockWraps.length; i++) {\n                blockUnwrap(blockWraps[i]);\n            }\n\n            removeZeroWidthSpaces(displayName);\n            removeZeroWidthSpaces(desc);\n            Element.removeClassName(buildName, \"block\");\n            buildName.removeAttribute('style');\n            Element.removeClassName(buildDetails, \"block\");\n            buildDetails.removeAttribute('style');\n            if (buildControls) {\n                Element.removeClassName(buildControls, \"block\");\n                buildDetails.removeAttribute('style');\n            }\n        }\n\n        // Undo everything from the previous poll.\n        resetCellOverflows();\n\n        // Insert zero-width spaces so as to allow text to wrap, allowing us to get the true clientWidth.\n        insertZeroWidthSpacesInElementText(displayName, 2);\n        if (desc) {\n            insertZeroWidthSpacesInElementText(desc, 30);\n            markMultiline();\n        }\n\n        var rowWidth = bh.clientWidth;\n        var usableRowWidth = rowWidth - (leftRightPadding * 2);\n        var nameOverflowParams = getElementOverflowParams(buildName);\n        var detailsOverflowParams = getElementOverflowParams(buildDetails);\n\n        var controlsOverflowParams;\n        if (buildControls) {\n            controlsOverflowParams = getElementOverflowParams(buildControls);\n        }\n\n        if (nameOverflowParams.isOverflowed) {\n            // If the name is overflowed, lets remove the zero-width spaces we added above and\n            // re-add zero-width spaces with a bigger max word sizes.\n            removeZeroWidthSpaces(displayName);\n            insertZeroWidthSpacesInElementText(displayName, 20);\n        }\n\n        function fitToControlsHeight(element) {\n            if (buildControls) {\n                if (element.clientHeight < buildControls.clientHeight) {\n                    $(element).setStyle({height: buildControls.clientHeight.toString() + 'px'});\n                }\n            }\n        }\n\n        function setBuildControlWidths() {\n            if (buildControls) {\n                var buildBadge = $(buildControls).getElementsBySelector('.build-badge')[0];\n\n                if (buildBadge) {\n                    var buildControlsWidth = buildControls.clientWidth;\n                    var buildBadgeWidth;\n\n                    var buildStop = $(buildControls).getElementsBySelector('.build-stop')[0];\n                    if (buildStop) {\n                        $(buildStop).setStyle({width: '24px'});\n                        // Minus 24 for the buildStop width,\n                        // minus 4 for left+right padding in the controls container\n                        buildBadgeWidth = (buildControlsWidth - 24 - leftRightPadding);\n                        if (Element.hasClassName(buildControls, \"indent-multiline\")) {\n                            buildBadgeWidth = buildBadgeWidth - 20;\n                        }\n                        $(buildBadge).setStyle({width: (buildBadgeWidth) + 'px'});\n                    } else {\n                        $(buildBadge).setStyle({width: '100%'});\n                    }\n                }\n                controlsOverflowParams = getElementOverflowParams(buildControls);\n            }\n        }\n        setBuildControlWidths();\n\n        var controlsRepositioned = false;\n\n        if (nameOverflowParams.isOverflowed || detailsOverflowParams.isOverflowed) {\n            // At least one of the cells (name or details) needs to move to a row of its own.\n\n            markMultiline();\n\n            if (buildControls) {\n\n                // We have build controls. Lets see can we find a combination that allows the build controls\n                // to sit beside either the build name or the build details.\n\n                var badgesOverflowing = false;\n                var nameLessThanHalf = true;\n                var detailsLessThanHalf = true;\n                var buildBadge = $(buildControls).getElementsBySelector('.build-badge')[0];\n                if (buildBadge) {\n                    var badgeOverflowParams = getElementOverflowParams(buildBadge);\n\n                    if (badgeOverflowParams.isOverflowed) {\n                        // The badges are also overflowing. In this case, we will only attempt to\n                        // put the controls on the same line as the name or details (see below)\n                        // if the name or details is using less than half the width of the build history\n                        // widget.\n                        badgesOverflowing = true;\n                        nameLessThanHalf = (nameOverflowParams.scrollWidth < usableRowWidth/2);\n                        detailsLessThanHalf = (detailsOverflowParams.scrollWidth < usableRowWidth/2);\n                    }\n                }\n                function expandLeftWithRight(leftCellOverFlowParams, rightCellOverflowParams) {\n                    // Float them left and right...\n                    $(leftCellOverFlowParams.element).setStyle({float: 'left'});\n                    $(rightCellOverflowParams.element).setStyle({float: 'right'});\n\n                    if (!leftCellOverFlowParams.isOverflowed && !rightCellOverflowParams.isOverflowed) {\n                        // If neither left nor right are overflowed, just leave as is and let them float left and right.\n                        return;\n                    }\n                    if (leftCellOverFlowParams.isOverflowed && !rightCellOverflowParams.isOverflowed) {\n                        $(leftCellOverFlowParams.element).setStyle({width: leftCellOverFlowParams.scrollWidth + 'px'});\n                        return;\n                    }\n                    if (!leftCellOverFlowParams.isOverflowed && rightCellOverflowParams.isOverflowed) {\n                        $(rightCellOverflowParams.element).setStyle({width: rightCellOverflowParams.scrollWidth + 'px'});\n                        return;\n                    }\n                }\n\n                if ((!badgesOverflowing || nameLessThanHalf) &&\n                    (nameOverflowParams.scrollWidth + controlsOverflowParams.scrollWidth <= usableRowWidth)) {\n                    // Build name and controls can go on one row (first row). Need to move build details down\n                    // to a row of its own (second row) by making it a block element, forcing it to wrap. If there\n                    // are controls, we move them up to position them after the build name by inserting before the\n                    // build details.\n                    Element.addClassName(buildDetails, \"block\");\n                    buildControls.parentNode.removeChild(buildControls);\n                    buildDetails.parentNode.insertBefore(buildControls, buildDetails);\n                    var wrap = blockWrap(buildName, buildControls);\n                    Element.addClassName(wrap, \"build-name-controls\");\n                    indentMultiline(buildDetails);\n                    nameOverflowParams = getElementOverflowParams(buildName); // recalculate\n                    expandLeftWithRight(nameOverflowParams, controlsOverflowParams);\n                    setBuildControlWidths();\n                    fitToControlsHeight(buildName);\n                } else if ((!badgesOverflowing || detailsLessThanHalf) &&\n                    (detailsOverflowParams.scrollWidth + controlsOverflowParams.scrollWidth <= usableRowWidth)) {\n                    // Build details and controls can go on one row. Need to make the\n                    // build name (first field) a block element, forcing the details and controls to wrap\n                    // onto the next row (creating a second row).\n                    Element.addClassName(buildName, \"block\");\n                    var wrap = blockWrap(buildDetails, buildControls);\n                    indentMultiline(wrap);\n                    Element.addClassName(wrap, \"build-details-controls\");\n                    $(displayName).setStyle({width: '100%'});\n                    detailsOverflowParams = getElementOverflowParams(buildDetails); // recalculate\n                    expandLeftWithRight(detailsOverflowParams, controlsOverflowParams);\n                    setBuildControlWidths();\n                    fitToControlsHeight(buildDetails);\n                } else {\n                    // No suitable combo fits on a row. All need to go on rows of their own.\n                    Element.addClassName(buildName, \"block\");\n                    Element.addClassName(buildDetails, \"block\");\n                    Element.addClassName(buildControls, \"block\");\n                    indentMultiline(buildDetails);\n                    indentMultiline(buildControls);\n                    nameOverflowParams = getElementOverflowParams(buildName); // recalculate\n                    detailsOverflowParams = getElementOverflowParams(buildDetails); // recalculate\n                    setBuildControlWidths();\n                }\n                controlsRepositioned = true;\n            } else {\n                Element.addClassName(buildName, \"block\");\n                Element.addClassName(buildDetails, \"block\");\n                indentMultiline(buildDetails);\n            }\n        }\n\n        if (buildControls && !controlsRepositioned) {\n            var buildBadge = $(buildControls).getElementsBySelector('.build-badge')[0];\n            if (buildBadge) {\n                var badgeOverflowParams = getElementOverflowParams(buildBadge);\n\n                if (badgeOverflowParams.isOverflowed) {\n                    markMultiline();\n                    indentMultiline(buildControls);\n                    Element.addClassName(buildControls, \"block\");\n                    controlsRepositioned = true;\n                    setBuildControlWidths();\n                }\n            }\n        }\n\n        if (!nameOverflowParams.isOverflowed && !detailsOverflowParams.isOverflowed && !controlsRepositioned) {\n            fitToControlsHeight(buildName);\n            fitToControlsHeight(buildDetails);\n        }\n\n        Element.addClassName(row, \"overflow-checked\");\n    }\n\n    function checkAllRowCellOverflows() {\n        if(isRunAsTest) {\n            return;\n        }\n\n        var bh = $('buildHistory');\n        var dataTable = getDataTable(bh);\n        var rows = dataTable.rows;\n\n        // Insert zero-width spaces in text that may cause overflow distortions.\n        var displayNames = $(bh).getElementsBySelector('.display-name');\n        for (var i = 0; i < displayNames.length; i++) {\n            insertZeroWidthSpacesInElementText(displayNames[i], 2);\n        }\n        var descriptions = $(bh).getElementsBySelector('.desc');\n        for (var i = 0; i < descriptions.length; i++) {\n            insertZeroWidthSpacesInElementText(descriptions[i], 30);\n        }\n\n        for (var i = 0; i < rows.length; i++) {\n            var row = rows[i];\n            checkRowCellOverflows(row);\n        }\n    }\n\n    var updateBuildsRefreshInterval = 5000;\n    function updateBuilds() {\n        if(isPageVisible()){\n            if (bh.headers == null) {\n                // Yahoo.log(\"Missing headers in buildHistory element\");\n            }\n\n            new Ajax.Request(ajaxUrl, {\n                requestHeaders: bh.headers,\n                onSuccess: function(rsp) {\n                    var dataTable = getDataTable(bh);\n                    var rows = dataTable.rows;\n\n                    //delete rows with transitive data\n                    while (rows.length > 0 && Element.hasClassName(rows[0], \"transitive\")) {\n                        Element.remove(rows[0]);\n                    }\n\n                    // insert new rows\n                    var div = document.createElement('div');\n                    div.innerHTML = rsp.responseText;\n                    Behaviour.applySubtree(div);\n\n                    var pivot = rows[0];\n                    var newRows = getDataTable(div).rows;\n                    while (newRows.length > 0) {\n                        if (pivot !== undefined) {\n                            // The data table has rows.  Insert before a \"pivot\" row (first row).\n                            pivot.parentNode.insertBefore(newRows[0], pivot);\n                        } else {\n                            // The data table has no rows.  In this case, we just add all new rows directly to the\n                            // table, one after the other i.e. we don't insert before a \"pivot\" row (first row).\n                            dataTable.appendChild(newRows[0]);\n                        }\n                    }\n\n                    // next update\n                    bh.headers = [\"n\",rsp.getResponseHeader(\"n\")];\n                    window.setTimeout(updateBuilds, updateBuildsRefreshInterval);\n\n                    checkAllRowCellOverflows();\n                }\n            });\n        } else {\n            // Reschedule again\n            window.setTimeout(updateBuilds, updateBuildsRefreshInterval);\n        }\n    }\n\n    checkAllRowCellOverflows();\n    window.setTimeout(updateBuilds, updateBuildsRefreshInterval);\n\n    onBuildHistoryChange(function() {\n        checkAllRowCellOverflows();\n    });\n}\n\nfunction getElementOverflowParams(element) {\n    // First we force it to wrap so we can get those dimension.\n    // Then we force it to \"nowrap\", so we can get those dimension.\n    // We can then compare the two sets, which will indicate if\n    // wrapping is potentially happening, or not.\n\n    // Force it to wrap.\n    Element.addClassName(element, \"force-wrap\");\n    var wrappedClientWidth = element.clientWidth;\n    var wrappedClientHeight = element.clientHeight;\n    Element.removeClassName(element, \"force-wrap\");\n\n    // Force it to nowrap. Return the comparisons.\n    Element.addClassName(element, \"force-nowrap\");\n    var nowrapClientHeight = element.clientHeight;\n    try {\n        var overflowParams = {\n            element: element,\n            clientWidth: wrappedClientWidth,\n            scrollWidth: element.scrollWidth,\n            isOverflowed: wrappedClientHeight > nowrapClientHeight\n        };\n        return  overflowParams;\n    } finally {\n        Element.removeClassName(element, \"force-nowrap\");\n    }\n}\n\nvar zeroWidthSpace = String.fromCharCode(8203);\nvar ELEMENT_NODE = 1;\nvar TEXT_NODE = 3;\nfunction insertZeroWidthSpacesInText(textNode, maxWordSize) {\n    if (textNode.textContent.length < maxWordSize) {\n        return;\n    }\n\n    // capture the original text\n    textNode.preZWSText = textNode.textContent;\n\n    var words = textNode.textContent.split(/\\s+/);\n    var newTextContent = '';\n\n    var splitRegex = new RegExp('.{1,' + maxWordSize + '}', 'g');\n    for (var i = 0; i < words.length; i++) {\n        var word = words[i];\n        var wordTokens = word.match(splitRegex);\n        if (wordTokens) {\n            for (var ii = 0; ii < wordTokens.length; ii++) {\n                if (newTextContent.length === 0) {\n                    newTextContent += wordTokens[ii];\n                } else {\n                    newTextContent += zeroWidthSpace + wordTokens[ii];\n                }\n            }\n        } else {\n            newTextContent += word;\n        }\n        newTextContent += ' ';\n    }\n\n    textNode.textContent = newTextContent;\n}\nfunction insertZeroWidthSpacesInElementText(element, maxWordSize) {\n    if (Element.hasClassName(element, 'zws-inserted')) {\n        // already done.\n        return;\n    }\n    if (!element.hasChildNodes()) {\n        return;\n    }\n\n    var children = element.childNodes;\n    for (var i = 0; i < children.length; i++) {\n        var child = children[i];\n        if (child.nodeType === TEXT_NODE) {\n            insertZeroWidthSpacesInText(child, maxWordSize);\n        } else if (child.nodeType === ELEMENT_NODE) {\n            insertZeroWidthSpacesInElementText(child, maxWordSize);\n        }\n    }\n\n    Element.addClassName(element, 'zws-inserted');\n}\nfunction removeZeroWidthSpaces(element) {\n    if (element) {\n        if (!Element.hasClassName(element, 'zws-inserted')) {\n            // Doesn't have ZWSed text.\n            return;\n        }\n        if (!element.hasChildNodes()) {\n            return;\n        }\n\n        var children = element.childNodes;\n        for (var i = 0; i < children.length; i++) {\n            var child = children[i];\n            if (child.nodeType === TEXT_NODE && child.preZWSText) {\n                child.textContent = child.preZWSText;\n            } else if (child.nodeType === ELEMENT_NODE) {\n                removeZeroWidthSpaces(child);\n            }\n        }\n\n        Element.removeClassName(element, 'zws-inserted');\n    }\n}\n\n// get the cascaded computed style value. 'a' is the style name like 'backgroundColor'\nfunction getStyle(e,a){\n  if(document.defaultView && document.defaultView.getComputedStyle)\n    return document.defaultView.getComputedStyle(e,null).getPropertyValue(a.replace(/([A-Z])/g, \"-$1\"));\n  if(e.currentStyle)\n    return e.currentStyle[a];\n  return null;\n}\n\nfunction ElementResizeTracker() {\n    this.trackedElements = [];\n\n    if(isRunAsTest) {\n        return;\n    }\n\n    var thisTracker = this;\n    function checkForResize() {\n        for (var i = 0; i < thisTracker.trackedElements.length; i++) {\n            var element = thisTracker.trackedElements[i];\n            var currDims = Element.getDimensions(element);\n            var lastDims = element.lastDimensions;\n            if (currDims.width !== lastDims.width || currDims.height !== lastDims.height) {\n                Event.fire(element, 'jenkins:resize');\n            }\n            element.lastDimensions = currDims;\n        }\n    }\n    Event.observe(window, 'jenkins:resizeCheck', checkForResize);\n\n    function checkForResizeLoop() {\n        checkForResize();\n        setTimeout(checkForResizeLoop, 200);\n    }\n    checkForResizeLoop();\n}\nElementResizeTracker.prototype.addElement = function(element) {\n    for (var i = 0; i < this.trackedElements.length; i++) {\n        if (this.trackedElements[i] === element) {\n            // we're already tracking it so no need to add it.\n            return;\n        }\n    }\n    this.trackedElements.push(element);\n}\nElementResizeTracker.prototype.onResize = function(element, handler) {\n    element.lastDimensions = Element.getDimensions(element);\n    Event.observe(element, 'jenkins:resize', handler);\n    this.addElement(element);\n}\nElementResizeTracker.fireResizeCheck = function() {\n    Event.fire(window, 'jenkins:resizeCheck');\n}\nvar elementResizeTracker = new ElementResizeTracker();\n\n/**\n * Makes sure the given element is within the viewport.\n *\n * @param {HTMLElement} e\n *      The element to bring into the viewport.\n */\nfunction ensureVisible(e) {\n    var viewport = YAHOO.util.Dom.getClientRegion();\n    var pos      = YAHOO.util.Dom.getRegion(e);\n\n    var Y = viewport.top;\n    var H = viewport.height;\n\n    function handleStickers(name,f) {\n        var e = $(name);\n        if (e) f(e);\n        document.getElementsBySelector(\".\"+name).each(f);\n    }\n\n    // if there are any stickers around, subtract them from the viewport\n    handleStickers(\"top-sticker\",function (t) {\n        t = t.clientHeight;\n        Y+=t; H-=t;\n    });\n\n    handleStickers(\"bottom-sticker\",function (b) {\n        b = b.clientHeight;\n        H-=b;\n    });\n\n    var y = pos.top;\n    var h = pos.height;\n\n    var d = (y+h)-(Y+H);\n    if (d>0) {\n        document.body.scrollTop += d;\n    } else {\n        var d = Y-y;\n        if (d>0)    document.body.scrollTop -= d;\n    }\n}\n\n// set up logic behind the search box\nfunction createSearchBox(searchURL) {\n    var ds = new YAHOO.util.XHRDataSource(searchURL+\"suggest\");\n    ds.responseType = YAHOO.util.XHRDataSource.TYPE_JSON;\n    ds.responseSchema = {\n        resultsList: \"suggestions\",\n        fields: [\"name\"]\n    };\n    var ac = new YAHOO.widget.AutoComplete(\"search-box\",\"search-box-completion\",ds);\n    ac.typeAhead = false;\n    ac.autoHighlight = false;\n    ac.formatResult = ac.formatEscapedResult;\n\n    var box   = $(\"search-box\");\n    var sizer = $(\"search-box-sizer\");\n    var comp  = $(\"search-box-completion\");\n    var minW  = $(\"search-box-minWidth\");\n\n    Behaviour.addLoadEvent(function(){\n        // make sure all three components have the same font settings\n        function copyFontStyle(s,d) {\n            var ds = d.style;\n            ds.fontFamily = getStyle(s,\"fontFamily\");\n            ds.fontSize = getStyle(s,\"fontSize\");\n            ds.fontStyle = getStyle(s,\"fontStyle\");\n            ds.fontWeight = getStyle(s,\"fontWeight\");\n        }\n\n        copyFontStyle(box,sizer);\n        copyFontStyle(box,minW);\n    });\n\n    // update positions and sizes of the components relevant to search\n    function updatePos() {\n        function max(a,b) { if(a>b) return a; else return b; }\n\n        sizer.innerHTML = box.value.escapeHTML();\n        var w = max(sizer.offsetWidth,minW.offsetWidth);\n        box.style.width =\n        comp.style.width = \n        comp.firstChild.style.width = (w+60)+\"px\";\n\n        var pos = YAHOO.util.Dom.getXY(box);\n        pos[1] += YAHOO.util.Dom.get(box).offsetHeight + 2;\n        YAHOO.util.Dom.setXY(comp, pos);\n    }\n\n    updatePos();\n    box.onkeyup = updatePos;\n}\n\n\n/**\n * Finds the DOM node of the given DOM node that acts as a parent in the form submission.\n *\n * @param {HTMLElement} e\n *      The node whose parent we are looking for.\n * @param {HTMLFormElement} form\n *      The form element that owns 'e'. Passed in as a performance improvement. Can be null.\n * @return null\n *      if the given element shouldn't be a part of the final submission.\n */\nfunction findFormParent(e,form,isStatic) {\n    isStatic = isStatic || false;\n\n    if (form==null) // caller can pass in null to have this method compute the owning form\n        form = findAncestor(e,\"FORM\");\n\n    while(e!=form) {\n        // this is used to create a group where no single containing parent node exists,\n        // like <optionalBlock>\n        var nameRef = e.getAttribute(\"nameRef\");\n        if(nameRef!=null)\n            e = $(nameRef);\n        else\n            e = e.parentNode;\n\n        if(!isStatic && e.getAttribute(\"field-disabled\")!=null)\n            return null;  // this field shouldn't contribute to the final result\n\n        var name = e.getAttribute(\"name\");\n        if(name!=null && name.length>0) {\n            if(e.tagName==\"INPUT\" && !isStatic && !xor(e.checked,Element.hasClassName(e,\"negative\")))\n                return null;  // field is not active\n\n            return e;\n        }\n    }\n\n    return form;\n}\n\n// compute the form field name from the control name\nfunction shortenName(name) {\n    // [abc.def.ghi] -> abc.def.ghi\n    if(name.startsWith('['))\n        return name.substring(1,name.length-1);\n\n    // abc.def.ghi -> ghi\n    var idx = name.lastIndexOf('.');\n    if(idx>=0)  name = name.substring(idx+1);\n    return name;\n}\n\n\n\n//\n// structured form submission handling\n//   see http://wiki.jenkins-ci.org/display/JENKINS/Structured+Form+Submission\nfunction buildFormTree(form) {\n    try {\n        // I initially tried to use an associative array with DOM elements as keys\n        // but that doesn't seem to work neither on IE nor Firefox.\n        // so I switch back to adding a dynamic property on DOM.\n        form.formDom = {}; // root object\n\n        var doms = []; // DOMs that we added 'formDom' for.\n        doms.push(form);\n\n        function addProperty(parent,name,value) {\n            name = shortenName(name);\n            if(parent[name]!=null) {\n                if(parent[name].push==null) // is this array?\n                    parent[name] = [ parent[name] ];\n                parent[name].push(value);\n            } else {\n                parent[name] = value;\n            }\n        }\n\n        // find the grouping parent node, which will have @name.\n        // then return the corresponding object in the map\n        function findParent(e) {\n            var p = findFormParent(e,form);\n            if (p==null)    return {};\n\n            var m = p.formDom;\n            if(m==null) {\n                // this is a new grouping node\n                doms.push(p);\n                p.formDom = m = {};\n                addProperty(findParent(p), p.getAttribute(\"name\"), m);\n            }\n            return m;\n        }\n\n        var jsonElement = null;\n\n        for( var i=0; i<form.elements.length; i++ ) {\n            var e = form.elements[i];\n            if(e.name==\"json\") {\n                jsonElement = e;\n                continue;\n            }\n            if(e.tagName==\"FIELDSET\")\n                continue;\n            if(e.tagName==\"SELECT\" && e.multiple) {\n                var values = [];\n                for( var o=0; o<e.options.length; o++ ) {\n                    var opt = e.options.item(o);\n                    if(opt.selected)\n                        values.push(opt.value);\n                }\n                addProperty(findParent(e),e.name,values);\n                continue;\n            }\n                \n            var p;\n            var r;\n            var type = e.getAttribute(\"type\");\n            if(type==null)  type=\"\";\n            switch(type.toLowerCase()) {\n            case \"button\":\n            case \"submit\":\n                break;\n            case \"checkbox\":\n                p = findParent(e);\n                var checked = xor(e.checked,Element.hasClassName(e,\"negative\"));\n                if(!e.groupingNode) {\n                    v = e.getAttribute(\"json\");\n                    if (v) {\n                        // if the special attribute is present, we'll either set the value or not. useful for an array of checkboxes\n                        // we can't use @value because IE6 sets the value to be \"on\" if it's left unspecified.\n                        if (checked)\n                            addProperty(p, e.name, v);\n                    } else {// otherwise it'll bind to boolean\n                        addProperty(p, e.name, checked);\n                    }\n                } else {\n                    if(checked)\n                        addProperty(p, e.name, e.formDom = {});\n                }\n                break;\n            case \"file\":\n                // to support structured form submission with file uploads,\n                // rename form field names to unique ones, and leave this name mapping information\n                // in JSON. this behavior is backward incompatible, so only do\n                // this when\n                p = findParent(e);\n                if(e.getAttribute(\"jsonAware\")!=null) {\n                    var on = e.getAttribute(\"originalName\");\n                    if(on!=null) {\n                        addProperty(p,on,e.name);\n                    } else {\n                        var uniqName = \"file\"+(iota++);\n                        addProperty(p,e.name,uniqName);\n                        e.setAttribute(\"originalName\",e.name);\n                        e.name = uniqName;\n                    }\n                }\n                // switch to multipart/form-data to support file submission\n                // @enctype is the standard, but IE needs @encoding.\n                form.enctype = form.encoding = \"multipart/form-data\";\n                crumb.appendToForm(form);\n                break;\n            case \"radio\":\n                if(!e.checked)  break;\n                r=0;\n                while (e.name.substring(r,r+8)=='removeme')\n                    r = e.name.indexOf('_',r+8)+1;\n                p = findParent(e);\n                if(e.groupingNode) {\n                    addProperty(p, e.name.substring(r), e.formDom = { value: e.value });\n                } else {\n                    addProperty(p, e.name.substring(r), e.value);\n                }\n                break;\n\n            default:\n                p = findParent(e);\n                addProperty(p, e.name, e.value);\n                break;\n            }\n        }\n\n        jsonElement.value = Object.toJSON(form.formDom);\n\n        // clean up\n        for( i=0; i<doms.length; i++ )\n            doms[i].formDom = null;\n\n        return true;\n    } catch(e) {\n        alert(e+'\\n(form not submitted)');\n        return false;\n    }\n}\n\n/**\n * @param {boolean} toggle\n *      When true, will check all checkboxes in the page. When false, unchecks them all.\n */\nvar toggleCheckboxes = function(toggle) {\n    var inputs = document.getElementsByTagName(\"input\");\n    for(var i=0; i<inputs.length; i++) {\n        if(inputs[i].type === \"checkbox\") {\n            inputs[i].checked = toggle;\n        }\n    }\n};\n\n// this used to be in prototype.js but it must have been removed somewhere between 1.4.0 to 1.5.1\nString.prototype.trim = function() {\n    var temp = this;\n    var obj = /^(\\s*)([\\W\\w]*)(\\b\\s*$)/;\n    if (obj.test(temp))\n        temp = temp.replace(obj, '$2');\n    obj = /  /g;\n    while (temp.match(obj))\n        temp = temp.replace(obj, \" \");\n    return temp;\n}\n\n\n\nvar hoverNotification = (function() {\n    var msgBox;\n    var body;\n\n    // animation effect that automatically hide the message box\n    var effect = function(overlay, dur) {\n        var o = YAHOO.widget.ContainerEffect.FADE(overlay, dur);\n        o.animateInCompleteEvent.subscribe(function() {\n            window.setTimeout(function() {\n                msgBox.hide()\n            }, 1500);\n        });\n        return o;\n    }\n\n    function init() {\n        if(msgBox!=null)  return;   // already initialized\n\n        var div = document.createElement(\"DIV\");\n        document.body.appendChild(div);\n        div.innerHTML = \"<div id=hoverNotification><div class=bd></div></div>\";\n        body = $('hoverNotification');\n        \n        msgBox = new YAHOO.widget.Overlay(body, {\n          visible:false,\n          width:\"10em\",\n          zIndex:1000,\n          effect:{\n            effect:effect,\n            duration:0.25\n          }\n        });\n        msgBox.render();\n    }\n\n    return function(title, anchor, offset) {\n        if (typeof offset === 'undefined') {\n            offset = 48;\n        }\n        init();\n        body.innerHTML = title;\n        var xy = YAHOO.util.Dom.getXY(anchor);\n        xy[0] += offset;\n        xy[1] += anchor.offsetHeight;\n        msgBox.cfg.setProperty(\"xy\",xy);\n        msgBox.show();\n    };\n})();\n\n/**\n * Loads the script specified by the URL.\n *\n * @param href\n *      The URL of the script to load.\n * @param callback\n *      If specified, this function will be invoked after the script is loaded.\n * @see http://stackoverflow.com/questions/4845762/onload-handler-for-script-tag-in-internet-explorer\n */\nfunction loadScript(href,callback) {\n    var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\n    var script = document.createElement(\"script\");\n    script.src = href;\n\n    if (callback) {\n        // Handle Script loading\n        var done = false;\n\n        // Attach handlers for all browsers\n        script.onload = script.onreadystatechange = function() {\n            if ( !done && (!this.readyState ||\n                    this.readyState === \"loaded\" || this.readyState === \"complete\") ) {\n                done = true;\n                callback();\n\n                // Handle memory leak in IE\n                script.onload = script.onreadystatechange = null;\n                if ( head && script.parentNode ) {\n                    head.removeChild( script );\n                }\n            }\n        };\n    }\n\n    // Use insertBefore instead of appendChild  to circumvent an IE6 bug.\n    // This arises when a base node is used (#2709 and #4378).\n    head.insertBefore( script, head.firstChild );\n}\n\n/**\n * Loads a dynamically created invisible IFRAME.\n */\nfunction createIframe(src,callback) {\n    var iframe = document.createElement(\"iframe\");\n    iframe.src = src;\n    iframe.style.display = \"none\";\n\n    var done = false;\n    iframe.onload = iframe.onreadystatechange = function() {\n        if ( !done && (!this.readyState ||\n                this.readyState === \"loaded\" || this.readyState === \"complete\") ) {\n            done = true;\n            callback();\n        }\n    };\n\n    document.body.appendChild(iframe);\n    return iframe;\n}\n\nvar downloadService = {\n    continuations: {},\n\n    download : function(id,url,info, postBack,completionHandler) {\n        var tag = {id:id,postBack:postBack,completionHandler:completionHandler,received:false};\n        this.continuations[id] = tag;\n\n        // use JSONP to download the data\n        function fallback() {\n            loadScript(url+\"?id=\"+id+'&'+Hash.toQueryString(info));\n        }\n\n        if (window.postMessage) {\n            // try downloading the postMessage version of the data,\n            // if we don't receive postMessage (which probably means the server isn't ready with these new datasets),\n            // fallback to JSONP\n            tag.iframe = createIframe(url+\".html?id=\"+id+'&'+Hash.toQueryString(info),function() {\n                window.setTimeout(function() {\n                    if (!tag.received)\n                        fallback();\n                },100); // bit of delay in case onload on our side fires first\n            });\n        } else {\n            // this browser doesn't support postMessage\n            fallback();\n        }\n\n        // NOTE:\n        //   the only reason we even try fallback() is in case our server accepts the submission without a signature\n        //   (which it really shouldn't)\n    },\n\n    /**\n     * Call back to postMessage\n     */\n    receiveMessage : function(ev) {\n        var self = this;\n        Object.values(this.continuations).each(function(tag) {\n            if (tag.iframe.contentWindow==ev.source) {\n                self.post(tag.id,JSON.parse(ev.data));\n            }\n        })\n    },\n\n    post : function(id,data) {\n        if (data==undefined) {\n            // default to id in data\n            data = id;\n            id = data.id;\n        }\n        var tag = this.continuations[id];\n        if (tag==undefined) {\n            console.log(\"Submission from update center that we don't know: \"+id);\n            console.log(\"Likely mismatch between the registered ID vs ID in JSON\");\n            return;\n        }\n        tag.received = true;\n\n        // send the payload back in the body. We used to send this in as a form submission, but that hits the form size check in Jetty.\n        new Ajax.Request(tag.postBack, {\n            contentType:\"application/json\",\n            encoding:\"UTF-8\",\n            postBody:Object.toJSON(data),\n            onSuccess: function() {\n                if(tag.completionHandler!=null)\n                    tag.completionHandler();\n                else if(downloadService.completionHandler!=null)\n                    downloadService.completionHandler();\n            }\n        });\n    }\n};\n\n// update center service. to remain compatible with earlier version of Jenkins, aliased.\nvar updateCenter = downloadService;\n\nYAHOO.util.Event.addListener(window, \"message\", function(ev) { downloadService.receiveMessage(ev); })\n\n/*\nredirects to a page once the page is ready.\n\n    @param url\n        Specifies the URL to redirect the user.\n*/\nfunction applySafeRedirector(url) {\n    var i=0;\n    new PeriodicalExecuter(function() {\n      i = (i+1)%4;\n      var s = \"\";\n      var j=0;\n      for( j=0; j<i; j++ )\n        s+='.';\n      // put the rest of dots as hidden so that the layout doesn't change\n      // depending on the # of dots.\n      s+=\"<span style='visibility:hidden'>\";\n      for( ; j<4; j++ )\n        s+='.';\n      s+=\"</span>\";\n      $('progress').innerHTML = s;\n    },1);\n\n    window.setTimeout(function() {\n      var statusChecker = arguments.callee;\n        new Ajax.Request(url, {\n            method: \"get\",\n            onFailure: function(rsp) {\n                if(rsp.status==503 && rsp.getHeader(\"X-Jenkins-Interactive\")==null) {\n                  // redirect as long as we are still loading\n                  window.setTimeout(statusChecker,5000);\n                } else {\n                  window.location.replace(url);\n                }\n            },\n            onSuccess: function(rsp) {\n                if(rsp.status!=200) {\n                    // if connection fails, somehow Prototype thinks it's a success\n                    window.setTimeout(statusChecker,5000);\n                } else {\n                    window.location.replace(url);\n                }\n            }\n        });\n    }, 5000);\n}\n\n// logic behind <f:validateButton />\nfunction validateButton(checkUrl,paramList,button) {\n  button = button._button;\n\n  var parameters = {};\n\n  paramList.split(',').each(function(name) {\n      var p = findPreviousFormItem(button,name);\n      if(p!=null) {\n        if(p.type==\"checkbox\")  parameters[name] = p.checked;\n        else                    parameters[name] = p.value;\n      }\n  });\n\n  var spinner = $(button).up(\"DIV\").next();\n  var target = spinner.next();\n  spinner.style.display=\"block\";\n\n  new Ajax.Request(checkUrl, {\n      parameters: parameters,\n      onComplete: function(rsp) {\n          spinner.style.display=\"none\";\n          applyErrorMessage(target, rsp);\n          layoutUpdateCallback.call();\n          var s = rsp.getResponseHeader(\"script\");\n          try {\n              geval(s);\n          } catch(e) {\n              window.alert(\"failed to evaluate \"+s+\"\\n\"+e.message);\n          }\n      }\n  });\n}\n\nfunction applyErrorMessage(elt, rsp) {\n    if (rsp.status == 200) {\n        elt.innerHTML = rsp.responseText;\n    } else {\n        var id = 'valerr' + (iota++);\n        elt.innerHTML = '<a href=\"\" onclick=\"document.getElementById(\\'' + id\n        + '\\').style.display=\\'block\\';return false\">ERROR</a><div id=\"'\n        + id + '\" style=\"display:none\">' + rsp.responseText + '</div>';\n        var error = document.getElementById('error-description'); // cf. oops.jelly\n        if (error) {\n            var div = document.getElementById(id);\n            while (div.firstChild) {\n                div.removeChild(div.firstChild);\n            }\n            div.appendChild(error);\n        }\n    }\n    Behaviour.applySubtree(elt);\n}\n\n// create a combobox.\n// @param idOrField\n//      ID of the <input type=text> element that becomes a combobox, or the field itself.\n//      Passing an ID is @deprecated since 1.350; use <input class=\"combobox\"/> instead.\n// @param valueFunction\n//      Function that returns all the candidates as an array\nfunction createComboBox(idOrField,valueFunction) {\n    var candidates = valueFunction();\n    var creator = function() {\n        if (typeof idOrField == \"string\")\n          idOrField = document.getElementById(idOrField);\n        if (!idOrField) return;\n        new ComboBox(idOrField, function(value /*, comboBox*/) {\n          var items = new Array();\n          if (value.length > 0) { // if no value, we'll not provide anything\n            value = value.toLowerCase();\n            for (var i = 0; i<candidates.length; i++) {\n              if (candidates[i].toLowerCase().indexOf(value) >= 0) {\n                items.push(candidates[i]);\n                if(items.length>20)\n                  break; // 20 items in the list should be enough\n              }\n            }\n          }\n          return items; // equiv to: comboBox.setItems(items);\n        });\n    };\n    // If an ID given, create when page has loaded (backward compatibility); otherwise now.\n    if (typeof idOrField == \"string\") Behaviour.addLoadEvent(creator); else creator();\n}\n\n\n// Exception in code during the AJAX processing should be reported,\n// so that our users can find them more easily.\nAjax.Request.prototype.dispatchException = function(e) {\n    throw e;\n}\n\n// event callback when layouts/visibility are updated and elements might have moved around\nvar layoutUpdateCallback = {\n    callbacks : [],\n    add : function (f) {\n        this.callbacks.push(f);\n    },\n    call : function() {\n        for (var i = 0, length = this.callbacks.length; i < length; i++)\n            this.callbacks[i]();\n    }\n}\n\n// Notification bar\n// ==============================\n// this control displays a single line message at the top of the page, like StackOverflow does\n// see ui-samples for more details\nvar notificationBar = {\n    OPACITY : 0.8,\n    DELAY : 3000,   // milliseconds to auto-close the notification\n    div : null,     // the main 'notification-bar' DIV\n    token : null,   // timer for cancelling auto-close\n\n    OK : {// standard option values for typical OK notification\n        icon: \"accept.png\",\n        backgroundColor: \"#8ae234\"\n    },\n    WARNING : {// likewise, for warning\n        icon: \"yellow.png\",\n        backgroundColor: \"#fce94f\"\n    },\n    ERROR : {// likewise, for error\n        icon: \"red.png\",\n        backgroundColor: \"#ef2929\",\n        sticky: true\n    },\n\n    init : function() {\n        if (this.div==null) {\n            this.div = document.createElement(\"div\");\n            YAHOO.util.Dom.setStyle(this.div,\"opacity\",0);\n            this.div.id=\"notification-bar\";\n            this.div.style.backgroundColor=\"#fff\";\n            document.body.insertBefore(this.div, document.body.firstChild);\n\n            var self = this;\n            this.div.onclick = function() {\n                self.hide();\n            };\n        }\n    },\n    // cancel pending auto-hide timeout\n    clearTimeout : function() {\n        if (this.token)\n            window.clearTimeout(this.token);\n        this.token = null;\n    },\n    // hide the current notification bar, if it's displayed\n    hide : function () {\n        this.clearTimeout();\n        var self = this;\n        var out = new YAHOO.util.ColorAnim(this.div, {\n            opacity: { to:0 },\n            backgroundColor: {to:\"#fff\"}\n        }, 0.3, YAHOO.util.Easing.easeIn);\n        out.onComplete.subscribe(function() {\n            self.div.style.display = \"none\";\n        })\n        out.animate();\n    },\n    // show a notification bar\n    show : function (text,options) {\n        options = options || {}\n\n        this.init();\n        this.div.style.height = this.div.style.lineHeight = options.height || \"40px\";\n        this.div.style.display = \"block\";\n\n        if (options.icon)\n            text = \"<img src='\"+rootURL+\"/images/24x24/\"+options.icon+\"'> \"+text;\n        this.div.innerHTML = text;\n\n        new YAHOO.util.ColorAnim(this.div, {\n            opacity: { to:this.OPACITY },\n            backgroundColor : { to: options.backgroundColor || \"#fff\" }\n        }, 1, YAHOO.util.Easing.easeOut).animate();\n\n        this.clearTimeout();\n        var self = this;\n        if (!options.sticky)\n            this.token = window.setTimeout(function(){self.hide();},this.DELAY);\n    }\n};\n"], "filenames": ["war/src/main/webapp/scripts/hudson-behavior.js"], "buggy_code_start_loc": [2170], "buggy_code_end_loc": [2170], "fixing_code_start_loc": [2171], "fixing_code_end_loc": [2172], "type": "CWE-79", "message": "jenkins before versions 2.44, 2.32.2 is vulnerable to a persisted cross-site scripting in search suggestions due to improperly escaping users with less-than and greater-than characters in their names (SECURITY-388).", "other": {"cve": {"id": "CVE-2017-2610", "sourceIdentifier": "secalert@redhat.com", "published": "2018-05-15T21:29:00.400", "lastModified": "2019-10-09T23:26:56.053", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "jenkins before versions 2.44, 2.32.2 is vulnerable to a persisted cross-site scripting in search suggestions due to improperly escaping users with less-than and greater-than characters in their names (SECURITY-388)."}, {"lang": "es", "value": "Jenkins en versiones anteriores a la 2.44 y 2.32.2 es vulnerable a Cross-Site Scripting (XSS) persistente en las sugerencias de b\u00fasqueda debido al escapado incorrecto de usuarios con los caracteres \"menor que\" y \"mayor que\" en sus nombres (SECURITY-388)."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}, {"source": "secalert@redhat.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "secalert@redhat.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:jenkins:jenkins:*:*:*:*:lts:*:*:*", "versionEndExcluding": "2.32.2", "matchCriteriaId": "F1F48E96-6C2B-4773-98A4-BFF626A0811F"}, {"vulnerable": true, "criteria": "cpe:2.3:a:jenkins:jenkins:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.44", "matchCriteriaId": "D4595374-F7F2-43D5-BB78-37E8377B1E45"}]}]}], "references": [{"url": "http://www.securityfocus.com/bid/95951", "source": "secalert@redhat.com", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2017-2610", "source": "secalert@redhat.com", "tags": ["Issue Tracking"]}, {"url": "https://github.com/jenkinsci/jenkins/commit/307ed31caba68a46426b8c73a787a05add2c7489", "source": "secalert@redhat.com", "tags": ["Patch"]}, {"url": "https://jenkins.io/security/advisory/2017-02-01/", "source": "secalert@redhat.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/jenkinsci/jenkins/commit/307ed31caba68a46426b8c73a787a05add2c7489"}}