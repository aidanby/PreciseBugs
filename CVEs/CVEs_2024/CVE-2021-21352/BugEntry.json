{"buggy_code": ["<script>\n  function chLocation(newLocation) { document.location = newLocation; }\n</script>\n\n{$forms.reportViewForm.open}\n<table width=\"720\">\n  <td valign=\"top\">\n    <table border=\"0\" cellpadding=\"3\" cellspacing=\"1\" width=\"100%\">\n      <tr>\n        <td valign=\"top\" class=\"sectionHeaderNoBorder\" align=\"center\">{$i18n.form.report.export} {if file_exists('WEB-INF/lib/tcpdf')}<a href=\"topdf.php\">PDF</a>,{/if} <a href=\"tofile.php?type=xml\">XML</a> {$i18n.label.or} <a href=\"tofile.php?type=csv\">CSV</a></td>\n      </tr>\n    </table>\n    <table border=\"0\" cellpadding=\"3\" cellspacing=\"1\" width=\"100%\">\n<!-- totals only report -->\n{if $bean->getAttribute('chtotalsonly')}\n      <tr>\n        <td class=\"tableHeader\">{$group_by_header|escape}</td>\n        {if $bean->getAttribute('chduration')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.duration}</td>{/if}\n        {if $bean->getAttribute('chunits')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.work_units_short}</td>{/if}\n        {if $bean->getAttribute('chcost')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.cost}</td>{/if}\n      </tr>\n  {foreach $subtotals as $subtotal}\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{if $subtotal['name']}{$subtotal['name']|escape}{else}&nbsp;{/if}</td>\n        {if $bean->getAttribute('chduration')}<td class=\"cellRightAlignedSubtotal\">{$subtotal['time']}</td>{/if}\n        {if $bean->getAttribute('chunits')}<td class=\"cellRightAlignedSubtotal\">{$subtotal['units']}</td>{/if}\n        {if $bean->getAttribute('chcost')}<td class=\"cellRightAlignedSubtotal\">{if $user->can('manage_invoices') || $user->isClient()}{$subtotal['cost']}{else}{$subtotal['expenses']}{/if}</td>{/if}\n      </tr>\n  {/foreach}\n      <!-- print totals -->\n      <tr><td>&nbsp;</td></tr>\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{$i18n.label.total}</td>\n        {if $bean->getAttribute('chduration')}<td nowrap class=\"cellRightAlignedSubtotal\">{$totals['time']}</td>{/if}\n        {if $bean->getAttribute('chunits')}<td nowrap class=\"cellRightAlignedSubtotal\">{$totals['units']}</td>{/if}\n        {if $bean->getAttribute('chcost')}<td nowrap class=\"cellRightAlignedSubtotal\">{$user->currency|escape} {if $user->can('manage_invoices') || $user->isClient()}{$totals['cost']}{else}{$totals['expenses']}{/if}</td>{/if}\n      </tr>\n{else}\n<!-- normal report -->\n      <tr>\n        <td class=\"tableHeader\">{$i18n.label.date}</td>\n  {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td class=\"tableHeader\">{$i18n.label.user}</td>{/if}\n\n  {* user custom fileds *}\n  {if $custom_fields && $custom_fields->userFields}\n    {foreach $custom_fields->userFields as $userField}\n      {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n      {if $bean->getAttribute($checkbox_control_name)}<td class=\"tableHeader\">{{$userField['label']|escape}}</td>{/if}\n    {/foreach}\n  {/if}\n\n  {if $bean->getAttribute('chclient')}<td class=\"tableHeader\">{$i18n.label.client}</td>{/if}\n  {if $bean->getAttribute('chproject')}<td class=\"tableHeader\">{$i18n.label.project}</td>{/if}\n  {if $bean->getAttribute('chtask')}<td class=\"tableHeader\">{$i18n.label.task}</td>{/if}\n\n  {* time custom fileds *}\n  {if $custom_fields && $custom_fields->timeFields}\n    {foreach $custom_fields->timeFields as $timeField}\n      {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n      {if $bean->getAttribute($checkbox_control_name)}<td class=\"tableHeader\">{{$timeField['label']|escape}}</td>{/if}\n    {/foreach}\n  {/if}\n\n  {if $bean->getAttribute('chstart')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.start}</td>{/if}\n  {if $bean->getAttribute('chfinish')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.finish}</td>{/if}\n  {if $bean->getAttribute('chduration')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.duration}</td>{/if}\n  {if $bean->getAttribute('chunits')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.work_units_short}</td>{/if}\n  {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td class=\"tableHeader\">{$i18n.label.note}</td>{/if}\n  {if $bean->getAttribute('chcost')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.cost}</td>{/if}\n  {if $bean->getAttribute('chapproved')}<td class=\"tableHeader\">{$i18n.label.approved}</td>{/if}\n  {if $bean->getAttribute('chpaid')}<td class=\"tableHeader\">{$i18n.label.paid}</td>{/if}\n  {if $bean->getAttribute('chip')}<td class=\"tableHeaderCentered\">{$i18n.label.ip}</td>{/if}\n  {if $bean->getAttribute('chinvoice')}<td class=\"tableHeader\">{$i18n.label.invoice}</td>{/if}\n  {if $bean->getAttribute('chtimesheet')}<td class=\"tableHeader\">{$i18n.label.timesheet}</td>{/if}\n  {if $bean->getAttribute('chfiles')}<td></td>{/if}\n      </tr>\n  {foreach $report_items as $item}\n    <!-- print subtotal for a block of grouped values -->\n    {$cur_date = $item.date}\n    {if $print_subtotals}\n      {$cur_grouped_by = $item.grouped_by}\n      {if $cur_grouped_by != $prev_grouped_by && !$first_pass}\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{$i18n.label.subtotal}\n        {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$prev_grouped_by]['user']|escape}</td>{/if}\n\n        {* user custom fileds *}\n        {if $custom_fields && $custom_fields->userFields}\n          {foreach $custom_fields->userFields as $userField}\n            {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n            {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n          {/foreach}\n        {/if}\n\n        {if $bean->getAttribute('chclient')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$prev_grouped_by]['client']|escape}</td>{/if}\n        {if $bean->getAttribute('chproject')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$prev_grouped_by]['project']|escape}</td>{/if}\n        {if $bean->getAttribute('chtask')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$prev_grouped_by]['task']|escape}</td>{/if}\n\n        {* time custom fileds *}\n          {if $custom_fields && $custom_fields->timeFields}\n           {foreach $custom_fields->timeFields as $timeField}\n            {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n            {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n          {/foreach}\n        {/if}\n\n        {if $bean->getAttribute('chstart')}<td></td>{/if}\n        {if $bean->getAttribute('chfinish')}<td></td>{/if}\n        {if $bean->getAttribute('chduration')}<td class=\"cellRightAlignedSubtotal\">{$subtotals[$prev_grouped_by]['time']}</td>{/if}\n        {if $bean->getAttribute('chunits')}<td class=\"cellRightAlignedSubtotal\">{$subtotals[$prev_grouped_by]['units']}</td>{/if}\n        {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td></td>{/if}\n        {if $bean->getAttribute('chcost')}<td class=\"cellRightAlignedSubtotal\">{if $user->can('manage_invoices') || $user->isClient()}{$subtotals[$prev_grouped_by]['cost']}{else}{$subtotals[$prev_grouped_by]['expenses']}{/if}</td>{/if}\n        {if $bean->getAttribute('chapproved')}<td></td>{/if}\n        {if $bean->getAttribute('chpaid')}<td></td>{/if}\n        {if $bean->getAttribute('chip')}<td></td>{/if}\n        {if $bean->getAttribute('chinvoice')}<td></td>{/if}\n        {if $bean->getAttribute('chtimesheet')}<td></td>{/if}\n        {if $bean->getAttribute('chfiles')}<td></td>{/if}\n        {if $use_checkboxes}<td></td>{/if}\n      </tr>\n      <tr><td>&nbsp;</td></tr>\n      {/if}\n    {$first_pass = false}\n    {/if}\n      <!--  print regular row --> \n      {if $cur_date != $prev_date}\n        {if $report_row_class == 'rowReportItem'} {$report_row_class = 'rowReportItemAlt'} {else} {$report_row_class = 'rowReportItem'} {/if}\n      {/if}\n      <tr class=\"{$report_row_class}\">\n        <td class=\"cellLeftAligned\">{$item.date}</td>\n    {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td class=\"cellLeftAligned\">{$item.user|escape}</td>{/if}\n\n    {* user custom fileds *}\n    {if $custom_fields && $custom_fields->userFields}\n      {foreach $custom_fields->userFields as $userField}\n        {assign var=\"control_name\" value='user_field_'|cat:$userField['id']}\n        {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td>{$item.$control_name|escape}</td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chclient')}<td class=\"cellLeftAligned\">{$item.client|escape}</td>{/if}\n    {if $bean->getAttribute('chproject')}<td class=\"cellLeftAligned\">{$item.project|escape}</td>{/if}\n    {if $bean->getAttribute('chtask')}<td class=\"cellLeftAligned\">{$item.task|escape}</td>{/if}\n\n    {* time custom fileds *}\n    {if $custom_fields && $custom_fields->timeFields}\n      {foreach $custom_fields->timeFields as $timeField}\n        {assign var=\"control_name\" value='time_field_'|cat:$timeField['id']}\n        {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td>{$item.$control_name|escape}</td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chstart')}<td nowrap class=\"cellRightAligned\">{$item.start}</td>{/if}\n    {if $bean->getAttribute('chfinish')}<td nowrap class=\"cellRightAligned\">{$item.finish}</td>{/if}\n    {if $bean->getAttribute('chduration')}<td class=\"cellRightAligned\">{$item.duration}</td>{/if}\n    {if $bean->getAttribute('chunits')}<td class=\"cellRightAligned\">{$item.units}</td>{/if}\n    {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td class=\"cellLeftAligned\">{$item.note|escape}</td>{/if}\n    {if $bean->getAttribute('chcost')}<td class=\"cellRightAligned\">{if $user->can('manage_invoices') || $user->isClient()}{$item.cost}{else}{$item.expense}{/if}</td>{/if}\n    {if $bean->getAttribute('chapproved')}<td class=\"cellRightAligned\">{if $item.approved == 1}{$i18n.label.yes}{else}{$i18n.label.no}{/if}</td>{/if}\n    {if $bean->getAttribute('chpaid')}<td class=\"cellRightAligned\">{if $item.paid == 1}{$i18n.label.yes}{else}{$i18n.label.no}{/if}</td>{/if}\n    {if $bean->getAttribute('chip')}<td class=\"cellRightAligned\">{if $item.modified}{$item.modified_ip} {$item.modified}{else}{$item.created_ip} {$item.created}{/if}</td>{/if}\n    {if $bean->getAttribute('chinvoice')}<td class=\"cellRightAligned\">{$item.invoice|escape}</td>{/if}\n    {if $bean->getAttribute('chtimesheet')}<td class=\"cellRightAligned\">{$item.timesheet_name|escape}</td>{/if}\n    {if $bean->getAttribute('chfiles')}\n      {if 1 == $item.type}<td class=\"cellRightAligned\">{if $item.has_files}<a href=\"time_files.php?id={$item.id}\"><img class=\"table_icon\" alt=\"{$i18n.label.files}\" src=\"img/icon-files.png\"></a>{/if}</td>{/if}\n      {if 2 == $item.type}<td class=\"cellRightAligned\">{if $item.has_files}<a href=\"expense_files.php?id={$item.id}\"><img class=\"table_icon\" alt=\"{$i18n.label.files}\" src=\"img/icon-files.png\"></a>{/if}</td>{/if}\n    {/if}\n    {if $use_checkboxes}\n      {if 1 == $item.type}<td bgcolor=\"white\"><input type=\"checkbox\" name=\"log_id_{$item.id}\"></td>{/if}\n      {if 2 == $item.type}<td bgcolor=\"white\"><input type=\"checkbox\" name=\"item_id_{$item.id}\"></td>{/if}\n    {/if}\n      </tr>\n    {if $note_on_separate_row && $bean->getAttribute('chnote') && $item.note}\n      <tr>\n        <td class=\"cellRightAligned\">{$i18n.label.note}:</td>\n        <td colspan=\"{$colspan}\">{$item.note|escape}</td>\n      </tr>\n    {/if}\n    {$prev_date = $item.date}\n    {if $print_subtotals} {$prev_grouped_by = $item.grouped_by} {/if}\n  {/foreach}\n  <!-- print a terminating subtotal -->\n  {if $print_subtotals}\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{$i18n.label.subtotal}\n    {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$cur_grouped_by]['user']|escape}</td>{/if}\n\n    {* user custom fileds *}\n    {if $custom_fields && $custom_fields->userFields}\n      {foreach $custom_fields->userFields as $userField}\n        {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chclient')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$cur_grouped_by]['client']|escape}</td>{/if}\n    {if $bean->getAttribute('chproject')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$cur_grouped_by]['project']|escape}</td>{/if}\n    {if $bean->getAttribute('chtask')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$cur_grouped_by]['task']|escape}</td>{/if}\n\n    {* time custom fileds *}\n    {if $custom_fields && $custom_fields->timeFields}\n      {foreach $custom_fields->timeFields as $timeField}\n        {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chstart')}<td></td>{/if}\n    {if $bean->getAttribute('chfinish')}<td></td>{/if}\n    {if $bean->getAttribute('chduration')}<td class=\"cellRightAlignedSubtotal\">{$subtotals[$cur_grouped_by]['time']}</td>{/if}\n    {if $bean->getAttribute('chunits')}<td class=\"cellRightAlignedSubtotal\">{$subtotals[$cur_grouped_by]['units']}</td>{/if}\n    {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td></td>{/if}\n    {if $bean->getAttribute('chcost')}<td class=\"cellRightAlignedSubtotal\">{if $user->can('manage_invoices') || $user->isClient()}{$subtotals[$cur_grouped_by]['cost']}{else}{$subtotals[$cur_grouped_by]['expenses']}{/if}</td>{/if}\n    {if $bean->getAttribute('chapproved')}<td></td>{/if}\n    {if $bean->getAttribute('chpaid')}<td></td>{/if}\n    {if $bean->getAttribute('chip')}<td></td>{/if}\n    {if $bean->getAttribute('chinvoice')}<td></td>{/if}\n    {if $bean->getAttribute('chtimesheet')}<td></td>{/if}\n    {if $bean->getAttribute('chfiles')}<td></td>{/if}\n    {if $use_checkboxes}<td></td>{/if}\n      </tr>\n  {/if}\n  <!-- print totals -->\n      <tr><td>&nbsp;</td></tr>\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{$i18n.label.total}</td>\n    {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td></td>{/if}\n\n    {* user custom fileds *}\n    {if $custom_fields && $custom_fields->userFields}\n      {foreach $custom_fields->userFields as $userField}\n        {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chclient')}<td></td>{/if}\n    {if $bean->getAttribute('chproject')}<td></td>{/if}\n    {if $bean->getAttribute('chtask')}<td></td>{/if}\n\n    {* time custom fileds *}\n    {if $custom_fields && $custom_fields->timeFields}\n      {foreach $custom_fields->timeFields as $timeField}\n        {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chstart')}<td></td>{/if}\n    {if $bean->getAttribute('chfinish')}<td></td>{/if}\n    {if $bean->getAttribute('chduration')}<td class=\"cellRightAlignedSubtotal\">{$totals['time']}</td>{/if}\n    {if $bean->getAttribute('chunits')}<td class=\"cellRightAlignedSubtotal\">{$totals['units']}</td>{/if}\n    {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td></td>{/if}\n    {if $bean->getAttribute('chcost')}<td nowrap class=\"cellRightAlignedSubtotal\">{$user->currency|escape} {if $user->can('manage_invoices') || $user->isClient()}{$totals['cost']}{else}{$totals['expenses']}{/if}</td>{/if}\n    {if $bean->getAttribute('chapproved')}<td></td>{/if}\n    {if $bean->getAttribute('chpaid')}<td></td>{/if}\n    {if $bean->getAttribute('chip')}<td></td>{/if}\n    {if $bean->getAttribute('chinvoice')}<td></td>{/if}\n    {if $bean->getAttribute('chtimesheet')}<td></td>{/if}\n    {if $bean->getAttribute('chfiles')}<td></td>{/if}\n    {if $use_checkboxes}<td></td>{/if}\n      </tr>\n{/if}\n    </table>\n  </td>\n</tr>\n</table>\n{if $report_items && ($use_mark_approved || $use_mark_paid || $use_assign_to_invoice || $use_assign_to_timesheet)}\n<table width=\"720\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\n  {if $use_mark_approved}\n  <tr>\n    <td align=\"right\">\n      <table>\n        <tr><td>{$i18n.label.mark_approved}: {$forms.reportViewForm.mark_approved_select_options.control} {$forms.reportViewForm.mark_approved_action_options.control} {$forms.reportViewForm.btn_mark_approved.control}</td></tr>\n      </table>\n    </td>\n  </tr>\n  {/if}\n  {if $use_mark_paid}\n  <tr>\n    <td align=\"right\">\n      <table>\n        <tr><td>{$i18n.label.mark_paid}: {$forms.reportViewForm.mark_paid_select_options.control} {$forms.reportViewForm.mark_paid_action_options.control} {$forms.reportViewForm.btn_mark_paid.control}</td></tr>\n      </table>\n    </td>\n  </tr>\n  {/if}\n  {if $use_assign_to_invoice}\n  <tr>\n    <td align=\"right\">\n      <table>\n        <tr><td>{$i18n.form.report.assign_to_invoice}: {$forms.reportViewForm.assign_invoice_select_options.control} {$forms.reportViewForm.recent_invoice.control} {$forms.reportViewForm.btn_assign_invoice.control}</td></tr>\n      </table>\n    </td>\n  </tr>\n  {/if}\n  {if $use_assign_to_timesheet}\n  <tr>\n    <td align=\"right\">\n      <table>\n        <tr><td>{$i18n.form.report.assign_to_timesheet}: {$forms.reportViewForm.assign_timesheet_select_options.control} {$forms.reportViewForm.timesheet.control} {$forms.reportViewForm.btn_assign_timesheet.control}</td></tr>\n      </table>\n    </td>\n  </tr>\n  {/if}\n</table>\n{/if}\n{$forms.reportViewForm.close}\n\n<table width=\"720\" cellspacing=\"4\" cellpadding=\"4\" border=\"0\">\n<tr>\n  <td align=\"center\">\n  <table>\n  <tr>\n    <td><input type=\"button\" onclick=\"chLocation('report_send.php');\" value=\"{$i18n.button.send_by_email}\"></td>\n  </tr>\n  </table>\n  </td>\n</tr>\n</table>\n", "<?php\n/* Copyright (c) Anuko International Ltd. https://www.anuko.com\nLicense: See license.txt */\n\n// Report all errors except E_NOTICE and E_STRICT.\n// Ignoring E_STRICT is here because PEAR 1.9.4 that we use is not E_STRICT compliant.\nif (!defined('E_STRICT')) define('E_STRICT', 2048);\n// if (!defined('E_DEPRECATED')) define('E_DEPRECATED', 8192);\nerror_reporting(E_ALL & ~E_NOTICE & ~E_STRICT); // & ~E_DEPRECATED);\n// E_ALL tends to change as PHP evolves, therefore we use & here instead of exclusive OR (^).\n\n// Disable displaying errors on screen.\nini_set('display_errors', 'Off');\n\n// require_once('init_auth.php');\ndefine(\"APP_VERSION\", \"1.19.23.5414\");\ndefine(\"APP_DIR\", dirname(__FILE__));\ndefine(\"LIBRARY_DIR\", APP_DIR.\"/WEB-INF/lib\");\ndefine(\"TEMPLATE_DIR\", APP_DIR.\"/WEB-INF/templates\");\n// Date format for database and URI parameters.\ndefine('DB_DATEFORMAT', '%Y-%m-%d');\ndefine('MAX_RANK', 512); // Max user rank.\n\nrequire_once(LIBRARY_DIR.'/common.lib.php');\n\n// Require the configuration file with application settings.\nif (!file_exists(APP_DIR.\"/WEB-INF/config.php\")) die (\"WEB-INF/config.php file does not exist.\");\nrequire_once(\"WEB-INF/config.php\");\n// Check whether DSN is defined.\nif (!defined(\"DSN\")) {\n  die (\"DSN value is not defined. Check your config.php file.\");\n}\n\n// Depending on DSN, require either mysqli or mysql extensions.\nif (strrpos(DSN, 'mysqli://', -strlen(DSN)) !== FALSE) {\n  check_extension('mysqli'); // DSN starts with mysqli:// - require mysqli extension.\n}\nif (strrpos(DSN, 'mysql://', -strlen(DSN)) !== FALSE) {\n  check_extension('mysql');  // DSN starts with mysql:// - require mysql extension.\n}\n\n// Require other extensions.\ncheck_extension('mbstring');\n\n// If auth params are not defined (in config.php) - initialize with an empty array.\nif (!isset($GLOBALS['AUTH_MODULE_PARAMS']) || !is_array($GLOBALS['AUTH_MODULE_PARAMS']))\n  $GLOBALS['AUTH_MODULE_PARAMS'] = array();\n\n// Smarty initialization.\nimport('smarty.Smarty');\n$smarty = new Smarty;\n$smarty->use_sub_dirs = false;\n$smarty->template_dir = TEMPLATE_DIR;\n$smarty->compile_dir  = TEMPLATE_DIR.'_c';\n\n// Note: these 3 settings below used to be in .htaccess file. Moved them here to eliminate \"error 500\" problems\n// with some shared hostings that do not have AllowOverride Options or AllowOverride All in their apache configurations.\n// Change http cache expiration time to 1 minute.\nsession_cache_expire(1);\n\n$phpsessid_ttl = defined('PHPSESSID_TTL') ? PHPSESSID_TTL : 60*60*24;\n// Set lifetime for garbage collection.\nini_set('session.gc_maxlifetime', $phpsessid_ttl);\n// Set PHP session path, if defined to avoid garbage collection interference from other scripts.\nif (defined('PHP_SESSION_PATH') && realpath(PHP_SESSION_PATH)) {\n  ini_set('session.save_path', realpath(PHP_SESSION_PATH));\n  ini_set('session.gc_probability', 1);\n}\n\n// \"tt_\" prefix is to avoid sharing session with other PHP apps that do not name session.\nif (!defined('SESSION_COOKIE_NAME')) define('SESSION_COOKIE_NAME', 'tt_PHPSESSID');\nif (!defined('LOGIN_COOKIE_NAME')) define('LOGIN_COOKIE_NAME', 'tt_login');\n\n// Set session cookie lifetime.\nsession_set_cookie_params($phpsessid_ttl);\nif (isset($_COOKIE[SESSION_COOKIE_NAME])) {\n  // Extend PHP session cookie lifetime by PHPSESSID_TTL (if defined, otherwise 24 hours) \n  // so that users don't have to re-login during this period from now. \n  setcookie(SESSION_COOKIE_NAME, $_COOKIE[SESSION_COOKIE_NAME],  time() + $phpsessid_ttl, '/');\n}\n\n// Start or resume PHP session.\nsession_name(SESSION_COOKIE_NAME);\n@session_start();\n\n// Authorization.\nimport('Auth');\n$auth = Auth::factory(AUTH_MODULE, $GLOBALS['AUTH_MODULE_PARAMS']);\n\n// Some defines we'll need.\n//\ndefine('RESOURCE_DIR', APP_DIR.'/WEB-INF/resources');\ndefine('COOKIE_EXPIRE', 60*60*24*30); // Cookies expire in 30 days.\n\n// Status values for projects, users, etc.\ndefine('ACTIVE', 1);\ndefine('INACTIVE', 0);\n// define('DELETED', -1); // DELETED items should have a NULL status. This allows us to have duplicate NULL status entries with existing indexes.\n\n// Definitions for tracking mode types.\ndefine('MODE_TIME', 0); // Tracking time only. There are no projects or tasks.\ndefine('MODE_PROJECTS', 1); // Tracking time per projects. There are no tasks.\ndefine('MODE_PROJECTS_AND_TASKS', 2); // Tracking time for projects and tasks.\n\n// Definitions of types for time records.\ndefine('TYPE_ALL', 0); // Time record can be specified with either duration or start and finish times.\ndefine('TYPE_START_FINISH', 1); // Time record has start and finish times.\ndefine('TYPE_DURATION', 2); // Time record has only duration, no start and finish times.\n\ndefine('CHARSET', 'utf-8');\n\ndate_default_timezone_set(@date_default_timezone_get());\n\n// Initialize global objects that are needed for the application.\nimport('html.HttpRequest');\n$request = new ttHttpRequest();\n\nimport('form.ActionErrors');\n$err = new ActionErrors(); // Error messages for user.\n$msg = new ActionErrors(); // Notification messages (not errrors) for user.\n\n// Create an instance of ttUser class. This gets us most of user details.\nimport('ttUser');\n$user = new ttUser(null, $auth->getUserId());\nif ($user->custom_logo) {\n  $smarty->assign('custom_logo', 'img/'.$user->group_id.'.png');\n  $smarty->assign('mobile_custom_logo', '../img/'.$user->group_id.'.png');\n}\n$smarty->assign('user', $user);\n\n// Localization.\nimport('I18n');\n$i18n = new I18n();\n\n// Determine the language to use.\n$lang = $user->lang;\nif (!$lang) {\n  if (defined('LANG_DEFAULT'))\n    $lang = LANG_DEFAULT;\n\n  // If we still do not have the language get it from the browser.\n  if (!$lang) {\n    $lang = $i18n->getBrowserLanguage();\n\n    // Finally - English is the default.\n    if (!$lang) {\n      $lang = 'en';\n    }\n  }\n}\n\n// Load i18n file.\n$i18n->load($lang);\n\n// Assign things for smarty to use in template files.\n$smarty->assign('i18n', $i18n->keys);\n$smarty->assign('err', $err);\n$smarty->assign('msg', $msg);\n\n// TODO: move this code out of here to the files that use it.\n\n// We use js/strftime.js to print dates in JavaScript (in DateField controls).\n// One of our date formats (%d.%m.%Y %a) prints a localized short weekday name (%a).\n// The init_js_date_locale function iniitializes Date.ext.locales array in js/strftime.js for our language\n// so that we could print localized short weekday names.\n//\n// JavaScript usage (see http://hacks.bluesmoon.info/strftime/localisation.html).\n//\n// var d = new Date();\n// d.locale = \"fr\";           // Remember to initialize locale.\n// d.strftime(\"%d.%m.%Y %a\"); // This will output a localized %a as in \"31.05.2013 Ven\"\n\n// Initialize date locale for JavaScript.\ninit_js_date_locale();\n\nfunction init_js_date_locale()\n{\n  global $i18n, $smarty;\n  $lang = $i18n->lang;\n\n  $days = $i18n->weekdayNames;\n  $short_day_names = array();\n  foreach($days as $k => $v) {\n    $short_day_names[$k] = mb_substr($v, 0, 3, 'utf-8');\n  }\n\n  /*\n  $months = $i18n->monthNames;\n  $short_month_names = array();\n  foreach ($months as $k => $v) {\n    $short_month_names[$k] = mb_substr($v, 0, 3, 'utf-8');\n  }\n  $js = \"Date.ext.locales['$lang'] = {\n      a: ['\" . join(\"', '\", $short_day_names) . \"'],\n      A: ['\" . join(\"', '\", $days) . \"'],\n      b: ['\" . join(\"', '\", $short_month_names) . \"'],\n      B: ['\" . join(\"', '\", $months) . \"'],\n      c: '%a %d %b %Y %T %Z',\n      p: ['', ''],\n      P: ['', ''],\n      x: '%Y-%m-%d',\n      X: '%T'\n    };\"; */\n  // We use %a in one of date formats. Therefore, simplified code here (instead of the above block).\n  // %p is also used on the Profile page in 12-hour time format example. Note that %p is not localized.\n  $js = \"Date.ext.locales['$lang'] = {\n      a: ['\" . join(\"', '\", $short_day_names) . \"'],\n      p: ['AM', 'PM']\n    };\";\n  $smarty->assign('js_date_locale', $js);\n}\n", "<?php\n/* Copyright (c) Anuko International Ltd. https://www.anuko.com\nLicense: See license.txt */\n\nrequire_once('initialize.php');\nimport('form.Form');\nimport('ttUser');\nimport('ttUserHelper');\n\nif ($auth->isPasswordExternal()) {\n  header('Location: login.php');\n  exit();\n}\n\n$cl_login = $request->getParameter('login');\n\n$form = new Form('resetPasswordForm');\n$form->addInput(array('type'=>'text','maxlength'=>'100','name'=>'login','value'=>$cl_login));\n$form->addInput(array('type'=>'submit','name'=>'btn_submit','value'=>$i18n->get('button.reset_password')));\n\nif ($request->isPost()) {\n  // Validate user input.\n  if (!ttValidString($cl_login)) $err->add($i18n->get('error.field'), $i18n->get('label.login'));\n\n  if ($err->no()) {\n    if (!ttUserHelper::getUserByLogin($cl_login)) {\n      // User with a specified login was not found.\n      // In this case, if login looks like email, try finding user by email.\n      if (ttValidEmail($cl_login)) {\n        $login = ttUserHelper::getUserByEmail($cl_login);\n        if ($login)\n          $cl_login = $login;\n        else\n          $err->add($i18n->get('error.no_login'));\n      } else\n        $err->add($i18n->get('error.no_login'));\n    }\n  }\n\n  if ($err->no()) {\n    $user = new ttUser($cl_login); // Note: reusing $user from initialize.php here.\n\n    // Protection against flooding user mailbox with too many password reset emails.\n    if (ttUserHelper::recentRefExists($user->id)) $err->add($i18n->get('error.access_denied'));\n  }\n\n  if ($err->no()) {\n    // Prepare and save a temporary reference for user.\n    $temp_ref = md5(uniqid());\n    ttUserHelper::saveTmpRef($temp_ref, $user->id);\n\n    $user_i18n = null;\n    if ($user->lang != $i18n->lang) {\n      $user_i18n = new I18n();\n      $user_i18n->load($user->lang);\n    } else\n      $user_i18n = &$i18n;\n\n    // Where do we email to?\n    $receiver = null;\n    if ($user->email)\n      $receiver = $user->email;\n    else {\n      if (ttValidEmail($cl_login))\n        $receiver = $cl_login;\n      else\n        $err->add($i18n->get('error.no_email'));\n    }\n\n    if ($receiver) {\n      import('mail.Mailer');\n      $mailer = new Mailer();\n      $mailer->setCharSet(CHARSET);\n      $mailer->setSender(SENDER);\n      $mailer->setReceiver(\"$receiver\");\n      if ((!empty($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] !== 'off')) || ($_SERVER['SERVER_PORT'] == 443))\n        $secure_connection = true;\n      if($secure_connection)\n        $http = 'https';\n      else\n        $http = 'http';\n\n      $cl_subject = $user_i18n->get('form.reset_password.email_subject');\n\n      $dir_name = trim(@constant('DIR_NAME'), '/');\n      if (!empty($dir_name))\n        $app_root = '/'.$dir_name;\n\n      $pass_edit_url = $http.'://'.$_SERVER['HTTP_HOST'].$app_root.'/password_change.php?ref='.$temp_ref;\n\n      $mailer->setMailMode(MAIL_MODE);\n      if ($mailer->send($cl_subject, sprintf($user_i18n->get('form.reset_password.email_body'), $_SERVER['REMOTE_ADDR'], $pass_edit_url)))\n        $msg->add($i18n->get('form.reset_password.message'));\n      else\n        $err->add($i18n->get('error.mail_send'));\n    }\n  }\n} // isPost\n\n$smarty->assign('forms', array($form->getName()=>$form->toArray()));\n$smarty->assign('onload', 'onLoad=\"document.resetPasswordForm.login.focus()\"');\n$smarty->assign('title', $i18n->get('title.reset_password'));\n$smarty->assign('content_page_name', 'password_reset2.tpl');\n$smarty->display('index2.tpl');\n"], "fixing_code": ["<script>\n  function chLocation(newLocation) { document.location = newLocation; }\n</script>\n\n{$forms.reportViewForm.open}\n<table width=\"720\">\n  <td valign=\"top\">\n    <table border=\"0\" cellpadding=\"3\" cellspacing=\"1\" width=\"100%\">\n      <tr>\n        <td valign=\"top\" class=\"sectionHeaderNoBorder\" align=\"center\">{$i18n.form.report.export} {if file_exists('WEB-INF/lib/tcpdf')}<a href=\"topdf.php\">PDF</a>,{/if} <a href=\"tofile.php?type=xml\">XML</a> {$i18n.label.or} <a href=\"tofile.php?type=csv\">CSV</a></td>\n      </tr>\n    </table>\n    <table border=\"0\" cellpadding=\"3\" cellspacing=\"1\" width=\"100%\">\n<!-- totals only report -->\n{if $bean->getAttribute('chtotalsonly')}\n      <tr>\n        <td class=\"tableHeader\">{$group_by_header|escape}</td>\n        {if $bean->getAttribute('chduration')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.duration}</td>{/if}\n        {if $bean->getAttribute('chunits')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.work_units_short}</td>{/if}\n        {if $bean->getAttribute('chcost')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.cost}</td>{/if}\n      </tr>\n  {foreach $subtotals as $subtotal}\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{if $subtotal['name']}{$subtotal['name']|escape}{else}&nbsp;{/if}</td>\n        {if $bean->getAttribute('chduration')}<td class=\"cellRightAlignedSubtotal\">{$subtotal['time']}</td>{/if}\n        {if $bean->getAttribute('chunits')}<td class=\"cellRightAlignedSubtotal\">{$subtotal['units']}</td>{/if}\n        {if $bean->getAttribute('chcost')}<td class=\"cellRightAlignedSubtotal\">{if $user->can('manage_invoices') || $user->isClient()}{$subtotal['cost']}{else}{$subtotal['expenses']}{/if}</td>{/if}\n      </tr>\n  {/foreach}\n      <!-- print totals -->\n      <tr><td>&nbsp;</td></tr>\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{$i18n.label.total}</td>\n        {if $bean->getAttribute('chduration')}<td nowrap class=\"cellRightAlignedSubtotal\">{$totals['time']}</td>{/if}\n        {if $bean->getAttribute('chunits')}<td nowrap class=\"cellRightAlignedSubtotal\">{$totals['units']}</td>{/if}\n        {if $bean->getAttribute('chcost')}<td nowrap class=\"cellRightAlignedSubtotal\">{$user->currency|escape} {if $user->can('manage_invoices') || $user->isClient()}{$totals['cost']}{else}{$totals['expenses']}{/if}</td>{/if}\n      </tr>\n{else}\n<!-- normal report -->\n      <tr>\n        <td class=\"tableHeader\">{$i18n.label.date}</td>\n  {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td class=\"tableHeader\">{$i18n.label.user}</td>{/if}\n\n  {* user custom fileds *}\n  {if $custom_fields && $custom_fields->userFields}\n    {foreach $custom_fields->userFields as $userField}\n      {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n      {if $bean->getAttribute($checkbox_control_name)}<td class=\"tableHeader\">{{$userField['label']|escape}}</td>{/if}\n    {/foreach}\n  {/if}\n\n  {if $bean->getAttribute('chclient')}<td class=\"tableHeader\">{$i18n.label.client}</td>{/if}\n  {if $bean->getAttribute('chproject')}<td class=\"tableHeader\">{$i18n.label.project}</td>{/if}\n  {if $bean->getAttribute('chtask')}<td class=\"tableHeader\">{$i18n.label.task}</td>{/if}\n\n  {* time custom fileds *}\n  {if $custom_fields && $custom_fields->timeFields}\n    {foreach $custom_fields->timeFields as $timeField}\n      {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n      {if $bean->getAttribute($checkbox_control_name)}<td class=\"tableHeader\">{{$timeField['label']|escape}}</td>{/if}\n    {/foreach}\n  {/if}\n\n  {if $bean->getAttribute('chstart')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.start}</td>{/if}\n  {if $bean->getAttribute('chfinish')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.finish}</td>{/if}\n  {if $bean->getAttribute('chduration')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.duration}</td>{/if}\n  {if $bean->getAttribute('chunits')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.work_units_short}</td>{/if}\n  {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td class=\"tableHeader\">{$i18n.label.note}</td>{/if}\n  {if $bean->getAttribute('chcost')}<td class=\"tableHeaderCentered\" width=\"5%\">{$i18n.label.cost}</td>{/if}\n  {if $bean->getAttribute('chapproved')}<td class=\"tableHeader\">{$i18n.label.approved}</td>{/if}\n  {if $bean->getAttribute('chpaid')}<td class=\"tableHeader\">{$i18n.label.paid}</td>{/if}\n  {if $bean->getAttribute('chip')}<td class=\"tableHeaderCentered\">{$i18n.label.ip}</td>{/if}\n  {if $bean->getAttribute('chinvoice')}<td class=\"tableHeader\">{$i18n.label.invoice}</td>{/if}\n  {if $bean->getAttribute('chtimesheet')}<td class=\"tableHeader\">{$i18n.label.timesheet}</td>{/if}\n  {if $bean->getAttribute('chfiles')}<td></td>{/if}\n      </tr>\n  {foreach $report_items as $item}\n    <!-- print subtotal for a block of grouped values -->\n    {$cur_date = $item.date}\n    {if $print_subtotals}\n      {$cur_grouped_by = $item.grouped_by}\n      {if $cur_grouped_by != $prev_grouped_by && !$first_pass}\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{$i18n.label.subtotal}\n        {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$prev_grouped_by]['user']|escape}</td>{/if}\n\n        {* user custom fileds *}\n        {if $custom_fields && $custom_fields->userFields}\n          {foreach $custom_fields->userFields as $userField}\n            {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n            {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n          {/foreach}\n        {/if}\n\n        {if $bean->getAttribute('chclient')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$prev_grouped_by]['client']|escape}</td>{/if}\n        {if $bean->getAttribute('chproject')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$prev_grouped_by]['project']|escape}</td>{/if}\n        {if $bean->getAttribute('chtask')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$prev_grouped_by]['task']|escape}</td>{/if}\n\n        {* time custom fileds *}\n          {if $custom_fields && $custom_fields->timeFields}\n           {foreach $custom_fields->timeFields as $timeField}\n            {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n            {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n          {/foreach}\n        {/if}\n\n        {if $bean->getAttribute('chstart')}<td></td>{/if}\n        {if $bean->getAttribute('chfinish')}<td></td>{/if}\n        {if $bean->getAttribute('chduration')}<td class=\"cellRightAlignedSubtotal\">{$subtotals[$prev_grouped_by]['time']}</td>{/if}\n        {if $bean->getAttribute('chunits')}<td class=\"cellRightAlignedSubtotal\">{$subtotals[$prev_grouped_by]['units']}</td>{/if}\n        {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td></td>{/if}\n        {if $bean->getAttribute('chcost')}<td class=\"cellRightAlignedSubtotal\">{if $user->can('manage_invoices') || $user->isClient()}{$subtotals[$prev_grouped_by]['cost']}{else}{$subtotals[$prev_grouped_by]['expenses']}{/if}</td>{/if}\n        {if $bean->getAttribute('chapproved')}<td></td>{/if}\n        {if $bean->getAttribute('chpaid')}<td></td>{/if}\n        {if $bean->getAttribute('chip')}<td></td>{/if}\n        {if $bean->getAttribute('chinvoice')}<td></td>{/if}\n        {if $bean->getAttribute('chtimesheet')}<td></td>{/if}\n        {if $bean->getAttribute('chfiles')}<td></td>{/if}\n        {if $use_checkboxes}<td></td>{/if}\n        {* <td></td>{* column for edit icons *}\n      </tr>\n      <tr><td>&nbsp;</td></tr>\n      {/if}\n    {$first_pass = false}\n    {/if}\n      <!--  print regular row --> \n      {if $cur_date != $prev_date}\n        {if $report_row_class == 'rowReportItem'} {$report_row_class = 'rowReportItemAlt'} {else} {$report_row_class = 'rowReportItem'} {/if}\n      {/if}\n      <tr class=\"{$report_row_class}\">\n        <td class=\"cellLeftAligned\">{$item.date}</td>\n    {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td class=\"cellLeftAligned\">{$item.user|escape}</td>{/if}\n\n    {* user custom fileds *}\n    {if $custom_fields && $custom_fields->userFields}\n      {foreach $custom_fields->userFields as $userField}\n        {assign var=\"control_name\" value='user_field_'|cat:$userField['id']}\n        {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td>{$item.$control_name|escape}</td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chclient')}<td class=\"cellLeftAligned\">{$item.client|escape}</td>{/if}\n    {if $bean->getAttribute('chproject')}<td class=\"cellLeftAligned\">{$item.project|escape}</td>{/if}\n    {if $bean->getAttribute('chtask')}<td class=\"cellLeftAligned\">{$item.task|escape}</td>{/if}\n\n    {* time custom fileds *}\n    {if $custom_fields && $custom_fields->timeFields}\n      {foreach $custom_fields->timeFields as $timeField}\n        {assign var=\"control_name\" value='time_field_'|cat:$timeField['id']}\n        {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td>{$item.$control_name|escape}</td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chstart')}<td nowrap class=\"cellRightAligned\">{$item.start}</td>{/if}\n    {if $bean->getAttribute('chfinish')}<td nowrap class=\"cellRightAligned\">{$item.finish}</td>{/if}\n    {if $bean->getAttribute('chduration')}<td class=\"cellRightAligned\">{$item.duration}</td>{/if}\n    {if $bean->getAttribute('chunits')}<td class=\"cellRightAligned\">{$item.units}</td>{/if}\n    {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td class=\"cellLeftAligned\">{$item.note|escape}</td>{/if}\n    {if $bean->getAttribute('chcost')}<td class=\"cellRightAligned\">{if $user->can('manage_invoices') || $user->isClient()}{$item.cost}{else}{$item.expense}{/if}</td>{/if}\n    {if $bean->getAttribute('chapproved')}<td class=\"cellRightAligned\">{if $item.approved == 1}{$i18n.label.yes}{else}{$i18n.label.no}{/if}</td>{/if}\n    {if $bean->getAttribute('chpaid')}<td class=\"cellRightAligned\">{if $item.paid == 1}{$i18n.label.yes}{else}{$i18n.label.no}{/if}</td>{/if}\n    {if $bean->getAttribute('chip')}<td class=\"cellRightAligned\">{if $item.modified}{$item.modified_ip} {$item.modified}{else}{$item.created_ip} {$item.created}{/if}</td>{/if}\n    {if $bean->getAttribute('chinvoice')}<td class=\"cellRightAligned\">{$item.invoice|escape}</td>{/if}\n    {if $bean->getAttribute('chtimesheet')}<td class=\"cellRightAligned\">{$item.timesheet_name|escape}</td>{/if}\n    {if $bean->getAttribute('chfiles')}\n      {if 1 == $item.type}<td class=\"cellRightAligned\">{if $item.has_files}<a href=\"time_files.php?id={$item.id}\"><img class=\"table_icon\" alt=\"{$i18n.label.files}\" src=\"img/icon-files.png\"></a>{/if}</td>{/if}\n      {if 2 == $item.type}<td class=\"cellRightAligned\">{if $item.has_files}<a href=\"expense_files.php?id={$item.id}\"><img class=\"table_icon\" alt=\"{$i18n.label.files}\" src=\"img/icon-files.png\"></a>{/if}</td>{/if}\n    {/if}\n    {if $use_checkboxes}\n      {if 1 == $item.type}<td bgcolor=\"white\"><input type=\"checkbox\" name=\"log_id_{$item.id}\"></td>{/if}\n      {if 2 == $item.type}<td bgcolor=\"white\"><input type=\"checkbox\" name=\"item_id_{$item.id}\"></td>{/if}\n    {/if}\n     {* <td><a href=\"time_edit.php?id={$item.id}\"><img class=\"table_icon\" alt=\"{$i18n.label.edit}\" src=\"img/icon-edit.png\"></a></td>{* column for edit icons *}\n      </tr>\n    {if $note_on_separate_row && $bean->getAttribute('chnote') && $item.note}\n      <tr>\n        <td class=\"cellRightAligned\">{$i18n.label.note}:</td>\n        <td colspan=\"{$colspan}\">{$item.note|escape}</td>\n      </tr>\n    {/if}\n    {$prev_date = $item.date}\n    {if $print_subtotals} {$prev_grouped_by = $item.grouped_by} {/if}\n  {/foreach}\n  <!-- print a terminating subtotal -->\n  {if $print_subtotals}\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{$i18n.label.subtotal}\n    {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$cur_grouped_by]['user']|escape}</td>{/if}\n\n    {* user custom fileds *}\n    {if $custom_fields && $custom_fields->userFields}\n      {foreach $custom_fields->userFields as $userField}\n        {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chclient')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$cur_grouped_by]['client']|escape}</td>{/if}\n    {if $bean->getAttribute('chproject')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$cur_grouped_by]['project']|escape}</td>{/if}\n    {if $bean->getAttribute('chtask')}<td class=\"cellLeftAlignedSubtotal\">{$subtotals[$cur_grouped_by]['task']|escape}</td>{/if}\n\n    {* time custom fileds *}\n    {if $custom_fields && $custom_fields->timeFields}\n      {foreach $custom_fields->timeFields as $timeField}\n        {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chstart')}<td></td>{/if}\n    {if $bean->getAttribute('chfinish')}<td></td>{/if}\n    {if $bean->getAttribute('chduration')}<td class=\"cellRightAlignedSubtotal\">{$subtotals[$cur_grouped_by]['time']}</td>{/if}\n    {if $bean->getAttribute('chunits')}<td class=\"cellRightAlignedSubtotal\">{$subtotals[$cur_grouped_by]['units']}</td>{/if}\n    {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td></td>{/if}\n    {if $bean->getAttribute('chcost')}<td class=\"cellRightAlignedSubtotal\">{if $user->can('manage_invoices') || $user->isClient()}{$subtotals[$cur_grouped_by]['cost']}{else}{$subtotals[$cur_grouped_by]['expenses']}{/if}</td>{/if}\n    {if $bean->getAttribute('chapproved')}<td></td>{/if}\n    {if $bean->getAttribute('chpaid')}<td></td>{/if}\n    {if $bean->getAttribute('chip')}<td></td>{/if}\n    {if $bean->getAttribute('chinvoice')}<td></td>{/if}\n    {if $bean->getAttribute('chtimesheet')}<td></td>{/if}\n    {if $bean->getAttribute('chfiles')}<td></td>{/if}\n    {if $use_checkboxes}<td></td>{/if}\n    {* <td></td>{* column for edit icons *}\n      </tr>\n  {/if}\n  <!-- print totals -->\n      <tr><td>&nbsp;</td></tr>\n      <tr class=\"rowReportSubtotal\">\n        <td class=\"cellLeftAlignedSubtotal\">{$i18n.label.total}</td>\n    {if $user->can('view_reports') || $user->can('view_all_reports') || $user->isClient()}<td></td>{/if}\n\n    {* user custom fileds *}\n    {if $custom_fields && $custom_fields->userFields}\n      {foreach $custom_fields->userFields as $userField}\n        {assign var=\"checkbox_control_name\" value='show_user_field_'|cat:$userField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chclient')}<td></td>{/if}\n    {if $bean->getAttribute('chproject')}<td></td>{/if}\n    {if $bean->getAttribute('chtask')}<td></td>{/if}\n\n    {* time custom fileds *}\n    {if $custom_fields && $custom_fields->timeFields}\n      {foreach $custom_fields->timeFields as $timeField}\n        {assign var=\"checkbox_control_name\" value='show_time_field_'|cat:$timeField['id']}\n        {if $bean->getAttribute($checkbox_control_name)}<td></td>{/if}\n      {/foreach}\n    {/if}\n\n    {if $bean->getAttribute('chstart')}<td></td>{/if}\n    {if $bean->getAttribute('chfinish')}<td></td>{/if}\n    {if $bean->getAttribute('chduration')}<td class=\"cellRightAlignedSubtotal\">{$totals['time']}</td>{/if}\n    {if $bean->getAttribute('chunits')}<td class=\"cellRightAlignedSubtotal\">{$totals['units']}</td>{/if}\n    {if $bean->getAttribute('chnote') && !$note_on_separate_row}<td></td>{/if}\n    {if $bean->getAttribute('chcost')}<td nowrap class=\"cellRightAlignedSubtotal\">{$user->currency|escape} {if $user->can('manage_invoices') || $user->isClient()}{$totals['cost']}{else}{$totals['expenses']}{/if}</td>{/if}\n    {if $bean->getAttribute('chapproved')}<td></td>{/if}\n    {if $bean->getAttribute('chpaid')}<td></td>{/if}\n    {if $bean->getAttribute('chip')}<td></td>{/if}\n    {if $bean->getAttribute('chinvoice')}<td></td>{/if}\n    {if $bean->getAttribute('chtimesheet')}<td></td>{/if}\n    {if $bean->getAttribute('chfiles')}<td></td>{/if}\n    {if $use_checkboxes}<td></td>{/if}\n    {* <td></td>{* column for edit icons *}\n      </tr>\n{/if}\n    </table>\n  </td>\n</tr>\n</table>\n{if $report_items && ($use_mark_approved || $use_mark_paid || $use_assign_to_invoice || $use_assign_to_timesheet)}\n<table width=\"720\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">\n  {if $use_mark_approved}\n  <tr>\n    <td align=\"right\">\n      <table>\n        <tr><td>{$i18n.label.mark_approved}: {$forms.reportViewForm.mark_approved_select_options.control} {$forms.reportViewForm.mark_approved_action_options.control} {$forms.reportViewForm.btn_mark_approved.control}</td></tr>\n      </table>\n    </td>\n  </tr>\n  {/if}\n  {if $use_mark_paid}\n  <tr>\n    <td align=\"right\">\n      <table>\n        <tr><td>{$i18n.label.mark_paid}: {$forms.reportViewForm.mark_paid_select_options.control} {$forms.reportViewForm.mark_paid_action_options.control} {$forms.reportViewForm.btn_mark_paid.control}</td></tr>\n      </table>\n    </td>\n  </tr>\n  {/if}\n  {if $use_assign_to_invoice}\n  <tr>\n    <td align=\"right\">\n      <table>\n        <tr><td>{$i18n.form.report.assign_to_invoice}: {$forms.reportViewForm.assign_invoice_select_options.control} {$forms.reportViewForm.recent_invoice.control} {$forms.reportViewForm.btn_assign_invoice.control}</td></tr>\n      </table>\n    </td>\n  </tr>\n  {/if}\n  {if $use_assign_to_timesheet}\n  <tr>\n    <td align=\"right\">\n      <table>\n        <tr><td>{$i18n.form.report.assign_to_timesheet}: {$forms.reportViewForm.assign_timesheet_select_options.control} {$forms.reportViewForm.timesheet.control} {$forms.reportViewForm.btn_assign_timesheet.control}</td></tr>\n      </table>\n    </td>\n  </tr>\n  {/if}\n</table>\n{/if}\n{$forms.reportViewForm.close}\n\n<table width=\"720\" cellspacing=\"4\" cellpadding=\"4\" border=\"0\">\n<tr>\n  <td align=\"center\">\n  <table>\n  <tr>\n    <td><input type=\"button\" onclick=\"chLocation('report_send.php');\" value=\"{$i18n.button.send_by_email}\"></td>\n  </tr>\n  </table>\n  </td>\n</tr>\n</table>\n", "<?php\n/* Copyright (c) Anuko International Ltd. https://www.anuko.com\nLicense: See license.txt */\n\n// Report all errors except E_NOTICE and E_STRICT.\n// Ignoring E_STRICT is here because PEAR 1.9.4 that we use is not E_STRICT compliant.\nif (!defined('E_STRICT')) define('E_STRICT', 2048);\n// if (!defined('E_DEPRECATED')) define('E_DEPRECATED', 8192);\nerror_reporting(E_ALL & ~E_NOTICE & ~E_STRICT); // & ~E_DEPRECATED);\n// E_ALL tends to change as PHP evolves, therefore we use & here instead of exclusive OR (^).\n\n// Disable displaying errors on screen.\nini_set('display_errors', 'Off');\n\n// require_once('init_auth.php');\ndefine(\"APP_VERSION\", \"1.19.24.5415\");\ndefine(\"APP_DIR\", dirname(__FILE__));\ndefine(\"LIBRARY_DIR\", APP_DIR.\"/WEB-INF/lib\");\ndefine(\"TEMPLATE_DIR\", APP_DIR.\"/WEB-INF/templates\");\n// Date format for database and URI parameters.\ndefine('DB_DATEFORMAT', '%Y-%m-%d');\ndefine('MAX_RANK', 512); // Max user rank.\n\nrequire_once(LIBRARY_DIR.'/common.lib.php');\n\n// Require the configuration file with application settings.\nif (!file_exists(APP_DIR.\"/WEB-INF/config.php\")) die (\"WEB-INF/config.php file does not exist.\");\nrequire_once(\"WEB-INF/config.php\");\n// Check whether DSN is defined.\nif (!defined(\"DSN\")) {\n  die (\"DSN value is not defined. Check your config.php file.\");\n}\n\n// Depending on DSN, require either mysqli or mysql extensions.\nif (strrpos(DSN, 'mysqli://', -strlen(DSN)) !== FALSE) {\n  check_extension('mysqli'); // DSN starts with mysqli:// - require mysqli extension.\n}\nif (strrpos(DSN, 'mysql://', -strlen(DSN)) !== FALSE) {\n  check_extension('mysql');  // DSN starts with mysql:// - require mysql extension.\n}\n\n// Require other extensions.\ncheck_extension('mbstring');\n\n// If auth params are not defined (in config.php) - initialize with an empty array.\nif (!isset($GLOBALS['AUTH_MODULE_PARAMS']) || !is_array($GLOBALS['AUTH_MODULE_PARAMS']))\n  $GLOBALS['AUTH_MODULE_PARAMS'] = array();\n\n// Smarty initialization.\nimport('smarty.Smarty');\n$smarty = new Smarty;\n$smarty->use_sub_dirs = false;\n$smarty->template_dir = TEMPLATE_DIR;\n$smarty->compile_dir  = TEMPLATE_DIR.'_c';\n\n// Note: these 3 settings below used to be in .htaccess file. Moved them here to eliminate \"error 500\" problems\n// with some shared hostings that do not have AllowOverride Options or AllowOverride All in their apache configurations.\n// Change http cache expiration time to 1 minute.\nsession_cache_expire(1);\n\n$phpsessid_ttl = defined('PHPSESSID_TTL') ? PHPSESSID_TTL : 60*60*24;\n// Set lifetime for garbage collection.\nini_set('session.gc_maxlifetime', $phpsessid_ttl);\n// Set PHP session path, if defined to avoid garbage collection interference from other scripts.\nif (defined('PHP_SESSION_PATH') && realpath(PHP_SESSION_PATH)) {\n  ini_set('session.save_path', realpath(PHP_SESSION_PATH));\n  ini_set('session.gc_probability', 1);\n}\n\n// \"tt_\" prefix is to avoid sharing session with other PHP apps that do not name session.\nif (!defined('SESSION_COOKIE_NAME')) define('SESSION_COOKIE_NAME', 'tt_PHPSESSID');\nif (!defined('LOGIN_COOKIE_NAME')) define('LOGIN_COOKIE_NAME', 'tt_login');\n\n// Set session cookie lifetime.\nsession_set_cookie_params($phpsessid_ttl);\nif (isset($_COOKIE[SESSION_COOKIE_NAME])) {\n  // Extend PHP session cookie lifetime by PHPSESSID_TTL (if defined, otherwise 24 hours) \n  // so that users don't have to re-login during this period from now. \n  setcookie(SESSION_COOKIE_NAME, $_COOKIE[SESSION_COOKIE_NAME],  time() + $phpsessid_ttl, '/');\n}\n\n// Start or resume PHP session.\nsession_name(SESSION_COOKIE_NAME);\n@session_start();\n\n// Authorization.\nimport('Auth');\n$auth = Auth::factory(AUTH_MODULE, $GLOBALS['AUTH_MODULE_PARAMS']);\n\n// Some defines we'll need.\n//\ndefine('RESOURCE_DIR', APP_DIR.'/WEB-INF/resources');\ndefine('COOKIE_EXPIRE', 60*60*24*30); // Cookies expire in 30 days.\n\n// Status values for projects, users, etc.\ndefine('ACTIVE', 1);\ndefine('INACTIVE', 0);\n// define('DELETED', -1); // DELETED items should have a NULL status. This allows us to have duplicate NULL status entries with existing indexes.\n\n// Definitions for tracking mode types.\ndefine('MODE_TIME', 0); // Tracking time only. There are no projects or tasks.\ndefine('MODE_PROJECTS', 1); // Tracking time per projects. There are no tasks.\ndefine('MODE_PROJECTS_AND_TASKS', 2); // Tracking time for projects and tasks.\n\n// Definitions of types for time records.\ndefine('TYPE_ALL', 0); // Time record can be specified with either duration or start and finish times.\ndefine('TYPE_START_FINISH', 1); // Time record has start and finish times.\ndefine('TYPE_DURATION', 2); // Time record has only duration, no start and finish times.\n\ndefine('CHARSET', 'utf-8');\n\ndate_default_timezone_set(@date_default_timezone_get());\n\n// Initialize global objects that are needed for the application.\nimport('html.HttpRequest');\n$request = new ttHttpRequest();\n\nimport('form.ActionErrors');\n$err = new ActionErrors(); // Error messages for user.\n$msg = new ActionErrors(); // Notification messages (not errrors) for user.\n\n// Create an instance of ttUser class. This gets us most of user details.\nimport('ttUser');\n$user = new ttUser(null, $auth->getUserId());\nif ($user->custom_logo) {\n  $smarty->assign('custom_logo', 'img/'.$user->group_id.'.png');\n  $smarty->assign('mobile_custom_logo', '../img/'.$user->group_id.'.png');\n}\n$smarty->assign('user', $user);\n\n// Localization.\nimport('I18n');\n$i18n = new I18n();\n\n// Determine the language to use.\n$lang = $user->lang;\nif (!$lang) {\n  if (defined('LANG_DEFAULT'))\n    $lang = LANG_DEFAULT;\n\n  // If we still do not have the language get it from the browser.\n  if (!$lang) {\n    $lang = $i18n->getBrowserLanguage();\n\n    // Finally - English is the default.\n    if (!$lang) {\n      $lang = 'en';\n    }\n  }\n}\n\n// Load i18n file.\n$i18n->load($lang);\n\n// Assign things for smarty to use in template files.\n$smarty->assign('i18n', $i18n->keys);\n$smarty->assign('err', $err);\n$smarty->assign('msg', $msg);\n\n// TODO: move this code out of here to the files that use it.\n\n// We use js/strftime.js to print dates in JavaScript (in DateField controls).\n// One of our date formats (%d.%m.%Y %a) prints a localized short weekday name (%a).\n// The init_js_date_locale function iniitializes Date.ext.locales array in js/strftime.js for our language\n// so that we could print localized short weekday names.\n//\n// JavaScript usage (see http://hacks.bluesmoon.info/strftime/localisation.html).\n//\n// var d = new Date();\n// d.locale = \"fr\";           // Remember to initialize locale.\n// d.strftime(\"%d.%m.%Y %a\"); // This will output a localized %a as in \"31.05.2013 Ven\"\n\n// Initialize date locale for JavaScript.\ninit_js_date_locale();\n\nfunction init_js_date_locale()\n{\n  global $i18n, $smarty;\n  $lang = $i18n->lang;\n\n  $days = $i18n->weekdayNames;\n  $short_day_names = array();\n  foreach($days as $k => $v) {\n    $short_day_names[$k] = mb_substr($v, 0, 3, 'utf-8');\n  }\n\n  /*\n  $months = $i18n->monthNames;\n  $short_month_names = array();\n  foreach ($months as $k => $v) {\n    $short_month_names[$k] = mb_substr($v, 0, 3, 'utf-8');\n  }\n  $js = \"Date.ext.locales['$lang'] = {\n      a: ['\" . join(\"', '\", $short_day_names) . \"'],\n      A: ['\" . join(\"', '\", $days) . \"'],\n      b: ['\" . join(\"', '\", $short_month_names) . \"'],\n      B: ['\" . join(\"', '\", $months) . \"'],\n      c: '%a %d %b %Y %T %Z',\n      p: ['', ''],\n      P: ['', ''],\n      x: '%Y-%m-%d',\n      X: '%T'\n    };\"; */\n  // We use %a in one of date formats. Therefore, simplified code here (instead of the above block).\n  // %p is also used on the Profile page in 12-hour time format example. Note that %p is not localized.\n  $js = \"Date.ext.locales['$lang'] = {\n      a: ['\" . join(\"', '\", $short_day_names) . \"'],\n      p: ['AM', 'PM']\n    };\";\n  $smarty->assign('js_date_locale', $js);\n}\n", "<?php\n/* Copyright (c) Anuko International Ltd. https://www.anuko.com\nLicense: See license.txt */\n\nrequire_once('initialize.php');\nimport('form.Form');\nimport('ttUser');\nimport('ttUserHelper');\n\nif ($auth->isPasswordExternal()) {\n  header('Location: login.php');\n  exit();\n}\n\n$cl_login = $request->getParameter('login');\n\n$form = new Form('resetPasswordForm');\n$form->addInput(array('type'=>'text','maxlength'=>'100','name'=>'login','value'=>$cl_login));\n$form->addInput(array('type'=>'submit','name'=>'btn_submit','value'=>$i18n->get('button.reset_password')));\n\nif ($request->isPost()) {\n  // Validate user input.\n  if (!ttValidString($cl_login)) $err->add($i18n->get('error.field'), $i18n->get('label.login'));\n\n  if ($err->no()) {\n    if (!ttUserHelper::getUserByLogin($cl_login)) {\n      // User with a specified login was not found.\n      // In this case, if login looks like email, try finding user by email.\n      if (ttValidEmail($cl_login)) {\n        $login = ttUserHelper::getUserByEmail($cl_login);\n        if ($login)\n          $cl_login = $login;\n        else\n          $err->add($i18n->get('error.no_login'));\n      } else\n        $err->add($i18n->get('error.no_login'));\n    }\n  }\n\n  if ($err->no()) {\n    $user = new ttUser($cl_login); // Note: reusing $user from initialize.php here.\n\n    // Protection against flooding user mailbox with too many password reset emails.\n    if (ttUserHelper::recentRefExists($user->id)) $err->add($i18n->get('error.access_denied'));\n  }\n\n  if ($err->no()) {\n    // Prepare and save a temporary reference for user.\n    $cryptographically_strong = true;\n    $random_bytes = openssl_random_pseudo_bytes(16, $cryptographically_strong);\n    if ($random_bytes === false) die (\"openssl_random_pseudo_bytes function call failed...\");\n    $temp_ref = bin2hex($random_bytes);\n    ttUserHelper::saveTmpRef($temp_ref, $user->id);\n\n    $user_i18n = null;\n    if ($user->lang != $i18n->lang) {\n      $user_i18n = new I18n();\n      $user_i18n->load($user->lang);\n    } else\n      $user_i18n = &$i18n;\n\n    // Where do we email to?\n    $receiver = null;\n    if ($user->email)\n      $receiver = $user->email;\n    else {\n      if (ttValidEmail($cl_login))\n        $receiver = $cl_login;\n      else\n        $err->add($i18n->get('error.no_email'));\n    }\n\n    if ($receiver) {\n      import('mail.Mailer');\n      $mailer = new Mailer();\n      $mailer->setCharSet(CHARSET);\n      $mailer->setSender(SENDER);\n      $mailer->setReceiver(\"$receiver\");\n      if ((!empty($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] !== 'off')) || ($_SERVER['SERVER_PORT'] == 443))\n        $secure_connection = true;\n      if($secure_connection)\n        $http = 'https';\n      else\n        $http = 'http';\n\n      $cl_subject = $user_i18n->get('form.reset_password.email_subject');\n\n      $dir_name = trim(@constant('DIR_NAME'), '/');\n      if (!empty($dir_name))\n        $app_root = '/'.$dir_name;\n\n      $pass_edit_url = $http.'://'.$_SERVER['HTTP_HOST'].$app_root.'/password_change.php?ref='.$temp_ref;\n\n      $mailer->setMailMode(MAIL_MODE);\n      if ($mailer->send($cl_subject, sprintf($user_i18n->get('form.reset_password.email_body'), $_SERVER['REMOTE_ADDR'], $pass_edit_url)))\n        $msg->add($i18n->get('form.reset_password.message'));\n      else\n        $err->add($i18n->get('error.mail_send'));\n    }\n  }\n} // isPost\n\n$smarty->assign('forms', array($form->getName()=>$form->toArray()));\n$smarty->assign('onload', 'onLoad=\"document.resetPasswordForm.login.focus()\"');\n$smarty->assign('title', $i18n->get('title.reset_password'));\n$smarty->assign('content_page_name', 'password_reset2.tpl');\n$smarty->display('index2.tpl');\n"], "filenames": ["WEB-INF/templates/report.tpl", "initialize.php", "password_reset.php"], "buggy_code_start_loc": [119, 16, 49], "buggy_code_end_loc": [263, 17, 50], "fixing_code_start_loc": [120, 16, 49], "fixing_code_end_loc": [268, 17, 53], "type": "CWE-330", "message": "Anuko Time Tracker is an open source, web-based time tracking application written in PHP. In TimeTracker before version 1.19.24.5415 tokens used in password reset feature in Time Tracker are based on system time and, therefore, are predictable. This opens a window for brute force attacks to guess user tokens and, once successful, change user passwords, including that of a system administrator. This vulnerability is pathced in version 1.19.24.5415 (started to use more secure tokens) with an additional improvement in 1.19.24.5416 (limited an available window for brute force token guessing).", "other": {"cve": {"id": "CVE-2021-21352", "sourceIdentifier": "security-advisories@github.com", "published": "2021-03-03T01:15:13.427", "lastModified": "2021-03-09T15:51:41.237", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Anuko Time Tracker is an open source, web-based time tracking application written in PHP. In TimeTracker before version 1.19.24.5415 tokens used in password reset feature in Time Tracker are based on system time and, therefore, are predictable. This opens a window for brute force attacks to guess user tokens and, once successful, change user passwords, including that of a system administrator. This vulnerability is pathced in version 1.19.24.5415 (started to use more secure tokens) with an additional improvement in 1.19.24.5416 (limited an available window for brute force token guessing)."}, {"lang": "es", "value": "Anuko Time Tracker es una aplicaci\u00f3n de seguimiento de tiempo de c\u00f3digo abierto basada en la web escrita en PHP.&#xa0;En TimeTracker anterior a la versi\u00f3n 1.19.24.5415, los tokens usados en la funcionalidad de restablecimiento de contrase\u00f1a en Time Tracker se basan en la hora del sistema y, por lo tanto, son predecibles.&#xa0;Esto abre una ventana para que los ataques de fuerza bruta adivinen los tokens de los usuarios y, una vez exitosos, cambien las contrase\u00f1as de los usuarios, incluyendo la de un administrador del sistema.&#xa0;Esta vulnerabilidad es parcheada en la versi\u00f3n 1.19.24.5415 (comenz\u00f3 a usar tokens m\u00e1s seguros) con una mejora adicional en la versi\u00f3n 1.19.24.5416 (una ventana disponible limitada para adivinar tokens por fuerza bruta)"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 9.1, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.2}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 6.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.2, "impactScore": 4.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 5.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 10.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-330"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:anuko:time_tracker:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.19.24.5415", "matchCriteriaId": "3F8654E7-D4A3-483D-8F9E-B0AEEF90DBE3"}]}]}], "references": [{"url": "https://github.com/anuko/timetracker/commit/40f3d9345adc20e6f28eb9f59e2489aff87fecf5", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/anuko/timetracker/security/advisories/GHSA-43c9-rx4h-4gqq", "source": "security-advisories@github.com", "tags": ["Mitigation", "Third Party Advisory"]}, {"url": "https://www.anuko.com/time-tracker/index.htm", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/anuko/timetracker/commit/40f3d9345adc20e6f28eb9f59e2489aff87fecf5"}}