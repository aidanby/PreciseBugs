{"buggy_code": ["var log4js = require('log4js');\nvar apiLogger = log4js.getLogger(\"API\");\nvar clientLogger = log4js.getLogger(\"client\");\nvar formidable = require('formidable');\nvar apiHandler = require('../../handler/APIHandler');\n\n//This is for making an api call, collecting all post information and passing it to the apiHandler\nvar apiCaller = function(req, res, fields) {\n  res.header(\"Content-Type\", \"application/json; charset=utf-8\");\n\n  apiLogger.info(\"REQUEST, v\"+ req.params.version + \":\" + req.params.func + \", \" + JSON.stringify(fields));\n\n  //wrap the send function so we can log the response\n  //note: res._send seems to be already in use, so better use a \"unique\" name\n  res._____send = res.send;\n  res.send = function (response) {\n    response = JSON.stringify(response);\n    apiLogger.info(\"RESPONSE, \" + req.params.func + \", \" + response);\n\n    //is this a jsonp call, if yes, add the function call\n    if(req.query.jsonp)\n      response = req.query.jsonp + \"(\" + response + \")\";\n\n    res._____send(response);\n  }\n\n  //call the api handler\n  apiHandler.handle(req.params.version, req.params.func, fields, req, res);\n}\n\nexports.apiCaller = apiCaller;\n\nexports.expressCreateServer = function (hook_name, args, cb) {\n  //This is a api GET call, collect all post informations and pass it to the apiHandler\n  args.app.get('/api/:version/:func', function (req, res) {\n    apiCaller(req, res, req.query)\n  });\n\n  //This is a api POST call, collect all post informations and pass it to the apiHandler\n  args.app.post('/api/:version/:func', function(req, res) {\n    new formidable.IncomingForm().parse(req, function (err, fields, files) {\n      apiCaller(req, res, fields)\n    });\n  });\n\n  //The Etherpad client side sends information about how a disconnect happened\n  args.app.post('/ep/pad/connection-diagnostic-info', function(req, res) {\n    new formidable.IncomingForm().parse(req, function(err, fields, files) { \n      clientLogger.info(\"DIAGNOSTIC-INFO: \" + fields.diagnosticInfo);\n      res.end(\"OK\");\n    });\n  });\n\n  //The Etherpad client side sends information about client side javscript errors\n  args.app.post('/jserror', function(req, res) {\n    new formidable.IncomingForm().parse(req, function(err, fields, files) { \n      try {\n        var data = JSON.parse(fields.errorInfo)\n      }catch(e){\n        return res.end()\n      }\n      clientLogger.warn(data.msg+' --', data);\n      res.end(\"OK\");\n    });\n  });\n  \n  //Provide a possibility to query the latest available API version\n  args.app.get('/api', function (req, res) {\n     res.json({\"currentVersion\" : apiHandler.latestApiVersion});\n  });\n}\n", "{\n  \"name\"           : \"ep_etherpad-lite\",\n  \"description\"    : \"A Etherpad based on node.js\",\n  \"homepage\"       : \"http://etherpad.org\",\n  \"keywords\"       : [\"etherpad\", \"realtime\", \"collaborative\", \"editor\"],\n  \"author\"         : \"Etherpad Foundation\",\n  \"contributors\"   : [\n                      { \"name\": \"John McLear\" },\n                      { \"name\": \"Hans Pinckaers\" },\n                      { \"name\": \"Robin Buse\" },\n                      { \"name\": \"Marcel Klehr\" },\n                      { \"name\": \"Peter Martischka\" }\n                     ],\n  \"dependencies\"   : {\n                      \"etherpad-yajsml\"         : \"0.0.2\",\n                      \"request\"                 : \"2.83.0\",\n                      \"etherpad-require-kernel\" : \"1.0.9\",\n                      \"resolve\"                 : \"1.1.7\",\n                      \"socket.io\"               : \"1.7.3\",\n                      \"ueberdb2\"                : \"0.3.0\",\n                      \"express\"                 : \"4.13.4\",\n                      \"express-session\"         : \"1.13.0\",\n                      \"cookie-parser\"           : \"1.3.4\",\n                      \"async\"                   : \"0.9.0\",\n                      \"clean-css\"               : \"3.4.19\",\n                      \"uglify-js\"               : \"2.6.2\",\n                      \"formidable\"              : \"1.0.17\",\n                      \"log4js\"                  : \"0.6.35\",\n                      \"cheerio\"                 : \"0.20.0\",\n                      \"async-stacktrace\"        : \"0.0.2\",\n                      \"npm\"                     : \"4.0.2\",\n                      \"ejs\"                     : \"2.5.7\",\n                      \"graceful-fs\"             : \"4.1.3\",\n                      \"slide\"                   : \"1.1.6\",\n                      \"semver\"                  : \"5.1.0\",\n                      \"security\"                : \"1.0.0\",\n                      \"tinycon\"                 : \"0.0.1\",\n                      \"underscore\"              : \"1.8.3\",\n                      \"unorm\"                   : \"1.4.1\",\n                      \"languages4translatewiki\" : \"0.1.3\",\n                      \"swagger-node-express\"    : \"2.1.3\",\n                      \"channels\"                : \"0.0.4\",\n                      \"jsonminify\"              : \"0.4.1\",\n                      \"measured\"                : \"1.1.0\",\n                      \"mocha\"                   : \"2.4.5\",\n                      \"supertest\"               : \"1.2.0\"\n                     },\n  \"bin\":             { \"etherpad-lite\": \"./node/server.js\" },\n  \"devDependencies\": {\n                      \"wd\"      : \"0.3.11\"\n                     },\n  \"engines\"        : { \"node\" : \">=0.10.0\",\n                       \"npm\"  : \">=1.0\"\n                     },\n  \"repository\"     : { \"type\" : \"git\",\n                       \"url\" : \"http://github.com/ether/etherpad-lite.git\"\n                     },\n  \"version\"        : \"1.6.2\",\n  \"license\"        : \"Apache-2.0\"\n}\n"], "fixing_code": ["var log4js = require('log4js');\nvar apiLogger = log4js.getLogger(\"API\");\nvar clientLogger = log4js.getLogger(\"client\");\nvar formidable = require('formidable');\nvar apiHandler = require('../../handler/APIHandler');\n\n//This is for making an api call, collecting all post information and passing it to the apiHandler\nvar apiCaller = function(req, res, fields) {\n  res.header(\"Content-Type\", \"application/json; charset=utf-8\");\n\n  apiLogger.info(\"REQUEST, v\"+ req.params.version + \":\" + req.params.func + \", \" + JSON.stringify(fields));\n\n  //wrap the send function so we can log the response\n  //note: res._send seems to be already in use, so better use a \"unique\" name\n  res._____send = res.send;\n  res.send = function (response) {\n    response = JSON.stringify(response);\n    apiLogger.info(\"RESPONSE, \" + req.params.func + \", \" + response);\n\n    //is this a jsonp call, if yes, add the function call\n    if(req.query.jsonp && isVarName(response))\n      response = req.query.jsonp + \"(\" + response + \")\";\n\n    res._____send(response);\n  }\n\n  //call the api handler\n  apiHandler.handle(req.params.version, req.params.func, fields, req, res);\n}\n\nexports.apiCaller = apiCaller;\n\nexports.expressCreateServer = function (hook_name, args, cb) {\n  //This is a api GET call, collect all post informations and pass it to the apiHandler\n  args.app.get('/api/:version/:func', function (req, res) {\n    apiCaller(req, res, req.query)\n  });\n\n  //This is a api POST call, collect all post informations and pass it to the apiHandler\n  args.app.post('/api/:version/:func', function(req, res) {\n    new formidable.IncomingForm().parse(req, function (err, fields, files) {\n      apiCaller(req, res, fields)\n    });\n  });\n\n  //The Etherpad client side sends information about how a disconnect happened\n  args.app.post('/ep/pad/connection-diagnostic-info', function(req, res) {\n    new formidable.IncomingForm().parse(req, function(err, fields, files) { \n      clientLogger.info(\"DIAGNOSTIC-INFO: \" + fields.diagnosticInfo);\n      res.end(\"OK\");\n    });\n  });\n\n  //The Etherpad client side sends information about client side javscript errors\n  args.app.post('/jserror', function(req, res) {\n    new formidable.IncomingForm().parse(req, function(err, fields, files) { \n      try {\n        var data = JSON.parse(fields.errorInfo)\n      }catch(e){\n        return res.end()\n      }\n      clientLogger.warn(data.msg+' --', data);\n      res.end(\"OK\");\n    });\n  });\n  \n  //Provide a possibility to query the latest available API version\n  args.app.get('/api', function (req, res) {\n     res.json({\"currentVersion\" : apiHandler.latestApiVersion});\n  });\n}\n", "{\n  \"name\"           : \"ep_etherpad-lite\",\n  \"description\"    : \"A Etherpad based on node.js\",\n  \"homepage\"       : \"http://etherpad.org\",\n  \"keywords\"       : [\"etherpad\", \"realtime\", \"collaborative\", \"editor\"],\n  \"author\"         : \"Etherpad Foundation\",\n  \"contributors\"   : [\n                      { \"name\": \"John McLear\" },\n                      { \"name\": \"Hans Pinckaers\" },\n                      { \"name\": \"Robin Buse\" },\n                      { \"name\": \"Marcel Klehr\" },\n                      { \"name\": \"Peter Martischka\" }\n                     ],\n  \"dependencies\"   : {\n                      \"etherpad-yajsml\"         : \"0.0.2\",\n                      \"request\"                 : \"2.83.0\",\n                      \"etherpad-require-kernel\" : \"1.0.9\",\n                      \"resolve\"                 : \"1.1.7\",\n                      \"socket.io\"               : \"1.7.3\",\n                      \"ueberdb2\"                : \"0.3.0\",\n                      \"express\"                 : \"4.13.4\",\n                      \"express-session\"         : \"1.13.0\",\n                      \"cookie-parser\"           : \"1.3.4\",\n                      \"async\"                   : \"0.9.0\",\n                      \"clean-css\"               : \"3.4.19\",\n                      \"uglify-js\"               : \"2.6.2\",\n                      \"formidable\"              : \"1.0.17\",\n                      \"log4js\"                  : \"0.6.35\",\n                      \"cheerio\"                 : \"0.20.0\",\n                      \"async-stacktrace\"        : \"0.0.2\",\n                      \"npm\"                     : \"4.0.2\",\n                      \"ejs\"                     : \"2.5.7\",\n                      \"graceful-fs\"             : \"4.1.3\",\n                      \"slide\"                   : \"1.1.6\",\n                      \"semver\"                  : \"5.1.0\",\n                      \"security\"                : \"1.0.0\",\n                      \"tinycon\"                 : \"0.0.1\",\n                      \"underscore\"              : \"1.8.3\",\n                      \"unorm\"                   : \"1.4.1\",\n                      \"languages4translatewiki\" : \"0.1.3\",\n                      \"swagger-node-express\"    : \"2.1.3\",\n                      \"channels\"                : \"0.0.4\",\n                      \"jsonminify\"              : \"0.4.1\",\n                      \"measured\"                : \"1.1.0\",\n                      \"mocha\"                   : \"2.4.5\",\n                      \"supertest\"               : \"1.2.0\",\n                      \"is-var-name\"             : \"1.0.0\"\n                     },\n  \"bin\":             { \"etherpad-lite\": \"./node/server.js\" },\n  \"devDependencies\": {\n                      \"wd\"      : \"0.3.11\"\n                     },\n  \"engines\"        : { \"node\" : \">=0.10.0\",\n                       \"npm\"  : \">=1.0\"\n                     },\n  \"repository\"     : { \"type\" : \"git\",\n                       \"url\" : \"http://github.com/ether/etherpad-lite.git\"\n                     },\n  \"version\"        : \"1.6.2\",\n  \"license\"        : \"Apache-2.0\"\n}\n"], "filenames": ["src/node/hooks/express/apicalls.js", "src/package.json"], "buggy_code_start_loc": [21, 46], "buggy_code_end_loc": [22, 47], "fixing_code_start_loc": [21, 46], "fixing_code_end_loc": [22, 48], "type": "CWE-20", "message": "node/hooks/express/apicalls.js in Etherpad Lite before v1.6.3 mishandles JSONP, which allows remote attackers to bypass intended access restrictions.", "other": {"cve": {"id": "CVE-2018-6835", "sourceIdentifier": "cve@mitre.org", "published": "2018-02-08T07:29:01.147", "lastModified": "2019-10-03T00:03:26.223", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "node/hooks/express/apicalls.js in Etherpad Lite before v1.6.3 mishandles JSONP, which allows remote attackers to bypass intended access restrictions."}, {"lang": "es", "value": "node/hooks/express/apicalls.js en Etherpad Lite, en versiones anteriores a la v1.6.3, gestiona JSONP de manera incorrecta, lo que permite que atacantes remotos omitan las restricciones de acceso planeadas."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": true, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-20"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:etherpad:etherpad:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.6.3", "matchCriteriaId": "DF94DB96-E070-478F-9EFC-0AFA52ED1240"}]}]}], "references": [{"url": "https://github.com/ether/etherpad-lite/commit/626e58cc5af1db3691b41fca7b06c28ea43141b1", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/ether/etherpad-lite/releases/tag/1.6.3", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/ether/etherpad-lite/commit/626e58cc5af1db3691b41fca7b06c28ea43141b1"}}