{"buggy_code": ["%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global _hardened_build 1\n\n%global fipscheck_version 1.3.0\n%global buildefence 0\n%global development 0\n\n#global prever rc1\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\n# version is generated in the release script\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}1%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nBuildRequires: systemd systemd-units\nRequires(post): coreutils bash systemd-units\nRequires(preun): systemd-units\nRequires(postun): systemd-units\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig hostname\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\n# we need fipshmac\nRequires: fipscheck%{_isa} >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  INITSYSTEM=systemd \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n  USE_FIPSCHECK=\"%{USE_FIPSCHECK}\" \\\n  USE_LIBCAP_NG=\"%{USE_LIBCAP_NG}\" \\\n  USE_LABELED_IPSEC=\"%{USE_LABELED_IPSEC}\" \\\n%if %{USE_CRL_FETCHING}\n  USE_LDAP=true \\\n  USE_LIBCURL=true \\\n%endif\n  USE_DNSSEC=\"%{USE_DNSSEC}\" \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n    %{?__debug_package:%{__debug_install_post}} \\\n    %{__arch_install_post} \\\n    %{__os_install_post} \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck ` ls %{buildroot}%{_libexecdir}/ipsec/*|grep -v setup` \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_sbindir}/ipsec \\\n%{nil}\n%endif\n\n%install\nrm -rf ${RPM_BUILD_ROOT}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  INITSYSTEM=systemd \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\n%if %{USE_FIPSCHECK}\nmkdir -p %{buildroot}%{_libdir}/fipscheck\n%endif\n\necho \"include /etc/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}/etc/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %{_unitdir}/ipsec.service\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_sbindir}/ipsec\n%{_libexecdir}/ipsec\n%attr(0644,root,root) %doc %{_mandir}/*/*\n\n%if %{USE_FIPSCHECK}\n%{_libdir}/fipscheck/*.hmac\n%endif\n\n%preun\nif [ $1 -eq 0 ] ; then\n    # Package removal, not upgrade\n    /bin/systemctl --no-reload disable ipsec.service > /dev/null 2>&1 || :\n    /bin/systemctl stop ipsec.service > /dev/null 2>&1 || :\nfi\n\n%postun\n/bin/systemctl daemon-reload >/dev/null 2>&1 || :\nif [ $1 -ge 1 ] ; then\n    # Package upgrade, not uninstall\n    /bin/systemctl try-restart ipsec.service >/dev/null 2>&1 || :\nfi\n\n\n%post \nif [ $1 -eq 1 ] ; then \n    # Initial installation \n    /bin/systemctl daemon-reload >/dev/null 2>&1 || :\nfi\nif [ ! -f /etc/ipsec.d/cert8.db ] ; then\necho > /var/tmp/libreswan-nss-pwd\ncertutil -N -f /var/tmp/libreswan-nss-pwd -d /etc/ipsec.d\nrestorecon /etc/ipsec.d/*db 2>/dev/null || :\nrm /var/tmp/libreswan-nss-pwd\nfi\n\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSEBASEVERSION-1\n- Automated build from release tar ball\n", "%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global _hardened_build 1\n\n%global fipscheck_version 1.3.0\n%global buildefence 0\n%global development 0\n\n#global prever rc1\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\n# version is generated in the release script\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}1%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nBuildRequires: systemd systemd-units\nRequires(post): coreutils bash systemd\nRequires(preun): systemd\nRequires(postun): systemd\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig hostname\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\nRequires: fipscheck%{_isa} >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  INITSYSTEM=systemd \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n%if %{USE_FIPSCHECK}\n  USE_FIPSCHECK=\"%{USE_FIPSCHECK}\" \\\n  FIPSPRODUCTCHECK=/etc/system-fips \\\n%endif\n  USE_LIBCAP_NG=\"%{USE_LIBCAP_NG}\" \\\n  USE_LABELED_IPSEC=\"%{USE_LABELED_IPSEC}\" \\\n%if %{USE_CRL_FETCHING}\n  USE_LDAP=true \\\n  USE_LIBCURL=true \\\n%endif\n  USE_DNSSEC=\"%{USE_DNSSEC}\" \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n    %{?__debug_package:%{__debug_install_post}} \\\n    %{__arch_install_post} \\\n    %{__os_install_post} \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_libexecdir}/ipsec/* \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_sbindir}/ipsec \\\n%{nil}\n%endif\n\n%install\nrm -rf ${RPM_BUILD_ROOT}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  INITSYSTEM=systemd \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\n%if %{USE_FIPSCHECK}\nmkdir -p %{buildroot}%{_libdir}/fipscheck\ninstall -d %{buildroot}%{_sysconfdir}/prelink.conf.d/\ninstall -m644 packaging/fedora/libreswan-prelink.conf %{buildroot}%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\necho \"include /etc/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}/etc/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %{_unitdir}/ipsec.service\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_sbindir}/ipsec\n%{_libexecdir}/ipsec\n%attr(0644,root,root) %doc %{_mandir}/*/*\n\n%if %{USE_FIPSCHECK}\n%{_libdir}/fipscheck/*.hmac\n# We own the directory so we don't have to require prelink\n%attr(0755,root,root) %dir %{_sysconfdir}/prelink.conf.d/\n%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\n%preun\n%systemd_preun ipsec.service\n\n%postun\n%systemd_postun_with_restart ipsec.service\n\n%post \n%systemd_post ipsec.service\nif [ ! -f /etc/ipsec.d/cert8.db ] ; then\necho > /var/tmp/libreswan-nss-pwd\ncertutil -N -f /var/tmp/libreswan-nss-pwd -d /etc/ipsec.d\nrestorecon /etc/ipsec.d/*db 2>/dev/null || :\nrm /var/tmp/libreswan-nss-pwd\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSECBASEVERSION-1\n- Automated build from release tar ball\n", "%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global _hardened_build 1\n\n%global fipscheck_version 1.3.0\n%global buildefence 0\n%global development 0\n\n#global prever rc1\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\n# version is generated in the release script\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}1%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nBuildRequires: systemd systemd-units\nRequires(post): coreutils bash systemd\nRequires(preun): systemd\nRequires(postun): systemd\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig hostname\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\nRequires: fipscheck%{_isa} >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  INITSYSTEM=systemd \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n%if %{USE_FIPSCHECK}\n  USE_FIPSCHECK=\"%{USE_FIPSCHECK}\" \\\n  FIPSPRODUCTCHECK=/etc/system-fips \\\n%endif\n  USE_LIBCAP_NG=\"%{USE_LIBCAP_NG}\" \\\n  USE_LABELED_IPSEC=\"%{USE_LABELED_IPSEC}\" \\\n%if %{USE_CRL_FETCHING}\n  USE_LDAP=true \\\n  USE_LIBCURL=true \\\n%endif\n  USE_DNSSEC=\"%{USE_DNSSEC}\" \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n    %{?__debug_package:%{__debug_install_post}} \\\n    %{__arch_install_post} \\\n    %{__os_install_post} \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_libexecdir}/ipsec/* \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_sbindir}/ipsec \\\n%{nil}\n%endif\n\n%install\nrm -rf ${RPM_BUILD_ROOT}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  INITSYSTEM=systemd \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\n%if %{USE_FIPSCHECK}\nmkdir -p %{buildroot}%{_libdir}/fipscheck\ninstall -d %{buildroot}%{_sysconfdir}/prelink.conf.d/\ninstall -m644 packaging/fedora/libreswan-prelink.conf %{buildroot}%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\necho \"include /etc/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}/etc/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %{_unitdir}/ipsec.service\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_sbindir}/ipsec\n%{_libexecdir}/ipsec\n%attr(0644,root,root) %doc %{_mandir}/*/*\n\n%if %{USE_FIPSCHECK}\n%{_libdir}/fipscheck/*.hmac\n# We own the directory so we don't have to require prelink\n%attr(0755,root,root) %dir %{_sysconfdir}/prelink.conf.d/\n%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\n%preun\n%systemd_preun ipsec.service\n\n%postun\n%systemd_postun_with_restart ipsec.service\n\n%post \n%systemd_post ipsec.service\nif [ ! -f /etc/ipsec.d/cert8.db ] ; then\necho > /var/tmp/libreswan-nss-pwd\ncertutil -N -f /var/tmp/libreswan-nss-pwd -d /etc/ipsec.d\nrestorecon /etc/ipsec.d/*db 2>/dev/null || :\nrm /var/tmp/libreswan-nss-pwd\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSECBASEVERSION-1\n- Automated build from release tar ball\n", "%define USE_FIPSCHECK true\n%define USE_LABELED_IPSEC true\n%define USE_CRL_FETCHING true\n%define USE_DNSSEC true\n%define USE_NM true\n%define USE_LINUX_AUDIT true\n# Eanble for OCF, requires <crypto/cryptodev.h> See ocf-linux.sourceforge.net\n%define USE_OCF 0\n# Not available for RHEL5\n%define USE_LIBCAP_NG 0\n\n%define fipscheck_version 1.2.0-1\n%define buildefence 0\n%define development 0\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\n# version is generated in the release script\nVersion: IPSECBASEVERSION\n\n# The default kernel version to build for is the latest of\n# the installed binary kernel\n# This can be overridden by \"--define 'kversion x.x.x-y.y.y'\"\n%define defkv %(rpm -q kernel kernel-lt kernel-debug| grep -v \"not installed\" | sed -e \"s/kernel-debug-//\" -e  \"s/kernel-//\" -e \"s/\\.[^.]*$//\"  | sort | tail -1 )\n%{!?kversion: %{expand: %%define kversion %defkv}}\n%define krelver %(echo %{kversion} | tr -s '-' '_')\n# Libreswan -pre/-rc nomenclature has to co-exist with hyphen paranoia\n%define srcpkgver %(echo %{version} | tr -s '_' '-')\n\nRelease: 1%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: %{name}-%{srcpkgver}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nRequires(post): coreutils bash\nRequires(preun): initscripts chkconfig\nRequires(post): /sbin/chkconfig\nRequires(preun): /sbin/chkconfig\nRequires(preun): /sbin/service\nBuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)\n\nBuildRequires: pkgconfig net-tools\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\n# we need fipshmac\nRequires: fipscheck >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{srcpkgver}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing\" \\\n%endif\n  INITSYSTEM=sysvinit \\\n  USERLINK=\"-g -pie %{?efence}\" \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n  USE_FIPSCHECK=%{USE_FIPSCHECK} \\\n  USE_LIBCAP_NG=%{USE_LIBCAP_NG} \\\n%if %{USE_OCF}\n  USE_OCF=true \\\n%endif\n  USE_LABELED_IPSEC=%{USE_LABELED_IPSEC} \\\n  USE_LDAP=%{USE_CRL_FETCHING} \\\n  USE_LIBCURL=%{USE_CRL_FETCHING} \\\n  USE_DNSSEC=%{USE_DNSSEC} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n  %{?__debug_package:%{__debug_install_post}} \\\n  %{__arch_install_post} \\\n  %{__os_install_post} \\\n  fipshmac %{buildroot}%{_sbindir}/ipsec \\\n  fipshmac %{buildroot}%{_libexecdir}/ipsec/* \\\n%{nil}\n%endif\n\n%install\nrm -rf %{buildroot}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INITSYSTEM=sysvinit \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\necho \"include /etc/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}/etc/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_initrddir}/ipsec\n%{_libexecdir}/ipsec\n%{_sbindir}/ipsec\n%attr(0644,root,root) %{_mandir}/*/*.gz\n\n%if %{USE_FIPSCHECK}\n%{_sbindir}/.ipsec.hmac\n%endif\n\n%preun\nif [ $1 -eq 0 ]; then\n        /sbin/service ipsec stop > /dev/null 2>&1 || :\n        /sbin/chkconfig --del ipsec\nfi\n\n%postun\nif [ $1 -ge 1 ] ; then\n /sbin/service ipsec condrestart 2>&1 >/dev/null || :\nfi\n\n%post \n/sbin/chkconfig --add ipsec || :\nif [ ! -f /etc/ipsec.d/cert8.db ] ; then\necho > /var/tmp/libreswan-nss-pwd\ncertutil -N -f /var/tmp/libreswan-nss-pwd -d /etc/ipsec.d\nrestorecon /etc/ipsec.d/*db 2>/dev/null || :\nrm /var/tmp/libreswan-nss-pwd\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - 3.1-1\n- Automated build from release tar ball\n\n", "%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global fipscheck_version 1.2.0-1\n%global buildefence 0\n%global development 0\n\n#global prever rc1\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}1%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nRequires(post): coreutils bash\nRequires(preun): initscripts chkconfig\nRequires(post): /sbin/chkconfig\nRequires(preun): /sbin/chkconfig\nRequires(preun): /sbin/service\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig net-tools\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\n# we need fipshmac\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\nRequires: fipscheck%{_isa} >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %global efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  INITSYSTEM=sysvinit \\\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n  USE_FIPSCHECK=%{USE_FIPSCHECK} \\\n  FIPSPRODUCTCHECK=\"/etc/system-fips\" \\\n  USE_LIBCAP_NG=%{USE_LIBCAP_NG} \\\n  USE_LABELED_IPSEC=%{USE_LABELED_IPSEC} \\\n  USE_LDAP=%{USE_CRL_FETCHING} \\\n  USE_LIBCURL=%{USE_CRL_FETCHING} \\\n  USE_DNSSEC=%{USE_DNSSEC} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n  %{?__debug_package:%{__debug_install_post}} \\\n  %{__arch_install_post} \\\n  %{__os_install_post} \\\n  fipshmac %{buildroot}%{_sbindir}/ipsec \\\n  fipshmac %{buildroot}%{_libexecdir}/ipsec/* \\\n%{nil}\n%endif\n\n%install\nrm -rf %{buildroot}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INITSYSTEM=sysvinit \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n# replace with rhel[56] specific version\ninstall -m 0755 initsystems/sysvinit/init.rhel %{buildroot}%{_initrddir}/ipsec\n\necho \"include /etc/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}/etc/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_initrddir}/ipsec\n%{_libexecdir}/ipsec\n%{_sbindir}/ipsec\n%attr(0644,root,root) %{_mandir}/*/*.gz\n\n%if %{USE_FIPSCHECK}\n%{_sbindir}/.ipsec.hmac\n%endif\n\n%preun\nif [ $1 -eq 0 ]; then\n        /sbin/service ipsec stop > /dev/null 2>&1 || :\n        /sbin/chkconfig --del ipsec\nfi\n\n%postun\nif [ $1 -ge 1 ] ; then\n /sbin/service ipsec condrestart 2>&1 >/dev/null || :\nfi\n\n%post \n/sbin/chkconfig --add ipsec || :\n%if %{USE_FIPSCHECK}\nprelink -u %{_libexecdir}/ipsec/* 2>/dev/null || :\n%endif\nif [ ! -f /etc/ipsec.d/cert8.db ] ; then\necho > /var/tmp/libreswan-nss-pwd\ncertutil -N -f /var/tmp/libreswan-nss-pwd -d /etc/ipsec.d\nrestorecon /etc/ipsec.d/*db 2>/dev/null || :\nrm /var/tmp/libreswan-nss-pwd\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSECBASEVERSION-1\n- Automated build from release tar ball\n\n", "%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global _hardened_build 1\n\n%global buildefence 0\n%global development 0\n\n#global prever rc6\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}2%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nBuildRequires: systemd\nRequires(post): coreutils bash systemd\nRequires(preun): systemd\nRequires(postun): systemd\nRequires: iproute\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig hostname\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel\n# we need fipshmac\nRequires: fipscheck%{_isa}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is\nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and\ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  INITSYSTEM=systemd \\\n  USE_DYNAMICDNS=\"true\" \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n  USE_FIPSCHECK=\"%{USE_FIPSCHECK}\" \\\n  USE_LIBCAP_NG=\"%{USE_LIBCAP_NG}\" \\\n  USE_LABELED_IPSEC=\"%{USE_LABELED_IPSEC}\" \\\n%if %{USE_CRL_FETCHING}\n  USE_LDAP=true \\\n  USE_LIBCURL=true \\\n%endif\n  USE_DNSSEC=\"%{USE_DNSSEC}\" \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n    %{?__debug_package:%{__debug_install_post}} \\\n    %{__arch_install_post} \\\n    %{__os_install_post} \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_libexecdir}/ipsec/* \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_sbindir}/ipsec \\\n%{nil}\n%endif\n\n%install\nrm -rf ${RPM_BUILD_ROOT}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  INITSYSTEM=systemd \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase\ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\n%if %{USE_FIPSCHECK}\nmkdir -p %{buildroot}%{_libdir}/fipscheck\ninstall -d %{buildroot}%{_sysconfdir}/prelink.conf.d/\ninstall -m644 packaging/fedora/libreswan-prelink.conf %{buildroot}%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\necho \"include /etc/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}/etc/rc.d/rc*\n\n%files\n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %{_unitdir}/ipsec.service\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_sbindir}/ipsec\n%{_libexecdir}/ipsec\n%attr(0644,root,root) %doc %{_mandir}/*/*\n\n%if %{USE_FIPSCHECK}\n%{_libdir}/fipscheck/*.hmac\n# We own the directory so we don't have to require prelink\n%attr(0755,root,root) %dir %{_sysconfdir}/prelink.conf.d/\n%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\n%preun\n%systemd_preun ipsec.service\n\n%postun\n%systemd_postun_with_restart ipsec.service\n\n%post\n%systemd_post ipsec.service\n%if %{USE_FIPSCHECK}\nprelink -u %{_libexecdir}/ipsec/* 2>/dev/null || :\n%endif\nif [ ! -f /etc/ipsec.d/cert8.db ] ; then\necho > /var/tmp/libreswan-nss-pwd\ncertutil -N -f /var/tmp/libreswan-nss-pwd -d /etc/ipsec.d\nrestorecon /etc/ipsec.d/*db 2>/dev/null || :\nrm /var/tmp/libreswan-nss-pwd\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSECBASEVERSION-1\n- Automated build from release tar ball\n"], "fixing_code": ["%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global _hardened_build 1\n\n%global fipscheck_version 1.3.0\n%global buildefence 0\n%global development 0\n\n#global prever rc1\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\n# version is generated in the release script\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}1%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nBuildRequires: systemd systemd-units\nRequires(post): coreutils bash systemd-units\nRequires(preun): systemd-units\nRequires(postun): systemd-units\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig hostname\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\n# we need fipshmac\nRequires: fipscheck%{_isa} >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  INITSYSTEM=systemd \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n  USE_FIPSCHECK=\"%{USE_FIPSCHECK}\" \\\n  USE_LIBCAP_NG=\"%{USE_LIBCAP_NG}\" \\\n  USE_LABELED_IPSEC=\"%{USE_LABELED_IPSEC}\" \\\n%if %{USE_CRL_FETCHING}\n  USE_LDAP=true \\\n  USE_LIBCURL=true \\\n%endif\n  USE_DNSSEC=\"%{USE_DNSSEC}\" \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n    %{?__debug_package:%{__debug_install_post}} \\\n    %{__arch_install_post} \\\n    %{__os_install_post} \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck ` ls %{buildroot}%{_libexecdir}/ipsec/*|grep -v setup` \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_sbindir}/ipsec \\\n%{nil}\n%endif\n\n%install\nrm -rf ${RPM_BUILD_ROOT}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  INITSYSTEM=systemd \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\n%if %{USE_FIPSCHECK}\nmkdir -p %{buildroot}%{_libdir}/fipscheck\n%endif\n\necho \"include %{_sysconfdir}/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}%{_sysconfdir}/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %{_unitdir}/ipsec.service\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_sbindir}/ipsec\n%{_libexecdir}/ipsec\n%attr(0644,root,root) %doc %{_mandir}/*/*\n\n%if %{USE_FIPSCHECK}\n%{_libdir}/fipscheck/*.hmac\n%endif\n\n%preun\nif [ $1 -eq 0 ] ; then\n    # Package removal, not upgrade\n    /bin/systemctl --no-reload disable ipsec.service > /dev/null 2>&1 || :\n    /bin/systemctl stop ipsec.service > /dev/null 2>&1 || :\nfi\n\n%postun\n/bin/systemctl daemon-reload >/dev/null 2>&1 || :\nif [ $1 -ge 1 ] ; then\n    # Package upgrade, not uninstall\n    /bin/systemctl try-restart ipsec.service >/dev/null 2>&1 || :\nfi\n\n\n%post \nif [ $1 -eq 1 ] ; then \n    # Initial installation \n    /bin/systemctl daemon-reload >/dev/null 2>&1 || :\nfi\nif [ ! -f %{_sysconfdir}/ipsec.d/cert8.db ] ; then\n    TEMPFILE=$(/bin/mktemp %{_sysconfdir}/ipsec.d/nsspw.XXXXXXX)\n    [ $? -gt 0 ] && TEMPFILE=%{_sysconfdir}/ipsec.d/nsspw.$$\n    echo > ${TEMPFILE}\n    certutil -N -f ${TEMPFILE} -d %{_sysconfdir}/ipsec.d\n    restorecon %{_sysconfdir}/ipsec.d/*db 2>/dev/null || :\n    rm -f ${TEMPFILE}\nfi\n\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSEBASEVERSION-1\n- Automated build from release tar ball\n", "%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global _hardened_build 1\n\n%global fipscheck_version 1.3.0\n%global buildefence 0\n%global development 0\n\n#global prever rc1\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\n# version is generated in the release script\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}1%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nBuildRequires: systemd systemd-units\nRequires(post): coreutils bash systemd\nRequires(preun): systemd\nRequires(postun): systemd\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig hostname\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\nRequires: fipscheck%{_isa} >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  INITSYSTEM=systemd \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n%if %{USE_FIPSCHECK}\n  USE_FIPSCHECK=\"%{USE_FIPSCHECK}\" \\\n  FIPSPRODUCTCHECK=%{_sysconfdir}/system-fips \\\n%endif\n  USE_LIBCAP_NG=\"%{USE_LIBCAP_NG}\" \\\n  USE_LABELED_IPSEC=\"%{USE_LABELED_IPSEC}\" \\\n%if %{USE_CRL_FETCHING}\n  USE_LDAP=true \\\n  USE_LIBCURL=true \\\n%endif\n  USE_DNSSEC=\"%{USE_DNSSEC}\" \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n    %{?__debug_package:%{__debug_install_post}} \\\n    %{__arch_install_post} \\\n    %{__os_install_post} \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_libexecdir}/ipsec/* \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_sbindir}/ipsec \\\n%{nil}\n%endif\n\n%install\nrm -rf ${RPM_BUILD_ROOT}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  INITSYSTEM=systemd \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\n%if %{USE_FIPSCHECK}\nmkdir -p %{buildroot}%{_libdir}/fipscheck\ninstall -d %{buildroot}%{_sysconfdir}/prelink.conf.d/\ninstall -m644 packaging/fedora/libreswan-prelink.conf %{buildroot}%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\necho \"include %{_sysconfdir}/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}%{_sysconfdir}/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %{_unitdir}/ipsec.service\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_sbindir}/ipsec\n%{_libexecdir}/ipsec\n%attr(0644,root,root) %doc %{_mandir}/*/*\n\n%if %{USE_FIPSCHECK}\n%{_libdir}/fipscheck/*.hmac\n# We own the directory so we don't have to require prelink\n%attr(0755,root,root) %dir %{_sysconfdir}/prelink.conf.d/\n%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\n%preun\n%systemd_preun ipsec.service\n\n%postun\n%systemd_postun_with_restart ipsec.service\n\n%post \n%systemd_post ipsec.service\nif [ ! -f %{_sysconfdir}/ipsec.d/cert8.db ] ; then\n    TEMPFILE=$(/bin/mktemp %{_sysconfdir}/ipsec.d/nsspw.XXXXXXX)\n    [ $? -gt 0 ] && TEMPFILE=%{_sysconfdir}/ipsec.d/nsspw.$$\n    echo > ${TEMPFILE}\n    certutil -N -f ${TEMPFILE} -d %{_sysconfdir}/ipsec.d\n    restorecon %{_sysconfdir}/ipsec.d/*db 2>/dev/null || :\n    rm -f ${TEMPFILE}\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSECBASEVERSION-1\n- Automated build from release tar ball\n", "%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global _hardened_build 1\n\n%global fipscheck_version 1.3.0\n%global buildefence 0\n%global development 0\n\n#global prever rc1\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\n# version is generated in the release script\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}1%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nBuildRequires: systemd systemd-units\nRequires(post): coreutils bash systemd\nRequires(preun): systemd\nRequires(postun): systemd\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig hostname\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\nRequires: fipscheck%{_isa} >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  INITSYSTEM=systemd \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n%if %{USE_FIPSCHECK}\n  USE_FIPSCHECK=\"%{USE_FIPSCHECK}\" \\\n  FIPSPRODUCTCHECK=%{_syconfdir}/system-fips \\\n%endif\n  USE_LIBCAP_NG=\"%{USE_LIBCAP_NG}\" \\\n  USE_LABELED_IPSEC=\"%{USE_LABELED_IPSEC}\" \\\n%if %{USE_CRL_FETCHING}\n  USE_LDAP=true \\\n  USE_LIBCURL=true \\\n%endif\n  USE_DNSSEC=\"%{USE_DNSSEC}\" \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n    %{?__debug_package:%{__debug_install_post}} \\\n    %{__arch_install_post} \\\n    %{__os_install_post} \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_libexecdir}/ipsec/* \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_sbindir}/ipsec \\\n%{nil}\n%endif\n\n%install\nrm -rf ${RPM_BUILD_ROOT}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  INITSYSTEM=systemd \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\n%if %{USE_FIPSCHECK}\nmkdir -p %{buildroot}%{_libdir}/fipscheck\ninstall -d %{buildroot}%{_sysconfdir}/prelink.conf.d/\ninstall -m644 packaging/fedora/libreswan-prelink.conf %{buildroot}%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\necho \"include %{_syconfdir}/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}%{_syconfdir}/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %{_unitdir}/ipsec.service\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_sbindir}/ipsec\n%{_libexecdir}/ipsec\n%attr(0644,root,root) %doc %{_mandir}/*/*\n\n%if %{USE_FIPSCHECK}\n%{_libdir}/fipscheck/*.hmac\n# We own the directory so we don't have to require prelink\n%attr(0755,root,root) %dir %{_sysconfdir}/prelink.conf.d/\n%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\n%preun\n%systemd_preun ipsec.service\n\n%postun\n%systemd_postun_with_restart ipsec.service\n\n%post \n%systemd_post ipsec.service\nif [ ! -f %{_sysconfdir}/ipsec.d/cert8.db ] ; then\n    TEMPFILE=$(/bin/mktemp %{_sysconfdir}/ipsec.d/nsspw.XXXXXXX)\n    [ $? -gt 0 ] && TEMPFILE=%{_sysconfdir}/ipsec.d/nsspw.$$\n    echo > ${TEMPFILE}\n    certutil -N -f ${TEMPFILE} -d %{_sysconfdir}/ipsec.d\n    restorecon %{_sysconfdir}/ipsec.d/*db 2>/dev/null || :\n    rm -f ${TEMPFILE}\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSECBASEVERSION-1\n- Automated build from release tar ball\n", "%define USE_FIPSCHECK true\n%define USE_LABELED_IPSEC true\n%define USE_CRL_FETCHING true\n%define USE_DNSSEC true\n%define USE_NM true\n%define USE_LINUX_AUDIT true\n# Eanble for OCF, requires <crypto/cryptodev.h> See ocf-linux.sourceforge.net\n%define USE_OCF 0\n# Not available for RHEL5\n%define USE_LIBCAP_NG 0\n\n%define fipscheck_version 1.2.0-1\n%define buildefence 0\n%define development 0\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\n# version is generated in the release script\nVersion: IPSECBASEVERSION\n\n# The default kernel version to build for is the latest of\n# the installed binary kernel\n# This can be overridden by \"--define 'kversion x.x.x-y.y.y'\"\n%define defkv %(rpm -q kernel kernel-lt kernel-debug| grep -v \"not installed\" | sed -e \"s/kernel-debug-//\" -e  \"s/kernel-//\" -e \"s/\\.[^.]*$//\"  | sort | tail -1 )\n%{!?kversion: %{expand: %%define kversion %defkv}}\n%define krelver %(echo %{kversion} | tr -s '-' '_')\n# Libreswan -pre/-rc nomenclature has to co-exist with hyphen paranoia\n%define srcpkgver %(echo %{version} | tr -s '_' '-')\n\nRelease: 1%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: %{name}-%{srcpkgver}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nRequires(post): coreutils bash\nRequires(preun): initscripts chkconfig\nRequires(post): /sbin/chkconfig\nRequires(preun): /sbin/chkconfig\nRequires(preun): /sbin/service\nBuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)\n\nBuildRequires: pkgconfig net-tools\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\n# we need fipshmac\nRequires: fipscheck >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{srcpkgver}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing\" \\\n%endif\n  INITSYSTEM=sysvinit \\\n  USERLINK=\"-g -pie %{?efence}\" \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n  USE_FIPSCHECK=%{USE_FIPSCHECK} \\\n  USE_LIBCAP_NG=%{USE_LIBCAP_NG} \\\n%if %{USE_OCF}\n  USE_OCF=true \\\n%endif\n  USE_LABELED_IPSEC=%{USE_LABELED_IPSEC} \\\n  USE_LDAP=%{USE_CRL_FETCHING} \\\n  USE_LIBCURL=%{USE_CRL_FETCHING} \\\n  USE_DNSSEC=%{USE_DNSSEC} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n  %{?__debug_package:%{__debug_install_post}} \\\n  %{__arch_install_post} \\\n  %{__os_install_post} \\\n  fipshmac %{buildroot}%{_sbindir}/ipsec \\\n  fipshmac %{buildroot}%{_libexecdir}/ipsec/* \\\n%{nil}\n%endif\n\n%install\nrm -rf %{buildroot}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INITSYSTEM=sysvinit \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\necho \"include /etc/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}/etc/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_initrddir}/ipsec\n%{_libexecdir}/ipsec\n%{_sbindir}/ipsec\n%attr(0644,root,root) %{_mandir}/*/*.gz\n\n%if %{USE_FIPSCHECK}\n%{_sbindir}/.ipsec.hmac\n%endif\n\n%preun\nif [ $1 -eq 0 ]; then\n        /sbin/service ipsec stop > /dev/null 2>&1 || :\n        /sbin/chkconfig --del ipsec\nfi\n\n%postun\nif [ $1 -ge 1 ] ; then\n /sbin/service ipsec condrestart 2>&1 >/dev/null || :\nfi\n\n%post \n/sbin/chkconfig --add ipsec || :\nif [ ! -f %{_sysconfdir}/ipsec.d/cert8.db ] ; then\n    TEMPFILE=$(/bin/mktemp %{_sysconfdir}/ipsec.d/nsspw.XXXXXXX)\n    [ $? -gt 0 ] && TEMPFILE=%{_sysconfdir}/ipsec.d/nsspw.$$\n    echo > ${TEMPFILE}\n    certutil -N -f ${TEMPFILE} -d %{_sysconfdir}/ipsec.d\n    restorecon %{_sysconfdir}/ipsec.d/*db 2>/dev/null || :\n    rm -f ${TEMPFILE}\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - 3.1-1\n- Automated build from release tar ball\n\n", "%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global fipscheck_version 1.2.0-1\n%global buildefence 0\n%global development 0\n\n#global prever rc1\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}1%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nRequires(post): coreutils bash\nRequires(preun): initscripts chkconfig\nRequires(post): /sbin/chkconfig\nRequires(preun): /sbin/chkconfig\nRequires(preun): /sbin/service\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig net-tools\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\n# we need fipshmac\nBuildRequires: fipscheck-devel >= %{fipscheck_version}\nRequires: fipscheck%{_isa} >= %{fipscheck_version}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\nRequires: iproute >= 2.6.8\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is \nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and \ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %global efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  INITSYSTEM=sysvinit \\\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n  USE_FIPSCHECK=%{USE_FIPSCHECK} \\\n  FIPSPRODUCTCHECK=\"%{_sysconfdir}/system-fips\" \\\n  USE_LIBCAP_NG=%{USE_LIBCAP_NG} \\\n  USE_LABELED_IPSEC=%{USE_LABELED_IPSEC} \\\n  USE_LDAP=%{USE_CRL_FETCHING} \\\n  USE_LIBCURL=%{USE_CRL_FETCHING} \\\n  USE_DNSSEC=%{USE_DNSSEC} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n  %{?__debug_package:%{__debug_install_post}} \\\n  %{__arch_install_post} \\\n  %{__os_install_post} \\\n  fipshmac %{buildroot}%{_sbindir}/ipsec \\\n  fipshmac %{buildroot}%{_libexecdir}/ipsec/* \\\n%{nil}\n%endif\n\n%install\nrm -rf %{buildroot}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INITSYSTEM=sysvinit \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase \ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n# replace with rhel[56] specific version\ninstall -m 0755 initsystems/sysvinit/init.rhel %{buildroot}%{_initrddir}/ipsec\n\necho \"include %{_sysconfdir}/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}%{_sysconfdir}/rc.d/rc*\n\n%files \n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_initrddir}/ipsec\n%{_libexecdir}/ipsec\n%{_sbindir}/ipsec\n%attr(0644,root,root) %{_mandir}/*/*.gz\n\n%if %{USE_FIPSCHECK}\n%{_sbindir}/.ipsec.hmac\n%endif\n\n%preun\nif [ $1 -eq 0 ]; then\n        /sbin/service ipsec stop > /dev/null 2>&1 || :\n        /sbin/chkconfig --del ipsec\nfi\n\n%postun\nif [ $1 -ge 1 ] ; then\n /sbin/service ipsec condrestart 2>&1 >/dev/null || :\nfi\n\n%post \n/sbin/chkconfig --add ipsec || :\n%if %{USE_FIPSCHECK}\nprelink -u %{_libexecdir}/ipsec/* 2>/dev/null || :\n%endif\nif [ ! -f %{_sysconfdir}/ipsec.d/cert8.db ] ; then\n    TEMPFILE=$(/bin/mktemp %{_sysconfdir}/ipsec.d/nsspw.XXXXXXX)\n    [ $? -gt 0 ] && TEMPFILE=%{_sysconfdir}/ipsec.d/nsspw.$$\n    echo > ${TEMPFILE}\n    certutil -N -f ${TEMPFILE} -d %{_sysconfdir}/ipsec.d\n    restorecon %{_sysconfdir}/ipsec.d/*db 2>/dev/null || :\n    rm -f ${TEMPFILE}\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSECBASEVERSION-1\n- Automated build from release tar ball\n\n", "%global USE_FIPSCHECK true\n%global USE_LIBCAP_NG true\n%global USE_LABELED_IPSEC true\n%global USE_CRL_FETCHING true\n%global USE_DNSSEC true\n%global USE_NM true\n%global USE_LINUX_AUDIT true\n\n%global _hardened_build 1\n\n%global buildefence 0\n%global development 0\n\n#global prever rc6\n\nName: libreswan\nSummary: IPsec implementation with IKEv1 and IKEv2 keying protocols\nVersion: IPSECBASEVERSION\nRelease: %{?prever:0.}2%{?prever:.%{prever}}%{?dist}\nLicense: GPLv2\nUrl: https://www.libreswan.org/\nSource: https://download.libreswan.org/%{name}-%{version}%{?prever}.tar.gz\nGroup: System Environment/Daemons\nBuildRequires: gmp-devel bison flex redhat-rpm-config pkgconfig\nBuildRequires: systemd\nRequires(post): coreutils bash systemd\nRequires(preun): systemd\nRequires(postun): systemd\nRequires: iproute\n\nConflicts: openswan < %{version}-%{release}\nObsoletes: openswan < %{version}-%{release}\nProvides: openswan = %{version}-%{release}\n\nBuildRequires: pkgconfig hostname\nBuildRequires: nss-devel >= 3.12.6-2, nspr-devel\nBuildRequires: pam-devel\n%if %{USE_DNSSEC}\nBuildRequires: unbound-devel\n%endif\n%if %{USE_FIPSCHECK}\nBuildRequires: fipscheck-devel\n# we need fipshmac\nRequires: fipscheck%{_isa}\n%endif\n%if %{USE_LINUX_AUDIT}\nBuildrequires: audit-libs-devel\n%endif\n\n%if %{USE_LIBCAP_NG}\nBuildRequires: libcap-ng-devel\n%endif\n%if %{USE_CRL_FETCHING}\nBuildRequires: openldap-devel curl-devel\n%endif\n%if %{buildefence}\nBuildRequires: ElectricFence\n%endif\n# Only needed if xml man pages are modified and need regeneration\n# BuildRequires: xmlto\n\nRequires: nss-tools, nss-softokn\n\n%description\nLibreswan is a free implementation of IPsec & IKE for Linux.  IPsec is\nthe Internet Protocol Security and uses strong cryptography to provide\nboth authentication and encryption services.  These services allow you\nto build secure tunnels through untrusted networks.  Everything passing\nthrough the untrusted net is encrypted by the ipsec gateway machine and\ndecrypted by the gateway at the other end of the tunnel.  The resulting\ntunnel is a virtual private network or VPN.\n\nThis package contains the daemons and userland tools for setting up\nLibreswan. To build KLIPS, see the kmod-libreswan.spec file.\n\nLibreswan also supports IKEv2 (RFC4309) and Secure Labeling\n\nLibreswan is based on Openswan-2.6.38 which in turn is based on FreeS/WAN-2.04\n\n%prep\n%setup -q -n libreswan-%{version}%{?prever}\n\n%build\n%if %{buildefence}\n %define efence \"-lefence\"\n%endif\n\n#796683: -fno-strict-aliasing\n%{__make} \\\n%if %{development}\n   USERCOMPILE=\"-g -DGCC_LINT %(echo %{optflags} | sed -e s/-O[0-9]*/ /) %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%else\n  USERCOMPILE=\"-g -DGCC_LINT %{optflags} %{?efence} -fPIE -pie -fno-strict-aliasing -Wformat-nonliteral -Wformat-security\" \\\n%endif\n  USERLINK=\"-g -pie -Wl,-z,relro,-z,now %{?efence}\" \\\n  INITSYSTEM=systemd \\\n  USE_DYNAMICDNS=\"true\" \\\n  USE_NM=%{USE_NM} \\\n  USE_XAUTHPAM=true \\\n  USE_FIPSCHECK=\"%{USE_FIPSCHECK}\" \\\n  USE_LIBCAP_NG=\"%{USE_LIBCAP_NG}\" \\\n  USE_LABELED_IPSEC=\"%{USE_LABELED_IPSEC}\" \\\n%if %{USE_CRL_FETCHING}\n  USE_LDAP=true \\\n  USE_LIBCURL=true \\\n%endif\n  USE_DNSSEC=\"%{USE_DNSSEC}\" \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  programs\nFS=$(pwd)\n\n%if %{USE_FIPSCHECK}\n# Add generation of HMAC checksums of the final stripped binaries\n%define __spec_install_post \\\n    %{?__debug_package:%{__debug_install_post}} \\\n    %{__arch_install_post} \\\n    %{__os_install_post} \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_libexecdir}/ipsec/* \\\n  fipshmac -d %{buildroot}%{_libdir}/fipscheck %{buildroot}%{_sbindir}/ipsec \\\n%{nil}\n%endif\n\n%install\nrm -rf ${RPM_BUILD_ROOT}\n%{__make} \\\n  DESTDIR=%{buildroot} \\\n  INC_USRLOCAL=%{_prefix} \\\n  FINALLIBDIR=%{_libexecdir}/ipsec \\\n  FINALLIBEXECDIR=%{_libexecdir}/ipsec \\\n  MANTREE=%{buildroot}%{_mandir} \\\n  INC_RCDEFAULT=%{_initrddir} \\\n  INSTMANFLAGS=\"-m 644\" \\\n  INITSYSTEM=systemd \\\n  install\nFS=$(pwd)\nrm -rf %{buildroot}/usr/share/doc/libreswan\n\ninstall -d -m 0755 %{buildroot}%{_localstatedir}/run/pluto\n# used when setting --perpeerlog without --perpeerlogbase\ninstall -d -m 0700 %{buildroot}%{_localstatedir}/log/pluto/peer\ninstall -d %{buildroot}%{_sbindir}\n\n%if %{USE_FIPSCHECK}\nmkdir -p %{buildroot}%{_libdir}/fipscheck\ninstall -d %{buildroot}%{_sysconfdir}/prelink.conf.d/\ninstall -m644 packaging/fedora/libreswan-prelink.conf %{buildroot}%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\necho \"include /etc/ipsec.d/*.secrets\" > %{buildroot}%{_sysconfdir}/ipsec.secrets\nrm -fr %{buildroot}/etc/rc.d/rc*\n\n%files\n%doc BUGS CHANGES COPYING CREDITS README LICENSE\n%doc docs/*.*\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.conf\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/sysconfig/pluto\n%attr(0600,root,root) %config(noreplace) %{_sysconfdir}/ipsec.secrets\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/cacerts\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/crls\n%attr(0700,root,root) %dir %{_sysconfdir}/ipsec.d/policies\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/ipsec.d/policies/*\n%attr(0700,root,root) %dir %{_localstatedir}/log/pluto/peer\n%attr(0755,root,root) %dir %{_localstatedir}/run/pluto\n%attr(0644,root,root) %{_unitdir}/ipsec.service\n%attr(0644,root,root) %config(noreplace) %{_sysconfdir}/pam.d/pluto\n%{_sbindir}/ipsec\n%{_libexecdir}/ipsec\n%attr(0644,root,root) %doc %{_mandir}/*/*\n\n%if %{USE_FIPSCHECK}\n%{_libdir}/fipscheck/*.hmac\n# We own the directory so we don't have to require prelink\n%attr(0755,root,root) %dir %{_sysconfdir}/prelink.conf.d/\n%{_sysconfdir}/prelink.conf.d/libreswan-fips.conf\n%endif\n\n%preun\n%systemd_preun ipsec.service\n\n%postun\n%systemd_postun_with_restart ipsec.service\n\n%post\n%systemd_post ipsec.service\n%if %{USE_FIPSCHECK}\nprelink -u %{_libexecdir}/ipsec/* 2>/dev/null || :\n%endif\nif [ ! -f %{_sysconfdir}/ipsec.d/cert8.db ] ; then\n    TEMPFILE=$(/bin/mktemp %{_sysconfdir}/ipsec.d/nsspw.XXXXXXX)\n    [ $? -gt 0 ] && TEMPFILE=%{_sysconfdir}/ipsec.d/nsspw.$$\n    echo > ${TEMPFILE}\n    certutil -N -f ${TEMPFILE} -d %{_sysconfdir}/ipsec.d\n    restorecon %{_sysconfdir}/ipsec.d/*db 2>/dev/null || :\n    rm -f ${TEMPFILE}\nfi\n\n%changelog\n* Tue Jan 01 2013 Team Libreswan <team@libreswan.org> - IPSECBASEVERSION-1\n- Automated build from release tar ball\n"], "filenames": ["packaging/fedora/17/libreswan.spec", "packaging/fedora/18/libreswan.spec", "packaging/fedora/19/libreswan.spec", "packaging/rhel/5/libreswan.spec", "packaging/rhel/6/libreswan.spec", "packaging/rhel/7/libreswan.spec"], "buggy_code_start_loc": [152, 102, 102, 194, 99, 193], "buggy_code_end_loc": [203, 198, 198, 199, 193, 198], "fixing_code_start_loc": [152, 102, 102, 194, 99, 193], "fixing_code_end_loc": [205, 200, 200, 201, 195, 200], "type": "CWE-362", "message": "Race condition in the libreswan.spec files for Red Hat Enterprise Linux (RHEL) and Fedora packages in libreswan 3.6 has unspecified impact and attack vectors, involving the /var/tmp/libreswan-nss-pwd temporary file.", "other": {"cve": {"id": "CVE-2013-7283", "sourceIdentifier": "cve@mitre.org", "published": "2014-01-09T18:07:29.017", "lastModified": "2014-01-10T15:07:52.657", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Race condition in the libreswan.spec files for Red Hat Enterprise Linux (RHEL) and Fedora packages in libreswan 3.6 has unspecified impact and attack vectors, involving the /var/tmp/libreswan-nss-pwd temporary file."}, {"lang": "es", "value": "Condici\u00f3n de carrera en archivos libreswan.spec para paquetes de Red Hat Enterprise Linux (RHEL) y Fedora en libreswan 3.6 tiene un impacto y vectores de ataque no especificados, involucrando el archivo temporal /var/tmp/libreswan-nss-pwd."}], "metrics": {"cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:C/I:C/A:C", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "COMPLETE", "integrityImpact": "COMPLETE", "availabilityImpact": "COMPLETE", "baseScore": 9.3}, "baseSeverity": "HIGH", "exploitabilityScore": 8.6, "impactScore": 10.0, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-362"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:libreswan:libreswan:3.6:*:*:*:*:*:*:*", "matchCriteriaId": "D1B09B58-1F6E-4BEE-BF09-9856231EC7DC"}]}]}], "references": [{"url": "https://github.com/libreswan/libreswan/commit/ef2d756e73a188401c36133c2e2f7ce4f3c6ae55", "source": "cve@mitre.org", "tags": ["Exploit", "Patch"]}, {"url": "https://lists.libreswan.org/pipermail/swan-announce/2013/000007.html", "source": "cve@mitre.org", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/libreswan/libreswan/commit/ef2d756e73a188401c36133c2e2f7ce4f3c6ae55"}}