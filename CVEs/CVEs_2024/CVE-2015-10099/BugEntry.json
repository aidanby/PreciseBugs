{"buggy_code": ["<?php\n/*\nPlugin Name: CP Appointment Calendar\nPlugin URI: http://wordpress.dwbooster.com/calendars/cp-appointment-calendar\nDescription: This plugin allows you to easily insert appointments forms into your WP website.\nVersion: 1.1.5\nAuthor: CodePeople.net\nAuthor URI: http://codepeople.net\nLicense: GPL\n*/\n\n\n/* initialization / install / uninstall functions */\n\n\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_LANGUAGE', 'EN');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_DATEFORMAT', '0');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_MILITARYTIME', '1');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_WEEKDAY', '0');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_MINDATE', 'today');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_MAXDATE', '');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_PAGES', 1);\n\ndefine('DEX_APPOINTMENTS_DEFAULT_ENABLE_PAYPAL', 1);\ndefine('DEX_APPOINTMENTS_DEFAULT_PAYPAL_EMAIL','put_your@email_here.com');\ndefine('DEX_APPOINTMENTS_DEFAULT_PRODUCT_NAME','Consultation');\ndefine('DEX_APPOINTMENTS_DEFAULT_COST','25');\ndefine('DEX_APPOINTMENTS_DEFAULT_OK_URL',get_site_url());\ndefine('DEX_APPOINTMENTS_DEFAULT_CANCEL_URL',get_site_url());\ndefine('DEX_APPOINTMENTS_DEFAULT_CURRENCY','USD');\ndefine('DEX_APPOINTMENTS_DEFAULT_PAYPAL_LANGUAGE','EN');\n\ndefine('DEX_APPOINTMENTS_DEFAULT_SUBJECT_CONFIRMATION_EMAIL', 'Thank you for your request...');\ndefine('DEX_APPOINTMENTS_DEFAULT_CONFIRMATION_EMAIL', \"We have received your request with the following information:\\n\\n%INFORMATION%\\n\\nThank you.\\n\\nBest regards.\");\ndefine('DEX_APPOINTMENTS_DEFAULT_SUBJECT_NOTIFICATION_EMAIL','New appointment requested...');\ndefine('DEX_APPOINTMENTS_DEFAULT_NOTIFICATION_EMAIL', \"New appointment made with the following information:\\n\\n%INFORMATION%\\n\\nBest regards.\");\n\n\ndefine('DEX_APPOINTMENTS_TABLE_NAME_NO_PREFIX', \"dex_appointments\");\ndefine('DEX_APPOINTMENTS_TABLE_NAME', @$wpdb->prefix . DEX_APPOINTMENTS_TABLE_NAME_NO_PREFIX);\n\ndefine('DEX_APPOINTMENTS_CALENDARS_TABLE_NAME_NO_PREFIX', \"appointment_calendars_data\");\ndefine('DEX_APPOINTMENTS_CALENDARS_TABLE_NAME', @$wpdb->prefix .\"appointment_calendars_data\");\n\ndefine('DEX_APPOINTMENTS_CONFIG_TABLE_NAME_NO_PREFIX', \"appointment_calendars\");\ndefine('DEX_APPOINTMENTS_CONFIG_TABLE_NAME', @$wpdb->prefix .\"appointment_calendars\");\n\n// calendar constants\n\ndefine(\"TDE_APP_DEFAULT_CALENDAR_ID\",\"1\");\ndefine(\"TDE_APP_DEFAULT_CALENDAR_LANGUAGE\",\"EN\");\n\ndefine(\"TDE_APP_CAL_PREFIX\", \"cal\");\ndefine(\"TDE_APP_CONFIG\",DEX_APPOINTMENTS_CONFIG_TABLE_NAME);\ndefine(\"TDE_APP_CONFIG_ID\",\"id\");\ndefine(\"TDE_APP_CONFIG_TITLE\",\"title\");\ndefine(\"TDE_APP_CONFIG_USER\",\"uname\");\ndefine(\"TDE_APP_CONFIG_PASS\",\"passwd\");\ndefine(\"TDE_APP_CONFIG_LANG\",\"lang\");\ndefine(\"TDE_APP_CONFIG_CPAGES\",\"cpages\");\ndefine(\"TDE_APP_CONFIG_TYPE\",\"ctype\");\ndefine(\"TDE_APP_CONFIG_MSG\",\"msg\");\ndefine(\"TDE_APP_CONFIG_WORKINGDATES\",\"workingDates\");\ndefine(\"TDE_APP_CONFIG_RESTRICTEDDATES\",\"restrictedDates\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES0\",\"timeWorkingDates0\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES1\",\"timeWorkingDates1\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES2\",\"timeWorkingDates2\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES3\",\"timeWorkingDates3\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES4\",\"timeWorkingDates4\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES5\",\"timeWorkingDates5\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES6\",\"timeWorkingDates6\");\ndefine(\"TDE_APP_CALDELETED_FIELD\",\"caldeleted\");\n\ndefine(\"TDE_APP_CALENDAR_DATA_TABLE\",DEX_APPOINTMENTS_CALENDARS_TABLE_NAME);\ndefine(\"TDE_APP_DATA_ID\",\"id\");\ndefine(\"TDE_APP_DATA_IDCALENDAR\",\"appointment_calendar_id\");\ndefine(\"TDE_APP_DATA_DATETIME\",\"datatime\");\ndefine(\"TDE_APP_DATA_TITLE\",\"title\");\ndefine(\"TDE_APP_DATA_DESCRIPTION\",\"description\");\n// end calendar constants\n\n\nregister_activation_hook(__FILE__,'dex_appointments_install'); \nregister_deactivation_hook( __FILE__, 'dex_appointments_remove' );\n\nfunction dex_appointments_install() {\n    global $wpdb;\n    \n    \n    $table_name = $wpdb->prefix . DEX_APPOINTMENTS_TABLE_NAME_NO_PREFIX;\n      \n    $sql = \"CREATE TABLE $table_name (\n         id mediumint(9) NOT NULL AUTO_INCREMENT,\n         time datetime DEFAULT '0000-00-00 00:00:00' NOT NULL,\n         booked_time VARCHAR(250) DEFAULT '' NOT NULL,\n         name VARCHAR(250) DEFAULT '' NOT NULL,\n         email VARCHAR(250) DEFAULT '' NOT NULL,\n         phone VARCHAR(250) DEFAULT '' NOT NULL,\n         question text,\n         buffered_date text,\n         UNIQUE KEY id (id)\n         );\";\n         \n    $sql .= \"CREATE TABLE `\".$wpdb->prefix.DEX_APPOINTMENTS_CONFIG_TABLE_NAME.\"` (`\".TDE_APP_CONFIG_ID.\"` int(10) unsigned NOT NULL auto_increment,`\".TDE_APP_CONFIG_TITLE.\"` varchar(255) NOT NULL default '',`\".TDE_APP_CONFIG_USER.\"` varchar(100) default NULL,`\".TDE_APP_CONFIG_PASS.\"` varchar(100) default NULL,`\".TDE_APP_CONFIG_LANG.\"` varchar(5) default NULL,`\".TDE_APP_CONFIG_CPAGES.\"` tinyint(3) unsigned default NULL,`\".TDE_APP_CONFIG_TYPE.\"` tinyint(3) unsigned default NULL,`\".TDE_APP_CONFIG_MSG.\"` varchar(255) NOT NULL default '',`\".TDE_APP_CONFIG_WORKINGDATES.\"` varchar(255) NOT NULL default '',`\".TDE_APP_CONFIG_RESTRICTEDDATES.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES0.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES1.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES2.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES3.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES4.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES5.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES6.\"` text,`\".TDE_APP_CALDELETED_FIELD.\"` tinyint(3) unsigned default NULL,PRIMARY KEY (`\".TDE_APP_CONFIG_ID.\"`)); \";\n    $sql .= \"CREATE TABLE `\".$wpdb->prefix.DEX_APPOINTMENTS_CALENDARS_TABLE_NAME.\"` (`\".TDE_APP_DATA_ID.\"` int(10) unsigned NOT NULL auto_increment,`\".TDE_APP_DATA_IDCALENDAR.\"` int(10) unsigned default NULL,`\".TDE_APP_DATA_DATETIME.\"`datetime NOT NULL default '0000-00-00 00:00:00',`\".TDE_APP_DATA_TITLE.\"` varchar(250) default NULL,`\".TDE_APP_DATA_DESCRIPTION.\"` text,PRIMARY KEY (`\".TDE_APP_DATA_ID.\"`)) ;\";\n    $sql .= 'INSERT INTO `'.$wpdb->prefix.DEX_APPOINTMENTS_CONFIG_TABLE_NAME.'` (`'.TDE_APP_CONFIG_ID.'`,`'.TDE_APP_CONFIG_TITLE.'`,`'.TDE_APP_CONFIG_USER.'`,`'.TDE_APP_CONFIG_PASS.'`,`'.TDE_APP_CONFIG_LANG.'`,`'.TDE_APP_CONFIG_CPAGES.'`,`'.TDE_APP_CONFIG_TYPE.'`,`'.TDE_APP_CONFIG_MSG.'`,`'.TDE_APP_CONFIG_WORKINGDATES.'`,`'.TDE_APP_CONFIG_RESTRICTEDDATES.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES0.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES1.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES2.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES3.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES4.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES5.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES6.'`,`'.TDE_APP_CALDELETED_FIELD.'`) VALUES(\"1\",\"cal1\",\"\",\"\",\"ENG\",\"1\",\"3\",\"Please, select your appointment.\",\"1,2,3,4,5\",\"\",\"\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"\",\"0\");';  \n\n    require_once(ABSPATH . 'wp-admin/includes/upgrade.php');\n    dbDelta($sql);    \n    \n    add_option(\"dex_appointments_data\", 'Default', '', 'yes'); // Creates new database field \n}\n\nfunction dex_appointments_remove() {    \n    delete_option('dex_appointments_data'); // Deletes the database field \n}\n\n\n/* Filter for placing the maps into the contents */\n\nadd_filter('the_content','dex_appointments_filter_content');\n\nfunction dex_appointments_filter_content($content) {\n    \n    if (strpos($content, \"[APPOINTMENT_CALENDAR_FORM_WILL_APPEAR_HERE]\") !== false) \n    {        \n        ob_start();\n        define('DEX_AUTH_INCLUDE', true);\n        @include dirname( __FILE__ ) . '/dex_scheduler.inc.php';\n        $buffered_contents = ob_get_contents();\n        ob_end_clean();\n\n        $content = str_replace(\"[APPOINTMENT_CALENDAR_FORM_WILL_APPEAR_HERE]\", $buffered_contents, $content);\n    }    \n    return $content;\n}\n\n\nfunction dex_appointments_show_booking_form($id = \"\")\n{\n    if ($id != '')\n        define ('DEX_CALENDAR_FIXED_ID',$id);\n    define('DEX_AUTH_INCLUDE', true);\n    @include dirname( __FILE__ ) . '/dex_scheduler.inc.php';    \n}\n\n/* Code for the admin area */\n\nif ( is_admin() ) {\n    add_action('media_buttons', 'set_dex_apps_insert_button', 100);\n    add_action('admin_enqueue_scripts', 'set_dex_apps_insert_adminScripts', 1);\n    add_action('admin_menu', 'dex_appointments_admin_menu');\n    add_action('admin_init', 'register_mysettings' );\n    \n    $plugin = plugin_basename(__FILE__);        \n    add_filter(\"plugin_action_links_\".$plugin, 'dex_customAdjustmentsLink');    \n    add_filter(\"plugin_action_links_\".$plugin, 'dex_settingsLink');\n    add_filter(\"plugin_action_links_\".$plugin, 'dex_helpLink');\n    \n    \n    \n\n    function register_mysettings() { // whitelist options\n      \n      register_setting( 'dex-appointments-group', 'calendar_language' );\n      register_setting( 'dex-appointments-group', 'calendar_dateformat' );\n      register_setting( 'dex-appointments-group', 'calendar_militarytime' );\n      register_setting( 'dex-appointments-group', 'calendar_weekday' );\n      register_setting( 'dex-appointments-group', 'calendar_mindate' );\n      register_setting( 'dex-appointments-group', 'calendar_maxdate' );        \n      register_setting( 'dex-appointments-group', 'calendar_pages' );\n        \n      register_setting( 'dex-appointments-group', 'enable_paypal' );\n      register_setting( 'dex-appointments-group', 'paypal_email' );\n      register_setting( 'dex-appointments-group', 'request_cost' );\n      register_setting( 'dex-appointments-group', 'paypal_product_name' );\n      register_setting( 'dex-appointments-group', 'currency' );\n      register_setting( 'dex-appointments-group', 'url_ok' );\n      register_setting( 'dex-appointments-group', 'url_cancel' );\n      register_setting( 'dex-appointments-group', 'paypal_language' );\n      \n      register_setting( 'dex-appointments-group', 'notification_from_email' );\n      register_setting( 'dex-appointments-group', 'notification_destination_email' );\n      register_setting( 'dex-appointments-group', 'email_subject_confirmation_to_user' );\n      register_setting( 'dex-appointments-group', 'email_confirmation_to_user' );\n      register_setting( 'dex-appointments-group', 'email_subject_notification_to_admin' );\n      register_setting( 'dex-appointments-group', 'email_notification_to_admin' );\n    }\n\n    function dex_appointments_admin_menu() {                \n        add_options_page('CP Appointment Calendar Options', 'CP Appointment Calendar', 'manage_options', 'dex_appointments', 'dex_appointments_html_post_page' );\n    }\n}\n\nfunction dex_settingsLink($links) {\n    $settings_link = '<a href=\"options-general.php?page=dex_appointments\">'.__('Settings').'</a>'; \n\tarray_unshift($links, $settings_link);     \n\treturn $links;\n}\n\nfunction dex_helpLink($links) {\n    $help_link = '<a href=\"http://wordpress.dwbooster.com/calendars/cp-appointment-calendar\">'.__('Help').'</a>'; \n\tarray_unshift($links, $help_link);     \n\treturn $links;\n}\n\nfunction dex_customAdjustmentsLink($links) {\n    $customAdjustments_link = '<a href=\"http://wordpress.dwbooster.com/contact-us\">'.__('Request custom changes').'</a>'; \n\tarray_unshift($links, $customAdjustments_link);     \n\treturn $links;\n}\n\nfunction dex_appointments_html_post_page() {\n    @include_once dirname( __FILE__ ) . '/dex_appointments_admin_int.inc.php';\n\n}\n\nfunction set_dex_apps_insert_button() {\n    print '<a href=\"javascript:dex_appointments_insertCalendar();\" title=\"'.__('Insert Appointment Calendar').'\"><img hspace=\"5\" src=\"'.plugins_url('/images/dex_apps.gif', __FILE__).'\" alt=\"'.__('Insert  Appointment Calendar').'\" /></a>';    \n} \n\nfunction set_dex_apps_insert_adminScripts($hook) { \n    if( 'post.php' != $hook  && 'post-new.php' != $hook )\n        return;\n    wp_enqueue_script( 'my_custom_script', plugins_url('/dex_script.js', __FILE__) );\n}\n\n\n/* hook for checking posted data for the admin area */\n\nadd_action( 'init', 'dex_appointments_check_posted_data', 11 );\n\nfunction dex_appointments_check_posted_data() {\n\t\n    global $wpdb;\n    \n\tif ( 'POST' != $_SERVER['REQUEST_METHOD'] || ! isset( $_POST['dex_appointments_post'] ) )\t\t\n\t\treturn;\n\n    $_POST[\"dateAndTime\"] =  $_POST[\"selYearcal1\"].\"-\".$_POST[\"selMonthcal1\"].\"-\".$_POST[\"selDaycal1\"].\" \".$_POST[\"selHourcal1\"].\":\".$_POST[\"selMinutecal1\"];\n    $_POST[\"Date\"] = date(\"m/d/Y H:i\",strtotime($_POST[\"dateAndTime\"]));\n    \n   \n    $buffer = $_POST[\"selYearcal1\"].\",\".$_POST[\"selMonthcal1\"].\",\".$_POST[\"selDaycal1\"].\"\\n\".\n    $_POST[\"selHourcal1\"].\":\".($_POST[\"selMinutecal1\"]<10?\"0\":\"\").$_POST[\"selMinutecal1\"].\"\\n\".\n    \"Name: \".$_POST[\"name\"].\"\\n\".\n    \"Email: \".$_POST[\"email\"].\"\\n\".\n    \"Phone: \".$_POST[\"phone\"].\"\\n\".\n    \"Question: \".$_POST[\"question\"].\"\\n\".\n    \"*-*\\n\";\n\t\n    $rows_affected = $wpdb->insert( DEX_APPOINTMENTS_TABLE_NAME, array( 'time' => current_time('mysql'), \n                                                                        'booked_time' => $_POST[\"Date\"], \n                                                                        'name' => $_POST[\"name\"], \n                                                                        'email' => $_POST[\"email\"], \n                                                                        'phone' => $_POST[\"phone\"], \n                                                                        'question' => $_POST[\"question\"], \n                                                                        'buffered_date' => $_POST[\"dateAndTime\"]\n                                                                         ) );\n    if (!$rows_affected)\n    {\n        echo 'Error saving data! Please try again.';\n        exit;\n    }\n    \n    \n    $myrows = $wpdb->get_results( \"SELECT MAX(id) as max_id FROM \".DEX_APPOINTMENTS_TABLE_NAME );                                                                     \n     \t\n \t// save data here \t\n    $item_number = $myrows[0]->max_id; \n    \n\n?>\n<html>\n<head><title>Redirecting to Paypal...</title></head>\n<body>\n<form action=\"https://www.paypal.com/cgi-bin/webscr\" name=\"ppform3\" method=\"post\">\n<input type=\"hidden\" name=\"cmd\" value=\"_xclick\" />\n<input type=\"hidden\" name=\"business\" value=\"<?php echo get_option('paypal_email', DEX_APPOINTMENTS_DEFAULT_PAYPAL_EMAIL); ?>\" />\n<input type=\"hidden\" name=\"item_name\" value=\"<?php echo get_option('paypal_product_name', DEX_APPOINTMENTS_DEFAULT_PRODUCT_NAME); ?>\" />\n<input type=\"hidden\" name=\"item_number\" value=\"<?php echo $item_number; ?>\" />\n<input type=\"hidden\" name=\"amount\" value=\"<?php echo get_option('request_cost', DEX_APPOINTMENTS_DEFAULT_COST); ?>\" />\n<input type=\"hidden\" name=\"page_style\" value=\"Primary\" />\n<input type=\"hidden\" name=\"no_shipping\" value=\"1\" />\n<input type=\"hidden\" name=\"return\" value=\"<?php echo get_option('url_ok', DEX_APPOINTMENTS_DEFAULT_OK_URL); ?>\">\n<input type=\"hidden\" name=\"cancel_return\" value=\"<?php echo get_option('url_cancel', DEX_APPOINTMENTS_DEFAULT_CANCEL_URL); ?>\" />\n<input type=\"hidden\" name=\"no_note\" value=\"1\" />\n<input type=\"hidden\" name=\"currency_code\" value=\"<?php echo strtoupper(get_option('currency', DEX_APPOINTMENTS_DEFAULT_CURRENCY)); ?>\" />\n<input type=\"hidden\" name=\"lc\" value=\"<?php echo get_option('paypal_language', DEX_APPOINTMENTS_DEFAULT_PAYPAL_LANGUAGE); ?>\" />\n<input type=\"hidden\" name=\"bn\" value=\"NetFactorSL_SI_Custom\" />\n<input type=\"hidden\" name=\"notify_url\" value=\"<?php echo cp_appointment_get_FULL_site_url(); ?>/?ipncheck=1&itemnumber=<?php echo $item_number; ?>\" />\n<input type=\"hidden\" name=\"ipn_test\" value=\"1\" />\n<input class=\"pbutton\" type=\"hidden\" value=\"Buy Now\" /></div>\n</form>\n<script type=\"text/javascript\">\ndocument.ppform3.submit();\n</script>  \n</body>\n</html> \n<?php\n        exit();\n\n} \n\nadd_action( 'init', 'dex_appointments_check_IPN_verification', 11 );\n\nfunction dex_appointments_check_IPN_verification() {    \n    \n    global $wpdb;\n  \n\tif ( ! isset( $_GET['ipncheck'] ) || $_GET['ipncheck'] != '1' ||  ! isset( $_GET[\"itemnumber\"] ) )\n\t\treturn;\n\t\t\n    $item_name = $_POST['item_name'];\n    $item_number = $_POST['item_number'];\n    $payment_status = $_POST['payment_status'];\n    $payment_amount = $_POST['mc_gross'];\n    $payment_currency = $_POST['mc_currency'];\n    $txn_id = $_POST['txn_id'];\n    $receiver_email = $_POST['receiver_email'];\n    $payer_email = $_POST['payer_email'];\n    $payment_type = $_POST['payment_type'];\n\t\t\n\t\t\n    if (strtolower($payment_status) != 'completed' && strtolower($payment_type) != 'echeck')\n        return;\n\t    \n    if (strtolower($payment_type) == 'echeck' && strtolower($payment_status) == 'completed')    \n        return;            \t\n\n    dex_process_ready_to_go_appointment($_GET[\"itemnumber\"], $payer_email);    \n    \n    echo 'OK';\n    \n    exit();\n\t\t    \n}\n\nfunction dex_process_ready_to_go_appointment($itemnumber, $payer_email = \"\")\n{\n   global $wpdb;\n   \n   $myrows = $wpdb->get_results( \"SELECT * FROM \".DEX_APPOINTMENTS_TABLE_NAME.\" WHERE id=\".$itemnumber );   \n       \n   $SYSTEM_EMAIL = get_option('notification_from_email', DEX_APPOINTMENTS_DEFAULT_PAYPAL_EMAIL);\n   $SYSTEM_RCPT_EMAIL = get_option('notification_destination_email', DEX_APPOINTMENTS_DEFAULT_PAYPAL_EMAIL);\n   \n    \n   $email_subject1 = get_option('email_subject_confirmation_to_user', DEX_APPOINTMENTS_DEFAULT_SUBJECT_CONFIRMATION_EMAIL);\n   $email_content1 = get_option('email_confirmation_to_user', DEX_APPOINTMENTS_DEFAULT_CONFIRMATION_EMAIL);\n   $email_subject2 = get_option('email_subject_notification_to_admin', DEX_APPOINTMENTS_DEFAULT_SUBJECT_NOTIFICATION_EMAIL);\n   $email_content2 = get_option('email_notification_to_admin', DEX_APPOINTMENTS_DEFAULT_NOTIFICATION_EMAIL);\n   \n   $information = $myrows[0]->booked_time.\"\\n\".\n                  $myrows[0]->name.\"\\n\".  \n                  $myrows[0]->email.\"\\n\".  \n                  $myrows[0]->phone.\"\\n\".  \n                  $myrows[0]->question.\"\\n\";\n   \n   $email_content1 = str_replace(\"%INFORMATION%\", $information, $email_content1);\n   $email_content2 = str_replace(\"%INFORMATION%\", $information, $email_content2);\n   \n   // SEND EMAIL TO USER \n   wp_mail($myrows[0]->email, $email_subject1, $email_content1,\n            \"From: \\\"$SYSTEM_EMAIL\\\" <\".$SYSTEM_EMAIL.\">\\r\\n\".\n            \"Content-Type: text/plain; charset=utf-8\\n\".\n            \"X-Mailer: PHP/\" . phpversion());\n            \n   if ($payer_email && $payer_email != $myrows[0]->email)         \n       wp_mail($payer_email , $email_subject1, $email_content1,\n                \"From: \\\"$SYSTEM_EMAIL\\\" <\".$SYSTEM_EMAIL.\">\\r\\n\".\n                \"Content-Type: text/plain; charset=utf-8\\n\".\n                \"X-Mailer: PHP/\" . phpversion());\n\n   // SEND EMAIL TO ADMIN\n   wp_mail($SYSTEM_RCPT_EMAIL, $email_subject2, $email_content2,\n            \"From: \\\"$SYSTEM_EMAIL\\\" <\".$SYSTEM_EMAIL.\">\\r\\n\".\n            \"Reply-To: \\\"\".$myrows[0]->email.\"\\\" <\".$myrows[0]->email.\">\\r\\n\".\n            \"Content-Type: text/plain; charset=utf-8\\n\".\n            \"X-Mailer: PHP/\" . phpversion());      \n            \n            \n    $rows_affected = $wpdb->insert( TDE_APP_CALENDAR_DATA_TABLE, array( 'appointment_calendar_id' => TDE_APP_DEFAULT_CALENDAR_ID, \n                                                                        'datatime' => date(\"Y-m-d H:i:s\", strtotime($myrows[0]->buffered_date)), \n                                                                        'title' => $myrows[0]->email, \n                                                                        'description' => str_replace(\"\\n\",\"<br />\", $information)\n                                                                         ) );             \n   \n   // $fp = fopen(dirname( __FILE__ ) .'/TDE_AppCalendar/admin/database/cal1data.txt', 'a');                                                              \n   // fwrite($fp, $myrows[0]->buffered_date);\n   // fclose($fp);\t \n    \n\n}\n\n\nadd_action( 'init', 'dex_appointments_calendar_load', 11 );\nadd_action( 'init', 'dex_appointments_calendar_load2', 11 );\nadd_action( 'init', 'dex_appointments_calendar_update', 11 );\nadd_action( 'init', 'dex_appointments_calendar_update2', 11 );\n\nfunction dex_appointments_calendar_load() {        \n    global $wpdb;  \n\tif ( ! isset( $_GET['calendar_load'] ) || $_GET['calendar_load'] != '1' )\n\t\treturn;\n    @ob_clean();\n    header(\"Cache-Control: no-store, no-cache, must-revalidate\");\n    header(\"Pragma: no-cache\");        \n    $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n    $query = \"SELECT * FROM \".TDE_APP_CONFIG.\" where \".TDE_APP_CONFIG_ID.\"='\".$calid.\"'\";    \n    $row = $wpdb->get_results($query,ARRAY_A);\n    if ($row[0])\n    {\n        echo $row[0][TDE_APP_CONFIG_WORKINGDATES].\";\";\n        echo $row[0][TDE_APP_CONFIG_RESTRICTEDDATES].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES0].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES1].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES2].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES3].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES4].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES5].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES6].\";\";\n    }\n    \n    exit();\t\t    \n}\n\nfunction dex_appointments_calendar_load2() {        \n    global $wpdb;  \n\tif ( ! isset( $_GET['calendar_load2'] ) || $_GET['calendar_load2'] != '1' )\n\t\treturn;\n    @ob_clean();\n    header(\"Cache-Control: no-store, no-cache, must-revalidate\");\n    header(\"Pragma: no-cache\");      \n    $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n    $query = \"SELECT * FROM \".TDE_APP_CALENDAR_DATA_TABLE.\" where \".TDE_APP_DATA_IDCALENDAR.\"='\".$calid.\"'\";\n    $row_array = $wpdb->get_results($query,ARRAY_A);\n    foreach ($row_array as $row)\n    {\n        echo $row[TDE_APP_DATA_ID].\"\\n\";\n        $dn =  explode(\" \", $row[TDE_APP_DATA_DATETIME]);\n        $d1 =  explode(\"-\", $dn[0]);\n        $d2 =  explode(\":\", $dn[1]);\n        \n        echo intval($d1[0]).\",\".intval($d1[1]).\",\".intval($d1[2]).\"\\n\";\n        echo intval($d2[0]).\":\".($d2[1]).\"\\n\";\n        echo $row[TDE_APP_DATA_TITLE].\"\\n\";\n        echo $row[TDE_APP_DATA_DESCRIPTION].\"\\n*-*\\n\";\n    }\n  \n    exit();\t\t    \n}\n\nfunction dex_appointments_calendar_update() {                \n    global $wpdb, $user_ID;   \n    \n    if ( ! current_user_can('manage_options') )\n        return;\n            \n\tif ( ! isset( $_GET['calendar_update'] ) || $_GET['calendar_update'] != '1' )\n\t\treturn;\n    @ob_clean();\n    header(\"Cache-Control: no-store, no-cache, must-revalidate\");\n    header(\"Pragma: no-cache\");      \n    if ( $user_ID )\n    {  \n        $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n        $wpdb->query(\"update  \".TDE_APP_CONFIG.\" set \".TDE_APP_CONFIG_WORKINGDATES.\"='\".$_POST[\"workingDates\"].\"',\".TDE_APP_CONFIG_RESTRICTEDDATES.\"='\".$_POST[\"restrictedDates\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES0.\"='\".$_POST[\"timeWorkingDates0\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES1.\"='\".$_POST[\"timeWorkingDates1\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES2.\"='\".$_POST[\"timeWorkingDates2\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES3.\"='\".$_POST[\"timeWorkingDates3\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES4.\"='\".$_POST[\"timeWorkingDates4\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES5.\"='\".$_POST[\"timeWorkingDates5\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES6.\"='\".$_POST[\"timeWorkingDates6\"].\"'  where \".TDE_APP_CONFIG_ID.\"=\".$calid);   \n    }\n    \n    exit();\t\t    \n}\n\nfunction dex_appointments_calendar_update2() {        \n    global $wpdb, $user_ID;  \n    \n    if ( ! current_user_can('manage_options') )\n        return;\n            \n\tif ( ! isset( $_GET['calendar_update2'] ) || $_GET['calendar_update2'] != '1' )\n\t\treturn;\n    @ob_clean();\n    header(\"Cache-Control: no-store, no-cache, must-revalidate\");\n    header(\"Pragma: no-cache\");  \n    if ( $user_ID )\n    {   \n        if ($_GET[\"act\"]=='del')\n        {\n            $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n            $wpdb->query(\"delete from \".TDE_APP_CALENDAR_DATA_TABLE.\" where \".TDE_APP_DATA_IDCALENDAR.\"=\".$calid.\" and \".TDE_APP_DATA_ID.\"=\".$_POST[\"sqlId\"]);\n            \n        }\n        else if ($_GET[\"act\"]=='edit')\n        {\n            $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n            $data = explode(\"\\n\", $_POST[\"appoiments\"]);\n            $d1 =  explode(\",\", $data[0]);\n            $d2 =  explode(\":\", $data[1]);\n\t        $datetime = $d1[0].\"-\".$d1[1].\"-\".$d1[2].\" \".$d2[0].\":\".$d2[1];\n\t        $title = $data[2];\n            $description = \"\";\n            for ($j=3;$j<count($data);$j++)\n            {\n                $description .= $data[$j];\n                if ($j!=count($data)-1)\n                    $description .= \"\\n\";\n            }\n            $wpdb->query(\"update  \".TDE_APP_CALENDAR_DATA_TABLE.\" set \".TDE_APP_DATA_DATETIME.\"='\".$datetime.\"',\".TDE_APP_DATA_TITLE.\"='\".esc_sql($title).\"',\".TDE_APP_DATA_DESCRIPTION.\"='\".esc_sql($description).\"'  where \".TDE_APP_DATA_IDCALENDAR.\"=\".$calid.\" and \".TDE_APP_DATA_ID.\"=\".$_POST[\"sqlId\"]);\n        }\n        else if ($_GET[\"act\"]=='add')\n        {\n            $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n            $data = explode(\"\\n\", $_POST[\"appoiments\"]);\n            $d1 =  explode(\",\", $data[0]);\n            $d2 =  explode(\":\", $data[1]);\n\t        $datetime = $d1[0].\"-\".$d1[1].\"-\".$d1[2].\" \".$d2[0].\":\".$d2[1];\n\t        $title = $data[2];\n            $description = \"\";\n            for ($j=3;$j<count($data);$j++)\n            {\n                $description .= $data[$j];\n                if ($j!=count($data)-1)\n                    $description .= \"\\n\";\n            }\n            $wpdb->query(\"insert into \".TDE_APP_CALENDAR_DATA_TABLE.\"(\".TDE_APP_DATA_IDCALENDAR.\",\".TDE_APP_DATA_DATETIME.\",\".TDE_APP_DATA_TITLE.\",\".TDE_APP_DATA_DESCRIPTION.\") values(\".$calid.\",'\".$datetime.\"','\".esc_sql($title).\"','\".esc_sql($description).\"') \"); \n            echo  $wpdb->insert_id;\n            \n        }\n    }\n    \n    exit();\t\t    \n}\n\n\nfunction cp_appointment_get_site_url()\n{\n    $url = parse_url(get_site_url());\n    $url = rtrim($url[\"path\"],\"/\");\n    return $url;\n}\n\nfunction cp_appointment_get_FULL_site_url()\n{\n    $url = parse_url(get_site_url());\n    $url = rtrim($url[\"path\"],\"/\");\n    $pos = strpos($url, \"://\");    \n    if ($pos === false)\n        $url = 'http://'.$_SERVER[\"HTTP_HOST\"].$url;\n    return $url;\n}\n\n?>"], "fixing_code": ["<?php\n/*\nPlugin Name: CP Appointment Calendar\nPlugin URI: http://wordpress.dwbooster.com/calendars/cp-appointment-calendar\nDescription: This plugin allows you to easily insert appointments forms into your WP website.\nVersion: 1.1.5\nAuthor: CodePeople.net\nAuthor URI: http://codepeople.net\nLicense: GPL\n*/\n\n\n/* initialization / install / uninstall functions */\n\n\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_LANGUAGE', 'EN');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_DATEFORMAT', '0');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_MILITARYTIME', '1');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_WEEKDAY', '0');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_MINDATE', 'today');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_MAXDATE', '');\ndefine('DEX_APPOINTMENTS_DEFAULT_CALENDAR_PAGES', 1);\n\ndefine('DEX_APPOINTMENTS_DEFAULT_ENABLE_PAYPAL', 1);\ndefine('DEX_APPOINTMENTS_DEFAULT_PAYPAL_EMAIL','put_your@email_here.com');\ndefine('DEX_APPOINTMENTS_DEFAULT_PRODUCT_NAME','Consultation');\ndefine('DEX_APPOINTMENTS_DEFAULT_COST','25');\ndefine('DEX_APPOINTMENTS_DEFAULT_OK_URL',get_site_url());\ndefine('DEX_APPOINTMENTS_DEFAULT_CANCEL_URL',get_site_url());\ndefine('DEX_APPOINTMENTS_DEFAULT_CURRENCY','USD');\ndefine('DEX_APPOINTMENTS_DEFAULT_PAYPAL_LANGUAGE','EN');\n\ndefine('DEX_APPOINTMENTS_DEFAULT_SUBJECT_CONFIRMATION_EMAIL', 'Thank you for your request...');\ndefine('DEX_APPOINTMENTS_DEFAULT_CONFIRMATION_EMAIL', \"We have received your request with the following information:\\n\\n%INFORMATION%\\n\\nThank you.\\n\\nBest regards.\");\ndefine('DEX_APPOINTMENTS_DEFAULT_SUBJECT_NOTIFICATION_EMAIL','New appointment requested...');\ndefine('DEX_APPOINTMENTS_DEFAULT_NOTIFICATION_EMAIL', \"New appointment made with the following information:\\n\\n%INFORMATION%\\n\\nBest regards.\");\n\n\ndefine('DEX_APPOINTMENTS_TABLE_NAME_NO_PREFIX', \"dex_appointments\");\ndefine('DEX_APPOINTMENTS_TABLE_NAME', @$wpdb->prefix . DEX_APPOINTMENTS_TABLE_NAME_NO_PREFIX);\n\ndefine('DEX_APPOINTMENTS_CALENDARS_TABLE_NAME_NO_PREFIX', \"appointment_calendars_data\");\ndefine('DEX_APPOINTMENTS_CALENDARS_TABLE_NAME', @$wpdb->prefix .\"appointment_calendars_data\");\n\ndefine('DEX_APPOINTMENTS_CONFIG_TABLE_NAME_NO_PREFIX', \"appointment_calendars\");\ndefine('DEX_APPOINTMENTS_CONFIG_TABLE_NAME', @$wpdb->prefix .\"appointment_calendars\");\n\n// calendar constants\n\ndefine(\"TDE_APP_DEFAULT_CALENDAR_ID\",\"1\");\ndefine(\"TDE_APP_DEFAULT_CALENDAR_LANGUAGE\",\"EN\");\n\ndefine(\"TDE_APP_CAL_PREFIX\", \"cal\");\ndefine(\"TDE_APP_CONFIG\",DEX_APPOINTMENTS_CONFIG_TABLE_NAME);\ndefine(\"TDE_APP_CONFIG_ID\",\"id\");\ndefine(\"TDE_APP_CONFIG_TITLE\",\"title\");\ndefine(\"TDE_APP_CONFIG_USER\",\"uname\");\ndefine(\"TDE_APP_CONFIG_PASS\",\"passwd\");\ndefine(\"TDE_APP_CONFIG_LANG\",\"lang\");\ndefine(\"TDE_APP_CONFIG_CPAGES\",\"cpages\");\ndefine(\"TDE_APP_CONFIG_TYPE\",\"ctype\");\ndefine(\"TDE_APP_CONFIG_MSG\",\"msg\");\ndefine(\"TDE_APP_CONFIG_WORKINGDATES\",\"workingDates\");\ndefine(\"TDE_APP_CONFIG_RESTRICTEDDATES\",\"restrictedDates\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES0\",\"timeWorkingDates0\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES1\",\"timeWorkingDates1\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES2\",\"timeWorkingDates2\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES3\",\"timeWorkingDates3\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES4\",\"timeWorkingDates4\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES5\",\"timeWorkingDates5\");\ndefine(\"TDE_APP_CONFIG_TIMEWORKINGDATES6\",\"timeWorkingDates6\");\ndefine(\"TDE_APP_CALDELETED_FIELD\",\"caldeleted\");\n\ndefine(\"TDE_APP_CALENDAR_DATA_TABLE\",DEX_APPOINTMENTS_CALENDARS_TABLE_NAME);\ndefine(\"TDE_APP_DATA_ID\",\"id\");\ndefine(\"TDE_APP_DATA_IDCALENDAR\",\"appointment_calendar_id\");\ndefine(\"TDE_APP_DATA_DATETIME\",\"datatime\");\ndefine(\"TDE_APP_DATA_TITLE\",\"title\");\ndefine(\"TDE_APP_DATA_DESCRIPTION\",\"description\");\n// end calendar constants\n\n\nregister_activation_hook(__FILE__,'dex_appointments_install'); \nregister_deactivation_hook( __FILE__, 'dex_appointments_remove' );\n\nfunction dex_appointments_install() {\n    global $wpdb;\n    \n    \n    $table_name = $wpdb->prefix . DEX_APPOINTMENTS_TABLE_NAME_NO_PREFIX;\n      \n    $sql = \"CREATE TABLE $table_name (\n         id mediumint(9) NOT NULL AUTO_INCREMENT,\n         time datetime DEFAULT '0000-00-00 00:00:00' NOT NULL,\n         booked_time VARCHAR(250) DEFAULT '' NOT NULL,\n         name VARCHAR(250) DEFAULT '' NOT NULL,\n         email VARCHAR(250) DEFAULT '' NOT NULL,\n         phone VARCHAR(250) DEFAULT '' NOT NULL,\n         question text,\n         buffered_date text,\n         UNIQUE KEY id (id)\n         );\";\n         \n    $sql .= \"CREATE TABLE `\".$wpdb->prefix.DEX_APPOINTMENTS_CONFIG_TABLE_NAME.\"` (`\".TDE_APP_CONFIG_ID.\"` int(10) unsigned NOT NULL auto_increment,`\".TDE_APP_CONFIG_TITLE.\"` varchar(255) NOT NULL default '',`\".TDE_APP_CONFIG_USER.\"` varchar(100) default NULL,`\".TDE_APP_CONFIG_PASS.\"` varchar(100) default NULL,`\".TDE_APP_CONFIG_LANG.\"` varchar(5) default NULL,`\".TDE_APP_CONFIG_CPAGES.\"` tinyint(3) unsigned default NULL,`\".TDE_APP_CONFIG_TYPE.\"` tinyint(3) unsigned default NULL,`\".TDE_APP_CONFIG_MSG.\"` varchar(255) NOT NULL default '',`\".TDE_APP_CONFIG_WORKINGDATES.\"` varchar(255) NOT NULL default '',`\".TDE_APP_CONFIG_RESTRICTEDDATES.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES0.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES1.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES2.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES3.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES4.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES5.\"` text,`\".TDE_APP_CONFIG_TIMEWORKINGDATES6.\"` text,`\".TDE_APP_CALDELETED_FIELD.\"` tinyint(3) unsigned default NULL,PRIMARY KEY (`\".TDE_APP_CONFIG_ID.\"`)); \";\n    $sql .= \"CREATE TABLE `\".$wpdb->prefix.DEX_APPOINTMENTS_CALENDARS_TABLE_NAME.\"` (`\".TDE_APP_DATA_ID.\"` int(10) unsigned NOT NULL auto_increment,`\".TDE_APP_DATA_IDCALENDAR.\"` int(10) unsigned default NULL,`\".TDE_APP_DATA_DATETIME.\"`datetime NOT NULL default '0000-00-00 00:00:00',`\".TDE_APP_DATA_TITLE.\"` varchar(250) default NULL,`\".TDE_APP_DATA_DESCRIPTION.\"` text,PRIMARY KEY (`\".TDE_APP_DATA_ID.\"`)) ;\";\n    $sql .= 'INSERT INTO `'.$wpdb->prefix.DEX_APPOINTMENTS_CONFIG_TABLE_NAME.'` (`'.TDE_APP_CONFIG_ID.'`,`'.TDE_APP_CONFIG_TITLE.'`,`'.TDE_APP_CONFIG_USER.'`,`'.TDE_APP_CONFIG_PASS.'`,`'.TDE_APP_CONFIG_LANG.'`,`'.TDE_APP_CONFIG_CPAGES.'`,`'.TDE_APP_CONFIG_TYPE.'`,`'.TDE_APP_CONFIG_MSG.'`,`'.TDE_APP_CONFIG_WORKINGDATES.'`,`'.TDE_APP_CONFIG_RESTRICTEDDATES.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES0.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES1.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES2.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES3.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES4.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES5.'`,`'.TDE_APP_CONFIG_TIMEWORKINGDATES6.'`,`'.TDE_APP_CALDELETED_FIELD.'`) VALUES(\"1\",\"cal1\",\"\",\"\",\"ENG\",\"1\",\"3\",\"Please, select your appointment.\",\"1,2,3,4,5\",\"\",\"\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0\",\"\",\"0\");';  \n\n    require_once(ABSPATH . 'wp-admin/includes/upgrade.php');\n    dbDelta($sql);    \n    \n    add_option(\"dex_appointments_data\", 'Default', '', 'yes'); // Creates new database field \n}\n\nfunction dex_appointments_remove() {    \n    delete_option('dex_appointments_data'); // Deletes the database field \n}\n\n\n/* Filter for placing the maps into the contents */\n\nadd_filter('the_content','dex_appointments_filter_content');\n\nfunction dex_appointments_filter_content($content) {\n    \n    if (strpos($content, \"[APPOINTMENT_CALENDAR_FORM_WILL_APPEAR_HERE]\") !== false) \n    {        \n        ob_start();\n        define('DEX_AUTH_INCLUDE', true);\n        @include dirname( __FILE__ ) . '/dex_scheduler.inc.php';\n        $buffered_contents = ob_get_contents();\n        ob_end_clean();\n\n        $content = str_replace(\"[APPOINTMENT_CALENDAR_FORM_WILL_APPEAR_HERE]\", $buffered_contents, $content);\n    }    \n    return $content;\n}\n\n\nfunction dex_appointments_show_booking_form($id = \"\")\n{\n    if ($id != '')\n        define ('DEX_CALENDAR_FIXED_ID',$id);\n    define('DEX_AUTH_INCLUDE', true);\n    @include dirname( __FILE__ ) . '/dex_scheduler.inc.php';    \n}\n\n/* Code for the admin area */\n\nif ( is_admin() ) {\n    add_action('media_buttons', 'set_dex_apps_insert_button', 100);\n    add_action('admin_enqueue_scripts', 'set_dex_apps_insert_adminScripts', 1);\n    add_action('admin_menu', 'dex_appointments_admin_menu');\n    add_action('admin_init', 'register_mysettings' );\n    \n    $plugin = plugin_basename(__FILE__);        \n    add_filter(\"plugin_action_links_\".$plugin, 'dex_customAdjustmentsLink');    \n    add_filter(\"plugin_action_links_\".$plugin, 'dex_settingsLink');\n    add_filter(\"plugin_action_links_\".$plugin, 'dex_helpLink');\n    \n    \n    \n\n    function register_mysettings() { // whitelist options\n      \n      register_setting( 'dex-appointments-group', 'calendar_language' );\n      register_setting( 'dex-appointments-group', 'calendar_dateformat' );\n      register_setting( 'dex-appointments-group', 'calendar_militarytime' );\n      register_setting( 'dex-appointments-group', 'calendar_weekday' );\n      register_setting( 'dex-appointments-group', 'calendar_mindate' );\n      register_setting( 'dex-appointments-group', 'calendar_maxdate' );        \n      register_setting( 'dex-appointments-group', 'calendar_pages' );\n        \n      register_setting( 'dex-appointments-group', 'enable_paypal' );\n      register_setting( 'dex-appointments-group', 'paypal_email' );\n      register_setting( 'dex-appointments-group', 'request_cost' );\n      register_setting( 'dex-appointments-group', 'paypal_product_name' );\n      register_setting( 'dex-appointments-group', 'currency' );\n      register_setting( 'dex-appointments-group', 'url_ok' );\n      register_setting( 'dex-appointments-group', 'url_cancel' );\n      register_setting( 'dex-appointments-group', 'paypal_language' );\n      \n      register_setting( 'dex-appointments-group', 'notification_from_email' );\n      register_setting( 'dex-appointments-group', 'notification_destination_email' );\n      register_setting( 'dex-appointments-group', 'email_subject_confirmation_to_user' );\n      register_setting( 'dex-appointments-group', 'email_confirmation_to_user' );\n      register_setting( 'dex-appointments-group', 'email_subject_notification_to_admin' );\n      register_setting( 'dex-appointments-group', 'email_notification_to_admin' );\n    }\n\n    function dex_appointments_admin_menu() {                \n        add_options_page('CP Appointment Calendar Options', 'CP Appointment Calendar', 'manage_options', 'dex_appointments', 'dex_appointments_html_post_page' );\n    }\n}\n\nfunction dex_settingsLink($links) {\n    $settings_link = '<a href=\"options-general.php?page=dex_appointments\">'.__('Settings').'</a>'; \n\tarray_unshift($links, $settings_link);     \n\treturn $links;\n}\n\nfunction dex_helpLink($links) {\n    $help_link = '<a href=\"http://wordpress.dwbooster.com/calendars/cp-appointment-calendar\">'.__('Help').'</a>'; \n\tarray_unshift($links, $help_link);     \n\treturn $links;\n}\n\nfunction dex_customAdjustmentsLink($links) {\n    $customAdjustments_link = '<a href=\"http://wordpress.dwbooster.com/contact-us\">'.__('Request custom changes').'</a>'; \n\tarray_unshift($links, $customAdjustments_link);     \n\treturn $links;\n}\n\nfunction dex_appointments_html_post_page() {\n    @include_once dirname( __FILE__ ) . '/dex_appointments_admin_int.inc.php';\n\n}\n\nfunction set_dex_apps_insert_button() {\n    print '<a href=\"javascript:dex_appointments_insertCalendar();\" title=\"'.__('Insert Appointment Calendar').'\"><img hspace=\"5\" src=\"'.plugins_url('/images/dex_apps.gif', __FILE__).'\" alt=\"'.__('Insert  Appointment Calendar').'\" /></a>';    \n} \n\nfunction set_dex_apps_insert_adminScripts($hook) { \n    if( 'post.php' != $hook  && 'post-new.php' != $hook )\n        return;\n    wp_enqueue_script( 'my_custom_script', plugins_url('/dex_script.js', __FILE__) );\n}\n\n\n/* hook for checking posted data for the admin area */\n\nadd_action( 'init', 'dex_appointments_check_posted_data', 11 );\n\nfunction dex_appointments_check_posted_data() {\n\t\n    global $wpdb;\n    \n\tif ( 'POST' != $_SERVER['REQUEST_METHOD'] || ! isset( $_POST['dex_appointments_post'] ) )\t\t\n\t\treturn;\n\n    $_POST[\"dateAndTime\"] =  $_POST[\"selYearcal1\"].\"-\".$_POST[\"selMonthcal1\"].\"-\".$_POST[\"selDaycal1\"].\" \".$_POST[\"selHourcal1\"].\":\".$_POST[\"selMinutecal1\"];\n    $_POST[\"Date\"] = date(\"m/d/Y H:i\",strtotime($_POST[\"dateAndTime\"]));\n    \n   \n    $buffer = $_POST[\"selYearcal1\"].\",\".$_POST[\"selMonthcal1\"].\",\".$_POST[\"selDaycal1\"].\"\\n\".\n    $_POST[\"selHourcal1\"].\":\".($_POST[\"selMinutecal1\"]<10?\"0\":\"\").$_POST[\"selMinutecal1\"].\"\\n\".\n    \"Name: \".$_POST[\"name\"].\"\\n\".\n    \"Email: \".$_POST[\"email\"].\"\\n\".\n    \"Phone: \".$_POST[\"phone\"].\"\\n\".\n    \"Question: \".$_POST[\"question\"].\"\\n\".\n    \"*-*\\n\";\n\t\n    $rows_affected = $wpdb->insert( DEX_APPOINTMENTS_TABLE_NAME, array( 'time' => current_time('mysql'), \n                                                                        'booked_time' => $_POST[\"Date\"], \n                                                                        'name' => $_POST[\"name\"], \n                                                                        'email' => $_POST[\"email\"], \n                                                                        'phone' => $_POST[\"phone\"], \n                                                                        'question' => $_POST[\"question\"], \n                                                                        'buffered_date' => $_POST[\"dateAndTime\"]\n                                                                         ) );\n    if (!$rows_affected)\n    {\n        echo 'Error saving data! Please try again.';\n        exit;\n    }\n    \n    \n    $myrows = $wpdb->get_results( \"SELECT MAX(id) as max_id FROM \".DEX_APPOINTMENTS_TABLE_NAME );                                                                     \n     \t\n \t// save data here \t\n    $item_number = $myrows[0]->max_id; \n    \n\n?>\n<html>\n<head><title>Redirecting to Paypal...</title></head>\n<body>\n<form action=\"https://www.paypal.com/cgi-bin/webscr\" name=\"ppform3\" method=\"post\">\n<input type=\"hidden\" name=\"cmd\" value=\"_xclick\" />\n<input type=\"hidden\" name=\"business\" value=\"<?php echo get_option('paypal_email', DEX_APPOINTMENTS_DEFAULT_PAYPAL_EMAIL); ?>\" />\n<input type=\"hidden\" name=\"item_name\" value=\"<?php echo get_option('paypal_product_name', DEX_APPOINTMENTS_DEFAULT_PRODUCT_NAME); ?>\" />\n<input type=\"hidden\" name=\"item_number\" value=\"<?php echo $item_number; ?>\" />\n<input type=\"hidden\" name=\"amount\" value=\"<?php echo get_option('request_cost', DEX_APPOINTMENTS_DEFAULT_COST); ?>\" />\n<input type=\"hidden\" name=\"page_style\" value=\"Primary\" />\n<input type=\"hidden\" name=\"no_shipping\" value=\"1\" />\n<input type=\"hidden\" name=\"return\" value=\"<?php echo get_option('url_ok', DEX_APPOINTMENTS_DEFAULT_OK_URL); ?>\">\n<input type=\"hidden\" name=\"cancel_return\" value=\"<?php echo get_option('url_cancel', DEX_APPOINTMENTS_DEFAULT_CANCEL_URL); ?>\" />\n<input type=\"hidden\" name=\"no_note\" value=\"1\" />\n<input type=\"hidden\" name=\"currency_code\" value=\"<?php echo strtoupper(get_option('currency', DEX_APPOINTMENTS_DEFAULT_CURRENCY)); ?>\" />\n<input type=\"hidden\" name=\"lc\" value=\"<?php echo get_option('paypal_language', DEX_APPOINTMENTS_DEFAULT_PAYPAL_LANGUAGE); ?>\" />\n<input type=\"hidden\" name=\"bn\" value=\"NetFactorSL_SI_Custom\" />\n<input type=\"hidden\" name=\"notify_url\" value=\"<?php echo cp_appointment_get_FULL_site_url(); ?>/?ipncheck=1&itemnumber=<?php echo $item_number; ?>\" />\n<input type=\"hidden\" name=\"ipn_test\" value=\"1\" />\n<input class=\"pbutton\" type=\"hidden\" value=\"Buy Now\" /></div>\n</form>\n<script type=\"text/javascript\">\ndocument.ppform3.submit();\n</script>  \n</body>\n</html> \n<?php\n        exit();\n\n} \n\nadd_action( 'init', 'dex_appointments_check_IPN_verification', 11 );\n\nfunction dex_appointments_check_IPN_verification() {    \n    \n    global $wpdb;\n  \n\tif ( ! isset( $_GET['ipncheck'] ) || $_GET['ipncheck'] != '1' ||  ! isset( $_GET[\"itemnumber\"] ) )\n\t\treturn;\n\t\t\n    $item_name = $_POST['item_name'];\n    $item_number = $_POST['item_number'];\n    $payment_status = $_POST['payment_status'];\n    $payment_amount = $_POST['mc_gross'];\n    $payment_currency = $_POST['mc_currency'];\n    $txn_id = $_POST['txn_id'];\n    $receiver_email = $_POST['receiver_email'];\n    $payer_email = $_POST['payer_email'];\n    $payment_type = $_POST['payment_type'];\n\t\t\n\t\t\n    if (strtolower($payment_status) != 'completed' && strtolower($payment_type) != 'echeck')\n        return;\n\t    \n    if (strtolower($payment_type) == 'echeck' && strtolower($payment_status) == 'completed')    \n        return;            \t\n\n    dex_process_ready_to_go_appointment($_GET[\"itemnumber\"], $payer_email);    \n    \n    echo 'OK';\n    \n    exit();\n\t\t    \n}\n\nfunction dex_process_ready_to_go_appointment($itemnumber, $payer_email = \"\")\n{\n   global $wpdb;\n   \n   $itemnumber = intval($itemnumber);\n   \n   $myrows = $wpdb->get_results( \"SELECT * FROM \".DEX_APPOINTMENTS_TABLE_NAME.\" WHERE id=\".$itemnumber );   \n       \n   $SYSTEM_EMAIL = get_option('notification_from_email', DEX_APPOINTMENTS_DEFAULT_PAYPAL_EMAIL);\n   $SYSTEM_RCPT_EMAIL = get_option('notification_destination_email', DEX_APPOINTMENTS_DEFAULT_PAYPAL_EMAIL);\n   \n    \n   $email_subject1 = get_option('email_subject_confirmation_to_user', DEX_APPOINTMENTS_DEFAULT_SUBJECT_CONFIRMATION_EMAIL);\n   $email_content1 = get_option('email_confirmation_to_user', DEX_APPOINTMENTS_DEFAULT_CONFIRMATION_EMAIL);\n   $email_subject2 = get_option('email_subject_notification_to_admin', DEX_APPOINTMENTS_DEFAULT_SUBJECT_NOTIFICATION_EMAIL);\n   $email_content2 = get_option('email_notification_to_admin', DEX_APPOINTMENTS_DEFAULT_NOTIFICATION_EMAIL);\n   \n   $information = $myrows[0]->booked_time.\"\\n\".\n                  $myrows[0]->name.\"\\n\".  \n                  $myrows[0]->email.\"\\n\".  \n                  $myrows[0]->phone.\"\\n\".  \n                  $myrows[0]->question.\"\\n\";\n   \n   $email_content1 = str_replace(\"%INFORMATION%\", $information, $email_content1);\n   $email_content2 = str_replace(\"%INFORMATION%\", $information, $email_content2);\n   \n   // SEND EMAIL TO USER \n   wp_mail($myrows[0]->email, $email_subject1, $email_content1,\n            \"From: \\\"$SYSTEM_EMAIL\\\" <\".$SYSTEM_EMAIL.\">\\r\\n\".\n            \"Content-Type: text/plain; charset=utf-8\\n\".\n            \"X-Mailer: PHP/\" . phpversion());\n            \n   if ($payer_email && $payer_email != $myrows[0]->email)         \n       wp_mail($payer_email , $email_subject1, $email_content1,\n                \"From: \\\"$SYSTEM_EMAIL\\\" <\".$SYSTEM_EMAIL.\">\\r\\n\".\n                \"Content-Type: text/plain; charset=utf-8\\n\".\n                \"X-Mailer: PHP/\" . phpversion());\n\n   // SEND EMAIL TO ADMIN\n   wp_mail($SYSTEM_RCPT_EMAIL, $email_subject2, $email_content2,\n            \"From: \\\"$SYSTEM_EMAIL\\\" <\".$SYSTEM_EMAIL.\">\\r\\n\".\n            \"Reply-To: \\\"\".$myrows[0]->email.\"\\\" <\".$myrows[0]->email.\">\\r\\n\".\n            \"Content-Type: text/plain; charset=utf-8\\n\".\n            \"X-Mailer: PHP/\" . phpversion());      \n            \n            \n    $rows_affected = $wpdb->insert( TDE_APP_CALENDAR_DATA_TABLE, array( 'appointment_calendar_id' => TDE_APP_DEFAULT_CALENDAR_ID, \n                                                                        'datatime' => date(\"Y-m-d H:i:s\", strtotime($myrows[0]->buffered_date)), \n                                                                        'title' => $myrows[0]->email, \n                                                                        'description' => str_replace(\"\\n\",\"<br />\", $information)\n                                                                         ) );             \n   \n   // $fp = fopen(dirname( __FILE__ ) .'/TDE_AppCalendar/admin/database/cal1data.txt', 'a');                                                              \n   // fwrite($fp, $myrows[0]->buffered_date);\n   // fclose($fp);\t \n    \n\n}\n\n\nadd_action( 'init', 'dex_appointments_calendar_load', 11 );\nadd_action( 'init', 'dex_appointments_calendar_load2', 11 );\nadd_action( 'init', 'dex_appointments_calendar_update', 11 );\nadd_action( 'init', 'dex_appointments_calendar_update2', 11 );\n\nfunction dex_appointments_calendar_load() {        \n    global $wpdb;  \n\tif ( ! isset( $_GET['calendar_load'] ) || $_GET['calendar_load'] != '1' )\n\t\treturn;\n    @ob_clean();\n    header(\"Cache-Control: no-store, no-cache, must-revalidate\");\n    header(\"Pragma: no-cache\");        \n    $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n    $query = \"SELECT * FROM \".TDE_APP_CONFIG.\" where \".TDE_APP_CONFIG_ID.\"='\".$calid.\"'\";    \n    $row = $wpdb->get_results($query,ARRAY_A);\n    if ($row[0])\n    {\n        echo $row[0][TDE_APP_CONFIG_WORKINGDATES].\";\";\n        echo $row[0][TDE_APP_CONFIG_RESTRICTEDDATES].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES0].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES1].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES2].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES3].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES4].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES5].\";\";\n        echo $row[0][TDE_APP_CONFIG_TIMEWORKINGDATES6].\";\";\n    }\n    \n    exit();\t\t    \n}\n\nfunction dex_appointments_calendar_load2() {        \n    global $wpdb;  \n\tif ( ! isset( $_GET['calendar_load2'] ) || $_GET['calendar_load2'] != '1' )\n\t\treturn;\n    @ob_clean();\n    header(\"Cache-Control: no-store, no-cache, must-revalidate\");\n    header(\"Pragma: no-cache\");      \n    $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n    $query = \"SELECT * FROM \".TDE_APP_CALENDAR_DATA_TABLE.\" where \".TDE_APP_DATA_IDCALENDAR.\"='\".$calid.\"'\";\n    $row_array = $wpdb->get_results($query,ARRAY_A);\n    foreach ($row_array as $row)\n    {\n        echo $row[TDE_APP_DATA_ID].\"\\n\";\n        $dn =  explode(\" \", $row[TDE_APP_DATA_DATETIME]);\n        $d1 =  explode(\"-\", $dn[0]);\n        $d2 =  explode(\":\", $dn[1]);\n        \n        echo intval($d1[0]).\",\".intval($d1[1]).\",\".intval($d1[2]).\"\\n\";\n        echo intval($d2[0]).\":\".($d2[1]).\"\\n\";\n        echo $row[TDE_APP_DATA_TITLE].\"\\n\";\n        echo $row[TDE_APP_DATA_DESCRIPTION].\"\\n*-*\\n\";\n    }\n  \n    exit();\t\t    \n}\n\nfunction dex_appointments_calendar_update() {                \n    global $wpdb, $user_ID;   \n    \n    if ( ! current_user_can('manage_options') )\n        return;\n            \n\tif ( ! isset( $_GET['calendar_update'] ) || $_GET['calendar_update'] != '1' )\n\t\treturn;\n    @ob_clean();\n    header(\"Cache-Control: no-store, no-cache, must-revalidate\");\n    header(\"Pragma: no-cache\");      \n    if ( $user_ID )\n    {  \n        $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n        $wpdb->query(\"update  \".TDE_APP_CONFIG.\" set \".TDE_APP_CONFIG_WORKINGDATES.\"='\".$_POST[\"workingDates\"].\"',\".TDE_APP_CONFIG_RESTRICTEDDATES.\"='\".$_POST[\"restrictedDates\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES0.\"='\".$_POST[\"timeWorkingDates0\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES1.\"='\".$_POST[\"timeWorkingDates1\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES2.\"='\".$_POST[\"timeWorkingDates2\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES3.\"='\".$_POST[\"timeWorkingDates3\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES4.\"='\".$_POST[\"timeWorkingDates4\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES5.\"='\".$_POST[\"timeWorkingDates5\"].\"',\".TDE_APP_CONFIG_TIMEWORKINGDATES6.\"='\".$_POST[\"timeWorkingDates6\"].\"'  where \".TDE_APP_CONFIG_ID.\"=\".$calid);   \n    }\n    \n    exit();\t\t    \n}\n\nfunction dex_appointments_calendar_update2() {        \n    global $wpdb, $user_ID;  \n    \n    if ( ! current_user_can('manage_options') )\n        return;\n            \n\tif ( ! isset( $_GET['calendar_update2'] ) || $_GET['calendar_update2'] != '1' )\n\t\treturn;\n    @ob_clean();\n    header(\"Cache-Control: no-store, no-cache, must-revalidate\");\n    header(\"Pragma: no-cache\");  \n    if ( $user_ID )\n    {   \n        if ($_GET[\"act\"]=='del')\n        {\n            $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n            $wpdb->query(\"delete from \".TDE_APP_CALENDAR_DATA_TABLE.\" where \".TDE_APP_DATA_IDCALENDAR.\"=\".$calid.\" and \".TDE_APP_DATA_ID.\"=\".$_POST[\"sqlId\"]);\n            \n        }\n        else if ($_GET[\"act\"]=='edit')\n        {\n            $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n            $data = explode(\"\\n\", $_POST[\"appoiments\"]);\n            $d1 =  explode(\",\", $data[0]);\n            $d2 =  explode(\":\", $data[1]);\n\t        $datetime = $d1[0].\"-\".$d1[1].\"-\".$d1[2].\" \".$d2[0].\":\".$d2[1];\n\t        $title = $data[2];\n            $description = \"\";\n            for ($j=3;$j<count($data);$j++)\n            {\n                $description .= $data[$j];\n                if ($j!=count($data)-1)\n                    $description .= \"\\n\";\n            }\n            $wpdb->query(\"update  \".TDE_APP_CALENDAR_DATA_TABLE.\" set \".TDE_APP_DATA_DATETIME.\"='\".$datetime.\"',\".TDE_APP_DATA_TITLE.\"='\".esc_sql($title).\"',\".TDE_APP_DATA_DESCRIPTION.\"='\".esc_sql($description).\"'  where \".TDE_APP_DATA_IDCALENDAR.\"=\".$calid.\" and \".TDE_APP_DATA_ID.\"=\".$_POST[\"sqlId\"]);\n        }\n        else if ($_GET[\"act\"]=='add')\n        {\n            $calid = str_replace  (TDE_APP_CAL_PREFIX, \"\",$_GET[\"id\"]);\n            $data = explode(\"\\n\", $_POST[\"appoiments\"]);\n            $d1 =  explode(\",\", $data[0]);\n            $d2 =  explode(\":\", $data[1]);\n\t        $datetime = $d1[0].\"-\".$d1[1].\"-\".$d1[2].\" \".$d2[0].\":\".$d2[1];\n\t        $title = $data[2];\n            $description = \"\";\n            for ($j=3;$j<count($data);$j++)\n            {\n                $description .= $data[$j];\n                if ($j!=count($data)-1)\n                    $description .= \"\\n\";\n            }\n            $wpdb->query(\"insert into \".TDE_APP_CALENDAR_DATA_TABLE.\"(\".TDE_APP_DATA_IDCALENDAR.\",\".TDE_APP_DATA_DATETIME.\",\".TDE_APP_DATA_TITLE.\",\".TDE_APP_DATA_DESCRIPTION.\") values(\".$calid.\",'\".$datetime.\"','\".esc_sql($title).\"','\".esc_sql($description).\"') \"); \n            echo  $wpdb->insert_id;\n            \n        }\n    }\n    \n    exit();\t\t    \n}\n\n\nfunction cp_appointment_get_site_url()\n{\n    $url = parse_url(get_site_url());\n    $url = rtrim($url[\"path\"],\"/\");\n    return $url;\n}\n\nfunction cp_appointment_get_FULL_site_url()\n{\n    $url = parse_url(get_site_url());\n    $url = rtrim($url[\"path\"],\"/\");\n    $pos = strpos($url, \"://\");    \n    if ($pos === false)\n        $url = 'http://'.$_SERVER[\"HTTP_HOST\"].$url;\n    return $url;\n}\n\n?>"], "filenames": ["dex_appointments.php"], "buggy_code_start_loc": [341], "buggy_code_end_loc": [341], "fixing_code_start_loc": [342], "fixing_code_end_loc": [344], "type": "CWE-89", "message": "A vulnerability classified as critical has been found in CP Appointment Calendar Plugin up to 1.1.5. This affects the function dex_process_ready_to_go_appointment of the file dex_appointments.php. The manipulation of the argument itemnumber leads to sql injection. It is possible to initiate the attack remotely. The name of the patch is e29a9cdbcb0f37d887dd302a05b9e8bf213da01d. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-225351.", "other": {"cve": {"id": "CVE-2015-10099", "sourceIdentifier": "cna@vuldb.com", "published": "2023-04-10T12:15:07.093", "lastModified": "2023-04-18T01:40:40.507", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as critical has been found in CP Appointment Calendar Plugin up to 1.1.5. This affects the function dex_process_ready_to_go_appointment of the file dex_appointments.php. The manipulation of the argument itemnumber leads to sql injection. It is possible to initiate the attack remotely. The name of the patch is e29a9cdbcb0f37d887dd302a05b9e8bf213da01d. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-225351."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:codepeople:cp_appointment_calendar:*:*:*:*:*:wordpress:*:*", "versionEndIncluding": "1.1.5", "matchCriteriaId": "1E05C44A-B339-4BBE-B9BB-98E7F5129D5A"}]}]}], "references": [{"url": "https://github.com/wp-plugins/cp-appointment-calendar/commit/e29a9cdbcb0f37d887dd302a05b9e8bf213da01d", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://vuldb.com/?ctiid.225351", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.225351", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/wp-plugins/cp-appointment-calendar/commit/e29a9cdbcb0f37d887dd302a05b9e8bf213da01d"}}