{"buggy_code": ["<?php // 5.3.3\n\n/*\n * delete.php - deletes an uploaded file from a user's subdirectory\n *\n * Author: Alexander Breen (alexander.breen@gmail.com)\n */\n\nrequire 'lib/init.php';\nrequire 'lib/socrates.php';\n\n// redirects to log in page if necessary\nrequire 'auth.php';\n\nif (!isset($_GET['type']) || !isset($_GET['num']) || !isset($_GET['file']))\n    trigger_error('invalid or not enough parameters');\n\ncheck_assignment($_GET['num'], $_GET['type']);\n\n$num = $_GET['num'];\n$type = $_GET['type'];\n\ndelete_file($num, $type, $_SESSION['username'], $_GET['file']);\n\n$vars = array();\n\n$vars['assignment'] = htmlspecialchars(assignment_name($num, $type));\n$vars['filename'] = $_GET['file'];\n$vars['url'] = \"upload.php?type=$type&num=$num\";\n\nset_title('Deleted');\nuse_body_template('delete');\nrender_page($vars);\n", "<?php // 5.3.3\n\n/*\n * download.php - downloads an uploaded file in a user's subdirectory\n *\n * Author: Alexander Breen (alexander.breen@gmail.com)\n */\n\nrequire 'lib/init.php';\nrequire 'lib/socrates.php';\n\n// redirects to log in page if necessary\nrequire 'auth.php';\n\nif (!isset($_GET['type']) || !isset($_GET['num']) || !isset($_GET['file']))\n    trigger_error('invalid or not enough parameters');\n\ncheck_assignment($_GET['num'], $_GET['type']);\n\n$num = $_GET['num'];\n$type = $_GET['type'];\n$assignment_name = htmlspecialchars(assignment_name($num, $type));\n\n$path = submission_path($num, $type, $_SESSION['username'], $_GET['file']);\n\nif (!file_exists($path))\n    trigger_error('the specified file does not exist: ' . $_GET['file']);\n\nheader('Content-Description: File Transfer');\nheader('Content-Type: application/octet-stream');\nheader('Content-Disposition: attachment; filename=' . basename($path));\nheader('Expires: 0');\nheader('Cache-Control: must-revalidate');\nheader('Pragma: public');\nheader('Content-Length: ' . filesize($path));\n\nreadfile($path);\n", "<?php // 5.3.3\n\n/*\n * view_file.php - displays the contents of a submitted file\n *\n * Author: Alexander Breen (alexander.breen@gmail.com)\n */\n\nrequire 'lib/init.php';\nrequire 'lib/socrates.php';\n\n// redirects to log in page if necessary\nrequire 'auth.php';\n\nif (!isset($_GET['type']) || !isset($_GET['num']) || !isset($_GET['file']))\n    trigger_error('invalid or not enough parameters');\n\ncheck_assignment($_GET['num'], $_GET['type']);\n\n$num = $_GET['num'];\n$type = $_GET['type'];\n$assignment_name = htmlspecialchars(assignment_name($num, $type));\n\n$path = submission_path($num, $type, $_SESSION['username'], $_GET['file']);\n\nif (!file_exists($path))\n    trigger_error('the specified file does not exist: ' . $_GET['file']);\n\n$vars = array();\n\n$vars['filename'] = $_GET['file'];\n$vars['file'] = htmlspecialchars(file_get_contents($path));\n\n$vars['url'] = \"upload.php?type=$type&num=$num\";\n$vars['assignment'] = $assignment_name;\n\n$ct = get_change_time($num, $type, $_SESSION['username'], $_GET['file']);\n$vars['ctime'] = $ct;\n\nset_title('Viewing ' . $_GET['file']);\nuse_body_template('view_file');\nrender_page($vars);\n"], "fixing_code": ["<?php // 5.3.3\n\n/*\n * delete.php - deletes an uploaded file from a user's subdirectory\n *\n * Author: Alexander Breen (alexander.breen@gmail.com)\n */\n\nrequire 'lib/init.php';\nrequire 'lib/socrates.php';\n\n// redirects to log in page if necessary\nrequire 'auth.php';\n\nif (!isset($_GET['type']) || !isset($_GET['num']) || !isset($_GET['file']))\n    trigger_error('invalid or not enough parameters');\n\ncheck_assignment($_GET['num'], $_GET['type']);\n\n$num = $_GET['num'];\n$type = $_GET['type'];\n\n// protects against attacks where '..' could be used in file path\nif (basename($_GET['file']) !== $_GET['file'])\n    trigger_error('invalid file path');\n\ndelete_file($num, $type, $_SESSION['username'], $_GET['file']);\n\n$vars = array();\n\n$vars['assignment'] = htmlspecialchars(assignment_name($num, $type));\n$vars['filename'] = $_GET['file'];\n$vars['url'] = \"upload.php?type=$type&num=$num\";\n\nset_title('Deleted');\nuse_body_template('delete');\nrender_page($vars);\n", "<?php // 5.3.3\n\n/*\n * download.php - downloads an uploaded file in a user's subdirectory\n *\n * Author: Alexander Breen (alexander.breen@gmail.com)\n */\n\nrequire 'lib/init.php';\nrequire 'lib/socrates.php';\n\n// redirects to log in page if necessary\nrequire 'auth.php';\n\nif (!isset($_GET['type']) || !isset($_GET['num']) || !isset($_GET['file']))\n    trigger_error('invalid or not enough parameters');\n\ncheck_assignment($_GET['num'], $_GET['type']);\n\n$num = $_GET['num'];\n$type = $_GET['type'];\n$assignment_name = htmlspecialchars(assignment_name($num, $type));\n\n// protects against attacks where '..' could be used in file path\nif (basename($_GET['file']) !== $_GET['file'])\n    trigger_error('invalid file path');\n\n$path = submission_path($num, $type, $_SESSION['username'], $_GET['file']);\n\nif (!file_exists($path))\n    trigger_error('the specified file does not exist: ' . $_GET['file']);\n\nheader('Content-Description: File Transfer');\nheader('Content-Type: application/octet-stream');\nheader('Content-Disposition: attachment; filename=' . basename($path));\nheader('Expires: 0');\nheader('Cache-Control: must-revalidate');\nheader('Pragma: public');\nheader('Content-Length: ' . filesize($path));\n\nreadfile($path);\n", "<?php // 5.3.3\n\n/*\n * view_file.php - displays the contents of a submitted file\n *\n * Author: Alexander Breen (alexander.breen@gmail.com)\n */\n\nrequire 'lib/init.php';\nrequire 'lib/socrates.php';\n\n// redirects to log in page if necessary\nrequire 'auth.php';\n\nif (!isset($_GET['type']) || !isset($_GET['num']) || !isset($_GET['file']))\n    trigger_error('invalid or not enough parameters');\n\ncheck_assignment($_GET['num'], $_GET['type']);\n\n$num = $_GET['num'];\n$type = $_GET['type'];\n$assignment_name = htmlspecialchars(assignment_name($num, $type));\n\n// protects against attacks where '..' could be used in file path\nif (basename($_GET['file']) !== $_GET['file'])\n    trigger_error('invalid file path');\n\n$path = submission_path($num, $type, $_SESSION['username'], $_GET['file']);\n\nif (!file_exists($path))\n    trigger_error('the specified file does not exist: ' . $_GET['file']);\n\n$vars = array();\n\n$vars['filename'] = $_GET['file'];\n$vars['file'] = htmlspecialchars(file_get_contents($path));\n\n$vars['url'] = \"upload.php?type=$type&num=$num\";\n$vars['assignment'] = $assignment_name;\n\n$ct = get_change_time($num, $type, $_SESSION['username'], $_GET['file']);\n$vars['ctime'] = $ct;\n\nset_title('Viewing ' . $_GET['file']);\nuse_body_template('view_file');\nrender_page($vars);\n"], "filenames": ["delete.php", "download.php", "view_file.php"], "buggy_code_start_loc": [22, 23, 23], "buggy_code_end_loc": [22, 23, 23], "fixing_code_start_loc": [23, 24, 24], "fixing_code_end_loc": [27, 28, 28], "type": "CWE-22", "message": "A vulnerability, which was classified as critical, was found in abreen Apollo. This affects an unknown part. The manipulation of the argument file leads to path traversal. The name of the patch is 6206406630780bbd074aff34f4683fb764faba71. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-218307.", "other": {"cve": {"id": "CVE-2015-10043", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-14T21:15:09.337", "lastModified": "2023-01-24T17:30:14.070", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as critical, was found in abreen Apollo. This affects an unknown part. The manipulation of the argument file leads to path traversal. The name of the patch is 6206406630780bbd074aff34f4683fb764faba71. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-218307."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-22"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:apollo_project:apollo:*:*:*:*:*:*:*:*", "versionEndExcluding": "2015-01-29", "matchCriteriaId": "00BDEC68-FD93-4B0C-B8A4-92F02C44CDAC"}]}]}], "references": [{"url": "https://github.com/abreen/Apollo/commit/6206406630780bbd074aff34f4683fb764faba71", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.218307", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.218307", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/abreen/Apollo/commit/6206406630780bbd074aff34f4683fb764faba71"}}