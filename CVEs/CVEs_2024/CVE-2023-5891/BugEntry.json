{"buggy_code": ["<?php\n/**\n * @file classes/components/form/site/PKPRestrictBulkEmailsForm.inc.php\n *\n * Copyright (c) 2014-2021 Simon Fraser University\n * Copyright (c) 2000-2021 John Willinsky\n * Distributed under the GNU GPL v3. For full terms see the file docs/COPYING.\n *\n * @class PKPRestrictBulkEmailsForm\n * @ingroup classes_controllers_form\n *\n * @brief A form for setting restrictions on the sending of bulk emails in a context.\n */\nnamespace PKP\\components\\forms\\context;\nuse \\PKP\\components\\forms\\FormComponent;\nuse \\PKP\\components\\forms\\FieldOptions;\n\ndefine('FORM_RESTRICT_BULK_EMAILS', 'restrictBulkEmails');\n\nclass PKPRestrictBulkEmailsForm extends FormComponent {\n\t/** @copydoc FormComponent::$id */\n\tpublic $id = FORM_RESTRICT_BULK_EMAILS;\n\n\t/** @copydoc FormComponent::$method */\n\tpublic $method = 'PUT';\n\n\t/**\n\t * Constructor\n\t *\n\t * @param string $action URL to submit the form to\n\t * @param Context $site Journal, press or preprint server\n\t * @param DAOResultFactory $userGroups\n\t */\n\tpublic function __construct($action, $context, $userGroups) {\n\t\t$this->action = $action;\n\n\t\t$userGroupOptions = [];\n\t\twhile ($userGroup = $userGroups->next()) {\n\t\t\t$userGroupOptions[] = [\n\t\t\t\t'value' => $userGroup->getId(),\n\t\t\t\t'label' => $userGroup->getLocalizedData('name'),\n\t\t\t];\n\t\t}\n\n\t\t$request = \\Application::get()->getRequest();\n\t\t$siteSettingsUrl = $request->getDispatcher()->url($request, ROUTE_PAGE, null, 'admin', 'settings', null, null, 'setup/bulkEmails');\n\n\t\t$this->addField(new FieldOptions('disableBulkEmailUserGroups', [\n\t\t\t'label' => __('admin.settings.disableBulkEmailRoles.label'),\n\t\t\t'description' => __('admin.settings.disableBulkEmailRoles.description', ['siteSettingsUrl' => $siteSettingsUrl]),\n\t\t\t'value' => (array) $context->getData('disableBulkEmailUserGroups'),\n\t\t\t'options' => $userGroupOptions,\n\t\t]));\n\t}\n}\n", "<?php\n/**\n * @file classes/components/form/site/PKPSiteBulkEmailsForm.inc.php\n *\n * Copyright (c) 2014-2021 Simon Fraser University\n * Copyright (c) 2000-2021 John Willinsky\n * Distributed under the GNU GPL v3. For full terms see the file docs/COPYING.\n *\n * @class PKPSiteBulkEmailsForm\n * @ingroup classes_controllers_form\n *\n * @brief A form for enabling the bulk email features.\n */\nnamespace PKP\\components\\forms\\site;\nuse \\PKP\\components\\forms\\FormComponent;\nuse \\PKP\\components\\forms\\FieldOptions;\n\ndefine('FORM_SITE_BULK_EMAILS', 'bulkEmails');\n\nclass PKPSiteBulkEmailsForm extends FormComponent {\n\t/** @copydoc FormComponent::$id */\n\tpublic $id = FORM_SITE_BULK_EMAILS;\n\n\t/** @copydoc FormComponent::$method */\n\tpublic $method = 'PUT';\n\n\t/**\n\t * Constructor\n\t *\n\t * @param string $action URL to submit the form to\n\t * @param Site $site\n\t * @param Array $contexts List of context summary objects. See PKPContextQueryBuilder::getManySummary()\n\t */\n\tpublic function __construct($action, $site, $contexts) {\n\t\t$this->action = $action;\n\n\t\t$request = \\Application::get()->getRequest();\n\t\t$hostedContextsUrl = $request->getDispatcher()->url($request, ROUTE_PAGE, null, 'admin', 'contexts');\n\n\t\t$options = [];\n\t\tforeach ($contexts as $context) {\n\t\t\t$options[] = [\n\t\t\t\t'value' => $context->id,\n\t\t\t\t'label' => $context->name,\n\t\t\t];\n\t\t}\n\n\t\t$this->addField(new FieldOptions('enableBulkEmails', [\n\t\t\t'label' => __('admin.settings.enableBulkEmails.label'),\n\t\t\t'description' => __('admin.settings.enableBulkEmails.description', ['hostedContextsUrl' => $hostedContextsUrl]),\n\t\t\t'value' => (array) $site->getData('enableBulkEmails'),\n\t\t\t'options' => $options,\n\t\t]));\n\t}\n}\n", "<?php\n/**\n * @file classes/components/form/site/PKPSiteConfigForm.inc.php\n *\n * Copyright (c) 2014-2021 Simon Fraser University\n * Copyright (c) 2000-2021 John Willinsky\n * Distributed under the GNU GPL v3. For full terms see the file docs/COPYING.\n *\n * @class PKPSiteConfigForm\n * @ingroup classes_controllers_form\n *\n * @brief A preset form for the site config settings.\n */\nnamespace PKP\\components\\forms\\site;\nuse \\PKP\\components\\forms\\FormComponent;\nuse \\PKP\\components\\forms\\FieldSelect;\nuse \\PKP\\components\\forms\\FieldText;\n\ndefine('FORM_SITE_CONFIG', 'siteConfig');\n\nclass PKPSiteConfigForm extends FormComponent {\n\t/** @copydoc FormComponent::$id */\n\tpublic $id = FORM_SITE_CONFIG;\n\n\t/** @copydoc FormComponent::$method */\n\tpublic $method = 'PUT';\n\n\t/**\n\t * Constructor\n\t *\n\t * @param $action string URL to submit the form to\n\t * @param $locales array Supported locales\n\t * @param $site Site\n\t */\n\tpublic function __construct($action, $locales, $site) {\n\t\t$this->action = $action;\n\t\t$this->locales = $locales;\n\n\t\t$contextsIterator = \\Services::get('context')->getMany(['isEnabled' => true]);\n\n\t\t$this->addField(new FieldText('title', [\n\t\t\t'label' => __('admin.settings.siteTitle'),\n\t\t\t'isRequired' => true,\n\t\t\t'isMultilingual' => true,\n\t\t\t'value' => $site->getData('title'),\n\t\t]));\n\n\t\t$options = [['value' => '', 'label' => '']];\n\t\tforeach ($contextsIterator as $context) {\n\t\t\t$options[] = [\n\t\t\t\t'value' => $context->getId(),\n\t\t\t\t'label' => $context->getLocalizedData('name'),\n\t\t\t];\n\t\t}\n\t\tif (count($options) > 1) $this->addField(new FieldSelect('redirect', [\n\t\t\t'label' => __('admin.settings.redirect'),\n\t\t\t'description' => __('admin.settings.redirectInstructions'),\n\t\t\t'options' => $options,\n\t\t\t'value' => $site->getData('redirect'),\n\t\t]));\n\n\t\t$this->addField(new FieldText('minPasswordLength', [\n\t\t\t'label' => __('admin.settings.minPasswordLength'),\n\t\t\t'isRequired' => true,\n\t\t\t'size' => 'small',\n\t\t\t'value' => $site->getData('minPasswordLength'),\n\t\t]));\n\t}\n}\n"], "fixing_code": ["<?php\n/**\n * @file classes/components/form/site/PKPRestrictBulkEmailsForm.inc.php\n *\n * Copyright (c) 2014-2021 Simon Fraser University\n * Copyright (c) 2000-2021 John Willinsky\n * Distributed under the GNU GPL v3. For full terms see the file docs/COPYING.\n *\n * @class PKPRestrictBulkEmailsForm\n * @ingroup classes_controllers_form\n *\n * @brief A form for setting restrictions on the sending of bulk emails in a context.\n */\nnamespace PKP\\components\\forms\\context;\nuse \\PKP\\components\\forms\\FormComponent;\nuse \\PKP\\components\\forms\\FieldOptions;\n\ndefine('FORM_RESTRICT_BULK_EMAILS', 'restrictBulkEmails');\n\nclass PKPRestrictBulkEmailsForm extends FormComponent {\n\t/** @copydoc FormComponent::$id */\n\tpublic $id = FORM_RESTRICT_BULK_EMAILS;\n\n\t/** @copydoc FormComponent::$method */\n\tpublic $method = 'PUT';\n\n\t/**\n\t * Constructor\n\t *\n\t * @param string $action URL to submit the form to\n\t * @param Context $site Journal, press or preprint server\n\t * @param DAOResultFactory $userGroups\n\t */\n\tpublic function __construct($action, $context, $userGroups) {\n\t\t$this->action = $action;\n\n\t\t$userGroupOptions = [];\n\t\twhile ($userGroup = $userGroups->next()) {\n\t\t\t$userGroupOptions[] = [\n\t\t\t\t'value' => $userGroup->getId(),\n\t\t\t\t'label' => htmlspecialchars($userGroup->getLocalizedData('name')),\n\t\t\t];\n\t\t}\n\n\t\t$request = \\Application::get()->getRequest();\n\t\t$siteSettingsUrl = $request->getDispatcher()->url($request, ROUTE_PAGE, null, 'admin', 'settings', null, null, 'setup/bulkEmails');\n\n\t\t$this->addField(new FieldOptions('disableBulkEmailUserGroups', [\n\t\t\t'label' => __('admin.settings.disableBulkEmailRoles.label'),\n\t\t\t'description' => __('admin.settings.disableBulkEmailRoles.description', ['siteSettingsUrl' => $siteSettingsUrl]),\n\t\t\t'value' => (array) $context->getData('disableBulkEmailUserGroups'),\n\t\t\t'options' => $userGroupOptions,\n\t\t]));\n\t}\n}\n", "<?php\n/**\n * @file classes/components/form/site/PKPSiteBulkEmailsForm.inc.php\n *\n * Copyright (c) 2014-2021 Simon Fraser University\n * Copyright (c) 2000-2021 John Willinsky\n * Distributed under the GNU GPL v3. For full terms see the file docs/COPYING.\n *\n * @class PKPSiteBulkEmailsForm\n * @ingroup classes_controllers_form\n *\n * @brief A form for enabling the bulk email features.\n */\nnamespace PKP\\components\\forms\\site;\nuse \\PKP\\components\\forms\\FormComponent;\nuse \\PKP\\components\\forms\\FieldOptions;\n\ndefine('FORM_SITE_BULK_EMAILS', 'bulkEmails');\n\nclass PKPSiteBulkEmailsForm extends FormComponent {\n\t/** @copydoc FormComponent::$id */\n\tpublic $id = FORM_SITE_BULK_EMAILS;\n\n\t/** @copydoc FormComponent::$method */\n\tpublic $method = 'PUT';\n\n\t/**\n\t * Constructor\n\t *\n\t * @param string $action URL to submit the form to\n\t * @param Site $site\n\t * @param Array $contexts List of context summary objects. See PKPContextQueryBuilder::getManySummary()\n\t */\n\tpublic function __construct($action, $site, $contexts) {\n\t\t$this->action = $action;\n\n\t\t$request = \\Application::get()->getRequest();\n\t\t$hostedContextsUrl = $request->getDispatcher()->url($request, ROUTE_PAGE, null, 'admin', 'contexts');\n\n\t\t$options = [];\n\t\tforeach ($contexts as $context) {\n\t\t\t$options[] = [\n\t\t\t\t'value' => $context->id,\n\t\t\t\t'label' => htmlspecialchars($context->name),\n\t\t\t];\n\t\t}\n\n\t\t$this->addField(new FieldOptions('enableBulkEmails', [\n\t\t\t'label' => __('admin.settings.enableBulkEmails.label'),\n\t\t\t'description' => __('admin.settings.enableBulkEmails.description', ['hostedContextsUrl' => $hostedContextsUrl]),\n\t\t\t'value' => (array) $site->getData('enableBulkEmails'),\n\t\t\t'options' => $options,\n\t\t]));\n\t}\n}\n", "<?php\n/**\n * @file classes/components/form/site/PKPSiteConfigForm.inc.php\n *\n * Copyright (c) 2014-2021 Simon Fraser University\n * Copyright (c) 2000-2021 John Willinsky\n * Distributed under the GNU GPL v3. For full terms see the file docs/COPYING.\n *\n * @class PKPSiteConfigForm\n * @ingroup classes_controllers_form\n *\n * @brief A preset form for the site config settings.\n */\nnamespace PKP\\components\\forms\\site;\nuse \\PKP\\components\\forms\\FormComponent;\nuse \\PKP\\components\\forms\\FieldSelect;\nuse \\PKP\\components\\forms\\FieldText;\n\ndefine('FORM_SITE_CONFIG', 'siteConfig');\n\nclass PKPSiteConfigForm extends FormComponent {\n\t/** @copydoc FormComponent::$id */\n\tpublic $id = FORM_SITE_CONFIG;\n\n\t/** @copydoc FormComponent::$method */\n\tpublic $method = 'PUT';\n\n\t/**\n\t * Constructor\n\t *\n\t * @param $action string URL to submit the form to\n\t * @param $locales array Supported locales\n\t * @param $site Site\n\t */\n\tpublic function __construct($action, $locales, $site) {\n\t\t$this->action = $action;\n\t\t$this->locales = $locales;\n\n\t\t$contextsIterator = \\Services::get('context')->getMany(['isEnabled' => true]);\n\n\t\t$this->addField(new FieldText('title', [\n\t\t\t'label' => __('admin.settings.siteTitle'),\n\t\t\t'isRequired' => true,\n\t\t\t'isMultilingual' => true,\n\t\t\t'value' => $site->getData('title'),\n\t\t]));\n\n\t\t$options = [['value' => '', 'label' => '']];\n\t\tforeach ($contextsIterator as $context) {\n\t\t\t$options[] = [\n\t\t\t\t'value' => $context->getId(),\n\t\t\t\t'label' => htmlspecialchars($context->getLocalizedData('name')),\n\t\t\t];\n\t\t}\n\t\tif (count($options) > 1) $this->addField(new FieldSelect('redirect', [\n\t\t\t'label' => __('admin.settings.redirect'),\n\t\t\t'description' => __('admin.settings.redirectInstructions'),\n\t\t\t'options' => $options,\n\t\t\t'value' => $site->getData('redirect'),\n\t\t]));\n\n\t\t$this->addField(new FieldText('minPasswordLength', [\n\t\t\t'label' => __('admin.settings.minPasswordLength'),\n\t\t\t'isRequired' => true,\n\t\t\t'size' => 'small',\n\t\t\t'value' => $site->getData('minPasswordLength'),\n\t\t]));\n\t}\n}\n"], "filenames": ["classes/components/forms/context/PKPRestrictBulkEmailsForm.inc.php", "classes/components/forms/site/PKPSiteBulkEmailsForm.inc.php", "classes/components/forms/site/PKPSiteConfigForm.inc.php"], "buggy_code_start_loc": [41, 44, 52], "buggy_code_end_loc": [42, 45, 53], "fixing_code_start_loc": [41, 44, 52], "fixing_code_end_loc": [42, 45, 53], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Reflected in GitHub repository pkp/pkp-lib prior to 3.3.0-16.", "other": {"cve": {"id": "CVE-2023-5891", "sourceIdentifier": "security@huntr.dev", "published": "2023-11-01T01:15:07.563", "lastModified": "2023-11-09T00:00:28.930", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Reflected in GitHub repository pkp/pkp-lib prior to 3.3.0-16."}, {"lang": "es", "value": "Cross-site Scripting (XSS): reflejadas en el repositorio de GitHub pkp/pkp-lib anterior a 3.3.0-16."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.5}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:sfu:pkp_web_application_library:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.3.0-16", "matchCriteriaId": "60CE0E67-FCF5-4A26-A91E-514946B97D99"}]}]}], "references": [{"url": "https://github.com/pkp/pkp-lib/commit/d4111c4d0eef783f1ed2e55654a5b83d9d527d97", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.com/bounties/ce4956e4-9ef5-4e0e-bfb2-481ec5cfb0a5", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/pkp/pkp-lib/commit/d4111c4d0eef783f1ed2e55654a5b83d9d527d97"}}