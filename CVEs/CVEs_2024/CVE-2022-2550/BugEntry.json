{"buggy_code": ["<?php\n\nnamespace Hestia\\WebApp\\Installers\\DokuWiki;\n\nuse Hestia\\System\\Util;\nuse \\Hestia\\WebApp\\Installers\\BaseSetup as BaseSetup;\n\nclass DokuWikiSetup extends BaseSetup {\n\n\tprotected $appInfo = [ \n\t\t'name' => 'DokuWiki',\n\t\t'group' => 'wiki',\n\t\t'enabled' => true,\n\t\t'version' => 'stable_2020-07-29',\n\t\t'thumbnail' => 'dokuwiki-logo.svg'\n\t];\n\t\n\tprotected $appname = 'dokuwiki';\n\tprotected $extractsubdir = \"/tmp-dokuwiki\";\n\n\tprotected $config = [\n\t\t'form' => [\n\t\t\t'wiki_name' => 'text',\n\t\t\t'superuser' => 'text',\n\t\t\t'real_name' => 'text',\n\t\t\t'email' => 'text',\n\t\t\t'password' => 'password',\n\t\t\t'initial_ACL_policy' => [ \n\t\t\t\t'type' => 'select',\n\t\t\t\t'options' => [\n\t\t\t\t\t'0: Open Wiki (read, write, upload for everyone)', // 0\n\t\t\t\t\t'1: Public Wiki (read for everyone, write and upload for registered users)', // 1\n\t\t\t\t\t'2: Closed Wiki (read, write, upload for registered users only)' // 3\n\t\t\t   \t],\n\t\t\t],\n\t\t\t'content_license' => [\n\t\t\t\t'type' => 'select',\n\t\t\t\t'options' => [\n\t\t\t\t\t'cc-zero: CC0 1.0 Universal',\n\t\t\t\t\t'publicdomain: Public Domain',\n\t\t\t\t\t'cc-by: CC Attribution 4.0 International',\n\t\t\t\t\t'cc-by-sa: CC Attribution-Share Alike 4.0 International',\n\t\t\t\t\t'gnufdl: GNU Free Documentation License 1.3',\n\t\t\t\t\t'cc-by-nc: CC Attribution-Noncommercial 4.0 International',\n\t\t\t\t\t'cc-by-nc-sa: CC Attribution-Noncommercial-Share Alike 4.0 International',\n\t\t\t\t\t'0: Do not show any license information',\n\t\t\t\t]\t\n\t\t\t],\n\t\t ],\n\t\t'resources' => [\n\t\t\t'archive'  => [ 'src' => 'https://github.com/splitbrain/dokuwiki/archive/refs/tags/release_stable_2020-07-29.zip' ],\n\t\t],\n\t\t'server' => [\n\t\t\t'nginx' => [\n\t\t\t\t'template' => 'default'\n\t\t\t],\n\t\t\t'php' => [ \n\t\t\t\t'supported' => [ '7.3','7.4' ],\n\t\t\t]\n\t\t], \n\t];\n\t\n\tpublic function install(array $options = null, &$status=null)\n\t{\n\t\tparent::install($options);\n\t\tparent::setup($options);\n\t\t\t\n\t\t//check if ssl is enabled \n        $this->appcontext->run('v-list-web-domain', [$this->appcontext->user(), $this->domain, 'json'], $status);\n\t\t$sslEnabled = ($status->json[$this->domain]['SSL'] == 'no' ? 0 : 1);\n\n\t\t$webDomain = ($sslEnabled ? \"https://\" : \"http://\") . $this->domain . \"/\";\n\t\t\n\t\t$this->appcontext->runUser('v-copy-fs-directory',[\n\t\t\t$this->getDocRoot($this->extractsubdir . \"/dokuwiki-release_stable_2020-07-29/.\"),\n\t\t\t$this->getDocRoot()], $status);\n\n\t\t// enable htaccess\n\t\t$this->appcontext->runUser('v-move-fs-file', [$this->getDocRoot(\".htaccess.dist\"), $this->getDocRoot(\".htaccess\")], $status);\n\n\t\t$installUrl = $webDomain . \"install.php\";\n\n\t\t$cmd = \"curl --request POST \"\n\t\t  . ($sslEnabled ? \"\" : \"--insecure \" )\n\t\t  . \"--url $installUrl \"\n\t\t  . \"--header 'Content-Type: application/x-www-form-urlencoded' \"\n\t\t  . \"--data l=en \"\n\t\t  . \"--data 'd[title]=\" . $options['wiki_name'] . \"' \"\n\t\t  . \"--data 'd[acl]=on' \"\n\t\t  . \"--data 'd[superuser]=\" . $options['superuser'] . \"' \"\n\t\t  . \"--data 'd[fullname]=\" . $options['real_name'] . \"' \"\n\t\t  . \"--data 'd[email]=\" . $options['email'] . \"' \"\n\t\t  . \"--data 'd[password]=\" . $options['password'] . \"' \"\n\t\t  . \"--data 'd[confirm]=\" . $options['password'] . \"' \"\n\t\t  . \"--data 'd[policy]=\" . substr($options['initial_ACL_policy'], 0, 1) . \"' \"\n\t\t  . \"--data 'd[license]=\" . explode(\":\", $options['content_license'])[0] . \"' \"\n\t\t  . \"--data submit=\";\n\n\t\texec($cmd, $output, $return_var);\n\t\tif($return_var > 0){\n\t\t\tthrow new \\Exception(implode( PHP_EOL, $output));\n\t\t}\n\n\t\t// remove temp folder\n\t\t$this->appcontext->runUser('v-delete-fs-file', [$this->getDocRoot(\"install.php\")], $status);\n\t\t$this->cleanup();\n\n\t\treturn ($status->code === 0);\n\t}\n}"], "fixing_code": ["<?php\n\nnamespace Hestia\\WebApp\\Installers\\DokuWiki;\n\nuse Hestia\\System\\Util;\nuse \\Hestia\\WebApp\\Installers\\BaseSetup as BaseSetup;\n\nclass DokuWikiSetup extends BaseSetup {\n\n\tprotected $appInfo = [ \n\t\t'name' => 'DokuWiki',\n\t\t'group' => 'wiki',\n\t\t'enabled' => true,\n\t\t'version' => 'stable_2020-07-29',\n\t\t'thumbnail' => 'dokuwiki-logo.svg'\n\t];\n\t\n\tprotected $appname = 'dokuwiki';\n\tprotected $extractsubdir = \"/tmp-dokuwiki\";\n\n\tprotected $config = [\n\t\t'form' => [\n\t\t\t'wiki_name' => 'text',\n\t\t\t'superuser' => 'text',\n\t\t\t'real_name' => 'text',\n\t\t\t'email' => 'text',\n\t\t\t'password' => 'password',\n\t\t\t'initial_ACL_policy' => [ \n\t\t\t\t'type' => 'select',\n\t\t\t\t'options' => [\n\t\t\t\t\t'0: Open Wiki (read, write, upload for everyone)', // 0\n\t\t\t\t\t'1: Public Wiki (read for everyone, write and upload for registered users)', // 1\n\t\t\t\t\t'2: Closed Wiki (read, write, upload for registered users only)' // 3\n\t\t\t   \t],\n\t\t\t],\n\t\t\t'content_license' => [\n\t\t\t\t'type' => 'select',\n\t\t\t\t'options' => [\n\t\t\t\t\t'cc-zero: CC0 1.0 Universal',\n\t\t\t\t\t'publicdomain: Public Domain',\n\t\t\t\t\t'cc-by: CC Attribution 4.0 International',\n\t\t\t\t\t'cc-by-sa: CC Attribution-Share Alike 4.0 International',\n\t\t\t\t\t'gnufdl: GNU Free Documentation License 1.3',\n\t\t\t\t\t'cc-by-nc: CC Attribution-Noncommercial 4.0 International',\n\t\t\t\t\t'cc-by-nc-sa: CC Attribution-Noncommercial-Share Alike 4.0 International',\n\t\t\t\t\t'0: Do not show any license information',\n\t\t\t\t]\t\n\t\t\t],\n\t\t ],\n\t\t'resources' => [\n\t\t\t'archive'  => [ 'src' => 'https://github.com/splitbrain/dokuwiki/archive/refs/tags/release_stable_2020-07-29.zip' ],\n\t\t],\n\t\t'server' => [\n\t\t\t'nginx' => [\n\t\t\t\t'template' => 'default'\n\t\t\t],\n\t\t\t'php' => [ \n\t\t\t\t'supported' => [ '7.3','7.4' ],\n\t\t\t]\n\t\t], \n\t];\n\t\n\tpublic function install(array $options = null, &$status=null)\n\t{\n\t\tparent::install($options);\n\t\tparent::setup($options);\n\t\t\t\n\t\t//check if ssl is enabled \n        $this->appcontext->run('v-list-web-domain', [$this->appcontext->user(), $this->domain, 'json'], $status);\n\t\t$sslEnabled = ($status->json[$this->domain]['SSL'] == 'no' ? 0 : 1);\n\n\t\t$webDomain = ($sslEnabled ? \"https://\" : \"http://\") . $this->domain . \"/\";\n\t\t\n\t\t$this->appcontext->runUser('v-copy-fs-directory',[\n\t\t\t$this->getDocRoot($this->extractsubdir . \"/dokuwiki-release_stable_2020-07-29/.\"),\n\t\t\t$this->getDocRoot()], $status);\n\n\t\t// enable htaccess\n\t\t$this->appcontext->runUser('v-move-fs-file', [$this->getDocRoot(\".htaccess.dist\"), $this->getDocRoot(\".htaccess\")], $status);\n\n\t\t$installUrl = $webDomain . \"install.php\";\n\n\t\t$cmd = implode(\" \", array(\n\t\t\t\"curl\",\n\t\t\t\"--request POST\",\n\t\t\t($sslEnabled ? \"\" : \"--insecure \"),\n\t\t\t\"--url \" . escapeshellarg($installUrl),\n\t\t\t\"--header 'Content-Type: application/x-www-form-urlencoded'\",\n\t\t\t'--data-binary ' . escapeshellarg(http_build_query(array(\n\t\t\t\t\"l\" => \"en\",\n\t\t\t\t\"d\" => array(\n\t\t\t\t\t\"title\" => $options['wiki_name'],\n\t\t\t\t\t'acl' => 'on',\n\t\t\t\t\t'superuser' => $options['superuser'],\n\t\t\t\t\t'fullname' => $options['real_name'],\n\t\t\t\t\t'email' => $options['email'],\n\t\t\t\t\t'password' => $options['password'],\n\t\t\t\t\t'confirm' => $options['password'],\n\t\t\t\t\t'policy' => substr($options['initial_ACL_policy'], 0, 1),\n\t\t\t\t\t'license' => explode(\":\", $options['content_license'])[0]\n\t\t\t\t),\n\t\t\t\t'submit' => ''\n\t\t\t)))\n\t\t));\n\n\t\texec($cmd, $output, $return_var);\n\t\tif($return_var > 0){\n\t\t\tthrow new \\Exception(implode( PHP_EOL, $output));\n\t\t}\n\n\t\t// remove temp folder\n\t\t$this->appcontext->runUser('v-delete-fs-file', [$this->getDocRoot(\"install.php\")], $status);\n\t\t$this->cleanup();\n\n\t\treturn ($status->code === 0);\n\t}\n}"], "filenames": ["web/src/app/WebApp/Installers/DokuWiki/DokuWikiSetup.php"], "buggy_code_start_loc": [83], "buggy_code_end_loc": [98], "fixing_code_start_loc": [83], "fixing_code_end_loc": [105], "type": "CWE-78", "message": "OS Command Injection in GitHub repository hestiacp/hestiacp prior to 1.6.5.", "other": {"cve": {"id": "CVE-2022-2550", "sourceIdentifier": "security@huntr.dev", "published": "2022-07-27T15:15:08.703", "lastModified": "2022-08-02T20:12:55.877", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "OS Command Injection in GitHub repository hestiacp/hestiacp prior to 1.6.5."}, {"lang": "es", "value": "Una Inyecci\u00f3n de Comandos del Sistema Operativo en el repositorio de GitHub hestiacp/hestiacp versiones anteriores a 1.6.5"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.9, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.1, "impactScore": 6.0}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-78"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:hestiacp:control_panel:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.6.5", "matchCriteriaId": "4E403032-3260-4D9F-8FC2-E70A733A0649"}]}]}], "references": [{"url": "https://github.com/hestiacp/hestiacp/commit/3d4c309cf138943cfd1e71ae51556406987aa4bf", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/6ab4384d-bcbe-4d98-bf67-35c3535fc5c7", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/hestiacp/hestiacp/commit/3d4c309cf138943cfd1e71ae51556406987aa4bf"}}