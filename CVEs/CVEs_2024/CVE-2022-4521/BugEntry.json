{"buggy_code": ["<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>\n<%@ taglib prefix=\"carbon\" uri=\"http://wso2.org/projects/carbon/taglibs/carbontags.jar\" %>\n<%\n    String parentPath = request.getParameter(\"parentPath\");\n%>\n<br/>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<%-- Read more on Ajax.Updater, evalScripts (used by resource_util.js, when adding custom content)\n     and defining functions at http://www.prototypejs.org/api/ajax/updater --%>\n<script type=\"text/javascript\">\n    submitAddProfile = function (parentPath) {\n        var rForm = document.forms[\"customUIForm\"];\n        /* Validate the form before submit */\n\n        var reason = \"\";\n        reason += validateEmpty(rForm.addProfileUser,\n                '<fmt:message key=\"username\"/>');\n        if (reason != \"\") {\n            CARBON.showWarningDialog(reason);\n            return false;\n        }\n        sessionAwareFunction(function() {\n            var username = document.getElementById('addProfileUser').value;\n            window.location = \"../userprofiles/profiles_handler_ajaxprocessor.jsp?username=\" +\n                              username + \"&parentPath=\" + parentPath;\n            /*new Ajax.Request('../userprofiles/profiles_handler_ajaxprocessor.jsp',\n            {\n                method:'post',\n                parameters: {username: username, parentPath: parentPath}\n            });*/\n        }, '<fmt:message key=\"session.timed.out\"/>');\n        return true;\n    };\n</script>\n<form id=\"customUIForm\" action=\"/wso2registry/system/addProfile\" method=\"post\">\n    <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:100%\" class=\"styledLeft\">\n        <thead>\n        <tr>\n            <th colspan=\"2\"><fmt:message key=\"input.username.to.add\"/></th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n            <td><fmt:message key=\"username\"/> <span class=\"required\">*</span></td>\n            <td><input type=\"text\" id=\"addProfileUser\" name=\"addProfileUser\" style=\"width:100%\"/></td>\n        </tr>\n        <tr>\n            <td class=\"buttonRow\" colspan=\"2\">\n                <input type=\"button\" onclick=\"submitAddProfile('<%=parentPath%>');\" class=\"button registryWriteOperation\" value=\"<fmt:message key=\"submit\"/>\" />\n                <input type=\"button\" disabled=\"disabled\" class=\"button registryNonWriteOperation\" value=\"<fmt:message key=\"submit\"/>\" />\n            </td>\n        </tr>\n        </tbody>\n    </table>\n</form>\n    </fmt:bundle>\n<br/>\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIMessage\"%>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.clients.ProfilesAdminServiceClient\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.stub.beans.xsd.ProfilesBean\" %>\n<%@ page import=\"java.util.Map\" %>\n<%@ page import=\"java.util.Iterator\" %>\n<%@ page import=\"org.wso2.carbon.user.core.UserCoreConstants\" %>\n<%@ page import=\"java.util.HashMap\" %>\n<%@ page import=\"org.wso2.carbon.registry.core.RegistryConstants\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.utils.GetProfileUtil\" %>\n<%@ page import=\"java.util.Set\" %>\n\n<%\n    String path =request.getParameter(\"path\");\n    Map<String, Map<String,String>> data = null;\n    Map<String,String> defaultprofile = null;\n    Iterator it = null;\n    String profilename = null;\n    try {\n        data =GetProfileUtil.getProfile(path,config,session);\n        profilename = GetProfileUtil.getprofilename(data);\n        defaultprofile = GetProfileUtil.getprofiledatatoshow(data,profilename);\n\n    } catch (Exception e) {\n        CarbonUIMessage uiMsg = new CarbonUIMessage(CarbonUIMessage.ERROR, e.getMessage(), e);\n        session.setAttribute(CarbonUIMessage.ID, uiMsg);\n        %>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<script type=\"text/javascript\">\n    CARBON.showErrorDialog('<fmt:message key=\"unable.to.display.profile\"/>');\n</script>\n</fmt:bundle>\n        <%\n        return;\n    }\n%>\n<br/>\n\n<h3><%=profilename%> Profile</h3>\n<table class=\"styledLeft\" id=\"customTable\">\n   <!--<form name=\"profile_names\" action=\"profiles_edit_ajaxprocessor.jsp\" method=\"get\">\n       <%--<input type=\"hidden\" name=\"profilename\" value=\"<%=path%>\">--%>\n        <tr>\n            <select name=\"profile_menu\">\n\n                <option selected>Choose One</option>\n                <%\n//                    while(it.hasNext()){\n//                    String profilename = (String)it.next();\n\n                %>\n                <%--<option value=<%=profilename%>><%=profilename%></option>--%>\n                <%\n//                    }\n\n                %>\n\n            </select>\n        </tr>\n        <input type=\"submit\"  value=\"View Profile\">\n        </form> -->\n        <thead>\n        <tr>\n                <th>Display Name</th>\n                <th>Value</th>\n            </tr>\n        </thead>\n        <tbody>\n                <%\n            it = defaultprofile.entrySet().iterator();\n          while (it.hasNext()) {\n                Map.Entry pairs = (Map.Entry)it.next();\n                String displayName = (String)pairs.getKey();\n                String value = (String)pairs.getValue();\n             %>\n            <tr>\n                <td><%=displayName%></td>\n                <td><%=value%></td>\n            </tr>\n\n                <%\n         }\n         %>\n        </tbody>\n    </table>\n<script type=\"text/javascript\">\n    alternateTableRows('customTable','tableEvenRow','tableOddRow');\n</script>\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ page import=\"org.wso2.carbon.registry.common.utils.RegistryUtil\" %>\n<%@ page import=\"org.wso2.carbon.registry.common.ui.UIException\" %>\n<%\n    String esPath = request.getParameter(\"path\");\n    String profilesMainPath = \"profiles_main_ajaxprocessor.jsp?path=\" + esPath;\n %>\n<jsp:forward page=\"<%=profilesMainPath%>\"/>\n\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ page import=\"org.wso2.carbon.registry.common.ui.UIException\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.stub.beans.xsd.ProfilesBean\" %>\n<%@ page import=\"org.wso2.carbon.registry.core.RegistryConstants\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.clients.ProfilesAdminServiceClient\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIMessage\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIUtil\" %>\n<%\n    String username = request.getParameter(\"username\");\n    String error = \"This profile is already stored in the registry or a profile does not exist for the given username or you don't have sufficient privileges to configure user profiles.\";\n//    bean.setUserName(username);\n    if (username != null) {\n        username = RegistryConstants.PROFILES_PATH + username + RegistryConstants.PROFILE_RESOURCE_NAME;\n    }\n    try {\n    ProfilesAdminServiceClient client = new ProfilesAdminServiceClient(config,session);\n    if(username != null && client.putUserProfile(username)){\n        String resourcePagePath = \"../resources/resource.jsp?region=region3&item=resource_browser_menu&viewType=std&path=/_system/config/users\";\n        response.sendRedirect(resourcePagePath);\n        return;\n    }\n    else{\n        request.setAttribute(CarbonUIMessage.ID,new CarbonUIMessage(error,error,null));\n    %>\n        <jsp:forward page=\"../admin/error.jsp\"/>\n        <%\n    }\n    } catch (Exception e) {\n        request.setAttribute(CarbonUIMessage.ID,new CarbonUIMessage(error,error,null));\n    %>\n        <jsp:forward page=\"../admin/error.jsp?\"/>\n        <%\n    }\n\n%>\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIMessage\"%>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.clients.ProfilesAdminServiceClient\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.stub.beans.xsd.ProfilesBean\" %>\n<%@ page import=\"java.util.Map\" %>\n<%@ page import=\"java.util.Iterator\" %>\n<%@ page import=\"org.wso2.carbon.user.core.UserCoreConstants\" %>\n<%@ page import=\"java.util.HashMap\" %>\n<%@ page import=\"org.wso2.carbon.registry.core.RegistryConstants\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.utils.GetProfileUtil\" %>\n\n<%\n    String path =request.getParameter(\"path\");\n    Map<String,String> defaultProfile = new HashMap();\n    Map<String, Map<String,String>> data = null;\n    try {\n        data = GetProfileUtil.getProfile(path,config,session);\n        if (data != null) {\n            defaultProfile = data.get(UserCoreConstants.DEFAULT_PROFILE);\n        }\n    } catch (Exception e) {\n        CarbonUIMessage uiMsg = new CarbonUIMessage(CarbonUIMessage.ERROR, e.getMessage(), e);\n        session.setAttribute(CarbonUIMessage.ID, uiMsg);\n        %>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<script type=\"text/javascript\">\n    CARBON.showErrorDialog('<fmt:message key=\"unable.to.display.profile\"/>');\n</script>\n</fmt:bundle>\n        <%\n        return;\n    }\n%>\n<br/>\n\n<h3>Profiles Information</h3>\n<table width=\"50%\">\n <!--   <form name=\"profile_names\" action=\"profiles_select_view.jsp\" method=\"get\">\n        <tr>\n            <select name=\"profile_menu\">\n\n                <option selected>Choose One</option>\n                <%\n//                    String [] profiles = bean.getProfileNames();\n//                    request.setAttribute(\"profilenames\",profiles);\n//                    for(String eachprofile:profiles){\n\n                %>\n                <%--<option value=<%=eachprofile%>><%=eachprofile%></option>--%>\n                <%\n//                    }\n\n                %>\n\n            </select>\n        </tr>\n        <input type=\"button\" onClick=\"location=document.jump.menu.options[document.jump.menu.selectedIndex].value;\" value=\"View Profile\">\n        </p>\n    </form> -->\n\n            <tr>\n                <th>Display Name</th>\n                <th>Value</th>\n            </tr>\n                <%\n        Iterator it = defaultProfile.entrySet().iterator();\n          while (it.hasNext()) {\n                Map.Entry pairs = (Map.Entry)it.next();\n                String displayName = (String)pairs.getKey();\n                String value = (String)pairs.getValue();\n             %>\n            <tr>\n                <td><%=displayName%></td>\n                <td><%=value%></td>\n            </tr>\n\n                <%\n         }\n         %>\n\n</table>\n    <a onclick=\"loadViewUI('../userprofiles/profiles_edit_ajaxprocessor.jsp', '<%=path%>')\">Edit Profile</a>\n</br>\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIMessage\"%>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.clients.ProfilesAdminServiceClient\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.stub.beans.xsd.ProfilesBean\" %>\n<%@ page import=\"java.util.Map\" %>\n<%@ page import=\"java.util.Iterator\" %>\n<%@ page import=\"org.wso2.carbon.user.core.UserCoreConstants\" %>\n<%@ page import=\"java.util.HashMap\" %>\n<%@ page import=\"org.wso2.carbon.registry.core.RegistryConstants\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.utils.GetProfileUtil\" %>\n<%@ page import=\"java.util.Set\" %>\n\n<%\n    String path =request.getParameter(\"path\");\n    String selectedProfile = request.getParameter(\"profile_menu\");\n    if (selectedProfile == null) {\n        selectedProfile = \"default\";\n    }\n    Map<String,String> defaultProfile = null;\n    Map<String, Map<String,String>> data = null;\n    Iterator it = null;\n    try {\n        data =GetProfileUtil.getProfile(path.substring(path.indexOf(RegistryConstants.PROFILES_PATH)),config,session);\n        if (data != null) {\n            defaultProfile = data.get(selectedProfile);\n            Set<String> profileNames = data.keySet();\n            if (defaultProfile == null) {\n                if (data.isEmpty()) {\n                    throw new Exception();\n                }\n                selectedProfile = profileNames.toArray(new String[data.size()])[0];\n                defaultProfile = data.get(selectedProfile);\n                if (defaultProfile == null) {\n                    throw new Exception();\n                }\n            }\n            it = profileNames.iterator();\n        } else {\n            throw new Exception();\n        }\n    } catch (Exception e) {\n        CarbonUIMessage uiMsg = new CarbonUIMessage(CarbonUIMessage.ERROR, e.getMessage(), e);\n        session.setAttribute(CarbonUIMessage.ID, uiMsg);\n        %>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<script type=\"text/javascript\">\n    CARBON.showErrorDialog('<fmt:message key=\"unable.to.display.profile\"/>');\n</script>\n</fmt:bundle>\n        <%\n        return;\n    }\n%>\n<br/>\n<script type=\"text/javascript\">\n    function switchProfiles() {\n        if ($('profile_menu').value != 0 && $('profile_menu').value != \"<%=selectedProfile%>\") {\n            window.location = \"../resources/resource.jsp?region=region3&item=resource_browser_menu&path=<%=path%>&viewType=std&profile_menu=\" +\n                              $('profile_menu').value;\n        }\n    }\n</script>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<h3><fmt:message key=\"view.profiles\"/></h3>\n<table width=\"50%\">\n   <form name=\"profile_names\" action=\"profiles_select_ajaxprocessor.jsp\" method=\"get\">\n        <tr>\n            <select id=\"profile_menu\">\n\n                <option value=\"0\" selected><fmt:message key=\"choose.one\"/></option>\n                <%\n                    while(it.hasNext()){\n                    String profilename = (String)it.next();\n\n                %>\n                <option value=<%=profilename%>><%=profilename%></option>\n                <%\n                    }\n\n                %>\n\n            </select>\n        </tr>\n        <input type=\"button\" onClick=\"switchProfiles()\" value=\"View Profile\">\n        </form>\n    <form id=\"profilesEditForm\">\n        <tr>\n                <th><fmt:message key=\"display.name\"/></th>\n                <th><fmt:message key=\"value\"/></th>\n            </tr>\n        <tr>\n                <td><fmt:message key=\"profile.name\"/></td>\n                <td><%=selectedProfile%></td>\n            </tr>\n                <%\n            it = defaultProfile.entrySet().iterator();\n          while (it.hasNext()) {\n                Map.Entry pairs = (Map.Entry)it.next();\n                String displayName = (String)pairs.getKey();\n                String value = (String)pairs.getValue();\n             %>\n            <tr>\n                <td><%=displayName%></td>\n                <td><%=value%></td>\n            </tr>\n\n                <%\n         }\n         %>\n        </form>\n    </table>\n</fmt:bundle>"], "fixing_code": ["<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>\n<%@ taglib prefix=\"carbon\" uri=\"http://wso2.org/projects/carbon/taglibs/carbontags.jar\" %>\n<%@ page import=\"org.owasp.encoder.Encode\" %>\n<%\n    String parentPath = Encode.forHtml(request.getParameter(\"parentPath\"));\n%>\n<br/>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<%-- Read more on Ajax.Updater, evalScripts (used by resource_util.js, when adding custom content)\n     and defining functions at http://www.prototypejs.org/api/ajax/updater --%>\n<script type=\"text/javascript\">\n    submitAddProfile = function (parentPath) {\n        var rForm = document.forms[\"customUIForm\"];\n        /* Validate the form before submit */\n\n        var reason = \"\";\n        reason += validateEmpty(rForm.addProfileUser,\n                '<fmt:message key=\"username\"/>');\n        if (reason != \"\") {\n            CARBON.showWarningDialog(reason);\n            return false;\n        }\n        sessionAwareFunction(function() {\n            var username = document.getElementById('addProfileUser').value;\n            window.location = \"../userprofiles/profiles_handler_ajaxprocessor.jsp?username=\" +\n                              username + \"&parentPath=\" + parentPath;\n            /*new Ajax.Request('../userprofiles/profiles_handler_ajaxprocessor.jsp',\n            {\n                method:'post',\n                parameters: {username: username, parentPath: parentPath}\n            });*/\n        }, '<fmt:message key=\"session.timed.out\"/>');\n        return true;\n    };\n</script>\n<form id=\"customUIForm\" action=\"/wso2registry/system/addProfile\" method=\"post\">\n    <table cellspacing=\"0\" cellpadding=\"0\" border=\"0\" style=\"width:100%\" class=\"styledLeft\">\n        <thead>\n        <tr>\n            <th colspan=\"2\"><fmt:message key=\"input.username.to.add\"/></th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n            <td><fmt:message key=\"username\"/> <span class=\"required\">*</span></td>\n            <td><input type=\"text\" id=\"addProfileUser\" name=\"addProfileUser\" style=\"width:100%\"/></td>\n        </tr>\n        <tr>\n            <td class=\"buttonRow\" colspan=\"2\">\n                <input type=\"button\" onclick=\"submitAddProfile('<%=parentPath%>');\" class=\"button registryWriteOperation\" value=\"<fmt:message key=\"submit\"/>\" />\n                <input type=\"button\" disabled=\"disabled\" class=\"button registryNonWriteOperation\" value=\"<fmt:message key=\"submit\"/>\" />\n            </td>\n        </tr>\n        </tbody>\n    </table>\n</form>\n    </fmt:bundle>\n<br/>\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>\n<%@ page import=\"org.owasp.encoder.Encode\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIMessage\"%>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.clients.ProfilesAdminServiceClient\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.stub.beans.xsd.ProfilesBean\" %>\n<%@ page import=\"java.util.Map\" %>\n<%@ page import=\"java.util.Iterator\" %>\n<%@ page import=\"org.wso2.carbon.user.core.UserCoreConstants\" %>\n<%@ page import=\"java.util.HashMap\" %>\n<%@ page import=\"org.wso2.carbon.registry.core.RegistryConstants\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.utils.GetProfileUtil\" %>\n<%@ page import=\"java.util.Set\" %>\n\n<%\n    String path = Encode.forHtml(request.getParameter(\"path\"));\n    Map<String, Map<String,String>> data = null;\n    Map<String,String> defaultprofile = null;\n    Iterator it = null;\n    String profilename = null;\n    try {\n        data =GetProfileUtil.getProfile(path,config,session);\n        profilename = GetProfileUtil.getprofilename(data);\n        defaultprofile = GetProfileUtil.getprofiledatatoshow(data,profilename);\n\n    } catch (Exception e) {\n        CarbonUIMessage uiMsg = new CarbonUIMessage(CarbonUIMessage.ERROR, e.getMessage(), e);\n        session.setAttribute(CarbonUIMessage.ID, uiMsg);\n        %>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<script type=\"text/javascript\">\n    CARBON.showErrorDialog('<fmt:message key=\"unable.to.display.profile\"/>');\n</script>\n</fmt:bundle>\n        <%\n        return;\n    }\n%>\n<br/>\n\n<h3><%=profilename%> Profile</h3>\n<table class=\"styledLeft\" id=\"customTable\">\n   <!--<form name=\"profile_names\" action=\"profiles_edit_ajaxprocessor.jsp\" method=\"get\">\n       <%--<input type=\"hidden\" name=\"profilename\" value=\"<%=path%>\">--%>\n        <tr>\n            <select name=\"profile_menu\">\n\n                <option selected>Choose One</option>\n                <%\n//                    while(it.hasNext()){\n//                    String profilename = (String)it.next();\n\n                %>\n                <%--<option value=<%=profilename%>><%=profilename%></option>--%>\n                <%\n//                    }\n\n                %>\n\n            </select>\n        </tr>\n        <input type=\"submit\"  value=\"View Profile\">\n        </form> -->\n        <thead>\n        <tr>\n                <th>Display Name</th>\n                <th>Value</th>\n            </tr>\n        </thead>\n        <tbody>\n                <%\n            it = defaultprofile.entrySet().iterator();\n          while (it.hasNext()) {\n                Map.Entry pairs = (Map.Entry)it.next();\n                String displayName = (String)pairs.getKey();\n                String value = (String)pairs.getValue();\n             %>\n            <tr>\n                <td><%=displayName%></td>\n                <td><%=value%></td>\n            </tr>\n\n                <%\n         }\n         %>\n        </tbody>\n    </table>\n<script type=\"text/javascript\">\n    alternateTableRows('customTable','tableEvenRow','tableOddRow');\n</script>\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ page import=\"org.owasp.encoder.Encode\" %>\n<%@ page import=\"org.wso2.carbon.registry.common.utils.RegistryUtil\" %>\n<%@ page import=\"org.wso2.carbon.registry.common.ui.UIException\" %>\n<%\n    String esPath = Encode.forHtml(request.getParameter(\"path\"));\n    String profilesMainPath = \"profiles_main_ajaxprocessor.jsp?path=\" + esPath;\n %>\n<jsp:forward page=\"<%=profilesMainPath%>\"/>\n\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ page import=\"org.owasp.encoder.Encode\" %>\n<%@ page import=\"org.wso2.carbon.registry.common.ui.UIException\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.stub.beans.xsd.ProfilesBean\" %>\n<%@ page import=\"org.wso2.carbon.registry.core.RegistryConstants\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.clients.ProfilesAdminServiceClient\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIMessage\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIUtil\" %>\n<%\n    String username = Encode.forHtml(request.getParameter(\"username\"));\n    String error = \"This profile is already stored in the registry or a profile does not exist for the given username or you don't have sufficient privileges to configure user profiles.\";\n//    bean.setUserName(username);\n    if (username != null) {\n        username = RegistryConstants.PROFILES_PATH + username + RegistryConstants.PROFILE_RESOURCE_NAME;\n    }\n    try {\n    ProfilesAdminServiceClient client = new ProfilesAdminServiceClient(config,session);\n    if(username != null && client.putUserProfile(username)){\n        String resourcePagePath = \"../resources/resource.jsp?region=region3&item=resource_browser_menu&viewType=std&path=/_system/config/users\";\n        response.sendRedirect(resourcePagePath);\n        return;\n    }\n    else{\n        request.setAttribute(CarbonUIMessage.ID,new CarbonUIMessage(error,error,null));\n    %>\n        <jsp:forward page=\"../admin/error.jsp\"/>\n        <%\n    }\n    } catch (Exception e) {\n        request.setAttribute(CarbonUIMessage.ID,new CarbonUIMessage(error,error,null));\n    %>\n        <jsp:forward page=\"../admin/error.jsp?\"/>\n        <%\n    }\n\n%>\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>\n<%@ page import=\"org.owasp.encoder.Encode\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIMessage\"%>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.clients.ProfilesAdminServiceClient\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.stub.beans.xsd.ProfilesBean\" %>\n<%@ page import=\"java.util.Map\" %>\n<%@ page import=\"java.util.Iterator\" %>\n<%@ page import=\"org.wso2.carbon.user.core.UserCoreConstants\" %>\n<%@ page import=\"java.util.HashMap\" %>\n<%@ page import=\"org.wso2.carbon.registry.core.RegistryConstants\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.utils.GetProfileUtil\" %>\n\n<%\n    String path = Encode.forHtml(request.getParameter(\"path\"));\n    Map<String,String> defaultProfile = new HashMap();\n    Map<String, Map<String,String>> data = null;\n    try {\n        data = GetProfileUtil.getProfile(path,config,session);\n        if (data != null) {\n            defaultProfile = data.get(UserCoreConstants.DEFAULT_PROFILE);\n        }\n    } catch (Exception e) {\n        CarbonUIMessage uiMsg = new CarbonUIMessage(CarbonUIMessage.ERROR, e.getMessage(), e);\n        session.setAttribute(CarbonUIMessage.ID, uiMsg);\n        %>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<script type=\"text/javascript\">\n    CARBON.showErrorDialog('<fmt:message key=\"unable.to.display.profile\"/>');\n</script>\n</fmt:bundle>\n        <%\n        return;\n    }\n%>\n<br/>\n\n<h3>Profiles Information</h3>\n<table width=\"50%\">\n <!--   <form name=\"profile_names\" action=\"profiles_select_view.jsp\" method=\"get\">\n        <tr>\n            <select name=\"profile_menu\">\n\n                <option selected>Choose One</option>\n                <%\n//                    String [] profiles = bean.getProfileNames();\n//                    request.setAttribute(\"profilenames\",profiles);\n//                    for(String eachprofile:profiles){\n\n                %>\n                <%--<option value=<%=eachprofile%>><%=eachprofile%></option>--%>\n                <%\n//                    }\n\n                %>\n\n            </select>\n        </tr>\n        <input type=\"button\" onClick=\"location=document.jump.menu.options[document.jump.menu.selectedIndex].value;\" value=\"View Profile\">\n        </p>\n    </form> -->\n\n            <tr>\n                <th>Display Name</th>\n                <th>Value</th>\n            </tr>\n                <%\n        Iterator it = defaultProfile.entrySet().iterator();\n          while (it.hasNext()) {\n                Map.Entry pairs = (Map.Entry)it.next();\n                String displayName = (String)pairs.getKey();\n                String value = (String)pairs.getValue();\n             %>\n            <tr>\n                <td><%=displayName%></td>\n                <td><%=value%></td>\n            </tr>\n\n                <%\n         }\n         %>\n\n</table>\n    <a onclick=\"loadViewUI('../userprofiles/profiles_edit_ajaxprocessor.jsp', '<%=path%>')\">Edit Profile</a>\n</br>\n", "<!--\n ~ Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n ~\n ~ WSO2 Inc. licenses this file to you under the Apache License,\n ~ Version 2.0 (the \"License\"); you may not use this file except\n ~ in compliance with the License.\n ~ You may obtain a copy of the License at\n ~\n ~    http://www.apache.org/licenses/LICENSE-2.0\n ~\n ~ Unless required by applicable law or agreed to in writing,\n ~ software distributed under the License is distributed on an\n ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n ~ KIND, either express or implied.  See the License for the\n ~ specific language governing permissions and limitations\n ~ under the License.\n -->\n<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" %>\n<%@ page import=\"org.owasp.encoder.Encode\" %>\n<%@ page import=\"org.wso2.carbon.ui.CarbonUIMessage\"%>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.clients.ProfilesAdminServiceClient\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.stub.beans.xsd.ProfilesBean\" %>\n<%@ page import=\"java.util.Map\" %>\n<%@ page import=\"java.util.Iterator\" %>\n<%@ page import=\"org.wso2.carbon.user.core.UserCoreConstants\" %>\n<%@ page import=\"java.util.HashMap\" %>\n<%@ page import=\"org.wso2.carbon.registry.core.RegistryConstants\" %>\n<%@ page import=\"org.wso2.carbon.registry.profiles.ui.utils.GetProfileUtil\" %>\n<%@ page import=\"java.util.Set\" %>\n\n<%\n    String path = Encode.forHtml(request.getParameter(\"path\"));\n    String selectedProfile = Encode.forHtml(request.getParameter(\"profile_menu\"));\n    if (selectedProfile == null) {\n        selectedProfile = \"default\";\n    }\n    Map<String,String> defaultProfile = null;\n    Map<String, Map<String,String>> data = null;\n    Iterator it = null;\n    try {\n        data =GetProfileUtil.getProfile(path.substring(path.indexOf(RegistryConstants.PROFILES_PATH)),config,session);\n        if (data != null) {\n            defaultProfile = data.get(selectedProfile);\n            Set<String> profileNames = data.keySet();\n            if (defaultProfile == null) {\n                if (data.isEmpty()) {\n                    throw new Exception();\n                }\n                selectedProfile = profileNames.toArray(new String[data.size()])[0];\n                defaultProfile = data.get(selectedProfile);\n                if (defaultProfile == null) {\n                    throw new Exception();\n                }\n            }\n            it = profileNames.iterator();\n        } else {\n            throw new Exception();\n        }\n    } catch (Exception e) {\n        CarbonUIMessage uiMsg = new CarbonUIMessage(CarbonUIMessage.ERROR, e.getMessage(), e);\n        session.setAttribute(CarbonUIMessage.ID, uiMsg);\n        %>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<script type=\"text/javascript\">\n    CARBON.showErrorDialog('<fmt:message key=\"unable.to.display.profile\"/>');\n</script>\n</fmt:bundle>\n        <%\n        return;\n    }\n%>\n<br/>\n<script type=\"text/javascript\">\n    function switchProfiles() {\n        if ($('profile_menu').value != 0 && $('profile_menu').value != \"<%=selectedProfile%>\") {\n            window.location = \"../resources/resource.jsp?region=region3&item=resource_browser_menu&path=<%=path%>&viewType=std&profile_menu=\" +\n                              $('profile_menu').value;\n        }\n    }\n</script>\n<fmt:bundle basename=\"org.wso2.carbon.registry.profiles.ui.i18n.Resources\">\n<h3><fmt:message key=\"view.profiles\"/></h3>\n<table width=\"50%\">\n   <form name=\"profile_names\" action=\"profiles_select_ajaxprocessor.jsp\" method=\"get\">\n        <tr>\n            <select id=\"profile_menu\">\n\n                <option value=\"0\" selected><fmt:message key=\"choose.one\"/></option>\n                <%\n                    while(it.hasNext()){\n                    String profilename = (String)it.next();\n\n                %>\n                <option value=<%=profilename%>><%=profilename%></option>\n                <%\n                    }\n\n                %>\n\n            </select>\n        </tr>\n        <input type=\"button\" onClick=\"switchProfiles()\" value=\"View Profile\">\n        </form>\n    <form id=\"profilesEditForm\">\n        <tr>\n                <th><fmt:message key=\"display.name\"/></th>\n                <th><fmt:message key=\"value\"/></th>\n            </tr>\n        <tr>\n                <td><fmt:message key=\"profile.name\"/></td>\n                <td><%=selectedProfile%></td>\n            </tr>\n                <%\n            it = defaultProfile.entrySet().iterator();\n          while (it.hasNext()) {\n                Map.Entry pairs = (Map.Entry)it.next();\n                String displayName = (String)pairs.getKey();\n                String value = (String)pairs.getValue();\n             %>\n            <tr>\n                <td><%=displayName%></td>\n                <td><%=value%></td>\n            </tr>\n\n                <%\n         }\n         %>\n        </form>\n    </table>\n</fmt:bundle>"], "filenames": ["components/registry/org.wso2.carbon.registry.profiles.ui/src/main/resources/web/userprofiles/profiles_add_ajaxprocessor.jsp", "components/registry/org.wso2.carbon.registry.profiles.ui/src/main/resources/web/userprofiles/profiles_edit_ajaxprocessor.jsp", "components/registry/org.wso2.carbon.registry.profiles.ui/src/main/resources/web/userprofiles/profiles_edit_handler_ajaxprocessor.jsp", "components/registry/org.wso2.carbon.registry.profiles.ui/src/main/resources/web/userprofiles/profiles_handler_ajaxprocessor.jsp", "components/registry/org.wso2.carbon.registry.profiles.ui/src/main/resources/web/userprofiles/profiles_main_ajaxprocessor.jsp", "components/registry/org.wso2.carbon.registry.profiles.ui/src/main/resources/web/userprofiles/profiles_select_ajaxprocessor.jsp"], "buggy_code_start_loc": [20, 19, 18, 18, 19, 19], "buggy_code_end_loc": [23, 33, 23, 27, 32, 34], "fixing_code_start_loc": [21, 20, 19, 19, 20, 20], "fixing_code_end_loc": [24, 34, 24, 28, 33, 35], "type": "CWE-79", "message": "A vulnerability classified as problematic has been found in WSO2 carbon-registry up to 4.8.6. This affects an unknown part of the component Request Parameter Handler. The manipulation of the argument parentPath/path/username/path/profile_menu leads to cross site scripting. It is possible to initiate the attack remotely. Upgrading to version 4.8.7 is able to address this issue. The name of the patch is 9f967abfde9317bee2cda469dbc09b57d539f2cc. It is recommended to upgrade the affected component. The identifier VDB-215901 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2022-4521", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-15T21:15:12.773", "lastModified": "2023-01-09T16:31:59.343", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as problematic has been found in WSO2 carbon-registry up to 4.8.6. This affects an unknown part of the component Request Parameter Handler. The manipulation of the argument parentPath/path/username/path/profile_menu leads to cross site scripting. It is possible to initiate the attack remotely. Upgrading to version 4.8.7 is able to address this issue. The name of the patch is 9f967abfde9317bee2cda469dbc09b57d539f2cc. It is recommended to upgrade the affected component. The identifier VDB-215901 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "nvd@nist.gov", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:wso2:carbon-registry:*:*:*:*:*:*:*:*", "versionEndExcluding": "4.8.7", "matchCriteriaId": "29362E19-DD2F-48A7-A794-14D13A4C97BB"}]}]}], "references": [{"url": "https://github.com/wso2/carbon-registry/commit/9f967abfde9317bee2cda469dbc09b57d539f2cc", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/wso2/carbon-registry/pull/399", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/wso2/carbon-registry/releases/tag/v4.8.7", "source": "cna@vuldb.com", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.215901", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/wso2/carbon-registry/commit/9f967abfde9317bee2cda469dbc09b57d539f2cc"}}