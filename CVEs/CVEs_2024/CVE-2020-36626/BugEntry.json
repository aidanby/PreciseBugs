{"buggy_code": ["<?php\n\n\nnamespace ModularContent;\nuse WP_Query;\n\n\n/**\n * Class SearchFilter\n *\n * @package ModularContent\n *\n * Filters search queries to include content entered into panels\n */\nclass SearchFilter {\n\tprivate $query = NULL;\n\n\tpublic function __construct( WP_Query $query ) {\n\t\t$this->query = $query;\n\t}\n\n\tpublic function set_hooks() {\n\t\t$this->query->set( 'panel_search_filter', true );\n\t\tadd_filter( 'posts_search', array( $this, 'add_post_content_filtered_to_search_sql' ), 1000, 2 );\n\t}\n\n\t/**\n\t * @param string $sql\n\t * @param WP_Query $query\n\t *\n\t * @return string\n\t */\n\tpublic function add_post_content_filtered_to_search_sql( $sql, $query ) {\n\t\tif ( $query->get( 'panel_search_filter' ) ) {\n\t\t\tglobal $wpdb;\n\t\t\tremove_filter( 'posts_search', array( $this, 'add_post_content_filtered_to_search_sql' ), 1000, 2 );\n\t\t\t\n\t\t\t$pattern = \"#OR \\($wpdb->posts.post_content LIKE '(.*?)'\\)#\";\n\t\t\t$sql = preg_replace_callback( $pattern, array( $this, 'replace_callback' ), $sql );\n\t\t}\n\t\treturn $sql;\n\t}\n\n\t/**\n\t * Duplicate the search SQL on the post_content field to also search the post_content_filtered field\n\t *\n\t * @param array $matches\n\t *\n\t * @return string\n\t */\n\tprivate function replace_callback( $matches ) {\n\t\tglobal $wpdb;\n\t\t$post_content = $matches[0];\n\t\t$post_content_filtered = str_replace( $wpdb->posts.'.post_content', $wpdb->posts.'.post_content_filtered', $post_content );\n\t\treturn $post_content.' '.$post_content_filtered;\n\t}\n}"], "fixing_code": ["<?php\n\n\nnamespace ModularContent;\nuse WP_Query;\n\n\n/**\n * Class SearchFilter\n *\n * @package ModularContent\n *\n * Filters search queries to include content entered into panels\n */\nclass SearchFilter {\n\tprivate $query = NULL;\n\n\tpublic function __construct( WP_Query $query ) {\n\t\t$this->query = $query;\n\t}\n\n\tpublic function set_hooks() {\n\t\t$this->query->set( 'panel_search_filter', true );\n\t\tadd_filter( 'posts_search', array( $this, 'add_post_content_filtered_to_search_sql' ), 1000, 2 );\n\t}\n\n\t/**\n\t * @param string $sql\n\t * @param WP_Query $query\n\t *\n\t * @return string\n\t */\n\tpublic function add_post_content_filtered_to_search_sql( $sql, $query ) {\n\t\tif ( $query->get( 'panel_search_filter' ) ) {\n\t\t\tglobal $wpdb;\n\t\t\tremove_filter( 'posts_search', array( $this, 'add_post_content_filtered_to_search_sql' ), 1000, 2 );\n\n\t\t\t$pattern = \"#OR \\($wpdb->posts.post_content LIKE '{(.*?)}'\\)#\";\n\t\t\t$sql = preg_replace_callback( $pattern, array( $this, 'replace_callback' ), $sql );\n\t\t}\n\t\treturn $sql;\n\t}\n\n\t/**\n\t * Duplicate the search SQL on the post_content field to also search the post_content_filtered field\n\t *\n\t * @param array $matches\n\t *\n\t * @return string\n\t */\n\tprivate function replace_callback( $matches ) {\n\t\tglobal $wpdb;\n\t\t$post_content = $matches[0];\n\t\t$post_content_filtered = str_replace( $wpdb->posts.'.post_content', $wpdb->posts.'.post_content_filtered', $post_content );\n\t\treturn $post_content.' '.$post_content_filtered;\n\t}\n}\n"], "filenames": ["ModularContent/SearchFilter.php"], "buggy_code_start_loc": [37], "buggy_code_end_loc": [58], "fixing_code_start_loc": [37], "fixing_code_end_loc": [58], "type": "CWE-79", "message": "A vulnerability classified as critical has been found in Modern Tribe Panel Builder Plugin. Affected is the function add_post_content_filtered_to_search_sql of the file ModularContent/SearchFilter.php. The manipulation leads to sql injection. It is possible to launch the attack remotely. The exploit has been disclosed to the public and may be used. The name of the patch is 4528d4f855dbbf24e9fc12a162fda84ce3bedc2f. It is recommended to apply a patch to fix this issue. VDB-216738 is the identifier assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2020-36626", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-27T15:15:11.310", "lastModified": "2023-01-13T14:38:18.137", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as critical has been found in Modern Tribe Panel Builder Plugin. Affected is the function add_post_content_filtered_to_search_sql of the file ModularContent/SearchFilter.php. The manipulation leads to sql injection. It is possible to launch the attack remotely. The exploit has been disclosed to the public and may be used. The name of the patch is 4528d4f855dbbf24e9fc12a162fda84ce3bedc2f. It is recommended to apply a patch to fix this issue. VDB-216738 is the identifier assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "cna@vuldb.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:tri:panel_builder:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "2020-05-08", "matchCriteriaId": "07147564-2708-4777-83A0-B862FA720A2F"}]}]}], "references": [{"url": "https://github.com/moderntribe/panel-builder/commit/4528d4f855dbbf24e9fc12a162fda84ce3bedc2f", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/moderntribe/panel-builder/pull/173", "source": "cna@vuldb.com", "tags": ["Exploit", "Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216738", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/moderntribe/panel-builder/commit/4528d4f855dbbf24e9fc12a162fda84ce3bedc2f"}}