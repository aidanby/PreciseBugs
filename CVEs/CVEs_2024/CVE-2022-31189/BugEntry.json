{"buggy_code": ["/**\n * The contents of this file are subject to the license and copyright\n * detailed in the LICENSE and NOTICE files at the root of the source\n * tree and available online at\n *\n * http://www.dspace.org/license/\n */\npackage org.dspace.app.webui.servlet;\n\nimport java.io.IOException;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\nimport org.apache.log4j.Logger;\nimport org.dspace.app.webui.util.JSPManager;\nimport org.dspace.app.webui.util.UIUtil;\n\n/**\n * Servlet for handling an internal server error\n * \n * @author Robert Tansley\n * @version $Revision$\n */\npublic class InternalErrorServlet extends HttpServlet\n{\n    /*\n     * We don't extend DSpaceServlet in case it's context creation etc. that\n     * caused the problem!\n     */\n\n    /** log4j category */\n    private static Logger log = Logger.getLogger(InternalErrorServlet.class);\n\n    protected void doGet(HttpServletRequest request,\n            HttpServletResponse response) throws ServletException, IOException\n    {\n        // Get the exception that occurred, if any\n        Throwable t = (Throwable) request\n                .getAttribute(\"javax.servlet.error.exception\");\n\n        String logInfo = UIUtil.getRequestLogInfo(request);\n\n        // Log the error. Since we don't have a context, we need to\n        // build the info \"by hand\"\n        String logMessage = \":session_id=\" + request.getSession().getId()\n                + \":internal_error:\" + logInfo;\n\n        log.warn(logMessage, t);\n\n        // Now we try and mail the designated user, if any\n        UIUtil.sendAlert(request, (Exception) t);\n\n        JSPManager.showJSP(request, response, \"/error/internal.jsp\");\n    }\n\n    protected void doPost(HttpServletRequest request,\n            HttpServletResponse response) throws ServletException, IOException\n    {\n        doGet(request, response);\n    }\n}\n", "<%--\n\n    The contents of this file are subject to the license and copyright\n    detailed in the LICENSE and NOTICE files at the root of the source\n    tree and available online at\n\n    http://www.dspace.org/license/\n\n--%>\n<%--\n  - Page representing an internal server error\n  --%>\n\n<%@ page contentType=\"text/html;charset=UTF-8\" %>\n\n<%@ taglib uri=\"http://java.sun.com/jsp/jstl/fmt\"\n    prefix=\"fmt\" %>\n\t\n<%@ page import=\"java.io.PrintWriter\" %>\n\n<%@ page isErrorPage=\"true\" %>\n\n<%@ taglib uri=\"http://www.dspace.org/dspace-tags.tld\" prefix=\"dspace\" %>\n\n<dspace:layout titlekey=\"jsp.error.internal.title\">\n    <%-- <h1>Internal System Error</h1> --%>\n    <h1><fmt:message key=\"jsp.error.internal.title\"/></h1>\n    <%-- <p>Oops!  The system has experienced an internal error.  This is our fault,\n    please pardon our dust during these early stages of the DSpace system!</p> --%>\n    <p><fmt:message key=\"jsp.error.internal.text1\"/></p>\n    <%-- <p>The system has logged this error.  Please try to do what you were doing\n    again, and if the problem persists, please contact us so we can fix the\n    problem.</p> --%>\n\n    <dspace:include page=\"/components/contact-info.jsp\" />\n\n    <p align=\"center\">\n        <%-- <a href=\"<%= request.getContextPath() %>/\">Go to the DSpace home page</a> --%>\n        <a href=\"<%= request.getContextPath() %>/\"><fmt:message key=\"jsp.general.gohome\"/></a>\n    </p>\n        <!--\n    <%\n    Throwable ex = (Throwable) request.getAttribute(\"javax.servlet.error.exception\");\n    if(ex == null) out.println(\"No stack trace available<br/>\");\n    else {\n                for(Throwable t = ex ; t!=null; t = t.getCause())\n                {\n                    out.println(t.getMessage());\n                    out.println(\"=============================================\");\n                    t.printStackTrace(new PrintWriter(out));\n                    out.println(\"\\n\\n\\n\");\n                }\n        }\n        %>\n      -->\n</dspace:layout>\n"], "fixing_code": ["/**\n * The contents of this file are subject to the license and copyright\n * detailed in the LICENSE and NOTICE files at the root of the source\n * tree and available online at\n *\n * http://www.dspace.org/license/\n */\npackage org.dspace.app.webui.servlet;\n\nimport java.io.IOException;\nimport java.util.UUID;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\nimport org.apache.log4j.Logger;\nimport org.dspace.app.webui.util.JSPManager;\nimport org.dspace.app.webui.util.UIUtil;\n\n/**\n * Servlet for handling an internal server error\n * \n * @author Robert Tansley\n * @version $Revision$\n */\npublic class InternalErrorServlet extends HttpServlet\n{\n    /*\n     * We don't extend DSpaceServlet in case it's context creation etc. that\n     * caused the problem!\n     */\n\n    /** log4j category */\n    private static Logger log = Logger.getLogger(InternalErrorServlet.class);\n\n    protected void doGet(HttpServletRequest request,\n            HttpServletResponse response) throws ServletException, IOException\n    {\n\n    \tUUID errorCode = UUID.randomUUID();\n        // Get the exception that occurred, if any\n        Throwable t = (Throwable) request\n                .getAttribute(\"javax.servlet.error.exception\");\n\n        String logInfo = UIUtil.getRequestLogInfo(request);\n\n        // Log the error. Since we don't have a context, we need to\n        // build the info \"by hand\"\n        String logMessage = \":error_code=\" + errorCode + \":session_id=\" + request.getSession().getId()\n                + \":internal_error:\" + logInfo;\n\n        log.warn(logMessage, t);\n\n        // Now we try and mail the designated user, if any\n        UIUtil.sendAlert(request, (Exception) t);\n\n        request.setAttribute(\"javax.servlet.error.code\", errorCode.toString());\n        JSPManager.showJSP(request, response, \"/error/internal.jsp\");\n    }\n\n    protected void doPost(HttpServletRequest request,\n            HttpServletResponse response) throws ServletException, IOException\n    {\n        doGet(request, response);\n    }\n}\n", "<%--\n\n    The contents of this file are subject to the license and copyright\n    detailed in the LICENSE and NOTICE files at the root of the source\n    tree and available online at\n\n    http://www.dspace.org/license/\n\n--%>\n<%--\n  - Page representing an internal server error\n  --%>\n\n<%@ page contentType=\"text/html;charset=UTF-8\" %>\n\n<%@ taglib uri=\"http://java.sun.com/jsp/jstl/fmt\"\n    prefix=\"fmt\" %>\n\t\n<%@ page import=\"java.io.PrintWriter\" %>\n<%@ page import=\"org.apache.commons.lang.StringUtils\" %>\n\n<%@ page isErrorPage=\"true\" %>\n\n<%@ taglib uri=\"http://www.dspace.org/dspace-tags.tld\" prefix=\"dspace\" %>\n\n<dspace:layout titlekey=\"jsp.error.internal.title\">\n    <%-- <h1>Internal System Error</h1> --%>\n    <h1><fmt:message key=\"jsp.error.internal.title\"/></h1>\n    <%-- <p>Oops!  The system has experienced an internal error.  This is our fault,\n    please pardon our dust during these early stages of the DSpace system!</p> --%>\n    <p><fmt:message key=\"jsp.error.internal.text1\"/></p>\n    <%-- <p>The system has logged this error.  Please try to do what you were doing\n    again, and if the problem persists, please contact us so we can fix the\n    problem.</p> --%>\n\n    <dspace:include page=\"/components/contact-info.jsp\" />\n\n    <p align=\"center\">\n        <%-- <a href=\"<%= request.getContextPath() %>/\">Go to the DSpace home page</a> --%>\n        <a href=\"<%= request.getContextPath() %>/\"><fmt:message key=\"jsp.general.gohome\"/></a>\n    </p>\n        <!--\n    <%\n    String exCode = (String) request.getAttribute(\"javax.servlet.error.code\");\n    if(StringUtils.isBlank(exCode)) {\n\t\tout.println(\"No error code available\");\n    }\n    else {\n\t\tout.println(\"System error code: \" + exCode);\n\t}\n    out.println(\"=============================================\");\n    out.println(\"\\n\\n\\n\");\n        %>\n      -->\n</dspace:layout>\n"], "filenames": ["dspace-jspui/src/main/java/org/dspace/app/webui/servlet/InternalErrorServlet.java", "dspace-jspui/src/main/webapp/error/internal.jsp"], "buggy_code_start_loc": [10, 19], "buggy_code_end_loc": [55, 54], "fixing_code_start_loc": [11, 20], "fixing_code_end_loc": [60, 53], "type": "CWE-209", "message": "DSpace open source software is a repository application which provides durable access to digital resources. dspace-jspui is a UI component for DSpace. When an \"Internal System Error\" occurs in the JSPUI, then entire exception (including stack trace) is available. Information in this stacktrace may be useful to an attacker in launching a more sophisticated attack. This vulnerability only impacts the JSPUI. This issue has been fixed in version 6.4. users are advised to upgrade. Users unable to upgrade should disable the display of error messages in their internal.jsp file.", "other": {"cve": {"id": "CVE-2022-31189", "sourceIdentifier": "security-advisories@github.com", "published": "2022-08-01T21:15:13.217", "lastModified": "2022-08-08T17:02:29.900", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "DSpace open source software is a repository application which provides durable access to digital resources. dspace-jspui is a UI component for DSpace. When an \"Internal System Error\" occurs in the JSPUI, then entire exception (including stack trace) is available. Information in this stacktrace may be useful to an attacker in launching a more sophisticated attack. This vulnerability only impacts the JSPUI. This issue has been fixed in version 6.4. users are advised to upgrade. Users unable to upgrade should disable the display of error messages in their internal.jsp file."}, {"lang": "es", "value": "El software de c\u00f3digo abierto DSpace es una aplicaci\u00f3n de repositorio que proporciona acceso duradero a los recursos digitales. dspace-jspui es un componente de interfaz de usuario para DSpace. Cuando es producido un \"Error interno del sistema\" en la JSPUI, la excepci\u00f3n completa (incluyendo el seguimiento de la pila) est\u00e1 disponible. La informaci\u00f3n en este stacktrace puede ser \u00fatil para un atacante para lanzar un ataque m\u00e1s sofisticado. Esta vulnerabilidad s\u00f3lo afecta a la JSPUI. Este problema ha sido corregido en versi\u00f3n 6.4. Es recomendado a usuarios actualicen. Los usuarios que no puedan actualizarse deber\u00e1n deshabilitar la visualizaci\u00f3n de mensajes de error en su archivo internal.jsp"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 5.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 3.9, "impactScore": 1.4}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 5.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 3.9, "impactScore": 1.4}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-209"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:duraspace:dspace:*:*:*:*:*:*:*:*", "versionStartExcluding": "4.0", "versionEndExcluding": "6.4", "matchCriteriaId": "A5C7E6BD-3A22-4279-907B-6B2C76E0185C"}]}]}], "references": [{"url": "https://github.com/DSpace/DSpace/commit/afcc6c3389729b85d5c7b0230cbf9aaf7452f31a", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/DSpace/DSpace/security/advisories/GHSA-c2j7-66m3-r4ff", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/DSpace/DSpace/commit/afcc6c3389729b85d5c7b0230cbf9aaf7452f31a"}}