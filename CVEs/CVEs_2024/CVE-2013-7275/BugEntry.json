{"buggy_code": ["<?php\n/**\n * MyBB 1.6\n * Copyright 2010 MyBB Group, All Rights Reserved\n *\n * Website: http://mybb.com\n * License: http://mybb.com/about/license\n *\n * $Id$\n */\n\ndefine(\"IN_MYBB\", 1);\ndefine('THIS_SCRIPT', 'misc.php');\n\n$templatelist = \"misc_rules_forum,misc_help_helpdoc,misc_whoposted_poster,misc_whoposted,misc_smilies_popup_smilie,misc_smilies_popup,misc_syndication_feedurl,misc_syndication\";\n$templatelist .= \",misc_buddypopup,misc_buddypopup_user_online,misc_buddypopup_user_offline,misc_buddypopup_user_sendpm\";\n$templatelist .= \",misc_smilies,misc_smilies_smilie,misc_help_section_bit,misc_help_section,misc_help,forumdisplay_password_wrongpass,forumdisplay_password\";\nrequire_once \"./global.php\";\nrequire_once MYBB_ROOT.\"inc/functions_post.php\";\n\n// Load global language phrases\n$lang->load(\"misc\");\n\n$plugins->run_hooks(\"misc_start\");\n\nif($mybb->input['action'] == \"dstswitch\" && $mybb->request_method == \"post\" && $mybb->user['uid'] > 0)\n{\n\tif($mybb->user['dstcorrection'] == 2)\n\t{\n\t\tif($mybb->user['dst'] == 1)\n\t\t{\n\t\t\t$update_array = array(\"dst\" => 0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$update_array = array(\"dst\" => 1);\n\t\t}\n\t}\n\t$db->update_query(\"users\", $update_array, \"uid='{$mybb->user['uid']}'\");\n\tif(!$mybb->input['ajax'])\n\t{\n\t\tredirect(\"index.php\", $lang->dst_settings_updated);\n\t}\n\telse\n\t{\n\t\techo \"done\";\n\t\texit;\n\t}\n}\nif($mybb->input['action'] == \"markread\")\n{\n\tif($mybb->user['uid'] && verify_post_check($mybb->input['my_post_key'], true) !== true)\n\t{\n\t\t// Protect our user's unread forums from CSRF\n\t\terror($lang->invalid_post_code);\n\t}\n\n\tif($mybb->input['fid'])\n\t{\n\t\t$mybb->input['fid'] = intval($mybb->input['fid']);\n\t\t$validforum = get_forum($mybb->input['fid']);\n\t\tif(!$validforum)\n\t\t{\n\t\t\tif(!$mybb->input['ajax'])\n\t\t\t{\n\t\t\t\terror($lang->error_invalidforum);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\techo 0;\n\t\t\t\texit;\n\t\t\t}\n\t\t}\n\n\t\trequire_once MYBB_ROOT.\"/inc/functions_indicators.php\";\n\t\tmark_forum_read($mybb->input['fid']);\n\n\t\t$plugins->run_hooks(\"misc_markread_forum\");\n\n\t\tif(!$mybb->input['ajax'])\n\t\t{\n\t\t\tredirect(get_forum_link($mybb->input['fid']), $lang->redirect_markforumread);\n\t\t}\n\t\telse\n\t\t{\n\t\t\techo 1;\n\t\t\texit;\n\t\t}\n\t}\n\telse\n\t{\n\n\t\t$plugins->run_hooks(\"misc_markread_end\");\n\t\trequire_once MYBB_ROOT.\"/inc/functions_indicators.php\";\n\t\tmark_all_forums_read();\n\t\tredirect(\"index.php\", $lang->redirect_markforumsread);\n\t}\n}\nelseif($mybb->input['action'] == \"clearpass\")\n{\n\t$plugins->run_hooks(\"misc_clearpass\");\n\n\tif($mybb->input['fid'])\n\t{\n\t\tif(!verify_post_check($mybb->input['my_post_key']))\n\t\t{\n\t\t\terror($lang->invalid_post_code);\n\t\t}\n\n\t\tmy_unsetcookie(\"forumpass[\".intval($mybb->input['fid']).\"]\");\n\t\tredirect(\"index.php\", $lang->redirect_forumpasscleared);\n\t}\n}\nelseif($mybb->input['action'] == \"rules\")\n{\n\tif($mybb->input['fid'])\n\t{\n\t\t$plugins->run_hooks(\"misc_rules_start\");\n\n\t\t$fid = intval($mybb->input['fid']);\n\n\t\t$forum = get_forum($fid);\n\t\tif(!$forum || $forum['type'] != \"f\" || $forum['rules'] == '')\n\t\t{\n\t\t\terror($lang->error_invalidforum);\n\t\t}\n\n\t\t$forumpermissions = forum_permissions($forum['fid']);\n\t\tif($forumpermissions['canview'] != 1)\n\t\t{\n\t\t\terror_no_permission();\n\t\t}\n\n\t\tif(!$forum['rulestitle'])\n\t\t{\n\t\t\t$forum['rulestitle'] = $lang->sprintf($lang->forum_rules, $forum['name']);\n\t\t}\n\n\t\trequire_once MYBB_ROOT.\"inc/class_parser.php\";\n\t\t$parser = new postParser();\n\t\t$parser_options = array(\n\t\t\t\"allow_html\" => 1,\n\t\t\t\"allow_mycode\" => 1,\n\t\t\t\"allow_smilies\" => 1,\n\t\t\t\"allow_imgcode\" => 1,\n\t\t\t\"filter_badwords\" => 1\n\t\t);\n\n\t\t$forum['rules'] = $parser->parse_message($forum['rules'], $parser_options);\n\n\t\t// Make navigation\n\t\tbuild_forum_breadcrumb($mybb->input['fid']);\n\t\tadd_breadcrumb($forum['rulestitle']);\n\n\t\t$plugins->run_hooks(\"misc_rules_end\");\n\n\t\teval(\"\\$rules = \\\"\".$templates->get(\"misc_rules_forum\").\"\\\";\");\n\t\toutput_page($rules);\n\t}\n\n}\nelseif($mybb->input['action'] == \"help\")\n{\n\t$lang->load(\"helpdocs\");\n\t$lang->load(\"helpsections\");\n\t$lang->load(\"customhelpdocs\");\n\t$lang->load(\"customhelpsections\");\n\n\tadd_breadcrumb($lang->nav_helpdocs, \"misc.php?action=help\");\n\n\t$query = $db->query(\"\n\t\tSELECT h.*, s.enabled AS section\n\t\tFROM \".TABLE_PREFIX.\"helpdocs h\n\t\tLEFT JOIN \".TABLE_PREFIX.\"helpsections s ON (s.sid=h.sid)\n\t\tWHERE h.hid='\".intval($mybb->input['hid']).\"'\n\t\");\n\t$helpdoc = $db->fetch_array($query);\n\tif($helpdoc['hid'])\n\t{\n\t\tif($helpdoc['section'] != 0 && $helpdoc['enabled'] != 0)\n\t\t{\n\t\t\t$plugins->run_hooks(\"misc_help_helpdoc_start\");\n\n\t\t\tif($helpdoc['usetranslation'] == 1)\n\t\t\t{\n\t\t\t\t$langnamevar = \"d\".$helpdoc['hid'].\"_name\";\n\t\t\t\t$langdescvar = \"d\".$helpdoc['hid'].\"_desc\";\n\t\t\t\t$langdocvar = \"d\".$helpdoc['hid'].\"_document\";\n\t\t\t\tif($lang->$langnamevar)\n\t\t\t\t{\n\t\t\t\t\t$helpdoc['name'] = $lang->$langnamevar;\n\t\t\t\t}\n\t\t\t\tif($lang->$langdescvar)\n\t\t\t\t{\n\t\t\t\t\t$helpdoc['description'] = $lang->$langdescvar;\n\t\t\t\t}\n\t\t\t\tif($lang->$langdocvar)\n\t\t\t\t{\n\t\t\t\t\t$helpdoc['document'] = $lang->$langdocvar;\n\t\t\t\t\t\n\t\t\t\t\tif($langdocvar == \"d3_document\")\n\t\t\t\t\t{\n\t\t\t\t\t\t$helpdoc['document'] = $lang->sprintf($helpdoc['document'], $mybb->user['logoutkey']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tadd_breadcrumb($helpdoc['name']);\n\n\t\t\t$plugins->run_hooks(\"misc_help_helpdoc_end\");\n\n\t\t\teval(\"\\$helppage = \\\"\".$templates->get(\"misc_help_helpdoc\").\"\\\";\");\n\t\t\toutput_page($helppage);\n\t\t}\n\t\telse\n\t\t{\n\t\t\terror($lang->error_invalidhelpdoc);\n\t\t}\n\t}\n\telse\n\t{\n\t\t$plugins->run_hooks(\"misc_help_section_start\");\n\n\t\t$query = $db->simple_select(\"helpdocs\", \"*\", \"\", array('order_by' => 'sid, disporder'));\n\t\twhile($helpdoc = $db->fetch_array($query))\n\t\t{\n\t\t\t$helpdocs[$helpdoc['sid']][$helpdoc['disporder']][$helpdoc['hid']] = $helpdoc;\n\t\t}\n\t\tunset($helpdoc);\n\t\t$sections = '';\n\t\t$query = $db->simple_select(\"helpsections\", \"*\", \"enabled != 0\", array('order_by' => 'disporder'));\n\t\twhile($section = $db->fetch_array($query))\n\t\t{\n\t\t\tif($section['usetranslation'] == 1)\n\t\t\t{\n\t\t\t\t$langnamevar = \"s\".$section['sid'].\"_name\";\n\t\t\t\t$langdescvar = \"s\".$section['sid'].\"_desc\";\n\t\t\t\tif($lang->$langnamevar)\n\t\t\t\t{\n\t\t\t\t\t$section['name'] = $lang->$langnamevar;\n\t\t\t\t}\n\t\t\t\tif($lang->$langdescvar)\n\t\t\t\t{\n\t\t\t\t\t$section['description'] = $lang->$langdescvar;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(is_array($helpdocs[$section['sid']]))\n\t\t\t{\n\t\t\t\t$helpbits = '';\n\t\t\t\t// Expand (or Collapse) forums\n\t\t\t\tif($mybb->input['action'] == \"expand\")\n\t\t\t\t{\n\t\t\t\t\tmy_setcookie(\"fcollapse[{$section['sid']}]\", '');\n\t\t\t\t\t$scollapse[$section['sid']] = '';\n\t\t\t\t}\n\t\t\t\telseif($mybb->input['action'] == \"collapse\")\n\t\t\t\t{\n\t\t\t\t\tmy_setcookie(\"fcollapse[{$section['sid']}]\", \"y\");\n\t\t\t\t\t$scollapse[$section['sid']] = \"y\";\n\t\t\t\t}\n\t\t\t\tforeach($helpdocs[$section['sid']] as $key => $bit)\n\t\t\t\t{\n\t\t\t\t\tforeach($bit as $key => $helpdoc)\n\t\t\t\t\t{\n\t\t\t\t\t\tif($helpdoc['enabled'] != 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif($helpdoc['usetranslation'] == 1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$langnamevar = \"d\".$helpdoc['hid'].'_name';\n\t\t\t\t\t\t\t\t$langdescvar = \"d\".$helpdoc['hid'].'_desc';\n\t\t\t\t\t\t\t\tif($lang->$langnamevar)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$helpdoc['name'] = $lang->$langnamevar;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif($lang->$langdescvar)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$helpdoc['description'] = $lang->$langdescvar;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$altbg = alt_trow();\n\t\t\t\t\t\t\teval(\"\\$helpbits .= \\\"\".$templates->get(\"misc_help_section_bit\").\"\\\";\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$expdisplay = '';\n\t\t\t\t\t$sname = \"sid_\".$section['sid'].\"_c\";\n\t\t\t\t\tif($collapsed[$sname] == \"display: show;\")\n\t\t\t\t\t{\n\t\t\t\t\t\t$expcolimage = \"collapse_collapsed.gif\";\n\t\t\t\t\t\t$expdisplay = \"display: none;\";\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$expcolimage = \"collapse.gif\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\teval(\"\\$sections .= \\\"\".$templates->get(\"misc_help_section\").\"\\\";\");\n\t\t\t}\n\t\t}\n\n\t\t$plugins->run_hooks(\"misc_help_section_end\");\n\n\t\teval(\"\\$help = \\\"\".$templates->get(\"misc_help\").\"\\\";\");\n\t\toutput_page($help);\n\t}\n}\nelseif($mybb->input['action'] == \"buddypopup\")\n{\n\t$plugins->run_hooks(\"misc_buddypopup_start\");\n\n\tif($mybb->user['uid'] == 0)\n\t{\n\t\terror_no_permission();\n\t}\n\tif($mybb->input['removebuddy'] && verify_post_check($mybb->input['my_post_key']))\n\t{\n\t\t$buddies = $mybb->user['buddylist'];\n\t\t$namesarray = explode(\",\",$buddies);\n\t\tif(is_array($namesarray))\n\t\t{\n\t\t\tforeach($namesarray as $key => $buddyid)\n\t\t\t{\n\t\t\t\tif($buddyid == $mybb->input['removebuddy'])\n\t\t\t\t{\n\t\t\t\t\tunset($namesarray[$key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t$buddylist = implode(',', $namesarray);\n\t\t\t$db->update_query(\"users\", array('buddylist' => $buddylist), \"uid='\".$mybb->user['uid'].\"'\");\n\t\t\t$mybb->user['buddylist'] = $buddylist;\n\t\t}\n\t}\n\t// Load Buddies\n\tif($mybb->user['buddylist'] != \"\")\n\t{\n\t\t$timecut = TIME_NOW - $mybb->settings['wolcutoff'];\n\t\t$query = $db->simple_select(\"users\", \"*\", \"uid IN ({$mybb->user['buddylist']})\", array('order_by' => 'lastactive'));\n\n\t\twhile($buddy = $db->fetch_array($query))\n\t\t{\n\t\t\t$buddy_name = format_name($buddy['username'], $buddy['usergroup'], $buddy['displaygroup']);\n\t\t\t$profile_link = build_profile_link($buddy_name, $buddy['uid'], '_blank', 'if(window.opener) { window.opener.location = this.href; return false; }');\n\n\t\t\tif($mybb->user['receivepms'] != 0 && $buddy['receivepms'] != 0 && $groupscache[$buddy['usergroup']]['canusepms'] != 0)\n\t\t\t{\n\t\t\t\teval(\"\\$send_pm = \\\"\".$templates->get(\"misc_buddypopup_user_sendpm\").\"\\\";\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$send_pm = '';\n\t\t\t}\n\t\t\tif($buddy['lastactive'])\n\t\t\t{\n\t\t\t\t$last_active = $lang->sprintf($lang->last_active, my_date($mybb->settings['dateformat'], $buddy['lastactive']).\", \".my_date($mybb->settings['timeformat'], $buddy['lastactive']));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$last_active = $lang->sprintf($lang->last_active, $lang->never);\n\t\t\t}\n\n\t\t\tif($buddy['avatar'])\n\t\t\t{\n\t\t\t\t$buddy['avatar'] = htmlspecialchars_uni($buddy['avatar']);\n\t\t\t\tif($buddy['avatardimensions'])\n\t\t\t\t{\n\t\t\t\t\trequire_once MYBB_ROOT.\"inc/functions_image.php\";\n\t\t\t\t\tlist($width, $height) = explode(\"|\", $buddy['avatardimensions']);\n\t\t\t\t\t$scaled_dimensions = scale_image($width, $height, 44, 44);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$scaled_dimensions = array(\n\t\t\t\t\t\t\"width\" => 44,\n\t\t\t\t\t\t\"height\" => 44\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$buddy['avatar'] = $theme['imgdir'] . \"/default_avatar.gif\";\n\t\t\t\t$scaled_dimensions = array(\n\t\t\t\t\t\"width\" => 44,\n\t\t\t\t\t\"height\" => 44\n\t\t\t\t);\n\t\t\t}\n\t\t\t$margin_top = ceil((50-$scaled_dimensions['height'])/2);\n\t\t\tif($buddy['lastactive'] > $timecut && ($buddy['invisible'] == 0 || $mybb->user['usergroup'] == 4) && $buddy['lastvisit'] != $buddy['lastactive'])\n\t\t\t{\n\t\t\t\teval(\"\\$buddys['online'] .= \\\"\".$templates->get(\"misc_buddypopup_user_online\").\"\\\";\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\teval(\"\\$buddys['offline'] .= \\\"\".$templates->get(\"misc_buddypopup_user_offline\").\"\\\";\");\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\t// No buddies? :(\n\t\t$buddys['offline'] = $lang->no_buddies;\n\t}\n\n\t$plugins->run_hooks(\"misc_buddypopup_end\");\n\n\teval(\"\\$buddylist = \\\"\".$templates->get(\"misc_buddypopup\").\"\\\";\");\n\toutput_page($buddylist);\n}\nelseif($mybb->input['action'] == \"whoposted\")\n{\n\t$numposts = 0;\n\t$altbg = alt_trow();\n\t$whoposted = '';\n\t$tid = intval($mybb->input['tid']);\n\t$thread = get_thread($tid);\n\t\n\tif(is_moderator($thread['fid']))\n\t{\n\t\t$ismod = true;\n\t\t$show_posts = \"(p.visible = '1' OR p.visible = '0')\";\n\t}\n\telse\n\t{\n\t\t$ismod = false;\n\t\t$show_posts = \"p.visible = '1'\";\n\t}\n\t\n\t// Make sure we are looking at a real thread here.\n\tif(!$thread || ($thread['visible'] != 1 && $ismod == false) || ($thread['visible'] > 1 && $ismod == true))\n\t{\n\t\terror($lang->error_invalidthread);\n\t}\n\t// Does the thread belong to a valid forum?\n\t$forum = get_forum($thread['fid']);\n\tif(!$forum || $forum['type'] != \"f\")\n\t{\n\t\terror($lang->error_invalidforum);\n\t}\n\t\n\t// Does the user have permission to view this thread?\n\t$forumpermissions = forum_permissions($forum['fid']);\n\t\n\tif($forumpermissions['canview'] == 0 || $forumpermissions['canviewthreads'] == 0 || ($forumpermissions['canonlyviewownthreads'] != 0 && $thread['uid'] != $mybb->user['uid']))\n\t{\n\t\terror_no_permission();\n\t}\n\t\n\t// Check if this forum is password protected and we have a valid password\n\tcheck_forum_password($forum['fid']);\n\t\n\tif($mybb->input['sort'] != 'username')\n\t{\n\t\t$sortsql = ' ORDER BY posts DESC';\n\t}\n\telse\n\t{\n\t\t$sortsql = ' ORDER BY p.username ASC';\n\t}\n\t$query = $db->query(\"\n\t\tSELECT COUNT(p.pid) AS posts, p.username AS postusername, u.uid, u.username, u.usergroup, u.displaygroup\n\t\tFROM \".TABLE_PREFIX.\"posts p\n\t\tLEFT JOIN \".TABLE_PREFIX.\"users u ON (u.uid=p.uid)\n\t\tWHERE tid='\".$tid.\"' AND $show_posts\n\t\tGROUP BY u.uid, p.username, u.uid, u.username, u.usergroup, u.displaygroup\n\t\t\".$sortsql.\"\n\t\");\n\twhile($poster = $db->fetch_array($query))\n\t{\n\t\tif($poster['username'] == '')\n\t\t{\n\t\t\t$poster['username'] = $poster['postusername'];\n\t\t}\n\t\t$poster_name = format_name($poster['username'], $poster['usergroup'], $poster['displaygroup']);\n\t\tif($poster['uid'])\n\t\t{\n\t\t\t$onclick = \"opener.location.href='\".get_profile_link($poster['uid']).\"'; return false;\";\n\t\t}\n\t\t$profile_link = build_profile_link($poster_name, $poster['uid'], '_blank', $onclick);\n\t\t$numposts += $poster['posts'];\n\t\teval(\"\\$whoposted .= \\\"\".$templates->get(\"misc_whoposted_poster\").\"\\\";\");\n\t\t$altbg = alt_trow();\n\t}\n\t$numposts = my_number_format($numposts);\n\teval(\"\\$whop = \\\"\".$templates->get(\"misc_whoposted\").\"\\\";\");\n\toutput_page($whop);\n}\nelseif($mybb->input['action'] == \"smilies\")\n{\n\t$smilies = '';\n\tif($mybb->input['popup'])\n\t{ // make small popup list of smilies\n\t\t$editor = addslashes(htmlentities($mybb->input['editor']));\n\t\t$e = 1;\n\t\t$class = \"trow1\";\n\t\t$smilies = \"<tr>\";\n\t\t$query = $db->simple_select(\"smilies\", \"*\", \"\", array('order_by' => 'disporder'));\n\t\twhile($smilie = $db->fetch_array($query))\n\t\t{\n\t\t\t$smilie['insert'] = addslashes($smilie['find']);\n\t\t\t$smilie['find'] = htmlspecialchars_uni($smilie['find']);\n\t\t\teval(\"\\$smilies .= \\\"\".$templates->get(\"misc_smilies_popup_smilie\").\"\\\";\");\n\t\t\tif($e == 2)\n\t\t\t{\n\t\t\t\t$smilies .= \"</tr><tr>\";\n\t\t\t\t$e = 1;\n\t\t\t\t$class = alt_trow();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$e = 2;\n\t\t\t}\n\t\t}\n\t\tif($e == 2)\n\t\t{\n\t\t\t$smilies .= \"<td colspan=\\\"2\\\" class=\\\"$class\\\">&nbsp;</td>\";\n\t\t}\n\t\teval(\"\\$smiliespage = \\\"\".$templates->get(\"misc_smilies_popup\").\"\\\";\");\n\t\toutput_page($smiliespage);\n\t}\n\telse\n\t{\n\t\tadd_breadcrumb($lang->nav_smilies);\n\t\t$class = \"trow1\";\n\t\t$query = $db->simple_select(\"smilies\", \"*\", \"\", array('order_by' => 'disporder'));\n\t\twhile($smilie = $db->fetch_array($query))\n\t\t{\n\t\t\t$smilie['find'] = htmlspecialchars_uni($smilie['find']);\n\t\t\teval(\"\\$smilies .= \\\"\".$templates->get(\"misc_smilies_smilie\").\"\\\";\");\n\t\t\t$class = alt_trow();\n\t\t}\n\t\teval(\"\\$smiliespage = \\\"\".$templates->get(\"misc_smilies\").\"\\\";\");\n\t\toutput_page($smiliespage);\n\t}\n}\nelseif($mybb->input['action'] == \"imcenter\")\n{\n\tif($mybb->input['imtype'] != \"aim\" && $mybb->input['imtype'] != \"msn\" && $mybb->input['imtype'] != \"yahoo\")\n\t{\n\t\terror($lang->error_invalidimtype);\n\t}\n\t$uid = $mybb->input['uid'];\n\t$user = get_user($uid);\n\n\tif(!$user['username'])\n\t{\n\t\terror($lang->error_invaliduser);\n\t}\n\tif(!$user[$mybb->input['imtype']])\n\t{\n\t\terror($lang->error_invalidimtype);\n\t}\n\n\t// build im navigation bar\n\t$navigationbar = $navsep = '';\n\tif($user['aim'])\n\t{\n\t\t$navigationbar .= \"<a href=\\\"misc.php?action=imcenter&amp;imtype=aim&amp;uid=$uid\\\">$lang->aol_im</a>\";\n\t\t$navsep = ' - ';\n\t}\n\tif($user['msn'])\n\t{\n\t\t$navigationbar .= \"$navsep<a href=\\\"misc.php?action=imcenter&amp;imtype=msn&amp;uid=$uid\\\">$lang->msn</a>\";\n\t\t$navsep = ' - ';\n\t}\n\tif($user['yahoo'])\n\t{\n\t\t$navigationbar .= \"$navsep<a href=\\\"misc.php?action=imcenter&amp;imtype=yahoo&amp;uid=$uid\\\">$lang->yahoo_im</a>\";\n\t}\n\t$lang->msn_address_is = $lang->sprintf($lang->msn_address_is, $user['username']);\n\t$lang->send_y_message = $lang->sprintf($lang->send_y_message, $user['username']);\n\t$lang->view_y_profile = $lang->sprintf($lang->view_y_profile, $user['username']);\n\t\n\t$imtemplate = \"misc_imcenter_\".$mybb->input['imtype'];\n\teval(\"\\$imcenter = \\\"\".$templates->get($imtemplate).\"\\\";\");\n\toutput_page($imcenter);\n}\nelseif($mybb->input['action'] == \"syndication\")\n{\n\t$plugins->run_hooks(\"misc_syndication_start\");\n\n\t$fid = $mybb->input['fid'];\n\t$version = $mybb->input['version'];\n\t$limit = $mybb->input['limit'];\n\t$forums = $mybb->input['forums'];\n\n\tadd_breadcrumb($lang->nav_syndication);\n\t$unviewable = get_unviewable_forums();\n\tif(is_array($forums))\n\t{\n\t\t$unexp = explode(\",\", $unviewable);\n\t\tforeach($unexp as $fid)\n\t\t{\n\t\t\t$unview[$fid] = 1;\n\t\t}\n\t\t$syndicate = '';\n\t\t$comma = '';\n\t\tforeach($forums as $fid)\n\t\t{\n\t\t\tif($fid == \"all\")\n\t\t\t{\n\t\t\t\t$all = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telseif(is_numeric($fid))\n\t\t\t{\n\t\t\t\tif(!$unview[$fid])\n\t\t\t\t{\n\t\t\t\t\t$syndicate .= $comma.$fid;\n\t\t\t\t\t$comma = \",\";\n\t\t\t\t\t$flist[$fid] = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$url = $mybb->settings['bburl'].\"/syndication.php\";\n\t\tif(!$all)\n\t\t{\n\t\t\t$url .= \"?fid=$syndicate\";\n\t\t\t$add = 1;\n\t\t}\n\n\t\t// If the version is not RSS2.0, set the type to Atom1.0.\n\t\tif($version != \"rss2.0\")\n\t\t{\n\t\t\tif(!$add)\n\t\t\t{\n\t\t\t\t$url .= \"?\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$url .= \"&\";\n\t\t\t}\n\t\t\t$url .= \"type=atom1.0\";\n\t\t\t$add = 1;\n\t\t}\n\t\tif(intval($limit) > 0)\n\t\t{\n\t\t\tif($limit > 100)\n\t\t\t{\n\t\t\t\t$limit = 100;\n\t\t\t}\n\t\t\tif(!$add)\n\t\t\t{\n\t\t\t\t$url .= \"?\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$url .= \"&\";\n\t\t\t}\n\t\t\tif(is_numeric($limit))\n\t\t\t{\n\t\t\t\t$url .= \"limit=$limit\";\n\t\t\t}\n\t\t}\n\t\t$limit = intval($_POST['limit']);\n\t\teval(\"\\$feedurl = \\\"\".$templates->get(\"misc_syndication_feedurl\").\"\\\";\");\n\t}\n\tunset($GLOBALS['forumcache']);\n\tif(!$limit || !is_numeric($limit))\n\t{\n\t\t$limit = 15;\n\t}\n\n\t// If there is no version in the input, check the default (RSS2.0).\n\tif($version == \"atom1.0\")\n\t{\n\t\t$atom1check = \"checked=\\\"checked\\\"\";\n\t\t$rss2check = '';\n\t}\n\telse\n\t{\n\t\t$atom1check = '';\n\t\t$rss2check = \"checked=\\\"checked\\\"\";\n\t}\n\t$forumselect = makesyndicateforums();\n\n\t$plugins->run_hooks(\"misc_syndication_end\");\n\n\teval(\"\\$syndication = \\\"\".$templates->get(\"misc_syndication\").\"\\\";\");\n\toutput_page($syndication);\n}\n\n\nif($mybb->input['action'] == \"clearcookies\")\n{\n\t$plugins->run_hooks(\"misc_clearcookies\");\n\t\n\tif($mybb->input['key'] != $mybb->user['logoutkey'])\n\t{\n\t\terror($lang->error_invalidkey);\n\t}\n\n\t$remove_cookies = array('mybb', 'mybbuser', 'mybb[password]', 'mybb[lastvisit]', 'mybb[lastactive]', 'collapsed', 'mybb[forumread]', 'mybb[threadsread]', 'mybbadmin');\n\n\tif($mybb->settings['cookiedomain'])\n\t{\n\t\tforeach($remove_cookies as $name)\n\t\t{\n\t\t\t@my_setcookie($name, '', TIME_NOW-1, $mybb->settings['cookiepath'], $mybb->settings['cookiedomain']);\n\t\t}\n\t}\n\telse\n\t{\n\t\tforeach($remove_cookies as $name)\n\t\t{\n\t\t\t@my_setcookie($name, '', TIME_NOW-1, $mybb->settings['cookiepath']);\n\t\t}\n\t}\n\tredirect(\"index.php\", $lang->redirect_cookiescleared);\n}\n\nfunction makesyndicateforums($pid=\"0\", $selitem=\"\", $addselect=\"1\", $depth=\"\", $permissions=\"\")\n{\n\tglobal $db, $forumcache, $permissioncache, $mybb, $selecteddone, $forumlist, $forumlistbits, $theme, $templates, $flist, $lang, $unviewable;\n\tstatic $unviewableforums;\n\n\t$pid = intval($pid);\n\tif(!$permissions)\n\t{\n\t\t$permissions = $mybb->usergroup;\n\t}\n\n\tif(!is_array($forumcache))\n\t{\n\t\t// Get Forums\n\t\t$query = $db->simple_select(\"forums\", \"*\", \"linkto = '' AND active!=0\", array('order_by' => 'pid, disporder'));\n\t\twhile($forum = $db->fetch_array($query))\n\t\t{\n\t\t\t$forumcache[$forum['pid']][$forum['disporder']][$forum['fid']] = $forum;\n\t\t}\n\t}\n\n\tif(!is_array($permissioncache))\n\t{\n\t\t$permissioncache = forum_permissions();\n\t}\n\n\tif(!$unviewableforums)\n\t{\n\t\t// Save our unviewable forums in an array\n\t\t$unviewableforums = explode(\",\", str_replace(\"'\", \"\", $unviewable));\n\t}\n\n\tif(is_array($forumcache[$pid]))\n\t{\n\t\tforeach($forumcache[$pid] as $key => $main)\n\t\t{\n\t\t\tforeach($main as $key => $forum)\n\t\t\t{\n\t\t\t\t$perms = $permissioncache[$forum['fid']];\n\t\t\t\tif($perms['canview'] == 1 || $mybb->settings['hideprivateforums'] == 0)\n\t\t\t\t{\n\t\t\t\t\tif($flist[$forum['fid']])\n\t\t\t\t\t{\n\t\t\t\t\t\t$optionselected = \"selected=\\\"selected\\\"\";\n\t\t\t\t\t\t$selecteddone = \"1\";\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$optionselected = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif($forum['password'] == '' && !in_array($forum['fid'], $unviewableforums) || $forum['password'] && $mybb->cookies['forumpass'][$forum['fid']] == md5($mybb->user['uid'].$forum['password']))\n\t\t\t\t\t{\n\t\t\t\t\t\t$forumlistbits .= \"<option value=\\\"{$forum['fid']}\\\" $optionselected>$depth {$forum['name']}</option>\\n\";\n\t\t\t\t\t}\n\n\t\t\t\t\tif($forumcache[$forum['fid']])\n\t\t\t\t\t{\n\t\t\t\t\t\t$newdepth = $depth.\"&nbsp;&nbsp;&nbsp;&nbsp;\";\n\t\t\t\t\t\t$forumlistbits .= makesyndicateforums($forum['fid'], $selitem, 0, $newdepth, $perms);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif($addselect)\n\t{\n\t\tif(!$selecteddone)\n\t\t{\n\t\t\t$addsel = \" selected=\\\"selected\\\"\";\n\t\t}\n\t\t$forumlist = \"<select name=\\\"forums[]\\\" size=\\\"10\\\" multiple=\\\"multiple\\\">\\n<option value=\\\"all\\\" $addsel>$lang->syndicate_all_forums</option>\\n<option value=\\\"all\\\">----------------------</option>\\n$forumlistbits\\n</select>\";\n\t}\n\treturn $forumlist;\n}\n\n?>"], "fixing_code": ["<?php\n/**\n * MyBB 1.6\n * Copyright 2010 MyBB Group, All Rights Reserved\n *\n * Website: http://mybb.com\n * License: http://mybb.com/about/license\n *\n * $Id$\n */\n\ndefine(\"IN_MYBB\", 1);\ndefine('THIS_SCRIPT', 'misc.php');\n\n$templatelist = \"misc_rules_forum,misc_help_helpdoc,misc_whoposted_poster,misc_whoposted,misc_smilies_popup_smilie,misc_smilies_popup,misc_syndication_feedurl,misc_syndication\";\n$templatelist .= \",misc_buddypopup,misc_buddypopup_user_online,misc_buddypopup_user_offline,misc_buddypopup_user_sendpm\";\n$templatelist .= \",misc_smilies,misc_smilies_smilie,misc_help_section_bit,misc_help_section,misc_help,forumdisplay_password_wrongpass,forumdisplay_password\";\nrequire_once \"./global.php\";\nrequire_once MYBB_ROOT.\"inc/functions_post.php\";\n\n// Load global language phrases\n$lang->load(\"misc\");\n\n$plugins->run_hooks(\"misc_start\");\n\nif($mybb->input['action'] == \"dstswitch\" && $mybb->request_method == \"post\" && $mybb->user['uid'] > 0)\n{\n\tif($mybb->user['dstcorrection'] == 2)\n\t{\n\t\tif($mybb->user['dst'] == 1)\n\t\t{\n\t\t\t$update_array = array(\"dst\" => 0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$update_array = array(\"dst\" => 1);\n\t\t}\n\t}\n\t$db->update_query(\"users\", $update_array, \"uid='{$mybb->user['uid']}'\");\n\tif(!$mybb->input['ajax'])\n\t{\n\t\tredirect(\"index.php\", $lang->dst_settings_updated);\n\t}\n\telse\n\t{\n\t\techo \"done\";\n\t\texit;\n\t}\n}\nif($mybb->input['action'] == \"markread\")\n{\n\tif($mybb->user['uid'] && verify_post_check($mybb->input['my_post_key'], true) !== true)\n\t{\n\t\t// Protect our user's unread forums from CSRF\n\t\terror($lang->invalid_post_code);\n\t}\n\n\tif($mybb->input['fid'])\n\t{\n\t\t$mybb->input['fid'] = intval($mybb->input['fid']);\n\t\t$validforum = get_forum($mybb->input['fid']);\n\t\tif(!$validforum)\n\t\t{\n\t\t\tif(!$mybb->input['ajax'])\n\t\t\t{\n\t\t\t\terror($lang->error_invalidforum);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\techo 0;\n\t\t\t\texit;\n\t\t\t}\n\t\t}\n\n\t\trequire_once MYBB_ROOT.\"/inc/functions_indicators.php\";\n\t\tmark_forum_read($mybb->input['fid']);\n\n\t\t$plugins->run_hooks(\"misc_markread_forum\");\n\n\t\tif(!$mybb->input['ajax'])\n\t\t{\n\t\t\tredirect(get_forum_link($mybb->input['fid']), $lang->redirect_markforumread);\n\t\t}\n\t\telse\n\t\t{\n\t\t\techo 1;\n\t\t\texit;\n\t\t}\n\t}\n\telse\n\t{\n\n\t\t$plugins->run_hooks(\"misc_markread_end\");\n\t\trequire_once MYBB_ROOT.\"/inc/functions_indicators.php\";\n\t\tmark_all_forums_read();\n\t\tredirect(\"index.php\", $lang->redirect_markforumsread);\n\t}\n}\nelseif($mybb->input['action'] == \"clearpass\")\n{\n\t$plugins->run_hooks(\"misc_clearpass\");\n\n\tif($mybb->input['fid'])\n\t{\n\t\tif(!verify_post_check($mybb->input['my_post_key']))\n\t\t{\n\t\t\terror($lang->invalid_post_code);\n\t\t}\n\n\t\tmy_unsetcookie(\"forumpass[\".intval($mybb->input['fid']).\"]\");\n\t\tredirect(\"index.php\", $lang->redirect_forumpasscleared);\n\t}\n}\nelseif($mybb->input['action'] == \"rules\")\n{\n\tif($mybb->input['fid'])\n\t{\n\t\t$plugins->run_hooks(\"misc_rules_start\");\n\n\t\t$fid = intval($mybb->input['fid']);\n\n\t\t$forum = get_forum($fid);\n\t\tif(!$forum || $forum['type'] != \"f\" || $forum['rules'] == '')\n\t\t{\n\t\t\terror($lang->error_invalidforum);\n\t\t}\n\n\t\t$forumpermissions = forum_permissions($forum['fid']);\n\t\tif($forumpermissions['canview'] != 1)\n\t\t{\n\t\t\terror_no_permission();\n\t\t}\n\n\t\tif(!$forum['rulestitle'])\n\t\t{\n\t\t\t$forum['rulestitle'] = $lang->sprintf($lang->forum_rules, $forum['name']);\n\t\t}\n\n\t\trequire_once MYBB_ROOT.\"inc/class_parser.php\";\n\t\t$parser = new postParser();\n\t\t$parser_options = array(\n\t\t\t\"allow_html\" => 1,\n\t\t\t\"allow_mycode\" => 1,\n\t\t\t\"allow_smilies\" => 1,\n\t\t\t\"allow_imgcode\" => 1,\n\t\t\t\"filter_badwords\" => 1\n\t\t);\n\n\t\t$forum['rules'] = $parser->parse_message($forum['rules'], $parser_options);\n\n\t\t// Make navigation\n\t\tbuild_forum_breadcrumb($mybb->input['fid']);\n\t\tadd_breadcrumb($forum['rulestitle']);\n\n\t\t$plugins->run_hooks(\"misc_rules_end\");\n\n\t\teval(\"\\$rules = \\\"\".$templates->get(\"misc_rules_forum\").\"\\\";\");\n\t\toutput_page($rules);\n\t}\n\n}\nelseif($mybb->input['action'] == \"help\")\n{\n\t$lang->load(\"helpdocs\");\n\t$lang->load(\"helpsections\");\n\t$lang->load(\"customhelpdocs\");\n\t$lang->load(\"customhelpsections\");\n\n\tadd_breadcrumb($lang->nav_helpdocs, \"misc.php?action=help\");\n\n\t$query = $db->query(\"\n\t\tSELECT h.*, s.enabled AS section\n\t\tFROM \".TABLE_PREFIX.\"helpdocs h\n\t\tLEFT JOIN \".TABLE_PREFIX.\"helpsections s ON (s.sid=h.sid)\n\t\tWHERE h.hid='\".intval($mybb->input['hid']).\"'\n\t\");\n\t$helpdoc = $db->fetch_array($query);\n\tif($helpdoc['hid'])\n\t{\n\t\tif($helpdoc['section'] != 0 && $helpdoc['enabled'] != 0)\n\t\t{\n\t\t\t$plugins->run_hooks(\"misc_help_helpdoc_start\");\n\n\t\t\tif($helpdoc['usetranslation'] == 1)\n\t\t\t{\n\t\t\t\t$langnamevar = \"d\".$helpdoc['hid'].\"_name\";\n\t\t\t\t$langdescvar = \"d\".$helpdoc['hid'].\"_desc\";\n\t\t\t\t$langdocvar = \"d\".$helpdoc['hid'].\"_document\";\n\t\t\t\tif($lang->$langnamevar)\n\t\t\t\t{\n\t\t\t\t\t$helpdoc['name'] = $lang->$langnamevar;\n\t\t\t\t}\n\t\t\t\tif($lang->$langdescvar)\n\t\t\t\t{\n\t\t\t\t\t$helpdoc['description'] = $lang->$langdescvar;\n\t\t\t\t}\n\t\t\t\tif($lang->$langdocvar)\n\t\t\t\t{\n\t\t\t\t\t$helpdoc['document'] = $lang->$langdocvar;\n\t\t\t\t\t\n\t\t\t\t\tif($langdocvar == \"d3_document\")\n\t\t\t\t\t{\n\t\t\t\t\t\t$helpdoc['document'] = $lang->sprintf($helpdoc['document'], $mybb->user['logoutkey']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tadd_breadcrumb($helpdoc['name']);\n\n\t\t\t$plugins->run_hooks(\"misc_help_helpdoc_end\");\n\n\t\t\teval(\"\\$helppage = \\\"\".$templates->get(\"misc_help_helpdoc\").\"\\\";\");\n\t\t\toutput_page($helppage);\n\t\t}\n\t\telse\n\t\t{\n\t\t\terror($lang->error_invalidhelpdoc);\n\t\t}\n\t}\n\telse\n\t{\n\t\t$plugins->run_hooks(\"misc_help_section_start\");\n\n\t\t$query = $db->simple_select(\"helpdocs\", \"*\", \"\", array('order_by' => 'sid, disporder'));\n\t\twhile($helpdoc = $db->fetch_array($query))\n\t\t{\n\t\t\t$helpdocs[$helpdoc['sid']][$helpdoc['disporder']][$helpdoc['hid']] = $helpdoc;\n\t\t}\n\t\tunset($helpdoc);\n\t\t$sections = '';\n\t\t$query = $db->simple_select(\"helpsections\", \"*\", \"enabled != 0\", array('order_by' => 'disporder'));\n\t\twhile($section = $db->fetch_array($query))\n\t\t{\n\t\t\tif($section['usetranslation'] == 1)\n\t\t\t{\n\t\t\t\t$langnamevar = \"s\".$section['sid'].\"_name\";\n\t\t\t\t$langdescvar = \"s\".$section['sid'].\"_desc\";\n\t\t\t\tif($lang->$langnamevar)\n\t\t\t\t{\n\t\t\t\t\t$section['name'] = $lang->$langnamevar;\n\t\t\t\t}\n\t\t\t\tif($lang->$langdescvar)\n\t\t\t\t{\n\t\t\t\t\t$section['description'] = $lang->$langdescvar;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(is_array($helpdocs[$section['sid']]))\n\t\t\t{\n\t\t\t\t$helpbits = '';\n\t\t\t\t// Expand (or Collapse) forums\n\t\t\t\tif($mybb->input['action'] == \"expand\")\n\t\t\t\t{\n\t\t\t\t\tmy_setcookie(\"fcollapse[{$section['sid']}]\", '');\n\t\t\t\t\t$scollapse[$section['sid']] = '';\n\t\t\t\t}\n\t\t\t\telseif($mybb->input['action'] == \"collapse\")\n\t\t\t\t{\n\t\t\t\t\tmy_setcookie(\"fcollapse[{$section['sid']}]\", \"y\");\n\t\t\t\t\t$scollapse[$section['sid']] = \"y\";\n\t\t\t\t}\n\t\t\t\tforeach($helpdocs[$section['sid']] as $key => $bit)\n\t\t\t\t{\n\t\t\t\t\tforeach($bit as $key => $helpdoc)\n\t\t\t\t\t{\n\t\t\t\t\t\tif($helpdoc['enabled'] != 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif($helpdoc['usetranslation'] == 1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$langnamevar = \"d\".$helpdoc['hid'].'_name';\n\t\t\t\t\t\t\t\t$langdescvar = \"d\".$helpdoc['hid'].'_desc';\n\t\t\t\t\t\t\t\tif($lang->$langnamevar)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$helpdoc['name'] = $lang->$langnamevar;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif($lang->$langdescvar)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$helpdoc['description'] = $lang->$langdescvar;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$altbg = alt_trow();\n\t\t\t\t\t\t\teval(\"\\$helpbits .= \\\"\".$templates->get(\"misc_help_section_bit\").\"\\\";\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$expdisplay = '';\n\t\t\t\t\t$sname = \"sid_\".$section['sid'].\"_c\";\n\t\t\t\t\tif($collapsed[$sname] == \"display: show;\")\n\t\t\t\t\t{\n\t\t\t\t\t\t$expcolimage = \"collapse_collapsed.gif\";\n\t\t\t\t\t\t$expdisplay = \"display: none;\";\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$expcolimage = \"collapse.gif\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\teval(\"\\$sections .= \\\"\".$templates->get(\"misc_help_section\").\"\\\";\");\n\t\t\t}\n\t\t}\n\n\t\t$plugins->run_hooks(\"misc_help_section_end\");\n\n\t\teval(\"\\$help = \\\"\".$templates->get(\"misc_help\").\"\\\";\");\n\t\toutput_page($help);\n\t}\n}\nelseif($mybb->input['action'] == \"buddypopup\")\n{\n\t$plugins->run_hooks(\"misc_buddypopup_start\");\n\n\tif($mybb->user['uid'] == 0)\n\t{\n\t\terror_no_permission();\n\t}\n\tif($mybb->input['removebuddy'] && verify_post_check($mybb->input['my_post_key']))\n\t{\n\t\t$buddies = $mybb->user['buddylist'];\n\t\t$namesarray = explode(\",\",$buddies);\n\t\tif(is_array($namesarray))\n\t\t{\n\t\t\tforeach($namesarray as $key => $buddyid)\n\t\t\t{\n\t\t\t\tif($buddyid == $mybb->input['removebuddy'])\n\t\t\t\t{\n\t\t\t\t\tunset($namesarray[$key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t$buddylist = implode(',', $namesarray);\n\t\t\t$db->update_query(\"users\", array('buddylist' => $buddylist), \"uid='\".$mybb->user['uid'].\"'\");\n\t\t\t$mybb->user['buddylist'] = $buddylist;\n\t\t}\n\t}\n\t// Load Buddies\n\tif($mybb->user['buddylist'] != \"\")\n\t{\n\t\t$timecut = TIME_NOW - $mybb->settings['wolcutoff'];\n\t\t$query = $db->simple_select(\"users\", \"*\", \"uid IN ({$mybb->user['buddylist']})\", array('order_by' => 'lastactive'));\n\n\t\twhile($buddy = $db->fetch_array($query))\n\t\t{\n\t\t\t$buddy_name = format_name($buddy['username'], $buddy['usergroup'], $buddy['displaygroup']);\n\t\t\t$profile_link = build_profile_link($buddy_name, $buddy['uid'], '_blank', 'if(window.opener) { window.opener.location = this.href; return false; }');\n\n\t\t\tif($mybb->user['receivepms'] != 0 && $buddy['receivepms'] != 0 && $groupscache[$buddy['usergroup']]['canusepms'] != 0)\n\t\t\t{\n\t\t\t\teval(\"\\$send_pm = \\\"\".$templates->get(\"misc_buddypopup_user_sendpm\").\"\\\";\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$send_pm = '';\n\t\t\t}\n\t\t\tif($buddy['lastactive'])\n\t\t\t{\n\t\t\t\t$last_active = $lang->sprintf($lang->last_active, my_date($mybb->settings['dateformat'], $buddy['lastactive']).\", \".my_date($mybb->settings['timeformat'], $buddy['lastactive']));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$last_active = $lang->sprintf($lang->last_active, $lang->never);\n\t\t\t}\n\n\t\t\tif($buddy['avatar'])\n\t\t\t{\n\t\t\t\t$buddy['avatar'] = htmlspecialchars_uni($buddy['avatar']);\n\t\t\t\tif($buddy['avatardimensions'])\n\t\t\t\t{\n\t\t\t\t\trequire_once MYBB_ROOT.\"inc/functions_image.php\";\n\t\t\t\t\tlist($width, $height) = explode(\"|\", $buddy['avatardimensions']);\n\t\t\t\t\t$scaled_dimensions = scale_image($width, $height, 44, 44);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$scaled_dimensions = array(\n\t\t\t\t\t\t\"width\" => 44,\n\t\t\t\t\t\t\"height\" => 44\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$buddy['avatar'] = $theme['imgdir'] . \"/default_avatar.gif\";\n\t\t\t\t$scaled_dimensions = array(\n\t\t\t\t\t\"width\" => 44,\n\t\t\t\t\t\"height\" => 44\n\t\t\t\t);\n\t\t\t}\n\t\t\t$margin_top = ceil((50-$scaled_dimensions['height'])/2);\n\t\t\tif($buddy['lastactive'] > $timecut && ($buddy['invisible'] == 0 || $mybb->user['usergroup'] == 4) && $buddy['lastvisit'] != $buddy['lastactive'])\n\t\t\t{\n\t\t\t\teval(\"\\$buddys['online'] .= \\\"\".$templates->get(\"misc_buddypopup_user_online\").\"\\\";\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\teval(\"\\$buddys['offline'] .= \\\"\".$templates->get(\"misc_buddypopup_user_offline\").\"\\\";\");\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\t// No buddies? :(\n\t\t$buddys['offline'] = $lang->no_buddies;\n\t}\n\n\t$plugins->run_hooks(\"misc_buddypopup_end\");\n\n\teval(\"\\$buddylist = \\\"\".$templates->get(\"misc_buddypopup\").\"\\\";\");\n\toutput_page($buddylist);\n}\nelseif($mybb->input['action'] == \"whoposted\")\n{\n\t$numposts = 0;\n\t$altbg = alt_trow();\n\t$whoposted = '';\n\t$tid = intval($mybb->input['tid']);\n\t$thread = get_thread($tid);\n\t\n\tif(is_moderator($thread['fid']))\n\t{\n\t\t$ismod = true;\n\t\t$show_posts = \"(p.visible = '1' OR p.visible = '0')\";\n\t}\n\telse\n\t{\n\t\t$ismod = false;\n\t\t$show_posts = \"p.visible = '1'\";\n\t}\n\t\n\t// Make sure we are looking at a real thread here.\n\tif(!$thread || ($thread['visible'] != 1 && $ismod == false) || ($thread['visible'] > 1 && $ismod == true))\n\t{\n\t\terror($lang->error_invalidthread);\n\t}\n\t// Does the thread belong to a valid forum?\n\t$forum = get_forum($thread['fid']);\n\tif(!$forum || $forum['type'] != \"f\")\n\t{\n\t\terror($lang->error_invalidforum);\n\t}\n\t\n\t// Does the user have permission to view this thread?\n\t$forumpermissions = forum_permissions($forum['fid']);\n\t\n\tif($forumpermissions['canview'] == 0 || $forumpermissions['canviewthreads'] == 0 || ($forumpermissions['canonlyviewownthreads'] != 0 && $thread['uid'] != $mybb->user['uid']))\n\t{\n\t\terror_no_permission();\n\t}\n\t\n\t// Check if this forum is password protected and we have a valid password\n\tcheck_forum_password($forum['fid']);\n\t\n\tif($mybb->input['sort'] != 'username')\n\t{\n\t\t$sortsql = ' ORDER BY posts DESC';\n\t}\n\telse\n\t{\n\t\t$sortsql = ' ORDER BY p.username ASC';\n\t}\n\t$query = $db->query(\"\n\t\tSELECT COUNT(p.pid) AS posts, p.username AS postusername, u.uid, u.username, u.usergroup, u.displaygroup\n\t\tFROM \".TABLE_PREFIX.\"posts p\n\t\tLEFT JOIN \".TABLE_PREFIX.\"users u ON (u.uid=p.uid)\n\t\tWHERE tid='\".$tid.\"' AND $show_posts\n\t\tGROUP BY u.uid, p.username, u.uid, u.username, u.usergroup, u.displaygroup\n\t\t\".$sortsql.\"\n\t\");\n\twhile($poster = $db->fetch_array($query))\n\t{\n\t\tif($poster['username'] == '')\n\t\t{\n\t\t\t$poster['username'] = $poster['postusername'];\n\t\t}\n\t\t$poster_name = format_name($poster['username'], $poster['usergroup'], $poster['displaygroup']);\n\t\tif($poster['uid'])\n\t\t{\n\t\t\t$onclick = \"opener.location.href='\".get_profile_link($poster['uid']).\"'; return false;\";\n\t\t}\n\t\t$profile_link = build_profile_link($poster_name, $poster['uid'], '_blank', $onclick);\n\t\t$numposts += $poster['posts'];\n\t\teval(\"\\$whoposted .= \\\"\".$templates->get(\"misc_whoposted_poster\").\"\\\";\");\n\t\t$altbg = alt_trow();\n\t}\n\t$numposts = my_number_format($numposts);\n\teval(\"\\$whop = \\\"\".$templates->get(\"misc_whoposted\").\"\\\";\");\n\toutput_page($whop);\n}\nelseif($mybb->input['action'] == \"smilies\")\n{\n\t$smilies = '';\n\tif($mybb->input['popup'])\n\t{ // make small popup list of smilies\n\t\t$editor = preg_replace('#([^a-zA-z0-9_-]+)#', '', $mybb->input['editor']);\n\t\t$e = 1;\n\t\t$class = \"trow1\";\n\t\t$smilies = \"<tr>\";\n\t\t$query = $db->simple_select(\"smilies\", \"*\", \"\", array('order_by' => 'disporder'));\n\t\twhile($smilie = $db->fetch_array($query))\n\t\t{\n\t\t\t$smilie['insert'] = addslashes($smilie['find']);\n\t\t\t$smilie['find'] = htmlspecialchars_uni($smilie['find']);\n\t\t\teval(\"\\$smilies .= \\\"\".$templates->get(\"misc_smilies_popup_smilie\").\"\\\";\");\n\t\t\tif($e == 2)\n\t\t\t{\n\t\t\t\t$smilies .= \"</tr><tr>\";\n\t\t\t\t$e = 1;\n\t\t\t\t$class = alt_trow();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$e = 2;\n\t\t\t}\n\t\t}\n\t\tif($e == 2)\n\t\t{\n\t\t\t$smilies .= \"<td colspan=\\\"2\\\" class=\\\"$class\\\">&nbsp;</td>\";\n\t\t}\n\t\teval(\"\\$smiliespage = \\\"\".$templates->get(\"misc_smilies_popup\").\"\\\";\");\n\t\toutput_page($smiliespage);\n\t}\n\telse\n\t{\n\t\tadd_breadcrumb($lang->nav_smilies);\n\t\t$class = \"trow1\";\n\t\t$query = $db->simple_select(\"smilies\", \"*\", \"\", array('order_by' => 'disporder'));\n\t\twhile($smilie = $db->fetch_array($query))\n\t\t{\n\t\t\t$smilie['find'] = htmlspecialchars_uni($smilie['find']);\n\t\t\teval(\"\\$smilies .= \\\"\".$templates->get(\"misc_smilies_smilie\").\"\\\";\");\n\t\t\t$class = alt_trow();\n\t\t}\n\t\teval(\"\\$smiliespage = \\\"\".$templates->get(\"misc_smilies\").\"\\\";\");\n\t\toutput_page($smiliespage);\n\t}\n}\nelseif($mybb->input['action'] == \"imcenter\")\n{\n\tif($mybb->input['imtype'] != \"aim\" && $mybb->input['imtype'] != \"msn\" && $mybb->input['imtype'] != \"yahoo\")\n\t{\n\t\terror($lang->error_invalidimtype);\n\t}\n\t$uid = $mybb->input['uid'];\n\t$user = get_user($uid);\n\n\tif(!$user['username'])\n\t{\n\t\terror($lang->error_invaliduser);\n\t}\n\tif(!$user[$mybb->input['imtype']])\n\t{\n\t\terror($lang->error_invalidimtype);\n\t}\n\n\t// build im navigation bar\n\t$navigationbar = $navsep = '';\n\tif($user['aim'])\n\t{\n\t\t$navigationbar .= \"<a href=\\\"misc.php?action=imcenter&amp;imtype=aim&amp;uid=$uid\\\">$lang->aol_im</a>\";\n\t\t$navsep = ' - ';\n\t}\n\tif($user['msn'])\n\t{\n\t\t$navigationbar .= \"$navsep<a href=\\\"misc.php?action=imcenter&amp;imtype=msn&amp;uid=$uid\\\">$lang->msn</a>\";\n\t\t$navsep = ' - ';\n\t}\n\tif($user['yahoo'])\n\t{\n\t\t$navigationbar .= \"$navsep<a href=\\\"misc.php?action=imcenter&amp;imtype=yahoo&amp;uid=$uid\\\">$lang->yahoo_im</a>\";\n\t}\n\t$lang->msn_address_is = $lang->sprintf($lang->msn_address_is, $user['username']);\n\t$lang->send_y_message = $lang->sprintf($lang->send_y_message, $user['username']);\n\t$lang->view_y_profile = $lang->sprintf($lang->view_y_profile, $user['username']);\n\t\n\t$imtemplate = \"misc_imcenter_\".$mybb->input['imtype'];\n\teval(\"\\$imcenter = \\\"\".$templates->get($imtemplate).\"\\\";\");\n\toutput_page($imcenter);\n}\nelseif($mybb->input['action'] == \"syndication\")\n{\n\t$plugins->run_hooks(\"misc_syndication_start\");\n\n\t$fid = $mybb->input['fid'];\n\t$version = $mybb->input['version'];\n\t$limit = $mybb->input['limit'];\n\t$forums = $mybb->input['forums'];\n\n\tadd_breadcrumb($lang->nav_syndication);\n\t$unviewable = get_unviewable_forums();\n\tif(is_array($forums))\n\t{\n\t\t$unexp = explode(\",\", $unviewable);\n\t\tforeach($unexp as $fid)\n\t\t{\n\t\t\t$unview[$fid] = 1;\n\t\t}\n\t\t$syndicate = '';\n\t\t$comma = '';\n\t\tforeach($forums as $fid)\n\t\t{\n\t\t\tif($fid == \"all\")\n\t\t\t{\n\t\t\t\t$all = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telseif(is_numeric($fid))\n\t\t\t{\n\t\t\t\tif(!$unview[$fid])\n\t\t\t\t{\n\t\t\t\t\t$syndicate .= $comma.$fid;\n\t\t\t\t\t$comma = \",\";\n\t\t\t\t\t$flist[$fid] = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$url = $mybb->settings['bburl'].\"/syndication.php\";\n\t\tif(!$all)\n\t\t{\n\t\t\t$url .= \"?fid=$syndicate\";\n\t\t\t$add = 1;\n\t\t}\n\n\t\t// If the version is not RSS2.0, set the type to Atom1.0.\n\t\tif($version != \"rss2.0\")\n\t\t{\n\t\t\tif(!$add)\n\t\t\t{\n\t\t\t\t$url .= \"?\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$url .= \"&\";\n\t\t\t}\n\t\t\t$url .= \"type=atom1.0\";\n\t\t\t$add = 1;\n\t\t}\n\t\tif(intval($limit) > 0)\n\t\t{\n\t\t\tif($limit > 100)\n\t\t\t{\n\t\t\t\t$limit = 100;\n\t\t\t}\n\t\t\tif(!$add)\n\t\t\t{\n\t\t\t\t$url .= \"?\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$url .= \"&\";\n\t\t\t}\n\t\t\tif(is_numeric($limit))\n\t\t\t{\n\t\t\t\t$url .= \"limit=$limit\";\n\t\t\t}\n\t\t}\n\t\t$limit = intval($_POST['limit']);\n\t\teval(\"\\$feedurl = \\\"\".$templates->get(\"misc_syndication_feedurl\").\"\\\";\");\n\t}\n\tunset($GLOBALS['forumcache']);\n\tif(!$limit || !is_numeric($limit))\n\t{\n\t\t$limit = 15;\n\t}\n\n\t// If there is no version in the input, check the default (RSS2.0).\n\tif($version == \"atom1.0\")\n\t{\n\t\t$atom1check = \"checked=\\\"checked\\\"\";\n\t\t$rss2check = '';\n\t}\n\telse\n\t{\n\t\t$atom1check = '';\n\t\t$rss2check = \"checked=\\\"checked\\\"\";\n\t}\n\t$forumselect = makesyndicateforums();\n\n\t$plugins->run_hooks(\"misc_syndication_end\");\n\n\teval(\"\\$syndication = \\\"\".$templates->get(\"misc_syndication\").\"\\\";\");\n\toutput_page($syndication);\n}\n\n\nif($mybb->input['action'] == \"clearcookies\")\n{\n\t$plugins->run_hooks(\"misc_clearcookies\");\n\t\n\tif($mybb->input['key'] != $mybb->user['logoutkey'])\n\t{\n\t\terror($lang->error_invalidkey);\n\t}\n\n\t$remove_cookies = array('mybb', 'mybbuser', 'mybb[password]', 'mybb[lastvisit]', 'mybb[lastactive]', 'collapsed', 'mybb[forumread]', 'mybb[threadsread]', 'mybbadmin');\n\n\tif($mybb->settings['cookiedomain'])\n\t{\n\t\tforeach($remove_cookies as $name)\n\t\t{\n\t\t\t@my_setcookie($name, '', TIME_NOW-1, $mybb->settings['cookiepath'], $mybb->settings['cookiedomain']);\n\t\t}\n\t}\n\telse\n\t{\n\t\tforeach($remove_cookies as $name)\n\t\t{\n\t\t\t@my_setcookie($name, '', TIME_NOW-1, $mybb->settings['cookiepath']);\n\t\t}\n\t}\n\tredirect(\"index.php\", $lang->redirect_cookiescleared);\n}\n\nfunction makesyndicateforums($pid=\"0\", $selitem=\"\", $addselect=\"1\", $depth=\"\", $permissions=\"\")\n{\n\tglobal $db, $forumcache, $permissioncache, $mybb, $selecteddone, $forumlist, $forumlistbits, $theme, $templates, $flist, $lang, $unviewable;\n\tstatic $unviewableforums;\n\n\t$pid = intval($pid);\n\tif(!$permissions)\n\t{\n\t\t$permissions = $mybb->usergroup;\n\t}\n\n\tif(!is_array($forumcache))\n\t{\n\t\t// Get Forums\n\t\t$query = $db->simple_select(\"forums\", \"*\", \"linkto = '' AND active!=0\", array('order_by' => 'pid, disporder'));\n\t\twhile($forum = $db->fetch_array($query))\n\t\t{\n\t\t\t$forumcache[$forum['pid']][$forum['disporder']][$forum['fid']] = $forum;\n\t\t}\n\t}\n\n\tif(!is_array($permissioncache))\n\t{\n\t\t$permissioncache = forum_permissions();\n\t}\n\n\tif(!$unviewableforums)\n\t{\n\t\t// Save our unviewable forums in an array\n\t\t$unviewableforums = explode(\",\", str_replace(\"'\", \"\", $unviewable));\n\t}\n\n\tif(is_array($forumcache[$pid]))\n\t{\n\t\tforeach($forumcache[$pid] as $key => $main)\n\t\t{\n\t\t\tforeach($main as $key => $forum)\n\t\t\t{\n\t\t\t\t$perms = $permissioncache[$forum['fid']];\n\t\t\t\tif($perms['canview'] == 1 || $mybb->settings['hideprivateforums'] == 0)\n\t\t\t\t{\n\t\t\t\t\tif($flist[$forum['fid']])\n\t\t\t\t\t{\n\t\t\t\t\t\t$optionselected = \"selected=\\\"selected\\\"\";\n\t\t\t\t\t\t$selecteddone = \"1\";\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$optionselected = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif($forum['password'] == '' && !in_array($forum['fid'], $unviewableforums) || $forum['password'] && $mybb->cookies['forumpass'][$forum['fid']] == md5($mybb->user['uid'].$forum['password']))\n\t\t\t\t\t{\n\t\t\t\t\t\t$forumlistbits .= \"<option value=\\\"{$forum['fid']}\\\" $optionselected>$depth {$forum['name']}</option>\\n\";\n\t\t\t\t\t}\n\n\t\t\t\t\tif($forumcache[$forum['fid']])\n\t\t\t\t\t{\n\t\t\t\t\t\t$newdepth = $depth.\"&nbsp;&nbsp;&nbsp;&nbsp;\";\n\t\t\t\t\t\t$forumlistbits .= makesyndicateforums($forum['fid'], $selitem, 0, $newdepth, $perms);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif($addselect)\n\t{\n\t\tif(!$selecteddone)\n\t\t{\n\t\t\t$addsel = \" selected=\\\"selected\\\"\";\n\t\t}\n\t\t$forumlist = \"<select name=\\\"forums[]\\\" size=\\\"10\\\" multiple=\\\"multiple\\\">\\n<option value=\\\"all\\\" $addsel>$lang->syndicate_all_forums</option>\\n<option value=\\\"all\\\">----------------------</option>\\n$forumlistbits\\n</select>\";\n\t}\n\treturn $forumlist;\n}\n\n?>"], "filenames": ["misc.php"], "buggy_code_start_loc": [489], "buggy_code_end_loc": [490], "fixing_code_start_loc": [489], "fixing_code_end_loc": [490], "type": "CWE-79", "message": "Cross-site scripting (XSS) vulnerability in misc.php in MyBB (aka MyBulletinBoard) before 1.6.12 allows remote attackers to inject arbitrary web script or HTML via the editor parameter in a smilie list popup.", "other": {"cve": {"id": "CVE-2013-7275", "sourceIdentifier": "cve@mitre.org", "published": "2014-01-08T15:29:56.807", "lastModified": "2014-02-25T14:03:18.627", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site scripting (XSS) vulnerability in misc.php in MyBB (aka MyBulletinBoard) before 1.6.12 allows remote attackers to inject arbitrary web script or HTML via the editor parameter in a smilie list popup."}, {"lang": "es", "value": "Vulnerabilidad cross-site scripting (XSS) en misc.php de MyBB (tambien conocido como MyBulletinBoard) anteriores a 1.6.12 permite a atacantes remotos inyectar script web o HTML de forma arbitraria a trav\u00e9s del par\u00e1metro editor en un listado de smileis."}], "metrics": {"cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:*:*:*:*:*:*:*:*", "versionEndIncluding": "1.6.11", "matchCriteriaId": "1AB176E2-A87C-4098-93F3-B6B4C09389FD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.00:*:*:*:*:*:*:*", "matchCriteriaId": "BD61D970-9363-4A75-A8DB-D0EBA2CF0D53"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.0:beta4:*:*:*:*:*:*", "matchCriteriaId": "C14F8B95-1A33-4DA8-8DE4-35C7DC3590CF"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.0:pr1:*:*:*:*:*:*", "matchCriteriaId": "CD7728CD-1FA0-4428-B3FC-883781A699CD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.0:pr2:*:*:*:*:*:*", "matchCriteriaId": "0883675F-9442-49E7-8471-C205B7EA201D"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.0:rc1:*:*:*:*:*:*", "matchCriteriaId": "B85E419B-F9D3-4839-A15C-F22BF9DABFAC"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.0:rc2:*:*:*:*:*:*", "matchCriteriaId": "EAB8B860-71DC-4F45-9E2A-74BD1C2ED893"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.0:rc3:*:*:*:*:*:*", "matchCriteriaId": "C67749DF-F8AF-4C88-A120-0F48307C58E1"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.0:rc4:*:*:*:*:*:*", "matchCriteriaId": "FD0820A0-5D85-446F-9B7E-F8DB258A1178"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.01:*:*:*:*:*:*:*", "matchCriteriaId": "990E206E-5E2C-4A68-9FDF-CD47F7524054"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.0:*:*:*:*:*:*:*", "matchCriteriaId": "CF143B59-5C78-4BF6-9368-5BCF427B4753"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.1:*:*:*:*:*:*:*", "matchCriteriaId": "B16F6F07-F5A9-47BF-88ED-25F068B68CF6"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.2:*:*:*:*:*:*:*", "matchCriteriaId": "A8A46A48-1361-4DD3-B97D-4C4FC776D68A"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.3:*:*:*:*:*:*:*", "matchCriteriaId": "337D89AE-1B7A-4101-B1F7-DFEDF2369385"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.4:*:*:*:*:*:*:*", "matchCriteriaId": "BE08AF25-EDB1-4DA1-B431-F0692858AAAA"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.5:*:*:*:*:*:*:*", "matchCriteriaId": "BF24E7BA-3144-4DBA-9613-A44FBE0822F9"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.6:*:*:*:*:*:*:*", "matchCriteriaId": "029430A5-85BD-4258-B58D-F3DCBC625E5B"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.7:*:*:*:*:*:*:*", "matchCriteriaId": "4183DB7F-FAB3-4D90-AD87-31CA4150CFDD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.1.8:*:*:*:*:*:*:*", "matchCriteriaId": "3E2B90B8-DC02-4C79-BD69-DEF79945C418"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.02:*:*:*:*:*:*:*", "matchCriteriaId": "C5C52215-D236-4D1A-9E30-14B9676FB68A"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2:*:*:*:*:*:*:*", "matchCriteriaId": "4E080342-93CD-4E74-AE60-5858738CE7F5"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.0:*:*:*:*:*:*:*", "matchCriteriaId": "B48D2EDF-86C2-475C-9476-E5A2D586CA0E"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.1:*:*:*:*:*:*:*", "matchCriteriaId": "B6725373-C229-4B57-BB1E-AF178E19DEB0"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.2:*:*:*:*:*:*:*", "matchCriteriaId": "36E4C84A-21D5-4C9A-85F8-45C9657CE6F5"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.3:*:*:*:*:*:*:*", "matchCriteriaId": "C7E55085-E3E3-4BB8-A680-19A28D7E88F4"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.4:*:*:*:*:*:*:*", "matchCriteriaId": "AB01A9AA-AE70-46DF-815A-05D1101EE706"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.5:*:*:*:*:*:*:*", "matchCriteriaId": "98AFD77B-A046-4AB9-B6F4-FFFF66C63C68"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.6:*:*:*:*:*:*:*", "matchCriteriaId": "AA00D38E-AAF6-4F66-9203-5C074FC61F30"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.7:*:*:*:*:*:*:*", "matchCriteriaId": "137A8CED-BE82-462F-B83C-15F535961E74"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.8:*:*:*:*:*:*:*", "matchCriteriaId": "D179FDB6-9B1D-438C-B512-9A5C4F869A4C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.9:*:*:*:*:*:*:*", "matchCriteriaId": "B3E72A13-6B4A-4C7F-B8D9-A2D35E074B67"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.10:*:*:*:*:*:*:*", "matchCriteriaId": "3A2D344F-4671-4194-A553-A5773B5DF3B1"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.11:*:*:*:*:*:*:*", "matchCriteriaId": "245760C8-DC10-47F1-843A-461AE2F3DF61"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.12:*:*:*:*:*:*:*", "matchCriteriaId": "A055E6BF-3CAC-4C74-8E37-A89E3E0F8559"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.13:*:*:*:*:*:*:*", "matchCriteriaId": "1121A071-3709-4B2B-ADF4-EDC560F73E0A"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.2.14:*:*:*:*:*:*:*", "matchCriteriaId": "71FD2842-7E00-440F-8A93-9D3F45A004DB"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.03:*:*:*:*:*:*:*", "matchCriteriaId": "F6ABDEE8-D463-47CA-998D-33472F3382F3"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.3:pre-1.0:*:*:*:*:*:*", "matchCriteriaId": "16C45BFE-A083-4DC8-A2E5-9BCE543F5AE4"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.04:*:*:*:*:*:*:*", "matchCriteriaId": "DE44965F-F968-4CD2-9F21-1E1A92F5F7F2"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.0:*:*:*:*:*:*:*", "matchCriteriaId": "3FC8864E-161F-408E-93D6-693A9238C494"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.1:*:*:*:*:*:*:*", "matchCriteriaId": "4C5965DE-D9B6-4074-B14B-ABCAAAAB872B"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.2:*:*:*:*:*:*:*", "matchCriteriaId": "9503D6C2-DCBC-4720-BE29-34913950407E"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.3:*:*:*:*:*:*:*", "matchCriteriaId": "0F6FC2B1-45DF-439E-8BAE-A15A08E7D9F7"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.4:*:*:*:*:*:*:*", "matchCriteriaId": "853E94FE-A56F-44B0-87FE-DE5927B7A547"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.5:*:*:*:*:*:*:*", "matchCriteriaId": "49C7F758-9E38-4870-85C3-11E350F96641"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.6:*:*:*:*:*:*:*", "matchCriteriaId": "B46B7E13-51F8-4950-BBB4-A03B8E5B4750"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.7:*:*:*:*:*:*:*", "matchCriteriaId": "58C9C804-6901-412C-B178-183417BD5C04"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.8:*:*:*:*:*:*:*", "matchCriteriaId": "A00F1254-67DE-436D-AB83-1C55639BDBD2"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.9:*:*:*:*:*:*:*", "matchCriteriaId": "AC2FDC2B-2CB4-433F-9290-3A6BE0A929B5"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.10:*:*:*:*:*:*:*", "matchCriteriaId": "1FF9452B-CF4B-45F0-8487-23D9CCBB1A4A"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.11:*:*:*:*:*:*:*", "matchCriteriaId": "2021275B-D61A-4309-8876-5354E115CB29"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.12:*:*:*:*:*:*:*", "matchCriteriaId": "7925DEA1-8062-45C9-94E7-19D8FACEAFCD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.13:*:*:*:*:*:*:*", "matchCriteriaId": "D35E537F-0F49-40AB-9E97-7898D91353D1"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.14:*:*:*:*:*:*:*", "matchCriteriaId": "BCDC1181-A2B7-4D1B-B2BF-DAC9E58E88C3"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.15:*:*:*:*:*:*:*", "matchCriteriaId": "57C37D10-B945-4674-A846-BCEC573FF93C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.4.16:*:*:*:*:*:*:*", "matchCriteriaId": "4FD245B9-1381-4A1B-AF47-F28349FA6F52"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.5.1:*:*:*:*:*:*:*", "matchCriteriaId": "2AFD7848-56E4-4608-82E7-CFF46A8809AC"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.5.2:*:*:*:*:*:*:*", "matchCriteriaId": "CC489F94-3545-4E1A-AE9E-B88EB1A7D516"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.0:*:*:*:*:*:*:*", "matchCriteriaId": "E5B50C36-C3D7-48FD-805B-4A94E727C93F"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.1:*:*:*:*:*:*:*", "matchCriteriaId": "FBEB75D4-FAA4-4A5B-AA0A-57EE8EE88E61"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.2:*:*:*:*:*:*:*", "matchCriteriaId": "00E51ABC-9F77-4028-BE47-D5BFD4FEC749"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.3:*:*:*:*:*:*:*", "matchCriteriaId": "E0BD20D9-0DFC-451F-9C71-38C6D0236CF2"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.4:*:*:*:*:*:*:*", "matchCriteriaId": "FDFE35CB-05CC-4E6F-B188-1141773E7F10"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.5:*:*:*:*:*:*:*", "matchCriteriaId": "22A90F66-DAE9-45FC-B255-390D569CCC56"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.6:*:*:*:*:*:*:*", "matchCriteriaId": "E1A3FDDB-9488-405B-A2A0-500CF49061BE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.7:*:*:*:*:*:*:*", "matchCriteriaId": "04264BC5-425C-47D4-9EE0-35BF11B904F9"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.8:*:*:*:*:*:*:*", "matchCriteriaId": "5E42628F-7E7F-4E3A-BB8E-699166CB86B3"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.9:*:*:*:*:*:*:*", "matchCriteriaId": "A02FA2FA-E035-40CD-9C0F-A143A931D40D"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mybb:mybb:1.6.10:*:*:*:*:*:*:*", "matchCriteriaId": "F52B8848-9103-4A78-A45B-6BE73855647A"}]}]}], "references": [{"url": "http://blog.mybb.com/2013/12/16/mybb-1-6-12-released-security-maintenance-release", "source": "cve@mitre.org", "tags": ["Vendor Advisory"]}, {"url": "http://www.securityfocus.com/bid/64570", "source": "cve@mitre.org"}, {"url": "https://github.com/mybb/mybb/commit/6212bc954d72caf591e141ca36b8df964387bee8", "source": "cve@mitre.org", "tags": ["Exploit", "Patch"]}]}, "github_commit_url": "https://github.com/mybb/mybb/commit/6212bc954d72caf591e141ca36b8df964387bee8"}}