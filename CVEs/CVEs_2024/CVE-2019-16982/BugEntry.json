{"buggy_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\tThe Original Code is FusionPBX\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2018\n\tthe Initial Developer. All Rights Reserved.\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (!permission_exists('access_control_node_view')) {\n\t\techo \"access denied\"; exit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get variables used to control the order\n\t$order_by = $_GET[\"order_by\"];\n\t$order = $_GET[\"order\"];\n\n//additional includes\n\trequire_once \"resources/header.php\";\n\trequire_once \"resources/paging.php\";\n\n//show the content\n\techo \"<table width='100%' border='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' align='left' nowrap='nowrap'><b>\".$text['title-access_control_nodes'].\"</b></td>\\n\";\n\techo \"\t\t<td width='50%' align='right'>&nbsp;</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\n//prepare to page the results\n\t$sql = \"select count(*) from v_access_control_nodes \";\n\t$sql .= \"where access_control_uuid = :access_control_uuid \";\n\t$parameters['access_control_uuid'] = $access_control_uuid;\n\t$database = new database;\n\t$num_rows = $database->select($sql, $parameters, 'column');\n\n//prepare to page the results\n\t$rows_per_page = ($_SESSION['domain']['paging']['numeric'] != '') ? $_SESSION['domain']['paging']['numeric'] : 50;\n\t$param = \"&id=\".escape($access_control_uuid);\n\t$page = $_GET['page'];\n\tif (strlen($page) == 0) { $page = 0; $_GET['page'] = 0; }\n\tlist($paging_controls, $rows_per_page, $var3) = paging($num_rows, $param, $rows_per_page);\n\t$offset = $rows_per_page * $page;\n\n//get the list\n\t$sql = \"select * from v_access_control_nodes \";\n\t$sql .= \"where access_control_uuid = :access_control_uuid \";\n\t$sql .= order_by($order_by, $order);\n\t$sql .= limit_offset($rows_per_page, $offset);\n\t$parameters['access_control_uuid'] = $access_control_uuid;\n\t$database = new database;\n\t$access_control_nodes = $database->select($sql, $parameters);\n\n//set the row styles\n\t$c = 0;\n\t$row_style[\"0\"] = \"row_style0\";\n\t$row_style[\"1\"] = \"row_style1\";\n\n//show the nodes\n\techo \"<table class='tr_hover' width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"<tr>\\n\";\n\techo th_order_by('node_type', $text['label-node_type'], $order_by, $order);\n\techo th_order_by('node_cidr', $text['label-node_cidr'], $order_by, $order);\n\techo th_order_by('node_domain', $text['label-node_domain'], $order_by, $order);\n\techo th_order_by('node_description', $text['label-node_description'], $order_by, $order);\n\techo \"<td class='list_control_icons'>\";\n\tif (permission_exists('access_control_node_add')) {\n\t\techo \"<a href='access_control_node_edit.php?access_control_uuid=\".escape($_GET['id']).\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \"&nbsp;\\n\";\n\t}\n\techo \"</td>\\n\";\n\techo \"<tr>\\n\";\n\n\tif (is_array($access_control_nodes)) {\n\t\tforeach($access_control_nodes as $row) {\n\t\t\tif (permission_exists('access_control_node_edit')) {\n\t\t\t\t$tr_link = \"href='access_control_node_edit.php?access_control_uuid=\".escape($row['access_control_uuid']).\"&id=\".escape($row['access_control_node_uuid']).\"'\";\n\t\t\t}\n\t\t\techo \"<tr \".$tr_link.\">\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['node_type']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'><a \".$tr_link.\">\".escape($row['node_cidr']).\"</a></td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['node_domain']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['node_description']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td class='list_control_icons'>\";\n\t\t\tif (permission_exists('access_control_node_edit')) {\n\t\t\t\techo \"<a href='access_control_node_edit.php?access_control_uuid=\".escape($row['access_control_uuid']).\"&id=\".escape($row['access_control_node_uuid']).\"' alt='\".$text['button-edit'].\"'>$v_link_label_edit</a>\";\n\t\t\t}\n\t\t\tif (permission_exists('access_control_node_delete')) {\n\t\t\t\techo \"<a href='access_control_node_delete.php?access_control_uuid=\".escape($row['access_control_uuid']).\"&id=\".escape($row['access_control_node_uuid']).\"' alt='\".$text['button-delete'].\"' onclick=\\\"return confirm('\".$text['confirm-delete'].\"')\\\">$v_link_label_delete</a>\";\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\t$c = $c == 1 ? 0 : 1;\n\t\t} //end foreach\n\t\tunset($sql, $result, $row_count);\n\t} //end if results\n\n\techo \"</table>\\n\";\n\tif (permission_exists('access_control_node_add')) {\n\t\techo \"<div style='float: right;'>\\n\";\n\t\techo \"\t<a href='access_control_node_edit.php?access_control_uuid=\".escape($_GET['id']).\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t\techo \"</div>\\n\";\n\t}\n\techo \"<br />\\n\";\n\techo \"<div align='center'>\".$paging_controls.\"</div>\\n\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "fixing_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\tThe Original Code is FusionPBX\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2019\n\tthe Initial Developer. All Rights Reserved.\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (!permission_exists('access_control_node_view')) {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get variables used to control the order\n\t$order_by = $_GET[\"order_by\"];\n\t$order = $_GET[\"order\"];\n\n//additional includes\n\trequire_once \"resources/header.php\";\n\trequire_once \"resources/paging.php\";\n\n//show the content\n\techo \"<table width='100%' border='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' align='left' nowrap='nowrap'><b>\".$text['title-access_control_nodes'].\"</b></td>\\n\";\n\techo \"\t\t<td width='50%' align='right'>&nbsp;</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\n//prepare to page the results\n\t$sql = \"select count(*) from v_access_control_nodes \";\n\t$sql .= \"where access_control_uuid = :access_control_uuid \";\n\t$parameters['access_control_uuid'] = $access_control_uuid;\n\t$database = new database;\n\t$num_rows = $database->select($sql, $parameters, 'column');\n\n//prepare to page the results\n\t$rows_per_page = ($_SESSION['domain']['paging']['numeric'] != '') ? $_SESSION['domain']['paging']['numeric'] : 50;\n\t$param = \"&id=\".escape($access_control_uuid);\n\t$page = $_GET['page'];\n\tif (strlen($page) == 0) { $page = 0; $_GET['page'] = 0; }\n\tlist($paging_controls, $rows_per_page, $var3) = paging($num_rows, $param, $rows_per_page);\n\t$offset = $rows_per_page * $page;\n\n//get the list\n\t$sql = \"select * from v_access_control_nodes \";\n\t$sql .= \"where access_control_uuid = :access_control_uuid \";\n\t$sql .= order_by($order_by, $order);\n\t$sql .= limit_offset($rows_per_page, $offset);\n\t$parameters['access_control_uuid'] = $access_control_uuid;\n\t$database = new database;\n\t$access_control_nodes = $database->select($sql, $parameters);\n\n//set the row styles\n\t$c = 0;\n\t$row_style[\"0\"] = \"row_style0\";\n\t$row_style[\"1\"] = \"row_style1\";\n\n//show the nodes\n\techo \"<table class='tr_hover' width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"<tr>\\n\";\n\techo th_order_by('node_type', $text['label-node_type'], $order_by, $order);\n\techo th_order_by('node_cidr', $text['label-node_cidr'], $order_by, $order);\n\techo th_order_by('node_domain', $text['label-node_domain'], $order_by, $order);\n\techo th_order_by('node_description', $text['label-node_description'], $order_by, $order);\n\techo \"<td class='list_control_icons'>\";\n\tif (permission_exists('access_control_node_add')) {\n\t\techo \"<a href='access_control_node_edit.php?access_control_uuid=\".urlencode($_GET['id']).\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \"&nbsp;\\n\";\n\t}\n\techo \"</td>\\n\";\n\techo \"<tr>\\n\";\n\n\tif (is_array($access_control_nodes)) {\n\t\tforeach($access_control_nodes as $row) {\n\t\t\tif (permission_exists('access_control_node_edit')) {\n\t\t\t\t$tr_link = \"href='access_control_node_edit.php?access_control_uuid=\".urlencode($row['access_control_uuid']).\"&id=\".urlencode($row['access_control_node_uuid']).\"'\";\n\t\t\t}\n\t\t\techo \"<tr \".$tr_link.\">\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['node_type']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'><a \".$tr_link.\">\".escape($row['node_cidr']).\"</a></td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['node_domain']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['node_description']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td class='list_control_icons'>\";\n\t\t\tif (permission_exists('access_control_node_edit')) {\n\t\t\t\techo \"<a href='access_control_node_edit.php?access_control_uuid=\".urlencode($row['access_control_uuid']).\"&id=\".urlencode($row['access_control_node_uuid']).\"' alt='\".$text['button-edit'].\"'>$v_link_label_edit</a>\";\n\t\t\t}\n\t\t\tif (permission_exists('access_control_node_delete')) {\n\t\t\t\techo \"<a href='access_control_node_delete.php?access_control_uuid=\".urlencode($row['access_control_uuid']).\"&id=\".urlencode($row['access_control_node_uuid']).\"' alt='\".$text['button-delete'].\"' onclick=\\\"return confirm('\".$text['confirm-delete'].\"')\\\">$v_link_label_delete</a>\";\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\t$c = $c == 1 ? 0 : 1;\n\t\t} //end foreach\n\t\tunset($sql, $result, $row_count);\n\t} //end if results\n\n\techo \"</table>\\n\";\n\tif (permission_exists('access_control_node_add')) {\n\t\techo \"<div style='float: right;'>\\n\";\n\t\techo \"\t<a href='access_control_node_edit.php?access_control_uuid=\".urlencode($_GET['id']).\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t\techo \"</div>\\n\";\n\t}\n\techo \"<br />\\n\";\n\techo \"<div align='center'>\".$paging_controls.\"</div>\\n\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "filenames": ["app/access_controls/access_control_nodes.php"], "buggy_code_start_loc": [16], "buggy_code_end_loc": [126], "fixing_code_start_loc": [16], "fixing_code_end_loc": [127], "type": "CWE-79", "message": "In FusionPBX up to v4.5.7, the file app\\access_controls\\access_control_nodes.php uses an unsanitized \"id\" variable coming from the URL, which is reflected in HTML, leading to XSS.", "other": {"cve": {"id": "CVE-2019-16982", "sourceIdentifier": "cve@mitre.org", "published": "2019-10-21T16:15:17.837", "lastModified": "2023-02-03T21:35:59.800", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In FusionPBX up to v4.5.7, the file app\\access_controls\\access_control_nodes.php uses an unsanitized \"id\" variable coming from the URL, which is reflected in HTML, leading to XSS."}, {"lang": "es", "value": "En FusionPBX versiones hasta v4.5.7, el archivo app\\access_controls\\access_control_nodes.php utiliza una variable \"id\" no saneada que proviene de la URL, que es reflejada en HTML, conllevando a una vulnerabilidad de tipo XSS."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.5.7", "matchCriteriaId": "A5A0C1F9-8032-46C6-8DD4-DB91FACF7330"}]}]}], "references": [{"url": "https://github.com/fusionpbx/fusionpbx/commit/c9f87dc16def2135930ebbfd667651cc3f6de2ff", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://resp3ctblog.wordpress.com/2019/10/19/fusionpbx-xss-14/", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/c9f87dc16def2135930ebbfd667651cc3f6de2ff"}}