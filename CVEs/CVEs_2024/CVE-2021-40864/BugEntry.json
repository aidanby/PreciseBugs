{"buggy_code": ["<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"UTF-8\">\n\t<title>translate</title>\n    <script type=\"text/javascript\" src=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.js\"></script>\n\t<script src=\"scripts/translate.js\"></script>\n\t<style>\n\t\thtml, body {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t</style>\n</head>\n<body id=\"body\" style=\"left:0px; top:0px; margin:0px; padding:0px;\">\n\t<div id=\"iframe_parent\" style=\"width:100%; height:100%;margin:0;padding:0\"></div>\n</body>\n</html>", "<!DOCTYPE html>\r\n<html lang=\"en\" style=\"width: 100%;height: 100%;\">\r\n<head>\r\n\t<meta charset=\"UTF-8\">\r\n\t<title>translate</title>\r\n    <script type=\"text/javascript\" src=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins-ui.js\"></script>\r\n\t<link rel=\"stylesheet\" href=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.css\">\r\n\t<style>\r\n\t\t.body_class {\r\n\t\t\ttop: 0 !important;\r\n\t\t\tleft: 0 !important;\r\n\t\t\tpadding: 5px !important;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\toverflow: hidden;\r\n\t\t\tfont-size: 14px !important;\r\n\t\t}\r\n\t\t.goog-te-banner-frame {\r\n\t\t\tdisplay: none;\r\n\t\t}\r\n\t\t.goog-te-combo {\r\n\t\t\twidth: 100% !important;\r\n\t\t}\r\n\t\t.noselect {\r\n\t\t\t-khtml-user-select: none;\r\n\t\t\tuser-select: none;\r\n\t\t\t-moz-user-select: none;\r\n\t\t\t-webkit-user-select: none;\r\n\t\t}\r\n\t\t.goog-tooltip {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\tfont {\r\n\t\t\tbackground-color: transparent !important;\r\n\t\t\t-webkit-box-shadow: 0px 0px 0px #9999aa !important;\r\n\t\t\t-moz-box-shadow: 0px 0px 0px #9999aa !important;\r\n\t\t\tbox-shadow: 0px 0px 0px #9999aa !important;\r\n\t\t\tbox-sizing: border-box !important;\r\n\t\t\t-webkit-box-sizing: border-box !important;\r\n\t\t\t-moz-box-sizing: border-box !important;\r\n\t\t\tposition: relative !important;\r\n\t\t}\r\n\t\timg {\r\n\t\t\twidth: 42px !important;\r\n\t\t\theight: 16px !important;\r\n\t\t\tpadding-top: 3px !important;\r\n\t\t}\r\n\t\t.goog-te-gadget {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\t\t.goog-te-combo {\r\n\t\t\theight: 22px;\r\n\t\t}\r\n\t\t.div_btn {\r\n\t\t\tpadding-top: 3px;\r\n\t\t\tpadding-left: 5px;\r\n\t\t\twidth: calc(100% - 20px);\r\n\t\t}\r\n\t\t.hidden {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t#btn_copy, #btn_replace {\r\n\t\t\twidth: calc(50% - 10px) !important;\r\n\t\t\tfont-size: 11px;\r\n\t\t\tmargin: 5px;\r\n\t\t}\r\n\t\t#hr {\r\n\t\t\twidth: calc(100% - 20px) !important;\r\n\t\t\tmargin-left: 10px !important;\r\n\t\t}\r\n\t</style>\r\n</head>\r\n<body id=\"body\" class=\"body_class\" style=\"left:0px;top:0px;width:100%; height: 100%;margin:0px;padding:0px;\">\r\n\t<div id=\"google_translate_state\" style=\"width: calc(100% - 20px); margin-left: 10px;\"></div>\r\n\t<hr id =\"hr\">\r\n\t<div id=\"div_parent\" style=\"overflow: hidden; overflow-x: hidden; padding-top: 15px; position: relative;\">\r\n\t\t<div id=\"google_translate_element\" style=\"position: relative; font-family: 'Arial'; word-break: break-word; white-space: pre-wrap; height: fit-content; margin-left: 10px; margin-right: 15px;\"></div>\r\n\t</div>\r\n\t<script>\r\n\t\tif (!Ps) Ps = new PerfectScrollbar('#' + \"div_parent\", {});\r\n\t\tvar timeOut;\r\n\t\tfunction googleTranslateElementInit() \r\n\t\t{\r\n\r\n\t\t\tdocument.getElementById(\"google_translate_element\").style.maxHeight = document.getElementById(\"body\").clientHeight- 120 +\"px\";\r\n\r\n\t\t\t// const urlParams = new URLSearchParams(window.location.search);\r\n\t\t\t// console.log(urlParams);\r\n\t\t\t// document.getElementById(\"google_translate_element\").innerHTML = decodeURIComponent(urlParams.get(\"text\"));\r\n\t\t\twindow.googleTranslator = new google.translate.TranslateElement({\r\n\t\t\t\t//pageLanguage: 'en',\r\n\t\t\t\tlayout: google.translate.TranslateElement.InlineLayout.VERTICAL,\r\n\t\t\t\tdisableAutoTranslation : false,\r\n\t\t\t}, 'google_translate_state');\r\n\t\t}\r\n\t\twindow.onload = function () {\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tdocument.getElementById(\"btn_copy\").onclick = function () {\r\n\t\t\t\t\tselectText(\"google_translate_element\");\r\n\t\t\t\t};\r\n\t\t\t\tdocument.getElementsByClassName(\"goog-te-combo\")[0].classList.add(\"form-control\")\r\n\t\t\t}, 300);\r\n\t\t\tif (navigator.userAgent.indexOf(\"Chrome\") !== -1) {\r\n\t\t\t\tdocument.getElementById(\":0.targetLanguage\").firstChild.style = \"height:21px;\"\r\n\t\t\t}\r\n\r\n\t\t\tfunction selectText(id) {\r\n\t\t\t\tvar sel, range;\r\n\t\t\t\tvar el = document.getElementById(id); //get element id\r\n\t\t\t\tif (window.getSelection && document.createRange) { //Browser compatibility\r\n\t\t\t\tsel = window.getSelection();\r\n\t\t\t\tif (sel.toString() == '') { //no text selection\r\n\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\trange = document.createRange(); //range object\r\n\t\t\t\t\t\trange.selectNodeContents(el); //sets Range\r\n\t\t\t\t\t\tsel.removeAllRanges(); //remove all ranges from selection\r\n\t\t\t\t\t\tsel.addRange(range);//add Range to a Selection.\r\n\t\t\t\t\t\tdocument.execCommand(\"copy\"); //copy\r\n\t\t\t\t\t\tsel.removeAllRanges(); //remove all ranges from selection\r\n\t\t\t\t\t},1);\r\n\t\t\t\t}\r\n\t\t\t\t} else if (document.selection) { //older ie\r\n\t\t\t\t\tsel = document.selection.createRange();\r\n\t\t\t\t\tif (sel.text == '') { //no text selection\r\n\t\t\t\t\t\trange = document.body.createTextRange();//Creates TextRange object\r\n\t\t\t\t\t\trange.moveToElementText(el);//sets Range\r\n\t\t\t\t\t\trange.select(); //make selection.\r\n\t\t\t\t\t\tdocument.execCommand(\"copy\"); //copy\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.addEventListener('message', function (msg) {\r\n\t\t\tif (typeof(msg.data) === \"object\")\r\n\t\t\t{\r\n\t\t\t\t//event for change theme\r\n\t\t\t\tvar styleTheme = document.createElement('style');\r\n\t\t\t\tstyleTheme.type = 'text/css';\r\n\t\t\t\tstyleTheme.innerHTML = msg.data.style;\r\n\t\t\t\tdocument.getElementsByTagName('head')[0].appendChild(styleTheme);\r\n\t\t\t\tdocument.getElementById(\"google_translate_element\").style.color = msg.data.theme[\"text-normal\"];\r\n\t\t\t\tdocument.getElementsByClassName(\"goog-te-gadget\")[0].style.color = msg.data.theme[\"text-normal\"];\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse if (msg.data === \"update_scroll\")\r\n\t\t\t{\r\n\t\t\t\tsetTimeout(()=> Ps.update(), 600);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (msg.data !== \"onchange_goog-te-combo\") {\r\n\t\t\t\tdocument.getElementById(\"google_translate_element\").innerHTML = msg.data;\r\n\t\t\t\t}\r\n\t\t\t\ttimeOut = setTimeout(function() {\r\n\t\t\t\t\tdocument.getElementById(\"google_translate_element\").style.opacity = 1;\r\n\t\t\t\t\tPs.update();\r\n\t\t\t\t\tif (msg.data.length)\r\n\t\t\t\t\t\tdocument.getElementById(\"div_btn\").classList.remove(\"hidden\");\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdocument.getElementById(\"div_btn\").classList.add(\"hidden\");\r\n\t\t\t\t}, 600);\r\n\t\t\t}\r\n\t\t});\r\n\t</script>\r\n\t<script src=\"vendor/google/google.js\"></script>\r\n<!-- for russian language -->\r\n<!-- <script src=\"http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit\"></script> -->\r\n</body>\r\n</html>", "(function(window, undefined){\r\n\tvar isInit = false;\r\n\tvar ifr;\r\n\tconst isIE = checkInternetExplorer();\t//check IE\r\n\tvar message = \"This plugin doesn't work in Internet Explorer.\"\r\n\t\r\n\twindow.Asc.plugin.init = function(text)\r\n\t{\r\n\t\tif (isIE) {\r\n\t\t\tdocument.getElementById(\"iframe_parent\").innerHTML = \"<h4 id='h4' style='margin:5px'>\" + message + \"</h4>\";\r\n\t\t\treturn;\r\n\t\t}\r\n    \r\n\t  \ttext = ProcessText(text);\r\n\r\n\t\tif (!isInit) {\r\n\t\t\tdocument.getElementById(\"iframe_parent\").innerHTML = \"\";\r\n\t\t\tifr                = document.createElement(\"iframe\");\r\n\t\t\tifr.position\t   = \"fixed\";\r\n\t\t\tifr.name           = \"google_name\";\r\n\t\t\tifr.id             = \"google_id\";\r\n\t\t\tifr.src            = \"./index_widget.html\";//?text=\" + encodeURIComponent(text);\r\n\t\t\tifr.style.top      = \"0px\";\r\n\t\t\tifr.style.left     = \"0px\";\r\n\t\t\tifr.style.width    = \"100%\";\r\n\t\t\tifr.style.height   = \"100%\";\r\n\t\t\tifr.setAttribute(\"frameBorder\", \"0\");\t\t\r\n\t\t\tdocument.getElementById(\"iframe_parent\").appendChild(ifr);\r\n\t\t\tisInit = true;\r\n\t\t\tifr.onload = function() {\r\n\t\t\t\tif (ifr.contentWindow.document.readyState == 'complete')\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tifr.contentDocument.getElementById(\"google_translate_element\").innerHTML = text;\r\n\t\t\t\t\t\tif (text.length)\r\n\t\t\t\t\t\t\tifr.contentDocument.getElementById(\"div_btn\").classList.remove(\"hidden\");\r\n\t\t\t\t\t}, 500);\r\n\t\t\t\t\r\n\t\t\t\tvar selectElement = ifr.contentDocument.getElementsByClassName('goog-te-combo')[0];\r\n\t\t\t\tselectElement.addEventListener('change', function(event) {\r\n\t\t\t\t\tifr.contentWindow.postMessage(\"onchange_goog-te-combo\", '*');\r\n\t\t\t\t\tifr.contentDocument.getElementById(\"google_translate_element\").style.opacity = 0;\r\n\t\t\t\t});\r\n\t\t\t\tifr.contentDocument.getElementById(\"google_translate_element\").style.height = \"fit-content\";\r\n\t\t\t\tvar btn = ifr.contentDocument.createElement(\"button\");\r\n\t\t\t\tvar btnReplace = ifr.contentDocument.createElement(\"button\");\r\n\t\t\t\tvar div = ifr.contentDocument.createElement(\"div\");\r\n\t\t\t\tdiv.appendChild(btn);\r\n\t\t\t\tdiv.appendChild(btnReplace);\r\n\t\t\t\tdiv.id = \"div_btn\";\r\n\t\t\t\tdiv.classList.add(\"skiptranslate\");\r\n\t\t\t\tdiv.classList.add(\"div_btn\");\r\n\t\t\t\tdiv.classList.add(\"hidden\");\r\n\t\t\t\tbtn.innerHTML = window.Asc.plugin.tr(\"Copy\");\r\n\t\t\t\tbtn.id = \"btn_copy\";\r\n\t\t\t\tbtn.classList.add(\"btn-text-default\");\r\n\t\t\t\tbtnReplace.classList.add(\"btn-text-default\");\r\n\t\t\t\tbtnReplace.innerHTML = window.Asc.plugin.tr(\"Replace\");\r\n\t\t\t\tbtnReplace.id = \"btn_replace\";\r\n\t\t\t\tsetTimeout(function() {ifr.contentDocument.getElementById(\"body\").appendChild(div);}, 100);\r\n\r\n\t\t\t\tsetTimeout(function() {\r\n                    btnReplace.onclick = function () {\r\n                        var translatedTxt = ifr.contentDocument.getElementById(\"google_translate_element\").outerText;\r\n                        var allParasTxt = translatedTxt.split(/\\n/);\r\n                        var allParsedParas = [];\r\n\r\n                        for (var nStr = 0; nStr < allParasTxt.length; nStr++) {\r\n                            if (allParasTxt[nStr].search(/\t/) === 0) {\r\n                                allParsedParas.push(\"\");\r\n                                allParasTxt[nStr] = allParasTxt[nStr].replace(/\t/, \"\");\r\n                            }\r\n                            var sSplited = allParasTxt[nStr].split(/\t/);\r\n\r\n                            sSplited.forEach(function(item, i, sSplited) {\r\n                                allParsedParas.push(item);\r\n                            });\r\n                        }\r\n                        Asc.scope.arr = allParsedParas;\r\n                        window.Asc.plugin.executeMethod(\"GetVersion\", [], function(version) {\r\n                            if (version === undefined) {\r\n                                window.Asc.plugin.executeMethod(\"PasteText\", [ifr.contentDocument.getElementById(\"google_translate_element\").outerText]);\r\n                            }\r\n                            else {\r\n                                window.Asc.plugin.executeMethod(\"GetSelectionType\", [], function(sType) {\r\n                                    switch (sType) {\r\n                                        case \"none\":\r\n                                        case \"drawing\":\r\n                                            window.Asc.plugin.executeMethod(\"PasteText\", [ifr.contentDocument.getElementById(\"google_translate_element\").outerText]);\r\n                                            break;\r\n                                        case \"text\":\r\n                                            window.Asc.plugin.callCommand(function() {\r\n                                                Api.ReplaceTextSmart(Asc.scope.arr);\r\n                                            });\r\n                                            break;\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n\t\t\t\tifr.contentWindow.postMessage(\"update_scroll\", '*');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tifr.contentWindow.postMessage(text, '*');\r\n\t\t\tifr.contentDocument.getElementById(\"google_translate_element\").style.opacity = 0;\r\n\t\t}\r\n\t};\r\n\r\n  \tfunction ProcessText(sText) {\r\n        return sText.replace(/\t/gi, '\\n').replace(/\t/gi, '\\n');\r\n    };\r\n\r\n\tfunction checkInternetExplorer(){\r\n\t\tvar rv = -1;\r\n\t\tif (window.navigator.appName == 'Microsoft Internet Explorer') {\r\n\t\t\tconst ua = window.navigator.userAgent;\r\n\t\t\tconst re = new RegExp('MSIE ([0-9]{1,}[\\.0-9]{0,})');\r\n\t\t\tif (re.exec(ua) != null) {\r\n\t\t\t\trv = parseFloat(RegExp.$1);\r\n\t\t\t}\r\n\t\t} else if (window.navigator.appName == 'Netscape') {\r\n\t\t\tconst ua = window.navigator.userAgent;\r\n\t\t\tconst re = new RegExp('Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})');\r\n\r\n\t\t\tif (re.exec(ua) != null) {\r\n\t\t\t\trv = parseFloat(RegExp.$1);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rv !== -1;\r\n\t};\r\n\r\n\twindow.Asc.plugin.button = function(id)\r\n\t{\r\n\t\tthis.executeCommand(\"close\", \"\");\r\n\t};\r\n\r\n\twindow.onresize = function()\r\n\t{\r\n\t\tifr.contentWindow.postMessage(\"update_scroll\", '*');\r\n\t};\r\n\r\n\twindow.Asc.plugin.onExternalMouseUp = function()\r\n\t{\r\n\t\tvar evt = document.createEvent(\"MouseEvents\");\r\n\t\tevt.initMouseEvent(\"mouseup\", true, true, window, 1, 0, 0, 0, 0,\r\n\t\t\tfalse, false, false, false, 0, null);\r\n\r\n\t\tdocument.dispatchEvent(evt);\r\n\t};\r\n\r\n\twindow.Asc.plugin.onTranslate = function()\r\n\t{\r\n\t\tif (isIE) {\r\n\t\t\tvar field = document.getElementById(\"h4\");\r\n\t\t\tif (field)\r\n\t\t\t\tfield.innerHTML = message = window.Asc.plugin.tr(message);\r\n\t\t}\r\n\t\t\r\n\t};\r\n\r\n\twindow.Asc.plugin.onThemeChanged = function(theme)\r\n\t{\r\n\t\twindow.Asc.plugin.onThemeChangedBase(theme);\r\n\t\tvar style = document.getElementsByTagName('head')[0].lastChild;\r\n\t\tsetTimeout(()=>ifr.contentWindow.postMessage({theme,style : style.innerHTML}, '*'),600);\r\n\t};\r\n\r\n})(window, undefined);\r\n"], "fixing_code": ["<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"UTF-8\">\n\t<title>translate</title>\n    <script type=\"text/javascript\" src=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.js\"></script>\n\t<script type=\"text/javascript\" src=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins-ui.js\"></script>\n\t<script src=\"scripts/translate.js\"></script>\n\t<style>\n\t\thtml, body {\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t}\n\t</style>\n</head>\n<body id=\"body\" style=\"left:0px; top:0px; margin:0px; padding:0px;\">\n\t<div id=\"iframe_parent\" style=\"width:100%; height:100%;margin:0;padding:0\"></div>\n</body>\n</html>", "<!DOCTYPE html>\r\n<html lang=\"en\" style=\"width: 100%;height: 100%;\">\r\n<head>\r\n\t<meta charset=\"UTF-8\">\r\n\t<title>translate</title>\r\n    <script type=\"text/javascript\" src=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.js\"></script>\r\n\t<script type=\"text/javascript\" src=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins-ui.js\"></script>\r\n\t<link rel=\"stylesheet\" href=\"https://onlyoffice.github.io/sdkjs-plugins/v1/plugins.css\">\r\n\t<style>\r\n\t\t.body_class {\r\n\t\t\ttop: 0 !important;\r\n\t\t\tleft: 0 !important;\r\n\t\t\tpadding: 5px !important;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\toverflow: hidden;\r\n\t\t\tfont-size: 14px !important;\r\n\t\t}\r\n\t\t.goog-te-banner-frame {\r\n\t\t\tdisplay: none;\r\n\t\t}\r\n\t\t.goog-te-combo {\r\n\t\t\twidth: 100% !important;\r\n\t\t}\r\n\t\t.noselect {\r\n\t\t\t-khtml-user-select: none;\r\n\t\t\tuser-select: none;\r\n\t\t\t-moz-user-select: none;\r\n\t\t\t-webkit-user-select: none;\r\n\t\t}\r\n\t\t.goog-tooltip {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\tfont {\r\n\t\t\tbackground-color: transparent !important;\r\n\t\t\t-webkit-box-shadow: 0px 0px 0px #9999aa !important;\r\n\t\t\t-moz-box-shadow: 0px 0px 0px #9999aa !important;\r\n\t\t\tbox-shadow: 0px 0px 0px #9999aa !important;\r\n\t\t\tbox-sizing: border-box !important;\r\n\t\t\t-webkit-box-sizing: border-box !important;\r\n\t\t\t-moz-box-sizing: border-box !important;\r\n\t\t\tposition: relative !important;\r\n\t\t}\r\n\t\timg {\r\n\t\t\twidth: 42px !important;\r\n\t\t\theight: 16px !important;\r\n\t\t\tpadding-top: 3px !important;\r\n\t\t}\r\n\t\t.goog-te-gadget {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\t\t.goog-te-combo {\r\n\t\t\theight: 22px;\r\n\t\t}\r\n\t\t.div_btn {\r\n\t\t\tpadding-top: 3px;\r\n\t\t\tpadding-left: 5px;\r\n\t\t\twidth: calc(100% - 20px);\r\n\t\t}\r\n\t\t.hidden {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t#btn_copy, #btn_replace {\r\n\t\t\twidth: calc(50% - 10px) !important;\r\n\t\t\tfont-size: 11px;\r\n\t\t\tmargin: 5px;\r\n\t\t}\r\n\t\t#hr {\r\n\t\t\twidth: calc(100% - 20px) !important;\r\n\t\t\tmargin-left: 10px !important;\r\n\t\t}\r\n\t</style>\r\n</head>\r\n<body id=\"body\" class=\"body_class\" style=\"left:0px;top:0px;width:100%; height: 100%;margin:0px;padding:0px;\">\r\n\t<div id=\"google_translate_state\" style=\"width: calc(100% - 20px); margin-left: 10px;\"></div>\r\n\t<hr id =\"hr\">\r\n\t<div id=\"div_parent\" style=\"overflow: hidden; overflow-x: hidden; padding-top: 15px; position: relative;\">\r\n\t\t<div id=\"google_translate_element\" style=\"position: relative; font-family: 'Arial'; word-break: break-word; white-space: pre-wrap; height: fit-content; margin-left: 10px; margin-right: 15px;\"></div>\r\n\t</div>\r\n\t<script>\r\n\t\tif (!Ps) Ps = new PerfectScrollbar('#' + \"div_parent\", {});\r\n\t\tvar timeOut;\r\n\t\tfunction googleTranslateElementInit() \r\n\t\t{\r\n\r\n\t\t\tdocument.getElementById(\"google_translate_element\").style.maxHeight = document.getElementById(\"body\").clientHeight- 120 +\"px\";\r\n\r\n\t\t\t// const urlParams = new URLSearchParams(window.location.search);\r\n\t\t\t// console.log(urlParams);\r\n\t\t\t// document.getElementById(\"google_translate_element\").innerHTML = decodeURIComponent(urlParams.get(\"text\"));\r\n\t\t\twindow.googleTranslator = new google.translate.TranslateElement({\r\n\t\t\t\t//pageLanguage: 'en',\r\n\t\t\t\tlayout: google.translate.TranslateElement.InlineLayout.VERTICAL,\r\n\t\t\t\tdisableAutoTranslation : false,\r\n\t\t\t}, 'google_translate_state');\r\n\t\t}\r\n\t\twindow.onload = function () {\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tdocument.getElementById(\"btn_copy\").onclick = function () {\r\n\t\t\t\t\tselectText(\"google_translate_element\");\r\n\t\t\t\t};\r\n\t\t\t\tdocument.getElementsByClassName(\"goog-te-combo\")[0].classList.add(\"form-control\")\r\n\t\t\t}, 300);\r\n\t\t\tif (navigator.userAgent.indexOf(\"Chrome\") !== -1) {\r\n\t\t\t\tdocument.getElementById(\":0.targetLanguage\").firstChild.style = \"height:21px;\"\r\n\t\t\t}\r\n\r\n\t\t\tfunction selectText(id) {\r\n\t\t\t\tvar sel, range;\r\n\t\t\t\tvar el = document.getElementById(id); //get element id\r\n\t\t\t\tif (window.getSelection && document.createRange) { //Browser compatibility\r\n\t\t\t\tsel = window.getSelection();\r\n\t\t\t\tif (sel.toString() == '') { //no text selection\r\n\t\t\t\t\twindow.setTimeout(function(){\r\n\t\t\t\t\t\trange = document.createRange(); //range object\r\n\t\t\t\t\t\trange.selectNodeContents(el); //sets Range\r\n\t\t\t\t\t\tsel.removeAllRanges(); //remove all ranges from selection\r\n\t\t\t\t\t\tsel.addRange(range);//add Range to a Selection.\r\n\t\t\t\t\t\tdocument.execCommand(\"copy\"); //copy\r\n\t\t\t\t\t\tsel.removeAllRanges(); //remove all ranges from selection\r\n\t\t\t\t\t},1);\r\n\t\t\t\t}\r\n\t\t\t\t} else if (document.selection) { //older ie\r\n\t\t\t\t\tsel = document.selection.createRange();\r\n\t\t\t\t\tif (sel.text == '') { //no text selection\r\n\t\t\t\t\t\trange = document.body.createTextRange();//Creates TextRange object\r\n\t\t\t\t\t\trange.moveToElementText(el);//sets Range\r\n\t\t\t\t\t\trange.select(); //make selection.\r\n\t\t\t\t\t\tdocument.execCommand(\"copy\"); //copy\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.addEventListener('message', function (msg) {\r\n\t\t\tif (typeof(msg.data) === \"object\")\r\n\t\t\t{\r\n\t\t\t\t//event for change theme\r\n\t\t\t\tvar styleTheme = document.createElement('style');\r\n\t\t\t\tstyleTheme.type = 'text/css';\r\n\t\t\t\tstyleTheme.innerHTML = msg.data.style;\r\n\t\t\t\tdocument.getElementsByTagName('head')[0].appendChild(styleTheme);\r\n\t\t\t\tdocument.getElementById(\"google_translate_element\").style.color = msg.data.theme[\"text-normal\"];\r\n\t\t\t\tdocument.getElementsByClassName(\"goog-te-gadget\")[0].style.color = msg.data.theme[\"text-normal\"];\t\t\t\t\r\n\t\t\t}\r\n\t\t\telse if (msg.data === \"update_scroll\")\r\n\t\t\t{\r\n\t\t\t\tsetTimeout(()=> Ps.update(), 600);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (msg.data !== \"onchange_goog-te-combo\") {\r\n\t\t\t\tdocument.getElementById(\"google_translate_element\").innerHTML = escape(msg.data);\r\n\t\t\t\t}\r\n\t\t\t\ttimeOut = setTimeout(function() {\r\n\t\t\t\t\tdocument.getElementById(\"google_translate_element\").style.opacity = 1;\r\n\t\t\t\t\tPs.update();\r\n\t\t\t\t\tif (msg.data.length)\r\n\t\t\t\t\t\tdocument.getElementById(\"div_btn\").classList.remove(\"hidden\");\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdocument.getElementById(\"div_btn\").classList.add(\"hidden\");\r\n\t\t\t\t}, 600);\r\n\t\t\t}\r\n\t\t});\r\n\t</script>\r\n\t<script src=\"vendor/google/google.js\"></script>\r\n<!-- for russian language -->\r\n<!-- <script src=\"http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit\"></script> -->\r\n</body>\r\n</html>", "(function(window, undefined){\r\n\tvar isInit = false;\r\n\tvar ifr;\r\n\tconst isIE = checkInternetExplorer();\t//check IE\r\n\tvar message = \"This plugin doesn't work in Internet Explorer.\"\r\n\t\r\n\twindow.Asc.plugin.init = function(text)\r\n\t{\r\n\t\tif (isIE) {\r\n\t\t\tdocument.getElementById(\"iframe_parent\").innerHTML = \"<h4 id='h4' style='margin:5px'>\" + message + \"</h4>\";\r\n\t\t\treturn;\r\n\t\t}\r\n    \r\n\t  \ttext = ProcessText(text);\r\n\r\n\t\tif (!isInit) {\r\n\t\t\tdocument.getElementById(\"iframe_parent\").innerHTML = \"\";\r\n\t\t\tifr                = document.createElement(\"iframe\");\r\n\t\t\tifr.position\t   = \"fixed\";\r\n\t\t\tifr.name           = \"google_name\";\r\n\t\t\tifr.id             = \"google_id\";\r\n\t\t\tifr.src            = \"./index_widget.html\";//?text=\" + encodeURIComponent(text);\r\n\t\t\tifr.style.top      = \"0px\";\r\n\t\t\tifr.style.left     = \"0px\";\r\n\t\t\tifr.style.width    = \"100%\";\r\n\t\t\tifr.style.height   = \"100%\";\r\n\t\t\tifr.setAttribute(\"frameBorder\", \"0\");\t\t\r\n\t\t\tdocument.getElementById(\"iframe_parent\").appendChild(ifr);\r\n\t\t\tisInit = true;\r\n\t\t\tifr.onload = function() {\r\n\t\t\t\tif (ifr.contentWindow.document.readyState == 'complete')\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tifr.contentDocument.getElementById(\"google_translate_element\").innerHTML = escape(text);\r\n\t\t\t\t\t\tif (text.length)\r\n\t\t\t\t\t\t\tifr.contentDocument.getElementById(\"div_btn\").classList.remove(\"hidden\");\r\n\t\t\t\t\t}, 500);\r\n\t\t\t\t\r\n\t\t\t\tvar selectElement = ifr.contentDocument.getElementsByClassName('goog-te-combo')[0];\r\n\t\t\t\tselectElement.addEventListener('change', function(event) {\r\n\t\t\t\t\tifr.contentWindow.postMessage(\"onchange_goog-te-combo\", '*');\r\n\t\t\t\t\tifr.contentDocument.getElementById(\"google_translate_element\").style.opacity = 0;\r\n\t\t\t\t});\r\n\t\t\t\tifr.contentDocument.getElementById(\"google_translate_element\").style.height = \"fit-content\";\r\n\t\t\t\tvar btn = ifr.contentDocument.createElement(\"button\");\r\n\t\t\t\tvar btnReplace = ifr.contentDocument.createElement(\"button\");\r\n\t\t\t\tvar div = ifr.contentDocument.createElement(\"div\");\r\n\t\t\t\tdiv.appendChild(btn);\r\n\t\t\t\tdiv.appendChild(btnReplace);\r\n\t\t\t\tdiv.id = \"div_btn\";\r\n\t\t\t\tdiv.classList.add(\"skiptranslate\");\r\n\t\t\t\tdiv.classList.add(\"div_btn\");\r\n\t\t\t\tdiv.classList.add(\"hidden\");\r\n\t\t\t\tbtn.innerHTML = window.Asc.plugin.tr(\"Copy\");\r\n\t\t\t\tbtn.id = \"btn_copy\";\r\n\t\t\t\tbtn.classList.add(\"btn-text-default\");\r\n\t\t\t\tbtnReplace.classList.add(\"btn-text-default\");\r\n\t\t\t\tbtnReplace.innerHTML = window.Asc.plugin.tr(\"Replace\");\r\n\t\t\t\tbtnReplace.id = \"btn_replace\";\r\n\t\t\t\tsetTimeout(function() {ifr.contentDocument.getElementById(\"body\").appendChild(div);}, 100);\r\n\r\n\t\t\t\tsetTimeout(function() {\r\n                    btnReplace.onclick = function () {\r\n                        var translatedTxt = ifr.contentDocument.getElementById(\"google_translate_element\").outerText;\r\n                        var allParasTxt = translatedTxt.split(/\\n/);\r\n                        var allParsedParas = [];\r\n\r\n                        for (var nStr = 0; nStr < allParasTxt.length; nStr++) {\r\n                            if (allParasTxt[nStr].search(/\t/) === 0) {\r\n                                allParsedParas.push(\"\");\r\n                                allParasTxt[nStr] = allParasTxt[nStr].replace(/\t/, \"\");\r\n                            }\r\n                            var sSplited = allParasTxt[nStr].split(/\t/);\r\n\r\n                            sSplited.forEach(function(item, i, sSplited) {\r\n                                allParsedParas.push(item);\r\n                            });\r\n                        }\r\n                        Asc.scope.arr = allParsedParas;\r\n                        window.Asc.plugin.executeMethod(\"GetVersion\", [], function(version) {\r\n                            if (version === undefined) {\r\n                                window.Asc.plugin.executeMethod(\"PasteText\", [ifr.contentDocument.getElementById(\"google_translate_element\").outerText]);\r\n                            }\r\n                            else {\r\n                                window.Asc.plugin.executeMethod(\"GetSelectionType\", [], function(sType) {\r\n                                    switch (sType) {\r\n                                        case \"none\":\r\n                                        case \"drawing\":\r\n                                            window.Asc.plugin.executeMethod(\"PasteText\", [ifr.contentDocument.getElementById(\"google_translate_element\").outerText]);\r\n                                            break;\r\n                                        case \"text\":\r\n                                            window.Asc.plugin.callCommand(function() {\r\n                                                Api.ReplaceTextSmart(Asc.scope.arr);\r\n                                            });\r\n                                            break;\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n\t\t\t\tifr.contentWindow.postMessage(\"update_scroll\", '*');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tifr.contentWindow.postMessage(text, '*');\r\n\t\t\tifr.contentDocument.getElementById(\"google_translate_element\").style.opacity = 0;\r\n\t\t}\r\n\t};\r\n\r\n  \tfunction ProcessText(sText) {\r\n        return sText.replace(/\t/gi, '\\n').replace(/\t/gi, '\\n');\r\n    };\r\n\r\n\tfunction checkInternetExplorer(){\r\n\t\tvar rv = -1;\r\n\t\tif (window.navigator.appName == 'Microsoft Internet Explorer') {\r\n\t\t\tconst ua = window.navigator.userAgent;\r\n\t\t\tconst re = new RegExp('MSIE ([0-9]{1,}[\\.0-9]{0,})');\r\n\t\t\tif (re.exec(ua) != null) {\r\n\t\t\t\trv = parseFloat(RegExp.$1);\r\n\t\t\t}\r\n\t\t} else if (window.navigator.appName == 'Netscape') {\r\n\t\t\tconst ua = window.navigator.userAgent;\r\n\t\t\tconst re = new RegExp('Trident/.*rv:([0-9]{1,}[\\.0-9]{0,})');\r\n\r\n\t\t\tif (re.exec(ua) != null) {\r\n\t\t\t\trv = parseFloat(RegExp.$1);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn rv !== -1;\r\n\t};\r\n\r\n\twindow.Asc.plugin.button = function(id)\r\n\t{\r\n\t\tthis.executeCommand(\"close\", \"\");\r\n\t};\r\n\r\n\twindow.onresize = function()\r\n\t{\r\n\t\tifr.contentWindow.postMessage(\"update_scroll\", '*');\r\n\t};\r\n\r\n\twindow.Asc.plugin.onExternalMouseUp = function()\r\n\t{\r\n\t\tvar evt = document.createEvent(\"MouseEvents\");\r\n\t\tevt.initMouseEvent(\"mouseup\", true, true, window, 1, 0, 0, 0, 0,\r\n\t\t\tfalse, false, false, false, 0, null);\r\n\r\n\t\tdocument.dispatchEvent(evt);\r\n\t};\r\n\r\n\twindow.Asc.plugin.onTranslate = function()\r\n\t{\r\n\t\tif (isIE) {\r\n\t\t\tvar field = document.getElementById(\"h4\");\r\n\t\t\tif (field)\r\n\t\t\t\tfield.innerHTML = message = window.Asc.plugin.tr(message);\r\n\t\t}\r\n\t\t\r\n\t};\r\n\r\n\twindow.Asc.plugin.onThemeChanged = function(theme)\r\n\t{\r\n\t\twindow.Asc.plugin.onThemeChangedBase(theme);\r\n\t\tvar style = document.getElementsByTagName('head')[0].lastChild;\r\n\t\tsetTimeout(()=>ifr.contentWindow.postMessage({theme,style : style.innerHTML}, '*'),600);\r\n\t};\r\n\r\n})(window, undefined);\r\n"], "filenames": ["index.html", "index_widget.html", "scripts/translate.js"], "buggy_code_start_loc": [6, 151, 33], "buggy_code_end_loc": [6, 152, 34], "fixing_code_start_loc": [7, 151, 33], "fixing_code_end_loc": [8, 152, 34], "type": "NVD-CWE-noinfo", "message": "The Translate plugin 6.1.x through 6.3.x before 6.3.0.72 for ONLYOFFICE Document Server lacks escape calls for the msg.data and text fields.", "other": {"cve": {"id": "CVE-2021-40864", "sourceIdentifier": "cve@mitre.org", "published": "2021-09-10T19:15:08.267", "lastModified": "2021-09-24T03:05:12.577", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The Translate plugin 6.1.x through 6.3.x before 6.3.0.72 for ONLYOFFICE Document Server lacks escape calls for the msg.data and text fields."}, {"lang": "es", "value": "El plugin Translate versiones 6.1.x hasta 6.3.x anteriores a 6.3.0.72 para ONLYOFFICE Document Server, carece de llamadas de escape para los campos msg.data y text"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "NVD-CWE-noinfo"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:onlyoffice:google_translate:*:*:*:*:*:document_server:*:*", "versionStartIncluding": "6.1.0", "versionEndExcluding": "6.3.0.72", "matchCriteriaId": "C2DE8C9A-CB6B-49C1-84EF-8F8BAE73DFFF"}]}]}], "references": [{"url": "https://github.com/ONLYOFFICE/plugin-translator/commit/2206c0179cb97e3b8b290a0ab5719b1f0f54542b", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/ONLYOFFICE/plugin-translator/compare/v6.3.0.71...v6.3.0.72", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/ONLYOFFICE/plugin-translator/commit/2206c0179cb97e3b8b290a0ab5719b1f0f54542b"}}