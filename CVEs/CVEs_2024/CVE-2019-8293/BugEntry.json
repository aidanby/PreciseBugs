{"buggy_code": ["<?php\r\n    if(isset($_FILES[\"fileUpload\"][\"name\"])){\r\n        $imageFile = ($_FILES[\"fileUpload\"][\"name\"]);\r\n        $imageType = ($_FILES[\"fileUpload\"][\"type\"]);\r\n        $validext = array(\"jpeg\",\"jpg\",\"png\");\r\n        $fileExt = pathinfo($imageFile, PATHINFO_EXTENSION);\r\n        $ready = false;\r\n        if((($imageType == \"image/jpeg\") || ($imageType == \"image/jpg\") || ($imageType == \"image/png\"))&&in_array($fileExt, $validext)){\r\n            $ready = true;\r\n        }else{\r\n            echo \"was not an image<br>\";\r\n        }\r\n\r\n        if($_FILES[\"fileUpload\"][\"size\"] < 1000000){\r\n            $ready = true;\r\n            echo \"file size is \".$_FILES['fileUpload'][\"size\"].\"<br>\";\r\n        }else{\r\n            echo \"file was TOO BIG!\";\r\n        }\r\n\r\n        if($_FILES[\"fileUpload\"][\"error\"]){\r\n            echo \"looks like there was an error\".$_FILES['fileUpload'][\"error\"].\"<br>\";\r\n            $ready = false;\r\n        }\r\n\r\n        $targetPath = \"images/\".$imageFile;\r\n        $sourcePath = $_FILES[\"fileUpload\"][\"tmp_name\"];\r\n        if(file_exists(\"images/\".$imageFile)){\r\n            echo \"File already there <br>\";\r\n            $ready = false;\r\n        }\r\n\r\n        if($ready == true){\r\n            move_uploaded_file($sourcePath,$targetPath);\r\n            echo \"upload successful!\";\r\n        }\r\n    }\r\n?>"], "fixing_code": ["<?php\r\n    if(isset($_FILES[\"fileUpload\"][\"name\"])){\r\n        $imageFile = ($_FILES[\"fileUpload\"][\"name\"]);\r\n        $imageType = ($_FILES[\"fileUpload\"][\"type\"]);\r\n        $validext = array(\"jpeg\",\"jpg\",\"png\");\r\n        $fileExt = pathinfo($imageFile, PATHINFO_EXTENSION);\r\n        $ready = false;\r\n        if((($imageType == \"image/jpeg\") || ($imageType == \"image/jpg\") || ($imageType == \"image/png\"))&&in_array($fileExt, $validext)){\r\n            $ready = true;\r\n        }else{\r\n            echo \"was not an image<br>\";\r\n            exit();\r\n        }\r\n\r\n        if($_FILES[\"fileUpload\"][\"size\"] < 1000000){\r\n            $ready = true;\r\n            echo \"file size is \".$_FILES['fileUpload'][\"size\"].\"<br>\";\r\n        }else{\r\n            echo \"file was TOO BIG!\";\r\n            exit();\r\n        }\r\n\r\n        if($_FILES[\"fileUpload\"][\"error\"]){\r\n            echo \"looks like there was an error\".$_FILES['fileUpload'][\"error\"].\"<br>\";\r\n            $ready = false;\r\n            exit();\r\n        }\r\n\r\n        $targetPath = \"images/\".$imageFile;\r\n        $sourcePath = $_FILES[\"fileUpload\"][\"tmp_name\"];\r\n        if(file_exists(\"images/\".$imageFile)){\r\n            echo \"File already there <br>\";\r\n            $ready = false;\r\n            exit();\r\n        }\r\n\r\n        if($ready == true){\r\n            move_uploaded_file($sourcePath,$targetPath);\r\n            echo \"upload successful!\";\r\n        }\r\n    }\r\n?>"], "filenames": ["upload.php"], "buggy_code_start_loc": [11], "buggy_code_end_loc": [30], "fixing_code_start_loc": [12], "fixing_code_end_loc": [35], "type": "CWE-434", "message": "Due to a logic error in the code, upload-image-with-ajax v1.0 allows arbitrary files to be uploaded to the web root allowing code execution.", "other": {"cve": {"id": "CVE-2019-8293", "sourceIdentifier": "larry0@me.com", "published": "2019-12-23T22:15:11.563", "lastModified": "2020-01-02T16:45:02.360", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Due to a logic error in the code, upload-image-with-ajax v1.0 allows arbitrary files to be uploaded to the web root allowing code execution."}, {"lang": "es", "value": "Debido a un error l\u00f3gico en el c\u00f3digo, upload-image-with-ajax versi\u00f3n v1.0, permite que sean cargados archivos arbitrarios en la web root permitiendo una ejecuci\u00f3n de c\u00f3digo."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-434"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:abcprintf:upload-image-with-ajax:1.0:*:*:*:*:*:*:*", "matchCriteriaId": "1AE083B8-63B8-44F6-89DC-1BA3316CA717"}]}]}], "references": [{"url": "http://www.openwall.com/lists/oss-security/2019/12/23/2", "source": "larry0@me.com", "tags": ["Exploit", "Mailing List", "Third Party Advisory"]}, {"url": "https://github.com/abcprintf/upload-image-with-ajax/commit/71436ba5102010397519d4b25ea57591cfb4974c", "source": "larry0@me.com", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/abcprintf/upload-image-with-ajax/commit/71436ba5102010397519d4b25ea57591cfb4974c"}}