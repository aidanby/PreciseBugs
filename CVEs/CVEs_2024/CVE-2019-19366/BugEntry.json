{"buggy_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tCopyright (C) 2008-2018\n\tAll Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//include\n\tinclude \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists('xml_cdr_search_advanced')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//send the header\n\trequire_once \"resources/header.php\";\n\n//javascript to toggle input/select boxes\n\techo \"<script type='text/javascript'>\";\n\techo \"\tfunction toggle(field) {\";\n\techo \"\t\tif (field == 'source') {\";\n\techo \"\t\t\tdocument.getElementById('caller_extension_uuid').selectedIndex = 0;\";\n\techo \"\t\t\tdocument.getElementById('caller_id_number').value = '';\";\n\techo \"\t\t\t$('#caller_extension_uuid').toggle();\";\n\techo \"\t\t\t$('#caller_id_number').toggle();\";\n\techo \"\t\t\tif ($('#caller_id_number').is(':visible')) { $('#caller_id_number').trigger('focus'); } else { $('#caller_extension_uuid').trigger('focus'); }\";\n\techo \"\t\t}\";\n\techo \"\t}\";\n\techo \"</script>\";\n\n//start the html form\n\tif (strlen(check_str($_GET['redirect'])) > 0) {\n\t\techo \"<form method='get' action='\" . $_GET['redirect'] . \".php'>\\n\";\n\t}\n\telse {\n\t\techo \"<form method='get' action='xml_cdr.php'>\\n\";\n\t}\n\t\n\techo \"<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='30%' nowrap='nowrap' valign='top'><b>Advanced Search</b></td>\\n\";\n\techo \"\t\t<td width='70%' align='right' valign='top'>\";\n\techo \"\t\t\t<input type='button' class='btn' name='' alt='back' onclick=\\\"window.location='xml_cdr.php'\\\" value='Back'>\";\n\techo \"\t\t\t<input type='submit' name='submit' class='btn' value='Search'>\";\n\techo \"\t\t\t<br /><br />\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\t\n\techo \"<table cellpadding='0' cellspacing='0' border='0' width='100%'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' style='vertical-align: top;'>\\n\";\n\t\n\techo \"<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='30%' class='vncell' valign='top' nowrap='nowrap'>\\n\";\n\techo \"\t\t\t\".$text['label-direction'].\"\\n\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t\t<td width='70%' class='vtable' align='left'>\\n\";\n\techo \"\t\t\t<select name='direction' class='formfld'>\\n\";\n\techo \"\t\t\t\t<option value=''></option>\\n\";\n\tif ($direction == \"inbound\") {\n\t\techo \"\t\t\t<option value='inbound' selected='selected'>\".$text['label-inbound'].\"</option>\\n\";\n\t}\n\telse {\n\t\techo \"\t\t\t<option value='inbound'>\".$text['label-inbound'].\"</option>\\n\";\n\t}\n\tif ($direction == \"outbound\") {\n\t\techo \"\t\t\t<option value='outbound' selected='selected'>\".$text['label-outbound'].\"</option>\\n\";\n\t}\n\telse {\n\t\techo \"\t\t\t<option value='outbound'>\".$text['label-outbound'].\"</option>\\n\";\n\t}\n\tif ($direction == \"local\") {\n\t\techo \"\t\t\t<option value='local' selected='selected'>\".$text['label-local'].\"</option>\\n\";\n\t}\n\telse {\n\t\techo \"\t\t\t<option value='local'>\".$text['label-local'].\"</option>\\n\";\n\t}\n\techo \"\t\t\t</select>\\n\";\n\n\tif (permission_exists('xml_cdr_b_leg')){\n\t\techo \"\t\t\t<select name='leg' class='formfld'>\\n\";\n\t\techo \"\t\t\t<option value='' selected='selected'></option>\\n\";\n\t\techo \"\t\t\t<option value='a'>a-leg</option>\\n\";\n\t\techo \"\t\t\t<option value='b'>b-leg</option>\\n\";\n\t\techo \"\t\t\t</select>\\n\";\n\t}\n\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-caller_id_name'].\"</td>\"; //source name\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='caller_id_name' value='\".escape($caller_id_name).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-extension'].\"</td>\"; //source number\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<select class='formfld' name='extension_uuid' id='extension_uuid'>\\n\";\n\techo \"\t\t\t\t<option value=''></option>\";\n\t$sql = \"select extension_uuid, extension, number_alias from v_extensions \";\n\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t$sql .= \"order by extension asc, number_alias asc \";\n\t$parameters['domain_uuid'] = $_SESSION['domain_uuid'];\n\t$database = new database;\n\t$result_e = $database->select($sql, $parameters, 'all');\n\tif (is_array($result_e) && @sizeof($result_e) != 0) {\n\t\tforeach ($result_e as &$row) {\n\t\t\t$selected = ($row['extension_uuid'] == $caller_extension_uuid) ? \"selected\" : null;\n\t\t\techo \"\t\t\t<option value='\".escape($row['extension_uuid']).\"' \".escape($selected).\">\".((is_numeric($row['extension'])) ? escape($row['extension']) : escape($row['number_alias']).\" (\".escape($row['extension']).\")\").\"</option>\";\n\t\t}\n\t}\n\tunset($sql, $parameters, $result_e, $row, $selected);\n\techo \"\t\t\t</select>\\n\";\n\techo \"\t\t\t<input type='text' class='formfld' style='display: none;' name='caller_id_number' id='caller_id_number' value='\".escape($caller_id_number).\"'>\\n\";\n\techo \"\t\t\t<input type='button' id='btn_toggle_source' class='btn' name='' alt='\".$text['button-back'].\"' value='&#9665;' onclick=\\\"toggle('source');\\\">\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-destination'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='destination_number' value='\".escape($destination_number).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-context'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='context' value='\".escape($context).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-start_range'].\"</td>\";\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<div class='row'>\\n\";\n\techo \"\t\t\t\t<div class='col-sm-12'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#start_stamp_begin' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='start_stamp_begin' id='start_stamp_begin' placeholder='\".$text['label-from'].\"' value='\".escape($start_stamp_begin).\"'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#start_stamp_end' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='start_stamp_end' id='start_stamp_end' placeholder='\".$text['label-to'].\"' value='\".escape($start_stamp_end).\"'>\";\n\techo \"\t\t\t\t</div>\\n\";\n\techo \"\t\t\t</div>\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-answer_range'].\"</td>\";\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<div class='row'>\\n\";\n\techo \"\t\t\t\t<div class='col-sm-12'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#answer_stamp_begin' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='answer_stamp_begin' id='answer_stamp_begin' placeholder='\".$text['label-from'].\"' value='\".escape($answer_stamp_begin).\"'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#answer_stamp_end' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='answer_stamp_end' id='answer_stamp_end' placeholder='\".$text['label-to'].\"' value='\".escape($answer_stamp_end).\"'>\";\n\techo \"\t\t\t\t</div>\\n\";\n\techo \"\t\t\t</div>\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-end_range'].\"</td>\";\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<div class='row'>\\n\";\n\techo \"\t\t\t\t<div class='col-sm-12'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#end_stamp_begin' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='end_stamp_begin' id='end_stamp_begin' placeholder='\".$text['label-from'].\"' value='\".escape($end_stamp_begin).\"'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#end_stamp_end' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='end_stamp_end' id='end_stamp_end' placeholder='\".$text['label-to'].\"' value='\".escape($end_stamp_end).\"'>\";\n\techo \"\t\t\t\t</div>\\n\";\n\techo \"\t\t\t</div>\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-duration'].\" (\".$text['label-seconds'].\")</td>\";\n\techo \"\t\t<td class='vtable'>\\n\";\n\techo \"\t\t\t<input type='text' class='formfld' style='min-width: 75px; width: 75px;' name='duration_min' value='\".escape($duration_min).\"' placeholder=\\\"\".$text['label-minimum'].\"\\\">\\n\";\n\techo \"\t\t\t<input type='text' class='formfld' style='min-width: 75px; width: 75px;' name='duration_max' value='\".escape($duration_max).\"' placeholder=\\\"\".$text['label-maximum'].\"\\\">\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\tif (permission_exists('xml_cdr_all')) {\n\t\techo \"\t<tr>\";\n\t\techo \"\t\t<td class='vncell'>\".$text['button-show_all'].\"</td>\";\n\t\techo \"\t\t<td class='vtable'>\\n\";\n\t\tif (permission_exists('xml_cdr_all') && $_REQUEST['showall'] == \"true\") {\n\t\t\techo \"\t\t\t<input type='checkbox' class='formfld' name='showall' checked='checked' value='true'>\";\n\t\t}\n\t\telse {\n\t\t\techo \"\t\t\t<input type='checkbox' class='formfld' name='showall' value='true'>\";\n\t\t}\n\t\techo \"\t\t<td>\";\n\t\techo \"\t</tr>\";\n\t}\n\techo \"</table>\";\n\t\n\techo \"\t\t</td>\";\n\techo \"\t\t<td width='50%' style='vertical-align: top;'>\\n\";\n\t\n\techo \"<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td width='30%' class='vncell'>\".$text['label-billsec'].\"</td>\";\n\techo \"\t\t<td width='70%' class='vtable'><input type='text' class='formfld' name='billsec' value='\".escape($billsec).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-hangup_cause'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='hangup_cause' value='\".escape($hangup_cause).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-uuid'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='xml_cdr_uuid' value='\".escape($xml_cdr_uuid).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-bridge_uuid'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='bleg_uuid' value='\".escape($bridge_uuid).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-accountcode'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='accountcode' value='\".escape($accountcode).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-read_codec'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='read_codec' value='\".escape($read_codec).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-write_codec'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='write_codec' value='\".escape($write_codec).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-remote_media_ip'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='remote_media_ip' value='\".escape($remote_media_ip).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-network_addr'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='network_addr' value='\".escape($network_addr).\"'></td>\";\n\techo \"\t</tr>\";\n\tif (is_array($_SESSION['cdr']['field'])) {\n\t\tforeach ($_SESSION['cdr']['field'] as $field) {\n\t\t\t$array = explode(\",\", $field);\n\t\t\t$field_name = end($array);\n\t\t\t$field_label = ucwords(str_replace(\"_\", \" \", $field_name));\n\t\t\t$field_label = str_replace(\"Sip\", \"SIP\", $field_label);\n\t\t\tif ($field_name != \"destination_number\") {\n\t\t\t\techo \"\t<tr>\";\n\t\t\t\techo \"\t\t<td class='vncell'>\".escape($field_label).\"</td>\";\n\t\t\t\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='\".escape($field_name).\"' value='\".escape($$field_name).\"'></td>\";\n\t\t\t\techo \"\t</tr>\";\n\t\t\t}\n\t\t}\n\t}\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-mos_score'].\"</td>\";\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<select name='mos_comparison' class='formfld'>\\n\";\n\techo \"\t\t\t<option value=''></option>\\n\";\n\techo \"\t\t\t<option value='less'>&lt;</option>\\n\";\n\techo \"\t\t\t<option value='greater'>&gt;</option>\\n\";\n\techo \"\t\t\t<option value='lessorequal'>&lt;&#61;</option>\\n\";\n\techo \"\t\t\t<option value='greaterorequal'>&gt;&#61;</option>\\n\";\n\techo \"\t\t\t<option value='equal'>&#61;</option>\\n\";\n\techo \"\t\t\t<option value='notequal'>&lt;&gt;</option>\\n\";\n\techo \"\t\t\t</select>\\n\";\n\techo \"\t\t\t<input type='text' class='formfld' name='mos_score' value='\".escape($mos_score).\"'>\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\\n\";\n\t\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td colspan='2' align='right'><br>\\n\";\n\techo \"\t\t\t<input type='submit' name='submit' class='btn' value='\".$text['button-search'].\"'>\\n\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\t\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"</table>\";\n\techo \"<br><br>\";\n\t\n\techo \"</form>\";\n\n//include footer\n\trequire_once \"resources/footer.php\";\n\n?>"], "fixing_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tCopyright (C) 2008-2018\n\tAll Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//include\n\tinclude \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists('xml_cdr_search_advanced')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//send the header\n\trequire_once \"resources/header.php\";\n\n//javascript to toggle input/select boxes\n\techo \"<script type='text/javascript'>\";\n\techo \"\tfunction toggle(field) {\";\n\techo \"\t\tif (field == 'source') {\";\n\techo \"\t\t\tdocument.getElementById('caller_extension_uuid').selectedIndex = 0;\";\n\techo \"\t\t\tdocument.getElementById('caller_id_number').value = '';\";\n\techo \"\t\t\t$('#caller_extension_uuid').toggle();\";\n\techo \"\t\t\t$('#caller_id_number').toggle();\";\n\techo \"\t\t\tif ($('#caller_id_number').is(':visible')) { $('#caller_id_number').trigger('focus'); } else { $('#caller_extension_uuid').trigger('focus'); }\";\n\techo \"\t\t}\";\n\techo \"\t}\";\n\techo \"</script>\";\n\n//start the html form\n\tif ($_GET['redirect'] == 'xml_cdr_statistics') {\n\t\techo \"<form method='get' action='xml_cdr_statistics.php'>\\n\";\n\t}\n\telse {\n\t\techo \"<form method='get' action='xml_cdr.php'>\\n\";\n\t}\n\t\n\techo \"<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='30%' nowrap='nowrap' valign='top'><b>Advanced Search</b></td>\\n\";\n\techo \"\t\t<td width='70%' align='right' valign='top'>\";\n\techo \"\t\t\t<input type='button' class='btn' name='' alt='back' onclick=\\\"window.location='xml_cdr.php'\\\" value='Back'>\";\n\techo \"\t\t\t<input type='submit' name='submit' class='btn' value='Search'>\";\n\techo \"\t\t\t<br /><br />\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\t\n\techo \"<table cellpadding='0' cellspacing='0' border='0' width='100%'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' style='vertical-align: top;'>\\n\";\n\t\n\techo \"<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='30%' class='vncell' valign='top' nowrap='nowrap'>\\n\";\n\techo \"\t\t\t\".$text['label-direction'].\"\\n\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t\t<td width='70%' class='vtable' align='left'>\\n\";\n\techo \"\t\t\t<select name='direction' class='formfld'>\\n\";\n\techo \"\t\t\t\t<option value=''></option>\\n\";\n\tif ($direction == \"inbound\") {\n\t\techo \"\t\t\t<option value='inbound' selected='selected'>\".$text['label-inbound'].\"</option>\\n\";\n\t}\n\telse {\n\t\techo \"\t\t\t<option value='inbound'>\".$text['label-inbound'].\"</option>\\n\";\n\t}\n\tif ($direction == \"outbound\") {\n\t\techo \"\t\t\t<option value='outbound' selected='selected'>\".$text['label-outbound'].\"</option>\\n\";\n\t}\n\telse {\n\t\techo \"\t\t\t<option value='outbound'>\".$text['label-outbound'].\"</option>\\n\";\n\t}\n\tif ($direction == \"local\") {\n\t\techo \"\t\t\t<option value='local' selected='selected'>\".$text['label-local'].\"</option>\\n\";\n\t}\n\telse {\n\t\techo \"\t\t\t<option value='local'>\".$text['label-local'].\"</option>\\n\";\n\t}\n\techo \"\t\t\t</select>\\n\";\n\n\tif (permission_exists('xml_cdr_b_leg')){\n\t\techo \"\t\t\t<select name='leg' class='formfld'>\\n\";\n\t\techo \"\t\t\t<option value='' selected='selected'></option>\\n\";\n\t\techo \"\t\t\t<option value='a'>a-leg</option>\\n\";\n\t\techo \"\t\t\t<option value='b'>b-leg</option>\\n\";\n\t\techo \"\t\t\t</select>\\n\";\n\t}\n\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-caller_id_name'].\"</td>\"; //source name\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='caller_id_name' value='\".escape($caller_id_name).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-extension'].\"</td>\"; //source number\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<select class='formfld' name='extension_uuid' id='extension_uuid'>\\n\";\n\techo \"\t\t\t\t<option value=''></option>\";\n\t$sql = \"select extension_uuid, extension, number_alias from v_extensions \";\n\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t$sql .= \"order by extension asc, number_alias asc \";\n\t$parameters['domain_uuid'] = $_SESSION['domain_uuid'];\n\t$database = new database;\n\t$result_e = $database->select($sql, $parameters, 'all');\n\tif (is_array($result_e) && @sizeof($result_e) != 0) {\n\t\tforeach ($result_e as &$row) {\n\t\t\t$selected = ($row['extension_uuid'] == $caller_extension_uuid) ? \"selected\" : null;\n\t\t\techo \"\t\t\t<option value='\".escape($row['extension_uuid']).\"' \".escape($selected).\">\".((is_numeric($row['extension'])) ? escape($row['extension']) : escape($row['number_alias']).\" (\".escape($row['extension']).\")\").\"</option>\";\n\t\t}\n\t}\n\tunset($sql, $parameters, $result_e, $row, $selected);\n\techo \"\t\t\t</select>\\n\";\n\techo \"\t\t\t<input type='text' class='formfld' style='display: none;' name='caller_id_number' id='caller_id_number' value='\".escape($caller_id_number).\"'>\\n\";\n\techo \"\t\t\t<input type='button' id='btn_toggle_source' class='btn' name='' alt='\".$text['button-back'].\"' value='&#9665;' onclick=\\\"toggle('source');\\\">\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-destination'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='destination_number' value='\".escape($destination_number).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-context'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='context' value='\".escape($context).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-start_range'].\"</td>\";\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<div class='row'>\\n\";\n\techo \"\t\t\t\t<div class='col-sm-12'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#start_stamp_begin' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='start_stamp_begin' id='start_stamp_begin' placeholder='\".$text['label-from'].\"' value='\".escape($start_stamp_begin).\"'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#start_stamp_end' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='start_stamp_end' id='start_stamp_end' placeholder='\".$text['label-to'].\"' value='\".escape($start_stamp_end).\"'>\";\n\techo \"\t\t\t\t</div>\\n\";\n\techo \"\t\t\t</div>\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-answer_range'].\"</td>\";\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<div class='row'>\\n\";\n\techo \"\t\t\t\t<div class='col-sm-12'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#answer_stamp_begin' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='answer_stamp_begin' id='answer_stamp_begin' placeholder='\".$text['label-from'].\"' value='\".escape($answer_stamp_begin).\"'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#answer_stamp_end' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='answer_stamp_end' id='answer_stamp_end' placeholder='\".$text['label-to'].\"' value='\".escape($answer_stamp_end).\"'>\";\n\techo \"\t\t\t\t</div>\\n\";\n\techo \"\t\t\t</div>\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-end_range'].\"</td>\";\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<div class='row'>\\n\";\n\techo \"\t\t\t\t<div class='col-sm-12'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#end_stamp_begin' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='end_stamp_begin' id='end_stamp_begin' placeholder='\".$text['label-from'].\"' value='\".escape($end_stamp_begin).\"'>\";\n\techo \"\t\t\t\t\t<input type='text' class='formfld datetimepicker' data-toggle='datetimepicker' data-target='#end_stamp_end' onblur=\\\"$(this).datetimepicker('hide');\\\" style='min-width: 115px; width: 115px;' name='end_stamp_end' id='end_stamp_end' placeholder='\".$text['label-to'].\"' value='\".escape($end_stamp_end).\"'>\";\n\techo \"\t\t\t\t</div>\\n\";\n\techo \"\t\t\t</div>\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-duration'].\" (\".$text['label-seconds'].\")</td>\";\n\techo \"\t\t<td class='vtable'>\\n\";\n\techo \"\t\t\t<input type='text' class='formfld' style='min-width: 75px; width: 75px;' name='duration_min' value='\".escape($duration_min).\"' placeholder=\\\"\".$text['label-minimum'].\"\\\">\\n\";\n\techo \"\t\t\t<input type='text' class='formfld' style='min-width: 75px; width: 75px;' name='duration_max' value='\".escape($duration_max).\"' placeholder=\\\"\".$text['label-maximum'].\"\\\">\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\tif (permission_exists('xml_cdr_all')) {\n\t\techo \"\t<tr>\";\n\t\techo \"\t\t<td class='vncell'>\".$text['button-show_all'].\"</td>\";\n\t\techo \"\t\t<td class='vtable'>\\n\";\n\t\tif (permission_exists('xml_cdr_all') && $_REQUEST['showall'] == \"true\") {\n\t\t\techo \"\t\t\t<input type='checkbox' class='formfld' name='showall' checked='checked' value='true'>\";\n\t\t}\n\t\telse {\n\t\t\techo \"\t\t\t<input type='checkbox' class='formfld' name='showall' value='true'>\";\n\t\t}\n\t\techo \"\t\t<td>\";\n\t\techo \"\t</tr>\";\n\t}\n\techo \"</table>\";\n\t\n\techo \"\t\t</td>\";\n\techo \"\t\t<td width='50%' style='vertical-align: top;'>\\n\";\n\t\n\techo \"<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td width='30%' class='vncell'>\".$text['label-billsec'].\"</td>\";\n\techo \"\t\t<td width='70%' class='vtable'><input type='text' class='formfld' name='billsec' value='\".escape($billsec).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-hangup_cause'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='hangup_cause' value='\".escape($hangup_cause).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-uuid'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='xml_cdr_uuid' value='\".escape($xml_cdr_uuid).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-bridge_uuid'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='bleg_uuid' value='\".escape($bridge_uuid).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-accountcode'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='accountcode' value='\".escape($accountcode).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-read_codec'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='read_codec' value='\".escape($read_codec).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-write_codec'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='write_codec' value='\".escape($write_codec).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-remote_media_ip'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='remote_media_ip' value='\".escape($remote_media_ip).\"'></td>\";\n\techo \"\t</tr>\";\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-network_addr'].\"</td>\";\n\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='network_addr' value='\".escape($network_addr).\"'></td>\";\n\techo \"\t</tr>\";\n\tif (is_array($_SESSION['cdr']['field'])) {\n\t\tforeach ($_SESSION['cdr']['field'] as $field) {\n\t\t\t$array = explode(\",\", $field);\n\t\t\t$field_name = end($array);\n\t\t\t$field_label = ucwords(str_replace(\"_\", \" \", $field_name));\n\t\t\t$field_label = str_replace(\"Sip\", \"SIP\", $field_label);\n\t\t\tif ($field_name != \"destination_number\") {\n\t\t\t\techo \"\t<tr>\";\n\t\t\t\techo \"\t\t<td class='vncell'>\".escape($field_label).\"</td>\";\n\t\t\t\techo \"\t\t<td class='vtable'><input type='text' class='formfld' name='\".escape($field_name).\"' value='\".escape($$field_name).\"'></td>\";\n\t\t\t\techo \"\t</tr>\";\n\t\t\t}\n\t\t}\n\t}\n\techo \"\t<tr>\";\n\techo \"\t\t<td class='vncell'>\".$text['label-mos_score'].\"</td>\";\n\techo \"\t\t<td class='vtable'>\";\n\techo \"\t\t\t<select name='mos_comparison' class='formfld'>\\n\";\n\techo \"\t\t\t<option value=''></option>\\n\";\n\techo \"\t\t\t<option value='less'>&lt;</option>\\n\";\n\techo \"\t\t\t<option value='greater'>&gt;</option>\\n\";\n\techo \"\t\t\t<option value='lessorequal'>&lt;&#61;</option>\\n\";\n\techo \"\t\t\t<option value='greaterorequal'>&gt;&#61;</option>\\n\";\n\techo \"\t\t\t<option value='equal'>&#61;</option>\\n\";\n\techo \"\t\t\t<option value='notequal'>&lt;&gt;</option>\\n\";\n\techo \"\t\t\t</select>\\n\";\n\techo \"\t\t\t<input type='text' class='formfld' name='mos_score' value='\".escape($mos_score).\"'>\\n\";\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\\n\";\n\t\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td colspan='2' align='right'><br>\\n\";\n\techo \"\t\t\t<input type='submit' name='submit' class='btn' value='\".$text['button-search'].\"'>\\n\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\t\n\techo \"\t\t</td>\";\n\techo \"\t</tr>\";\n\techo \"</table>\";\n\techo \"<br><br>\";\n\t\n\techo \"</form>\";\n\n//include footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "filenames": ["app/xml_cdr/xml_cdr_search.php"], "buggy_code_start_loc": [62], "buggy_code_end_loc": [301], "fixing_code_start_loc": [62], "fixing_code_end_loc": [301], "type": "CWE-79", "message": "A cross-site scripting (XSS) vulnerability in app/xml_cdr/xml_cdr_search.php in FusionPBX 4.4.1 allows remote attackers to inject arbitrary web script or HTML via the redirect parameter.", "other": {"cve": {"id": "CVE-2019-19366", "sourceIdentifier": "cve@mitre.org", "published": "2019-11-27T20:15:11.533", "lastModified": "2019-12-04T15:22:35.510", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A cross-site scripting (XSS) vulnerability in app/xml_cdr/xml_cdr_search.php in FusionPBX 4.4.1 allows remote attackers to inject arbitrary web script or HTML via the redirect parameter."}, {"lang": "es", "value": "Una vulnerabilidad de tipo cross-site scripting (XSS) en el archivo app/xml_cdr/xml_cdr_search.php en FusionPBX versi\u00f3n 4.4.1, permite a atacantes remotos inyectar script web o HTML arbitrario por medio del par\u00e1metro redirect."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:4.4.1:*:*:*:*:*:*:*", "matchCriteriaId": "954E2072-AC03-4E55-8A7F-640534279042"}]}]}], "references": [{"url": "https://gist.github.com/xax007/94183b11bdfe579fd860a37e74cd3a8e", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://github.com/fusionpbx/fusionpbx/commit/f3047c83f3022a4780dca95ed7bccbf3a6fa868e", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/f3047c83f3022a4780dca95ed7bccbf3a6fa868e"}}