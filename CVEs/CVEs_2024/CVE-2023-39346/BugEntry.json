{"buggy_code": ["<?php\nputenv('PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games');\nif (isset($_FILES[\"file\"])) {\n    if ($_FILES[\"file\"][\"error\"] > 0)\n        die(\"Error:\" . $_FILES[\"file\"][\"error\"]);\n    $allowedExts = array(\"cpp\", \"c\", \"zip\");\n    $temp = explode(\".\", $_FILES[\"file\"][\"name\"]);\n    $extension = end($temp);\n    if ($_FILES[\"file\"][\"size\"] > 1048576 || !in_array($extension, $allowedExts))\n        die(\"Size transcended the limit or Not acceptable file type!\");\n    $rootDir = dirname(__FILE__);\n    $fileMD5 = md5($_FILES[\"file\"][\"tmp_name\"]);\n    $fileName = $fileMD5;\n    $fullName = $rootDir . \"/tmp/\" . $fileName;\n    $scriptDirName = $rootDir . '/CallGraph.py';\n    move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $fullName . '.' . $extension);\n    $retCode = 1;\n    $message = \"\";\n    $STL = isset($_POST['STL']);\n    $PLT = isset($_POST['PLT']);\n    $igraph = isset($_POST['igraph']);\n    if ($extension != \"zip\") {\n        $command = \"g++ --std=c++17 -S \\\"$fullName.$extension\\\" -o \\\"$fullName.s\\\" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"g++ compiler error!\");\n        }\n        $command = \"callgraph -f \\\"$fullName.s\\\"\" . ($STL?\" --enable-stl \":\"\") . ($PLT?\" --enable-plt \":\"\") . ($igraph?\" -d igraph \":\"\") . \" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"Script execution error!\");\n        }\n        header(\"Location:  tmp/$fileMD5.png\");\n    } else {\n        $command = \"unzip -l \\\"$fullName.zip\\\" | grep php 2>&1\";\n        exec($command,$message,$retCode);\n        if(count($message)){\n            die(\"Don't try to do bad things!\");\n        }\n        $command = \"unzip \\\"$fullName.zip\\\" -d \\\"$fullName\\\" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"unzip error!\");\n        }\n        if (file_exists($fullName . '/main.cpp')) $extension = 'cpp';\n        else if (file_exists($fullName . '/main.c')) $extension = 'c';\n        else die(\"No entrypoint file named main.c/main.cpp! Please check!\");\n        $command = \"g++ --std=c++17 -S \\\"$fullName/main.$extension\\\" -o \\\"$fullName/main.s\\\" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"g++ compiler error!\");\n        }\n        $command = \"callgraph -f \\\"$fullName/main.s\\\"\" . ($STL?\" --enable-stl \":\"\") . ($PLT?\" --enable-plt \":\"\") . ($igraph?\" -d igraph \":\"\") . \" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"Script execution error!\");\n        }\n        header(\"Location:  tmp/$fileMD5/main.png\");\n    }\n}\n?>\n<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\"\n          integrity=\"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\" crossorigin=\"anonymous\">\n    <title>Call Graph Generator</title>\n</head>\n<body>\n<div style=\"text-align: center;\" class=\"container\">\n    <div class=\"alert alert-primary\" role=\"alert\">\n        Call Graph Generator\n    </div>\n    <div class=\"alert alert-secondary\" role=\"alert\">\n        Please submit your .cpp/.c/.zip file.\n        <br>\n        If you have .h or .hpp files customized, rename your ENTRYPOINT .c/.cpp file to main.c/main.cpp and simply pack them with your main code file in ZIP format.\n        <br>\n        File size must be less than 1MB.\n    </div>\n\t<div class=\"alert alert-warning\" role=\"alert\">\n\t\tCompiler Command: g++ --std=c++17 -S main.cpp -o main.s\n\t\t<br>\n\t\tFor security reasons, g++ compiler error log won't show in the result page if your program has a syntax error. Please try with the above command in your local LINUX machine to find out where the error is located and what it is in order to fix it.\n\t\t<br>\n\t\tIf you encountered any problem in the usage, please click the copyright information hyperlink to open an issue. The repo's maintainer is glad to solve your problem.\n\t</div>\n    <form method=\"post\" enctype=\"multipart/form-data\" role=\"form\">\n        <div class=\"checkbox\">\n            <label><input type=\"checkbox\" class=\"form-control\" name=\"STL\">Draw STL Functions</label>\n            <br>\n            <label>(Also Draw Call Graph of functions in C++ Standard Library)</label>\n        </div>\n        <div class=\"checkbox\">\n            <label><input type=\"checkbox\" class=\"form-control\" name=\"PLT\">Draw PLT Functions</label>\n            <br>\n            <label>(Also Draw Call Graph of EXTERNAL functions in PLT (IMPORT TABLE) )</label>\n        </div>\n        <div class=\"checkbox\">\n            <label><input type=\"checkbox\" class=\"form-control\" name=\"igraph\">Use igraph plotter</label>\n            <br>\n            <label>(Check to use python-igraph plotter, default pygraphviz)</label>\n        </div>\n        <input type=\"file\" class=\"form-control\" name=\"file\" id=\"file\">\n        <br>\n        <button type=\"submit\" class=\"btn btn-primary\">Submit</button>\n    </form>\n    <br>\n    <p>Powered by <a href=\"https://github.com/bjrjk/LinuxASMCallGraph\">bjrjk/LinuxASMCallGraph</a></p>\n</div>\n</body>\n</html>\n"], "fixing_code": ["<?php\nputenv('PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games');\nif (isset($_FILES[\"file\"])) {\n    if ($_FILES[\"file\"][\"error\"] > 0)\n        die(\"Error:\" . $_FILES[\"file\"][\"error\"]);\n    $allowedExts = array(\"cpp\", \"c\", \"zip\");\n    $temp = explode(\".\", $_FILES[\"file\"][\"name\"]);\n    $extension = end($temp);\n    if ($_FILES[\"file\"][\"size\"] > 1048576 || !in_array($extension, $allowedExts))\n        die(\"Size transcended the limit or Not acceptable file type!\");\n    $rootDir = dirname(__FILE__);\n    $fileMD5 = md5($_FILES[\"file\"][\"tmp_name\"]);\n    $fileName = $fileMD5;\n    $fullName = $rootDir . \"/tmp/\" . $fileName;\n    $scriptDirName = $rootDir . '/CallGraph.py';\n    move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $fullName . '.' . $extension);\n    $retCode = 1;\n    $message = \"\";\n    $STL = isset($_POST['STL']);\n    $PLT = isset($_POST['PLT']);\n    $igraph = isset($_POST['igraph']);\n    if ($extension != \"zip\") {\n        $command = \"g++ --std=c++17 -S \\\"$fullName.$extension\\\" -o \\\"$fullName.s\\\" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"g++ compiler error!\");\n        }\n        $command = \"callgraph -f \\\"$fullName.s\\\"\" . ($STL?\" --enable-stl \":\"\") . ($PLT?\" --enable-plt \":\"\") . ($igraph?\" -d igraph \":\"\") . \" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"Script execution error!\");\n        }\n        header(\"Location:  tmp/$fileMD5.png\");\n    } else {\n        $command = \"zipinfo \\\"$fullName.zip\\\" | grep -P l[rwx-]{9} 2>&1\";\n        exec($command,$message,$retCode);\n        if(count($message)){\n            die(\"Don't try to do bad! You tricky Linux hacker boy!\");\n        }\n        $command = \"unzip \\\"$fullName.zip\\\" -d \\\"$fullName\\\" | grep -P \\\".php|.htaccess\\\" 2>&1\";\n\t\tif(count($message)){\n            die(\"Don't try to do bad! You tricky web hacker boy!\");\n        }\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"unzip error!\");\n        }\n        if (file_exists($fullName . '/main.cpp')) $extension = 'cpp';\n        else if (file_exists($fullName . '/main.c')) $extension = 'c';\n        else die(\"No entrypoint file named main.c/main.cpp! Please check!\");\n        $command = \"g++ --std=c++17 -S \\\"$fullName/main.$extension\\\" -o \\\"$fullName/main.s\\\" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"g++ compiler error!\");\n        }\n        $command = \"callgraph -f \\\"$fullName/main.s\\\"\" . ($STL?\" --enable-stl \":\"\") . ($PLT?\" --enable-plt \":\"\") . ($igraph?\" -d igraph \":\"\") . \" 2>&1\";\n        exec($command,$message,$retCode);\n        if($retCode != 0){\n            die(\"Script execution error!\");\n        }\n        header(\"Location:  tmp/$fileMD5/main.png\");\n    }\n}\n?>\n<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css\"\n          integrity=\"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh\" crossorigin=\"anonymous\">\n    <title>Call Graph Generator</title>\n</head>\n<body>\n<div style=\"text-align: center;\" class=\"container\">\n    <div class=\"alert alert-primary\" role=\"alert\">\n        Call Graph Generator\n    </div>\n    <div class=\"alert alert-secondary\" role=\"alert\">\n        Please submit your .cpp/.c/.zip file.\n        <br>\n        If you have .h or .hpp files customized, rename your ENTRYPOINT .c/.cpp file to main.c/main.cpp and simply pack them with your main code file in ZIP format.\n        <br>\n        File size must be less than 1MB.\n    </div>\n\t<div class=\"alert alert-warning\" role=\"alert\">\n\t\tCompiler Command: g++ --std=c++17 -S main.cpp -o main.s\n\t\t<br>\n\t\tFor security reasons, g++ compiler error log won't show in the result page if your program has a syntax error. Please try with the above command in your local LINUX machine to find out where the error is located and what it is in order to fix it.\n\t\t<br>\n\t\tIf you encountered any problem in the usage, please click the copyright information hyperlink to open an issue. The repo's maintainer is glad to solve your problem.\n\t</div>\n    <form method=\"post\" enctype=\"multipart/form-data\" role=\"form\">\n        <div class=\"checkbox\">\n            <label><input type=\"checkbox\" class=\"form-control\" name=\"STL\">Draw STL Functions</label>\n            <br>\n            <label>(Also Draw Call Graph of functions in C++ Standard Library)</label>\n        </div>\n        <div class=\"checkbox\">\n            <label><input type=\"checkbox\" class=\"form-control\" name=\"PLT\">Draw PLT Functions</label>\n            <br>\n            <label>(Also Draw Call Graph of EXTERNAL functions in PLT (IMPORT TABLE) )</label>\n        </div>\n        <div class=\"checkbox\">\n            <label><input type=\"checkbox\" class=\"form-control\" name=\"igraph\">Use igraph plotter</label>\n            <br>\n            <label>(Check to use python-igraph plotter, default pygraphviz)</label>\n        </div>\n        <input type=\"file\" class=\"form-control\" name=\"file\" id=\"file\">\n        <br>\n        <button type=\"submit\" class=\"btn btn-primary\">Submit</button>\n    </form>\n    <br>\n    <p>Powered by <a href=\"https://github.com/bjrjk/LinuxASMCallGraph\">bjrjk/LinuxASMCallGraph</a></p>\n</div>\n</body>\n</html>\n"], "filenames": ["web/index.php"], "buggy_code_start_loc": [35], "buggy_code_end_loc": [41], "fixing_code_start_loc": [35], "fixing_code_end_loc": [44], "type": "CWE-434", "message": "LinuxASMCallGraph is software for drawing the call graph of the programming code. Linux ASMCallGraph before commit 20dba06bd1a3cf260612d4f21547c25002121cd5 allows attackers to cause a remote code execution on the server side via uploading a crafted ZIP file due to incorrect filtering rules of uploaded file. The problem has been patched in commit 20dba06bd1a3cf260612d4f21547c25002121cd5. There are no known workarounds.", "other": {"cve": {"id": "CVE-2023-39346", "sourceIdentifier": "security-advisories@github.com", "published": "2023-08-04T21:15:11.107", "lastModified": "2023-08-10T19:09:13.480", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "LinuxASMCallGraph is software for drawing the call graph of the programming code. Linux ASMCallGraph before commit 20dba06bd1a3cf260612d4f21547c25002121cd5 allows attackers to cause a remote code execution on the server side via uploading a crafted ZIP file due to incorrect filtering rules of uploaded file. The problem has been patched in commit 20dba06bd1a3cf260612d4f21547c25002121cd5. There are no known workarounds."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-434"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:renjikai:linuxasmcallgraph:*:*:*:*:*:*:*:*", "versionEndExcluding": "2022-02-08", "matchCriteriaId": "29C88887-094B-411F-B4D7-613B36B933C8"}]}]}], "references": [{"url": "https://github.com/bjrjk/LinuxASMCallGraph/commit/20dba06bd1a3cf260612d4f21547c25002121cd5", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/bjrjk/LinuxASMCallGraph/issues/6", "source": "security-advisories@github.com", "tags": ["Issue Tracking"]}, {"url": "https://github.com/bjrjk/LinuxASMCallGraph/issues/8", "source": "security-advisories@github.com", "tags": ["Issue Tracking"]}, {"url": "https://github.com/bjrjk/LinuxASMCallGraph/security/advisories/GHSA-63c3-r9qm-c2wx", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/bjrjk/LinuxASMCallGraph/commit/20dba06bd1a3cf260612d4f21547c25002121cd5"}}