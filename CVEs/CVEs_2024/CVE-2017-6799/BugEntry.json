{"buggy_code": ["<?php\n# MantisBT - A PHP based bugtracking system\n\n# MantisBT is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 2 of the License, or\n# (at your option) any later version.\n#\n# MantisBT is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with MantisBT.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * View Filters Page\n *\n * @package MantisBT\n * @copyright Copyright 2000 - 2002  Kenzaburo Ito - kenito@300baud.org\n * @copyright Copyright 2002  MantisBT Team - mantisbt-dev@lists.sourceforge.net\n * @link http://www.mantisbt.org\n *\n * @uses core.php\n * @uses access_api.php\n * @uses authentication_api.php\n * @uses compress_api.php\n * @uses config_api.php\n * @uses constant_inc.php\n * @uses current_user_api.php\n * @uses custom_field_api.php\n * @uses filter_api.php\n * @uses filter_constants_inc.php\n * @uses gpc_api.php\n * @uses helper_api.php\n * @uses html_api.php\n * @uses lang_api.php\n * @uses print_api.php\n * @uses string_api.php\n * @uses version_api.php\n */\n\nrequire_once( 'core.php' );\nrequire_api( 'access_api.php' );\nrequire_api( 'authentication_api.php' );\nrequire_api( 'compress_api.php' );\nrequire_api( 'config_api.php' );\nrequire_api( 'constant_inc.php' );\nrequire_api( 'current_user_api.php' );\nrequire_api( 'custom_field_api.php' );\nrequire_api( 'filter_api.php' );\nrequire_api( 'filter_constants_inc.php' );\nrequire_api( 'gpc_api.php' );\nrequire_api( 'helper_api.php' );\nrequire_api( 'html_api.php' );\nrequire_api( 'lang_api.php' );\nrequire_api( 'print_api.php' );\nrequire_api( 'string_api.php' );\nrequire_api( 'version_api.php' );\n\nauth_ensure_user_authenticated();\n\ncompress_enable();\n\nlayout_page_header();\n\nlayout_page_begin();\n\n$f_filter_id = gpc_get( 'filter_id', null );\nif( null === $f_filter_id ) {\n\t$t_filter = current_user_get_bug_filter();\n\t$t_named_filter = false;\n} else {\n\t$c_filter_id = (int)$f_filter_id;\n\t$t_filter_string = filter_db_get_filter( $c_filter_id );\n\tif( !$t_filter_string ) {\n\t\taccess_denied();\n\t} else {\n\t\t$t_filter = filter_deserialize( $t_filter_string );\n\t\t$t_named_filter = true;\n\t\tfilter_cache_row( $c_filter_id );\n\t}\n}\n\n$f_for_screen = gpc_get_bool( 'for_screen', true );\n\n$t_action  = 'view_all_set.php?f=3';\n\nif( $f_for_screen == false ) {\n\t$t_action  = 'view_all_set.php';\n}\n\n$f_static = gpc_get_bool( 'static', false );\n\n$f_view_type = gpc_get_string( 'view_type', $t_filter['_view_type'] );\n$t_filter['_view_type'] = $f_view_type;\n$t_filter = filter_ensure_valid_filter( $t_filter );\n\n?>\n<div class=\"space-10\"></div>\n<div class=\"col-md-12 col-xs-12\">\n\n\t<form method=\"post\" name=\"filters\" id=\"filters_form_open\" class=\"form-control\" action=\"<?php echo $t_action; ?>\">\n\n\t<?php # CSRF protection not required here - form does not result in modifications ?>\n\t<input type=\"hidden\" name=\"type\" value=\"1\" />\n\t<input type=\"hidden\" name=\"view_type\" value=\"<?php echo $f_view_type; ?>\" />\n\t<?php\n\t\tif( $f_for_screen == false ) {\n\t\t\tprint '<input type=\"hidden\" name=\"print\" value=\"1\" />';\n\t\t\tprint '<input type=\"hidden\" name=\"offset\" value=\"0\" />';\n\t\t}\n\t?>\n\n\t\t<div class=\"widget-box widget-color-blue2\">\n\t\t\t<div class=\"widget-header widget-header-small\">\n\t\t\t\t<h4 class=\"widget-title lighter\">\n\t\t\t\t\t<i class=\"ace-icon fa fa-filter\"></i>\n\t\t\t\t\t<?php echo lang_get('filters') ?>\n\t\t\t\t</h4>\n\n\t\t\t\t<div class=\"widget-toolbar\">\n\t\t\t\t\t<div class=\"widget-menu\">\n\t\t\t\t\t\t<a href=\"#\" data-action=\"settings\" data-toggle=\"dropdown\">\n\t\t\t\t\t\t\t<i class=\"ace-icon fa fa-bars bigger-125\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class=\"dropdown-menu dropdown-menu-right dropdown-yellow dropdown-caret dropdown-closer\">\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$t_url = 'view_filters_page.php?static=' . (int)$f_static;\n\t\t\t\t\t\t\t\tif( $t_named_filter ) {\n\t\t\t\t\t\t\t\t\t$t_url .= '&filter_id=' . $f_filter_id;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t$t_url .= '&view_type=';\n\t\t\t\t\t\t\t\tfilter_print_view_type_toggle( $t_url, $t_filter['_view_type'] );\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class=\"widget-body\">\n\t\t\t\t<div class=\"widget-main no-padding\">\n\n\t\t\t\t\t<div class=\"table-responsive\">\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tfilter_form_draw_inputs( $t_filter, $f_for_screen, $f_static );\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"widget-toolbox padding-8 clearfix\">\n\t\t\t\t\t\t<div class=\"btn-toolbar pull-left\">\n\t\t\t\t\t\t\t<div class=\"form-inline\">\n\t\t\t\t\t\t\t\t<label><?php echo lang_get( 'search' ) ?>&nbsp;\n\t\t\t\t\t\t\t\t\t<input type=\"text\" id=\"filter-search-txt\" class=\"input-sm\" size=\"16\"\n\t\t\t\t\t\t\t\t\t\t   name=\"<?php echo FILTER_PROPERTY_SEARCH ?>\"\n\t\t\t\t\t\t\t\t\t\t   value=\"<?php echo string_attribute( $t_filter[FILTER_PROPERTY_SEARCH] ) ?>\">\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"btn-toolbar pull-right\">\n\t\t\t\t\t\t\t<div class=\"form-inline\">\n\t\t\t\t\t\t\t\t<input type=\"submit\" class=\"btn btn-primary btn-sm btn-white btn-round no-float\" name=\"filter\" value=\"<?php echo lang_get( 'use_query' )?>\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</form>\n</div>\n<?php\nlayout_page_end();\n"], "fixing_code": ["<?php\n# MantisBT - A PHP based bugtracking system\n\n# MantisBT is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 2 of the License, or\n# (at your option) any later version.\n#\n# MantisBT is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with MantisBT.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * View Filters Page\n *\n * @package MantisBT\n * @copyright Copyright 2000 - 2002  Kenzaburo Ito - kenito@300baud.org\n * @copyright Copyright 2002  MantisBT Team - mantisbt-dev@lists.sourceforge.net\n * @link http://www.mantisbt.org\n *\n * @uses core.php\n * @uses access_api.php\n * @uses authentication_api.php\n * @uses compress_api.php\n * @uses config_api.php\n * @uses constant_inc.php\n * @uses current_user_api.php\n * @uses custom_field_api.php\n * @uses filter_api.php\n * @uses filter_constants_inc.php\n * @uses gpc_api.php\n * @uses helper_api.php\n * @uses html_api.php\n * @uses lang_api.php\n * @uses print_api.php\n * @uses string_api.php\n * @uses version_api.php\n */\n\nrequire_once( 'core.php' );\nrequire_api( 'access_api.php' );\nrequire_api( 'authentication_api.php' );\nrequire_api( 'compress_api.php' );\nrequire_api( 'config_api.php' );\nrequire_api( 'constant_inc.php' );\nrequire_api( 'current_user_api.php' );\nrequire_api( 'custom_field_api.php' );\nrequire_api( 'filter_api.php' );\nrequire_api( 'filter_constants_inc.php' );\nrequire_api( 'gpc_api.php' );\nrequire_api( 'helper_api.php' );\nrequire_api( 'html_api.php' );\nrequire_api( 'lang_api.php' );\nrequire_api( 'print_api.php' );\nrequire_api( 'string_api.php' );\nrequire_api( 'version_api.php' );\n\nauth_ensure_user_authenticated();\n\ncompress_enable();\n\nlayout_page_header();\n\nlayout_page_begin();\n\n$f_filter_id = gpc_get( 'filter_id', null );\nif( null === $f_filter_id ) {\n\t$t_filter = current_user_get_bug_filter();\n\t$t_named_filter = false;\n} else {\n\t$c_filter_id = (int)$f_filter_id;\n\t$t_filter_string = filter_db_get_filter( $c_filter_id );\n\tif( !$t_filter_string ) {\n\t\taccess_denied();\n\t} else {\n\t\t$t_filter = filter_deserialize( $t_filter_string );\n\t\t$t_named_filter = true;\n\t\tfilter_cache_row( $c_filter_id );\n\t}\n}\n\n$f_for_screen = gpc_get_bool( 'for_screen', true );\n\n$t_action  = 'view_all_set.php?f=3';\n\nif( $f_for_screen == false ) {\n\t$t_action  = 'view_all_set.php';\n}\n\n$f_static = gpc_get_bool( 'static', false );\n\n$f_view_type = gpc_get_string( 'view_type', $t_filter['_view_type'] );\n$t_filter['_view_type'] = $f_view_type;\n$t_filter = filter_ensure_valid_filter( $t_filter );\n\n?>\n<div class=\"space-10\"></div>\n<div class=\"col-md-12 col-xs-12\">\n\n\t<form method=\"post\" name=\"filters\" id=\"filters_form_open\" class=\"form-control\" action=\"<?php echo $t_action; ?>\">\n\n\t<?php # CSRF protection not required here - form does not result in modifications ?>\n\t<input type=\"hidden\" name=\"type\" value=\"1\" />\n\t<input type=\"hidden\" name=\"view_type\" value=\"<?php echo $t_filter['_view_type']; ?>\" />\n\t<?php\n\t\tif( $f_for_screen == false ) {\n\t\t\tprint '<input type=\"hidden\" name=\"print\" value=\"1\" />';\n\t\t\tprint '<input type=\"hidden\" name=\"offset\" value=\"0\" />';\n\t\t}\n\t?>\n\n\t\t<div class=\"widget-box widget-color-blue2\">\n\t\t\t<div class=\"widget-header widget-header-small\">\n\t\t\t\t<h4 class=\"widget-title lighter\">\n\t\t\t\t\t<i class=\"ace-icon fa fa-filter\"></i>\n\t\t\t\t\t<?php echo lang_get('filters') ?>\n\t\t\t\t</h4>\n\n\t\t\t\t<div class=\"widget-toolbar\">\n\t\t\t\t\t<div class=\"widget-menu\">\n\t\t\t\t\t\t<a href=\"#\" data-action=\"settings\" data-toggle=\"dropdown\">\n\t\t\t\t\t\t\t<i class=\"ace-icon fa fa-bars bigger-125\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class=\"dropdown-menu dropdown-menu-right dropdown-yellow dropdown-caret dropdown-closer\">\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\t\t$t_url = 'view_filters_page.php?static=' . (int)$f_static;\n\t\t\t\t\t\t\t\tif( $t_named_filter ) {\n\t\t\t\t\t\t\t\t\t$t_url .= '&filter_id=' . $f_filter_id;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t$t_url .= '&view_type=';\n\t\t\t\t\t\t\t\tfilter_print_view_type_toggle( $t_url, $t_filter['_view_type'] );\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class=\"widget-body\">\n\t\t\t\t<div class=\"widget-main no-padding\">\n\n\t\t\t\t\t<div class=\"table-responsive\">\n\t\t\t\t\t\t\t<?php\n\t\t\t\t\t\t\tfilter_form_draw_inputs( $t_filter, $f_for_screen, $f_static );\n\t\t\t\t\t\t\t?>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"widget-toolbox padding-8 clearfix\">\n\t\t\t\t\t\t<div class=\"btn-toolbar pull-left\">\n\t\t\t\t\t\t\t<div class=\"form-inline\">\n\t\t\t\t\t\t\t\t<label><?php echo lang_get( 'search' ) ?>&nbsp;\n\t\t\t\t\t\t\t\t\t<input type=\"text\" id=\"filter-search-txt\" class=\"input-sm\" size=\"16\"\n\t\t\t\t\t\t\t\t\t\t   name=\"<?php echo FILTER_PROPERTY_SEARCH ?>\"\n\t\t\t\t\t\t\t\t\t\t   value=\"<?php echo string_attribute( $t_filter[FILTER_PROPERTY_SEARCH] ) ?>\">\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"btn-toolbar pull-right\">\n\t\t\t\t\t\t\t<div class=\"form-inline\">\n\t\t\t\t\t\t\t\t<input type=\"submit\" class=\"btn btn-primary btn-sm btn-white btn-round no-float\" name=\"filter\" value=\"<?php echo lang_get( 'use_query' )?>\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</form>\n</div>\n<?php\nlayout_page_end();\n"], "filenames": ["view_filters_page.php"], "buggy_code_start_loc": [108], "buggy_code_end_loc": [109], "fixing_code_start_loc": [108], "fixing_code_end_loc": [109], "type": "CWE-79", "message": "A cross-site scripting (XSS) vulnerability in view_filters_page.php in MantisBT before 2.2.1 allows remote attackers to inject arbitrary JavaScript via the 'view_type' parameter.", "other": {"cve": {"id": "CVE-2017-6799", "sourceIdentifier": "cve@mitre.org", "published": "2017-03-10T10:59:00.483", "lastModified": "2019-03-19T00:37:22.007", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A cross-site scripting (XSS) vulnerability in view_filters_page.php in MantisBT before 2.2.1 allows remote attackers to inject arbitrary JavaScript via the 'view_type' parameter."}, {"lang": "es", "value": "Una vulnerabilidad de XSS en view_filters_page.php en MantisBT en versiones anteriores a 2.2.1 permite a atacantes remotos inyectar c\u00f3digo JavaScript arbitrario a trav\u00e9s del par\u00e1metro 'view_type'."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:mantisbt:mantisbt:*:*:*:*:*:*:*:*", "versionEndIncluding": "2.2.0", "matchCriteriaId": "D9031423-4FC3-40C2-BAF3-93D6E49B0563"}]}]}], "references": [{"url": "http://mantisbt.org/bugs/view.php?id=22497", "source": "cve@mitre.org", "tags": ["Exploit", "Issue Tracking", "Vendor Advisory"]}, {"url": "http://www.openwall.com/lists/oss-security/2017/03/10/1", "source": "cve@mitre.org", "tags": ["Exploit", "Mailing List", "Patch", "Third Party Advisory"]}, {"url": "http://www.securityfocus.com/bid/96819", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/mantisbt/mantisbt/commit/1677251434b6e8b2be8f1d4376a3e78f7be14d95", "source": "cve@mitre.org", "tags": ["Patch"]}]}, "github_commit_url": "https://github.com/mantisbt/mantisbt/commit/1677251434b6e8b2be8f1d4376a3e78f7be14d95"}}