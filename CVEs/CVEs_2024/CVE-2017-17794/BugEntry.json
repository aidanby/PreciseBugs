{"buggy_code": ["<?php\n# *** LICENSE ***\n# This file is part of BlogoText.\n# https://github.com/BlogoText/blogotext/\n#\n# 2006      Frederic Nassar.\n# 2010-2016 Timo Van Neerden.\n# 2016-.... Micka\u00ebl Schoentgen and the community.\n#\n# BlogoText is free software.\n# You can redistribute it under the terms of the MIT / X11 Licence.\n# *** LICENSE ***\n\nrequire_once 'inc/boot.php';\n\n\n/**\n * Check SemVer validity.\n * source: https://github.com/morrisonlevi/SemVer/blob/master/src/League/SemVer/RegexParser.php\n */\nfunction is_valid_version($version)\n{\n    $regex = '/^\n        (?#major)(0|(?:[1-9][0-9]*))\n        \\\\.\n        (?#minor)(0|(?:[1-9][0-9]*))\n        \\\\.\n        (?#patch)(0|(?:[1-9][0-9]*))\n        (?:\n            -\n            (?#pre-release)(\n                (?:(?:0|(?:[1-9][0-9]*))|(?:[0-9]*[a-zA-Z-][a-zA-Z0-9-]*))\n                (?:\n                    \\\\.\n                    (?:(?:0|(?:[1-9][0-9]*))|(?:[0-9]*[a-zA-Z-][a-zA-Z0-9-]*))\n                )*\n            )\n        )?\n        (?:\n            \\\\+\n            (?#build)(\n                [0-9a-zA-Z-]+\n                (?:\\\\.[a-zA-Z0-9-]+)*\n            )\n        )?\n    $/x';\n    return preg_match($regex, $version);\n}\n\n/**\n *\n */\nfunction form_format_date($default)\n{\n    $day = jour_en_lettres(date('d'), date('m'), date('Y'));\n    $month = mois_en_lettres(date('m'));\n    $formats = array (\n        date('d').'/'.date('m').'/'.date('Y'),              // 05/07/2011\n        date('m').'/'.date('d').'/'.date('Y'),              // 07/05/2011\n        date('d').' '.$month.' '.date('Y'),                // 05 juillet 2011\n        $day.' '.date('d').' '.$month.' '.date('Y'),    // mardi 05 juillet 2011\n        $day.' '.date('d').' '.$month,                  // mardi 05 juillet\n        $month.' '.date('d').', '.date('Y'),               // juillet 05, 2011\n        $day.', '.$month.' '.date('d').', '.date('Y'),  // mardi, juillet 05, 2011\n        date('Y').'-'.date('m').'-'.date('d'),              // 2011-07-05\n        substr($day, 0, 3).'. '.date('d').' '.$month,   // ven. 14 janvier\n    );\n    $form = '<label>'.$GLOBALS['lang']['pref_format_date'].'</label>';\n    $form .= '<select name=\"format_date\">';\n    foreach ($formats as $option => $label) {\n        $form .= '<option value=\"'.htmlentities($option).'\"'.(($default == $option) ? ' selected=\"selected\" ' : '').'>'.$label.'</option>';\n    }\n    $form .= '</select>';\n    return $form;\n}\n\n/**\n *\n */\nfunction form_timezone($default)\n{\n    $timezones = timezone_identifiers_list();\n    $timezoneList = array();\n    foreach ($timezones as $tz) {\n        $spos = strpos($tz, '/');\n        if ($spos !== false) {\n            $continent = substr($tz, 0, $spos);\n            $city = substr($tz, $spos + 1);\n            $timezoneList[$continent][] = array('tz_name' => $tz, 'city' => $city);\n        }\n        if ($tz == 'UTC') {\n            $timezoneList['UTC'][] = array('tz_name' => 'UTC', 'city' => 'UTC');\n        }\n    }\n    $form = '<label>'.$GLOBALS['lang']['pref_fuseau_horaire'].'</label>';\n    $form .= '<select name=\"fuseau_horaire\">';\n    foreach ($timezoneList as $continent => $zone) {\n        $form .= '<optgroup label=\"'.ucfirst(strtolower($continent)).'\">';\n        foreach ($zone as $fuseau) {\n            $form .= '<option value=\"'.htmlentities($fuseau['tz_name']).'\"';\n            $form .= ($default == $fuseau['tz_name']) ? ' selected=\"selected\"' : '';\n                $timeOffset = date_offset_get(date_create('now', timezone_open($fuseau['tz_name'])));\n                $timeOffsetFormatted = sprintf(\n                    '(UTC%s%02d:%02d) ',\n                    ($timeOffset < 0) ? '\u2013' : '+',\n                    floor((abs($timeOffset) / 3600)),\n                    floor((abs($timeOffset) % 3600) / 60)\n                );\n            $form .= '>'.$timeOffsetFormatted.' '.htmlentities($fuseau['city']).'</option>';\n        }\n        $form .= '</optgroup>';\n    }\n    $form .= '</select>';\n    return $form;\n}\n\n/**\n *\n */\nfunction form_format_hour($default)\n{\n    $formats = array (\n        date('H:i:s'),    // 23:56:04\n        date('H:i'),      // 23:56\n        date('h:i:s A'),  // 11:56:04 PM\n        date('h:i A'),    // 11:56 PM\n    );\n    $form = '<label>'.$GLOBALS['lang']['pref_format_heure'].'</label>';\n    $form .= '<select name=\"format_heure\">';\n    foreach ($formats as $option => $label) {\n        $form .= '<option value=\"'.htmlentities($option).'\"'.(($default == $option) ? ' selected=\"selected\" ' : '').'>'.htmlentities($label).'</option>';\n    }\n    $form .= '</select>';\n    return $form;\n}\n\n/**\n *\n */\nfunction form_language($default)\n{\n    $form = '<label>'.$GLOBALS['lang']['pref_langue'].'</label>';\n    $form .= '<select name=\"langue\">';\n    foreach ($GLOBALS['langs'] as $option => $label) {\n        $form .= '<option value=\"'.htmlentities($option).'\"'.(($default == $option) ? ' selected=\"selected\" ' : '').'>'.$label.'</option>';\n    }\n    $form .= '</select>';\n    return $form;\n}\n\n/**\n *\n */\nfunction list_themes($path)\n{\n    if ($handler = opendir($path)) {\n        while ($folders = readdir($handler)) {\n            if (is_dir($path.'/'.$folders) && is_file($path.'/'.$folders.'/list.html')) {\n                $themes[$folders] = $folders;\n            }\n        }\n        closedir($handler);\n    }\n    if (isset($themes)) {\n        return $themes;\n    }\n}\n\n/**\n *\n */\nfunction validate_form_preferences()\n{\n    $errors = array();\n    $token = (string)filter_input(INPUT_POST, 'token');\n    $author = (string)filter_input(INPUT_POST, 'auteur');\n    $email = (string)filter_input(INPUT_POST, 'email');\n    $root = (string)filter_input(INPUT_POST, 'racine');\n    $username = (string)filter_input(INPUT_POST, 'identifiant');\n    $password = (string)filter_input(INPUT_POST, 'mdp');\n    $newPassword = (string)filter_input(INPUT_POST, 'mdp_rep');\n\n    if (!check_token($token)) {\n        $errors[] = $GLOBALS['lang']['err_wrong_token'];\n    }\n    if (!strlen(trim($author))) {\n        $errors[] = $GLOBALS['lang']['err_prefs_auteur'];\n    }\n    if ($GLOBALS['require_email'] == 1) {\n        if (!preg_match('#^[\\w.+~\\'*-]+@[\\w.-]+\\.[a-zA-Z]{2,6}$#i', trim($email))) {\n            $errors[] = $GLOBALS['lang']['err_prefs_email'] ;\n        }\n    }\n    if (!preg_match('#^(https?://).*/$#', $root)) {\n        $errors[] = $GLOBALS['lang']['err_prefs_racine_slash'];\n    }\n    if (!strlen(trim($username))) {\n        $errors[] = $GLOBALS['lang']['err_prefs_identifiant'];\n    }\n    if ($username != USER_LOGIN && !strlen($password)) {\n        $errors[] = $GLOBALS['lang']['err_prefs_id_mdp'];\n    }\n    if (preg_match('#[=\\'\"\\\\\\\\|]#iu', $username)) {\n        $errors[] = $GLOBALS['lang']['err_prefs_id_syntaxe'];\n    }\n    if ($password && !password_verify(hash_pass($password, true), USER_PWHASH)) {\n        $errors[] = $GLOBALS['lang']['err_prefs_oldmdp'];\n    }\n    if ($password && strlen($newPassword) < 6) {\n        $errors[] = $GLOBALS['lang']['err_prefs_mdp'];\n    }\n    if (!$newPassword xor !$password) {\n        $errors[] = $GLOBALS['lang']['err_prefs_newmdp'] ;\n    }\n    return $errors;\n}\n\n\n/**\n * v\n */\nfunction display_form_prefs($errors = '')\n{\n    $submitBox = '<div class=\"submit-bttns\">';\n    $submitBox .= hidden_input('_verif_envoi', 1);\n    $submitBox .= hidden_input('token', new_token());\n    $submitBox .= '<button class=\"submit button-cancel\" type=\"button\" onclick=\"annuler(\\'preferences.php\\');\" >'.$GLOBALS['lang']['annuler'].'</button>';\n    $submitBox .= '<button class=\"submit button-submit\" type=\"submit\" name=\"enregistrer\">'.$GLOBALS['lang']['enregistrer'].'</button>';\n    $submitBox .= '</div>';\n\n    echo '<form id=\"preferences\" method=\"post\" action=\"'.basename($_SERVER['SCRIPT_NAME']).'\" >' ;\n        echo erreurs($errors);\n        $fieldsetUser = '<div role=\"group\" class=\"pref\">';\n        $fieldsetUser .= '<div class=\"form-legend\"><legend class=\"legend-user\">'.$GLOBALS['lang']['prefs_legend_utilisateur'].'</legend></div>';\n\n        $fieldsetUser .= '<div class=\"form-lines\">';\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"auteur\">'.$GLOBALS['lang']['pref_auteur'].'</label>';\n        $fieldsetUser .= '<input type=\"text\" id=\"auteur\" name=\"auteur\" size=\"30\" value=\"'.((empty($GLOBALS['auteur'])) ? htmlspecialchars(USER_LOGIN) : $GLOBALS['auteur']).'\" class=\"text\" />';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"email\">'.$GLOBALS['lang']['pref_email'].'</label>';\n        $fieldsetUser .= '<input type=\"text\" id=\"email\" name=\"email\" size=\"30\" value=\"'.$GLOBALS['email'].'\" class=\"text\" />';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"nom_du_site\">'.$GLOBALS['lang']['pref_nom_site'].'</label>';\n        $fieldsetUser .= '<input type=\"text\" id=\"nom_du_site\" name=\"nom_du_site\" size=\"30\" value=\"'.$GLOBALS['nom_du_site'].'\" class=\"text\" />';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"racine\">'.$GLOBALS['lang']['pref_racine'].'</label>';\n        $fieldsetUser .= '<input type=\"text\" id=\"racine\" name=\"racine\" size=\"30\" value=\"'.$GLOBALS['racine'].'\" class=\"text\" />';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"description\">'.$GLOBALS['lang']['label_dp_description'].'</label>';\n        $fieldsetUser .= '<textarea id=\"description\" name=\"description\" cols=\"35\" rows=\"2\" class=\"text\" >'.$GLOBALS['description'].'</textarea>';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"keywords\">'.$GLOBALS['lang']['pref_keywords'].'</label>';\n        $fieldsetUser .= '<textarea id=\"keywords\" name=\"keywords\" cols=\"35\" rows=\"2\" class=\"text\" >'.$GLOBALS['keywords'].'</textarea>';\n        $fieldsetUser .= '</p>';\n        $fieldsetUser .= '</div>';\n\n        $fieldsetUser .= $submitBox;\n\n        $fieldsetUser .= '</div>';\n    echo $fieldsetUser;\n\n        $fieldsetSecurity = '<div role=\"group\" class=\"pref\">';\n        $fieldsetSecurity .= '<div class=\"form-legend\"><legend class=\"legend-securite\">'.$GLOBALS['lang']['prefs_legend_securite'].'</legend></div>';\n\n        $fieldsetSecurity .= '<div class=\"form-lines\">';\n        $fieldsetSecurity .= '<p>';\n        $fieldsetSecurity .= '<label for=\"identifiant\">'.$GLOBALS['lang']['pref_identifiant'].'</label>';\n        $fieldsetSecurity .= '<input type=\"text\" id=\"identifiant\" name=\"identifiant\" size=\"30\" value=\"'.htmlspecialchars(USER_LOGIN).'\" class=\"text\" />';\n        $fieldsetSecurity .= '</p>';\n\n        $fieldsetSecurity .= '<p>';\n        $fieldsetSecurity .= '<label for=\"mdp\">'.$GLOBALS['lang']['pref_mdp'].'</label>';\n        $fieldsetSecurity .= '<input type=\"password\" id=\"mdp\" name=\"mdp\" size=\"30\" value=\"\" class=\"text\" autocomplete=\"off\" />';\n        $fieldsetSecurity .= '</p>';\n\n        $fieldsetSecurity .= '<p>';\n        $fieldsetSecurity .= '<label for=\"mdp_rep\">'.$GLOBALS['lang']['pref_mdp_nouv'].'</label>';\n        $fieldsetSecurity .= '<input type=\"password\" id=\"mdp_rep\" name=\"mdp_rep\" size=\"30\" value=\"\" class=\"text\" autocomplete=\"off\" />';\n        $fieldsetSecurity .= '</p>';\n        $fieldsetSecurity .= '</div>';\n\n        $fieldsetSecurity .= $submitBox;\n\n        $fieldsetSecurity .= '</div>';\n    echo $fieldsetSecurity;\n\n        $fieldsetAppearance = '<div role=\"group\" class=\"pref\">';\n        $fieldsetAppearance .= '<div class=\"form-legend\"><legend class=\"legend-apparence\">'.$GLOBALS['lang']['prefs_legend_apparence'].'</legend></div>';\n\n        $fieldsetAppearance .= '<div class=\"form-lines\">';\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_select('theme_choisi', list_themes(DIR_THEMES), $GLOBALS['theme_choisi'], $GLOBALS['lang']['pref_theme']);\n        $fieldsetAppearance .= '</p>';\n\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_select('max_bill_acceuil', array(5 => 5, 10 => 10, 15 => 15, 20 => 20,  25 => 25, 50 => 50), $GLOBALS['max_bill_acceuil'], $GLOBALS['lang']['pref_nb_maxi']);\n        $fieldsetAppearance .= '</p>';\n\n        $nbs = array(10 => 10, 25 => 25, 50 => 50, 100 => 100, 300 => 300, -1 => $GLOBALS['lang']['pref_all']);\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_select('max_bill_admin', $nbs, $GLOBALS['max_bill_admin'], $GLOBALS['lang']['pref_nb_list']);\n        $fieldsetAppearance .= '</p>';\n\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_select('max_comm_admin', $nbs, $GLOBALS['max_comm_admin'], $GLOBALS['lang']['pref_nb_list_com']);\n        $fieldsetAppearance .= '</p>';\n\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_checkbox('afficher_rss', $GLOBALS['afficher_rss'], $GLOBALS['lang']['pref_afficher_rss']);\n        $fieldsetAppearance .= '</p>';\n\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_checkbox('afficher_liens', $GLOBALS['afficher_liens'], $GLOBALS['lang']['pref_afficher_liens']);\n        $fieldsetAppearance .= '</p>';\n        $fieldsetAppearance .= '</div>';\n\n        $fieldsetAppearance .= $submitBox;\n\n        $fieldsetAppearance .= '</div>';\n    echo $fieldsetAppearance;\n\n        $fieldsetDateHour = '<div role=\"group\" class=\"pref\">';\n        $fieldsetDateHour .= '<div class=\"form-legend\"><legend class=\"legend-dateheure\">'.$GLOBALS['lang']['prefs_legend_langdateheure'].'</legend></div>';\n\n        $fieldsetDateHour .= '<div class=\"form-lines\">';\n        $fieldsetDateHour .= '<p>';\n        $fieldsetDateHour .= form_language($GLOBALS['lang']['id']);\n        $fieldsetDateHour .= '</p>';\n\n        $fieldsetDateHour .= '<p>';\n        $fieldsetDateHour .= form_format_date($GLOBALS['format_date']);\n        $fieldsetDateHour .= '</p>';\n\n        $fieldsetDateHour .= '<p>';\n        $fieldsetDateHour .= form_format_hour($GLOBALS['format_heure']);\n        $fieldsetDateHour .= '</p>';\n\n        $fieldsetDateHour .= '<p>';\n        $fieldsetDateHour .= form_timezone($GLOBALS['fuseau_horaire']);\n        $fieldsetDateHour .= '</p>';\n        $fieldsetDateHour .= '</div>';\n\n        $fieldsetDateHour .= $submitBox;\n\n        $fieldsetDateHour .= '</div>';\n    echo $fieldsetDateHour;\n\n        $fieldsetParameters = '<div role=\"group\" class=\"pref\">';\n        $fieldsetParameters .= '<div class=\"form-legend\"><legend class=\"legend-blogcomm\">'.$GLOBALS['lang']['prefs_legend_configblog'].'</legend></div>';\n\n        $fieldsetParameters .= '<div class=\"form-lines\">';\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('activer_categories', $GLOBALS['activer_categories'], $GLOBALS['lang']['pref_categories']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('auto_keywords', $GLOBALS['automatic_keywords'], $GLOBALS['lang']['pref_automatic_keywords']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('global_comments', $GLOBALS['global_com_rule'], $GLOBALS['lang']['pref_allow_global_coms']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('require_email', $GLOBALS['require_email'], $GLOBALS['lang']['pref_force_email']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('alert_author', $GLOBALS['alert_author'], $GLOBALS['lang']['pref_alert_author']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_select('comm_defaut_status', array($GLOBALS['lang']['pref_comm_white_list'], $GLOBALS['lang']['pref_comm_black_list']), $GLOBALS['comm_defaut_status'], $GLOBALS['lang']['pref_comm_BoW_list']);\n        $fieldsetParameters .= '</p>';\n        $fieldsetParameters .= '</div>';\n\n        $fieldsetParameters .= $submitBox;\n\n        $fieldsetParameters .= '</div>';\n    echo $fieldsetParameters;\n\n    if ($GLOBALS['afficher_liens']) {\n        $fieldsetLinks = '<div role=\"group\" class=\"pref\">';\n        $fieldsetLinks .= '<div class=\"form-legend\"><legend class=\"legend-links\">'.$GLOBALS['lang']['prefs_legend_configlinx'].'</legend></div>';\n\n        $fieldsetLinks .= '<div class=\"form-lines\">';\n        // nb liens c\u00f4t\u00e9 admin\n        $nbs = array(50 => 50, 100 => 100, 200 => 200, 300 => 300, 500 => 500, -1 => $GLOBALS['lang']['pref_all']);\n\n        $fieldsetLinks .= '<p>';\n        $fieldsetLinks .= form_select('nb_list_linx', $nbs, $GLOBALS['nb_list_linx'], $GLOBALS['lang']['pref_nb_list_linx']);\n        $fieldsetLinks .= '</p>';\n\n        // partage de fichiers !pages : t\u00e9l\u00e9charger dans fichiers automatiquement ?\n        $nbs = array($GLOBALS['lang']['non'], $GLOBALS['lang']['oui'], $GLOBALS['lang']['pref_ask_everytime']);\n\n        $fieldsetLinks .= '<p>';\n        $fieldsetLinks .= form_select('dl_link_to_files', $nbs, $GLOBALS['dl_link_to_files'], $GLOBALS['lang']['pref_linx_dl_auto']);\n        $fieldsetLinks .= '</p>';\n\n        // lien \u00e0 glisser sur la barre des favoris\n        $link = explode('/', dirname($_SERVER['SCRIPT_NAME']));\n        $fieldsetLinks .= '<p>';\n        $fieldsetLinks .= '<label>'.$GLOBALS['lang']['pref_label_bookmark_lien'].'</label>';\n        $fieldsetLinks .= '<a class=\"dnd-to-favs\" onclick=\"alert(\\''.$GLOBALS['lang']['pref_label_bookmark_lien'].'\\');return false;\" href=\"javascript:javascript:(function(){window.open(\\''.$GLOBALS['racine'].$link[count($link) - 1].'/links.php?url=\\'+encodeURIComponent(location.href));})();\">Save link</a>';\n        $fieldsetLinks .= '</p>';\n        $fieldsetLinks .= '</div>';\n\n        $fieldsetLinks .= $submitBox;\n\n        $fieldsetLinks .= '</div>';\n        echo $fieldsetLinks;\n    } else {\n        echo hidden_input('nb_list_linx', 50);\n        echo hidden_input('dl_link_to_files', 1);\n    }\n\n    if ($GLOBALS['afficher_rss']) {\n        $fieldsetFeeds = '<div role=\"group\" class=\"pref\">';\n        $fieldsetFeeds .= '<div class=\"form-legend\"><legend class=\"legend-rss\">'.$GLOBALS['lang']['prefs_legend_configrss'].'</legend></div>';\n        $fieldsetFeeds .= '<div class=\"form-lines\">';\n\n        $nbs = array(10 => 10, 25 => 25, 50 => 50, 100 => 100, 300 => 300);\n        $fieldsetFeeds .= '<p>';\n        $fieldsetFeeds .= form_select('max_rss_admin', $nbs, $GLOBALS['max_rss_admin'], $GLOBALS['lang']['pref_nb_list']);\n        $fieldsetFeeds .= '</p>';\n\n        $fieldsetFeeds .= '<p>';\n        $feed = explode('/', dirname($_SERVER['SCRIPT_NAME']));\n        $fieldsetFeeds .= '<label>'.$GLOBALS['lang']['pref_label_crontab_rss'].'</label>';\n        $fieldsetFeeds .= '<a onclick=\"prompt(\\''.$GLOBALS['lang']['pref_alert_crontab_rss'].'\\',\u00a0\\'0 *  *   *   *   wget --spider -qO- '.$GLOBALS['racine'].$feed[count($feed) - 1].'/_rss.ajax.php?guid='.BLOG_UID.'&refresh_all'.'\\');return false;\" href=\"#\">Afficher ligne Cron</a>';\n        $fieldsetFeeds .= '</p>';\n\n        $fieldsetFeeds .= '<p>';\n        $fieldsetFeeds .= '<label>'.$GLOBALS['lang']['pref_rss_go_to_imp-export'].'</label>';\n        $fieldsetFeeds .= '<a href=\"maintenance.php\">'.$GLOBALS['lang']['label_import-export'].'</a>';\n        $fieldsetFeeds .= '</p>';\n\n        $fieldsetFeeds .= '<p>';\n        $fieldsetFeeds .= '</p>';\n\n        $fieldsetFeeds .= '</div>';\n\n        $fieldsetFeeds .= $submitBox;\n        $fieldsetFeeds .= '</div>';\n        echo $fieldsetFeeds;\n    } else {\n        echo hidden_input('max_rss_admin', 10);\n    }\n\n    $fieldsetMaintenance = '<div role=\"group\" class=\"pref\">';\n    $fieldsetMaintenance .= '<div class=\"form-legend\"><legend class=\"legend-sweep\">'.$GLOBALS['lang']['titre_maintenance'].'</legend></div>';\n\n    $fieldsetMaintenance .= '<div class=\"form-lines\">';\n    $fieldsetMaintenance .= '<p>';\n    $fieldsetMaintenance .= form_checkbox('auto_check_updates', $GLOBALS['auto_check_updates'], $GLOBALS['lang']['pref_check_update']);\n    $fieldsetMaintenance .= '</p>';\n\n    $fieldsetMaintenance .= '<p>';\n    $fieldsetMaintenance .= '<label>'.$GLOBALS['lang']['pref_go_to_maintenance'].'</label>';\n    $fieldsetMaintenance .= '<a href=\"maintenance.php\">Maintenance</a>';\n    $fieldsetMaintenance .= '</p>';\n    $fieldsetMaintenance .= '</div>';\n\n    $fieldsetMaintenance .= $submitBox;\n\n    $fieldsetMaintenance .= '</div>';\n    echo $fieldsetMaintenance;\n\n    // Check if a new BlogoText version is available (code from Shaarli, by Sebsauvage).\n    // Get latest version number at most once a day.\n    if ($GLOBALS['auto_check_updates'] == 1) {\n        $versionFile = '../VERSION';\n        if (!is_file($versionFile) or filemtime($versionFile) < time() - 24 * 60 * 60) {\n            $versionHitUrl = 'https://raw.githubusercontent.com/BlogoText/blogotext/master/VERSION';\n            $response = request_external_files(array($versionHitUrl), 6);\n            $version = trim($response[$versionHitUrl]['body']);\n            $lastVersion = (is_valid_version($version)) ? $version : BLOGOTEXT_VERSION;\n            file_put_contents($versionFile, $lastVersion, LOCK_EX);\n        }\n\n        // Compare versions\n        $newestVersion = file_get_contents($versionFile);\n        if (version_compare($newestVersion, BLOGOTEXT_VERSION) == 1) {\n            $fieldsetUpdate = '<div role=\"group\" class=\"pref\">';\n            $fieldsetUpdate .= '<div class=\"form-legend\"><legend class=\"legend-update\">'.$GLOBALS['lang']['maint_chk_update'].'</legend></div>';\n            $fieldsetUpdate .= '<div class=\"form-lines\">';\n            $fieldsetUpdate .= '<p>';\n            $fieldsetUpdate .= '<label>'.$GLOBALS['lang']['maint_update_youisbad'].'</label>';\n            $fieldsetUpdate .= '<b>'.$newestVersion.'</b>';\n            $fieldsetUpdate .= '</p>';\n            $fieldsetUpdate .= '<p>';\n            $fieldsetUpdate .= '<label>'.$GLOBALS['lang']['maint_update_go_dl_it'].'</label>';\n            $fieldsetUpdate .= '<a href=\"'.BLOGOTEXT_SITE.'\">'.parse_url(BLOGOTEXT_SITE, 1).parse_url(BLOGOTEXT_SITE, 5).'</a>';\n            $fieldsetUpdate .= '</p>';\n            $fieldsetUpdate .= '</div>';\n            $fieldsetUpdate .= '</div>';\n            echo $fieldsetUpdate;\n        }\n    }\n\n    echo '</form>';\n}\n\n\n/**\n * process\n */\n\n$errorsForm = array();\n\nif (filter_input(INPUT_POST, '_verif_envoi') !== null) {\n    $errorsForm = validate_form_preferences();\n    if (!$errorsForm) {\n        // devnote : I suppose we take $_POST['mdp_rep'] (alt. $_POST['mdp'])\n        $username = (string)filter_input(INPUT_POST, 'identifiant');\n        $password = (string)filter_input(INPUT_POST, 'mdp_rep');\n        if (auth_write_user_login_file($username, $password) && fichier_prefs()) {\n            redirection(basename($_SERVER['SCRIPT_NAME']).'?msg=confirm_prefs_maj');\n        }\n        $errorsForm[] = $GLOBALS['lang']['err_prefs_write'];\n    }\n}\n\n\n/**\n * echo\n */\n\necho tpl_get_html_head($GLOBALS['lang']['preferences']);\n\n    echo '<div id=\"header\">';\n        echo '<div id=\"top\">';\n        tpl_show_msg();\n        echo tpl_show_topnav($GLOBALS['lang']['preferences']);\n        echo '</div>';\n    echo '</div>';\necho '<div id=\"axe\">';\necho '<div id=\"page\">';\n\ndisplay_form_prefs($errorsForm);\n\necho '<script src=\"style/javascript.js\"></script>';\n\necho tpl_get_footer($begin);\n"], "fixing_code": ["<?php\n# *** LICENSE ***\n# This file is part of BlogoText.\n# https://github.com/BlogoText/blogotext/\n#\n# 2006      Frederic Nassar.\n# 2010-2016 Timo Van Neerden.\n# 2016-.... Micka\u00ebl Schoentgen and the community.\n#\n# BlogoText is free software.\n# You can redistribute it under the terms of the MIT / X11 Licence.\n# *** LICENSE ***\n\nrequire_once 'inc/boot.php';\n\n\n/**\n * Check SemVer validity.\n * source: https://github.com/morrisonlevi/SemVer/blob/master/src/League/SemVer/RegexParser.php\n */\nfunction is_valid_version($version)\n{\n    $regex = '/^\n        (?#major)(0|(?:[1-9][0-9]*))\n        \\\\.\n        (?#minor)(0|(?:[1-9][0-9]*))\n        \\\\.\n        (?#patch)(0|(?:[1-9][0-9]*))\n        (?:\n            -\n            (?#pre-release)(\n                (?:(?:0|(?:[1-9][0-9]*))|(?:[0-9]*[a-zA-Z-][a-zA-Z0-9-]*))\n                (?:\n                    \\\\.\n                    (?:(?:0|(?:[1-9][0-9]*))|(?:[0-9]*[a-zA-Z-][a-zA-Z0-9-]*))\n                )*\n            )\n        )?\n        (?:\n            \\\\+\n            (?#build)(\n                [0-9a-zA-Z-]+\n                (?:\\\\.[a-zA-Z0-9-]+)*\n            )\n        )?\n    $/x';\n    return preg_match($regex, $version);\n}\n\n/**\n *\n */\nfunction form_format_date($default)\n{\n    $day = jour_en_lettres(date('d'), date('m'), date('Y'));\n    $month = mois_en_lettres(date('m'));\n    $formats = array (\n        date('d').'/'.date('m').'/'.date('Y'),              // 05/07/2011\n        date('m').'/'.date('d').'/'.date('Y'),              // 07/05/2011\n        date('d').' '.$month.' '.date('Y'),                // 05 juillet 2011\n        $day.' '.date('d').' '.$month.' '.date('Y'),    // mardi 05 juillet 2011\n        $day.' '.date('d').' '.$month,                  // mardi 05 juillet\n        $month.' '.date('d').', '.date('Y'),               // juillet 05, 2011\n        $day.', '.$month.' '.date('d').', '.date('Y'),  // mardi, juillet 05, 2011\n        date('Y').'-'.date('m').'-'.date('d'),              // 2011-07-05\n        substr($day, 0, 3).'. '.date('d').' '.$month,   // ven. 14 janvier\n    );\n    $form = '<label>'.$GLOBALS['lang']['pref_format_date'].'</label>';\n    $form .= '<select name=\"format_date\">';\n    foreach ($formats as $option => $label) {\n        $form .= '<option value=\"'.htmlentities($option).'\"'.(($default == $option) ? ' selected=\"selected\" ' : '').'>'.$label.'</option>';\n    }\n    $form .= '</select>';\n    return $form;\n}\n\n/**\n *\n */\nfunction form_timezone($default)\n{\n    $timezones = timezone_identifiers_list();\n    $timezoneList = array();\n    foreach ($timezones as $tz) {\n        $spos = strpos($tz, '/');\n        if ($spos !== false) {\n            $continent = substr($tz, 0, $spos);\n            $city = substr($tz, $spos + 1);\n            $timezoneList[$continent][] = array('tz_name' => $tz, 'city' => $city);\n        }\n        if ($tz == 'UTC') {\n            $timezoneList['UTC'][] = array('tz_name' => 'UTC', 'city' => 'UTC');\n        }\n    }\n    $form = '<label>'.$GLOBALS['lang']['pref_fuseau_horaire'].'</label>';\n    $form .= '<select name=\"fuseau_horaire\">';\n    foreach ($timezoneList as $continent => $zone) {\n        $form .= '<optgroup label=\"'.ucfirst(strtolower($continent)).'\">';\n        foreach ($zone as $fuseau) {\n            $form .= '<option value=\"'.htmlentities($fuseau['tz_name']).'\"';\n            $form .= ($default == $fuseau['tz_name']) ? ' selected=\"selected\"' : '';\n                $timeOffset = date_offset_get(date_create('now', timezone_open($fuseau['tz_name'])));\n                $timeOffsetFormatted = sprintf(\n                    '(UTC%s%02d:%02d) ',\n                    ($timeOffset < 0) ? '\u2013' : '+',\n                    floor((abs($timeOffset) / 3600)),\n                    floor((abs($timeOffset) % 3600) / 60)\n                );\n            $form .= '>'.$timeOffsetFormatted.' '.htmlentities($fuseau['city']).'</option>';\n        }\n        $form .= '</optgroup>';\n    }\n    $form .= '</select>';\n    return $form;\n}\n\n/**\n *\n */\nfunction form_format_hour($default)\n{\n    $formats = array (\n        date('H:i:s'),    // 23:56:04\n        date('H:i'),      // 23:56\n        date('h:i:s A'),  // 11:56:04 PM\n        date('h:i A'),    // 11:56 PM\n    );\n    $form = '<label>'.$GLOBALS['lang']['pref_format_heure'].'</label>';\n    $form .= '<select name=\"format_heure\">';\n    foreach ($formats as $option => $label) {\n        $form .= '<option value=\"'.htmlentities($option).'\"'.(($default == $option) ? ' selected=\"selected\" ' : '').'>'.htmlentities($label).'</option>';\n    }\n    $form .= '</select>';\n    return $form;\n}\n\n/**\n *\n */\nfunction form_language($default)\n{\n    $form = '<label>'.$GLOBALS['lang']['pref_langue'].'</label>';\n    $form .= '<select name=\"langue\">';\n    foreach ($GLOBALS['langs'] as $option => $label) {\n        $form .= '<option value=\"'.htmlentities($option).'\"'.(($default == $option) ? ' selected=\"selected\" ' : '').'>'.$label.'</option>';\n    }\n    $form .= '</select>';\n    return $form;\n}\n\n/**\n *\n */\nfunction list_themes($path)\n{\n    if ($handler = opendir($path)) {\n        while ($folders = readdir($handler)) {\n            if (is_dir($path.'/'.$folders) && is_file($path.'/'.$folders.'/list.html')) {\n                $themes[$folders] = $folders;\n            }\n        }\n        closedir($handler);\n    }\n    if (isset($themes)) {\n        return $themes;\n    }\n}\n\n/**\n *\n */\nfunction validate_form_preferences()\n{\n    $errors = array();\n    $token = (string)filter_input(INPUT_POST, 'token');\n    $author = (string)filter_input(INPUT_POST, 'auteur');\n    $email = (string)filter_input(INPUT_POST, 'email', FILTER_VALIDATE_EMAIL);\n    $root = (string)filter_input(INPUT_POST, 'racine');\n    $username = (string)filter_input(INPUT_POST, 'identifiant');\n    $password = (string)filter_input(INPUT_POST, 'mdp');\n    $newPassword = (string)filter_input(INPUT_POST, 'mdp_rep');\n\n    if (!check_token($token)) {\n        $errors[] = $GLOBALS['lang']['err_wrong_token'];\n    }\n    if (!strlen(trim($author))) {\n        $errors[] = $GLOBALS['lang']['err_prefs_auteur'];\n    }\n    // if ($GLOBALS['require_email'] == 1) {\n        if ($email === null || !preg_match('#^[\\w.+~\\'*-]+@[\\w.-]+\\.[a-zA-Z]{2,6}$#i', trim($email))) {\n            $errors[] = $GLOBALS['lang']['err_prefs_email'] ;\n        }\n    // }\n    if (!preg_match('#^(https?://).*/$#', $root)) {\n        $errors[] = $GLOBALS['lang']['err_prefs_racine_slash'];\n    }\n    if (!strlen(trim($username))) {\n        $errors[] = $GLOBALS['lang']['err_prefs_identifiant'];\n    }\n    if ($username != USER_LOGIN && !strlen($password)) {\n        $errors[] = $GLOBALS['lang']['err_prefs_id_mdp'];\n    }\n    if (preg_match('#[=\\'\"\\\\\\\\|]#iu', $username)) {\n        $errors[] = $GLOBALS['lang']['err_prefs_id_syntaxe'];\n    }\n    if ($password && !password_verify(hash_pass($password, true), USER_PWHASH)) {\n        $errors[] = $GLOBALS['lang']['err_prefs_oldmdp'];\n    }\n    if ($password && strlen($newPassword) < 6) {\n        $errors[] = $GLOBALS['lang']['err_prefs_mdp'];\n    }\n    if (!$newPassword xor !$password) {\n        $errors[] = $GLOBALS['lang']['err_prefs_newmdp'] ;\n    }\n    return $errors;\n}\n\n\n/**\n * v\n */\nfunction display_form_prefs($errors = '')\n{\n    $submitBox = '<div class=\"submit-bttns\">';\n    $submitBox .= hidden_input('_verif_envoi', 1);\n    $submitBox .= hidden_input('token', new_token());\n    $submitBox .= '<button class=\"submit button-cancel\" type=\"button\" onclick=\"annuler(\\'preferences.php\\');\" >'.$GLOBALS['lang']['annuler'].'</button>';\n    $submitBox .= '<button class=\"submit button-submit\" type=\"submit\" name=\"enregistrer\">'.$GLOBALS['lang']['enregistrer'].'</button>';\n    $submitBox .= '</div>';\n\n    echo '<form id=\"preferences\" method=\"post\" action=\"'.basename($_SERVER['SCRIPT_NAME']).'\" >' ;\n        echo erreurs($errors);\n        $fieldsetUser = '<div role=\"group\" class=\"pref\">';\n        $fieldsetUser .= '<div class=\"form-legend\"><legend class=\"legend-user\">'.$GLOBALS['lang']['prefs_legend_utilisateur'].'</legend></div>';\n\n        $fieldsetUser .= '<div class=\"form-lines\">';\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"auteur\">'.$GLOBALS['lang']['pref_auteur'].'</label>';\n        $fieldsetUser .= '<input type=\"text\" id=\"auteur\" name=\"auteur\" size=\"30\" value=\"'.((empty($GLOBALS['auteur'])) ? htmlspecialchars(USER_LOGIN) : $GLOBALS['auteur']).'\" class=\"text\" />';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"email\">'.$GLOBALS['lang']['pref_email'].'</label>';\n        $fieldsetUser .= '<input type=\"text\" id=\"email\" name=\"email\" size=\"30\" value=\"'.$GLOBALS['email'].'\" class=\"text\" />';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"nom_du_site\">'.$GLOBALS['lang']['pref_nom_site'].'</label>';\n        $fieldsetUser .= '<input type=\"text\" id=\"nom_du_site\" name=\"nom_du_site\" size=\"30\" value=\"'.$GLOBALS['nom_du_site'].'\" class=\"text\" />';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"racine\">'.$GLOBALS['lang']['pref_racine'].'</label>';\n        $fieldsetUser .= '<input type=\"text\" id=\"racine\" name=\"racine\" size=\"30\" value=\"'.$GLOBALS['racine'].'\" class=\"text\" />';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"description\">'.$GLOBALS['lang']['label_dp_description'].'</label>';\n        $fieldsetUser .= '<textarea id=\"description\" name=\"description\" cols=\"35\" rows=\"2\" class=\"text\" >'.$GLOBALS['description'].'</textarea>';\n        $fieldsetUser .= '</p>';\n\n        $fieldsetUser .= '<p>';\n        $fieldsetUser .= '<label for=\"keywords\">'.$GLOBALS['lang']['pref_keywords'].'</label>';\n        $fieldsetUser .= '<textarea id=\"keywords\" name=\"keywords\" cols=\"35\" rows=\"2\" class=\"text\" >'.$GLOBALS['keywords'].'</textarea>';\n        $fieldsetUser .= '</p>';\n        $fieldsetUser .= '</div>';\n\n        $fieldsetUser .= $submitBox;\n\n        $fieldsetUser .= '</div>';\n    echo $fieldsetUser;\n\n        $fieldsetSecurity = '<div role=\"group\" class=\"pref\">';\n        $fieldsetSecurity .= '<div class=\"form-legend\"><legend class=\"legend-securite\">'.$GLOBALS['lang']['prefs_legend_securite'].'</legend></div>';\n\n        $fieldsetSecurity .= '<div class=\"form-lines\">';\n        $fieldsetSecurity .= '<p>';\n        $fieldsetSecurity .= '<label for=\"identifiant\">'.$GLOBALS['lang']['pref_identifiant'].'</label>';\n        $fieldsetSecurity .= '<input type=\"text\" id=\"identifiant\" name=\"identifiant\" size=\"30\" value=\"'.htmlspecialchars(USER_LOGIN).'\" class=\"text\" />';\n        $fieldsetSecurity .= '</p>';\n\n        $fieldsetSecurity .= '<p>';\n        $fieldsetSecurity .= '<label for=\"mdp\">'.$GLOBALS['lang']['pref_mdp'].'</label>';\n        $fieldsetSecurity .= '<input type=\"password\" id=\"mdp\" name=\"mdp\" size=\"30\" value=\"\" class=\"text\" autocomplete=\"off\" />';\n        $fieldsetSecurity .= '</p>';\n\n        $fieldsetSecurity .= '<p>';\n        $fieldsetSecurity .= '<label for=\"mdp_rep\">'.$GLOBALS['lang']['pref_mdp_nouv'].'</label>';\n        $fieldsetSecurity .= '<input type=\"password\" id=\"mdp_rep\" name=\"mdp_rep\" size=\"30\" value=\"\" class=\"text\" autocomplete=\"off\" />';\n        $fieldsetSecurity .= '</p>';\n        $fieldsetSecurity .= '</div>';\n\n        $fieldsetSecurity .= $submitBox;\n\n        $fieldsetSecurity .= '</div>';\n    echo $fieldsetSecurity;\n\n        $fieldsetAppearance = '<div role=\"group\" class=\"pref\">';\n        $fieldsetAppearance .= '<div class=\"form-legend\"><legend class=\"legend-apparence\">'.$GLOBALS['lang']['prefs_legend_apparence'].'</legend></div>';\n\n        $fieldsetAppearance .= '<div class=\"form-lines\">';\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_select('theme_choisi', list_themes(DIR_THEMES), $GLOBALS['theme_choisi'], $GLOBALS['lang']['pref_theme']);\n        $fieldsetAppearance .= '</p>';\n\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_select('max_bill_acceuil', array(5 => 5, 10 => 10, 15 => 15, 20 => 20,  25 => 25, 50 => 50), $GLOBALS['max_bill_acceuil'], $GLOBALS['lang']['pref_nb_maxi']);\n        $fieldsetAppearance .= '</p>';\n\n        $nbs = array(10 => 10, 25 => 25, 50 => 50, 100 => 100, 300 => 300, -1 => $GLOBALS['lang']['pref_all']);\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_select('max_bill_admin', $nbs, $GLOBALS['max_bill_admin'], $GLOBALS['lang']['pref_nb_list']);\n        $fieldsetAppearance .= '</p>';\n\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_select('max_comm_admin', $nbs, $GLOBALS['max_comm_admin'], $GLOBALS['lang']['pref_nb_list_com']);\n        $fieldsetAppearance .= '</p>';\n\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_checkbox('afficher_rss', $GLOBALS['afficher_rss'], $GLOBALS['lang']['pref_afficher_rss']);\n        $fieldsetAppearance .= '</p>';\n\n        $fieldsetAppearance .= '<p>';\n        $fieldsetAppearance .= form_checkbox('afficher_liens', $GLOBALS['afficher_liens'], $GLOBALS['lang']['pref_afficher_liens']);\n        $fieldsetAppearance .= '</p>';\n        $fieldsetAppearance .= '</div>';\n\n        $fieldsetAppearance .= $submitBox;\n\n        $fieldsetAppearance .= '</div>';\n    echo $fieldsetAppearance;\n\n        $fieldsetDateHour = '<div role=\"group\" class=\"pref\">';\n        $fieldsetDateHour .= '<div class=\"form-legend\"><legend class=\"legend-dateheure\">'.$GLOBALS['lang']['prefs_legend_langdateheure'].'</legend></div>';\n\n        $fieldsetDateHour .= '<div class=\"form-lines\">';\n        $fieldsetDateHour .= '<p>';\n        $fieldsetDateHour .= form_language($GLOBALS['lang']['id']);\n        $fieldsetDateHour .= '</p>';\n\n        $fieldsetDateHour .= '<p>';\n        $fieldsetDateHour .= form_format_date($GLOBALS['format_date']);\n        $fieldsetDateHour .= '</p>';\n\n        $fieldsetDateHour .= '<p>';\n        $fieldsetDateHour .= form_format_hour($GLOBALS['format_heure']);\n        $fieldsetDateHour .= '</p>';\n\n        $fieldsetDateHour .= '<p>';\n        $fieldsetDateHour .= form_timezone($GLOBALS['fuseau_horaire']);\n        $fieldsetDateHour .= '</p>';\n        $fieldsetDateHour .= '</div>';\n\n        $fieldsetDateHour .= $submitBox;\n\n        $fieldsetDateHour .= '</div>';\n    echo $fieldsetDateHour;\n\n        $fieldsetParameters = '<div role=\"group\" class=\"pref\">';\n        $fieldsetParameters .= '<div class=\"form-legend\"><legend class=\"legend-blogcomm\">'.$GLOBALS['lang']['prefs_legend_configblog'].'</legend></div>';\n\n        $fieldsetParameters .= '<div class=\"form-lines\">';\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('activer_categories', $GLOBALS['activer_categories'], $GLOBALS['lang']['pref_categories']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('auto_keywords', $GLOBALS['automatic_keywords'], $GLOBALS['lang']['pref_automatic_keywords']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('global_comments', $GLOBALS['global_com_rule'], $GLOBALS['lang']['pref_allow_global_coms']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('require_email', $GLOBALS['require_email'], $GLOBALS['lang']['pref_force_email']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_checkbox('alert_author', $GLOBALS['alert_author'], $GLOBALS['lang']['pref_alert_author']);\n        $fieldsetParameters .= '</p>';\n\n        $fieldsetParameters .= '<p>';\n        $fieldsetParameters .= form_select('comm_defaut_status', array($GLOBALS['lang']['pref_comm_white_list'], $GLOBALS['lang']['pref_comm_black_list']), $GLOBALS['comm_defaut_status'], $GLOBALS['lang']['pref_comm_BoW_list']);\n        $fieldsetParameters .= '</p>';\n        $fieldsetParameters .= '</div>';\n\n        $fieldsetParameters .= $submitBox;\n\n        $fieldsetParameters .= '</div>';\n    echo $fieldsetParameters;\n\n    if ($GLOBALS['afficher_liens']) {\n        $fieldsetLinks = '<div role=\"group\" class=\"pref\">';\n        $fieldsetLinks .= '<div class=\"form-legend\"><legend class=\"legend-links\">'.$GLOBALS['lang']['prefs_legend_configlinx'].'</legend></div>';\n\n        $fieldsetLinks .= '<div class=\"form-lines\">';\n        // nb liens c\u00f4t\u00e9 admin\n        $nbs = array(50 => 50, 100 => 100, 200 => 200, 300 => 300, 500 => 500, -1 => $GLOBALS['lang']['pref_all']);\n\n        $fieldsetLinks .= '<p>';\n        $fieldsetLinks .= form_select('nb_list_linx', $nbs, $GLOBALS['nb_list_linx'], $GLOBALS['lang']['pref_nb_list_linx']);\n        $fieldsetLinks .= '</p>';\n\n        // partage de fichiers !pages : t\u00e9l\u00e9charger dans fichiers automatiquement ?\n        $nbs = array($GLOBALS['lang']['non'], $GLOBALS['lang']['oui'], $GLOBALS['lang']['pref_ask_everytime']);\n\n        $fieldsetLinks .= '<p>';\n        $fieldsetLinks .= form_select('dl_link_to_files', $nbs, $GLOBALS['dl_link_to_files'], $GLOBALS['lang']['pref_linx_dl_auto']);\n        $fieldsetLinks .= '</p>';\n\n        // lien \u00e0 glisser sur la barre des favoris\n        $link = explode('/', dirname($_SERVER['SCRIPT_NAME']));\n        $fieldsetLinks .= '<p>';\n        $fieldsetLinks .= '<label>'.$GLOBALS['lang']['pref_label_bookmark_lien'].'</label>';\n        $fieldsetLinks .= '<a class=\"dnd-to-favs\" onclick=\"alert(\\''.$GLOBALS['lang']['pref_label_bookmark_lien'].'\\');return false;\" href=\"javascript:javascript:(function(){window.open(\\''.$GLOBALS['racine'].$link[count($link) - 1].'/links.php?url=\\'+encodeURIComponent(location.href));})();\">Save link</a>';\n        $fieldsetLinks .= '</p>';\n        $fieldsetLinks .= '</div>';\n\n        $fieldsetLinks .= $submitBox;\n\n        $fieldsetLinks .= '</div>';\n        echo $fieldsetLinks;\n    } else {\n        echo hidden_input('nb_list_linx', 50);\n        echo hidden_input('dl_link_to_files', 1);\n    }\n\n    if ($GLOBALS['afficher_rss']) {\n        $fieldsetFeeds = '<div role=\"group\" class=\"pref\">';\n        $fieldsetFeeds .= '<div class=\"form-legend\"><legend class=\"legend-rss\">'.$GLOBALS['lang']['prefs_legend_configrss'].'</legend></div>';\n        $fieldsetFeeds .= '<div class=\"form-lines\">';\n\n        $nbs = array(10 => 10, 25 => 25, 50 => 50, 100 => 100, 300 => 300);\n        $fieldsetFeeds .= '<p>';\n        $fieldsetFeeds .= form_select('max_rss_admin', $nbs, $GLOBALS['max_rss_admin'], $GLOBALS['lang']['pref_nb_list']);\n        $fieldsetFeeds .= '</p>';\n\n        $fieldsetFeeds .= '<p>';\n        $feed = explode('/', dirname($_SERVER['SCRIPT_NAME']));\n        $fieldsetFeeds .= '<label>'.$GLOBALS['lang']['pref_label_crontab_rss'].'</label>';\n        $fieldsetFeeds .= '<a onclick=\"prompt(\\''.$GLOBALS['lang']['pref_alert_crontab_rss'].'\\',\u00a0\\'0 *  *   *   *   wget --spider -qO- '.$GLOBALS['racine'].$feed[count($feed) - 1].'/_rss.ajax.php?guid='.BLOG_UID.'&refresh_all'.'\\');return false;\" href=\"#\">Afficher ligne Cron</a>';\n        $fieldsetFeeds .= '</p>';\n\n        $fieldsetFeeds .= '<p>';\n        $fieldsetFeeds .= '<label>'.$GLOBALS['lang']['pref_rss_go_to_imp-export'].'</label>';\n        $fieldsetFeeds .= '<a href=\"maintenance.php\">'.$GLOBALS['lang']['label_import-export'].'</a>';\n        $fieldsetFeeds .= '</p>';\n\n        $fieldsetFeeds .= '<p>';\n        $fieldsetFeeds .= '</p>';\n\n        $fieldsetFeeds .= '</div>';\n\n        $fieldsetFeeds .= $submitBox;\n        $fieldsetFeeds .= '</div>';\n        echo $fieldsetFeeds;\n    } else {\n        echo hidden_input('max_rss_admin', 10);\n    }\n\n    $fieldsetMaintenance = '<div role=\"group\" class=\"pref\">';\n    $fieldsetMaintenance .= '<div class=\"form-legend\"><legend class=\"legend-sweep\">'.$GLOBALS['lang']['titre_maintenance'].'</legend></div>';\n\n    $fieldsetMaintenance .= '<div class=\"form-lines\">';\n    $fieldsetMaintenance .= '<p>';\n    $fieldsetMaintenance .= form_checkbox('auto_check_updates', $GLOBALS['auto_check_updates'], $GLOBALS['lang']['pref_check_update']);\n    $fieldsetMaintenance .= '</p>';\n\n    $fieldsetMaintenance .= '<p>';\n    $fieldsetMaintenance .= '<label>'.$GLOBALS['lang']['pref_go_to_maintenance'].'</label>';\n    $fieldsetMaintenance .= '<a href=\"maintenance.php\">Maintenance</a>';\n    $fieldsetMaintenance .= '</p>';\n    $fieldsetMaintenance .= '</div>';\n\n    $fieldsetMaintenance .= $submitBox;\n\n    $fieldsetMaintenance .= '</div>';\n    echo $fieldsetMaintenance;\n\n    // Check if a new BlogoText version is available (code from Shaarli, by Sebsauvage).\n    // Get latest version number at most once a day.\n    if ($GLOBALS['auto_check_updates'] == 1) {\n        $versionFile = '../VERSION';\n        if (!is_file($versionFile) or filemtime($versionFile) < time() - 24 * 60 * 60) {\n            $versionHitUrl = 'https://raw.githubusercontent.com/BlogoText/blogotext/master/VERSION';\n            $response = request_external_files(array($versionHitUrl), 6);\n            $version = trim($response[$versionHitUrl]['body']);\n            $lastVersion = (is_valid_version($version)) ? $version : BLOGOTEXT_VERSION;\n            file_put_contents($versionFile, $lastVersion, LOCK_EX);\n        }\n\n        // Compare versions\n        $newestVersion = file_get_contents($versionFile);\n        if (version_compare($newestVersion, BLOGOTEXT_VERSION) == 1) {\n            $fieldsetUpdate = '<div role=\"group\" class=\"pref\">';\n            $fieldsetUpdate .= '<div class=\"form-legend\"><legend class=\"legend-update\">'.$GLOBALS['lang']['maint_chk_update'].'</legend></div>';\n            $fieldsetUpdate .= '<div class=\"form-lines\">';\n            $fieldsetUpdate .= '<p>';\n            $fieldsetUpdate .= '<label>'.$GLOBALS['lang']['maint_update_youisbad'].'</label>';\n            $fieldsetUpdate .= '<b>'.$newestVersion.'</b>';\n            $fieldsetUpdate .= '</p>';\n            $fieldsetUpdate .= '<p>';\n            $fieldsetUpdate .= '<label>'.$GLOBALS['lang']['maint_update_go_dl_it'].'</label>';\n            $fieldsetUpdate .= '<a href=\"'.BLOGOTEXT_SITE.'\">'.parse_url(BLOGOTEXT_SITE, 1).parse_url(BLOGOTEXT_SITE, 5).'</a>';\n            $fieldsetUpdate .= '</p>';\n            $fieldsetUpdate .= '</div>';\n            $fieldsetUpdate .= '</div>';\n            echo $fieldsetUpdate;\n        }\n    }\n\n    echo '</form>';\n}\n\n\n/**\n * process\n */\n\n$errorsForm = array();\n\nif (filter_input(INPUT_POST, '_verif_envoi') !== null) {\n    $errorsForm = validate_form_preferences();\n    if (!$errorsForm) {\n        // devnote : I suppose we take $_POST['mdp_rep'] (alt. $_POST['mdp'])\n        $username = (string)filter_input(INPUT_POST, 'identifiant');\n        $password = (string)filter_input(INPUT_POST, 'mdp_rep');\n        if (auth_write_user_login_file($username, $password) && fichier_prefs()) {\n            redirection(basename($_SERVER['SCRIPT_NAME']).'?msg=confirm_prefs_maj');\n        }\n        $errorsForm[] = $GLOBALS['lang']['err_prefs_write'];\n    }\n}\n\n\n/**\n * echo\n */\n\necho tpl_get_html_head($GLOBALS['lang']['preferences']);\n\n    echo '<div id=\"header\">';\n        echo '<div id=\"top\">';\n        tpl_show_msg();\n        echo tpl_show_topnav($GLOBALS['lang']['preferences']);\n        echo '</div>';\n    echo '</div>';\necho '<div id=\"axe\">';\necho '<div id=\"page\">';\n\ndisplay_form_prefs($errorsForm);\n\necho '<script src=\"style/javascript.js\"></script>';\n\necho tpl_get_footer($begin);\n"], "filenames": ["admin/preferences.php"], "buggy_code_start_loc": [177], "buggy_code_end_loc": [194], "fixing_code_start_loc": [177], "fixing_code_end_loc": [194], "type": "NVD-CWE-noinfo", "message": "validate_form_preferences in admin/preferences.php in BlogoText through 3.7.6 allows attackers to bypass intended access restrictions via vectors related to an e-mail address field.", "other": {"cve": {"id": "CVE-2017-17794", "sourceIdentifier": "cve@mitre.org", "published": "2017-12-20T09:29:01.803", "lastModified": "2019-10-03T00:03:26.223", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "validate_form_preferences in admin/preferences.php in BlogoText through 3.7.6 allows attackers to bypass intended access restrictions via vectors related to an e-mail address field."}, {"lang": "es", "value": "validate_form_preferences en admin/preferences.php en BlogoText hasta la versi\u00f3n 3.7.6 permite a los atacantes omitir las restricciones de acceso previstas a trav\u00e9s de vectores relacionados con un campo de direcci\u00f3n de correo electr\u00f3nico."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "NVD-CWE-noinfo"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:blogotext_project:blogotext:*:*:*:*:*:*:*:*", "versionEndIncluding": "3.7.6", "matchCriteriaId": "D0375519-1423-42DC-BFF4-8250FEDDF0E8"}]}]}], "references": [{"url": "https://github.com/BlogoText/blogotext/commit/256041d8cab2fdc50678f4d49d916fea25cdb4fd", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://github.com/BlogoText/blogotext/issues/345", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/BlogoText/blogotext/commit/256041d8cab2fdc50678f4d49d916fea25cdb4fd"}}