{"buggy_code": ["<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n  $query = \"SELECT * FROM domains\n    WHERE domain_id=:domain_id\";\n  $sth = $dbh->prepare($query);\n  $sth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n  if ($sth->rowCount()) { $row = $sth->fetch(); }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminalias.php\"><?php echo _('Manage Aliases'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Forms\">\n      <form name=\"adminadd\" method=\"post\" action=\"adminaliasaddsubmit.php\">\n        <table align=\"center\">\n          <tr>\n            <td><?php echo _('Alias Name'); ?>:</td>\n            <td><input name=\"realname\" type=\"text\" class=\"textfield\" autofocus></td>\n          </tr>\n          <tr>\n            <td><?php echo _('Address'); ?>:</td>\n            <td>\n              <input name=\"localpart\" type=\"text\" class=\"textfield\">@\n              <?php print $_SESSION['domain']; ?>\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"padafter\">\n              <?php echo _('Multiple addresses should be comma separated,\n                with no spaces'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Forward To'); ?>:</td>\n            <td><input name=\"smtp\" type=\"text\" size=\"30\" class=\"textfield\"></td>\n          </tr>\n          <tr>\n            <td><?php echo _('Password'); ?>:</td>\n            <td>\n              <input name=\"clear\" type=\"password\" size=\"30\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"padafter\">\n              (<?php echo _('Password only needed if you want the user to be able\n              to log in, or if the Alias is the admin account'); ?>)\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Verify Password'); ?>:</td>\n            <td>\n              <input name=\"vclear\" type=\"password\" size=\"30\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Admin'); ?>:</td>\n            <td><input name=\"admin\" type=\"checkbox\" class=\"textfield\"></td>\n          </tr>\n          <?php\n            if ($row['avscan'] == \"1\") {\n          ?>\n          <tr>\n            <td><?php echo _('Anti-Virus'); ?>:</td>\n            <td colspan=\"2\"><input name=\"on_avscan\" type=\"checkbox\"></td>\n          </tr>\n          <?php }\n            if ($row['spamassassin'] == \"1\") {\n          ?>\n          <tr>\n            <td><?php echo _('Spamassassin'); ?>:</td>\n            <td colspan=\"2\"><input name=\"on_spamassassin\" type=\"checkbox\"></td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin tag score'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"sa_tag\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $row['sa_tag']; ?>\"></td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin refuse score'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"sa_refuse\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $row['sa_refuse']; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('How to handle mail above the SA refuse score'); ?>:</td>\n            <td>\n             <input type=\"radio\" id=\"off\" name=\"spam_drop\" value=\"0\" checked>\n             <label for=\"off\"> <?PHP echo _('forward Spam mails'); ?></label><br>\n             <input type=\"radio\" id=\"on\" name=\"spam_drop\" value=\"1\">\n             <label for=\"on\"><?PHP echo _('delete Spam mails'); ?></label><br>\n            </td>\n          </tr>\n          <?php } ?>\n          <tr>\n            <td><?php echo _('Enabled'); ?>:</td>\n            <td>\n              <input name=\"enabled\" type=\"checkbox\" class=\"textfield\" checked>\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"button\">\n              <input name=\"submit\" type=\"submit\" value=\"<?php echo _('Submit'); ?>\">\n            </td>\n          </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n\n  if(array_key_exists('confirm', $_GET)) {\n    if ($_GET['confirm'] == '1') {\n      $query = \"DELETE FROM users\n        WHERE user_id=:user_id\n        AND domain_id=:domain_id\n\t    AND (type='alias' OR type='catch')\";\n      $sth = $dbh->prepare($query);\n      $success = $sth->execute(array(':user_id'=>$_GET['user_id'], ':domain_id'=>$_SESSION['domain_id']));\n      if ($success) {\n        header (\"Location: adminalias.php?deleted={$_GET['localpart']}\");\n        die;\n      } else {\n        header (\"Location: adminalias.php?faildeleted={$_GET['localpart']}\");\n        die;\n      }\n    } else if ($_GET['confirm'] == 'cancel') {\n      header (\"Location: adminalias.php?faildeleted={$_GET['localpart']}\");\n      die;\n    }\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Confirm Delete'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n    <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminaliasadd.php\"><?php echo _('Add Alias'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Content\">\n      <form name=\"aliasdelete\" method=\"get\" action=\"adminaliasdelete.php\">\n        <table align=\"center\">\n          <tr>\n            <td colspan=\"2\">\n              <?php printf (_('Please confirm deleting alias %s@%s'),\n                $_GET['localpart'] ,\n                $_SESSION['domain']);\n              ?>:\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='confirm' type='radio' value='cancel' checked>\n              <b><?php printf (_('Do Not Delete %s@%s'),\n                $_GET['localpart'],\n                $_SESSION['domain']);\n              ?></b>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='confirm' type='radio' value='1'>\n              <b><?php printf (_('Delete %s@%s'),\n                $_GET['localpart'],\n                $_SESSION['domain']);\n              ?></b>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='domain' type='hidden'\n                value='<?php echo $_SESSION['domain']; ?>'>\n              <input name='user_id' type='hidden'\n                value='<?php echo $_GET['user_id']; ?>'>\n              <input name='localpart' type='hidden'\n                value='<?php echo $_GET['localpart']; ?>'>\n              <input name='submit' type='submit'\n                value='<?php echo _('Continue'); ?>'>\n            </td>\n          </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminfailadd.php\"><?php echo _('Add Fail'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Content\">\n    <table align=\"center\">\n      <tr>\n        <th>&nbsp;</th>\n        <th><?php echo _('Failed Address'); ?>..</th>\n      </tr>\n      <?php\n        $query = \"SELECT user_id,localpart FROM users\n          WHERE domain_id=:domain_id\n          AND users.type='fail'\n          ORDER BY localpart;\";\n        $sth = $dbh->prepare($query);\n        $sth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n        if ($sth->rowCount()) {\n          while ($row = $sth->fetch()) {\n            print '<tr>'\n              . '<td align=\"center\">'\n              . '<a href=\"adminfaildelete.php?user_id='\n              . $row['user_id']\n              . '&amp;localpart='\n              . $row['localpart']\n              . '\"><img class=\"trash\" src=\"images/trashcan.gif\" title=\"'\n              . _('Delete fail ')\n              . $row['localpart']\n              . '\"></a></td>';\n            print '<td>'\n              . '<a href=\"adminfailchange.php?user_id='\n              . $row['user_id']\n              . '\">'\n              . $row['localpart']\n              . '@'\n              . $_SESSION['domain']\n              . '</a></td>';\n            print '</tr>';\n          }\n        }\n      ?>\n    </table>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n       <a href=\"adminfail.php\"><?php echo _('Manage Fails'); ?></a><br>\n       <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n       <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Forms\">\n      <form name=\"adminadd\" method=\"post\" action=\"adminfailaddsubmit.php\">\n        <table align=\"center\">\n\t  <tr>\n\t    <td><?php echo _('Address to fail'); ?>:</td>\n            <td>\n              <input name=\"localpart\" type=\"text\" class=\"textfield\" autofocus>@\n              <?php print $_SESSION['domain']; ?>\n            </td>\n\t  </tr>\n\t  <tr>\n\t    <td colspan=\"2\" class=\"button\">\n              <input name=\"submit\" type=\"submit\"\n              value=\"<?php echo _('Submit'); ?>\">\n            </td>\n\t  </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n\n  $query = \"SELECT localpart FROM users WHERE user_id=:user_id AND domain_id=:domain_id AND users.type='fail'\";\n  $sth = $dbh->prepare($query);\n  $sth->execute(array(':user_id'=>$_GET['user_id'], ':domain_id'=>$_SESSION['domain_id']));\n  if($sth->rowCount()) {\n      $row = $sth->fetch();\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminfail.php\"><?php echo _('Manage Fails'); ?></a><br>\n      <a href=\"adminfailadd.php\"><?php echo _('Add Fail'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div=\"Forms\">\n\t<?php\n\t\t# ensure this page can only be used to view/edit fail's that already exist for the domain of the admin account\n\t\tif (!$sth->rowCount()) {\n\t\t\techo '<table align=\"center\"><tr><td>';\n\t\t\techo \"Invalid fail userid '\" . htmlentities($_GET['user_id']) . \"' for domain '\" . htmlentities($_SESSION['domain']). \"'\";\n\t\t\techo '</td></tr></table>';\n\t\t}else{\n\t?>\n      <form name=\"failchange\" method=\"post\" action=\"adminfailchangesubmit.php\">\n\t<table align=\"center\">\n\t  <tr>\n            <td><?php echo _('Fail address'); ?>:</td>\n\t    <td>\n              <input name=\"localpart\" type=\"text\"\n                value=\"<?php print $row['localpart']; ?>\" class=\"textfield\" autofocus>@\n              <?php print $_SESSION['domain']; ?>\n            </td>\n\t    <td>\n              <input name=\"user_id\" type=\"hidden\"\n                value=\"<?php print $_GET['user_id']; ?>\" class=\"textfield\">\n            </td>\n          </tr>\n\t  <tr>\n            <td></td>\n            <td>\n              <input name=\"submit\" type=\"submit\"\n                value=\"<?php echo _('Submit'); ?>\">\n            </td>\n          </tr>\n\t</table>\n      </form>\n\t\t<?php\n\t\t\t# end of the block editing a fail within the domain\n\t\t}\n\t\t?>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n?>\n<?php\n  $query = \"SELECT * FROM groups WHERE id=:group_id AND domain_id=:domain_id\";\n  $sth = $dbh->prepare($query);\n  $sth->execute(array(':group_id'=>$_GET['group_id'], ':domain_id'=>$_SESSION['domain_id']));\n  if($sth->rowCount()) {\n    $row = $sth->fetch();\n    $grouplocalpart = $row['name'];\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Edit group'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"admingroup.php\"><?php echo _('Manage Groups'); ?></a><br>\n      <a href=\"admingroupadd.php\"><?php echo _('Add Group'); ?></a></br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Forms\">\n\t<?php\n\t\t# ensure this page can only be used to view/edit aliases that already exist for the domain of the admin account\n\t\tif (!$sth->rowCount()) {\n\t\t\techo '<table align=\"center\"><tr><td>';\n\t\t\techo \"Invalid groupid '\" . htmlentities($_GET['group_id']) . \"' for domain '\" . htmlentities($_SESSION['domain']). \"'\";\n\t\t\techo '</td></tr></table>';\n\t\t}else{\n\t?>\n      <table align=\"center\">\n        <form name=\"groupchange\" method=\"post\"\n          action=\"admingroupchangesubmit.php\">\n        <tr>\n          <td><?php echo _('Group Address'); ?>:</td>\n          <td>\n            <input name=\"localpart\" type=\"text\"\n              value=\"<?php echo $row['name']; ?>\"class=\"textfield\" autofocus>@\n              <?php echo $_SESSION['domain']; ?>\n            <input name=\"group_id\" type=\"hidden\"\n              value=\"<?php echo $_GET['group_id']; ?>\" class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Is public'); ?></td>\n          <td>\n            <input name=\"is_public\" type=\"checkbox\"\n              <?php echo $row['is_public'] == 'Y' ? 'checked' : ''; ?>\n              class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Enabled'); ?></td>\n          <td>\n            <input name=\"enabled\" type=\"checkbox\"\n              <?php echo $row['enabled']=='1' ? 'checked' : ''; ?>\n              class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td colspan=\"2\" class=\"button\">\n            <input name=\"editgroup\" type=\"submit\" value=\"Submit\">\n          </td>\n        </tr>\n        </form>\n        <tr>\n          <td colspan=\"2\">&nbsp;</td>\n        </tr>\n        <tr>\n          <td colspan=\"2\">\n            <?php\n              $query = \"SELECT u.realname, u.localpart, u.enabled, c.member_id\n                FROM users u, group_contents c\n                WHERE u.user_id=c.member_id and c.group_id=:group_id\n                ORDER BY u.enabled desc, u.realname asc\";\n              $sth = $dbh->prepare($query);\n              $sth->execute(array(':group_id'=>$_GET['group_id']));\n              if ($sth->rowCount()) {\n            ?>\n            <table align=\"center\">\n              <tr>\n                <th>&nbsp;</th>\n                <th><?php echo _('Real name'); ?></th>\n                <th><?php echo _('Email Address'); ?></th>\n                <th><?php echo _('Enabled'); ?></th>\n              </tr>\n              <?php\n                while ($row = $sth->fetch()) {\n              ?>\n              <tr>\n                <td class=\"trash\">\n                  <a href=\"admingroupcontentdeletesubmit.php?group_id=<?php echo $_GET['group_id'];\n\t\t\t\t\t?>&member_id=<?php echo $row['member_id'];\n\t\t\t\t\t?>&localpart=<?php echo $grouplocalpart;\n\t\t\t\t\t?>\">\n                    <img class=\"trash\"\n                      title=\"Remove member <?php echo $row['realname']\n                      . ' from group ' . $grouplocalpart; ?>\"\n                      src=\"images/trashcan.gif\" alt=\"trashcan\">\n                  </a>\n                </td>\n                <td><?php echo $row['realname']; ?></td>\n                <td><?php echo $row['localpart'].'@'.$_SESSION['domain']; ?></td>\n                <td>\n                  <?php\n                    if($row['enabled']='1') {\n                  ?>\n                  <img class=\"check\" src=\"images/check.gif\">\n                  <?php\n                    }\n                  ?>\n                </td>\n              </tr>\n              <?php\n                }#while\n              ?>\n            </table>\n            <?php\n              } else {\n                print _('There are no members in this group');\n              }\n            ?>\n          </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\">&nbsp;</td>\n          </tr>\n          <form method=\"post\" action=\"admingroupcontentaddsubmit.php\"\n            name=\"groupcontentadd\">\n          <tr>\n            <td><?php echo _('Add Member'); ?></td>\n            <td>\n              <input name=\"group_id\" type=\"hidden\"\n                value=\"<?php echo $_GET['group_id']; ?>\" class=\"textfield\">\n              <input name=\"localpart\" type=\"hidden\"\n                value=\"<?php echo $grouplocalpart; ?>\" class=\"textfield\">\n              <select name=\"usertoadd\">\n                <option selected value=\"\"></option>\n                <?php\n                  $query = \"SELECT realname, localpart, user_id FROM users\n                    WHERE enabled='1' AND domain_id=:domain_id AND type!='fail'\n                    ORDER BY realname, username, type desc\";\n                  $sth = $dbh->prepare($query);\n                  $sth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n                  while ($row = $sth->fetch()) {\n                ?>\n                  <option value=\"<?php echo $row['user_id'];\n\t\t\t\t\t?>\"><?php echo $row['realname'];\n\t\t\t\t\t?> (<?php echo $row['localpart'].'@'.$_SESSION['domain']; ?>)</option>\n                <?php\n                  }\n                ?>\n              </select>\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"button\">\n              <input name=\"addmember\" type=\"submit\"\n                value=\"<?php echo _('Submit'); ?>\">\n            </td>\n          </tr>\n        </form>\n      </table>\n\t\t<?php\n\t\t\t# end of the block editing a group within the domain\n\t\t}\n\t\t?>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n\n  if(array_key_exists('confirm', $_GET)) {\n    if ($_GET['confirm'] == '1') {\n      # confirm that the user is deleting a group they are permitted to change before going further\n\t  $query = \"SELECT * FROM groups WHERE id=:group_id AND domain_id=:domain_id\";\n      $sth = $dbh->prepare($query);\n      $sth->execute(array(':group_id'=>$_GET['group_id'], ':domain_id'=>$_SESSION['domain_id']));\n\t  if (!$sth->rowCount()) {\n  \t    header (\"Location: admingroup.php?group_faildeleted={$_GET['localpart']}\");\n\t    die();\n\t  }\n\n      # delete group member first\n      $query = \"DELETE FROM group_contents WHERE group_id=:group_id\";\n      $sth = $dbh->prepare($query);\n      $success = $sth->execute(array(':group_id'=>$_GET['group_id']));\n      if ($success) {\n        # delete group\n        $query = \"DELETE FROM groups WHERE id=:group_id AND domain_id=:domain_id\";\n        $sth = $dbh->prepare($query);\n        $success = $sth->execute(array(':group_id'=>$_GET['group_id'], ':domain_id'=>$_SESSION['domain_id']));\n        if ($success) {\n          header (\"Location: admingroup.php?group_deleted={$_GET['localpart']}\");\n          die;\n        } else {\n          header (\"Location: admingroup.php?group_faildeleted={$_GET['localpart']}\");\n          die;\n        }\n      } else {\n        header (\"Location: admingroup.php?group_faildeleted={$_GET['localpart']}\");\n        die;\n      }\n    } else if ($_GET['confirm'] == 'cancel') {\n      header (\"Location: admingroup.php?group_faildeleted={$_GET['localpart']}\");\n      die;\n    }\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Confirm Delete'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n    <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"admingroupadd.php\"><?php echo _('Add Group'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Content\">\n      <form name=\"groupdelete\" method=\"get\" action=\"admingroupdelete.php\">\n        <table align=\"center\">\n          <tr>\n            <td colspan=\"2\">\n              <?php printf (_('Please confirm deleting group %s@%s'),\n                $_GET['localpart'],\n                $_SESSION['domain']);\n              ?>:\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='confirm' type='radio' value='cancel' checked>\n              <b><?php printf (_('Do Not Delete %s@%s'),\n                $_GET['localpart'],\n                $_SESSION['domain']);\n              ?></b>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='confirm' type='radio' value='1'><b>\n              <?php printf (_('Delete %s@%s'),\n                $_GET['localpart'],\n                $_SESSION['domain']);\n              ?></b>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='domain' type='hidden'\n                value='<?php echo $_SESSION['domain']; ?>'>\n              <input name='group_id' type='hidden'\n                value='<?php echo $_GET['group_id']; ?>'>\n              <input name='localpart' type='hidden'\n                value='<?php echo $_GET['localpart']; ?>'>\n              <input name='submit' type='submit'\n                value='<?php echo _('Continue'); ?>'>\n            </td>\n          </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n\n  if (isset($_GET['LETTER'])) {\n    $letter = strtolower($_GET['LETTER']);\n  } else {\n    $letter = '';\n  }\n  if (!isset($_POST['searchfor'])) {\n    $_POST['searchfor'] = '';\n  }\n  if (!isset($_POST['field']) || ($_POST['field'] != 'localpart')) {\n    $_POST['field'] = 'realname';\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminuseradd.php\"><?php echo _('Add User'); ?></a>\n      <?php\n        $query = \"SELECT count(users.user_id)\n          AS used, max_accounts\n          FROM domains,users\n          WHERE users.domain_id=:domain_id\n          AND domains.domain_id=users.domain_id\n          AND (users.type='local' OR users.type='piped')\n          GROUP BY max_accounts\";\n        $sth = $dbh->prepare($query);\n        $sth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n        $row = $sth->fetch();\n        if (($sth->rowCount()) && $row['max_accounts']) {\n          printf(_(\"(%d of %d)\"), $row['used'], $row['max_accounts']);\n        }\n      ?>\n      <br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Content\">\n      <?php\n        alpha_menu($alphausers)\n      ?>\n      <form name=\"search\" method=\"post\" action=\"adminuser.php\">\n        <?php echo _('Search'); ?>:\n        <input type=\"text\" size=\"20\" name=\"searchfor\"\n          value=\"<?php echo $_POST['searchfor']; ?>\" class=\"textfield\">\n        <?php echo _('in'); ?>\n        <select name=\"field\" class=\"textfield\">\n          <option value=\"realname\" <?php if ($_POST['field'] == 'realname') {\n            echo 'selected=\"selected\"';\n          } ?>><?php echo _('User'); ?></option>\n          <option value=\"localpart\" <?php if ($_POST['field'] == 'localpart') {\n            echo \"selected=\\\"selected\\\"\";\n          } ?>><?php echo _('Email address'); ?></option>\n        </select>\n        <input type=\"submit\" name=\"search\" value=\"<?php echo _('search'); ?>\">\n      </form>\n      <table>\n        <tr>\n          <th>&nbsp;</th>\n          <th><?php echo _('User'); ?></th>\n          <th><?php echo _('Email address'); ?></th>\n          <th><?php echo _('Admin'); ?></th>\n        </tr>\n        <?php\n        $query = \"SELECT user_id, localpart, realname, admin, enabled\n          FROM users\n          WHERE domain_id=:domain_id\n          AND  (type = 'local' OR type= 'piped')\";\n        $queryParams=array(':domain_id'=>$_SESSION['domain_id']);\n        if ($alphausers AND $letter != '') {\n          $query .= \" AND lower(localpart) LIKE lower(:letter)\";\n          $queryParams[':letter'] = $letter.'%';\n        } elseif ($_POST['searchfor'] != '') {\n          $query .= ' AND ' . $dbh->quote($_POST['field']) .  ' LIKE :searchfor';\n          $queryParams[':searchfor'] = '%'.$_POST['searchfor'].'%';\n        }\n        $query .= ' ORDER BY realname, localpart';\n        $sth = $dbh->prepare($query);\n        $sth->execute($queryParams);\n        while ($row = $sth->fetch()) {\n          if($row['enabled']===\"0\") print '<tr class=\"disabled\">'; else print '<tr>';\n          print '<td class=\"trash\"><a href=\"adminuserdelete.php?user_id='\n            . $row['user_id']\n            . '&amp;localpart='\n            . $row['localpart']\n            . '\">';\n          print '<img class=\"trash\" title=\"Delete '\n            . $row['realname']\n            . '\" src=\"images/trashcan.gif\" alt=\"trashcan\"></a></td>';\n          print '<td><a href=\"adminuserchange.php?user_id=' . $row['user_id']\n            . '&amp;localpart=' . $row['localpart']\n            . '\" title=\"' . _('Click to modify')\n            . ' '\n            . $row['realname']\n            . '\">'\n            . $row['realname']\n            . '</a></td>';\n          print '<td><a href=\"adminuserchange.php?user_id=' . $row['user_id']\n            . '&amp;localpart=' . $row['localpart']\n            . '\" title=\"' . _('Click to modify')\n            . ' '\n            . $row['realname']\n            . '\">'\n            . $row['localpart'] .'@'. $_SESSION['domain']\n            . '</a></td>';\n          print '<td class=\"check\">';\n          if ($row['admin'] == 1) {\n            print  '<img class=\"check\" src=\"images/check.gif\" title=\"'\n            . $row['realname']\n            . _(' is an administrator')\n            . '\">';\n          }\n          print \"</td></tr>\\n\";\n        }\n        ?>\n      </table>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n\n  $query = \"SELECT * FROM users WHERE user_id=:user_id\n\t\tAND domain_id=:domain_id\n\t\tAND (type='local' OR type='piped')\";\n  $sth = $dbh->prepare($query);\n  $sth->execute(array(':user_id'=>$_GET['user_id'], ':domain_id'=>$_SESSION['domain_id']));\n  if ($sth->rowCount()) { $row = $sth->fetch(); }\n  \n  $username = $row['username'];\n  $domquery = \"SELECT avscan,spamassassin,quotas,pipe FROM domains\n    WHERE domain_id=:domain_id\";\n  $domsth = $dbh->prepare($domquery);\n  $domsth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n  if ($domsth->rowCount()) {\n    $domrow = $domsth->fetch();\n  }\n  $blockquery = \"SELECT blockhdr,blockval,block_id FROM blocklists\n    WHERE blocklists.user_id=:user_id\";\n  $blocksth = $dbh->prepare($blockquery);\n  $blocksth->execute(array(':user_id'=>$_GET['user_id']));\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n    <script src=\"scripts.js\" type=\"text/javascript\"></script>\n  </head>\n  <body>\n  <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminuser.php\"><?php echo _('Manage Accounts'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"forms\">\n\t<?php \n\t\t# ensure this page can only be used to view/edit user accounts that already exist for the domain of the admin account\n\t\tif (!$sth->rowCount()) {\t\t\t\n\t\t\techo '<table align=\"center\"><tr><td>';\n\t\t\techo \"Invalid userid '\" . htmlentities($_GET['user_id']) . \"' for domain '\" . htmlentities($_SESSION['domain']). \"'\";\t\t\t\n\t\t\techo '</td></tr></table>';\n\t\t}else{\n\t?>\n\t\n    <form name=\"userchange\" method=\"post\" action=\"adminuserchangesubmit.php\">\n      <table align=\"center\">\n        <tr>\n          <td><?php echo _('Name'); ?>:</td>\n          <td>\n            <input type=\"text\" size=\"25\" name=\"realname\"\n              value=\"<?php print $row['realname']; ?>\" class=\"textfield\" autofocus>\n            <input name=\"user_id\" type=\"hidden\"\n              value=\"<?php print $_GET['user_id']; ?>\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Email Address'); ?>:</td>\n          <td><?php print $row['username']; ?></td>\n        </tr>\n        <tr>\n          <td><?php echo _('Password'); ?>:</td>\n          <td>\n            <input type=\"password\" size=\"25\" id=\"clear\" name=\"clear\" class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Verify Password'); ?>:</td>\n          <td>\n            <input type=\"password\" size=\"25\" id=\"vclear\" name=\"vclear\" class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td></td>\n          <td>\n            <input type=\"button\" id=\"pwgenerate\" value=\"<?php echo _('Generate password'); ?>\">\n            <input type=\"text\" size=\"15\" id=\"suggest\" class=\"textfield\">\n            <input type=\"button\" id=\"pwcopy\" value=\"<?php echo _('Copy'); ?>\">\n          </td>\n        </tr>\n        <?php\n          if ($postmasteruidgid == \"yes\") { ?>\n          <tr>\n            <td><?php echo _('UID'); ?>:</td>\n            <td>\n              <input type=\"text\" size=\"25\" name=\"uid\" class=\"textfield\"\n                value=\"<?php echo $row['uid']; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('GID'); ?>:</td>\n            <td>\n              <input type=\"text\" size=\"25\" name=\"gid\" class=\"textfield\"\n                value=\"<?php echo $row['gid']; ?>\">\n            </td>\n          </tr> \n          <tr>\n            <td colspan=\"2\" class=\"padafter\">\n              <?php echo _('When you update the UID or GID, please make sure\n                your MTA still has permission to create the required user\n                directories!'); ?>\n            </td>\n          </tr>\n        <?php\n          }\n          //if ($domrow['quotas'] > \"0\") {\n        ?>\n            <tr>\n               <td>\n                 <?php printf (_('Mailbox quota (%s MB max)'),\n                   $domrow['quotas']); ?>:</td>\n                <td>\n                  <input type=\"text\" size=\"5\" name=\"quota\" class=\"textfield\"\n                    value=\"<?php echo ($domrow['quotas'] == 0 ? $row['quota'] : ($row['quota'] == 0 ? $domrow['quotas'] : min($domrow['quotas'], $row['quota']))); ?>\">\n                    <?php echo _('MB'); ?>\n                </td>\n              </tr>\n          <?php\n            //}\n            if ((function_exists('imap_get_quotaroot'))\n              && ($imap_to_check_quota == \"yes\")) {\n              $mbox = imap_open(\n                $imapquotaserver, $row['username'], $row['clear'], OP_HALFOPEN\n              );\n              $quota = imap_get_quotaroot($mbox, \"INBOX\");\n              if (is_array($quota) && !empty($quota)) {\n              printf (\"<tr><td>\"\n                . _('Space used:')\n                . \"</td><td>\"\n                . _('%.2f MB')\n                . \"</td></tr>\",\n                $quota['STORAGE']['usage'] / 1024);\n              }\n              imap_close($mbox);\n            }\n          if ($domrow['pipe'] == \"1\") {\n          ?>\n          <tr>\n            <td><?php echo _('Pipe to command or alternative Maildir'); ?>:</td>\n            <td>\n              <input type=\"textfield\" size=\"25\" name=\"smtp\" class=\"textfield\"\n                value=\"<?php echo $row['smtp']; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"padafter\">\n              <?php echo _('Optional'); ?>:\n              <?php echo _('Pipe all mail to a command (e.g. procmail).'); ?>\n              <br>\n              <?php echo _('Check box below to enable'); ?>:\n            </td>\n          </tr>\n          <tr>\n            <td><?php _('Enable piped command or alternative Maildir?'); ?></td>\n            <td>\n              <input type=\"checkbox\" name=\"on_piped\"\n              <?php\n                if ($row['on_piped'] == \"1\") {\n                  print \" checked \";\n                } ?>>\n            </td>\n          </tr>\n        <?php\n          }\n        ?>\n        <tr>\n          <td>\n            <?php echo _('Admin'); ?>:</td>\n            <td>\n              <input name=\"admin\" type=\"checkbox\"<?php if ($row['admin'] == 1) { \n                print \" checked\";\n              } ?> class=\"textfield\">\n            </td>\n          </tr>\n        <?php\n          if ($domrow['avscan'] == \"1\") {\n        ?>\n          <tr>\n            <td><?php echo _('Anti-Virus'); ?>:</td>\n            <td><input name=\"on_avscan\" type=\"checkbox\"\n              <?php if ($row['on_avscan'] == \"1\") {\n                print \" checked\";\n              } ?>>\n            </td>\n          </tr>\n        <?php\n           }\n           if ($domrow['spamassassin'] == \"1\") {\n        ?>\n            <tr>\n              <td><?php echo _('Spamassassin'); ?>:</td>\n              <td><input name=\"on_spamassassin\" type=\"checkbox\"\n                <?php if ($row['on_spamassassin'] == \"1\") {\n                  print \" checked\";\n                }?>>\n              </td>\n            </tr>\n            <tr>\n              <td><?php echo _('Spamassassin tag score'); ?>:</td>\n              <td>\n                <input type=\"text\" size=\"5\" name=\"sa_tag\"\n                  value=\"<?php echo $row['sa_tag']; ?>\" class=\"textfield\">\n              </td>\n            </tr>\n            <tr>\n              <td><?php echo _('Spamassassin refuse score'); ?>:</td>\n              <td>\n                <input type=\"text\" size=\"5\" name=\"sa_refuse\"\n                  value=\"<?php echo $row['sa_refuse']; ?>\" class=\"textfield\">\n              </td>\n            </tr>\n            <tr>\n              <td><?php echo _('How to handle mail above the SA refuse score'); ?>:</td>\n              <td>\n               <input type=\"radio\" id=\"off\" name=\"spam_drop\" value=\"0\"<?php if ($row['spam_drop'] == \"0\") {\n                  print \" checked\"; }?>>\n               <label for=\"off\"> <?PHP echo _('move to Spam-folder'); ?></label><br>\n               <input type=\"radio\" id=\"on\" name=\"spam_drop\" value=\"1\"<?php if ($row['spam_drop'] == \"1\") {\n                  print \" checked\"; }?>>\n               <label for=\"on\"><?PHP echo _('delete - you cannot restore these mails'); ?></label><br>\n            </td>\n            </tr>\n          <?php\n            }\n          ?>\n        <tr>\n          <td><?php echo _('Maximum message size'); ?>:</td>\n          <td>\n            <input type=\"text\" size=\"5\" name=\"maxmsgsize\"\n              value=\"<?php echo $row['maxmsgsize']; ?>\" class=\"textfield\">Kb\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Enabled'); ?>:</td>\n          <td><input name=\"enabled\" type=\"checkbox\" <?php\n            if ($row['enabled'] == 1) {\n              print \"checked\";\n            } ?> class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Vacation on'); ?>:</td>\n          <td><input name=\"on_vacation\" type=\"checkbox\" <?php\n            if ($row['on_vacation'] == \"1\") {\n              print \" checked \";\n            } ?>>\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Vacation message'); ?>:</td>\n          <td>\n            <textarea name=\"vacation\" cols=\"40\" rows=\"5\" class=\"textfield\"><?php print quoted_printable_decode($row['vacation']); ?></textarea>\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Forwarding on'); ?>:</td>\n          <td><input name=\"on_forward\" id=\"on_forward\" type=\"checkbox\" <?php\n            if ($row['on_forward'] == \"1\") {\n              print \" checked\";\n            } ?>>\n          </td>\n        </tr>\n        <tr>\n          <td valign=\"top\"><?php echo _('Forward mail to'); ?>:</td>\n          <td>\n            <input type=\"text\" size=\"25\" name=\"forward\" id=\"forward\"\n            value=\"<?php print $row['forward']; ?>\" class=\"textfield\"><br>\n            <?php echo _('Enter full e-mail addresses, use commas to separate them'); ?>!<br>\n            <?php echo _('or select from this list') .\":<br>\\n\"; ?>\n            <select name=\"forwardmenu\" id=\"forwardmenu\">\n              <option selected value=\"\"></option>\n              <?php\n                $queryuserlist = \"SELECT realname, username, user_id, unseen\n                FROM users\n                WHERE enabled='1' AND domain_id=:domain_id AND type != 'fail'\n                ORDER BY realname, username, type desc\";\n                $sthuserlist = $dbh->prepare($queryuserlist);\n                $sthuserlist->execute(array(':domain_id'=>$_SESSION['domain_id']));\n                while ($rowuserlist = $sthuserlist->fetch()) {\n              ?>\n                <option value=\"<?php echo $rowuserlist['username']; ?>\">\n                  <?php echo $rowuserlist['realname']; ?>\n                  (<?php echo $rowuserlist['username']; ?>)\n                </option>\n              <?php\n                }\n              ?>\n            </select>\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Store Forwarded Mail Locally'); ?>:</td>\n          <td><input name=\"unseen\" type=\"checkbox\" <?php\n            if ($row['unseen'] == \"1\") {\n              print \" checked \";\n            } ?>>\n            <input name=\"user_id\" type=\"hidden\"\n              value=\"<?php print $_GET['user_id']; ?>\">\n            <input name=\"localpart\" type=\"hidden\"\n              value=\"<?php print $row['localpart']; ?>\">\n          </td>\n        </tr>\n        <tr>\n          <td colspan=\"2\" class=\"button\">\n            <input name=\"submit\" type=\"submit\" value=\"<?php echo _('Submit'); ?>\">\n          </td>\n        </tr>\n        <tr>\n          <td colspan=\"2\" class=\"padafter\">\n          <?php\n            # Print the aliases associated with this account\n            $query = \"SELECT user_id,localpart,domain,realname FROM users,domains\n              WHERE smtp=:smtp AND users.domain_id=domains.domain_id ORDER BY realname\";\n            $sth = $dbh->prepare($query);\n            $sth->execute(array(':smtp'=>$row['localpart'].'@'.$_SESSION['domain']));\n            if ($sth->rowCount()) {\n              echo \"<h4>\"._('Aliases to this account').\":</h4>\";\n              while ($row = $sth->fetch()) {\n                if (($row['domain'] == $_SESSION['domain'])\n                  && ($row['localpart'] != \"*\")) {\n                  print '<a href=\"adminaliaschange.php?user_id='\n                    . $row['user_id']\n                    . '\">'\n                    . $row['localpart']. '@' . $row['domain']\n                    . '</a>';\n                } else if (($row['domain'] == $_SESSION['domain'])\n                  && ($row['localpart'] == \"*\")) {\n                  print '<a href=\"admincatchall.php?user_id='\n                    . $row['user_id']\n                    . '\">'\n                    . $row['localpart'] . '@' . $row['domain']\n                    . '</a>';\n              } else {\n                print $row['localpart'] . '@' . $row['domain'];\n              }\n              if ($row['realname'] == \"Catchall\") {\n                print $row['realname'];\n              }\n              print '<br>';\n            }\n          }\n        ?>\n        </td></tr>\n      </table>\n    </form>\n    <br>\n    <form name=\"blocklist\" method=\"post\" action=\"adminuserblocksubmit.php\">\n      <table align=\"center\">\n        <tr>\n          <td colspan=\"2\">\n            <h4>\n              <?php\n                echo _('Add a new header blocking filter for this user');\n              ?>:\n            </h4>\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Header'); ?>:</td>\n          <td>\n            <select name=\"blockhdr\" class=\"textfield\">\n              <option value=\"From\"><?php echo _('From'); ?>:</option>\n              <option value=\"To\"><?php echo _('To'); ?>:</option>\n              <option value=\"Subject\"><?php echo _('Subject'); ?>:</option>\n              <option value=\"X-Mailer\"><?php echo _('X-Mailer'); ?>:</option>\n            </select>\n          </td>\n          <td>\n            <input name=\"blockval\" type=\"text\" size=\"25\" class=\"textfield\">\n            <input name=\"user_id\" type=\"hidden\"\n              value=\"<?php print $_GET['user_id']; ?>\">\n            <input name=\"localpart\" type=\"hidden\"\n              value=\"<?php print $_GET['localpart']; ?>\">\n            <input name=\"color\" type=\"hidden\" value=\"black\">\n          </td>\n        </tr>\n        <tr>\n          <td colspan=\"3\" class=\"button\">\n            <input name=\"submit\" type=\"submit\"\n              value=\"<?php echo _('Submit'); ?>\">\n          </td>\n        </tr>\n      </table>\n    </form>\n    <table align=\"center\">\n      <tr>\n        <th><?php echo _('Delete'); ?></th>\n        <th><?php echo _('Blocked Header'); ?></th>\n        <th><?php echo _('Content'); ?></th>\n      </tr>\n      <?php\n        if ($blocksth->rowCount()) {\n          while ($blockrow = $blocksth->fetch()) {\n      ?>\n            <tr>\n              <td>\n                <a href=\"adminuserblocksubmit.php?action=delete&user_id=<?php\n\t\t\t\t\tprint $_GET['user_id']\n\t\t\t\t\t. '&block_id='\n\t\t\t\t\t. $blockrow['block_id']\n\t\t\t\t\t.'&localpart='\n\t\t\t\t\t. $_GET['localpart'];?>\">\n                  <img class=\"trash\" title=\"Delete\" src=\"images/trashcan.gif\"\n                    alt=\"trashcan\">\n                </a>\n              </td>\n              <td><?php echo $blockrow['blockhdr']; ?></td>\n              <td><?php echo $blockrow['blockval']; ?></td>\n            </tr>\n        <?php\n          }\n        }\n      ?>\n    </table>\n\t<?php\n\t\t# end of the block editing an alias within the domain\n\t}\n\t?>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authsite.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Domains'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n    <script src=\"scripts.js\" type=\"text/javascript\"></script>\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id='Menu'>\n      <a href=\"site.php\"><?php echo _('Manage Domains'); ?></a><br>\n      <a href=\"sitepassword.php\"><?php echo _('Site Password'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"forms\">\n      <form name=\"siteadd\" method=\"post\" action=\"siteaddsubmit.php\">\n        <table align=\"center\">\n          <tr>\n            <td><?php echo _('New Domain'); ?>:</td>\n            <td><input name=\"domain\" type=\"text\" class=\"textfield\" autofocus></td>\n            <td>\n              <?php echo _('The name of the new domain you are adding'); ?>\n            </td>\n          </tr>\n          <?php\n            if ($_GET['type'] == \"local\") {\n          ?>\n          <tr>\n            <td><?php echo _('Domain Admin'); ?>:</td>\n            <td>\n              <input name=\"localpart\" type=\"text\" value=\"postmaster\"\n                class=\"textfield\">\n            </td>\n            <td>\n              <?php\n                echo _('The username of the domain\\'s administrator account');\n              ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Password'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"clear\" id=\"clear\" type=\"password\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Verify Password'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"vclear\" id=\"vclear\" type=\"password\" class=\"textfield\">\n            </td>\n          </tr>\n        <tr>\n            <td></td>\n            <td colspan=\"2\">\n              <input type=\"button\" id=\"pwgenerate\" value=\"Generate password\">\n              <input type=\"text\" size=\"15\" name=\"suggest\" id=\"suggest\" class=\"textfield\">\n              <input type=\"button\" id=\"pwcopy\" value=\"Copy\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('System UID'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"uid\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $uid; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('System GID'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"gid\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $gid; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Domain Mail directory'); ?>:</td>\n            <td>\n              <input name=\"maildir\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $mailroot; ?>\">\n            </td>\n            <td>\n              <?php\n                echo _('Create the domain directory below this top-level\n                  mailstore');\n              ?>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <?php echo _('Maximum accounts'); ?><br>\n              (<?php echo _(\"0 for unlimited\"); ?>):\n            </td>\n            <td colspan=\"2\">\n              <input type=\"text\" size=\"5\" name=\"max_accounts\" value=\"0\"\n                class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <?php echo _('Max mailbox quota'); ?>\n              (<?php echo _('0 for disabled'); ?>):\n            </td>\n            <td colspan=\"2\">\n              <input name=\"quotas\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"0\"><?php echo _('Mb'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Maximum message size'); ?>:</td>\n            <td>\n              <input name=\"maxmsgsize\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"0\"><?php echo _('Kb'); ?>\n            </td>\n            <td>\n              <?php echo _('The maximum size for incoming mail (user\n                tunable)'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin tag score'); ?>:</td>\n            <td>\n              <input name=\"sa_tag\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $sa_tag; ?>\">\n            </td>\n            <td>\n              <?php echo _('The score at the \"X-Spam-Flag: YES\" header will\n                be added'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin refuse score'); ?>:</td>\n            <td>\n              <input name=\"sa_refuse\" size=\"5\" type=\"text\" class=\"textfield\"\n              value=\"<?php echo $sa_refuse; ?>\">\n            </td>\n            <td><?php echo _('The score at which to refuse potentially spam\n              mail and not deliver'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin enabled?'); ?></td>\n            <td colspan=\"2\">\n              <input name=\"spamassassin\" type=\"checkbox\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Anti Virus enabled?'); ?></td>\n            <td colspan=\"2\">\n              <input name=\"avscan\" type=\"checkbox\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Enable piping mail to command?'); ?></td>\n            <td colspan=\"2\">\n              <input name=\"pipe\" type=\"checkbox\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Domain enabled?'); ?></td>\n            <td colspan=\"2\">\n              <input name=\"enabled\" type=\"checkbox\" class=\"textfield\" checked>\n            </td>\n          </tr>\n          <tr><td colspan=\"3\"></td></tr>\n        <?php\n           } else if ($_GET['type'] == \"alias\") {\n        ?>\n          <tr>\n            <td><?php echo _('Redirect messages to domain'); ?>:</td>\n            <td colspan=\"2\">\n              <select name=\"aliasdest\" type=\"text\" class=\"textfield\">\n                <?php\n                  $query = 'SELECT domain_id, domain FROM domains WHERE type=\"local\" ORDER BY domain';\n                  $sth = $dbh->prepare($query);\n                  $sth->execute();\n                  while ($row = $sth->fetch()) {\n                    print '<option value=\"' . $row['domain_id'] . '\">' . $row['domain'] . '</option>' . \"\\n\\t\";\n                  }\n                ?>\n              </select>\n            </td>\n          </tr>\n        <?php\n           }\n        ?>\n          <tr>\n            <td>\n            </td>\n            <td colspan=\"2\">\n              <input name=\"type\" type=\"hidden\"\n                value=\"<?php print $_GET['type']; ?>\">\n              <input name=\"admin\" type=\"hidden\" value=\"1\">\n              <input name=\"submit\" type=\"submit\"\n                value=\"<?php echo _('Submit'); ?>\">\n            </td>\n          </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\ninclude_once dirname(__FILE__) . \"/config/variables.php\";\ninclude_once dirname(__FILE__) . \"/config/authsite.php\";\ninclude_once dirname(__FILE__) . \"/config/functions.php\";\ninclude_once dirname(__FILE__) . \"/config/httpheaders.php\";\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title><?php echo _(\"Virtual Exim\") . \": \" . _(\"Manage Domains\"); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n</head>\n<body>\n<?php include dirname(__FILE__) . \"/config/header.php\"; ?>\n<div id=\"Menu\">\n    <a href=\"site.php\"><?php echo _(\"Manage Domains\"); ?></a><br>\n    <a href=\"sitepassword.php\"><?php echo _(\"Site Password\"); ?></a><br>\n    <br>\n    <a href=\"logout.php\"><?php echo _(\"Logout\"); ?></a><br>\n</div>\n<div id=\"Forms\">\n    <form name=\"passwordchange\" method=\"post\" action=\"sitechangesubmit.php\">\n        <table align=\"center\">\n            <tr>\n                <td colspan=\"2\"><h4><?php echo _(\"Modify Domain Admin\"); ?>:</h4></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Admin\"); ?>:</td>\n                <td><select name=\"localpart\" class=\"textfield\" autofocus>\n                        <?php\n                        $query = \"SELECT localpart,domain FROM users,domains\n                            WHERE domains.domain_id=:domain_id\n                            AND admin=1 AND users.domain_id=domains.domain_id\";\n                        $sth = $dbh->prepare($query);\n                        $sth->execute(array(':domain_id' => $_GET['domain_id']));\n                        while ($row = $sth->fetch()) {\n                            print '<option value=\"' . $row['localpart'] . '\">' . $row['localpart'] . '</option>' . \"\\n\\t\";\n                        }\n                        ?>\n                    </select>@<?php\n                    $query = \"SELECT * FROM domains WHERE domain_id=:domain_id\";\n                    $sth = $dbh->prepare($query);\n                    $sth->execute(array(':domain_id' => $_GET['domain_id']));\n                    if ($sth->rowCount()) {\n                        $row = $sth->fetch();\n                    }\n                    print $row['domain'];\n                    ?>\n                </td>\n                <td>\n                    <input name=\"domain_id\" type=\"hidden\" value=\"<?php print $_GET['domain_id']; ?>\">\n                    <input name=\"domain\" type=\"hidden\" value=\"<?php print $_GET['domain']; ?>\">\n                </td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Password\"); ?>:</td>\n                <td><input name=\"clear\" size=\"25\" type=\"password\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Verify Password\"); ?>:</td>\n                <td><input name=\"vclear\" size=\"25\" type=\"password\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"button\">\n                    <input name=\"submit\" size=\"25\" type=\"submit\" value=\"<?php echo _(\"Submit Password\"); ?>\">\n                </td>\n            </tr>\n        </table>\n    </form><br>\n    <form name=\"domainchange\" method=\"post\" action=\"sitechangesubmit.php\">\n        <table align=\"center\">\n            <tr>\n                <td colspan=\"2\"><h4><?php echo _(\"Modify Domain Properties\"); ?>:</h4></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"System UID\"); ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"uid\" value=\"<?php print $row['uid']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"System GID\"); ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"gid\" value=\"<?php print $row['gid']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Maximum accounts\") . \"<br>(\" . _(\"0 for unlimited\") . \")\"; ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"max_accounts\" value=\"<?php print $row['max_accounts']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Max mailbox quota in MB\") . \"<br>(\" . _(\"0 for disabled\") . \")\"; ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"quotas\" value=\"<?php print $row['quotas']; ?>\" class=\"textfield\"> </td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Maximum message size\"); ?>:</td>\n                <td><input name=\"maxmsgsize\" size=\"5\" type=\"text\" class=\"textfield\" value=\"<?php print $row['maxmsgsize']; ?>\"> KB</td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Spamassassin tag score\"); ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"sa_tag\" value=\"<?php print $row['sa_tag']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Spamassassin refuse score\"); ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"sa_refuse\" value=\"<?php print $row['sa_refuse']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Spamassassin\"); ?>:</td>\n                <td><input type=\"checkbox\" name=\"spamassassin\" <?php if ($row['spamassassin'] == 1) {print \"checked\";} ?>></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Anti-virus\"); ?>:</td>\n                <td><input type=\"checkbox\" name=\"avscan\" <?php if ($row['avscan'] == 1) {print \"checked\";} ?>></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Piping to command\"); ?>:</td>\n                <td><input type=\"checkbox\" name=\"pipe\" <?php if ($row['pipe'] == 1) {print \"checked\";} ?>></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Enabled\"); ?>:</td>\n                <td><input type=\"checkbox\" name=\"enabled\" <?php if ($row['enabled'] == 1) {print \"checked\";} ?>></td>\n                <td>\n                    <input name=\"domain_id\" type=\"hidden\" value=\"<?php print $_GET['domain_id']; ?>\">\n                    <input name=\"domain\" type=\"hidden\" value=\"<?php print $_GET['domain']; ?>\">\n                </td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"button\">\n                    <input name=\"submit\" size=\"25\" type=\"submit\" value=\"<?php echo _(\"Submit Changes\"); ?>\">\n                </td>\n            </tr>\n        </table>\n    </form><br>\n    <form name=\"allusers\" method=\"post\" action=\"sitechangesubmit.php\">\n            <input name=\"allusers\" type=\"hidden\" value=\"<?php print $_GET['domain_id']; ?>\">\n            <input name=\"domain_id\" type=\"hidden\" value=\"<?php print $_GET['domain_id']; ?>\">\n            <input name=\"domain\" type=\"hidden\" value=\"<?php print $_GET['domain']; ?>\">\n        <table align=\"center\">\n            <tr>\n                <td colspan=\"2\"><h4><?php echo _(\"Modify SpamAssassin/Antivirus for all users\").\":\"; ?></h4></td>\n            </tr>\n            <tr>\n                <td valign=\"top\"><?php echo _(\"SpamAssassin for all domain users\") . \"<br><b>(\" . _(\"Warning: cannot be reversed!\") . \")</b>:\"; ?></td>\n                <td>\n                    <input type=\"radio\" name=\"on_spamassassin\" value=\"2\" checked><?php echo _(\"Keep unchanged\"); ?><br>\n                    <input type=\"radio\" name=\"on_spamassassin\" value=\"1\"><?php echo _(\"Enable\"); ?><br>\n                    <input type=\"radio\" name=\"on_spamassassin\" value=\"0\"><?php echo _(\"Disable\"); ?>\n                </td>\n            </tr>\n            <tr>\n                <td valign=\"top\"><?php echo _(\"Anti-Virus for all domain users\") . \"<br><b>(\" . _(\"Warning: cannot be reversed!\") . \")</b>:\"; ?></td>\n                <td>\n                    <input type=\"radio\" name=\"on_avscan\" value=\"2\" checked><?php echo _(\"Keep unchanged\"); ?><br>\n                    <input type=\"radio\" name=\"on_avscan\" value=\"1\"><?php echo _(\"Enable\"); ?><br>\n                    <input type=\"radio\" name=\"on_avscan\" value=\"0\"><?php echo _(\"Disable\"); ?>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"button\">\n                    <input name=\"submit\" type=\"submit\" value=\"<?php echo _(\"Submit\"); ?>\">\n                </td>\n            </tr>\n        </table>\n    </form>\n</div>\n</body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . \"/config/variables.php\";\n  include_once dirname(__FILE__) . \"/config/authsite.php\";\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n  include_once dirname(__FILE__) . \"/config/httpheaders.php\";\n\n  if(!isset($_POST['confirm'])) {\n      $_POST['confirm'] = null;\n  }\n  if(!isset($_POST['type'])) {\n      $_POST['type'] = null;\n  }\n  if(!isset($_GET['type'])) {\n      $_GET['type'] = null;\n  }\n\n  // Delete the domain's users\n  if (($_POST['confirm'] == \"1\") && ($_POST['type'] != \"alias\")) {\n    $usrdelquery = \"DELETE FROM users WHERE domain_id=:domain_id\";\n    $usrdelsth = $dbh->prepare($usrdelquery);\n    $usrdelsuccess = $usrdelsth->execute(array(':domain_id'=>$_POST['domain_id']));\n    // if we were successful, delete the domain's blocklists\n    if ($usrdelsuccess) {\n      $usrdelquery = \"DELETE FROM blocklists WHERE domain_id=:domain_id\";\n      $usrdelsth = $dbh->prepare($usrdelquery);\n      $usrdelsuccess = $usrdelsth->execute(array(':domain_id'=>$_POST['domain_id']));\n      // if we were successful, delete the domain's aliases\n      if($usrdelsuccess) {\n\t$aliasdelquery = \"DELETE FROM domainalias WHERE domain_id=:domain_id\";\n        $aliasdelsth = $dbh->prepare($aliasdelquery);\n        $aliasdelsuccess = $aliasdelsth->execute(array(':domain_id'=>$_POST['domain_id']));\n        // if we were successful, delete the domain itself\n        if ($aliasdelsuccess) {\n          $domdelquery = \"DELETE FROM domains WHERE domain_id=:domain_id\";\n          $domdelsth = $dbh->prepare($domdelquery);\n          $domdelsuccess = $domdelsth->execute(array(':domain_id'=>$_POST['domain_id']));\n          // If everything went well, redirect to a success page.\n\t    if ($domdelsuccess) {\n\t      header (\"Location: site.php?deleted={$_POST['domain']}\");\n\t      die;\n\t    }\n        }\n      }\t\n    } else {\n      header (\"Location: site.php?faildeleted={$_POST['domain']}\");\n      die;\n    }\n  } else if (($_POST['confirm'] == \"1\") && ($_POST['type'] == \"alias\")) {\n    $aliasdeletequery = \"DELETE FROM domainalias WHERE alias=:domain\";\n    $sth = $dbh->prepare($aliasdeletequery);\n    $success = $sth->execute(array(':domain'=>$_POST['domain']));\n    if ($success) {\n      header (\"Location: site.php?deleted={$_POST['domain']}\");\n      die;\n    } else {\n      header (\"Location: site.php?faildeleted={$_POST['domain']}\");\n      die;\n    }\n  } else if ($_POST['confirm'] == \"cancel\") {\n    header (\"Location: site.php?canceldelete={$_POST['domain']}\");\n    die;\n  }\n\n  if ($_GET['type'] != \"alias\") {\n    $query = \"SELECT COUNT(*) AS count, domain, domains.type FROM users,domains\n              WHERE (domains.domain_id=:domain_id\n\t\tAND users.domain_id=domains.domain_id)\n\t\tGROUP BY domain,domains.type\";\n    $sth = $dbh->prepare($query);\n    $sth->execute(array(':domain_id'=>$_GET['domain_id']));\n    $row = $sth->fetch();\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _(\"Virtual Exim\") . \": \" .  _(\"Confirm Delete\"); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n    <body>\n    <?php include dirname(__FILE__) . \"/config/header.php\"; ?>\n    <div id='Menu'>\n      <a href='site.php'><?php echo _(\"Manage Domains\"); ?></a><br>\n      <a href='sitepassword.php'><?php echo _(\"Site Password\"); ?></a><br>\n      <br><a href='logout.php'><?php echo _(\"Logout\"); ?></a><br>\n    </div>\n    <div id='Content'>\n      <form name='domaindelete' method='post' action='sitedelete.php'>\n\t<table align=\"center\">\n\t  <tr><td colspan='2'><?php printf (_(\"Please confirm deleting domain %s.\"), $_GET['domain']); ?>:</td></tr>\n\t  <?php if (($_GET['type'] != \"relay\") && ($_GET['type'] != \"alias\")) {\n\t\tprint   \"<tr><td colspan='2'>\";\n        printf (ngettext(\"There is currently <b>%1\\$d</b> account in domain %2\\$s\", \"There are currently <b>%1\\$d</b> accounts in domain %2\\$s\", $row['count']), $row['count'], $_GET['domain']);\n        print   \"</td></tr>\";\n\t     }\n\t  ?>\n\t  <tr><td><input name='confirm' type='radio' value='cancel' checked><b> <?php printf (_(\"Do Not Delete %s\"), $_GET['domain']); ?></b></td></tr>\n\t  <tr><td><input name='confirm' type='radio' value='1'><b> <?php printf (_(\"Delete %s\"), $_GET['domain']); ?></b></td></tr>\n\t  <tr><td><input name='domain_id' type='hidden' value='<?php print $_GET['domain_id']; ?>'>\n\t  \t  <input name='domain' type='hidden' value='<?php print $_GET['domain']; ?>'>\n\t  \t  <input name='type' type='hidden' value='<?php print $_GET['type']; ?>'>\n\t\t  <input name='submit' type='submit' value='<?php echo _(\"Continue\"); ?>'></td></tr>\n\t</table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . \"/config/variables.php\";\n  include_once dirname(__FILE__) . \"/config/authuser.php\";\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n  include_once dirname(__FILE__) . \"/config/httpheaders.php\";\n\n  $domquery = \"SELECT avscan,spamassassin FROM domains WHERE domain_id=:domain_id\";\n  $domsth = $dbh->prepare($domquery);\n  $success = $domsth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n  if ($success) { $domrow = $domsth->fetch(); }\n  $query = \"SELECT * FROM users WHERE user_id=:user_id\";\n  $sth = $dbh->prepare($query);\n  $success = $sth->execute(array(':user_id'=>$_SESSION['user_id']));\n  if ($success) { $row = $sth->fetch(); }\n  $blockquery = \"SELECT block_id,blockhdr,blockval FROM blocklists,users\n              WHERE blocklists.user_id=:user_id\n\t\tAND users.user_id=blocklists.user_id\";\n  $blocksth = $dbh->prepare($blockquery);\n  $blocksuccess = $blocksth->execute(array(':user_id'=>$_SESSION['user_id']));\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _(\"Virtual Exim\") . \": \" . _(\"Manage Users\"); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n    <script src=\"scripts.js\" type=\"text/javascript\"></script>\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . \"/config/header.php\"; ?>\n    <div id=\"Menu\">\n      <a href=\"logout.php\"><?php echo _(\"Logout\"); ?></a><br>\n    </div>\n    <div id=\"forms\">\n      <form name=\"userchange\" method=\"post\" action=\"userchangesubmit.php\">\n        <table align=\"center\">\n\t  <tr><td><?php echo _(\"Name\"); ?>:</td><td><input name=\"realname\" type=\"text\" value=\"<?php print $row['realname']; ?>\" class=\"textfield\" autofocus></td></tr>\n\t  <tr><td><?php echo _(\"Email Address\"); ?>:</td><td><?php print $row['localpart'].\"@\".$_SESSION['domain']; ?></td>\n\t  <tr><td><?php echo _(\"Password\"); ?>:</td><td><input name=\"clear\" type=\"password\" class=\"textfield\"></td></tr>\n\t  <tr><td class=\"padafter\"><?php echo _(\"Verify Password\"); ?>:</td><td><input name=\"vclear\" type=\"password\" class=\"textfield\"></td></tr>\n   \t  <tr><td colspan=\"2\"><b><?php echo _(\"Note:\"); ?></b> <?php echo _(\"Attempting to set blank passwords does not work!\"); ?><td></tr>\n\t  <tr><td></td><td class=\"button\"><input name=\"submit\" type=\"submit\" value=\"<?php echo _(\"Submit Password\"); ?>\"></td></tr>\n        </table>\n      </form>\n      <form name=\"userchange\" method=\"post\" action=\"userchangesubmit.php\">\n        <table align=\"center\">\n         <?php if($row['type']!=\"alias\") { ?>\n\t  <tr><td colspan=\"2\"><?php\n\t    if ($row['quota'] != \"0\") {\n\t      printf (_(\"Your mailbox quota is currently: %s Mb\"), $row['quota']);\n\t    } else {\n\t      print _(\"Your mailbox quota is currently: Unlimited\");\n\t    }\n\t  ?>\n           </td>\n\t  </tr>\n        <?php\n          }\n          if ($domrow['avscan'] == \"1\") {\n        ?>\n\t  <tr>\n\t    <td><?php echo _('Anti-Virus'); ?>:</td>\n\t    <td><input name=\"on_avscan\" type=\"checkbox\"\n              <?php if ($row['on_avscan'] == \"1\") {\n                print \" checked\";\n              } ?>>\n\t    </td>\n\t  </tr>\n        <?php\n           }\n           if ($domrow['spamassassin'] == \"1\") {\n        ?>\n  \t  <tr>\n  \t    <td><?php echo _('Spamassassin'); ?>:</td>\n  \t    <td><input name=\"on_spamassassin\" type=\"checkbox\"\n                <?php if ($row['on_spamassassin'] == \"1\") {\n                  print \" checked\";\n                }?>>\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('Spamassassin tag score'); ?>:</td>\n  \t    <td>\n                <input type=\"text\" size=\"5\" name=\"sa_tag\"\n                  value=\"<?php echo $row['sa_tag']; ?>\" class=\"textfield\">\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('Spamassassin refuse score'); ?>:</td>\n  \t    <td>\n                <input type=\"text\" size=\"5\" name=\"sa_refuse\"\n                  value=\"<?php echo $row['sa_refuse']; ?>\" class=\"textfield\">\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('How to handle mail above the SA refuse score'); ?>:</td>\n  \t    <td>\n               <input type=\"radio\" id=\"off\" name=\"spam_drop\" value=\"0\"<?php if ($row['spam_drop'] == \"0\") {\n                  print \" checked\"; }?>>\n               <label for=\"off\"> <?PHP if($row['type']==\"alias\") { echo _('forward spam mails'); } else { echo _('move to Spam-folder'); } ?></label><br>\n               <input type=\"radio\" id=\"on\" name=\"spam_drop\" value=\"1\"<?php if ($row['spam_drop'] == \"1\") {\n                  print \" checked\"; }?>>\n               <label for=\"on\"><?PHP echo _('delete - you cannot restore these mails'); ?></label><br>\n\t    </td>\n  \t  </tr>\n          <?php\n            }\n          if($row['type']!=\"alias\") {\n          ?>\n  \t  <tr>\n  \t    <td><?php echo _('Maximum message size'); ?>:</td>\n  \t    <td>\n            <input type=\"text\" size=\"5\" name=\"maxmsgsize\"\n              value=\"<?php echo $row['maxmsgsize']; ?>\" class=\"textfield\">Kb\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('Vacation on'); ?>:</td>\n  \t    <td><input name=\"on_vacation\" type=\"checkbox\" <?php\n            if ($row['on_vacation'] == \"1\") {\n              print \" checked \";\n            } ?>>\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('Vacation message'); ?>:</td>\n  \t    <td><textarea name=\"vacation\" cols=\"40\" rows=\"5\" class=\"textfield\"><?php print quoted_printable_decode($row['vacation']); ?></textarea></td>\n  \t  </tr>\n  \t  <tr><td><?php echo _(\"Forwarding enabled\"); ?>:</td>\n  \t    <td><input name=\"on_forward\" type=\"checkbox\" id=\"on_forward\"\n          <?php if($row['on_forward'] == \"1\") { print \" checked \"; } ?>>\n          </td></tr>\n  \t  <tr><td><?php echo _(\"Forward mail to\");?>:</td>\n\t    <td><input type=\"text\" name=\"forward\" id=\"forward\" value=\"<?php print $row['forward']; ?>\" class=\"textfield\"><br>\n          <?php echo _(\"Enter full e-mail addresses, use commas to separate them.\"); ?>\n        </td></tr>\n  \t  <tr><td><?php echo  _(\"Store Forwarded Mail Locally\");?>:</td>\n  \t    <td><input name=\"unseen\" type=\"checkbox\"\n          <?php if($row['unseen'] == \"1\") { print \" checked \"; } ?>>\n        </td></tr>\n      <?php }\n      ?>\n  \t  <tr><td></td><td class=\"button\"><input name=\"submit\" type=\"submit\" value=\"<?php echo _(\"Submit Profile\"); ?>\"></td></tr>\n  </table>\n  </form>\n<?php if ($row['type']!=\"alias\") { ?>\n  <form name=\"blocklist\" method=\"post\" action=\"userblocksubmit.php\">\n    <table align=\"center\">\n  \t  <tr><td><?php echo _(\"Add a new header blocking filter\"); ?>:</td></tr>\n  \t  <tr><td><select name=\"blockhdr\" class=\"textfield\">\n\t  <option value=\"From\"><?php echo _(\"From\"); ?>:</option>\n\t  <option value=\"To\"><?php echo _(\"To\"); ?>:</option>\n\t  <option value=\"Subject\"><?php echo _(\"Subject\"); ?>:</option>\n  \t  <option value=\"X-Mailer\"><?php echo _(\"X-Mailer\"); ?>:</option>\n\t  </select></td>\n\t    <td><input name=\"blockval\" type=\"text\" size=\"25\" class=\"textfield\">\n\t  <input name=\"color\" type=\"hidden\" value=\"black\"></td></tr>\n  \t  <tr><td></td><td class=\"button\"><input name=\"submit\" type=\"submit\" value=\"Submit\"></td></tr>\n    </table>\n    </form>\n    <table align=\"center\">\n  \t  <tr><th><?php echo _(\"Delete\"); ?></th><th><?php echo _(\"Blocked Header\"); ?></th><th><?php echo _(\"Content\"); ?></th></tr>\n      <?php if ($blocksuccess) {\n\twhile ($blockrow = $blocksth->fetch()) {\n\t  print \"<tr><td><a href=\\\"userblocksubmit.php?action=delete&block_id={$blockrow['block_id']}\\\"><img border=\\\"0\\\" width=\\\"10\\\" height=\\\"16\\\" title=\\\"Delete\\\" src=\\\"images/trashcan.gif\\\" alt=\\\"trashcan\\\"></a></td>\";\n\t  print \"<td>{$blockrow['blockhdr']}</td><td>{$blockrow['blockval']}</td></tr>\\n\";\n\t}\n      }\n\t?>\n      </table>\n<?php }\n?>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n"], "fixing_code": ["<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n  $query = \"SELECT * FROM domains\n    WHERE domain_id=:domain_id\";\n  $sth = $dbh->prepare($query);\n  $sth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n  if ($sth->rowCount()) { $row = $sth->fetch(); }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminalias.php\"><?php echo _('Manage Aliases'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Forms\">\n      <form name=\"adminadd\" method=\"post\" action=\"adminaliasaddsubmit.php\">\n        <table align=\"center\">\n          <tr>\n            <td><?php echo _('Alias Name'); ?>:</td>\n            <td><input name=\"realname\" type=\"text\" class=\"textfield\" autofocus></td>\n          </tr>\n          <tr>\n            <td><?php echo _('Address'); ?>:</td>\n            <td>\n              <input name=\"localpart\" type=\"text\" class=\"textfield\">@\n              <?php print htmlspecialchars($_SESSION['domain']); ?>\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"padafter\">\n              <?php echo _('Multiple addresses should be comma separated,\n                with no spaces'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Forward To'); ?>:</td>\n            <td><input name=\"smtp\" type=\"text\" size=\"30\" class=\"textfield\"></td>\n          </tr>\n          <tr>\n            <td><?php echo _('Password'); ?>:</td>\n            <td>\n              <input name=\"clear\" type=\"password\" size=\"30\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"padafter\">\n              (<?php echo _('Password only needed if you want the user to be able\n              to log in, or if the Alias is the admin account'); ?>)\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Verify Password'); ?>:</td>\n            <td>\n              <input name=\"vclear\" type=\"password\" size=\"30\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Admin'); ?>:</td>\n            <td><input name=\"admin\" type=\"checkbox\" class=\"textfield\"></td>\n          </tr>\n          <?php\n            if ($row['avscan'] == \"1\") {\n          ?>\n          <tr>\n            <td><?php echo _('Anti-Virus'); ?>:</td>\n            <td colspan=\"2\"><input name=\"on_avscan\" type=\"checkbox\"></td>\n          </tr>\n          <?php }\n            if ($row['spamassassin'] == \"1\") {\n          ?>\n          <tr>\n            <td><?php echo _('Spamassassin'); ?>:</td>\n            <td colspan=\"2\"><input name=\"on_spamassassin\" type=\"checkbox\"></td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin tag score'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"sa_tag\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $row['sa_tag']; ?>\"></td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin refuse score'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"sa_refuse\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $row['sa_refuse']; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('How to handle mail above the SA refuse score'); ?>:</td>\n            <td>\n             <input type=\"radio\" id=\"off\" name=\"spam_drop\" value=\"0\" checked>\n             <label for=\"off\"> <?PHP echo _('forward Spam mails'); ?></label><br>\n             <input type=\"radio\" id=\"on\" name=\"spam_drop\" value=\"1\">\n             <label for=\"on\"><?PHP echo _('delete Spam mails'); ?></label><br>\n            </td>\n          </tr>\n          <?php } ?>\n          <tr>\n            <td><?php echo _('Enabled'); ?>:</td>\n            <td>\n              <input name=\"enabled\" type=\"checkbox\" class=\"textfield\" checked>\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"button\">\n              <input name=\"submit\" type=\"submit\" value=\"<?php echo _('Submit'); ?>\">\n            </td>\n          </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n\n  if(array_key_exists('confirm', $_GET)) {\n    if ($_GET['confirm'] == '1') {\n      $query = \"DELETE FROM users\n        WHERE user_id=:user_id\n        AND domain_id=:domain_id\n\t    AND (type='alias' OR type='catch')\";\n      $sth = $dbh->prepare($query);\n      $success = $sth->execute(array(':user_id'=>$_GET['user_id'], ':domain_id'=>$_SESSION['domain_id']));\n      if ($success) {\n        header (\"Location: adminalias.php?deleted={$_GET['localpart']}\");\n        die;\n      } else {\n        header (\"Location: adminalias.php?faildeleted={$_GET['localpart']}\");\n        die;\n      }\n    } else if ($_GET['confirm'] == 'cancel') {\n      header (\"Location: adminalias.php?faildeleted={$_GET['localpart']}\");\n      die;\n    }\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Confirm Delete'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n    <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminaliasadd.php\"><?php echo _('Add Alias'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Content\">\n      <form name=\"aliasdelete\" method=\"get\" action=\"adminaliasdelete.php\">\n        <table align=\"center\">\n          <tr>\n            <td colspan=\"2\">\n              <?php printf (_('Please confirm deleting alias %s@%s'),\n                htmlspecialchars($_GET['localpart']),\n                htmlspecialchars($_SESSION['domain']));\n              ?>:\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='confirm' type='radio' value='cancel' checked>\n              <b><?php printf (_('Do Not Delete %s@%s'),\n                htmlspecialchars($_GET['localpart']),\n                htmlspecialchars($_SESSION['domain']));\n              ?></b>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='confirm' type='radio' value='1'>\n              <b><?php printf (_('Delete %s@%s'),\n                htmlspecialchars($_GET['localpart']),\n                htmlspecialchars($_SESSION['domain']));\n              ?></b>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='domain' type='hidden'\n                value='<?php echo htmlspecialchars($_SESSION['domain']); ?>'>\n              <input name='user_id' type='hidden'\n                value='<?php echo htmlspecialchars($_GET['user_id']); ?>'>\n              <input name='localpart' type='hidden'\n                value='<?php echo htmlspecialchars($_GET['localpart']); ?>'>\n              <input name='submit' type='submit'\n                value='<?php echo _('Continue'); ?>'>\n            </td>\n          </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminfailadd.php\"><?php echo _('Add Fail'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Content\">\n    <table align=\"center\">\n      <tr>\n        <th>&nbsp;</th>\n        <th><?php echo _('Failed Address'); ?>..</th>\n      </tr>\n      <?php\n        $query = \"SELECT user_id,localpart FROM users\n          WHERE domain_id=:domain_id\n          AND users.type='fail'\n          ORDER BY localpart;\";\n        $sth = $dbh->prepare($query);\n        $sth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n        if ($sth->rowCount()) {\n          while ($row = $sth->fetch()) {\n            print '<tr>'\n              . '<td align=\"center\">'\n              . '<a href=\"adminfaildelete.php?user_id='\n              . $row['user_id']\n              . '&amp;localpart='\n              . $row['localpart']\n              . '\"><img class=\"trash\" src=\"images/trashcan.gif\" title=\"'\n              . _('Delete fail ')\n              . $row['localpart']\n              . '\"></a></td>';\n            print '<td>'\n              . '<a href=\"adminfailchange.php?user_id='\n              . $row['user_id']\n              . '\">'\n              . $row['localpart']\n              . '@'\n              . htmlspecialchars($_SESSION['domain'])\n              . '</a></td>';\n            print '</tr>';\n          }\n        }\n      ?>\n    </table>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n       <a href=\"adminfail.php\"><?php echo _('Manage Fails'); ?></a><br>\n       <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n       <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Forms\">\n      <form name=\"adminadd\" method=\"post\" action=\"adminfailaddsubmit.php\">\n        <table align=\"center\">\n\t  <tr>\n\t    <td><?php echo _('Address to fail'); ?>:</td>\n            <td>\n              <input name=\"localpart\" type=\"text\" class=\"textfield\" autofocus>@\n              <?php print htmlspecialchars($_SESSION['domain']); ?>\n            </td>\n\t  </tr>\n\t  <tr>\n\t    <td colspan=\"2\" class=\"button\">\n              <input name=\"submit\" type=\"submit\"\n              value=\"<?php echo _('Submit'); ?>\">\n            </td>\n\t  </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n\n  $query = \"SELECT localpart FROM users WHERE user_id=:user_id AND domain_id=:domain_id AND users.type='fail'\";\n  $sth = $dbh->prepare($query);\n  $sth->execute(array(':user_id'=>$_GET['user_id'], ':domain_id'=>$_SESSION['domain_id']));\n  if($sth->rowCount()) {\n      $row = $sth->fetch();\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminfail.php\"><?php echo _('Manage Fails'); ?></a><br>\n      <a href=\"adminfailadd.php\"><?php echo _('Add Fail'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div=\"Forms\">\n\t<?php\n\t\t# ensure this page can only be used to view/edit fail's that already exist for the domain of the admin account\n\t\tif (!$sth->rowCount()) {\n\t\t\techo '<table align=\"center\"><tr><td>';\n\t\t\techo \"Invalid fail userid '\" . htmlentities($_GET['user_id']) . \"' for domain '\" . htmlentities($_SESSION['domain']). \"'\";\n\t\t\techo '</td></tr></table>';\n\t\t}else{\n\t?>\n      <form name=\"failchange\" method=\"post\" action=\"adminfailchangesubmit.php\">\n\t<table align=\"center\">\n\t  <tr>\n            <td><?php echo _('Fail address'); ?>:</td>\n\t    <td>\n              <input name=\"localpart\" type=\"text\"\n                value=\"<?php print $row['localpart']; ?>\" class=\"textfield\" autofocus>@\n              <?php print htmlspecialchars($_SESSION['domain']); ?>\n            </td>\n\t    <td>\n              <input name=\"user_id\" type=\"hidden\"\n                value=\"<?php print htmlspecialchars($_GET['user_id']); ?>\" class=\"textfield\">\n            </td>\n          </tr>\n\t  <tr>\n            <td></td>\n            <td>\n              <input name=\"submit\" type=\"submit\"\n                value=\"<?php echo _('Submit'); ?>\">\n            </td>\n          </tr>\n\t</table>\n      </form>\n\t\t<?php\n\t\t\t# end of the block editing a fail within the domain\n\t\t}\n\t\t?>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n?>\n<?php\n  $query = \"SELECT * FROM groups WHERE id=:group_id AND domain_id=:domain_id\";\n  $sth = $dbh->prepare($query);\n  $sth->execute(array(':group_id'=>$_GET['group_id'], ':domain_id'=>$_SESSION['domain_id']));\n  if($sth->rowCount()) {\n    $row = $sth->fetch();\n    $grouplocalpart = $row['name'];\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Edit group'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"admingroup.php\"><?php echo _('Manage Groups'); ?></a><br>\n      <a href=\"admingroupadd.php\"><?php echo _('Add Group'); ?></a></br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Forms\">\n\t<?php\n\t\t# ensure this page can only be used to view/edit aliases that already exist for the domain of the admin account\n\t\tif (!$sth->rowCount()) {\n\t\t\techo '<table align=\"center\"><tr><td>';\n\t\t\techo \"Invalid groupid '\" . htmlentities($_GET['group_id']) . \"' for domain '\" . htmlentities($_SESSION['domain']). \"'\";\n\t\t\techo '</td></tr></table>';\n\t\t}else{\n\t?>\n      <table align=\"center\">\n        <form name=\"groupchange\" method=\"post\"\n          action=\"admingroupchangesubmit.php\">\n        <tr>\n          <td><?php echo _('Group Address'); ?>:</td>\n          <td>\n            <input name=\"localpart\" type=\"text\"\n              value=\"<?php echo $row['name']; ?>\"class=\"textfield\" autofocus>@\n              <?php echo htmlspecialchars($_SESSION['domain']); ?>\n            <input name=\"group_id\" type=\"hidden\"\n              value=\"<?php echo htmlspecialchars($_GET['group_id']); ?>\" class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Is public'); ?></td>\n          <td>\n            <input name=\"is_public\" type=\"checkbox\"\n              <?php echo $row['is_public'] == 'Y' ? 'checked' : ''; ?>\n              class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Enabled'); ?></td>\n          <td>\n            <input name=\"enabled\" type=\"checkbox\"\n              <?php echo $row['enabled']=='1' ? 'checked' : ''; ?>\n              class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td colspan=\"2\" class=\"button\">\n            <input name=\"editgroup\" type=\"submit\" value=\"Submit\">\n          </td>\n        </tr>\n        </form>\n        <tr>\n          <td colspan=\"2\">&nbsp;</td>\n        </tr>\n        <tr>\n          <td colspan=\"2\">\n            <?php\n              $query = \"SELECT u.realname, u.localpart, u.enabled, c.member_id\n                FROM users u, group_contents c\n                WHERE u.user_id=c.member_id and c.group_id=:group_id\n                ORDER BY u.enabled desc, u.realname asc\";\n              $sth = $dbh->prepare($query);\n              $sth->execute(array(':group_id'=>$_GET['group_id']));\n              if ($sth->rowCount()) {\n            ?>\n            <table align=\"center\">\n              <tr>\n                <th>&nbsp;</th>\n                <th><?php echo _('Real name'); ?></th>\n                <th><?php echo _('Email Address'); ?></th>\n                <th><?php echo _('Enabled'); ?></th>\n              </tr>\n              <?php\n                while ($row = $sth->fetch()) {\n              ?>\n              <tr>\n                <td class=\"trash\">\n                  <a href=\"admingroupcontentdeletesubmit.php?group_id=<?php echo htmlspecialchars($_GET['group_id']);\n\t\t\t\t\t?>&member_id=<?php echo $row['member_id'];\n\t\t\t\t\t?>&localpart=<?php echo $grouplocalpart;\n\t\t\t\t\t?>\">\n                    <img class=\"trash\"\n                      title=\"Remove member <?php echo $row['realname']\n                      . ' from group ' . $grouplocalpart; ?>\"\n                      src=\"images/trashcan.gif\" alt=\"trashcan\">\n                  </a>\n                </td>\n                <td><?php echo $row['realname']; ?></td>\n                <td><?php echo $row['localpart'].'@'.htmlspecialchars($_SESSION['domain']); ?></td>\n                <td>\n                  <?php\n                    if($row['enabled']='1') {\n                  ?>\n                  <img class=\"check\" src=\"images/check.gif\">\n                  <?php\n                    }\n                  ?>\n                </td>\n              </tr>\n              <?php\n                }#while\n              ?>\n            </table>\n            <?php\n              } else {\n                print _('There are no members in this group');\n              }\n            ?>\n          </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\">&nbsp;</td>\n          </tr>\n          <form method=\"post\" action=\"admingroupcontentaddsubmit.php\"\n            name=\"groupcontentadd\">\n          <tr>\n            <td><?php echo _('Add Member'); ?></td>\n            <td>\n              <input name=\"group_id\" type=\"hidden\"\n                value=\"<?php echo htmlspecialchars($_GET['group_id']); ?>\" class=\"textfield\">\n              <input name=\"localpart\" type=\"hidden\"\n                value=\"<?php echo $grouplocalpart; ?>\" class=\"textfield\">\n              <select name=\"usertoadd\">\n                <option selected value=\"\"></option>\n                <?php\n                  $query = \"SELECT realname, localpart, user_id FROM users\n                    WHERE enabled='1' AND domain_id=:domain_id AND type!='fail'\n                    ORDER BY realname, username, type desc\";\n                  $sth = $dbh->prepare($query);\n                  $sth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n                  while ($row = $sth->fetch()) {\n                ?>\n                  <option value=\"<?php echo $row['user_id'];\n\t\t\t\t\t?>\"><?php echo $row['realname'];\n\t\t\t\t\t?> (<?php echo $row['localpart'].'@'.htmlspecialchars($_SESSION['domain']); ?>)</option>\n                <?php\n                  }\n                ?>\n              </select>\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"button\">\n              <input name=\"addmember\" type=\"submit\"\n                value=\"<?php echo _('Submit'); ?>\">\n            </td>\n          </tr>\n        </form>\n      </table>\n\t\t<?php\n\t\t\t# end of the block editing a group within the domain\n\t\t}\n\t\t?>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n\n  if(array_key_exists('confirm', $_GET)) {\n    if ($_GET['confirm'] == '1') {\n      # confirm that the user is deleting a group they are permitted to change before going further\n\t  $query = \"SELECT * FROM groups WHERE id=:group_id AND domain_id=:domain_id\";\n      $sth = $dbh->prepare($query);\n      $sth->execute(array(':group_id'=>$_GET['group_id'], ':domain_id'=>$_SESSION['domain_id']));\n\t  if (!$sth->rowCount()) {\n  \t    header (\"Location: admingroup.php?group_faildeleted={$_GET['localpart']}\");\n\t    die();\n\t  }\n\n      # delete group member first\n      $query = \"DELETE FROM group_contents WHERE group_id=:group_id\";\n      $sth = $dbh->prepare($query);\n      $success = $sth->execute(array(':group_id'=>$_GET['group_id']));\n      if ($success) {\n        # delete group\n        $query = \"DELETE FROM groups WHERE id=:group_id AND domain_id=:domain_id\";\n        $sth = $dbh->prepare($query);\n        $success = $sth->execute(array(':group_id'=>$_GET['group_id'], ':domain_id'=>$_SESSION['domain_id']));\n        if ($success) {\n          header (\"Location: admingroup.php?group_deleted={$_GET['localpart']}\");\n          die;\n        } else {\n          header (\"Location: admingroup.php?group_faildeleted={$_GET['localpart']}\");\n          die;\n        }\n      } else {\n        header (\"Location: admingroup.php?group_faildeleted={$_GET['localpart']}\");\n        die;\n      }\n    } else if ($_GET['confirm'] == 'cancel') {\n      header (\"Location: admingroup.php?group_faildeleted={$_GET['localpart']}\");\n      die;\n    }\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Confirm Delete'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n    <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"admingroupadd.php\"><?php echo _('Add Group'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Content\">\n      <form name=\"groupdelete\" method=\"get\" action=\"admingroupdelete.php\">\n        <table align=\"center\">\n          <tr>\n            <td colspan=\"2\">\n              <?php printf (_('Please confirm deleting group %s@%s'),\n                htmlspecialchars($_GET['localpart']),\n                htmlspecialchars($_SESSION['domain']));\n              ?>:\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='confirm' type='radio' value='cancel' checked>\n              <b><?php printf (_('Do Not Delete %s@%s'),\n                htmlspecialchars($_GET['localpart']),\n                htmlspecialchars($_SESSION['domain']));\n              ?></b>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='confirm' type='radio' value='1'><b>\n              <?php printf (_('Delete %s@%s'),\n                htmlspecialchars($_GET['localpart']),\n                htmlspecialchars($_SESSION['domain']));\n              ?></b>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <input name='domain' type='hidden'\n                value='<?php echo htmlspecialchars($_SESSION['domain']); ?>'>\n              <input name='group_id' type='hidden'\n                value='<?php echo htmlspecialchars($_GET['group_id']); ?>'>\n              <input name='localpart' type='hidden'\n                value='<?php echo htmlspecialchars($_GET['localpart']); ?>'>\n              <input name='submit' type='submit'\n                value='<?php echo _('Continue'); ?>'>\n            </td>\n          </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n\n  if (isset($_GET['LETTER'])) {\n    $letter = strtolower($_GET['LETTER']);\n  } else {\n    $letter = '';\n  }\n  if (!isset($_POST['searchfor'])) {\n    $_POST['searchfor'] = '';\n  }\n  if (!isset($_POST['field']) || ($_POST['field'] != 'localpart')) {\n    $_POST['field'] = 'realname';\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminuseradd.php\"><?php echo _('Add User'); ?></a>\n      <?php\n        $query = \"SELECT count(users.user_id)\n          AS used, max_accounts\n          FROM domains,users\n          WHERE users.domain_id=:domain_id\n          AND domains.domain_id=users.domain_id\n          AND (users.type='local' OR users.type='piped')\n          GROUP BY max_accounts\";\n        $sth = $dbh->prepare($query);\n        $sth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n        $row = $sth->fetch();\n        if (($sth->rowCount()) && $row['max_accounts']) {\n          printf(_(\"(%d of %d)\"), $row['used'], $row['max_accounts']);\n        }\n      ?>\n      <br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"Content\">\n      <?php\n        alpha_menu($alphausers)\n      ?>\n      <form name=\"search\" method=\"post\" action=\"adminuser.php\">\n        <?php echo _('Search'); ?>:\n        <input type=\"text\" size=\"20\" name=\"searchfor\"\n          value=\"<?php echo htmlspecialchars($_POST['searchfor']); ?>\" class=\"textfield\">\n        <?php echo _('in'); ?>\n        <select name=\"field\" class=\"textfield\">\n          <option value=\"realname\" <?php if ($_POST['field'] == 'realname') {\n            echo 'selected=\"selected\"';\n          } ?>><?php echo _('User'); ?></option>\n          <option value=\"localpart\" <?php if ($_POST['field'] == 'localpart') {\n            echo \"selected=\\\"selected\\\"\";\n          } ?>><?php echo _('Email address'); ?></option>\n        </select>\n        <input type=\"submit\" name=\"search\" value=\"<?php echo _('search'); ?>\">\n      </form>\n      <table>\n        <tr>\n          <th>&nbsp;</th>\n          <th><?php echo _('User'); ?></th>\n          <th><?php echo _('Email address'); ?></th>\n          <th><?php echo _('Admin'); ?></th>\n        </tr>\n        <?php\n        $query = \"SELECT user_id, localpart, realname, admin, enabled\n          FROM users\n          WHERE domain_id=:domain_id\n          AND  (type = 'local' OR type= 'piped')\";\n        $queryParams=array(':domain_id'=>$_SESSION['domain_id']);\n        if ($alphausers AND $letter != '') {\n          $query .= \" AND lower(localpart) LIKE lower(:letter)\";\n          $queryParams[':letter'] = $letter.'%';\n        } elseif ($_POST['searchfor'] != '') {\n          $query .= ' AND ' . $dbh->quote($_POST['field']) .  ' LIKE :searchfor';\n          $queryParams[':searchfor'] = '%'.$_POST['searchfor'].'%';\n        }\n        $query .= ' ORDER BY realname, localpart';\n        $sth = $dbh->prepare($query);\n        $sth->execute($queryParams);\n        while ($row = $sth->fetch()) {\n          if($row['enabled']===\"0\") print '<tr class=\"disabled\">'; else print '<tr>';\n          print '<td class=\"trash\"><a href=\"adminuserdelete.php?user_id='\n            . $row['user_id']\n            . '&amp;localpart='\n            . $row['localpart']\n            . '\">';\n          print '<img class=\"trash\" title=\"Delete '\n            . $row['realname']\n            . '\" src=\"images/trashcan.gif\" alt=\"trashcan\"></a></td>';\n          print '<td><a href=\"adminuserchange.php?user_id=' . $row['user_id']\n            . '&amp;localpart=' . $row['localpart']\n            . '\" title=\"' . _('Click to modify')\n            . ' '\n            . $row['realname']\n            . '\">'\n            . $row['realname']\n            . '</a></td>';\n          print '<td><a href=\"adminuserchange.php?user_id=' . $row['user_id']\n            . '&amp;localpart=' . $row['localpart']\n            . '\" title=\"' . _('Click to modify')\n            . ' '\n            . $row['realname']\n            . '\">'\n            . $row['localpart'] .'@'. htmlspecialchars($_SESSION['domain'])\n            . '</a></td>';\n          print '<td class=\"check\">';\n          if ($row['admin'] == 1) {\n            print  '<img class=\"check\" src=\"images/check.gif\" title=\"'\n            . $row['realname']\n            . _(' is an administrator')\n            . '\">';\n          }\n          print \"</td></tr>\\n\";\n        }\n        ?>\n      </table>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authpostmaster.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n\n  $query = \"SELECT * FROM users WHERE user_id=:user_id\n\t\tAND domain_id=:domain_id\n\t\tAND (type='local' OR type='piped')\";\n  $sth = $dbh->prepare($query);\n  $sth->execute(array(':user_id'=>$_GET['user_id'], ':domain_id'=>$_SESSION['domain_id']));\n  if ($sth->rowCount()) { $row = $sth->fetch(); }\n  \n  $username = $row['username'];\n  $domquery = \"SELECT avscan,spamassassin,quotas,pipe FROM domains\n    WHERE domain_id=:domain_id\";\n  $domsth = $dbh->prepare($domquery);\n  $domsth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n  if ($domsth->rowCount()) {\n    $domrow = $domsth->fetch();\n  }\n  $blockquery = \"SELECT blockhdr,blockval,block_id FROM blocklists\n    WHERE blocklists.user_id=:user_id\";\n  $blocksth = $dbh->prepare($blockquery);\n  $blocksth->execute(array(':user_id'=>$_GET['user_id']));\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Users'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n    <script src=\"scripts.js\" type=\"text/javascript\"></script>\n  </head>\n  <body>\n  <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id=\"Menu\">\n      <a href=\"adminuser.php\"><?php echo _('Manage Accounts'); ?></a><br>\n      <a href=\"admin.php\"><?php echo _('Main Menu'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"forms\">\n\t<?php \n\t\t# ensure this page can only be used to view/edit user accounts that already exist for the domain of the admin account\n\t\tif (!$sth->rowCount()) {\t\t\t\n\t\t\techo '<table align=\"center\"><tr><td>';\n\t\t\techo \"Invalid userid '\" . htmlentities($_GET['user_id']) . \"' for domain '\" . htmlentities($_SESSION['domain']). \"'\";\t\t\t\n\t\t\techo '</td></tr></table>';\n\t\t}else{\n\t?>\n\t\n    <form name=\"userchange\" method=\"post\" action=\"adminuserchangesubmit.php\">\n      <table align=\"center\">\n        <tr>\n          <td><?php echo _('Name'); ?>:</td>\n          <td>\n            <input type=\"text\" size=\"25\" name=\"realname\"\n              value=\"<?php print $row['realname']; ?>\" class=\"textfield\" autofocus>\n            <input name=\"user_id\" type=\"hidden\"\n              value=\"<?php print htmlspecialchars($_GET['user_id']); ?>\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Email Address'); ?>:</td>\n          <td><?php print $row['username']; ?></td>\n        </tr>\n        <tr>\n          <td><?php echo _('Password'); ?>:</td>\n          <td>\n            <input type=\"password\" size=\"25\" id=\"clear\" name=\"clear\" class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Verify Password'); ?>:</td>\n          <td>\n            <input type=\"password\" size=\"25\" id=\"vclear\" name=\"vclear\" class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td></td>\n          <td>\n            <input type=\"button\" id=\"pwgenerate\" value=\"<?php echo _('Generate password'); ?>\">\n            <input type=\"text\" size=\"15\" id=\"suggest\" class=\"textfield\">\n            <input type=\"button\" id=\"pwcopy\" value=\"<?php echo _('Copy'); ?>\">\n          </td>\n        </tr>\n        <?php\n          if ($postmasteruidgid == \"yes\") { ?>\n          <tr>\n            <td><?php echo _('UID'); ?>:</td>\n            <td>\n              <input type=\"text\" size=\"25\" name=\"uid\" class=\"textfield\"\n                value=\"<?php echo $row['uid']; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('GID'); ?>:</td>\n            <td>\n              <input type=\"text\" size=\"25\" name=\"gid\" class=\"textfield\"\n                value=\"<?php echo $row['gid']; ?>\">\n            </td>\n          </tr> \n          <tr>\n            <td colspan=\"2\" class=\"padafter\">\n              <?php echo _('When you update the UID or GID, please make sure\n                your MTA still has permission to create the required user\n                directories!'); ?>\n            </td>\n          </tr>\n        <?php\n          }\n          //if ($domrow['quotas'] > \"0\") {\n        ?>\n            <tr>\n               <td>\n                 <?php printf (_('Mailbox quota (%s MB max)'),\n                   $domrow['quotas']); ?>:</td>\n                <td>\n                  <input type=\"text\" size=\"5\" name=\"quota\" class=\"textfield\"\n                    value=\"<?php echo ($domrow['quotas'] == 0 ? $row['quota'] : ($row['quota'] == 0 ? $domrow['quotas'] : min($domrow['quotas'], $row['quota']))); ?>\">\n                    <?php echo _('MB'); ?>\n                </td>\n              </tr>\n          <?php\n            //}\n            if ((function_exists('imap_get_quotaroot'))\n              && ($imap_to_check_quota == \"yes\")) {\n              $mbox = imap_open(\n                $imapquotaserver, $row['username'], $row['clear'], OP_HALFOPEN\n              );\n              $quota = imap_get_quotaroot($mbox, \"INBOX\");\n              if (is_array($quota) && !empty($quota)) {\n              printf (\"<tr><td>\"\n                . _('Space used:')\n                . \"</td><td>\"\n                . _('%.2f MB')\n                . \"</td></tr>\",\n                $quota['STORAGE']['usage'] / 1024);\n              }\n              imap_close($mbox);\n            }\n          if ($domrow['pipe'] == \"1\") {\n          ?>\n          <tr>\n            <td><?php echo _('Pipe to command or alternative Maildir'); ?>:</td>\n            <td>\n              <input type=\"textfield\" size=\"25\" name=\"smtp\" class=\"textfield\"\n                value=\"<?php echo $row['smtp']; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td colspan=\"2\" class=\"padafter\">\n              <?php echo _('Optional'); ?>:\n              <?php echo _('Pipe all mail to a command (e.g. procmail).'); ?>\n              <br>\n              <?php echo _('Check box below to enable'); ?>:\n            </td>\n          </tr>\n          <tr>\n            <td><?php _('Enable piped command or alternative Maildir?'); ?></td>\n            <td>\n              <input type=\"checkbox\" name=\"on_piped\"\n              <?php\n                if ($row['on_piped'] == \"1\") {\n                  print \" checked \";\n                } ?>>\n            </td>\n          </tr>\n        <?php\n          }\n        ?>\n        <tr>\n          <td>\n            <?php echo _('Admin'); ?>:</td>\n            <td>\n              <input name=\"admin\" type=\"checkbox\"<?php if ($row['admin'] == 1) { \n                print \" checked\";\n              } ?> class=\"textfield\">\n            </td>\n          </tr>\n        <?php\n          if ($domrow['avscan'] == \"1\") {\n        ?>\n          <tr>\n            <td><?php echo _('Anti-Virus'); ?>:</td>\n            <td><input name=\"on_avscan\" type=\"checkbox\"\n              <?php if ($row['on_avscan'] == \"1\") {\n                print \" checked\";\n              } ?>>\n            </td>\n          </tr>\n        <?php\n           }\n           if ($domrow['spamassassin'] == \"1\") {\n        ?>\n            <tr>\n              <td><?php echo _('Spamassassin'); ?>:</td>\n              <td><input name=\"on_spamassassin\" type=\"checkbox\"\n                <?php if ($row['on_spamassassin'] == \"1\") {\n                  print \" checked\";\n                }?>>\n              </td>\n            </tr>\n            <tr>\n              <td><?php echo _('Spamassassin tag score'); ?>:</td>\n              <td>\n                <input type=\"text\" size=\"5\" name=\"sa_tag\"\n                  value=\"<?php echo $row['sa_tag']; ?>\" class=\"textfield\">\n              </td>\n            </tr>\n            <tr>\n              <td><?php echo _('Spamassassin refuse score'); ?>:</td>\n              <td>\n                <input type=\"text\" size=\"5\" name=\"sa_refuse\"\n                  value=\"<?php echo $row['sa_refuse']; ?>\" class=\"textfield\">\n              </td>\n            </tr>\n            <tr>\n              <td><?php echo _('How to handle mail above the SA refuse score'); ?>:</td>\n              <td>\n               <input type=\"radio\" id=\"off\" name=\"spam_drop\" value=\"0\"<?php if ($row['spam_drop'] == \"0\") {\n                  print \" checked\"; }?>>\n               <label for=\"off\"> <?PHP echo _('move to Spam-folder'); ?></label><br>\n               <input type=\"radio\" id=\"on\" name=\"spam_drop\" value=\"1\"<?php if ($row['spam_drop'] == \"1\") {\n                  print \" checked\"; }?>>\n               <label for=\"on\"><?PHP echo _('delete - you cannot restore these mails'); ?></label><br>\n            </td>\n            </tr>\n          <?php\n            }\n          ?>\n        <tr>\n          <td><?php echo _('Maximum message size'); ?>:</td>\n          <td>\n            <input type=\"text\" size=\"5\" name=\"maxmsgsize\"\n              value=\"<?php echo $row['maxmsgsize']; ?>\" class=\"textfield\">Kb\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Enabled'); ?>:</td>\n          <td><input name=\"enabled\" type=\"checkbox\" <?php\n            if ($row['enabled'] == 1) {\n              print \"checked\";\n            } ?> class=\"textfield\">\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Vacation on'); ?>:</td>\n          <td><input name=\"on_vacation\" type=\"checkbox\" <?php\n            if ($row['on_vacation'] == \"1\") {\n              print \" checked \";\n            } ?>>\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Vacation message'); ?>:</td>\n          <td>\n            <textarea name=\"vacation\" cols=\"40\" rows=\"5\" class=\"textfield\"><?php print quoted_printable_decode($row['vacation']); ?></textarea>\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Forwarding on'); ?>:</td>\n          <td><input name=\"on_forward\" id=\"on_forward\" type=\"checkbox\" <?php\n            if ($row['on_forward'] == \"1\") {\n              print \" checked\";\n            } ?>>\n          </td>\n        </tr>\n        <tr>\n          <td valign=\"top\"><?php echo _('Forward mail to'); ?>:</td>\n          <td>\n            <input type=\"text\" size=\"25\" name=\"forward\" id=\"forward\"\n            value=\"<?php print $row['forward']; ?>\" class=\"textfield\"><br>\n            <?php echo _('Enter full e-mail addresses, use commas to separate them'); ?>!<br>\n            <?php echo _('or select from this list') .\":<br>\\n\"; ?>\n            <select name=\"forwardmenu\" id=\"forwardmenu\">\n              <option selected value=\"\"></option>\n              <?php\n                $queryuserlist = \"SELECT realname, username, user_id, unseen\n                FROM users\n                WHERE enabled='1' AND domain_id=:domain_id AND type != 'fail'\n                ORDER BY realname, username, type desc\";\n                $sthuserlist = $dbh->prepare($queryuserlist);\n                $sthuserlist->execute(array(':domain_id'=>$_SESSION['domain_id']));\n                while ($rowuserlist = $sthuserlist->fetch()) {\n              ?>\n                <option value=\"<?php echo $rowuserlist['username']; ?>\">\n                  <?php echo $rowuserlist['realname']; ?>\n                  (<?php echo $rowuserlist['username']; ?>)\n                </option>\n              <?php\n                }\n              ?>\n            </select>\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Store Forwarded Mail Locally'); ?>:</td>\n          <td><input name=\"unseen\" type=\"checkbox\" <?php\n            if ($row['unseen'] == \"1\") {\n              print \" checked \";\n            } ?>>\n            <input name=\"user_id\" type=\"hidden\"\n              value=\"<?php print htmlspecialchars($_GET['user_id']); ?>\">\n            <input name=\"localpart\" type=\"hidden\"\n              value=\"<?php print $row['localpart']; ?>\">\n          </td>\n        </tr>\n        <tr>\n          <td colspan=\"2\" class=\"button\">\n            <input name=\"submit\" type=\"submit\" value=\"<?php echo _('Submit'); ?>\">\n          </td>\n        </tr>\n        <tr>\n          <td colspan=\"2\" class=\"padafter\">\n          <?php\n            # Print the aliases associated with this account\n            $query = \"SELECT user_id,localpart,domain,realname FROM users,domains\n              WHERE smtp=:smtp AND users.domain_id=domains.domain_id ORDER BY realname\";\n            $sth = $dbh->prepare($query);\n            $sth->execute(array(':smtp'=>$row['localpart'].'@'.$_SESSION['domain']));\n            if ($sth->rowCount()) {\n              echo \"<h4>\"._('Aliases to this account').\":</h4>\";\n              while ($row = $sth->fetch()) {\n                if (($row['domain'] == $_SESSION['domain'])\n                  && ($row['localpart'] != \"*\")) {\n                  print '<a href=\"adminaliaschange.php?user_id='\n                    . $row['user_id']\n                    . '\">'\n                    . $row['localpart']. '@' . $row['domain']\n                    . '</a>';\n                } else if (($row['domain'] == $_SESSION['domain'])\n                  && ($row['localpart'] == \"*\")) {\n                  print '<a href=\"admincatchall.php?user_id='\n                    . $row['user_id']\n                    . '\">'\n                    . $row['localpart'] . '@' . $row['domain']\n                    . '</a>';\n              } else {\n                print $row['localpart'] . '@' . $row['domain'];\n              }\n              if ($row['realname'] == \"Catchall\") {\n                print $row['realname'];\n              }\n              print '<br>';\n            }\n          }\n        ?>\n        </td></tr>\n      </table>\n    </form>\n    <br>\n    <form name=\"blocklist\" method=\"post\" action=\"adminuserblocksubmit.php\">\n      <table align=\"center\">\n        <tr>\n          <td colspan=\"2\">\n            <h4>\n              <?php\n                echo _('Add a new header blocking filter for this user');\n              ?>:\n            </h4>\n          </td>\n        </tr>\n        <tr>\n          <td><?php echo _('Header'); ?>:</td>\n          <td>\n            <select name=\"blockhdr\" class=\"textfield\">\n              <option value=\"From\"><?php echo _('From'); ?>:</option>\n              <option value=\"To\"><?php echo _('To'); ?>:</option>\n              <option value=\"Subject\"><?php echo _('Subject'); ?>:</option>\n              <option value=\"X-Mailer\"><?php echo _('X-Mailer'); ?>:</option>\n            </select>\n          </td>\n          <td>\n            <input name=\"blockval\" type=\"text\" size=\"25\" class=\"textfield\">\n            <input name=\"user_id\" type=\"hidden\"\n              value=\"<?php print htmlspecialchars($_GET['user_id']); ?>\">\n            <input name=\"localpart\" type=\"hidden\"\n              value=\"<?php print htmlspecialchars($_GET['localpart']); ?>\">\n            <input name=\"color\" type=\"hidden\" value=\"black\">\n          </td>\n        </tr>\n        <tr>\n          <td colspan=\"3\" class=\"button\">\n            <input name=\"submit\" type=\"submit\"\n              value=\"<?php echo _('Submit'); ?>\">\n          </td>\n        </tr>\n      </table>\n    </form>\n    <table align=\"center\">\n      <tr>\n        <th><?php echo _('Delete'); ?></th>\n        <th><?php echo _('Blocked Header'); ?></th>\n        <th><?php echo _('Content'); ?></th>\n      </tr>\n      <?php\n        if ($blocksth->rowCount()) {\n          while ($blockrow = $blocksth->fetch()) {\n      ?>\n            <tr>\n              <td>\n                <a href=\"adminuserblocksubmit.php?action=delete&user_id=<?php\n\t\t\t\t\tprint htmlspecialchars($_GET['user_id'])\n\t\t\t\t\t. '&block_id='\n\t\t\t\t\t. $blockrow['block_id']\n\t\t\t\t\t.'&localpart='\n\t\t\t\t\t. htmlspecialchars($_GET['localpart']);?>\">\n                  <img class=\"trash\" title=\"Delete\" src=\"images/trashcan.gif\"\n                    alt=\"trashcan\">\n                </a>\n              </td>\n              <td><?php echo $blockrow['blockhdr']; ?></td>\n              <td><?php echo $blockrow['blockval']; ?></td>\n            </tr>\n        <?php\n          }\n        }\n      ?>\n    </table>\n\t<?php\n\t\t# end of the block editing an alias within the domain\n\t}\n\t?>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . '/config/variables.php';\n  include_once dirname(__FILE__) . '/config/authsite.php';\n  include_once dirname(__FILE__) . '/config/functions.php';\n  include_once dirname(__FILE__) . '/config/httpheaders.php';\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _('Virtual Exim') . ': ' . _('Manage Domains'); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n    <script src=\"scripts.js\" type=\"text/javascript\"></script>\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . '/config/header.php'; ?>\n    <div id='Menu'>\n      <a href=\"site.php\"><?php echo _('Manage Domains'); ?></a><br>\n      <a href=\"sitepassword.php\"><?php echo _('Site Password'); ?></a><br>\n      <br><a href=\"logout.php\"><?php echo _('Logout'); ?></a><br>\n    </div>\n    <div id=\"forms\">\n      <form name=\"siteadd\" method=\"post\" action=\"siteaddsubmit.php\">\n        <table align=\"center\">\n          <tr>\n            <td><?php echo _('New Domain'); ?>:</td>\n            <td><input name=\"domain\" type=\"text\" class=\"textfield\" autofocus></td>\n            <td>\n              <?php echo _('The name of the new domain you are adding'); ?>\n            </td>\n          </tr>\n          <?php\n            if ($_GET['type'] == \"local\") {\n          ?>\n          <tr>\n            <td><?php echo _('Domain Admin'); ?>:</td>\n            <td>\n              <input name=\"localpart\" type=\"text\" value=\"postmaster\"\n                class=\"textfield\">\n            </td>\n            <td>\n              <?php\n                echo _('The username of the domain\\'s administrator account');\n              ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Password'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"clear\" id=\"clear\" type=\"password\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Verify Password'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"vclear\" id=\"vclear\" type=\"password\" class=\"textfield\">\n            </td>\n          </tr>\n        <tr>\n            <td></td>\n            <td colspan=\"2\">\n              <input type=\"button\" id=\"pwgenerate\" value=\"Generate password\">\n              <input type=\"text\" size=\"15\" name=\"suggest\" id=\"suggest\" class=\"textfield\">\n              <input type=\"button\" id=\"pwcopy\" value=\"Copy\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('System UID'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"uid\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $uid; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('System GID'); ?>:</td>\n            <td colspan=\"2\">\n              <input name=\"gid\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $gid; ?>\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Domain Mail directory'); ?>:</td>\n            <td>\n              <input name=\"maildir\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $mailroot; ?>\">\n            </td>\n            <td>\n              <?php\n                echo _('Create the domain directory below this top-level\n                  mailstore');\n              ?>\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <?php echo _('Maximum accounts'); ?><br>\n              (<?php echo _(\"0 for unlimited\"); ?>):\n            </td>\n            <td colspan=\"2\">\n              <input type=\"text\" size=\"5\" name=\"max_accounts\" value=\"0\"\n                class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td>\n              <?php echo _('Max mailbox quota'); ?>\n              (<?php echo _('0 for disabled'); ?>):\n            </td>\n            <td colspan=\"2\">\n              <input name=\"quotas\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"0\"><?php echo _('Mb'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Maximum message size'); ?>:</td>\n            <td>\n              <input name=\"maxmsgsize\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"0\"><?php echo _('Kb'); ?>\n            </td>\n            <td>\n              <?php echo _('The maximum size for incoming mail (user\n                tunable)'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin tag score'); ?>:</td>\n            <td>\n              <input name=\"sa_tag\" size=\"5\" type=\"text\" class=\"textfield\"\n                value=\"<?php echo $sa_tag; ?>\">\n            </td>\n            <td>\n              <?php echo _('The score at the \"X-Spam-Flag: YES\" header will\n                be added'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin refuse score'); ?>:</td>\n            <td>\n              <input name=\"sa_refuse\" size=\"5\" type=\"text\" class=\"textfield\"\n              value=\"<?php echo $sa_refuse; ?>\">\n            </td>\n            <td><?php echo _('The score at which to refuse potentially spam\n              mail and not deliver'); ?>\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Spamassassin enabled?'); ?></td>\n            <td colspan=\"2\">\n              <input name=\"spamassassin\" type=\"checkbox\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Anti Virus enabled?'); ?></td>\n            <td colspan=\"2\">\n              <input name=\"avscan\" type=\"checkbox\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Enable piping mail to command?'); ?></td>\n            <td colspan=\"2\">\n              <input name=\"pipe\" type=\"checkbox\" class=\"textfield\">\n            </td>\n          </tr>\n          <tr>\n            <td><?php echo _('Domain enabled?'); ?></td>\n            <td colspan=\"2\">\n              <input name=\"enabled\" type=\"checkbox\" class=\"textfield\" checked>\n            </td>\n          </tr>\n          <tr><td colspan=\"3\"></td></tr>\n        <?php\n           } else if ($_GET['type'] == \"alias\") {\n        ?>\n          <tr>\n            <td><?php echo _('Redirect messages to domain'); ?>:</td>\n            <td colspan=\"2\">\n              <select name=\"aliasdest\" type=\"text\" class=\"textfield\">\n                <?php\n                  $query = 'SELECT domain_id, domain FROM domains WHERE type=\"local\" ORDER BY domain';\n                  $sth = $dbh->prepare($query);\n                  $sth->execute();\n                  while ($row = $sth->fetch()) {\n                    print '<option value=\"' . $row['domain_id'] . '\">' . $row['domain'] . '</option>' . \"\\n\\t\";\n                  }\n                ?>\n              </select>\n            </td>\n          </tr>\n        <?php\n           }\n        ?>\n          <tr>\n            <td>\n            </td>\n            <td colspan=\"2\">\n              <input name=\"type\" type=\"hidden\"\n                value=\"<?php print htmlspecialchars($_GET['type']); ?>\">\n              <input name=\"admin\" type=\"hidden\" value=\"1\">\n              <input name=\"submit\" type=\"submit\"\n                value=\"<?php echo _('Submit'); ?>\">\n            </td>\n          </tr>\n        </table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\ninclude_once dirname(__FILE__) . \"/config/variables.php\";\ninclude_once dirname(__FILE__) . \"/config/authsite.php\";\ninclude_once dirname(__FILE__) . \"/config/functions.php\";\ninclude_once dirname(__FILE__) . \"/config/httpheaders.php\";\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <title><?php echo _(\"Virtual Exim\") . \": \" . _(\"Manage Domains\"); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n</head>\n<body>\n<?php include dirname(__FILE__) . \"/config/header.php\"; ?>\n<div id=\"Menu\">\n    <a href=\"site.php\"><?php echo _(\"Manage Domains\"); ?></a><br>\n    <a href=\"sitepassword.php\"><?php echo _(\"Site Password\"); ?></a><br>\n    <br>\n    <a href=\"logout.php\"><?php echo _(\"Logout\"); ?></a><br>\n</div>\n<div id=\"Forms\">\n    <form name=\"passwordchange\" method=\"post\" action=\"sitechangesubmit.php\">\n        <table align=\"center\">\n            <tr>\n                <td colspan=\"2\"><h4><?php echo _(\"Modify Domain Admin\"); ?>:</h4></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Admin\"); ?>:</td>\n                <td><select name=\"localpart\" class=\"textfield\" autofocus>\n                        <?php\n                        $query = \"SELECT localpart,domain FROM users,domains\n                            WHERE domains.domain_id=:domain_id\n                            AND admin=1 AND users.domain_id=domains.domain_id\";\n                        $sth = $dbh->prepare($query);\n                        $sth->execute(array(':domain_id' => $_GET['domain_id']));\n                        while ($row = $sth->fetch()) {\n                            print '<option value=\"' . $row['localpart'] . '\">' . $row['localpart'] . '</option>' . \"\\n\\t\";\n                        }\n                        ?>\n                    </select>@<?php\n                    $query = \"SELECT * FROM domains WHERE domain_id=:domain_id\";\n                    $sth = $dbh->prepare($query);\n                    $sth->execute(array(':domain_id' => $_GET['domain_id']));\n                    if ($sth->rowCount()) {\n                        $row = $sth->fetch();\n                    }\n                    print $row['domain'];\n                    ?>\n                </td>\n                <td>\n                    <input name=\"domain_id\" type=\"hidden\" value=\"<?php print htmlspecialchars($_GET['domain_id']); ?>\">\n                    <input name=\"domain\" type=\"hidden\" value=\"<?php print htmlspecialchars($_GET['domain']); ?>\">\n                </td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Password\"); ?>:</td>\n                <td><input name=\"clear\" size=\"25\" type=\"password\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Verify Password\"); ?>:</td>\n                <td><input name=\"vclear\" size=\"25\" type=\"password\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"button\">\n                    <input name=\"submit\" size=\"25\" type=\"submit\" value=\"<?php echo _(\"Submit Password\"); ?>\">\n                </td>\n            </tr>\n        </table>\n    </form><br>\n    <form name=\"domainchange\" method=\"post\" action=\"sitechangesubmit.php\">\n        <table align=\"center\">\n            <tr>\n                <td colspan=\"2\"><h4><?php echo _(\"Modify Domain Properties\"); ?>:</h4></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"System UID\"); ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"uid\" value=\"<?php print $row['uid']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"System GID\"); ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"gid\" value=\"<?php print $row['gid']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Maximum accounts\") . \"<br>(\" . _(\"0 for unlimited\") . \")\"; ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"max_accounts\" value=\"<?php print $row['max_accounts']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Max mailbox quota in MB\") . \"<br>(\" . _(\"0 for disabled\") . \")\"; ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"quotas\" value=\"<?php print $row['quotas']; ?>\" class=\"textfield\"> </td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Maximum message size\"); ?>:</td>\n                <td><input name=\"maxmsgsize\" size=\"5\" type=\"text\" class=\"textfield\" value=\"<?php print $row['maxmsgsize']; ?>\"> KB</td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Spamassassin tag score\"); ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"sa_tag\" value=\"<?php print $row['sa_tag']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Spamassassin refuse score\"); ?>:</td>\n                <td><input type=\"text\" size=\"5\" name=\"sa_refuse\" value=\"<?php print $row['sa_refuse']; ?>\" class=\"textfield\"></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Spamassassin\"); ?>:</td>\n                <td><input type=\"checkbox\" name=\"spamassassin\" <?php if ($row['spamassassin'] == 1) {print \"checked\";} ?>></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Anti-virus\"); ?>:</td>\n                <td><input type=\"checkbox\" name=\"avscan\" <?php if ($row['avscan'] == 1) {print \"checked\";} ?>></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Piping to command\"); ?>:</td>\n                <td><input type=\"checkbox\" name=\"pipe\" <?php if ($row['pipe'] == 1) {print \"checked\";} ?>></td>\n            </tr>\n            <tr>\n                <td><?php echo _(\"Enabled\"); ?>:</td>\n                <td><input type=\"checkbox\" name=\"enabled\" <?php if ($row['enabled'] == 1) {print \"checked\";} ?>></td>\n                <td>\n                    <input name=\"domain_id\" type=\"hidden\" value=\"<?php print htmlspecialchars($_GET['domain_id']); ?>\">\n                    <input name=\"domain\" type=\"hidden\" value=\"<?php print htmlspecialchars($_GET['domain']); ?>\">\n                </td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"button\">\n                    <input name=\"submit\" size=\"25\" type=\"submit\" value=\"<?php echo _(\"Submit Changes\"); ?>\">\n                </td>\n            </tr>\n        </table>\n    </form><br>\n    <form name=\"allusers\" method=\"post\" action=\"sitechangesubmit.php\">\n            <input name=\"allusers\" type=\"hidden\" value=\"<?php print htmlspecialchars($_GET['domain_id']); ?>\">\n            <input name=\"domain_id\" type=\"hidden\" value=\"<?php print htmlspecialchars($_GET['domain_id']); ?>\">\n            <input name=\"domain\" type=\"hidden\" value=\"<?php print htmlspecialchars($_GET['domain']); ?>\">\n        <table align=\"center\">\n            <tr>\n                <td colspan=\"2\"><h4><?php echo _(\"Modify SpamAssassin/Antivirus for all users\").\":\"; ?></h4></td>\n            </tr>\n            <tr>\n                <td valign=\"top\"><?php echo _(\"SpamAssassin for all domain users\") . \"<br><b>(\" . _(\"Warning: cannot be reversed!\") . \")</b>:\"; ?></td>\n                <td>\n                    <input type=\"radio\" name=\"on_spamassassin\" value=\"2\" checked><?php echo _(\"Keep unchanged\"); ?><br>\n                    <input type=\"radio\" name=\"on_spamassassin\" value=\"1\"><?php echo _(\"Enable\"); ?><br>\n                    <input type=\"radio\" name=\"on_spamassassin\" value=\"0\"><?php echo _(\"Disable\"); ?>\n                </td>\n            </tr>\n            <tr>\n                <td valign=\"top\"><?php echo _(\"Anti-Virus for all domain users\") . \"<br><b>(\" . _(\"Warning: cannot be reversed!\") . \")</b>:\"; ?></td>\n                <td>\n                    <input type=\"radio\" name=\"on_avscan\" value=\"2\" checked><?php echo _(\"Keep unchanged\"); ?><br>\n                    <input type=\"radio\" name=\"on_avscan\" value=\"1\"><?php echo _(\"Enable\"); ?><br>\n                    <input type=\"radio\" name=\"on_avscan\" value=\"0\"><?php echo _(\"Disable\"); ?>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"button\">\n                    <input name=\"submit\" type=\"submit\" value=\"<?php echo _(\"Submit\"); ?>\">\n                </td>\n            </tr>\n        </table>\n    </form>\n</div>\n</body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . \"/config/variables.php\";\n  include_once dirname(__FILE__) . \"/config/authsite.php\";\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n  include_once dirname(__FILE__) . \"/config/httpheaders.php\";\n\n  if(!isset($_POST['confirm'])) {\n      $_POST['confirm'] = null;\n  }\n  if(!isset($_POST['type'])) {\n      $_POST['type'] = null;\n  }\n  if(!isset($_GET['type'])) {\n      $_GET['type'] = null;\n  }\n\n  // Delete the domain's users\n  if (($_POST['confirm'] == \"1\") && ($_POST['type'] != \"alias\")) {\n    $usrdelquery = \"DELETE FROM users WHERE domain_id=:domain_id\";\n    $usrdelsth = $dbh->prepare($usrdelquery);\n    $usrdelsuccess = $usrdelsth->execute(array(':domain_id'=>$_POST['domain_id']));\n    // if we were successful, delete the domain's blocklists\n    if ($usrdelsuccess) {\n      $usrdelquery = \"DELETE FROM blocklists WHERE domain_id=:domain_id\";\n      $usrdelsth = $dbh->prepare($usrdelquery);\n      $usrdelsuccess = $usrdelsth->execute(array(':domain_id'=>$_POST['domain_id']));\n      // if we were successful, delete the domain's aliases\n      if($usrdelsuccess) {\n\t$aliasdelquery = \"DELETE FROM domainalias WHERE domain_id=:domain_id\";\n        $aliasdelsth = $dbh->prepare($aliasdelquery);\n        $aliasdelsuccess = $aliasdelsth->execute(array(':domain_id'=>$_POST['domain_id']));\n        // if we were successful, delete the domain itself\n        if ($aliasdelsuccess) {\n          $domdelquery = \"DELETE FROM domains WHERE domain_id=:domain_id\";\n          $domdelsth = $dbh->prepare($domdelquery);\n          $domdelsuccess = $domdelsth->execute(array(':domain_id'=>$_POST['domain_id']));\n          // If everything went well, redirect to a success page.\n\t    if ($domdelsuccess) {\n\t      header (\"Location: site.php?deleted={$_POST['domain']}\");\n\t      die;\n\t    }\n        }\n      }\t\n    } else {\n      header (\"Location: site.php?faildeleted={$_POST['domain']}\");\n      die;\n    }\n  } else if (($_POST['confirm'] == \"1\") && ($_POST['type'] == \"alias\")) {\n    $aliasdeletequery = \"DELETE FROM domainalias WHERE alias=:domain\";\n    $sth = $dbh->prepare($aliasdeletequery);\n    $success = $sth->execute(array(':domain'=>$_POST['domain']));\n    if ($success) {\n      header (\"Location: site.php?deleted={$_POST['domain']}\");\n      die;\n    } else {\n      header (\"Location: site.php?faildeleted={$_POST['domain']}\");\n      die;\n    }\n  } else if ($_POST['confirm'] == \"cancel\") {\n    header (\"Location: site.php?canceldelete={$_POST['domain']}\");\n    die;\n  }\n\n  if ($_GET['type'] != \"alias\") {\n    $query = \"SELECT COUNT(*) AS count, domain, domains.type FROM users,domains\n              WHERE (domains.domain_id=:domain_id\n\t\tAND users.domain_id=domains.domain_id)\n\t\tGROUP BY domain,domains.type\";\n    $sth = $dbh->prepare($query);\n    $sth->execute(array(':domain_id'=>$_GET['domain_id']));\n    $row = $sth->fetch();\n  }\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _(\"Virtual Exim\") . \": \" .  _(\"Confirm Delete\"); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n  </head>\n    <body>\n    <?php include dirname(__FILE__) . \"/config/header.php\"; ?>\n    <div id='Menu'>\n      <a href='site.php'><?php echo _(\"Manage Domains\"); ?></a><br>\n      <a href='sitepassword.php'><?php echo _(\"Site Password\"); ?></a><br>\n      <br><a href='logout.php'><?php echo _(\"Logout\"); ?></a><br>\n    </div>\n    <div id='Content'>\n      <form name='domaindelete' method='post' action='sitedelete.php'>\n\t<table align=\"center\">\n\t  <tr><td colspan='2'><?php printf (_(\"Please confirm deleting domain %s.\"), htmlspecialchars($_GET['domain'])); ?>:</td></tr>\n\t  <?php if (($_GET['type'] != \"relay\") && ($_GET['type'] != \"alias\")) {\n\t\tprint   \"<tr><td colspan='2'>\";\n        printf (ngettext(\"There is currently <b>%1\\$d</b> account in domain %2\\$s\", \"There are currently <b>%1\\$d</b> accounts in domain %2\\$s\", $row['count']), $row['count'], htmlspecialchars($_GET['domain']));\n        print   \"</td></tr>\";\n\t     }\n\t  ?>\n\t  <tr><td><input name='confirm' type='radio' value='cancel' checked><b> <?php printf (_(\"Do Not Delete %s\"), htmlspecialchars($_GET['domain'])); ?></b></td></tr>\n\t  <tr><td><input name='confirm' type='radio' value='1'><b> <?php printf (_(\"Delete %s\"), htmlspecialchars($_GET['domain'])); ?></b></td></tr>\n\t  <tr><td><input name='domain_id' type='hidden' value='<?php print htmlspecialchars($_GET['domain_id']); ?>'>\n\t  \t  <input name='domain' type='hidden' value='<?php print htmlspecialchars($_GET['domain']); ?>'>\n\t  \t  <input name='type' type='hidden' value='<?php print htmlspecialchars($_GET['type']); ?>'>\n\t\t  <input name='submit' type='submit' value='<?php echo _(\"Continue\"); ?>'></td></tr>\n\t</table>\n      </form>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n", "<?php\n  include_once dirname(__FILE__) . \"/config/variables.php\";\n  include_once dirname(__FILE__) . \"/config/authuser.php\";\n  include_once dirname(__FILE__) . \"/config/functions.php\";\n  include_once dirname(__FILE__) . \"/config/httpheaders.php\";\n\n  $domquery = \"SELECT avscan,spamassassin FROM domains WHERE domain_id=:domain_id\";\n  $domsth = $dbh->prepare($domquery);\n  $success = $domsth->execute(array(':domain_id'=>$_SESSION['domain_id']));\n  if ($success) { $domrow = $domsth->fetch(); }\n  $query = \"SELECT * FROM users WHERE user_id=:user_id\";\n  $sth = $dbh->prepare($query);\n  $success = $sth->execute(array(':user_id'=>$_SESSION['user_id']));\n  if ($success) { $row = $sth->fetch(); }\n  $blockquery = \"SELECT block_id,blockhdr,blockval FROM blocklists,users\n              WHERE blocklists.user_id=:user_id\n\t\tAND users.user_id=blocklists.user_id\";\n  $blocksth = $dbh->prepare($blockquery);\n  $blocksuccess = $blocksth->execute(array(':user_id'=>$_SESSION['user_id']));\n?>\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><?php echo _(\"Virtual Exim\") . \": \" . _(\"Manage Users\"); ?></title>\n    <link rel=\"stylesheet\" href=\"style.css\" type=\"text/css\">\n    <script src=\"scripts.js\" type=\"text/javascript\"></script>\n  </head>\n  <body>\n    <?php include dirname(__FILE__) . \"/config/header.php\"; ?>\n    <div id=\"Menu\">\n      <a href=\"logout.php\"><?php echo _(\"Logout\"); ?></a><br>\n    </div>\n    <div id=\"forms\">\n      <form name=\"userchange\" method=\"post\" action=\"userchangesubmit.php\">\n        <table align=\"center\">\n\t  <tr><td><?php echo _(\"Name\"); ?>:</td><td><input name=\"realname\" type=\"text\" value=\"<?php print $row['realname']; ?>\" class=\"textfield\" autofocus></td></tr>\n\t  <tr><td><?php echo _(\"Email Address\"); ?>:</td><td><?php print $row['localpart'].\"@\".htmlspecialchars($_SESSION['domain']); ?></td>\n\t  <tr><td><?php echo _(\"Password\"); ?>:</td><td><input name=\"clear\" type=\"password\" class=\"textfield\"></td></tr>\n\t  <tr><td class=\"padafter\"><?php echo _(\"Verify Password\"); ?>:</td><td><input name=\"vclear\" type=\"password\" class=\"textfield\"></td></tr>\n   \t  <tr><td colspan=\"2\"><b><?php echo _(\"Note:\"); ?></b> <?php echo _(\"Attempting to set blank passwords does not work!\"); ?><td></tr>\n\t  <tr><td></td><td class=\"button\"><input name=\"submit\" type=\"submit\" value=\"<?php echo _(\"Submit Password\"); ?>\"></td></tr>\n        </table>\n      </form>\n      <form name=\"userchange\" method=\"post\" action=\"userchangesubmit.php\">\n        <table align=\"center\">\n         <?php if($row['type']!=\"alias\") { ?>\n\t  <tr><td colspan=\"2\"><?php\n\t    if ($row['quota'] != \"0\") {\n\t      printf (_(\"Your mailbox quota is currently: %s Mb\"), $row['quota']);\n\t    } else {\n\t      print _(\"Your mailbox quota is currently: Unlimited\");\n\t    }\n\t  ?>\n           </td>\n\t  </tr>\n        <?php\n          }\n          if ($domrow['avscan'] == \"1\") {\n        ?>\n\t  <tr>\n\t    <td><?php echo _('Anti-Virus'); ?>:</td>\n\t    <td><input name=\"on_avscan\" type=\"checkbox\"\n              <?php if ($row['on_avscan'] == \"1\") {\n                print \" checked\";\n              } ?>>\n\t    </td>\n\t  </tr>\n        <?php\n           }\n           if ($domrow['spamassassin'] == \"1\") {\n        ?>\n  \t  <tr>\n  \t    <td><?php echo _('Spamassassin'); ?>:</td>\n  \t    <td><input name=\"on_spamassassin\" type=\"checkbox\"\n                <?php if ($row['on_spamassassin'] == \"1\") {\n                  print \" checked\";\n                }?>>\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('Spamassassin tag score'); ?>:</td>\n  \t    <td>\n                <input type=\"text\" size=\"5\" name=\"sa_tag\"\n                  value=\"<?php echo $row['sa_tag']; ?>\" class=\"textfield\">\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('Spamassassin refuse score'); ?>:</td>\n  \t    <td>\n                <input type=\"text\" size=\"5\" name=\"sa_refuse\"\n                  value=\"<?php echo $row['sa_refuse']; ?>\" class=\"textfield\">\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('How to handle mail above the SA refuse score'); ?>:</td>\n  \t    <td>\n               <input type=\"radio\" id=\"off\" name=\"spam_drop\" value=\"0\"<?php if ($row['spam_drop'] == \"0\") {\n                  print \" checked\"; }?>>\n               <label for=\"off\"> <?PHP if($row['type']==\"alias\") { echo _('forward spam mails'); } else { echo _('move to Spam-folder'); } ?></label><br>\n               <input type=\"radio\" id=\"on\" name=\"spam_drop\" value=\"1\"<?php if ($row['spam_drop'] == \"1\") {\n                  print \" checked\"; }?>>\n               <label for=\"on\"><?PHP echo _('delete - you cannot restore these mails'); ?></label><br>\n\t    </td>\n  \t  </tr>\n          <?php\n            }\n          if($row['type']!=\"alias\") {\n          ?>\n  \t  <tr>\n  \t    <td><?php echo _('Maximum message size'); ?>:</td>\n  \t    <td>\n            <input type=\"text\" size=\"5\" name=\"maxmsgsize\"\n              value=\"<?php echo $row['maxmsgsize']; ?>\" class=\"textfield\">Kb\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('Vacation on'); ?>:</td>\n  \t    <td><input name=\"on_vacation\" type=\"checkbox\" <?php\n            if ($row['on_vacation'] == \"1\") {\n              print \" checked \";\n            } ?>>\n\t    </td>\n  \t  </tr>\n  \t  <tr>\n  \t    <td><?php echo _('Vacation message'); ?>:</td>\n  \t    <td><textarea name=\"vacation\" cols=\"40\" rows=\"5\" class=\"textfield\"><?php print quoted_printable_decode($row['vacation']); ?></textarea></td>\n  \t  </tr>\n  \t  <tr><td><?php echo _(\"Forwarding enabled\"); ?>:</td>\n  \t    <td><input name=\"on_forward\" type=\"checkbox\" id=\"on_forward\"\n          <?php if($row['on_forward'] == \"1\") { print \" checked \"; } ?>>\n          </td></tr>\n  \t  <tr><td><?php echo _(\"Forward mail to\");?>:</td>\n\t    <td><input type=\"text\" name=\"forward\" id=\"forward\" value=\"<?php print $row['forward']; ?>\" class=\"textfield\"><br>\n          <?php echo _(\"Enter full e-mail addresses, use commas to separate them.\"); ?>\n        </td></tr>\n  \t  <tr><td><?php echo  _(\"Store Forwarded Mail Locally\");?>:</td>\n  \t    <td><input name=\"unseen\" type=\"checkbox\"\n          <?php if($row['unseen'] == \"1\") { print \" checked \"; } ?>>\n        </td></tr>\n      <?php }\n      ?>\n  \t  <tr><td></td><td class=\"button\"><input name=\"submit\" type=\"submit\" value=\"<?php echo _(\"Submit Profile\"); ?>\"></td></tr>\n  </table>\n  </form>\n<?php if ($row['type']!=\"alias\") { ?>\n  <form name=\"blocklist\" method=\"post\" action=\"userblocksubmit.php\">\n    <table align=\"center\">\n  \t  <tr><td><?php echo _(\"Add a new header blocking filter\"); ?>:</td></tr>\n  \t  <tr><td><select name=\"blockhdr\" class=\"textfield\">\n\t  <option value=\"From\"><?php echo _(\"From\"); ?>:</option>\n\t  <option value=\"To\"><?php echo _(\"To\"); ?>:</option>\n\t  <option value=\"Subject\"><?php echo _(\"Subject\"); ?>:</option>\n  \t  <option value=\"X-Mailer\"><?php echo _(\"X-Mailer\"); ?>:</option>\n\t  </select></td>\n\t    <td><input name=\"blockval\" type=\"text\" size=\"25\" class=\"textfield\">\n\t  <input name=\"color\" type=\"hidden\" value=\"black\"></td></tr>\n  \t  <tr><td></td><td class=\"button\"><input name=\"submit\" type=\"submit\" value=\"Submit\"></td></tr>\n    </table>\n    </form>\n    <table align=\"center\">\n  \t  <tr><th><?php echo _(\"Delete\"); ?></th><th><?php echo _(\"Blocked Header\"); ?></th><th><?php echo _(\"Content\"); ?></th></tr>\n      <?php if ($blocksuccess) {\n\twhile ($blockrow = $blocksth->fetch()) {\n\t  print \"<tr><td><a href=\\\"userblocksubmit.php?action=delete&block_id={$blockrow['block_id']}\\\"><img border=\\\"0\\\" width=\\\"10\\\" height=\\\"16\\\" title=\\\"Delete\\\" src=\\\"images/trashcan.gif\\\" alt=\\\"trashcan\\\"></a></td>\";\n\t  print \"<td>{$blockrow['blockhdr']}</td><td>{$blockrow['blockval']}</td></tr>\\n\";\n\t}\n      }\n\t?>\n      </table>\n<?php }\n?>\n    </div>\n  </body>\n</html>\n<!-- Layout and CSS tricks obtained from http://www.bluerobot.com/web/layouts/ -->\n"], "filenames": ["vexim/adminaliasadd.php", "vexim/adminaliasdelete.php", "vexim/adminfail.php", "vexim/adminfailadd.php", "vexim/adminfailchange.php", "vexim/admingroupchange.php", "vexim/admingroupdelete.php", "vexim/adminuser.php", "vexim/adminuserchange.php", "vexim/siteadd.php", "vexim/sitechange.php", "vexim/sitedelete.php", "vexim/userchange.php"], "buggy_code_start_loc": [36, 47, 51, 27, 44, 46, 62, 55, 59, 196, 51, 90, 37], "buggy_code_end_loc": [37, 78, 52, 28, 49, 157, 93, 115, 408, 197, 134, 102, 38], "fixing_code_start_loc": [36, 47, 51, 27, 44, 46, 62, 55, 59, 196, 51, 90, 37], "fixing_code_end_loc": [37, 78, 52, 28, 49, 157, 93, 115, 408, 197, 134, 102, 38], "type": "CWE-707", "message": "A vulnerability, which was classified as problematic, has been found in vexim2. This issue affects some unknown processing. The manipulation leads to cross site scripting. The attack may be initiated remotely. The name of the patch is 21c0a60d12e9d587f905cd084b2c70f9b1592065. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-215903.", "other": {"cve": {"id": "CVE-2022-4523", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-15T21:15:12.933", "lastModified": "2022-12-21T13:15:25.487", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, has been found in vexim2. This issue affects some unknown processing. The manipulation leads to cross site scripting. The attack may be initiated remotely. The name of the patch is 21c0a60d12e9d587f905cd084b2c70f9b1592065. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-215903."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:virtual_exim_project:virtual_exim_2:-:*:*:*:*:*:*:*", "matchCriteriaId": "491D51B3-9C81-4611-AC0C-626B18AA6337"}]}]}], "references": [{"url": "https://github.com/vexim/vexim2/commit/21c0a60d12e9d587f905cd084b2c70f9b1592065", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/vexim/vexim2/pull/274", "source": "cna@vuldb.com", "tags": ["Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.215903", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/vexim/vexim2/commit/21c0a60d12e9d587f905cd084b2c70f9b1592065"}}