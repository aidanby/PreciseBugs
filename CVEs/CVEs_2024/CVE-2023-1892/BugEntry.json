{"buggy_code": ["# Sidekiq Changes\n\n[Sidekiq Changes](https://github.com/sidekiq/sidekiq/blob/main/Changes.md) | [Sidekiq Pro Changes](https://github.com/sidekiq/sidekiq/blob/main/Pro-Changes.md) | [Sidekiq Enterprise Changes](https://github.com/sidekiq/sidekiq/blob/main/Ent-Changes.md)\n\nHEAD\n----------\n\n- Add job hash as another parameter to any `sidekiq_retry_in` block.\n\n7.0.7\n----------\n\n- Fix redis-client API usage which could result in stuck Redis\nconnections [#5823]\n- Fix AS::Duration with `sidekiq_retry_in` [#5806]\n- Restore dumping config options on startup with `-v` [#5822]\n\n7.0.5,7.0.6\n----------\n\n- More context for debugging json unsafe errors [#5787]\n\n7.0.4\n----------\n\n- Performance and memory optimizations [#5768, fatkodima]\n- Add 1-8 hour period selector to Metrics pages [#5694]\n- Fix process display with `sidekiqmon` [#5733]\n\n7.0.3\n----------\n\n- Don't warn about memory policy on Redis Enterprise [#5712]\n- Don't allow Quiet/Stop on embedded Sidekiq instances [#5716]\n- Fix `size: X` for configuring the default Redis pool size [#5702]\n- Improve the display of queue weights on Busy page [#5642]\n- Freeze CurrentAttributes on a job once initially set [#5692]\n\n7.0.2\n----------\n\n- Improve compatibility with custom loggers [#5673]\n- Add queue weights on Busy page [#5640]\n- Add BID link on job_info page if job is part of a Batch [#5623]\n- Allow custom extensions to add rows/links within Job detail pages [#5624]\n```ruby\nSidekiq::Web.custom_job_info_rows << AddAccountLink.new\n\nclass AddAccountLink\n  include CGI::Util\n  def add_pair(job)\n    # yield a (name, value) pair\n    # You can include HTML tags and CSS, Sidekiq does not do any\n    # escaping so beware user data injection! Note how we use CGI's\n    # `h` escape helper.\n    aid = job[\"account_id\"]\n    yield \"Account\", \"<a href='/accounts/#{h aid}'>#{h aid}</a>\" if aid\n  end\nend\n```\n\n7.0.1\n----------\n\n- Allow an embedding process to reuse its own heartbeat thread\n- Update zh-cn localization\n\n7.0.0\n----------\n\n- Embedded mode!\n- Capsules!!\n- Job Execution metrics!!!\n- See `docs/7.0-Upgrade.md` for release notes\n\n6.5.8\n----------\n\n- Fail if using a bad version of scout_apm [#5616]\n- Add pagination to Busy page [#5556]\n- Speed up WorkSet#each [#5559]\n- Adjust CurrentAttributes to work with the String class name so we aren't referencing the Class within a Rails initializer [#5536]\n\n6.5.7\n----------\n\n- Updates for JA and ZH locales\n- Further optimizations for scheduled polling [#5513]\n\n6.5.6\n----------\n\n- Fix deprecation warnings with redis-rb 4.8.0 [#5484]\n- Lock redis-rb to < 5.0 as we are moving to redis-client in Sidekiq 7.0\n\n6.5.5\n----------\n\n- Fix require issue with job_retry.rb [#5462]\n- Improve Sidekiq::Web compatibility with Rack 3.x\n\n6.5.4\n----------\n\n- Fix invalid code on Ruby 2.5 [#5460]\n- Fix further metrics dependency issues [#5457]\n\n6.5.3\n----------\n\n- Don't require metrics code without explicit opt-in [#5456]\n\n6.5.2\n----------\n\n- [Job Metrics are under active development, help wanted!](https://github.com/sidekiq/sidekiq/wiki/Metrics#contributing) **BETA**\n- Add `Context` column on queue page which shows any CurrentAttributes [#5450]\n- `sidekiq_retry_in` may now return `:discard` or `:kill` to dynamically stop job retries [#5406]\n- Smarter sorting of processes in /busy Web UI [#5398]\n- Fix broken hamburger menu in mobile UI [#5428]\n- Require redis-rb 4.5.0. Note that Sidekiq will break if you use the\n  [`Redis.exists_returns_integer = false`](https://github.com/redis/redis-rb/blob/master/CHANGELOG.md#450) flag. [#5394]\n\n6.5.1\n----------\n\n- Fix `push_bulk` breakage [#5387]\n\n6.5.0\n---------\n\n- Substantial refactoring of Sidekiq server internals, part of a larger effort\n  to reduce Sidekiq's internal usage of global methods and data, see [docs/global_to_local.md](docs/global_to_local.md) and [docs/middleware.md](docs/middleware.md).\n- **Add beta support for the `redis-client` gem**. This will become the default Redis driver in Sidekiq 7.0. [#5298]\n  Read more: https://github.com/sidekiq/sidekiq/wiki/Using-redis-client\n- **Add beta support for DB transaction-aware client** [#5291]\n  Add this line to your initializer and any jobs created during a transaction\n  will only be pushed to Redis **after the transaction commits**. You will need to add the\n  `after_commit_everywhere` gem to your Gemfile.\n```ruby\nSidekiq.transactional_push!\n```\n  This feature does not have a lot of production usage yet; please try it out and let us\n  know if you have any issues. It will be fully supported in Sidekiq 7.0 or removed if it\n  proves problematic.\n- Fix regression with middleware arguments [#5312]\n\n6.4.2\n---------\n\n- Strict argument checking now runs after client-side middleware [#5246]\n- Fix page events with live polling [#5184]\n- Many under-the-hood changes to remove all usage of the term \"worker\"\n  from the Sidekiq codebase and APIs. This mostly involved RDoc and local\n  variable names but a few constants and public APIs were changed. The old\n  APIs will be removed in Sidekiq 7.0.\n```\nSidekiq::DEFAULT_WORKER_OPTIONS -> Sidekiq.default_job_options\nSidekiq.default_worker_options -> Sidekiq.default_job_options\nSidekiq::Queues[\"default\"].jobs_by_worker(HardJob) -> Sidekiq::Queues[\"default\"].jobs_by_class(HardJob)\n```\n\n6.4.1\n---------\n\n- Fix pipeline/multi deprecations in redis-rb 4.6\n- Fix sidekiq.yml YAML load errors on Ruby 3.1 [#5141]\n- Sharding support for `perform_bulk` [#5129]\n- Refactor job logger for SPEEEEEEED\n\n6.4.0\n---------\n\n- **SECURITY**: Validate input to avoid possible DoS in Web UI.\n- Add **strict argument checking** [#5071]\n  Sidekiq will now log a warning if JSON-unsafe arguments are passed to `perform_async`.\n  Add `Sidekiq.strict_args!(false)` to your initializer to disable this warning.\n  This warning will switch to an exception in Sidekiq 7.0.\n- Note that Delayed Extensions will be removed in Sidekiq 7.0 [#5076]\n- Add `perform_{inline,sync}` in Sidekiq::Job to run a job synchronously [#5061, hasan-ally]\n```ruby\nSomeJob.perform_async(args...)\nSomeJob.perform_sync(args...)\nSomeJob.perform_inline(args...)\n```\n  You can also dynamically redirect a job to run synchronously:\n```ruby\nSomeJob.set(\"sync\": true).perform_async(args...) # will run via perform_inline\n```\n- Replace Sidekiq::Worker `app/workers` generator with Sidekiq::Job `app/sidekiq` generator [#5055]\n```\nbin/rails generate sidekiq:job ProcessOrderJob\n```\n- Fix job retries losing CurrentAttributes [#5090]\n- Tweak shutdown to give long-running threads time to cleanup [#5095]\n\n6.3.1\n---------\n\n- Fix keyword arguments error with CurrentAttributes on Ruby 3.0 [#5048]\n\n6.3.0\n---------\n\n- **BREAK**: The Web UI has been refactored to remove jQuery. Any UI extensions\n  which use jQuery will break.\n- **FEATURE**: Sidekiq.logger has been enhanced so any `Rails.logger`\n  output in jobs now shows up in the Sidekiq console. Remove any logger\n  hacks in your initializer and see if it Just Works\u2122 now. [#5021]\n- **FEATURE**: Add `Sidekiq::Job` alias for `Sidekiq::Worker`, to better\n  reflect industry standard terminology. You can now do this:\n```ruby\nclass MyJob\n  include Sidekiq::Job\n  sidekiq_options ...\n  def perform(args)\n  end\nend\n```\n- **FEATURE**: Support for serializing ActiveSupport::CurrentAttributes into each job. [#4982]\n```ruby\n# config/initializers/sidekiq.rb\nrequire \"sidekiq/middleware/current_attributes\"\nSidekiq::CurrentAttributes.persist(Myapp::Current) # Your AS::CurrentAttributes singleton\n```\n- **FEATURE**: Add `Sidekiq::Worker.perform_bulk` for enqueuing jobs in bulk,\n  similar to `Sidekiq::Client.push_bulk` [#5042]\n```ruby\nMyJob.perform_bulk([[1], [2], [3]])\n```\n- Implement `queue_as`, `wait` and `wait_until` for ActiveJob compatibility [#5003]\n- Scheduler now uses Lua to reduce Redis load and network roundtrips [#5044]\n- Retry Redis operation if we get an `UNBLOCKED` Redis error [#4985]\n- Run existing signal traps, if any, before running Sidekiq's trap [#4991]\n- Fix fetch bug when using weighted queues which caused Sidekiq to stop\n  processing queues randomly [#5031]\n\n6.2.2\n---------\n\n- Reduce retry jitter, add jitter to `sidekiq_retry_in` values [#4957]\n- Minimize scheduler load on Redis at scale [#4882]\n- Improve logging of delay jobs [#4904, BuonOno]\n- Minor CSS improvements for buttons and tables, design PRs always welcome!\n- Tweak Web UI `Cache-Control` header [#4966]\n- Rename internal API class `Sidekiq::Job` to `Sidekiq::JobRecord` [#4955]\n\n6.2.1\n---------\n\n- Update RTT warning logic to handle transient RTT spikes [#4851]\n- Fix very low priority CVE on unescaped queue name [#4852]\n- Add note about sessions and Rails apps in API mode\n\n6.2.0\n---------\n\n- Store Redis RTT and log if poor [#4824]\n- Add process/thread stats to Busy page [#4806]\n- Improve Web UI on mobile devices [#4840]\n- **Refactor Web UI session usage** [#4804]\n  Numerous people have hit \"Forbidden\" errors and struggled with Sidekiq's\n  Web UI session requirement. If you have code in your initializer for\n  Web sessions, it's quite possible it will need to be removed. Here's\n  an overview:\n```\nSidekiq::Web needs a valid Rack session for CSRF protection. If this is a Rails app,\nmake sure you mount Sidekiq::Web *inside* your routes in `config/routes.rb` so\nSidekiq can reuse the Rails session:\n\n  Rails.application.routes.draw do\n    mount Sidekiq::Web => \"/sidekiq\"\n    ....\n  end\n\nIf this is a bare Rack app, use a session middleware before Sidekiq::Web:\n\n  # first, use IRB to create a shared secret key for sessions and commit it\n  require 'securerandom'; File.open(\".session.key\", \"w\") {|f| f.write(SecureRandom.hex(32)) }\n\n  # now, update your Rack app to include the secret with a session cookie middleware\n  use Rack::Session::Cookie, secret: File.read(\".session.key\"), same_site: true, max_age: 86400\n  run Sidekiq::Web\n\nIf this is a Rails app in API mode, you need to enable sessions.\n\n  https://guides.rubyonrails.org/api_app.html#using-session-middlewares\n```\n\n6.1.3\n---------\n\n- Warn if Redis is configured to evict data under memory pressure [#4752]\n- Add process RSS on the Busy page [#4717]\n\n6.1.2\n---------\n\n- Improve readability in dark mode Web UI [#4674]\n- Fix Web UI crash with corrupt session [#4672]\n- Allow middleware to yield arguments [#4673, @eugeneius]\n- Migrate CI from CircleCI to GitHub Actions [#4677]\n\n6.1.1\n---------\n\n- Jobs are now sorted by age in the Busy Workers table. [#4641]\n- Fix \"check all\" JS logic in Web UI [#4619]\n\n6.1.0\n---------\n\n- Web UI - Dark Mode fixes [#4543, natematykiewicz]\n- Ensure `Rack::ContentLength` is loaded as middleware for correct Web UI responses [#4541]\n- Avoid exception dumping SSL store in Redis connection logging [#4532]\n- Better error messages in Sidekiq::Client [#4549]\n- Remove rack-protection, reimplement CSRF protection [#4588]\n- Require redis-rb 4.2 [#4591]\n- Update to jquery 1.12.4 [#4593]\n- Refactor internal fetch logic and API [#4602]\n\n6.0.7\n---------\n\n- Refactor systemd integration to work better with custom binaries [#4511]\n- Don't connect to Redis at process exit if not needed [#4502]\n- Remove Redis connection naming [#4479]\n- Fix Redis Sentinel password redaction [#4499]\n- Add Vietnamese locale (vi) [#4528]\n\n6.0.6\n---------\n\n- **Integrate with systemd's watchdog and notification features** [#4488]\n  Set `Type=notify` in [sidekiq.service](https://github.com/sidekiq/sidekiq/blob/4b8a8bd3ae42f6e48ae1fdaf95ed7d7af18ed8bb/examples/systemd/sidekiq.service#L30-L39). The integration works automatically.\n- Use `setTimeout` rather than `setInterval` to avoid thundering herd [#4480]\n- Fix edge case where a job can be pushed without a queue.\n- Flush job stats at exit [#4498]\n- Check RAILS_ENV before RACK_ENV [#4493]\n- Add Lithuanian locale [#4476]\n\n6.0.5\n---------\n\n- Fix broken Web UI response when using NewRelic and Rack 2.1.2+. [#4440]\n- Update APIs to use `UNLINK`, not `DEL`. [#4449]\n- Fix Ruby 2.7 warnings [#4412]\n- Add support for `APP_ENV` [[95fa5d9]](https://github.com/sidekiq/sidekiq/commit/95fa5d90192148026e52ca2902f1b83c70858ce8)\n\n6.0.4\n---------\n\n- Fix ActiveJob's `sidekiq_options` integration [#4404]\n- Sidekiq Pro users will now see a Pause button next to each queue in\n  the Web UI, allowing them to pause queues manually [#4374, shayonj]\n- Fix Sidekiq::Workers API unintentional change in 6.0.2 [#4387]\n\n\n6.0.3\n---------\n\n- Fix `Sidekiq::Client.push_bulk` API which was erroneously putting\n  invalid `at` values in the job payloads [#4321]\n\n6.0.2\n---------\n\n- Fix Sidekiq Enterprise's rolling restart functionality, broken by refactoring in 6.0.0. [#4334]\n- More internal refactoring and performance tuning [fatkodima]\n\n6.0.1\n---------\n\n- **Performance tuning**, Sidekiq should be 10-15% faster now [#4303, 4299,\n  4269, fatkodima]\n- **Dark Mode support in Web UI** (further design polish welcome!) [#4227, mperham,\n  fatkodima, silent-e]\n- **Job-specific log levels**, allowing you to turn on debugging for\n  problematic workers. [fatkodima, #4287]\n```ruby\nMyWorker.set(log_level: :debug).perform_async(...)\n```\n- **Ad-hoc job tags**. You can tag your jobs with, e.g, subdomain, tenant, country,\n  locale, application, version, user/client, \"alpha/beta/pro/ent\", types of jobs,\n  teams/people responsible for jobs, additional metadata, etc.\n  Tags are shown on different pages with job listings. Sidekiq Pro users\n  can filter based on them [fatkodima, #4280]\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_options tags: ['bank-ops', 'alpha']\n  ...\nend\n```\n- Fetch scheduled jobs in batches before pushing into specific queues.\n  This will decrease enqueueing time of scheduled jobs by a third. [fatkodima, #4273]\n```\nScheduledSet with 10,000 jobs\nBefore: 56.6 seconds\nAfter:  39.2 seconds\n```\n- Compress error backtraces before pushing into Redis, if you are\n  storing error backtraces, this will halve the size of your RetrySet\n  in Redis [fatkodima, #4272]\n```\nRetrySet with 100,000 jobs\nBefore: 261 MB\nAfter:  129 MB\n```\n- Support display of ActiveJob 6.0 payloads in the Web UI [#4263]\n- Add `SortedSet#scan` for pattern based scanning. For large sets this API will be **MUCH** faster\n  than standard iteration using each. [fatkodima, #4262]\n```ruby\n  Sidekiq::DeadSet.new.scan(\"UnreliableApi\") do |job|\n    job.retry\n  end\n```\n- Dramatically speed up SortedSet#find\\_job(jid) by using Redis's ZSCAN\n  support, approx 10x faster. [fatkodima, #4259]\n```\nzscan   0.179366   0.047727   0.227093 (  1.161376)\nenum    8.522311   0.419826   8.942137 (  9.785079)\n```\n- Respect rails' generators `test_framework` option and gracefully handle extra `worker` suffix on generator [fatkodima, #4256]\n- Add ability to sort 'Enqueued' page on Web UI by position in the queue [fatkodima, #4248]\n- Support `Client.push_bulk` with different delays [fatkodima, #4243]\n```ruby\nSidekiq::Client.push_bulk(\"class\" => FooJob, \"args\" => [[1], [2]], \"at\" => [1.minute.from_now.to_f, 5.minutes.from_now.to_f])\n```\n- Easier way to test enqueuing specific ActionMailer and ActiveRecord delayed jobs. Instead of manually\n  parsing embedded class, you can now test by fetching jobs for specific classes. [fatkodima, #4292]\n```ruby\nassert_equal 1, Sidekiq::Extensions::DelayedMailer.jobs_for(FooMailer).size\n```\n- Add `sidekiqmon` to gemspec executables [#4242]\n- Gracefully handle `Sidekiq.logger = nil` [#4240]\n- Inject Sidekiq::LogContext module if user-supplied logger does not include it [#4239]\n\n6.0\n---------\n\nThis release has major breaking changes.  Read and test carefully in production.\n\n- With Rails 6.0.2+, ActiveJobs can now use `sidekiq_options` directly to configure Sidekiq\n  features/internals like the retry subsystem. [#4213, pirj]\n```ruby\nclass MyJob < ActiveJob::Base\n  queue_as :myqueue\n  sidekiq_options retry: 10, backtrace: 20\n  def perform(...)\n  end\nend\n```\n- Logging has been redesigned to allow for pluggable log formatters:\n```ruby\nSidekiq.configure_server do |config|\n  config.log_formatter = Sidekiq::Logger::Formatters::JSON.new\nend\n```\nSee the [Logging wiki page](https://github.com/sidekiq/sidekiq/wiki/Logging) for more details.\n- **BREAKING CHANGE** Validate proper usage of the `REDIS_PROVIDER`\n  variable.  This variable is meant to hold the name of the environment\n  variable which contains your Redis URL, so that you can switch Redis\n  providers quickly and easily with a single variable change.  It is not\n  meant to hold the actual Redis URL itself.  If you want to manually set\n  the Redis URL (not recommended as it implies you have no failover),\n  then you may set `REDIS_URL` directly. [#3969]\n- **BREAKING CHANGE** Increase default shutdown timeout from 8 seconds\n  to 25 seconds.  Both Heroku and ECS now use 30 second shutdown timeout\n  by default and we want Sidekiq to take advantage of this time.  If you\n  have deployment scripts which depend on the old default timeout, use `-t 8` to\n  get the old behavior. [#3968]\n- **BREAKING CHANGE** Remove the daemonization, logfile and pidfile\n  arguments to Sidekiq. Use a proper process supervisor (e.g. systemd or\n  foreman) to manage Sidekiq.  See the Deployment wiki page for links to\n  more resources.\n- Integrate the StandardRB code formatter to ensure consistent code\n  styling. [#4114, gearnode]\n\n5.2.10\n---------\n\n- Backport fix for CVE-2022-23837.\n- Migrate to `exists?` for redis-rb.\n- Lock redis-rb to <4.6 to avoid deprecations.\n\n5.2.9\n---------\n\n- Release Rack lock due to a cascade of CVEs. [#4566]\n  Pro-tip: don't lock Rack.\n\n5.2.8\n---------\n\n- Lock to Rack 2.0.x to prevent future incompatibilities\n- Fix invalid reference in `sidekiqctl`\n\n5.2.7\n---------\n\n- Fix stale `enqueued_at` when retrying [#4149]\n- Move build to [Circle CI](https://circleci.com/gh/mperham/sidekiq) [#4120]\n\n5.2.6\n---------\n\n- Fix edge case where a job failure during Redis outage could result in a lost job [#4141]\n- Better handling of malformed job arguments in payload [#4095]\n- Restore bootstap's dropdown css component [#4099, urkle]\n- Display human-friendly time diff for longer queue latencies [#4111, interlinked]\n- Allow `Sidekiq::Worker#set` to be chained\n\n5.2.5\n---------\n\n- Fix default usage of `config/sidekiq.yml` [#4077, Tensho]\n\n5.2.4\n---------\n\n- Add warnings for various deprecations and changes coming in Sidekiq 6.0.\n  See the 6-0 branch. [#4056]\n- Various improvements to the Sidekiq test suite and coverage [#4026, #4039, Tensho]\n\n5.2.3\n---------\n\n- Warning message on invalid REDIS\\_PROVIDER [#3970]\n- Add `sidekiqctl status` command [#4003, dzunk]\n- Update elapsed time calculatons to use monotonic clock [#3999]\n- Fix a few issues with mobile Web UI styling [#3973, navied]\n- Jobs with `retry: false` now go through the global `death_handlers`,\n  meaning you can take action on failed ephemeral jobs. [#3980, Benjamin-Dobell]\n- Fix race condition in defining Workers. [#3997, mattbooks]\n\n5.2.2\n---------\n\n- Raise error for duplicate queue names in config to avoid unexpected fetch algorithm change [#3911]\n- Fix concurrency bug on JRuby [#3958, mattbooks]\n- Add \"Kill All\" button to the retries page [#3938]\n\n5.2.1\n-----------\n\n- Fix concurrent modification error during heartbeat [#3921]\n\n5.2.0\n-----------\n\n- **Decrease default concurrency from 25 to 10** [#3892]\n- Verify connection pool sizing upon startup [#3917]\n- Smoother scheduling for large Sidekiq clusters [#3889]\n- Switch Sidekiq::Testing impl from alias\\_method to Module#prepend, for resiliency [#3852]\n- Update Sidekiq APIs to use SCAN for scalability [#3848, ffiller]\n- Remove concurrent-ruby gem dependency [#3830]\n- Optimize Web UI's bootstrap.css [#3914]\n\n5.1.3\n-----------\n\n- Fix version comparison so Ruby 2.2.10 works. [#3808, nateberkopec]\n\n5.1.2\n-----------\n\n- Add link to docs in Web UI footer\n- Fix crash on Ctrl-C in Windows [#3775, Bernica]\n- Remove `freeze` calls on String constants. This is superfluous with Ruby\n  2.3+ and `frozen_string_literal: true`. [#3759]\n- Fix use of AR middleware outside of Rails [#3787]\n- Sidekiq::Worker `sidekiq_retry_in` block can now return nil or 0 to use\n  the default backoff delay [#3796, dsalahutdinov]\n\n5.1.1\n-----------\n\n- Fix Web UI incompatibility with Redis 3.x gem [#3749]\n\n5.1.0\n-----------\n\n- **NEW** Global death handlers - called when your job exhausts all\n  retries and dies.  Now you can take action when a job fails permanently. [#3721]\n- **NEW** Enable ActiveRecord query cache within jobs by default [#3718, sobrinho]\n  This will prevent duplicate SELECTS; cache is cleared upon any UPDATE/INSERT/DELETE.\n  See the issue for how to bypass the cache or disable it completely.\n- Scheduler timing is now more accurate, 15 -> 5 seconds [#3734]\n- Exceptions during the :startup event will now kill the process [#3717]\n- Make `Sidekiq::Client.via` reentrant [#3715]\n- Fix use of Sidekiq logger outside of the server process [#3714]\n- Tweak `constantize` to better match Rails class lookup. [#3701, caffeinated-tech]\n\n5.0.5\n-----------\n\n- Update gemspec to allow newer versions of the Redis gem [#3617]\n- Refactor Worker.set so it can be memoized [#3602]\n- Fix display of Redis URL in web footer, broken in 5.0.3 [#3560]\n- Update `Sidekiq::Job#display_args` to avoid mutation [#3621]\n\n5.0.4\n-----------\n\n- Fix \"slow startup\" performance regression from 5.0.2. [#3525]\n- Allow users to disable ID generation since some redis providers disable the CLIENT command. [#3521]\n\n5.0.3\n-----------\n\n- Fix overriding `class_attribute` core extension from ActiveSupport with Sidekiq one [PikachuEXE, #3499]\n- Allow job logger to be overridden [AlfonsoUceda, #3502]\n- Set a default Redis client identifier for debugging [#3516]\n- Fix \"Uninitialized constant\" errors on startup with the delayed extensions [#3509]\n\n5.0.2\n-----------\n\n- fix broken release, thanks @nateberkopec\n\n5.0.1\n-----------\n\n- Fix incorrect server identity when daemonizing [jwilm, #3496]\n- Work around error running Web UI against Redis Cluster [#3492]\n- Remove core extensions, Sidekiq is now monkeypatch-free! [#3474]\n- Reimplement Web UI's HTTP\\_ACCEPT\\_LANGUAGE parsing because the spec is utterly\n  incomprehensible for various edge cases. [johanlunds, natematykiewicz, #3449]\n- Update `class_attribute` core extension to avoid warnings\n- Expose `job_hash_context` from `Sidekiq::Logging` to support log customization\n\n5.0.0\n-----------\n\n- **BREAKING CHANGE** Job dispatch was refactored for safer integration with\n  Rails 5.  The **Logging** and **RetryJobs** server middleware were removed and\n  functionality integrated directly into Sidekiq::Processor.  These aren't\n  commonly used public APIs so this shouldn't impact most users.\n```\nSidekiq::Middleware::Server::RetryJobs -> Sidekiq::JobRetry\nSidekiq::Middleware::Server::Logging -> Sidekiq::JobLogger\n```\n- Quieting Sidekiq is now done via the TSTP signal, the USR1 signal is deprecated.\n- The `delay` extension APIs are no longer available by default, you\n  must opt into them.\n- The Web UI is now BiDi and can render RTL languages like Arabic, Farsi and Hebrew.\n- Rails 3.2 and Ruby 2.0 and 2.1 are no longer supported.\n- The `SomeWorker.set(options)` API was re-written to avoid thread-local state. [#2152]\n- Sidekiq Enterprise's encrypted jobs now display \"[encrypted data]\" in the Web UI instead\n  of random hex bytes.\n- Please see the [5.0 Upgrade notes](docs/5.0-Upgrade.md) for more detail.\n\n4.2.10\n-----------\n\n- Scheduled jobs can now be moved directly to the Dead queue via API [#3390]\n- Fix edge case leading to job duplication when using Sidekiq Pro's\n  reliability feature [#3388]\n- Fix error class name display on retry page [#3348]\n- More robust latency calculation [#3340]\n\n4.2.9\n-----------\n\n- Rollback [#3303] which broke Heroku Redis users [#3311]\n- Add support for TSTP signal, for Sidekiq 5.0 forward compatibility. [#3302]\n\n4.2.8\n-----------\n\n- Fix rare edge case with Redis driver that can create duplicate jobs [#3303]\n- Fix Rails 5 loading issue [#3275]\n- Restore missing tooltips to timestamps in Web UI [#3310]\n- Work on **Sidekiq 5.0** is now active! [#3301]\n\n4.2.7\n-----------\n\n- Add new integration testing to verify code loading and job execution\n  in development and production modes with Rails 4 and 5 [#3241]\n- Fix delayed extensions in development mode [#3227, DarthSim]\n- Use Worker's `retry` default if job payload does not have a retry\n  attribute [#3234, mlarraz]\n\n4.2.6\n-----------\n\n- Run Rails Executor when in production [#3221, eugeneius]\n\n4.2.5\n-----------\n\n- Re-enable eager loading of all code when running non-development Rails 5. [#3203]\n- Better root URL handling for zany web servers [#3207]\n\n4.2.4\n-----------\n\n- Log errors coming from the Rails 5 reloader. [#3212, eugeneius]\n- Clone job data so middleware changes don't appear in Busy tab\n\n4.2.3\n-----------\n\n- Disable use of Rails 5's Reloader API in non-development modes, it has proven\n  to be unstable under load [#3154]\n- Allow disabling of Sidekiq::Web's cookie session to handle the\n  case where the app provides a session already [#3180, inkstak]\n```ruby\nSidekiq::Web.set :sessions, false\n```\n- Fix Web UI sharding support broken in 4.2.2. [#3169]\n- Fix timestamps not updating during UI polling [#3193, shaneog]\n- Relax rack-protection version to >= 1.5.0\n- Provide consistent interface to exception handlers, changing the structure of the context hash. [#3161]\n\n4.2.2\n-----------\n\n- Fix ever-increasing cookie size with nginx [#3146, cconstantine]\n- Fix so Web UI works without trailing slash [#3158, timdorr]\n\n4.2.1\n-----------\n\n- Ensure browser does not cache JSON/AJAX responses. [#3136]\n- Support old Sinatra syntax for setting config [#3139]\n\n4.2.0\n-----------\n\n- Enable development-mode code reloading.  **With Rails 5.0+, you don't need\n  to restart Sidekiq to pick up your Sidekiq::Worker changes anymore!** [#2457]\n- **Remove Sinatra dependency**.  Sidekiq's Web UI now uses Rack directly.\n  Thank you to Sidekiq's newest committer, **badosu**, for writing the code\n  and doing a lot of testing to ensure compatibility with many different\n  3rd party plugins.  If your Web UI works with 4.1.4 but fails with\n  4.2.0, please open an issue. [#3075]\n- Allow tuning of concurrency with the `RAILS_MAX_THREADS` env var. [#2985]\n  This is the same var used by Puma so you can tune all of your systems\n  the same way:\n```sh\nweb: RAILS_MAX_THREADS=5 bundle exec puma ...\nworker: RAILS_MAX_THREADS=10 bundle exec sidekiq ...\n```\nUsing `-c` or `config/sidekiq.yml` overrides this setting.  I recommend\nadjusting your `config/database.yml` to use it too so connections are\nauto-scaled:\n```yaml\n  pool: <%= ENV['RAILS_MAX_THREADS'] || 5 %>\n```\n\n4.1.4\n-----------\n\n- Unlock Sinatra so a Rails 5.0 compatible version may be used [#3048]\n- Fix race condition on startup with JRuby [#3043]\n\n\n4.1.3\n-----------\n\n- Please note the Redis 3.3.0 gem has a [memory leak](https://github.com/redis/redis-rb/issues/612),\n  Redis 3.2.2 is recommended until that issue is fixed.\n- Sinatra 1.4.x is now a required dependency, avoiding cryptic errors\n  and old bugs due to people not upgrading Sinatra for years. [#3042]\n- Fixed race condition in heartbeat which could rarely lead to lingering\n  processes on the Busy tab. [#2982]\n```ruby\n# To clean up lingering processes, modify this as necessary to connect to your Redis.\n# After 60 seconds, lingering processes should disappear from the Busy page.\n\nrequire 'redis'\nr = Redis.new(url: \"redis://localhost:6379/0\")\n# uncomment if you need a namespace\n#require 'redis-namespace'\n#r = Redis::Namespace.new(\"foo\", r)\nr.smembers(\"processes\").each do |pro|\n  r.expire(pro, 60)\n  r.expire(\"#{pro}:workers\", 60)\nend\n```\n\n\n4.1.2\n-----------\n\n- Fix Redis data leak with worker data when a busy Sidekiq process\n  crashes.  You can find and expire leaked data in Redis with this\nscript:\n```bash\n$ redis-cli keys  \"*:workers\" | while read LINE ; do TTL=`redis-cli expire \"$LINE\" 60`; echo \"$LINE\"; done;\n```\n  Please note that `keys` can be dangerous to run on a large, busy Redis.  Caveat runner.\n- Freeze all string literals with Ruby 2.3. [#2741]\n- Client middleware can now stop bulk job push. [#2887]\n\n4.1.1\n-----------\n\n- Much better behavior when Redis disappears and comes back. [#2866]\n- Update FR locale [dbachet]\n- Don't fill logfile in case of Redis downtime [#2860]\n- Allow definition of a global retries_exhausted handler. [#2807]\n```ruby\nSidekiq.configure_server do |config|\n  config.default_retries_exhausted = -> (job, ex) do\n    Sidekiq.logger.info \"#{job['class']} job is now dead\"\n  end\nend\n```\n\n4.1.0\n-----------\n\n- Tag quiet processes in the Web UI [#2757, jcarlson]\n- Pass last exception to sidekiq\\_retries\\_exhausted block [#2787, Nowaker]\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_retries_exhausted do |job, exception|\n  end\nend\n```\n- Add native support for ActiveJob's `set(options)` method allowing\nyou to override worker options dynamically.  This should make it\neven easier to switch between ActiveJob and Sidekiq's native APIs [#2780]\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_options queue: 'default', retry: true\n\n  def perform(*args)\n    # do something\n  end\nend\n\nMyWorker.set(queue: 'high', retry: false).perform_async(1)\n```\n\n4.0.2\n-----------\n\n- Better Japanese translations\n- Remove `json` gem dependency from gemspec. [#2743]\n- There's a new testing API based off the `Sidekiq::Queues` namespace. All\n  assertions made against the Worker class still work as expected.\n  [#2676, brandonhilkert]\n```ruby\nassert_equal 0, Sidekiq::Queues[\"default\"].size\nHardWorker.perform_async(\"log\")\nassert_equal 1, Sidekiq::Queues[\"default\"].size\nassert_equal \"log\", Sidekiq::Queues[\"default\"].first['args'][0]\nSidekiq::Queues.clear_all\n```\n\n4.0.1\n-----------\n\n- Yank new queue-based testing API [#2663]\n- Fix invalid constant reference in heartbeat\n\n4.0.0\n-----------\n\n- Sidekiq's internals have been completely overhauled for performance\n  and to remove dependencies.  This has resulted in major speedups, as\n  [detailed on my blog](http://www.mikeperham.com/2015/10/14/optimizing-sidekiq/).\n- See the [4.0 upgrade notes](docs/4.0-Upgrade.md) for more detail.\n\n3.5.4\n-----------\n\n- Ensure exception message is a string [#2707]\n- Revert racy Process.kill usage in sidekiqctl\n\n3.5.3\n-----------\n\n- Adjust shutdown event to run in parallel with the rest of system shutdown. [#2635]\n\n3.5.2\n-----------\n\n- **Sidekiq 3 is now in maintenance mode**, only major bugs will be fixed.\n- The exception triggering a retry is now passed into `sidekiq_retry_in`,\n  allowing you to retry more frequently for certain types of errors.\n  [#2619, kreynolds]\n```ruby\n  sidekiq_retry_in do |count, ex|\n    case ex\n    when RuntimeError\n      5 * count\n    else\n      10 * count\n    end\n  end\n```\n\n3.5.1\n-----------\n\n- **FIX MEMORY LEAK** Under rare conditions, threads may leak [#2598, gazay]\n- Add Ukrainian locale [#2561, elrakita]\n- Disconnect and retry Redis operations if we see a READONLY error [#2550]\n- Add server middleware testing harness; see [wiki](https://github.com/sidekiq/sidekiq/wiki/Testing#testing-server-middleware) [#2534, ryansch]\n\n3.5.0\n-----------\n\n- Polished new banner! [#2522, firedev]\n- Upgrade to Celluloid 0.17. [#2420, digitalextremist]\n- Activate sessions in Sinatra for CSRF protection, requires Rails\n  monkeypatch due to rails/rails#15843. [#2460, jc00ke]\n\n3.4.2\n-----------\n\n- Don't allow `Sidekiq::Worker` in ActiveJob::Base classes. [#2424]\n- Safer display of job data in Web UI [#2405]\n- Fix CSRF vulnerability in Web UI, thanks to Egor Homakov for\n  reporting. [#2422] If you are running the Web UI as a standalone Rack app,\n  ensure you have a [session middleware\nconfigured](https://github.com/sidekiq/sidekiq/wiki/Monitoring#standalone):\n```ruby\nuse Rack::Session::Cookie, :secret => \"some unique secret string here\"\n```\n\n3.4.1\n-----------\n\n- Lock to Celluloid 0.16\n\n\n3.4.0\n-----------\n\n- Set a `created_at` attribute when jobs are created, set `enqueued_at` only\n  when they go into a queue. Fixes invalid latency calculations with scheduled jobs.\n  [#2373, mrsimo]\n- Don't log timestamp on Heroku [#2343]\n- Run `shutdown` event handlers in reverse order of definition [#2374]\n- Rename and rework `poll_interval` to be simpler, more predictable [#2317, cainlevy]\n  The new setting is `average_scheduled_poll_interval`.  To configure\n  Sidekiq to look for scheduled jobs every 5 seconds, just set it to 5.\n```ruby\nSidekiq.configure_server do |config|\n  config.average_scheduled_poll_interval = 5\nend\n```\n\n3.3.4\n-----------\n\n- **Improved ActiveJob integration** - Web UI now shows ActiveJobs in a\n  nicer format and job logging shows the actual class name, requires\n  Rails 4.2.2+ [#2248, #2259]\n- Add Sidekiq::Process#dump\\_threads API to trigger TTIN output [#2247]\n- Web UI polling now uses Ajax to avoid page reload [#2266, davydovanton]\n- Several Web UI styling improvements [davydovanton]\n- Add Tamil, Hindi translations for Web UI [ferdinandrosario, tejasbubane]\n- Fix Web UI to work with country-specific locales [#2243]\n- Handle circular error causes [#2285,  eugenk]\n\n3.3.3\n-----------\n\n- Fix crash on exit when Redis is down [#2235]\n- Fix duplicate logging on startup\n- Undeprecate delay extension for ActionMailer 4.2+ . [#2186]\n\n3.3.2\n-----------\n\n- Add Sidekiq::Stats#queues back\n- Allows configuration of dead job set size and timeout [#2173, jonhyman]\n- Refactor scheduler enqueuing so Sidekiq Pro can override it. [#2159]\n\n3.3.1\n-----------\n\n- Dumb down ActionMailer integration so it tries to deliver if possible [#2149]\n- Stringify Sidekiq.default\\_worker\\_options's keys [#2126]\n- Add random integer to process identity [#2113, michaeldiscala]\n- Log Sidekiq Pro's Batch ID if available [#2076]\n- Refactor Processor Redis usage to avoid redis/redis-rb#490 [#2094]\n- Move /dashboard/stats to /stats.  Add /stats/queues. [moserke, #2099]\n- Add processes count to /stats [ismaelga, #2141]\n- Greatly improve speed of Sidekiq::Stats [ismaelga, #2142]\n- Add better usage text for `sidekiqctl`.\n- `Sidekiq::Logging.with_context` is now a stack so you can set your\n  own job context for logging purposes [grosser, #2110]\n- Remove usage of Google Fonts in Web UI so it loads in China [#2144]\n\n3.3.0\n-----------\n\n- Upgrade to Celluloid 0.16 [#2056]\n- Fix typo for generator test file name [dlackty, #2016]\n- Add Sidekiq::Middleware::Chain#prepend [seuros, #2029]\n\n3.2.6\n-----------\n\n- Deprecate delay extension for ActionMailer 4.2+ . [seuros, #1933]\n- Poll interval tuning now accounts for dead processes [epchris, #1984]\n- Add non-production environment to Web UI page titles [JacobEvelyn, #2004]\n\n3.2.5\n-----------\n\n- Lock Celluloid to 0.15.2 due to bugs in 0.16.0.  This prevents the\n  \"hang on shutdown\" problem with Celluloid 0.16.0.\n\n3.2.4\n-----------\n\n- Fix issue preventing ActionMailer sends working in some cases with\n  Rails 4. [pbhogan, #1923]\n\n3.2.3\n-----------\n\n- Clean invalid bytes from error message before converting to JSON (requires Ruby 2.1+) [#1705]\n- Add queues list for each process to the Busy page. [davetoxa, #1897]\n- Fix for crash caused by empty config file. [jordan0day, #1901]\n- Add Rails Worker generator, `rails g sidekiq:worker User` will create `app/workers/user_worker.rb`. [seuros, #1909]\n- Fix Web UI rendering with huge job arguments [jhass, #1918]\n- Minor refactoring of Sidekiq::Client internals, for Sidekiq Pro. [#1919]\n\n3.2.2\n-----------\n\n- **This version of Sidekiq will no longer start on Ruby 1.9.**  Sidekiq\n  3 does not support MRI 1.9 but we've allowed it to run before now.\n- Fix issue which could cause Sidekiq workers to disappear from the Busy\n  tab while still being active [#1884]\n- Add \"Back to App\" button in Web UI.  You can set the button link via\n  `Sidekiq::Web.app_url = 'http://www.mysite.com'` [#1875, seuros]\n- Add process tag (`-g tag`) to the Busy page so you can differentiate processes at a glance. [seuros, #1878]\n- Add \"Kill\" button to move retries directly to the DJQ so they don't retry. [seuros, #1867]\n\n3.2.1\n-----------\n\n- Revert eager loading change for Rails 3.x apps, as it broke a few edge\n  cases.\n\n3.2.0\n-----------\n\n- **Fix issue which caused duplicate job execution in Rails 3.x**\n  This issue is caused by [improper exception handling in ActiveRecord](https://github.com/rails/rails/blob/3-2-stable/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb#L281) which changes Sidekiq's Shutdown exception into a database\n  error, making Sidekiq think the job needs to be retried. **The fix requires Ruby 2.1**. [#1805]\n- Update how Sidekiq eager loads Rails application code [#1791, jonleighton]\n- Change logging timestamp to show milliseconds.\n- Reverse sorting of Dead tab so newer jobs are listed first [#1802]\n\n3.1.4\n-----------\n\n- Happy \u03c0 release!\n- Self-tuning Scheduler polling, we use heartbeat info to better tune poll\\_interval [#1630]\n- Remove all table column width rules, hopefully get better column formatting [#1747]\n- Handle edge case where YAML can't be decoded in dev mode [#1761]\n- Fix lingering jobs in Busy page on Heroku [#1764]\n\n3.1.3\n-----------\n\n- Use ENV['DYNO'] on Heroku for hostname display, rather than an ugly UUID. [#1742]\n- Show per-process labels on the Busy page, for feature tagging [#1673]\n\n\n3.1.2\n-----------\n\n- Suitably chastised, @mperham reverts the Bundler change.\n\n\n3.1.1\n-----------\n\n- Sidekiq::CLI now runs `Bundler.require(:default, environment)` to boot all gems\n  before loading any app code.\n- Sort queues by name in Web UI [#1734]\n\n\n3.1.0\n-----------\n\n- New **remote control** feature: you can remotely trigger Sidekiq to quiet\n  or terminate via API, without signals.  This is most useful on JRuby\n  or Heroku which does not support the USR1 'quiet' signal.  Now you can\n  run a rake task like this at the start of your deploy to quiet your\n  set of Sidekiq processes. [#1703]\n```ruby\nnamespace :sidekiq do\n  task :quiet => :environment do\n    Sidekiq::ProcessSet.new.each(&:quiet!)\n  end\nend\n```\n- The Web UI can use the API to quiet or stop all processes via the Busy page.\n- The Web UI understands and hides the `Sidekiq::Extensions::Delay*`\n  classes, instead showing `Class.method` as the Job. [#1718]\n- Polish the Dashboard graphs a bit, update Rickshaw [brandonhilkert, #1725]\n- The poll interval is now configurable in the Web UI [madebydna, #1713]\n- Delay extensions can be removed so they don't conflict with\n  DelayedJob: put `Sidekiq.remove_delay!` in your initializer. [devaroop, #1674]\n\n\n3.0.2\n-----------\n\n- Revert gemfile requirement of Ruby 2.0.  JRuby 1.7 calls itself Ruby\n  1.9.3 and broke with this requirement.\n\n3.0.1\n-----------\n\n- Revert pidfile behavior from 2.17.5: Sidekiq will no longer remove its own pidfile\n  as this is a race condition when restarting. [#1470, #1677]\n- Show warning on the Queues page if a queue is paused [#1672]\n- Only activate the ActiveRecord middleware if ActiveRecord::Base is defined on boot. [#1666]\n- Add ability to disable jobs going to the DJQ with the `dead` option.\n```ruby\nsidekiq_options :dead => false, :retry => 5\n```\n- Minor fixes\n\n\n3.0.0\n-----------\n\nPlease see [3.0-Upgrade.md](docs/3.0-Upgrade.md) for more comprehensive upgrade notes.\n\n- **Dead Job Queue** - jobs which run out of retries are now moved to a dead\n  job queue.  These jobs must be retried manually or they will expire\n  after 6 months or 10,000 jobs.  The Web UI contains a \"Dead\" tab\n  exposing these jobs.  Use `sidekiq_options :retry => false` if you\ndon't wish jobs to be retried or put in the DJQ.  Use\n`sidekiq_options :retry => 0` if you don't want jobs to retry but go\nstraight to the DJQ.\n- **Process Lifecycle Events** - you can now register blocks to run at\n  certain points during the Sidekiq process lifecycle: startup, quiet and\n  shutdown.\n```ruby\nSidekiq.configure_server do |config|\n  config.on(:startup) do\n    # do something\n  end\nend\n```\n- **Global Error Handlers** - blocks of code which handle errors that\n  occur anywhere within Sidekiq, not just within middleware.\n```ruby\nSidekiq.configure_server do |config|\n  config.error_handlers << proc {|ex,ctx| ... }\nend\n```\n- **Process Heartbeat** - each Sidekiq process will ping Redis every 5\n  seconds to give a summary of the Sidekiq population at work.\n- The Workers tab is now renamed to Busy and contains a list of live\n  Sidekiq processes and jobs in progress based on the heartbeat.\n- **Shardable Client** - Sidekiq::Client instances can use a custom\n  Redis connection pool, allowing very large Sidekiq installations to scale by\n  sharding: sending different jobs to different Redis instances.\n```ruby\nclient = Sidekiq::Client.new(ConnectionPool.new { Redis.new })\nclient.push(...)\n```\n```ruby\nSidekiq::Client.via(ConnectionPool.new { Redis.new }) do\n  FooWorker.perform_async\n  BarWorker.perform_async\nend\n```\n  **Sharding support does require a breaking change to client-side\nmiddleware, see docs/3.0-Upgrade.md.**\n- New Chinese, Greek, Swedish and Czech translations for the Web UI.\n- Updated most languages translations for the new UI features.\n- **Remove official Capistrano integration** - this integration has been\n  moved into the [capistrano-sidekiq](https://github.com/seuros/capistrano-sidekiq) gem.\n- **Remove official support for MRI 1.9** - Things still might work but\n  I no longer actively test on it.\n- **Remove built-in support for Redis-to-Go**.\n  Heroku users: `heroku config:set REDIS_PROVIDER=REDISTOGO_URL`\n- **Remove built-in error integration for Airbrake, Honeybadger, ExceptionNotifier and Exceptional**.\n  Each error gem should provide its own Sidekiq integration.  Update your error gem to the latest\n  version to pick up Sidekiq support.\n- Upgrade to connection\\_pool 2.0 which now creates connections lazily.\n- Remove deprecated Sidekiq::Client.registered\\_\\* APIs\n- Remove deprecated support for the old Sidekiq::Worker#retries\\_exhausted method.\n- Removed 'sidekiq/yaml\\_patch', this was never documented or recommended.\n- Removed --profile option, #1592\n- Remove usage of the term 'Worker' in the UI for clarity.  Users would call both threads and\n  processes 'workers'.  Instead, use \"Thread\", \"Process\" or \"Job\".\n\n2.17.7\n-----------\n\n- Auto-prune jobs older than one hour from the Workers page [#1508]\n- Add Sidekiq::Workers#prune which can perform the auto-pruning.\n- Fix issue where a job could be lost when an exception occurs updating\n  Redis stats before the job executes [#1511]\n\n2.17.6\n-----------\n\n- Fix capistrano integration due to missing pidfile. [#1490]\n\n2.17.5\n-----------\n\n- Automatically use the config file found at `config/sidekiq.yml`, if not passed `-C`. [#1481]\n- Store 'retried\\_at' and 'failed\\_at' timestamps as Floats, not Strings. [#1473]\n- A `USR2` signal will now reopen _all_ logs, using IO#reopen. Thus, instead of creating a new Logger object,\n  Sidekiq will now just update the existing Logger's file descriptor [#1163].\n- Remove pidfile when shutting down if started with `-P` [#1470]\n\n2.17.4\n-----------\n\n- Fix JID support in inline testing, #1454\n- Polish worker arguments display in UI, #1453\n- Marshal arguments fully to avoid worker mutation, #1452\n- Support reverse paging sorted sets, #1098\n\n\n2.17.3\n-----------\n\n- Synchronously terminates the poller and fetcher to fix a race condition in bulk requeue during shutdown [#1406]\n\n2.17.2\n-----------\n\n- Fix bug where strictly prioritized queues might be processed out of\n  order [#1408]. A side effect of this change is that it breaks a queue\n  declaration syntax that worked, although only because of a bug\u2014it was\n  never intended to work and never supported. If you were declaring your\n  queues as a  comma-separated list, e.g. `sidekiq -q critical,default,low`,\n  you must now use the `-q` flag before each queue, e.g.\n  `sidekiq -q critical -q default -q low`.\n\n2.17.1\n-----------\n\n- Expose `delay` extension as `sidekiq_delay` also.  This allows you to\n  run Delayed::Job and Sidekiq in the same process, selectively porting\n  `delay` calls to `sidekiq_delay`.  You just need to ensure that\n  Sidekiq is required **before** Delayed::Job in your Gemfile. [#1393]\n- Bump redis client required version to 3.0.6\n- Minor CSS fixes for Web UI\n\n2.17.0\n-----------\n\n- Change `Sidekiq::Client#push_bulk` to return an array of pushed `jid`s. [#1315, barelyknown]\n- Web UI refactoring to use more API internally (yummy dogfood!)\n- Much faster Sidekiq::Job#delete performance for larger queue sizes\n- Further capistrano 3 fixes\n- Many misc minor fixes\n\n2.16.1\n-----------\n\n- Revert usage of `resolv-replace`.  MRI's native DNS lookup releases the GIL.\n- Fix several Capistrano 3 issues\n- Escaping dynamic data like job args and error messages in Sidekiq Web UI. [#1299, lian]\n\n2.16.0\n-----------\n\n- Deprecate `Sidekiq::Client.registered_workers` and `Sidekiq::Client.registered_queues`\n- Refactor Sidekiq::Client to be instance-based [#1279]\n- Pass all Redis options to the Redis driver so Unix sockets\n  can be fully configured. [#1270, salimane]\n- Allow sidekiq-web extensions to add locale paths so extensions\n  can be localized. [#1261, ondrejbartas]\n- Capistrano 3 support [#1254, phallstrom]\n- Use Ruby's `resolv-replace` to enable pure Ruby DNS lookups.\n  This ensures that any DNS resolution that takes place in worker\n  threads won't lock up the entire VM on MRI. [#1258]\n\n2.15.2\n-----------\n\n- Iterating over Sidekiq::Queue and Sidekiq::SortedSet will now work as\n  intended when jobs are deleted [#866, aackerman]\n- A few more minor Web UI fixes [#1247]\n\n2.15.1\n-----------\n\n- Fix several Web UI issues with the Bootstrap 3 upgrade.\n\n2.15.0\n-----------\n\n- The Core Sidekiq actors are now monitored.  If any crash, the\n  Sidekiq process logs the error and exits immediately.  This is to\n  help prevent \"stuck\" Sidekiq processes which are running but don't\n  appear to be doing any work. [#1194]\n- Sidekiq's testing behavior is now dynamic.  You can choose between\n  `inline` and `fake` behavior in your tests. See\n[Testing](https://github.com/sidekiq/sidekiq/wiki/Testing) for detail. [#1193]\n- The Retries table has a new column for the error message.\n- The Web UI topbar now contains the status and live poll button.\n- Orphaned worker records are now auto-vacuumed when you visit the\n  Workers page in the Web UI.\n- Sidekiq.default\\_worker\\_options allows you to configure default\n  options for all Sidekiq worker types.\n\n```ruby\nSidekiq.default_worker_options = { 'queue' => 'default', 'backtrace' => true }\n```\n- Added two Sidekiq::Client class methods for compatibility with resque-scheduler:\n  `enqueue_to_in` and `enqueue_in` [#1212]\n- Upgrade Web UI to Bootstrap 3.0. [#1211, jeffboek]\n\n2.14.1\n-----------\n\n- Fix misc Web UI issues due to ERB conversion.\n- Bump redis-namespace version due to security issue.\n\n2.14.0\n-----------\n\n- Removed slim gem dependency, Web UI now uses ERB [Locke23rus, #1120]\n- Fix more race conditions in Web UI actions\n- Don't reset Job enqueued\\_at when retrying\n- Timestamp tooltips in the Web UI should use UTC\n- Fix invalid usage of handle\\_exception causing issues in Airbrake\n  [#1134]\n\n\n2.13.1\n-----------\n\n- Make Sidekiq::Middleware::Chain Enumerable\n- Make summary bar and graphs responsive [manishval, #1025]\n- Adds a job status page for scheduled jobs [jonhyman]\n- Handle race condition in retrying and deleting jobs in the Web UI\n- The Web UI relative times are now i18n. [MadRabbit, #1088]\n- Allow for default number of retry attempts to be set for\n  `Sidekiq::Middleware::Server::RetryJobs` middleware. [czarneckid] [#1091]\n\n```ruby\nSidekiq.configure_server do |config|\n  config.server_middleware do |chain|\n    chain.add Sidekiq::Middleware::Server::RetryJobs, :max_retries => 10\n  end\nend\n```\n\n\n2.13.0\n-----------\n\n- Adding button to move scheduled job to main queue [guiceolin, #1020]\n- fix i18n support resetting saved locale when job is retried [#1011]\n- log rotation via USR2 now closes the old logger [#1008]\n- Add ability to customize retry schedule, like so [jmazzi, #1027]\n\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_retry_in { |count| count * 2 }\nend\n```\n- Redesign Worker#retries\\_exhausted callback to use same form as above [jmazzi, #1030]\n\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_retries_exhausted do |msg|\n    Rails.logger.error \"Failed to process #{msg['class']} with args: #{msg['args']}\"\n  end\nend\n```\n\n2.12.4\n-----------\n\n- Fix error in previous release which crashed the Manager when a\n  Processor died.\n\n2.12.3\n-----------\n\n- Revert back to Celluloid's TaskFiber for job processing which has proven to be more\n  stable than TaskThread. [#985]\n- Avoid possible lockup during hard shutdown [#997]\n\nAt this point, if you are experiencing stability issues with Sidekiq in\nRuby 1.9, please try Ruby 2.0.  It seems to be more stable.\n\n2.12.2\n-----------\n\n- Relax slim version requirement to >= 1.1.0\n- Refactor historical stats to use TTL, not explicit cleanup. [grosser, #971]\n\n2.12.1\n-----------\n\n- Force Celluloid 0.14.1 as 0.14.0 has a serious bug. [#954]\n- Scheduled and Retry jobs now use Sidekiq::Client to push\n  jobs onto the queue, so they use client middleware. [dimko, #948]\n- Record the timestamp when jobs are enqueued. Add\n  Sidekiq::Job#enqueued\\_at to query the time. [mariovisic, #944]\n- Add Sidekiq::Queue#latency - calculates diff between now and\n  enqueued\\_at for the oldest job in the queue.\n- Add testing method `perform_one` that dequeues and performs a single job.\n  This is mainly to aid testing jobs that spawn other jobs. [fumin, #963]\n\n2.12.0\n-----------\n\n- Upgrade to Celluloid 0.14, remove the use of Celluloid's thread\n  pool.  This should halve the number of threads in each Sidekiq\n  process, thus requiring less resources. [#919]\n- Abstract Celluloid usage to Sidekiq::Actor for testing purposes.\n- Better handling for Redis downtime when fetching jobs and shutting\n  down, don't print exceptions every second and print success message\n  when Redis is back.\n- Fix unclean shutdown leading to duplicate jobs [#897]\n- Add Korean locale [#890]\n- Upgrade test suite to Minitest 5\n- Remove usage of `multi_json` as `json` is now robust on all platforms.\n\n2.11.2\n-----------\n\n- Fix Web UI when used without Rails [#886]\n- Add Sidekiq::Stats#reset [#349]\n- Add Norwegian locale.\n- Updates for the JA locale.\n\n2.11.1\n-----------\n\n- Fix timeout warning.\n- Add Dutch web UI locale.\n\n2.11.0\n-----------\n\n- Upgrade to Celluloid 0.13. [#834]\n- Remove **timeout** support from `sidekiq_options`.  Ruby's timeout\n  is inherently unsafe in a multi-threaded application and was causing\n  stability problems for many.  See http://bit.ly/OtYpK\n- Add Japanese locale for Web UI [#868]\n- Fix a few issues with Web UI i18n.\n\n2.10.1\n-----------\n\n- Remove need for the i18n gem. (brandonhilkert)\n- Improve redis connection info logging on startup for debugging\npurposes [#858]\n- Revert sinatra/slim as runtime dependencies\n- Add `find_job` method to sidekiq/api\n\n\n2.10.0\n-----------\n\n- Refactor algorithm for putting scheduled jobs onto the queue [#843]\n- Fix scheduler thread dying due to incorrect error handling [#839]\n- Fix issue which left stale workers if Sidekiq wasn't shutdown while\nquiet. [#840]\n- I18n for web UI.  Please submit translations of `web/locales/en.yml` for\nyour own language. [#811]\n- 'sinatra', 'slim' and 'i18n' are now gem dependencies for Sidekiq.\n\n\n2.9.0\n-----------\n\n- Update 'sidekiq/testing' to work with any Sidekiq::Client call. It\n  also serializes the arguments as using Redis would. [#713]\n- Raise a Sidekiq::Shutdown error within workers which don't finish within the hard\n  timeout.  This is to prevent unwanted database transaction commits. [#377]\n- Lazy load Redis connection pool, you no longer need to specify\n  anything in Passenger or Unicorn's after_fork callback [#794]\n- Add optional Worker#retries_exhausted hook after max retries failed. [jkassemi, #780]\n- Fix bug in pagination link to last page [pitr, #774]\n- Upstart scripts for multiple Sidekiq instances [dariocravero, #763]\n- Use select via pipes instead of poll to catch signals [mrnugget, #761]\n\n2.8.0\n-----------\n\n- I18n support!  Sidekiq can optionally save and restore the Rails locale\n  so it will be properly set when your jobs execute.  Just include\n  `require 'sidekiq/middleware/i18n'` in your sidekiq initializer. [#750]\n- Fix bug which could lose messages when using namespaces and the message\nneeds to be requeued in Redis. [#744]\n- Refactor Redis namespace support [#747].  The redis namespace can no longer be\n  passed via the config file, the only supported way is via Ruby in your\n  initializer:\n\n```ruby\nsidekiq_redis = { :url => 'redis://localhost:3679', :namespace => 'foo' }\nSidekiq.configure_server { |config| config.redis = sidekiq_redis }\nSidekiq.configure_client { |config| config.redis = sidekiq_redis }\n```\n\nA warning is printed out to the log if a namespace is found in your sidekiq.yml.\n\n\n2.7.5\n-----------\n\n- Capistrano no longer uses daemonization in order to work with JRuby [#719]\n- Refactor signal handling to work on Ruby 2.0 [#728, #730]\n- Fix dashboard refresh URL [#732]\n\n2.7.4\n-----------\n\n- Fixed daemonization, was broken by some internal refactoring in 2.7.3 [#727]\n\n2.7.3\n-----------\n\n- Real-time dashboard is now the default web page\n- Make config file optional for capistrano\n- Fix Retry All button in the Web UI\n\n2.7.2\n-----------\n\n- Remove gem signing infrastructure.  It was causing Sidekiq to break\nwhen used via git in Bundler.  This is why we can't have nice things. [#688]\n\n\n2.7.1\n-----------\n\n- Fix issue with hard shutdown [#680]\n\n\n2.7.0\n-----------\n\n- Add -d daemonize flag, capistrano recipe has been updated to use it [#662]\n- Support profiling via `ruby-prof` with -p.  When Sidekiq is stopped\n  via Ctrl-C, it will output `profile.html`.  You must add `gem 'ruby-prof'` to your Gemfile for it to work.\n- Dynamically update Redis stats on dashboard [brandonhilkert]\n- Add Sidekiq::Workers API giving programmatic access to the current\n  set of active workers.\n\n```\nworkers = Sidekiq::Workers.new\nworkers.size => 2\nworkers.each do |name, work|\n  # name is a unique identifier per Processor instance\n  # work is a Hash which looks like:\n  # { 'queue' => name, 'run_at' => timestamp, 'payload' => msg }\nend\n```\n\n- Allow environment-specific sections within the config file which\noverride the global values [dtaniwaki, #630]\n\n```\n---\n:concurrency:  50\n:verbose:      false\nstaging:\n  :verbose:      true\n  :concurrency:  5\n```\n\n\n2.6.5\n-----------\n\n- Several reliability fixes for job requeueing upon termination [apinstein, #622, #624]\n- Fix typo in capistrano recipe\n- Add `retry_queue` option so retries can be given lower priority [ryanlower, #620]\n\n```ruby\nsidekiq_options queue: 'high', retry_queue: 'low'\n```\n\n2.6.4\n-----------\n\n- Fix crash upon empty queue [#612]\n\n2.6.3\n-----------\n\n- sidekiqctl exits with non-zero exit code upon error [jmazzi]\n- better argument validation in Sidekiq::Client [karlfreeman]\n\n2.6.2\n-----------\n\n- Add Dashboard beacon indicating when stats are updated. [brandonhilkert, #606]\n- Revert issue with capistrano restart. [#598]\n\n2.6.1\n-----------\n\n- Dashboard now live updates summary stats also. [brandonhilkert, #605]\n- Add middleware chain APIs `insert_before` and `insert_after` for fine\n  tuning the order of middleware. [jackrg, #595]\n\n2.6.0\n-----------\n\n- Web UI much more mobile friendly now [brandonhilkert, #573]\n- Enable live polling for every section in Web UI [brandonhilkert, #567]\n- Add Stats API [brandonhilkert, #565]\n- Add Stats::History API [brandonhilkert, #570]\n- Add Dashboard to Web UI with live and historical stat graphs [brandonhilkert, #580]\n- Add option to log output to a file, reopen log file on USR2 signal [mrnugget, #581]\n\n2.5.4\n-----------\n\n- `Sidekiq::Client.push` now accepts the worker class as a string so the\n  Sidekiq client does not have to load your worker classes at all.  [#524]\n- `Sidekiq::Client.push_bulk` now works with inline testing.\n- **Really** fix status icon in Web UI this time.\n- Add \"Delete All\" and \"Retry All\" buttons to Retries in Web UI\n\n\n2.5.3\n-----------\n\n- Small Web UI fixes\n- Add `delay_until` so you can delay jobs until a specific timestamp:\n\n```ruby\nAuction.delay_until(@auction.ends_at).close(@auction.id)\n```\n\nThis is identical to the existing Sidekiq::Worker method, `perform_at`.\n\n2.5.2\n-----------\n\n- Remove asset pipeline from Web UI for much faster, simpler runtime.  [#499, #490, #481]\n- Add -g option so the procline better identifies a Sidekiq process, defaults to File.basename(Rails.root). [#486]\n\n    sidekiq 2.5.1 myapp [0 of 25 busy]\n\n- Add splay to retry time so groups of failed jobs don't fire all at once. [#483]\n\n2.5.1\n-----------\n\n- Fix issues with core\\_ext\n\n2.5.0\n-----------\n\n- REDESIGNED WEB UI! [unity, cavneb]\n- Support Honeybadger for error delivery\n- Inline testing runs the client middleware before executing jobs [#465]\n- Web UI can now remove jobs from queue. [#466, dleung]\n- Web UI can now show the full message, not just 100 chars [#464, dleung]\n- Add APIs for manipulating the retry and job queues.  See sidekiq/api. [#457]\n\n\n2.4.0\n-----------\n\n- ActionMailer.delay.method now only tries to deliver if method returns a valid message.\n- Logging now uses \"MSG-#{Job ID}\", not a random msg ID\n- Allow generic Redis provider as environment variable. [#443]\n- Add ability to customize sidekiq\\_options with delay calls [#450]\n\n```ruby\nFoo.delay(:retry => false).bar\nFoo.delay(:retry => 10).bar\nFoo.delay(:timeout => 10.seconds).bar\nFoo.delay_for(5.minutes, :timeout => 10.seconds).bar\n```\n\n2.3.3\n-----------\n\n- Remove option to disable Rails hooks. [#401]\n- Allow delay of any module class method\n\n2.3.2\n-----------\n\n- Fix retry.  2.3.1 accidentally disabled it.\n\n2.3.1\n-----------\n\n- Add Sidekiq::Client.push\\_bulk for bulk adding of jobs to Redis.\n  My own simple test case shows pushing 10,000 jobs goes from 5 sec to 1.5 sec.\n- Add support for multiple processes per host to Capistrano recipe\n- Re-enable Celluloid::Actor#defer to fix stack overflow issues [#398]\n\n2.3.0\n-----------\n\n- Upgrade Celluloid to 0.12\n- Upgrade Twitter Bootstrap to 2.1.0\n- Rescue more Exceptions\n- Change Job ID to be Hex, rather than Base64, for HTTP safety\n- Use `Airbrake#notify_or_ignore`\n\n2.2.1\n-----------\n\n- Add support for custom tabs to Sidekiq::Web [#346]\n- Change capistrano recipe to run 'quiet' before deploy:update\\_code so\n  it is run upon both 'deploy' and 'deploy:migrations'. [#352]\n- Rescue Exception rather than StandardError to catch and log any sort\n  of Processor death.\n\n2.2.0\n-----------\n\n- Roll back Celluloid optimizations in 2.1.0 which caused instability.\n- Add extension to delay any arbitrary class method to Sidekiq.\n  Previously this was limited to ActiveRecord classes.\n\n```ruby\nSomeClass.delay.class_method(1, 'mike', Date.today)\n```\n\n- Sidekiq::Client now generates and returns a random, 128-bit Job ID 'jid' which\n  can be used to track the processing of a Job, e.g. for calling back to a webhook\n  when a job is finished.\n\n2.1.1\n-----------\n\n- Handle networking errors causing the scheduler thread to die [#309]\n- Rework exception handling to log all Processor and actor death (#325, subelsky)\n- Clone arguments when calling worker so modifications are discarded. (#265, hakanensari)\n\n2.1.0\n-----------\n\n- Tune Celluloid to no longer run message processing within a Fiber.\n  This gives us a full Thread stack and also lowers Sidekiq's memory\n  usage.\n- Add pagination within the Web UI [#253]\n- Specify which Redis driver to use: *hiredis* or *ruby* (default)\n- Remove FailureJobs and UniqueJobs, which were optional middleware\n  that I don't want to support in core. [#302]\n\n2.0.3\n-----------\n- Fix sidekiq-web's navbar on mobile devices and windows under 980px (ezkl)\n- Fix Capistrano task for first deploys [#259]\n- Worker subclasses now properly inherit sidekiq\\_options set in\n  their superclass [#221]\n- Add random jitter to scheduler to spread polls across POLL\\_INTERVAL\n  window. [#247]\n- Sidekiq has a new mailing list: sidekiq@librelist.org  See README.\n\n2.0.2\n-----------\n\n- Fix \"Retry Now\" button on individual retry page. (ezkl)\n\n2.0.1\n-----------\n\n- Add \"Clear Workers\" button to UI.  If you kill -9 Sidekiq, the workers\n  set can fill up with stale entries.\n- Update sidekiq/testing to support new scheduled jobs API:\n\n   ```ruby\n   require 'sidekiq/testing'\n   DirectWorker.perform_in(10.seconds, 1, 2)\n   assert_equal 1, DirectWorker.jobs.size\n   assert_in_delta 10.seconds.from_now.to_f, DirectWorker.jobs.last['at'], 0.01\n   ```\n\n2.0.0\n-----------\n\n- **SCHEDULED JOBS**!\n\nYou can now use `perform_at` and `perform_in` to schedule jobs\nto run at arbitrary points in the future, like so:\n\n```ruby\n  SomeWorker.perform_in(5.days, 'bob', 13)\n  SomeWorker.perform_at(5.days.from_now, 'bob', 13)\n```\n\nIt also works with the delay extensions:\n\n```ruby\n  UserMailer.delay_for(5.days).send_welcome_email(user.id)\n```\n\nThe time is approximately when the job will be placed on the queue;\nit is not guaranteed to run at precisely at that moment in time.\n\nThis functionality is meant for one-off, arbitrary jobs.  I still\nrecommend `whenever` or `clockwork` if you want cron-like,\nrecurring jobs.  See `examples/scheduling.rb`\n\nI want to specially thank @yabawock for his work on sidekiq-scheduler.\nHis extension for Sidekiq 1.x filled an obvious functional gap that I now think is\nuseful enough to implement in Sidekiq proper.\n\n- Fixed issues due to Redis 3.x API changes.  Sidekiq now requires\n  the Redis 3.x client.\n- Inline testing now round trips arguments through JSON to catch\n  serialization issues (betelgeuse)\n\n1.2.1\n-----------\n\n- Sidekiq::Worker now has access to Sidekiq's standard logger\n- Fix issue with non-StandardErrors leading to Processor exhaustion\n- Fix issue with Fetcher slowing Sidekiq shutdown\n- Print backtraces for all threads upon TTIN signal [#183]\n- Overhaul retries Web UI with new index page and bulk operations [#184]\n\n1.2.0\n-----------\n\n- Full or partial error backtraces can optionally be stored as part of the retry\n  for display in the web UI if you aren't using an error service. [#155]\n\n```ruby\nclass Worker\n  include Sidekiq::Worker\n  sidekiq_options :backtrace => [true || 10]\nend\n```\n- Add timeout option to kill a worker after N seconds (blackgold9)\n\n```ruby\nclass HangingWorker\n  include Sidekiq::Worker\n  sidekiq_options :timeout => 600\n  def perform\n    # will be killed if it takes longer than 10 minutes\n  end\nend\n```\n\n- Fix delayed extensions not available in workers [#152]\n- In test environments add the `#drain` class method to workers. This method\n  executes all previously queued jobs. (panthomakos)\n- Sidekiq workers can be run inline during tests, just `require 'sidekiq/testing/inline'` (panthomakos)\n- Queues can now be deleted from the Sidekiq web UI [#154]\n- Fix unnecessary shutdown delay due to Retry Poller [#174]\n\n1.1.4\n-----------\n\n- Add 24 hr expiry for basic keys set in Redis, to avoid any possible leaking.\n- Only register workers in Redis while working, to avoid lingering\n  workers [#156]\n- Speed up shutdown significantly.\n\n1.1.3\n-----------\n\n- Better network error handling when fetching jobs from Redis.\n  Sidekiq will retry once per second until it can re-establish\n  a connection. (ryanlecompte)\n- capistrano recipe now uses `bundle_cmd` if set [#147]\n- handle multi\\_json API changes (sferik)\n\n1.1.2\n-----------\n\n- Fix double restart with cap deploy [#137]\n\n1.1.1\n-----------\n\n- Set procline for easy monitoring of Sidekiq status via \"ps aux\"\n- Fix race condition on shutdown [#134]\n- Fix hang with cap sidekiq:start [#131]\n\n1.1.0\n-----------\n\n- The Sidekiq license has switched from GPLv3 to LGPLv3!\n- Sidekiq::Client.push now returns whether the actual Redis\n  operation succeeded or not. [#123]\n- Remove UniqueJobs from the default middleware chain.  Its\n  functionality, while useful, is unexpected for new Sidekiq\n  users.  You can re-enable it with the following config.\n  Read #119 for more discussion.\n\n```ruby\nSidekiq.configure_client do |config|\n  require 'sidekiq/middleware/client/unique_jobs'\n  config.client_middleware do |chain|\n    chain.add Sidekiq::Middleware::Client::UniqueJobs\n  end\nend\nSidekiq.configure_server do |config|\n  require 'sidekiq/middleware/server/unique_jobs'\n  config.server_middleware do |chain|\n    chain.add Sidekiq::Middleware::Server::UniqueJobs\n  end\nend\n```\n\n1.0.0\n-----------\n\nThanks to all Sidekiq users and contributors for helping me\nget to this big milestone!\n\n- Default concurrency on client-side to 5, not 25 so we don't\n  create as many unused Redis connections, same as ActiveRecord's\n  default pool size.\n- Ensure redis= is given a Hash or ConnectionPool.\n\n0.11.2\n-----------\n\n- Implement \"safe shutdown\".  The messages for any workers that\n  are still busy when we hit the TERM timeout will be requeued in\n  Redis so the messages are not lost when the Sidekiq process exits.\n  [#110]\n- Work around Celluloid's small 4kb stack limit [#115]\n- Add support for a custom Capistrano role to limit Sidekiq to\n  a set of machines. [#113]\n\n0.11.1\n-----------\n\n- Fix fetch breaking retry when used with Redis namespaces. [#109]\n- Redis connection now just a plain ConnectionPool, not CP::Wrapper.\n- Capistrano initial deploy fix [#106]\n- Re-implemented weighted queues support (ryanlecompte)\n\n0.11.0\n-----------\n\n- Client-side API changes, added sidekiq\\_options for Sidekiq::Worker.\n  As a side effect of this change, the client API works on Ruby 1.8.\n  It's not officially supported but should work [#103]\n- NO POLL!  Sidekiq no longer polls Redis, leading to lower network\n  utilization and lower latency for message processing.\n- Add --version CLI option\n\n0.10.1\n-----------\n\n- Add details page for jobs in retry queue (jcoene)\n- Display relative timestamps in web interface (jcoene)\n- Capistrano fixes (hinrik, bensie)\n\n0.10.0\n-----------\n\n- Reworked capistrano recipe to make it more fault-tolerant [#94].\n- Automatic failure retry!  Sidekiq will now save failed messages\n  and retry them, with an exponential backoff, over about 20 days.\n  Did a message fail to process?  Just deploy a bug fix in the next\n  few days and Sidekiq will retry the message eventually.\n\n0.9.1\n-----------\n\n- Fix missed deprecations, poor method name in web UI\n\n0.9.0\n-----------\n\n- Add -t option to configure the TERM shutdown timeout\n- TERM shutdown timeout is now configurable, defaults to 5 seconds.\n- USR1 signal now stops Sidekiq from accepting new work,\n  capistrano sends USR1 at start of deploy and TERM at end of deploy\n  giving workers the maximum amount of time to finish.\n- New Sidekiq::Web rack application available\n- Updated Sidekiq.redis API\n\n0.8.0\n-----------\n\n- Remove :namespace and :server CLI options (mperham)\n- Add ExceptionNotifier support (masterkain)\n- Add capistrano support (mperham)\n- Workers now log upon start and finish (mperham)\n- Messages for terminated workers are now automatically requeued (mperham)\n- Add support for Exceptional error reporting (bensie)\n\n0.7.0\n-----------\n\n- Example chef recipe and monitrc script (jc00ke)\n- Refactor global configuration into Sidekiq.configure\\_server and\n  Sidekiq.configure\\_client blocks. (mperham)\n- Add optional middleware FailureJobs which saves failed jobs to a\n  'failed' queue (fbjork)\n- Upon shutdown, workers are now terminated after 5 seconds.  This is to\n  meet Heroku's hard limit of 10 seconds for a process to shutdown. (mperham)\n- Refactor middleware API for simplicity, see sidekiq/middleware/chain. (mperham)\n- Add `delay` extensions for ActionMailer and ActiveRecord. (mperham)\n- Added config file support. See test/config.yml for an example file.  (jc00ke)\n- Added pidfile for tools like monit (jc00ke)\n\n0.6.0\n-----------\n\n- Resque-compatible processing stats in redis (mperham)\n- Simple client testing support in sidekiq/testing (mperham)\n- Plain old Ruby support via the -r cli flag (mperham)\n- Refactored middleware support, introducing ability to add client-side middleware (ryanlecompte)\n- Added middleware for ignoring duplicate jobs (ryanlecompte)\n- Added middleware for displaying jobs in resque-web dashboard (maxjustus)\n- Added redis namespacing support (maxjustus)\n\n0.5.1\n-----------\n\n- Initial release!\n", "# frozen_string_literal: true\n\nmodule Sidekiq\n  VERSION = \"7.0.7\"\n  MAJOR = 7\nend\n", "# frozen_string_literal: true\n\nmodule Sidekiq\n  class WebApplication\n    extend WebRouter\n\n    REDIS_KEYS = %w[redis_version uptime_in_days connected_clients used_memory_human used_memory_peak_human]\n    CSP_HEADER = [\n      \"default-src 'self' https: http:\",\n      \"child-src 'self'\",\n      \"connect-src 'self' https: http: wss: ws:\",\n      \"font-src 'self' https: http:\",\n      \"frame-src 'self'\",\n      \"img-src 'self' https: http: data:\",\n      \"manifest-src 'self'\",\n      \"media-src 'self'\",\n      \"object-src 'none'\",\n      \"script-src 'self' https: http: 'unsafe-inline'\",\n      \"style-src 'self' https: http: 'unsafe-inline'\",\n      \"worker-src 'self'\",\n      \"base-uri 'self'\"\n    ].join(\"; \").freeze\n    METRICS_PERIODS = {\n      \"1h\" => 60,\n      \"2h\" => 120,\n      \"4h\" => 240,\n      \"8h\" => 480\n    }\n\n    def initialize(klass)\n      @klass = klass\n    end\n\n    def settings\n      @klass.settings\n    end\n\n    def self.settings\n      Sidekiq::Web.settings\n    end\n\n    def self.tabs\n      Sidekiq::Web.tabs\n    end\n\n    def self.set(key, val)\n      # nothing, backwards compatibility\n    end\n\n    head \"/\" do\n      # HEAD / is the cheapest heartbeat possible,\n      # it hits Redis to ensure connectivity\n      Sidekiq.redis { |c| c.llen(\"queue:default\") }\n      \"\"\n    end\n\n    get \"/\" do\n      @redis_info = redis_info.select { |k, v| REDIS_KEYS.include? k }\n      days = (params[\"days\"] || 30).to_i\n      return halt(401) if days < 1 || days > 180\n\n      stats_history = Sidekiq::Stats::History.new(days)\n      @processed_history = stats_history.processed\n      @failed_history = stats_history.failed\n\n      erb(:dashboard)\n    end\n\n    get \"/metrics\" do\n      q = Sidekiq::Metrics::Query.new\n      @period = params[:period]\n      @periods = METRICS_PERIODS\n      minutes = @periods.fetch(@period, @periods.values.first)\n      @query_result = q.top_jobs(minutes: minutes)\n      erb(:metrics)\n    end\n\n    get \"/metrics/:name\" do\n      @name = route_params[:name]\n      @period = params[:period]\n      q = Sidekiq::Metrics::Query.new\n      @periods = METRICS_PERIODS\n      minutes = @periods.fetch(@period, @periods.values.first)\n      @query_result = q.for_job(@name, minutes: minutes)\n      erb(:metrics_for_job)\n    end\n\n    get \"/busy\" do\n      @count = (params[\"count\"] || 100).to_i\n      (@current_page, @total_size, @workset) = page_items(workset, params[\"page\"], @count)\n\n      erb(:busy)\n    end\n\n    post \"/busy\" do\n      if params[\"identity\"]\n        pro = Sidekiq::ProcessSet[params[\"identity\"]]\n\n        pro.quiet! if params[\"quiet\"]\n        pro.stop! if params[\"stop\"]\n      else\n        processes.each do |pro|\n          next if pro.embedded?\n\n          pro.quiet! if params[\"quiet\"]\n          pro.stop! if params[\"stop\"]\n        end\n      end\n\n      redirect \"#{root_path}busy\"\n    end\n\n    get \"/queues\" do\n      @queues = Sidekiq::Queue.all\n\n      erb(:queues)\n    end\n\n    QUEUE_NAME = /\\A[a-z_:.\\-0-9]+\\z/i\n\n    get \"/queues/:name\" do\n      @name = route_params[:name]\n\n      halt(404) if !@name || @name !~ QUEUE_NAME\n\n      @count = (params[\"count\"] || 25).to_i\n      @queue = Sidekiq::Queue.new(@name)\n      (@current_page, @total_size, @jobs) = page(\"queue:#{@name}\", params[\"page\"], @count, reverse: params[\"direction\"] == \"asc\")\n      @jobs = @jobs.map { |msg| Sidekiq::JobRecord.new(msg, @name) }\n\n      erb(:queue)\n    end\n\n    post \"/queues/:name\" do\n      queue = Sidekiq::Queue.new(route_params[:name])\n\n      if Sidekiq.pro? && params[\"pause\"]\n        queue.pause!\n      elsif Sidekiq.pro? && params[\"unpause\"]\n        queue.unpause!\n      else\n        queue.clear\n      end\n\n      redirect \"#{root_path}queues\"\n    end\n\n    post \"/queues/:name/delete\" do\n      name = route_params[:name]\n      Sidekiq::JobRecord.new(params[\"key_val\"], name).delete\n\n      redirect_with_query(\"#{root_path}queues/#{CGI.escape(name)}\")\n    end\n\n    get \"/morgue\" do\n      @count = (params[\"count\"] || 25).to_i\n      (@current_page, @total_size, @dead) = page(\"dead\", params[\"page\"], @count, reverse: true)\n      @dead = @dead.map { |msg, score| Sidekiq::SortedEntry.new(nil, score, msg) }\n\n      erb(:morgue)\n    end\n\n    get \"/morgue/:key\" do\n      key = route_params[:key]\n      halt(404) unless key\n\n      @dead = Sidekiq::DeadSet.new.fetch(*parse_params(key)).first\n\n      if @dead.nil?\n        redirect \"#{root_path}morgue\"\n      else\n        erb(:dead)\n      end\n    end\n\n    post \"/morgue\" do\n      redirect(request.path) unless params[\"key\"]\n\n      params[\"key\"].each do |key|\n        job = Sidekiq::DeadSet.new.fetch(*parse_params(key)).first\n        retry_or_delete_or_kill job, params if job\n      end\n\n      redirect_with_query(\"#{root_path}morgue\")\n    end\n\n    post \"/morgue/all/delete\" do\n      Sidekiq::DeadSet.new.clear\n\n      redirect \"#{root_path}morgue\"\n    end\n\n    post \"/morgue/all/retry\" do\n      Sidekiq::DeadSet.new.retry_all\n\n      redirect \"#{root_path}morgue\"\n    end\n\n    post \"/morgue/:key\" do\n      key = route_params[:key]\n      halt(404) unless key\n\n      job = Sidekiq::DeadSet.new.fetch(*parse_params(key)).first\n      retry_or_delete_or_kill job, params if job\n\n      redirect_with_query(\"#{root_path}morgue\")\n    end\n\n    get \"/retries\" do\n      @count = (params[\"count\"] || 25).to_i\n      (@current_page, @total_size, @retries) = page(\"retry\", params[\"page\"], @count)\n      @retries = @retries.map { |msg, score| Sidekiq::SortedEntry.new(nil, score, msg) }\n\n      erb(:retries)\n    end\n\n    get \"/retries/:key\" do\n      @retry = Sidekiq::RetrySet.new.fetch(*parse_params(route_params[:key])).first\n\n      if @retry.nil?\n        redirect \"#{root_path}retries\"\n      else\n        erb(:retry)\n      end\n    end\n\n    post \"/retries\" do\n      redirect(request.path) unless params[\"key\"]\n\n      params[\"key\"].each do |key|\n        job = Sidekiq::RetrySet.new.fetch(*parse_params(key)).first\n        retry_or_delete_or_kill job, params if job\n      end\n\n      redirect_with_query(\"#{root_path}retries\")\n    end\n\n    post \"/retries/all/delete\" do\n      Sidekiq::RetrySet.new.clear\n\n      redirect \"#{root_path}retries\"\n    end\n\n    post \"/retries/all/retry\" do\n      Sidekiq::RetrySet.new.retry_all\n\n      redirect \"#{root_path}retries\"\n    end\n\n    post \"/retries/all/kill\" do\n      Sidekiq::RetrySet.new.kill_all\n\n      redirect \"#{root_path}retries\"\n    end\n\n    post \"/retries/:key\" do\n      job = Sidekiq::RetrySet.new.fetch(*parse_params(route_params[:key])).first\n\n      retry_or_delete_or_kill job, params if job\n\n      redirect_with_query(\"#{root_path}retries\")\n    end\n\n    get \"/scheduled\" do\n      @count = (params[\"count\"] || 25).to_i\n      (@current_page, @total_size, @scheduled) = page(\"schedule\", params[\"page\"], @count)\n      @scheduled = @scheduled.map { |msg, score| Sidekiq::SortedEntry.new(nil, score, msg) }\n\n      erb(:scheduled)\n    end\n\n    get \"/scheduled/:key\" do\n      @job = Sidekiq::ScheduledSet.new.fetch(*parse_params(route_params[:key])).first\n\n      if @job.nil?\n        redirect \"#{root_path}scheduled\"\n      else\n        erb(:scheduled_job_info)\n      end\n    end\n\n    post \"/scheduled\" do\n      redirect(request.path) unless params[\"key\"]\n\n      params[\"key\"].each do |key|\n        job = Sidekiq::ScheduledSet.new.fetch(*parse_params(key)).first\n        delete_or_add_queue job, params if job\n      end\n\n      redirect_with_query(\"#{root_path}scheduled\")\n    end\n\n    post \"/scheduled/:key\" do\n      key = route_params[:key]\n      halt(404) unless key\n\n      job = Sidekiq::ScheduledSet.new.fetch(*parse_params(key)).first\n      delete_or_add_queue job, params if job\n\n      redirect_with_query(\"#{root_path}scheduled\")\n    end\n\n    get \"/dashboard/stats\" do\n      redirect \"#{root_path}stats\"\n    end\n\n    get \"/stats\" do\n      sidekiq_stats = Sidekiq::Stats.new\n      redis_stats = redis_info.select { |k, v| REDIS_KEYS.include? k }\n      json(\n        sidekiq: {\n          processed: sidekiq_stats.processed,\n          failed: sidekiq_stats.failed,\n          busy: sidekiq_stats.workers_size,\n          processes: sidekiq_stats.processes_size,\n          enqueued: sidekiq_stats.enqueued,\n          scheduled: sidekiq_stats.scheduled_size,\n          retries: sidekiq_stats.retry_size,\n          dead: sidekiq_stats.dead_size,\n          default_latency: sidekiq_stats.default_queue_latency\n        },\n        redis: redis_stats,\n        server_utc_time: server_utc_time\n      )\n    end\n\n    get \"/stats/queues\" do\n      json Sidekiq::Stats.new.queues\n    end\n\n    def call(env)\n      action = self.class.match(env)\n      return [404, {\"content-type\" => \"text/plain\", \"x-cascade\" => \"pass\"}, [\"Not Found\"]] unless action\n\n      app = @klass\n      resp = catch(:halt) do\n        self.class.run_befores(app, action)\n        action.instance_exec env, &action.block\n      ensure\n        self.class.run_afters(app, action)\n      end\n\n      case resp\n      when Array\n        # redirects go here\n        resp\n      else\n        # rendered content goes here\n        headers = {\n          \"content-type\" => \"text/html\",\n          \"cache-control\" => \"private, no-store\",\n          \"content-language\" => action.locale,\n          \"content-security-policy\" => CSP_HEADER\n        }\n        # we'll let Rack calculate Content-Length for us.\n        [200, headers, [resp]]\n      end\n    end\n\n    def self.helpers(mod = nil, &block)\n      if block\n        WebAction.class_eval(&block)\n      else\n        WebAction.send(:include, mod)\n      end\n    end\n\n    def self.before(path = nil, &block)\n      befores << [path && Regexp.new(\"\\\\A#{path.gsub(\"*\", \".*\")}\\\\z\"), block]\n    end\n\n    def self.after(path = nil, &block)\n      afters << [path && Regexp.new(\"\\\\A#{path.gsub(\"*\", \".*\")}\\\\z\"), block]\n    end\n\n    def self.run_befores(app, action)\n      run_hooks(befores, app, action)\n    end\n\n    def self.run_afters(app, action)\n      run_hooks(afters, app, action)\n    end\n\n    def self.run_hooks(hooks, app, action)\n      hooks.select { |p, _| !p || p =~ action.env[WebRouter::PATH_INFO] }\n        .each { |_, b| action.instance_exec(action.env, app, &b) }\n    end\n\n    def self.befores\n      @befores ||= []\n    end\n\n    def self.afters\n      @afters ||= []\n    end\n  end\nend\n"], "fixing_code": ["# Sidekiq Changes\n\n[Sidekiq Changes](https://github.com/sidekiq/sidekiq/blob/main/Changes.md) | [Sidekiq Pro Changes](https://github.com/sidekiq/sidekiq/blob/main/Pro-Changes.md) | [Sidekiq Enterprise Changes](https://github.com/sidekiq/sidekiq/blob/main/Ent-Changes.md)\n\n7.0.8\n----------\n\n- **SECURITY** Sanitize `period` input parameter on Metrics pages.\n  Specially crafted values can lead to XSS. This functionality\n  was introduced in 7.0.4. Thank you to spercex @ huntr.dev [#5694]\n- Add job hash as 3rd parameter to the `sidekiq_retry_in` block.\n\n7.0.7\n----------\n\n- Fix redis-client API usage which could result in stuck Redis\nconnections [#5823]\n- Fix AS::Duration with `sidekiq_retry_in` [#5806]\n- Restore dumping config options on startup with `-v` [#5822]\n\n7.0.5,7.0.6\n----------\n\n- More context for debugging json unsafe errors [#5787]\n\n7.0.4\n----------\n\n- Performance and memory optimizations [#5768, fatkodima]\n- Add 1-8 hour period selector to Metrics pages [#5694]\n- Fix process display with `sidekiqmon` [#5733]\n\n7.0.3\n----------\n\n- Don't warn about memory policy on Redis Enterprise [#5712]\n- Don't allow Quiet/Stop on embedded Sidekiq instances [#5716]\n- Fix `size: X` for configuring the default Redis pool size [#5702]\n- Improve the display of queue weights on Busy page [#5642]\n- Freeze CurrentAttributes on a job once initially set [#5692]\n\n7.0.2\n----------\n\n- Improve compatibility with custom loggers [#5673]\n- Add queue weights on Busy page [#5640]\n- Add BID link on job_info page if job is part of a Batch [#5623]\n- Allow custom extensions to add rows/links within Job detail pages [#5624]\n```ruby\nSidekiq::Web.custom_job_info_rows << AddAccountLink.new\n\nclass AddAccountLink\n  include CGI::Util\n  def add_pair(job)\n    # yield a (name, value) pair\n    # You can include HTML tags and CSS, Sidekiq does not do any\n    # escaping so beware user data injection! Note how we use CGI's\n    # `h` escape helper.\n    aid = job[\"account_id\"]\n    yield \"Account\", \"<a href='/accounts/#{h aid}'>#{h aid}</a>\" if aid\n  end\nend\n```\n\n7.0.1\n----------\n\n- Allow an embedding process to reuse its own heartbeat thread\n- Update zh-cn localization\n\n7.0.0\n----------\n\n- Embedded mode!\n- Capsules!!\n- Job Execution metrics!!!\n- See `docs/7.0-Upgrade.md` for release notes\n\n6.5.8\n----------\n\n- Fail if using a bad version of scout_apm [#5616]\n- Add pagination to Busy page [#5556]\n- Speed up WorkSet#each [#5559]\n- Adjust CurrentAttributes to work with the String class name so we aren't referencing the Class within a Rails initializer [#5536]\n\n6.5.7\n----------\n\n- Updates for JA and ZH locales\n- Further optimizations for scheduled polling [#5513]\n\n6.5.6\n----------\n\n- Fix deprecation warnings with redis-rb 4.8.0 [#5484]\n- Lock redis-rb to < 5.0 as we are moving to redis-client in Sidekiq 7.0\n\n6.5.5\n----------\n\n- Fix require issue with job_retry.rb [#5462]\n- Improve Sidekiq::Web compatibility with Rack 3.x\n\n6.5.4\n----------\n\n- Fix invalid code on Ruby 2.5 [#5460]\n- Fix further metrics dependency issues [#5457]\n\n6.5.3\n----------\n\n- Don't require metrics code without explicit opt-in [#5456]\n\n6.5.2\n----------\n\n- [Job Metrics are under active development, help wanted!](https://github.com/sidekiq/sidekiq/wiki/Metrics#contributing) **BETA**\n- Add `Context` column on queue page which shows any CurrentAttributes [#5450]\n- `sidekiq_retry_in` may now return `:discard` or `:kill` to dynamically stop job retries [#5406]\n- Smarter sorting of processes in /busy Web UI [#5398]\n- Fix broken hamburger menu in mobile UI [#5428]\n- Require redis-rb 4.5.0. Note that Sidekiq will break if you use the\n  [`Redis.exists_returns_integer = false`](https://github.com/redis/redis-rb/blob/master/CHANGELOG.md#450) flag. [#5394]\n\n6.5.1\n----------\n\n- Fix `push_bulk` breakage [#5387]\n\n6.5.0\n---------\n\n- Substantial refactoring of Sidekiq server internals, part of a larger effort\n  to reduce Sidekiq's internal usage of global methods and data, see [docs/global_to_local.md](docs/global_to_local.md) and [docs/middleware.md](docs/middleware.md).\n- **Add beta support for the `redis-client` gem**. This will become the default Redis driver in Sidekiq 7.0. [#5298]\n  Read more: https://github.com/sidekiq/sidekiq/wiki/Using-redis-client\n- **Add beta support for DB transaction-aware client** [#5291]\n  Add this line to your initializer and any jobs created during a transaction\n  will only be pushed to Redis **after the transaction commits**. You will need to add the\n  `after_commit_everywhere` gem to your Gemfile.\n```ruby\nSidekiq.transactional_push!\n```\n  This feature does not have a lot of production usage yet; please try it out and let us\n  know if you have any issues. It will be fully supported in Sidekiq 7.0 or removed if it\n  proves problematic.\n- Fix regression with middleware arguments [#5312]\n\n6.4.2\n---------\n\n- Strict argument checking now runs after client-side middleware [#5246]\n- Fix page events with live polling [#5184]\n- Many under-the-hood changes to remove all usage of the term \"worker\"\n  from the Sidekiq codebase and APIs. This mostly involved RDoc and local\n  variable names but a few constants and public APIs were changed. The old\n  APIs will be removed in Sidekiq 7.0.\n```\nSidekiq::DEFAULT_WORKER_OPTIONS -> Sidekiq.default_job_options\nSidekiq.default_worker_options -> Sidekiq.default_job_options\nSidekiq::Queues[\"default\"].jobs_by_worker(HardJob) -> Sidekiq::Queues[\"default\"].jobs_by_class(HardJob)\n```\n\n6.4.1\n---------\n\n- Fix pipeline/multi deprecations in redis-rb 4.6\n- Fix sidekiq.yml YAML load errors on Ruby 3.1 [#5141]\n- Sharding support for `perform_bulk` [#5129]\n- Refactor job logger for SPEEEEEEED\n\n6.4.0\n---------\n\n- **SECURITY**: Validate input to avoid possible DoS in Web UI.\n- Add **strict argument checking** [#5071]\n  Sidekiq will now log a warning if JSON-unsafe arguments are passed to `perform_async`.\n  Add `Sidekiq.strict_args!(false)` to your initializer to disable this warning.\n  This warning will switch to an exception in Sidekiq 7.0.\n- Note that Delayed Extensions will be removed in Sidekiq 7.0 [#5076]\n- Add `perform_{inline,sync}` in Sidekiq::Job to run a job synchronously [#5061, hasan-ally]\n```ruby\nSomeJob.perform_async(args...)\nSomeJob.perform_sync(args...)\nSomeJob.perform_inline(args...)\n```\n  You can also dynamically redirect a job to run synchronously:\n```ruby\nSomeJob.set(\"sync\": true).perform_async(args...) # will run via perform_inline\n```\n- Replace Sidekiq::Worker `app/workers` generator with Sidekiq::Job `app/sidekiq` generator [#5055]\n```\nbin/rails generate sidekiq:job ProcessOrderJob\n```\n- Fix job retries losing CurrentAttributes [#5090]\n- Tweak shutdown to give long-running threads time to cleanup [#5095]\n\n6.3.1\n---------\n\n- Fix keyword arguments error with CurrentAttributes on Ruby 3.0 [#5048]\n\n6.3.0\n---------\n\n- **BREAK**: The Web UI has been refactored to remove jQuery. Any UI extensions\n  which use jQuery will break.\n- **FEATURE**: Sidekiq.logger has been enhanced so any `Rails.logger`\n  output in jobs now shows up in the Sidekiq console. Remove any logger\n  hacks in your initializer and see if it Just Works\u2122 now. [#5021]\n- **FEATURE**: Add `Sidekiq::Job` alias for `Sidekiq::Worker`, to better\n  reflect industry standard terminology. You can now do this:\n```ruby\nclass MyJob\n  include Sidekiq::Job\n  sidekiq_options ...\n  def perform(args)\n  end\nend\n```\n- **FEATURE**: Support for serializing ActiveSupport::CurrentAttributes into each job. [#4982]\n```ruby\n# config/initializers/sidekiq.rb\nrequire \"sidekiq/middleware/current_attributes\"\nSidekiq::CurrentAttributes.persist(Myapp::Current) # Your AS::CurrentAttributes singleton\n```\n- **FEATURE**: Add `Sidekiq::Worker.perform_bulk` for enqueuing jobs in bulk,\n  similar to `Sidekiq::Client.push_bulk` [#5042]\n```ruby\nMyJob.perform_bulk([[1], [2], [3]])\n```\n- Implement `queue_as`, `wait` and `wait_until` for ActiveJob compatibility [#5003]\n- Scheduler now uses Lua to reduce Redis load and network roundtrips [#5044]\n- Retry Redis operation if we get an `UNBLOCKED` Redis error [#4985]\n- Run existing signal traps, if any, before running Sidekiq's trap [#4991]\n- Fix fetch bug when using weighted queues which caused Sidekiq to stop\n  processing queues randomly [#5031]\n\n6.2.2\n---------\n\n- Reduce retry jitter, add jitter to `sidekiq_retry_in` values [#4957]\n- Minimize scheduler load on Redis at scale [#4882]\n- Improve logging of delay jobs [#4904, BuonOno]\n- Minor CSS improvements for buttons and tables, design PRs always welcome!\n- Tweak Web UI `Cache-Control` header [#4966]\n- Rename internal API class `Sidekiq::Job` to `Sidekiq::JobRecord` [#4955]\n\n6.2.1\n---------\n\n- Update RTT warning logic to handle transient RTT spikes [#4851]\n- Fix very low priority CVE on unescaped queue name [#4852]\n- Add note about sessions and Rails apps in API mode\n\n6.2.0\n---------\n\n- Store Redis RTT and log if poor [#4824]\n- Add process/thread stats to Busy page [#4806]\n- Improve Web UI on mobile devices [#4840]\n- **Refactor Web UI session usage** [#4804]\n  Numerous people have hit \"Forbidden\" errors and struggled with Sidekiq's\n  Web UI session requirement. If you have code in your initializer for\n  Web sessions, it's quite possible it will need to be removed. Here's\n  an overview:\n```\nSidekiq::Web needs a valid Rack session for CSRF protection. If this is a Rails app,\nmake sure you mount Sidekiq::Web *inside* your routes in `config/routes.rb` so\nSidekiq can reuse the Rails session:\n\n  Rails.application.routes.draw do\n    mount Sidekiq::Web => \"/sidekiq\"\n    ....\n  end\n\nIf this is a bare Rack app, use a session middleware before Sidekiq::Web:\n\n  # first, use IRB to create a shared secret key for sessions and commit it\n  require 'securerandom'; File.open(\".session.key\", \"w\") {|f| f.write(SecureRandom.hex(32)) }\n\n  # now, update your Rack app to include the secret with a session cookie middleware\n  use Rack::Session::Cookie, secret: File.read(\".session.key\"), same_site: true, max_age: 86400\n  run Sidekiq::Web\n\nIf this is a Rails app in API mode, you need to enable sessions.\n\n  https://guides.rubyonrails.org/api_app.html#using-session-middlewares\n```\n\n6.1.3\n---------\n\n- Warn if Redis is configured to evict data under memory pressure [#4752]\n- Add process RSS on the Busy page [#4717]\n\n6.1.2\n---------\n\n- Improve readability in dark mode Web UI [#4674]\n- Fix Web UI crash with corrupt session [#4672]\n- Allow middleware to yield arguments [#4673, @eugeneius]\n- Migrate CI from CircleCI to GitHub Actions [#4677]\n\n6.1.1\n---------\n\n- Jobs are now sorted by age in the Busy Workers table. [#4641]\n- Fix \"check all\" JS logic in Web UI [#4619]\n\n6.1.0\n---------\n\n- Web UI - Dark Mode fixes [#4543, natematykiewicz]\n- Ensure `Rack::ContentLength` is loaded as middleware for correct Web UI responses [#4541]\n- Avoid exception dumping SSL store in Redis connection logging [#4532]\n- Better error messages in Sidekiq::Client [#4549]\n- Remove rack-protection, reimplement CSRF protection [#4588]\n- Require redis-rb 4.2 [#4591]\n- Update to jquery 1.12.4 [#4593]\n- Refactor internal fetch logic and API [#4602]\n\n6.0.7\n---------\n\n- Refactor systemd integration to work better with custom binaries [#4511]\n- Don't connect to Redis at process exit if not needed [#4502]\n- Remove Redis connection naming [#4479]\n- Fix Redis Sentinel password redaction [#4499]\n- Add Vietnamese locale (vi) [#4528]\n\n6.0.6\n---------\n\n- **Integrate with systemd's watchdog and notification features** [#4488]\n  Set `Type=notify` in [sidekiq.service](https://github.com/sidekiq/sidekiq/blob/4b8a8bd3ae42f6e48ae1fdaf95ed7d7af18ed8bb/examples/systemd/sidekiq.service#L30-L39). The integration works automatically.\n- Use `setTimeout` rather than `setInterval` to avoid thundering herd [#4480]\n- Fix edge case where a job can be pushed without a queue.\n- Flush job stats at exit [#4498]\n- Check RAILS_ENV before RACK_ENV [#4493]\n- Add Lithuanian locale [#4476]\n\n6.0.5\n---------\n\n- Fix broken Web UI response when using NewRelic and Rack 2.1.2+. [#4440]\n- Update APIs to use `UNLINK`, not `DEL`. [#4449]\n- Fix Ruby 2.7 warnings [#4412]\n- Add support for `APP_ENV` [[95fa5d9]](https://github.com/sidekiq/sidekiq/commit/95fa5d90192148026e52ca2902f1b83c70858ce8)\n\n6.0.4\n---------\n\n- Fix ActiveJob's `sidekiq_options` integration [#4404]\n- Sidekiq Pro users will now see a Pause button next to each queue in\n  the Web UI, allowing them to pause queues manually [#4374, shayonj]\n- Fix Sidekiq::Workers API unintentional change in 6.0.2 [#4387]\n\n\n6.0.3\n---------\n\n- Fix `Sidekiq::Client.push_bulk` API which was erroneously putting\n  invalid `at` values in the job payloads [#4321]\n\n6.0.2\n---------\n\n- Fix Sidekiq Enterprise's rolling restart functionality, broken by refactoring in 6.0.0. [#4334]\n- More internal refactoring and performance tuning [fatkodima]\n\n6.0.1\n---------\n\n- **Performance tuning**, Sidekiq should be 10-15% faster now [#4303, 4299,\n  4269, fatkodima]\n- **Dark Mode support in Web UI** (further design polish welcome!) [#4227, mperham,\n  fatkodima, silent-e]\n- **Job-specific log levels**, allowing you to turn on debugging for\n  problematic workers. [fatkodima, #4287]\n```ruby\nMyWorker.set(log_level: :debug).perform_async(...)\n```\n- **Ad-hoc job tags**. You can tag your jobs with, e.g, subdomain, tenant, country,\n  locale, application, version, user/client, \"alpha/beta/pro/ent\", types of jobs,\n  teams/people responsible for jobs, additional metadata, etc.\n  Tags are shown on different pages with job listings. Sidekiq Pro users\n  can filter based on them [fatkodima, #4280]\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_options tags: ['bank-ops', 'alpha']\n  ...\nend\n```\n- Fetch scheduled jobs in batches before pushing into specific queues.\n  This will decrease enqueueing time of scheduled jobs by a third. [fatkodima, #4273]\n```\nScheduledSet with 10,000 jobs\nBefore: 56.6 seconds\nAfter:  39.2 seconds\n```\n- Compress error backtraces before pushing into Redis, if you are\n  storing error backtraces, this will halve the size of your RetrySet\n  in Redis [fatkodima, #4272]\n```\nRetrySet with 100,000 jobs\nBefore: 261 MB\nAfter:  129 MB\n```\n- Support display of ActiveJob 6.0 payloads in the Web UI [#4263]\n- Add `SortedSet#scan` for pattern based scanning. For large sets this API will be **MUCH** faster\n  than standard iteration using each. [fatkodima, #4262]\n```ruby\n  Sidekiq::DeadSet.new.scan(\"UnreliableApi\") do |job|\n    job.retry\n  end\n```\n- Dramatically speed up SortedSet#find\\_job(jid) by using Redis's ZSCAN\n  support, approx 10x faster. [fatkodima, #4259]\n```\nzscan   0.179366   0.047727   0.227093 (  1.161376)\nenum    8.522311   0.419826   8.942137 (  9.785079)\n```\n- Respect rails' generators `test_framework` option and gracefully handle extra `worker` suffix on generator [fatkodima, #4256]\n- Add ability to sort 'Enqueued' page on Web UI by position in the queue [fatkodima, #4248]\n- Support `Client.push_bulk` with different delays [fatkodima, #4243]\n```ruby\nSidekiq::Client.push_bulk(\"class\" => FooJob, \"args\" => [[1], [2]], \"at\" => [1.minute.from_now.to_f, 5.minutes.from_now.to_f])\n```\n- Easier way to test enqueuing specific ActionMailer and ActiveRecord delayed jobs. Instead of manually\n  parsing embedded class, you can now test by fetching jobs for specific classes. [fatkodima, #4292]\n```ruby\nassert_equal 1, Sidekiq::Extensions::DelayedMailer.jobs_for(FooMailer).size\n```\n- Add `sidekiqmon` to gemspec executables [#4242]\n- Gracefully handle `Sidekiq.logger = nil` [#4240]\n- Inject Sidekiq::LogContext module if user-supplied logger does not include it [#4239]\n\n6.0\n---------\n\nThis release has major breaking changes.  Read and test carefully in production.\n\n- With Rails 6.0.2+, ActiveJobs can now use `sidekiq_options` directly to configure Sidekiq\n  features/internals like the retry subsystem. [#4213, pirj]\n```ruby\nclass MyJob < ActiveJob::Base\n  queue_as :myqueue\n  sidekiq_options retry: 10, backtrace: 20\n  def perform(...)\n  end\nend\n```\n- Logging has been redesigned to allow for pluggable log formatters:\n```ruby\nSidekiq.configure_server do |config|\n  config.log_formatter = Sidekiq::Logger::Formatters::JSON.new\nend\n```\nSee the [Logging wiki page](https://github.com/sidekiq/sidekiq/wiki/Logging) for more details.\n- **BREAKING CHANGE** Validate proper usage of the `REDIS_PROVIDER`\n  variable.  This variable is meant to hold the name of the environment\n  variable which contains your Redis URL, so that you can switch Redis\n  providers quickly and easily with a single variable change.  It is not\n  meant to hold the actual Redis URL itself.  If you want to manually set\n  the Redis URL (not recommended as it implies you have no failover),\n  then you may set `REDIS_URL` directly. [#3969]\n- **BREAKING CHANGE** Increase default shutdown timeout from 8 seconds\n  to 25 seconds.  Both Heroku and ECS now use 30 second shutdown timeout\n  by default and we want Sidekiq to take advantage of this time.  If you\n  have deployment scripts which depend on the old default timeout, use `-t 8` to\n  get the old behavior. [#3968]\n- **BREAKING CHANGE** Remove the daemonization, logfile and pidfile\n  arguments to Sidekiq. Use a proper process supervisor (e.g. systemd or\n  foreman) to manage Sidekiq.  See the Deployment wiki page for links to\n  more resources.\n- Integrate the StandardRB code formatter to ensure consistent code\n  styling. [#4114, gearnode]\n\n5.2.10\n---------\n\n- Backport fix for CVE-2022-23837.\n- Migrate to `exists?` for redis-rb.\n- Lock redis-rb to <4.6 to avoid deprecations.\n\n5.2.9\n---------\n\n- Release Rack lock due to a cascade of CVEs. [#4566]\n  Pro-tip: don't lock Rack.\n\n5.2.8\n---------\n\n- Lock to Rack 2.0.x to prevent future incompatibilities\n- Fix invalid reference in `sidekiqctl`\n\n5.2.7\n---------\n\n- Fix stale `enqueued_at` when retrying [#4149]\n- Move build to [Circle CI](https://circleci.com/gh/mperham/sidekiq) [#4120]\n\n5.2.6\n---------\n\n- Fix edge case where a job failure during Redis outage could result in a lost job [#4141]\n- Better handling of malformed job arguments in payload [#4095]\n- Restore bootstap's dropdown css component [#4099, urkle]\n- Display human-friendly time diff for longer queue latencies [#4111, interlinked]\n- Allow `Sidekiq::Worker#set` to be chained\n\n5.2.5\n---------\n\n- Fix default usage of `config/sidekiq.yml` [#4077, Tensho]\n\n5.2.4\n---------\n\n- Add warnings for various deprecations and changes coming in Sidekiq 6.0.\n  See the 6-0 branch. [#4056]\n- Various improvements to the Sidekiq test suite and coverage [#4026, #4039, Tensho]\n\n5.2.3\n---------\n\n- Warning message on invalid REDIS\\_PROVIDER [#3970]\n- Add `sidekiqctl status` command [#4003, dzunk]\n- Update elapsed time calculatons to use monotonic clock [#3999]\n- Fix a few issues with mobile Web UI styling [#3973, navied]\n- Jobs with `retry: false` now go through the global `death_handlers`,\n  meaning you can take action on failed ephemeral jobs. [#3980, Benjamin-Dobell]\n- Fix race condition in defining Workers. [#3997, mattbooks]\n\n5.2.2\n---------\n\n- Raise error for duplicate queue names in config to avoid unexpected fetch algorithm change [#3911]\n- Fix concurrency bug on JRuby [#3958, mattbooks]\n- Add \"Kill All\" button to the retries page [#3938]\n\n5.2.1\n-----------\n\n- Fix concurrent modification error during heartbeat [#3921]\n\n5.2.0\n-----------\n\n- **Decrease default concurrency from 25 to 10** [#3892]\n- Verify connection pool sizing upon startup [#3917]\n- Smoother scheduling for large Sidekiq clusters [#3889]\n- Switch Sidekiq::Testing impl from alias\\_method to Module#prepend, for resiliency [#3852]\n- Update Sidekiq APIs to use SCAN for scalability [#3848, ffiller]\n- Remove concurrent-ruby gem dependency [#3830]\n- Optimize Web UI's bootstrap.css [#3914]\n\n5.1.3\n-----------\n\n- Fix version comparison so Ruby 2.2.10 works. [#3808, nateberkopec]\n\n5.1.2\n-----------\n\n- Add link to docs in Web UI footer\n- Fix crash on Ctrl-C in Windows [#3775, Bernica]\n- Remove `freeze` calls on String constants. This is superfluous with Ruby\n  2.3+ and `frozen_string_literal: true`. [#3759]\n- Fix use of AR middleware outside of Rails [#3787]\n- Sidekiq::Worker `sidekiq_retry_in` block can now return nil or 0 to use\n  the default backoff delay [#3796, dsalahutdinov]\n\n5.1.1\n-----------\n\n- Fix Web UI incompatibility with Redis 3.x gem [#3749]\n\n5.1.0\n-----------\n\n- **NEW** Global death handlers - called when your job exhausts all\n  retries and dies.  Now you can take action when a job fails permanently. [#3721]\n- **NEW** Enable ActiveRecord query cache within jobs by default [#3718, sobrinho]\n  This will prevent duplicate SELECTS; cache is cleared upon any UPDATE/INSERT/DELETE.\n  See the issue for how to bypass the cache or disable it completely.\n- Scheduler timing is now more accurate, 15 -> 5 seconds [#3734]\n- Exceptions during the :startup event will now kill the process [#3717]\n- Make `Sidekiq::Client.via` reentrant [#3715]\n- Fix use of Sidekiq logger outside of the server process [#3714]\n- Tweak `constantize` to better match Rails class lookup. [#3701, caffeinated-tech]\n\n5.0.5\n-----------\n\n- Update gemspec to allow newer versions of the Redis gem [#3617]\n- Refactor Worker.set so it can be memoized [#3602]\n- Fix display of Redis URL in web footer, broken in 5.0.3 [#3560]\n- Update `Sidekiq::Job#display_args` to avoid mutation [#3621]\n\n5.0.4\n-----------\n\n- Fix \"slow startup\" performance regression from 5.0.2. [#3525]\n- Allow users to disable ID generation since some redis providers disable the CLIENT command. [#3521]\n\n5.0.3\n-----------\n\n- Fix overriding `class_attribute` core extension from ActiveSupport with Sidekiq one [PikachuEXE, #3499]\n- Allow job logger to be overridden [AlfonsoUceda, #3502]\n- Set a default Redis client identifier for debugging [#3516]\n- Fix \"Uninitialized constant\" errors on startup with the delayed extensions [#3509]\n\n5.0.2\n-----------\n\n- fix broken release, thanks @nateberkopec\n\n5.0.1\n-----------\n\n- Fix incorrect server identity when daemonizing [jwilm, #3496]\n- Work around error running Web UI against Redis Cluster [#3492]\n- Remove core extensions, Sidekiq is now monkeypatch-free! [#3474]\n- Reimplement Web UI's HTTP\\_ACCEPT\\_LANGUAGE parsing because the spec is utterly\n  incomprehensible for various edge cases. [johanlunds, natematykiewicz, #3449]\n- Update `class_attribute` core extension to avoid warnings\n- Expose `job_hash_context` from `Sidekiq::Logging` to support log customization\n\n5.0.0\n-----------\n\n- **BREAKING CHANGE** Job dispatch was refactored for safer integration with\n  Rails 5.  The **Logging** and **RetryJobs** server middleware were removed and\n  functionality integrated directly into Sidekiq::Processor.  These aren't\n  commonly used public APIs so this shouldn't impact most users.\n```\nSidekiq::Middleware::Server::RetryJobs -> Sidekiq::JobRetry\nSidekiq::Middleware::Server::Logging -> Sidekiq::JobLogger\n```\n- Quieting Sidekiq is now done via the TSTP signal, the USR1 signal is deprecated.\n- The `delay` extension APIs are no longer available by default, you\n  must opt into them.\n- The Web UI is now BiDi and can render RTL languages like Arabic, Farsi and Hebrew.\n- Rails 3.2 and Ruby 2.0 and 2.1 are no longer supported.\n- The `SomeWorker.set(options)` API was re-written to avoid thread-local state. [#2152]\n- Sidekiq Enterprise's encrypted jobs now display \"[encrypted data]\" in the Web UI instead\n  of random hex bytes.\n- Please see the [5.0 Upgrade notes](docs/5.0-Upgrade.md) for more detail.\n\n4.2.10\n-----------\n\n- Scheduled jobs can now be moved directly to the Dead queue via API [#3390]\n- Fix edge case leading to job duplication when using Sidekiq Pro's\n  reliability feature [#3388]\n- Fix error class name display on retry page [#3348]\n- More robust latency calculation [#3340]\n\n4.2.9\n-----------\n\n- Rollback [#3303] which broke Heroku Redis users [#3311]\n- Add support for TSTP signal, for Sidekiq 5.0 forward compatibility. [#3302]\n\n4.2.8\n-----------\n\n- Fix rare edge case with Redis driver that can create duplicate jobs [#3303]\n- Fix Rails 5 loading issue [#3275]\n- Restore missing tooltips to timestamps in Web UI [#3310]\n- Work on **Sidekiq 5.0** is now active! [#3301]\n\n4.2.7\n-----------\n\n- Add new integration testing to verify code loading and job execution\n  in development and production modes with Rails 4 and 5 [#3241]\n- Fix delayed extensions in development mode [#3227, DarthSim]\n- Use Worker's `retry` default if job payload does not have a retry\n  attribute [#3234, mlarraz]\n\n4.2.6\n-----------\n\n- Run Rails Executor when in production [#3221, eugeneius]\n\n4.2.5\n-----------\n\n- Re-enable eager loading of all code when running non-development Rails 5. [#3203]\n- Better root URL handling for zany web servers [#3207]\n\n4.2.4\n-----------\n\n- Log errors coming from the Rails 5 reloader. [#3212, eugeneius]\n- Clone job data so middleware changes don't appear in Busy tab\n\n4.2.3\n-----------\n\n- Disable use of Rails 5's Reloader API in non-development modes, it has proven\n  to be unstable under load [#3154]\n- Allow disabling of Sidekiq::Web's cookie session to handle the\n  case where the app provides a session already [#3180, inkstak]\n```ruby\nSidekiq::Web.set :sessions, false\n```\n- Fix Web UI sharding support broken in 4.2.2. [#3169]\n- Fix timestamps not updating during UI polling [#3193, shaneog]\n- Relax rack-protection version to >= 1.5.0\n- Provide consistent interface to exception handlers, changing the structure of the context hash. [#3161]\n\n4.2.2\n-----------\n\n- Fix ever-increasing cookie size with nginx [#3146, cconstantine]\n- Fix so Web UI works without trailing slash [#3158, timdorr]\n\n4.2.1\n-----------\n\n- Ensure browser does not cache JSON/AJAX responses. [#3136]\n- Support old Sinatra syntax for setting config [#3139]\n\n4.2.0\n-----------\n\n- Enable development-mode code reloading.  **With Rails 5.0+, you don't need\n  to restart Sidekiq to pick up your Sidekiq::Worker changes anymore!** [#2457]\n- **Remove Sinatra dependency**.  Sidekiq's Web UI now uses Rack directly.\n  Thank you to Sidekiq's newest committer, **badosu**, for writing the code\n  and doing a lot of testing to ensure compatibility with many different\n  3rd party plugins.  If your Web UI works with 4.1.4 but fails with\n  4.2.0, please open an issue. [#3075]\n- Allow tuning of concurrency with the `RAILS_MAX_THREADS` env var. [#2985]\n  This is the same var used by Puma so you can tune all of your systems\n  the same way:\n```sh\nweb: RAILS_MAX_THREADS=5 bundle exec puma ...\nworker: RAILS_MAX_THREADS=10 bundle exec sidekiq ...\n```\nUsing `-c` or `config/sidekiq.yml` overrides this setting.  I recommend\nadjusting your `config/database.yml` to use it too so connections are\nauto-scaled:\n```yaml\n  pool: <%= ENV['RAILS_MAX_THREADS'] || 5 %>\n```\n\n4.1.4\n-----------\n\n- Unlock Sinatra so a Rails 5.0 compatible version may be used [#3048]\n- Fix race condition on startup with JRuby [#3043]\n\n\n4.1.3\n-----------\n\n- Please note the Redis 3.3.0 gem has a [memory leak](https://github.com/redis/redis-rb/issues/612),\n  Redis 3.2.2 is recommended until that issue is fixed.\n- Sinatra 1.4.x is now a required dependency, avoiding cryptic errors\n  and old bugs due to people not upgrading Sinatra for years. [#3042]\n- Fixed race condition in heartbeat which could rarely lead to lingering\n  processes on the Busy tab. [#2982]\n```ruby\n# To clean up lingering processes, modify this as necessary to connect to your Redis.\n# After 60 seconds, lingering processes should disappear from the Busy page.\n\nrequire 'redis'\nr = Redis.new(url: \"redis://localhost:6379/0\")\n# uncomment if you need a namespace\n#require 'redis-namespace'\n#r = Redis::Namespace.new(\"foo\", r)\nr.smembers(\"processes\").each do |pro|\n  r.expire(pro, 60)\n  r.expire(\"#{pro}:workers\", 60)\nend\n```\n\n\n4.1.2\n-----------\n\n- Fix Redis data leak with worker data when a busy Sidekiq process\n  crashes.  You can find and expire leaked data in Redis with this\nscript:\n```bash\n$ redis-cli keys  \"*:workers\" | while read LINE ; do TTL=`redis-cli expire \"$LINE\" 60`; echo \"$LINE\"; done;\n```\n  Please note that `keys` can be dangerous to run on a large, busy Redis.  Caveat runner.\n- Freeze all string literals with Ruby 2.3. [#2741]\n- Client middleware can now stop bulk job push. [#2887]\n\n4.1.1\n-----------\n\n- Much better behavior when Redis disappears and comes back. [#2866]\n- Update FR locale [dbachet]\n- Don't fill logfile in case of Redis downtime [#2860]\n- Allow definition of a global retries_exhausted handler. [#2807]\n```ruby\nSidekiq.configure_server do |config|\n  config.default_retries_exhausted = -> (job, ex) do\n    Sidekiq.logger.info \"#{job['class']} job is now dead\"\n  end\nend\n```\n\n4.1.0\n-----------\n\n- Tag quiet processes in the Web UI [#2757, jcarlson]\n- Pass last exception to sidekiq\\_retries\\_exhausted block [#2787, Nowaker]\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_retries_exhausted do |job, exception|\n  end\nend\n```\n- Add native support for ActiveJob's `set(options)` method allowing\nyou to override worker options dynamically.  This should make it\neven easier to switch between ActiveJob and Sidekiq's native APIs [#2780]\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_options queue: 'default', retry: true\n\n  def perform(*args)\n    # do something\n  end\nend\n\nMyWorker.set(queue: 'high', retry: false).perform_async(1)\n```\n\n4.0.2\n-----------\n\n- Better Japanese translations\n- Remove `json` gem dependency from gemspec. [#2743]\n- There's a new testing API based off the `Sidekiq::Queues` namespace. All\n  assertions made against the Worker class still work as expected.\n  [#2676, brandonhilkert]\n```ruby\nassert_equal 0, Sidekiq::Queues[\"default\"].size\nHardWorker.perform_async(\"log\")\nassert_equal 1, Sidekiq::Queues[\"default\"].size\nassert_equal \"log\", Sidekiq::Queues[\"default\"].first['args'][0]\nSidekiq::Queues.clear_all\n```\n\n4.0.1\n-----------\n\n- Yank new queue-based testing API [#2663]\n- Fix invalid constant reference in heartbeat\n\n4.0.0\n-----------\n\n- Sidekiq's internals have been completely overhauled for performance\n  and to remove dependencies.  This has resulted in major speedups, as\n  [detailed on my blog](http://www.mikeperham.com/2015/10/14/optimizing-sidekiq/).\n- See the [4.0 upgrade notes](docs/4.0-Upgrade.md) for more detail.\n\n3.5.4\n-----------\n\n- Ensure exception message is a string [#2707]\n- Revert racy Process.kill usage in sidekiqctl\n\n3.5.3\n-----------\n\n- Adjust shutdown event to run in parallel with the rest of system shutdown. [#2635]\n\n3.5.2\n-----------\n\n- **Sidekiq 3 is now in maintenance mode**, only major bugs will be fixed.\n- The exception triggering a retry is now passed into `sidekiq_retry_in`,\n  allowing you to retry more frequently for certain types of errors.\n  [#2619, kreynolds]\n```ruby\n  sidekiq_retry_in do |count, ex|\n    case ex\n    when RuntimeError\n      5 * count\n    else\n      10 * count\n    end\n  end\n```\n\n3.5.1\n-----------\n\n- **FIX MEMORY LEAK** Under rare conditions, threads may leak [#2598, gazay]\n- Add Ukrainian locale [#2561, elrakita]\n- Disconnect and retry Redis operations if we see a READONLY error [#2550]\n- Add server middleware testing harness; see [wiki](https://github.com/sidekiq/sidekiq/wiki/Testing#testing-server-middleware) [#2534, ryansch]\n\n3.5.0\n-----------\n\n- Polished new banner! [#2522, firedev]\n- Upgrade to Celluloid 0.17. [#2420, digitalextremist]\n- Activate sessions in Sinatra for CSRF protection, requires Rails\n  monkeypatch due to rails/rails#15843. [#2460, jc00ke]\n\n3.4.2\n-----------\n\n- Don't allow `Sidekiq::Worker` in ActiveJob::Base classes. [#2424]\n- Safer display of job data in Web UI [#2405]\n- Fix CSRF vulnerability in Web UI, thanks to Egor Homakov for\n  reporting. [#2422] If you are running the Web UI as a standalone Rack app,\n  ensure you have a [session middleware\nconfigured](https://github.com/sidekiq/sidekiq/wiki/Monitoring#standalone):\n```ruby\nuse Rack::Session::Cookie, :secret => \"some unique secret string here\"\n```\n\n3.4.1\n-----------\n\n- Lock to Celluloid 0.16\n\n\n3.4.0\n-----------\n\n- Set a `created_at` attribute when jobs are created, set `enqueued_at` only\n  when they go into a queue. Fixes invalid latency calculations with scheduled jobs.\n  [#2373, mrsimo]\n- Don't log timestamp on Heroku [#2343]\n- Run `shutdown` event handlers in reverse order of definition [#2374]\n- Rename and rework `poll_interval` to be simpler, more predictable [#2317, cainlevy]\n  The new setting is `average_scheduled_poll_interval`.  To configure\n  Sidekiq to look for scheduled jobs every 5 seconds, just set it to 5.\n```ruby\nSidekiq.configure_server do |config|\n  config.average_scheduled_poll_interval = 5\nend\n```\n\n3.3.4\n-----------\n\n- **Improved ActiveJob integration** - Web UI now shows ActiveJobs in a\n  nicer format and job logging shows the actual class name, requires\n  Rails 4.2.2+ [#2248, #2259]\n- Add Sidekiq::Process#dump\\_threads API to trigger TTIN output [#2247]\n- Web UI polling now uses Ajax to avoid page reload [#2266, davydovanton]\n- Several Web UI styling improvements [davydovanton]\n- Add Tamil, Hindi translations for Web UI [ferdinandrosario, tejasbubane]\n- Fix Web UI to work with country-specific locales [#2243]\n- Handle circular error causes [#2285,  eugenk]\n\n3.3.3\n-----------\n\n- Fix crash on exit when Redis is down [#2235]\n- Fix duplicate logging on startup\n- Undeprecate delay extension for ActionMailer 4.2+ . [#2186]\n\n3.3.2\n-----------\n\n- Add Sidekiq::Stats#queues back\n- Allows configuration of dead job set size and timeout [#2173, jonhyman]\n- Refactor scheduler enqueuing so Sidekiq Pro can override it. [#2159]\n\n3.3.1\n-----------\n\n- Dumb down ActionMailer integration so it tries to deliver if possible [#2149]\n- Stringify Sidekiq.default\\_worker\\_options's keys [#2126]\n- Add random integer to process identity [#2113, michaeldiscala]\n- Log Sidekiq Pro's Batch ID if available [#2076]\n- Refactor Processor Redis usage to avoid redis/redis-rb#490 [#2094]\n- Move /dashboard/stats to /stats.  Add /stats/queues. [moserke, #2099]\n- Add processes count to /stats [ismaelga, #2141]\n- Greatly improve speed of Sidekiq::Stats [ismaelga, #2142]\n- Add better usage text for `sidekiqctl`.\n- `Sidekiq::Logging.with_context` is now a stack so you can set your\n  own job context for logging purposes [grosser, #2110]\n- Remove usage of Google Fonts in Web UI so it loads in China [#2144]\n\n3.3.0\n-----------\n\n- Upgrade to Celluloid 0.16 [#2056]\n- Fix typo for generator test file name [dlackty, #2016]\n- Add Sidekiq::Middleware::Chain#prepend [seuros, #2029]\n\n3.2.6\n-----------\n\n- Deprecate delay extension for ActionMailer 4.2+ . [seuros, #1933]\n- Poll interval tuning now accounts for dead processes [epchris, #1984]\n- Add non-production environment to Web UI page titles [JacobEvelyn, #2004]\n\n3.2.5\n-----------\n\n- Lock Celluloid to 0.15.2 due to bugs in 0.16.0.  This prevents the\n  \"hang on shutdown\" problem with Celluloid 0.16.0.\n\n3.2.4\n-----------\n\n- Fix issue preventing ActionMailer sends working in some cases with\n  Rails 4. [pbhogan, #1923]\n\n3.2.3\n-----------\n\n- Clean invalid bytes from error message before converting to JSON (requires Ruby 2.1+) [#1705]\n- Add queues list for each process to the Busy page. [davetoxa, #1897]\n- Fix for crash caused by empty config file. [jordan0day, #1901]\n- Add Rails Worker generator, `rails g sidekiq:worker User` will create `app/workers/user_worker.rb`. [seuros, #1909]\n- Fix Web UI rendering with huge job arguments [jhass, #1918]\n- Minor refactoring of Sidekiq::Client internals, for Sidekiq Pro. [#1919]\n\n3.2.2\n-----------\n\n- **This version of Sidekiq will no longer start on Ruby 1.9.**  Sidekiq\n  3 does not support MRI 1.9 but we've allowed it to run before now.\n- Fix issue which could cause Sidekiq workers to disappear from the Busy\n  tab while still being active [#1884]\n- Add \"Back to App\" button in Web UI.  You can set the button link via\n  `Sidekiq::Web.app_url = 'http://www.mysite.com'` [#1875, seuros]\n- Add process tag (`-g tag`) to the Busy page so you can differentiate processes at a glance. [seuros, #1878]\n- Add \"Kill\" button to move retries directly to the DJQ so they don't retry. [seuros, #1867]\n\n3.2.1\n-----------\n\n- Revert eager loading change for Rails 3.x apps, as it broke a few edge\n  cases.\n\n3.2.0\n-----------\n\n- **Fix issue which caused duplicate job execution in Rails 3.x**\n  This issue is caused by [improper exception handling in ActiveRecord](https://github.com/rails/rails/blob/3-2-stable/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb#L281) which changes Sidekiq's Shutdown exception into a database\n  error, making Sidekiq think the job needs to be retried. **The fix requires Ruby 2.1**. [#1805]\n- Update how Sidekiq eager loads Rails application code [#1791, jonleighton]\n- Change logging timestamp to show milliseconds.\n- Reverse sorting of Dead tab so newer jobs are listed first [#1802]\n\n3.1.4\n-----------\n\n- Happy \u03c0 release!\n- Self-tuning Scheduler polling, we use heartbeat info to better tune poll\\_interval [#1630]\n- Remove all table column width rules, hopefully get better column formatting [#1747]\n- Handle edge case where YAML can't be decoded in dev mode [#1761]\n- Fix lingering jobs in Busy page on Heroku [#1764]\n\n3.1.3\n-----------\n\n- Use ENV['DYNO'] on Heroku for hostname display, rather than an ugly UUID. [#1742]\n- Show per-process labels on the Busy page, for feature tagging [#1673]\n\n\n3.1.2\n-----------\n\n- Suitably chastised, @mperham reverts the Bundler change.\n\n\n3.1.1\n-----------\n\n- Sidekiq::CLI now runs `Bundler.require(:default, environment)` to boot all gems\n  before loading any app code.\n- Sort queues by name in Web UI [#1734]\n\n\n3.1.0\n-----------\n\n- New **remote control** feature: you can remotely trigger Sidekiq to quiet\n  or terminate via API, without signals.  This is most useful on JRuby\n  or Heroku which does not support the USR1 'quiet' signal.  Now you can\n  run a rake task like this at the start of your deploy to quiet your\n  set of Sidekiq processes. [#1703]\n```ruby\nnamespace :sidekiq do\n  task :quiet => :environment do\n    Sidekiq::ProcessSet.new.each(&:quiet!)\n  end\nend\n```\n- The Web UI can use the API to quiet or stop all processes via the Busy page.\n- The Web UI understands and hides the `Sidekiq::Extensions::Delay*`\n  classes, instead showing `Class.method` as the Job. [#1718]\n- Polish the Dashboard graphs a bit, update Rickshaw [brandonhilkert, #1725]\n- The poll interval is now configurable in the Web UI [madebydna, #1713]\n- Delay extensions can be removed so they don't conflict with\n  DelayedJob: put `Sidekiq.remove_delay!` in your initializer. [devaroop, #1674]\n\n\n3.0.2\n-----------\n\n- Revert gemfile requirement of Ruby 2.0.  JRuby 1.7 calls itself Ruby\n  1.9.3 and broke with this requirement.\n\n3.0.1\n-----------\n\n- Revert pidfile behavior from 2.17.5: Sidekiq will no longer remove its own pidfile\n  as this is a race condition when restarting. [#1470, #1677]\n- Show warning on the Queues page if a queue is paused [#1672]\n- Only activate the ActiveRecord middleware if ActiveRecord::Base is defined on boot. [#1666]\n- Add ability to disable jobs going to the DJQ with the `dead` option.\n```ruby\nsidekiq_options :dead => false, :retry => 5\n```\n- Minor fixes\n\n\n3.0.0\n-----------\n\nPlease see [3.0-Upgrade.md](docs/3.0-Upgrade.md) for more comprehensive upgrade notes.\n\n- **Dead Job Queue** - jobs which run out of retries are now moved to a dead\n  job queue.  These jobs must be retried manually or they will expire\n  after 6 months or 10,000 jobs.  The Web UI contains a \"Dead\" tab\n  exposing these jobs.  Use `sidekiq_options :retry => false` if you\ndon't wish jobs to be retried or put in the DJQ.  Use\n`sidekiq_options :retry => 0` if you don't want jobs to retry but go\nstraight to the DJQ.\n- **Process Lifecycle Events** - you can now register blocks to run at\n  certain points during the Sidekiq process lifecycle: startup, quiet and\n  shutdown.\n```ruby\nSidekiq.configure_server do |config|\n  config.on(:startup) do\n    # do something\n  end\nend\n```\n- **Global Error Handlers** - blocks of code which handle errors that\n  occur anywhere within Sidekiq, not just within middleware.\n```ruby\nSidekiq.configure_server do |config|\n  config.error_handlers << proc {|ex,ctx| ... }\nend\n```\n- **Process Heartbeat** - each Sidekiq process will ping Redis every 5\n  seconds to give a summary of the Sidekiq population at work.\n- The Workers tab is now renamed to Busy and contains a list of live\n  Sidekiq processes and jobs in progress based on the heartbeat.\n- **Shardable Client** - Sidekiq::Client instances can use a custom\n  Redis connection pool, allowing very large Sidekiq installations to scale by\n  sharding: sending different jobs to different Redis instances.\n```ruby\nclient = Sidekiq::Client.new(ConnectionPool.new { Redis.new })\nclient.push(...)\n```\n```ruby\nSidekiq::Client.via(ConnectionPool.new { Redis.new }) do\n  FooWorker.perform_async\n  BarWorker.perform_async\nend\n```\n  **Sharding support does require a breaking change to client-side\nmiddleware, see docs/3.0-Upgrade.md.**\n- New Chinese, Greek, Swedish and Czech translations for the Web UI.\n- Updated most languages translations for the new UI features.\n- **Remove official Capistrano integration** - this integration has been\n  moved into the [capistrano-sidekiq](https://github.com/seuros/capistrano-sidekiq) gem.\n- **Remove official support for MRI 1.9** - Things still might work but\n  I no longer actively test on it.\n- **Remove built-in support for Redis-to-Go**.\n  Heroku users: `heroku config:set REDIS_PROVIDER=REDISTOGO_URL`\n- **Remove built-in error integration for Airbrake, Honeybadger, ExceptionNotifier and Exceptional**.\n  Each error gem should provide its own Sidekiq integration.  Update your error gem to the latest\n  version to pick up Sidekiq support.\n- Upgrade to connection\\_pool 2.0 which now creates connections lazily.\n- Remove deprecated Sidekiq::Client.registered\\_\\* APIs\n- Remove deprecated support for the old Sidekiq::Worker#retries\\_exhausted method.\n- Removed 'sidekiq/yaml\\_patch', this was never documented or recommended.\n- Removed --profile option, #1592\n- Remove usage of the term 'Worker' in the UI for clarity.  Users would call both threads and\n  processes 'workers'.  Instead, use \"Thread\", \"Process\" or \"Job\".\n\n2.17.7\n-----------\n\n- Auto-prune jobs older than one hour from the Workers page [#1508]\n- Add Sidekiq::Workers#prune which can perform the auto-pruning.\n- Fix issue where a job could be lost when an exception occurs updating\n  Redis stats before the job executes [#1511]\n\n2.17.6\n-----------\n\n- Fix capistrano integration due to missing pidfile. [#1490]\n\n2.17.5\n-----------\n\n- Automatically use the config file found at `config/sidekiq.yml`, if not passed `-C`. [#1481]\n- Store 'retried\\_at' and 'failed\\_at' timestamps as Floats, not Strings. [#1473]\n- A `USR2` signal will now reopen _all_ logs, using IO#reopen. Thus, instead of creating a new Logger object,\n  Sidekiq will now just update the existing Logger's file descriptor [#1163].\n- Remove pidfile when shutting down if started with `-P` [#1470]\n\n2.17.4\n-----------\n\n- Fix JID support in inline testing, #1454\n- Polish worker arguments display in UI, #1453\n- Marshal arguments fully to avoid worker mutation, #1452\n- Support reverse paging sorted sets, #1098\n\n\n2.17.3\n-----------\n\n- Synchronously terminates the poller and fetcher to fix a race condition in bulk requeue during shutdown [#1406]\n\n2.17.2\n-----------\n\n- Fix bug where strictly prioritized queues might be processed out of\n  order [#1408]. A side effect of this change is that it breaks a queue\n  declaration syntax that worked, although only because of a bug\u2014it was\n  never intended to work and never supported. If you were declaring your\n  queues as a  comma-separated list, e.g. `sidekiq -q critical,default,low`,\n  you must now use the `-q` flag before each queue, e.g.\n  `sidekiq -q critical -q default -q low`.\n\n2.17.1\n-----------\n\n- Expose `delay` extension as `sidekiq_delay` also.  This allows you to\n  run Delayed::Job and Sidekiq in the same process, selectively porting\n  `delay` calls to `sidekiq_delay`.  You just need to ensure that\n  Sidekiq is required **before** Delayed::Job in your Gemfile. [#1393]\n- Bump redis client required version to 3.0.6\n- Minor CSS fixes for Web UI\n\n2.17.0\n-----------\n\n- Change `Sidekiq::Client#push_bulk` to return an array of pushed `jid`s. [#1315, barelyknown]\n- Web UI refactoring to use more API internally (yummy dogfood!)\n- Much faster Sidekiq::Job#delete performance for larger queue sizes\n- Further capistrano 3 fixes\n- Many misc minor fixes\n\n2.16.1\n-----------\n\n- Revert usage of `resolv-replace`.  MRI's native DNS lookup releases the GIL.\n- Fix several Capistrano 3 issues\n- Escaping dynamic data like job args and error messages in Sidekiq Web UI. [#1299, lian]\n\n2.16.0\n-----------\n\n- Deprecate `Sidekiq::Client.registered_workers` and `Sidekiq::Client.registered_queues`\n- Refactor Sidekiq::Client to be instance-based [#1279]\n- Pass all Redis options to the Redis driver so Unix sockets\n  can be fully configured. [#1270, salimane]\n- Allow sidekiq-web extensions to add locale paths so extensions\n  can be localized. [#1261, ondrejbartas]\n- Capistrano 3 support [#1254, phallstrom]\n- Use Ruby's `resolv-replace` to enable pure Ruby DNS lookups.\n  This ensures that any DNS resolution that takes place in worker\n  threads won't lock up the entire VM on MRI. [#1258]\n\n2.15.2\n-----------\n\n- Iterating over Sidekiq::Queue and Sidekiq::SortedSet will now work as\n  intended when jobs are deleted [#866, aackerman]\n- A few more minor Web UI fixes [#1247]\n\n2.15.1\n-----------\n\n- Fix several Web UI issues with the Bootstrap 3 upgrade.\n\n2.15.0\n-----------\n\n- The Core Sidekiq actors are now monitored.  If any crash, the\n  Sidekiq process logs the error and exits immediately.  This is to\n  help prevent \"stuck\" Sidekiq processes which are running but don't\n  appear to be doing any work. [#1194]\n- Sidekiq's testing behavior is now dynamic.  You can choose between\n  `inline` and `fake` behavior in your tests. See\n[Testing](https://github.com/sidekiq/sidekiq/wiki/Testing) for detail. [#1193]\n- The Retries table has a new column for the error message.\n- The Web UI topbar now contains the status and live poll button.\n- Orphaned worker records are now auto-vacuumed when you visit the\n  Workers page in the Web UI.\n- Sidekiq.default\\_worker\\_options allows you to configure default\n  options for all Sidekiq worker types.\n\n```ruby\nSidekiq.default_worker_options = { 'queue' => 'default', 'backtrace' => true }\n```\n- Added two Sidekiq::Client class methods for compatibility with resque-scheduler:\n  `enqueue_to_in` and `enqueue_in` [#1212]\n- Upgrade Web UI to Bootstrap 3.0. [#1211, jeffboek]\n\n2.14.1\n-----------\n\n- Fix misc Web UI issues due to ERB conversion.\n- Bump redis-namespace version due to security issue.\n\n2.14.0\n-----------\n\n- Removed slim gem dependency, Web UI now uses ERB [Locke23rus, #1120]\n- Fix more race conditions in Web UI actions\n- Don't reset Job enqueued\\_at when retrying\n- Timestamp tooltips in the Web UI should use UTC\n- Fix invalid usage of handle\\_exception causing issues in Airbrake\n  [#1134]\n\n\n2.13.1\n-----------\n\n- Make Sidekiq::Middleware::Chain Enumerable\n- Make summary bar and graphs responsive [manishval, #1025]\n- Adds a job status page for scheduled jobs [jonhyman]\n- Handle race condition in retrying and deleting jobs in the Web UI\n- The Web UI relative times are now i18n. [MadRabbit, #1088]\n- Allow for default number of retry attempts to be set for\n  `Sidekiq::Middleware::Server::RetryJobs` middleware. [czarneckid] [#1091]\n\n```ruby\nSidekiq.configure_server do |config|\n  config.server_middleware do |chain|\n    chain.add Sidekiq::Middleware::Server::RetryJobs, :max_retries => 10\n  end\nend\n```\n\n\n2.13.0\n-----------\n\n- Adding button to move scheduled job to main queue [guiceolin, #1020]\n- fix i18n support resetting saved locale when job is retried [#1011]\n- log rotation via USR2 now closes the old logger [#1008]\n- Add ability to customize retry schedule, like so [jmazzi, #1027]\n\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_retry_in { |count| count * 2 }\nend\n```\n- Redesign Worker#retries\\_exhausted callback to use same form as above [jmazzi, #1030]\n\n```ruby\nclass MyWorker\n  include Sidekiq::Worker\n  sidekiq_retries_exhausted do |msg|\n    Rails.logger.error \"Failed to process #{msg['class']} with args: #{msg['args']}\"\n  end\nend\n```\n\n2.12.4\n-----------\n\n- Fix error in previous release which crashed the Manager when a\n  Processor died.\n\n2.12.3\n-----------\n\n- Revert back to Celluloid's TaskFiber for job processing which has proven to be more\n  stable than TaskThread. [#985]\n- Avoid possible lockup during hard shutdown [#997]\n\nAt this point, if you are experiencing stability issues with Sidekiq in\nRuby 1.9, please try Ruby 2.0.  It seems to be more stable.\n\n2.12.2\n-----------\n\n- Relax slim version requirement to >= 1.1.0\n- Refactor historical stats to use TTL, not explicit cleanup. [grosser, #971]\n\n2.12.1\n-----------\n\n- Force Celluloid 0.14.1 as 0.14.0 has a serious bug. [#954]\n- Scheduled and Retry jobs now use Sidekiq::Client to push\n  jobs onto the queue, so they use client middleware. [dimko, #948]\n- Record the timestamp when jobs are enqueued. Add\n  Sidekiq::Job#enqueued\\_at to query the time. [mariovisic, #944]\n- Add Sidekiq::Queue#latency - calculates diff between now and\n  enqueued\\_at for the oldest job in the queue.\n- Add testing method `perform_one` that dequeues and performs a single job.\n  This is mainly to aid testing jobs that spawn other jobs. [fumin, #963]\n\n2.12.0\n-----------\n\n- Upgrade to Celluloid 0.14, remove the use of Celluloid's thread\n  pool.  This should halve the number of threads in each Sidekiq\n  process, thus requiring less resources. [#919]\n- Abstract Celluloid usage to Sidekiq::Actor for testing purposes.\n- Better handling for Redis downtime when fetching jobs and shutting\n  down, don't print exceptions every second and print success message\n  when Redis is back.\n- Fix unclean shutdown leading to duplicate jobs [#897]\n- Add Korean locale [#890]\n- Upgrade test suite to Minitest 5\n- Remove usage of `multi_json` as `json` is now robust on all platforms.\n\n2.11.2\n-----------\n\n- Fix Web UI when used without Rails [#886]\n- Add Sidekiq::Stats#reset [#349]\n- Add Norwegian locale.\n- Updates for the JA locale.\n\n2.11.1\n-----------\n\n- Fix timeout warning.\n- Add Dutch web UI locale.\n\n2.11.0\n-----------\n\n- Upgrade to Celluloid 0.13. [#834]\n- Remove **timeout** support from `sidekiq_options`.  Ruby's timeout\n  is inherently unsafe in a multi-threaded application and was causing\n  stability problems for many.  See http://bit.ly/OtYpK\n- Add Japanese locale for Web UI [#868]\n- Fix a few issues with Web UI i18n.\n\n2.10.1\n-----------\n\n- Remove need for the i18n gem. (brandonhilkert)\n- Improve redis connection info logging on startup for debugging\npurposes [#858]\n- Revert sinatra/slim as runtime dependencies\n- Add `find_job` method to sidekiq/api\n\n\n2.10.0\n-----------\n\n- Refactor algorithm for putting scheduled jobs onto the queue [#843]\n- Fix scheduler thread dying due to incorrect error handling [#839]\n- Fix issue which left stale workers if Sidekiq wasn't shutdown while\nquiet. [#840]\n- I18n for web UI.  Please submit translations of `web/locales/en.yml` for\nyour own language. [#811]\n- 'sinatra', 'slim' and 'i18n' are now gem dependencies for Sidekiq.\n\n\n2.9.0\n-----------\n\n- Update 'sidekiq/testing' to work with any Sidekiq::Client call. It\n  also serializes the arguments as using Redis would. [#713]\n- Raise a Sidekiq::Shutdown error within workers which don't finish within the hard\n  timeout.  This is to prevent unwanted database transaction commits. [#377]\n- Lazy load Redis connection pool, you no longer need to specify\n  anything in Passenger or Unicorn's after_fork callback [#794]\n- Add optional Worker#retries_exhausted hook after max retries failed. [jkassemi, #780]\n- Fix bug in pagination link to last page [pitr, #774]\n- Upstart scripts for multiple Sidekiq instances [dariocravero, #763]\n- Use select via pipes instead of poll to catch signals [mrnugget, #761]\n\n2.8.0\n-----------\n\n- I18n support!  Sidekiq can optionally save and restore the Rails locale\n  so it will be properly set when your jobs execute.  Just include\n  `require 'sidekiq/middleware/i18n'` in your sidekiq initializer. [#750]\n- Fix bug which could lose messages when using namespaces and the message\nneeds to be requeued in Redis. [#744]\n- Refactor Redis namespace support [#747].  The redis namespace can no longer be\n  passed via the config file, the only supported way is via Ruby in your\n  initializer:\n\n```ruby\nsidekiq_redis = { :url => 'redis://localhost:3679', :namespace => 'foo' }\nSidekiq.configure_server { |config| config.redis = sidekiq_redis }\nSidekiq.configure_client { |config| config.redis = sidekiq_redis }\n```\n\nA warning is printed out to the log if a namespace is found in your sidekiq.yml.\n\n\n2.7.5\n-----------\n\n- Capistrano no longer uses daemonization in order to work with JRuby [#719]\n- Refactor signal handling to work on Ruby 2.0 [#728, #730]\n- Fix dashboard refresh URL [#732]\n\n2.7.4\n-----------\n\n- Fixed daemonization, was broken by some internal refactoring in 2.7.3 [#727]\n\n2.7.3\n-----------\n\n- Real-time dashboard is now the default web page\n- Make config file optional for capistrano\n- Fix Retry All button in the Web UI\n\n2.7.2\n-----------\n\n- Remove gem signing infrastructure.  It was causing Sidekiq to break\nwhen used via git in Bundler.  This is why we can't have nice things. [#688]\n\n\n2.7.1\n-----------\n\n- Fix issue with hard shutdown [#680]\n\n\n2.7.0\n-----------\n\n- Add -d daemonize flag, capistrano recipe has been updated to use it [#662]\n- Support profiling via `ruby-prof` with -p.  When Sidekiq is stopped\n  via Ctrl-C, it will output `profile.html`.  You must add `gem 'ruby-prof'` to your Gemfile for it to work.\n- Dynamically update Redis stats on dashboard [brandonhilkert]\n- Add Sidekiq::Workers API giving programmatic access to the current\n  set of active workers.\n\n```\nworkers = Sidekiq::Workers.new\nworkers.size => 2\nworkers.each do |name, work|\n  # name is a unique identifier per Processor instance\n  # work is a Hash which looks like:\n  # { 'queue' => name, 'run_at' => timestamp, 'payload' => msg }\nend\n```\n\n- Allow environment-specific sections within the config file which\noverride the global values [dtaniwaki, #630]\n\n```\n---\n:concurrency:  50\n:verbose:      false\nstaging:\n  :verbose:      true\n  :concurrency:  5\n```\n\n\n2.6.5\n-----------\n\n- Several reliability fixes for job requeueing upon termination [apinstein, #622, #624]\n- Fix typo in capistrano recipe\n- Add `retry_queue` option so retries can be given lower priority [ryanlower, #620]\n\n```ruby\nsidekiq_options queue: 'high', retry_queue: 'low'\n```\n\n2.6.4\n-----------\n\n- Fix crash upon empty queue [#612]\n\n2.6.3\n-----------\n\n- sidekiqctl exits with non-zero exit code upon error [jmazzi]\n- better argument validation in Sidekiq::Client [karlfreeman]\n\n2.6.2\n-----------\n\n- Add Dashboard beacon indicating when stats are updated. [brandonhilkert, #606]\n- Revert issue with capistrano restart. [#598]\n\n2.6.1\n-----------\n\n- Dashboard now live updates summary stats also. [brandonhilkert, #605]\n- Add middleware chain APIs `insert_before` and `insert_after` for fine\n  tuning the order of middleware. [jackrg, #595]\n\n2.6.0\n-----------\n\n- Web UI much more mobile friendly now [brandonhilkert, #573]\n- Enable live polling for every section in Web UI [brandonhilkert, #567]\n- Add Stats API [brandonhilkert, #565]\n- Add Stats::History API [brandonhilkert, #570]\n- Add Dashboard to Web UI with live and historical stat graphs [brandonhilkert, #580]\n- Add option to log output to a file, reopen log file on USR2 signal [mrnugget, #581]\n\n2.5.4\n-----------\n\n- `Sidekiq::Client.push` now accepts the worker class as a string so the\n  Sidekiq client does not have to load your worker classes at all.  [#524]\n- `Sidekiq::Client.push_bulk` now works with inline testing.\n- **Really** fix status icon in Web UI this time.\n- Add \"Delete All\" and \"Retry All\" buttons to Retries in Web UI\n\n\n2.5.3\n-----------\n\n- Small Web UI fixes\n- Add `delay_until` so you can delay jobs until a specific timestamp:\n\n```ruby\nAuction.delay_until(@auction.ends_at).close(@auction.id)\n```\n\nThis is identical to the existing Sidekiq::Worker method, `perform_at`.\n\n2.5.2\n-----------\n\n- Remove asset pipeline from Web UI for much faster, simpler runtime.  [#499, #490, #481]\n- Add -g option so the procline better identifies a Sidekiq process, defaults to File.basename(Rails.root). [#486]\n\n    sidekiq 2.5.1 myapp [0 of 25 busy]\n\n- Add splay to retry time so groups of failed jobs don't fire all at once. [#483]\n\n2.5.1\n-----------\n\n- Fix issues with core\\_ext\n\n2.5.0\n-----------\n\n- REDESIGNED WEB UI! [unity, cavneb]\n- Support Honeybadger for error delivery\n- Inline testing runs the client middleware before executing jobs [#465]\n- Web UI can now remove jobs from queue. [#466, dleung]\n- Web UI can now show the full message, not just 100 chars [#464, dleung]\n- Add APIs for manipulating the retry and job queues.  See sidekiq/api. [#457]\n\n\n2.4.0\n-----------\n\n- ActionMailer.delay.method now only tries to deliver if method returns a valid message.\n- Logging now uses \"MSG-#{Job ID}\", not a random msg ID\n- Allow generic Redis provider as environment variable. [#443]\n- Add ability to customize sidekiq\\_options with delay calls [#450]\n\n```ruby\nFoo.delay(:retry => false).bar\nFoo.delay(:retry => 10).bar\nFoo.delay(:timeout => 10.seconds).bar\nFoo.delay_for(5.minutes, :timeout => 10.seconds).bar\n```\n\n2.3.3\n-----------\n\n- Remove option to disable Rails hooks. [#401]\n- Allow delay of any module class method\n\n2.3.2\n-----------\n\n- Fix retry.  2.3.1 accidentally disabled it.\n\n2.3.1\n-----------\n\n- Add Sidekiq::Client.push\\_bulk for bulk adding of jobs to Redis.\n  My own simple test case shows pushing 10,000 jobs goes from 5 sec to 1.5 sec.\n- Add support for multiple processes per host to Capistrano recipe\n- Re-enable Celluloid::Actor#defer to fix stack overflow issues [#398]\n\n2.3.0\n-----------\n\n- Upgrade Celluloid to 0.12\n- Upgrade Twitter Bootstrap to 2.1.0\n- Rescue more Exceptions\n- Change Job ID to be Hex, rather than Base64, for HTTP safety\n- Use `Airbrake#notify_or_ignore`\n\n2.2.1\n-----------\n\n- Add support for custom tabs to Sidekiq::Web [#346]\n- Change capistrano recipe to run 'quiet' before deploy:update\\_code so\n  it is run upon both 'deploy' and 'deploy:migrations'. [#352]\n- Rescue Exception rather than StandardError to catch and log any sort\n  of Processor death.\n\n2.2.0\n-----------\n\n- Roll back Celluloid optimizations in 2.1.0 which caused instability.\n- Add extension to delay any arbitrary class method to Sidekiq.\n  Previously this was limited to ActiveRecord classes.\n\n```ruby\nSomeClass.delay.class_method(1, 'mike', Date.today)\n```\n\n- Sidekiq::Client now generates and returns a random, 128-bit Job ID 'jid' which\n  can be used to track the processing of a Job, e.g. for calling back to a webhook\n  when a job is finished.\n\n2.1.1\n-----------\n\n- Handle networking errors causing the scheduler thread to die [#309]\n- Rework exception handling to log all Processor and actor death (#325, subelsky)\n- Clone arguments when calling worker so modifications are discarded. (#265, hakanensari)\n\n2.1.0\n-----------\n\n- Tune Celluloid to no longer run message processing within a Fiber.\n  This gives us a full Thread stack and also lowers Sidekiq's memory\n  usage.\n- Add pagination within the Web UI [#253]\n- Specify which Redis driver to use: *hiredis* or *ruby* (default)\n- Remove FailureJobs and UniqueJobs, which were optional middleware\n  that I don't want to support in core. [#302]\n\n2.0.3\n-----------\n- Fix sidekiq-web's navbar on mobile devices and windows under 980px (ezkl)\n- Fix Capistrano task for first deploys [#259]\n- Worker subclasses now properly inherit sidekiq\\_options set in\n  their superclass [#221]\n- Add random jitter to scheduler to spread polls across POLL\\_INTERVAL\n  window. [#247]\n- Sidekiq has a new mailing list: sidekiq@librelist.org  See README.\n\n2.0.2\n-----------\n\n- Fix \"Retry Now\" button on individual retry page. (ezkl)\n\n2.0.1\n-----------\n\n- Add \"Clear Workers\" button to UI.  If you kill -9 Sidekiq, the workers\n  set can fill up with stale entries.\n- Update sidekiq/testing to support new scheduled jobs API:\n\n   ```ruby\n   require 'sidekiq/testing'\n   DirectWorker.perform_in(10.seconds, 1, 2)\n   assert_equal 1, DirectWorker.jobs.size\n   assert_in_delta 10.seconds.from_now.to_f, DirectWorker.jobs.last['at'], 0.01\n   ```\n\n2.0.0\n-----------\n\n- **SCHEDULED JOBS**!\n\nYou can now use `perform_at` and `perform_in` to schedule jobs\nto run at arbitrary points in the future, like so:\n\n```ruby\n  SomeWorker.perform_in(5.days, 'bob', 13)\n  SomeWorker.perform_at(5.days.from_now, 'bob', 13)\n```\n\nIt also works with the delay extensions:\n\n```ruby\n  UserMailer.delay_for(5.days).send_welcome_email(user.id)\n```\n\nThe time is approximately when the job will be placed on the queue;\nit is not guaranteed to run at precisely at that moment in time.\n\nThis functionality is meant for one-off, arbitrary jobs.  I still\nrecommend `whenever` or `clockwork` if you want cron-like,\nrecurring jobs.  See `examples/scheduling.rb`\n\nI want to specially thank @yabawock for his work on sidekiq-scheduler.\nHis extension for Sidekiq 1.x filled an obvious functional gap that I now think is\nuseful enough to implement in Sidekiq proper.\n\n- Fixed issues due to Redis 3.x API changes.  Sidekiq now requires\n  the Redis 3.x client.\n- Inline testing now round trips arguments through JSON to catch\n  serialization issues (betelgeuse)\n\n1.2.1\n-----------\n\n- Sidekiq::Worker now has access to Sidekiq's standard logger\n- Fix issue with non-StandardErrors leading to Processor exhaustion\n- Fix issue with Fetcher slowing Sidekiq shutdown\n- Print backtraces for all threads upon TTIN signal [#183]\n- Overhaul retries Web UI with new index page and bulk operations [#184]\n\n1.2.0\n-----------\n\n- Full or partial error backtraces can optionally be stored as part of the retry\n  for display in the web UI if you aren't using an error service. [#155]\n\n```ruby\nclass Worker\n  include Sidekiq::Worker\n  sidekiq_options :backtrace => [true || 10]\nend\n```\n- Add timeout option to kill a worker after N seconds (blackgold9)\n\n```ruby\nclass HangingWorker\n  include Sidekiq::Worker\n  sidekiq_options :timeout => 600\n  def perform\n    # will be killed if it takes longer than 10 minutes\n  end\nend\n```\n\n- Fix delayed extensions not available in workers [#152]\n- In test environments add the `#drain` class method to workers. This method\n  executes all previously queued jobs. (panthomakos)\n- Sidekiq workers can be run inline during tests, just `require 'sidekiq/testing/inline'` (panthomakos)\n- Queues can now be deleted from the Sidekiq web UI [#154]\n- Fix unnecessary shutdown delay due to Retry Poller [#174]\n\n1.1.4\n-----------\n\n- Add 24 hr expiry for basic keys set in Redis, to avoid any possible leaking.\n- Only register workers in Redis while working, to avoid lingering\n  workers [#156]\n- Speed up shutdown significantly.\n\n1.1.3\n-----------\n\n- Better network error handling when fetching jobs from Redis.\n  Sidekiq will retry once per second until it can re-establish\n  a connection. (ryanlecompte)\n- capistrano recipe now uses `bundle_cmd` if set [#147]\n- handle multi\\_json API changes (sferik)\n\n1.1.2\n-----------\n\n- Fix double restart with cap deploy [#137]\n\n1.1.1\n-----------\n\n- Set procline for easy monitoring of Sidekiq status via \"ps aux\"\n- Fix race condition on shutdown [#134]\n- Fix hang with cap sidekiq:start [#131]\n\n1.1.0\n-----------\n\n- The Sidekiq license has switched from GPLv3 to LGPLv3!\n- Sidekiq::Client.push now returns whether the actual Redis\n  operation succeeded or not. [#123]\n- Remove UniqueJobs from the default middleware chain.  Its\n  functionality, while useful, is unexpected for new Sidekiq\n  users.  You can re-enable it with the following config.\n  Read #119 for more discussion.\n\n```ruby\nSidekiq.configure_client do |config|\n  require 'sidekiq/middleware/client/unique_jobs'\n  config.client_middleware do |chain|\n    chain.add Sidekiq::Middleware::Client::UniqueJobs\n  end\nend\nSidekiq.configure_server do |config|\n  require 'sidekiq/middleware/server/unique_jobs'\n  config.server_middleware do |chain|\n    chain.add Sidekiq::Middleware::Server::UniqueJobs\n  end\nend\n```\n\n1.0.0\n-----------\n\nThanks to all Sidekiq users and contributors for helping me\nget to this big milestone!\n\n- Default concurrency on client-side to 5, not 25 so we don't\n  create as many unused Redis connections, same as ActiveRecord's\n  default pool size.\n- Ensure redis= is given a Hash or ConnectionPool.\n\n0.11.2\n-----------\n\n- Implement \"safe shutdown\".  The messages for any workers that\n  are still busy when we hit the TERM timeout will be requeued in\n  Redis so the messages are not lost when the Sidekiq process exits.\n  [#110]\n- Work around Celluloid's small 4kb stack limit [#115]\n- Add support for a custom Capistrano role to limit Sidekiq to\n  a set of machines. [#113]\n\n0.11.1\n-----------\n\n- Fix fetch breaking retry when used with Redis namespaces. [#109]\n- Redis connection now just a plain ConnectionPool, not CP::Wrapper.\n- Capistrano initial deploy fix [#106]\n- Re-implemented weighted queues support (ryanlecompte)\n\n0.11.0\n-----------\n\n- Client-side API changes, added sidekiq\\_options for Sidekiq::Worker.\n  As a side effect of this change, the client API works on Ruby 1.8.\n  It's not officially supported but should work [#103]\n- NO POLL!  Sidekiq no longer polls Redis, leading to lower network\n  utilization and lower latency for message processing.\n- Add --version CLI option\n\n0.10.1\n-----------\n\n- Add details page for jobs in retry queue (jcoene)\n- Display relative timestamps in web interface (jcoene)\n- Capistrano fixes (hinrik, bensie)\n\n0.10.0\n-----------\n\n- Reworked capistrano recipe to make it more fault-tolerant [#94].\n- Automatic failure retry!  Sidekiq will now save failed messages\n  and retry them, with an exponential backoff, over about 20 days.\n  Did a message fail to process?  Just deploy a bug fix in the next\n  few days and Sidekiq will retry the message eventually.\n\n0.9.1\n-----------\n\n- Fix missed deprecations, poor method name in web UI\n\n0.9.0\n-----------\n\n- Add -t option to configure the TERM shutdown timeout\n- TERM shutdown timeout is now configurable, defaults to 5 seconds.\n- USR1 signal now stops Sidekiq from accepting new work,\n  capistrano sends USR1 at start of deploy and TERM at end of deploy\n  giving workers the maximum amount of time to finish.\n- New Sidekiq::Web rack application available\n- Updated Sidekiq.redis API\n\n0.8.0\n-----------\n\n- Remove :namespace and :server CLI options (mperham)\n- Add ExceptionNotifier support (masterkain)\n- Add capistrano support (mperham)\n- Workers now log upon start and finish (mperham)\n- Messages for terminated workers are now automatically requeued (mperham)\n- Add support for Exceptional error reporting (bensie)\n\n0.7.0\n-----------\n\n- Example chef recipe and monitrc script (jc00ke)\n- Refactor global configuration into Sidekiq.configure\\_server and\n  Sidekiq.configure\\_client blocks. (mperham)\n- Add optional middleware FailureJobs which saves failed jobs to a\n  'failed' queue (fbjork)\n- Upon shutdown, workers are now terminated after 5 seconds.  This is to\n  meet Heroku's hard limit of 10 seconds for a process to shutdown. (mperham)\n- Refactor middleware API for simplicity, see sidekiq/middleware/chain. (mperham)\n- Add `delay` extensions for ActionMailer and ActiveRecord. (mperham)\n- Added config file support. See test/config.yml for an example file.  (jc00ke)\n- Added pidfile for tools like monit (jc00ke)\n\n0.6.0\n-----------\n\n- Resque-compatible processing stats in redis (mperham)\n- Simple client testing support in sidekiq/testing (mperham)\n- Plain old Ruby support via the -r cli flag (mperham)\n- Refactored middleware support, introducing ability to add client-side middleware (ryanlecompte)\n- Added middleware for ignoring duplicate jobs (ryanlecompte)\n- Added middleware for displaying jobs in resque-web dashboard (maxjustus)\n- Added redis namespacing support (maxjustus)\n\n0.5.1\n-----------\n\n- Initial release!\n", "# frozen_string_literal: true\n\nmodule Sidekiq\n  VERSION = \"7.0.8\"\n  MAJOR = 7\nend\n", "# frozen_string_literal: true\n\nmodule Sidekiq\n  class WebApplication\n    extend WebRouter\n\n    REDIS_KEYS = %w[redis_version uptime_in_days connected_clients used_memory_human used_memory_peak_human]\n    CSP_HEADER = [\n      \"default-src 'self' https: http:\",\n      \"child-src 'self'\",\n      \"connect-src 'self' https: http: wss: ws:\",\n      \"font-src 'self' https: http:\",\n      \"frame-src 'self'\",\n      \"img-src 'self' https: http: data:\",\n      \"manifest-src 'self'\",\n      \"media-src 'self'\",\n      \"object-src 'none'\",\n      \"script-src 'self' https: http: 'unsafe-inline'\",\n      \"style-src 'self' https: http: 'unsafe-inline'\",\n      \"worker-src 'self'\",\n      \"base-uri 'self'\"\n    ].join(\"; \").freeze\n    METRICS_PERIODS = {\n      \"1h\" => 60,\n      \"2h\" => 120,\n      \"4h\" => 240,\n      \"8h\" => 480\n    }\n\n    def initialize(klass)\n      @klass = klass\n    end\n\n    def settings\n      @klass.settings\n    end\n\n    def self.settings\n      Sidekiq::Web.settings\n    end\n\n    def self.tabs\n      Sidekiq::Web.tabs\n    end\n\n    def self.set(key, val)\n      # nothing, backwards compatibility\n    end\n\n    head \"/\" do\n      # HEAD / is the cheapest heartbeat possible,\n      # it hits Redis to ensure connectivity\n      Sidekiq.redis { |c| c.llen(\"queue:default\") }\n      \"\"\n    end\n\n    get \"/\" do\n      @redis_info = redis_info.select { |k, v| REDIS_KEYS.include? k }\n      days = (params[\"days\"] || 30).to_i\n      return halt(401) if days < 1 || days > 180\n\n      stats_history = Sidekiq::Stats::History.new(days)\n      @processed_history = stats_history.processed\n      @failed_history = stats_history.failed\n\n      erb(:dashboard)\n    end\n\n    get \"/metrics\" do\n      q = Sidekiq::Metrics::Query.new\n      @period = h((params[:period] || \"\")[0..1])\n      @periods = METRICS_PERIODS\n      minutes = @periods.fetch(@period, @periods.values.first)\n      @query_result = q.top_jobs(minutes: minutes)\n      erb(:metrics)\n    end\n\n    get \"/metrics/:name\" do\n      @name = route_params[:name]\n      @period = h((params[:period] || \"\")[0..1])\n      q = Sidekiq::Metrics::Query.new\n      @periods = METRICS_PERIODS\n      minutes = @periods.fetch(@period, @periods.values.first)\n      @query_result = q.for_job(@name, minutes: minutes)\n      erb(:metrics_for_job)\n    end\n\n    get \"/busy\" do\n      @count = (params[\"count\"] || 100).to_i\n      (@current_page, @total_size, @workset) = page_items(workset, params[\"page\"], @count)\n\n      erb(:busy)\n    end\n\n    post \"/busy\" do\n      if params[\"identity\"]\n        pro = Sidekiq::ProcessSet[params[\"identity\"]]\n\n        pro.quiet! if params[\"quiet\"]\n        pro.stop! if params[\"stop\"]\n      else\n        processes.each do |pro|\n          next if pro.embedded?\n\n          pro.quiet! if params[\"quiet\"]\n          pro.stop! if params[\"stop\"]\n        end\n      end\n\n      redirect \"#{root_path}busy\"\n    end\n\n    get \"/queues\" do\n      @queues = Sidekiq::Queue.all\n\n      erb(:queues)\n    end\n\n    QUEUE_NAME = /\\A[a-z_:.\\-0-9]+\\z/i\n\n    get \"/queues/:name\" do\n      @name = route_params[:name]\n\n      halt(404) if !@name || @name !~ QUEUE_NAME\n\n      @count = (params[\"count\"] || 25).to_i\n      @queue = Sidekiq::Queue.new(@name)\n      (@current_page, @total_size, @jobs) = page(\"queue:#{@name}\", params[\"page\"], @count, reverse: params[\"direction\"] == \"asc\")\n      @jobs = @jobs.map { |msg| Sidekiq::JobRecord.new(msg, @name) }\n\n      erb(:queue)\n    end\n\n    post \"/queues/:name\" do\n      queue = Sidekiq::Queue.new(route_params[:name])\n\n      if Sidekiq.pro? && params[\"pause\"]\n        queue.pause!\n      elsif Sidekiq.pro? && params[\"unpause\"]\n        queue.unpause!\n      else\n        queue.clear\n      end\n\n      redirect \"#{root_path}queues\"\n    end\n\n    post \"/queues/:name/delete\" do\n      name = route_params[:name]\n      Sidekiq::JobRecord.new(params[\"key_val\"], name).delete\n\n      redirect_with_query(\"#{root_path}queues/#{CGI.escape(name)}\")\n    end\n\n    get \"/morgue\" do\n      @count = (params[\"count\"] || 25).to_i\n      (@current_page, @total_size, @dead) = page(\"dead\", params[\"page\"], @count, reverse: true)\n      @dead = @dead.map { |msg, score| Sidekiq::SortedEntry.new(nil, score, msg) }\n\n      erb(:morgue)\n    end\n\n    get \"/morgue/:key\" do\n      key = route_params[:key]\n      halt(404) unless key\n\n      @dead = Sidekiq::DeadSet.new.fetch(*parse_params(key)).first\n\n      if @dead.nil?\n        redirect \"#{root_path}morgue\"\n      else\n        erb(:dead)\n      end\n    end\n\n    post \"/morgue\" do\n      redirect(request.path) unless params[\"key\"]\n\n      params[\"key\"].each do |key|\n        job = Sidekiq::DeadSet.new.fetch(*parse_params(key)).first\n        retry_or_delete_or_kill job, params if job\n      end\n\n      redirect_with_query(\"#{root_path}morgue\")\n    end\n\n    post \"/morgue/all/delete\" do\n      Sidekiq::DeadSet.new.clear\n\n      redirect \"#{root_path}morgue\"\n    end\n\n    post \"/morgue/all/retry\" do\n      Sidekiq::DeadSet.new.retry_all\n\n      redirect \"#{root_path}morgue\"\n    end\n\n    post \"/morgue/:key\" do\n      key = route_params[:key]\n      halt(404) unless key\n\n      job = Sidekiq::DeadSet.new.fetch(*parse_params(key)).first\n      retry_or_delete_or_kill job, params if job\n\n      redirect_with_query(\"#{root_path}morgue\")\n    end\n\n    get \"/retries\" do\n      @count = (params[\"count\"] || 25).to_i\n      (@current_page, @total_size, @retries) = page(\"retry\", params[\"page\"], @count)\n      @retries = @retries.map { |msg, score| Sidekiq::SortedEntry.new(nil, score, msg) }\n\n      erb(:retries)\n    end\n\n    get \"/retries/:key\" do\n      @retry = Sidekiq::RetrySet.new.fetch(*parse_params(route_params[:key])).first\n\n      if @retry.nil?\n        redirect \"#{root_path}retries\"\n      else\n        erb(:retry)\n      end\n    end\n\n    post \"/retries\" do\n      redirect(request.path) unless params[\"key\"]\n\n      params[\"key\"].each do |key|\n        job = Sidekiq::RetrySet.new.fetch(*parse_params(key)).first\n        retry_or_delete_or_kill job, params if job\n      end\n\n      redirect_with_query(\"#{root_path}retries\")\n    end\n\n    post \"/retries/all/delete\" do\n      Sidekiq::RetrySet.new.clear\n\n      redirect \"#{root_path}retries\"\n    end\n\n    post \"/retries/all/retry\" do\n      Sidekiq::RetrySet.new.retry_all\n\n      redirect \"#{root_path}retries\"\n    end\n\n    post \"/retries/all/kill\" do\n      Sidekiq::RetrySet.new.kill_all\n\n      redirect \"#{root_path}retries\"\n    end\n\n    post \"/retries/:key\" do\n      job = Sidekiq::RetrySet.new.fetch(*parse_params(route_params[:key])).first\n\n      retry_or_delete_or_kill job, params if job\n\n      redirect_with_query(\"#{root_path}retries\")\n    end\n\n    get \"/scheduled\" do\n      @count = (params[\"count\"] || 25).to_i\n      (@current_page, @total_size, @scheduled) = page(\"schedule\", params[\"page\"], @count)\n      @scheduled = @scheduled.map { |msg, score| Sidekiq::SortedEntry.new(nil, score, msg) }\n\n      erb(:scheduled)\n    end\n\n    get \"/scheduled/:key\" do\n      @job = Sidekiq::ScheduledSet.new.fetch(*parse_params(route_params[:key])).first\n\n      if @job.nil?\n        redirect \"#{root_path}scheduled\"\n      else\n        erb(:scheduled_job_info)\n      end\n    end\n\n    post \"/scheduled\" do\n      redirect(request.path) unless params[\"key\"]\n\n      params[\"key\"].each do |key|\n        job = Sidekiq::ScheduledSet.new.fetch(*parse_params(key)).first\n        delete_or_add_queue job, params if job\n      end\n\n      redirect_with_query(\"#{root_path}scheduled\")\n    end\n\n    post \"/scheduled/:key\" do\n      key = route_params[:key]\n      halt(404) unless key\n\n      job = Sidekiq::ScheduledSet.new.fetch(*parse_params(key)).first\n      delete_or_add_queue job, params if job\n\n      redirect_with_query(\"#{root_path}scheduled\")\n    end\n\n    get \"/dashboard/stats\" do\n      redirect \"#{root_path}stats\"\n    end\n\n    get \"/stats\" do\n      sidekiq_stats = Sidekiq::Stats.new\n      redis_stats = redis_info.select { |k, v| REDIS_KEYS.include? k }\n      json(\n        sidekiq: {\n          processed: sidekiq_stats.processed,\n          failed: sidekiq_stats.failed,\n          busy: sidekiq_stats.workers_size,\n          processes: sidekiq_stats.processes_size,\n          enqueued: sidekiq_stats.enqueued,\n          scheduled: sidekiq_stats.scheduled_size,\n          retries: sidekiq_stats.retry_size,\n          dead: sidekiq_stats.dead_size,\n          default_latency: sidekiq_stats.default_queue_latency\n        },\n        redis: redis_stats,\n        server_utc_time: server_utc_time\n      )\n    end\n\n    get \"/stats/queues\" do\n      json Sidekiq::Stats.new.queues\n    end\n\n    def call(env)\n      action = self.class.match(env)\n      return [404, {\"content-type\" => \"text/plain\", \"x-cascade\" => \"pass\"}, [\"Not Found\"]] unless action\n\n      app = @klass\n      resp = catch(:halt) do\n        self.class.run_befores(app, action)\n        action.instance_exec env, &action.block\n      ensure\n        self.class.run_afters(app, action)\n      end\n\n      case resp\n      when Array\n        # redirects go here\n        resp\n      else\n        # rendered content goes here\n        headers = {\n          \"content-type\" => \"text/html\",\n          \"cache-control\" => \"private, no-store\",\n          \"content-language\" => action.locale,\n          \"content-security-policy\" => CSP_HEADER\n        }\n        # we'll let Rack calculate Content-Length for us.\n        [200, headers, [resp]]\n      end\n    end\n\n    def self.helpers(mod = nil, &block)\n      if block\n        WebAction.class_eval(&block)\n      else\n        WebAction.send(:include, mod)\n      end\n    end\n\n    def self.before(path = nil, &block)\n      befores << [path && Regexp.new(\"\\\\A#{path.gsub(\"*\", \".*\")}\\\\z\"), block]\n    end\n\n    def self.after(path = nil, &block)\n      afters << [path && Regexp.new(\"\\\\A#{path.gsub(\"*\", \".*\")}\\\\z\"), block]\n    end\n\n    def self.run_befores(app, action)\n      run_hooks(befores, app, action)\n    end\n\n    def self.run_afters(app, action)\n      run_hooks(afters, app, action)\n    end\n\n    def self.run_hooks(hooks, app, action)\n      hooks.select { |p, _| !p || p =~ action.env[WebRouter::PATH_INFO] }\n        .each { |_, b| action.instance_exec(action.env, app, &b) }\n    end\n\n    def self.befores\n      @befores ||= []\n    end\n\n    def self.afters\n      @afters ||= []\n    end\n  end\nend\n"], "filenames": ["Changes.md", "lib/sidekiq/version.rb", "lib/sidekiq/web/application.rb"], "buggy_code_start_loc": [5, 4, 71], "buggy_code_end_loc": [9, 5, 81], "fixing_code_start_loc": [5, 4, 71], "fixing_code_end_loc": [12, 5, 81], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Reflected in GitHub repository sidekiq/sidekiq prior to 7.0.8.", "other": {"cve": {"id": "CVE-2023-1892", "sourceIdentifier": "security@huntr.dev", "published": "2023-04-21T05:15:07.057", "lastModified": "2023-06-09T18:07:41.737", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Reflected in GitHub repository sidekiq/sidekiq prior to 7.0.8."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.6, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.8, "impactScore": 6.0}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "LOW", "baseScore": 8.3, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.5}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:contribsys:sidekiq:*:*:*:*:*:*:*:*", "versionStartIncluding": "7.0.4", "versionEndExcluding": "7.0.8", "matchCriteriaId": "5B32B98F-EEB2-4982-976A-BEC2ECE01909"}]}]}], "references": [{"url": "https://github.com/sidekiq/sidekiq/commit/458fdf74176a9881478c48dc5cf0269107b22214", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/e35e5653-c429-4fb8-94a3-cbc123ae4777", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/sidekiq/sidekiq/commit/458fdf74176a9881478c48dc5cf0269107b22214"}}