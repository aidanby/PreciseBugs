{"buggy_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2016\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\ninclude \"root.php\";\nrequire_once \"resources/require.php\";\nrequire_once \"resources/check_auth.php\";\nif (permission_exists(\"backup_download\")) {\n\t//access granted\n}\nelse {\n\techo \"access denied\";\n\texit;\n}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//download the backup\n\tif ($_GET['a'] == \"download\" && permission_exists('backup_download')) {\n\t\t$file_format = $_GET['file_format'];\n\t\t$file_format = ($file_format != '') ? $file_format : 'tgz';\n\n\t\t//build the backup file\n\t\t\t$backup_path = ($_SESSION['server']['backup']['path'] != '') ? $_SESSION['server']['backup']['path'] : '/tmp';\n\t\t\t$backup_file = 'backup_'.date('Ymd_His').'.'.$file_format;\n\t\t\tif (count($_SESSION['backup']['path']) > 0) {\n\t\t\t\t//determine compression method\n\t\t\t\tswitch ($file_format) {\n\t\t\t\t\tcase \"rar\" : $cmd = 'rar a -ow -r '; break;\n\t\t\t\t\tcase \"zip\" : $cmd = 'zip -r '; break;\n\t\t\t\t\tcase \"tbz\" : $cmd = 'tar -jvcf '; break;\n\t\t\t\t\tdefault : $cmd = 'tar -zvcf ';\n\t\t\t\t}\n\t\t\t\t$cmd .= $backup_path.'/'.$backup_file.' ';\n\t\t\t\tif (isset($_SESSION['backup']['path'])) foreach ($_SESSION['backup']['path'] as $value) {\n\t\t\t\t\t$cmd .= $value.' ';\n\t\t\t\t}\n\t\t\t\t$cmd .= \" 2>&1\";\n\t\t\t\texec($cmd, $response, $restore_errlevel);\n\t\t\t\t$response_txt = \"<br>\" . implode(\"<br>\", $response);\n\n\t\t\t//download the file\n\t\t\t\tsession_cache_limiter('public');\n\t\t\t\tif (file_exists($backup_path.\"/\".$backup_file)) {\n\t\t\t\t\t$fd = fopen($backup_path.\"/\".$backup_file, 'rb');\n\t\t\t\t\theader(\"Content-Type: application/octet-stream\");\n\t\t\t\t\theader(\"Content-Transfer-Encoding: binary\");\n\t\t\t\t\theader(\"Content-Description: File Transfer\");\n\t\t\t\t\theader('Content-Disposition: attachment; filename='.$backup_file);\n\t\t\t\t\theader(\"Cache-Control: no-cache, must-revalidate\"); // HTTP/1.1\n\t\t\t\t\theader(\"Expires: Sat, 26 Jul 1997 05:00:00 GMT\"); // Date in the past\n\t\t\t\t\theader(\"Content-Length: \".filesize($backup_path.\"/\".$backup_file));\n\t\t\t\t\theader(\"Pragma: no-cache\");\n\t\t\t\t\theader(\"Expires: 0\");\n\t\t\t\t\tob_clean();\n\t\t\t\t\tfpassthru($fd);\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t//set response message\n\t\t\t\t\tmessage::add($text['message-backup_failed_format'] . $response_txt, 'negative');\n\t\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t//set response message\n\t\t\t\tmessage::add($text['message-backup_failed_paths'], 'negative');\n\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\texit;\n\t\t\t}\n\t}\n\n//script a backup (cron)\n\tif ($_GET['a'] == \"script\" && permission_exists('backup_download')) {\n\t\t$file_format = $_GET['file_format'];\n\t\t$target_type = \"script\";\n\n\t\t$backup = new backup;\n\t\t$command = $backup->command(\"backup\", $file_format);\n\t}\n\n//restore a backup\n\tif ($_POST['a'] == \"restore\" && permission_exists('backup_upload')) {\n\n\t\t$backup_path = ($_SESSION['server']['backup']['path'] != '') ? $_SESSION['server']['backup']['path'] : '/tmp';\n\t\t$backup_file = $_FILES['backup_file']['name'];\n\n\t\tif (is_uploaded_file($_FILES['backup_file']['tmp_name'])) {\n\t\t\t//move temp file to backup path\n\t\t\tmove_uploaded_file($_FILES['backup_file']['tmp_name'], $backup_path.'/'.$backup_file);\n\t\t\t//determine file format and restore backup\n\t\t\t$file_format = pathinfo($_FILES['backup_file']['name'], PATHINFO_EXTENSION);\n\t\t\t$valid_format = true;\n\t\t\tswitch ($file_format) {\n\t\t\t\tcase \"rar\" : $cmd = 'rar x -ow -o+ '.$backup_path.'/'.$backup_file.' /'; break;\n\t\t\t\tcase \"zip\" : $cmd = 'umask 755; unzip -o -qq -X -K '.$backup_path.'/'.$backup_file.' -d /'; break;\n\t\t\t\tcase \"tbz\" : $cmd = 'tar -xvpjf '.$backup_path.'/'.$backup_file.' -C /'; break;\n\t\t\t\tcase \"tgz\" : $cmd = 'tar -xvpzf '.$backup_path.'/'.$backup_file.' -C /'; break;\n\t\t\t\tdefault: $valid_format = false;\n\t\t\t}\n\t\t\tif (!$valid_format) {\n\t\t\t\t@unlink($backup_path.'/'.$backup_file);\n\t\t\t\tmessage::add($text['message-restore_failed_format'], 'negative');\n\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\texit;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$cmd .= ' 2>&1';\n\t\t\t\texec($cmd, $response, $restore_errlevel);\n\t\t\t\t$response_txt = \"<br>\" . implode(\"<br>\", $response);\n\t\t\t\tif ($restore_errlevel == 0) {\n\t\t\t\t\t//set response message\n\t\t\t\t\tmessage::add($text['message-restore_completed']);\n\t\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\t\texit;\n\t\t\t\t} else {\n\t\t\t\t\tmessage::add($text['message-restore_failed_extract'] . $response_txt, 'negative');\n\t\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t//set response message\n\t\t\tmessage::add($text['message-restore_failed_upload'], 'negative');\n\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\texit;\n\t\t}\n\t}\n\n//add the header\n\trequire_once \"resources/header.php\";\n\t$document['title'] = $text['title-destinations'];\n\n// backup type switch javascript\n\techo \"<script language='javascript' type='text/javascript'>\";\n\techo \"\tvar fade_speed = 400;\";\n\techo \"\tfunction toggle_target(first_elem, second_elem) {\";\n\techo \"\t\t$('#command').fadeOut(fade_speed);\";\n\techo \"\t\t$('#'+first_elem).fadeToggle(fade_speed, function() {\";\n\techo \"\t\t\t$('#command').slideUp(fade_speed, function() {\";\n\techo \"\t\t\t\t$('#'+second_elem).fadeToggle(fade_speed);\";\n\techo \"\t\t\t});\";\n\techo \"\t\t});\";\n\techo \"\t}\";\n\techo \"</script>\";\n\n//show the content\n\techo \"<table width='100%' cellpadding='0' cellspacing='0' border='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' valign='top'>\\n\";\n\n\techo \"<b>\".$text['header-backup'].\"</b>\\n\";\n\techo \"<br><br>\";\n\techo $text['description-backup'].\"\\n\";\n\techo \"<br><br><br>\";\n\techo \"<table border='0' cellpadding='0' cellspacing='0' width='100%'>\\n\";\n\techo \"<tr>\\n\";\n\techo \"<td width='30%' class='vncell' valign='top' align='left' nowrap='nowrap'>\\n\";\n\techo \"\t\".$text['label-source_paths'].\"\\n\";\n\techo \"</td>\\n\";\n\techo \"<td width='70%' class='vtable' align='left'>\\n\";\n\tif (isset($_SESSION['backup']['path'])) foreach ($_SESSION['backup']['path'] as $backup_path) {\n\t\techo $backup_path.\"<br>\\n\";\n\t}\n\techo \"</td>\";\n\techo \"</tr>\";\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' align='left' nowrap='nowrap'>\\n\";\n\techo \"\t\".$text['label-file_format'].\"\\n\";\n\techo \"</td>\\n\";\n\techo \"<td class='vtable' align='left'>\\n\";\n\techo \"\t<select class='formfld' name='file_format' id='file_format'>\";\n\techo \"\t\t<option value='tgz' \".(($file_format == 'tgz') ? 'selected' : null).\">TAR GZIP</option>\";\n\techo \"\t\t<option value='tbz' \".(($file_format == 'tbz') ? 'selected' : null).\">TAR BZIP</option>\";\n\techo \"\t\t<option value='rar' \".(($file_format == 'rar') ? 'selected' : null).\">RAR</option>\";\n\techo \"\t\t<option value='zip' \".(($file_format == 'zip') ? 'selected' : null).\">ZIP</option>\";\n\techo \"\t</select>\";\n\techo \"</td>\";\n\techo \"</tr>\";\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' align='left' nowrap='nowrap'>\\n\";\n\techo \"\t\".$text['label-target_type'].\"\\n\";\n\techo \"</td>\\n\";\n\techo \"<td class='vtable' align='left'>\\n\";\n\techo \"\t<select class='formfld' name='target_type' id='target_type' onchange=\\\"(this.selectedIndex == 0) ? toggle_target('btn_script','btn_download') : toggle_target('btn_download','btn_script');\\\">\";\n\techo \"\t\t<option value='download'>\".$text['option-file_download'].\"</option>\";\n\techo \"\t\t<option value='script' \".(($target_type == 'script') ? 'selected' : null).\">\".$text['option-command'].\"</option>\";\n\techo \"\t</select>\";\n\techo \"</td>\";\n\techo \"</tr>\";\n\techo \"</table>\";\n\techo \"<div id='command' \".(($command == '') ? \"style='display: none;'\" : null).\">\";\n\techo \"<table border='0' cellpadding='0' cellspacing='0' width='100%'>\\n\";\n\techo \"<tr>\\n\";\n\techo \"<td width='30%' class='vncell' valign='top' align='left' nowrap='nowrap'>\\n\";\n\techo \"\t\".$text['label-command'].\"\\n\";\n\techo \"</td>\\n\";\n\techo \"<td width='70%' class='vtable' align='left'>\\n\";\n\techo \"\t<textarea class='formfld' style='width: 100%; height: 200px; font-family: courier;'>\".$command.\"</textarea>\";\n\techo \"</td>\";\n\techo \"</tr>\";\n\techo \"</table>\";\n\techo \"</div>\";\n\techo \"<br>\";\n\techo \"<div align='right'>\";\n\techo \"<input type='button' id='btn_script' class='btn' \".(($target_type != 'script') ? \"style='display: none;'\" : null).\" value='\".$text['button-generate'].\"' onclick=\\\"document.location.href='\".PROJECT_PATH.\"/app/backup/index.php?a=script&file_format='+document.getElementById('file_format').options[document.getElementById('file_format').selectedIndex].value;\\\">\";\n\techo \"<input type='button' id='btn_download' class='btn' \".(($target_type == 'script') ? \"style='display: none;'\" : null).\" value='\".$text['button-download'].\"' onclick=\\\"document.location.href='\".PROJECT_PATH.\"/app/backup/index.php?a=download&file_format='+document.getElementById('file_format').options[document.getElementById('file_format').selectedIndex].value;\\\">\";\n\techo \"</div>\";\n\techo \"<br><br>\";\n\n\tif (permission_exists(\"backup_upload\")) {\n\t\techo \"\t\t</td>\\n\";\n\t\techo \"\t\t<td width='20'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>\\n\";\n\t\techo \"\t\t<td width='50%' valign='top'>\\n\";\n\t\techo \"\t\t\t<b>\".$text['header-restore'].\"</b>\\n\";\n\t\techo \"\t\t\t<br><br>\";\n\t\techo $text['description-restore'].\"\\n\";\n\t\techo \"\t\t\t<br><br><br>\";\n\t\techo \"\t\t\t<div align='center'>\";\n\t\techo \"\t\t\t\t<form name='frmrestore' method='post' enctype='multipart/form-data' action=''>\";\n\t\techo \"\t\t\t\t<input type='hidden' name='a' value='restore'>\";\n\t\techo \"\t\t\t\t<table>\";\n\t\techo \"\t\t\t\t<tr>\";\n\t\techo \"\t\t\t\t\t<td nowrap>\".$text['label-select_backup'].\"&nbsp;</td>\";\n\t\techo \"\t\t\t\t\t<td><input type='file' class='formfld fileinput' name='backup_file'></td>\";\n\t\techo \"\t\t\t\t\t<td><input type='submit' class='btn' value='\".$text['button-restore'].\"'></td>\";\n\t\techo \"\t\t\t\t</tr>\";\n\t\techo \"\t\t\t\t</table>\";\n\t\techo \"\t\t\t\t<br>\";\n\t\techo \"\t\t\t\t<span style='font-weight: bold; text-decoration: underline; color: #000;'>\".$text['description-restore_warning'].\"</span>\";\n\t\techo \"\t\t\t\t</form>\\n\";\n\t\techo \"\t\t\t</div>\";\n\t\techo \"\t\t</td>\\n\";\n\t}\n\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\techo \"<br><br>\";\n\n //show the footer\n \trequire_once \"resources/footer.php\";\n\n?>"], "fixing_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\n\tThe Original Code is FusionPBX\n\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n\tPortions created by the Initial Developer are Copyright (C) 2008-2019\n\tthe Initial Developer. All Rights Reserved.\n\n\tContributor(s):\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n//includes\n\tinclude \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\n//check permissions\n\tif (permission_exists(\"backup_download\")) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//download the backup\n\tif ($_GET['a'] == \"download\" && permission_exists('backup_download')) {\n\t\t//get the file format\n\t\t\t$file_format = $_GET['file_format'];\n\t\t\t$file_format = ($file_format != '') ? $file_format : 'tgz';\n\n\t\t//build the backup file\n\t\t\t$backup_path = ($_SESSION['server']['backup']['path'] != '') ? $_SESSION['server']['backup']['path'] : '/tmp';\n\t\t\t$backup_file = 'backup_'.date('Ymd_His').'.'.$file_format;\n\t\t\tif (count($_SESSION['backup']['path']) > 0) {\n\t\t\t\t//determine compression method\n\t\t\t\tswitch ($file_format) {\n\t\t\t\t\tcase \"rar\" : $cmd = 'rar a -ow -r '; break;\n\t\t\t\t\tcase \"zip\" : $cmd = 'zip -r '; break;\n\t\t\t\t\tcase \"tbz\" : $cmd = 'tar -jvcf '; break;\n\t\t\t\t\tdefault : $cmd = 'tar -zvcf ';\n\t\t\t\t}\n\t\t\t\t$cmd .= $backup_path.'/'.$backup_file.' ';\n\t\t\t\tif (isset($_SESSION['backup']['path'])) {\n\t\t\t\t\tforeach ($_SESSION['backup']['path'] as $value) {\n\t\t\t\t\t\tif (file_exists($value)) {\n\t\t\t\t\t\t\t$cmd .= $value.' ';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$cmd .= \" 2>&1\";\n\t\t\t\texec($cmd, $response, $restore_errlevel);\n\t\t\t\t$response_txt = \"<br>\" . implode(\"<br>\", $response);\n\n\t\t\t//download the file\n\t\t\t\tsession_cache_limiter('public');\n\t\t\t\tif (file_exists($backup_path.\"/\".$backup_file)) {\n\t\t\t\t\t$fd = fopen($backup_path.\"/\".$backup_file, 'rb');\n\t\t\t\t\theader(\"Content-Type: application/octet-stream\");\n\t\t\t\t\theader(\"Content-Transfer-Encoding: binary\");\n\t\t\t\t\theader(\"Content-Description: File Transfer\");\n\t\t\t\t\theader('Content-Disposition: attachment; filename='.$backup_file);\n\t\t\t\t\theader(\"Cache-Control: no-cache, must-revalidate\"); // HTTP/1.1\n\t\t\t\t\theader(\"Expires: Sat, 26 Jul 1997 05:00:00 GMT\"); // Date in the past\n\t\t\t\t\theader(\"Content-Length: \".filesize($backup_path.\"/\".$backup_file));\n\t\t\t\t\theader(\"Pragma: no-cache\");\n\t\t\t\t\theader(\"Expires: 0\");\n\t\t\t\t\tob_clean();\n\t\t\t\t\tfpassthru($fd);\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t//set response message\n\t\t\t\t\tmessage::add($text['message-backup_failed_format'] . $response_txt, 'negative');\n\t\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t//set response message\n\t\t\t\tmessage::add($text['message-backup_failed_paths'], 'negative');\n\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\texit;\n\t\t\t}\n\t}\n\n//script a backup (cron)\n\tif ($_GET['a'] == \"script\" && permission_exists('backup_download')) {\n\t\t$file_format = $_GET['file_format'];\n\t\t$target_type = \"script\";\n\n\t\t$backup = new backup;\n\t\t$command = $backup->command(\"backup\", $file_format);\n\t}\n\n//restore a backup\n\tif ($_POST['a'] == \"restore\" && permission_exists('backup_upload')) {\n\n\t\t$backup_path = ($_SESSION['server']['backup']['path'] != '') ? $_SESSION['server']['backup']['path'] : '/tmp';\n\t\t$backup_file = $_FILES['backup_file']['name'];\n\n\t\tif (is_uploaded_file($_FILES['backup_file']['tmp_name']) && file_exists($backup_path.'/'.$backup_file)) {\n\t\t\t//move temp file to backup path\n\t\t\tmove_uploaded_file($_FILES['backup_file']['tmp_name'], $backup_path.'/'.$backup_file);\n\t\t\t//determine file format and restore backup\n\t\t\t$file_format = pathinfo($_FILES['backup_file']['name'], PATHINFO_EXTENSION);\n\t\t\t$valid_format = true;\n\t\t\tswitch ($file_format) {\n\t\t\t\tcase \"rar\" : $cmd = 'rar x -ow -o+ '.$backup_path.'/'.$backup_file.' /'; break;\n\t\t\t\tcase \"zip\" : $cmd = 'umask 755; unzip -o -qq -X -K '.$backup_path.'/'.$backup_file.' -d /'; break;\n\t\t\t\tcase \"tbz\" : $cmd = 'tar -xvpjf '.$backup_path.'/'.$backup_file.' -C /'; break;\n\t\t\t\tcase \"tgz\" : $cmd = 'tar -xvpzf '.$backup_path.'/'.$backup_file.' -C /'; break;\n\t\t\t\tdefault: $valid_format = false;\n\t\t\t}\n\t\t\tif (!$valid_format) {\n\t\t\t\t@unlink($backup_path.'/'.$backup_file);\n\t\t\t\tmessage::add($text['message-restore_failed_format'], 'negative');\n\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\texit;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$cmd .= ' 2>&1';\n\t\t\t\texec($cmd, $response, $restore_errlevel);\n\t\t\t\t$response_txt = \"<br>\" . implode(\"<br>\", $response);\n\t\t\t\tif ($restore_errlevel == 0) {\n\t\t\t\t\t//set response message\n\t\t\t\t\tmessage::add($text['message-restore_completed']);\n\t\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\t\texit;\n\t\t\t\t} else {\n\t\t\t\t\tmessage::add($text['message-restore_failed_extract'] . $response_txt, 'negative');\n\t\t\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t//set response message\n\t\t\tmessage::add($text['message-restore_failed_upload'], 'negative');\n\t\t\theader(\"Location: \".$_SERVER['PHP_SELF']);\n\t\t\texit;\n\t\t}\n\t}\n\n//add the header\n\trequire_once \"resources/header.php\";\n\t$document['title'] = $text['title-destinations'];\n\n// backup type switch javascript\n\techo \"<script language='javascript' type='text/javascript'>\";\n\techo \"\tvar fade_speed = 400;\";\n\techo \"\tfunction toggle_target(first_elem, second_elem) {\";\n\techo \"\t\t$('#command').fadeOut(fade_speed);\";\n\techo \"\t\t$('#'+first_elem).fadeToggle(fade_speed, function() {\";\n\techo \"\t\t\t$('#command').slideUp(fade_speed, function() {\";\n\techo \"\t\t\t\t$('#'+second_elem).fadeToggle(fade_speed);\";\n\techo \"\t\t\t});\";\n\techo \"\t\t});\";\n\techo \"\t}\";\n\techo \"</script>\";\n\n//show the content\n\techo \"<table width='100%' cellpadding='0' cellspacing='0' border='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' valign='top'>\\n\";\n\n\techo \"<b>\".$text['header-backup'].\"</b>\\n\";\n\techo \"<br><br>\";\n\techo $text['description-backup'].\"\\n\";\n\techo \"<br><br><br>\";\n\techo \"<table border='0' cellpadding='0' cellspacing='0' width='100%'>\\n\";\n\techo \"<tr>\\n\";\n\techo \"<td width='30%' class='vncell' valign='top' align='left' nowrap='nowrap'>\\n\";\n\techo \"\t\".$text['label-source_paths'].\"\\n\";\n\techo \"</td>\\n\";\n\techo \"<td width='70%' class='vtable' align='left'>\\n\";\n\tif (isset($_SESSION['backup']['path'])) foreach ($_SESSION['backup']['path'] as $backup_path) {\n\t\techo $backup_path.\"<br>\\n\";\n\t}\n\techo \"</td>\";\n\techo \"</tr>\";\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' align='left' nowrap='nowrap'>\\n\";\n\techo \"\t\".$text['label-file_format'].\"\\n\";\n\techo \"</td>\\n\";\n\techo \"<td class='vtable' align='left'>\\n\";\n\techo \"\t<select class='formfld' name='file_format' id='file_format'>\";\n\techo \"\t\t<option value='tgz' \".(($file_format == 'tgz') ? 'selected' : null).\">TAR GZIP</option>\";\n\techo \"\t\t<option value='tbz' \".(($file_format == 'tbz') ? 'selected' : null).\">TAR BZIP</option>\";\n\techo \"\t\t<option value='rar' \".(($file_format == 'rar') ? 'selected' : null).\">RAR</option>\";\n\techo \"\t\t<option value='zip' \".(($file_format == 'zip') ? 'selected' : null).\">ZIP</option>\";\n\techo \"\t</select>\";\n\techo \"</td>\";\n\techo \"</tr>\";\n\techo \"<tr>\\n\";\n\techo \"<td class='vncell' valign='top' align='left' nowrap='nowrap'>\\n\";\n\techo \"\t\".$text['label-target_type'].\"\\n\";\n\techo \"</td>\\n\";\n\techo \"<td class='vtable' align='left'>\\n\";\n\techo \"\t<select class='formfld' name='target_type' id='target_type' onchange=\\\"(this.selectedIndex == 0) ? toggle_target('btn_script','btn_download') : toggle_target('btn_download','btn_script');\\\">\";\n\techo \"\t\t<option value='download'>\".$text['option-file_download'].\"</option>\";\n\techo \"\t\t<option value='script' \".(($target_type == 'script') ? 'selected' : null).\">\".$text['option-command'].\"</option>\";\n\techo \"\t</select>\";\n\techo \"</td>\";\n\techo \"</tr>\";\n\techo \"</table>\";\n\techo \"<div id='command' \".(($command == '') ? \"style='display: none;'\" : null).\">\";\n\techo \"<table border='0' cellpadding='0' cellspacing='0' width='100%'>\\n\";\n\techo \"<tr>\\n\";\n\techo \"<td width='30%' class='vncell' valign='top' align='left' nowrap='nowrap'>\\n\";\n\techo \"\t\".$text['label-command'].\"\\n\";\n\techo \"</td>\\n\";\n\techo \"<td width='70%' class='vtable' align='left'>\\n\";\n\techo \"\t<textarea class='formfld' style='width: 100%; height: 200px; font-family: courier;'>\".$command.\"</textarea>\";\n\techo \"</td>\";\n\techo \"</tr>\";\n\techo \"</table>\";\n\techo \"</div>\";\n\techo \"<br>\";\n\techo \"<div align='right'>\";\n\techo \"<input type='button' id='btn_script' class='btn' \".(($target_type != 'script') ? \"style='display: none;'\" : null).\" value='\".$text['button-generate'].\"' onclick=\\\"document.location.href='\".PROJECT_PATH.\"/app/backup/index.php?a=script&file_format='+document.getElementById('file_format').options[document.getElementById('file_format').selectedIndex].value;\\\">\";\n\techo \"<input type='button' id='btn_download' class='btn' \".(($target_type == 'script') ? \"style='display: none;'\" : null).\" value='\".$text['button-download'].\"' onclick=\\\"document.location.href='\".PROJECT_PATH.\"/app/backup/index.php?a=download&file_format='+document.getElementById('file_format').options[document.getElementById('file_format').selectedIndex].value;\\\">\";\n\techo \"</div>\";\n\techo \"<br><br>\";\n\n\tif (permission_exists(\"backup_upload\")) {\n\t\techo \"\t\t</td>\\n\";\n\t\techo \"\t\t<td width='20'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>\\n\";\n\t\techo \"\t\t<td width='50%' valign='top'>\\n\";\n\t\techo \"\t\t\t<b>\".$text['header-restore'].\"</b>\\n\";\n\t\techo \"\t\t\t<br><br>\";\n\t\techo $text['description-restore'].\"\\n\";\n\t\techo \"\t\t\t<br><br><br>\";\n\t\techo \"\t\t\t<div align='center'>\";\n\t\techo \"\t\t\t\t<form name='frmrestore' method='post' enctype='multipart/form-data' action=''>\";\n\t\techo \"\t\t\t\t<input type='hidden' name='a' value='restore'>\";\n\t\techo \"\t\t\t\t<table>\";\n\t\techo \"\t\t\t\t<tr>\";\n\t\techo \"\t\t\t\t\t<td nowrap>\".$text['label-select_backup'].\"&nbsp;</td>\";\n\t\techo \"\t\t\t\t\t<td><input type='file' class='formfld fileinput' name='backup_file'></td>\";\n\t\techo \"\t\t\t\t\t<td><input type='submit' class='btn' value='\".$text['button-restore'].\"'></td>\";\n\t\techo \"\t\t\t\t</tr>\";\n\t\techo \"\t\t\t\t</table>\";\n\t\techo \"\t\t\t\t<br>\";\n\t\techo \"\t\t\t\t<span style='font-weight: bold; text-decoration: underline; color: #000;'>\".$text['description-restore_warning'].\"</span>\";\n\t\techo \"\t\t\t\t</form>\\n\";\n\t\techo \"\t\t\t</div>\";\n\t\techo \"\t\t</td>\\n\";\n\t}\n\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\techo \"<br><br>\";\n\n //show the footer\n \trequire_once \"resources/footer.php\";\n\n?>\n"], "filenames": ["app/backup/index.php"], "buggy_code_start_loc": [20], "buggy_code_end_loc": [269], "fixing_code_start_loc": [20], "fixing_code_end_loc": [277], "type": "CWE-78", "message": "app/backup/index.php in the Backup Module in FusionPBX 4.4.3 suffers from a command injection vulnerability due to a lack of input validation, which allows authenticated administrative attackers to execute commands on the host.", "other": {"cve": {"id": "CVE-2019-11410", "sourceIdentifier": "cve@mitre.org", "published": "2019-06-17T19:15:11.390", "lastModified": "2020-08-24T17:37:01.140", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "app/backup/index.php in the Backup Module in FusionPBX 4.4.3 suffers from a command injection vulnerability due to a lack of input validation, which allows authenticated administrative attackers to execute commands on the host."}, {"lang": "es", "value": "app / backup / index.php en el m\u00f3dulo de copia de seguridad en FusionPBX 4.4.3 sufre una vulnerabilidad de inyecci\u00f3n de comandos debido a la falta de validaci\u00f3n de entrada, lo que permite a los atacantes administrativos identificados ejecutar comandos en el host"}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.2, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.2, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:C/I:C/A:C", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "COMPLETE", "integrityImpact": "COMPLETE", "availabilityImpact": "COMPLETE", "baseScore": 9.0}, "baseSeverity": "HIGH", "exploitabilityScore": 8.0, "impactScore": 10.0, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-78"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:4.4.3:*:*:*:*:*:*:*", "matchCriteriaId": "ED771627-B19B-4F2E-8366-2D98F13BF022"}]}]}], "references": [{"url": "https://blog.gdssecurity.com/labs/2019/6/7/rce-using-caller-id-multiple-vulnerabilities-in-fusionpbx.html", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "https://github.com/fusionpbx/fusionpbx/commit/0f965c89288de449236ad6de4f97960814ce8c84", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/0f965c89288de449236ad6de4f97960814ce8c84"}}