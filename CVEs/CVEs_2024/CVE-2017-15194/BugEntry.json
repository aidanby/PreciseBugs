{"buggy_code": ["<?php\n/*\n +-------------------------------------------------------------------------+\n | Copyright (C) 2004-2017 The Cacti Group                                 |\n |                                                                         |\n | This program is free software; you can redistribute it and/or           |\n | modify it under the terms of the GNU General Public License             |\n | as published by the Free Software Foundation; either version 2          |\n | of the License, or (at your option) any later version.                  |\n |                                                                         |\n | This program is distributed in the hope that it will be useful,         |\n | but WITHOUT ANY WARRANTY; without even the implied warranty of          |\n | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           |\n | GNU General Public License for more details.                            |\n +-------------------------------------------------------------------------+\n | Cacti: The Complete RRDTool-based Graphing Solution                     |\n +-------------------------------------------------------------------------+\n | This code is designed, written, and maintained by the Cacti Group. See  |\n | about.php and/or the AUTHORS file for specific developer information.   |\n +-------------------------------------------------------------------------+\n | http://www.cacti.net/                                                   |\n +-------------------------------------------------------------------------+\n*/\n\nglobal $config, $refresh;\n\n$script = basename($_SERVER['SCRIPT_NAME']);\nif ($script == 'graph_view.php' || $script == 'graph.php') {\n\tif (isset($_SESSION['custom']) && $_SESSION['custom'] == true) {\n\t\t$refreshIsLogout = 'true';\n\t}else if (isset_request_var('action') && get_nfilter_request_var('action') == 'zoom') {\n\t\t$refreshIsLogout = 'true';\n\t} else {\n\t\t$refresh = api_plugin_hook_function('top_graph_refresh', read_user_setting('page_refresh'));\n\t\t$refreshIsLogout = 'false';\n\t}\n} elseif (strstr($_SERVER['SCRIPT_NAME'], 'plugins')) {\n\t$refresh = api_plugin_hook_function('top_graph_refresh', $refresh);\n\tif (empty($refresh)) {\n\t\t$refreshIsLogout = 'true';\n\t} else {\n\t\t$refreshIsLogout = 'false';\n\t}\n}\n\nif (isset($_SESSION['refresh'])) {\n\tif (isset($_SESSION['refresh']['seconds'])) {\n\t\t$myrefresh['seconds'] = $_SESSION['refresh']['seconds'];\n\t} else {\n\t\t$myrefresh['seconds'] = ini_get('session.gc_maxlifetime');\n\t}\n\n    if (isset($_SESSION['refresh']['logout'])) {\n        $refreshIsLogout = $_SESSION['refresh']['logout'];\n    } else {\n\t\t$refreshIsLogout = 'true';\n\t}\n\n    if (isset($_SESSION['refresh']['page'])) {\n        $myrefresh['page'] = $_SESSION['refresh']['page'];\n    } else {\n\t\t$myrefresh['page'] = $config['url_path'] . 'logout.php?action=timeout';\n\t}\n\n\tunset($_SESSION['refresh']);\n} elseif (isset($refresh) && is_array($refresh)) {\n\t$refreshIsLogout = 'false';\n\t$myrefresh['seconds'] = $refresh['seconds'];\n\t$myrefresh['page']    = (strpos($refresh['page'], '?') ? '&':'?') . 'header=false';\n} elseif (isset($refresh)) {\n\t$refreshIsLogout = 'false';\n\t$myrefresh['seconds'] = $refresh;\n\t$myrefresh['page']    = $_SERVER['REQUEST_URI'] . (strpos($_SERVER['REQUEST_URI'], '?') ? '&':'?') . 'header=false';;\n} elseif (read_config_option('auth_cache_enabled') == 'on' && isset($_COOKIE['cacti_remembers'])) {\n\t$myrefresh['seconds'] = 99999999;\n\t$myrefresh['page']    = 'index.php';\n\t$refreshIsLogout = 'false';\n} else {\n\t$myrefresh['seconds'] = ini_get('session.gc_maxlifetime');\n\t$myrefresh['page']    = $config['url_path'] . 'logout.php?action=timeout';\n\t$refreshIsLogout = 'true';\n} ?>\n<script type='text/javascript'>\n\tvar cactiVersion='<?php print $config['cacti_version'];?>';\n\tvar theme='<?php print get_selected_theme();?>';\n\tvar refreshIsLogout=<?php print $refreshIsLogout;?>;\n\tvar refreshPage='<?php print $myrefresh['page'];?>';\n\tvar refreshMSeconds=<?php print $myrefresh['seconds']*1000;?>;\n\tvar urlPath='<?php print $config['url_path'];?>';\n\tvar previousPage='';\n\tvar requestURI='<?php print $_SERVER['REQUEST_URI'];?>';\n\tvar searchFilter='<?php print __('Enter a search term');?>';\n\tvar searchRFilter='<?php print __('Enter a regular expression');?>';\n\tvar noFileSelected='<?php print __('No file selected');?>';\n\tvar timeGraphView='<?php print __('Time Graph View');?>';\n\tvar filterSettingsSaved='<?php print __('Filter Settings Saved');?>';\n\tvar spikeKillResuls='<?php print __('SpikeKill Results');?>';\n\tvar utilityView='<?php print __('Utility View');?>';\n\tvar realtimeClickOn='<?php print __('Click to view just this Graph in Realtime');?>';\n\tvar realtimeClickOff='<?php print __('Click again to take this Graph out of Realtime');?>';\n\tvar treeView='<?php print __('Tree View');?>';\n\tvar listView='<?php print __('List View');?>';\n\tvar previewView='<?php print __('Preview View');?>';\n\tvar cactiHome='<?php print __('Cacti Home');?>';\n\tvar cactiProjectPage='<?php print __('Cacti Project Page');?>';\n\tvar cactiCommunityForum='<?php print __('Cacti Community Forum');?>';\n\tvar reportABug='<?php print __('Report a bug');?>';\n\tvar aboutCacti='<?php print __('About Cacti');?>';\n\tvar spikeKillResults='<?php print __('SpikeKill Results');?>';\n\tvar showHideFilter='<?php print __('Click to Show/Hide Filter');?>';\n\tvar clearFilterTitle='<?php print __('Clear Current Filter');?>';\n</script>\n"], "fixing_code": ["<?php\n/*\n +-------------------------------------------------------------------------+\n | Copyright (C) 2004-2017 The Cacti Group                                 |\n |                                                                         |\n | This program is free software; you can redistribute it and/or           |\n | modify it under the terms of the GNU General Public License             |\n | as published by the Free Software Foundation; either version 2          |\n | of the License, or (at your option) any later version.                  |\n |                                                                         |\n | This program is distributed in the hope that it will be useful,         |\n | but WITHOUT ANY WARRANTY; without even the implied warranty of          |\n | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           |\n | GNU General Public License for more details.                            |\n +-------------------------------------------------------------------------+\n | Cacti: The Complete RRDTool-based Graphing Solution                     |\n +-------------------------------------------------------------------------+\n | This code is designed, written, and maintained by the Cacti Group. See  |\n | about.php and/or the AUTHORS file for specific developer information.   |\n +-------------------------------------------------------------------------+\n | http://www.cacti.net/                                                   |\n +-------------------------------------------------------------------------+\n*/\n\nglobal $config, $refresh;\n\n$script = basename($_SERVER['SCRIPT_NAME']);\nif ($script == 'graph_view.php' || $script == 'graph.php') {\n\tif (isset($_SESSION['custom']) && $_SESSION['custom'] == true) {\n\t\t$refreshIsLogout = 'true';\n\t}else if (isset_request_var('action') && get_nfilter_request_var('action') == 'zoom') {\n\t\t$refreshIsLogout = 'true';\n\t} else {\n\t\t$refresh = api_plugin_hook_function('top_graph_refresh', read_user_setting('page_refresh'));\n\t\t$refreshIsLogout = 'false';\n\t}\n} elseif (strstr($_SERVER['SCRIPT_NAME'], 'plugins')) {\n\t$refresh = api_plugin_hook_function('top_graph_refresh', $refresh);\n\tif (empty($refresh)) {\n\t\t$refreshIsLogout = 'true';\n\t} else {\n\t\t$refreshIsLogout = 'false';\n\t}\n}\n\nif (isset($_SESSION['refresh'])) {\n\tif (isset($_SESSION['refresh']['seconds'])) {\n\t\t$myrefresh['seconds'] = $_SESSION['refresh']['seconds'];\n\t} else {\n\t\t$myrefresh['seconds'] = ini_get('session.gc_maxlifetime');\n\t}\n\n    if (isset($_SESSION['refresh']['logout'])) {\n        $refreshIsLogout = $_SESSION['refresh']['logout'];\n    } else {\n\t\t$refreshIsLogout = 'true';\n\t}\n\n    if (isset($_SESSION['refresh']['page'])) {\n        $myrefresh['page'] = $_SESSION['refresh']['page'];\n    } else {\n\t\t$myrefresh['page'] = $config['url_path'] . 'logout.php?action=timeout';\n\t}\n\n\tunset($_SESSION['refresh']);\n} elseif (isset($refresh) && is_array($refresh)) {\n\t$refreshIsLogout = 'false';\n\t$myrefresh['seconds'] = $refresh['seconds'];\n\t$myrefresh['page']    = (strpos($refresh['page'], '?') ? '&':'?') . 'header=false';\n} elseif (isset($refresh)) {\n\t$refreshIsLogout = 'false';\n\t$myrefresh['seconds'] = $refresh;\n\t$myrefresh['page']    = $_SERVER['REQUEST_URI'] . (strpos($_SERVER['REQUEST_URI'], '?') ? '&':'?') . 'header=false';;\n} elseif (read_config_option('auth_cache_enabled') == 'on' && isset($_COOKIE['cacti_remembers'])) {\n\t$myrefresh['seconds'] = 99999999;\n\t$myrefresh['page']    = 'index.php';\n\t$refreshIsLogout = 'false';\n} else {\n\t$myrefresh['seconds'] = ini_get('session.gc_maxlifetime');\n\t$myrefresh['page']    = $config['url_path'] . 'logout.php?action=timeout';\n\t$refreshIsLogout = 'true';\n} ?>\n<script type='text/javascript'>\n\tvar cactiVersion='<?php print $config['cacti_version'];?>';\n\tvar theme='<?php print get_selected_theme();?>';\n\tvar refreshIsLogout=<?php print $refreshIsLogout;?>;\n\tvar refreshPage='<?php print htmlspecialchars($myrefresh['page']);?>';\n\tvar refreshMSeconds=<?php print $myrefresh['seconds']*1000;?>;\n\tvar urlPath='<?php print $config['url_path'];?>';\n\tvar previousPage='';\n\tvar requestURI='<?php print htmlspecialchars($_SERVER['REQUEST_URI']);?>';\n\tvar searchFilter='<?php print __('Enter a search term');?>';\n\tvar searchRFilter='<?php print __('Enter a regular expression');?>';\n\tvar noFileSelected='<?php print __('No file selected');?>';\n\tvar timeGraphView='<?php print __('Time Graph View');?>';\n\tvar filterSettingsSaved='<?php print __('Filter Settings Saved');?>';\n\tvar spikeKillResuls='<?php print __('SpikeKill Results');?>';\n\tvar utilityView='<?php print __('Utility View');?>';\n\tvar realtimeClickOn='<?php print __('Click to view just this Graph in Realtime');?>';\n\tvar realtimeClickOff='<?php print __('Click again to take this Graph out of Realtime');?>';\n\tvar treeView='<?php print __('Tree View');?>';\n\tvar listView='<?php print __('List View');?>';\n\tvar previewView='<?php print __('Preview View');?>';\n\tvar cactiHome='<?php print __('Cacti Home');?>';\n\tvar cactiProjectPage='<?php print __('Cacti Project Page');?>';\n\tvar cactiCommunityForum='<?php print __('Cacti Community Forum');?>';\n\tvar reportABug='<?php print __('Report a bug');?>';\n\tvar aboutCacti='<?php print __('About Cacti');?>';\n\tvar spikeKillResults='<?php print __('SpikeKill Results');?>';\n\tvar showHideFilter='<?php print __('Click to Show/Hide Filter');?>';\n\tvar clearFilterTitle='<?php print __('Clear Current Filter');?>';\n</script>\n"], "filenames": ["include/global_session.php"], "buggy_code_start_loc": [87], "buggy_code_end_loc": [92], "fixing_code_start_loc": [87], "fixing_code_end_loc": [92], "type": "CWE-79", "message": "include/global_session.php in Cacti 1.1.25 has XSS related to (1) the URI or (2) the refresh page.", "other": {"cve": {"id": "CVE-2017-15194", "sourceIdentifier": "cve@mitre.org", "published": "2017-10-11T01:32:54.207", "lastModified": "2017-10-20T14:29:26.410", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "include/global_session.php in Cacti 1.1.25 has XSS related to (1) the URI or (2) the refresh page."}, {"lang": "es", "value": "include/global_session.php en Cacti 1.1.25 tiene XSS relacionado con (1) la URI o (2) la acci\u00f3n refresh page."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:cacti:cacti:1.1.25:*:*:*:*:*:*:*", "matchCriteriaId": "D20820A0-E201-4CD6-9E4B-61426B5E2107"}]}]}], "references": [{"url": "http://www.securitytracker.com/id/1039569", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/Cacti/cacti/commit/93f661d8adcfa6618b11522cdab30e97bada33fd", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/Cacti/cacti/issues/1010", "source": "cve@mitre.org", "tags": ["Exploit", "Issue Tracking", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Cacti/cacti/commit/93f661d8adcfa6618b11522cdab30e97bada33fd"}}