{"buggy_code": ["---\n2.2.4:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2022-03-01\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |+\n    \n2.2.3:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2022-03-01\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Fix XSS vulnerability in Open Document mime viewer (Reported by: Simon Scannell, SonarSource <simon.scannell@sonarsource.com>).\n2.2.2:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2017-08-28\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Fix bottom table line length of RAR archive summaries.\n2.2.1:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2016-09-06\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] SECURITY: Don't render SVG images in the browser to avoid XSS attacks (Reported by Dawid Gounski via Beyond Security's SecuriTeam Secure Disclosure program).\n2.2.0:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2016-07-28\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mjr] Add SyntaxHighlighter version 4 support.\n2.1.3:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2016-03-21\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Greek translation (Limperis Antonis <limperis@cti.gr>).\n2.1.2:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2016-02-01\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Add temp_dir configuration parameter to OpenOffice/LibreOffice viewer (Request #11756).\n    [jan] Mark PHP 7 as supported.\n2.1.1:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2015-07-31\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Updated GL translation.\n2.1.0:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2015-04-13\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Add optional support to determine if link text is a hostname when doing phishing analysis for the HTML driver.\n2.0.8:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2014-11-18\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] More thorough handling of tar.gz data.\n2.0.7:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2014-05-21\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Hungarian translation (Andras Galos <galosa@netinform.hu>).\n2.0.6:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2014-04-03\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Fix fatal error if using TNEF viewer and bcmath extension is not installed on the system.\n2.0.5:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2013-05-28\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Ukrainian translation (Andriy Kopystyansky <anri@polynet.lviv.ua>).\n2.0.4:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2013-03-05\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Spreadsheet conversion now works without using temporary files.\n2.0.3:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2013-01-29\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update French translation (Paul De Vlieger <paul.de_vlieger@moniut.univ-bpclermont.fr>).\n2.0.2:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2013-01-09\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Add Basque translation (Ibon Igartua <ibon.igartua@ehu.es>).\n    [jan] Update XSLT processor for OpenDocument files.\n2.0.1:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2012-11-06\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Dutch translation (Arjen de Korte <build+horde@de-korte.org>).\n2.0.0:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2012-10-30\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First stable release for Horde 5.\n2.0.0RC1:\n  api: 1.0.0\n  state:\n    release: beta\n    api: stable\n  date: 2012-10-26\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Fix reading Debian archive data.\n2.0.0beta1:\n  api: 1.0.0\n  state:\n    release: beta\n    api: stable\n  date: 2012-07-19\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First beta release for Horde 5.\n2.0.0alpha1:\n  api: 1.0.0\n  state:\n    release: alpha\n    api: stable\n  date: 2012-07-05\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First alpha release for Horde 5.\n1.0.9:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: false\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Fix reading Debian archive data.\n1.0.8:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-11-22\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Add Croatian translation.\n    [jan] Add Estonian translation.\n1.0.7:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-11-02\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Fix iteration through child HTML nodes in the HTML viewer so that extended viewers can do things like remove nodes outright.\n1.0.6:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-10-11\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Fix configuration of syntaxhighlighter viewer.\n1.0.5:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-07-27\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Latvian translation.\n1.0.4:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-07-05\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Lithuanian translation.\n    [jan] Update Brazilian Portuguese translation.\n    [gwr] Support restricting the HTML tidy post processing by the message size (Request #10266).\n1.0.3:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-06-01\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Updated Slovak translation.\n1.0.2:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-05-18\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Updated Spanish translation.\n1.0.1:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-05-03\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Improve Syntaxhighlighter rendering in Chrome browsers.\n1.0.0:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-04-06\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First stable release for Horde 4.\n1.0.0RC2:\n  api: 1.0.0\n  state:\n    release: beta\n    api: beta\n  date: 2011-03-29\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    Second release candidate for Horde 4.\n    [jan] Fix OpenOffice MIME viewer.\n1.0.0RC1:\n  api: 1.0.0\n  state:\n    release: beta\n    api: beta\n  date: 2011-03-22\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First release candidate for Horde 4.\n1.0.0beta1:\n  api: 1.0.0\n  state:\n    release: beta\n    api: beta\n  date: 2011-03-16\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First beta release for Horde 4.\n1.0.0alpha1:\n  api: 1.0.0\n  state:\n    release: alpha\n    api: alpha\n  date: 2011-03-08\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First alpha release for Horde 4.\n    Replaced external or PHP-based syntax highlighters with javascript SyntaxHighlighter: http://alexgorbatchev.com/SyntaxHighlighter/\n", "<?php\n/**\n * The Horde_Mime_Viewer_Ooo class renders out OpenOffice.org documents in\n * HTML format.\n *\n * Copyright 2003-2017 Horde LLC (http://www.horde.org/)\n *\n * See the enclosed file LICENSE for license information (LGPL). If you\n * did not receive this file, see http://www.horde.org/licenses/lgpl21.\n *\n * @author   Marko Djukic <marko@oblo.com>\n * @author   Jan Schneider <jan@horde.org>\n * @category Horde\n * @license  http://www.horde.org/licenses/lgpl21 LGPL 2.1\n * @package  Mime_Viewer\n */\nclass Horde_Mime_Viewer_Ooo extends Horde_Mime_Viewer_Base\n{\n    /**\n     * This driver's display capabilities.\n     *\n     * @var array\n     */\n    protected $_capability = array(\n        'full' => true,\n        'info' => false,\n        'inline' => false,\n        'raw' => false\n    );\n\n    /**\n     * Metadata for the current viewer/data.\n     *\n     * @var array\n     */\n    protected $_metadata = array(\n        /* At this point assume that the document takes advantage of ZIP\n         * compression. */\n        'compressed' => true,\n        'embedded' => false,\n        'forceinline' => false\n    );\n\n    /**\n     * Constructor.\n     *\n     * @param Horde_Mime_Part $mime_part  The object with the data to be\n     *                                    rendered.\n     * @param array $conf                 Configuration:\n     *   - 'zip': (Horde_Compress_Zip) A zip object.\n     *   - 'temp_dir': (string) Where to create a temporary directory.\n     */\n    public function __construct(Horde_Mime_Part $part, array $conf = array())\n    {\n        parent::__construct($part, $conf);\n    }\n\n    /**\n     * Return the full rendered version of the Horde_Mime_Part object.\n     *\n     * @return array  See parent::render().\n     * @throws Horde_Exception\n     */\n    protected function _render()\n    {\n        $has_xsl = Horde_Util::extensionExists('xsl');\n        if ($has_xsl) {\n            $tmpdir = Horde_Util::createTempDir(true, $this->getConfigParam('temp_dir')) . '/';\n        }\n\n        $fnames = array('content.xml', 'styles.xml', 'meta.xml');\n        $tags = array(\n            'text:p' => 'p',\n            'table:table' => 'table border=\"0\" cellspacing=\"1\" cellpadding=\"0\" ',\n            'table:table-row' => 'tr bgcolor=\"#cccccc\"',\n            'table:table-cell' => 'td',\n            'table:number-columns-spanned=' => 'colspan='\n        );\n\n        if (!$this->getConfigParam('zip')) {\n            $this->setConfigParam('zip', Horde_Compress::factory('Zip'));\n        }\n        $list = $this->getConfigParam('zip')\n            ->decompress($this->_mimepart->getContents(),\n                         array('action' => Horde_Compress_Zip::ZIP_LIST));\n\n        foreach ($list as $key => $file) {\n            if (in_array($file['name'], $fnames)) {\n                $content = $this->getConfigParam('zip')\n                    ->decompress($this->_mimepart->getContents(), array(\n                        'action' => Horde_Compress_Zip::ZIP_DATA,\n                        'info' => $list,\n                        'key' => $key\n                    ));\n\n                if ($has_xsl) {\n                    file_put_contents($tmpdir . $file['name'], $content);\n                } elseif ($file['name'] == 'content.xml') {\n                    return array(\n                        $this->_mimepart->getMimeId() => array(\n                            'data' => str_replace(array_keys($tags), array_values($tags), $content),\n                            'status' => array(),\n                            'type' => 'text/html; charset=UTF-8'\n                        )\n                    );\n                }\n            }\n        }\n\n        if (!$has_xsl) {\n            return array();\n        }\n\n        $xslt = new XSLTProcessor();\n        $xsl = new DOMDocument();\n        $xsl->load(realpath(__DIR__ . '/Ooo/export/xhtml/opendoc2xhtml.xsl'));\n        $xslt->importStylesheet($xsl);\n        $xslt->setParameter('http://www.w3.org/1999/XSL/Transform', array(\n            'metaFileURL' => 'file://' . $tmpdir . 'meta.xml',\n            'stylesFileURL' => 'file://' . $tmpdir . 'styles.xml',\n            'java' => false,\n        ));\n        $xml = new DOMDocument();\n        $xml->load(realpath($tmpdir . 'content.xml'));\n        $result = $xslt->transformToXml($xml);\n        if ($result) {\n            $result = Horde_Text_Filter::filter($result, 'xss');\n        } else {\n            $result = libxml_get_last_error()->message;\n        }\n\n        return array(\n            $this->_mimepart->getMimeId() => array(\n                'data' => $result,\n                'status' => array(),\n                'type' => 'text/html; charset=UTF-8'\n            )\n        );\n    }\n\n}\n"], "fixing_code": ["---\n2.2.4:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2022-03-01\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Fix XSS vulnerability in Open Document mime viewer with different code path (Reported by: Mahdi Pasche <pasche@b1-systems.de>).\n    |+\n2.2.3:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2022-03-01\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Fix XSS vulnerability in Open Document mime viewer (Reported by: Simon Scannell, SonarSource <simon.scannell@sonarsource.com>).\n2.2.2:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2017-08-28\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Fix bottom table line length of RAR archive summaries.\n2.2.1:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2016-09-06\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] SECURITY: Don't render SVG images in the browser to avoid XSS attacks (Reported by Dawid Gounski via Beyond Security's SecuriTeam Secure Disclosure program).\n2.2.0:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2016-07-28\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mjr] Add SyntaxHighlighter version 4 support.\n2.1.3:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2016-03-21\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Greek translation (Limperis Antonis <limperis@cti.gr>).\n2.1.2:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2016-02-01\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Add temp_dir configuration parameter to OpenOffice/LibreOffice viewer (Request #11756).\n    [jan] Mark PHP 7 as supported.\n2.1.1:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2015-07-31\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Updated GL translation.\n2.1.0:\n  api: 2.1.0\n  state:\n    release: stable\n    api: stable\n  date: 2015-04-13\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Add optional support to determine if link text is a hostname when doing phishing analysis for the HTML driver.\n2.0.8:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2014-11-18\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] More thorough handling of tar.gz data.\n2.0.7:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2014-05-21\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Hungarian translation (Andras Galos <galosa@netinform.hu>).\n2.0.6:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2014-04-03\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Fix fatal error if using TNEF viewer and bcmath extension is not installed on the system.\n2.0.5:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2013-05-28\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Ukrainian translation (Andriy Kopystyansky <anri@polynet.lviv.ua>).\n2.0.4:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2013-03-05\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Spreadsheet conversion now works without using temporary files.\n2.0.3:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2013-01-29\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update French translation (Paul De Vlieger <paul.de_vlieger@moniut.univ-bpclermont.fr>).\n2.0.2:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2013-01-09\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Add Basque translation (Ibon Igartua <ibon.igartua@ehu.es>).\n    [jan] Update XSLT processor for OpenDocument files.\n2.0.1:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2012-11-06\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Dutch translation (Arjen de Korte <build+horde@de-korte.org>).\n2.0.0:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2012-10-30\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First stable release for Horde 5.\n2.0.0RC1:\n  api: 1.0.0\n  state:\n    release: beta\n    api: stable\n  date: 2012-10-26\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Fix reading Debian archive data.\n2.0.0beta1:\n  api: 1.0.0\n  state:\n    release: beta\n    api: stable\n  date: 2012-07-19\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First beta release for Horde 5.\n2.0.0alpha1:\n  api: 1.0.0\n  state:\n    release: alpha\n    api: stable\n  date: 2012-07-05\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First alpha release for Horde 5.\n1.0.9:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: false\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Fix reading Debian archive data.\n1.0.8:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-11-22\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Add Croatian translation.\n    [jan] Add Estonian translation.\n1.0.7:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-11-02\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [mms] Fix iteration through child HTML nodes in the HTML viewer so that extended viewers can do things like remove nodes outright.\n1.0.6:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-10-11\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Fix configuration of syntaxhighlighter viewer.\n1.0.5:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-07-27\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Latvian translation.\n1.0.4:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-07-05\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Update Lithuanian translation.\n    [jan] Update Brazilian Portuguese translation.\n    [gwr] Support restricting the HTML tidy post processing by the message size (Request #10266).\n1.0.3:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-06-01\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Updated Slovak translation.\n1.0.2:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-05-18\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Updated Spanish translation.\n1.0.1:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-05-03\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    [jan] Improve Syntaxhighlighter rendering in Chrome browsers.\n1.0.0:\n  api: 1.0.0\n  state:\n    release: stable\n    api: stable\n  date: 2011-04-06\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First stable release for Horde 4.\n1.0.0RC2:\n  api: 1.0.0\n  state:\n    release: beta\n    api: beta\n  date: 2011-03-29\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    Second release candidate for Horde 4.\n    [jan] Fix OpenOffice MIME viewer.\n1.0.0RC1:\n  api: 1.0.0\n  state:\n    release: beta\n    api: beta\n  date: 2011-03-22\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First release candidate for Horde 4.\n1.0.0beta1:\n  api: 1.0.0\n  state:\n    release: beta\n    api: beta\n  date: 2011-03-16\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First beta release for Horde 4.\n1.0.0alpha1:\n  api: 1.0.0\n  state:\n    release: alpha\n    api: alpha\n  date: 2011-03-08\n  license:\n    identifier: LGPL-2.1\n    uri: http://www.horde.org/licenses/lgpl21\n  notes: |\n    First alpha release for Horde 4.\n    Replaced external or PHP-based syntax highlighters with javascript SyntaxHighlighter: http://alexgorbatchev.com/SyntaxHighlighter/\n", "<?php\n/**\n * The Horde_Mime_Viewer_Ooo class renders out OpenOffice.org documents in\n * HTML format.\n *\n * Copyright 2003-2017 Horde LLC (http://www.horde.org/)\n *\n * See the enclosed file LICENSE for license information (LGPL). If you\n * did not receive this file, see http://www.horde.org/licenses/lgpl21.\n *\n * @author   Marko Djukic <marko@oblo.com>\n * @author   Jan Schneider <jan@horde.org>\n * @category Horde\n * @license  http://www.horde.org/licenses/lgpl21 LGPL 2.1\n * @package  Mime_Viewer\n */\nclass Horde_Mime_Viewer_Ooo extends Horde_Mime_Viewer_Base\n{\n    /**\n     * This driver's display capabilities.\n     *\n     * @var array\n     */\n    protected $_capability = array(\n        'full' => true,\n        'info' => false,\n        'inline' => false,\n        'raw' => false\n    );\n\n    /**\n     * Metadata for the current viewer/data.\n     *\n     * @var array\n     */\n    protected $_metadata = array(\n        /* At this point assume that the document takes advantage of ZIP\n         * compression. */\n        'compressed' => true,\n        'embedded' => false,\n        'forceinline' => false\n    );\n\n    /**\n     * Constructor.\n     *\n     * @param Horde_Mime_Part $mime_part  The object with the data to be\n     *                                    rendered.\n     * @param array $conf                 Configuration:\n     *   - 'zip': (Horde_Compress_Zip) A zip object.\n     *   - 'temp_dir': (string) Where to create a temporary directory.\n     */\n    public function __construct(Horde_Mime_Part $part, array $conf = array())\n    {\n        parent::__construct($part, $conf);\n    }\n\n    /**\n     * Return the full rendered version of the Horde_Mime_Part object.\n     *\n     * @return array  See parent::render().\n     * @throws Horde_Exception\n     */\n    protected function _render()\n    {\n        $has_xsl = Horde_Util::extensionExists('xsl');\n        if ($has_xsl) {\n            $tmpdir = Horde_Util::createTempDir(true, $this->getConfigParam('temp_dir')) . '/';\n        }\n\n        $fnames = array('content.xml', 'styles.xml', 'meta.xml');\n        $tags = array(\n            'text:p' => 'p',\n            'table:table' => 'table border=\"0\" cellspacing=\"1\" cellpadding=\"0\" ',\n            'table:table-row' => 'tr bgcolor=\"#cccccc\"',\n            'table:table-cell' => 'td',\n            'table:number-columns-spanned=' => 'colspan='\n        );\n\n        if (!$this->getConfigParam('zip')) {\n            $this->setConfigParam('zip', Horde_Compress::factory('Zip'));\n        }\n        $list = $this->getConfigParam('zip')\n            ->decompress($this->_mimepart->getContents(),\n                         array('action' => Horde_Compress_Zip::ZIP_LIST));\n\n        foreach ($list as $key => $file) {\n            if (in_array($file['name'], $fnames)) {\n                $content = $this->getConfigParam('zip')\n                    ->decompress($this->_mimepart->getContents(), array(\n                        'action' => Horde_Compress_Zip::ZIP_DATA,\n                        'info' => $list,\n                        'key' => $key\n                    ));\n\n                if ($has_xsl) {\n                    file_put_contents($tmpdir . $file['name'], $content);\n                } elseif ($file['name'] == 'content.xml') {\n                    return array(\n                        $this->_mimepart->getMimeId() => array(\n                            'data' => Horde_Text_Filter::filter(\n                                str_replace(array_keys($tags), array_values($tags), $content),\n                                'xss'\n                            ),\n                            'status' => array(),\n                            'type' => 'text/html; charset=UTF-8'\n                        )\n                    );\n                }\n            }\n        }\n\n        if (!$has_xsl) {\n            return array();\n        }\n\n        $xslt = new XSLTProcessor();\n        $xsl = new DOMDocument();\n        $xsl->load(realpath(__DIR__ . '/Ooo/export/xhtml/opendoc2xhtml.xsl'));\n        $xslt->importStylesheet($xsl);\n        $xslt->setParameter('http://www.w3.org/1999/XSL/Transform', array(\n            'metaFileURL' => 'file://' . $tmpdir . 'meta.xml',\n            'stylesFileURL' => 'file://' . $tmpdir . 'styles.xml',\n            'java' => false,\n        ));\n        $xml = new DOMDocument();\n        $xml->load(realpath($tmpdir . 'content.xml'));\n        $result = $xslt->transformToXml($xml);\n        if ($result) {\n            $result = Horde_Text_Filter::filter($result, 'xss');\n        } else {\n            $result = libxml_get_last_error()->message;\n        }\n\n        return array(\n            $this->_mimepart->getMimeId() => array(\n                'data' => $result,\n                'status' => array(),\n                'type' => 'text/html; charset=UTF-8'\n            )\n        );\n    }\n\n}\n"], "filenames": ["doc/Horde/Mime/Viewer/changelog.yml", "lib/Horde/Mime/Viewer/Ooo.php"], "buggy_code_start_loc": [11, 101], "buggy_code_end_loc": [13, 102], "fixing_code_start_loc": [11, 101], "fixing_code_end_loc": [14, 105], "type": "CWE-79", "message": "lib/Horde/Mime/Viewer/Ooo.php in Horde Mime_Viewer before 2.2.4 allows XSS via an OpenOffice document, leading to account takeover in Horde Groupware Webmail Edition. This occurs after XSLT rendering.", "other": {"cve": {"id": "CVE-2022-26874", "sourceIdentifier": "cve@mitre.org", "published": "2022-03-11T07:15:08.037", "lastModified": "2022-10-14T12:44:33.543", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "lib/Horde/Mime/Viewer/Ooo.php in Horde Mime_Viewer before 2.2.4 allows XSS via an OpenOffice document, leading to account takeover in Horde Groupware Webmail Edition. This occurs after XSLT rendering."}, {"lang": "es", "value": "el archivo lib/Horde/Mime/Viewer/Ooo.php en Horde Mime_Viewer versiones anteriores a 2.2.4, permite un ataque de tipo XSS por medio de un documento de OpenOffice, conllevando a la toma de posesi\u00f3n de la cuenta en Horde Groupware Webmail Edition. Esto ocurre despu\u00e9s de la renderizaci\u00f3n de XSLT"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:horde:horde_mime_viewer:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.2.4", "matchCriteriaId": "EFC3BD69-CAFA-47FA-828A-331FA97B10EE"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:9.0:*:*:*:*:*:*:*", "matchCriteriaId": "DEECE5FC-CACF-4496-A3E7-164736409252"}, {"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:10.0:*:*:*:*:*:*:*", "matchCriteriaId": "07B237A9-69A3-4A9C-9DA0-4E06BD37AE73"}]}]}], "references": [{"url": "https://blog.sonarsource.com/horde-webmail-account-takeover-via-email/", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://github.com/horde/Mime_Viewer/commit/02b46cec1a7e8f1a6835b628850cd56b85963bb5", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://lists.debian.org/debian-lts-announce/2022/06/msg00007.html", "source": "cve@mitre.org", "tags": ["Mailing List", "Third Party Advisory"]}, {"url": "https://lists.debian.org/debian-lts-announce/2022/08/msg00021.html", "source": "cve@mitre.org", "tags": ["Mailing List", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/horde/Mime_Viewer/commit/02b46cec1a7e8f1a6835b628850cd56b85963bb5"}}