{"buggy_code": ["<?php\n\n/*\n * UserController.php\n * Copyright (c) 2021 james@firefly-iii.org\n *\n * This file is part of Firefly III (https://github.com/firefly-iii).\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\ndeclare(strict_types=1);\n\nnamespace FireflyIII\\Api\\V1\\Controllers\\System;\n\nuse FireflyIII\\Api\\V1\\Controllers\\Controller;\nuse FireflyIII\\Api\\V1\\Requests\\System\\UserStoreRequest;\nuse FireflyIII\\Api\\V1\\Requests\\System\\UserUpdateRequest;\nuse FireflyIII\\Exceptions\\FireflyException;\nuse FireflyIII\\Repositories\\User\\UserRepositoryInterface;\nuse FireflyIII\\Transformers\\UserTransformer;\nuse FireflyIII\\User;\nuse Illuminate\\Http\\JsonResponse;\nuse Illuminate\\Pagination\\LengthAwarePaginator;\nuse League\\Fractal\\Pagination\\IlluminatePaginatorAdapter;\nuse League\\Fractal\\Resource\\Collection as FractalCollection;\nuse League\\Fractal\\Resource\\Item;\n\n/**\n * Class UserController.\n */\nclass UserController extends Controller\n{\n    private UserRepositoryInterface $repository;\n\n    /**\n     * UserController constructor.\n     *\n     * @codeCoverageIgnore\n     */\n    public function __construct()\n    {\n        parent::__construct();\n        $this->middleware(\n            function ($request, $next) {\n                $this->repository = app(UserRepositoryInterface::class);\n\n                return $next($request);\n            }\n        );\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/deleteUser\n     *\n     * Remove the specified resource from storage.\n     *\n     * @param  User  $user\n     *\n     * @return JsonResponse\n     * @throws FireflyException\n     * @codeCoverageIgnore\n     */\n    public function destroy(User $user): JsonResponse\n    {\n        /** @var User $admin */\n        $admin = auth()->user();\n        if ($admin->id === $user->id) {\n            return response()->json([], 500);\n        }\n\n        if ($this->repository->hasRole($admin, 'owner')) {\n            $this->repository->destroy($user);\n\n            return response()->json([], 204);\n        }\n        throw new FireflyException('200025: No access to function.');\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/listUser\n     *\n     * Display a listing of the resource.\n     *\n     * @return JsonResponse\n     * @throws FireflyException\n     * @codeCoverageIgnore\n     */\n    public function index(): JsonResponse\n    {\n        // user preferences\n        $pageSize = (int)app('preferences')->getForUser(auth()->user(), 'listPageSize', 50)->data;\n        $manager  = $this->getManager();\n\n        // build collection\n        $collection = $this->repository->all();\n        $count      = $collection->count();\n        $users      = $collection->slice(($this->parameters->get('page') - 1) * $pageSize, $pageSize);\n\n        // make paginator:\n        $paginator = new LengthAwarePaginator($users, $count, $pageSize, $this->parameters->get('page'));\n        $paginator->setPath(route('api.v1.users.index').$this->buildParams());\n\n        // make resource\n        /** @var UserTransformer $transformer */\n        $transformer = app(UserTransformer::class);\n        $transformer->setParameters($this->parameters);\n\n        $resource = new FractalCollection($users, $transformer, 'users');\n        $resource->setPaginator(new IlluminatePaginatorAdapter($paginator));\n\n        return response()->json($manager->createData($resource)->toArray())->header('Content-Type', self::CONTENT_TYPE);\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/getUser\n     *\n     * Show a single user.\n     *\n     * @param  User  $user\n     *\n     * @return JsonResponse\n     * @codeCoverageIgnore\n     */\n    public function show(User $user): JsonResponse\n    {\n        // make manager\n        $manager = $this->getManager();\n        // make resource\n        /** @var UserTransformer $transformer */\n        $transformer = app(UserTransformer::class);\n        $transformer->setParameters($this->parameters);\n\n        $resource = new Item($user, $transformer, 'users');\n\n        return response()->json($manager->createData($resource)->toArray())->header('Content-Type', self::CONTENT_TYPE);\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/storeUser\n     *\n     * Store a new user.\n     *\n     * @param  UserStoreRequest  $request\n     *\n     * @return JsonResponse\n     */\n    public function store(UserStoreRequest $request): JsonResponse\n    {\n        $data    = $request->getAll();\n        $user    = $this->repository->store($data);\n        $manager = $this->getManager();\n\n        // make resource\n\n        /** @var UserTransformer $transformer */\n        $transformer = app(UserTransformer::class);\n        $transformer->setParameters($this->parameters);\n\n        $resource = new Item($user, $transformer, 'users');\n\n        return response()->json($manager->createData($resource)->toArray())->header('Content-Type', self::CONTENT_TYPE);\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/updateUser\n     *\n     * Update a user.\n     *\n     * @param  UserUpdateRequest  $request\n     * @param  User  $user\n     *\n     * @return JsonResponse\n     */\n    public function update(UserUpdateRequest $request, User $user): JsonResponse\n    {\n        $data    = $request->getAll();\n        $user    = $this->repository->update($user, $data);\n        $manager = $this->getManager();\n        // make resource\n        /** @var UserTransformer $transformer */\n        $transformer = app(UserTransformer::class);\n        $transformer->setParameters($this->parameters);\n\n        $resource = new Item($user, $transformer, 'users');\n\n        return response()->json($manager->createData($resource)->toArray())->header('Content-Type', self::CONTENT_TYPE);\n    }\n}\n", "<?php\n\n/**\n * Authenticate.php\n * Copyright (c) 2019 james@firefly-iii.org\n *\n * This file is part of Firefly III (https://github.com/firefly-iii).\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\ndeclare(strict_types=1);\n\nnamespace FireflyIII\\Http\\Middleware;\n\nuse Closure;\nuse FireflyIII\\Exceptions\\FireflyException;\nuse FireflyIII\\User;\nuse Illuminate\\Auth\\AuthenticationException;\nuse Illuminate\\Contracts\\Auth\\Factory as Auth;\nuse Illuminate\\Http\\Request;\nuse Log;\n\n/**\n * Class Authenticate\n */\nclass Authenticate\n{\n    /**\n     * The authentication factory instance.\n     *\n     * @var Auth\n     */\n    protected $auth;\n\n    /**\n     * Create a new middleware instance.\n     *\n     * @param  Auth  $auth\n     *\n     * @return void\n     */\n    public function __construct(Auth $auth)\n    {\n        $this->auth = $auth;\n    }\n\n    /**\n     * Handle an incoming request.\n     *\n     * @param  Request  $request\n     * @param  Closure  $next\n     * @param  string[]  ...$guards\n     *\n     * @return mixed\n     *\n     * @throws FireflyException\n     * @throws AuthenticationException\n     */\n    public function handle($request, Closure $next, ...$guards)\n    {\n        $this->authenticate($request, $guards);\n\n        return $next($request);\n    }\n\n    /**\n     * Determine if the user is logged in to any of the given guards.\n     *\n     * @param  mixed  $request\n     * @param  array  $guards\n     *\n     * @return mixed\n     * @throws FireflyException\n     * @throws AuthenticationException\n     */\n    protected function authenticate($request, array $guards)\n    {\n        // Log::debug(sprintf('Now in %s', __METHOD__));\n        if (0 === count($guards)) {\n            // Log::debug('No guards present.');\n            // go for default guard:\n            /** @noinspection PhpUndefinedMethodInspection */\n            if ($this->auth->check()) {\n                // Log::debug('Default guard says user is authenticated.');\n                // do an extra check on user object.\n                /** @noinspection PhpUndefinedMethodInspection */\n                /** @var User $user */\n                $user = $this->auth->authenticate();\n                if (null === $user) {\n                    Log::warning('User is null, throw exception?');\n                }\n                if (null !== $user) {\n                    // Log::debug(get_class($user));\n                    if (1 === (int)$user->blocked) {\n                        $message = (string)trans('firefly.block_account_logout');\n                        if ('email_changed' === $user->blocked_code) {\n                            $message = (string)trans('firefly.email_changed_logout');\n                        }\n                        app('session')->flash('logoutMessage', $message);\n                        $this->auth->logout(); // @phpstan-ignore-line (thinks function is undefined)\n\n                        throw new AuthenticationException('Blocked account.', $guards);\n                    }\n                }\n            }\n\n            return $this->auth->authenticate(); // @phpstan-ignore-line (thinks function returns void)\n        }\n        // Log::debug('Guard array is not empty.');\n\n        foreach ($guards as $guard) {\n            // Log::debug(sprintf('Now in guard loop, guard is \"%s\"', $guard));\n            if('api' !== $guard) {\n                $this->auth->guard($guard)->authenticate();\n            }\n            $result = $this->auth->guard($guard)->check();\n            // Log::debug(sprintf('Result is %s', var_export($result, true)));\n            if ($result) {\n                // According to PHPstan the method returns void, but we'll see.\n                return $this->auth->shouldUse($guard); // @phpstan-ignore-line\n            }\n        }\n\n        throw new AuthenticationException('Unauthenticated.', $guards);\n    }\n}\n", "# Change Log\nAll notable changes to this project will be documented in this file.\nThis project adheres to [Semantic Versioning](http://semver.org/).\n\nAlpha 2\n\n\n- Data import: when you submit a transaction but give the ID of an account of the wrong type, Firefly III will try to create an account of the right type. For example: you submit a deposit but the source account is an expense account: Firefly III will try to create a revenue account instead. \n\n\n\n## 5.8.0-alpha.1 - 2023-01-08\n\nThis is the first release of the new 5.8.0 series of Firefly III. It should upgrade the database automatically BUT \nmake a backup of your database first! I guarantee nothing.\n\n### Warnings\n\n- \u26a0\ufe0f Make a backup of your database first!\n- \u26a0\ufe0f This version requires **PHP 8.2**.\n\nYou can access the new V3 layout under `/v3/`. If you decide to use or test it:\n\n- \u26a0\ufe0f Read the instructions under the \u2620\ufe0f icon FIRST.\n- \u26a0\ufe0f The new layout is not yet finished. Use it to change your data at your own risk. \n\n### Added\n\nLots of new stuff that I invite you to test and break.\n\n- [Issue 4975](https://github.com/firefly-iii/firefly-iii/issues/4975) Rules can copy/move description to notes and vice versa\n- [Issue 5031](https://github.com/firefly-iii/firefly-iii/issues/5031) You can invite users to your installation when registration is off\n- [Issue 5213](https://github.com/firefly-iii/firefly-iii/issues/5213) You can trigger recurring transactions beforehand\n- [Issue 5592](https://github.com/firefly-iii/firefly-iii/issues/5592) Transactions have a little history box to show how rules changed them\n- [Issue 5752](https://github.com/firefly-iii/firefly-iii/issues/5752) Firefly III can send Slack notifications instead of emails\n- [Issue 5862](https://github.com/firefly-iii/firefly-iii/issues/5862) Search can filter on reconciled transactions\n- [Issue 6086](https://github.com/firefly-iii/firefly-iii/issues/6086) All search filters can be negative by putting `-` in front of them\n- [Issue 6441](https://github.com/firefly-iii/firefly-iii/issues/6441) Buttons to purge deleted data, which is easy for data imports\n- [Issue 6457](https://github.com/firefly-iii/firefly-iii/issues/6457) Rule trigger 'transaction exists', that will always trigger\n- [Issue 6526](https://github.com/firefly-iii/firefly-iii/issues/6526) Option to disable rules and/or webhooks when saving transactions\n- [Issue 6605](https://github.com/firefly-iii/firefly-iii/issues/6605) You can search for external ID values\n- Working beta of the new layout under `/v3/`\n- New authentication screens that support dark mode.\n- There is a page for webhooks.\n\n### Changed\n- Firefly III requires PHP 8.2\n- Liabilities are no longer part of your net worth.\n- Liabilities no longer need two transactions to be managed properly (see the documentation)\n\n### Removed\n- [Issue 4198](https://github.com/firefly-iii/firefly-iii/issues/4198) The total available budget amount bar on the `/budgets` page is no longer manageable but will be auto-calculated\n\n### Fixed\n\nNot many bugfixes (yet).\n\n- [Issue 6581](https://github.com/firefly-iii/firefly-iii/issues/6581) Fields were not cleared in the transaction screen in some cases\n\n### API\n\nNew `/v2/` endpoints are being implemented that prepare the application for (among other things) the ability\nto manage multiple financial administrations. The documentation for these endpoints will be at \nhttps://api-docs.firefly-iii.org/.\n\n- [Issue 6130](https://github.com/firefly-iii/firefly-iii/issues/6130) You can now create a reconciliation transaction\n\n## 5.7.18 - 2023-01-03\n\n### Fixed\n- [Issue 6775](https://github.com/firefly-iii/firefly-iii/issues/6775) OAuth authentication was broken for Authelia and other remote user providers.\n- [Issue 6787](https://github.com/firefly-iii/firefly-iii/issues/6787) SQLite value conversion broke several functions\n\n## 5.7.17 - 2022-12-30\n\n### Fixed\n- [Issue 6742](https://github.com/firefly-iii/firefly-iii/issues/6742) Error when a rule tries to add or remove an amount from a piggy bank\n- [Issue 6743](https://github.com/firefly-iii/firefly-iii/issues/6743) Error when opening piggy bank overview\n- [Issue 6753](https://github.com/firefly-iii/firefly-iii/issues/6753) Rules are not finding any transactions with trigger 'Amount is greater than 0'\n\n## 5.7.16 - 2022-12-25\n\n### Added\n- You can now search for SEPA CT, thanks @dasJ!\n\n### Changed\n- Links go to [Mastodon](https://fosstodon.org/@ff3), not Twitter.\n- Most if not all remaining float values removed. None were used in financial math.\n- Expand Laravel Passport settings.\n\n### Fixed\n- [Issue 6597](https://github.com/firefly-iii/firefly-iii/issues/6597) Edit existing split transaction's source did not work properly.\n- [Issue 6610](https://github.com/firefly-iii/firefly-iii/issues/6610) Fix search for attachments\n- [Issue 6625](https://github.com/firefly-iii/firefly-iii/issues/6625) Page of the links is not displayed due to an error\n- [Issue 6701](https://github.com/firefly-iii/firefly-iii/issues/6701) Ensure remote_guard_alt_email if changed, thanks @nebulade!\n- Remove some null pointers in the code.\n- Add missing locale data\n- Fixed typo, thx @charlesteets!\n- Various issues with piggy banks\n- Clear cache after a transaction is deleted.\n- Be more clear about registrations being disabled.\n\n### Security\n- Updated all packages and dependencies.\n\n### API\n- Fix API endpoint that would not accept two of the same dates.\n\n## 5.7.15 - 2022-11-02\n\n### Fixed\n- You can no longer set the currency of expense and revenue accounts.\n- Form elements are not spell checked anymore (privacy).\n- [Issue 6556](https://github.com/firefly-iii/firefly-iii/issues/6556) Wrong value used in bill chart\n- [Issue 6564](https://github.com/firefly-iii/firefly-iii/issues/6564) Right-Align numbers to match monetary value digits\n- [Issue 6589](https://github.com/firefly-iii/firefly-iii/issues/6589) Webhook not fired after destroying transaction\n- Add missing locale data\n\n## 5.7.14 - 2022-10-19\n\n### Fixed\n- Bulk editing transactions works.\n- Negative budgets no longer work.\n\n## 5.7.13 - 2022-10-17\n\n### Added\n- [Issue 6502](https://github.com/firefly-iii/firefly-iii/issues/6502) A few students from @D7032E-Group-6 added MTD and YTD, thanks!\n\n### Fixed\n- [Issue 6461](https://github.com/firefly-iii/firefly-iii/issues/6461) Broken link in `/public` directory warning.\n- [Issue 6475](https://github.com/firefly-iii/firefly-iii/issues/6475) Method name mixup.\n- [Issue 6471](https://github.com/firefly-iii/firefly-iii/issues/6471) Fix float conversion\n- [Issue 6510](https://github.com/firefly-iii/firefly-iii/issues/6510) Destroy transaction now also triggers liability recalculation.\n- Amount check for budget amounts was too low.\n- Some other small fixes\n\n### API\n- [Issue 6481](https://github.com/firefly-iii/firefly-iii/issues/6481) Mixup in API validation, fixed by @janw\n\n## 5.7.12 - 2022-09-12\n\n### Fixed\n- [Issue 6287](https://github.com/firefly-iii/firefly-iii/issues/6287) Catch error when trying to email with invalid settings.\n- [Issue 6423](https://github.com/firefly-iii/firefly-iii/issues/6423) Fix redis error, thanks @canoine!\n- [Issue 6421](https://github.com/firefly-iii/firefly-iii/issues/6421) Fix issue with SQLite.\n- [Issue 6379](https://github.com/firefly-iii/firefly-iii/issues/6379) Fix issue when user has lots of currencies but short list settings.\n- [Issue 6333](https://github.com/firefly-iii/firefly-iii/issues/6333) Fix broken chart for reconciliation.\n- [Issue 6332](https://github.com/firefly-iii/firefly-iii/issues/6332) Fix issue with uploading zipped PDF's.\n\n## 5.7.11 - 2022-09-05\n\n### Added\n- [Issue 6254](https://github.com/firefly-iii/firefly-iii/issues/6254) Use Piggy Bank's start date in monthly suggestion by @rickdoesdev\n- Add best practices badge.\n- Various sanity checks on large amounts.\n\n### Removed\n- Service worker is removed.\n\n### Fixed\n- [Issue 6260](https://github.com/firefly-iii/firefly-iii/issues/6260)\n- [Issue 6271](https://github.com/firefly-iii/firefly-iii/issues/6271) Improve settings for Redis, by @canoine\n- [Issue 6283](https://github.com/firefly-iii/firefly-iii/issues/6283) Convert to deposit means the transaction loses its bill.\n- Fix issue with foreign currencies in transaction form.\n- Fix various issues with SQLite.\n- [Issue 6379](https://github.com/firefly-iii/firefly-iii/issues/6379) Some foreign currencies not list for setting on new transactions\n- Make 2FA code + validation more robust. Thanks to @jtmoss3991, @timaschew and @Ottega.\n\n## 5.7.10 - 2022-07-16\n\n### Fixed\n- [Issue 6122](https://github.com/firefly-iii/firefly-iii/issues/6122) Type error on data import and display\n- SQLite query issues fixed\n- Fix nullpointer.\n- [Issue 6168](https://github.com/firefly-iii/firefly-iii/issues/6168) Missing date overview in no-category list.\n- [Issue 6165](https://github.com/firefly-iii/firefly-iii/issues/6165) Account numbers could not be shared between expense and revenue accounts.\n- [Issue 6150](https://github.com/firefly-iii/firefly-iii/issues/6150) The first remote user would not get admin.\n- [Issue 6118](https://github.com/firefly-iii/firefly-iii/issues/6118) Piggy bank events would not get copied when transaction was copied.  \n\n### Security\n- Update packages\n\n## 5.7.9 - 2022-06-01\n\n### Fixed\n- Symfony 6.1 requires PHP 8.1, so back to 6.0 for the time being.\n\n## 5.7.8 - 2022-06-01\n\n### Fixed\n- Symfony 6.1 requires PHP 8.1, so back to 6.0 for the time being.\n\n## 5.7.7 - 2022-06-01\n\n### Fixed\n- Fixed an issue where the login form would overflow a database field.\n- [Issue 6113](https://github.com/firefly-iii/firefly-iii/issues/6113) Fix issue with number formatting.\n- [Issue 5996](https://github.com/firefly-iii/firefly-iii/issues/5996) Catch bad library\n\n### Added\n- @turrisxyz added a dependency review, thanks!\n\n## 5.7.6 - 2022-05-19\n\n### Fixed\n- [Issue 6058](https://github.com/firefly-iii/firefly-iii/issues/6058) Bad type-casting could break Firefly III on Home Assistant.\n- [Issue 6059](https://github.com/firefly-iii/firefly-iii/issues/6059) Fix issue with missing list of bills when creating a recurring transaction from a transaction.\n- Added missing DB integrity checks.\n\n### Security\n- Updated various packages\n\n## 5.7.5 - 2022-05-06\n\n### Fixed\n- Fixed an issue where missing method names would break the API.\n- [Issue 6040](https://github.com/firefly-iii/firefly-iii/issues/6040) Could not add or remove money from piggy banks without a target.\n- [Issue 6009](https://github.com/firefly-iii/firefly-iii/issues/6009) `has_no_attachments:true` would not return transactions with *deleted* transactions.\n- [Issue 6050](https://github.com/firefly-iii/firefly-iii/issues/6050) ja_JP is part of the Docker image\n\n## 5.7.4 - 2022-05-03\n\n### Fixed\n- Fixed issue in method names.\n\n## 5.7.3 - 2022-05-03\n\n### Fixed\n- Searching for `updated_at_before` and `created_at_before` works again.\n- [Issue 6000](https://github.com/firefly-iii/firefly-iii/issues/6000) Bad math when dealing with multi-currency reconciliation.\n- Remove unused CSS\n- Fix bad migration.\n\n### API\n- Add error code to error message.\n\n## 5.7.2 - 2022-04-13\n\n### Fixed\n- Not configuring email would break registration.\n- Extra validation on piggy bank amounts.\n\n## 5.7.1 - 2022-04-05\n\n### Fixed\n- Fixes an issue with showing piggy banks\n- [Issue 5961](https://github.com/firefly-iii/firefly-iii/issues/5961) Fixes an issue registering new users\n\n## 5.7.0 - 2022-04-04\n\n- \u26a0\ufe0f This release no longer supports LDAP.\n- \u26a0\ufe0f This is the last release that supports PHP 8.0\n- \ud83d\udc4d Want to try the new v3 layout? At your own risk, browse to `/v3/`.\n\nPlease refer to the [documentation](https://docs.firefly-iii.org/firefly-iii/) and support channels if you run into problems:\n\n- [Gitter.im](https://gitter.im/firefly-iii/firefly-iii)\n- [Twitter](https://twitter.com/Firefly_III/)\n- [GitHub Issues](https://github.com/firefly-iii/firefly-iii/issues)\n- [GitHub Discussions](https://github.com/firefly-iii/firefly-iii/discussions)\n\n### Added\n- Error email message now includes HTTP headers.\n- [Issue 5373](https://github.com/firefly-iii/firefly-iii/issues/5373) You can give budgets notes, although they're not visible yet.\n- [Issue 5648](https://github.com/firefly-iii/firefly-iii/issues/5648) The Docker image supports custom locales, see `.env.example` for instructions.\n- [Issue 3984](https://github.com/firefly-iii/firefly-iii/issues/3984) [issue 5636](https://github.com/firefly-iii/firefly-iii/issues/5636) [issue 4903](https://github.com/firefly-iii/firefly-iii/issues/4903) [issue 5326](https://github.com/firefly-iii/firefly-iii/issues/5326) Lots of new search and rule operators. For the full list, see [search.php](https://github.com/firefly-iii/firefly-iii/blob/main/config/search.php) (a bit technical).\n- [Issue 5269](https://github.com/firefly-iii/firefly-iii/issues/5269) It's possible to add piggy banks that have no explicit target amount goal.\n- [Issue 4893](https://github.com/firefly-iii/firefly-iii/issues/4893) Bills can be given an end date and an extension date and will warn you about those dates.\n\n### Changed\n- [Issue 5757](https://github.com/firefly-iii/firefly-iii/issues/5757) Upgrade to Laravel 9.\n\n### Deprecated\n- [Issue 5911](https://github.com/firefly-iii/firefly-iii/issues/5911) Removed support for LDAP.\n\n### Fixed\n- [Issue 5810](https://github.com/firefly-iii/firefly-iii/issues/5810) Could not search for `no_notes:true` in some cases.\n- [Issue 5869](https://github.com/firefly-iii/firefly-iii/issues/5869) Converting transactions would sometimes fail.\n- [Issue 5870](https://github.com/firefly-iii/firefly-iii/issues/5870) Fixed broken link to instructions.\n- [Issue 5903](https://github.com/firefly-iii/firefly-iii/issues/5903) API budget limits was broken due to upgraded package.\n- [Issue 5852](https://github.com/firefly-iii/firefly-iii/issues/5852) It was not possible to recreate a currency.\n- [Issue 5882](https://github.com/firefly-iii/firefly-iii/issues/5882) `no_external_url:true` was broken.\n- [Issue 5770](https://github.com/firefly-iii/firefly-iii/issues/5770) Liabilities spent amount would be doubled.\n- [Issue 4013](https://github.com/firefly-iii/firefly-iii/issues/4013) Date in email message was not localized.\n- [Issue 5949](https://github.com/firefly-iii/firefly-iii/issues/5949) Deleting a transaction would sometimes send you back to a 404.\n\n## x.x.x - 20xx-xx-xx\n\n### Added\n- Initial release.\n\n### Changed\n- Initial release.\n\n### Deprecated\n- Initial release.\n\n### Removed\n- Initial release.\n\n### Fixed\n- Initial release.\n\n### Security\n- Initial release.\n\n### API\n- Initial release.\n\n\n# Full change log\n\nCan be found here: https://docs.firefly-iii.org/firefly-iii/about-firefly-iii/changelog/\n\n\n"], "fixing_code": ["<?php\n\n/*\n * UserController.php\n * Copyright (c) 2021 james@firefly-iii.org\n *\n * This file is part of Firefly III (https://github.com/firefly-iii).\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\ndeclare(strict_types=1);\n\nnamespace FireflyIII\\Api\\V1\\Controllers\\System;\n\nuse FireflyIII\\Api\\V1\\Controllers\\Controller;\nuse FireflyIII\\Api\\V1\\Requests\\System\\UserStoreRequest;\nuse FireflyIII\\Api\\V1\\Requests\\System\\UserUpdateRequest;\nuse FireflyIII\\Exceptions\\FireflyException;\nuse FireflyIII\\Repositories\\User\\UserRepositoryInterface;\nuse FireflyIII\\Transformers\\UserTransformer;\nuse FireflyIII\\User;\nuse Illuminate\\Http\\JsonResponse;\nuse Illuminate\\Pagination\\LengthAwarePaginator;\nuse Illuminate\\Support\\Facades\\Log;\nuse League\\Fractal\\Pagination\\IlluminatePaginatorAdapter;\nuse League\\Fractal\\Resource\\Collection as FractalCollection;\nuse League\\Fractal\\Resource\\Item;\n\n/**\n * Class UserController.\n */\nclass UserController extends Controller\n{\n    private UserRepositoryInterface $repository;\n\n    /**\n     * UserController constructor.\n     *\n     * @codeCoverageIgnore\n     */\n    public function __construct()\n    {\n        parent::__construct();\n        $this->middleware(\n            function ($request, $next) {\n                $this->repository = app(UserRepositoryInterface::class);\n\n                return $next($request);\n            }\n        );\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/deleteUser\n     *\n     * Remove the specified resource from storage.\n     *\n     * @param  User  $user\n     *\n     * @return JsonResponse\n     * @throws FireflyException\n     * @codeCoverageIgnore\n     */\n    public function destroy(User $user): JsonResponse\n    {\n        /** @var User $admin */\n        $admin = auth()->user();\n        if ($admin->id === $user->id) {\n            return response()->json([], 500);\n        }\n\n        if ($this->repository->hasRole($admin, 'owner')) {\n            $this->repository->destroy($user);\n\n            return response()->json([], 204);\n        }\n        throw new FireflyException('200025: No access to function.');\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/listUser\n     *\n     * Display a listing of the resource.\n     *\n     * @return JsonResponse\n     * @throws FireflyException\n     * @codeCoverageIgnore\n     */\n    public function index(): JsonResponse\n    {\n        // user preferences\n        $pageSize = (int)app('preferences')->getForUser(auth()->user(), 'listPageSize', 50)->data;\n        $manager  = $this->getManager();\n\n        // build collection\n        $collection = $this->repository->all();\n        $count      = $collection->count();\n        $users      = $collection->slice(($this->parameters->get('page') - 1) * $pageSize, $pageSize);\n\n        // make paginator:\n        $paginator = new LengthAwarePaginator($users, $count, $pageSize, $this->parameters->get('page'));\n        $paginator->setPath(route('api.v1.users.index').$this->buildParams());\n\n        // make resource\n        /** @var UserTransformer $transformer */\n        $transformer = app(UserTransformer::class);\n        $transformer->setParameters($this->parameters);\n\n        $resource = new FractalCollection($users, $transformer, 'users');\n        $resource->setPaginator(new IlluminatePaginatorAdapter($paginator));\n\n        return response()->json($manager->createData($resource)->toArray())->header('Content-Type', self::CONTENT_TYPE);\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/getUser\n     *\n     * Show a single user.\n     *\n     * @param  User  $user\n     *\n     * @return JsonResponse\n     * @codeCoverageIgnore\n     */\n    public function show(User $user): JsonResponse\n    {\n        // make manager\n        $manager = $this->getManager();\n        // make resource\n        /** @var UserTransformer $transformer */\n        $transformer = app(UserTransformer::class);\n        $transformer->setParameters($this->parameters);\n\n        $resource = new Item($user, $transformer, 'users');\n\n        return response()->json($manager->createData($resource)->toArray())->header('Content-Type', self::CONTENT_TYPE);\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/storeUser\n     *\n     * Store a new user.\n     *\n     * @param  UserStoreRequest  $request\n     *\n     * @return JsonResponse\n     */\n    public function store(UserStoreRequest $request): JsonResponse\n    {\n        $data    = $request->getAll();\n        $user    = $this->repository->store($data);\n        $manager = $this->getManager();\n\n        // make resource\n\n        /** @var UserTransformer $transformer */\n        $transformer = app(UserTransformer::class);\n        $transformer->setParameters($this->parameters);\n\n        $resource = new Item($user, $transformer, 'users');\n\n        return response()->json($manager->createData($resource)->toArray())->header('Content-Type', self::CONTENT_TYPE);\n    }\n\n    /**\n     * This endpoint is documented at:\n     * https://api-docs.firefly-iii.org/#/users/updateUser\n     *\n     * Update a user.\n     *\n     * @param  UserUpdateRequest  $request\n     * @param  User  $user\n     *\n     * @return JsonResponse\n     */\n    public function update(UserUpdateRequest $request, User $user): JsonResponse\n    {\n        $data    = $request->getAll();\n\n        // can only update 'blocked' when user is admin.\n        if(!$this->repository->hasRole(auth()->user(), 'owner')) {\n            Log::debug('Quietly drop fields \"blocked\" and \"blocked_code\" from request.');\n            unset($data['blocked'], $data['blocked_code']);\n        }\n\n        $user    = $this->repository->update($user, $data);\n        $manager = $this->getManager();\n        // make resource\n        /** @var UserTransformer $transformer */\n        $transformer = app(UserTransformer::class);\n        $transformer->setParameters($this->parameters);\n\n        $resource = new Item($user, $transformer, 'users');\n\n        return response()->json($manager->createData($resource)->toArray())->header('Content-Type', self::CONTENT_TYPE);\n    }\n}\n", "<?php\n\n/**\n * Authenticate.php\n * Copyright (c) 2019 james@firefly-iii.org\n *\n * This file is part of Firefly III (https://github.com/firefly-iii).\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n */\n\ndeclare(strict_types=1);\n\nnamespace FireflyIII\\Http\\Middleware;\n\nuse Closure;\nuse FireflyIII\\Exceptions\\FireflyException;\nuse FireflyIII\\User;\nuse Illuminate\\Auth\\AuthenticationException;\nuse Illuminate\\Contracts\\Auth\\Factory as Auth;\nuse Illuminate\\Http\\Request;\nuse Log;\n\n/**\n * Class Authenticate\n */\nclass Authenticate\n{\n    /**\n     * The authentication factory instance.\n     *\n     * @var Auth\n     */\n    protected $auth;\n\n    /**\n     * Create a new middleware instance.\n     *\n     * @param  Auth  $auth\n     *\n     * @return void\n     */\n    public function __construct(Auth $auth)\n    {\n        $this->auth = $auth;\n    }\n\n    /**\n     * Handle an incoming request.\n     *\n     * @param  Request  $request\n     * @param  Closure  $next\n     * @param  string[]  ...$guards\n     *\n     * @return mixed\n     *\n     * @throws FireflyException\n     * @throws AuthenticationException\n     */\n    public function handle($request, Closure $next, ...$guards)\n    {\n        $this->authenticate($request, $guards);\n\n        return $next($request);\n    }\n\n    /**\n     * Determine if the user is logged in to any of the given guards.\n     *\n     * @param  mixed  $request\n     * @param  array  $guards\n     *\n     * @return mixed\n     * @throws FireflyException\n     * @throws AuthenticationException\n     */\n    protected function authenticate($request, array $guards)\n    {\n        Log::debug(sprintf('Now in %s', __METHOD__));\n        if (0 === count($guards)) {\n            // Log::debug('No guards present.');\n            // go for default guard:\n            /** @noinspection PhpUndefinedMethodInspection */\n            if ($this->auth->check()) {\n                // Log::debug('Default guard says user is authenticated.');\n                // do an extra check on user object.\n                /** @noinspection PhpUndefinedMethodInspection */\n                /** @var User $user */\n                $user = $this->auth->authenticate();\n                $this->validateBlockedUser($user, $guards);\n            }\n\n            return $this->auth->authenticate(); // @phpstan-ignore-line (thinks function returns void)\n        }\n        // Log::debug('Guard array is not empty.');\n\n        foreach ($guards as $guard) {\n            Log::debug(sprintf('Now in guard loop, guard is \"%s\"', $guard));\n            if ('api' !== $guard) {\n                $this->auth->guard($guard)->authenticate();\n            }\n            $result = $this->auth->guard($guard)->check();\n            Log::debug(sprintf('Result is %s', var_export($result, true)));\n            if ($result) {\n                $user = $this->auth->guard($guard)->user();\n                $this->validateBlockedUser($user, $guards);\n                // According to PHPstan the method returns void, but we'll see.\n                return $this->auth->shouldUse($guard); // @phpstan-ignore-line\n            }\n        }\n\n        throw new AuthenticationException('Unauthenticated.', $guards);\n    }\n\n    /**\n     * @param  User|null  $user\n     * @param  array  $guards\n     * @return void\n     * @throws AuthenticationException\n     */\n    private function validateBlockedUser(?User $user, array $guards): void\n    {\n        Log::debug(sprintf('Now in %s', __METHOD__));\n        if (null === $user) {\n            Log::warning('User is null, throw exception?');\n        }\n        if (null !== $user) {\n            // Log::debug(get_class($user));\n            if (1 === (int)$user->blocked) {\n                $message = (string)trans('firefly.block_account_logout');\n                if ('email_changed' === $user->blocked_code) {\n                    $message = (string)trans('firefly.email_changed_logout');\n                }\n                Log::warning('User is blocked, cannot use authentication method.');\n                app('session')->flash('logoutMessage', $message);\n                $this->auth->logout(); // @phpstan-ignore-line (thinks function is undefined)\n\n                throw new AuthenticationException('Blocked account.', $guards);\n            }\n        }\n    }\n}\n", "# Change Log\nAll notable changes to this project will be documented in this file.\nThis project adheres to [Semantic Versioning](http://semver.org/).\n\nAlpha 2\n\n\n- Data import: when you submit a transaction but give the ID of an account of the wrong type, Firefly III will try to create an account of the right type. For example: you submit a deposit but the source account is an expense account: Firefly III will try to create a revenue account instead. \n- Security: blocked users can access API, users can unblock themselves using the API.\n\n## 5.8.0-alpha.1 - 2023-01-08\n\nThis is the first release of the new 5.8.0 series of Firefly III. It should upgrade the database automatically BUT \nmake a backup of your database first! I guarantee nothing.\n\n### Warnings\n\n- \u26a0\ufe0f Make a backup of your database first!\n- \u26a0\ufe0f This version requires **PHP 8.2**.\n\nYou can access the new V3 layout under `/v3/`. If you decide to use or test it:\n\n- \u26a0\ufe0f Read the instructions under the \u2620\ufe0f icon FIRST.\n- \u26a0\ufe0f The new layout is not yet finished. Use it to change your data at your own risk. \n\n### Added\n\nLots of new stuff that I invite you to test and break.\n\n- [Issue 4975](https://github.com/firefly-iii/firefly-iii/issues/4975) Rules can copy/move description to notes and vice versa\n- [Issue 5031](https://github.com/firefly-iii/firefly-iii/issues/5031) You can invite users to your installation when registration is off\n- [Issue 5213](https://github.com/firefly-iii/firefly-iii/issues/5213) You can trigger recurring transactions beforehand\n- [Issue 5592](https://github.com/firefly-iii/firefly-iii/issues/5592) Transactions have a little history box to show how rules changed them\n- [Issue 5752](https://github.com/firefly-iii/firefly-iii/issues/5752) Firefly III can send Slack notifications instead of emails\n- [Issue 5862](https://github.com/firefly-iii/firefly-iii/issues/5862) Search can filter on reconciled transactions\n- [Issue 6086](https://github.com/firefly-iii/firefly-iii/issues/6086) All search filters can be negative by putting `-` in front of them\n- [Issue 6441](https://github.com/firefly-iii/firefly-iii/issues/6441) Buttons to purge deleted data, which is easy for data imports\n- [Issue 6457](https://github.com/firefly-iii/firefly-iii/issues/6457) Rule trigger 'transaction exists', that will always trigger\n- [Issue 6526](https://github.com/firefly-iii/firefly-iii/issues/6526) Option to disable rules and/or webhooks when saving transactions\n- [Issue 6605](https://github.com/firefly-iii/firefly-iii/issues/6605) You can search for external ID values\n- Working beta of the new layout under `/v3/`\n- New authentication screens that support dark mode.\n- There is a page for webhooks.\n\n### Changed\n- Firefly III requires PHP 8.2\n- Liabilities are no longer part of your net worth.\n- Liabilities no longer need two transactions to be managed properly (see the documentation)\n\n### Removed\n- [Issue 4198](https://github.com/firefly-iii/firefly-iii/issues/4198) The total available budget amount bar on the `/budgets` page is no longer manageable but will be auto-calculated\n\n### Fixed\n\nNot many bugfixes (yet).\n\n- [Issue 6581](https://github.com/firefly-iii/firefly-iii/issues/6581) Fields were not cleared in the transaction screen in some cases\n\n### API\n\nNew `/v2/` endpoints are being implemented that prepare the application for (among other things) the ability\nto manage multiple financial administrations. The documentation for these endpoints will be at \nhttps://api-docs.firefly-iii.org/.\n\n- [Issue 6130](https://github.com/firefly-iii/firefly-iii/issues/6130) You can now create a reconciliation transaction\n\n## 5.7.18 - 2023-01-03\n\n### Fixed\n- [Issue 6775](https://github.com/firefly-iii/firefly-iii/issues/6775) OAuth authentication was broken for Authelia and other remote user providers.\n- [Issue 6787](https://github.com/firefly-iii/firefly-iii/issues/6787) SQLite value conversion broke several functions\n\n## 5.7.17 - 2022-12-30\n\n### Fixed\n- [Issue 6742](https://github.com/firefly-iii/firefly-iii/issues/6742) Error when a rule tries to add or remove an amount from a piggy bank\n- [Issue 6743](https://github.com/firefly-iii/firefly-iii/issues/6743) Error when opening piggy bank overview\n- [Issue 6753](https://github.com/firefly-iii/firefly-iii/issues/6753) Rules are not finding any transactions with trigger 'Amount is greater than 0'\n\n## 5.7.16 - 2022-12-25\n\n### Added\n- You can now search for SEPA CT, thanks @dasJ!\n\n### Changed\n- Links go to [Mastodon](https://fosstodon.org/@ff3), not Twitter.\n- Most if not all remaining float values removed. None were used in financial math.\n- Expand Laravel Passport settings.\n\n### Fixed\n- [Issue 6597](https://github.com/firefly-iii/firefly-iii/issues/6597) Edit existing split transaction's source did not work properly.\n- [Issue 6610](https://github.com/firefly-iii/firefly-iii/issues/6610) Fix search for attachments\n- [Issue 6625](https://github.com/firefly-iii/firefly-iii/issues/6625) Page of the links is not displayed due to an error\n- [Issue 6701](https://github.com/firefly-iii/firefly-iii/issues/6701) Ensure remote_guard_alt_email if changed, thanks @nebulade!\n- Remove some null pointers in the code.\n- Add missing locale data\n- Fixed typo, thx @charlesteets!\n- Various issues with piggy banks\n- Clear cache after a transaction is deleted.\n- Be more clear about registrations being disabled.\n\n### Security\n- Updated all packages and dependencies.\n\n### API\n- Fix API endpoint that would not accept two of the same dates.\n\n## 5.7.15 - 2022-11-02\n\n### Fixed\n- You can no longer set the currency of expense and revenue accounts.\n- Form elements are not spell checked anymore (privacy).\n- [Issue 6556](https://github.com/firefly-iii/firefly-iii/issues/6556) Wrong value used in bill chart\n- [Issue 6564](https://github.com/firefly-iii/firefly-iii/issues/6564) Right-Align numbers to match monetary value digits\n- [Issue 6589](https://github.com/firefly-iii/firefly-iii/issues/6589) Webhook not fired after destroying transaction\n- Add missing locale data\n\n## 5.7.14 - 2022-10-19\n\n### Fixed\n- Bulk editing transactions works.\n- Negative budgets no longer work.\n\n## 5.7.13 - 2022-10-17\n\n### Added\n- [Issue 6502](https://github.com/firefly-iii/firefly-iii/issues/6502) A few students from @D7032E-Group-6 added MTD and YTD, thanks!\n\n### Fixed\n- [Issue 6461](https://github.com/firefly-iii/firefly-iii/issues/6461) Broken link in `/public` directory warning.\n- [Issue 6475](https://github.com/firefly-iii/firefly-iii/issues/6475) Method name mixup.\n- [Issue 6471](https://github.com/firefly-iii/firefly-iii/issues/6471) Fix float conversion\n- [Issue 6510](https://github.com/firefly-iii/firefly-iii/issues/6510) Destroy transaction now also triggers liability recalculation.\n- Amount check for budget amounts was too low.\n- Some other small fixes\n\n### API\n- [Issue 6481](https://github.com/firefly-iii/firefly-iii/issues/6481) Mixup in API validation, fixed by @janw\n\n## 5.7.12 - 2022-09-12\n\n### Fixed\n- [Issue 6287](https://github.com/firefly-iii/firefly-iii/issues/6287) Catch error when trying to email with invalid settings.\n- [Issue 6423](https://github.com/firefly-iii/firefly-iii/issues/6423) Fix redis error, thanks @canoine!\n- [Issue 6421](https://github.com/firefly-iii/firefly-iii/issues/6421) Fix issue with SQLite.\n- [Issue 6379](https://github.com/firefly-iii/firefly-iii/issues/6379) Fix issue when user has lots of currencies but short list settings.\n- [Issue 6333](https://github.com/firefly-iii/firefly-iii/issues/6333) Fix broken chart for reconciliation.\n- [Issue 6332](https://github.com/firefly-iii/firefly-iii/issues/6332) Fix issue with uploading zipped PDF's.\n\n## 5.7.11 - 2022-09-05\n\n### Added\n- [Issue 6254](https://github.com/firefly-iii/firefly-iii/issues/6254) Use Piggy Bank's start date in monthly suggestion by @rickdoesdev\n- Add best practices badge.\n- Various sanity checks on large amounts.\n\n### Removed\n- Service worker is removed.\n\n### Fixed\n- [Issue 6260](https://github.com/firefly-iii/firefly-iii/issues/6260)\n- [Issue 6271](https://github.com/firefly-iii/firefly-iii/issues/6271) Improve settings for Redis, by @canoine\n- [Issue 6283](https://github.com/firefly-iii/firefly-iii/issues/6283) Convert to deposit means the transaction loses its bill.\n- Fix issue with foreign currencies in transaction form.\n- Fix various issues with SQLite.\n- [Issue 6379](https://github.com/firefly-iii/firefly-iii/issues/6379) Some foreign currencies not list for setting on new transactions\n- Make 2FA code + validation more robust. Thanks to @jtmoss3991, @timaschew and @Ottega.\n\n## 5.7.10 - 2022-07-16\n\n### Fixed\n- [Issue 6122](https://github.com/firefly-iii/firefly-iii/issues/6122) Type error on data import and display\n- SQLite query issues fixed\n- Fix nullpointer.\n- [Issue 6168](https://github.com/firefly-iii/firefly-iii/issues/6168) Missing date overview in no-category list.\n- [Issue 6165](https://github.com/firefly-iii/firefly-iii/issues/6165) Account numbers could not be shared between expense and revenue accounts.\n- [Issue 6150](https://github.com/firefly-iii/firefly-iii/issues/6150) The first remote user would not get admin.\n- [Issue 6118](https://github.com/firefly-iii/firefly-iii/issues/6118) Piggy bank events would not get copied when transaction was copied.  \n\n### Security\n- Update packages\n\n## 5.7.9 - 2022-06-01\n\n### Fixed\n- Symfony 6.1 requires PHP 8.1, so back to 6.0 for the time being.\n\n## 5.7.8 - 2022-06-01\n\n### Fixed\n- Symfony 6.1 requires PHP 8.1, so back to 6.0 for the time being.\n\n## 5.7.7 - 2022-06-01\n\n### Fixed\n- Fixed an issue where the login form would overflow a database field.\n- [Issue 6113](https://github.com/firefly-iii/firefly-iii/issues/6113) Fix issue with number formatting.\n- [Issue 5996](https://github.com/firefly-iii/firefly-iii/issues/5996) Catch bad library\n\n### Added\n- @turrisxyz added a dependency review, thanks!\n\n## 5.7.6 - 2022-05-19\n\n### Fixed\n- [Issue 6058](https://github.com/firefly-iii/firefly-iii/issues/6058) Bad type-casting could break Firefly III on Home Assistant.\n- [Issue 6059](https://github.com/firefly-iii/firefly-iii/issues/6059) Fix issue with missing list of bills when creating a recurring transaction from a transaction.\n- Added missing DB integrity checks.\n\n### Security\n- Updated various packages\n\n## 5.7.5 - 2022-05-06\n\n### Fixed\n- Fixed an issue where missing method names would break the API.\n- [Issue 6040](https://github.com/firefly-iii/firefly-iii/issues/6040) Could not add or remove money from piggy banks without a target.\n- [Issue 6009](https://github.com/firefly-iii/firefly-iii/issues/6009) `has_no_attachments:true` would not return transactions with *deleted* transactions.\n- [Issue 6050](https://github.com/firefly-iii/firefly-iii/issues/6050) ja_JP is part of the Docker image\n\n## 5.7.4 - 2022-05-03\n\n### Fixed\n- Fixed issue in method names.\n\n## 5.7.3 - 2022-05-03\n\n### Fixed\n- Searching for `updated_at_before` and `created_at_before` works again.\n- [Issue 6000](https://github.com/firefly-iii/firefly-iii/issues/6000) Bad math when dealing with multi-currency reconciliation.\n- Remove unused CSS\n- Fix bad migration.\n\n### API\n- Add error code to error message.\n\n## 5.7.2 - 2022-04-13\n\n### Fixed\n- Not configuring email would break registration.\n- Extra validation on piggy bank amounts.\n\n## 5.7.1 - 2022-04-05\n\n### Fixed\n- Fixes an issue with showing piggy banks\n- [Issue 5961](https://github.com/firefly-iii/firefly-iii/issues/5961) Fixes an issue registering new users\n\n## 5.7.0 - 2022-04-04\n\n- \u26a0\ufe0f This release no longer supports LDAP.\n- \u26a0\ufe0f This is the last release that supports PHP 8.0\n- \ud83d\udc4d Want to try the new v3 layout? At your own risk, browse to `/v3/`.\n\nPlease refer to the [documentation](https://docs.firefly-iii.org/firefly-iii/) and support channels if you run into problems:\n\n- [Gitter.im](https://gitter.im/firefly-iii/firefly-iii)\n- [Twitter](https://twitter.com/Firefly_III/)\n- [GitHub Issues](https://github.com/firefly-iii/firefly-iii/issues)\n- [GitHub Discussions](https://github.com/firefly-iii/firefly-iii/discussions)\n\n### Added\n- Error email message now includes HTTP headers.\n- [Issue 5373](https://github.com/firefly-iii/firefly-iii/issues/5373) You can give budgets notes, although they're not visible yet.\n- [Issue 5648](https://github.com/firefly-iii/firefly-iii/issues/5648) The Docker image supports custom locales, see `.env.example` for instructions.\n- [Issue 3984](https://github.com/firefly-iii/firefly-iii/issues/3984) [issue 5636](https://github.com/firefly-iii/firefly-iii/issues/5636) [issue 4903](https://github.com/firefly-iii/firefly-iii/issues/4903) [issue 5326](https://github.com/firefly-iii/firefly-iii/issues/5326) Lots of new search and rule operators. For the full list, see [search.php](https://github.com/firefly-iii/firefly-iii/blob/main/config/search.php) (a bit technical).\n- [Issue 5269](https://github.com/firefly-iii/firefly-iii/issues/5269) It's possible to add piggy banks that have no explicit target amount goal.\n- [Issue 4893](https://github.com/firefly-iii/firefly-iii/issues/4893) Bills can be given an end date and an extension date and will warn you about those dates.\n\n### Changed\n- [Issue 5757](https://github.com/firefly-iii/firefly-iii/issues/5757) Upgrade to Laravel 9.\n\n### Deprecated\n- [Issue 5911](https://github.com/firefly-iii/firefly-iii/issues/5911) Removed support for LDAP.\n\n### Fixed\n- [Issue 5810](https://github.com/firefly-iii/firefly-iii/issues/5810) Could not search for `no_notes:true` in some cases.\n- [Issue 5869](https://github.com/firefly-iii/firefly-iii/issues/5869) Converting transactions would sometimes fail.\n- [Issue 5870](https://github.com/firefly-iii/firefly-iii/issues/5870) Fixed broken link to instructions.\n- [Issue 5903](https://github.com/firefly-iii/firefly-iii/issues/5903) API budget limits was broken due to upgraded package.\n- [Issue 5852](https://github.com/firefly-iii/firefly-iii/issues/5852) It was not possible to recreate a currency.\n- [Issue 5882](https://github.com/firefly-iii/firefly-iii/issues/5882) `no_external_url:true` was broken.\n- [Issue 5770](https://github.com/firefly-iii/firefly-iii/issues/5770) Liabilities spent amount would be doubled.\n- [Issue 4013](https://github.com/firefly-iii/firefly-iii/issues/4013) Date in email message was not localized.\n- [Issue 5949](https://github.com/firefly-iii/firefly-iii/issues/5949) Deleting a transaction would sometimes send you back to a 404.\n\n## x.x.x - 20xx-xx-xx\n\n### Added\n- Initial release.\n\n### Changed\n- Initial release.\n\n### Deprecated\n- Initial release.\n\n### Removed\n- Initial release.\n\n### Fixed\n- Initial release.\n\n### Security\n- Initial release.\n\n### API\n- Initial release.\n\n\n# Full change log\n\nCan be found here: https://docs.firefly-iii.org/firefly-iii/about-firefly-iii/changelog/\n\n\n"], "filenames": ["app/Api/V1/Controllers/System/UserController.php", "app/Http/Middleware/Authenticate.php", "changelog.md"], "buggy_code_start_loc": [35, 90, 9], "buggy_code_end_loc": [193, 137, 11], "fixing_code_start_loc": [36, 90, 9], "fixing_code_end_loc": [202, 153, 10], "type": "CWE-863", "message": "Incorrect Authorization in GitHub repository firefly-iii/firefly-iii prior to 5.8.0.", "other": {"cve": {"id": "CVE-2023-0298", "sourceIdentifier": "security@huntr.dev", "published": "2023-01-14T08:15:13.110", "lastModified": "2023-03-02T02:15:41.390", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "Incorrect Authorization in GitHub repository firefly-iii/firefly-iii prior to 5.8.0."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-863"}]}, {"source": "nvd@nist.gov", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-863"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:firefly-iii:firefly_iii:*:*:*:*:*:*:*:*", "versionEndExcluding": "5.8.0", "matchCriteriaId": "FC71D703-37D4-4FB8-BCA8-E6AB82116D63"}]}]}], "references": [{"url": "https://github.com/firefly-iii/firefly-iii/commit/db0500dcf0d4f1990fc7a377ef0d56c3884fcaa4", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/9689052c-c1d7-4aae-aa08-346c9b6e04ed", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/firefly-iii/firefly-iii/commit/db0500dcf0d4f1990fc7a377ef0d56c3884fcaa4"}}