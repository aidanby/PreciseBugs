{"buggy_code": ["using System;\r\nusing System.Linq;\r\nusing System.Web.UI.WebControls;\r\nusing System.Web.UI.HtmlControls;\r\nusing System.Xml;\r\nusing System.Xml.Linq;\r\nusing Umbraco.Core;\r\nusing Umbraco.Core.IO;\r\n\r\nnamespace umbraco.presentation.umbraco.dialogs\r\n{\r\n\t/// <summary>\r\n\t/// Summary description for importDocumentType.\r\n\t/// </summary>\r\n\tpublic class importDocumentType : BasePages.UmbracoEnsuredPage\r\n\t{\r\n\t    public importDocumentType()\r\n\t    {\r\n\r\n            CurrentApp = BusinessLogic.DefaultApps.settings.ToString();\r\n\r\n\t    }\r\n\t\tprotected Literal FeedBackMessage;\r\n\t\tprotected Literal jsShowWindow;\r\n\t\tprotected Panel Wizard;\r\n\t\tprotected HtmlTable Table1;\r\n\t\tprotected HtmlInputHidden tempFile;\r\n\t\tprotected HtmlInputFile documentTypeFile;\r\n\t\tprotected Button submit;\r\n\t\tprotected Panel Confirm;\r\n\t\tprotected Literal dtName;\r\n\t\tprotected Literal dtAlias;\r\n\t\tprotected Button import;\r\n\t\tprotected Literal dtNameConfirm;\r\n\t\tprotected Panel done;\r\n\t\tprivate string tempFileName = \"\";\r\n\r\n\t\tprivate void Page_Load(object sender, EventArgs e)\r\n\t\t{\r\n\t\t\tif (!IsPostBack) \r\n\t\t\t{\r\n\t\t\t\tsubmit.Text = ui.Text(\"import\");\r\n\t\t\t\timport.Text = ui.Text(\"import\");\r\n\t\t\t} \r\n\t\t}\r\n\r\n\t\t#region Web Form Designer generated code\r\n\t\toverride protected void OnInit(EventArgs e)\r\n\t\t{\r\n\t\t\t//\r\n\t\t\t// CODEGEN: This call is required by the ASP.NET Web Form Designer.\r\n\t\t\t//\r\n\t\t\tInitializeComponent();\r\n\t\t\tbase.OnInit(e);\r\n\t\t}\r\n\t\t\r\n\t\t/// <summary>\r\n\t\t/// Required method for Designer support - do not modify\r\n\t\t/// the contents of this method with the code editor.\r\n\t\t/// </summary>\r\n\t\tprivate void InitializeComponent()\r\n\t\t{    \r\n\t\t\tthis.submit.Click += new System.EventHandler(this.submit_Click);\r\n\t\t\tthis.import.Click += new System.EventHandler(this.import_Click);\r\n\t\t\tthis.Load += new System.EventHandler(this.Page_Load);\r\n\r\n\t\t}\r\n\t\t#endregion\r\n\r\n\t\tprivate void import_Click(object sender, EventArgs e)\r\n\t\t{\r\n            var xd = new XmlDocument();\r\n            xd.Load(tempFile.Value);\r\n\r\n\t\t    var userId = base.getUser().Id;\r\n\r\n            var element = XElement.Parse(xd.InnerXml);\r\n\t\t    var importContentTypes = ApplicationContext.Current.Services.PackagingService.ImportContentTypes(element, userId);\r\n\t\t    var contentType = importContentTypes.FirstOrDefault();\r\n\t\t    if (contentType != null)\r\n\t\t        dtNameConfirm.Text = contentType.Name;\r\n\r\n            // Try to clean up the temporary file.\r\n            try\r\n            {\r\n                System.IO.File.Delete(tempFile.Value);\r\n            }\r\n            catch(Exception ex)\r\n            {\r\n                Umbraco.Core.Logging.LogHelper.Error(typeof(importDocumentType), \"Error cleaning up temporary udt file in App_Data: \" + ex.Message, ex);\r\n            }\r\n\r\n\t\t    Wizard.Visible = false;\r\n\t\t\tConfirm.Visible = false;\r\n\t\t\tdone.Visible = true;\r\n\t\t}\r\n\r\n\t\tprivate void submit_Click(object sender, EventArgs e)\r\n\t\t{\r\n\t\t\ttempFileName = \"justDelete_\" + Guid.NewGuid().ToString() + \".udt\";\r\n\t\t\tvar fileName = IOHelper.MapPath(SystemDirectories.Data + \"/\" + tempFileName);\r\n\t\t\ttempFile.Value = fileName;\r\n\r\n\t\t\tdocumentTypeFile.PostedFile.SaveAs(fileName);\r\n\r\n\t\t\tvar xd = new XmlDocument();\r\n\t\t\txd.Load(fileName);\r\n\t\t\tdtName.Text = xd.DocumentElement.SelectSingleNode(\"//DocumentType/Info/Name\").FirstChild.Value;\r\n\t\t\tdtAlias.Text = xd.DocumentElement.SelectSingleNode(\"//DocumentType/Info/Alias\").FirstChild.Value;\r\n\r\n\t\t\tWizard.Visible = false;\r\n\t\t\tdone.Visible = false;\r\n\t\t\tConfirm.Visible = true;\r\n\t\t}\r\n\t}\r\n}\r\n"], "fixing_code": ["using System;\r\nusing System.Linq;\r\nusing System.Web.UI.WebControls;\r\nusing System.Web.UI.HtmlControls;\r\nusing System.Xml;\r\nusing System.Xml.Linq;\r\nusing Umbraco.Core;\r\nusing Umbraco.Core.IO;\r\n\r\nnamespace umbraco.presentation.umbraco.dialogs\r\n{\r\n\t/// <summary>\r\n\t/// Summary description for importDocumentType.\r\n\t/// </summary>\r\n\tpublic class importDocumentType : BasePages.UmbracoEnsuredPage\r\n\t{\r\n\t    public importDocumentType()\r\n\t    {\r\n\r\n            CurrentApp = BusinessLogic.DefaultApps.settings.ToString();\r\n\r\n\t    }\r\n\t\tprotected Literal FeedBackMessage;\r\n\t\tprotected Literal jsShowWindow;\r\n\t\tprotected Panel Wizard;\r\n\t\tprotected HtmlTable Table1;\r\n\t\tprotected HtmlInputHidden tempFile;\r\n\t\tprotected HtmlInputFile documentTypeFile;\r\n\t\tprotected Button submit;\r\n\t\tprotected Panel Confirm;\r\n\t\tprotected Literal dtName;\r\n\t\tprotected Literal dtAlias;\r\n\t\tprotected Button import;\r\n\t\tprotected Literal dtNameConfirm;\r\n\t\tprotected Panel done;\r\n\t\tprivate string tempFileName = \"\";\r\n\r\n\t\tprivate void Page_Load(object sender, EventArgs e)\r\n\t\t{\r\n\t\t\tif (!IsPostBack) \r\n\t\t\t{\r\n\t\t\t\tsubmit.Text = ui.Text(\"import\");\r\n\t\t\t\timport.Text = ui.Text(\"import\");\r\n\t\t\t} \r\n\t\t}\r\n\r\n\t\t#region Web Form Designer generated code\r\n\t\toverride protected void OnInit(EventArgs e)\r\n\t\t{\r\n\t\t\t//\r\n\t\t\t// CODEGEN: This call is required by the ASP.NET Web Form Designer.\r\n\t\t\t//\r\n\t\t\tInitializeComponent();\r\n\t\t\tbase.OnInit(e);\r\n\t\t}\r\n\t\t\r\n\t\t/// <summary>\r\n\t\t/// Required method for Designer support - do not modify\r\n\t\t/// the contents of this method with the code editor.\r\n\t\t/// </summary>\r\n\t\tprivate void InitializeComponent()\r\n\t\t{    \r\n\t\t\tthis.submit.Click += new System.EventHandler(this.submit_Click);\r\n\t\t\tthis.import.Click += new System.EventHandler(this.import_Click);\r\n\t\t\tthis.Load += new System.EventHandler(this.Page_Load);\r\n\r\n\t\t}\r\n\t\t#endregion\r\n\r\n\t\tprivate void import_Click(object sender, EventArgs e)\r\n\t\t{\r\n            var xd = new XmlDocument();\r\n\t\t    xd.XmlResolver = null;\r\n            xd.Load(tempFile.Value);\r\n\r\n\t\t    var userId = base.getUser().Id;\r\n            \r\n            var element = XElement.Parse(xd.InnerXml);\r\n\t\t    var importContentTypes = ApplicationContext.Current.Services.PackagingService.ImportContentTypes(element, userId);\r\n\t\t    var contentType = importContentTypes.FirstOrDefault();\r\n\t\t    if (contentType != null)\r\n\t\t        dtNameConfirm.Text = contentType.Name;\r\n\r\n            // Try to clean up the temporary file.\r\n            try\r\n            {\r\n                System.IO.File.Delete(tempFile.Value);\r\n            }\r\n            catch(Exception ex)\r\n            {\r\n                Umbraco.Core.Logging.LogHelper.Error(typeof(importDocumentType), \"Error cleaning up temporary udt file in App_Data: \" + ex.Message, ex);\r\n            }\r\n\r\n\t\t    Wizard.Visible = false;\r\n\t\t\tConfirm.Visible = false;\r\n\t\t\tdone.Visible = true;\r\n\t\t}\r\n\r\n\t\tprivate void submit_Click(object sender, EventArgs e)\r\n\t\t{\r\n\t\t\ttempFileName = \"justDelete_\" + Guid.NewGuid().ToString() + \".udt\";\r\n\t\t\tvar fileName = IOHelper.MapPath(SystemDirectories.Data + \"/\" + tempFileName);\r\n\t\t\ttempFile.Value = fileName;\r\n\r\n\t\t\tdocumentTypeFile.PostedFile.SaveAs(fileName);\r\n\r\n\t\t\tvar xd = new XmlDocument();\r\n\t\t    xd.XmlResolver = null;\n            xd.Load(fileName);\r\n\t\t\tdtName.Text = xd.DocumentElement.SelectSingleNode(\"//DocumentType/Info/Name\").FirstChild.Value;\r\n\t\t\tdtAlias.Text = xd.DocumentElement.SelectSingleNode(\"//DocumentType/Info/Alias\").FirstChild.Value;\r\n\r\n\t\t\tWizard.Visible = false;\r\n\t\t\tdone.Visible = false;\r\n\t\t\tConfirm.Visible = true;\r\n\t\t}\r\n\t}\r\n}\r\n"], "filenames": ["src/Umbraco.Web/umbraco.presentation/umbraco/dialogs/importDocumenttype.aspx.cs"], "buggy_code_start_loc": [72], "buggy_code_end_loc": [108], "fixing_code_start_loc": [73], "fixing_code_end_loc": [110], "type": "CWE-611", "message": "XML external entity (XXE) vulnerability in Umbraco CMS before 7.7.3 allows attackers to obtain sensitive information by reading files on the server or sending TCP requests to intranet hosts (aka SSRF), related to Umbraco.Web/umbraco.presentation/umbraco/dialogs/importDocumenttype.aspx.cs.", "other": {"cve": {"id": "CVE-2017-15280", "sourceIdentifier": "cve@mitre.org", "published": "2017-10-12T08:29:00.510", "lastModified": "2017-10-25T12:53:37.937", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XML external entity (XXE) vulnerability in Umbraco CMS before 7.7.3 allows attackers to obtain sensitive information by reading files on the server or sending TCP requests to intranet hosts (aka SSRF), related to Umbraco.Web/umbraco.presentation/umbraco/dialogs/importDocumenttype.aspx.cs."}, {"lang": "es", "value": "Vulnerabilidad XEE (XML External Entity) en Umbraco CMS en versiones anteriores 7.7.3 permite que atacantes obtengan informaci\u00f3n sensible leyendo archivos en el servidor o enviando peticiones TCP a hosts de la intranet (tambi\u00e9n conocido como SSRF). Esto est\u00e1 relacionado con Umbraco.Web/umbraco.presentation/umbraco/dialogs/importDocumenttype.aspx.cs."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N", "attackVector": "LOCAL", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.8, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:N/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-611"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:umbraco:umbraco_cms:*:*:*:*:*:*:*:*", "versionEndIncluding": "7.7.2", "matchCriteriaId": "ED6DB680-A447-45E3-9DA7-F1B4FB25C557"}]}]}], "references": [{"url": "http://issues.umbraco.org/issue/U4-10506", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Patch", "Vendor Advisory"]}, {"url": "https://github.com/umbraco/Umbraco-CMS/commit/5dde2efe0d2b3a47d17439e03acabb7ea2befb64", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/umbraco/Umbraco-CMS/commit/5dde2efe0d2b3a47d17439e03acabb7ea2befb64"}}