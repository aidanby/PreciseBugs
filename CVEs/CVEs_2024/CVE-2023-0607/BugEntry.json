{"buggy_code": ["<?php\n/**\n * List of available client's templates\n */\n$allowed_levels = array(9);\nrequire_once 'bootstrap.php';\n\n$page_title    = __(\"Templates\", 'cftp_admin');\n\n$active_nav = 'templates';\ninclude_once ADMIN_VIEWS_DIR . DS . 'header.php';\n\n/**\n * Changing the client's template\n */\nif (isset($_GET['activate_template'])) {\n    $save = save_option('selected_clients_template', $_GET['activate_template']);\n\n    global $flash;\n    if ($save) {\n        $flash->success(__('Options updated successfully.', 'cftp_admin'));\n    } else {\n        $flash->error(__('There was an error. Please try again.', 'cftp_admin'));\n    }\n\n    /** Redirect so the options are reflected immediately */\n    $section_redirect = 'templates';\n\n    ps_redirect(BASE_URI . 'templates.php');\n}\n\n$templates = look_for_templates();\n?>\n<div class=\"row\">\n    <div class=\"col-12 col-sm-12 col-lg-12\">\n        <div class=\"template_selector\">\n            <div class=\"row\">\n                <?php\n                    foreach ($templates as $template) {\n                ?>\n                    <div class=\"col-12 col-sm-6 col-md-3\">\n                        <div class=\"template <?php if ($template['location'] == get_option('selected_clients_template')) { echo 'current_template';} ?>\">\n                            <div class=\"col-12\">\n                                <div class=\"images\">\n                                    <?php\n                                    if (!empty($template['cover'])) {\n                                    ?>\n                                        <div class=\"cover\">\n                                            <img src=\"<?php echo html_output($template['cover']); ?>\" alt=\"<?php echo html_output($template['name']); ?>\">\n                                        </div>\n                                    <?php\n                                    }\n                                    ?>\n                                    <div class=\"screenshot\">\n                                        <img src=\"<?php echo html_output($template['screenshot']); ?>\" alt=\"<?php echo html_output($template['name']); ?>\">\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-12\">\n                                <h4>\n                                    <?php echo $template['name']; ?>\n                                </h4>\n                            </div>\n                            <div class=\"col-xs-8\">\n                                <div class=\"info\">\n                                    <div class=\"description\">\n                                        <?php echo $template['description']; ?>\n                                    </div>\n\n                                    <h5><?php _e('Author', 'cftp_admin'); ?></h5>\n                                    <p>\n                                        <a href=\"<?php echo $template['authoruri']; ?>\" target=\"_blank\">\n                                            <?php echo $template['author']; ?>\n                                        </a><br>\n                                        <?php echo $template['authoremail']; ?>\n                                    </p>\n                                </div>\n                            </div>\n                            <div class=\"col-xs-4\">\n                                <div class=\"buttons\">\n                                    <?php\n                                    if ($template['location'] == get_option('selected_clients_template')) {\n                                    ?>\n                                        <a href=\"#\" class=\"btn btn-pslight disabled\">\n                                            <?php _e('Active', 'cftp_admin'); ?>\n                                        </a>\n                                    <?php\n                                    } else {\n                                    ?>\n                                        <a href=\"templates.php?activate_template=<?php echo $template['location']; ?>\" class=\"btn btn-primary\">\n                                            <?php _e('Activate', 'cftp_admin'); ?>\n                                        </a>\n                                    <?php\n                                    }\n                                    ?>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                <?php\n                }\n                ?>\n            </div>\n        </div>\n    </div>\n</div>\n<?php\ninclude_once ADMIN_VIEWS_DIR . DS . 'footer.php';\n"], "fixing_code": ["<?php\n/**\n * List of available client's templates\n */\n$allowed_levels = array(9);\nrequire_once 'bootstrap.php';\n\n$page_title    = __(\"Templates\", 'cftp_admin');\n\n$active_nav = 'templates';\ninclude_once ADMIN_VIEWS_DIR . DS . 'header.php';\n\n$templates = look_for_templates();\n$valid_templates = array_map(function($t) { return $t['location']; }, $templates);\n\n/**\n * Changing the client's template\n */\nif (isset($_GET['activate_template'])) {\n    if (!in_array($_GET['activate_template'], $valid_templates)) {\n        exit_with_error_code(403);\n    }\n\n    $save = save_option('selected_clients_template', $_GET['activate_template']);\n\n    global $flash;\n    if ($save) {\n        $flash->success(__('Options updated successfully.', 'cftp_admin'));\n    } else {\n        $flash->error(__('There was an error. Please try again.', 'cftp_admin'));\n    }\n\n    /** Redirect so the options are reflected immediately */\n    $section_redirect = 'templates';\n\n    ps_redirect(BASE_URI . 'templates.php');\n}\n?>\n<div class=\"row\">\n    <div class=\"col-12 col-sm-12 col-lg-12\">\n        <div class=\"template_selector\">\n            <div class=\"row\">\n                <?php\n                    foreach ($templates as $template) {\n                ?>\n                    <div class=\"col-12 col-sm-6 col-md-3\">\n                        <div class=\"template <?php if ($template['location'] == get_option('selected_clients_template')) { echo 'current_template';} ?>\">\n                            <div class=\"col-12\">\n                                <div class=\"images\">\n                                    <?php\n                                    if (!empty($template['cover'])) {\n                                    ?>\n                                        <div class=\"cover\">\n                                            <img src=\"<?php echo html_output($template['cover']); ?>\" alt=\"<?php echo html_output($template['name']); ?>\">\n                                        </div>\n                                    <?php\n                                    }\n                                    ?>\n                                    <div class=\"screenshot\">\n                                        <img src=\"<?php echo html_output($template['screenshot']); ?>\" alt=\"<?php echo html_output($template['name']); ?>\">\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-12\">\n                                <h4>\n                                    <?php echo $template['name']; ?>\n                                </h4>\n                            </div>\n                            <div class=\"col-xs-8\">\n                                <div class=\"info\">\n                                    <div class=\"description\">\n                                        <?php echo $template['description']; ?>\n                                    </div>\n\n                                    <h5><?php _e('Author', 'cftp_admin'); ?></h5>\n                                    <p>\n                                        <a href=\"<?php echo $template['authoruri']; ?>\" target=\"_blank\">\n                                            <?php echo $template['author']; ?>\n                                        </a><br>\n                                        <?php echo $template['authoremail']; ?>\n                                    </p>\n                                </div>\n                            </div>\n                            <div class=\"col-xs-4\">\n                                <div class=\"buttons\">\n                                    <?php\n                                    if ($template['location'] == get_option('selected_clients_template')) {\n                                    ?>\n                                        <a href=\"#\" class=\"btn btn-pslight disabled\">\n                                            <?php _e('Active', 'cftp_admin'); ?>\n                                        </a>\n                                    <?php\n                                    } else {\n                                    ?>\n                                        <a href=\"templates.php?activate_template=<?php echo $template['location']; ?>\" class=\"btn btn-primary\">\n                                            <?php _e('Activate', 'cftp_admin'); ?>\n                                        </a>\n                                    <?php\n                                    }\n                                    ?>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                <?php\n                }\n                ?>\n            </div>\n        </div>\n    </div>\n</div>\n<?php\ninclude_once ADMIN_VIEWS_DIR . DS . 'footer.php';\n"], "filenames": ["templates.php"], "buggy_code_start_loc": [12], "buggy_code_end_loc": [33], "fixing_code_start_loc": [13], "fixing_code_end_loc": [37], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository projectsend/projectsend prior to r1606.", "other": {"cve": {"id": "CVE-2023-0607", "sourceIdentifier": "security@huntr.dev", "published": "2023-02-01T04:15:09.253", "lastModified": "2023-02-08T15:30:47.177", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository projectsend/projectsend prior to r1606."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.2, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.2, "impactScore": 5.9}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:projectsend:projectsend:*:*:*:*:*:*:*:*", "versionEndExcluding": "r1606", "matchCriteriaId": "829FE2A0-DD2C-4933-A79D-4561855A1DC0"}]}]}], "references": [{"url": "https://github.com/projectsend/projectsend/commit/698be4ade1db6ae0eaf27c843a03ffc9683cca0a", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/9294743d-7818-4264-b973-59de027d549b", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/projectsend/projectsend/commit/698be4ade1db6ae0eaf27c843a03ffc9683cca0a"}}