{"buggy_code": ["<?php\n\n/**\n * Delete open questions.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package phpMyFAQ\n * @author Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2003-2022 phpMyFAQ Team\n * @license http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link https://www.phpmyfaq.de\n * @since 2003-02-24\n */\n\nuse phpMyFAQ\\Category;\nuse phpMyFAQ\\Date;\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Question;\nuse phpMyFAQ\\Strings;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n?>\n<div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n  <h1 class=\"h2\">\n    <i aria-hidden=\"true\" class=\"fa fa-question-circle-o\"></i>\n      <?= $PMF_LANG['msgOpenQuestions'] ?>\n  </h1>\n</div>\n\n<div class=\"row\">\n  <div class=\"col-lg-12\">\n      <?php\n      if ($user->perm->hasPermission($user->getUserId(), 'delquestion')) {\n          $category = new Category($faqConfig, [], false);\n          $question = new Question($faqConfig);\n          $category->setUser($currentAdminUser);\n          $category->setGroups($currentAdminGroups);\n          $date = new Date($faqConfig);\n          $questionId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n          $csrfToken = Filter::filterInput(INPUT_GET, 'csrf', FILTER_UNSAFE_RAW);\n\n          if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n              $csrfChecked = false;\n          } else {\n              $csrfChecked = true;\n          }\n\n          $toggle = Filter::filterInput(INPUT_GET, 'is_visible', FILTER_UNSAFE_RAW);\n          if ($csrfChecked && $toggle === 'toggle') {\n              $isVisible = $question->getVisibility($questionId);\n              if (!is_null($isVisible)) {\n                  $question->setVisibility($questionId, ($isVisible == 'N' ? 'Y' : 'N'));\n              }\n          }\n\n            echo '<div id=\"returnMessage\"></div>';\n\n            $openQuestions = $question->getAllOpenQuestions();\n\n            if (count($openQuestions) > 0) {\n                ?>\n            <form id=\"questionSelection\" name=\"questionSelection\" method=\"post\" accept-charset=\"utf-8\">\n              <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n              <table class=\"table table-striped\">\n                <thead>\n                <tr>\n                  <th></th>\n                  <th><?= $PMF_LANG['ad_entry_author'] ?></th>\n                  <th><?= $PMF_LANG['ad_entry_theme'] ?></th>\n                  <th colspan=\"2\"><?= $PMF_LANG['ad_entry_visibility'] ?>?</th>\n                </tr>\n                </thead>\n                <tbody>\n                <?php\n                foreach ($openQuestions as $openQuestion) {\n                    ?>\n                  <tr>\n                    <td>\n                      <label>\n                        <input id=\"questions[]\" name=\"questions[]\" value=\"<?= $openQuestion->getId() ?>\" type=\"checkbox\">\n                      </label>\n                    </td>\n                    <td>\n                        <?= $date->format(Date::createIsoDate($openQuestion->getCreated())) ?>\n                      <br>\n                      <a href=\"mailto:<?= $openQuestion->getEmail() ?>\">\n                          <?= Strings::htmlentities($openQuestion->getUsername()) ?>\n                      </a>\n                    </td>\n                    <td>\n                      <strong><?= $category->categoryName[$openQuestion->getCategoryId()]['name'] ?></strong>\n                      <br>\n                        <?= Strings::htmlentities($openQuestion->getQuestion()) ?>\n                    </td>\n                    <td>\n                      <a href=\"?action=question&amp;id=<?= $openQuestion->getId() ?>&amp;is_visible=toggle&csrf=<?= $user->getCsrfTokenFromSession() ?>\"\n                         class=\"btn btn-info\">\n                          <?= ('Y' === $openQuestion->isVisible()) ? $PMF_LANG['ad_gen_yes'] : $PMF_LANG['ad_gen_no'] ?>\n                      </a>\n                    </td>\n                    <td>\n                        <?php if ($faqConfig->get('records.enableCloseQuestion') && $openQuestion->getAnswerId()) { ?>\n                        <a href=\"?action=editentry&amp;id=<?= $openQuestion->getAnswerId() ?>&amp;lang=<?= $faqLangCode ?>\"\n                           class=\"btn btn-success\">\n                            <?= $PMF_LANG['msg2answerFAQ'] ?>\n                        </a>\n                        <?php } else { ?>\n                        <a href=\"?action=takequestion&amp;id=<?= $openQuestion->getId() ?>\" class=\"btn btn-success\">\n                            <?= $PMF_LANG['ad_ques_take'] ?>\n                        </a>\n                        <?php } ?>\n                    </td>\n                  </tr>\n                <?php } ?>\n                </tbody>\n              </table>\n\n              <div class=\"text-right\">\n                <button class=\"btn btn-danger\" id=\"submitDeleteQuestions\" type=\"submit\">\n                    <?= $PMF_LANG['ad_entry_delete'] ?>\n                </button>\n              </div>\n\n            </form>\n            <script src=\"assets/js/record.js\"></script>\n                <?php\n            } else {\n                echo $PMF_LANG['msgNoQuestionsAvailable'];\n            }\n        } else {\n            echo $PMF_LANG['err_NotAuth'];\n        }\n        ?>\n  </div>\n</div>\n"], "fixing_code": ["<?php\n\n/**\n * Delete open questions.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package phpMyFAQ\n * @author Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2003-2022 phpMyFAQ Team\n * @license http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link https://www.phpmyfaq.de\n * @since 2003-02-24\n */\n\nuse phpMyFAQ\\Category;\nuse phpMyFAQ\\Date;\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Question;\nuse phpMyFAQ\\Strings;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n?>\n<div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n  <h1 class=\"h2\">\n    <i aria-hidden=\"true\" class=\"fa fa-question-circle-o\"></i>\n      <?= $PMF_LANG['msgOpenQuestions'] ?>\n  </h1>\n</div>\n\n<div class=\"row\">\n  <div class=\"col-lg-12\">\n      <?php\n      if ($user->perm->hasPermission($user->getUserId(), 'delquestion')) {\n          $category = new Category($faqConfig, [], false);\n          $question = new Question($faqConfig);\n          $category->setUser($currentAdminUser);\n          $category->setGroups($currentAdminGroups);\n          $date = new Date($faqConfig);\n          $questionId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);\n          $csrfToken = Filter::filterInput(INPUT_GET, 'csrf', FILTER_UNSAFE_RAW);\n\n          if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n              $csrfChecked = false;\n          } else {\n              $csrfChecked = true;\n          }\n\n          $toggle = Filter::filterInput(INPUT_GET, 'is_visible', FILTER_UNSAFE_RAW);\n          if ($csrfChecked && $toggle === 'toggle') {\n              $isVisible = $question->getVisibility($questionId);\n              if (!is_null($isVisible)) {\n                  $question->setVisibility($questionId, ($isVisible == 'N' ? 'Y' : 'N'));\n              }\n          }\n\n            echo '<div id=\"returnMessage\"></div>';\n\n            $openQuestions = $question->getAllOpenQuestions();\n\n            if (count($openQuestions) > 0) {\n                ?>\n            <form id=\"questionSelection\" name=\"questionSelection\" method=\"post\" accept-charset=\"utf-8\">\n              <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n              <table class=\"table table-striped\">\n                <thead>\n                <tr>\n                  <th></th>\n                  <th><?= $PMF_LANG['ad_entry_author'] ?></th>\n                  <th><?= $PMF_LANG['ad_entry_theme'] ?></th>\n                  <th colspan=\"2\"><?= $PMF_LANG['ad_entry_visibility'] ?>?</th>\n                </tr>\n                </thead>\n                <tbody>\n                <?php\n                foreach ($openQuestions as $openQuestion) {\n                    ?>\n                  <tr>\n                    <td>\n                      <label>\n                        <input id=\"questions[]\" name=\"questions[]\" value=\"<?= $openQuestion->getId() ?>\" type=\"checkbox\">\n                      </label>\n                    </td>\n                    <td>\n                        <?= $date->format(Date::createIsoDate($openQuestion->getCreated())) ?>\n                      <br>\n                      <a href=\"mailto:<?= Strings::htmlentities($openQuestion->getEmail()) ?>\">\n                          <?= Strings::htmlentities($openQuestion->getUsername()) ?>\n                      </a>\n                    </td>\n                    <td>\n                      <strong>\n                          <?= Strings::htmlentities($category->categoryName[$openQuestion->getCategoryId()]['name']) ?>\n                      </strong>\n                      <br>\n                        <?= Strings::htmlentities($openQuestion->getQuestion()) ?>\n                    </td>\n                    <td>\n                      <a href=\"?action=question&amp;id=<?= $openQuestion->getId() ?>&amp;is_visible=toggle&csrf=<?= $user->getCsrfTokenFromSession() ?>\"\n                         class=\"btn btn-info\">\n                          <?= ('Y' === $openQuestion->isVisible()) ? $PMF_LANG['ad_gen_yes'] : $PMF_LANG['ad_gen_no'] ?>\n                      </a>\n                    </td>\n                    <td>\n                        <?php if ($faqConfig->get('records.enableCloseQuestion') && $openQuestion->getAnswerId()) { ?>\n                        <a href=\"?action=editentry&amp;id=<?= $openQuestion->getAnswerId() ?>&amp;lang=<?= $faqLangCode ?>\"\n                           class=\"btn btn-success\">\n                            <?= $PMF_LANG['msg2answerFAQ'] ?>\n                        </a>\n                        <?php } else { ?>\n                        <a href=\"?action=takequestion&amp;id=<?= $openQuestion->getId() ?>\" class=\"btn btn-success\">\n                            <?= $PMF_LANG['ad_ques_take'] ?>\n                        </a>\n                        <?php } ?>\n                    </td>\n                  </tr>\n                <?php } ?>\n                </tbody>\n              </table>\n\n              <div class=\"text-right\">\n                <button class=\"btn btn-danger\" id=\"submitDeleteQuestions\" type=\"submit\">\n                    <?= $PMF_LANG['ad_entry_delete'] ?>\n                </button>\n              </div>\n\n            </form>\n            <script src=\"assets/js/record.js\"></script>\n                <?php\n            } else {\n                echo $PMF_LANG['msgNoQuestionsAvailable'];\n            }\n        } else {\n            echo $PMF_LANG['err_NotAuth'];\n        }\n        ?>\n  </div>\n</div>\n"], "filenames": ["phpmyfaq/admin/record.questions.php"], "buggy_code_start_loc": [92], "buggy_code_end_loc": [98], "fixing_code_start_loc": [92], "fixing_code_end_loc": [100], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository thorsten/phpmyfaq prior to 3.1.13.", "other": {"cve": {"id": "CVE-2023-2550", "sourceIdentifier": "security@huntr.dev", "published": "2023-05-05T20:15:10.557", "lastModified": "2023-05-10T02:20:24.467", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository thorsten/phpmyfaq prior to 3.1.13."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "LOW", "baseScore": 8.2, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 4.2}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyfaq:phpmyfaq:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.1.13", "matchCriteriaId": "C8E79CDF-44C3-4462-BDA6-E23A25A11D0D"}]}]}], "references": [{"url": "https://github.com/thorsten/phpmyfaq/commit/20ac51594db11604a4518aacc28a51f67d4f11bf", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/840c8d91-c97e-4116-a9f8-4ab1a38d239b", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/thorsten/phpmyfaq/commit/20ac51594db11604a4518aacc28a51f67d4f11bf"}}