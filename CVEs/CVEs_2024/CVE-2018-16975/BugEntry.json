{"buggy_code": ["<?php\n\n/**\n * Live preview handler for stylesheet forms.\n */\n\n$this->require_admin ();\n\n$this->run ('admin/util/i18n');\n\n$page->title = __ ('Page title');\n$page->preview = true;\n$page->layout = false;\n\nif ($_SERVER['REQUEST_METHOD'] == 'GET') {\n\tif (! empty ($_GET['layout'])) {\n\t\tif (strpos ($_GET['layout'], '..') === false) {\n\t\t\tif (file_exists ('layouts/' . $_GET['layout'] . '.html')) {\n\t\t\t\t$page->layout = file_get_contents ('layouts/' . $_GET['layout'] . '.html');\n\t\t\t} elseif (file_exists ('layouts/' . $_GET['layout'] . '/' . $_GET['layout'] . '.html')) {\n\t\t\t\t$page->layout = file_get_contents ('layouts/' . $_GET['layout'] . '/' . $_GET['layout'] . '.html');\n\t\t\t}\n\t\t}\n\t}\n\tif ($_GET['css'] && preg_match ('/^(layouts|css)\\/[a-z0-9\\/ _-]+\\.css$/i', $_GET['css'])) {\n\t\t$page->layout = str_replace ('</head>', '<style>' . file_get_contents ($_GET['css']) . '</style></head>', $page->layout);\n\t}\n} else {\n\tif (! empty ($_POST['layout'])) {\n\t\tif (strpos ($_POST['layout'], '..') === false) {\n\t\t\tif (file_exists ('layouts/' . $_POST['layout'] . '.html')) {\n\t\t\t\t$page->layout = file_get_contents ('layouts/' . $_POST['layout'] . '.html');\n\t\t\t} elseif (file_exists ('layouts/' . $_POST['layout'] . '/' . $_POST['layout'] . '.html')) {\n\t\t\t\t$page->layout = file_get_contents ('layouts/' . $_POST['layout'] . '/' . $_POST['layout'] . '.html');\n\t\t\t}\n\t\t}\n\t}\n\tif ($_POST['css']) {\n\t\t$page->layout = str_replace ('</head>', '<style>' . $_POST['css'] . '</style></head>', $page->layout);\n\t}\t\n}\n\nif ($page->layout === false) {\n\t$page->layout = conf ('General', 'default_layout');\n}\n\necho '<p>' . __ ('This is a preview of how your layout will look.') . '</p>';\n"], "fixing_code": ["<?php\n\n/**\n * Live preview handler for stylesheet forms.\n */\n\n$this->require_admin ();\n\n$this->run ('admin/util/i18n');\n\n$page->title = __ ('Page title');\n$page->preview = true;\n$page->layout = false;\n\nif ($_SERVER['REQUEST_METHOD'] == 'GET') {\n\tif (! empty ($_GET['layout'])) {\n\t\tif (strpos ($_GET['layout'], '..') === false) {\n\t\t\tif (file_exists ('layouts/' . $_GET['layout'] . '.html')) {\n\t\t\t\t$page->layout = file_get_contents ('layouts/' . $_GET['layout'] . '.html');\n\t\t\t} elseif (file_exists ('layouts/' . $_GET['layout'] . '/' . $_GET['layout'] . '.html')) {\n\t\t\t\t$page->layout = file_get_contents ('layouts/' . $_GET['layout'] . '/' . $_GET['layout'] . '.html');\n\t\t\t}\n\t\t}\n\t}\n\tif ($_GET['css'] && preg_match ('/^(layouts|css)\\/[a-z0-9\\/ _-]+\\.css$/i', $_GET['css'])) {\n\t\t$page->layout = str_replace ('</head>', '<style>' . strip_tags (file_get_contents ($_GET['css'])) . '</style></head>', $page->layout);\n\t}\n} else {\n\tif (! empty ($_POST['layout'])) {\n\t\tif (strpos ($_POST['layout'], '..') === false) {\n\t\t\tif (file_exists ('layouts/' . $_POST['layout'] . '.html')) {\n\t\t\t\t$page->layout = file_get_contents ('layouts/' . $_POST['layout'] . '.html');\n\t\t\t} elseif (file_exists ('layouts/' . $_POST['layout'] . '/' . $_POST['layout'] . '.html')) {\n\t\t\t\t$page->layout = file_get_contents ('layouts/' . $_POST['layout'] . '/' . $_POST['layout'] . '.html');\n\t\t\t}\n\t\t}\n\t}\n\tif ($_POST['css']) {\n\t\t$page->layout = str_replace ('</head>', '<style>' . strip_tags ($_POST['css']) . '</style></head>', $page->layout);\n\t}\t\n}\n\nif ($page->layout === false) {\n\t$page->layout = conf ('General', 'default_layout');\n}\n\necho '<p>' . __ ('This is a preview of how your layout will look.') . '</p>';\n"], "filenames": ["apps/designer/handlers/csspreview.php"], "buggy_code_start_loc": [26], "buggy_code_end_loc": [40], "fixing_code_start_loc": [26], "fixing_code_end_loc": [40], "type": "CWE-94", "message": "An issue was discovered in Elefant CMS before 2.0.7. There is a PHP Code Execution Vulnerability in /designer/add/stylesheet.php by using a .php extension in the New Stylesheet Name field in conjunction with <?php content, because of insufficient input validation in apps/designer/handlers/csspreview.php.", "other": {"cve": {"id": "CVE-2018-16975", "sourceIdentifier": "cve@mitre.org", "published": "2018-09-12T21:29:00.863", "lastModified": "2020-08-24T17:37:01.140", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "An issue was discovered in Elefant CMS before 2.0.7. There is a PHP Code Execution Vulnerability in /designer/add/stylesheet.php by using a .php extension in the New Stylesheet Name field in conjunction with <?php content, because of insufficient input validation in apps/designer/handlers/csspreview.php."}, {"lang": "es", "value": "Se ha descubierto un problema en versiones anteriores a la 2.0.7 de Elefant CMS. Hay una vulnerabilidad de ejecuci\u00f3n de c\u00f3digo PHP en /designer/add/stylesheet.php mediante el uso de una extensi\u00f3n .php en el campo New Stylesheet Name junto con contenido"}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-94"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:elefantcms:elefant:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.0.7", "matchCriteriaId": "1064DF8F-8937-4E41-96E1-180DA0EE9B59"}]}]}], "references": [{"url": "https://github.com/jbroadway/elefant/commit/0795ab57c7ffa53ff4af57e229f6d9680fa54a21", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/jbroadway/elefant/issues/286", "source": "cve@mitre.org", "tags": ["Exploit", "Patch", "Third Party Advisory"]}, {"url": "https://github.com/jbroadway/elefant/releases/tag/elefant_2_0_7_stable", "source": "cve@mitre.org", "tags": ["Release Notes"]}]}, "github_commit_url": "https://github.com/jbroadway/elefant/commit/0795ab57c7ffa53ff4af57e229f6d9680fa54a21"}}