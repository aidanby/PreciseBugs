{"buggy_code": ["<?php\n\nclass qa_html_theme_layer extends qa_html_theme_base {\n\tvar $meta_title;\n\tvar $meta_description;\n\tvar $meta_keywords;\n\tvar $metas = array();\n\tvar $social_metas = array();\n\tfunction doctype(){\n\t\tqa_html_theme_base::doctype();\n\t\trequire_once QA_INCLUDE_DIR.'qa-db-metas.php';\n\t\t// Custom Meta(title,description,keywords)\n\t\tif( ($this->template=='question') and (qa_opt('useo_meta_editor_enable')) ){\n\t\t\t$metas = json_decode(qa_db_postmeta_get($this->content['q_view']['raw']['postid'], 'useo-meta-info'),true);\n\t\t\t$this->meta_title = @$metas['title'];\n\t\t\t$this->meta_description = @$metas['description'];\n\t\t\t$this->meta_keywords = @$metas['keywords'];\n\t\t}\n\t\t// Generate Social Meta Tags\n\t\t$page_url = @$this->content['canonical'];\n\t\tif(! empty($this->meta_description))\n\t\t\t$description = $this->meta_description;\n\t\telse\n\t\t\t$description = @$this->content['description'];\n\t\tif(! empty($this->meta_title))\n\t\t\t$title = $this->meta_title;\n\t\telse\n\t\t\t$title = @$this->content['q_view']['raw']['title'];\n\t\t\n\t\tif($this->template=='question'){\n\t\t\tif(qa_opt('useo_social_enable_editor')){\n\t\t\t\t$this->social_metas = json_decode(qa_db_postmeta_get($this->content['q_view']['raw']['postid'], 'useo-social-info'),true);\n\t\t\t\tif(count($this->social_metas))\n\t\t\t\t\tforeach ($this->social_metas as $index => $variable){\n\t\t\t\t\t\t$this->metas[$index]['content'] = $variable;\n\t\t\t\t\t\t$this->metas[$index]['type'] = '';\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tif(qa_opt('useo_social_og_enable_auto')){ // Open Graph\n\t\t\t\t// site name\n\t\t\t\t$this->metas['og-sitename']['content'] = @$this->content['site_title'];\n\t\t\t\t$this->metas['og-sitename']['type'] = 'property=\"og:site_name\"';\n\t\t\t\t// title\n\t\t\t\t$this->metas['og-title']['content'] = $title;\n\t\t\t\t$this->metas['og-title']['type'] = 'property=\"og:title\"';\n\t\t\t\t// description\n\t\t\t\t$gl_length = qa_opt('useo_social_og_desc_length');\n\t\t\t\tif($gl_length<=0)\n\t\t\t\t\t\t$gl_length = 140;\n\t\t\t\t$this->metas['og-description']['content'] = useo_get_excerpt($description, 0, $gl_length);\n\t\t\t\t$this->metas['og-description']['type'] = 'property=\"og:description\"';\n\t\t\t\t// Type\n\t\t\t\t$this->metas['og-type']['content'] = 'website';\n\t\t\t\t$this->metas['og-type']['type'] = 'property=\"og:type\"';\n\t\t\t\t// url\n\t\t\t\tif(! empty($page_url)){\n\t\t\t\t\t$this->metas['og-url']['content'] = $page_url;\n\t\t\t\t\t$this->metas['og-url']['type'] = 'property=\"og:url\"';\n\t\t\t\t}\n\t\t\t\t// image\n\t\t\t\t$og_image = qa_opt('useo_social_og_image');\n\t\t\t\tif(! empty($og_image)){\n\t\t\t\t\t$this->metas['og-image']['content'] = $og_image;\n\t\t\t\t\t$this->metas['og-image']['type'] = 'property=\"og:image\"';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(qa_opt('useo_social_tc_enable')){ // Twitter Cards\n\t\t\t\t// type\n\t\t\t\t$this->metas['tc-type']['content'] = 'summary';\n\t\t\t\t$this->metas['tc-type']['type'] = 'property=\"twitter:card\"';\n\t\t\t\t// title\n\t\t\t\t$this->metas['tc-title']['content'] = $title;\n\t\t\t\t$this->metas['tc-title']['type'] = 'property=\"twitter:title\"';\n\t\t\t\t// description\n\t\t\t\t$useo_social_tc_desc_length = qa_opt('useo_social_og_desc_length');\n\t\t\t\tif($useo_social_tc_desc_length<=0)\n\t\t\t\t\t\t$useo_social_tc_desc_length = 120;\n\t\t\t\t$this->metas['tc-description']['content'] = useo_get_excerpt($description, 0, $useo_social_tc_desc_length);\n\t\t\t\t$this->metas['tc-description']['type'] = 'property=\"twitter:description\"';\n\t\t\t\t// image\n\t\t\t\t$tc_image = qa_opt('useo_social_tc_image');\n\t\t\t\tif(! empty($tc_image)){\n\t\t\t\t\t$this->metas['tc-image']['content'] = $tc_image;\n\t\t\t\t\t$this->metas['tc-image']['type'] = 'property=\"twitter:image\"';\n\t\t\t\t}\n\t\t\t\t// handler\n\t\t\t\t// twitter handler goes into \"site\" field of meta tag\n\t\t\t\t$tc_handler = qa_opt('useo_social_tc_handler');\n\t\t\t\tif(! empty($tc_handler)){\n\t\t\t\t\t$this->metas['tc-handler']['content'] = $tc_handler;\n\t\t\t\t\t$this->metas['tc-handler']['type'] = 'property=\"twitter:site\"';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(qa_opt('useo_social_schema_enable')){ // Twitter Cards\n\t\t\t\t// title\n\t\t\t\t$this->metas['gp-title']['content'] = $title;\n\t\t\t\t$this->metas['gp-title']['type'] = 'itemprop=\"name\"';\n\t\t\t\t// description\n\t\t\t\t$this->metas['gp-title']['content'] = $description;\n\t\t\t\t$this->metas['gp-title']['type'] = 'itemprop=\"description\"';\n\t\t\t\t// type\n\t\t\t\t$gp_type = qa_opt('useo_social_schema_page_type');\n\t\t\t\tif($gp_type==2)\n\t\t\t\t\t$gp_page_type = 'Question';\n\t\t\t\telseif($gp_type==3)\n\t\t\t\t\t$gp_page_type = 'Article';\n\t\t\t\tif( isset($gp_page_type) ){ \n\t\t\t\t\t$this->metas['gp-title']['content'] = '';\n\t\t\t\t\t$this->metas['gp-title']['type'] = 'itemscope itemtype=\"http://schema.org/' . $gp_page_type . '\"';\n\t\t\t\t}\n\t\t\t\t// description\n\t\t\t\t$gp_image = qa_opt('useo_social_gp_thumbnail');\n\t\t\t\tif(! empty($gp_image)){\n\t\t\t\t\t$this->metas['gp-image']['content'] = $gp_image;\n\t\t\t\t\t$this->metas['gp-image']['type'] = 'itemprop=\"image\"';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// category link titles\n\t\t$useo_cat_desc_map = array();\n\t\t$categoryid_list = array();\n\t\t//prepare category navigation ids\n\t\tif(isset($this->content['navigation']['cat']) && qa_opt('useo_cat_title_nav_enable')){\n\t\t\t$category_nav = $this->content['navigation']['cat'];\n\t\t\tunset($category_nav['all']);\n\t\t\tforeach ($category_nav as $index => $item){\n\t\t\t\t$categoryid_list[$item['categoryid']] = $item['categoryid'];\n\t\t\t}\n\t\t}\n\t\t// prepare question list ids\n\t\tif(isset($this->content[\"q_list\"][\"qs\"]) && qa_opt('useo_cat_title_qlist_enable')){\n\t\t\tforeach ($this->content[\"q_list\"][\"qs\"] as $index => $item){\n\t\t\t\tif($item['raw']['categoryid'])\n\t\t\t\t\t$categoryid_list[$item['raw']['categoryid']] = $item['raw']['categoryid'];\n\t\t\t}\n\t\t}\n\t\t// get all category titles\n\t\tif(count($categoryid_list)){\n\t\t\t$result=qa_db_query_sub(\n\t\t\t\t'SELECT categoryid, content FROM ^categorymetas WHERE categoryid IN ($) AND title=$',\n\t\t\t\t$categoryid_list,'useo_cat_title'\n\t\t\t);\n\t\t\t$useo_cat_desc_map = qa_db_read_all_assoc($result,'categoryid');\n\t\t\tif(isset($this->content[\"q_list\"][\"qs\"]))\n\t\t\t\tforeach ($this->content[\"q_list\"][\"qs\"] as $index => $item){\n\t\t\t\t\tif(isset($item['raw']['categoryid']) && isset($useo_cat_desc_map[$item['raw']['categoryid']]))\n\t\t\t\t\t\t$this->content[\"q_list\"][\"qs\"][$index]['where']['title'] = $useo_cat_desc_map[$item['raw']['categoryid']]['content'];\n\t\t\t\t}\n\t\t}\n\t\t// set category title for navigation\n\t\tif(count(@$this->content['navigation']['cat']) && qa_opt('useo_cat_title_nav_enable')){\n\t\t\tforeach ($this->content['navigation']['cat'] as $index => $item){\n\t\t\t\tif(isset($item['categoryid']) && isset($useo_cat_desc_map[$item['categoryid']]))\n\t\t\t\t\t$this->content['navigation']['cat'][$index][\"popup\"] = $useo_cat_desc_map[$item['categoryid']]['content'];\n\t\t\t}\n\t\t}\n\t\t// Administrator panel navigation item\n\t\tif ($this->request == 'admin/ulitmate_seo') {\n\t\t\tif(empty($this->content['navigation']['sub']))\n\t\t\t\t$this->content['navigation']['sub']=array();\n\t\t\trequire_once QA_INCLUDE_DIR.'qa-app-admin.php';\n\t\t\t$admin_nav = qa_admin_sub_navigation();\n\t\t\t$this->content['navigation']['sub'] = array_merge(\n\t\t\t\t$admin_nav,\n\t\t\t\t$this->content['navigation']['sub']\n\t\t\t);\n\t\t}\n\t\tif ( ($this->template=='admin') or ($this->request == 'ulitmate_seo') ){\n\t\t\t$this->content['navigation']['sub']['ulitmate_seo'] = array(\n\t\t\t\t'label' => 'Ultimate SEO',\n\t\t\t\t'url' => qa_path_html('admin/ulitmate_seo'),\n\t\t\t);\n\t\t\tif ($this->request == 'admin/ulitmate_seo'){\n\t\t\t\t$this->content['navigation']['sub']['ulitmate_seo']['selected'] = true;\n\t\t\t}\n\t\t}\n\t}\n\t// add canonical links to category pages\n\tfunction head_metas()\n\t{\n\t\tqa_html_theme_base::head_metas();\n\t\tif(qa_opt('useo_cat_canonical_enable')){\n\t\t\t$cat_slugs = useo_get_current_category_slug();\n\t\t\tif($cat_slugs){ // it's a category page\n\t\t\t\t$path = qa_path_absolute(implode('/', $cat_slugs));\n\t\t\t\t$this->output('<link rel=\"canonical\" href=\"' . $path . '\">');\n\t\t\t}\n\t\t}\n\t}\n\tfunction head_script()\n\t{\n\t\tqa_html_theme_base::head_script();\n\t\tif ( ($this->template=='question') and (qa_get_logged_in_level() >= QA_USER_LEVEL_ADMIN) ){\n\t\t\t$variables = '';\n\t\t\t$variables .= 'useo_ajax_url = \"' . USEO_URL . '/ajax.php\";';\n\t\t\t$variables .= 'useo_postid = ' . $this->content['q_view']['raw']['postid'] .';';\n\t\t\t$this->output('<script>' . $variables . '</script>');\n\t\t\t$this->output('<script src=\"'.USEO_URL.'/include/seo-forms.js\" type=\"text/javascript\"></script>');\n\t\t}\n\t}\t\n\n\tfunction head_title()\n\t{\n\n\t// Title Customization Options\n\t\t$title = '';\n\t\tswitch ($this->template) {\n\t\t\tcase 'qa':\n\t\t\t\t$title_template = qa_opt('useo_title_qa');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'question':\n\t\t\t\t$category_name = '';\n\t\t\t\tif ( (isset($this->content[\"categoryids\"])) && (!(empty($this->content[\"categoryids\"]))))\n\t\t\t\t\t\t$category_name = $this->content[\"q_view\"][\"raw\"][\"categoryname\"];\n\n\t\t\t\tif(empty($this->meta_title)){\n\t\t\t\t\t// title customization\n\t\t\t\t\t$title_template = qa_opt('useo_title_qa_item');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%question-title%', '%category-name%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), @$this->content['q_view']['raw']['title'], $category_name);\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\t// meta editor\n\t\t\t\t\t$title = $this->meta_title;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'questions':\n\t\t\t\t$category_name = '';\n\t\t\t\tif( count(explode('/',$this->request)) > 1 )\n\t\t\t\t\t$category_name = $this->content[\"q_list\"][\"qs\"][0][\"raw\"][\"categoryname\"];\n\t\t\t\t$sort = qa_get('sort');\n\t\t\t\tif(empty($sort)){\n\t\t\t\t\t$title_template = qa_opt('useo_title_recent');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%recent-qs-title%', '%category-name%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/recent_qs_title'), $category_name);\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='hot'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_hot');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%hot-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/hot_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='votes'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_voted');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%voted-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/voted_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='answers'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_answered');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%answered-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/answered_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='views'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_viewed');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%viewed-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/viewed_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\tcase 'unanswered':\n\t\t\t\t$sort = qa_get('by');\n\t\t\t\t$category_name = '';\n\t\t\t\tif( count(explode('/',$this->request)) > 1 )\n\t\t\t\t\t$category_name = $this->content[\"q_list\"][\"qs\"][0][\"raw\"][\"categoryname\"];\n\n\t\t\t\tif(empty($sort)){\n\t\t\t\t\t$title_template = qa_opt('useo_title_unanswered');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%unanswered-qs-title%', '%category-name%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/unanswered_qs_title'), $category_name);\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='selected'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_unselected');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%unselected-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/unselected_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='upvotes'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_unupvoted');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%unupvoteda-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/unupvoteda_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'activity':\n\t\t\t\t$title_template = qa_opt('useo_title_activity');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$category_name = '';\n\t\t\t\t\tif( count(explode('/',$this->request)) > 1 )\n\t\t\t\t\t\t$category_name = $this->content[\"q_list\"][\"qs\"][0][\"raw\"][\"categoryname\"];\n\n\t\t\t\t\t$search = array( '%site-title%', '%recent-activity-title%', '%category-name%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/recent_activity_title'), $category_name);\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'ask':\n\t\t\t\t$title_template = qa_opt('useo_title_ask');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%', '%ask-title%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('question/ask_title'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'categories':\n\t\t\t\t$title_template = qa_opt('useo_title_categories');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%', '%browse-categories%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('misc/browse_categories'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'tags':\n\t\t\t\t$title_template = qa_opt('useo_title_tags');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%', '%popular-tags%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/popular_tags'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'tag':\n\t\t\t\t$title_template = qa_opt('useo_title_tag');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$req = explode('/',$this->request);\n\t\t\t\t\t$tag = $req[1];\n\t\t\t\t\t$search = array( '%site-title%', '%questions-tagged-x%', '%current-tag%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html_sub('main/questions_tagged_x', qa_html($tag)), $tag );\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'search':\n\t\t\t\t$title_template = qa_opt('useo_title_search');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$term = qa_get('q');\n\t\t\t\t\t$search = array( '%site-title%', '%results-for-x%', '%current-term%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html_sub('main/results_for_x', qa_html($term)), $term );\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'users':\n\t\t\t\t$title_template = qa_opt('useo_title_users');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%', '%highest-users%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/highest_users'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'user':\n\t\t\t\t$title_template = qa_opt('useo_title_user');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$req = explode('/',$this->request);\n\t\t\t\t\t$user = $req[1];\n\t\t\t\t\t$search = array( '%site-title%', '%user-x%', '%current-user%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html_sub('main/results_for_x', qa_html($user)), $user );\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\n\t\t}\n\n\t\tif(empty($title))\n\t\t\tqa_html_theme_base::head_title();\n\t\telse\n\t\t\t$this->output('<title>'.$title.'</title>');\n\t\t\n\t// Page Meta Tags\n\t\t$noindex = qa_opt('useo_access_noindex');\n\t\t$nofollow = qa_opt('useo_access_nofollow');\n\t\tif($noindex and $nofollow)\n\t\t\t$this->output('<meta name=\"robots\" content=\"noindex, nofollow\" />');\n\t\telseif($noindex)\n\t\t\t$this->output('<meta name=\"robots\" content=\"noindex\" />');\n\t\telse{\n\t\t\t// if page is not already noindex, check if it needs to be noindex. also add nofollow if necessary\n\t\t\t$status = 1; // content is long enough\n\t\t\tif( ($this->template=='question') and (qa_opt('useo_access_length_enable')) and ( (int)qa_opt('useo_access_length')>0 ) ){\n\t\t\t\t$status = 0;\n\t\t\t\t$minimum_words = (int)qa_opt('useo_access_length');\n\t\t\t\t$word_count = str_word_count($this->content['q_view']['raw']['title']) + str_word_count($this->content['q_view']['raw']['content']);\n\t\t\t\tif($word_count >= $minimum_words)\n\t\t\t\t\t$status = 1;\n\t\t\t\telse{\n\t\t\t\t\tforeach($this->content['q_view']['c_list']['cs'] as $comment)\n\t\t\t\t\t\t$word_count += str_word_count($comment['raw']['content']);\n\t\t\t\t\tif($word_count >= $minimum_words)\n\t\t\t\t\t\t$status = 1;\n\t\t\t\t\telse{\n\t\t\t\t\t\tforeach($this->content['a_list']['as'] as $answer)\n\t\t\t\t\t\t\t$word_count += str_word_count($answer['raw']['content']);\n\t\t\t\t\t\tif($word_count >= $minimum_words)\n\t\t\t\t\t\t\t$status = 1;\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tforeach($this->content['a_list']['as'] as $answer)\n\t\t\t\t\t\t\t\tforeach($answer['c_list']['cs'] as $comment)\n\t\t\t\t\t\t\t\t\t$word_count += str_word_count($comment['raw']['content']);\n\t\t\t\t\t\t\tif($word_count >= $minimum_words)\n\t\t\t\t\t\t\t\t$status = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif( ($nofollow) && ($status==1) )\n\t\t\t\t$this->output('<meta name=\"robots\" content=\"nofollow\" />');\n\t\t\telseif( ($nofollow) && ($status==0) )\n\t\t\t\t$this->output('<meta name=\"robots\" content=\"noindex, nofollow\" />');\n\t\t\telseif($status==0)\n\t\t\t\t$this->output('<meta name=\"robots\" content=\"noindex\" />');\n\t\t}\n\t// Question Meta tags\n\t\tif($this->template=='question'){\n\t\t\t// setup custom meta keyword\n\t\t\tif (! empty($this->meta_keywords))\n\t\t\t\t$this->content['keywords'] = $this->meta_keywords;\n\t\t\t// setup custom meta description\n\t\t\tif (! empty($this->meta_description))\n\t\t\t\t$this->content['description'] = $this->meta_description;\n\t\t\t// if there was no custom meta description and it's supposed to read it from answers do it, otherwise don't change it\n\t\t\telseif(qa_opt('useo_meta_desc_ans_enable')){\n\t\t\t\t$lenght = (int)qa_opt('useo_meta_desc_length');\n\t\t\t\tif($lenght<=0)\n\t\t\t\t\t$lenght = 160;\n\t\t\t\t$text = '';\n\t\t\t\tif( ($this->content['q_view']['raw']['acount'] > 0) and (qa_opt('useo_meta_desc_ans_enable')) ){\n\t\t\t\t\t// get Selected Answer's content\n\t\t\t\t\tif( (isset($this->content[\"q_view\"][\"raw\"][\"selchildid\"])) and (qa_opt('useo_meta_desc_sel_ans_enable')) ){\n\t\t\t\t\t\tforeach($this->content['a_list']['as'] as $answer)\n\t\t\t\t\t\t\tif($answer['raw']['isselected'])\n\t\t\t\t\t\t\t\t$text = $answer['raw']['content'];\n\t\t\t\t\t}else{\n\t\t\t\t\t// get most voted Answer's content\n\t\t\t\t\t\t$max_vote = 0; // don't use answers with negative votes.\n\t\t\t\t\t\tforeach($this->content['a_list']['as'] as $answer){\n\t\t\t\t\t\t\tif($answer['raw']['netvotes'] > $max_vote){\n\t\t\t\t\t\t\t\t$text = $answer['raw']['content'];\n\t\t\t\t\t\t\t\t$max_vote = $answer['raw']['netvotes'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!(empty($text))){\n\t\t\t\t\tglobal $qa_sanitize_html_newwindow;\n\t\t\t\t\t$excerpt = useo_get_excerpt(qa_sanitize_html($text, $qa_sanitize_html_newwindow), 0, $lenght);\n\t\t\t\t\t$this->content['description'] = $excerpt;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Meta Tags and social meta tags\n\t\t\tif($this->template=='question'){\n\t\t\t\tif(qa_opt('useo_social_enable_editor')){\n\t\t\t\t\tforeach($this->metas as $key => $value)\n\t\t\t\t\t\tif( isset($this->social_metas[$key]) )\n\t\t\t\t\t\t\t$this->output('<meta ' . $value['type'] . ' content=\"' . $this->social_metas[$key] . '\" />' );\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t$this->output('<meta ' . $value['type'] . ( $value['content'] ? ' content=\"' . $value['content'] . '\"' : '') . ' /> ' );\n\t\t\t\t\n\t\t\t\t}elseif(qa_opt('useo_social_og_enable_auto')){\n\t\t\t\t\tforeach($this->metas as $key => $value)\n\t\t\t\t\t\t$this->output('<meta ' . $value['type'] . ( $value['content'] ? ' content=\"' . $value['content'] . '\"' : '') . ' /> ' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction main_parts($content)\n\t{\n\t\tqa_html_theme_base::main_parts($content);\n\n\t\tif( (qa_get_logged_in_level() >= QA_USER_LEVEL_ADMIN) and ($this->template=='question') and (qa_opt('useo_meta_editor_enable')) ){\n\t\t\t\n\t\t\t$this->output('<div class=\"qa-widgets-main qa-widgets-main-low\">');\n\t\t\t$this->output('<form name=\"useo-meta-editor\" action=\"'.qa_self_html().'\" method=\"post\">');\n\t\t\t$this->output('\n\t\t\t<h2> Page Title And Meta Tags </h2>\n\t\t\t<strong>Only administrators can see this section.</strong>\n\t\t\t<table class=\"qa-form-tall-table\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tPage Title\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . $this->content['q_view']['raw']['title'] . '\" id=\"useo-meta-editor-title\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. $this->meta_title .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tDescription Meta Tag\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<textarea placeholder=\"' . $this->content['description'] . '\" id=\"useo-meta-editor-description\" class=\"qa-form-tall-text\" cols=\"40\" rows=\"3\" name=\"useo-meta-editor-description\">'. $this->meta_description .'</textarea>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody id=\"useo-meta-keywords\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tKeywords Meta Tag\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . $this->content['keywords'] . '\" id=\"useo-meta-editor-keywords\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. $this->meta_keywords .'\" name=\"useo-meta-editor-keywords\">\n\t\t\t\t\t\t\t<div class=\"qa-form-tall-note\">A comma separated list of your most important keywords</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td  id=\"useo_buttons_container_meta\" class=\"qa-form-tall-buttons\" colspan=\"1\">\n\t\t\t\t\t\t\t<input id=\"useo_save_meta\" class=\"qa-form-tall-button qa-form-tall-button-save\" type=\"submit\" title=\"\" value=\"Save Options\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t\t');\n\t\t\t$this->output('</form>');\n\t\t\t$this->output('<hr /></div>');\n\t\t}\n\t\tif( (qa_get_logged_in_level() >= QA_USER_LEVEL_ADMIN) and ($this->template=='question') and (qa_opt('useo_social_enable_editor')) ){\n\t\t\t\n\t\t\t$this->output('<div class=\"qa-widgets-main qa-widgets-main-low\">');\n\t\t\t$this->output('<form name=\"useo-meta-editor\" action=\"'.qa_self_html().'\" method=\"post\">');\n\t\t\t$this->output('\n\t\t\t<h2> Social Tags Editor </h2>\n\t\t\t<p>Only administrators can see this section.</p>\n\t\t\t<h3>Open Graph</h3>\n\t\t\t<table class=\"qa-form-tall-table\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tSite Title\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['og-sitename']['content'] . '\" id=\"useo-og-sitename\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['og-sitename'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tPage Title\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['og-title']['content'] . '\" id=\"useo-og-title\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['og-title'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tDescription Meta Tag\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<textarea placeholder=\"' . @$this->metas['og-description']['content'] . '\" id=\"useo-og-description\" class=\"qa-form-tall-text\" cols=\"40\" rows=\"3\" name=\"useo-meta-editor-description\">'. @$this->social_metas['og-description'] .'</textarea>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tShared Page\\'s URL\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['og-url']['content'] . '\" id=\"useo-og-url\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['og-url'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tThumbnail Image\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['og-image']['content'] . '\" id=\"useo-og-image\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['og-image'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t\t<h3>Twitter Cards</h3>\n\t\t\t<table class=\"qa-form-tall-table\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tPage Title\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['tc-title']['content'] . '\" id=\"useo-tc-title\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['tc-title'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tDescription\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<textarea placeholder=\"' . @$this->metas['tc-description']['content'] . '\" id=\"useo-tc-description\" class=\"qa-form-tall-text\" cols=\"40\" rows=\"3\" name=\"useo-meta-editor-description\">'. @$this->social_metas['tc-description'] .'</textarea>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tThumbnail Image\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['tc-image']['content'] . '\" id=\"useo-tc-image\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['tc-image'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tTwitter Handler\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['tc-handler']['content'] . '\" id=\"useo-tc-handler\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['tc-handler'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t\t<h3>Google+ Schemas</h3>\n\t\t\t<table class=\"qa-form-tall-table\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tThumbnail Image\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['gp-image']['content'] . '\" id=\"useo-gp-image\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['gp-image'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td  id=\"useo_buttons_container_social\" class=\"qa-form-tall-buttons\" colspan=\"1\">\n\t\t\t\t\t\t\t<input id=\"useo_save_social\" class=\"qa-form-tall-button qa-form-tall-button-save\" type=\"submit\" title=\"\" value=\"Save Options\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\n\t\t\t</table>\n\t\t\t');\n\t\t\t$this->output('</form>');\n\t\t\t$this->output('<hr /></div>');\n\t\t}\n\t\t\n\t}\n\tfunction post_tag_item($taghtml, $class)\n\t{\n\t\trequire_once QA_INCLUDE_DIR.'qa-util-string.php';\n\t\tglobal\n\t\t\t$useo_tag_desc_list, // Already filled in qa-tag-desc-overrides.php  -  All tags used in this page are listed in this array\n\t\t\t$plugin_tag_map;       // here it will be filled with tag's meta descriptions\n\t\tif (count(@$useo_tag_desc_list)) {\n\t\t\t$result=qa_db_query_sub(\n\t\t\t\t'SELECT tag, title, content FROM ^tagmetas WHERE tag IN ($)',\n\t\t\t\tarray_keys($useo_tag_desc_list)\n\t\t\t);\n\t\t\t\n\t\t\t$useo_tag_desc_map=qa_db_read_all_assoc($result);\n\n\t\t\t$useo_tag_desc_list=null;\n\t\t\t\n\t\t\t$plugin_tag_map=array();\n\t\t\tforeach ($useo_tag_desc_map as &$value) {\n\t\t\t\tif ($value['title']=='title') $plugin_tag_map[$value['tag']]['title'] = $value['content'];\n\t\t\t\tif ($value['title']=='description') $plugin_tag_map[$value['tag']]['description'] = $value['content'];\n\t\t\t\tif ($value['title']=='icon') $plugin_tag_map[$value['tag']]['icon'] = $value['content'];\n\t\t\t}\n\t\t}\n\n\t\t$html = new DOMDocument();\n\t\t$html->loadHTML(mb_convert_encoding($taghtml, 'HTML-ENTITIES', 'UTF-8'));\n\n\t\tforeach($html->getElementsByTagName('a') as $a)\n        {\n\t\t\tif (!empty($plugin_tag_map[$a->nodeValue]['title']))\n\t\t\t\t$a->setAttribute('title', $plugin_tag_map[$a->nodeValue]['title']);\n\t\t\tif (!empty($plugin_tag_map[$a->nodeValue]['icon'])){\n\t\t\t\t$element = $html->createElement('img');\n\t\t\t\t$element->setAttribute('src',$plugin_tag_map[$a->nodeValue]['icon']);\n\t\t\t\t$element->setAttribute('class','qa-tag-img');\n\t\t\t\t$element->setAttribute('width',qa_opt('useo_tag_desc_icon_width'));\n\t\t\t\t$element->setAttribute('height',qa_opt('useo_tag_desc_icon_height'));\n\t\t\t\t $a->insertBefore($element, $a->firstChild);\n\t\t\t}\n\t\t}\n\t\t\n\t\t$taghtml= $html->saveHTML(); \n\t\tqa_html_theme_base::post_tag_item($taghtml, $class);\n\t}\n\t// category link titles\n\tfunction post_meta_where($post, $class)\n\t{\n\t\t//$post['where']['data']\n\t\tif(isset($post['where']['data']) && isset($post['where']['title'])){\n\t\t\t$max_len = (int)qa_opt('useo_cat_desc_max_len');\n\t\t\tif($max_len <= 0)\n\t\t\t\t$max_len = 250;\n\t\t\t$post['where']['data'] = str_replace('<a', '<a title=\"' . substr($post['where']['title'],0,$max_len) . '\" ', $post['where']['data']);\n\t\t}\n\t\tqa_html_theme_base::post_meta_where($post, $class);\n\t}\n\tfunction ranking($ranking)\n\t{\n\t\tif ($this->template=='tags')\n\t\t{\n\t\t\tglobal $useo_tag_desc_list; // Already filled in qa-tag-desc-overrides.php  -  All tags used in this page are listed in this array\n\t\t\t\n\t\t\tif (count(@$useo_tag_desc_list)) {\n\t\t\t\t// Get all tag meta in this query\n\t\t\t\t$result=qa_db_query_sub(\n\t\t\t\t\t'SELECT tag, title, content FROM ^tagmetas WHERE tag IN ($)',\n\t\t\t\t\tarray_keys($useo_tag_desc_list)\n\t\t\t\t);\n\t\t\t\t$useo_tag_desc_map=qa_db_read_all_assoc($result);\n\t\t\t\t$useo_tag_desc_list=null;\n\t\t\t\t$plugin_tag_map=array();\n\t\t\t\tforeach ($useo_tag_desc_map as &$value) {\n\t\t\t\t\tif ($value['title']=='title') $plugin_tag_map[$value['tag']]['title'] = $value['content'];\n\t\t\t\t\tif ($value['title']=='description') $plugin_tag_map[$value['tag']]['description'] = $value['content'];\n\t\t\t\t\tif ($value['title']=='icon') $plugin_tag_map[$value['tag']]['icon'] = $value['content'];\n\t\t\t\t}\n\t\t\t\t// add title and icon to each tag\n\t\t\t\t$html = new DOMDocument();\n\t\t\t\tforeach ($ranking['items'] as &$item) {\n\t\t\t\t\t$html->loadHTML(mb_convert_encoding($item['label'], 'HTML-ENTITIES', 'UTF-8'));\n\t\t\t\t\tforeach($html->getElementsByTagName('a') as $a)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!empty($plugin_tag_map[$a->nodeValue]['title']))\n\t\t\t\t\t\t\t$a->setAttribute('title', $plugin_tag_map[$a->nodeValue]['title']);\n\t\t\t\t\t\tif (!empty($plugin_tag_map[$a->nodeValue]['icon'])){\n\t\t\t\t\t\t\t$element = $html->createElement('img');\n\t\t\t\t\t\t\t$element->setAttribute('src',$plugin_tag_map[$a->nodeValue]['icon']);\n\t\t\t\t\t\t\t$element->setAttribute('class','qa-tag-img');\n\t\t\t\t\t\t\t$element->setAttribute('width',qa_opt('useo_tag_desc_icon_width'));\n\t\t\t\t\t\t\t$element->setAttribute('height',qa_opt('useo_tag_desc_icon_height'));\n\t\t\t\t\t\t\t$a->insertBefore($element, $a->firstChild);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$item['label']= $html->saveHTML(); \t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tqa_html_theme_base::ranking($ranking);\n\t}\n}\n\n"], "fixing_code": ["<?php\n\nclass qa_html_theme_layer extends qa_html_theme_base {\n\tvar $meta_title;\n\tvar $meta_description;\n\tvar $meta_keywords;\n\tvar $metas = array();\n\tvar $social_metas = array();\n\tfunction doctype(){\n\t\tqa_html_theme_base::doctype();\n\t\trequire_once QA_INCLUDE_DIR.'qa-db-metas.php';\n\t\t// Custom Meta(title,description,keywords)\n\t\tif( ($this->template=='question') and (qa_opt('useo_meta_editor_enable')) ){\n\t\t\t$metas = json_decode(qa_db_postmeta_get($this->content['q_view']['raw']['postid'], 'useo-meta-info'),true);\n\t\t\t$this->meta_title = htmlspecialchars(@$metas['title']);\n\t\t\t$this->meta_description = htmlspecialchars(@$metas['description']);\n\t\t\t$this->meta_keywords = htmlspecialchars(@$metas['keywords']);\n\t\t}\n\t\t// Generate Social Meta Tags\n\t\t$page_url = @$this->content['canonical'];\n\t\tif(! empty($this->meta_description))\n\t\t\t$description = htmlspecialchars($this->meta_description);\n\t\telse\n\t\t\t$description = htmlspecialchars(@$this->content['description']);\n\t\tif(! empty($this->meta_title))\n\t\t\t$title = htmlspecialchars($this->meta_title);\n\t\telse\n\t\t\t$title = htmlspecialchars(@$this->content['q_view']['raw']['title']);\n\t\t\n\t\tif($this->template=='question'){\n\t\t\tif(qa_opt('useo_social_enable_editor')){\n\t\t\t\t$this->social_metas = json_decode(qa_db_postmeta_get($this->content['q_view']['raw']['postid'], 'useo-social-info'),true);\n\t\t\t\tif(count($this->social_metas))\n\t\t\t\t\tforeach ($this->social_metas as $index => $variable){\n\t\t\t\t\t\t$this->metas[$index]['content'] = htmlspecialchars($variable);\n\t\t\t\t\t\t$this->metas[$index]['type'] = '';\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tif(qa_opt('useo_social_og_enable_auto')){ // Open Graph\n\t\t\t\t// site name\n\t\t\t\t$this->metas['og-sitename']['content'] = @$this->content['site_title'];\n\t\t\t\t$this->metas['og-sitename']['type'] = 'property=\"og:site_name\"';\n\t\t\t\t// title\n\t\t\t\t$this->metas['og-title']['content'] = $title;\n\t\t\t\t$this->metas['og-title']['type'] = 'property=\"og:title\"';\n\t\t\t\t// description\n\t\t\t\t$gl_length = qa_opt('useo_social_og_desc_length');\n\t\t\t\tif($gl_length<=0)\n\t\t\t\t\t\t$gl_length = 140;\n\t\t\t\t$this->metas['og-description']['content'] = useo_get_excerpt($description, 0, $gl_length);\n\t\t\t\t$this->metas['og-description']['type'] = 'property=\"og:description\"';\n\t\t\t\t// Type\n\t\t\t\t$this->metas['og-type']['content'] = 'website';\n\t\t\t\t$this->metas['og-type']['type'] = 'property=\"og:type\"';\n\t\t\t\t// url\n\t\t\t\tif(! empty($page_url)){\n\t\t\t\t\t$this->metas['og-url']['content'] = $page_url;\n\t\t\t\t\t$this->metas['og-url']['type'] = 'property=\"og:url\"';\n\t\t\t\t}\n\t\t\t\t// image\n\t\t\t\t$og_image = qa_opt('useo_social_og_image');\n\t\t\t\tif(! empty($og_image)){\n\t\t\t\t\t$this->metas['og-image']['content'] = $og_image;\n\t\t\t\t\t$this->metas['og-image']['type'] = 'property=\"og:image\"';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(qa_opt('useo_social_tc_enable')){ // Twitter Cards\n\t\t\t\t// type\n\t\t\t\t$this->metas['tc-type']['content'] = 'summary';\n\t\t\t\t$this->metas['tc-type']['type'] = 'property=\"twitter:card\"';\n\t\t\t\t// title\n\t\t\t\t$this->metas['tc-title']['content'] = $title;\n\t\t\t\t$this->metas['tc-title']['type'] = 'property=\"twitter:title\"';\n\t\t\t\t// description\n\t\t\t\t$useo_social_tc_desc_length = qa_opt('useo_social_og_desc_length');\n\t\t\t\tif($useo_social_tc_desc_length<=0)\n\t\t\t\t\t$useo_social_tc_desc_length = 120;\n\t\t\t\t$this->metas['tc-description']['content'] = useo_get_excerpt($description, 0, $useo_social_tc_desc_length);\n\t\t\t\t$this->metas['tc-description']['type'] = 'property=\"twitter:description\"';\n\t\t\t\t// image\n\t\t\t\t$tc_image = qa_opt('useo_social_tc_image');\n\t\t\t\tif(! empty($tc_image)){\n\t\t\t\t\t$this->metas['tc-image']['content'] = $tc_image;\n\t\t\t\t\t$this->metas['tc-image']['type'] = 'property=\"twitter:image\"';\n\t\t\t\t}\n\t\t\t\t// handler\n\t\t\t\t// twitter handler goes into \"site\" field of meta tag\n\t\t\t\t$tc_handler = qa_opt('useo_social_tc_handler');\n\t\t\t\tif(! empty($tc_handler)){\n\t\t\t\t\t$this->metas['tc-handler']['content'] = $tc_handler;\n\t\t\t\t\t$this->metas['tc-handler']['type'] = 'property=\"twitter:site\"';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(qa_opt('useo_social_schema_enable')){ // Twitter Cards\n\t\t\t\t// title\n\t\t\t\t$this->metas['gp-title']['content'] = $title;\n\t\t\t\t$this->metas['gp-title']['type'] = 'itemprop=\"name\"';\n\t\t\t\t// description\n\t\t\t\t$this->metas['gp-title']['content'] = $description;\n\t\t\t\t$this->metas['gp-title']['type'] = 'itemprop=\"description\"';\n\t\t\t\t// type\n\t\t\t\t$gp_type = qa_opt('useo_social_schema_page_type');\n\t\t\t\tif($gp_type==2)\n\t\t\t\t\t$gp_page_type = 'Question';\n\t\t\t\telseif($gp_type==3)\n\t\t\t\t\t$gp_page_type = 'Article';\n\t\t\t\tif( isset($gp_page_type) ){ \n\t\t\t\t\t$this->metas['gp-title']['content'] = '';\n\t\t\t\t\t$this->metas['gp-title']['type'] = 'itemscope itemtype=\"http://schema.org/' . $gp_page_type . '\"';\n\t\t\t\t}\n\t\t\t\t// description\n\t\t\t\t$gp_image = qa_opt('useo_social_gp_thumbnail');\n\t\t\t\tif(! empty($gp_image)){\n\t\t\t\t\t$this->metas['gp-image']['content'] = $gp_image;\n\t\t\t\t\t$this->metas['gp-image']['type'] = 'itemprop=\"image\"';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// category link titles\n\t\t$useo_cat_desc_map = array();\n\t\t$categoryid_list = array();\n\t\t//prepare category navigation ids\n\t\tif(isset($this->content['navigation']['cat']) && qa_opt('useo_cat_title_nav_enable')){\n\t\t\t$category_nav = $this->content['navigation']['cat'];\n\t\t\tunset($category_nav['all']);\n\t\t\tforeach ($category_nav as $index => $item){\n\t\t\t\t$categoryid_list[$item['categoryid']] = $item['categoryid'];\n\t\t\t}\n\t\t}\n\t\t// prepare question list ids\n\t\tif(isset($this->content[\"q_list\"][\"qs\"]) && qa_opt('useo_cat_title_qlist_enable')){\n\t\t\tforeach ($this->content[\"q_list\"][\"qs\"] as $index => $item){\n\t\t\t\tif($item['raw']['categoryid'])\n\t\t\t\t\t$categoryid_list[$item['raw']['categoryid']] = $item['raw']['categoryid'];\n\t\t\t}\n\t\t}\n\t\t// get all category titles\n\t\tif(count($categoryid_list)){\n\t\t\t$result=qa_db_query_sub(\n\t\t\t\t'SELECT categoryid, content FROM ^categorymetas WHERE categoryid IN ($) AND title=$',\n\t\t\t\t$categoryid_list,'useo_cat_title'\n\t\t\t);\n\t\t\t$useo_cat_desc_map = qa_db_read_all_assoc($result,'categoryid');\n\t\t\tif(isset($this->content[\"q_list\"][\"qs\"]))\n\t\t\t\tforeach ($this->content[\"q_list\"][\"qs\"] as $index => $item){\n\t\t\t\t\tif(isset($item['raw']['categoryid']) && isset($useo_cat_desc_map[$item['raw']['categoryid']]))\n\t\t\t\t\t\t$this->content[\"q_list\"][\"qs\"][$index]['where']['title'] = $useo_cat_desc_map[$item['raw']['categoryid']]['content'];\n\t\t\t\t}\n\t\t}\n\t\t// set category title for navigation\n\t\tif(count(@$this->content['navigation']['cat']) && qa_opt('useo_cat_title_nav_enable')){\n\t\t\tforeach ($this->content['navigation']['cat'] as $index => $item){\n\t\t\t\tif(isset($item['categoryid']) && isset($useo_cat_desc_map[$item['categoryid']]))\n\t\t\t\t\t$this->content['navigation']['cat'][$index][\"popup\"] = $useo_cat_desc_map[$item['categoryid']]['content'];\n\t\t\t}\n\t\t}\n\t\t// Administrator panel navigation item\n\t\tif ($this->request == 'admin/ulitmate_seo') {\n\t\t\tif(empty($this->content['navigation']['sub']))\n\t\t\t\t$this->content['navigation']['sub']=array();\n\t\t\trequire_once QA_INCLUDE_DIR.'qa-app-admin.php';\n\t\t\t$admin_nav = qa_admin_sub_navigation();\n\t\t\t$this->content['navigation']['sub'] = array_merge(\n\t\t\t\t$admin_nav,\n\t\t\t\t$this->content['navigation']['sub']\n\t\t\t);\n\t\t}\n\t\tif ( ($this->template=='admin') or ($this->request == 'ulitmate_seo') ){\n\t\t\t$this->content['navigation']['sub']['ulitmate_seo'] = array(\n\t\t\t\t'label' => 'Ultimate SEO',\n\t\t\t\t'url' => qa_path_html('admin/ulitmate_seo'),\n\t\t\t);\n\t\t\tif ($this->request == 'admin/ulitmate_seo'){\n\t\t\t\t$this->content['navigation']['sub']['ulitmate_seo']['selected'] = true;\n\t\t\t}\n\t\t}\n\t}\n\t// add canonical links to category pages\n\tfunction head_metas()\n\t{\n\t\tqa_html_theme_base::head_metas();\n\t\tif(qa_opt('useo_cat_canonical_enable')){\n\t\t\t$cat_slugs = useo_get_current_category_slug();\n\t\t\tif($cat_slugs){ // it's a category page\n\t\t\t\t$path = qa_path_absolute(implode('/', $cat_slugs));\n\t\t\t\t$this->output('<link rel=\"canonical\" href=\"' . $path . '\">');\n\t\t\t}\n\t\t}\n\t}\n\tfunction head_script()\n\t{\n\t\tqa_html_theme_base::head_script();\n\t\tif ( ($this->template=='question') and (qa_get_logged_in_level() >= QA_USER_LEVEL_ADMIN) ){\n\t\t\t$variables = '';\n\t\t\t$variables .= 'useo_ajax_url = \"' . USEO_URL . '/ajax.php\";';\n\t\t\t$variables .= 'useo_postid = ' . $this->content['q_view']['raw']['postid'] .';';\n\t\t\t$this->output('<script>' . $variables . '</script>');\n\t\t\t$this->output('<script src=\"'.USEO_URL.'/include/seo-forms.js\" type=\"text/javascript\"></script>');\n\t\t}\n\t}\t\n\n\tfunction head_title()\n\t{\n\n\t// Title Customization Options\n\t\t$title = '';\n\t\tswitch ($this->template) {\n\t\t\tcase 'qa':\n\t\t\t\t$title_template = qa_opt('useo_title_qa');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'question':\n\t\t\t\t$category_name = '';\n\t\t\t\tif ( (isset($this->content[\"categoryids\"])) && (!(empty($this->content[\"categoryids\"]))))\n\t\t\t\t\t\t$category_name = $this->content[\"q_view\"][\"raw\"][\"categoryname\"];\n\n\t\t\t\tif(empty($this->meta_title)){\n\t\t\t\t\t// title customization\n\t\t\t\t\t$title_template = qa_opt('useo_title_qa_item');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%question-title%', '%category-name%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), htmlspecialchars(@$this->content['q_view']['raw']['title']), $category_name);\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\t// meta editor\n\t\t\t\t\t$title = $this->meta_title;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'questions':\n\t\t\t\t$category_name = '';\n\t\t\t\tif( count(explode('/',$this->request)) > 1 )\n\t\t\t\t\t$category_name = $this->content[\"q_list\"][\"qs\"][0][\"raw\"][\"categoryname\"];\n\t\t\t\t$sort = qa_get('sort');\n\t\t\t\tif(empty($sort)){\n\t\t\t\t\t$title_template = qa_opt('useo_title_recent');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%recent-qs-title%', '%category-name%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/recent_qs_title'), $category_name);\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='hot'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_hot');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%hot-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/hot_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='votes'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_voted');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%voted-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/voted_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='answers'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_answered');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%answered-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/answered_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='views'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_viewed');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%viewed-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/viewed_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\tcase 'unanswered':\n\t\t\t\t$sort = qa_get('by');\n\t\t\t\t$category_name = '';\n\t\t\t\tif( count(explode('/',$this->request)) > 1 )\n\t\t\t\t\t$category_name = $this->content[\"q_list\"][\"qs\"][0][\"raw\"][\"categoryname\"];\n\n\t\t\t\tif(empty($sort)){\n\t\t\t\t\t$title_template = qa_opt('useo_title_unanswered');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%unanswered-qs-title%', '%category-name%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/unanswered_qs_title'), $category_name);\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='selected'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_unselected');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%unselected-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/unselected_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}elseif($sort=='upvotes'){\n\t\t\t\t\t$title_template = qa_opt('useo_title_unupvoted');\n\t\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t\t$search = array( '%site-title%', '%unupvoteda-qs-title%');\n\t\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/unupvoteda_qs_title'));\n\t\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'activity':\n\t\t\t\t$title_template = qa_opt('useo_title_activity');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$category_name = '';\n\t\t\t\t\tif( count(explode('/',$this->request)) > 1 )\n\t\t\t\t\t\t$category_name = $this->content[\"q_list\"][\"qs\"][0][\"raw\"][\"categoryname\"];\n\n\t\t\t\t\t$search = array( '%site-title%', '%recent-activity-title%', '%category-name%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/recent_activity_title'), $category_name);\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'ask':\n\t\t\t\t$title_template = qa_opt('useo_title_ask');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%', '%ask-title%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('question/ask_title'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'categories':\n\t\t\t\t$title_template = qa_opt('useo_title_categories');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%', '%browse-categories%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('misc/browse_categories'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'tags':\n\t\t\t\t$title_template = qa_opt('useo_title_tags');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%', '%popular-tags%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/popular_tags'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'tag':\n\t\t\t\t$title_template = qa_opt('useo_title_tag');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$req = explode('/',$this->request);\n\t\t\t\t\t$tag = $req[1];\n\t\t\t\t\t$search = array( '%site-title%', '%questions-tagged-x%', '%current-tag%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html_sub('main/questions_tagged_x', qa_html($tag)), $tag );\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'search':\n\t\t\t\t$title_template = qa_opt('useo_title_search');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$term = qa_get('q');\n\t\t\t\t\t$search = array( '%site-title%', '%results-for-x%', '%current-term%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html_sub('main/results_for_x', qa_html($term)), $term );\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'users':\n\t\t\t\t$title_template = qa_opt('useo_title_users');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$search = array( '%site-title%', '%highest-users%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html('main/highest_users'));\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'user':\n\t\t\t\t$title_template = qa_opt('useo_title_user');\n\t\t\t\tif(! empty($title_template) ){\n\t\t\t\t\t$req = explode('/',$this->request);\n\t\t\t\t\t$user = $req[1];\n\t\t\t\t\t$search = array( '%site-title%', '%user-x%', '%current-user%');\n\t\t\t\t\t$replace   = array(qa_opt('site_title'), qa_lang_html_sub('main/results_for_x', qa_html($user)), $user );\n\t\t\t\t\t$title = str_replace($search, $replace, $title_template);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\n\t\t}\n\n\t\tif(empty($title))\n\t\t\tqa_html_theme_base::head_title();\n\t\telse\n\t\t\t$this->output('<title>'.$title.'</title>');\n\t\t\n\t// Page Meta Tags\n\t\t$noindex = qa_opt('useo_access_noindex');\n\t\t$nofollow = qa_opt('useo_access_nofollow');\n\t\tif($noindex and $nofollow)\n\t\t\t$this->output('<meta name=\"robots\" content=\"noindex, nofollow\" />');\n\t\telseif($noindex)\n\t\t\t$this->output('<meta name=\"robots\" content=\"noindex\" />');\n\t\telse{\n\t\t\t// if page is not already noindex, check if it needs to be noindex. also add nofollow if necessary\n\t\t\t$status = 1; // content is long enough\n\t\t\tif( ($this->template=='question') and (qa_opt('useo_access_length_enable')) and ( (int)qa_opt('useo_access_length')>0 ) ){\n\t\t\t\t$status = 0;\n\t\t\t\t$minimum_words = (int)qa_opt('useo_access_length');\n\t\t\t\t$word_count = str_word_count($this->content['q_view']['raw']['title']) + str_word_count($this->content['q_view']['raw']['content']);\n\t\t\t\tif($word_count >= $minimum_words)\n\t\t\t\t\t$status = 1;\n\t\t\t\telse{\n\t\t\t\t\tforeach($this->content['q_view']['c_list']['cs'] as $comment)\n\t\t\t\t\t\t$word_count += str_word_count($comment['raw']['content']);\n\t\t\t\t\tif($word_count >= $minimum_words)\n\t\t\t\t\t\t$status = 1;\n\t\t\t\t\telse{\n\t\t\t\t\t\tforeach($this->content['a_list']['as'] as $answer)\n\t\t\t\t\t\t\t$word_count += str_word_count($answer['raw']['content']);\n\t\t\t\t\t\tif($word_count >= $minimum_words)\n\t\t\t\t\t\t\t$status = 1;\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tforeach($this->content['a_list']['as'] as $answer)\n\t\t\t\t\t\t\t\tforeach($answer['c_list']['cs'] as $comment)\n\t\t\t\t\t\t\t\t\t$word_count += str_word_count($comment['raw']['content']);\n\t\t\t\t\t\t\tif($word_count >= $minimum_words)\n\t\t\t\t\t\t\t\t$status = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif( ($nofollow) && ($status==1) )\n\t\t\t\t$this->output('<meta name=\"robots\" content=\"nofollow\" />');\n\t\t\telseif( ($nofollow) && ($status==0) )\n\t\t\t\t$this->output('<meta name=\"robots\" content=\"noindex, nofollow\" />');\n\t\t\telseif($status==0)\n\t\t\t\t$this->output('<meta name=\"robots\" content=\"noindex\" />');\n\t\t}\n\t// Question Meta tags\n\t\tif($this->template=='question'){\n\t\t\t// setup custom meta keyword\n\t\t\tif (! empty($this->meta_keywords))\n\t\t\t\t$this->content['keywords'] = htmlspecialchars($this->meta_keywords);\n\t\t\t// setup custom meta description\n\t\t\tif (! empty($this->meta_description))\n\t\t\t\t$this->content['description'] = htmlspecialchars($this->meta_description);\n\t\t\t// if there was no custom meta description and it's supposed to read it from answers do it, otherwise don't change it\n\t\t\telseif(qa_opt('useo_meta_desc_ans_enable')){\n\t\t\t\t$lenght = (int)qa_opt('useo_meta_desc_length');\n\t\t\t\tif($lenght<=0)\n\t\t\t\t\t$lenght = 160;\n\t\t\t\t$text = '';\n\t\t\t\tif( ($this->content['q_view']['raw']['acount'] > 0) and (qa_opt('useo_meta_desc_ans_enable')) ){\n\t\t\t\t\t// get Selected Answer's content\n\t\t\t\t\tif( (isset($this->content[\"q_view\"][\"raw\"][\"selchildid\"])) and (qa_opt('useo_meta_desc_sel_ans_enable')) ){\n\t\t\t\t\t\tforeach($this->content['a_list']['as'] as $answer)\n\t\t\t\t\t\t\tif($answer['raw']['isselected'])\n\t\t\t\t\t\t\t\t$text = $answer['raw']['content'];\n\t\t\t\t\t}else{\n\t\t\t\t\t// get most voted Answer's content\n\t\t\t\t\t\t$max_vote = 0; // don't use answers with negative votes.\n\t\t\t\t\t\tforeach($this->content['a_list']['as'] as $answer){\n\t\t\t\t\t\t\tif($answer['raw']['netvotes'] > $max_vote){\n\t\t\t\t\t\t\t\t$text = $answer['raw']['content'];\n\t\t\t\t\t\t\t\t$max_vote = $answer['raw']['netvotes'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!(empty($text))){\n\t\t\t\t\tglobal $qa_sanitize_html_newwindow;\n\t\t\t\t\t$excerpt = useo_get_excerpt(qa_sanitize_html($text, $qa_sanitize_html_newwindow), 0, $lenght);\n\t\t\t\t\t$this->content['description'] = $excerpt;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Meta Tags and social meta tags\n\t\t\tif($this->template=='question'){\n\t\t\t\tif(qa_opt('useo_social_enable_editor')){\n\t\t\t\t\tforeach($this->metas as $key => $value)\n\t\t\t\t\t\tif( isset($this->social_metas[$key]) )\n\t\t\t\t\t\t\t$this->output('<meta ' . $value['type'] . ' content=\"' . $this->social_metas[$key] . '\" />' );\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t$this->output('<meta ' . $value['type'] . ( $value['content'] ? ' content=\"' . $value['content'] . '\"' : '') . ' /> ' );\n\t\t\t\t\n\t\t\t\t}elseif(qa_opt('useo_social_og_enable_auto')){\n\t\t\t\t\tforeach($this->metas as $key => $value)\n\t\t\t\t\t\t$this->output('<meta ' . $value['type'] . ( $value['content'] ? ' content=\"' . $value['content'] . '\"' : '') . ' /> ' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction main_parts($content)\n\t{\n\t\tqa_html_theme_base::main_parts($content);\n\n\t\tif( (qa_get_logged_in_level() >= QA_USER_LEVEL_ADMIN) and ($this->template=='question') and (qa_opt('useo_meta_editor_enable')) ){\n\t\t\t\n\t\t\t$this->output('<div class=\"qa-widgets-main qa-widgets-main-low\">');\n\t\t\t$this->output('<form name=\"useo-meta-editor\" action=\"'.qa_self_html().'\" method=\"post\">');\n\t\t\t$this->output('\n\t\t\t<h2> Page Title And Meta Tags </h2>\n\t\t\t<strong>Only administrators can see this section.</strong>\n\t\t\t<table class=\"qa-form-tall-table\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tPage Title\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . htmlspecialchars($this->content['q_view']['raw']['title']) . '\" id=\"useo-meta-editor-title\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. $this->meta_title .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tDescription Meta Tag\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<textarea placeholder=\"' . htmlspecialchars($this->content['description']) . '\" id=\"useo-meta-editor-description\" class=\"qa-form-tall-text\" cols=\"40\" rows=\"3\" name=\"useo-meta-editor-description\">'. $this->meta_description .'</textarea>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody id=\"useo-meta-keywords\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tKeywords Meta Tag\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . $this->content['keywords'] . '\" id=\"useo-meta-editor-keywords\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. $this->meta_keywords .'\" name=\"useo-meta-editor-keywords\">\n\t\t\t\t\t\t\t<div class=\"qa-form-tall-note\">A comma separated list of your most important keywords</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td  id=\"useo_buttons_container_meta\" class=\"qa-form-tall-buttons\" colspan=\"1\">\n\t\t\t\t\t\t\t<input id=\"useo_save_meta\" class=\"qa-form-tall-button qa-form-tall-button-save\" type=\"submit\" title=\"\" value=\"Save Options\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t\t');\n\t\t\t$this->output('</form>');\n\t\t\t$this->output('<hr /></div>');\n\t\t}\n\t\tif( (qa_get_logged_in_level() >= QA_USER_LEVEL_ADMIN) and ($this->template=='question') and (qa_opt('useo_social_enable_editor')) ){\n\t\t\t\n\t\t\t$this->output('<div class=\"qa-widgets-main qa-widgets-main-low\">');\n\t\t\t$this->output('<form name=\"useo-meta-editor\" action=\"'.qa_self_html().'\" method=\"post\">');\n\t\t\t$this->output('\n\t\t\t<h2> Social Tags Editor </h2>\n\t\t\t<p>Only administrators can see this section.</p>\n\t\t\t<h3>Open Graph</h3>\n\t\t\t<table class=\"qa-form-tall-table\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tSite Title\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['og-sitename']['content'] . '\" id=\"useo-og-sitename\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['og-sitename'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tPage Title\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['og-title']['content'] . '\" id=\"useo-og-title\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['og-title'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tDescription Meta Tag\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<textarea placeholder=\"' . @$this->metas['og-description']['content'] . '\" id=\"useo-og-description\" class=\"qa-form-tall-text\" cols=\"40\" rows=\"3\" name=\"useo-meta-editor-description\">'. @$this->social_metas['og-description'] .'</textarea>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tShared Page\\'s URL\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['og-url']['content'] . '\" id=\"useo-og-url\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['og-url'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tThumbnail Image\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['og-image']['content'] . '\" id=\"useo-og-image\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['og-image'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t\t<h3>Twitter Cards</h3>\n\t\t\t<table class=\"qa-form-tall-table\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tPage Title\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['tc-title']['content'] . '\" id=\"useo-tc-title\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['tc-title'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tDescription\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<textarea placeholder=\"' . @$this->metas['tc-description']['content'] . '\" id=\"useo-tc-description\" class=\"qa-form-tall-text\" cols=\"40\" rows=\"3\" name=\"useo-meta-editor-description\">'. @$this->social_metas['tc-description'] .'</textarea>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tThumbnail Image\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['tc-image']['content'] . '\" id=\"useo-tc-image\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['tc-image'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tTwitter Handler\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['tc-handler']['content'] . '\" id=\"useo-tc-handler\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['tc-handler'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t\t<h3>Google+ Schemas</h3>\n\t\t\t<table class=\"qa-form-tall-table\">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-label\">\n\t\t\t\t\t\t\tThumbnail Image\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"qa-form-tall-data\">\n\t\t\t\t\t\t\t<input placeholder=\"' . @$this->metas['gp-image']['content'] . '\" id=\"useo-gp-image\" class=\"qa-form-tall-text\" type=\"text\" value=\"'. @$this->social_metas['gp-image'] .'\" name=\"useo-meta-editor-title\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td  id=\"useo_buttons_container_social\" class=\"qa-form-tall-buttons\" colspan=\"1\">\n\t\t\t\t\t\t\t<input id=\"useo_save_social\" class=\"qa-form-tall-button qa-form-tall-button-save\" type=\"submit\" title=\"\" value=\"Save Options\">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\n\t\t\t</table>\n\t\t\t');\n\t\t\t$this->output('</form>');\n\t\t\t$this->output('<hr /></div>');\n\t\t}\n\t\t\n\t}\n\tfunction post_tag_item($taghtml, $class)\n\t{\n\t\trequire_once QA_INCLUDE_DIR.'qa-util-string.php';\n\t\tglobal\n\t\t\t$useo_tag_desc_list, // Already filled in qa-tag-desc-overrides.php  -  All tags used in this page are listed in this array\n\t\t\t$plugin_tag_map;       // here it will be filled with tag's meta descriptions\n\t\tif (count(@$useo_tag_desc_list)) {\n\t\t\t$result=qa_db_query_sub(\n\t\t\t\t'SELECT tag, title, content FROM ^tagmetas WHERE tag IN ($)',\n\t\t\t\tarray_keys($useo_tag_desc_list)\n\t\t\t);\n\t\t\t\n\t\t\t$useo_tag_desc_map=qa_db_read_all_assoc($result);\n\n\t\t\t$useo_tag_desc_list=null;\n\t\t\t\n\t\t\t$plugin_tag_map=array();\n\t\t\tforeach ($useo_tag_desc_map as &$value) {\n\t\t\t\tif ($value['title']=='title') $plugin_tag_map[$value['tag']]['title'] = $value['content'];\n\t\t\t\tif ($value['title']=='description') $plugin_tag_map[$value['tag']]['description'] = $value['content'];\n\t\t\t\tif ($value['title']=='icon') $plugin_tag_map[$value['tag']]['icon'] = $value['content'];\n\t\t\t}\n\t\t}\n\n\t\t$html = new DOMDocument();\n\t\t$html->loadHTML(mb_convert_encoding($taghtml, 'HTML-ENTITIES', 'UTF-8'));\n\n\t\tforeach($html->getElementsByTagName('a') as $a)\n        {\n\t\t\tif (!empty($plugin_tag_map[$a->nodeValue]['title']))\n\t\t\t\t$a->setAttribute('title', $plugin_tag_map[$a->nodeValue]['title']);\n\t\t\tif (!empty($plugin_tag_map[$a->nodeValue]['icon'])){\n\t\t\t\t$element = $html->createElement('img');\n\t\t\t\t$element->setAttribute('src',$plugin_tag_map[$a->nodeValue]['icon']);\n\t\t\t\t$element->setAttribute('class','qa-tag-img');\n\t\t\t\t$element->setAttribute('width',qa_opt('useo_tag_desc_icon_width'));\n\t\t\t\t$element->setAttribute('height',qa_opt('useo_tag_desc_icon_height'));\n\t\t\t\t $a->insertBefore($element, $a->firstChild);\n\t\t\t}\n\t\t}\n\t\t\n\t\t$taghtml= $html->saveHTML(); \n\t\tqa_html_theme_base::post_tag_item($taghtml, $class);\n\t}\n\t// category link titles\n\tfunction post_meta_where($post, $class)\n\t{\n\t\t//$post['where']['data']\n\t\tif(isset($post['where']['data']) && isset($post['where']['title'])){\n\t\t\t$max_len = (int)qa_opt('useo_cat_desc_max_len');\n\t\t\tif($max_len <= 0)\n\t\t\t\t$max_len = 250;\n\t\t\t$post['where']['data'] = str_replace('<a', '<a title=\"' . substr($post['where']['title'],0,$max_len) . '\" ', $post['where']['data']);\n\t\t}\n\t\tqa_html_theme_base::post_meta_where($post, $class);\n\t}\n\tfunction ranking($ranking)\n\t{\n\t\tif ($this->template=='tags')\n\t\t{\n\t\t\tglobal $useo_tag_desc_list; // Already filled in qa-tag-desc-overrides.php  -  All tags used in this page are listed in this array\n\t\t\t\n\t\t\tif (count(@$useo_tag_desc_list)) {\n\t\t\t\t// Get all tag meta in this query\n\t\t\t\t$result=qa_db_query_sub(\n\t\t\t\t\t'SELECT tag, title, content FROM ^tagmetas WHERE tag IN ($)',\n\t\t\t\t\tarray_keys($useo_tag_desc_list)\n\t\t\t\t);\n\t\t\t\t$useo_tag_desc_map=qa_db_read_all_assoc($result);\n\t\t\t\t$useo_tag_desc_list=null;\n\t\t\t\t$plugin_tag_map=array();\n\t\t\t\tforeach ($useo_tag_desc_map as &$value) {\n\t\t\t\t\tif ($value['title']=='title') $plugin_tag_map[$value['tag']]['title'] = $value['content'];\n\t\t\t\t\tif ($value['title']=='description') $plugin_tag_map[$value['tag']]['description'] = $value['content'];\n\t\t\t\t\tif ($value['title']=='icon') $plugin_tag_map[$value['tag']]['icon'] = $value['content'];\n\t\t\t\t}\n\t\t\t\t// add title and icon to each tag\n\t\t\t\t$html = new DOMDocument();\n\t\t\t\tforeach ($ranking['items'] as &$item) {\n\t\t\t\t\t$html->loadHTML(mb_convert_encoding($item['label'], 'HTML-ENTITIES', 'UTF-8'));\n\t\t\t\t\tforeach($html->getElementsByTagName('a') as $a)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!empty($plugin_tag_map[$a->nodeValue]['title']))\n\t\t\t\t\t\t\t$a->setAttribute('title', $plugin_tag_map[$a->nodeValue]['title']);\n\t\t\t\t\t\tif (!empty($plugin_tag_map[$a->nodeValue]['icon'])){\n\t\t\t\t\t\t\t$element = $html->createElement('img');\n\t\t\t\t\t\t\t$element->setAttribute('src',$plugin_tag_map[$a->nodeValue]['icon']);\n\t\t\t\t\t\t\t$element->setAttribute('class','qa-tag-img');\n\t\t\t\t\t\t\t$element->setAttribute('width',qa_opt('useo_tag_desc_icon_width'));\n\t\t\t\t\t\t\t$element->setAttribute('height',qa_opt('useo_tag_desc_icon_height'));\n\t\t\t\t\t\t\t$a->insertBefore($element, $a->firstChild);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t$item['label']= $html->saveHTML(); \t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tqa_html_theme_base::ranking($ranking);\n\t}\n}\n\n"], "filenames": ["q2a-ultimate-seo/layer.php"], "buggy_code_start_loc": [15], "buggy_code_end_loc": [516], "fixing_code_start_loc": [15], "fixing_code_end_loc": [516], "type": "CWE-79", "message": "Question2Answer Q2A Ultimate SEO Version 1.3 is affected by cross-site scripting (XSS), which may lead to arbitrary remote code execution.", "other": {"cve": {"id": "CVE-2021-3258", "sourceIdentifier": "cve@mitre.org", "published": "2021-02-05T16:15:12.757", "lastModified": "2021-02-10T23:59:16.853", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Question2Answer Q2A Ultimate SEO Version 1.3 is affected by cross-site scripting (XSS), which may lead to arbitrary remote code execution."}, {"lang": "es", "value": "Question2Answer Q2A Ultimate SEO Version 1.3, est\u00e1 afectada por una vulnerabilidad de tipo cross-site scripting (XSS), que puede conllevar a una ejecuci\u00f3n de c\u00f3digo remota arbitraria"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:qa-themes:q2a_ultimate_seo:1.3:*:*:*:*:question2answer:*:*", "matchCriteriaId": "59B8670C-DA96-4018-9001-78929478BC1F"}]}]}], "references": [{"url": "https://github.com/q2a-projects/Q2A-Ultimate-SEO/commit/20069f28147c6f2c3acca4e3f6f5154537c5d536", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://nirmaldahal.com.np/sxss-to-defacement-and-account-takeover/", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://www.question2answer.org/qa/58520/important-q2a-ultimate-seo-important-update", "source": "cve@mitre.org", "tags": ["Release Notes", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/q2a-projects/Q2A-Ultimate-SEO/commit/20069f28147c6f2c3acca4e3f6f5154537c5d536"}}