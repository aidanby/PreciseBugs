{"buggy_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\tThe Original Code is FusionPBX\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\trequire_once \"resources/paging.php\";\n\n//check permissions\n\tif (permission_exists('email_log_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get posted data\n\tif (is_array($_POST['emails'])) {\n\t\t$action = $_POST['action'];\n\t\t$search = $_POST['search'];\n\t\t$emails = $_POST['emails'];\n\t}\n\n//process the http post data by action\n\tif ($action != '' && is_array($emails) && @sizeof($emails) != 0) {\n\t\tswitch ($action) {\n\t\t\tcase 'download':\n\t\t\t\tif (permission_exists('email_log_download')) {\n\t\t\t\t\t$obj = new email_logs;\n\t\t\t\t\t$obj->download($emails);\n\t\t\t\t\tmessage::add($text['message-download_failed'],'negative',7000); //download failed, set message\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'resend':\n\t\t\t\tif (permission_exists('email_log_resend')) {\n\t\t\t\t\t$obj = new email_logs;\n\t\t\t\t\t$obj->resend($emails);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'delete':\n\t\t\t\tif (permission_exists('email_log_delete')) {\n\t\t\t\t\t$obj = new email_logs;\n\t\t\t\t\t$obj->delete($emails);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\theader('Location: email_logs.php'.($search != '' ? '?search='.urlencode($search) : null));\n\t\texit;\n\t}\n\n//get order and order by and sanatize the values\n\t$order_by = $_GET[\"order_by\"];\n\t$order = $_GET[\"order\"];\n\n//add the search term\n\t$search = strtolower($_GET[\"search\"]);\n\n//prepare to page the results\n\t$sql = \"select count(*) from v_email_logs \";\n\tif ($_REQUEST['show'] == 'all' && permission_exists('email_log_all')) {\n\t\t$sql .= \"where true \";\n\t}\n\telse {\n\t\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t\t$parameters['domain_uuid'] = $domain_uuid;\n\t}\n\tif (strlen($search) > 0) {\n\t\t$sql = \"and (\";\n\t\t$sql .= \"lower(type) like :search \";\n\t\t$sql .= \"or lower(email) like :search \";\n\t\t$sql .= \") \";\n\t\t$parameters['search'] = '%'.$search.'%';\n\t}\n\t$database = new database;\n\t$num_rows = $database->select($sql, $parameters, 'column');\n\n//prepare to page the results\n\t$rows_per_page = ($_SESSION['domain']['paging']['numeric'] != '') ? $_SESSION['domain']['paging']['numeric'] : 50;\n\t$param = \"search=\".$search;\n\tif ($_GET['show'] == \"all\" && permission_exists('email_log_all')) {\n\t\t$param .= \"&show=all\";\n\t}\n\t$page = $_GET['page'];\n\tif (strlen($page) == 0) { $page = 0; $_GET['page'] = 0; }\n\tlist($paging_controls, $rows_per_page) = paging($num_rows, $param, $rows_per_page);\n\tlist($paging_controls_mini, $rows_per_page) = paging($num_rows, $param, $rows_per_page, true);\n\t$offset = $rows_per_page * $page;\n\n//get the list\n\t$sql = \"select * from v_email_logs \";\n\tif ($_REQUEST['show'] == 'all' && permission_exists('email_log_all')) {\n\t\t$sql .= \"where true \";\n\t}\n\telse {\n\t\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t\t$parameters['domain_uuid'] = $domain_uuid;\n\t}\n\tif (strlen($search) > 0) {\n\t\t$sql = \"and (\";\n\t\t$sql .= \"lower(type) like :search \";\n\t\t$sql .= \"or lower(email) like :search \";\n\t\t$sql .= \") \";\n\t\t$parameters['search'] = '%'.$search.'%';\n\t}\n\t$sql .= order_by($order_by, $order, 'sent_date', 'desc');\n\t$sql .= limit_offset($rows_per_page, $offset);\n\t$database = new database;\n\t$result = $database->select($sql, $parameters, 'all');\n\tunset($sql, $parameters);\n\n//get call details\n\tif (is_array($result) && @sizeof($result) != 0) {\n\t\tforeach ($result as $row) {\n\t\t\t$sql = \"select caller_id_name, caller_id_number, destination_number \";\n\t\t\t$sql .= \"from v_xml_cdr \";\n\t\t\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t\t\t$sql .= \"and uuid = :uuid \";\n\t\t\t$parameters['domain_uuid'] = $domain_uuid;\n\t\t\t$parameters['uuid'] = $row['call_uuid'];\n\t\t\t$database = new database;\n\t\t\t$result2 = $database->select($sql, $parameters, 'all');\n\t\t\tif (is_array($result2) && @sizeof($result2) != 0) {\n\t\t\t\tforeach($result2 as $row2) {\n\t\t\t\t\t$call[$row['call_uuid']]['caller_id_name'] = $row2['caller_id_name'];\n\t\t\t\t\t$call[$row['call_uuid']]['caller_id_number'] = $row2['caller_id_number'];\n\t\t\t\t\t$call[$row['call_uuid']]['destination_number'] = $row2['destination_number'];\n\t\t\t\t}\n\t\t\t}\n\t\t\tunset($sql, $parameters, $result2, $row2);\n\t\t}\n\t}\n\n//create token\n\t$object = new token;\n\t$token = $object->create('/app/email_logs/email_logs.php');\n\n//include the header\n\t$document['title'] = $text['title-emails'];\n\trequire_once \"resources/header.php\";\n\n//test result layer\n\techo \"<style>\\n\";\n\techo \"\t#test_result_layer {\\n\";\n\techo \"\t\tz-index: 999999;\\n\";\n\techo \"\t\tposition: absolute;\\n\";\n\techo \"\t\tleft: 0px;\\n\";\n\techo \"\t\ttop: 0px;\\n\";\n\techo \"\t\tright: 0px;\\n\";\n\techo \"\t\tbottom: 0px;\\n\";\n\techo \"\t\ttext-align: center;\\n\";\n\techo \"\t\tvertical-align: middle;\\n\";\n\techo \"\t\t}\\n\";\n\techo \"\t#test_result_container {\\n\";\n\techo \"\t\tdisplay: block;\\n\";\n\techo \"\t\toverflow: auto;\\n\";\n\techo \"\t\tbackground-color: #fff;\\n\";\n\techo \"\t\tpadding: 20px 30px;\\n\";\n\tif (http_user_agent('mobile')) {\n\t\techo \"\tmargin: 0;\\n\";\n\t}\n\telse {\n\t\techo \"\tmargin: auto 10%;\\n\";\n\t}\n\techo \"\t\ttext-align: left;\\n\";\n\techo \"\t\t-webkit-box-shadow: 0px 1px 20px #888;\\n\";\n\techo \"\t\t-moz-box-shadow: 0px 1px 20px #888;\\n\";\n\techo \"\t\tbox-shadow: 0px 1px 20px #888;\\n\";\n\techo \"\t\t}\\n\";\n\techo \"</style>\\n\";\n\n\techo \"<div id='test_result_layer' style='display: none;'>\\n\";\n\techo \"\t<table cellpadding='0' cellspacing='0' border='0' width='100%' height='100%'>\\n\";\n\techo \"\t\t<tr>\\n\";\n\techo \"\t\t\t<td align='center' valign='middle'>\\n\";\n\techo \"\t\t\t\t<span id='test_result_container'></span>\\n\";\n\techo \"\t\t\t</td>\\n\";\n\techo \"\t\t</tr>\\n\";\n\techo \"\t</table>\\n\";\n\techo \"</div>\\n\";\n\n//show the content\n\techo \"<div class='action_bar' id='action_bar'>\\n\";\n\techo \"\t<div class='heading'><b>\".$text['header-emails'].\" (\".$num_rows.\")</b></div>\\n\";\n\techo \"\t<div class='actions'>\\n\";\n\techo \t\t\"<form id='form_test' class='inline' method='post' action='email_test.php' target='_blank'>\\n\";\n\techo button::create(['label'=>$text['button-test'],'icon'=>'tools','type'=>'button','id'=>'test_button','style'=>'margin-right: 15px;','onclick'=>\"$(this).fadeOut(400, function(){ $('span#form_test').fadeIn(400); $('#to').trigger('focus'); });\"]);\n\techo \"\t\t<span id='form_test' style='display: none;'>\\n\";\n\techo \"\t\t\t<input type='text' class='txt' style='width: 150px;' name='to' id='to' placeholder='recipient@domain.com'>\";\n\techo button::create(['label'=>$text['button-send'],'icon'=>'envelope','type'=>'submit','id'=>'send_button','style'=>'margin-right: 15px;']);\n\techo \"\t\t</span>\\n\";\n\techo \"\t\t<input type='hidden' name='\".$token['name'].\"' value='\".$token['hash'].\"'>\\n\";\n\techo \"\t\t</form>\";\n\tif (permission_exists('email_log_resend') && $result) {\n\t\techo button::create(['type'=>'button','label'=>$text['button-resend'],'icon'=>'paper-plane','onclick'=>\"modal_open('modal-resend','btn_resend');\"]);\n\t}\n\tif (permission_exists('email_log_download') && $result) {\n\t\techo button::create(['type'=>'button','label'=>$text['button-download'],'icon'=>$_SESSION['theme']['button_icon_download'],'onclick'=>\"list_action_set('download'); list_form_submit('form_list');\"]);\n\t}\n\tif (permission_exists('email_log_delete') && $result) {\n\t\techo button::create(['type'=>'button','label'=>$text['button-delete'],'icon'=>$_SESSION['theme']['button_icon_delete'],'name'=>'btn_delete','onclick'=>\"modal_open('modal-delete','btn_delete');\"]);\n\t}\n\techo \t\t\"<form id='form_search' class='inline' method='get'>\\n\";\n\tif (permission_exists('email_log_all')) {\n\t\tif ($_GET['show'] == 'all') {\n\t\t\techo \"\t\t<input type='hidden' name='show' value='all'>\";\n\t\t}\n\t\telse {\n\t\t\techo button::create(['type'=>'button','label'=>$text['button-show_all'],'icon'=>$_SESSION['theme']['button_icon_all'],'link'=>'?show=all']);\n\t\t}\n\t}\n\techo button::create(['label'=>$text['button-refresh'],'icon'=>$_SESSION['theme']['button_icon_refresh'],'type'=>'button','onclick'=>'document.location.reload();']);\n\techo \t\t\"<input type='text' class='txt list-search' name='search' id='search' value=\\\"\".escape($search).\"\\\" placeholder=\\\"\".$text['label-search'].\"\\\" onkeydown=''>\";\n\techo button::create(['label'=>$text['button-search'],'icon'=>$_SESSION['theme']['button_icon_search'],'type'=>'submit','id'=>'btn_search']);\n\t//echo button::create(['label'=>$text['button-reset'],'icon'=>$_SESSION['theme']['button_icon_reset'],'type'=>'button','id'=>'btn_reset','link'=>'email_logs.php','style'=>($search == '' ? 'display: none;' : null)]);\n\tif ($paging_controls_mini != '') {\n\t\techo \t\"<span style='margin-left: 15px;'>\".$paging_controls_mini.\"</span>\";\n\t}\n\techo \"\t\t</form>\\n\";\n\techo \"\t</div>\\n\";\n\techo \"\t<div style='clear: both;'></div>\\n\";\n\techo \"</div>\\n\";\n\n\tif (permission_exists('email_log_resend') && $result) {\n\t\techo modal::create(['id'=>'modal-resend','type'=>'general','message'=>$text['confirm-resend'],'actions'=>button::create(['type'=>'button','label'=>$text['button-continue'],'icon'=>'check','id'=>'btn_resend','style'=>'float: right; margin-left: 15px;','collapse'=>'never','onclick'=>\"modal_close(); list_action_set('resend'); list_form_submit('form_list');\"])]);\n\t}\n\tif (permission_exists('email_log_delete') && $result) {\n\t\techo modal::create(['id'=>'modal-delete','type'=>'delete','actions'=>button::create(['type'=>'button','label'=>$text['button-continue'],'icon'=>'check','id'=>'btn_delete','style'=>'float: right; margin-left: 15px;','collapse'=>'never','onclick'=>\"modal_close(); list_action_set('delete'); list_form_submit('form_list');\"])]);\n\t}\n\n\techo $text['description-emails'].\"\\n\";\n\techo \"<br /><br />\\n\";\n\n\t/*\n\techo \"<form id='test_form' method='post' action='email_test.php' target='_blank'>\\n\";\n\techo \"<table width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' align='left' valign='top' nowrap='nowrap'>\";\n\techo \"\t\t\t<b>\".$text['header-emails'].\"</b>\";\n\techo \"\t\t\t<br /><br />\";\n\techo \"\t\t\t\".$text['description-emails'];\n\techo \"\t\t</td>\\n\";\n\techo \"\t\t<td width='50%' align='right' valign='top'>\\n\";\n\techo \"\t\t\t<input type='button' class='btn' id='test_button' alt=\\\"\".$text['button-test'].\"\\\" onclick=\\\"$(this).fadeOut(400, function(){ $('span#test_form').fadeIn(400); $('#to').trigger('focus'); });\\\" value='\".$text['button-test'].\"'>\\n\";\n\techo \"\t\t\t<span id='test_form' style='display: none;'>\\n\";\n\techo \"\t\t\t\t<input type='text' class='formfld' style='min-width: 150px; width:150px; max-width: 150px;' name='to' id='to' placeholder='recipient@domain.com'>\\n\";\n\techo \"\t\t\t\t<input type='submit' class='btn' id='send_button' alt=\\\"\".$text['button-send'].\"\\\" value='\".$text['button-send'].\"'>\\n\";\n\techo \"\t\t\t</span>\\n\";\n\tif (permission_exists('email_log_all')) {\n\t\tif ($_REQUEST['showall'] != 'true') {\n\t\t\techo \"\t\t<input type='button' class='btn' value='\".$text['button-show_all'].\"' onclick=\\\"window.location='email_logs.php?showall=true';\\\">\\n\";\n\t\t}\n\t}\n\techo \"\t\t\t<input type='button' class='btn' alt=\\\"\".$text['button-refresh'].\"\\\" onclick=\\\"document.location.reload();\\\" value='\".$text['button-refresh'].\"'>\\n\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\techo \"<input type='hidden' name='\".$token['name'].\"' value='\".$token['hash'].\"'>\\n\";\n\techo \"</form>\\n\";\n\techo \"<br />\\n\";\n\t*/\n\n\techo \"<form id='form_list' method='post'>\\n\";\n\techo \"<input type='hidden' id='action' name='action' value=''>\\n\";\n\techo \"<input type='hidden' name='search' value=\\\"\".escape($search).\"\\\">\\n\";\n\n\techo \"<table class='list'>\\n\";\n\techo \"<tr class='list-header'>\\n\";\n\tif (permission_exists('email_log_download') || permission_exists('email_log_resend') || permission_exists('email_log_delete')) {\n\t\techo \"\t<th class='checkbox'>\\n\";\n\t\techo \"\t\t<input type='checkbox' id='checkbox_all' name='checkbox_all' onclick='list_all_toggle();' \".($result ?: \"style='visibility: hidden;'\").\">\\n\";\n\t\techo \"\t</th>\\n\";\n\t}\n\tif ($_GET['show'] == \"all\" && permission_exists('email_log_all')) {\n\t\techo th_order_by('domain_name', $text['label-domain'], $order_by, $order, null, null, $param);\n\t}\n\techo th_order_by('sent_date', $text['label-sent'], $order_by, $order, null, null, $param);\n\techo th_order_by('type', $text['label-type'], $order_by, $order, null, null, $param);\n\techo th_order_by('status', $text['label-status'], $order_by, $order, null, null, $param);\n\techo \"<th class='center'>\".$text['label-actions'].\"</th>\\n\";\n\techo \"<th class='hide-sm-dn'>\".$text['label-reference'].\"</th>\\n\";\n\tif ($_SESSION['theme']['list_row_edit_button']['boolean'] == 'true') {\n\t\techo \"\t<td class='action-button'>&nbsp;</td>\\n\";\n\t}\n\techo \"</tr>\\n\";\n\n\tif (is_array($result) && @sizeof($result) != 0) {\n\t\t$x = 0;\n\t\tforeach($result as $row) {\n\t\t\t$list_row_url = \"email_log_view.php?id=\".urlencode($row['email_log_uuid']);\n\t\t\techo \"<tr class='list-row' href='\".$list_row_url.\"'>\\n\";\n\t\t\tif (permission_exists('email_log_download') || permission_exists('email_log_resend') || permission_exists('email_log_delete')) {\n\t\t\t\techo \"\t<td class='checkbox'>\\n\";\n\t\t\t\techo \"\t\t<input type='checkbox' name='emails[$x][checked]' id='checkbox_\".$x.\"' value='true' onclick=\\\"if (!this.checked) { document.getElementById('checkbox_all').checked = false; }\\\">\\n\";\n\t\t\t\techo \"\t\t<input type='hidden' name='emails[$x][uuid]' value='\".escape($row['email_log_uuid']).\"' />\\n\";\n\t\t\t\techo \"\t</td>\\n\";\n\t\t\t}\n\t\t\tif ($_GET['show'] == \"all\" && permission_exists('email_log_all')) {\n\t\t\t\techo \"\t<td>\".escape($_SESSION['domains'][$row['domain_uuid']]['domain_name']).\"</td>\\n\";\n\t\t\t}\n\t\t\t$sent_date = explode('.', $row['sent_date']);\n\t\t\techo \"\t<td><a href='\".$list_row_url.\"' title=\\\"\".$text['label-message_view'].\"\\\">\".$sent_date[0].\"</td>\\n\";\n\t\t\techo \"\t<td>\".$text['label-type_'.escape($row['type'])].\"</td>\\n\";\n\t\t\techo \"\t<td>\".$text['label-status_'.escape($row['status'])].\"</td>\\n\";\n\t\t\techo \"\t<td class='middle button center no-link no-wrap'>\";\n\t\t\tif (permission_exists('email_log_resend')) {\n\t\t\t\techo button::create(['type'=>'button','title'=>$text['button-resend'],'icon'=>'paper-plane','onclick'=>\"list_self_check('checkbox_\".$x.\"'); list_action_set('resend'); list_form_submit('form_list')\"]);\n\t\t\t}\n\t\t\tif (permission_exists('email_log_download')) {\n\t\t\t\techo button::create(['type'=>'button','title'=>$text['button-download'],'icon'=>$_SESSION['theme']['button_icon_download'],'onclick'=>\"list_self_check('checkbox_\".$x.\"'); list_action_set('download'); list_form_submit('form_list')\"]);\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"\t<td class='description overflow hide-sm-dn no-link'>\";\n\t\t\techo button::create(['type'=>'button','class'=>'link','label'=>$text['label-reference_cdr'],'link'=>PROJECT_PATH.'/app/xml_cdr/xml_cdr_details.php?id='.urlencode($row['call_uuid'])]);\n\t\t\techo \"\t\t\".($call[$row['call_uuid']]['caller_id_name'] != '' ? \"&nbsp;&nbsp;\".$call[$row['call_uuid']]['caller_id_name'].(is_numeric($call[$row['call_uuid']]['caller_id_number']) ? ' ('.format_phone($call[$row['call_uuid']]['caller_id_number']).')' : null) : $call[$row['call_uuid']]['caller_id_number']);\n\t\t\tif ($call[$row['call_uuid']]['destination_number']) {\n\t\t\t\techo \t\"&nbsp;&nbsp;<span style='font-size: 150%; line-height: 10px;'>&#8674;</span>&nbsp;&nbsp;\".$call[$row['call_uuid']]['destination_number'];\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\tif ($_SESSION['theme']['list_row_edit_button']['boolean'] == 'true') {\n\t\t\t\techo \"\t<td class='action-button'>\";\n\t\t\t\techo button::create(['type'=>'button','title'=>$text['label-message_view'],'icon'=>$_SESSION['theme']['button_icon_view'],'link'=>$list_row_url]);\n\t\t\t\techo \"\t</td>\\n\";\n\t\t\t}\n\t\t\techo \"</tr>\\n\";\n\t\t\t$x++;\n\n\t\t}\n\t\tunset($result);\n\t}\n\n\techo \"</table>\\n\";\n\techo \"<br />\\n\";\n\techo \"<div align='center'>\".$paging_controls.\"</div>\\n\";\n\n\techo \"<input type='hidden' name='\".$token['name'].\"' value='\".$token['hash'].\"'>\\n\";\n\n\techo \"</form>\\n\";\n\n//test script\n\techo \"<script>\\n\";\n\techo \"\t$('#form_test').submit(function(event) {\\n\";\n\techo \"\t\tevent.preventDefault();\\n\";\n\techo \"\t\t$.ajax({\\n\";\n\techo \"\t\t\turl: $(this).attr('action'),\\n\";\n\techo \"\t\t\ttype: $(this).attr('method'),\\n\";\n\techo \"\t\t\tdata: new FormData(this),\\n\";\n\techo \"\t\t\tprocessData: false,\\n\";\n\techo \"\t\t\tcontentType: false,\\n\";\n\techo \"\t\t\tcache: false,\\n\";\n\techo \"\t\t\tsuccess: function(response){\\n\";\n\techo \"\t\t\t\t$('#test_result_container').html(response);\\n\";\n\techo \"\t\t\t\t$('#test_result_layer').fadeIn(400);\\n\";\n\techo \"\t\t\t\t$('span#form_test').fadeOut(400, function(){\\n\";\n\techo \"\t\t\t\t\t$('#test_button').fadeIn(400);\\n\";\n\techo \"\t\t\t\t\t$('#to').val('');\\n\";\n\techo \"\t\t\t\t});\\n\";\n\techo \"\t\t\t}\\n\";\n\techo \"\t\t});\\n\";\n\techo \"\t});\\n\";\n\techo \"</script>\\n\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n", "<?php\n/*\n FusionPBX\n Version: MPL 1.1\n\n The contents of this file are subject to the Mozilla Public License Version\n 1.1 (the \"License\"); you may not use this file except in compliance with\n the License. You may obtain a copy of the License at\n http://www.mozilla.org/MPL/\n\n Software distributed under the License is distributed on an \"AS IS\" basis,\n WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n for the specific language governing rights and limitations under the\n License.\n\n The Original Code is FusionPBX\n\n The Initial Developer of the Original Code is\n Mark J Crane <markjcrane@fusionpbx.com>\n Portions created by the Initial Developer are Copyright (C) 2008-2019\n the Initial Developer. All Rights Reserved.\n\n Contributor(s):\n Mark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//define the email logs class\nif (!class_exists('email_logs')) {\n\tclass email_logs {\n\n\t\t/**\n\t\t * declare private parameters\n\t\t */\n\t\tprivate $app_name;\n\t\tprivate $app_uuid;\n\t\tprivate $permission_prefix;\n\t\tprivate $list_page;\n\t\tprivate $table;\n\t\tprivate $uuid_prefix;\n\n\t\t/**\n\t\t * called when the object is created\n\t\t */\n\t\tpublic function __construct() {\n\n\t\t\t//assign private parameters\n\t\t\t\t$this->app_name = 'email_logs';\n\t\t\t\t$this->app_uuid = 'bd64f590-9a24-468d-951f-6639ac728694';\n\t\t\t\t$this->permission_prefix = 'email_log_';\n\t\t\t\t$this->list_page = 'email_logs.php';\n\t\t\t\t$this->table = 'email_logs';\n\t\t\t\t$this->uuid_prefix = 'email_log_';\n\n\t\t}\n\n\t\t/**\n\t\t * called when there are no references to a particular object\n\t\t * unset the variables used in the class\n\t\t */\n\t\tpublic function __destruct() {\n\t\t\tforeach ($this as $key => $value) {\n\t\t\t\tunset($this->$key);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * delete records\n\t\t */\n\t\tpublic function delete($records) {\n\t\t\tif (permission_exists($this->permission_prefix.'delete')) {\n\n\t\t\t\t//add multi-lingual support\n\t\t\t\t\t$language = new text;\n\t\t\t\t\t$text = $language->get();\n\n\t\t\t\t//validate the token\n\t\t\t\t\t$token = new token;\n\t\t\t\t\tif (!$token->validate('/app/email_logs/email_logs.php')) {\n\t\t\t\t\t\tmessage::add($text['message-invalid_token'],'negative');\n\t\t\t\t\t\theader('Location: '.$this->list_page);\n\t\t\t\t\t\texit;\n\t\t\t\t\t}\n\n\t\t\t\t//delete multiple records\n\t\t\t\t\tif (is_array($records) && @sizeof($records) != 0) {\n\n\t\t\t\t\t\t//build the delete array\n\t\t\t\t\t\t\tforeach ($records as $x => $record) {\n\t\t\t\t\t\t\t\tif ($record['checked'] == 'true' && is_uuid($record['uuid'])) {\n\t\t\t\t\t\t\t\t\t$array[$this->table][$x][$this->uuid_prefix.'uuid'] = $record['uuid'];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//delete the checked rows\n\t\t\t\t\t\t\tif (is_array($array) && @sizeof($array) != 0) {\n\n\t\t\t\t\t\t\t\t//execute delete\n\t\t\t\t\t\t\t\t\t$database = new database;\n\t\t\t\t\t\t\t\t\t$database->app_name = $this->app_name;\n\t\t\t\t\t\t\t\t\t$database->app_uuid = $this->app_uuid;\n\t\t\t\t\t\t\t\t\t$database->delete($array);\n\t\t\t\t\t\t\t\t\tunset($array);\n\n\t\t\t\t\t\t\t\t//set message\n\t\t\t\t\t\t\t\t\tmessage::add($text['message-delete']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tunset($records);\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * resend records\n\t\t */\n\t\tpublic function resend($records) {\n\t\t\tif (permission_exists($this->permission_prefix.'resend')) {\n\n\t\t\t\t//add multi-lingual support\n\t\t\t\t\t$language = new text;\n\t\t\t\t\t$text = $language->get();\n\n\t\t\t\t//validate the token\n\t\t\t\t\t$token = new token;\n\t\t\t\t\tif (!$token->validate('/app/email_logs/email_logs.php')) {\n\t\t\t\t\t\tmessage::add($text['message-invalid_token'],'negative');\n\t\t\t\t\t\theader('Location: '.$this->list_page);\n\t\t\t\t\t\texit;\n\t\t\t\t\t}\n\n\t\t\t\t//resend multiple records (eventually)\n\t\t\t\t\tif (is_array($records) && @sizeof($records) != 0) {\n\n\t\t\t\t\t\t//retrieve checked records\n\t\t\t\t\t\t\tforeach($records as $x => $record) {\n\t\t\t\t\t\t\t\tif ($record['checked'] == 'true' && is_uuid($record['uuid'])) {\n\t\t\t\t\t\t\t\t\t$uuids[] = $record['uuid'];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//resend emails\n\t\t\t\t\t\t\tif (is_array($uuids) && @sizeof($uuids) != 0) {\n\t\t\t\t\t\t\t\t$x = 0;\n\t\t\t\t\t\t\t\tforeach ($uuids as $x => $uuid) {\n\n\t\t\t\t\t\t\t\t\t//get email message\n\t\t\t\t\t\t\t\t\t\t$sql = \"select email from v_email_logs \";\n\t\t\t\t\t\t\t\t\t\t$sql .= \"where email_log_uuid = :email_log_uuid \";\n\t\t\t\t\t\t\t\t\t\t$parameters['email_log_uuid'] = $uuid;\n\t\t\t\t\t\t\t\t\t\t$database = new database;\n\t\t\t\t\t\t\t\t\t\t$email = $database->select($sql, $parameters, 'column');\n\t\t\t\t\t\t\t\t\t\t$found = $email != '' ? true : false;\n\t\t\t\t\t\t\t\t\t\tunset($sql, $parameters, $row);\n\n\t\t\t\t\t\t\t\t\t//resend email\n\t\t\t\t\t\t\t\t\t\tif ($found) {\n\t\t\t\t\t\t\t\t\t\t\t$msg = $email;\n\t\t\t\t\t\t\t\t\t\t\t$resend = true;\n\t\t\t\t\t\t\t\t\t\t\trequire \"secure/v_mailto.php\";\n\t\t\t\t\t\t\t\t\t\t\tif ($mailer_error == '') {\n\n\t\t\t\t\t\t\t\t\t\t\t\t//build the delete array\n\t\t\t\t\t\t\t\t\t\t\t\t\t$array[$this->table][$x][$this->uuid_prefix.'uuid'] = $uuid;\n\n\t\t\t\t\t\t\t\t\t\t\t\t//grant temporary permissions\n\t\t\t\t\t\t\t\t\t\t\t\t\t$p = new permissions;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$p->add('email_log_delete', 'temp');\n\n\t\t\t\t\t\t\t\t\t\t\t\t//delete the email log\n\t\t\t\t\t\t\t\t\t\t\t\t\t$database = new database;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$database->app_name = $this->app_name;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$database->app_uuid = $this->app_uuid;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$database->delete($array);\n\t\t\t\t\t\t\t\t\t\t\t\t\tunset($array);\n\n\t\t\t\t\t\t\t\t\t\t\t\t//revoke temporary permissions\n\t\t\t\t\t\t\t\t\t\t\t\t\t$p->delete('email_log_delete', 'temp');\n\n\t\t\t\t\t\t\t\t\t\t\t\t//set message\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage::add($text['message-message_resent']);\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse {\n\n\t\t\t\t\t\t\t\t\t\t\t\t//set message\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage::add($text['message-resend_failed'].\": \".$mailer_error, 'negative', 4000);\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t//increment counter\n\t\t\t\t\t\t\t\t\t\t$x++;\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * download records\n\t\t */\n\t\tpublic function download($records) {\n\t\t\tif (permission_exists($this->permission_prefix.'download')) {\n\n\t\t\t\t//add multi-lingual support\n\t\t\t\t\t$language = new text;\n\t\t\t\t\t$text = $language->get();\n\n\t\t\t\t//validate the token\n\t\t\t\t\t$token = new token;\n\t\t\t\t\tif (!$token->validate('/app/email_logs/email_logs.php')) {\n\t\t\t\t\t\tmessage::add($text['message-invalid_token'],'negative');\n\t\t\t\t\t\theader('Location: '.$this->list_page);\n\t\t\t\t\t\texit;\n\t\t\t\t\t}\n\n\t\t\t\t//download multiple records (eventually zip individual emails together)\n\t\t\t\t\tif (is_array($records) && @sizeof($records) != 0) {\n\n\t\t\t\t\t\t//retrieve checked records\n\t\t\t\t\t\t\tforeach($records as $x => $record) {\n\t\t\t\t\t\t\t\tif ($record['checked'] == 'true' && is_uuid($record['uuid'])) {\n\t\t\t\t\t\t\t\t\t$uuids[] = $record['uuid'];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//download emails\n\t\t\t\t\t\t\tif (is_array($uuids) && @sizeof($uuids) != 0) {\n\t\t\t\t\t\t\t\tforeach ($uuids as $x => $uuid) {\n\n\t\t\t\t\t\t\t\t\t//get email details\n\t\t\t\t\t\t\t\t\t\t$sql = \"select call_uuid, sent_date, type, email from v_email_logs \";\n\t\t\t\t\t\t\t\t\t\t$sql .= \"where email_log_uuid = :email_log_uuid \";\n\t\t\t\t\t\t\t\t\t\t$parameters['email_log_uuid'] = $uuid;\n\t\t\t\t\t\t\t\t\t\t$database = new database;\n\t\t\t\t\t\t\t\t\t\t$row = $database->select($sql, $parameters, 'row');\n\t\t\t\t\t\t\t\t\t\tif (is_array($row) && @sizeof($row) != 0 && is_uuid($row['call_uuid'])) {\n\n\t\t\t\t\t\t\t\t\t\t\t//santize filename components\n\t\t\t\t\t\t\t\t\t\t\t\t$sent_date = str_replace('-','', $row['sent_date']);\n\t\t\t\t\t\t\t\t\t\t\t\t$sent_date = str_replace(':','', $sent_date);\n\t\t\t\t\t\t\t\t\t\t\t\t$sent_date = str_replace(' ','_', $sent_date);\n\t\t\t\t\t\t\t\t\t\t\t\t$type = strtolower($row['type']);\n\t\t\t\t\t\t\t\t\t\t\t\t$email_filename = $sent_date.'_'.$type.'_'.$row['call_uuid'].'.eml';\n\n\t\t\t\t\t\t\t\t\t\t\t//single email\n\t\t\t\t\t\t\t\t\t\t\t\tif (@sizeof($uuids) == 1) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t//set headers\n\t\t\t\t\t\t\t\t\t\t\t\t\t\theader(\"Content-Type: message/rfc822\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\theader('Content-Disposition: attachment; filename=\"'.$email_filename.'\"');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\theader(\"Cache-Control: no-cache, must-revalidate\"); // HTTP/1.1\n\t\t\t\t\t\t\t\t\t\t\t\t\t\theader(\"Expires: Sat, 26 Jul 1997 05:00:00 GMT\"); // Date in the past\n\t\t\t\t\t\t\t\t\t\t\t\t\t\theader(\"Content-Length: \".strlen($row['email']));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t//output content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\techo $row['email'];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\texit;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t//multiple emails\n\t\t\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (is_dir($_SESSION['server']['temp']['dir'])) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (file_put_contents($_SESSION['server']['temp']['dir'].'/'.$email_filename, $row['email'])) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$email_files[] = $_SESSION['server']['temp']['dir'].'/'.$email_filename;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tunset($sql, $parameters, $row);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t//download compressed file\n\t\t\t\t\t\t\t\tif (@sizeof($email_files) != 0) {\n\n\t\t\t\t\t\t\t\t\t//define compressed file name\n\t\t\t\t\t\t\t\t\t\t$compressed_filename = 'emails_'.date('Ymd_His').'.zip';\n\n\t\t\t\t\t\t\t\t\t//compress email files\n\t\t\t\t\t\t\t\t\t\t$command = 'zip -mj '.$_SESSION['server']['temp']['dir'].'/'.$compressed_filename.' '.implode(' ', $email_files).' 2>&1';\n\t\t\t\t\t\t\t\t\t\texec($command, $response, $restore_errlevel);\n\t\t\t\t\t\t\t\t\t\tunset($command);\n\n\t\t\t\t\t\t\t\t\t//push download\n\t\t\t\t\t\t\t\t\t\tif (file_exists($_SESSION['server']['temp']['dir'].'/'.$compressed_filename)) {\n\n\t\t\t\t\t\t\t\t\t\t\t//open file\n\t\t\t\t\t\t\t\t\t\t\t\tsession_cache_limiter('public');\n\t\t\t\t\t\t\t\t\t\t\t\t$fd = fopen($_SESSION['server']['temp']['dir'].'/'.$compressed_filename, 'rb');\n\n\t\t\t\t\t\t\t\t\t\t\t//set headers\n\t\t\t\t\t\t\t\t\t\t\t\theader(\"Content-Type: application/zip\");\n\t\t\t\t\t\t\t\t\t\t\t\theader('Content-Disposition: attachment; filename=\"'.$compressed_filename.'\"');\n\t\t\t\t\t\t\t\t\t\t\t\theader(\"Cache-Control: no-cache, must-revalidate\"); // HTTP/1.1\n\t\t\t\t\t\t\t\t\t\t\t\theader(\"Expires: Sat, 26 Jul 1997 05:00:00 GMT\"); // Date in the past\n\t\t\t\t\t\t\t\t\t\t\t\theader(\"Content-Length: \".filesize($_SESSION['server']['temp']['dir'].'/'.$compressed_filename));\n\n\t\t\t\t\t\t\t\t\t\t\t//output file content\n\t\t\t\t\t\t\t\t\t\t\t\tob_clean();\n\t\t\t\t\t\t\t\t\t\t\t\tfpassthru($fd);\n\t\t\t\t\t\t\t\t\t\t\t\tfclose($fd);\n\n\t\t\t\t\t\t\t\t\t\t\t//remove compressed file\n\t\t\t\t\t\t\t\t\t\t\t\t@unlink($_SESSION['server']['temp']['dir'].'/'.$compressed_filename);\n\t\t\t\t\t\t\t\t\t\t\t\texit;\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t}\n\n\t\t} //method\n\n\t} //class\n}\n\n?>"], "fixing_code": ["<?php\n/*\n\tFusionPBX\n\tVersion: MPL 1.1\n\tThe contents of this file are subject to the Mozilla Public License Version\n\t1.1 (the \"License\"); you may not use this file except in compliance with\n\tthe License. You may obtain a copy of the License at\n\thttp://www.mozilla.org/MPL/\n\tSoftware distributed under the License is distributed on an \"AS IS\" basis,\n\tWITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n\tfor the specific language governing rights and limitations under the\n\tLicense.\n\tThe Original Code is FusionPBX\n\tThe Initial Developer of the Original Code is\n\tMark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\trequire_once \"resources/check_auth.php\";\n\trequire_once \"resources/paging.php\";\n\n//check permissions\n\tif (permission_exists('email_log_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get posted data\n\tif (is_array($_POST['emails'])) {\n\t\t$action = $_POST['action'];\n\t\t$search = $_POST['search'];\n\t\t$emails = $_POST['emails'];\n\t}\n\n//process the http post data by action\n\tif ($action != '' && is_array($emails) && @sizeof($emails) != 0) {\n\t\tswitch ($action) {\n\t\t\tcase 'resend':\n\t\t\t\tif (permission_exists('email_log_resend')) {\n\t\t\t\t\t$obj = new email_logs;\n\t\t\t\t\t$obj->resend($emails);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'delete':\n\t\t\t\tif (permission_exists('email_log_delete')) {\n\t\t\t\t\t$obj = new email_logs;\n\t\t\t\t\t$obj->delete($emails);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\theader('Location: email_logs.php'.($search != '' ? '?search='.urlencode($search) : null));\n\t\texit;\n\t}\n\n//get order and order by and sanatize the values\n\t$order_by = $_GET[\"order_by\"];\n\t$order = $_GET[\"order\"];\n\n//add the search term\n\t$search = strtolower($_GET[\"search\"]);\n\n//prepare to page the results\n\t$sql = \"select count(*) from v_email_logs \";\n\tif ($_REQUEST['show'] == 'all' && permission_exists('email_log_all')) {\n\t\t$sql .= \"where true \";\n\t}\n\telse {\n\t\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t\t$parameters['domain_uuid'] = $domain_uuid;\n\t}\n\tif (strlen($search) > 0) {\n\t\t$sql = \"and (\";\n\t\t$sql .= \"lower(type) like :search \";\n\t\t$sql .= \"or lower(email) like :search \";\n\t\t$sql .= \") \";\n\t\t$parameters['search'] = '%'.$search.'%';\n\t}\n\t$database = new database;\n\t$num_rows = $database->select($sql, $parameters, 'column');\n\n//prepare to page the results\n\t$rows_per_page = ($_SESSION['domain']['paging']['numeric'] != '') ? $_SESSION['domain']['paging']['numeric'] : 50;\n\t$param = \"search=\".$search;\n\tif ($_GET['show'] == \"all\" && permission_exists('email_log_all')) {\n\t\t$param .= \"&show=all\";\n\t}\n\t$page = $_GET['page'];\n\tif (strlen($page) == 0) { $page = 0; $_GET['page'] = 0; }\n\tlist($paging_controls, $rows_per_page) = paging($num_rows, $param, $rows_per_page);\n\tlist($paging_controls_mini, $rows_per_page) = paging($num_rows, $param, $rows_per_page, true);\n\t$offset = $rows_per_page * $page;\n\n//get the list\n\t$sql = \"select * from v_email_logs \";\n\tif ($_REQUEST['show'] == 'all' && permission_exists('email_log_all')) {\n\t\t$sql .= \"where true \";\n\t}\n\telse {\n\t\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t\t$parameters['domain_uuid'] = $domain_uuid;\n\t}\n\tif (strlen($search) > 0) {\n\t\t$sql = \"and (\";\n\t\t$sql .= \"lower(type) like :search \";\n\t\t$sql .= \"or lower(email) like :search \";\n\t\t$sql .= \") \";\n\t\t$parameters['search'] = '%'.$search.'%';\n\t}\n\t$sql .= order_by($order_by, $order, 'sent_date', 'desc');\n\t$sql .= limit_offset($rows_per_page, $offset);\n\t$database = new database;\n\t$result = $database->select($sql, $parameters, 'all');\n\tunset($sql, $parameters);\n\n//get call details\n\tif (is_array($result) && @sizeof($result) != 0) {\n\t\tforeach ($result as $row) {\n\t\t\t$sql = \"select caller_id_name, caller_id_number, destination_number \";\n\t\t\t$sql .= \"from v_xml_cdr \";\n\t\t\t$sql .= \"where domain_uuid = :domain_uuid \";\n\t\t\t$sql .= \"and uuid = :uuid \";\n\t\t\t$parameters['domain_uuid'] = $domain_uuid;\n\t\t\t$parameters['uuid'] = $row['call_uuid'];\n\t\t\t$database = new database;\n\t\t\t$result2 = $database->select($sql, $parameters, 'all');\n\t\t\tif (is_array($result2) && @sizeof($result2) != 0) {\n\t\t\t\tforeach($result2 as $row2) {\n\t\t\t\t\t$call[$row['call_uuid']]['caller_id_name'] = $row2['caller_id_name'];\n\t\t\t\t\t$call[$row['call_uuid']]['caller_id_number'] = $row2['caller_id_number'];\n\t\t\t\t\t$call[$row['call_uuid']]['destination_number'] = $row2['destination_number'];\n\t\t\t\t}\n\t\t\t}\n\t\t\tunset($sql, $parameters, $result2, $row2);\n\t\t}\n\t}\n\n//create token\n\t$object = new token;\n\t$token = $object->create('/app/email_logs/email_logs.php');\n\n//include the header\n\t$document['title'] = $text['title-emails'];\n\trequire_once \"resources/header.php\";\n\n//test result layer\n\techo \"<style>\\n\";\n\techo \"\t#test_result_layer {\\n\";\n\techo \"\t\tz-index: 999999;\\n\";\n\techo \"\t\tposition: absolute;\\n\";\n\techo \"\t\tleft: 0px;\\n\";\n\techo \"\t\ttop: 0px;\\n\";\n\techo \"\t\tright: 0px;\\n\";\n\techo \"\t\tbottom: 0px;\\n\";\n\techo \"\t\ttext-align: center;\\n\";\n\techo \"\t\tvertical-align: middle;\\n\";\n\techo \"\t\t}\\n\";\n\techo \"\t#test_result_container {\\n\";\n\techo \"\t\tdisplay: block;\\n\";\n\techo \"\t\toverflow: auto;\\n\";\n\techo \"\t\tbackground-color: #fff;\\n\";\n\techo \"\t\tpadding: 20px 30px;\\n\";\n\tif (http_user_agent('mobile')) {\n\t\techo \"\tmargin: 0;\\n\";\n\t}\n\telse {\n\t\techo \"\tmargin: auto 10%;\\n\";\n\t}\n\techo \"\t\ttext-align: left;\\n\";\n\techo \"\t\t-webkit-box-shadow: 0px 1px 20px #888;\\n\";\n\techo \"\t\t-moz-box-shadow: 0px 1px 20px #888;\\n\";\n\techo \"\t\tbox-shadow: 0px 1px 20px #888;\\n\";\n\techo \"\t\t}\\n\";\n\techo \"</style>\\n\";\n\n\techo \"<div id='test_result_layer' style='display: none;'>\\n\";\n\techo \"\t<table cellpadding='0' cellspacing='0' border='0' width='100%' height='100%'>\\n\";\n\techo \"\t\t<tr>\\n\";\n\techo \"\t\t\t<td align='center' valign='middle'>\\n\";\n\techo \"\t\t\t\t<span id='test_result_container'></span>\\n\";\n\techo \"\t\t\t</td>\\n\";\n\techo \"\t\t</tr>\\n\";\n\techo \"\t</table>\\n\";\n\techo \"</div>\\n\";\n\n//show the content\n\techo \"<div class='action_bar' id='action_bar'>\\n\";\n\techo \"\t<div class='heading'><b>\".$text['header-emails'].\" (\".$num_rows.\")</b></div>\\n\";\n\techo \"\t<div class='actions'>\\n\";\n\techo \t\t\"<form id='form_test' class='inline' method='post' action='email_test.php' target='_blank'>\\n\";\n\techo button::create(['label'=>$text['button-test'],'icon'=>'tools','type'=>'button','id'=>'test_button','style'=>'margin-right: 15px;','onclick'=>\"$(this).fadeOut(400, function(){ $('span#form_test').fadeIn(400); $('#to').trigger('focus'); });\"]);\n\techo \"\t\t<span id='form_test' style='display: none;'>\\n\";\n\techo \"\t\t\t<input type='text' class='txt' style='width: 150px;' name='to' id='to' placeholder='recipient@domain.com'>\";\n\techo button::create(['label'=>$text['button-send'],'icon'=>'envelope','type'=>'submit','id'=>'send_button','style'=>'margin-right: 15px;']);\n\techo \"\t\t</span>\\n\";\n\techo \"\t\t<input type='hidden' name='\".$token['name'].\"' value='\".$token['hash'].\"'>\\n\";\n\techo \"\t\t</form>\";\n\tif (permission_exists('email_log_resend') && $result) {\n\t\techo button::create(['type'=>'button','label'=>$text['button-resend'],'icon'=>'paper-plane','onclick'=>\"modal_open('modal-resend','btn_resend');\"]);\n\t}\n\tif (permission_exists('email_log_delete') && $result) {\n\t\techo button::create(['type'=>'button','label'=>$text['button-delete'],'icon'=>$_SESSION['theme']['button_icon_delete'],'name'=>'btn_delete','onclick'=>\"modal_open('modal-delete','btn_delete');\"]);\n\t}\n\techo \t\t\"<form id='form_search' class='inline' method='get'>\\n\";\n\tif (permission_exists('email_log_all')) {\n\t\tif ($_GET['show'] == 'all') {\n\t\t\techo \"\t\t<input type='hidden' name='show' value='all'>\";\n\t\t}\n\t\telse {\n\t\t\techo button::create(['type'=>'button','label'=>$text['button-show_all'],'icon'=>$_SESSION['theme']['button_icon_all'],'link'=>'?show=all']);\n\t\t}\n\t}\n\techo button::create(['label'=>$text['button-refresh'],'icon'=>$_SESSION['theme']['button_icon_refresh'],'type'=>'button','onclick'=>'document.location.reload();']);\n\techo \t\t\"<input type='text' class='txt list-search' name='search' id='search' value=\\\"\".escape($search).\"\\\" placeholder=\\\"\".$text['label-search'].\"\\\" onkeydown=''>\";\n\techo button::create(['label'=>$text['button-search'],'icon'=>$_SESSION['theme']['button_icon_search'],'type'=>'submit','id'=>'btn_search']);\n\t//echo button::create(['label'=>$text['button-reset'],'icon'=>$_SESSION['theme']['button_icon_reset'],'type'=>'button','id'=>'btn_reset','link'=>'email_logs.php','style'=>($search == '' ? 'display: none;' : null)]);\n\tif ($paging_controls_mini != '') {\n\t\techo \t\"<span style='margin-left: 15px;'>\".$paging_controls_mini.\"</span>\";\n\t}\n\techo \"\t\t</form>\\n\";\n\techo \"\t</div>\\n\";\n\techo \"\t<div style='clear: both;'></div>\\n\";\n\techo \"</div>\\n\";\n\n\tif (permission_exists('email_log_resend') && $result) {\n\t\techo modal::create(['id'=>'modal-resend','type'=>'general','message'=>$text['confirm-resend'],'actions'=>button::create(['type'=>'button','label'=>$text['button-continue'],'icon'=>'check','id'=>'btn_resend','style'=>'float: right; margin-left: 15px;','collapse'=>'never','onclick'=>\"modal_close(); list_action_set('resend'); list_form_submit('form_list');\"])]);\n\t}\n\tif (permission_exists('email_log_delete') && $result) {\n\t\techo modal::create(['id'=>'modal-delete','type'=>'delete','actions'=>button::create(['type'=>'button','label'=>$text['button-continue'],'icon'=>'check','id'=>'btn_delete','style'=>'float: right; margin-left: 15px;','collapse'=>'never','onclick'=>\"modal_close(); list_action_set('delete'); list_form_submit('form_list');\"])]);\n\t}\n\n\techo $text['description-emails'].\"\\n\";\n\techo \"<br /><br />\\n\";\n\n\t/*\n\techo \"<form id='test_form' method='post' action='email_test.php' target='_blank'>\\n\";\n\techo \"<table width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='50%' align='left' valign='top' nowrap='nowrap'>\";\n\techo \"\t\t\t<b>\".$text['header-emails'].\"</b>\";\n\techo \"\t\t\t<br /><br />\";\n\techo \"\t\t\t\".$text['description-emails'];\n\techo \"\t\t</td>\\n\";\n\techo \"\t\t<td width='50%' align='right' valign='top'>\\n\";\n\techo \"\t\t\t<input type='button' class='btn' id='test_button' alt=\\\"\".$text['button-test'].\"\\\" onclick=\\\"$(this).fadeOut(400, function(){ $('span#test_form').fadeIn(400); $('#to').trigger('focus'); });\\\" value='\".$text['button-test'].\"'>\\n\";\n\techo \"\t\t\t<span id='test_form' style='display: none;'>\\n\";\n\techo \"\t\t\t\t<input type='text' class='formfld' style='min-width: 150px; width:150px; max-width: 150px;' name='to' id='to' placeholder='recipient@domain.com'>\\n\";\n\techo \"\t\t\t\t<input type='submit' class='btn' id='send_button' alt=\\\"\".$text['button-send'].\"\\\" value='\".$text['button-send'].\"'>\\n\";\n\techo \"\t\t\t</span>\\n\";\n\tif (permission_exists('email_log_all')) {\n\t\tif ($_REQUEST['showall'] != 'true') {\n\t\t\techo \"\t\t<input type='button' class='btn' value='\".$text['button-show_all'].\"' onclick=\\\"window.location='email_logs.php?showall=true';\\\">\\n\";\n\t\t}\n\t}\n\techo \"\t\t\t<input type='button' class='btn' alt=\\\"\".$text['button-refresh'].\"\\\" onclick=\\\"document.location.reload();\\\" value='\".$text['button-refresh'].\"'>\\n\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\techo \"<input type='hidden' name='\".$token['name'].\"' value='\".$token['hash'].\"'>\\n\";\n\techo \"</form>\\n\";\n\techo \"<br />\\n\";\n\t*/\n\n\techo \"<form id='form_list' method='post'>\\n\";\n\techo \"<input type='hidden' id='action' name='action' value=''>\\n\";\n\techo \"<input type='hidden' name='search' value=\\\"\".escape($search).\"\\\">\\n\";\n\n\techo \"<table class='list'>\\n\";\n\techo \"<tr class='list-header'>\\n\";\n\tif (permission_exists('email_log_resend') || permission_exists('email_log_delete')) {\n\t\techo \"\t<th class='checkbox'>\\n\";\n\t\techo \"\t\t<input type='checkbox' id='checkbox_all' name='checkbox_all' onclick='list_all_toggle();' \".($result ?: \"style='visibility: hidden;'\").\">\\n\";\n\t\techo \"\t</th>\\n\";\n\t}\n\tif ($_GET['show'] == \"all\" && permission_exists('email_log_all')) {\n\t\techo th_order_by('domain_name', $text['label-domain'], $order_by, $order, null, null, $param);\n\t}\n\techo th_order_by('sent_date', $text['label-sent'], $order_by, $order, null, null, $param);\n\techo th_order_by('type', $text['label-type'], $order_by, $order, null, null, $param);\n\techo th_order_by('status', $text['label-status'], $order_by, $order, null, null, $param);\n\techo \"<th class='center'>\".$text['label-actions'].\"</th>\\n\";\n\techo \"<th class='hide-sm-dn'>\".$text['label-reference'].\"</th>\\n\";\n\tif ($_SESSION['theme']['list_row_edit_button']['boolean'] == 'true') {\n\t\techo \"\t<td class='action-button'>&nbsp;</td>\\n\";\n\t}\n\techo \"</tr>\\n\";\n\n\tif (is_array($result) && @sizeof($result) != 0) {\n\t\t$x = 0;\n\t\tforeach($result as $row) {\n\t\t\t$list_row_url = \"email_log_view.php?id=\".urlencode($row['email_log_uuid']);\n\t\t\techo \"<tr class='list-row' href='\".$list_row_url.\"'>\\n\";\n\t\t\tif (permission_exists('email_log_resend') || permission_exists('email_log_delete')) {\n\t\t\t\techo \"\t<td class='checkbox'>\\n\";\n\t\t\t\techo \"\t\t<input type='checkbox' name='emails[$x][checked]' id='checkbox_\".$x.\"' value='true' onclick=\\\"if (!this.checked) { document.getElementById('checkbox_all').checked = false; }\\\">\\n\";\n\t\t\t\techo \"\t\t<input type='hidden' name='emails[$x][uuid]' value='\".escape($row['email_log_uuid']).\"' />\\n\";\n\t\t\t\techo \"\t</td>\\n\";\n\t\t\t}\n\t\t\tif ($_GET['show'] == \"all\" && permission_exists('email_log_all')) {\n\t\t\t\techo \"\t<td>\".escape($_SESSION['domains'][$row['domain_uuid']]['domain_name']).\"</td>\\n\";\n\t\t\t}\n\t\t\t$sent_date = explode('.', $row['sent_date']);\n\t\t\techo \"\t<td><a href='\".$list_row_url.\"' title=\\\"\".$text['label-message_view'].\"\\\">\".$sent_date[0].\"</td>\\n\";\n\t\t\techo \"\t<td>\".$text['label-type_'.escape($row['type'])].\"</td>\\n\";\n\t\t\techo \"\t<td>\".$text['label-status_'.escape($row['status'])].\"</td>\\n\";\n\t\t\techo \"\t<td class='middle button center no-link no-wrap'>\";\n\t\t\tif (permission_exists('email_log_resend')) {\n\t\t\t\techo button::create(['type'=>'button','title'=>$text['button-resend'],'icon'=>'paper-plane','onclick'=>\"list_self_check('checkbox_\".$x.\"'); list_action_set('resend'); list_form_submit('form_list')\"]);\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"\t<td class='description overflow hide-sm-dn no-link'>\";\n\t\t\techo button::create(['type'=>'button','class'=>'link','label'=>$text['label-reference_cdr'],'link'=>PROJECT_PATH.'/app/xml_cdr/xml_cdr_details.php?id='.urlencode($row['call_uuid'])]);\n\t\t\techo \"\t\t\".($call[$row['call_uuid']]['caller_id_name'] != '' ? \"&nbsp;&nbsp;\".$call[$row['call_uuid']]['caller_id_name'].(is_numeric($call[$row['call_uuid']]['caller_id_number']) ? ' ('.format_phone($call[$row['call_uuid']]['caller_id_number']).')' : null) : $call[$row['call_uuid']]['caller_id_number']);\n\t\t\tif ($call[$row['call_uuid']]['destination_number']) {\n\t\t\t\techo \t\"&nbsp;&nbsp;<span style='font-size: 150%; line-height: 10px;'>&#8674;</span>&nbsp;&nbsp;\".$call[$row['call_uuid']]['destination_number'];\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\tif ($_SESSION['theme']['list_row_edit_button']['boolean'] == 'true') {\n\t\t\t\techo \"\t<td class='action-button'>\";\n\t\t\t\techo button::create(['type'=>'button','title'=>$text['label-message_view'],'icon'=>$_SESSION['theme']['button_icon_view'],'link'=>$list_row_url]);\n\t\t\t\techo \"\t</td>\\n\";\n\t\t\t}\n\t\t\techo \"</tr>\\n\";\n\t\t\t$x++;\n\n\t\t}\n\t\tunset($result);\n\t}\n\n\techo \"</table>\\n\";\n\techo \"<br />\\n\";\n\techo \"<div align='center'>\".$paging_controls.\"</div>\\n\";\n\n\techo \"<input type='hidden' name='\".$token['name'].\"' value='\".$token['hash'].\"'>\\n\";\n\n\techo \"</form>\\n\";\n\n//test script\n\techo \"<script>\\n\";\n\techo \"\t$('#form_test').submit(function(event) {\\n\";\n\techo \"\t\tevent.preventDefault();\\n\";\n\techo \"\t\t$.ajax({\\n\";\n\techo \"\t\t\turl: $(this).attr('action'),\\n\";\n\techo \"\t\t\ttype: $(this).attr('method'),\\n\";\n\techo \"\t\t\tdata: new FormData(this),\\n\";\n\techo \"\t\t\tprocessData: false,\\n\";\n\techo \"\t\t\tcontentType: false,\\n\";\n\techo \"\t\t\tcache: false,\\n\";\n\techo \"\t\t\tsuccess: function(response){\\n\";\n\techo \"\t\t\t\t$('#test_result_container').html(response);\\n\";\n\techo \"\t\t\t\t$('#test_result_layer').fadeIn(400);\\n\";\n\techo \"\t\t\t\t$('span#form_test').fadeOut(400, function(){\\n\";\n\techo \"\t\t\t\t\t$('#test_button').fadeIn(400);\\n\";\n\techo \"\t\t\t\t\t$('#to').val('');\\n\";\n\techo \"\t\t\t\t});\\n\";\n\techo \"\t\t\t}\\n\";\n\techo \"\t\t});\\n\";\n\techo \"\t});\\n\";\n\techo \"</script>\\n\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n", "<?php\n/*\n FusionPBX\n Version: MPL 1.1\n\n The contents of this file are subject to the Mozilla Public License Version\n 1.1 (the \"License\"); you may not use this file except in compliance with\n the License. You may obtain a copy of the License at\n http://www.mozilla.org/MPL/\n\n Software distributed under the License is distributed on an \"AS IS\" basis,\n WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\n for the specific language governing rights and limitations under the\n License.\n\n The Original Code is FusionPBX\n\n The Initial Developer of the Original Code is\n Mark J Crane <markjcrane@fusionpbx.com>\n Portions created by the Initial Developer are Copyright (C) 2008-2019\n the Initial Developer. All Rights Reserved.\n\n Contributor(s):\n Mark J Crane <markjcrane@fusionpbx.com>\n*/\n\n//define the email logs class\nif (!class_exists('email_logs')) {\n\tclass email_logs {\n\n\t\t/**\n\t\t * declare private parameters\n\t\t */\n\t\tprivate $app_name;\n\t\tprivate $app_uuid;\n\t\tprivate $permission_prefix;\n\t\tprivate $list_page;\n\t\tprivate $table;\n\t\tprivate $uuid_prefix;\n\n\t\t/**\n\t\t * called when the object is created\n\t\t */\n\t\tpublic function __construct() {\n\n\t\t\t//assign private parameters\n\t\t\t\t$this->app_name = 'email_logs';\n\t\t\t\t$this->app_uuid = 'bd64f590-9a24-468d-951f-6639ac728694';\n\t\t\t\t$this->permission_prefix = 'email_log_';\n\t\t\t\t$this->list_page = 'email_logs.php';\n\t\t\t\t$this->table = 'email_logs';\n\t\t\t\t$this->uuid_prefix = 'email_log_';\n\n\t\t}\n\n\t\t/**\n\t\t * called when there are no references to a particular object\n\t\t * unset the variables used in the class\n\t\t */\n\t\tpublic function __destruct() {\n\t\t\tforeach ($this as $key => $value) {\n\t\t\t\tunset($this->$key);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * delete records\n\t\t */\n\t\tpublic function delete($records) {\n\t\t\tif (permission_exists($this->permission_prefix.'delete')) {\n\n\t\t\t\t//add multi-lingual support\n\t\t\t\t\t$language = new text;\n\t\t\t\t\t$text = $language->get();\n\n\t\t\t\t//validate the token\n\t\t\t\t\t$token = new token;\n\t\t\t\t\tif (!$token->validate('/app/email_logs/email_logs.php')) {\n\t\t\t\t\t\tmessage::add($text['message-invalid_token'],'negative');\n\t\t\t\t\t\theader('Location: '.$this->list_page);\n\t\t\t\t\t\texit;\n\t\t\t\t\t}\n\n\t\t\t\t//delete multiple records\n\t\t\t\t\tif (is_array($records) && @sizeof($records) != 0) {\n\n\t\t\t\t\t\t//build the delete array\n\t\t\t\t\t\t\tforeach ($records as $x => $record) {\n\t\t\t\t\t\t\t\tif ($record['checked'] == 'true' && is_uuid($record['uuid'])) {\n\t\t\t\t\t\t\t\t\t$array[$this->table][$x][$this->uuid_prefix.'uuid'] = $record['uuid'];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//delete the checked rows\n\t\t\t\t\t\t\tif (is_array($array) && @sizeof($array) != 0) {\n\n\t\t\t\t\t\t\t\t//execute delete\n\t\t\t\t\t\t\t\t\t$database = new database;\n\t\t\t\t\t\t\t\t\t$database->app_name = $this->app_name;\n\t\t\t\t\t\t\t\t\t$database->app_uuid = $this->app_uuid;\n\t\t\t\t\t\t\t\t\t$database->delete($array);\n\t\t\t\t\t\t\t\t\tunset($array);\n\n\t\t\t\t\t\t\t\t//set message\n\t\t\t\t\t\t\t\t\tmessage::add($text['message-delete']);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tunset($records);\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * resend records\n\t\t */\n\t\tpublic function resend($records) {\n\t\t\tif (permission_exists($this->permission_prefix.'resend')) {\n\n\t\t\t\t//add multi-lingual support\n\t\t\t\t\t$language = new text;\n\t\t\t\t\t$text = $language->get();\n\n\t\t\t\t//validate the token\n\t\t\t\t\t$token = new token;\n\t\t\t\t\tif (!$token->validate('/app/email_logs/email_logs.php')) {\n\t\t\t\t\t\tmessage::add($text['message-invalid_token'],'negative');\n\t\t\t\t\t\theader('Location: '.$this->list_page);\n\t\t\t\t\t\texit;\n\t\t\t\t\t}\n\n\t\t\t\t//resend multiple records (eventually)\n\t\t\t\t\tif (is_array($records) && @sizeof($records) != 0) {\n\n\t\t\t\t\t\t//retrieve checked records\n\t\t\t\t\t\t\tforeach($records as $x => $record) {\n\t\t\t\t\t\t\t\tif ($record['checked'] == 'true' && is_uuid($record['uuid'])) {\n\t\t\t\t\t\t\t\t\t$uuids[] = $record['uuid'];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//resend emails\n\t\t\t\t\t\t\tif (is_array($uuids) && @sizeof($uuids) != 0) {\n\t\t\t\t\t\t\t\t$x = 0;\n\t\t\t\t\t\t\t\tforeach ($uuids as $x => $uuid) {\n\n\t\t\t\t\t\t\t\t\t//get email message\n\t\t\t\t\t\t\t\t\t\t$sql = \"select email from v_email_logs \";\n\t\t\t\t\t\t\t\t\t\t$sql .= \"where email_log_uuid = :email_log_uuid \";\n\t\t\t\t\t\t\t\t\t\t$parameters['email_log_uuid'] = $uuid;\n\t\t\t\t\t\t\t\t\t\t$database = new database;\n\t\t\t\t\t\t\t\t\t\t$email = $database->select($sql, $parameters, 'column');\n\t\t\t\t\t\t\t\t\t\t$found = $email != '' ? true : false;\n\t\t\t\t\t\t\t\t\t\tunset($sql, $parameters, $row);\n\n\t\t\t\t\t\t\t\t\t//resend email\n\t\t\t\t\t\t\t\t\t\tif ($found) {\n\t\t\t\t\t\t\t\t\t\t\t$msg = $email;\n\t\t\t\t\t\t\t\t\t\t\t$resend = true;\n\t\t\t\t\t\t\t\t\t\t\trequire \"secure/v_mailto.php\";\n\t\t\t\t\t\t\t\t\t\t\tif ($mailer_error == '') {\n\n\t\t\t\t\t\t\t\t\t\t\t\t//build the delete array\n\t\t\t\t\t\t\t\t\t\t\t\t\t$array[$this->table][$x][$this->uuid_prefix.'uuid'] = $uuid;\n\n\t\t\t\t\t\t\t\t\t\t\t\t//grant temporary permissions\n\t\t\t\t\t\t\t\t\t\t\t\t\t$p = new permissions;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$p->add('email_log_delete', 'temp');\n\n\t\t\t\t\t\t\t\t\t\t\t\t//delete the email log\n\t\t\t\t\t\t\t\t\t\t\t\t\t$database = new database;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$database->app_name = $this->app_name;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$database->app_uuid = $this->app_uuid;\n\t\t\t\t\t\t\t\t\t\t\t\t\t$database->delete($array);\n\t\t\t\t\t\t\t\t\t\t\t\t\tunset($array);\n\n\t\t\t\t\t\t\t\t\t\t\t\t//revoke temporary permissions\n\t\t\t\t\t\t\t\t\t\t\t\t\t$p->delete('email_log_delete', 'temp');\n\n\t\t\t\t\t\t\t\t\t\t\t\t//set message\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage::add($text['message-message_resent']);\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse {\n\n\t\t\t\t\t\t\t\t\t\t\t\t//set message\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage::add($text['message-resend_failed'].\": \".$mailer_error, 'negative', 4000);\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t//increment counter\n\t\t\t\t\t\t\t\t\t\t$x++;\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t} //class\n}\n\n?>\n"], "filenames": ["app/email_logs/email_logs.php", "app/email_logs/resources/classes/email_logs.php"], "buggy_code_start_loc": [47, 201], "buggy_code_end_loc": [331, 327], "fixing_code_start_loc": [46, 200], "fixing_code_end_loc": [317, 205], "type": "CWE-77", "message": "Fusionpbx v4.4 and below contains a command injection vulnerability via the download email logs function.", "other": {"cve": {"id": "CVE-2022-28055", "sourceIdentifier": "cve@mitre.org", "published": "2022-05-04T03:15:07.697", "lastModified": "2022-05-11T17:26:33.007", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Fusionpbx v4.4 and below contains a command injection vulnerability via the download email logs function."}, {"lang": "es", "value": "Fusionpbx versiones v4.4 y anteriores, contienen una vulnerabilidad de inyecci\u00f3n de comandos por medio de la funci\u00f3n download email logs"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-77"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.4.0", "matchCriteriaId": "6442ED08-F6D0-4DE6-BEE0-E7D5E22C2F36"}]}]}], "references": [{"url": "https://github.com/fusionpbx/fusionpbx/commit/4e260b170e17705c4c9ccf787be7711b63a40868", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/4e260b170e17705c4c9ccf787be7711b63a40868"}}