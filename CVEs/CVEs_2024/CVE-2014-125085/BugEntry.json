{"buggy_code": ["<?php\nrequire_once(DIR . '/plugins/gimmie/functions.php');\nrequire_once(DIR . '/plugins/gimmie/OAuth.php');\n\n$my_player_uid        = $vbulletin->userinfo['email'];\n\n$key            = $gimmie['gimmie_key']; \n$secret           = $gimmie['gimmie_secret']; \n$access_token         = $my_player_uid;\n$access_token_secret    = $secret;\n$params           = array();\n$sig_method         = new OAuthSignatureMethod_HMAC_SHA1();\n$consumer         = new OAuthConsumer($key, $secret, NULL);\n$token            = new OAuthConsumer($access_token, $access_token_secret);\n$forumarray = array();\n\nif ($vbulletin->options['gimmie_trigger_specificforum'] != \"\")\n{\n  $forumarray = explode(\",\", $vbulletin->options['gimmie_trigger_specificforum']);\n  $forumarray = array_map('trim',$forumarray);\n}\n\nif (in_array($threadinfo[forumid], $forumarray) || $vbulletin->options['gimmie_trigger_specificforum'] == \"\")\n{  \n\n  if ($vbulletin->options['gimmie_enable_global'] == 1 && $vbulletin->options['gimmie_trigger_perthreadrating'] == 1)\n  {\n\n    $endpoint           = \"https://api.gimmieworld.com/1/trigger.json?async=webnotify&source_uid=\".$vbulletin->options['bburl'].\"&event_name=\" . $gimmie['gimmie_trigger_perthreadrating'];\n    $acc_req          = OAuthRequest::from_consumer_and_token($consumer, $token, \"GET\", $endpoint, $params);\n    $acc_req->sign_request($sig_method, $consumer, $token);\n    \n    fetch_web_data($acc_req->to_url());\n  }\n\n  if ($vbulletin->options['gimmie_enable_global'] == 1 && $vbulletin->options['gimmie_trigger_perthreadratingreceived'] == 1)\n  {\n\n    $threadsql  = $vbulletin->db->query_read(\"SELECT * FROM \" . TABLE_PREFIX . \"thread WHERE `threadid` = '\" . $_POST['t'] . \"'\");\n    $thread   = $vbulletin->db->fetch_array($threadsql);\n\n    $usersql  = $vbulletin->db->query_read(\"SELECT `userid`, `username`, `email` FROM \" . TABLE_PREFIX . \"user WHERE `username` = '\" . $thread['postusername'] . \"'\");\n    \n    $user   = $vbulletin->db->fetch_array($usersql);\n\n    $access_token         = $user['email'];\n    $access_token_secret    = $secret;\n    $params           = array();\n    $sig_method         = new OAuthSignatureMethod_HMAC_SHA1();\n    $consumer         = new OAuthConsumer($key, $secret, NULL);\n    $token            = new OAuthConsumer($access_token, $access_token_secret);\n\n\n    $endpoint           = \"https://api.gimmieworld.com/1/trigger.json?async=webnotify&source_uid=\".$vbulletin->options['bburl'].\"&event_name=\" . $gimmie['gimmie_trigger_perthreadratingreceived'];\n    $acc_req          = OAuthRequest::from_consumer_and_token($consumer, $token, \"GET\", $endpoint, $params);\n    $acc_req->sign_request($sig_method, $consumer, $token);\n\n    fetch_web_data($acc_req->to_url());\n    return;\n  \n  }\n}\n\n?>"], "fixing_code": ["<?php\nrequire_once(DIR . '/plugins/gimmie/functions.php');\nrequire_once(DIR . '/plugins/gimmie/OAuth.php');\n\n$my_player_uid        = $vbulletin->userinfo['email'];\n\n$key            = $gimmie['gimmie_key']; \n$secret           = $gimmie['gimmie_secret']; \n$access_token         = $my_player_uid;\n$access_token_secret    = $secret;\n$params           = array();\n$sig_method         = new OAuthSignatureMethod_HMAC_SHA1();\n$consumer         = new OAuthConsumer($key, $secret, NULL);\n$token            = new OAuthConsumer($access_token, $access_token_secret);\n$forumarray = array();\n\nif ($vbulletin->options['gimmie_trigger_specificforum'] != \"\")\n{\n  $forumarray = explode(\",\", $vbulletin->options['gimmie_trigger_specificforum']);\n  $forumarray = array_map('trim',$forumarray);\n}\n\nif (in_array($threadinfo[forumid], $forumarray) || $vbulletin->options['gimmie_trigger_specificforum'] == \"\")\n{  \n\n  if ($vbulletin->options['gimmie_enable_global'] == 1 && $vbulletin->options['gimmie_trigger_perthreadrating'] == 1)\n  {\n\n    $endpoint           = \"https://api.gimmieworld.com/1/trigger.json?async=webnotify&source_uid=\".$vbulletin->options['bburl'].\"&event_name=\" . $gimmie['gimmie_trigger_perthreadrating'];\n    $acc_req          = OAuthRequest::from_consumer_and_token($consumer, $token, \"GET\", $endpoint, $params);\n    $acc_req->sign_request($sig_method, $consumer, $token);\n    \n    fetch_web_data($acc_req->to_url());\n  }\n\n  if ($vbulletin->options['gimmie_enable_global'] == 1 && $vbulletin->options['gimmie_trigger_perthreadratingreceived'] == 1)\n  {\n\n    $threadsql  = $vbulletin->db->query_read(\"SELECT * FROM \" . TABLE_PREFIX . \"thread WHERE `threadid` = \" . $vbulletin->db->escape_string($_POST['t']));\n    $thread   = $vbulletin->db->fetch_array($threadsql);\n\n    $usersql  = $vbulletin->db->query_read(\"SELECT `userid`, `username`, `email` FROM \" . TABLE_PREFIX . \"user WHERE `username` = \" . $vbulletin->db->escape_string($thread['postusername']));\n    \n    $user   = $vbulletin->db->fetch_array($usersql);\n\n    $access_token         = $user['email'];\n    $access_token_secret    = $secret;\n    $params           = array();\n    $sig_method         = new OAuthSignatureMethod_HMAC_SHA1();\n    $consumer         = new OAuthConsumer($key, $secret, NULL);\n    $token            = new OAuthConsumer($access_token, $access_token_secret);\n\n\n    $endpoint           = \"https://api.gimmieworld.com/1/trigger.json?async=webnotify&source_uid=\".$vbulletin->options['bburl'].\"&event_name=\" . $gimmie['gimmie_trigger_perthreadratingreceived'];\n    $acc_req          = OAuthRequest::from_consumer_and_token($consumer, $token, \"GET\", $endpoint, $params);\n    $acc_req->sign_request($sig_method, $consumer, $token);\n\n    fetch_web_data($acc_req->to_url());\n    return;\n  \n  }\n}\n\n?>\n"], "filenames": ["Upload/plugins/gimmie/trigger_ratethread.php"], "buggy_code_start_loc": [39], "buggy_code_end_loc": [65], "fixing_code_start_loc": [39], "fixing_code_end_loc": [65], "type": "CWE-89", "message": "A vulnerability, which was classified as critical, was found in Gimmie Plugin 1.2.2. Affected is an unknown function of the file trigger_ratethread.php. The manipulation of the argument t/postusername leads to sql injection. Upgrading to version 1.3.0 is able to address this issue. The name of the patch is f11a136e9cbd24997354965178728dc22a2aa2ed. It is recommended to upgrade the affected component. VDB-220206 is the identifier assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2014-125085", "sourceIdentifier": "cna@vuldb.com", "published": "2023-02-06T00:15:08.913", "lastModified": "2023-02-12T04:55:52.127", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as critical, was found in Gimmie Plugin 1.2.2. Affected is an unknown function of the file trigger_ratethread.php. The manipulation of the argument t/postusername leads to sql injection. Upgrading to version 1.3.0 is able to address this issue. The name of the patch is f11a136e9cbd24997354965178728dc22a2aa2ed. It is recommended to upgrade the affected component. VDB-220206 is the identifier assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:gimmie_project:gimmie:*:*:*:*:*:vbulletin:*:*", "versionEndExcluding": "1.3.0", "matchCriteriaId": "CF0132D8-24D2-4DD6-A94F-60EDBC76CDDA"}]}]}], "references": [{"url": "https://github.com/gimmie/vbulletin-v4/commit/f11a136e9cbd24997354965178728dc22a2aa2ed", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/gimmie/vbulletin-v4/tree/v1.3.0", "source": "cna@vuldb.com", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.220206", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.220206", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/gimmie/vbulletin-v4/commit/f11a136e9cbd24997354965178728dc22a2aa2ed"}}