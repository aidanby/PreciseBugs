{"buggy_code": ["<?php\n\nuse LibreNMS\\Config;\nuse LibreNMS\\Exceptions\\HostUnreachableException;\nuse LibreNMS\\Util\\IP;\n\n$no_refresh = true;\n\nif (! Auth::user()->hasGlobalAdmin()) {\n    include 'includes/html/error-no-perm.inc.php';\n\n    exit;\n}\n\necho '<div class=\"row\">\n            <div class=\"col-sm-3\">\n            </div>\n            <div class=\"col-sm-6\">';\n\n// first load enabled, after that check snmp variable\n$snmp_enabled = ! isset($_POST['hostname']) || isset($_POST['snmp']);\n\nif (! empty($_POST['hostname'])) {\n    $hostname = strip_tags($_POST['hostname']);\n    if (! \\LibreNMS\\Util\\Validate::hostname($hostname) && ! IP::isValid($hostname)) {\n        print_error(\"Invalid hostname or IP: $hostname\");\n    }\n\n    if (Auth::user()->hasGlobalRead()) {\n        // Settings common to SNMPv2 & v3\n        if ($_POST['port']) {\n            $port = strip_tags($_POST['port']);\n        } else {\n            $port = Config::get('snmp.port');\n        }\n\n        if ($_POST['transport']) {\n            $transport = strip_tags($_POST['transport']);\n        } else {\n            $transport = 'udp';\n        }\n\n        $additional = [];\n        if (! $snmp_enabled) {\n            $snmpver = 'v2c';\n            $additional = [\n                'snmp_disable' => 1,\n                'os'           => $_POST['os'] ? $_POST['os_id'] : 'ping',\n                'hardware'     => $_POST['hardware'],\n                'sysName'      => $_POST['sysName'],\n            ];\n        } elseif ($_POST['snmpver'] === 'v2c' || $_POST['snmpver'] === 'v1') {\n            if ($_POST['community']) {\n                Config::set('snmp.community', [$_POST['community']]);\n            }\n\n            $snmpver = strip_tags($_POST['snmpver']);\n            print_message(\"Adding host $hostname communit\" . (count(Config::get('snmp.community')) == 1 ? 'y' : 'ies') . ' ' . implode(', ', Config::get('snmp.community')) . \" port $port using $transport\");\n        } elseif ($_POST['snmpver'] === 'v3') {\n            $v3 = [\n                'authlevel'  => strip_tags($_POST['authlevel']),\n                'authname'   => $_POST['authname'],\n                'authpass'   => $_POST['authpass'],\n                'authalgo'   => strip_tags($_POST['authalgo']),\n                'cryptopass' => $_POST['cryptopass'],\n                'cryptoalgo' => $_POST['cryptoalgo'],\n            ];\n\n            $v3_config = Config::get('snmp.v3');\n            array_unshift($v3_config, $v3);\n            Config::set('snmp.v3', $v3_config);\n\n            $snmpver = 'v3';\n            print_message(\"Adding SNMPv3 host: $hostname port: $port\");\n        } else {\n            print_error('Unsupported SNMP Version. There was a dropdown menu, how did you reach this error ?');\n        }//end if\n\n        $poller_group = strip_tags($_POST['poller_group']);\n        $force_add = ($_POST['force_add'] == 'on');\n\n        $port_assoc_mode = strip_tags($_POST['port_assoc_mode']);\n        try {\n            $device_id = addHost($hostname, $snmpver, $port, $transport, $poller_group, $force_add, $port_assoc_mode, $additional);\n            $link = \\LibreNMS\\Util\\Url::deviceUrl($device_id);\n            print_message(\"Device added <a href='$link'>$hostname ($device_id)</a>\");\n        } catch (HostUnreachableException $e) {\n            print_error($e->getMessage());\n            foreach ($e->getReasons() as $reason) {\n                print_error($reason);\n            }\n        } catch (Exception $e) {\n            print_error($e->getMessage());\n        }\n    } else {\n        print_error(\"You don't have the necessary privileges to add hosts.\");\n    }\n}\necho '    </div>\n        <div class=\"col-sm-3\">\n        </div>\n    </div>';\n\n$pagetitle[] = 'Add host';\n\n?>\n\n<div class=\"row\">\n  <div class=\"col-sm-3\">\n  </div>\n  <div class=\"col-sm-6\">\n<form name=\"form1\" method=\"post\" action=\"\" class=\"form-horizontal\" role=\"form\">\n    <?php echo csrf_field() ?>\n  <div><h2>Add Device</h2></div>\n  <div class=\"alert alert-info\">Devices will be checked for Ping/SNMP reachability before being probed.</div>\n  <div class=\"well well-lg\">\n      <div class=\"form-group\">\n          <label for=\"hostname\" class=\"col-sm-3 control-label\">Hostname or IP</label>\n          <div class=\"col-sm-9\">\n              <input type=\"text\" id=\"hostname\" name=\"hostname\" class=\"form-control input-sm\" placeholder=\"Hostname\">\n          </div>\n      </div>\n      <div class='form-group'>\n        <label for='hardware' class='col-sm-3 control-label'>SNMP</label>\n        <div class='col-sm-4'>\n            <input type=\"checkbox\" id=\"snmp\" name=\"snmp\" data-size=\"small\" onChange=\"disableSnmp(this);\" checked>\n        </div>\n    </div>\n    <div id='snmp_override' style=\"display: none;\">\n        <div class='form-group'>\n            <label for='sysName' class='col-sm-3 control-label'>sysName (optional)</label>\n            <div class='col-sm-9'>\n                <input id='sysName' class='form-control' name='sysName' placeholder=\"sysName (optional)\"/>\n            </div>\n        </div>\n        <div class='form-group'>\n            <label for='hardware' class='col-sm-3 control-label'>Hardware (optional)</label>\n            <div class='col-sm-9'>\n                <input id='hardware' class='form-control' name='hardware' placeholder=\"Hardware (optional)\"/>\n            </div>\n        </div>\n        <div class='form-group'>\n            <label for='os' class='col-sm-3 control-label'>OS (optional)</label>\n            <div class='col-sm-9'>\n                <input id='os' class='form-control' name='os' placeholder=\"OS (optional)\"/>\n                <input type='hidden' id='os_id' class='form-control' name='os_id' />\n            </div>\n        </div>\n    </div>\n    <div id=\"snmp_conf\" style=\"display: block;\">\n        <div class=\"form-group\">\n          <label for=\"snmpver\" class=\"col-sm-3 control-label\">SNMP Version</label>\n          <div class=\"col-sm-3\">\n            <select name=\"snmpver\" id=\"snmpver\" class=\"form-control input-sm\" onChange=\"changeForm();\">\n              <option value=\"v1\">v1</option>\n              <option value=\"v2c\" selected>v2c</option>\n              <option value=\"v3\">v3</option>\n            </select>\n          </div>\n          <div class=\"col-sm-3\">\n            <input type=\"text\" name=\"port\" placeholder=\"port\" class=\"form-control input-sm\">\n          </div>\n          <div class=\"col-sm-3\">\n            <select name=\"transport\" id=\"transport\" class=\"form-control input-sm\">\n<?php\nforeach (Config::get('snmp.transports') as $transport) {\n    echo \"<option value='\" . $transport . \"'\";\n    if ($transport == $device['transport']) {\n        echo \" selected='selected'\";\n    }\n\n    echo '>' . $transport . '</option>';\n}\n?>\n            </select>\n          </div>\n        </div>\n        <div class=\"form-group\">\n          <label for=\"port_association_mode\" class=\"col-sm-3 control-label\">Port Association Mode</label>\n          <div class=\"col-sm-3\">\n            <select name=\"port_assoc_mode\" id=\"port_assoc_mode\" class=\"form-control input-sm\">\n<?php\n\nforeach (get_port_assoc_modes() as $mode) {\n    $selected = '';\n    if ($mode == Config::get('default_port_association_mode')) {\n        $selected = 'selected';\n    }\n\n    echo \"              <option value=\\\"$mode\\\" $selected>$mode</option>\\n\";\n}\n\n?>\n            </select>\n          </div>\n        </div>\n        <div id=\"snmpv1_2\">\n          <div class=\"form-group\">\n            <div class=\"col-sm-12 alert alert-info\">\n              <label class=\"control-label text-left input-sm\">SNMPv1/2c Configuration</label>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"community\" class=\"col-sm-3 control-label\">Community</label>\n            <div class=\"col-sm-9\">\n              <input type=\"text\" name=\"community\" id=\"community\" placeholder=\"Community\" class=\"form-control input-sm\">\n            </div>\n          </div>\n        </div>\n        <div id=\"snmpv3\">\n          <div class=\"form-group\">\n            <div class=\"col-sm-12 alert alert-info\">\n              <label class=\"control-label text-left input-sm\">SNMPv3 Configuration</label>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"authlevel\" class=\"col-sm-3 control-label\">Auth Level</label>\n            <div class=\"col-sm-3\">\n              <select name=\"authlevel\" id=\"authlevel\" class=\"form-control input-sm\">\n                <option value=\"noAuthNoPriv\" selected>noAuthNoPriv</option>\n                <option value=\"authNoPriv\">authNoPriv</option>\n                <option value=\"authPriv\">authPriv</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"authname\" class=\"col-sm-3 control-label\">Auth User Name</label>\n            <div class=\"col-sm-9\">\n              <input type=\"text\" name=\"authname\" id=\"authname\" class=\"form-control input-sm\" autocomplete=\"off\">\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"authpass\" class=\"col-sm-3 control-label\">Auth Password</label>\n            <div class=\"col-sm-9\">\n              <input type=\"text\" name=\"authpass\" id=\"authpass\" placeholder=\"AuthPass\" class=\"form-control input-sm\" autocomplete=\"off\">\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"authalgo\" class=\"col-sm-3 control-label\">Auth Algorithm</label>\n            <div class=\"col-sm-9\">\n              <select name=\"authalgo\" id=\"authalgo\" class=\"form-control input-sm\">\n                  <?php\n                  foreach (\\LibreNMS\\SNMPCapabilities::authAlgorithms() as $algo => $enabled) {\n                      echo \"<option value=\\\"$algo\\\"\" . ($enabled ?: ' disabled') . \">$algo</option>\";\n                  }\n                  ?>\n              </select>\n              <?php if (! \\LibreNMS\\SNMPCapabilities::supportsSHA2()) {?>\n              <label class=\"text-left\"><small>Some options are disabled. <a href=\"https://docs.librenms.org/Support/FAQ/#optional-requirements-for-snmpv3-sha2-auth\">Read more here</a></small></label>\n              <?php } ?>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"cryptopass\" class=\"col-sm-3 control-label\">Crypto Password</label>\n            <div class=\"col-sm-9\">\n              <input type=\"text\" name=\"cryptopass\" id=\"cryptopass\" placeholder=\"Crypto Password\" class=\"form-control input-sm\" autocomplete=\"off\">\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"cryptoalgo\" class=\"col-sm-3 control-label\">Crypto Algorithm</label>\n            <div class=\"col-sm-9\">\n              <select name=\"cryptoalgo\" id=\"cryptoalgo\" class=\"form-control input-sm\">\n                  <?php\n                  foreach (\\LibreNMS\\SNMPCapabilities::cryptoAlgoritms() as $algo => $enabled) {\n                      echo \"<option value=\\\"$algo\\\"\" . ($enabled ?: ' disabled') . \">$algo</option>\";\n                  }\n                  ?>\n              </select>\n              <?php if (! \\LibreNMS\\SNMPCapabilities::supportsAES256()) {?>\n              <label class=\"text-left\"><small>Some options are disabled. <a href=\"https://docs.librenms.org/Support/FAQ/#optional-requirements-for-snmpv3-sha2-auth\">Read more here</a></small></label>\n              <?php } ?>\n            </div>\n          </div>\n        </div>\n      </div>\n<?php\nif (Config::get('distributed_poller') === true) {\n                      echo '\n          <div class=\"form-group\">\n              <label for=\"poller_group\" class=\"col-sm-3 control-label\">Poller Group</label>\n              <div class=\"col-sm-9\">\n                  <select name=\"poller_group\" id=\"poller_group\" class=\"form-control input-sm\">\n                      <option value=\"0\"> Default poller group</option>\n    ';\n\n                      foreach (dbFetchRows('SELECT `id`,`group_name` FROM `poller_groups` ORDER BY `group_name`') as $group) {\n                          echo '<option value=\"' . $group['id'] . '\">' . $group['group_name'] . '</option>';\n                      }\n\n                      echo '\n                  </select>\n              </div>\n          </div>\n    ';\n                  }//endif\n?>\n      <div class=\"form-group\">\n          <label for=\"force_add\" class=\"col-sm-3 control-label\">Force add<br><small>(No ICMP or SNMP checks performed)</small></label>\n          <div class=\"col-sm-9\">\n                  <input type=\"checkbox\" name=\"force_add\" id=\"force_add\" data-size=\"small\">\n          </div>\n      </div>\n    <hr>\n    <center><button type=\"submit\" class=\"btn btn-default\" name=\"Submit\">Add Device</button></center>\n  </div>\n</form>\n  </div>\n  <div class=\"col-sm-3\">\n  </div>\n</div>\n<script>\n    function changeForm() {\n        snmpVersion = $(\"#snmpver\").val();\n        if(snmpVersion == 'v1' || snmpVersion == 'v2c') {\n            $('#snmpv1_2').show();\n            $('#snmpv3').hide();\n        }\n        else if(snmpVersion == 'v3') {\n            $('#snmpv1_2').hide();\n            $('#snmpv3').show();\n        }\n    }\n    $('#snmpv3').toggle();\n\n    function disableSnmp(e) {\n        if(e.checked) {\n            $('#snmp_conf').show();\n            $('#snmp_override').hide();\n        } else {\n            $('#snmp_conf').hide();\n            $('#snmp_override').show();\n        }\n    }\n\n    var os_suggestions = new Bloodhound({\n        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('text'),\n        queryTokenizer: Bloodhound.tokenizers.whitespace,\n        remote: {\n            url: \"ajax_ossuggest.php?term=%QUERY\",\n            filter: function (output) {\n                return $.map(output, function (item) {\n                    return {\n                        text: item.text,\n                        os: item.os,\n                    };\n                });\n            },\n            wildcard: \"%QUERY\"\n        }\n    });\n    os_suggestions.initialize();\n    $('#os').typeahead({\n            hint: true,\n            highlight: true,\n            minLength: 1,\n            classNames: {\n                menu: 'typeahead-left'\n            }\n        },\n        {\n            source: os_suggestions.ttAdapter(),\n            async: true,\n            displayKey: 'text',\n            valueKey: 'os',\n            templates: {\n                suggestion: Handlebars.compile('<p>&nbsp;{{text}}</p>')\n            },\n            limit: 20\n        });\n\n    $(\"#os\").on(\"typeahead:selected typeahead:autocompleted\", function(e,datum) {\n        $(\"#os_id\").val(datum.os);\n        $(\"#os\").html('<mark>' + datum.text + '</mark>');\n    });\n\n    $(\"[name='snmp']\").bootstrapSwitch('offColor','danger');\n    $(\"[name='force_add']\").bootstrapSwitch();\n<?php\nif (! $snmp_enabled) {\n    echo '  $(\"[name=\\'snmp\\']\").trigger(\\'click\\');';\n}\n?>\n</script>\n"], "fixing_code": ["<?php\n\nuse LibreNMS\\Config;\nuse LibreNMS\\Exceptions\\HostUnreachableException;\nuse LibreNMS\\Util\\IP;\n\n$no_refresh = true;\n\nif (! Auth::user()->hasGlobalAdmin()) {\n    include 'includes/html/error-no-perm.inc.php';\n\n    exit;\n}\n\necho '<div class=\"row\">\n            <div class=\"col-sm-3\">\n            </div>\n            <div class=\"col-sm-6\">';\n\n// first load enabled, after that check snmp variable\n$snmp_enabled = ! isset($_POST['hostname']) || isset($_POST['snmp']);\n\nif (! empty($_POST['hostname'])) {\n    $hostname = strip_tags($_POST['hostname']);\n    if (! \\LibreNMS\\Util\\Validate::hostname($hostname) && ! IP::isValid($hostname)) {\n        print_error(\"Invalid hostname or IP: $hostname\");\n    }\n\n    if (Auth::user()->hasGlobalRead()) {\n        // Settings common to SNMPv2 & v3\n        if ($_POST['port']) {\n            $port = strip_tags($_POST['port']);\n        } else {\n            $port = Config::get('snmp.port');\n        }\n\n        if ($_POST['transport']) {\n            $transport = strip_tags($_POST['transport']);\n        } else {\n            $transport = 'udp';\n        }\n\n        $additional = [];\n        if (! $snmp_enabled) {\n            $snmpver = 'v2c';\n            $additional = [\n                'snmp_disable' => 1,\n                'os'           => $_POST['os'] ? strip_tags($_POST['os_id']) : 'ping',\n                'hardware'     => strip_tags($_POST['hardware']),\n                'sysName'      => strip_tags($_POST['sysName']),\n            ];\n        } elseif ($_POST['snmpver'] === 'v2c' || $_POST['snmpver'] === 'v1') {\n            if ($_POST['community']) {\n                Config::set('snmp.community', [$_POST['community']]);\n            }\n\n            $snmpver = strip_tags($_POST['snmpver']);\n            print_message(\"Adding host $hostname communit\" . (count(Config::get('snmp.community')) == 1 ? 'y' : 'ies') . ' ' . implode(', ', Config::get('snmp.community')) . \" port $port using $transport\");\n        } elseif ($_POST['snmpver'] === 'v3') {\n            $v3 = [\n                'authlevel'  => strip_tags($_POST['authlevel']),\n                'authname'   => $_POST['authname'],\n                'authpass'   => $_POST['authpass'],\n                'authalgo'   => strip_tags($_POST['authalgo']),\n                'cryptopass' => $_POST['cryptopass'],\n                'cryptoalgo' => $_POST['cryptoalgo'],\n            ];\n\n            $v3_config = Config::get('snmp.v3');\n            array_unshift($v3_config, $v3);\n            Config::set('snmp.v3', $v3_config);\n\n            $snmpver = 'v3';\n            print_message(\"Adding SNMPv3 host: $hostname port: $port\");\n        } else {\n            print_error('Unsupported SNMP Version. There was a dropdown menu, how did you reach this error ?');\n        }//end if\n\n        $poller_group = strip_tags($_POST['poller_group']);\n        $force_add = ($_POST['force_add'] == 'on');\n\n        $port_assoc_mode = strip_tags($_POST['port_assoc_mode']);\n        try {\n            $device_id = addHost($hostname, $snmpver, $port, $transport, $poller_group, $force_add, $port_assoc_mode, $additional);\n            $link = \\LibreNMS\\Util\\Url::deviceUrl($device_id);\n            print_message(\"Device added <a href='$link'>$hostname ($device_id)</a>\");\n        } catch (HostUnreachableException $e) {\n            print_error($e->getMessage());\n            foreach ($e->getReasons() as $reason) {\n                print_error($reason);\n            }\n        } catch (Exception $e) {\n            print_error($e->getMessage());\n        }\n    } else {\n        print_error(\"You don't have the necessary privileges to add hosts.\");\n    }\n}\necho '    </div>\n        <div class=\"col-sm-3\">\n        </div>\n    </div>';\n\n$pagetitle[] = 'Add host';\n\n?>\n\n<div class=\"row\">\n  <div class=\"col-sm-3\">\n  </div>\n  <div class=\"col-sm-6\">\n<form name=\"form1\" method=\"post\" action=\"\" class=\"form-horizontal\" role=\"form\">\n    <?php echo csrf_field() ?>\n  <div><h2>Add Device</h2></div>\n  <div class=\"alert alert-info\">Devices will be checked for Ping/SNMP reachability before being probed.</div>\n  <div class=\"well well-lg\">\n      <div class=\"form-group\">\n          <label for=\"hostname\" class=\"col-sm-3 control-label\">Hostname or IP</label>\n          <div class=\"col-sm-9\">\n              <input type=\"text\" id=\"hostname\" name=\"hostname\" class=\"form-control input-sm\" placeholder=\"Hostname\">\n          </div>\n      </div>\n      <div class='form-group'>\n        <label for='hardware' class='col-sm-3 control-label'>SNMP</label>\n        <div class='col-sm-4'>\n            <input type=\"checkbox\" id=\"snmp\" name=\"snmp\" data-size=\"small\" onChange=\"disableSnmp(this);\" checked>\n        </div>\n    </div>\n    <div id='snmp_override' style=\"display: none;\">\n        <div class='form-group'>\n            <label for='sysName' class='col-sm-3 control-label'>sysName (optional)</label>\n            <div class='col-sm-9'>\n                <input id='sysName' class='form-control' name='sysName' placeholder=\"sysName (optional)\"/>\n            </div>\n        </div>\n        <div class='form-group'>\n            <label for='hardware' class='col-sm-3 control-label'>Hardware (optional)</label>\n            <div class='col-sm-9'>\n                <input id='hardware' class='form-control' name='hardware' placeholder=\"Hardware (optional)\"/>\n            </div>\n        </div>\n        <div class='form-group'>\n            <label for='os' class='col-sm-3 control-label'>OS (optional)</label>\n            <div class='col-sm-9'>\n                <input id='os' class='form-control' name='os' placeholder=\"OS (optional)\"/>\n                <input type='hidden' id='os_id' class='form-control' name='os_id' />\n            </div>\n        </div>\n    </div>\n    <div id=\"snmp_conf\" style=\"display: block;\">\n        <div class=\"form-group\">\n          <label for=\"snmpver\" class=\"col-sm-3 control-label\">SNMP Version</label>\n          <div class=\"col-sm-3\">\n            <select name=\"snmpver\" id=\"snmpver\" class=\"form-control input-sm\" onChange=\"changeForm();\">\n              <option value=\"v1\">v1</option>\n              <option value=\"v2c\" selected>v2c</option>\n              <option value=\"v3\">v3</option>\n            </select>\n          </div>\n          <div class=\"col-sm-3\">\n            <input type=\"text\" name=\"port\" placeholder=\"port\" class=\"form-control input-sm\">\n          </div>\n          <div class=\"col-sm-3\">\n            <select name=\"transport\" id=\"transport\" class=\"form-control input-sm\">\n<?php\nforeach (Config::get('snmp.transports') as $transport) {\n    echo \"<option value='\" . $transport . \"'\";\n    if ($transport == $device['transport']) {\n        echo \" selected='selected'\";\n    }\n\n    echo '>' . $transport . '</option>';\n}\n?>\n            </select>\n          </div>\n        </div>\n        <div class=\"form-group\">\n          <label for=\"port_association_mode\" class=\"col-sm-3 control-label\">Port Association Mode</label>\n          <div class=\"col-sm-3\">\n            <select name=\"port_assoc_mode\" id=\"port_assoc_mode\" class=\"form-control input-sm\">\n<?php\n\nforeach (get_port_assoc_modes() as $mode) {\n    $selected = '';\n    if ($mode == Config::get('default_port_association_mode')) {\n        $selected = 'selected';\n    }\n\n    echo \"              <option value=\\\"$mode\\\" $selected>$mode</option>\\n\";\n}\n\n?>\n            </select>\n          </div>\n        </div>\n        <div id=\"snmpv1_2\">\n          <div class=\"form-group\">\n            <div class=\"col-sm-12 alert alert-info\">\n              <label class=\"control-label text-left input-sm\">SNMPv1/2c Configuration</label>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"community\" class=\"col-sm-3 control-label\">Community</label>\n            <div class=\"col-sm-9\">\n              <input type=\"text\" name=\"community\" id=\"community\" placeholder=\"Community\" class=\"form-control input-sm\">\n            </div>\n          </div>\n        </div>\n        <div id=\"snmpv3\">\n          <div class=\"form-group\">\n            <div class=\"col-sm-12 alert alert-info\">\n              <label class=\"control-label text-left input-sm\">SNMPv3 Configuration</label>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"authlevel\" class=\"col-sm-3 control-label\">Auth Level</label>\n            <div class=\"col-sm-3\">\n              <select name=\"authlevel\" id=\"authlevel\" class=\"form-control input-sm\">\n                <option value=\"noAuthNoPriv\" selected>noAuthNoPriv</option>\n                <option value=\"authNoPriv\">authNoPriv</option>\n                <option value=\"authPriv\">authPriv</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"authname\" class=\"col-sm-3 control-label\">Auth User Name</label>\n            <div class=\"col-sm-9\">\n              <input type=\"text\" name=\"authname\" id=\"authname\" class=\"form-control input-sm\" autocomplete=\"off\">\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"authpass\" class=\"col-sm-3 control-label\">Auth Password</label>\n            <div class=\"col-sm-9\">\n              <input type=\"text\" name=\"authpass\" id=\"authpass\" placeholder=\"AuthPass\" class=\"form-control input-sm\" autocomplete=\"off\">\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"authalgo\" class=\"col-sm-3 control-label\">Auth Algorithm</label>\n            <div class=\"col-sm-9\">\n              <select name=\"authalgo\" id=\"authalgo\" class=\"form-control input-sm\">\n                  <?php\n                  foreach (\\LibreNMS\\SNMPCapabilities::authAlgorithms() as $algo => $enabled) {\n                      echo \"<option value=\\\"$algo\\\"\" . ($enabled ?: ' disabled') . \">$algo</option>\";\n                  }\n                  ?>\n              </select>\n              <?php if (! \\LibreNMS\\SNMPCapabilities::supportsSHA2()) {?>\n              <label class=\"text-left\"><small>Some options are disabled. <a href=\"https://docs.librenms.org/Support/FAQ/#optional-requirements-for-snmpv3-sha2-auth\">Read more here</a></small></label>\n              <?php } ?>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"cryptopass\" class=\"col-sm-3 control-label\">Crypto Password</label>\n            <div class=\"col-sm-9\">\n              <input type=\"text\" name=\"cryptopass\" id=\"cryptopass\" placeholder=\"Crypto Password\" class=\"form-control input-sm\" autocomplete=\"off\">\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"cryptoalgo\" class=\"col-sm-3 control-label\">Crypto Algorithm</label>\n            <div class=\"col-sm-9\">\n              <select name=\"cryptoalgo\" id=\"cryptoalgo\" class=\"form-control input-sm\">\n                  <?php\n                  foreach (\\LibreNMS\\SNMPCapabilities::cryptoAlgoritms() as $algo => $enabled) {\n                      echo \"<option value=\\\"$algo\\\"\" . ($enabled ?: ' disabled') . \">$algo</option>\";\n                  }\n                  ?>\n              </select>\n              <?php if (! \\LibreNMS\\SNMPCapabilities::supportsAES256()) {?>\n              <label class=\"text-left\"><small>Some options are disabled. <a href=\"https://docs.librenms.org/Support/FAQ/#optional-requirements-for-snmpv3-sha2-auth\">Read more here</a></small></label>\n              <?php } ?>\n            </div>\n          </div>\n        </div>\n      </div>\n<?php\nif (Config::get('distributed_poller') === true) {\n                      echo '\n          <div class=\"form-group\">\n              <label for=\"poller_group\" class=\"col-sm-3 control-label\">Poller Group</label>\n              <div class=\"col-sm-9\">\n                  <select name=\"poller_group\" id=\"poller_group\" class=\"form-control input-sm\">\n                      <option value=\"0\"> Default poller group</option>\n    ';\n\n                      foreach (dbFetchRows('SELECT `id`,`group_name` FROM `poller_groups` ORDER BY `group_name`') as $group) {\n                          echo '<option value=\"' . $group['id'] . '\">' . $group['group_name'] . '</option>';\n                      }\n\n                      echo '\n                  </select>\n              </div>\n          </div>\n    ';\n                  }//endif\n?>\n      <div class=\"form-group\">\n          <label for=\"force_add\" class=\"col-sm-3 control-label\">Force add<br><small>(No ICMP or SNMP checks performed)</small></label>\n          <div class=\"col-sm-9\">\n                  <input type=\"checkbox\" name=\"force_add\" id=\"force_add\" data-size=\"small\">\n          </div>\n      </div>\n    <hr>\n    <center><button type=\"submit\" class=\"btn btn-default\" name=\"Submit\">Add Device</button></center>\n  </div>\n</form>\n  </div>\n  <div class=\"col-sm-3\">\n  </div>\n</div>\n<script>\n    function changeForm() {\n        snmpVersion = $(\"#snmpver\").val();\n        if(snmpVersion == 'v1' || snmpVersion == 'v2c') {\n            $('#snmpv1_2').show();\n            $('#snmpv3').hide();\n        }\n        else if(snmpVersion == 'v3') {\n            $('#snmpv1_2').hide();\n            $('#snmpv3').show();\n        }\n    }\n    $('#snmpv3').toggle();\n\n    function disableSnmp(e) {\n        if(e.checked) {\n            $('#snmp_conf').show();\n            $('#snmp_override').hide();\n        } else {\n            $('#snmp_conf').hide();\n            $('#snmp_override').show();\n        }\n    }\n\n    var os_suggestions = new Bloodhound({\n        datumTokenizer: Bloodhound.tokenizers.obj.whitespace('text'),\n        queryTokenizer: Bloodhound.tokenizers.whitespace,\n        remote: {\n            url: \"ajax_ossuggest.php?term=%QUERY\",\n            filter: function (output) {\n                return $.map(output, function (item) {\n                    return {\n                        text: item.text,\n                        os: item.os,\n                    };\n                });\n            },\n            wildcard: \"%QUERY\"\n        }\n    });\n    os_suggestions.initialize();\n    $('#os').typeahead({\n            hint: true,\n            highlight: true,\n            minLength: 1,\n            classNames: {\n                menu: 'typeahead-left'\n            }\n        },\n        {\n            source: os_suggestions.ttAdapter(),\n            async: true,\n            displayKey: 'text',\n            valueKey: 'os',\n            templates: {\n                suggestion: Handlebars.compile('<p>&nbsp;{{text}}</p>')\n            },\n            limit: 20\n        });\n\n    $(\"#os\").on(\"typeahead:selected typeahead:autocompleted\", function(e,datum) {\n        $(\"#os_id\").val(datum.os);\n        $(\"#os\").html('<mark>' + datum.text + '</mark>');\n    });\n\n    $(\"[name='snmp']\").bootstrapSwitch('offColor','danger');\n    $(\"[name='force_add']\").bootstrapSwitch();\n<?php\nif (! $snmp_enabled) {\n    echo '  $(\"[name=\\'snmp\\']\").trigger(\\'click\\');';\n}\n?>\n</script>\n"], "filenames": ["includes/html/pages/addhost.inc.php"], "buggy_code_start_loc": [48], "buggy_code_end_loc": [51], "fixing_code_start_loc": [48], "fixing_code_end_loc": [51], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in Packagist librenms/librenms prior to 22.2.0.", "other": {"cve": {"id": "CVE-2022-0575", "sourceIdentifier": "security@huntr.dev", "published": "2022-02-14T12:15:23.293", "lastModified": "2022-02-23T01:02:25.343", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in Packagist librenms/librenms prior to 22.2.0."}, {"lang": "es", "value": "Una vulnerabilidad de tipo Cross-site Scripting (XSS) - Almacenado en Packagist librenms/librenms versiones anteriores a 22.2.0"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.5}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:librenms:librenms:*:*:*:*:*:*:*:*", "versionEndExcluding": "22.2.0", "matchCriteriaId": "5728F9DE-EADE-4DC6-828D-FE2839E1A5AA"}]}]}], "references": [{"url": "https://github.com/librenms/librenms/commit/4f86915866703e2fcd1e34b3fc1181ec2ad78e54", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/13951f51-deed-4a3d-8275-52306cc5a87d", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://notes.netbytesec.com/2022/02/multiple-vulnerabilities-in-librenms.html", "source": "security@huntr.dev", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/librenms/librenms/commit/4f86915866703e2fcd1e34b3fc1181ec2ad78e54"}}