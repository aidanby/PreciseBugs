{"buggy_code": ["<?php\n//Default Configuration\n$CONFIG = '{\"lang\":\"en\",\"error_reporting\":false,\"show_hidden\":false,\"hide_Cols\":false,\"calc_folder\":false}';\n\n/**\n * H3K | Tiny File Manager V2.3.8\n * CCP Programmers | ccpprogrammers@gmail.com\n * https://tinyfilemanager.github.io\n */\n\n//TFM version\ndefine('VERSION', '2.3.8');\n\n//Application Title\ndefine('APP_TITLE', 'Tiny File Manager');\n\n// Auth with login/password (set true/false to enable/disable it)\n// Is independent from IP white- and blacklisting\n$use_auth = true;\n\n// Users: array('Username' => 'Password', 'Username2' => 'Password2', ...)\n// Generate secure password hash - https://tinyfilemanager.github.io/docs/pwd.html\n$auth_users = array(\n    'admin' => '$2y$10$/K.hjNr84lLNDt8fTXjoI.DBp6PpeyoJ.mGwrrLuCZfAwfSAGqhOW', //admin@123\n    'user' => '$2y$10$Fg6Dz8oH9fPoZ2jJan5tZuv6Z4Kp7avtQ9bDfrdRntXtPeiMAZyGO' //12345\n);\n\n// Readonly users (username array)\n$readonly_users = array(\n    'user'\n);\n\n// Possible rules are 'OFF', 'AND' or 'OR'\n// OFF => Don't check connection IP, defaults to OFF\n// AND => Connection must be on the whitelist, and not on the blacklist\n// OR => Connection must be on the whitelist, or not on the blacklist\n$ip_ruleset = 'OFF';\n\n// Should users be notified of their block?\n$ip_silent = true;\n\n// IP-addresses, both ipv4 and ipv6\n$ip_whitelist = array(\n    '127.0.0.1',    // local ipv4\n    '::1'           // local ipv6\n);\n\n// IP-addresses, both ipv4 and ipv6\n$ip_blacklist = array(\n    '0.0.0.0',      // non-routable meta ipv4\n    '::'            // non-routable meta ipv6\n);\n\n// user specific directories\n// array('Username' => 'Directory path', 'Username2' => 'Directory path', ...)\n$directories_users = array();\n\n// Enable highlight.js (https://highlightjs.org/) on view's page\n$use_highlightjs = true;\n\n// highlight.js style\n$highlightjs_style = 'vs';\n\n// Enable ace.js (https://ace.c9.io/) on view's page\n$edit_files = true;\n\n// Default timezone for date() and time() - http://php.net/manual/en/timezones.php\n$default_timezone = 'Etc/UTC'; // UTC\n\n// Root path for file manager\n// use absolute path of directory i.e: '/var/www/folder' or $_SERVER['DOCUMENT_ROOT'].'/folder'\n$root_path = $_SERVER['DOCUMENT_ROOT'];\n\n// Root url for links in file manager.Relative to $http_host. Variants: '', 'path/to/subfolder'\n// Will not working if $root_path will be outside of server document root\n$root_url = '';\n\n// Server hostname. Can set manually if wrong\n$http_host = $_SERVER['HTTP_HOST'];\n\n// input encoding for iconv\n$iconv_input_encoding = 'UTF-8';\n\n// date() format for file modification date\n$datetime_format = 'd.m.y H:i';\n\n// allowed file extensions for upload and rename\n// e.g. 'gif,png,jpg'\n$allowed_extensions = ''; \n\n// Favicon path. This can be either a full url to an .PNG image, or a path based on the document root.\n// full path, e.g http://example.com/favicon.png\n// local path, e.g images/icons/favicon.png\n$favicon_path = '?img=favicon';\n\n// Array of files and folders excluded from listing\n// e.r array('myfile.html', 'personal-folder')\n$GLOBALS['exclude_items'] = array();\n\n// Online office Docs Viewer\n// Availabe rules are 'google', 'microsoft' or false\n// google => View documents using Google Docs Viewer\n// microsoft => View documents using Microsoft Web Apps Viewer\n// false => disable online dov viewer\n$GLOBALS['online_viewer'] = 'google';\n\n// Sticky Nav bar\n// true => enable sticky header\n// false => disable sticky header\n$sticky_navbar = true;\n\n// max upload file size\ndefine('MAX_UPLOAD_SIZE', '2048');\n\n//--- EDIT BELOW CAREFULLY OR DO NOT EDIT AT ALL\n\n// private key and session name to store to the session\nif ( !defined( 'FM_SESSION_ID')) {\n    define('FM_SESSION_ID', 'filemanager');\n}\n\n// Configuration\n$cfg = new FM_Config();\n\n// Default language\n$lang = isset($cfg->data['lang']) ? $cfg->data['lang'] : 'en';\n\n// Show or hide files and folders that starts with a dot\n$show_hidden_files = isset($cfg->data['show_hidden']) ? $cfg->data['show_hidden'] : true;\n\n// PHP error reporting - false = Turns off Errors, true = Turns on Errors\n$report_errors = isset($cfg->data['error_reporting']) ? $cfg->data['error_reporting'] : true;\n\n// Hide Permissions and Owner cols in file-listing\n$hide_Cols = isset($cfg->data['hide_Cols']) ? $cfg->data['hide_Cols'] : true;\n\n// Show Dirsize: true or speedup output: false\n$calc_folder = isset($cfg->data['calc_folder']) ? $cfg->data['calc_folder'] : true;\n\n//available languages\n$lang_list = array(\n    'en' => 'English'\n);\n\nif ($report_errors == true) {\n    @ini_set('error_reporting', E_ALL);\n    @ini_set('display_errors', 1);\n} else {\n    @ini_set('error_reporting', E_ALL);\n    @ini_set('display_errors', 0);\n}\n\n// if fm included\nif (defined('FM_EMBED')) {\n    $use_auth = false;\n    $sticky_navbar = false;\n} else {\n    @set_time_limit(600);\n\n    date_default_timezone_set($default_timezone);\n\n    ini_set('default_charset', 'UTF-8');\n    if (version_compare(PHP_VERSION, '5.6.0', '<') && function_exists('mb_internal_encoding')) {\n        mb_internal_encoding('UTF-8');\n    }\n    if (function_exists('mb_regex_encoding')) {\n        mb_regex_encoding('UTF-8');\n    }\n\n    session_cache_limiter('');\n    session_name(FM_SESSION_ID );\n    @session_start();\n}\n\nif (empty($auth_users)) {\n    $use_auth = false;\n}\n\n$is_https = isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] == 'on' || $_SERVER['HTTPS'] == 1)\n    || isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https';\n\n// update $root_url based on user specific directories\nif (isset($_SESSION[FM_SESSION_ID]['logged']) && !empty($directories_users[$_SESSION[FM_SESSION_ID]['logged']])) {\n    $wd = fm_clean_path(dirname($_SERVER['PHP_SELF']));\n    $root_url =  $root_url.$wd.DIRECTORY_SEPARATOR.$directories_users[$_SESSION[FM_SESSION_ID]['logged']];\n}\n// clean $root_url\n$root_url = fm_clean_path($root_url);\n\n// abs path for site\ndefined('FM_ROOT_URL') || define('FM_ROOT_URL', ($is_https ? 'https' : 'http') . '://' . $http_host . (!empty($root_url) ? '/' . $root_url : ''));\ndefined('FM_SELF_URL') || define('FM_SELF_URL', ($is_https ? 'https' : 'http') . '://' . $http_host . $_SERVER['PHP_SELF']);\n\n// logout\nif (isset($_GET['logout'])) {\n    unset($_SESSION[FM_SESSION_ID]['logged']);\n    fm_redirect(FM_SELF_URL);\n}\n\n// Show image here\nif (isset($_GET['img'])) {\n    fm_show_image($_GET['img']);\n}\n\n// Validate connection IP\nif($ip_ruleset != 'OFF'){\n    $clientIp = $_SERVER['REMOTE_ADDR'];\n\n    $proceed = false;\n\n    $whitelisted = in_array($clientIp, $ip_whitelist);\n    $blacklisted = in_array($clientIp, $ip_blacklist);\n\n    if($ip_ruleset == 'AND'){\n        if($whitelisted == true && $blacklisted == false){\n            $proceed = true;\n        }\n    } else\n    if($ip_ruleset == 'OR'){\n         if($whitelisted == true || $blacklisted == false){\n            $proceed = true;\n        }\n    }\n\n    if($proceed == false){\n        trigger_error('User connection denied from: ' . $clientIp, E_USER_WARNING);\n\n        if($ip_silent == false){\n            fm_set_msg('Access denied. IP restriction applicable', 'error');\n            fm_show_header_login();\n            fm_show_message();\n        }\n\n        exit();\n    }\n}\n\n// Auth\nif ($use_auth) {\n    if (isset($_SESSION[FM_SESSION_ID]['logged'], $auth_users[$_SESSION[FM_SESSION_ID]['logged']])) {\n        // Logged\n    } elseif (isset($_POST['fm_usr'], $_POST['fm_pwd'])) {\n        // Logging In\n        sleep(1);\n        if(function_exists('password_verify')) {\n            if (isset($auth_users[$_POST['fm_usr']]) && isset($_POST['fm_pwd']) && password_verify($_POST['fm_pwd'], $auth_users[$_POST['fm_usr']])) {\n                $_SESSION[FM_SESSION_ID]['logged'] = $_POST['fm_usr'];\n                fm_set_msg('You are logged in');\n                fm_redirect(FM_SELF_URL . '?p=');\n            } else {\n                unset($_SESSION[FM_SESSION_ID]['logged']);\n                fm_set_msg('Login failed. Invalid username or password', 'error');\n                fm_redirect(FM_SELF_URL);\n            }\n        } else {\n            fm_set_msg('password_hash not supported, Upgrade PHP version', 'error');;\n        }\n    } else {\n        // Form\n        unset($_SESSION[FM_SESSION_ID]['logged']);\n        fm_show_header_login();\n        fm_show_message();\n        ?>\n        <section class=\"h-100\">\n            <div class=\"container h-100\">\n                <div class=\"row justify-content-md-center h-100\">\n                    <div class=\"card-wrapper\">\n                        <div class=\"brand\">\n                            <svg version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\" M1008 width=\"100%\" height=\"121px\" viewBox=\"0 0 238.000000 140.000000\" aria-label=\"H3K Tiny File Manager\">\n                                <g transform=\"translate(0.000000,140.000000) scale(0.100000,-0.100000)\" fill=\"#000000\" stroke=\"none\">\n                                    <path d=\"M160 700 l0 -600 110 0 110 0 0 260 0 260 70 0 70 0 0 -260 0 -260 110 0 110 0 0 600 0 600 -110 0 -110 0 0 -260 0 -260 -70 0 -70 0 0 260 0 260 -110 0 -110 0 0 -600z\"/>\n                                    <path fill=\"#003500\" d=\"M1008 1227 l-108 -72 0 -117 0 -118 110 0 110 0 0 110 0 110 70 0 70 0 0 -180 0 -180 -125 0 c-69 0 -125 -3 -125 -6 0 -3 23 -39 52 -80 l52 -74 73 0 73 0 0 -185 0 -185 -70 0 -70 0 0 115 0 115 -110 0 -110 0 0 -190 0 -190 181 0 181 0 109 73 108 72 1 181 0 181 -69 48 -68 49 68 50 69 49 0 249 0 248 -182 -1 -183 0 -107 -72z\"/>\n                                    <path d=\"M1640 700 l0 -600 110 0 110 0 0 208 0 208 35 34 35 34 35 -34 35 -34 0 -208 0 -208 110 0 110 0 0 212 0 213 -87 87 -88 88 88 88 87 87 0 213 0 212 -110 0 -110 0 0 -208 0 -208 -70 -69 -70 -69 0 277 0 277 -110 0 -110 0 0 -600z\"/></g>\n                            </svg>\n                        </div>\n                        <div class=\"text-center\">\n                            <h1 class=\"card-title\"><?php echo APP_TITLE; ?></h1>\n                        </div>\n                        <div class=\"card fat\">\n                            <div class=\"card-body\">\n                                <form class=\"form-signin\" action=\"\" method=\"post\" autocomplete=\"off\">\n                                    <div class=\"form-group\">\n                                        <label for=\"fm_usr\"><?php echo lng('Username'); ?></label>\n                                        <input type=\"text\" class=\"form-control\" id=\"fm_usr\" name=\"fm_usr\" required autofocus>\n                                    </div>\n\n                                    <div class=\"form-group\">\n                                        <label for=\"fm_pwd\"><?php echo lng('Password'); ?></label>\n                                        <input type=\"password\" class=\"form-control\" id=\"fm_pwd\" name=\"fm_pwd\" required>\n                                    </div>\n\n                                    <div class=\"form-group\">\n                                        <div class=\"custom-checkbox custom-control\">\n                                            <input type=\"checkbox\" name=\"remember\" id=\"remember\" class=\"custom-control-input\">\n                                            <label for=\"remember\" class=\"custom-control-label\"><?php echo lng('RememberMe'); ?></label>\n                                        </div>\n                                    </div>\n\n                                    <div class=\"form-group\">\n                                        <button type=\"submit\" class=\"btn btn-success btn-block\" role=\"button\">\n                                            <?php echo lng('Login'); ?>\n                                        </button>\n                                    </div>\n                                </form>\n                            </div>\n                        </div>\n                        <div class=\"footer text-center\">\n                            &mdash;&mdash; &copy;\n                            <a href=\"https://tinyfilemanager.github.io/\" target=\"_blank\" class=\"text-muted\" data-version=\"<?php echo VERSION; ?>\">CCP Programmers</a> &mdash;&mdash;\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <?php\n        fm_show_footer_login();\n        exit;\n    }\n}\n\n// update root path\nif ($use_auth && isset($_SESSION[FM_SESSION_ID]['logged'])) {\n    $root_path = isset($directories_users[$_SESSION[FM_SESSION_ID]['logged']]) ? $directories_users[$_SESSION[FM_SESSION_ID]['logged']] : $root_path;\n}\n\n// clean and check $root_path\n$root_path = rtrim($root_path, '\\\\/');\n$root_path = str_replace('\\\\', '/', $root_path);\nif (!@is_dir($root_path)) {\n    echo \"<h1>Root path \\\"{$root_path}\\\" not found!</h1>\";\n    exit;\n}\n\ndefined('FM_SHOW_HIDDEN') || define('FM_SHOW_HIDDEN', $show_hidden_files);\ndefined('FM_ROOT_PATH') || define('FM_ROOT_PATH', $root_path);\ndefined('FM_LANG') || define('FM_LANG', $lang);\ndefined('FM_EXTENSION') || define('FM_EXTENSION', $allowed_extensions);\ndefine('FM_READONLY', $use_auth && !empty($readonly_users) && isset($_SESSION[FM_SESSION_ID]['logged']) && in_array($_SESSION[FM_SESSION_ID]['logged'], $readonly_users));\ndefine('FM_IS_WIN', DIRECTORY_SEPARATOR == '\\\\');\n\n// always use ?p=\nif (!isset($_GET['p']) && empty($_FILES)) {\n    fm_redirect(FM_SELF_URL . '?p=');\n}\n\n// get path\n$p = isset($_GET['p']) ? $_GET['p'] : (isset($_POST['p']) ? $_POST['p'] : '');\n\n// clean path\n$p = fm_clean_path($p);\n\n// for ajax request - save\n$input = file_get_contents('php://input');\n$_POST = (strpos($input, 'ajax') != FALSE && strpos($input, 'save') != FALSE) ? json_decode($input, true) : $_POST;\n\n// instead globals vars\ndefine('FM_PATH', $p);\ndefine('FM_USE_AUTH', $use_auth);\ndefine('FM_EDIT_FILE', $edit_files);\ndefined('FM_ICONV_INPUT_ENC') || define('FM_ICONV_INPUT_ENC', $iconv_input_encoding);\ndefined('FM_USE_HIGHLIGHTJS') || define('FM_USE_HIGHLIGHTJS', $use_highlightjs);\ndefined('FM_HIGHLIGHTJS_STYLE') || define('FM_HIGHLIGHTJS_STYLE', $highlightjs_style);\ndefined('FM_DATETIME_FORMAT') || define('FM_DATETIME_FORMAT', $datetime_format);\n\nunset($p, $use_auth, $iconv_input_encoding, $use_highlightjs, $highlightjs_style);\n\n/*************************** ACTIONS ***************************/\n\n// AJAX Request\nif (isset($_POST['ajax']) && !FM_READONLY) {\n\n    // save\n    if (isset($_POST['type']) && $_POST['type'] == \"save\") {\n        // get current path\n        $path = FM_ROOT_PATH;\n        if (FM_PATH != '') {\n            $path .= '/' . FM_PATH;\n        }\n        // check path\n        if (!is_dir($path)) {\n            fm_redirect(FM_SELF_URL . '?p=');\n        }\n        $file = $_GET['edit'];\n        $file = fm_clean_path($file);\n        $file = str_replace('/', '', $file);\n        if ($file == '' || !is_file($path . '/' . $file)) {\n            fm_set_msg('File not found', 'error');\n            fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n        }\n        header('X-XSS-Protection:0'); \n        $file_path = $path . '/' . $file;\n        \n        $writedata = $_POST['content'];\n        $fd = fopen($file_path, \"w\");\n        @fwrite($fd, $writedata);\n        fclose($fd);\n        die(true);\n    }\n    \n    // backup files\n    if (isset($_POST['type']) && $_POST['type'] == \"backup\") {\n        $file = $_POST['file'];\n        $path = $_POST['path'];\n        $date = date(\"dMy-His\");\n        $newFile = $file . '-' . $date . '.bak';\n        copy($path . '/' . $file, $path . '/' . $newFile) or die(\"Unable to backup\");\n        echo \"Backup $newFile Created\";\n    }\n\n    // Save Config\n    if (isset($_POST['type']) && $_POST['type'] == \"settings\") {\n        global $cfg, $lang, $report_errors, $show_hidden_files, $lang_list, $hide_Cols, $calc_folder;\n        $newLng = $_POST['js-language'];\n        fm_get_translations([]);\n        if (!array_key_exists($newLng, $lang_list)) {\n            $newLng = 'en';\n        }\n\n        $erp = isset($_POST['js-error-report']) && $_POST['js-error-report'] == \"true\" ? true : false;\n        $shf = isset($_POST['js-show-hidden']) && $_POST['js-show-hidden'] == \"true\" ? true : false;\n        $hco = isset($_POST['js-hide-cols']) && $_POST['js-hide-cols'] == \"true\" ? true : false;\n        $caf = isset($_POST['js-calc-folder']) && $_POST['js-calc-folder'] == \"true\" ? true : false;\n\n        if ($cfg->data['lang'] != $newLng) {\n            $cfg->data['lang'] = $newLng;\n            $lang = $newLng;\n        }\n        if ($cfg->data['error_reporting'] != $erp) {\n            $cfg->data['error_reporting'] = $erp;\n            $report_errors = $erp;\n        }\n        if ($cfg->data['show_hidden'] != $shf) {\n            $cfg->data['show_hidden'] = $shf;\n            $show_hidden_files = $shf;\n        }\n        if ($cfg->data['show_hidden'] != $shf) {\n            $cfg->data['show_hidden'] = $shf;\n            $show_hidden_files = $shf;\n        }\n        if ($cfg->data['hide_Cols'] != $hco) {\n            $cfg->data['hide_Cols'] = $hco;\n            $hide_Cols = $hco;\n        }\n        if ($cfg->data['calc_folder'] != $caf) {\n            $cfg->data['calc_folder'] = $caf;\n            $calc_folder = $caf;\n        }\n        $cfg->save();\n        echo true;\n    }\n\n    // new password hash\n    if (isset($_POST['type']) && $_POST['type'] == \"pwdhash\") {\n        $res = isset($_POST['inputPassword2']) && !empty($_POST['inputPassword2']) ? password_hash($_POST['inputPassword2'], PASSWORD_DEFAULT) : '';\n        echo $res;\n    }\n\n    //upload using url\n    if(isset($_POST['type']) && $_POST['type'] == \"upload\" && !empty($_REQUEST[\"uploadurl\"])) {\n        $path = FM_ROOT_PATH;\n        if (FM_PATH != '') {\n            $path .= '/' . FM_PATH;\n        }\n\n        $url = !empty($_REQUEST[\"uploadurl\"]) && preg_match(\"|^http(s)?://.+$|\", stripslashes($_REQUEST[\"uploadurl\"])) ? stripslashes($_REQUEST[\"uploadurl\"]) : null;\n        $use_curl = false;\n        $temp_file = tempnam(sys_get_temp_dir(), \"upload-\");\n        $fileinfo = new stdClass();\n        $fileinfo->name = trim(basename($url), \".\\x00..\\x20\");\n\n        function event_callback ($message) {\n            global $callback;\n            echo json_encode($message);\n        }\n\n        function get_file_path () {\n            global $path, $fileinfo, $temp_file;\n            return $path.\"/\".basename($fileinfo->name);\n        }\n\n        $err = false;\n        if (!$url) {\n            $success = false;\n        } else if ($use_curl) {\n            @$fp = fopen($temp_file, \"w\");\n            @$ch = curl_init($url);\n            curl_setopt($ch, CURLOPT_NOPROGRESS, false );\n            curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);\n            curl_setopt($ch, CURLOPT_FILE, $fp);\n            @$success = curl_exec($ch);\n            $curl_info = curl_getinfo($ch);\n            if (!$success) {\n                $err = array(\"message\" => curl_error($ch));\n            }\n            @curl_close($ch);\n            fclose($fp);\n            $fileinfo->size = $curl_info[\"size_download\"];\n            $fileinfo->type = $curl_info[\"content_type\"];\n        } else {\n            $ctx = stream_context_create();\n            @$success = copy($url, $temp_file, $ctx);\n            if (!$success) {\n                $err = error_get_last();\n            }\n        }\n\n        if ($success) {\n            $success = rename($temp_file, get_file_path());\n        }\n\n        if ($success) {\n            event_callback(array(\"done\" => $fileinfo));\n        } else {\n            unlink($temp_file);\n            if (!$err) {\n                $err = array(\"message\" => \"Invalid url parameter\");\n            }\n            event_callback(array(\"fail\" => $err));\n        }\n    }\n\n    exit();\n}\n\n// Delete file / folder\nif (isset($_GET['del']) && !FM_READONLY) {\n    $del = str_replace( '/', '', fm_clean_path( $_GET['del'] ) );\n    if ($del != '' && $del != '..' && $del != '.') {\n        $path = FM_ROOT_PATH;\n        if (FM_PATH != '') {\n            $path .= '/' . FM_PATH;\n        }\n        $is_dir = is_dir($path . '/' . $del);\n        if (fm_rdelete($path . '/' . $del)) {\n            $msg = $is_dir ? 'Folder <b>%s</b> deleted' : 'File <b>%s</b> deleted';\n            fm_set_msg(sprintf($msg, fm_enc($del)));\n        } else {\n            $msg = $is_dir ? 'Folder <b>%s</b> not deleted' : 'File <b>%s</b> not deleted';\n            fm_set_msg(sprintf($msg, fm_enc($del)), 'error');\n        }\n    } else {\n        fm_set_msg('Wrong file or folder name', 'error');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Create folder\nif (isset($_GET['new']) && isset($_GET['type']) && !FM_READONLY) {\n    $type = $_GET['type'];\n    $new = str_replace( '/', '', fm_clean_path( strip_tags( $_GET['new'] ) ) );\n    if ($new != '' && $new != '..' && $new != '.') {\n        $path = FM_ROOT_PATH;\n        if (FM_PATH != '') {\n            $path .= '/' . FM_PATH;\n        }\n        if ($_GET['type'] == \"file\") {\n            if (!file_exists($path . '/' . $new)) {\n                @fopen($path . '/' . $new, 'w') or die('Cannot open file:  ' . $new);\n                fm_set_msg(sprintf('File <b>%s</b> created', fm_enc($new)));\n            } else {\n                fm_set_msg(sprintf('File <b>%s</b> already exists', fm_enc($new)), 'alert');\n            }\n        } else {\n            if (fm_mkdir($path . '/' . $new, false) === true) {\n                fm_set_msg(sprintf('Folder <b>%s</b> created', $new));\n            } elseif (fm_mkdir($path . '/' . $new, false) === $path . '/' . $new) {\n                fm_set_msg(sprintf('Folder <b>%s</b> already exists', fm_enc($new)), 'alert');\n            } else {\n                fm_set_msg(sprintf('Folder <b>%s</b> not created', fm_enc($new)), 'error');\n            }\n        }\n    } else {\n        fm_set_msg('Wrong folder name', 'error');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Copy folder / file\nif (isset($_GET['copy'], $_GET['finish']) && !FM_READONLY) {\n    // from\n    $copy = $_GET['copy'];\n    $copy = fm_clean_path($copy);\n    // empty path\n    if ($copy == '') {\n        fm_set_msg('Source path not defined', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n    // abs path from\n    $from = FM_ROOT_PATH . '/' . $copy;\n    // abs path to\n    $dest = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $dest .= '/' . FM_PATH;\n    }\n    $dest .= '/' . basename($from);\n    // move?\n    $move = isset($_GET['move']);\n    // copy/move\n    if ($from != $dest) {\n        $msg_from = trim(FM_PATH . '/' . basename($from), '/');\n        if ($move) {\n            $rename = fm_rename($from, $dest);\n            if ($rename) {\n                fm_set_msg(sprintf('Moved from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($msg_from)));\n            } elseif ($rename === null) {\n                fm_set_msg('File or folder with this path already exists', 'alert');\n            } else {\n                fm_set_msg(sprintf('Error while moving from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($msg_from)), 'error');\n            }\n        } else {\n            if (fm_rcopy($from, $dest)) {\n                fm_set_msg(sprintf('Copied from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($msg_from)));\n            } else {\n                fm_set_msg(sprintf('Error while copying from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($msg_from)), 'error');\n            }\n        }\n    } else {\n        fm_set_msg('Paths must be not equal', 'alert');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Mass copy files/ folders\nif (isset($_POST['file'], $_POST['copy_to'], $_POST['finish']) && !FM_READONLY) {\n    // from\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n    // to\n    $copy_to_path = FM_ROOT_PATH;\n    $copy_to = fm_clean_path($_POST['copy_to']);\n    if ($copy_to != '') {\n        $copy_to_path .= '/' . $copy_to;\n    }\n    if ($path == $copy_to_path) {\n        fm_set_msg('Paths must be not equal', 'alert');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n    if (!is_dir($copy_to_path)) {\n        if (!fm_mkdir($copy_to_path, true)) {\n            fm_set_msg('Unable to create destination folder', 'error');\n            fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n        }\n    }\n    // move?\n    $move = isset($_POST['move']);\n    // copy/move\n    $errors = 0;\n    $files = $_POST['file'];\n    if (is_array($files) && count($files)) {\n        foreach ($files as $f) {\n            if ($f != '') {\n                // abs path from\n                $from = $path . '/' . $f;\n                // abs path to\n                $dest = $copy_to_path . '/' . $f;\n                // do\n                if ($move) {\n                    $rename = fm_rename($from, $dest);\n                    if ($rename === false) {\n                        $errors++;\n                    }\n                } else {\n                    if (!fm_rcopy($from, $dest)) {\n                        $errors++;\n                    }\n                }\n            }\n        }\n        if ($errors == 0) {\n            $msg = $move ? 'Selected files and folders moved' : 'Selected files and folders copied';\n            fm_set_msg($msg);\n        } else {\n            $msg = $move ? 'Error while moving items' : 'Error while copying items';\n            fm_set_msg($msg, 'error');\n        }\n    } else {\n        fm_set_msg('Nothing selected', 'alert');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Rename\nif (isset($_GET['ren'], $_GET['to']) && !FM_READONLY) {\n    // old name\n    $old = $_GET['ren'];\n    $old = fm_clean_path($old);\n    $old = str_replace('/', '', $old);\n    // new name\n    $new = $_GET['to'];\n    $new = fm_clean_path(strip_tags($new));\n    $new = str_replace('/', '', $new);\n    // path\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n    // rename\n    if ($old != '' && $new != '') {\n        if (fm_rename($path . '/' . $old, $path . '/' . $new)) {\n            fm_set_msg(sprintf('Renamed from <b>%s</b> to <b>%s</b>', fm_enc($old), fm_enc($new)));\n        } else {\n            fm_set_msg(sprintf('Error while renaming from <b>%s</b> to <b>%s</b>', fm_enc($old), fm_enc($new)), 'error');\n        }\n    } else {\n        fm_set_msg('Names not set', 'error');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Download\nif (isset($_GET['dl'])) {\n    $dl = $_GET['dl'];\n    $dl = fm_clean_path($dl);\n    $dl = str_replace('/', '', $dl);\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n    if ($dl != '' && is_file($path . '/' . $dl)) {\n        header('Content-Description: File Transfer');\n        header('Content-Type: application/octet-stream');\n        header('Content-Disposition: attachment; filename=\"' . basename($path . '/' . $dl) . '\"');\n        header('Content-Transfer-Encoding: binary');\n        header('Connection: Keep-Alive');\n        header('Expires: 0');\n        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');\n        header('Pragma: public');\n        header('Content-Length: ' . filesize($path . '/' . $dl));\n        ob_end_clean();\n        readfile($path . '/' . $dl);\n        exit;\n    } else {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n}\n\n// Upload\nif (!empty($_FILES) && !FM_READONLY) {\n    $override_file_name = false;\n    $f = $_FILES;\n    $path = FM_ROOT_PATH;\n    $ds = DIRECTORY_SEPARATOR;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    $errors = 0;\n    $uploads = 0;\n    $allowed = (FM_EXTENSION) ? explode(',', FM_EXTENSION) : false;\n\n    $filename = $f['file']['name'];\n    $tmp_name = $f['file']['tmp_name'];\n    $ext = strtolower(pathinfo($filename, PATHINFO_EXTENSION));\n    $isFileAllowed = ($allowed) ? in_array($ext, $allowed) : true;\n\n    $targetPath = $path . $ds;\n    $fullPath = $path . '/' . $_REQUEST['fullpath'];\n    $folder = substr($fullPath, 0, strrpos($fullPath, \"/\"));\n\n    if(file_exists ($fullPath) && !$override_file_name) {\n        $ext_1 = $ext ? '.'.$ext : '';\n        $fullPath = str_replace($ext_1, '', $fullPath) .'_'. date('ymdHis'). $ext_1;\n    }\n\n    if (!is_dir($folder)) {\n        $old = umask(0);\n        mkdir($folder, 0777, true);\n        umask($old);\n    }\n\n    if (empty($f['file']['error']) && !empty($tmp_name) && $tmp_name != 'none' && $isFileAllowed) {\n        if (move_uploaded_file($tmp_name, $fullPath)) {\n            die('Successfully uploaded');\n        } else {\n            die(sprintf('Error while uploading files. Uploaded files: %s', $uploads));\n        }\n    }\n    exit();\n}\n\n// Mass deleting\nif (isset($_POST['group'], $_POST['delete']) && !FM_READONLY) {\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    $errors = 0;\n    $files = $_POST['file'];\n    if (is_array($files) && count($files)) {\n        foreach ($files as $f) {\n            if ($f != '') {\n                $new_path = $path . '/' . $f;\n                if (!fm_rdelete($new_path)) {\n                    $errors++;\n                }\n            }\n        }\n        if ($errors == 0) {\n            fm_set_msg('Selected files and folder deleted');\n        } else {\n            fm_set_msg('Error while deleting items', 'error');\n        }\n    } else {\n        fm_set_msg('Nothing selected', 'alert');\n    }\n\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Pack files\nif (isset($_POST['group']) && (isset($_POST['zip']) || isset($_POST['tar'])) && !FM_READONLY) {\n    $path = FM_ROOT_PATH;\n    $ext = 'zip';\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    //set pack type\n    $ext = isset($_POST['tar']) ? 'tar' : 'zip';\n\n\n    if (($ext == \"zip\" && !class_exists('ZipArchive')) || ($ext == \"tar\" && !class_exists('PharData'))) {\n        fm_set_msg('Operations with archives are not available', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    $files = $_POST['file'];\n    if (!empty($files)) {\n        chdir($path);\n\n        if (count($files) == 1) {\n            $one_file = reset($files);\n            $one_file = basename($one_file);\n            $zipname = $one_file . '_' . date('ymd_His') . '.'.$ext;\n        } else {\n            $zipname = 'archive_' . date('ymd_His') . '.'.$ext;\n        }\n\n        if($ext == 'zip') {\n            $zipper = new FM_Zipper();\n            $res = $zipper->create($zipname, $files);\n        } elseif ($ext == 'tar') {\n            $tar = new FM_Zipper_Tar();\n            $res = $tar->create($zipname, $files);\n        }\n\n        if ($res) {\n            fm_set_msg(sprintf('Archive <b>%s</b> created', fm_enc($zipname)));\n        } else {\n            fm_set_msg('Archive not created', 'error');\n        }\n    } else {\n        fm_set_msg('Nothing selected', 'alert');\n    }\n\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Unpack\nif (isset($_GET['unzip']) && !FM_READONLY) {\n    $unzip = $_GET['unzip'];\n    $unzip = fm_clean_path($unzip);\n    $unzip = str_replace('/', '', $unzip);\n    $isValid = false;\n\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    if ($unzip != '' && is_file($path . '/' . $unzip)) {\n        $zip_path = $path . '/' . $unzip;\n        $ext = pathinfo($zip_path, PATHINFO_EXTENSION);\n        $isValid = true;\n    } else {\n        fm_set_msg('File not found', 'error');\n    }\n\n\n    if (($ext == \"zip\" && !class_exists('ZipArchive')) || ($ext == \"tar\" && !class_exists('PharData'))) {\n        fm_set_msg('Operations with archives are not available', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    if ($isValid) {\n        //to folder\n        $tofolder = '';\n        if (isset($_GET['tofolder'])) {\n            $tofolder = pathinfo($zip_path, PATHINFO_FILENAME);\n            if (fm_mkdir($path . '/' . $tofolder, true)) {\n                $path .= '/' . $tofolder;\n            }\n        }\n\n        if($ext == \"zip\") {\n            $zipper = new FM_Zipper();\n            $res = $zipper->unzip($zip_path, $path);\n        } elseif ($ext == \"tar\") {\n            $gzipper = new PharData($zip_path);\n            $res = $gzipper->extractTo($path);\n        }\n\n        if ($res) {\n            fm_set_msg('Archive unpacked');\n        } else {\n            fm_set_msg('Archive not unpacked', 'error');\n        }\n\n    } else {\n        fm_set_msg('File not found', 'error');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Change Perms (not for Windows)\nif (isset($_POST['chmod']) && !FM_READONLY && !FM_IS_WIN) {\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    $file = $_POST['chmod'];\n    $file = fm_clean_path($file);\n    $file = str_replace('/', '', $file);\n    if ($file == '' || (!is_file($path . '/' . $file) && !is_dir($path . '/' . $file))) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    $mode = 0;\n    if (!empty($_POST['ur'])) {\n        $mode |= 0400;\n    }\n    if (!empty($_POST['uw'])) {\n        $mode |= 0200;\n    }\n    if (!empty($_POST['ux'])) {\n        $mode |= 0100;\n    }\n    if (!empty($_POST['gr'])) {\n        $mode |= 0040;\n    }\n    if (!empty($_POST['gw'])) {\n        $mode |= 0020;\n    }\n    if (!empty($_POST['gx'])) {\n        $mode |= 0010;\n    }\n    if (!empty($_POST['or'])) {\n        $mode |= 0004;\n    }\n    if (!empty($_POST['ow'])) {\n        $mode |= 0002;\n    }\n    if (!empty($_POST['ox'])) {\n        $mode |= 0001;\n    }\n\n    if (@chmod($path . '/' . $file, $mode)) {\n        fm_set_msg('Permissions changed');\n    } else {\n        fm_set_msg('Permissions not changed', 'error');\n    }\n\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n/*************************** /ACTIONS ***************************/\n\n// get current path\n$path = FM_ROOT_PATH;\nif (FM_PATH != '') {\n    $path .= '/' . FM_PATH;\n}\n\n// check path\nif (!is_dir($path)) {\n    fm_redirect(FM_SELF_URL . '?p=');\n}\n\n// get parent folder\n$parent = fm_get_parent_path(FM_PATH);\n\n$objects = is_readable($path) ? scandir($path) : array();\n$folders = array();\n$files = array();\n$current_path = array_slice(explode(\"/\",$path), -1)[0];\nif (is_array($objects) && !in_array($current_path, $GLOBALS['exclude_items'])) {\n    foreach ($objects as $file) {\n        if ($file == '.' || $file == '..' && in_array($file, $GLOBALS['exclude_items'])) {\n            continue;\n        }\n        if (!FM_SHOW_HIDDEN && substr($file, 0, 1) === '.') {\n            continue;\n        }\n        $new_path = $path . '/' . $file;\n        if (@is_file($new_path) && !in_array($file, $GLOBALS['exclude_items'])) {\n            $files[] = $file;\n        } elseif (@is_dir($new_path) && $file != '.' && $file != '..' && !in_array($file, $GLOBALS['exclude_items'])) {\n            $folders[] = $file;\n        }\n    }\n}\n\nif (!empty($files)) {\n    natcasesort($files);\n}\nif (!empty($folders)) {\n    natcasesort($folders);\n}\n\n// upload form\nif (isset($_GET['upload']) && !FM_READONLY) {\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    ?>\n\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.css\" rel=\"stylesheet\">\n    <div class=\"path\">\n\n        <div class=\"card mb-2 fm-upload-wrapper\">\n            <div class=\"card-header\">\n                <ul class=\"nav nav-tabs card-header-tabs\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link active\" href=\"#fileUploader\" data-target=\"#fileUploader\"><i class=\"fa fa-arrow-circle-o-up\"></i> <?php echo lng('UploadingFiles') ?></a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"#urlUploader\" class=\"js-url-upload\" data-target=\"#urlUploader\"><i class=\"fa fa-link\"></i> Upload from URL</a>\n                    </li>\n                </ul>\n            </div>\n            <div class=\"card-body\">\n                <p class=\"card-text\">\n                    <a href=\"?p=<?php echo FM_PATH ?>\" class=\"float-right\"><i class=\"fa fa-chevron-circle-left go-back\"></i> <?php echo lng('Back')?></a>\n                    <?php echo lng('DestinationFolder') ?>: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?>\n                </p>\n\n                <form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]) . '?p=' . fm_enc(FM_PATH) ?>\" class=\"dropzone card-tabs-container\" id=\"fileUploader\" enctype=\"multipart/form-data\">\n                    <input type=\"hidden\" name=\"p\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    <input type=\"hidden\" name=\"fullpath\" id=\"fullpath\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    <div class=\"fallback\">\n                        <input name=\"file\" type=\"file\" multiple/>\n                    </div>\n                </form>\n\n                <div class=\"upload-url-wrapper card-tabs-container hidden\" id=\"urlUploader\">\n                    <form id=\"js-form-url-upload\" class=\"form-inline\" onsubmit=\"return upload_from_url(this);\" method=\"POST\" action=\"\">\n                        <input type=\"hidden\" name=\"type\" value=\"upload\" aria-label=\"hidden\" aria-hidden=\"true\">\n                        <input type=\"url\" placeholder=\"URL\" name=\"uploadurl\" required class=\"form-control\" style=\"width: 80%\">\n                        <button type=\"submit\" class=\"btn btn-primary ml-3\"><?php echo lng('Upload') ?></button>\n                        <div class=\"lds-facebook\"><div></div><div></div><div></div></div>\n                    </form>\n                    <div id=\"js-url-upload__list\" class=\"col-9 mt-3\"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.js\"></script>\n    <script>\n        Dropzone.options.fileUploader = {\n            timeout: 120000,\n            maxFilesize: <?php echo MAX_UPLOAD_SIZE; ?>,\n            init: function () {\n                this.on(\"sending\", function (file, xhr, formData) {\n                    let _path = (file.fullPath) ? file.fullPath : file.name;\n                    document.getElementById(\"fullpath\").value = _path;\n                    xhr.ontimeout = (function() {\n                        alert('Error: Server Timeout');\n                    });\n                }).on(\"success\", function (res) {\n                    console.log('Upload Status >> ', res.status);\n                }).on(\"error\", function(file, response) {\n                    alert(response);\n                });\n            }\n        }\n    </script>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n// copy form POST\nif (isset($_POST['copy']) && !FM_READONLY) {\n    $copy_files = $_POST['file'];\n    if (!is_array($copy_files) || empty($copy_files)) {\n        fm_set_msg('Nothing selected', 'alert');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    ?>\n    <div class=\"path\">\n        <div class=\"card\">\n            <div class=\"card-header\">\n                <h6><?php echo lng('Copying') ?></h6>\n            </div>\n            <div class=\"card-body\">\n                <form action=\"\" method=\"post\">\n                    <input type=\"hidden\" name=\"p\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    <input type=\"hidden\" name=\"finish\" value=\"1\">\n                    <?php\n                    foreach ($copy_files as $cf) {\n                        echo '<input type=\"hidden\" name=\"file[]\" value=\"' . fm_enc($cf) . '\">' . PHP_EOL;\n                    }\n                    ?>\n                    <p class=\"break-word\"><?php echo lng('Files') ?>: <b><?php echo implode('</b>, <b>', $copy_files) ?></b></p>\n                    <p class=\"break-word\"><?php echo lng('SourceFolder') ?>: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?><br>\n                        <label for=\"inp_copy_to\"><?php echo lng('DestinationFolder') ?>:</label>\n                        <?php echo FM_ROOT_PATH ?>/<input type=\"text\" name=\"copy_to\" id=\"inp_copy_to\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    </p>\n                    <p class=\"custom-checkbox custom-control\"><input type=\"checkbox\" name=\"move\" value=\"1\" id=\"js-move-files\" class=\"custom-control-input\"><label for=\"js-move-files\" class=\"custom-control-label\" style=\"vertical-align: sub\"> <?php echo lng('Move') ?></label></p>\n                    <p>\n                        <button type=\"submit\" class=\"btn btn-success\"><i class=\"fa fa-check-circle\"></i> <?php echo lng('Copy') ?></button> &nbsp;\n                        <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>\" class=\"btn btn-outline-primary\"><i class=\"fa fa-times-circle\"></i> <?php echo lng('Cancel') ?></a></b>\n                    </p>\n                </form>\n            </div>\n        </div>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n// copy form\nif (isset($_GET['copy']) && !isset($_GET['finish']) && !FM_READONLY) {\n    $copy = $_GET['copy'];\n    $copy = fm_clean_path($copy);\n    if ($copy == '' || !file_exists(FM_ROOT_PATH . '/' . $copy)) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    ?>\n    <div class=\"path\">\n        <p><b>Copying</b></p>\n        <p class=\"break-word\">\n            Source path: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . $copy)) ?><br>\n            Destination folder: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?>\n        </p>\n        <p>\n            <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode($copy) ?>&amp;finish=1\"><i class=\"fa fa-check-circle\"></i> Copy</a></b> &nbsp;\n            <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode($copy) ?>&amp;finish=1&amp;move=1\"><i class=\"fa fa-check-circle\"></i> Move</a></b> &nbsp;\n            <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>\"><i class=\"fa fa-times-circle\"></i> Cancel</a></b>\n        </p>\n        <p><i>Select folder</i></p>\n        <ul class=\"folders break-word\">\n            <?php\n            if ($parent !== false) {\n                ?>\n                <li><a href=\"?p=<?php echo urlencode($parent) ?>&amp;copy=<?php echo urlencode($copy) ?>\"><i class=\"fa fa-chevron-circle-left\"></i> ..</a></li>\n                <?php\n            }\n            foreach ($folders as $f) {\n                ?>\n                <li>\n                    <a href=\"?p=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>&amp;copy=<?php echo urlencode($copy) ?>\"><i class=\"fa fa-folder-o\"></i> <?php echo fm_convert_win($f) ?></a></li>\n                <?php\n            }\n            ?>\n        </ul>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\nif (isset($_GET['settings']) && !FM_READONLY) {\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    global $cfg, $lang, $lang_list;\n    ?>\n\n    <div class=\"col-md-8 offset-md-2 pt-3\">\n        <div class=\"card mb-2\">\n            <h6 class=\"card-header\">\n                <i class=\"fa fa-cog\"></i>  <?php echo lng('Settings') ?>\n                <a href=\"?p=<?php echo FM_PATH ?>\" class=\"float-right\"><i class=\"fa fa-window-close\"></i> <?php echo lng('Cancel')?></a>\n            </h6>\n            <div class=\"card-body\">\n                <form id=\"js-settings-form\" action=\"\" method=\"post\" data-type=\"ajax\" onsubmit=\"return save_settings(this)\">\n                    <input type=\"hidden\" name=\"type\" value=\"settings\" aria-label=\"hidden\" aria-hidden=\"true\">\n                    <div class=\"form-group row\">\n                        <label for=\"js-language\" class=\"col-sm-3 col-form-label\"><?php echo lng('Language') ?></label>\n                        <div class=\"col-sm-5\">\n                            <select class=\"form-control\" id=\"js-language\" name=\"js-language\">\n                                <?php\n                                function getSelected($l) {\n                                    global $lang;\n                                    return ($lang == $l) ? 'selected' : '';\n                                }\n                                foreach ($lang_list as $k => $v) {\n                                    echo \"<option value='$k' \".getSelected($k).\">$v</option>\";\n                                }\n                                ?>\n                            </select>\n                        </div>\n                    </div>\n                    <?php\n                    //get ON/OFF and active class\n                    function getChecked($conf, $val, $txt) {\n                        if($conf== 1 && $val ==1) {\n                            return $txt;\n                        } else if($conf == '' && $val == '') {\n                            return $txt;\n                        } else {\n                            return '';\n                        }\n                    }\n                    ?>\n                    <div class=\"form-group row\">\n                        <label for=\"js-err-rpt-1\" class=\"col-sm-3 col-form-label\"><?php echo lng('ErrorReporting') ?></label>\n                        <div class=\"col-sm-9\">\n                            <div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">\n                                <label class=\"btn btn-secondary <?php echo getChecked($report_errors, 1, 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-error-report\" id=\"js-err-rpt-1\" autocomplete=\"off\" value=\"true\" <?php echo getChecked($report_errors, 1, 'checked') ?> > ON\n                                </label>\n                                <label class=\"btn btn-secondary <?php echo getChecked($report_errors, '', 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-error-report\" id=\"js-err-rpt-0\" autocomplete=\"off\" value=\"false\" <?php echo getChecked($report_errors, '', 'checked') ?> > OFF\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label for=\"js-hdn-1\" class=\"col-sm-3 col-form-label\"><?php echo lng('ShowHiddenFiles') ?></label>\n                        <div class=\"col-sm-9\">\n                            <div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">\n                                <label class=\"btn btn-secondary <?php echo getChecked($show_hidden_files, 1, 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-show-hidden\" id=\"js-hdn-1\" autocomplete=\"off\" value=\"true\" <?php echo getChecked($show_hidden_files, 1, 'checked') ?> > ON\n                                </label>\n                                <label class=\"btn btn-secondary <?php echo getChecked($show_hidden_files, '', 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-show-hidden\" id=\"js-hdn-0\" autocomplete=\"off\" value=\"false\" <?php echo getChecked($show_hidden_files, '', 'checked') ?> > OFF\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label for=\"js-hid-1\" class=\"col-sm-3 col-form-label\"><?php echo lng('HideColumns') ?></label>\n                        <div class=\"col-sm-9\">\n                            <div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">\n                                <label class=\"btn btn-secondary <?php echo getChecked($hide_Cols, 1, 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-hide-cols\" id=\"js-hid-1\" autocomplete=\"off\" value=\"true\" <?php echo getChecked($hide_Cols, 1, 'checked') ?> > ON\n                                </label>\n                                <label class=\"btn btn-secondary <?php echo getChecked($hide_Cols, '', 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-hide-cols\" id=\"js-hid-0\" autocomplete=\"off\" value=\"false\" <?php echo getChecked($hide_Cols, '', 'checked') ?> > OFF\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label for=\"js-dir-1\" class=\"col-sm-3 col-form-label\"><?php echo lng('CalculateFolderSize') ?></label>\n                        <div class=\"col-sm-9\">\n                            <div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">\n                                <label class=\"btn btn-secondary <?php echo getChecked($calc_folder, 1, 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-calc-folder\" id=\"js-dir-1\" autocomplete=\"off\" value=\"true\" <?php echo getChecked($calc_folder, 1, 'checked') ?> > ON\n                                </label>\n                                <label class=\"btn btn-secondary <?php echo getChecked($calc_folder, '', 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-calc-folder\" id=\"js-dir-0\" autocomplete=\"off\" value=\"false\" <?php echo getChecked($calc_folder, '', 'checked') ?> > OFF\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <div class=\"col-sm-10\">\n                            <button type=\"submit\" class=\"btn btn-success\"> <i class=\"fa fa-check-circle\"></i> <?php echo lng('Save'); ?></button>\n                        </div>\n                    </div>\n\n                </form>\n            </div>\n        </div>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\nif (isset($_GET['help'])) {\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    global $cfg, $lang;\n    ?>\n\n    <div class=\"col-md-8 offset-md-2 pt-3\">\n        <div class=\"card mb-2\">\n            <h6 class=\"card-header\">\n                <i class=\"fa fa-exclamation-circle\"></i> <?php echo lng('Help') ?>\n                <a href=\"?p=<?php echo FM_PATH ?>\" class=\"float-right\"><i class=\"fa fa-window-close\"></i> <?php echo lng('Cancel')?></a>\n            </h6>\n            <div class=\"card-body\">\n                <div class=\"row\">\n                    <div class=\"col-xs-12 col-sm-6\">\n                        <p><h3><a href=\"https://github.com/prasathmani/tinyfilemanager\" target=\"_blank\" class=\"app-v-title\"> Tiny File Manager <?php echo VERSION; ?></a></h3></p>\n                        <p>Author: Prasath Mani</p>\n                        <p>Mail Us: <a href=\"mailto:ccpprogrammers@gmail.com\">ccpprogrammers[at]gmail.com</a> </p>\n                    </div>\n                    <div class=\"col-xs-12 col-sm-6\">\n                        <div class=\"card\">\n                            <ul class=\"list-group list-group-flush\">\n                                <li class=\"list-group-item\"><a href=\"https://tinyfilemanager.github.io/docs/\" target=\"_blank\"><i class=\"fa fa-question-circle\"></i> <?php echo lng('Help Documents') ?> </a> </li>\n                                <li class=\"list-group-item\"><a href=\"https://github.com/prasathmani/tinyfilemanager/issues\" target=\"_blank\"><i class=\"fa fa-bug\"></i> <?php echo lng('Report Issue') ?></a></li>\n                                <li class=\"list-group-item\"><a href=\"javascript:latest_release_info('<?php echo VERSION; ?>');\"><i class=\"fa fa-link\"> </i> <?php echo lng('Check Latest Version') ?></a></li>\n                                <?php if(!FM_READONLY) { ?>\n                                <li class=\"list-group-item\"><a href=\"javascript:show_new_pwd();\"><i class=\"fa fa-lock\"></i> <?php echo lng('Generate new password hash') ?></a></li>\n                                <?php } ?>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"row js-new-pwd hidden mt-2\">\n                    <div class=\"col-12\">\n                        <form class=\"form-inline\" onsubmit=\"return new_password_hash(this)\" method=\"POST\" action=\"\">\n                            <input type=\"hidden\" name=\"type\" value=\"pwdhash\" aria-label=\"hidden\" aria-hidden=\"true\">\n                            <div class=\"form-group mb-2\">\n                                <label for=\"staticEmail2\"><?php echo lng('Generate new password hash') ?></label>\n                            </div>\n                            <div class=\"form-group mx-sm-3 mb-2\">\n                                <label for=\"inputPassword2\" class=\"sr-only\"><?php echo lng('Password') ?></label>\n                                <input type=\"text\" class=\"form-control btn-sm\" id=\"inputPassword2\" name=\"inputPassword2\" placeholder=\"Password\" required>\n                            </div>\n                            <button type=\"submit\" class=\"btn btn-success btn-sm mb-2\"><?php echo lng('Generate') ?></button>\n                        </form>\n                        <textarea class=\"form-control\" rows=\"2\" readonly id=\"js-pwd-result\"></textarea>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n// file viewer\nif (isset($_GET['view'])) {\n    $file = $_GET['view'];\n    $quickView = (isset($_GET['quickView']) && $_GET['quickView'] == 1) ? true : false;\n    $file = fm_clean_path($file, false);\n    $file = str_replace('/', '', $file);\n    if ($file == '' || !is_file($path . '/' . $file) || in_array($file, $GLOBALS['exclude_items'])) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    if(!$quickView) {\n        fm_show_header(); // HEADER\n        fm_show_nav_path(FM_PATH); // current path\n    }\n\n    $file_url = FM_ROOT_URL . fm_convert_win((FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file);\n    $file_path = $path . '/' . $file;\n\n    $ext = strtolower(pathinfo($file_path, PATHINFO_EXTENSION));\n    $mime_type = fm_get_mime_type($file_path);\n    $filesize = fm_get_filesize(filesize($file_path));\n\n    $is_zip = false;\n    $is_gzip = false;\n    $is_image = false;\n    $is_audio = false;\n    $is_video = false;\n    $is_text = false;\n    $is_onlineViewer = false;\n\n    $view_title = 'File';\n    $filenames = false; // for zip\n    $content = ''; // for text\n    $online_viewer = strtolower($GLOBALS['online_viewer']);\n\n    if($online_viewer && $online_viewer !== 'false' && in_array($ext, fm_get_onlineViewer_exts())){\n        $is_onlineViewer = true;\n    }\n    elseif ($ext == 'zip' || $ext == 'tar') {\n        $is_zip = true;\n        $view_title = 'Archive';\n        $filenames = fm_get_zif_info($file_path, $ext);\n    } elseif (in_array($ext, fm_get_image_exts())) {\n        $is_image = true;\n        $view_title = 'Image';\n    } elseif (in_array($ext, fm_get_audio_exts())) {\n        $is_audio = true;\n        $view_title = 'Audio';\n    } elseif (in_array($ext, fm_get_video_exts())) {\n        $is_video = true;\n        $view_title = 'Video';\n    } elseif (in_array($ext, fm_get_text_exts()) || substr($mime_type, 0, 4) == 'text' || in_array($mime_type, fm_get_text_mimes())) {\n        $is_text = true;\n        $content = file_get_contents($file_path);\n    }\n\n    ?>\n    <div class=\"row\">\n        <div class=\"col-12\">\n            <?php if(!$quickView) { ?>\n                <p class=\"break-word\"><b><?php echo $view_title ?> \"<?php echo fm_enc(fm_convert_win($file)) ?>\"</b></p>\n                <p class=\"break-word\">\n                    Full path: <?php echo fm_enc(fm_convert_win($file_path)) ?><br>\n                    File\n                    size: <?php echo fm_get_filesize($filesize) ?><?php if ($filesize >= 1000): ?> (<?php echo sprintf('%s bytes', $filesize) ?>)<?php endif; ?>\n                    <br>\n                    MIME-type: <?php echo $mime_type ?><br>\n                    <?php\n                    // ZIP info\n                    if (($is_zip || $is_gzip) && $filenames !== false) {\n                        $total_files = 0;\n                        $total_comp = 0;\n                        $total_uncomp = 0;\n                        foreach ($filenames as $fn) {\n                            if (!$fn['folder']) {\n                                $total_files++;\n                            }\n                            $total_comp += $fn['compressed_size'];\n                            $total_uncomp += $fn['filesize'];\n                        }\n                        ?>\n                        Files in archive: <?php echo $total_files ?><br>\n                        Total size: <?php echo fm_get_filesize($total_uncomp) ?><br>\n                        Size in archive: <?php echo fm_get_filesize($total_comp) ?><br>\n                        Compression: <?php echo round(($total_comp / $total_uncomp) * 100) ?>%<br>\n                        <?php\n                    }\n                    // Image info\n                    if ($is_image) {\n                        $image_size = getimagesize($file_path);\n                        echo 'Image sizes: ' . (isset($image_size[0]) ? $image_size[0] : '0') . ' x ' . (isset($image_size[1]) ? $image_size[1] : '0') . '<br>';\n                    }\n                    // Text info\n                    if ($is_text) {\n                        $is_utf8 = fm_is_utf8($content);\n                        if (function_exists('iconv')) {\n                            if (!$is_utf8) {\n                                $content = iconv(FM_ICONV_INPUT_ENC, 'UTF-8//IGNORE', $content);\n                            }\n                        }\n                        echo 'Charset: ' . ($is_utf8 ? 'utf-8' : '8 bit') . '<br>';\n                    }\n                    ?>\n                </p>\n                <p>\n                    <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;dl=<?php echo urlencode($file) ?>\"><i class=\"fa fa-cloud-download\"></i> <?php echo lng('Download') ?></a></b> &nbsp;\n                    <b><a href=\"<?php echo fm_enc($file_url) ?>\" target=\"_blank\"><i class=\"fa fa-external-link-square\"></i> <?php echo lng('Open') ?></a></b>\n                    &nbsp;\n                    <?php\n                    // ZIP actions\n                    if (!FM_READONLY && ($is_zip || $is_gzip) && $filenames !== false) {\n                        $zip_name = pathinfo($file_path, PATHINFO_FILENAME);\n                        ?>\n                        <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;unzip=<?php echo urlencode($file) ?>\"><i class=\"fa fa-check-circle\"></i> <?php echo lng('UnZip') ?></a></b> &nbsp;\n                        <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;unzip=<?php echo urlencode($file) ?>&amp;tofolder=1\" title=\"UnZip to <?php echo fm_enc($zip_name) ?>\"><i class=\"fa fa-check-circle\"></i>\n                                <?php echo lng('UnZipToFolder') ?></a></b> &nbsp;\n                        <?php\n                    }\n                    if ($is_text && !FM_READONLY) {\n                        ?>\n                        <b><a href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>\" class=\"edit-file\"><i class=\"fa fa-pencil-square\"></i> <?php echo lng('Edit') ?>\n                            </a></b> &nbsp;\n                        <b><a href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>&env=ace\"\n                              class=\"edit-file\"><i class=\"fa fa-pencil-square-o\"></i> <?php echo lng('AdvancedEditor') ?>\n                            </a></b> &nbsp;\n                    <?php } ?>\n                    <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>\"><i class=\"fa fa-chevron-circle-left go-back\"></i> <?php echo lng('Back') ?></a></b>\n                </p>\n                <?php\n            }\n            if($is_onlineViewer) {\n                if($online_viewer == 'google') {\n                    echo '<iframe src=\"https://docs.google.com/viewer?embedded=true&hl=en&url=' . fm_enc($file_url) . '\" frameborder=\"no\" style=\"width:100%;min-height:460px\"></iframe>';\n                } else if($online_viewer == 'microsoft') {\n                    echo '<iframe src=\"https://view.officeapps.live.com/op/embed.aspx?src=' . fm_enc($file_url) . '\" frameborder=\"no\" style=\"width:100%;min-height:460px\"></iframe>';\n                }\n            } elseif ($is_zip) {\n                // ZIP content\n                if ($filenames !== false) {\n                    echo '<code class=\"maxheight\">';\n                    foreach ($filenames as $fn) {\n                        if ($fn['folder']) {\n                            echo '<b>' . fm_enc($fn['name']) . '</b><br>';\n                        } else {\n                            echo $fn['name'] . ' (' . fm_get_filesize($fn['filesize']) . ')<br>';\n                        }\n                    }\n                    echo '</code>';\n                } else {\n                    echo '<p>Error while fetching archive info</p>';\n                }\n            } elseif ($is_image) {\n                // Image content\n                if (in_array($ext, array('gif', 'jpg', 'jpeg', 'png', 'bmp', 'ico', 'svg'))) {\n                    echo '<p><img src=\"' . fm_enc($file_url) . '\" alt=\"\" class=\"preview-img\"></p>';\n                }\n            } elseif ($is_audio) {\n                // Audio content\n                echo '<p><audio src=\"' . fm_enc($file_url) . '\" controls preload=\"metadata\"></audio></p>';\n            } elseif ($is_video) {\n                // Video content\n                echo '<div class=\"preview-video\"><video src=\"' . fm_enc($file_url) . '\" width=\"640\" height=\"360\" controls preload=\"metadata\"></video></div>';\n            } elseif ($is_text) {\n                if (FM_USE_HIGHLIGHTJS) {\n                    // highlight\n                    $hljs_classes = array(\n                        'shtml' => 'xml',\n                        'htaccess' => 'apache',\n                        'phtml' => 'php',\n                        'lock' => 'json',\n                        'svg' => 'xml',\n                    );\n                    $hljs_class = isset($hljs_classes[$ext]) ? 'lang-' . $hljs_classes[$ext] : 'lang-' . $ext;\n                    if (empty($ext) || in_array(strtolower($file), fm_get_text_names()) || preg_match('#\\.min\\.(css|js)$#i', $file)) {\n                        $hljs_class = 'nohighlight';\n                    }\n                    $content = '<pre class=\"with-hljs\"><code class=\"' . $hljs_class . '\">' . fm_enc($content) . '</code></pre>';\n                } elseif (in_array($ext, array('php', 'php4', 'php5', 'phtml', 'phps'))) {\n                    // php highlight\n                    $content = highlight_string($content, true);\n                } else {\n                    $content = '<pre>' . fm_enc($content) . '</pre>';\n                }\n                echo $content;\n            }\n            ?>\n        </div>\n    </div>\n    <?php\n    if(!$quickView) {\n        fm_show_footer();\n    }\n    exit;\n}\n\n// file editor\nif (isset($_GET['edit'])) {\n    $file = $_GET['edit'];\n    $file = fm_clean_path($file, false);\n    $file = str_replace('/', '', $file);\n    if ($file == '' || !is_file($path . '/' . $file)) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n    header('X-XSS-Protection:0');\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n\n    $file_url = FM_ROOT_URL . fm_convert_win((FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file);\n    $file_path = $path . '/' . $file;\n\n    // normal editer\n    $isNormalEditor = true;\n    if (isset($_GET['env'])) {\n        if ($_GET['env'] == \"ace\") {\n            $isNormalEditor = false;\n        }\n    }\n\n    // Save File\n    if (isset($_POST['savedata'])) {\n        $writedata = $_POST['savedata'];\n        $fd = fopen($file_path, \"w\");\n        @fwrite($fd, $writedata);\n        fclose($fd);\n        fm_set_msg('File Saved Successfully');\n    }\n\n    $ext = strtolower(pathinfo($file_path, PATHINFO_EXTENSION));\n    $mime_type = fm_get_mime_type($file_path);\n    $filesize = filesize($file_path);\n    $is_text = false;\n    $content = ''; // for text\n\n    if (in_array($ext, fm_get_text_exts()) || substr($mime_type, 0, 4) == 'text' || in_array($mime_type, fm_get_text_mimes())) {\n        $is_text = true;\n        $content = file_get_contents($file_path);\n    }\n\n    ?>\n    <div class=\"path\">\n        <div class=\"row\">\n            <div class=\"col-xs-12 col-sm-5 col-lg-6 pt-1\">\n                <div class=\"btn-toolbar\" role=\"toolbar\">\n                    <?php if (!$isNormalEditor) { ?>\n                        <div class=\"btn-group js-ace-toolbar\">\n                            <button data-cmd=\"none\" data-option=\"fullscreen\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-fullscreen\" title=\"Fullscreen\"><i class=\"fa fa-expand\" title=\"Fullscreen\"></i></button>\n                            <button data-cmd=\"find\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-search\" title=\"Search\"><i class=\"fa fa-search\" title=\"Search\"></i></button>\n                            <button data-cmd=\"undo\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-undo\" title=\"Undo\"><i class=\"fa fa-undo\" title=\"Undo\"></i></button>\n                            <button data-cmd=\"redo\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-redo\" title=\"Redo\"><i class=\"fa fa-repeat\" title=\"Redo\"></i></button>\n                            <button data-cmd=\"none\" data-option=\"wrap\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-wordWrap\" title=\"Word Wrap\"><i class=\"fa fa-text-width\" title=\"Word Wrap\"></i></button>\n                            <button data-cmd=\"none\" data-option=\"help\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-goLine\" title=\"Help\"><i class=\"fa fa-question\" title=\"Help\"></i></button>\n                            <select id=\"js-ace-mode\" data-type=\"mode\" title=\"Select Document Type\" class=\"btn-outline-secondary border-left-0 d-none d-md-block\"><option>-- Select Mode --</option></select>\n                            <select id=\"js-ace-theme\" data-type=\"theme\" title=\"Select Theme\" class=\"btn-outline-secondary border-left-0 d-none d-lg-block\"><option>-- Select Theme --</option></select>\n                            <select id=\"js-ace-fontSize\" data-type=\"fontSize\" title=\"Selct Font Size\" class=\"btn-outline-secondary border-left-0 d-none d-lg-block\"><option>-- Select Font Size --</option></select>\n                        </div>\n                    <?php } ?>\n                </div>\n            </div>\n            <div class=\"edit-file-actions col-xs-12 col-sm-7 col-lg-6 text-right pt-1\">\n                <a title=\"Back\" class=\"btn btn-sm btn-outline-primary\" href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;view=<?php echo urlencode($file) ?>\"><i class=\"fa fa-reply-all\"></i> <?php echo lng('Back') ?></a>\n                <a title=\"Backup\" class=\"btn btn-sm btn-outline-primary\" href=\"javascript:backup('<?php echo urlencode($path) ?>','<?php echo urlencode($file) ?>')\"><i class=\"fa fa-database\"></i> <?php echo lng('BackUp') ?></a>\n                <?php if ($is_text) { ?>\n                    <?php if ($isNormalEditor) { ?>\n                        <a title=\"Advanced\" class=\"btn btn-sm btn-outline-primary\" href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>&amp;env=ace\"><i class=\"fa fa-pencil-square-o\"></i> <?php echo lng('AdvancedEditor') ?></a>\n                        <button type=\"button\" class=\"btn btn-sm btn-outline-primary name=\"Save\" data-url=\"<?php echo fm_enc($file_url) ?>\" onclick=\"edit_save(this,'nrl')\"><i class=\"fa fa-floppy-o\"></i> Save\n                        </button>\n                    <?php } else { ?>\n                        <a title=\"Plain Editor\" class=\"btn btn-sm btn-outline-primary\" href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>\"><i class=\"fa fa-text-height\"></i> <?php echo lng('NormalEditor') ?></a>\n                        <button type=\"button\" class=\"btn btn-sm btn-outline-primary\" name=\"Save\" data-url=\"<?php echo fm_enc($file_url) ?>\" onclick=\"edit_save(this,'ace')\"><i class=\"fa fa-floppy-o\"></i> <?php echo lng('Save') ?>\n                        </button>\n                    <?php } ?>\n                <?php } ?>\n            </div>\n        </div>\n        <?php\n        if ($is_text && $isNormalEditor) {\n            echo '<textarea class=\"mt-2\" id=\"normal-editor\" rows=\"33\" cols=\"120\" style=\"width: 99.5%;\">' . htmlspecialchars($content) . '</textarea>';\n        } elseif ($is_text) {\n            echo '<div id=\"editor\" contenteditable=\"true\">' . htmlspecialchars($content) . '</div>';\n        } else {\n            fm_set_msg('FILE EXTENSION HAS NOT SUPPORTED', 'error');\n        }\n        ?>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n// chmod (not for Windows)\nif (isset($_GET['chmod']) && !FM_READONLY && !FM_IS_WIN) {\n    $file = $_GET['chmod'];\n    $file = fm_clean_path($file);\n    $file = str_replace('/', '', $file);\n    if ($file == '' || (!is_file($path . '/' . $file) && !is_dir($path . '/' . $file))) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n\n    $file_url = FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file;\n    $file_path = $path . '/' . $file;\n\n    $mode = fileperms($path . '/' . $file);\n\n    ?>\n    <div class=\"path\">\n        <div class=\"card mb-2\">\n            <h6 class=\"card-header\">\n                <?php echo lng('ChangePermissions') ?>\n            </h6>\n            <div class=\"card-body\">\n                <p class=\"card-text\">\n                    Full path: <?php echo $file_path ?><br>\n                </p>\n                <form action=\"\" method=\"post\">\n                    <input type=\"hidden\" name=\"p\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    <input type=\"hidden\" name=\"chmod\" value=\"<?php echo fm_enc($file) ?>\">\n\n                    <table class=\"table compact-table\">\n                        <tr>\n                            <td></td>\n                            <td><b><?php echo lng('Owner') ?></b></td>\n                            <td><b><?php echo lng('Group') ?></b></td>\n                            <td><b><?php echo lng('Other') ?></b></td>\n                        </tr>\n                        <tr>\n                            <td style=\"text-align: right\"><b><?php echo lng('Read') ?></b></td>\n                            <td><label><input type=\"checkbox\" name=\"ur\" value=\"1\"<?php echo ($mode & 00400) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"gr\" value=\"1\"<?php echo ($mode & 00040) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"or\" value=\"1\"<?php echo ($mode & 00004) ? ' checked' : '' ?>></label></td>\n                        </tr>\n                        <tr>\n                            <td style=\"text-align: right\"><b><?php echo lng('Write') ?></b></td>\n                            <td><label><input type=\"checkbox\" name=\"uw\" value=\"1\"<?php echo ($mode & 00200) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"gw\" value=\"1\"<?php echo ($mode & 00020) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"ow\" value=\"1\"<?php echo ($mode & 00002) ? ' checked' : '' ?>></label></td>\n                        </tr>\n                        <tr>\n                            <td style=\"text-align: right\"><b><?php echo lng('Execute') ?></b></td>\n                            <td><label><input type=\"checkbox\" name=\"ux\" value=\"1\"<?php echo ($mode & 00100) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"gx\" value=\"1\"<?php echo ($mode & 00010) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"ox\" value=\"1\"<?php echo ($mode & 00001) ? ' checked' : '' ?>></label></td>\n                        </tr>\n                    </table>\n\n                    <p>\n                        <button type=\"submit\" class=\"btn btn-success\"><i class=\"fa fa-check-circle\"></i> <?php echo lng('Change') ?></button> &nbsp;\n                        <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>\" class=\"btn btn-outline-primary\"><i class=\"fa fa-times-circle\"></i> <?php echo lng('Cancel') ?></a></b>\n                    </p>\n                </form>\n            </div>\n        </div>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n//--- FILEMANAGER MAIN\nfm_show_header(); // HEADER\nfm_show_nav_path(FM_PATH); // current path\n\n// messages\nfm_show_message();\n\n$num_files = count($files);\n$num_folders = count($folders);\n$all_files_size = 0;\n?>\n<form action=\"\" method=\"post\" class=\"pt-3\">\n    <input type=\"hidden\" name=\"p\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n    <input type=\"hidden\" name=\"group\" value=\"1\">\n    <div class=\"table-responsive\">\n        <table class=\"table table-bordered table-hover table-sm bg-white\" id=\"main-table\">\n            <thead class=\"thead-white\">\n            <tr>\n                <?php if (!FM_READONLY): ?>\n                    <th style=\"width:3%\" class=\"custom-checkbox-header\">\n                        <div class=\"custom-control custom-checkbox\">\n                            <input type=\"checkbox\" class=\"custom-control-input\" id=\"js-select-all-items\" onclick=\"checkbox_toggle()\">\n                            <label class=\"custom-control-label\" for=\"js-select-all-items\"></label>\n                        </div>\n                    </th><?php endif; ?>\n                <th><?php echo lng('Name') ?></th>\n                <th><?php echo lng('Size') ?></th>\n                <th><?php echo lng('Modified') ?></th>\n                <?php if (!FM_IS_WIN && !$hide_Cols): ?>\n                    <th><?php echo lng('Perms') ?></th>\n                    <th><?php echo lng('Owner') ?></th><?php endif; ?>\n                <th><?php echo lng('Actions') ?></th>\n            </tr>\n            </thead>\n            <?php\n            // link to parent folder\n            if ($parent !== false) {\n                ?>\n                <tr><?php if (!FM_READONLY): ?>\n                    <td class=\"nosort\"></td><?php endif; ?>\n                    <td class=\"border-0\"><a href=\"?p=<?php echo urlencode($parent) ?>\"><i class=\"fa fa-chevron-circle-left go-back\"></i> ..</a></td>\n                    <td class=\"border-0\"></td>\n                    <td class=\"border-0\"></td>\n                    <td class=\"border-0\"></td>\n                    <?php if (!FM_IS_WIN && !$hide_Cols) { ?>\n                        <td class=\"border-0\"></td>\n                        <td class=\"border-0\"></td>\n                    <?php } ?>\n                </tr>\n                <?php\n            }\n            $ii = 3399;\n            foreach ($folders as $f) {\n                $is_link = is_link($path . '/' . $f);\n                $img = $is_link ? 'icon-link_folder' : 'fa fa-folder-o';\n                $modif = date(FM_DATETIME_FORMAT, filemtime($path . '/' . $f));\n                $perms = substr(decoct(fileperms($path . '/' . $f)), -4);\n                if (function_exists('posix_getpwuid') && function_exists('posix_getgrgid')) {\n                    $owner = posix_getpwuid(fileowner($path . '/' . $f));\n                    $group = posix_getgrgid(filegroup($path . '/' . $f));\n                } else {\n                    $owner = array('name' => '?');\n                    $group = array('name' => '?');\n                }\n                ?>\n                <tr>\n                    <?php if (!FM_READONLY): ?>\n                        <td class=\"custom-checkbox-td\">\n                        <div class=\"custom-control custom-checkbox\">\n                            <input type=\"checkbox\" class=\"custom-control-input\" id=\"<?php echo $ii ?>\" name=\"file[]\" value=\"<?php echo fm_enc($f) ?>\">\n                            <label class=\"custom-control-label\" for=\"<?php echo $ii ?>\"></label>\n                        </div>\n                        </td><?php endif; ?>\n                    <td>\n                        <div class=\"filename\"><a href=\"?p=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>\"><i class=\"<?php echo $img ?>\"></i> <?php echo fm_convert_win($f) ?>\n                            </a><?php echo($is_link ? ' &rarr; <i>' . readlink($path . '/' . $f) . '</i>' : '') ?></div>\n                    </td>\n                    <td><?php if ($calc_folder) { echo fm_get_directorysize($path . '/' . $f); } else { echo lng('Folder'); } ?></td>\n                    <td><?php echo $modif ?></td>\n                    <?php if (!FM_IS_WIN && !$hide_Cols): ?>\n                        <td><?php if (!FM_READONLY): ?><a title=\"Change Permissions\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;chmod=<?php echo urlencode($f) ?>\"><?php echo $perms ?></a><?php else: ?><?php echo $perms ?><?php endif; ?>\n                        </td>\n                        <td><?php echo $owner['name'] . ':' . $group['name'] ?></td>\n                    <?php endif; ?>\n                    <td class=\"inline-actions\"><?php if (!FM_READONLY): ?>\n                            <a title=\"<?php echo lng('Delete')?>\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;del=<?php echo urlencode($f) ?>\" onclick=\"return confirm('Delete folder?');\"><i class=\"fa fa-trash-o\" aria-hidden=\"true\"></i></a>\n                            <a title=\"<?php echo lng('Rename')?>\" href=\"#\" onclick=\"rename('<?php echo fm_enc(FM_PATH) ?>', '<?php echo fm_enc(addslashes($f)) ?>');return false;\"><i class=\"fa fa-pencil-square-o\" aria-hidden=\"true\"></i></a>\n                            <a title=\"<?php echo lng('CopyTo')?>...\" href=\"?p=&amp;copy=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>\"><i class=\"fa fa-files-o\" aria-hidden=\"true\"></i></a>\n                        <?php endif; ?>\n                        <a title=\"<?php echo lng('DirectLink')?>\" href=\"<?php echo fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f . '/') ?>\" target=\"_blank\"><i class=\"fa fa-link\" aria-hidden=\"true\"></i></a>\n                    </td>\n                </tr>\n                <?php\n                flush();\n                $ii++;\n            }\n            $ik = 6070;\n            foreach ($files as $f) {\n                $is_link = is_link($path . '/' . $f);\n                $img = $is_link ? 'fa fa-file-text-o' : fm_get_file_icon_class($path . '/' . $f);\n                $modif = date(FM_DATETIME_FORMAT, filemtime($path . '/' . $f));\n                $filesize_raw = fm_get_size($path . '/' . $f);\n                $filesize = fm_get_filesize($filesize_raw);\n                $filelink = '?p=' . urlencode(FM_PATH) . '&amp;view=' . urlencode($f);\n                $all_files_size += $filesize_raw;\n                $perms = substr(decoct(fileperms($path . '/' . $f)), -4);\n                if (function_exists('posix_getpwuid') && function_exists('posix_getgrgid')) {\n                    $owner = posix_getpwuid(fileowner($path . '/' . $f));\n                    $group = posix_getgrgid(filegroup($path . '/' . $f));\n                } else {\n                    $owner = array('name' => '?');\n                    $group = array('name' => '?');\n                }\n                ?>\n                <tr>\n                    <?php if (!FM_READONLY): ?>\n                        <td class=\"custom-checkbox-td\">\n                        <div class=\"custom-control custom-checkbox\">\n                            <input type=\"checkbox\" class=\"custom-control-input\" id=\"<?php echo $ik ?>\" name=\"file[]\" value=\"<?php echo fm_enc($f) ?>\">\n                            <label class=\"custom-control-label\" for=\"<?php echo $ik ?>\"></label>\n                        </div>\n                        </td><?php endif; ?>\n                    <td>\n                        <div class=\"filename\"><a href=\"<?php echo $filelink ?>\" title=\"File info\"><i class=\"<?php echo $img ?>\"></i> <?php echo fm_convert_win($f) ?>\n                            </a><?php echo($is_link ? ' &rarr; <i>' . readlink($path . '/' . $f) . '</i>' : '') ?></div>\n                    </td>\n                    <td><span title=\"<?php printf('%s bytes', $filesize_raw) ?>\">\n                        <?php echo $filesize; ?>\n                        </span></td>\n                    <td><?php echo $modif ?></td>\n                    <?php if (!FM_IS_WIN && !$hide_Cols): ?>\n                        <td><?php if (!FM_READONLY): ?><a title=\"<?php echo 'Change Permissions' ?>\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;chmod=<?php echo urlencode($f) ?>\"><?php echo $perms ?></a><?php else: ?><?php echo $perms ?><?php endif; ?>\n                        </td>\n                        <td><?php echo fm_enc($owner['name'] . ':' . $group['name']) ?></td>\n                    <?php endif; ?>\n                    <td class=\"inline-actions\">\n                        <?php if (!FM_READONLY): ?>\n                            <a title=\"<?php echo lng('Preview') ?>\" href=\"<?php echo $filelink.'&quickView=1'; ?>\" data-toggle=\"lightbox\" data-gallery=\"tiny-gallery\" data-title=\"<?php echo fm_convert_win($f) ?>\" data-max-width=\"100%\" data-width=\"100%\"><i class=\"fa fa-eye\"></i></a>\n                            <a title=\"<?php echo lng('Delete') ?>\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;del=<?php echo urlencode($f) ?>\" onclick=\"return confirm('<?php echo lng('Delete').' '.lng('File').'?'; ?>');\"><i class=\"fa fa-trash-o\"></i></a>\n                            <a title=\"<?php echo lng('Rename') ?>\" href=\"#\" onclick=\"rename('<?php echo fm_enc(FM_PATH) ?>', '<?php echo fm_enc(addslashes($f)) ?>');return false;\"><i class=\"fa fa-pencil-square-o\"></i></a>\n                            <a title=\"<?php echo lng('CopyTo') ?>...\"\n                               href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>\"><i class=\"fa fa-files-o\"></i></a>\n                        <?php endif; ?>\n                        <a title=\"<?php echo lng('DirectLink') ?>\" href=\"<?php echo fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f) ?>\" target=\"_blank\"><i class=\"fa fa-link\"></i></a>\n                        <a title=\"<?php echo lng('Download') ?>\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;dl=<?php echo urlencode($f) ?>\"><i class=\"fa fa-download\"></i></a>\n                    </td>\n                </tr>\n                <?php\n                flush();\n                $ik++;\n            }\n\n            if (empty($folders) && empty($files)) {\n                ?>\n                <tfoot>\n                    <tr><?php if (!FM_READONLY): ?>\n                            <td></td><?php endif; ?>\n                        <td colspan=\"<?php echo (!FM_IS_WIN && !$hide_Cols) ? '6' : '4' ?>\"><em><?php echo 'Folder is empty' ?></em></td>\n                    </tr>\n                </tfoot>\n                <?php\n            } else {\n                ?>\n                <tfoot>\n                    <tr><?php if (!FM_READONLY): ?>\n                            <td class=\"gray\"></td><?php endif; ?>\n                        <td class=\"gray\" colspan=\"<?php echo (!FM_IS_WIN && !$hide_Cols) ? '6' : '4' ?>\">\n                            <?php echo lng('FullSize').': <span class=\"badge badge-light\">'.fm_get_filesize($all_files_size).'</span>' ?>\n                            <?php echo lng('File').': <span class=\"badge badge-light\">'.$num_files.'</span>' ?>\n                            <?php echo lng('Folder').': <span class=\"badge badge-light\">'.$num_folders.'</span>' ?>\n                            <?php echo lng('MemoryUsed').': <span class=\"badge badge-light\">'.fm_get_filesize(@memory_get_usage(true)).'</span>' ?>\n                            <?php echo lng('PartitionSize').': <span class=\"badge badge-light\">'.fm_get_filesize(@disk_free_space($path)) .'</span> '.lng('FreeOf').' <span class=\"badge badge-light\">'.fm_get_filesize(@disk_total_space($path)).'</span>'; ?>\n                        </td>\n                    </tr>\n                </tfoot>\n                <?php\n            }\n            ?>\n        </table>\n    </div>\n\n    <div class=\"row\">\n        <?php if (!FM_READONLY): ?>\n        <div class=\"col-xs-12 col-sm-9\">\n            <ul class=\"list-inline footer-action\">\n                <li class=\"list-inline-item\"> <a href=\"#/select-all\" class=\"btn btn-small btn-outline-primary btn-2\" onclick=\"select_all();return false;\"><i class=\"fa fa-check-square\"></i> <?php echo lng('SelectAll') ?> </a></li>\n                <li class=\"list-inline-item\"><a href=\"#/unselect-all\" class=\"btn btn-small btn-outline-primary btn-2\" onclick=\"unselect_all();return false;\"><i class=\"fa fa-window-close\"></i> <?php echo lng('UnSelectAll') ?> </a></li>\n                <li class=\"list-inline-item\"><a href=\"#/invert-all\" class=\"btn btn-small btn-outline-primary btn-2\" onclick=\"invert_all();return false;\"><i class=\"fa fa-th-list\"></i> <?php echo lng('InvertSelection') ?> </a></li>\n                <li class=\"list-inline-item\"><input type=\"submit\" class=\"hidden\" name=\"delete\" id=\"a-delete\" value=\"Delete\" onclick=\"return confirm('Delete selected files and folders?')\">\n                    <a href=\"javascript:document.getElementById('a-delete').click();\" class=\"btn btn-small btn-outline-primary btn-2\"><i class=\"fa fa-trash\"></i> <?php echo lng('Delete') ?> </a></li>\n                <li class=\"list-inline-item\"><input type=\"submit\" class=\"hidden\" name=\"zip\" id=\"a-zip\" value=\"zip\" onclick=\"return confirm('Create archive?')\">\n                    <a href=\"javascript:document.getElementById('a-zip').click();\" class=\"btn btn-small btn-outline-primary btn-2\"><i class=\"fa fa-file-archive-o\"></i> <?php echo lng('Zip') ?> </a></li>\n                <li class=\"list-inline-item\"><input type=\"submit\" class=\"hidden\" name=\"tar\" id=\"a-tar\" value=\"tar\" onclick=\"return confirm('Create archive?')\">\n                    <a href=\"javascript:document.getElementById('a-tar').click();\" class=\"btn btn-small btn-outline-primary btn-2\"><i class=\"fa fa-file-archive-o\"></i> <?php echo lng('Tar') ?> </a></li>\n                <li class=\"list-inline-item\"><input type=\"submit\" class=\"hidden\" name=\"copy\" id=\"a-copy\" value=\"Copy\">\n                    <a href=\"javascript:document.getElementById('a-copy').click();\" class=\"btn btn-small btn-outline-primary btn-2\"><i class=\"fa fa-files-o\"></i> <?php echo lng('Copy') ?> </a></li>\n            </ul>\n        </div>\n        <div class=\"col-3 d-none d-sm-block\"><a href=\"https://tinyfilemanager.github.io\" target=\"_blank\" class=\"float-right text-muted\">Tiny File Manager <?php echo VERSION; ?></a></div>\n        <?php else: ?>\n            <div class=\"col-12\"><a href=\"https://tinyfilemanager.github.io\" target=\"_blank\" class=\"float-right text-muted\">Tiny File Manager <?php echo VERSION; ?></a></div>\n        <?php endif; ?>\n    </div>\n\n</form>\n\n<?php\nfm_show_footer();\n\n//--- END\n\n// Functions\n\n/**\n * Delete  file or folder (recursively)\n * @param string $path\n * @return bool\n */\nfunction fm_rdelete($path)\n{\n    if (is_link($path)) {\n        return unlink($path);\n    } elseif (is_dir($path)) {\n        $objects = scandir($path);\n        $ok = true;\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (!fm_rdelete($path . '/' . $file)) {\n                        $ok = false;\n                    }\n                }\n            }\n        }\n        return ($ok) ? rmdir($path) : false;\n    } elseif (is_file($path)) {\n        return unlink($path);\n    }\n    return false;\n}\n\n/**\n * Recursive chmod\n * @param string $path\n * @param int $filemode\n * @param int $dirmode\n * @return bool\n * @todo Will use in mass chmod\n */\nfunction fm_rchmod($path, $filemode, $dirmode)\n{\n    if (is_dir($path)) {\n        if (!chmod($path, $dirmode)) {\n            return false;\n        }\n        $objects = scandir($path);\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (!fm_rchmod($path . '/' . $file, $filemode, $dirmode)) {\n                        return false;\n                    }\n                }\n            }\n        }\n        return true;\n    } elseif (is_link($path)) {\n        return true;\n    } elseif (is_file($path)) {\n        return chmod($path, $filemode);\n    }\n    return false;\n}\n\n/**\n * Safely rename\n * @param string $old\n * @param string $new\n * @return bool|null\n */\nfunction fm_rename($old, $new)\n{\n    $allowed = (FM_EXTENSION) ? explode(',', FM_EXTENSION) : false;\n\n    $ext = pathinfo($new, PATHINFO_EXTENSION);\n    $isFileAllowed = ($allowed) ? in_array($ext, $allowed) : true;\n\n    if(!$isFileAllowed) return false;\n\n    return (!file_exists($new) && file_exists($old)) ? rename($old, $new) : null;\n}\n\n/**\n * Copy file or folder (recursively).\n * @param string $path\n * @param string $dest\n * @param bool $upd Update files\n * @param bool $force Create folder with same names instead file\n * @return bool\n */\nfunction fm_rcopy($path, $dest, $upd = true, $force = true)\n{\n    if (is_dir($path)) {\n        if (!fm_mkdir($dest, $force)) {\n            return false;\n        }\n        $objects = scandir($path);\n        $ok = true;\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (!fm_rcopy($path . '/' . $file, $dest . '/' . $file)) {\n                        $ok = false;\n                    }\n                }\n            }\n        }\n        return $ok;\n    } elseif (is_file($path)) {\n        return fm_copy($path, $dest, $upd);\n    }\n    return false;\n}\n\n/**\n * Safely create folder\n * @param string $dir\n * @param bool $force\n * @return bool\n */\nfunction fm_mkdir($dir, $force)\n{\n    if (file_exists($dir)) {\n        if (is_dir($dir)) {\n            return $dir;\n        } elseif (!$force) {\n            return false;\n        }\n        unlink($dir);\n    }\n    return mkdir($dir, 0777, true);\n}\n\n/**\n * Safely copy file\n * @param string $f1\n * @param string $f2\n * @param bool $upd\n * @return bool\n */\nfunction fm_copy($f1, $f2, $upd)\n{\n    $time1 = filemtime($f1);\n    if (file_exists($f2)) {\n        $time2 = filemtime($f2);\n        if ($time2 >= $time1 && $upd) {\n            return false;\n        }\n    }\n    $ok = copy($f1, $f2);\n    if ($ok) {\n        touch($f2, $time1);\n    }\n    return $ok;\n}\n\n/**\n * Get mime type\n * @param string $file_path\n * @return mixed|string\n */\nfunction fm_get_mime_type($file_path)\n{\n    if (function_exists('finfo_open')) {\n        $finfo = finfo_open(FILEINFO_MIME_TYPE);\n        $mime = finfo_file($finfo, $file_path);\n        finfo_close($finfo);\n        return $mime;\n    } elseif (function_exists('mime_content_type')) {\n        return mime_content_type($file_path);\n    } elseif (!stristr(ini_get('disable_functions'), 'shell_exec')) {\n        $file = escapeshellarg($file_path);\n        $mime = shell_exec('file -bi ' . $file);\n        return $mime;\n    } else {\n        return '--';\n    }\n}\n\n/**\n * HTTP Redirect\n * @param string $url\n * @param int $code\n */\nfunction fm_redirect($url, $code = 302)\n{\n    header('Location: ' . $url, true, $code);\n    exit;\n}\n\n/**\n * Path traversal prevention and clean the url\n * It replaces (consecutive) occurrences of / and \\\\ with whatever is in DIRECTORY_SEPARATOR, and processes /. and /.. fine.\n * @param $path\n * @return string\n */\nfunction get_absolute_path($path) {\n    $path = str_replace(array('/', '\\\\'), DIRECTORY_SEPARATOR, $path);\n    $parts = array_filter(explode(DIRECTORY_SEPARATOR, $path), 'strlen');\n    $absolutes = array();\n    foreach ($parts as $part) {\n        if ('.' == $part) continue;\n        if ('..' == $part) {\n            array_pop($absolutes);\n        } else {\n            $absolutes[] = $part;\n        }\n    }\n    return implode(DIRECTORY_SEPARATOR, $absolutes);\n}\n\n/**\n * Clean path\n * @param string $path\n * @return string\n */\nfunction fm_clean_path($path, $trim = true)\n{\n    $path = $trim ? trim($path) : $path;\n    $path = trim($path, '\\\\/');\n    $path = str_replace(array('../', '..\\\\'), '', $path);\n    $path =  get_absolute_path($path);\n    if ($path == '..') {\n        $path = '';\n    }\n    return str_replace('\\\\', '/', $path);\n}\n\n/**\n * Get parent path\n * @param string $path\n * @return bool|string\n */\nfunction fm_get_parent_path($path)\n{\n    $path = fm_clean_path($path);\n    if ($path != '') {\n        $array = explode('/', $path);\n        if (count($array) > 1) {\n            $array = array_slice($array, 0, -1);\n            return implode('/', $array);\n        }\n        return '';\n    }\n    return false;\n}\n\n/*\n * get language translations from json file\n * @param int $tr\n * @return array\n */\nfunction fm_get_translations($tr) {\n    try {\n        $content = @file_get_contents('translation.json');\n        if($content !== FALSE) {\n            $lng = json_decode($content, TRUE);\n            global $lang_list;\n            foreach ($lng[\"language\"] as $key => $value)\n            {\n                $code = $value[\"code\"];\n                $lang_list[$code] = $value[\"name\"];\n                if ($tr)\n                    $tr[$code] = $value[\"translation\"];\n            }\n            return $tr;\n        }\n\n    }\n    catch (Exception $e) {\n        echo $e;\n    }\n}\n\n/**\n * @param $file\n * Recover all file sizes larger than > 2GB.\n * Works on php 32bits and 64bits and supports linux\n * @return int|string\n */\nfunction fm_get_size($file)\n{\n    static $iswin;\n    static $isdarwin;\n    if (!isset($iswin)) {\n        $iswin = (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN');\n    } \n    if (!isset($isdarwin)) {\n        $isdarwin = (strtoupper(substr(PHP_OS, 0)) == \"DARWIN\");\n    }\n\n    static $exec_works;\n    if (!isset($exec_works)) {\n        $exec_works = (function_exists('exec') && !ini_get('safe_mode') && @exec('echo EXEC') == 'EXEC');\n    }\n\n    // try a shell command\n    if ($exec_works) {\n        $cmd = ($iswin) ? \"for %F in (\\\"$file\\\") do @echo %~zF\" : ($isdarwin ? \"stat -f%z \\\"$file\\\"\" : \"stat -c%s \\\"$file\\\"\");\n        @exec($cmd, $output);\n        if (is_array($output) && ctype_digit($size = trim(implode(\"\\n\", $output)))) {\n            return $size;\n        }\n    }\n\n    // try the Windows COM interface\n    if ($iswin && class_exists(\"COM\")) {\n        try {\n            $fsobj = new COM('Scripting.FileSystemObject');\n            $f = $fsobj->GetFile( realpath($file) );\n            $size = $f->Size;\n        } catch (Exception $e) {\n            $size = null;\n        }\n        if (ctype_digit($size)) {\n            return $size;\n        }\n    }\n\n    // if all else fails\n    return filesize($file);\n}\n\n/**\n * Get nice filesize\n * @param int $size\n * @return string\n */\nfunction fm_get_filesize($size)\n{\n    if ($size < 1000) {\n        return sprintf('%s B', $size);\n    } elseif (($size / 1024) < 1000) {\n        return sprintf('%s KB', round(($size / 1024), 2));\n    } elseif (($size / 1024 / 1024) < 1000) {\n        return sprintf('%s MB', round(($size / 1024 / 1024), 2));\n    } elseif (($size / 1024 / 1024 / 1024) < 1000) {\n        return sprintf('%s GB', round(($size / 1024 / 1024 / 1024), 2));\n    } else {\n        return sprintf('%s TB', round(($size / 1024 / 1024 / 1024 / 1024), 2));\n    }\n}\n\n/**\n * Get director total size\n * @param string $directory\n * @return string\n */\nfunction fm_get_directorysize($directory) {\n    global $calc_folder;\n    if ($calc_folder==true) { //  Slower output\n      $size = 0;  $count= 0;  $dirCount= 0;\n    foreach(new RecursiveIteratorIterator(new RecursiveDirectoryIterator($directory)) as $file)\n    if ($file->isFile())\n        {   $size+=$file->getSize();\n            $count++;\n        }\n    else if ($file->isDir()) { $dirCount++; }\n    // return [$size, $count, $dirCount];\n    return fm_get_filesize($size);\n    }\n    else return 'Folder'; //  Quick output\n}\n\n/**\n * Get info about zip archive\n * @param string $path\n * @return array|bool\n */\nfunction fm_get_zif_info($path, $ext) {\n    if ($ext == 'zip' && function_exists('zip_open')) {\n        $arch = zip_open($path);\n        if ($arch) {\n            $filenames = array();\n            while ($zip_entry = zip_read($arch)) {\n                $zip_name = zip_entry_name($zip_entry);\n                $zip_folder = substr($zip_name, -1) == '/';\n                $filenames[] = array(\n                    'name' => $zip_name,\n                    'filesize' => zip_entry_filesize($zip_entry),\n                    'compressed_size' => zip_entry_compressedsize($zip_entry),\n                    'folder' => $zip_folder\n                    //'compression_method' => zip_entry_compressionmethod($zip_entry),\n                );\n            }\n            zip_close($arch);\n            return $filenames;\n        }\n    } elseif($ext == 'tar' && class_exists('PharData')) {\n        $archive = new PharData($path);\n        $filenames = array();\n        foreach(new RecursiveIteratorIterator($archive) as $file) {\n            $parent_info = $file->getPathInfo();\n            $zip_name = str_replace(\"phar://\".$path, '', $file->getPathName());\n            $zip_name = substr($zip_name, ($pos = strpos($zip_name, '/')) !== false ? $pos + 1 : 0);\n            $zip_folder = $parent_info->getFileName();\n            $zip_info = new SplFileInfo($file);\n            $filenames[] = array(\n                'name' => $zip_name,\n                'filesize' => $zip_info->getSize(),\n                'compressed_size' => $file->getCompressedSize(),\n                'folder' => $zip_folder\n            );\n        }\n        return $filenames;\n    }\n    return false;\n}\n\n/**\n * Encode html entities\n * @param string $text\n * @return string\n */\nfunction fm_enc($text)\n{\n    return htmlspecialchars($text, ENT_QUOTES, 'UTF-8');\n}\n\n/**\n * Save message in session\n * @param string $msg\n * @param string $status\n */\nfunction fm_set_msg($msg, $status = 'ok')\n{\n    $_SESSION[FM_SESSION_ID]['message'] = $msg;\n    $_SESSION[FM_SESSION_ID]['status'] = $status;\n}\n\n/**\n * Check if string is in UTF-8\n * @param string $string\n * @return int\n */\nfunction fm_is_utf8($string)\n{\n    return preg_match('//u', $string);\n}\n\n/**\n * Convert file name to UTF-8 in Windows\n * @param string $filename\n * @return string\n */\nfunction fm_convert_win($filename)\n{\n    if (FM_IS_WIN && function_exists('iconv')) {\n        $filename = iconv(FM_ICONV_INPUT_ENC, 'UTF-8//IGNORE', $filename);\n    }\n    return $filename;\n}\n\n/**\n * @param $obj\n * @return array\n */\nfunction fm_object_to_array($obj)\n{\n    if (!is_object($obj) && !is_array($obj)) {\n        return $obj;\n    }\n    if (is_object($obj)) {\n        $obj = get_object_vars($obj);\n    }\n    return array_map('fm_object_to_array', $obj);\n}\n\n/**\n * Get CSS classname for file\n * @param string $path\n * @return string\n */\nfunction fm_get_file_icon_class($path)\n{\n    // get extension\n    $ext = strtolower(pathinfo($path, PATHINFO_EXTENSION));\n\n    switch ($ext) {\n        case 'ico':\n        case 'gif':\n        case 'jpg':\n        case 'jpeg':\n        case 'jpc':\n        case 'jp2':\n        case 'jpx':\n        case 'xbm':\n        case 'wbmp':\n        case 'png':\n        case 'bmp':\n        case 'tif':\n        case 'tiff':\n        case 'svg':\n            $img = 'fa fa-picture-o';\n            break;\n        case 'passwd':\n        case 'ftpquota':\n        case 'sql':\n        case 'js':\n        case 'json':\n        case 'sh':\n        case 'config':\n        case 'twig':\n        case 'tpl':\n        case 'md':\n        case 'gitignore':\n        case 'c':\n        case 'cpp':\n        case 'cs':\n        case 'py':\n        case 'map':\n        case 'lock':\n        case 'dtd':\n            $img = 'fa fa-file-code-o';\n            break;\n        case 'txt':\n        case 'ini':\n        case 'conf':\n        case 'log':\n        case 'htaccess':\n            $img = 'fa fa-file-text-o';\n            break;\n        case 'css':\n        case 'less':\n        case 'sass':\n        case 'scss':\n            $img = 'fa fa-css3';\n            break;\n        case 'zip':\n        case 'rar':\n        case 'gz':\n        case 'tar':\n        case '7z':\n            $img = 'fa fa-file-archive-o';\n            break;\n        case 'php':\n        case 'php4':\n        case 'php5':\n        case 'phps':\n        case 'phtml':\n            $img = 'fa fa-code';\n            break;\n        case 'htm':\n        case 'html':\n        case 'shtml':\n        case 'xhtml':\n            $img = 'fa fa-html5';\n            break;\n        case 'xml':\n        case 'xsl':\n            $img = 'fa fa-file-excel-o';\n            break;\n        case 'wav':\n        case 'mp3':\n        case 'mp2':\n        case 'm4a':\n        case 'aac':\n        case 'ogg':\n        case 'oga':\n        case 'wma':\n        case 'mka':\n        case 'flac':\n        case 'ac3':\n        case 'tds':\n            $img = 'fa fa-music';\n            break;\n        case 'm3u':\n        case 'm3u8':\n        case 'pls':\n        case 'cue':\n            $img = 'fa fa-headphones';\n            break;\n        case 'avi':\n        case 'mpg':\n        case 'mpeg':\n        case 'mp4':\n        case 'm4v':\n        case 'flv':\n        case 'f4v':\n        case 'ogm':\n        case 'ogv':\n        case 'mov':\n        case 'mkv':\n        case '3gp':\n        case 'asf':\n        case 'wmv':\n            $img = 'fa fa-file-video-o';\n            break;\n        case 'eml':\n        case 'msg':\n            $img = 'fa fa-envelope-o';\n            break;\n        case 'xls':\n        case 'xlsx':\n        case 'ods':\n            $img = 'fa fa-file-excel-o';\n            break;\n        case 'csv':\n            $img = 'fa fa-file-text-o';\n            break;\n        case 'bak':\n            $img = 'fa fa-clipboard';\n            break;\n        case 'doc':\n        case 'docx':\n        case 'odt':\n            $img = 'fa fa-file-word-o';\n            break;\n        case 'ppt':\n        case 'pptx':\n            $img = 'fa fa-file-powerpoint-o';\n            break;\n        case 'ttf':\n        case 'ttc':\n        case 'otf':\n        case 'woff':\n        case 'woff2':\n        case 'eot':\n        case 'fon':\n            $img = 'fa fa-font';\n            break;\n        case 'pdf':\n            $img = 'fa fa-file-pdf-o';\n            break;\n        case 'psd':\n        case 'ai':\n        case 'eps':\n        case 'fla':\n        case 'swf':\n            $img = 'fa fa-file-image-o';\n            break;\n        case 'exe':\n        case 'msi':\n            $img = 'fa fa-file-o';\n            break;\n        case 'bat':\n            $img = 'fa fa-terminal';\n            break;\n        default:\n            $img = 'fa fa-info-circle';\n    }\n\n    return $img;\n}\n\n/**\n * Get image files extensions\n * @return array\n */\nfunction fm_get_image_exts()\n{\n    return array('ico', 'gif', 'jpg', 'jpeg', 'jpc', 'jp2', 'jpx', 'xbm', 'wbmp', 'png', 'bmp', 'tif', 'tiff', 'psd', 'svg');\n}\n\n/**\n * Get video files extensions\n * @return array\n */\nfunction fm_get_video_exts()\n{\n    return array('webm', 'mp4', 'm4v', 'ogm', 'ogv', 'mov', 'mkv');\n}\n\n/**\n * Get audio files extensions\n * @return array\n */\nfunction fm_get_audio_exts()\n{\n    return array('wav', 'mp3', 'ogg', 'm4a');\n}\n\n/**\n * Get text file extensions\n * @return array\n */\nfunction fm_get_text_exts()\n{\n    return array(\n        'txt', 'css', 'ini', 'conf', 'log', 'htaccess', 'passwd', 'ftpquota', 'sql', 'js', 'json', 'sh', 'config',\n        'php', 'php4', 'php5', 'phps', 'phtml', 'htm', 'html', 'shtml', 'xhtml', 'xml', 'xsl', 'm3u', 'm3u8', 'pls', 'cue',\n        'eml', 'msg', 'csv', 'bat', 'twig', 'tpl', 'md', 'gitignore', 'less', 'sass', 'scss', 'c', 'cpp', 'cs', 'py',\n        'map', 'lock', 'dtd', 'svg', 'scss', 'asp', 'aspx', 'asx', 'asmx', 'ashx', 'jsx', 'jsp', 'jspx', 'cfm', 'cgi'\n    );\n}\n\n/**\n * Get mime types of text files\n * @return array\n */\nfunction fm_get_text_mimes()\n{\n    return array(\n        'application/xml',\n        'application/javascript',\n        'application/x-javascript',\n        'image/svg+xml',\n        'message/rfc822',\n    );\n}\n\n/**\n * Get file names of text files w/o extensions\n * @return array\n */\nfunction fm_get_text_names()\n{\n    return array(\n        'license',\n        'readme',\n        'authors',\n        'contributors',\n        'changelog',\n    );\n}\n\n/**\n * Get online docs viewer supported files extensions\n * @return array\n */\nfunction fm_get_onlineViewer_exts()\n{\n    return array('doc', 'docx', 'xls', 'xlsx', 'pdf', 'ppt', 'pptx', 'ai', 'psd', 'dxf', 'xps', 'rar', 'odt', 'ods');\n}\n\n/**\n * Class to work with zip files (using ZipArchive)\n */\nclass FM_Zipper\n{\n    private $zip;\n\n    public function __construct()\n    {\n        $this->zip = new ZipArchive();\n    }\n\n    /**\n     * Create archive with name $filename and files $files (RELATIVE PATHS!)\n     * @param string $filename\n     * @param array|string $files\n     * @return bool\n     */\n    public function create($filename, $files)\n    {\n        $res = $this->zip->open($filename, ZipArchive::CREATE);\n        if ($res !== true) {\n            return false;\n        }\n        if (is_array($files)) {\n            foreach ($files as $f) {\n                if (!$this->addFileOrDir($f)) {\n                    $this->zip->close();\n                    return false;\n                }\n            }\n            $this->zip->close();\n            return true;\n        } else {\n            if ($this->addFileOrDir($files)) {\n                $this->zip->close();\n                return true;\n            }\n            return false;\n        }\n    }\n\n    /**\n     * Extract archive $filename to folder $path (RELATIVE OR ABSOLUTE PATHS)\n     * @param string $filename\n     * @param string $path\n     * @return bool\n     */\n    public function unzip($filename, $path)\n    {\n        $res = $this->zip->open($filename);\n        if ($res !== true) {\n            return false;\n        }\n        if ($this->zip->extractTo($path)) {\n            $this->zip->close();\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * Add file/folder to archive\n     * @param string $filename\n     * @return bool\n     */\n    private function addFileOrDir($filename)\n    {\n        if (is_file($filename)) {\n            return $this->zip->addFile($filename);\n        } elseif (is_dir($filename)) {\n            return $this->addDir($filename);\n        }\n        return false;\n    }\n\n    /**\n     * Add folder recursively\n     * @param string $path\n     * @return bool\n     */\n    private function addDir($path)\n    {\n        if (!$this->zip->addEmptyDir($path)) {\n            return false;\n        }\n        $objects = scandir($path);\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (is_dir($path . '/' . $file)) {\n                        if (!$this->addDir($path . '/' . $file)) {\n                            return false;\n                        }\n                    } elseif (is_file($path . '/' . $file)) {\n                        if (!$this->zip->addFile($path . '/' . $file)) {\n                            return false;\n                        }\n                    }\n                }\n            }\n            return true;\n        }\n        return false;\n    }\n}\n\n/**\n * Class to work with Tar files (using PharData)\n */\nclass FM_Zipper_Tar\n{\n    private $tar;\n\n    public function __construct()\n    {\n        $this->tar = null;\n    }\n\n    /**\n     * Create archive with name $filename and files $files (RELATIVE PATHS!)\n     * @param string $filename\n     * @param array|string $files\n     * @return bool\n     */\n    public function create($filename, $files)\n    {\n        $this->tar = new PharData($filename);\n        if (is_array($files)) {\n            foreach ($files as $f) {\n                if (!$this->addFileOrDir($f)) {\n                    return false;\n                }\n            }\n            return true;\n        } else {\n            if ($this->addFileOrDir($files)) {\n                return true;\n            }\n            return false;\n        }\n    }\n\n    /**\n     * Extract archive $filename to folder $path (RELATIVE OR ABSOLUTE PATHS)\n     * @param string $filename\n     * @param string $path\n     * @return bool\n     */\n    public function unzip($filename, $path)\n    {\n        $res = $this->tar->open($filename);\n        if ($res !== true) {\n            return false;\n        }\n        if ($this->tar->extractTo($path)) {\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * Add file/folder to archive\n     * @param string $filename\n     * @return bool\n     */\n    private function addFileOrDir($filename)\n    {\n        if (is_file($filename)) {\n            return $this->tar->addFile($filename);\n        } elseif (is_dir($filename)) {\n            return $this->addDir($filename);\n        }\n        return false;\n    }\n\n    /**\n     * Add folder recursively\n     * @param string $path\n     * @return bool\n     */\n    private function addDir($path)\n    {\n        $objects = scandir($path);\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (is_dir($path . '/' . $file)) {\n                        if (!$this->addDir($path . '/' . $file)) {\n                            return false;\n                        }\n                    } elseif (is_file($path . '/' . $file)) {\n                        try {\n                            $this->tar->addFile($path . '/' . $file);\n                        } catch (Exception $e) {\n                            return false;\n                        }\n                    }\n                }\n            }\n            return true;\n        }\n        return false;\n    }\n}\n\n\n\n/**\n * Save Configuration\n */\n class FM_Config\n{\n     var $data;\n\n    function __construct()\n    {\n        global $root_path, $root_url, $CONFIG;\n        $fm_url = $root_url.$_SERVER[\"PHP_SELF\"];\n        $this->data = array(\n            'lang' => 'en',\n            'error_reporting' => true,\n            'show_hidden' => true\n        );\n        $data = false;\n        if (strlen($CONFIG)) {\n            $data = fm_object_to_array(json_decode($CONFIG));\n        } else {\n            $msg = 'Tiny File Manager<br>Error: Cannot load configuration';\n            if (substr($fm_url, -1) == '/') {\n                $fm_url = rtrim($fm_url, '/');\n                $msg .= '<br>';\n                $msg .= '<br>Seems like you have a trailing slash on the URL.';\n                $msg .= '<br>Try this link: <a href=\"' . $fm_url . '\">' . $fm_url . '</a>';\n            }\n            die($msg);\n        }\n        if (is_array($data) && count($data)) $this->data = $data;\n        else $this->save();\n    }\n\n    function save()\n    {\n        global $root_path;\n        $fm_file = $root_path.$_SERVER[\"PHP_SELF\"];\n        $var_name = '$CONFIG';\n        $var_value = var_export(json_encode($this->data), true);\n        $config_string = \"<?php\" . chr(13) . chr(10) . \"//Default Configuration\".chr(13) . chr(10).\"$var_name = $var_value;\" . chr(13) . chr(10);\n        if (file_exists($fm_file)) {\n            $lines = file($fm_file);\n            if ($fh = @fopen($fm_file, \"w\")) {\n                @fputs($fh, $config_string, strlen($config_string));\n                for ($x = 3; $x < count($lines); $x++) {\n                    @fputs($fh, $lines[$x], strlen($lines[$x]));\n                }\n                @fclose($fh);\n            }\n        }\n    }\n}\n\n//--- templates functions\n\n/**\n * Show nav block\n * @param string $path\n */\nfunction fm_show_nav_path($path)\n{\n    global $lang, $sticky_navbar;\n    $isStickyNavBar = $sticky_navbar ? 'fixed-top' : '';\n    ?>\n    <nav class=\"navbar navbar-expand-lg navbar-light bg-white mb-4 main-nav <?php echo $isStickyNavBar ?>\">\n        <a class=\"navbar-brand\" href=\"\"> <?php echo lng('AppTitle') ?> </a>\n        <button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n            <span class=\"navbar-toggler-icon\"></span>\n        </button>\n        <div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\n\n            <?php\n            $path = fm_clean_path($path);\n            $root_url = \"<a href='?p='><i class='fa fa-home' aria-hidden='true' title='\" . FM_ROOT_PATH . \"'></i></a>\";\n            $sep = '<i class=\"bread-crumb\"> / </i>';\n            if ($path != '') {\n                $exploded = explode('/', $path);\n                $count = count($exploded);\n                $array = array();\n                $parent = '';\n                for ($i = 0; $i < $count; $i++) {\n                    $parent = trim($parent . '/' . $exploded[$i], '/');\n                    $parent_enc = urlencode($parent);\n                    $array[] = \"<a href='?p={$parent_enc}'>\" . fm_enc(fm_convert_win($exploded[$i])) . \"</a>\";\n                }\n                $root_url .= $sep . implode($sep, $array);\n            }\n            echo '<div class=\"col-xs-6 col-sm-5\">' . $root_url . '</div>';\n            ?>\n\n            <div class=\"col-xs-6 col-sm-7 text-right\">\n                <ul class=\"navbar-nav mr-auto float-right\">\n                    <?php if (!FM_READONLY): ?>\n                    <li class=\"nav-item mr-2\">\n                        <div class=\"input-group input-group-sm mr-1\" style=\"margin-top:4px;\">\n                            <input type=\"text\" class=\"form-control\" placeholder=\"<?php echo lng('Search') ?>\" aria-label=\"<?php echo lng('Search') ?>\" aria-describedby=\"search-addon2\" id=\"search-addon\">\n                            <div class=\"input-group-append\">\n                                <span class=\"input-group-text\" id=\"search-addon2\"><i class=\"fa fa-search\"></i></span>\n                            </div>\n                        </div>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a title=\"<?php echo lng('Upload') ?>\" class=\"nav-link\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;upload\"><i class=\"fa fa-cloud-upload\" aria-hidden=\"true\"></i> <?php echo lng('Upload') ?></a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a title=\"<?php echo lng('NewItem') ?>\" class=\"nav-link\" href=\"#createNewItem\" data-toggle=\"modal\" data-target=\"#createNewItem\"><i class=\"fa fa-plus-square\"></i> <?php echo lng('NewItem') ?></a>\n                    </li>\n                    <?php endif; ?>\n                    <?php if (FM_USE_AUTH): ?>\n                    <li class=\"nav-item avatar dropdown\">\n                        <a class=\"nav-link dropdown-toggle\" id=\"navbarDropdownMenuLink-5\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"> <i class=\"fa fa-user-circle\"></i> <?php if(isset($_SESSION[FM_SESSION_ID]['logged'])) { echo $_SESSION[FM_SESSION_ID]['logged']; } ?></a>\n                        <div class=\"dropdown-menu dropdown-menu-right\" aria-labelledby=\"navbarDropdownMenuLink-5\">\n                            <?php if (!FM_READONLY): ?>\n                            <a title=\"<?php echo lng('Settings') ?>\" class=\"dropdown-item nav-link\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;settings=1\"><i class=\"fa fa-cog\" aria-hidden=\"true\"></i> <?php echo lng('Settings') ?></a>\n                            <?php endif ?>\n                            <a title=\"<?php echo lng('Help') ?>\" class=\"dropdown-item nav-link\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;help=2\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i> <?php echo lng('Help') ?></a>\n                            <a title=\"<?php echo lng('Logout') ?>\" class=\"dropdown-item nav-link\" href=\"?logout=1\"><i class=\"fa fa-sign-out\" aria-hidden=\"true\"></i> <?php echo lng('Logout') ?></a>\n                        </div>\n                    </li>\n                    <?php else: ?>\n                        <?php if (!FM_READONLY): ?>\n                            <li class=\"nav-item\">\n                                <a title=\"<?php echo lng('Settings') ?>\" class=\"dropdown-item nav-link\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;settings=1\"><i class=\"fa fa-cog\" aria-hidden=\"true\"></i> <?php echo lng('Settings') ?></a>\n                            </li>\n                        <?php endif; ?>\n                    <?php endif; ?>\n                </ul>\n            </div>\n        </div>\n    </nav>\n    <?php\n}\n\n/**\n * Show message from session\n */\nfunction fm_show_message()\n{\n    if (isset($_SESSION[FM_SESSION_ID]['message'])) {\n        $class = isset($_SESSION[FM_SESSION_ID]['status']) ? $_SESSION[FM_SESSION_ID]['status'] : 'ok';\n        echo '<p class=\"message ' . $class . '\">' . $_SESSION[FM_SESSION_ID]['message'] . '</p>';\n        unset($_SESSION[FM_SESSION_ID]['message']);\n        unset($_SESSION[FM_SESSION_ID]['status']);\n    }\n}\n\n/**\n * Show page header in Login Form\n */\nfunction fm_show_header_login()\n{\n$sprites_ver = '20160315';\nheader(\"Content-Type: text/html; charset=utf-8\");\nheader(\"Expires: Sat, 26 Jul 1997 05:00:00 GMT\");\nheader(\"Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\");\nheader(\"Pragma: no-cache\");\n\nglobal $lang, $root_url, $favicon_path;\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <meta name=\"description\" content=\"Web based File Manager in PHP, Manage your files efficiently and easily with Tiny File Manager\">\n    <meta name=\"author\" content=\"CCP Programmers\">\n    <meta name=\"robots\" content=\"noindex, nofollow\">\n    <meta name=\"googlebot\" content=\"noindex\">\n    <link rel=\"icon\" href=\"<?php echo fm_enc($favicon_path) ?>\" type=\"image/png\">\n    <title><?php echo fm_enc(APP_TITLE) ?></title>\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\">\n    <style>\n        body.fm-login-page{background-color:#f7f9fb;font-size:14px}\n        .fm-login-page .brand{width:121px;overflow:hidden;margin:0 auto;margin:40px auto;margin-bottom:0;position:relative;z-index:1}\n        .fm-login-page .brand img{width:100%}\n        .fm-login-page .card-wrapper{width:360px}\n        .fm-login-page .card{border-color:transparent;box-shadow:0 4px 8px rgba(0,0,0,.05)}\n        .fm-login-page .card-title{margin-bottom:1.5rem;font-size:24px;font-weight:300;letter-spacing:-.5px}\n        .fm-login-page .form-control{border-width:2.3px}\n        .fm-login-page .form-group label{width:100%}\n        .fm-login-page .btn.btn-block{padding:12px 10px}\n        .fm-login-page .footer{margin:40px 0;color:#888;text-align:center}\n        @media screen and (max-width: 425px) {\n            .fm-login-page .card-wrapper{width:90%;margin:0 auto}\n        }\n        @media screen and (max-width: 320px) {\n            .fm-login-page .card.fat{padding:0}\n            .fm-login-page .card.fat .card-body{padding:15px}\n        }\n        .message{padding:4px 7px;border:1px solid #ddd;background-color:#fff}\n        .message.ok{border-color:green;color:green}\n        .message.error{border-color:red;color:red}\n        .message.alert{border-color:orange;color:orange}\n    </style>\n</head>\n<body class=\"fm-login-page\">\n<div id=\"wrapper\" class=\"container-fluid\">\n\n    <?php\n    }\n\n    /**\n     * Show page footer in Login Form\n     */\n    function fm_show_footer_login()\n    {\n    ?>\n</div>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.min.js\"></script>\n<script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\"></script>\n</body>\n</html>\n<?php\n}\n\n/**\n * Show Header after login\n */\nfunction fm_show_header()\n{\n$sprites_ver = '20160315';\nheader(\"Content-Type: text/html; charset=utf-8\");\nheader(\"Expires: Sat, 26 Jul 1997 05:00:00 GMT\");\nheader(\"Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\");\nheader(\"Pragma: no-cache\");\n\nglobal $lang, $root_url, $sticky_navbar, $favicon_path;\n$isStickyNavBar = $sticky_navbar ? 'navbar-fixed' : 'navbar-normal';\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <meta name=\"description\" content=\"Web based File Manager in PHP, Manage your files efficiently and easily with Tiny File Manager\">\n    <meta name=\"author\" content=\"CCP Programmers\">\n    <meta name=\"robots\" content=\"noindex, nofollow\">\n    <meta name=\"googlebot\" content=\"noindex\">\n    <link rel=\"icon\" href=\"<?php echo fm_enc($favicon_path) ?>\" type=\"image/png\">\n    <title><?php echo fm_enc(APP_TITLE) ?></title>\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css\" />\n    <?php if (FM_USE_HIGHLIGHTJS): ?>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/<?php echo FM_HIGHLIGHTJS_STYLE ?>.min.css\">\n    <?php endif; ?>\n    <style>\n        body {\n            font-size: 14px;\n            color: #222;\n            background: #F7F7F7;\n        }\n        body.navbar-fixed {\n            margin-top: 55px;\n        }\n        a:hover, a:visited, a:focus {\n            text-decoration: none !important;\n        }\n        * {\n            -webkit-border-radius: 0 !important;\n            -moz-border-radius: 0 !important;\n            border-radius: 0 !important;\n        }\n        .filename, td, th {\n            white-space: nowrap\n        }\n        .navbar-brand {\n            font-weight: bold;\n        }\n        .nav-item.avatar a {\n            cursor: pointer;\n            text-transform: capitalize;\n        }\n        .nav-item.avatar a > i {\n            font-size: 15px;\n        }\n        .nav-item.avatar .dropdown-menu a {\n            font-size: 13px;\n        }\n        #search-addon {\n            font-size: 12px;\n            border-right-width: 0;\n        }\n        #search-addon2 {\n            background: transparent;\n            border-left: 0;\n        }\n        .bread-crumb {\n            color: #cccccc;\n            font-style: normal;\n        }\n        #main-table .filename a {\n            color: #222222;\n        }\n        .table td, .table th {\n            vertical-align: middle !important;\n        }\n        .table .custom-checkbox-td .custom-control.custom-checkbox, .table .custom-checkbox-header .custom-control.custom-checkbox {\n            min-width: 18px;\n        }\n        .table-sm td, .table-sm th { padding: .4rem;}\n        .table-bordered td, .table-bordered th { border: 1px solid #f1f1f1;}\n        .hidden {\n            display: none\n        }\n        pre.with-hljs {\n            padding: 0\n        }\n        pre.with-hljs code {\n            margin: 0;\n            border: 0;\n            overflow: visible\n        }\n        code.maxheight, pre.maxheight {\n            max-height: 512px\n        }\n        .fa.fa-caret-right {\n            font-size: 1.2em;\n            margin: 0 4px;\n            vertical-align: middle;\n            color: #ececec\n        }\n        .fa.fa-home {\n            font-size: 1.3em;\n            vertical-align: bottom\n        }\n        .path {\n            margin-bottom: 10px\n        }\n        form.dropzone {\n            min-height: 200px;\n            border: 2px dashed #007bff;\n            line-height: 6rem;\n        }\n        .right {\n            text-align: right\n        }\n        .center, .close, .login-form {\n            text-align: center\n        }\n        .message {\n            padding: 4px 7px;\n            border: 1px solid #ddd;\n            background-color: #fff\n        }\n        .message.ok {\n            border-color: green;\n            color: green\n        }\n        .message.error {\n            border-color: red;\n            color: red\n        }\n        .message.alert {\n            border-color: orange;\n            color: orange\n        }\n        .preview-img {\n            max-width: 100%;\n            background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAKklEQVR42mL5//8/Azbw+PFjrOJMDCSCUQ3EABZc4S0rKzsaSvTTABBgAMyfCMsY4B9iAAAAAElFTkSuQmCC)\n        }\n        .inline-actions > a > i {\n            font-size: 1em;\n            margin-left: 5px;\n            background: #3785c1;\n            color: #fff;\n            padding: 3px;\n            border-radius: 3px\n        }\n        .preview-video {\n            position: relative;\n            max-width: 100%;\n            height: 0;\n            padding-bottom: 62.5%;\n            margin-bottom: 10px\n        }\n        .preview-video video {\n            position: absolute;\n            width: 100%;\n            height: 100%;\n            left: 0;\n            top: 0;\n            background: #000\n        }\n        .compact-table {\n            border: 0;\n            width: auto\n        }\n        .compact-table td, .compact-table th {\n            width: 100px;\n            border: 0;\n            text-align: center\n        }\n        .compact-table tr:hover td {\n            background-color: #fff\n        }\n        .filename {\n            max-width: 420px;\n            overflow: hidden;\n            text-overflow: ellipsis\n        }\n        .break-word {\n            word-wrap: break-word;\n            margin-left: 30px\n        }\n        .break-word.float-left a {\n            color: #7d7d7d\n        }\n        .break-word + .float-right {\n            padding-right: 30px;\n            position: relative\n        }\n        .break-word + .float-right > a {\n            color: #7d7d7d;\n            font-size: 1.2em;\n            margin-right: 4px\n        }\n        #editor {\n            position: absolute;\n            right: 15px;\n            top: 100px;\n            bottom: 15px;\n            left: 15px\n        }\n        @media (max-width:481px) {\n            #editor {\n                top: 150px;\n            }\n        }\n        #normal-editor {\n            border-radius: 3px;\n            border-width: 2px;\n            padding: 10px;\n            outline: none;\n        }\n        .btn-2 {\n            border-radius: 0;\n            padding: 3px 6px;\n            font-size: small;\n        }\n        li.file:before,li.folder:before{font:normal normal normal 14px/1 FontAwesome;content:\"\\f016\";margin-right:5px}li.folder:before{content:\"\\f114\"}i.fa.fa-folder-o{color:#0157b3}i.fa.fa-picture-o{color:#26b99a}i.fa.fa-file-archive-o{color:#da7d7d}.btn-2 i.fa.fa-file-archive-o{color:inherit}i.fa.fa-css3{color:#f36fa0}i.fa.fa-file-code-o{color:#007bff}i.fa.fa-code{color:#cc4b4c}i.fa.fa-file-text-o{color:#0096e6}i.fa.fa-html5{color:#d75e72}i.fa.fa-file-excel-o{color:#09c55d}i.fa.fa-file-powerpoint-o{color:#f6712e}\n        i.go-back {\n            font-size: 1.2em;\n            color: #007bff;\n        }\n        .main-nav {\n            padding: 0.2rem 1rem;\n            box-shadow: 0 4px 5px 0 rgba(0, 0, 0, .14), 0 1px 10px 0 rgba(0, 0, 0, .12), 0 2px 4px -1px rgba(0, 0, 0, .2)\n        }\n        .dataTables_filter {\n            display: none;\n        }\n        table.dataTable thead .sorting {\n            cursor: pointer;\n            background-repeat: no-repeat;\n            background-position: center right;\n            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAkElEQVQoz7XQMQ5AQBCF4dWQSJxC5wwax1Cq1e7BAdxD5SL+Tq/QCM1oNiJidwox0355mXnG/DrEtIQ6azioNZQxI0ykPhTQIwhCR+BmBYtlK7kLJYwWCcJA9M4qdrZrd8pPjZWPtOqdRQy320YSV17OatFC4euts6z39GYMKRPCTKY9UnPQ6P+GtMRfGtPnBCiqhAeJPmkqAAAAAElFTkSuQmCC');\n        }\n        table.dataTable thead .sorting_asc {\n            cursor: pointer;\n            background-repeat: no-repeat;\n            background-position: center right;\n            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZ0lEQVQ4y2NgGLKgquEuFxBPAGI2ahhWCsS/gDibUoO0gPgxEP8H4ttArEyuQYxAPBdqEAxPBImTY5gjEL9DM+wTENuQahAvEO9DMwiGdwAxOymGJQLxTyD+jgWDxCMZRsEoGAVoAADeemwtPcZI2wAAAABJRU5ErkJggg==');\n        }\n        table.dataTable thead .sorting_desc {\n            cursor: pointer;\n            background-repeat: no-repeat;\n            background-position: center right;\n            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZUlEQVQ4y2NgGAWjYBSggaqGu5FA/BOIv2PBIPFEUgxjB+IdQPwfC94HxLykus4GiD+hGfQOiB3J8SojEE9EM2wuSJzcsFMG4ttQgx4DsRalkZENxL+AuJQaMcsGxBOAmGvopk8AVz1sLZgg0bsAAAAASUVORK5CYII=');\n        }\n        table.dataTable thead tr:first-child th.custom-checkbox-header:first-child{\n            background-image: none;\n        }\n        .footer-action li {\n            margin-bottom: 10px;\n        }\n        .app-v-title {\n            font-size: 24px;\n            font-weight: 300;\n            letter-spacing: -.5px;\n            text-transform: uppercase;\n        }\n        hr.custom-hr {\n            border-top: 1px dashed #8c8b8b;\n            border-bottom: 1px dashed #fff;\n        }\n        .ekko-lightbox .modal-dialog { max-width: 98%; }\n        .ekko-lightbox-item.fade.in.show .row { background: #fff; }\n        .ekko-lightbox-nav-overlay{\n            display: flex !important;\n            opacity: 1 !important;\n            height: auto !important;\n            top: 50%;\n        }\n\n        .ekko-lightbox-nav-overlay a{\n            opacity: 1 !important;\n            width: auto !important;\n            text-shadow: none !important;\n            color: #3B3B3B;\n        }\n\n        .ekko-lightbox-nav-overlay a:hover{\n            color: #20507D;\n        }\n\n        #snackbar {\n          visibility: hidden;\n          min-width: 250px;\n          margin-left: -125px;\n          background-color: #333;\n          color: #fff;\n          text-align: center;\n          border-radius: 2px;\n          padding: 16px;\n          position: fixed;\n          z-index: 1;\n          left: 50%;\n          bottom: 30px;\n          font-size: 17px;\n        }\n\n        #snackbar.show {\n          visibility: visible;\n          -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;\n          animation: fadein 0.5s, fadeout 0.5s 2.5s;\n        }\n\n        @-webkit-keyframes fadein {\n          from {bottom: 0; opacity: 0;} \n          to {bottom: 30px; opacity: 1;}\n        }\n\n        @keyframes fadein {\n          from {bottom: 0; opacity: 0;}\n          to {bottom: 30px; opacity: 1;}\n        }\n\n        @-webkit-keyframes fadeout {\n          from {bottom: 30px; opacity: 1;} \n          to {bottom: 0; opacity: 0;}\n        }\n\n        @keyframes fadeout {\n          from {bottom: 30px; opacity: 1;}\n          to {bottom: 0; opacity: 0;}\n        }\n        #main-table span.badge{border-bottom:2px solid #f8f9fa}#main-table span.badge:nth-child(1){border-color:#df4227}#main-table span.badge:nth-child(2){border-color:#f8b600}#main-table span.badge:nth-child(3){border-color:#00bd60}#main-table span.badge:nth-child(4){border-color:#4581ff}#main-table span.badge:nth-child(5){border-color:#ac68fc}#main-table span.badge:nth-child(6){border-color:#45c3d2}\n        @media only screen and (min-device-width : 768px) and (max-device-width : 1024px) and (orientation : landscape) and (-webkit-min-device-pixel-ratio: 2) { .navbar-collapse .col-xs-6.text-right { padding: 0; } }\n        .btn.active.focus,.btn.active:focus,.btn.focus,.btn.focus:active,.btn:active:focus,.btn:focus{outline:0!important;outline-offset:0!important;background-image:none!important;-webkit-box-shadow:none!important;box-shadow:none!important}\n        .lds-facebook{display:none;position:relative;width:64px;height:64px}.lds-facebook div,.lds-facebook.show-me{display:inline-block}.lds-facebook div{position:absolute;left:6px;width:13px;background:#007bff;animation:lds-facebook 1.2s cubic-bezier(0,.5,.5,1) infinite}.lds-facebook div:nth-child(1){left:6px;animation-delay:-.24s}.lds-facebook div:nth-child(2){left:26px;animation-delay:-.12s}.lds-facebook div:nth-child(3){left:45px;animation-delay:0}@keyframes lds-facebook{0%{top:6px;height:51px}100%,50%{top:19px;height:26px}}\n    </style>\n</head>\n<body class=\"<?php echo $isStickyNavBar; ?>\">\n<div id=\"wrapper\" class=\"container-fluid\">\n\n    <!-- New Item creation -->\n    <div class=\"modal fade\" id=\"createNewItem\" tabindex=\"-1\" role=\"dialog\" aria-label=\"newItemModalLabel\" aria-hidden=\"true\">\n        <div class=\"modal-dialog\" role=\"document\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h5 class=\"modal-title\" id=\"newItemModalLabel\"><i class=\"fa fa-plus-square fa-fw\"></i><?php echo lng('CreateNewItem') ?></h5>\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                </div>\n                <div class=\"modal-body\">\n                    <p><label for=\"newfile\"><?php echo lng('ItemType') ?> </label></p>\n\n                    <div class=\"custom-control custom-radio custom-control-inline\">\n                        <input type=\"radio\" id=\"customRadioInline1\" name=\"newfile\" value=\"file\" class=\"custom-control-input\">\n                        <label class=\"custom-control-label\" for=\"customRadioInline1\"><?php echo lng('File') ?></label>\n                    </div>\n\n                    <div class=\"custom-control custom-radio custom-control-inline\">\n                        <input type=\"radio\" id=\"customRadioInline2\" name=\"newfile\" value=\"folder\" class=\"custom-control-input\" checked=\"\">\n                        <label class=\"custom-control-label\" for=\"customRadioInline2\"><?php echo lng('Folder') ?></label>\n                    </div>\n\n                    <p class=\"mt-3\"><label for=\"newfilename\"><?php echo lng('ItemName') ?> </label></p>\n                    <input type=\"text\" name=\"newfilename\" id=\"newfilename\" value=\"\" class=\"form-control\">\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"button\" class=\"btn btn-outline-primary\" data-dismiss=\"modal\"><i class=\"fa fa-times-circle\"></i> <?php echo lng('Cancel') ?></button>\n                    <button type=\"button\" class=\"btn btn-success\" onclick=\"newfolder('<?php echo fm_enc(FM_PATH) ?>');return false;\"><i class=\"fa fa-check-circle\"></i> <?php echo lng('CreateNow') ?></button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Modal -->\n    <script type=\"text/html\" id=\"js-tpl-modal\">\n        <div class=\"modal fade\" id=\"js-ModalCenter-<%this.id%>\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"ModalCenterTitle\" aria-hidden=\"true\">\n            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-header\">\n                        <h5 class=\"modal-title\" id=\"ModalCenterTitle\"><%this.title%></h5>\n                        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                            <span aria-hidden=\"true\">&times;</span>\n                        </button>\n                    </div>\n                    <div class=\"modal-body\">\n                        <%this.content%>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-outline-primary\" data-dismiss=\"modal\"><i class=\"fa fa-times-circle\"></i> <?php echo lng('Cancel') ?></button>\n                        <%if(this.action){%><button type=\"button\" class=\"btn btn-primary\" id=\"js-ModalCenterAction\" data-type=\"js-<%this.action%>\"><%this.action%></button><%}%>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </script>\n\n    <?php\n    }\n\n    /**\n     * Show page footer\n     */\n    function fm_show_footer()\n    {\n    ?>\n</div>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js\"></script>\n<script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\"></script>\n<script src=\"https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js\"></script>\n<?php if (FM_USE_HIGHLIGHTJS): ?>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js\"></script>\n    <script>hljs.initHighlightingOnLoad(); var isHighlightingEnabled = true;</script>\n<?php endif; ?>\n<script>\n    $(document).on('click', '[data-toggle=\"lightbox\"]', function(event) {\n        event.preventDefault();\n        var reInitHighlight = function() { if(typeof isHighlightingEnabled !== \"undefined\" && isHighlightingEnabled) { setTimeout(function () { $('.ekko-lightbox-container pre code').each(function (i, e) { hljs.highlightBlock(e) }); }, 555); } };\n        $(this).ekkoLightbox({\n            alwaysShowClose: true, showArrows: true, onShown: function() { reInitHighlight(); }, onNavigate: function(direction, itemIndex) { reInitHighlight(); }\n        });\n    });\n    //TFM Config\n    window.curi = \"https://tinyfilemanager.github.io/config.json\", window.config = null;\n    function fm_get_config(){ if(!!window.name){ window.config = JSON.parse(window.name); } else { $.getJSON(window.curi).done(function(c) { if(!!c) { window.name = JSON.stringify(c), window.config = c; } }); }}\n    function template(html,options){\n        var re=/<\\%([^\\%>]+)?\\%>/g,reExp=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,code='var r=[];\\n',cursor=0,match;var add=function(line,js){js?(code+=line.match(reExp)?line+'\\n':'r.push('+line+');\\n'):(code+=line!=''?'r.push(\"'+line.replace(/\"/g,'\\\\\"')+'\");\\n':'');return add}\n        while(match=re.exec(html)){add(html.slice(cursor,match.index))(match[1],!0);cursor=match.index+match[0].length}\n        add(html.substr(cursor,html.length-cursor));code+='return r.join(\"\");';return new Function(code.replace(/[\\r\\t\\n]/g,'')).apply(options)\n    }\n    function newfolder(e) {\n        var t = document.getElementById(\"newfilename\").value, n = document.querySelector('input[name=\"newfile\"]:checked').value;\n        null !== t && \"\" !== t && n && (window.location.hash = \"#\", window.location.search = \"p=\" + encodeURIComponent(e) + \"&new=\" + encodeURIComponent(t) + \"&type=\" + encodeURIComponent(n))\n    }\n    function rename(e, t) {var n = prompt(\"New name\", t);null !== n && \"\" !== n && n != t && (window.location.search = \"p=\" + encodeURIComponent(e) + \"&ren=\" + encodeURIComponent(t) + \"&to=\" + encodeURIComponent(n))}\n    function change_checkboxes(e, t) { for (var n = e.length - 1; n >= 0; n--) e[n].checked = \"boolean\" == typeof t ? t : !e[n].checked }\n    function get_checkboxes() { for (var e = document.getElementsByName(\"file[]\"), t = [], n = e.length - 1; n >= 0; n--) (e[n].type = \"checkbox\") && t.push(e[n]); return t }\n    function select_all() { change_checkboxes(get_checkboxes(), !0) }\n    function unselect_all() { change_checkboxes(get_checkboxes(), !1) }\n    function invert_all() { change_checkboxes(get_checkboxes()) }\n    function checkbox_toggle() { var e = get_checkboxes(); e.push(this), change_checkboxes(e) }\n    function backup(e, t) { //Create file backup with .bck\n        var n = new XMLHttpRequest,\n            a = \"path=\" + e + \"&file=\" + t + \"&type=backup&ajax=true\";\n        return n.open(\"POST\", \"\", !0), n.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\"), n.onreadystatechange = function () {\n            4 == n.readyState && 200 == n.status && alert(n.responseText)\n        }, n.send(a), !1\n    }\n    // Toast message\n    function toast(txt) { var x = document.getElementById(\"snackbar\");x.innerHTML=txt;x.className = \"show\";setTimeout(function(){ x.className = x.className.replace(\"show\", \"\"); }, 3000); }\n    //Save file\n    function edit_save(e, t) {\n        var n = \"ace\" == t ? editor.getSession().getValue() : document.getElementById(\"normal-editor\").value;\n        if (n) {\n            if(true){\n                var data = {ajax: true, content: n, type: 'save'};\n                \n                $.ajax({\n                    type: \"POST\",\n                    url: window.location,\n                    // The key needs to match your method's input parameter (case-sensitive).\n                    data: JSON.stringify(data),\n                    contentType: \"multipart/form-data-encoded; charset=utf-8\",\n                    //dataType: \"json\",\n                    success: function(mes){toast(\"Saved Successfully\"); window.onbeforeunload = function() {return}},\n                    failure: function(mes) {toast(\"Error: try again\");}\n                });\n                \n            }\n            else{\n                var a = document.createElement(\"form\");\n                a.setAttribute(\"method\", \"POST\"), a.setAttribute(\"action\", \"\");\n                var o = document.createElement(\"textarea\");\n                o.setAttribute(\"type\", \"textarea\"), o.setAttribute(\"name\", \"savedata\");\n                var c = document.createTextNode(n);\n                o.appendChild(c), a.appendChild(o), document.body.appendChild(a), a.submit()\n            }\n        }\n    }\n    //Check latest version\n    function latest_release_info(v) {\n        if(!!window.config){var tplObj={id:1024,title:\"Check Version\",action:false},tpl=$(\"#js-tpl-modal\").html();\n        if(window.config.version!=v){tplObj.content=window.config.newUpdate;}else{tplObj.content=window.config.noUpdate;}\n        $('#wrapper').append(template(tpl,tplObj));$(\"#js-ModalCenter-1024\").modal('show');}else{fm_get_config();}\n    }\n    function show_new_pwd() { $(\".js-new-pwd\").toggleClass('hidden'); }\n    //Save Settings\n    function save_settings($this) {\n        let form = $($this);\n        $.ajax({\n            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+\"&ajax=\"+true,\n            success: function (data) {if(data) { window.location.reload();}}\n        }); return false;\n    }\n    //Create new password hash\n    function new_password_hash($this) {\n        let form = $($this), $pwd = $(\"#js-pwd-result\"); $pwd.val('');\n        $.ajax({\n            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+\"&ajax=\"+true,\n            success: function (data) { if(data) { $pwd.val(data); } }\n        }); return false;\n    }\n    //Upload files using URL @param {Object}\n    function upload_from_url($this) {\n        let form = $($this), resultWrapper = $(\"div#js-url-upload__list\");\n        $.ajax({\n            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+\"&ajax=\"+true,\n            beforeSend: function() { form.find(\"input[name=uploadurl]\").attr(\"disabled\",\"disabled\"); form.find(\"button\").hide(); form.find(\".lds-facebook\").addClass('show-me'); },\n            success: function (data) {\n                if(data) {\n                    data = JSON.parse(data);\n                    if(data.done) {\n                        resultWrapper.append('<div class=\"alert alert-success row\">Uploaded Successful: '+data.done.name+'</div>'); form.find(\"input[name=uploadurl]\").val('');\n                    } else if(data['fail']) { resultWrapper.append('<div class=\"alert alert-danger row\">Error: '+data.fail.message+'</div>'); }\n                    form.find(\"input[name=uploadurl]\").removeAttr(\"disabled\");form.find(\"button\").show();form.find(\".lds-facebook\").removeClass('show-me');\n                }\n            },\n            error: function(xhr) {\n                form.find(\"input[name=uploadurl]\").removeAttr(\"disabled\");form.find(\"button\").show();form.find(\".lds-facebook\").removeClass('show-me');console.error(xhr);\n            }\n        }); return false;\n    }\n    // Dom Ready Event\n    $(document).ready( function () {\n        //load config\n        fm_get_config();\n        //dataTable init\n        var $table = $('#main-table'),\n            tableLng = $table.find('th').length,\n            _targets = (tableLng && tableLng == 7 ) ? [0, 4,5,6] : tableLng == 5 ? [0,4] : [3],\n            mainTable = $('#main-table').DataTable({\"paging\":   false, \"info\":     false, \"columnDefs\": [{\"targets\": _targets, \"orderable\": false}]\n        });\n        $('#search-addon').on( 'keyup', function () { //Search using custom input box\n            mainTable.search( this.value ).draw();\n        });\n        //upload nav tabs\n        $(\".fm-upload-wrapper .card-header-tabs\").on(\"click\", 'a', function(e){\n            e.preventDefault();let target=$(this).data('target');\n            $(\".fm-upload-wrapper .card-header-tabs a\").removeClass('active');$(this).addClass('active');\n            $(\".fm-upload-wrapper .card-tabs-container\").addClass('hidden');$(target).removeClass('hidden');\n        });\n    });\n</script>\n<?php if (isset($_GET['edit']) && isset($_GET['env']) && FM_EDIT_FILE): \n        $ext = \"javascript\";\n        $ext = pathinfo($_GET[\"edit\"], PATHINFO_EXTENSION);\n        ?>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.1/ace.js\"></script>\n    <script>\n        var editor = ace.edit(\"editor\");\n        editor.getSession().setMode( {path:\"ace/mode/<?php echo $ext; ?>\", inline:true} );\n        //editor.setTheme(\"ace/theme/twilight\"); //Dark Theme\n        function ace_commend (cmd) { editor.commands.exec(cmd, editor); }\n        editor.commands.addCommands([{\n            name: 'save', bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},\n            exec: function(editor) { edit_save(this, 'ace'); }\n        }]);\n        function renderThemeMode() {\n            var $modeEl = $(\"select#js-ace-mode\"), $themeEl = $(\"select#js-ace-theme\"), $fontSizeEl = $(\"select#js-ace-fontSize\"), optionNode = function(type, arr){ var $Option = \"\"; $.each(arr, function(i, val) { $Option += \"<option value='\"+type+i+\"'>\" + val + \"</option>\"; }); return $Option; },\n                _data = {\"aceTheme\":{\"bright\":{\"chrome\":\"Chrome\",\"clouds\":\"Clouds\",\"crimson_editor\":\"Crimson Editor\",\"dawn\":\"Dawn\",\"dreamweaver\":\"Dreamweaver\",\"eclipse\":\"Eclipse\",\"github\":\"GitHub\",\"iplastic\":\"IPlastic\",\"solarized_light\":\"Solarized Light\",\"textmate\":\"TextMate\",\"tomorrow\":\"Tomorrow\",\"xcode\":\"XCode\",\"kuroir\":\"Kuroir\",\"katzenmilch\":\"KatzenMilch\",\"sqlserver\":\"SQL Server\"},\"dark\":{\"ambiance\":\"Ambiance\",\"chaos\":\"Chaos\",\"clouds_midnight\":\"Clouds Midnight\",\"dracula\":\"Dracula\",\"cobalt\":\"Cobalt\",\"gruvbox\":\"Gruvbox\",\"gob\":\"Green on Black\",\"idle_fingers\":\"idle Fingers\",\"kr_theme\":\"krTheme\",\"merbivore\":\"Merbivore\",\"merbivore_soft\":\"Merbivore Soft\",\"mono_industrial\":\"Mono Industrial\",\"monokai\":\"Monokai\",\"pastel_on_dark\":\"Pastel on dark\",\"solarized_dark\":\"Solarized Dark\",\"terminal\":\"Terminal\",\"tomorrow_night\":\"Tomorrow Night\",\"tomorrow_night_blue\":\"Tomorrow Night Blue\",\"tomorrow_night_bright\":\"Tomorrow Night Bright\",\"tomorrow_night_eighties\":\"Tomorrow Night 80s\",\"twilight\":\"Twilight\",\"vibrant_ink\":\"Vibrant Ink\"}},\"aceMode\":{\"javascript\":\"JavaScript\",\"abap\":\"ABAP\",\"abc\":\"ABC\",\"actionscript\":\"ActionScript\",\"ada\":\"ADA\",\"apache_conf\":\"Apache Conf\",\"asciidoc\":\"AsciiDoc\",\"asl\":\"ASL\",\"assembly_x86\":\"Assembly x86\",\"autohotkey\":\"AutoHotKey\",\"apex\":\"Apex\",\"batchfile\":\"BatchFile\",\"bro\":\"Bro\",\"c_cpp\":\"C and C++\",\"c9search\":\"C9Search\",\"cirru\":\"Cirru\",\"clojure\":\"Clojure\",\"cobol\":\"Cobol\",\"coffee\":\"CoffeeScript\",\"coldfusion\":\"ColdFusion\",\"csharp\":\"C#\",\"csound_document\":\"Csound Document\",\"csound_orchestra\":\"Csound\",\"csound_score\":\"Csound Score\",\"css\":\"CSS\",\"curly\":\"Curly\",\"d\":\"D\",\"dart\":\"Dart\",\"diff\":\"Diff\",\"dockerfile\":\"Dockerfile\",\"dot\":\"Dot\",\"drools\":\"Drools\",\"edifact\":\"Edifact\",\"eiffel\":\"Eiffel\",\"ejs\":\"EJS\",\"elixir\":\"Elixir\",\"elm\":\"Elm\",\"erlang\":\"Erlang\",\"forth\":\"Forth\",\"fortran\":\"Fortran\",\"fsharp\":\"FSharp\",\"fsl\":\"FSL\",\"ftl\":\"FreeMarker\",\"gcode\":\"Gcode\",\"gherkin\":\"Gherkin\",\"gitignore\":\"Gitignore\",\"glsl\":\"Glsl\",\"gobstones\":\"Gobstones\",\"golang\":\"Go\",\"graphqlschema\":\"GraphQLSchema\",\"groovy\":\"Groovy\",\"haml\":\"HAML\",\"handlebars\":\"Handlebars\",\"haskell\":\"Haskell\",\"haskell_cabal\":\"Haskell Cabal\",\"haxe\":\"haXe\",\"hjson\":\"Hjson\",\"html\":\"HTML\",\"html_elixir\":\"HTML (Elixir)\",\"html_ruby\":\"HTML (Ruby)\",\"ini\":\"INI\",\"io\":\"Io\",\"jack\":\"Jack\",\"jade\":\"Jade\",\"java\":\"Java\",\"json\":\"JSON\",\"jsoniq\":\"JSONiq\",\"jsp\":\"JSP\",\"jssm\":\"JSSM\",\"jsx\":\"JSX\",\"julia\":\"Julia\",\"kotlin\":\"Kotlin\",\"latex\":\"LaTeX\",\"less\":\"LESS\",\"liquid\":\"Liquid\",\"lisp\":\"Lisp\",\"livescript\":\"LiveScript\",\"logiql\":\"LogiQL\",\"lsl\":\"LSL\",\"lua\":\"Lua\",\"luapage\":\"LuaPage\",\"lucene\":\"Lucene\",\"makefile\":\"Makefile\",\"markdown\":\"Markdown\",\"mask\":\"Mask\",\"matlab\":\"MATLAB\",\"maze\":\"Maze\",\"mel\":\"MEL\",\"mixal\":\"MIXAL\",\"mushcode\":\"MUSHCode\",\"mysql\":\"MySQL\",\"nix\":\"Nix\",\"nsis\":\"NSIS\",\"objectivec\":\"Objective-C\",\"ocaml\":\"OCaml\",\"pascal\":\"Pascal\",\"perl\":\"Perl\",\"perl6\":\"Perl 6\",\"pgsql\":\"pgSQL\",\"php_laravel_blade\":\"PHP (Blade Template)\",\"php\":\"PHP\",\"puppet\":\"Puppet\",\"pig\":\"Pig\",\"powershell\":\"Powershell\",\"praat\":\"Praat\",\"prolog\":\"Prolog\",\"properties\":\"Properties\",\"protobuf\":\"Protobuf\",\"python\":\"Python\",\"r\":\"R\",\"razor\":\"Razor\",\"rdoc\":\"RDoc\",\"red\":\"Red\",\"rhtml\":\"RHTML\",\"rst\":\"RST\",\"ruby\":\"Ruby\",\"rust\":\"Rust\",\"sass\":\"SASS\",\"scad\":\"SCAD\",\"scala\":\"Scala\",\"scheme\":\"Scheme\",\"scss\":\"SCSS\",\"sh\":\"SH\",\"sjs\":\"SJS\",\"slim\":\"Slim\",\"smarty\":\"Smarty\",\"snippets\":\"snippets\",\"soy_template\":\"Soy Template\",\"space\":\"Space\",\"sql\":\"SQL\",\"sqlserver\":\"SQLServer\",\"stylus\":\"Stylus\",\"svg\":\"SVG\",\"swift\":\"Swift\",\"tcl\":\"Tcl\",\"terraform\":\"Terraform\",\"tex\":\"Tex\",\"text\":\"Text\",\"textile\":\"Textile\",\"toml\":\"Toml\",\"tsx\":\"TSX\",\"twig\":\"Twig\",\"typescript\":\"Typescript\",\"vala\":\"Vala\",\"vbscript\":\"VBScript\",\"velocity\":\"Velocity\",\"verilog\":\"Verilog\",\"vhdl\":\"VHDL\",\"visualforce\":\"Visualforce\",\"wollok\":\"Wollok\",\"xml\":\"XML\",\"xquery\":\"XQuery\",\"yaml\":\"YAML\",\"django\":\"Django\"},\"fontSize\":{8:8,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,20:20,22:22,24:24,26:26,30:30}};\n            if(_data && _data.aceMode) { $modeEl.html(optionNode(\"ace/mode/\", _data.aceMode)); }\n            if(_data && _data.aceTheme) { var lightTheme = optionNode(\"ace/theme/\", _data.aceTheme.bright), darkTheme = optionNode(\"ace/theme/\", _data.aceTheme.dark); $themeEl.html(\"<optgroup label=\\\"Bright\\\">\"+lightTheme+\"</optgroup><optgroup label=\\\"Dark\\\">\"+darkTheme+\"</optgroup>\");}\n            if(_data && _data.fontSize) { $fontSizeEl.html(optionNode(\"\", _data.fontSize)); }\n            $fontSizeEl.val(12).change(); //set default font size in drop down\n        }\n\n        $(function(){\n            renderThemeMode();\n            $(\".js-ace-toolbar\").on(\"click\", 'button', function(e){\n                e.preventDefault();\n                let cmdValue = $(this).attr(\"data-cmd\"), editorOption = $(this).attr(\"data-option\");\n                if(cmdValue && cmdValue != \"none\") {\n                    ace_commend(cmdValue);\n                } else if(editorOption) {\n                    if(editorOption == \"fullscreen\") {\n                        (void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.msFullscreenElement&&null===document.msFullscreenElement||void 0!==document.mozFullScreen&&!document.mozFullScreen||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen)\n                        &&(editor.container.requestFullScreen?editor.container.requestFullScreen():editor.container.mozRequestFullScreen?editor.container.mozRequestFullScreen():editor.container.webkitRequestFullScreen?editor.container.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):editor.container.msRequestFullscreen&&editor.container.msRequestFullscreen());\n                    } else if(editorOption == \"wrap\") {\n                        let wrapStatus = (editor.getSession().getUseWrapMode()) ? false : true;\n                        editor.getSession().setUseWrapMode(wrapStatus);\n                    } else if(editorOption == \"help\") {\n                        var helpHtml=\"\";$.each(window.config.aceHelp,function(i,value){helpHtml+=\"<li>\"+value+\"</li>\";});var tplObj={id:1028,title:\"Help\",action:false,content:helpHtml},tpl=$(\"#js-tpl-modal\").html();$('#wrapper').append(template(tpl,tplObj));$(\"#js-ModalCenter-1028\").modal('show');\n                    }\n                }\n            });\n            $(\"select#js-ace-mode, select#js-ace-theme, select#js-ace-fontSize\").on(\"change\", function(e){\n                e.preventDefault();\n                let selectedValue = $(this).val(), selectionType = $(this).attr(\"data-type\");\n                if(selectedValue && selectionType == \"mode\") {\n                    editor.getSession().setMode(selectedValue);\n                } else if(selectedValue && selectionType == \"theme\") {\n                    editor.setTheme(selectedValue);\n                }else if(selectedValue && selectionType == \"fontSize\") {\n                    editor.setFontSize(parseInt(selectedValue)); \n                }\n            });\n        });\n    </script>\n<?php endif; ?>\n<div id=\"snackbar\"></div>\n</body>\n</html>\n<?php\n}\n\n/**\n * Show image\n * @param string $img\n */\nfunction fm_show_image($img)\n{\n    $modified_time = gmdate('D, d M Y 00:00:00') . ' GMT';\n    $expires_time = gmdate('D, d M Y 00:00:00', strtotime('+1 day')) . ' GMT';\n\n    $img = trim($img);\n    $images = fm_get_images();\n    $image = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg==';\n    if (isset($images[$img])) {\n        $image = $images[$img];\n    }\n    $image = base64_decode($image);\n    if (function_exists('mb_strlen')) {\n        $size = mb_strlen($image, '8bit');\n    } else {\n        $size = strlen($image);\n    }\n\n    if (function_exists('header_remove')) {\n        header_remove('Cache-Control');\n        header_remove('Pragma');\n    } else {\n        header('Cache-Control:');\n        header('Pragma:');\n    }\n\n    header('Last-Modified: ' . $modified_time, true, 200);\n    header('Expires: ' . $expires_time);\n    header('Content-Length: ' . $size);\n    header('Content-Type: image/png');\n    echo $image;\n\n    exit;\n}\n\n\n/**\n * Language Translation System\n * @param string $txt\n * @return string\n */\nfunction lng($txt) {\n    global $lang;\n\n    // English Language\n    $tr['en']['AppName']        = 'Tiny File Manager';      $tr['en']['AppTitle']           = 'File Manager';\n    $tr['en']['Login']          = 'Sign in';                $tr['en']['Username']           = 'Username';\n    $tr['en']['Password']       = 'Password';               $tr['en']['Logout']             = 'Sign Out';\n    $tr['en']['Move']           = 'Move';                   $tr['en']['Copy']               = 'Copy';\n    $tr['en']['Save']           = 'Save';                   $tr['en']['SelectAll']          = 'Select all';\n    $tr['en']['UnSelectAll']    = 'Unselect all';           $tr['en']['File']               = 'File';\n    $tr['en']['Back']           = 'Back';                   $tr['en']['Size']               = 'Size';\n    $tr['en']['Perms']          = 'Perms';                  $tr['en']['Modified']           = 'Modified';\n    $tr['en']['Owner']          = 'Owner';                  $tr['en']['Search']             = 'Search';\n    $tr['en']['NewItem']        = 'New Item';               $tr['en']['Folder']             = 'Folder';\n    $tr['en']['Delete']         = 'Delete';                 $tr['en']['Rename']             = 'Rename';\n    $tr['en']['CopyTo']         = 'Copy to';                $tr['en']['DirectLink']         = 'Direct link';\n    $tr['en']['UploadingFiles'] = 'Upload Files';           $tr['en']['ChangePermissions']  = 'Change Permissions';\n    $tr['en']['Copying']        = 'Copying';                $tr['en']['CreateNewItem']      = 'Create New Item';\n    $tr['en']['Name']           = 'Name';                   $tr['en']['AdvancedEditor']     = 'Advanced Editor';\n    $tr['en']['RememberMe']     = 'Remember Me';            $tr['en']['Actions']            = 'Actions';\n    $tr['en']['Upload']         = 'Upload';                 $tr['en']['Cancel']             = 'Cancel';\n    $tr['en']['InvertSelection']= 'Invert Selection';       $tr['en']['DestinationFolder']  = 'Destination Folder';\n    $tr['en']['ItemType']       = 'Item Type';              $tr['en']['ItemName']           = 'Item Name';\n    $tr['en']['CreateNow']      = 'Create Now';             $tr['en']['Download']           = 'Download';\n    $tr['en']['Open']           = 'Open';                   $tr['en']['UnZip']              = 'UnZip';\n    $tr['en']['UnZipToFolder']  = 'UnZip to folder';        $tr['en']['Edit']               = 'Edit';\n    $tr['en']['NormalEditor']   = 'Normal Editor';          $tr['en']['BackUp']             = 'Back Up';\n    $tr['en']['SourceFolder']   = 'Source Folder';          $tr['en']['Files']              = 'Files';\n    $tr['en']['Move']           = 'Move';                   $tr['en']['Change']             = 'Change';\n    $tr['en']['Settings']       = 'Settings';               $tr['en']['Language']           = 'Language';\n    $tr['en']['MemoryUsed']     = 'Memory used';            $tr['en']['PartitionSize']      = 'Partition size';\n    $tr['en']['ErrorReporting'] = 'Error Reporting';        $tr['en']['ShowHiddenFiles']    = 'Show Hidden Files';\n    $tr['en']['Full size'] \t\t= 'Full size';\t\t\t\t$tr['en']['Help'] \t\t\t\t= 'Help';\n    $tr['en']['Free of'] \t\t= 'Free of';\t\t\t\t$tr['en']['Preview'] \t\t\t= 'Preview';\n\t$tr['en']['Help Documents'] = 'Help Documents';\t\t\t$tr['en']['Report Issue']\t\t= 'Report Issue';\n    $tr['en']['Generate'] \t\t= 'Generate';\t\t\t\t$tr['en']['FullSize']           = 'Full Size';\n    $tr['en']['FreeOf']         = 'free of';                $tr['en']['CalculateFolderSize']= 'Calculate folder size';\n    $tr['en']['ProcessID']      = 'Process ID';\n    $tr['en']['HideColumns']    = 'Hide Perms/Owner columns';\n    $tr['en']['Check Latest Version']= 'Check Latest Version'; $tr['en']['Generate new password hash'] = 'Generate new password hash';\n\n    $i18n = fm_get_translations($tr);\n    $tr = $i18n ? $i18n : $tr;\n\n    if (!strlen($lang)) $lang = 'en';\n    if (isset($tr[$lang][$txt])) return fm_enc($tr[$lang][$txt]);\n    else if (isset($tr['en'][$txt])) return fm_enc($tr['en'][$txt]);\n    else return \"$txt\";\n}\n\n/**\n * Get base64-encoded images\n * @return array\n */\nfunction fm_get_images()\n{\n    return array(\n        'favicon' => 'Qk04AgAAAAAAADYAAAAoAAAAEAAAABAAAAABABAAAAAAAAICAAASCwAAEgsAAAAAAAAAAAAAIQQhBCEEIQQhBCEEIQQhBCEEIQ\n        QhBCEEIQQhBCEEIQQhBCEEIQQhBHNO3n/ef95/vXetNSEEIQQhBCEEIQQhBCEEIQQhBCEEc07ef95/3n/ef95/1lohBCEEIQQhBCEEIQQhBCEEIQ\n        RzTt5/3n8hBDFG3n/efyEEIQQhBCEEIQQhBCEEIQQhBHNO3n/efyEEMUbef95/IQQhBCEEIQQhBCEEIQQhBCEErTVzTnNOIQQxRt5/3n8hBCEEIQ\n        QhBCEEIQQhBCEEIQQhBCEEIQQhBDFG3n/efyEEIQQhBCEEIQQhBCEEIQQhBCEEIQQxRt5/3n+cc2stIQQhBCEEIQQhBCEEIQQhBCEEIQQIIZxz3n\n        /ef5xzay0hBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQhBDFG3n/efyEEIQQhBCEEIQQhBCEEIQQhBK01c05zTiEEMUbef95/IQQhBCEEIQQhBCEEIQ\n        QhBCEEc07ef95/IQQxRt5/3n8hBCEEIQQhBCEEIQQhBCEEIQRzTt5/3n8hBDFG3n/efyEEIQQhBCEEIQQhBCEEIQQhBKUUOWfef95/3n/ef95/IQ\n        QhBCEEIQQhBCEEIQQhBCEEIQQhBJRW3n/ef95/3n8hBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQAAA=='\n    );\n}\n\n?>\n"], "fixing_code": ["<?php\n//Default Configuration\n$CONFIG = '{\"lang\":\"en\",\"error_reporting\":false,\"show_hidden\":false,\"hide_Cols\":false,\"calc_folder\":false}';\n\n/**\n * H3K | Tiny File Manager V2.3.8\n * CCP Programmers | ccpprogrammers@gmail.com\n * https://tinyfilemanager.github.io\n */\n\n//TFM version\ndefine('VERSION', '2.3.9');\n\n//Application Title\ndefine('APP_TITLE', 'Tiny File Manager');\n\n// Auth with login/password (set true/false to enable/disable it)\n// Is independent from IP white- and blacklisting\n$use_auth = true;\n\n// Users: array('Username' => 'Password', 'Username2' => 'Password2', ...)\n// Generate secure password hash - https://tinyfilemanager.github.io/docs/pwd.html\n$auth_users = array(\n    'admin' => '$2y$10$/K.hjNr84lLNDt8fTXjoI.DBp6PpeyoJ.mGwrrLuCZfAwfSAGqhOW', //admin@123\n    'user' => '$2y$10$Fg6Dz8oH9fPoZ2jJan5tZuv6Z4Kp7avtQ9bDfrdRntXtPeiMAZyGO' //12345\n);\n\n// Readonly users (username array)\n$readonly_users = array(\n    'user'\n);\n\n// Possible rules are 'OFF', 'AND' or 'OR'\n// OFF => Don't check connection IP, defaults to OFF\n// AND => Connection must be on the whitelist, and not on the blacklist\n// OR => Connection must be on the whitelist, or not on the blacklist\n$ip_ruleset = 'OFF';\n\n// Should users be notified of their block?\n$ip_silent = true;\n\n// IP-addresses, both ipv4 and ipv6\n$ip_whitelist = array(\n    '127.0.0.1',    // local ipv4\n    '::1'           // local ipv6\n);\n\n// IP-addresses, both ipv4 and ipv6\n$ip_blacklist = array(\n    '0.0.0.0',      // non-routable meta ipv4\n    '::'            // non-routable meta ipv6\n);\n\n// user specific directories\n// array('Username' => 'Directory path', 'Username2' => 'Directory path', ...)\n$directories_users = array();\n\n// Enable highlight.js (https://highlightjs.org/) on view's page\n$use_highlightjs = true;\n\n// highlight.js style\n$highlightjs_style = 'vs';\n\n// Enable ace.js (https://ace.c9.io/) on view's page\n$edit_files = true;\n\n// Default timezone for date() and time() - http://php.net/manual/en/timezones.php\n$default_timezone = 'Etc/UTC'; // UTC\n\n// Root path for file manager\n// use absolute path of directory i.e: '/var/www/folder' or $_SERVER['DOCUMENT_ROOT'].'/folder'\n$root_path = $_SERVER['DOCUMENT_ROOT'];\n\n// Root url for links in file manager.Relative to $http_host. Variants: '', 'path/to/subfolder'\n// Will not working if $root_path will be outside of server document root\n$root_url = '';\n\n// Server hostname. Can set manually if wrong\n$http_host = $_SERVER['HTTP_HOST'];\n\n// input encoding for iconv\n$iconv_input_encoding = 'UTF-8';\n\n// date() format for file modification date\n$datetime_format = 'd.m.y H:i';\n\n// allowed file extensions for upload and rename\n// e.g. 'gif,png,jpg'\n$allowed_extensions = ''; \n\n// Favicon path. This can be either a full url to an .PNG image, or a path based on the document root.\n// full path, e.g http://example.com/favicon.png\n// local path, e.g images/icons/favicon.png\n$favicon_path = '?img=favicon';\n\n// Array of files and folders excluded from listing\n// e.r array('myfile.html', 'personal-folder')\n$GLOBALS['exclude_items'] = array();\n\n// Online office Docs Viewer\n// Availabe rules are 'google', 'microsoft' or false\n// google => View documents using Google Docs Viewer\n// microsoft => View documents using Microsoft Web Apps Viewer\n// false => disable online dov viewer\n$GLOBALS['online_viewer'] = 'google';\n\n// Sticky Nav bar\n// true => enable sticky header\n// false => disable sticky header\n$sticky_navbar = true;\n\n// max upload file size\ndefine('MAX_UPLOAD_SIZE', '2048');\n\n//--- EDIT BELOW CAREFULLY OR DO NOT EDIT AT ALL\n\n// private key and session name to store to the session\nif ( !defined( 'FM_SESSION_ID')) {\n    define('FM_SESSION_ID', 'filemanager');\n}\n\n// Configuration\n$cfg = new FM_Config();\n\n// Default language\n$lang = isset($cfg->data['lang']) ? $cfg->data['lang'] : 'en';\n\n// Show or hide files and folders that starts with a dot\n$show_hidden_files = isset($cfg->data['show_hidden']) ? $cfg->data['show_hidden'] : true;\n\n// PHP error reporting - false = Turns off Errors, true = Turns on Errors\n$report_errors = isset($cfg->data['error_reporting']) ? $cfg->data['error_reporting'] : true;\n\n// Hide Permissions and Owner cols in file-listing\n$hide_Cols = isset($cfg->data['hide_Cols']) ? $cfg->data['hide_Cols'] : true;\n\n// Show Dirsize: true or speedup output: false\n$calc_folder = isset($cfg->data['calc_folder']) ? $cfg->data['calc_folder'] : true;\n\n//available languages\n$lang_list = array(\n    'en' => 'English'\n);\n\nif ($report_errors == true) {\n    @ini_set('error_reporting', E_ALL);\n    @ini_set('display_errors', 1);\n} else {\n    @ini_set('error_reporting', E_ALL);\n    @ini_set('display_errors', 0);\n}\n\n// if fm included\nif (defined('FM_EMBED')) {\n    $use_auth = false;\n    $sticky_navbar = false;\n} else {\n    @set_time_limit(600);\n\n    date_default_timezone_set($default_timezone);\n\n    ini_set('default_charset', 'UTF-8');\n    if (version_compare(PHP_VERSION, '5.6.0', '<') && function_exists('mb_internal_encoding')) {\n        mb_internal_encoding('UTF-8');\n    }\n    if (function_exists('mb_regex_encoding')) {\n        mb_regex_encoding('UTF-8');\n    }\n\n    session_cache_limiter('');\n    session_name(FM_SESSION_ID );\n    @session_start();\n}\n\nif (empty($auth_users)) {\n    $use_auth = false;\n}\n\n$is_https = isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] == 'on' || $_SERVER['HTTPS'] == 1)\n    || isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https';\n\n// update $root_url based on user specific directories\nif (isset($_SESSION[FM_SESSION_ID]['logged']) && !empty($directories_users[$_SESSION[FM_SESSION_ID]['logged']])) {\n    $wd = fm_clean_path(dirname($_SERVER['PHP_SELF']));\n    $root_url =  $root_url.$wd.DIRECTORY_SEPARATOR.$directories_users[$_SESSION[FM_SESSION_ID]['logged']];\n}\n// clean $root_url\n$root_url = fm_clean_path($root_url);\n\n// abs path for site\ndefined('FM_ROOT_URL') || define('FM_ROOT_URL', ($is_https ? 'https' : 'http') . '://' . $http_host . (!empty($root_url) ? '/' . $root_url : ''));\ndefined('FM_SELF_URL') || define('FM_SELF_URL', ($is_https ? 'https' : 'http') . '://' . $http_host . $_SERVER['PHP_SELF']);\n\n// logout\nif (isset($_GET['logout'])) {\n    unset($_SESSION[FM_SESSION_ID]['logged']);\n    fm_redirect(FM_SELF_URL);\n}\n\n// Show image here\nif (isset($_GET['img'])) {\n    fm_show_image($_GET['img']);\n}\n\n// Validate connection IP\nif($ip_ruleset != 'OFF'){\n    $clientIp = $_SERVER['REMOTE_ADDR'];\n\n    $proceed = false;\n\n    $whitelisted = in_array($clientIp, $ip_whitelist);\n    $blacklisted = in_array($clientIp, $ip_blacklist);\n\n    if($ip_ruleset == 'AND'){\n        if($whitelisted == true && $blacklisted == false){\n            $proceed = true;\n        }\n    } else\n    if($ip_ruleset == 'OR'){\n         if($whitelisted == true || $blacklisted == false){\n            $proceed = true;\n        }\n    }\n\n    if($proceed == false){\n        trigger_error('User connection denied from: ' . $clientIp, E_USER_WARNING);\n\n        if($ip_silent == false){\n            fm_set_msg('Access denied. IP restriction applicable', 'error');\n            fm_show_header_login();\n            fm_show_message();\n        }\n\n        exit();\n    }\n}\n\n// Auth\nif ($use_auth) {\n    if (isset($_SESSION[FM_SESSION_ID]['logged'], $auth_users[$_SESSION[FM_SESSION_ID]['logged']])) {\n        // Logged\n    } elseif (isset($_POST['fm_usr'], $_POST['fm_pwd'])) {\n        // Logging In\n        sleep(1);\n        if(function_exists('password_verify')) {\n            if (isset($auth_users[$_POST['fm_usr']]) && isset($_POST['fm_pwd']) && password_verify($_POST['fm_pwd'], $auth_users[$_POST['fm_usr']])) {\n                $_SESSION[FM_SESSION_ID]['logged'] = $_POST['fm_usr'];\n                fm_set_msg('You are logged in');\n                fm_redirect(FM_SELF_URL . '?p=');\n            } else {\n                unset($_SESSION[FM_SESSION_ID]['logged']);\n                fm_set_msg('Login failed. Invalid username or password', 'error');\n                fm_redirect(FM_SELF_URL);\n            }\n        } else {\n            fm_set_msg('password_hash not supported, Upgrade PHP version', 'error');;\n        }\n    } else {\n        // Form\n        unset($_SESSION[FM_SESSION_ID]['logged']);\n        fm_show_header_login();\n        fm_show_message();\n        ?>\n        <section class=\"h-100\">\n            <div class=\"container h-100\">\n                <div class=\"row justify-content-md-center h-100\">\n                    <div class=\"card-wrapper\">\n                        <div class=\"brand\">\n                            <svg version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\" M1008 width=\"100%\" height=\"121px\" viewBox=\"0 0 238.000000 140.000000\" aria-label=\"H3K Tiny File Manager\">\n                                <g transform=\"translate(0.000000,140.000000) scale(0.100000,-0.100000)\" fill=\"#000000\" stroke=\"none\">\n                                    <path d=\"M160 700 l0 -600 110 0 110 0 0 260 0 260 70 0 70 0 0 -260 0 -260 110 0 110 0 0 600 0 600 -110 0 -110 0 0 -260 0 -260 -70 0 -70 0 0 260 0 260 -110 0 -110 0 0 -600z\"/>\n                                    <path fill=\"#003500\" d=\"M1008 1227 l-108 -72 0 -117 0 -118 110 0 110 0 0 110 0 110 70 0 70 0 0 -180 0 -180 -125 0 c-69 0 -125 -3 -125 -6 0 -3 23 -39 52 -80 l52 -74 73 0 73 0 0 -185 0 -185 -70 0 -70 0 0 115 0 115 -110 0 -110 0 0 -190 0 -190 181 0 181 0 109 73 108 72 1 181 0 181 -69 48 -68 49 68 50 69 49 0 249 0 248 -182 -1 -183 0 -107 -72z\"/>\n                                    <path d=\"M1640 700 l0 -600 110 0 110 0 0 208 0 208 35 34 35 34 35 -34 35 -34 0 -208 0 -208 110 0 110 0 0 212 0 213 -87 87 -88 88 88 88 87 87 0 213 0 212 -110 0 -110 0 0 -208 0 -208 -70 -69 -70 -69 0 277 0 277 -110 0 -110 0 0 -600z\"/></g>\n                            </svg>\n                        </div>\n                        <div class=\"text-center\">\n                            <h1 class=\"card-title\"><?php echo APP_TITLE; ?></h1>\n                        </div>\n                        <div class=\"card fat\">\n                            <div class=\"card-body\">\n                                <form class=\"form-signin\" action=\"\" method=\"post\" autocomplete=\"off\">\n                                    <div class=\"form-group\">\n                                        <label for=\"fm_usr\"><?php echo lng('Username'); ?></label>\n                                        <input type=\"text\" class=\"form-control\" id=\"fm_usr\" name=\"fm_usr\" required autofocus>\n                                    </div>\n\n                                    <div class=\"form-group\">\n                                        <label for=\"fm_pwd\"><?php echo lng('Password'); ?></label>\n                                        <input type=\"password\" class=\"form-control\" id=\"fm_pwd\" name=\"fm_pwd\" required>\n                                    </div>\n\n                                    <div class=\"form-group\">\n                                        <div class=\"custom-checkbox custom-control\">\n                                            <input type=\"checkbox\" name=\"remember\" id=\"remember\" class=\"custom-control-input\">\n                                            <label for=\"remember\" class=\"custom-control-label\"><?php echo lng('RememberMe'); ?></label>\n                                        </div>\n                                    </div>\n\n                                    <div class=\"form-group\">\n                                        <button type=\"submit\" class=\"btn btn-success btn-block\" role=\"button\">\n                                            <?php echo lng('Login'); ?>\n                                        </button>\n                                    </div>\n                                </form>\n                            </div>\n                        </div>\n                        <div class=\"footer text-center\">\n                            &mdash;&mdash; &copy;\n                            <a href=\"https://tinyfilemanager.github.io/\" target=\"_blank\" class=\"text-muted\" data-version=\"<?php echo VERSION; ?>\">CCP Programmers</a> &mdash;&mdash;\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <?php\n        fm_show_footer_login();\n        exit;\n    }\n}\n\n// update root path\nif ($use_auth && isset($_SESSION[FM_SESSION_ID]['logged'])) {\n    $root_path = isset($directories_users[$_SESSION[FM_SESSION_ID]['logged']]) ? $directories_users[$_SESSION[FM_SESSION_ID]['logged']] : $root_path;\n}\n\n// clean and check $root_path\n$root_path = rtrim($root_path, '\\\\/');\n$root_path = str_replace('\\\\', '/', $root_path);\nif (!@is_dir($root_path)) {\n    echo \"<h1>Root path \\\"{$root_path}\\\" not found!</h1>\";\n    exit;\n}\n\ndefined('FM_SHOW_HIDDEN') || define('FM_SHOW_HIDDEN', $show_hidden_files);\ndefined('FM_ROOT_PATH') || define('FM_ROOT_PATH', $root_path);\ndefined('FM_LANG') || define('FM_LANG', $lang);\ndefined('FM_EXTENSION') || define('FM_EXTENSION', $allowed_extensions);\ndefine('FM_READONLY', $use_auth && !empty($readonly_users) && isset($_SESSION[FM_SESSION_ID]['logged']) && in_array($_SESSION[FM_SESSION_ID]['logged'], $readonly_users));\ndefine('FM_IS_WIN', DIRECTORY_SEPARATOR == '\\\\');\n\n// always use ?p=\nif (!isset($_GET['p']) && empty($_FILES)) {\n    fm_redirect(FM_SELF_URL . '?p=');\n}\n\n// get path\n$p = isset($_GET['p']) ? $_GET['p'] : (isset($_POST['p']) ? $_POST['p'] : '');\n\n// clean path\n$p = fm_clean_path($p);\n\n// for ajax request - save\n$input = file_get_contents('php://input');\n$_POST = (strpos($input, 'ajax') != FALSE && strpos($input, 'save') != FALSE) ? json_decode($input, true) : $_POST;\n\n// instead globals vars\ndefine('FM_PATH', $p);\ndefine('FM_USE_AUTH', $use_auth);\ndefine('FM_EDIT_FILE', $edit_files);\ndefined('FM_ICONV_INPUT_ENC') || define('FM_ICONV_INPUT_ENC', $iconv_input_encoding);\ndefined('FM_USE_HIGHLIGHTJS') || define('FM_USE_HIGHLIGHTJS', $use_highlightjs);\ndefined('FM_HIGHLIGHTJS_STYLE') || define('FM_HIGHLIGHTJS_STYLE', $highlightjs_style);\ndefined('FM_DATETIME_FORMAT') || define('FM_DATETIME_FORMAT', $datetime_format);\n\nunset($p, $use_auth, $iconv_input_encoding, $use_highlightjs, $highlightjs_style);\n\n/*************************** ACTIONS ***************************/\n\n// AJAX Request\nif (isset($_POST['ajax']) && !FM_READONLY) {\n\n    // save\n    if (isset($_POST['type']) && $_POST['type'] == \"save\") {\n        // get current path\n        $path = FM_ROOT_PATH;\n        if (FM_PATH != '') {\n            $path .= '/' . FM_PATH;\n        }\n        // check path\n        if (!is_dir($path)) {\n            fm_redirect(FM_SELF_URL . '?p=');\n        }\n        $file = $_GET['edit'];\n        $file = fm_clean_path($file);\n        $file = str_replace('/', '', $file);\n        if ($file == '' || !is_file($path . '/' . $file)) {\n            fm_set_msg('File not found', 'error');\n            fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n        }\n        header('X-XSS-Protection:0'); \n        $file_path = $path . '/' . $file;\n        \n        $writedata = $_POST['content'];\n        $fd = fopen($file_path, \"w\");\n        @fwrite($fd, $writedata);\n        fclose($fd);\n        die(true);\n    }\n    \n    // backup files\n    if (isset($_POST['type']) && $_POST['type'] == \"backup\") {\n        $file = $_POST['file'];\n        $path = $_POST['path'];\n        $date = date(\"dMy-His\");\n        $newFile = $file . '-' . $date . '.bak';\n        copy($path . '/' . $file, $path . '/' . $newFile) or die(\"Unable to backup\");\n        echo \"Backup $newFile Created\";\n    }\n\n    // Save Config\n    if (isset($_POST['type']) && $_POST['type'] == \"settings\") {\n        global $cfg, $lang, $report_errors, $show_hidden_files, $lang_list, $hide_Cols, $calc_folder;\n        $newLng = $_POST['js-language'];\n        fm_get_translations([]);\n        if (!array_key_exists($newLng, $lang_list)) {\n            $newLng = 'en';\n        }\n\n        $erp = isset($_POST['js-error-report']) && $_POST['js-error-report'] == \"true\" ? true : false;\n        $shf = isset($_POST['js-show-hidden']) && $_POST['js-show-hidden'] == \"true\" ? true : false;\n        $hco = isset($_POST['js-hide-cols']) && $_POST['js-hide-cols'] == \"true\" ? true : false;\n        $caf = isset($_POST['js-calc-folder']) && $_POST['js-calc-folder'] == \"true\" ? true : false;\n\n        if ($cfg->data['lang'] != $newLng) {\n            $cfg->data['lang'] = $newLng;\n            $lang = $newLng;\n        }\n        if ($cfg->data['error_reporting'] != $erp) {\n            $cfg->data['error_reporting'] = $erp;\n            $report_errors = $erp;\n        }\n        if ($cfg->data['show_hidden'] != $shf) {\n            $cfg->data['show_hidden'] = $shf;\n            $show_hidden_files = $shf;\n        }\n        if ($cfg->data['show_hidden'] != $shf) {\n            $cfg->data['show_hidden'] = $shf;\n            $show_hidden_files = $shf;\n        }\n        if ($cfg->data['hide_Cols'] != $hco) {\n            $cfg->data['hide_Cols'] = $hco;\n            $hide_Cols = $hco;\n        }\n        if ($cfg->data['calc_folder'] != $caf) {\n            $cfg->data['calc_folder'] = $caf;\n            $calc_folder = $caf;\n        }\n        $cfg->save();\n        echo true;\n    }\n\n    // new password hash\n    if (isset($_POST['type']) && $_POST['type'] == \"pwdhash\") {\n        $res = isset($_POST['inputPassword2']) && !empty($_POST['inputPassword2']) ? password_hash($_POST['inputPassword2'], PASSWORD_DEFAULT) : '';\n        echo $res;\n    }\n\n    //upload using url\n    if(isset($_POST['type']) && $_POST['type'] == \"upload\" && !empty($_REQUEST[\"uploadurl\"])) {\n        $path = FM_ROOT_PATH;\n        if (FM_PATH != '') {\n            $path .= '/' . FM_PATH;\n        }\n\n        $url = !empty($_REQUEST[\"uploadurl\"]) && preg_match(\"|^http(s)?://.+$|\", stripslashes($_REQUEST[\"uploadurl\"])) ? stripslashes($_REQUEST[\"uploadurl\"]) : null;\n        $use_curl = false;\n        $temp_file = tempnam(sys_get_temp_dir(), \"upload-\");\n        $fileinfo = new stdClass();\n        $fileinfo->name = trim(basename($url), \".\\x00..\\x20\");\n\n        function event_callback ($message) {\n            global $callback;\n            echo json_encode($message);\n        }\n\n        function get_file_path () {\n            global $path, $fileinfo, $temp_file;\n            return $path.\"/\".basename($fileinfo->name);\n        }\n\n        $err = false;\n        if(!fm_is_file_allowed($fileinfo->name)) {\n            $err = array(\"message\" => \"File extension is not allowed\");\n            event_callback(array(\"fail\" => $err));\n            exit();\n        }\n\n        if (!$url) {\n            $success = false;\n        } else if ($use_curl) {\n            @$fp = fopen($temp_file, \"w\");\n            @$ch = curl_init($url);\n            curl_setopt($ch, CURLOPT_NOPROGRESS, false );\n            curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);\n            curl_setopt($ch, CURLOPT_FILE, $fp);\n            @$success = curl_exec($ch);\n            $curl_info = curl_getinfo($ch);\n            if (!$success) {\n                $err = array(\"message\" => curl_error($ch));\n            }\n            @curl_close($ch);\n            fclose($fp);\n            $fileinfo->size = $curl_info[\"size_download\"];\n            $fileinfo->type = $curl_info[\"content_type\"];\n        } else {\n            $ctx = stream_context_create();\n            @$success = copy($url, $temp_file, $ctx);\n            if (!$success) {\n                $err = error_get_last();\n            }\n        }\n\n        if ($success) {\n            $success = rename($temp_file, get_file_path());\n        }\n\n        if ($success) {\n            event_callback(array(\"done\" => $fileinfo));\n        } else {\n            unlink($temp_file);\n            if (!$err) {\n                $err = array(\"message\" => \"Invalid url parameter\");\n            }\n            event_callback(array(\"fail\" => $err));\n        }\n    }\n\n    exit();\n}\n\n// Delete file / folder\nif (isset($_GET['del']) && !FM_READONLY) {\n    $del = str_replace( '/', '', fm_clean_path( $_GET['del'] ) );\n    if ($del != '' && $del != '..' && $del != '.') {\n        $path = FM_ROOT_PATH;\n        if (FM_PATH != '') {\n            $path .= '/' . FM_PATH;\n        }\n        $is_dir = is_dir($path . '/' . $del);\n        if (fm_rdelete($path . '/' . $del)) {\n            $msg = $is_dir ? 'Folder <b>%s</b> deleted' : 'File <b>%s</b> deleted';\n            fm_set_msg(sprintf($msg, fm_enc($del)));\n        } else {\n            $msg = $is_dir ? 'Folder <b>%s</b> not deleted' : 'File <b>%s</b> not deleted';\n            fm_set_msg(sprintf($msg, fm_enc($del)), 'error');\n        }\n    } else {\n        fm_set_msg('Wrong file or folder name', 'error');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Create folder\nif (isset($_GET['new']) && isset($_GET['type']) && !FM_READONLY) {\n    $type = $_GET['type'];\n    $new = str_replace( '/', '', fm_clean_path( strip_tags( $_GET['new'] ) ) );\n    if ($new != '' && $new != '..' && $new != '.') {\n        $path = FM_ROOT_PATH;\n        if (FM_PATH != '') {\n            $path .= '/' . FM_PATH;\n        }\n        if ($_GET['type'] == \"file\") {\n            if (!file_exists($path . '/' . $new)) {\n                @fopen($path . '/' . $new, 'w') or die('Cannot open file:  ' . $new);\n                fm_set_msg(sprintf('File <b>%s</b> created', fm_enc($new)));\n            } else {\n                fm_set_msg(sprintf('File <b>%s</b> already exists', fm_enc($new)), 'alert');\n            }\n        } else {\n            if (fm_mkdir($path . '/' . $new, false) === true) {\n                fm_set_msg(sprintf('Folder <b>%s</b> created', $new));\n            } elseif (fm_mkdir($path . '/' . $new, false) === $path . '/' . $new) {\n                fm_set_msg(sprintf('Folder <b>%s</b> already exists', fm_enc($new)), 'alert');\n            } else {\n                fm_set_msg(sprintf('Folder <b>%s</b> not created', fm_enc($new)), 'error');\n            }\n        }\n    } else {\n        fm_set_msg('Wrong folder name', 'error');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Copy folder / file\nif (isset($_GET['copy'], $_GET['finish']) && !FM_READONLY) {\n    // from\n    $copy = $_GET['copy'];\n    $copy = fm_clean_path($copy);\n    // empty path\n    if ($copy == '') {\n        fm_set_msg('Source path not defined', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n    // abs path from\n    $from = FM_ROOT_PATH . '/' . $copy;\n    // abs path to\n    $dest = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $dest .= '/' . FM_PATH;\n    }\n    $dest .= '/' . basename($from);\n    // move?\n    $move = isset($_GET['move']);\n    // copy/move\n    if ($from != $dest) {\n        $msg_from = trim(FM_PATH . '/' . basename($from), '/');\n        if ($move) {\n            $rename = fm_rename($from, $dest);\n            if ($rename) {\n                fm_set_msg(sprintf('Moved from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($msg_from)));\n            } elseif ($rename === null) {\n                fm_set_msg('File or folder with this path already exists', 'alert');\n            } else {\n                fm_set_msg(sprintf('Error while moving from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($msg_from)), 'error');\n            }\n        } else {\n            if (fm_rcopy($from, $dest)) {\n                fm_set_msg(sprintf('Copied from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($msg_from)));\n            } else {\n                fm_set_msg(sprintf('Error while copying from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($msg_from)), 'error');\n            }\n        }\n    } else {\n        fm_set_msg('Paths must be not equal', 'alert');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Mass copy files/ folders\nif (isset($_POST['file'], $_POST['copy_to'], $_POST['finish']) && !FM_READONLY) {\n    // from\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n    // to\n    $copy_to_path = FM_ROOT_PATH;\n    $copy_to = fm_clean_path($_POST['copy_to']);\n    if ($copy_to != '') {\n        $copy_to_path .= '/' . $copy_to;\n    }\n    if ($path == $copy_to_path) {\n        fm_set_msg('Paths must be not equal', 'alert');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n    if (!is_dir($copy_to_path)) {\n        if (!fm_mkdir($copy_to_path, true)) {\n            fm_set_msg('Unable to create destination folder', 'error');\n            fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n        }\n    }\n    // move?\n    $move = isset($_POST['move']);\n    // copy/move\n    $errors = 0;\n    $files = $_POST['file'];\n    if (is_array($files) && count($files)) {\n        foreach ($files as $f) {\n            if ($f != '') {\n                // abs path from\n                $from = $path . '/' . $f;\n                // abs path to\n                $dest = $copy_to_path . '/' . $f;\n                // do\n                if ($move) {\n                    $rename = fm_rename($from, $dest);\n                    if ($rename === false) {\n                        $errors++;\n                    }\n                } else {\n                    if (!fm_rcopy($from, $dest)) {\n                        $errors++;\n                    }\n                }\n            }\n        }\n        if ($errors == 0) {\n            $msg = $move ? 'Selected files and folders moved' : 'Selected files and folders copied';\n            fm_set_msg($msg);\n        } else {\n            $msg = $move ? 'Error while moving items' : 'Error while copying items';\n            fm_set_msg($msg, 'error');\n        }\n    } else {\n        fm_set_msg('Nothing selected', 'alert');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Rename\nif (isset($_GET['ren'], $_GET['to']) && !FM_READONLY) {\n    // old name\n    $old = $_GET['ren'];\n    $old = fm_clean_path($old);\n    $old = str_replace('/', '', $old);\n    // new name\n    $new = $_GET['to'];\n    $new = fm_clean_path(strip_tags($new));\n    $new = str_replace('/', '', $new);\n    // path\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n    // rename\n    if ($old != '' && $new != '') {\n        if (fm_rename($path . '/' . $old, $path . '/' . $new)) {\n            fm_set_msg(sprintf('Renamed from <b>%s</b> to <b>%s</b>', fm_enc($old), fm_enc($new)));\n        } else {\n            fm_set_msg(sprintf('Error while renaming from <b>%s</b> to <b>%s</b>', fm_enc($old), fm_enc($new)), 'error');\n        }\n    } else {\n        fm_set_msg('Names not set', 'error');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Download\nif (isset($_GET['dl'])) {\n    $dl = $_GET['dl'];\n    $dl = fm_clean_path($dl);\n    $dl = str_replace('/', '', $dl);\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n    if ($dl != '' && is_file($path . '/' . $dl)) {\n        header('Content-Description: File Transfer');\n        header('Content-Type: application/octet-stream');\n        header('Content-Disposition: attachment; filename=\"' . basename($path . '/' . $dl) . '\"');\n        header('Content-Transfer-Encoding: binary');\n        header('Connection: Keep-Alive');\n        header('Expires: 0');\n        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');\n        header('Pragma: public');\n        header('Content-Length: ' . filesize($path . '/' . $dl));\n        ob_end_clean();\n        readfile($path . '/' . $dl);\n        exit;\n    } else {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n}\n\n// Upload\nif (!empty($_FILES) && !FM_READONLY) {\n    $override_file_name = false;\n    $f = $_FILES;\n    $path = FM_ROOT_PATH;\n    $ds = DIRECTORY_SEPARATOR;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    $errors = 0;\n    $uploads = 0;\n    $allowed = (FM_EXTENSION) ? explode(',', FM_EXTENSION) : false;\n\n    $filename = $f['file']['name'];\n    $tmp_name = $f['file']['tmp_name'];\n    $ext = strtolower(pathinfo($filename, PATHINFO_EXTENSION));\n    $isFileAllowed = ($allowed) ? in_array($ext, $allowed) : true;\n\n    $targetPath = $path . $ds;\n    $fullPath = $path . '/' . $_REQUEST['fullpath'];\n    $folder = substr($fullPath, 0, strrpos($fullPath, \"/\"));\n\n    if(file_exists ($fullPath) && !$override_file_name) {\n        $ext_1 = $ext ? '.'.$ext : '';\n        $fullPath = str_replace($ext_1, '', $fullPath) .'_'. date('ymdHis'). $ext_1;\n    }\n\n    if (!is_dir($folder)) {\n        $old = umask(0);\n        mkdir($folder, 0777, true);\n        umask($old);\n    }\n\n    if (empty($f['file']['error']) && !empty($tmp_name) && $tmp_name != 'none' && $isFileAllowed) {\n        if (move_uploaded_file($tmp_name, $fullPath)) {\n            die('Successfully uploaded');\n        } else {\n            die(sprintf('Error while uploading files. Uploaded files: %s', $uploads));\n        }\n    }\n    exit();\n}\n\n// Mass deleting\nif (isset($_POST['group'], $_POST['delete']) && !FM_READONLY) {\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    $errors = 0;\n    $files = $_POST['file'];\n    if (is_array($files) && count($files)) {\n        foreach ($files as $f) {\n            if ($f != '') {\n                $new_path = $path . '/' . $f;\n                if (!fm_rdelete($new_path)) {\n                    $errors++;\n                }\n            }\n        }\n        if ($errors == 0) {\n            fm_set_msg('Selected files and folder deleted');\n        } else {\n            fm_set_msg('Error while deleting items', 'error');\n        }\n    } else {\n        fm_set_msg('Nothing selected', 'alert');\n    }\n\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Pack files\nif (isset($_POST['group']) && (isset($_POST['zip']) || isset($_POST['tar'])) && !FM_READONLY) {\n    $path = FM_ROOT_PATH;\n    $ext = 'zip';\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    //set pack type\n    $ext = isset($_POST['tar']) ? 'tar' : 'zip';\n\n\n    if (($ext == \"zip\" && !class_exists('ZipArchive')) || ($ext == \"tar\" && !class_exists('PharData'))) {\n        fm_set_msg('Operations with archives are not available', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    $files = $_POST['file'];\n    if (!empty($files)) {\n        chdir($path);\n\n        if (count($files) == 1) {\n            $one_file = reset($files);\n            $one_file = basename($one_file);\n            $zipname = $one_file . '_' . date('ymd_His') . '.'.$ext;\n        } else {\n            $zipname = 'archive_' . date('ymd_His') . '.'.$ext;\n        }\n\n        if($ext == 'zip') {\n            $zipper = new FM_Zipper();\n            $res = $zipper->create($zipname, $files);\n        } elseif ($ext == 'tar') {\n            $tar = new FM_Zipper_Tar();\n            $res = $tar->create($zipname, $files);\n        }\n\n        if ($res) {\n            fm_set_msg(sprintf('Archive <b>%s</b> created', fm_enc($zipname)));\n        } else {\n            fm_set_msg('Archive not created', 'error');\n        }\n    } else {\n        fm_set_msg('Nothing selected', 'alert');\n    }\n\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Unpack\nif (isset($_GET['unzip']) && !FM_READONLY) {\n    $unzip = $_GET['unzip'];\n    $unzip = fm_clean_path($unzip);\n    $unzip = str_replace('/', '', $unzip);\n    $isValid = false;\n\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    if ($unzip != '' && is_file($path . '/' . $unzip)) {\n        $zip_path = $path . '/' . $unzip;\n        $ext = pathinfo($zip_path, PATHINFO_EXTENSION);\n        $isValid = true;\n    } else {\n        fm_set_msg('File not found', 'error');\n    }\n\n\n    if (($ext == \"zip\" && !class_exists('ZipArchive')) || ($ext == \"tar\" && !class_exists('PharData'))) {\n        fm_set_msg('Operations with archives are not available', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    if ($isValid) {\n        //to folder\n        $tofolder = '';\n        if (isset($_GET['tofolder'])) {\n            $tofolder = pathinfo($zip_path, PATHINFO_FILENAME);\n            if (fm_mkdir($path . '/' . $tofolder, true)) {\n                $path .= '/' . $tofolder;\n            }\n        }\n\n        if($ext == \"zip\") {\n            $zipper = new FM_Zipper();\n            $res = $zipper->unzip($zip_path, $path);\n        } elseif ($ext == \"tar\") {\n            $gzipper = new PharData($zip_path);\n            $res = $gzipper->extractTo($path);\n        }\n\n        if ($res) {\n            fm_set_msg('Archive unpacked');\n        } else {\n            fm_set_msg('Archive not unpacked', 'error');\n        }\n\n    } else {\n        fm_set_msg('File not found', 'error');\n    }\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n// Change Perms (not for Windows)\nif (isset($_POST['chmod']) && !FM_READONLY && !FM_IS_WIN) {\n    $path = FM_ROOT_PATH;\n    if (FM_PATH != '') {\n        $path .= '/' . FM_PATH;\n    }\n\n    $file = $_POST['chmod'];\n    $file = fm_clean_path($file);\n    $file = str_replace('/', '', $file);\n    if ($file == '' || (!is_file($path . '/' . $file) && !is_dir($path . '/' . $file))) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    $mode = 0;\n    if (!empty($_POST['ur'])) {\n        $mode |= 0400;\n    }\n    if (!empty($_POST['uw'])) {\n        $mode |= 0200;\n    }\n    if (!empty($_POST['ux'])) {\n        $mode |= 0100;\n    }\n    if (!empty($_POST['gr'])) {\n        $mode |= 0040;\n    }\n    if (!empty($_POST['gw'])) {\n        $mode |= 0020;\n    }\n    if (!empty($_POST['gx'])) {\n        $mode |= 0010;\n    }\n    if (!empty($_POST['or'])) {\n        $mode |= 0004;\n    }\n    if (!empty($_POST['ow'])) {\n        $mode |= 0002;\n    }\n    if (!empty($_POST['ox'])) {\n        $mode |= 0001;\n    }\n\n    if (@chmod($path . '/' . $file, $mode)) {\n        fm_set_msg('Permissions changed');\n    } else {\n        fm_set_msg('Permissions not changed', 'error');\n    }\n\n    fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n}\n\n/*************************** /ACTIONS ***************************/\n\n// get current path\n$path = FM_ROOT_PATH;\nif (FM_PATH != '') {\n    $path .= '/' . FM_PATH;\n}\n\n// check path\nif (!is_dir($path)) {\n    fm_redirect(FM_SELF_URL . '?p=');\n}\n\n// get parent folder\n$parent = fm_get_parent_path(FM_PATH);\n\n$objects = is_readable($path) ? scandir($path) : array();\n$folders = array();\n$files = array();\n$current_path = array_slice(explode(\"/\",$path), -1)[0];\nif (is_array($objects) && !in_array($current_path, $GLOBALS['exclude_items'])) {\n    foreach ($objects as $file) {\n        if ($file == '.' || $file == '..' && in_array($file, $GLOBALS['exclude_items'])) {\n            continue;\n        }\n        if (!FM_SHOW_HIDDEN && substr($file, 0, 1) === '.') {\n            continue;\n        }\n        $new_path = $path . '/' . $file;\n        if (@is_file($new_path) && !in_array($file, $GLOBALS['exclude_items'])) {\n            $files[] = $file;\n        } elseif (@is_dir($new_path) && $file != '.' && $file != '..' && !in_array($file, $GLOBALS['exclude_items'])) {\n            $folders[] = $file;\n        }\n    }\n}\n\nif (!empty($files)) {\n    natcasesort($files);\n}\nif (!empty($folders)) {\n    natcasesort($folders);\n}\n\n// upload form\nif (isset($_GET['upload']) && !FM_READONLY) {\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    ?>\n\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.css\" rel=\"stylesheet\">\n    <div class=\"path\">\n\n        <div class=\"card mb-2 fm-upload-wrapper\">\n            <div class=\"card-header\">\n                <ul class=\"nav nav-tabs card-header-tabs\">\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link active\" href=\"#fileUploader\" data-target=\"#fileUploader\"><i class=\"fa fa-arrow-circle-o-up\"></i> <?php echo lng('UploadingFiles') ?></a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a class=\"nav-link\" href=\"#urlUploader\" class=\"js-url-upload\" data-target=\"#urlUploader\"><i class=\"fa fa-link\"></i> Upload from URL</a>\n                    </li>\n                </ul>\n            </div>\n            <div class=\"card-body\">\n                <p class=\"card-text\">\n                    <a href=\"?p=<?php echo FM_PATH ?>\" class=\"float-right\"><i class=\"fa fa-chevron-circle-left go-back\"></i> <?php echo lng('Back')?></a>\n                    <?php echo lng('DestinationFolder') ?>: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?>\n                </p>\n\n                <form action=\"<?php echo htmlspecialchars($_SERVER[\"PHP_SELF\"]) . '?p=' . fm_enc(FM_PATH) ?>\" class=\"dropzone card-tabs-container\" id=\"fileUploader\" enctype=\"multipart/form-data\">\n                    <input type=\"hidden\" name=\"p\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    <input type=\"hidden\" name=\"fullpath\" id=\"fullpath\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    <div class=\"fallback\">\n                        <input name=\"file\" type=\"file\" multiple/>\n                    </div>\n                </form>\n\n                <div class=\"upload-url-wrapper card-tabs-container hidden\" id=\"urlUploader\">\n                    <form id=\"js-form-url-upload\" class=\"form-inline\" onsubmit=\"return upload_from_url(this);\" method=\"POST\" action=\"\">\n                        <input type=\"hidden\" name=\"type\" value=\"upload\" aria-label=\"hidden\" aria-hidden=\"true\">\n                        <input type=\"url\" placeholder=\"URL\" name=\"uploadurl\" required class=\"form-control\" style=\"width: 80%\">\n                        <button type=\"submit\" class=\"btn btn-primary ml-3\"><?php echo lng('Upload') ?></button>\n                        <div class=\"lds-facebook\"><div></div><div></div><div></div></div>\n                    </form>\n                    <div id=\"js-url-upload__list\" class=\"col-9 mt-3\"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.js\"></script>\n    <script>\n        Dropzone.options.fileUploader = {\n            timeout: 120000,\n            maxFilesize: <?php echo MAX_UPLOAD_SIZE; ?>,\n            init: function () {\n                this.on(\"sending\", function (file, xhr, formData) {\n                    let _path = (file.fullPath) ? file.fullPath : file.name;\n                    document.getElementById(\"fullpath\").value = _path;\n                    xhr.ontimeout = (function() {\n                        alert('Error: Server Timeout');\n                    });\n                }).on(\"success\", function (res) {\n                    console.log('Upload Status >> ', res.status);\n                }).on(\"error\", function(file, response) {\n                    alert(response);\n                });\n            }\n        }\n    </script>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n// copy form POST\nif (isset($_POST['copy']) && !FM_READONLY) {\n    $copy_files = $_POST['file'];\n    if (!is_array($copy_files) || empty($copy_files)) {\n        fm_set_msg('Nothing selected', 'alert');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    ?>\n    <div class=\"path\">\n        <div class=\"card\">\n            <div class=\"card-header\">\n                <h6><?php echo lng('Copying') ?></h6>\n            </div>\n            <div class=\"card-body\">\n                <form action=\"\" method=\"post\">\n                    <input type=\"hidden\" name=\"p\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    <input type=\"hidden\" name=\"finish\" value=\"1\">\n                    <?php\n                    foreach ($copy_files as $cf) {\n                        echo '<input type=\"hidden\" name=\"file[]\" value=\"' . fm_enc($cf) . '\">' . PHP_EOL;\n                    }\n                    ?>\n                    <p class=\"break-word\"><?php echo lng('Files') ?>: <b><?php echo implode('</b>, <b>', $copy_files) ?></b></p>\n                    <p class=\"break-word\"><?php echo lng('SourceFolder') ?>: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?><br>\n                        <label for=\"inp_copy_to\"><?php echo lng('DestinationFolder') ?>:</label>\n                        <?php echo FM_ROOT_PATH ?>/<input type=\"text\" name=\"copy_to\" id=\"inp_copy_to\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    </p>\n                    <p class=\"custom-checkbox custom-control\"><input type=\"checkbox\" name=\"move\" value=\"1\" id=\"js-move-files\" class=\"custom-control-input\"><label for=\"js-move-files\" class=\"custom-control-label\" style=\"vertical-align: sub\"> <?php echo lng('Move') ?></label></p>\n                    <p>\n                        <button type=\"submit\" class=\"btn btn-success\"><i class=\"fa fa-check-circle\"></i> <?php echo lng('Copy') ?></button> &nbsp;\n                        <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>\" class=\"btn btn-outline-primary\"><i class=\"fa fa-times-circle\"></i> <?php echo lng('Cancel') ?></a></b>\n                    </p>\n                </form>\n            </div>\n        </div>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n// copy form\nif (isset($_GET['copy']) && !isset($_GET['finish']) && !FM_READONLY) {\n    $copy = $_GET['copy'];\n    $copy = fm_clean_path($copy);\n    if ($copy == '' || !file_exists(FM_ROOT_PATH . '/' . $copy)) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    ?>\n    <div class=\"path\">\n        <p><b>Copying</b></p>\n        <p class=\"break-word\">\n            Source path: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . $copy)) ?><br>\n            Destination folder: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?>\n        </p>\n        <p>\n            <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode($copy) ?>&amp;finish=1\"><i class=\"fa fa-check-circle\"></i> Copy</a></b> &nbsp;\n            <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode($copy) ?>&amp;finish=1&amp;move=1\"><i class=\"fa fa-check-circle\"></i> Move</a></b> &nbsp;\n            <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>\"><i class=\"fa fa-times-circle\"></i> Cancel</a></b>\n        </p>\n        <p><i>Select folder</i></p>\n        <ul class=\"folders break-word\">\n            <?php\n            if ($parent !== false) {\n                ?>\n                <li><a href=\"?p=<?php echo urlencode($parent) ?>&amp;copy=<?php echo urlencode($copy) ?>\"><i class=\"fa fa-chevron-circle-left\"></i> ..</a></li>\n                <?php\n            }\n            foreach ($folders as $f) {\n                ?>\n                <li>\n                    <a href=\"?p=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>&amp;copy=<?php echo urlencode($copy) ?>\"><i class=\"fa fa-folder-o\"></i> <?php echo fm_convert_win($f) ?></a></li>\n                <?php\n            }\n            ?>\n        </ul>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\nif (isset($_GET['settings']) && !FM_READONLY) {\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    global $cfg, $lang, $lang_list;\n    ?>\n\n    <div class=\"col-md-8 offset-md-2 pt-3\">\n        <div class=\"card mb-2\">\n            <h6 class=\"card-header\">\n                <i class=\"fa fa-cog\"></i>  <?php echo lng('Settings') ?>\n                <a href=\"?p=<?php echo FM_PATH ?>\" class=\"float-right\"><i class=\"fa fa-window-close\"></i> <?php echo lng('Cancel')?></a>\n            </h6>\n            <div class=\"card-body\">\n                <form id=\"js-settings-form\" action=\"\" method=\"post\" data-type=\"ajax\" onsubmit=\"return save_settings(this)\">\n                    <input type=\"hidden\" name=\"type\" value=\"settings\" aria-label=\"hidden\" aria-hidden=\"true\">\n                    <div class=\"form-group row\">\n                        <label for=\"js-language\" class=\"col-sm-3 col-form-label\"><?php echo lng('Language') ?></label>\n                        <div class=\"col-sm-5\">\n                            <select class=\"form-control\" id=\"js-language\" name=\"js-language\">\n                                <?php\n                                function getSelected($l) {\n                                    global $lang;\n                                    return ($lang == $l) ? 'selected' : '';\n                                }\n                                foreach ($lang_list as $k => $v) {\n                                    echo \"<option value='$k' \".getSelected($k).\">$v</option>\";\n                                }\n                                ?>\n                            </select>\n                        </div>\n                    </div>\n                    <?php\n                    //get ON/OFF and active class\n                    function getChecked($conf, $val, $txt) {\n                        if($conf== 1 && $val ==1) {\n                            return $txt;\n                        } else if($conf == '' && $val == '') {\n                            return $txt;\n                        } else {\n                            return '';\n                        }\n                    }\n                    ?>\n                    <div class=\"form-group row\">\n                        <label for=\"js-err-rpt-1\" class=\"col-sm-3 col-form-label\"><?php echo lng('ErrorReporting') ?></label>\n                        <div class=\"col-sm-9\">\n                            <div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">\n                                <label class=\"btn btn-secondary <?php echo getChecked($report_errors, 1, 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-error-report\" id=\"js-err-rpt-1\" autocomplete=\"off\" value=\"true\" <?php echo getChecked($report_errors, 1, 'checked') ?> > ON\n                                </label>\n                                <label class=\"btn btn-secondary <?php echo getChecked($report_errors, '', 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-error-report\" id=\"js-err-rpt-0\" autocomplete=\"off\" value=\"false\" <?php echo getChecked($report_errors, '', 'checked') ?> > OFF\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label for=\"js-hdn-1\" class=\"col-sm-3 col-form-label\"><?php echo lng('ShowHiddenFiles') ?></label>\n                        <div class=\"col-sm-9\">\n                            <div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">\n                                <label class=\"btn btn-secondary <?php echo getChecked($show_hidden_files, 1, 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-show-hidden\" id=\"js-hdn-1\" autocomplete=\"off\" value=\"true\" <?php echo getChecked($show_hidden_files, 1, 'checked') ?> > ON\n                                </label>\n                                <label class=\"btn btn-secondary <?php echo getChecked($show_hidden_files, '', 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-show-hidden\" id=\"js-hdn-0\" autocomplete=\"off\" value=\"false\" <?php echo getChecked($show_hidden_files, '', 'checked') ?> > OFF\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label for=\"js-hid-1\" class=\"col-sm-3 col-form-label\"><?php echo lng('HideColumns') ?></label>\n                        <div class=\"col-sm-9\">\n                            <div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">\n                                <label class=\"btn btn-secondary <?php echo getChecked($hide_Cols, 1, 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-hide-cols\" id=\"js-hid-1\" autocomplete=\"off\" value=\"true\" <?php echo getChecked($hide_Cols, 1, 'checked') ?> > ON\n                                </label>\n                                <label class=\"btn btn-secondary <?php echo getChecked($hide_Cols, '', 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-hide-cols\" id=\"js-hid-0\" autocomplete=\"off\" value=\"false\" <?php echo getChecked($hide_Cols, '', 'checked') ?> > OFF\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <label for=\"js-dir-1\" class=\"col-sm-3 col-form-label\"><?php echo lng('CalculateFolderSize') ?></label>\n                        <div class=\"col-sm-9\">\n                            <div class=\"btn-group btn-group-toggle\" data-toggle=\"buttons\">\n                                <label class=\"btn btn-secondary <?php echo getChecked($calc_folder, 1, 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-calc-folder\" id=\"js-dir-1\" autocomplete=\"off\" value=\"true\" <?php echo getChecked($calc_folder, 1, 'checked') ?> > ON\n                                </label>\n                                <label class=\"btn btn-secondary <?php echo getChecked($calc_folder, '', 'active') ?>\">\n                                    <input type=\"radio\" name=\"js-calc-folder\" id=\"js-dir-0\" autocomplete=\"off\" value=\"false\" <?php echo getChecked($calc_folder, '', 'checked') ?> > OFF\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group row\">\n                        <div class=\"col-sm-10\">\n                            <button type=\"submit\" class=\"btn btn-success\"> <i class=\"fa fa-check-circle\"></i> <?php echo lng('Save'); ?></button>\n                        </div>\n                    </div>\n\n                </form>\n            </div>\n        </div>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\nif (isset($_GET['help'])) {\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n    global $cfg, $lang;\n    ?>\n\n    <div class=\"col-md-8 offset-md-2 pt-3\">\n        <div class=\"card mb-2\">\n            <h6 class=\"card-header\">\n                <i class=\"fa fa-exclamation-circle\"></i> <?php echo lng('Help') ?>\n                <a href=\"?p=<?php echo FM_PATH ?>\" class=\"float-right\"><i class=\"fa fa-window-close\"></i> <?php echo lng('Cancel')?></a>\n            </h6>\n            <div class=\"card-body\">\n                <div class=\"row\">\n                    <div class=\"col-xs-12 col-sm-6\">\n                        <p><h3><a href=\"https://github.com/prasathmani/tinyfilemanager\" target=\"_blank\" class=\"app-v-title\"> Tiny File Manager <?php echo VERSION; ?></a></h3></p>\n                        <p>Author: Prasath Mani</p>\n                        <p>Mail Us: <a href=\"mailto:ccpprogrammers@gmail.com\">ccpprogrammers[at]gmail.com</a> </p>\n                    </div>\n                    <div class=\"col-xs-12 col-sm-6\">\n                        <div class=\"card\">\n                            <ul class=\"list-group list-group-flush\">\n                                <li class=\"list-group-item\"><a href=\"https://tinyfilemanager.github.io/docs/\" target=\"_blank\"><i class=\"fa fa-question-circle\"></i> <?php echo lng('Help Documents') ?> </a> </li>\n                                <li class=\"list-group-item\"><a href=\"https://github.com/prasathmani/tinyfilemanager/issues\" target=\"_blank\"><i class=\"fa fa-bug\"></i> <?php echo lng('Report Issue') ?></a></li>\n                                <li class=\"list-group-item\"><a href=\"javascript:latest_release_info('<?php echo VERSION; ?>');\"><i class=\"fa fa-link\"> </i> <?php echo lng('Check Latest Version') ?></a></li>\n                                <?php if(!FM_READONLY) { ?>\n                                <li class=\"list-group-item\"><a href=\"javascript:show_new_pwd();\"><i class=\"fa fa-lock\"></i> <?php echo lng('Generate new password hash') ?></a></li>\n                                <?php } ?>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"row js-new-pwd hidden mt-2\">\n                    <div class=\"col-12\">\n                        <form class=\"form-inline\" onsubmit=\"return new_password_hash(this)\" method=\"POST\" action=\"\">\n                            <input type=\"hidden\" name=\"type\" value=\"pwdhash\" aria-label=\"hidden\" aria-hidden=\"true\">\n                            <div class=\"form-group mb-2\">\n                                <label for=\"staticEmail2\"><?php echo lng('Generate new password hash') ?></label>\n                            </div>\n                            <div class=\"form-group mx-sm-3 mb-2\">\n                                <label for=\"inputPassword2\" class=\"sr-only\"><?php echo lng('Password') ?></label>\n                                <input type=\"text\" class=\"form-control btn-sm\" id=\"inputPassword2\" name=\"inputPassword2\" placeholder=\"Password\" required>\n                            </div>\n                            <button type=\"submit\" class=\"btn btn-success btn-sm mb-2\"><?php echo lng('Generate') ?></button>\n                        </form>\n                        <textarea class=\"form-control\" rows=\"2\" readonly id=\"js-pwd-result\"></textarea>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n// file viewer\nif (isset($_GET['view'])) {\n    $file = $_GET['view'];\n    $quickView = (isset($_GET['quickView']) && $_GET['quickView'] == 1) ? true : false;\n    $file = fm_clean_path($file, false);\n    $file = str_replace('/', '', $file);\n    if ($file == '' || !is_file($path . '/' . $file) || in_array($file, $GLOBALS['exclude_items'])) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    if(!$quickView) {\n        fm_show_header(); // HEADER\n        fm_show_nav_path(FM_PATH); // current path\n    }\n\n    $file_url = FM_ROOT_URL . fm_convert_win((FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file);\n    $file_path = $path . '/' . $file;\n\n    $ext = strtolower(pathinfo($file_path, PATHINFO_EXTENSION));\n    $mime_type = fm_get_mime_type($file_path);\n    $filesize = fm_get_filesize(filesize($file_path));\n\n    $is_zip = false;\n    $is_gzip = false;\n    $is_image = false;\n    $is_audio = false;\n    $is_video = false;\n    $is_text = false;\n    $is_onlineViewer = false;\n\n    $view_title = 'File';\n    $filenames = false; // for zip\n    $content = ''; // for text\n    $online_viewer = strtolower($GLOBALS['online_viewer']);\n\n    if($online_viewer && $online_viewer !== 'false' && in_array($ext, fm_get_onlineViewer_exts())){\n        $is_onlineViewer = true;\n    }\n    elseif ($ext == 'zip' || $ext == 'tar') {\n        $is_zip = true;\n        $view_title = 'Archive';\n        $filenames = fm_get_zif_info($file_path, $ext);\n    } elseif (in_array($ext, fm_get_image_exts())) {\n        $is_image = true;\n        $view_title = 'Image';\n    } elseif (in_array($ext, fm_get_audio_exts())) {\n        $is_audio = true;\n        $view_title = 'Audio';\n    } elseif (in_array($ext, fm_get_video_exts())) {\n        $is_video = true;\n        $view_title = 'Video';\n    } elseif (in_array($ext, fm_get_text_exts()) || substr($mime_type, 0, 4) == 'text' || in_array($mime_type, fm_get_text_mimes())) {\n        $is_text = true;\n        $content = file_get_contents($file_path);\n    }\n\n    ?>\n    <div class=\"row\">\n        <div class=\"col-12\">\n            <?php if(!$quickView) { ?>\n                <p class=\"break-word\"><b><?php echo $view_title ?> \"<?php echo fm_enc(fm_convert_win($file)) ?>\"</b></p>\n                <p class=\"break-word\">\n                    Full path: <?php echo fm_enc(fm_convert_win($file_path)) ?><br>\n                    File\n                    size: <?php echo fm_get_filesize($filesize) ?><?php if ($filesize >= 1000): ?> (<?php echo sprintf('%s bytes', $filesize) ?>)<?php endif; ?>\n                    <br>\n                    MIME-type: <?php echo $mime_type ?><br>\n                    <?php\n                    // ZIP info\n                    if (($is_zip || $is_gzip) && $filenames !== false) {\n                        $total_files = 0;\n                        $total_comp = 0;\n                        $total_uncomp = 0;\n                        foreach ($filenames as $fn) {\n                            if (!$fn['folder']) {\n                                $total_files++;\n                            }\n                            $total_comp += $fn['compressed_size'];\n                            $total_uncomp += $fn['filesize'];\n                        }\n                        ?>\n                        Files in archive: <?php echo $total_files ?><br>\n                        Total size: <?php echo fm_get_filesize($total_uncomp) ?><br>\n                        Size in archive: <?php echo fm_get_filesize($total_comp) ?><br>\n                        Compression: <?php echo round(($total_comp / $total_uncomp) * 100) ?>%<br>\n                        <?php\n                    }\n                    // Image info\n                    if ($is_image) {\n                        $image_size = getimagesize($file_path);\n                        echo 'Image sizes: ' . (isset($image_size[0]) ? $image_size[0] : '0') . ' x ' . (isset($image_size[1]) ? $image_size[1] : '0') . '<br>';\n                    }\n                    // Text info\n                    if ($is_text) {\n                        $is_utf8 = fm_is_utf8($content);\n                        if (function_exists('iconv')) {\n                            if (!$is_utf8) {\n                                $content = iconv(FM_ICONV_INPUT_ENC, 'UTF-8//IGNORE', $content);\n                            }\n                        }\n                        echo 'Charset: ' . ($is_utf8 ? 'utf-8' : '8 bit') . '<br>';\n                    }\n                    ?>\n                </p>\n                <p>\n                    <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;dl=<?php echo urlencode($file) ?>\"><i class=\"fa fa-cloud-download\"></i> <?php echo lng('Download') ?></a></b> &nbsp;\n                    <b><a href=\"<?php echo fm_enc($file_url) ?>\" target=\"_blank\"><i class=\"fa fa-external-link-square\"></i> <?php echo lng('Open') ?></a></b>\n                    &nbsp;\n                    <?php\n                    // ZIP actions\n                    if (!FM_READONLY && ($is_zip || $is_gzip) && $filenames !== false) {\n                        $zip_name = pathinfo($file_path, PATHINFO_FILENAME);\n                        ?>\n                        <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;unzip=<?php echo urlencode($file) ?>\"><i class=\"fa fa-check-circle\"></i> <?php echo lng('UnZip') ?></a></b> &nbsp;\n                        <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;unzip=<?php echo urlencode($file) ?>&amp;tofolder=1\" title=\"UnZip to <?php echo fm_enc($zip_name) ?>\"><i class=\"fa fa-check-circle\"></i>\n                                <?php echo lng('UnZipToFolder') ?></a></b> &nbsp;\n                        <?php\n                    }\n                    if ($is_text && !FM_READONLY) {\n                        ?>\n                        <b><a href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>\" class=\"edit-file\"><i class=\"fa fa-pencil-square\"></i> <?php echo lng('Edit') ?>\n                            </a></b> &nbsp;\n                        <b><a href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>&env=ace\"\n                              class=\"edit-file\"><i class=\"fa fa-pencil-square-o\"></i> <?php echo lng('AdvancedEditor') ?>\n                            </a></b> &nbsp;\n                    <?php } ?>\n                    <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>\"><i class=\"fa fa-chevron-circle-left go-back\"></i> <?php echo lng('Back') ?></a></b>\n                </p>\n                <?php\n            }\n            if($is_onlineViewer) {\n                if($online_viewer == 'google') {\n                    echo '<iframe src=\"https://docs.google.com/viewer?embedded=true&hl=en&url=' . fm_enc($file_url) . '\" frameborder=\"no\" style=\"width:100%;min-height:460px\"></iframe>';\n                } else if($online_viewer == 'microsoft') {\n                    echo '<iframe src=\"https://view.officeapps.live.com/op/embed.aspx?src=' . fm_enc($file_url) . '\" frameborder=\"no\" style=\"width:100%;min-height:460px\"></iframe>';\n                }\n            } elseif ($is_zip) {\n                // ZIP content\n                if ($filenames !== false) {\n                    echo '<code class=\"maxheight\">';\n                    foreach ($filenames as $fn) {\n                        if ($fn['folder']) {\n                            echo '<b>' . fm_enc($fn['name']) . '</b><br>';\n                        } else {\n                            echo $fn['name'] . ' (' . fm_get_filesize($fn['filesize']) . ')<br>';\n                        }\n                    }\n                    echo '</code>';\n                } else {\n                    echo '<p>Error while fetching archive info</p>';\n                }\n            } elseif ($is_image) {\n                // Image content\n                if (in_array($ext, array('gif', 'jpg', 'jpeg', 'png', 'bmp', 'ico', 'svg'))) {\n                    echo '<p><img src=\"' . fm_enc($file_url) . '\" alt=\"\" class=\"preview-img\"></p>';\n                }\n            } elseif ($is_audio) {\n                // Audio content\n                echo '<p><audio src=\"' . fm_enc($file_url) . '\" controls preload=\"metadata\"></audio></p>';\n            } elseif ($is_video) {\n                // Video content\n                echo '<div class=\"preview-video\"><video src=\"' . fm_enc($file_url) . '\" width=\"640\" height=\"360\" controls preload=\"metadata\"></video></div>';\n            } elseif ($is_text) {\n                if (FM_USE_HIGHLIGHTJS) {\n                    // highlight\n                    $hljs_classes = array(\n                        'shtml' => 'xml',\n                        'htaccess' => 'apache',\n                        'phtml' => 'php',\n                        'lock' => 'json',\n                        'svg' => 'xml',\n                    );\n                    $hljs_class = isset($hljs_classes[$ext]) ? 'lang-' . $hljs_classes[$ext] : 'lang-' . $ext;\n                    if (empty($ext) || in_array(strtolower($file), fm_get_text_names()) || preg_match('#\\.min\\.(css|js)$#i', $file)) {\n                        $hljs_class = 'nohighlight';\n                    }\n                    $content = '<pre class=\"with-hljs\"><code class=\"' . $hljs_class . '\">' . fm_enc($content) . '</code></pre>';\n                } elseif (in_array($ext, array('php', 'php4', 'php5', 'phtml', 'phps'))) {\n                    // php highlight\n                    $content = highlight_string($content, true);\n                } else {\n                    $content = '<pre>' . fm_enc($content) . '</pre>';\n                }\n                echo $content;\n            }\n            ?>\n        </div>\n    </div>\n    <?php\n    if(!$quickView) {\n        fm_show_footer();\n    }\n    exit;\n}\n\n// file editor\nif (isset($_GET['edit'])) {\n    $file = $_GET['edit'];\n    $file = fm_clean_path($file, false);\n    $file = str_replace('/', '', $file);\n    if ($file == '' || !is_file($path . '/' . $file)) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n    header('X-XSS-Protection:0');\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n\n    $file_url = FM_ROOT_URL . fm_convert_win((FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file);\n    $file_path = $path . '/' . $file;\n\n    // normal editer\n    $isNormalEditor = true;\n    if (isset($_GET['env'])) {\n        if ($_GET['env'] == \"ace\") {\n            $isNormalEditor = false;\n        }\n    }\n\n    // Save File\n    if (isset($_POST['savedata'])) {\n        $writedata = $_POST['savedata'];\n        $fd = fopen($file_path, \"w\");\n        @fwrite($fd, $writedata);\n        fclose($fd);\n        fm_set_msg('File Saved Successfully');\n    }\n\n    $ext = strtolower(pathinfo($file_path, PATHINFO_EXTENSION));\n    $mime_type = fm_get_mime_type($file_path);\n    $filesize = filesize($file_path);\n    $is_text = false;\n    $content = ''; // for text\n\n    if (in_array($ext, fm_get_text_exts()) || substr($mime_type, 0, 4) == 'text' || in_array($mime_type, fm_get_text_mimes())) {\n        $is_text = true;\n        $content = file_get_contents($file_path);\n    }\n\n    ?>\n    <div class=\"path\">\n        <div class=\"row\">\n            <div class=\"col-xs-12 col-sm-5 col-lg-6 pt-1\">\n                <div class=\"btn-toolbar\" role=\"toolbar\">\n                    <?php if (!$isNormalEditor) { ?>\n                        <div class=\"btn-group js-ace-toolbar\">\n                            <button data-cmd=\"none\" data-option=\"fullscreen\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-fullscreen\" title=\"Fullscreen\"><i class=\"fa fa-expand\" title=\"Fullscreen\"></i></button>\n                            <button data-cmd=\"find\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-search\" title=\"Search\"><i class=\"fa fa-search\" title=\"Search\"></i></button>\n                            <button data-cmd=\"undo\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-undo\" title=\"Undo\"><i class=\"fa fa-undo\" title=\"Undo\"></i></button>\n                            <button data-cmd=\"redo\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-redo\" title=\"Redo\"><i class=\"fa fa-repeat\" title=\"Redo\"></i></button>\n                            <button data-cmd=\"none\" data-option=\"wrap\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-wordWrap\" title=\"Word Wrap\"><i class=\"fa fa-text-width\" title=\"Word Wrap\"></i></button>\n                            <button data-cmd=\"none\" data-option=\"help\" class=\"btn btn-sm btn-outline-secondary\" id=\"js-ace-goLine\" title=\"Help\"><i class=\"fa fa-question\" title=\"Help\"></i></button>\n                            <select id=\"js-ace-mode\" data-type=\"mode\" title=\"Select Document Type\" class=\"btn-outline-secondary border-left-0 d-none d-md-block\"><option>-- Select Mode --</option></select>\n                            <select id=\"js-ace-theme\" data-type=\"theme\" title=\"Select Theme\" class=\"btn-outline-secondary border-left-0 d-none d-lg-block\"><option>-- Select Theme --</option></select>\n                            <select id=\"js-ace-fontSize\" data-type=\"fontSize\" title=\"Selct Font Size\" class=\"btn-outline-secondary border-left-0 d-none d-lg-block\"><option>-- Select Font Size --</option></select>\n                        </div>\n                    <?php } ?>\n                </div>\n            </div>\n            <div class=\"edit-file-actions col-xs-12 col-sm-7 col-lg-6 text-right pt-1\">\n                <a title=\"Back\" class=\"btn btn-sm btn-outline-primary\" href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;view=<?php echo urlencode($file) ?>\"><i class=\"fa fa-reply-all\"></i> <?php echo lng('Back') ?></a>\n                <a title=\"Backup\" class=\"btn btn-sm btn-outline-primary\" href=\"javascript:backup('<?php echo urlencode($path) ?>','<?php echo urlencode($file) ?>')\"><i class=\"fa fa-database\"></i> <?php echo lng('BackUp') ?></a>\n                <?php if ($is_text) { ?>\n                    <?php if ($isNormalEditor) { ?>\n                        <a title=\"Advanced\" class=\"btn btn-sm btn-outline-primary\" href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>&amp;env=ace\"><i class=\"fa fa-pencil-square-o\"></i> <?php echo lng('AdvancedEditor') ?></a>\n                        <button type=\"button\" class=\"btn btn-sm btn-outline-primary name=\"Save\" data-url=\"<?php echo fm_enc($file_url) ?>\" onclick=\"edit_save(this,'nrl')\"><i class=\"fa fa-floppy-o\"></i> Save\n                        </button>\n                    <?php } else { ?>\n                        <a title=\"Plain Editor\" class=\"btn btn-sm btn-outline-primary\" href=\"?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>\"><i class=\"fa fa-text-height\"></i> <?php echo lng('NormalEditor') ?></a>\n                        <button type=\"button\" class=\"btn btn-sm btn-outline-primary\" name=\"Save\" data-url=\"<?php echo fm_enc($file_url) ?>\" onclick=\"edit_save(this,'ace')\"><i class=\"fa fa-floppy-o\"></i> <?php echo lng('Save') ?>\n                        </button>\n                    <?php } ?>\n                <?php } ?>\n            </div>\n        </div>\n        <?php\n        if ($is_text && $isNormalEditor) {\n            echo '<textarea class=\"mt-2\" id=\"normal-editor\" rows=\"33\" cols=\"120\" style=\"width: 99.5%;\">' . htmlspecialchars($content) . '</textarea>';\n        } elseif ($is_text) {\n            echo '<div id=\"editor\" contenteditable=\"true\">' . htmlspecialchars($content) . '</div>';\n        } else {\n            fm_set_msg('FILE EXTENSION HAS NOT SUPPORTED', 'error');\n        }\n        ?>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n// chmod (not for Windows)\nif (isset($_GET['chmod']) && !FM_READONLY && !FM_IS_WIN) {\n    $file = $_GET['chmod'];\n    $file = fm_clean_path($file);\n    $file = str_replace('/', '', $file);\n    if ($file == '' || (!is_file($path . '/' . $file) && !is_dir($path . '/' . $file))) {\n        fm_set_msg('File not found', 'error');\n        fm_redirect(FM_SELF_URL . '?p=' . urlencode(FM_PATH));\n    }\n\n    fm_show_header(); // HEADER\n    fm_show_nav_path(FM_PATH); // current path\n\n    $file_url = FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file;\n    $file_path = $path . '/' . $file;\n\n    $mode = fileperms($path . '/' . $file);\n\n    ?>\n    <div class=\"path\">\n        <div class=\"card mb-2\">\n            <h6 class=\"card-header\">\n                <?php echo lng('ChangePermissions') ?>\n            </h6>\n            <div class=\"card-body\">\n                <p class=\"card-text\">\n                    Full path: <?php echo $file_path ?><br>\n                </p>\n                <form action=\"\" method=\"post\">\n                    <input type=\"hidden\" name=\"p\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n                    <input type=\"hidden\" name=\"chmod\" value=\"<?php echo fm_enc($file) ?>\">\n\n                    <table class=\"table compact-table\">\n                        <tr>\n                            <td></td>\n                            <td><b><?php echo lng('Owner') ?></b></td>\n                            <td><b><?php echo lng('Group') ?></b></td>\n                            <td><b><?php echo lng('Other') ?></b></td>\n                        </tr>\n                        <tr>\n                            <td style=\"text-align: right\"><b><?php echo lng('Read') ?></b></td>\n                            <td><label><input type=\"checkbox\" name=\"ur\" value=\"1\"<?php echo ($mode & 00400) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"gr\" value=\"1\"<?php echo ($mode & 00040) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"or\" value=\"1\"<?php echo ($mode & 00004) ? ' checked' : '' ?>></label></td>\n                        </tr>\n                        <tr>\n                            <td style=\"text-align: right\"><b><?php echo lng('Write') ?></b></td>\n                            <td><label><input type=\"checkbox\" name=\"uw\" value=\"1\"<?php echo ($mode & 00200) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"gw\" value=\"1\"<?php echo ($mode & 00020) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"ow\" value=\"1\"<?php echo ($mode & 00002) ? ' checked' : '' ?>></label></td>\n                        </tr>\n                        <tr>\n                            <td style=\"text-align: right\"><b><?php echo lng('Execute') ?></b></td>\n                            <td><label><input type=\"checkbox\" name=\"ux\" value=\"1\"<?php echo ($mode & 00100) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"gx\" value=\"1\"<?php echo ($mode & 00010) ? ' checked' : '' ?>></label></td>\n                            <td><label><input type=\"checkbox\" name=\"ox\" value=\"1\"<?php echo ($mode & 00001) ? ' checked' : '' ?>></label></td>\n                        </tr>\n                    </table>\n\n                    <p>\n                        <button type=\"submit\" class=\"btn btn-success\"><i class=\"fa fa-check-circle\"></i> <?php echo lng('Change') ?></button> &nbsp;\n                        <b><a href=\"?p=<?php echo urlencode(FM_PATH) ?>\" class=\"btn btn-outline-primary\"><i class=\"fa fa-times-circle\"></i> <?php echo lng('Cancel') ?></a></b>\n                    </p>\n                </form>\n            </div>\n        </div>\n    </div>\n    <?php\n    fm_show_footer();\n    exit;\n}\n\n//--- FILEMANAGER MAIN\nfm_show_header(); // HEADER\nfm_show_nav_path(FM_PATH); // current path\n\n// messages\nfm_show_message();\n\n$num_files = count($files);\n$num_folders = count($folders);\n$all_files_size = 0;\n?>\n<form action=\"\" method=\"post\" class=\"pt-3\">\n    <input type=\"hidden\" name=\"p\" value=\"<?php echo fm_enc(FM_PATH) ?>\">\n    <input type=\"hidden\" name=\"group\" value=\"1\">\n    <div class=\"table-responsive\">\n        <table class=\"table table-bordered table-hover table-sm bg-white\" id=\"main-table\">\n            <thead class=\"thead-white\">\n            <tr>\n                <?php if (!FM_READONLY): ?>\n                    <th style=\"width:3%\" class=\"custom-checkbox-header\">\n                        <div class=\"custom-control custom-checkbox\">\n                            <input type=\"checkbox\" class=\"custom-control-input\" id=\"js-select-all-items\" onclick=\"checkbox_toggle()\">\n                            <label class=\"custom-control-label\" for=\"js-select-all-items\"></label>\n                        </div>\n                    </th><?php endif; ?>\n                <th><?php echo lng('Name') ?></th>\n                <th><?php echo lng('Size') ?></th>\n                <th><?php echo lng('Modified') ?></th>\n                <?php if (!FM_IS_WIN && !$hide_Cols): ?>\n                    <th><?php echo lng('Perms') ?></th>\n                    <th><?php echo lng('Owner') ?></th><?php endif; ?>\n                <th><?php echo lng('Actions') ?></th>\n            </tr>\n            </thead>\n            <?php\n            // link to parent folder\n            if ($parent !== false) {\n                ?>\n                <tr><?php if (!FM_READONLY): ?>\n                    <td class=\"nosort\"></td><?php endif; ?>\n                    <td class=\"border-0\"><a href=\"?p=<?php echo urlencode($parent) ?>\"><i class=\"fa fa-chevron-circle-left go-back\"></i> ..</a></td>\n                    <td class=\"border-0\"></td>\n                    <td class=\"border-0\"></td>\n                    <td class=\"border-0\"></td>\n                    <?php if (!FM_IS_WIN && !$hide_Cols) { ?>\n                        <td class=\"border-0\"></td>\n                        <td class=\"border-0\"></td>\n                    <?php } ?>\n                </tr>\n                <?php\n            }\n            $ii = 3399;\n            foreach ($folders as $f) {\n                $is_link = is_link($path . '/' . $f);\n                $img = $is_link ? 'icon-link_folder' : 'fa fa-folder-o';\n                $modif = date(FM_DATETIME_FORMAT, filemtime($path . '/' . $f));\n                $perms = substr(decoct(fileperms($path . '/' . $f)), -4);\n                if (function_exists('posix_getpwuid') && function_exists('posix_getgrgid')) {\n                    $owner = posix_getpwuid(fileowner($path . '/' . $f));\n                    $group = posix_getgrgid(filegroup($path . '/' . $f));\n                } else {\n                    $owner = array('name' => '?');\n                    $group = array('name' => '?');\n                }\n                ?>\n                <tr>\n                    <?php if (!FM_READONLY): ?>\n                        <td class=\"custom-checkbox-td\">\n                        <div class=\"custom-control custom-checkbox\">\n                            <input type=\"checkbox\" class=\"custom-control-input\" id=\"<?php echo $ii ?>\" name=\"file[]\" value=\"<?php echo fm_enc($f) ?>\">\n                            <label class=\"custom-control-label\" for=\"<?php echo $ii ?>\"></label>\n                        </div>\n                        </td><?php endif; ?>\n                    <td>\n                        <div class=\"filename\"><a href=\"?p=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>\"><i class=\"<?php echo $img ?>\"></i> <?php echo fm_convert_win($f) ?>\n                            </a><?php echo($is_link ? ' &rarr; <i>' . readlink($path . '/' . $f) . '</i>' : '') ?></div>\n                    </td>\n                    <td><?php if ($calc_folder) { echo fm_get_directorysize($path . '/' . $f); } else { echo lng('Folder'); } ?></td>\n                    <td><?php echo $modif ?></td>\n                    <?php if (!FM_IS_WIN && !$hide_Cols): ?>\n                        <td><?php if (!FM_READONLY): ?><a title=\"Change Permissions\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;chmod=<?php echo urlencode($f) ?>\"><?php echo $perms ?></a><?php else: ?><?php echo $perms ?><?php endif; ?>\n                        </td>\n                        <td><?php echo $owner['name'] . ':' . $group['name'] ?></td>\n                    <?php endif; ?>\n                    <td class=\"inline-actions\"><?php if (!FM_READONLY): ?>\n                            <a title=\"<?php echo lng('Delete')?>\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;del=<?php echo urlencode($f) ?>\" onclick=\"return confirm('Delete folder?');\"><i class=\"fa fa-trash-o\" aria-hidden=\"true\"></i></a>\n                            <a title=\"<?php echo lng('Rename')?>\" href=\"#\" onclick=\"rename('<?php echo fm_enc(FM_PATH) ?>', '<?php echo fm_enc(addslashes($f)) ?>');return false;\"><i class=\"fa fa-pencil-square-o\" aria-hidden=\"true\"></i></a>\n                            <a title=\"<?php echo lng('CopyTo')?>...\" href=\"?p=&amp;copy=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>\"><i class=\"fa fa-files-o\" aria-hidden=\"true\"></i></a>\n                        <?php endif; ?>\n                        <a title=\"<?php echo lng('DirectLink')?>\" href=\"<?php echo fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f . '/') ?>\" target=\"_blank\"><i class=\"fa fa-link\" aria-hidden=\"true\"></i></a>\n                    </td>\n                </tr>\n                <?php\n                flush();\n                $ii++;\n            }\n            $ik = 6070;\n            foreach ($files as $f) {\n                $is_link = is_link($path . '/' . $f);\n                $img = $is_link ? 'fa fa-file-text-o' : fm_get_file_icon_class($path . '/' . $f);\n                $modif = date(FM_DATETIME_FORMAT, filemtime($path . '/' . $f));\n                $filesize_raw = fm_get_size($path . '/' . $f);\n                $filesize = fm_get_filesize($filesize_raw);\n                $filelink = '?p=' . urlencode(FM_PATH) . '&amp;view=' . urlencode($f);\n                $all_files_size += $filesize_raw;\n                $perms = substr(decoct(fileperms($path . '/' . $f)), -4);\n                if (function_exists('posix_getpwuid') && function_exists('posix_getgrgid')) {\n                    $owner = posix_getpwuid(fileowner($path . '/' . $f));\n                    $group = posix_getgrgid(filegroup($path . '/' . $f));\n                } else {\n                    $owner = array('name' => '?');\n                    $group = array('name' => '?');\n                }\n                ?>\n                <tr>\n                    <?php if (!FM_READONLY): ?>\n                        <td class=\"custom-checkbox-td\">\n                        <div class=\"custom-control custom-checkbox\">\n                            <input type=\"checkbox\" class=\"custom-control-input\" id=\"<?php echo $ik ?>\" name=\"file[]\" value=\"<?php echo fm_enc($f) ?>\">\n                            <label class=\"custom-control-label\" for=\"<?php echo $ik ?>\"></label>\n                        </div>\n                        </td><?php endif; ?>\n                    <td>\n                        <div class=\"filename\"><a href=\"<?php echo $filelink ?>\" title=\"File info\"><i class=\"<?php echo $img ?>\"></i> <?php echo fm_convert_win($f) ?>\n                            </a><?php echo($is_link ? ' &rarr; <i>' . readlink($path . '/' . $f) . '</i>' : '') ?></div>\n                    </td>\n                    <td><span title=\"<?php printf('%s bytes', $filesize_raw) ?>\">\n                        <?php echo $filesize; ?>\n                        </span></td>\n                    <td><?php echo $modif ?></td>\n                    <?php if (!FM_IS_WIN && !$hide_Cols): ?>\n                        <td><?php if (!FM_READONLY): ?><a title=\"<?php echo 'Change Permissions' ?>\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;chmod=<?php echo urlencode($f) ?>\"><?php echo $perms ?></a><?php else: ?><?php echo $perms ?><?php endif; ?>\n                        </td>\n                        <td><?php echo fm_enc($owner['name'] . ':' . $group['name']) ?></td>\n                    <?php endif; ?>\n                    <td class=\"inline-actions\">\n                        <?php if (!FM_READONLY): ?>\n                            <a title=\"<?php echo lng('Preview') ?>\" href=\"<?php echo $filelink.'&quickView=1'; ?>\" data-toggle=\"lightbox\" data-gallery=\"tiny-gallery\" data-title=\"<?php echo fm_convert_win($f) ?>\" data-max-width=\"100%\" data-width=\"100%\"><i class=\"fa fa-eye\"></i></a>\n                            <a title=\"<?php echo lng('Delete') ?>\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;del=<?php echo urlencode($f) ?>\" onclick=\"return confirm('<?php echo lng('Delete').' '.lng('File').'?'; ?>');\"><i class=\"fa fa-trash-o\"></i></a>\n                            <a title=\"<?php echo lng('Rename') ?>\" href=\"#\" onclick=\"rename('<?php echo fm_enc(FM_PATH) ?>', '<?php echo fm_enc(addslashes($f)) ?>');return false;\"><i class=\"fa fa-pencil-square-o\"></i></a>\n                            <a title=\"<?php echo lng('CopyTo') ?>...\"\n                               href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>\"><i class=\"fa fa-files-o\"></i></a>\n                        <?php endif; ?>\n                        <a title=\"<?php echo lng('DirectLink') ?>\" href=\"<?php echo fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f) ?>\" target=\"_blank\"><i class=\"fa fa-link\"></i></a>\n                        <a title=\"<?php echo lng('Download') ?>\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;dl=<?php echo urlencode($f) ?>\"><i class=\"fa fa-download\"></i></a>\n                    </td>\n                </tr>\n                <?php\n                flush();\n                $ik++;\n            }\n\n            if (empty($folders) && empty($files)) {\n                ?>\n                <tfoot>\n                    <tr><?php if (!FM_READONLY): ?>\n                            <td></td><?php endif; ?>\n                        <td colspan=\"<?php echo (!FM_IS_WIN && !$hide_Cols) ? '6' : '4' ?>\"><em><?php echo 'Folder is empty' ?></em></td>\n                    </tr>\n                </tfoot>\n                <?php\n            } else {\n                ?>\n                <tfoot>\n                    <tr><?php if (!FM_READONLY): ?>\n                            <td class=\"gray\"></td><?php endif; ?>\n                        <td class=\"gray\" colspan=\"<?php echo (!FM_IS_WIN && !$hide_Cols) ? '6' : '4' ?>\">\n                            <?php echo lng('FullSize').': <span class=\"badge badge-light\">'.fm_get_filesize($all_files_size).'</span>' ?>\n                            <?php echo lng('File').': <span class=\"badge badge-light\">'.$num_files.'</span>' ?>\n                            <?php echo lng('Folder').': <span class=\"badge badge-light\">'.$num_folders.'</span>' ?>\n                            <?php echo lng('MemoryUsed').': <span class=\"badge badge-light\">'.fm_get_filesize(@memory_get_usage(true)).'</span>' ?>\n                            <?php echo lng('PartitionSize').': <span class=\"badge badge-light\">'.fm_get_filesize(@disk_free_space($path)) .'</span> '.lng('FreeOf').' <span class=\"badge badge-light\">'.fm_get_filesize(@disk_total_space($path)).'</span>'; ?>\n                        </td>\n                    </tr>\n                </tfoot>\n                <?php\n            }\n            ?>\n        </table>\n    </div>\n\n    <div class=\"row\">\n        <?php if (!FM_READONLY): ?>\n        <div class=\"col-xs-12 col-sm-9\">\n            <ul class=\"list-inline footer-action\">\n                <li class=\"list-inline-item\"> <a href=\"#/select-all\" class=\"btn btn-small btn-outline-primary btn-2\" onclick=\"select_all();return false;\"><i class=\"fa fa-check-square\"></i> <?php echo lng('SelectAll') ?> </a></li>\n                <li class=\"list-inline-item\"><a href=\"#/unselect-all\" class=\"btn btn-small btn-outline-primary btn-2\" onclick=\"unselect_all();return false;\"><i class=\"fa fa-window-close\"></i> <?php echo lng('UnSelectAll') ?> </a></li>\n                <li class=\"list-inline-item\"><a href=\"#/invert-all\" class=\"btn btn-small btn-outline-primary btn-2\" onclick=\"invert_all();return false;\"><i class=\"fa fa-th-list\"></i> <?php echo lng('InvertSelection') ?> </a></li>\n                <li class=\"list-inline-item\"><input type=\"submit\" class=\"hidden\" name=\"delete\" id=\"a-delete\" value=\"Delete\" onclick=\"return confirm('Delete selected files and folders?')\">\n                    <a href=\"javascript:document.getElementById('a-delete').click();\" class=\"btn btn-small btn-outline-primary btn-2\"><i class=\"fa fa-trash\"></i> <?php echo lng('Delete') ?> </a></li>\n                <li class=\"list-inline-item\"><input type=\"submit\" class=\"hidden\" name=\"zip\" id=\"a-zip\" value=\"zip\" onclick=\"return confirm('Create archive?')\">\n                    <a href=\"javascript:document.getElementById('a-zip').click();\" class=\"btn btn-small btn-outline-primary btn-2\"><i class=\"fa fa-file-archive-o\"></i> <?php echo lng('Zip') ?> </a></li>\n                <li class=\"list-inline-item\"><input type=\"submit\" class=\"hidden\" name=\"tar\" id=\"a-tar\" value=\"tar\" onclick=\"return confirm('Create archive?')\">\n                    <a href=\"javascript:document.getElementById('a-tar').click();\" class=\"btn btn-small btn-outline-primary btn-2\"><i class=\"fa fa-file-archive-o\"></i> <?php echo lng('Tar') ?> </a></li>\n                <li class=\"list-inline-item\"><input type=\"submit\" class=\"hidden\" name=\"copy\" id=\"a-copy\" value=\"Copy\">\n                    <a href=\"javascript:document.getElementById('a-copy').click();\" class=\"btn btn-small btn-outline-primary btn-2\"><i class=\"fa fa-files-o\"></i> <?php echo lng('Copy') ?> </a></li>\n            </ul>\n        </div>\n        <div class=\"col-3 d-none d-sm-block\"><a href=\"https://tinyfilemanager.github.io\" target=\"_blank\" class=\"float-right text-muted\">Tiny File Manager <?php echo VERSION; ?></a></div>\n        <?php else: ?>\n            <div class=\"col-12\"><a href=\"https://tinyfilemanager.github.io\" target=\"_blank\" class=\"float-right text-muted\">Tiny File Manager <?php echo VERSION; ?></a></div>\n        <?php endif; ?>\n    </div>\n\n</form>\n\n<?php\nfm_show_footer();\n\n//--- END\n\n// Functions\n\n/**\n * Check if the filename is allowed.\n * @param string $filename\n * @return bool\n */\nfunction fm_is_file_allowed($filename)\n{\n    // By default, no file is allowed\n    $allowed = false;\n\n    if (FM_EXTENSION) {\n        $ext = strtolower(pathinfo($filename, PATHINFO_EXTENSION));\n\n        if (in_array($ext, explode(',', strtolower(FM_EXTENSION)))) {\n            $allowed = true;\n        }\n    }\n\n    return $allowed;\n}\n\n/**\n * Delete  file or folder (recursively)\n * @param string $path\n * @return bool\n */\nfunction fm_rdelete($path)\n{\n    if (is_link($path)) {\n        return unlink($path);\n    } elseif (is_dir($path)) {\n        $objects = scandir($path);\n        $ok = true;\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (!fm_rdelete($path . '/' . $file)) {\n                        $ok = false;\n                    }\n                }\n            }\n        }\n        return ($ok) ? rmdir($path) : false;\n    } elseif (is_file($path)) {\n        return unlink($path);\n    }\n    return false;\n}\n\n/**\n * Recursive chmod\n * @param string $path\n * @param int $filemode\n * @param int $dirmode\n * @return bool\n * @todo Will use in mass chmod\n */\nfunction fm_rchmod($path, $filemode, $dirmode)\n{\n    if (is_dir($path)) {\n        if (!chmod($path, $dirmode)) {\n            return false;\n        }\n        $objects = scandir($path);\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (!fm_rchmod($path . '/' . $file, $filemode, $dirmode)) {\n                        return false;\n                    }\n                }\n            }\n        }\n        return true;\n    } elseif (is_link($path)) {\n        return true;\n    } elseif (is_file($path)) {\n        return chmod($path, $filemode);\n    }\n    return false;\n}\n\n/**\n * Safely rename\n * @param string $old\n * @param string $new\n * @return bool|null\n */\nfunction fm_rename($old, $new)\n{\n    $allowed = (FM_EXTENSION) ? explode(',', FM_EXTENSION) : false;\n\n    $ext = pathinfo($new, PATHINFO_EXTENSION);\n    $isFileAllowed = ($allowed) ? in_array($ext, $allowed) : true;\n\n    if(!$isFileAllowed) return false;\n\n    return (!file_exists($new) && file_exists($old)) ? rename($old, $new) : null;\n}\n\n/**\n * Copy file or folder (recursively).\n * @param string $path\n * @param string $dest\n * @param bool $upd Update files\n * @param bool $force Create folder with same names instead file\n * @return bool\n */\nfunction fm_rcopy($path, $dest, $upd = true, $force = true)\n{\n    if (is_dir($path)) {\n        if (!fm_mkdir($dest, $force)) {\n            return false;\n        }\n        $objects = scandir($path);\n        $ok = true;\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (!fm_rcopy($path . '/' . $file, $dest . '/' . $file)) {\n                        $ok = false;\n                    }\n                }\n            }\n        }\n        return $ok;\n    } elseif (is_file($path)) {\n        return fm_copy($path, $dest, $upd);\n    }\n    return false;\n}\n\n/**\n * Safely create folder\n * @param string $dir\n * @param bool $force\n * @return bool\n */\nfunction fm_mkdir($dir, $force)\n{\n    if (file_exists($dir)) {\n        if (is_dir($dir)) {\n            return $dir;\n        } elseif (!$force) {\n            return false;\n        }\n        unlink($dir);\n    }\n    return mkdir($dir, 0777, true);\n}\n\n/**\n * Safely copy file\n * @param string $f1\n * @param string $f2\n * @param bool $upd\n * @return bool\n */\nfunction fm_copy($f1, $f2, $upd)\n{\n    $time1 = filemtime($f1);\n    if (file_exists($f2)) {\n        $time2 = filemtime($f2);\n        if ($time2 >= $time1 && $upd) {\n            return false;\n        }\n    }\n    $ok = copy($f1, $f2);\n    if ($ok) {\n        touch($f2, $time1);\n    }\n    return $ok;\n}\n\n/**\n * Get mime type\n * @param string $file_path\n * @return mixed|string\n */\nfunction fm_get_mime_type($file_path)\n{\n    if (function_exists('finfo_open')) {\n        $finfo = finfo_open(FILEINFO_MIME_TYPE);\n        $mime = finfo_file($finfo, $file_path);\n        finfo_close($finfo);\n        return $mime;\n    } elseif (function_exists('mime_content_type')) {\n        return mime_content_type($file_path);\n    } elseif (!stristr(ini_get('disable_functions'), 'shell_exec')) {\n        $file = escapeshellarg($file_path);\n        $mime = shell_exec('file -bi ' . $file);\n        return $mime;\n    } else {\n        return '--';\n    }\n}\n\n/**\n * HTTP Redirect\n * @param string $url\n * @param int $code\n */\nfunction fm_redirect($url, $code = 302)\n{\n    header('Location: ' . $url, true, $code);\n    exit;\n}\n\n/**\n * Path traversal prevention and clean the url\n * It replaces (consecutive) occurrences of / and \\\\ with whatever is in DIRECTORY_SEPARATOR, and processes /. and /.. fine.\n * @param $path\n * @return string\n */\nfunction get_absolute_path($path) {\n    $path = str_replace(array('/', '\\\\'), DIRECTORY_SEPARATOR, $path);\n    $parts = array_filter(explode(DIRECTORY_SEPARATOR, $path), 'strlen');\n    $absolutes = array();\n    foreach ($parts as $part) {\n        if ('.' == $part) continue;\n        if ('..' == $part) {\n            array_pop($absolutes);\n        } else {\n            $absolutes[] = $part;\n        }\n    }\n    return implode(DIRECTORY_SEPARATOR, $absolutes);\n}\n\n/**\n * Clean path\n * @param string $path\n * @return string\n */\nfunction fm_clean_path($path, $trim = true)\n{\n    $path = $trim ? trim($path) : $path;\n    $path = trim($path, '\\\\/');\n    $path = str_replace(array('../', '..\\\\'), '', $path);\n    $path =  get_absolute_path($path);\n    if ($path == '..') {\n        $path = '';\n    }\n    return str_replace('\\\\', '/', $path);\n}\n\n/**\n * Get parent path\n * @param string $path\n * @return bool|string\n */\nfunction fm_get_parent_path($path)\n{\n    $path = fm_clean_path($path);\n    if ($path != '') {\n        $array = explode('/', $path);\n        if (count($array) > 1) {\n            $array = array_slice($array, 0, -1);\n            return implode('/', $array);\n        }\n        return '';\n    }\n    return false;\n}\n\n/*\n * get language translations from json file\n * @param int $tr\n * @return array\n */\nfunction fm_get_translations($tr) {\n    try {\n        $content = @file_get_contents('translation.json');\n        if($content !== FALSE) {\n            $lng = json_decode($content, TRUE);\n            global $lang_list;\n            foreach ($lng[\"language\"] as $key => $value)\n            {\n                $code = $value[\"code\"];\n                $lang_list[$code] = $value[\"name\"];\n                if ($tr)\n                    $tr[$code] = $value[\"translation\"];\n            }\n            return $tr;\n        }\n\n    }\n    catch (Exception $e) {\n        echo $e;\n    }\n}\n\n/**\n * @param $file\n * Recover all file sizes larger than > 2GB.\n * Works on php 32bits and 64bits and supports linux\n * @return int|string\n */\nfunction fm_get_size($file)\n{\n    static $iswin;\n    static $isdarwin;\n    if (!isset($iswin)) {\n        $iswin = (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN');\n    } \n    if (!isset($isdarwin)) {\n        $isdarwin = (strtoupper(substr(PHP_OS, 0)) == \"DARWIN\");\n    }\n\n    static $exec_works;\n    if (!isset($exec_works)) {\n        $exec_works = (function_exists('exec') && !ini_get('safe_mode') && @exec('echo EXEC') == 'EXEC');\n    }\n\n    // try a shell command\n    if ($exec_works) {\n        $arg = escapeshellarg($file);\n        $cmd = ($iswin) ? \"for %F in (\\\"$file\\\") do @echo %~zF\" : ($isdarwin ? \"stat -f%z $arg\" : \"stat -c%s $arg\");\n        @exec($cmd, $output);\n        if (is_array($output) && ctype_digit($size = trim(implode(\"\\n\", $output)))) {\n            return $size;\n        }\n    }\n\n    // try the Windows COM interface\n    if ($iswin && class_exists(\"COM\")) {\n        try {\n            $fsobj = new COM('Scripting.FileSystemObject');\n            $f = $fsobj->GetFile( realpath($file) );\n            $size = $f->Size;\n        } catch (Exception $e) {\n            $size = null;\n        }\n        if (ctype_digit($size)) {\n            return $size;\n        }\n    }\n\n    // if all else fails\n    return filesize($file);\n}\n\n/**\n * Get nice filesize\n * @param int $size\n * @return string\n */\nfunction fm_get_filesize($size)\n{\n    if ($size < 1000) {\n        return sprintf('%s B', $size);\n    } elseif (($size / 1024) < 1000) {\n        return sprintf('%s KB', round(($size / 1024), 2));\n    } elseif (($size / 1024 / 1024) < 1000) {\n        return sprintf('%s MB', round(($size / 1024 / 1024), 2));\n    } elseif (($size / 1024 / 1024 / 1024) < 1000) {\n        return sprintf('%s GB', round(($size / 1024 / 1024 / 1024), 2));\n    } else {\n        return sprintf('%s TB', round(($size / 1024 / 1024 / 1024 / 1024), 2));\n    }\n}\n\n/**\n * Get director total size\n * @param string $directory\n * @return string\n */\nfunction fm_get_directorysize($directory) {\n    global $calc_folder;\n    if ($calc_folder==true) { //  Slower output\n      $size = 0;  $count= 0;  $dirCount= 0;\n    foreach(new RecursiveIteratorIterator(new RecursiveDirectoryIterator($directory)) as $file)\n    if ($file->isFile())\n        {   $size+=$file->getSize();\n            $count++;\n        }\n    else if ($file->isDir()) { $dirCount++; }\n    // return [$size, $count, $dirCount];\n    return fm_get_filesize($size);\n    }\n    else return 'Folder'; //  Quick output\n}\n\n/**\n * Get info about zip archive\n * @param string $path\n * @return array|bool\n */\nfunction fm_get_zif_info($path, $ext) {\n    if ($ext == 'zip' && function_exists('zip_open')) {\n        $arch = zip_open($path);\n        if ($arch) {\n            $filenames = array();\n            while ($zip_entry = zip_read($arch)) {\n                $zip_name = zip_entry_name($zip_entry);\n                $zip_folder = substr($zip_name, -1) == '/';\n                $filenames[] = array(\n                    'name' => $zip_name,\n                    'filesize' => zip_entry_filesize($zip_entry),\n                    'compressed_size' => zip_entry_compressedsize($zip_entry),\n                    'folder' => $zip_folder\n                    //'compression_method' => zip_entry_compressionmethod($zip_entry),\n                );\n            }\n            zip_close($arch);\n            return $filenames;\n        }\n    } elseif($ext == 'tar' && class_exists('PharData')) {\n        $archive = new PharData($path);\n        $filenames = array();\n        foreach(new RecursiveIteratorIterator($archive) as $file) {\n            $parent_info = $file->getPathInfo();\n            $zip_name = str_replace(\"phar://\".$path, '', $file->getPathName());\n            $zip_name = substr($zip_name, ($pos = strpos($zip_name, '/')) !== false ? $pos + 1 : 0);\n            $zip_folder = $parent_info->getFileName();\n            $zip_info = new SplFileInfo($file);\n            $filenames[] = array(\n                'name' => $zip_name,\n                'filesize' => $zip_info->getSize(),\n                'compressed_size' => $file->getCompressedSize(),\n                'folder' => $zip_folder\n            );\n        }\n        return $filenames;\n    }\n    return false;\n}\n\n/**\n * Encode html entities\n * @param string $text\n * @return string\n */\nfunction fm_enc($text)\n{\n    return htmlspecialchars($text, ENT_QUOTES, 'UTF-8');\n}\n\n/**\n * Save message in session\n * @param string $msg\n * @param string $status\n */\nfunction fm_set_msg($msg, $status = 'ok')\n{\n    $_SESSION[FM_SESSION_ID]['message'] = $msg;\n    $_SESSION[FM_SESSION_ID]['status'] = $status;\n}\n\n/**\n * Check if string is in UTF-8\n * @param string $string\n * @return int\n */\nfunction fm_is_utf8($string)\n{\n    return preg_match('//u', $string);\n}\n\n/**\n * Convert file name to UTF-8 in Windows\n * @param string $filename\n * @return string\n */\nfunction fm_convert_win($filename)\n{\n    if (FM_IS_WIN && function_exists('iconv')) {\n        $filename = iconv(FM_ICONV_INPUT_ENC, 'UTF-8//IGNORE', $filename);\n    }\n    return $filename;\n}\n\n/**\n * @param $obj\n * @return array\n */\nfunction fm_object_to_array($obj)\n{\n    if (!is_object($obj) && !is_array($obj)) {\n        return $obj;\n    }\n    if (is_object($obj)) {\n        $obj = get_object_vars($obj);\n    }\n    return array_map('fm_object_to_array', $obj);\n}\n\n/**\n * Get CSS classname for file\n * @param string $path\n * @return string\n */\nfunction fm_get_file_icon_class($path)\n{\n    // get extension\n    $ext = strtolower(pathinfo($path, PATHINFO_EXTENSION));\n\n    switch ($ext) {\n        case 'ico':\n        case 'gif':\n        case 'jpg':\n        case 'jpeg':\n        case 'jpc':\n        case 'jp2':\n        case 'jpx':\n        case 'xbm':\n        case 'wbmp':\n        case 'png':\n        case 'bmp':\n        case 'tif':\n        case 'tiff':\n        case 'svg':\n            $img = 'fa fa-picture-o';\n            break;\n        case 'passwd':\n        case 'ftpquota':\n        case 'sql':\n        case 'js':\n        case 'json':\n        case 'sh':\n        case 'config':\n        case 'twig':\n        case 'tpl':\n        case 'md':\n        case 'gitignore':\n        case 'c':\n        case 'cpp':\n        case 'cs':\n        case 'py':\n        case 'map':\n        case 'lock':\n        case 'dtd':\n            $img = 'fa fa-file-code-o';\n            break;\n        case 'txt':\n        case 'ini':\n        case 'conf':\n        case 'log':\n        case 'htaccess':\n            $img = 'fa fa-file-text-o';\n            break;\n        case 'css':\n        case 'less':\n        case 'sass':\n        case 'scss':\n            $img = 'fa fa-css3';\n            break;\n        case 'zip':\n        case 'rar':\n        case 'gz':\n        case 'tar':\n        case '7z':\n            $img = 'fa fa-file-archive-o';\n            break;\n        case 'php':\n        case 'php4':\n        case 'php5':\n        case 'phps':\n        case 'phtml':\n            $img = 'fa fa-code';\n            break;\n        case 'htm':\n        case 'html':\n        case 'shtml':\n        case 'xhtml':\n            $img = 'fa fa-html5';\n            break;\n        case 'xml':\n        case 'xsl':\n            $img = 'fa fa-file-excel-o';\n            break;\n        case 'wav':\n        case 'mp3':\n        case 'mp2':\n        case 'm4a':\n        case 'aac':\n        case 'ogg':\n        case 'oga':\n        case 'wma':\n        case 'mka':\n        case 'flac':\n        case 'ac3':\n        case 'tds':\n            $img = 'fa fa-music';\n            break;\n        case 'm3u':\n        case 'm3u8':\n        case 'pls':\n        case 'cue':\n            $img = 'fa fa-headphones';\n            break;\n        case 'avi':\n        case 'mpg':\n        case 'mpeg':\n        case 'mp4':\n        case 'm4v':\n        case 'flv':\n        case 'f4v':\n        case 'ogm':\n        case 'ogv':\n        case 'mov':\n        case 'mkv':\n        case '3gp':\n        case 'asf':\n        case 'wmv':\n            $img = 'fa fa-file-video-o';\n            break;\n        case 'eml':\n        case 'msg':\n            $img = 'fa fa-envelope-o';\n            break;\n        case 'xls':\n        case 'xlsx':\n        case 'ods':\n            $img = 'fa fa-file-excel-o';\n            break;\n        case 'csv':\n            $img = 'fa fa-file-text-o';\n            break;\n        case 'bak':\n            $img = 'fa fa-clipboard';\n            break;\n        case 'doc':\n        case 'docx':\n        case 'odt':\n            $img = 'fa fa-file-word-o';\n            break;\n        case 'ppt':\n        case 'pptx':\n            $img = 'fa fa-file-powerpoint-o';\n            break;\n        case 'ttf':\n        case 'ttc':\n        case 'otf':\n        case 'woff':\n        case 'woff2':\n        case 'eot':\n        case 'fon':\n            $img = 'fa fa-font';\n            break;\n        case 'pdf':\n            $img = 'fa fa-file-pdf-o';\n            break;\n        case 'psd':\n        case 'ai':\n        case 'eps':\n        case 'fla':\n        case 'swf':\n            $img = 'fa fa-file-image-o';\n            break;\n        case 'exe':\n        case 'msi':\n            $img = 'fa fa-file-o';\n            break;\n        case 'bat':\n            $img = 'fa fa-terminal';\n            break;\n        default:\n            $img = 'fa fa-info-circle';\n    }\n\n    return $img;\n}\n\n/**\n * Get image files extensions\n * @return array\n */\nfunction fm_get_image_exts()\n{\n    return array('ico', 'gif', 'jpg', 'jpeg', 'jpc', 'jp2', 'jpx', 'xbm', 'wbmp', 'png', 'bmp', 'tif', 'tiff', 'psd', 'svg');\n}\n\n/**\n * Get video files extensions\n * @return array\n */\nfunction fm_get_video_exts()\n{\n    return array('webm', 'mp4', 'm4v', 'ogm', 'ogv', 'mov', 'mkv');\n}\n\n/**\n * Get audio files extensions\n * @return array\n */\nfunction fm_get_audio_exts()\n{\n    return array('wav', 'mp3', 'ogg', 'm4a');\n}\n\n/**\n * Get text file extensions\n * @return array\n */\nfunction fm_get_text_exts()\n{\n    return array(\n        'txt', 'css', 'ini', 'conf', 'log', 'htaccess', 'passwd', 'ftpquota', 'sql', 'js', 'json', 'sh', 'config',\n        'php', 'php4', 'php5', 'phps', 'phtml', 'htm', 'html', 'shtml', 'xhtml', 'xml', 'xsl', 'm3u', 'm3u8', 'pls', 'cue',\n        'eml', 'msg', 'csv', 'bat', 'twig', 'tpl', 'md', 'gitignore', 'less', 'sass', 'scss', 'c', 'cpp', 'cs', 'py',\n        'map', 'lock', 'dtd', 'svg', 'scss', 'asp', 'aspx', 'asx', 'asmx', 'ashx', 'jsx', 'jsp', 'jspx', 'cfm', 'cgi'\n    );\n}\n\n/**\n * Get mime types of text files\n * @return array\n */\nfunction fm_get_text_mimes()\n{\n    return array(\n        'application/xml',\n        'application/javascript',\n        'application/x-javascript',\n        'image/svg+xml',\n        'message/rfc822',\n    );\n}\n\n/**\n * Get file names of text files w/o extensions\n * @return array\n */\nfunction fm_get_text_names()\n{\n    return array(\n        'license',\n        'readme',\n        'authors',\n        'contributors',\n        'changelog',\n    );\n}\n\n/**\n * Get online docs viewer supported files extensions\n * @return array\n */\nfunction fm_get_onlineViewer_exts()\n{\n    return array('doc', 'docx', 'xls', 'xlsx', 'pdf', 'ppt', 'pptx', 'ai', 'psd', 'dxf', 'xps', 'rar', 'odt', 'ods');\n}\n\n/**\n * Class to work with zip files (using ZipArchive)\n */\nclass FM_Zipper\n{\n    private $zip;\n\n    public function __construct()\n    {\n        $this->zip = new ZipArchive();\n    }\n\n    /**\n     * Create archive with name $filename and files $files (RELATIVE PATHS!)\n     * @param string $filename\n     * @param array|string $files\n     * @return bool\n     */\n    public function create($filename, $files)\n    {\n        $res = $this->zip->open($filename, ZipArchive::CREATE);\n        if ($res !== true) {\n            return false;\n        }\n        if (is_array($files)) {\n            foreach ($files as $f) {\n                if (!$this->addFileOrDir($f)) {\n                    $this->zip->close();\n                    return false;\n                }\n            }\n            $this->zip->close();\n            return true;\n        } else {\n            if ($this->addFileOrDir($files)) {\n                $this->zip->close();\n                return true;\n            }\n            return false;\n        }\n    }\n\n    /**\n     * Extract archive $filename to folder $path (RELATIVE OR ABSOLUTE PATHS)\n     * @param string $filename\n     * @param string $path\n     * @return bool\n     */\n    public function unzip($filename, $path)\n    {\n        $res = $this->zip->open($filename);\n        if ($res !== true) {\n            return false;\n        }\n        if ($this->zip->extractTo($path)) {\n            $this->zip->close();\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * Add file/folder to archive\n     * @param string $filename\n     * @return bool\n     */\n    private function addFileOrDir($filename)\n    {\n        if (is_file($filename)) {\n            return $this->zip->addFile($filename);\n        } elseif (is_dir($filename)) {\n            return $this->addDir($filename);\n        }\n        return false;\n    }\n\n    /**\n     * Add folder recursively\n     * @param string $path\n     * @return bool\n     */\n    private function addDir($path)\n    {\n        if (!$this->zip->addEmptyDir($path)) {\n            return false;\n        }\n        $objects = scandir($path);\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (is_dir($path . '/' . $file)) {\n                        if (!$this->addDir($path . '/' . $file)) {\n                            return false;\n                        }\n                    } elseif (is_file($path . '/' . $file)) {\n                        if (!$this->zip->addFile($path . '/' . $file)) {\n                            return false;\n                        }\n                    }\n                }\n            }\n            return true;\n        }\n        return false;\n    }\n}\n\n/**\n * Class to work with Tar files (using PharData)\n */\nclass FM_Zipper_Tar\n{\n    private $tar;\n\n    public function __construct()\n    {\n        $this->tar = null;\n    }\n\n    /**\n     * Create archive with name $filename and files $files (RELATIVE PATHS!)\n     * @param string $filename\n     * @param array|string $files\n     * @return bool\n     */\n    public function create($filename, $files)\n    {\n        $this->tar = new PharData($filename);\n        if (is_array($files)) {\n            foreach ($files as $f) {\n                if (!$this->addFileOrDir($f)) {\n                    return false;\n                }\n            }\n            return true;\n        } else {\n            if ($this->addFileOrDir($files)) {\n                return true;\n            }\n            return false;\n        }\n    }\n\n    /**\n     * Extract archive $filename to folder $path (RELATIVE OR ABSOLUTE PATHS)\n     * @param string $filename\n     * @param string $path\n     * @return bool\n     */\n    public function unzip($filename, $path)\n    {\n        $res = $this->tar->open($filename);\n        if ($res !== true) {\n            return false;\n        }\n        if ($this->tar->extractTo($path)) {\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * Add file/folder to archive\n     * @param string $filename\n     * @return bool\n     */\n    private function addFileOrDir($filename)\n    {\n        if (is_file($filename)) {\n            return $this->tar->addFile($filename);\n        } elseif (is_dir($filename)) {\n            return $this->addDir($filename);\n        }\n        return false;\n    }\n\n    /**\n     * Add folder recursively\n     * @param string $path\n     * @return bool\n     */\n    private function addDir($path)\n    {\n        $objects = scandir($path);\n        if (is_array($objects)) {\n            foreach ($objects as $file) {\n                if ($file != '.' && $file != '..') {\n                    if (is_dir($path . '/' . $file)) {\n                        if (!$this->addDir($path . '/' . $file)) {\n                            return false;\n                        }\n                    } elseif (is_file($path . '/' . $file)) {\n                        try {\n                            $this->tar->addFile($path . '/' . $file);\n                        } catch (Exception $e) {\n                            return false;\n                        }\n                    }\n                }\n            }\n            return true;\n        }\n        return false;\n    }\n}\n\n\n\n/**\n * Save Configuration\n */\n class FM_Config\n{\n     var $data;\n\n    function __construct()\n    {\n        global $root_path, $root_url, $CONFIG;\n        $fm_url = $root_url.$_SERVER[\"PHP_SELF\"];\n        $this->data = array(\n            'lang' => 'en',\n            'error_reporting' => true,\n            'show_hidden' => true\n        );\n        $data = false;\n        if (strlen($CONFIG)) {\n            $data = fm_object_to_array(json_decode($CONFIG));\n        } else {\n            $msg = 'Tiny File Manager<br>Error: Cannot load configuration';\n            if (substr($fm_url, -1) == '/') {\n                $fm_url = rtrim($fm_url, '/');\n                $msg .= '<br>';\n                $msg .= '<br>Seems like you have a trailing slash on the URL.';\n                $msg .= '<br>Try this link: <a href=\"' . $fm_url . '\">' . $fm_url . '</a>';\n            }\n            die($msg);\n        }\n        if (is_array($data) && count($data)) $this->data = $data;\n        else $this->save();\n    }\n\n    function save()\n    {\n        global $root_path;\n        $fm_file = $root_path.$_SERVER[\"PHP_SELF\"];\n        $var_name = '$CONFIG';\n        $var_value = var_export(json_encode($this->data), true);\n        $config_string = \"<?php\" . chr(13) . chr(10) . \"//Default Configuration\".chr(13) . chr(10).\"$var_name = $var_value;\" . chr(13) . chr(10);\n        if (file_exists($fm_file)) {\n            $lines = file($fm_file);\n            if ($fh = @fopen($fm_file, \"w\")) {\n                @fputs($fh, $config_string, strlen($config_string));\n                for ($x = 3; $x < count($lines); $x++) {\n                    @fputs($fh, $lines[$x], strlen($lines[$x]));\n                }\n                @fclose($fh);\n            }\n        }\n    }\n}\n\n//--- templates functions\n\n/**\n * Show nav block\n * @param string $path\n */\nfunction fm_show_nav_path($path)\n{\n    global $lang, $sticky_navbar;\n    $isStickyNavBar = $sticky_navbar ? 'fixed-top' : '';\n    ?>\n    <nav class=\"navbar navbar-expand-lg navbar-light bg-white mb-4 main-nav <?php echo $isStickyNavBar ?>\">\n        <a class=\"navbar-brand\" href=\"\"> <?php echo lng('AppTitle') ?> </a>\n        <button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n            <span class=\"navbar-toggler-icon\"></span>\n        </button>\n        <div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\n\n            <?php\n            $path = fm_clean_path($path);\n            $root_url = \"<a href='?p='><i class='fa fa-home' aria-hidden='true' title='\" . FM_ROOT_PATH . \"'></i></a>\";\n            $sep = '<i class=\"bread-crumb\"> / </i>';\n            if ($path != '') {\n                $exploded = explode('/', $path);\n                $count = count($exploded);\n                $array = array();\n                $parent = '';\n                for ($i = 0; $i < $count; $i++) {\n                    $parent = trim($parent . '/' . $exploded[$i], '/');\n                    $parent_enc = urlencode($parent);\n                    $array[] = \"<a href='?p={$parent_enc}'>\" . fm_enc(fm_convert_win($exploded[$i])) . \"</a>\";\n                }\n                $root_url .= $sep . implode($sep, $array);\n            }\n            echo '<div class=\"col-xs-6 col-sm-5\">' . $root_url . '</div>';\n            ?>\n\n            <div class=\"col-xs-6 col-sm-7 text-right\">\n                <ul class=\"navbar-nav mr-auto float-right\">\n                    <?php if (!FM_READONLY): ?>\n                    <li class=\"nav-item mr-2\">\n                        <div class=\"input-group input-group-sm mr-1\" style=\"margin-top:4px;\">\n                            <input type=\"text\" class=\"form-control\" placeholder=\"<?php echo lng('Search') ?>\" aria-label=\"<?php echo lng('Search') ?>\" aria-describedby=\"search-addon2\" id=\"search-addon\">\n                            <div class=\"input-group-append\">\n                                <span class=\"input-group-text\" id=\"search-addon2\"><i class=\"fa fa-search\"></i></span>\n                            </div>\n                        </div>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a title=\"<?php echo lng('Upload') ?>\" class=\"nav-link\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;upload\"><i class=\"fa fa-cloud-upload\" aria-hidden=\"true\"></i> <?php echo lng('Upload') ?></a>\n                    </li>\n                    <li class=\"nav-item\">\n                        <a title=\"<?php echo lng('NewItem') ?>\" class=\"nav-link\" href=\"#createNewItem\" data-toggle=\"modal\" data-target=\"#createNewItem\"><i class=\"fa fa-plus-square\"></i> <?php echo lng('NewItem') ?></a>\n                    </li>\n                    <?php endif; ?>\n                    <?php if (FM_USE_AUTH): ?>\n                    <li class=\"nav-item avatar dropdown\">\n                        <a class=\"nav-link dropdown-toggle\" id=\"navbarDropdownMenuLink-5\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"> <i class=\"fa fa-user-circle\"></i> <?php if(isset($_SESSION[FM_SESSION_ID]['logged'])) { echo $_SESSION[FM_SESSION_ID]['logged']; } ?></a>\n                        <div class=\"dropdown-menu dropdown-menu-right\" aria-labelledby=\"navbarDropdownMenuLink-5\">\n                            <?php if (!FM_READONLY): ?>\n                            <a title=\"<?php echo lng('Settings') ?>\" class=\"dropdown-item nav-link\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;settings=1\"><i class=\"fa fa-cog\" aria-hidden=\"true\"></i> <?php echo lng('Settings') ?></a>\n                            <?php endif ?>\n                            <a title=\"<?php echo lng('Help') ?>\" class=\"dropdown-item nav-link\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;help=2\"><i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i> <?php echo lng('Help') ?></a>\n                            <a title=\"<?php echo lng('Logout') ?>\" class=\"dropdown-item nav-link\" href=\"?logout=1\"><i class=\"fa fa-sign-out\" aria-hidden=\"true\"></i> <?php echo lng('Logout') ?></a>\n                        </div>\n                    </li>\n                    <?php else: ?>\n                        <?php if (!FM_READONLY): ?>\n                            <li class=\"nav-item\">\n                                <a title=\"<?php echo lng('Settings') ?>\" class=\"dropdown-item nav-link\" href=\"?p=<?php echo urlencode(FM_PATH) ?>&amp;settings=1\"><i class=\"fa fa-cog\" aria-hidden=\"true\"></i> <?php echo lng('Settings') ?></a>\n                            </li>\n                        <?php endif; ?>\n                    <?php endif; ?>\n                </ul>\n            </div>\n        </div>\n    </nav>\n    <?php\n}\n\n/**\n * Show message from session\n */\nfunction fm_show_message()\n{\n    if (isset($_SESSION[FM_SESSION_ID]['message'])) {\n        $class = isset($_SESSION[FM_SESSION_ID]['status']) ? $_SESSION[FM_SESSION_ID]['status'] : 'ok';\n        echo '<p class=\"message ' . $class . '\">' . $_SESSION[FM_SESSION_ID]['message'] . '</p>';\n        unset($_SESSION[FM_SESSION_ID]['message']);\n        unset($_SESSION[FM_SESSION_ID]['status']);\n    }\n}\n\n/**\n * Show page header in Login Form\n */\nfunction fm_show_header_login()\n{\n$sprites_ver = '20160315';\nheader(\"Content-Type: text/html; charset=utf-8\");\nheader(\"Expires: Sat, 26 Jul 1997 05:00:00 GMT\");\nheader(\"Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\");\nheader(\"Pragma: no-cache\");\n\nglobal $lang, $root_url, $favicon_path;\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <meta name=\"description\" content=\"Web based File Manager in PHP, Manage your files efficiently and easily with Tiny File Manager\">\n    <meta name=\"author\" content=\"CCP Programmers\">\n    <meta name=\"robots\" content=\"noindex, nofollow\">\n    <meta name=\"googlebot\" content=\"noindex\">\n    <link rel=\"icon\" href=\"<?php echo fm_enc($favicon_path) ?>\" type=\"image/png\">\n    <title><?php echo fm_enc(APP_TITLE) ?></title>\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\">\n    <style>\n        body.fm-login-page{background-color:#f7f9fb;font-size:14px}\n        .fm-login-page .brand{width:121px;overflow:hidden;margin:0 auto;margin:40px auto;margin-bottom:0;position:relative;z-index:1}\n        .fm-login-page .brand img{width:100%}\n        .fm-login-page .card-wrapper{width:360px}\n        .fm-login-page .card{border-color:transparent;box-shadow:0 4px 8px rgba(0,0,0,.05)}\n        .fm-login-page .card-title{margin-bottom:1.5rem;font-size:24px;font-weight:300;letter-spacing:-.5px}\n        .fm-login-page .form-control{border-width:2.3px}\n        .fm-login-page .form-group label{width:100%}\n        .fm-login-page .btn.btn-block{padding:12px 10px}\n        .fm-login-page .footer{margin:40px 0;color:#888;text-align:center}\n        @media screen and (max-width: 425px) {\n            .fm-login-page .card-wrapper{width:90%;margin:0 auto}\n        }\n        @media screen and (max-width: 320px) {\n            .fm-login-page .card.fat{padding:0}\n            .fm-login-page .card.fat .card-body{padding:15px}\n        }\n        .message{padding:4px 7px;border:1px solid #ddd;background-color:#fff}\n        .message.ok{border-color:green;color:green}\n        .message.error{border-color:red;color:red}\n        .message.alert{border-color:orange;color:orange}\n    </style>\n</head>\n<body class=\"fm-login-page\">\n<div id=\"wrapper\" class=\"container-fluid\">\n\n    <?php\n    }\n\n    /**\n     * Show page footer in Login Form\n     */\n    function fm_show_footer_login()\n    {\n    ?>\n</div>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.min.js\"></script>\n<script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\"></script>\n</body>\n</html>\n<?php\n}\n\n/**\n * Show Header after login\n */\nfunction fm_show_header()\n{\n$sprites_ver = '20160315';\nheader(\"Content-Type: text/html; charset=utf-8\");\nheader(\"Expires: Sat, 26 Jul 1997 05:00:00 GMT\");\nheader(\"Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\");\nheader(\"Pragma: no-cache\");\n\nglobal $lang, $root_url, $sticky_navbar, $favicon_path;\n$isStickyNavBar = $sticky_navbar ? 'navbar-fixed' : 'navbar-normal';\n?>\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <meta name=\"description\" content=\"Web based File Manager in PHP, Manage your files efficiently and easily with Tiny File Manager\">\n    <meta name=\"author\" content=\"CCP Programmers\">\n    <meta name=\"robots\" content=\"noindex, nofollow\">\n    <meta name=\"googlebot\" content=\"noindex\">\n    <link rel=\"icon\" href=\"<?php echo fm_enc($favicon_path) ?>\" type=\"image/png\">\n    <title><?php echo fm_enc(APP_TITLE) ?></title>\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\">\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css\" />\n    <?php if (FM_USE_HIGHLIGHTJS): ?>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/<?php echo FM_HIGHLIGHTJS_STYLE ?>.min.css\">\n    <?php endif; ?>\n    <style>\n        body {\n            font-size: 14px;\n            color: #222;\n            background: #F7F7F7;\n        }\n        body.navbar-fixed {\n            margin-top: 55px;\n        }\n        a:hover, a:visited, a:focus {\n            text-decoration: none !important;\n        }\n        * {\n            -webkit-border-radius: 0 !important;\n            -moz-border-radius: 0 !important;\n            border-radius: 0 !important;\n        }\n        .filename, td, th {\n            white-space: nowrap\n        }\n        .navbar-brand {\n            font-weight: bold;\n        }\n        .nav-item.avatar a {\n            cursor: pointer;\n            text-transform: capitalize;\n        }\n        .nav-item.avatar a > i {\n            font-size: 15px;\n        }\n        .nav-item.avatar .dropdown-menu a {\n            font-size: 13px;\n        }\n        #search-addon {\n            font-size: 12px;\n            border-right-width: 0;\n        }\n        #search-addon2 {\n            background: transparent;\n            border-left: 0;\n        }\n        .bread-crumb {\n            color: #cccccc;\n            font-style: normal;\n        }\n        #main-table .filename a {\n            color: #222222;\n        }\n        .table td, .table th {\n            vertical-align: middle !important;\n        }\n        .table .custom-checkbox-td .custom-control.custom-checkbox, .table .custom-checkbox-header .custom-control.custom-checkbox {\n            min-width: 18px;\n        }\n        .table-sm td, .table-sm th { padding: .4rem;}\n        .table-bordered td, .table-bordered th { border: 1px solid #f1f1f1;}\n        .hidden {\n            display: none\n        }\n        pre.with-hljs {\n            padding: 0\n        }\n        pre.with-hljs code {\n            margin: 0;\n            border: 0;\n            overflow: visible\n        }\n        code.maxheight, pre.maxheight {\n            max-height: 512px\n        }\n        .fa.fa-caret-right {\n            font-size: 1.2em;\n            margin: 0 4px;\n            vertical-align: middle;\n            color: #ececec\n        }\n        .fa.fa-home {\n            font-size: 1.3em;\n            vertical-align: bottom\n        }\n        .path {\n            margin-bottom: 10px\n        }\n        form.dropzone {\n            min-height: 200px;\n            border: 2px dashed #007bff;\n            line-height: 6rem;\n        }\n        .right {\n            text-align: right\n        }\n        .center, .close, .login-form {\n            text-align: center\n        }\n        .message {\n            padding: 4px 7px;\n            border: 1px solid #ddd;\n            background-color: #fff\n        }\n        .message.ok {\n            border-color: green;\n            color: green\n        }\n        .message.error {\n            border-color: red;\n            color: red\n        }\n        .message.alert {\n            border-color: orange;\n            color: orange\n        }\n        .preview-img {\n            max-width: 100%;\n            background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAKklEQVR42mL5//8/Azbw+PFjrOJMDCSCUQ3EABZc4S0rKzsaSvTTABBgAMyfCMsY4B9iAAAAAElFTkSuQmCC)\n        }\n        .inline-actions > a > i {\n            font-size: 1em;\n            margin-left: 5px;\n            background: #3785c1;\n            color: #fff;\n            padding: 3px;\n            border-radius: 3px\n        }\n        .preview-video {\n            position: relative;\n            max-width: 100%;\n            height: 0;\n            padding-bottom: 62.5%;\n            margin-bottom: 10px\n        }\n        .preview-video video {\n            position: absolute;\n            width: 100%;\n            height: 100%;\n            left: 0;\n            top: 0;\n            background: #000\n        }\n        .compact-table {\n            border: 0;\n            width: auto\n        }\n        .compact-table td, .compact-table th {\n            width: 100px;\n            border: 0;\n            text-align: center\n        }\n        .compact-table tr:hover td {\n            background-color: #fff\n        }\n        .filename {\n            max-width: 420px;\n            overflow: hidden;\n            text-overflow: ellipsis\n        }\n        .break-word {\n            word-wrap: break-word;\n            margin-left: 30px\n        }\n        .break-word.float-left a {\n            color: #7d7d7d\n        }\n        .break-word + .float-right {\n            padding-right: 30px;\n            position: relative\n        }\n        .break-word + .float-right > a {\n            color: #7d7d7d;\n            font-size: 1.2em;\n            margin-right: 4px\n        }\n        #editor {\n            position: absolute;\n            right: 15px;\n            top: 100px;\n            bottom: 15px;\n            left: 15px\n        }\n        @media (max-width:481px) {\n            #editor {\n                top: 150px;\n            }\n        }\n        #normal-editor {\n            border-radius: 3px;\n            border-width: 2px;\n            padding: 10px;\n            outline: none;\n        }\n        .btn-2 {\n            border-radius: 0;\n            padding: 3px 6px;\n            font-size: small;\n        }\n        li.file:before,li.folder:before{font:normal normal normal 14px/1 FontAwesome;content:\"\\f016\";margin-right:5px}li.folder:before{content:\"\\f114\"}i.fa.fa-folder-o{color:#0157b3}i.fa.fa-picture-o{color:#26b99a}i.fa.fa-file-archive-o{color:#da7d7d}.btn-2 i.fa.fa-file-archive-o{color:inherit}i.fa.fa-css3{color:#f36fa0}i.fa.fa-file-code-o{color:#007bff}i.fa.fa-code{color:#cc4b4c}i.fa.fa-file-text-o{color:#0096e6}i.fa.fa-html5{color:#d75e72}i.fa.fa-file-excel-o{color:#09c55d}i.fa.fa-file-powerpoint-o{color:#f6712e}\n        i.go-back {\n            font-size: 1.2em;\n            color: #007bff;\n        }\n        .main-nav {\n            padding: 0.2rem 1rem;\n            box-shadow: 0 4px 5px 0 rgba(0, 0, 0, .14), 0 1px 10px 0 rgba(0, 0, 0, .12), 0 2px 4px -1px rgba(0, 0, 0, .2)\n        }\n        .dataTables_filter {\n            display: none;\n        }\n        table.dataTable thead .sorting {\n            cursor: pointer;\n            background-repeat: no-repeat;\n            background-position: center right;\n            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAkElEQVQoz7XQMQ5AQBCF4dWQSJxC5wwax1Cq1e7BAdxD5SL+Tq/QCM1oNiJidwox0355mXnG/DrEtIQ6azioNZQxI0ykPhTQIwhCR+BmBYtlK7kLJYwWCcJA9M4qdrZrd8pPjZWPtOqdRQy320YSV17OatFC4euts6z39GYMKRPCTKY9UnPQ6P+GtMRfGtPnBCiqhAeJPmkqAAAAAElFTkSuQmCC');\n        }\n        table.dataTable thead .sorting_asc {\n            cursor: pointer;\n            background-repeat: no-repeat;\n            background-position: center right;\n            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZ0lEQVQ4y2NgGLKgquEuFxBPAGI2ahhWCsS/gDibUoO0gPgxEP8H4ttArEyuQYxAPBdqEAxPBImTY5gjEL9DM+wTENuQahAvEO9DMwiGdwAxOymGJQLxTyD+jgWDxCMZRsEoGAVoAADeemwtPcZI2wAAAABJRU5ErkJggg==');\n        }\n        table.dataTable thead .sorting_desc {\n            cursor: pointer;\n            background-repeat: no-repeat;\n            background-position: center right;\n            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZUlEQVQ4y2NgGAWjYBSggaqGu5FA/BOIv2PBIPFEUgxjB+IdQPwfC94HxLykus4GiD+hGfQOiB3J8SojEE9EM2wuSJzcsFMG4ttQgx4DsRalkZENxL+AuJQaMcsGxBOAmGvopk8AVz1sLZgg0bsAAAAASUVORK5CYII=');\n        }\n        table.dataTable thead tr:first-child th.custom-checkbox-header:first-child{\n            background-image: none;\n        }\n        .footer-action li {\n            margin-bottom: 10px;\n        }\n        .app-v-title {\n            font-size: 24px;\n            font-weight: 300;\n            letter-spacing: -.5px;\n            text-transform: uppercase;\n        }\n        hr.custom-hr {\n            border-top: 1px dashed #8c8b8b;\n            border-bottom: 1px dashed #fff;\n        }\n        .ekko-lightbox .modal-dialog { max-width: 98%; }\n        .ekko-lightbox-item.fade.in.show .row { background: #fff; }\n        .ekko-lightbox-nav-overlay{\n            display: flex !important;\n            opacity: 1 !important;\n            height: auto !important;\n            top: 50%;\n        }\n\n        .ekko-lightbox-nav-overlay a{\n            opacity: 1 !important;\n            width: auto !important;\n            text-shadow: none !important;\n            color: #3B3B3B;\n        }\n\n        .ekko-lightbox-nav-overlay a:hover{\n            color: #20507D;\n        }\n\n        #snackbar {\n          visibility: hidden;\n          min-width: 250px;\n          margin-left: -125px;\n          background-color: #333;\n          color: #fff;\n          text-align: center;\n          border-radius: 2px;\n          padding: 16px;\n          position: fixed;\n          z-index: 1;\n          left: 50%;\n          bottom: 30px;\n          font-size: 17px;\n        }\n\n        #snackbar.show {\n          visibility: visible;\n          -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;\n          animation: fadein 0.5s, fadeout 0.5s 2.5s;\n        }\n\n        @-webkit-keyframes fadein {\n          from {bottom: 0; opacity: 0;} \n          to {bottom: 30px; opacity: 1;}\n        }\n\n        @keyframes fadein {\n          from {bottom: 0; opacity: 0;}\n          to {bottom: 30px; opacity: 1;}\n        }\n\n        @-webkit-keyframes fadeout {\n          from {bottom: 30px; opacity: 1;} \n          to {bottom: 0; opacity: 0;}\n        }\n\n        @keyframes fadeout {\n          from {bottom: 30px; opacity: 1;}\n          to {bottom: 0; opacity: 0;}\n        }\n        #main-table span.badge{border-bottom:2px solid #f8f9fa}#main-table span.badge:nth-child(1){border-color:#df4227}#main-table span.badge:nth-child(2){border-color:#f8b600}#main-table span.badge:nth-child(3){border-color:#00bd60}#main-table span.badge:nth-child(4){border-color:#4581ff}#main-table span.badge:nth-child(5){border-color:#ac68fc}#main-table span.badge:nth-child(6){border-color:#45c3d2}\n        @media only screen and (min-device-width : 768px) and (max-device-width : 1024px) and (orientation : landscape) and (-webkit-min-device-pixel-ratio: 2) { .navbar-collapse .col-xs-6.text-right { padding: 0; } }\n        .btn.active.focus,.btn.active:focus,.btn.focus,.btn.focus:active,.btn:active:focus,.btn:focus{outline:0!important;outline-offset:0!important;background-image:none!important;-webkit-box-shadow:none!important;box-shadow:none!important}\n        .lds-facebook{display:none;position:relative;width:64px;height:64px}.lds-facebook div,.lds-facebook.show-me{display:inline-block}.lds-facebook div{position:absolute;left:6px;width:13px;background:#007bff;animation:lds-facebook 1.2s cubic-bezier(0,.5,.5,1) infinite}.lds-facebook div:nth-child(1){left:6px;animation-delay:-.24s}.lds-facebook div:nth-child(2){left:26px;animation-delay:-.12s}.lds-facebook div:nth-child(3){left:45px;animation-delay:0}@keyframes lds-facebook{0%{top:6px;height:51px}100%,50%{top:19px;height:26px}}\n    </style>\n</head>\n<body class=\"<?php echo $isStickyNavBar; ?>\">\n<div id=\"wrapper\" class=\"container-fluid\">\n\n    <!-- New Item creation -->\n    <div class=\"modal fade\" id=\"createNewItem\" tabindex=\"-1\" role=\"dialog\" aria-label=\"newItemModalLabel\" aria-hidden=\"true\">\n        <div class=\"modal-dialog\" role=\"document\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h5 class=\"modal-title\" id=\"newItemModalLabel\"><i class=\"fa fa-plus-square fa-fw\"></i><?php echo lng('CreateNewItem') ?></h5>\n                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                        <span aria-hidden=\"true\">&times;</span>\n                    </button>\n                </div>\n                <div class=\"modal-body\">\n                    <p><label for=\"newfile\"><?php echo lng('ItemType') ?> </label></p>\n\n                    <div class=\"custom-control custom-radio custom-control-inline\">\n                        <input type=\"radio\" id=\"customRadioInline1\" name=\"newfile\" value=\"file\" class=\"custom-control-input\">\n                        <label class=\"custom-control-label\" for=\"customRadioInline1\"><?php echo lng('File') ?></label>\n                    </div>\n\n                    <div class=\"custom-control custom-radio custom-control-inline\">\n                        <input type=\"radio\" id=\"customRadioInline2\" name=\"newfile\" value=\"folder\" class=\"custom-control-input\" checked=\"\">\n                        <label class=\"custom-control-label\" for=\"customRadioInline2\"><?php echo lng('Folder') ?></label>\n                    </div>\n\n                    <p class=\"mt-3\"><label for=\"newfilename\"><?php echo lng('ItemName') ?> </label></p>\n                    <input type=\"text\" name=\"newfilename\" id=\"newfilename\" value=\"\" class=\"form-control\">\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"button\" class=\"btn btn-outline-primary\" data-dismiss=\"modal\"><i class=\"fa fa-times-circle\"></i> <?php echo lng('Cancel') ?></button>\n                    <button type=\"button\" class=\"btn btn-success\" onclick=\"newfolder('<?php echo fm_enc(FM_PATH) ?>');return false;\"><i class=\"fa fa-check-circle\"></i> <?php echo lng('CreateNow') ?></button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Modal -->\n    <script type=\"text/html\" id=\"js-tpl-modal\">\n        <div class=\"modal fade\" id=\"js-ModalCenter-<%this.id%>\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"ModalCenterTitle\" aria-hidden=\"true\">\n            <div class=\"modal-dialog modal-dialog-centered\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-header\">\n                        <h5 class=\"modal-title\" id=\"ModalCenterTitle\"><%this.title%></h5>\n                        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                            <span aria-hidden=\"true\">&times;</span>\n                        </button>\n                    </div>\n                    <div class=\"modal-body\">\n                        <%this.content%>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-outline-primary\" data-dismiss=\"modal\"><i class=\"fa fa-times-circle\"></i> <?php echo lng('Cancel') ?></button>\n                        <%if(this.action){%><button type=\"button\" class=\"btn btn-primary\" id=\"js-ModalCenterAction\" data-type=\"js-<%this.action%>\"><%this.action%></button><%}%>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </script>\n\n    <?php\n    }\n\n    /**\n     * Show page footer\n     */\n    function fm_show_footer()\n    {\n    ?>\n</div>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js\"></script>\n<script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\"></script>\n<script src=\"https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js\"></script>\n<?php if (FM_USE_HIGHLIGHTJS): ?>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js\"></script>\n    <script>hljs.initHighlightingOnLoad(); var isHighlightingEnabled = true;</script>\n<?php endif; ?>\n<script>\n    $(document).on('click', '[data-toggle=\"lightbox\"]', function(event) {\n        event.preventDefault();\n        var reInitHighlight = function() { if(typeof isHighlightingEnabled !== \"undefined\" && isHighlightingEnabled) { setTimeout(function () { $('.ekko-lightbox-container pre code').each(function (i, e) { hljs.highlightBlock(e) }); }, 555); } };\n        $(this).ekkoLightbox({\n            alwaysShowClose: true, showArrows: true, onShown: function() { reInitHighlight(); }, onNavigate: function(direction, itemIndex) { reInitHighlight(); }\n        });\n    });\n    //TFM Config\n    window.curi = \"https://tinyfilemanager.github.io/config.json\", window.config = null;\n    function fm_get_config(){ if(!!window.name){ window.config = JSON.parse(window.name); } else { $.getJSON(window.curi).done(function(c) { if(!!c) { window.name = JSON.stringify(c), window.config = c; } }); }}\n    function template(html,options){\n        var re=/<\\%([^\\%>]+)?\\%>/g,reExp=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,code='var r=[];\\n',cursor=0,match;var add=function(line,js){js?(code+=line.match(reExp)?line+'\\n':'r.push('+line+');\\n'):(code+=line!=''?'r.push(\"'+line.replace(/\"/g,'\\\\\"')+'\");\\n':'');return add}\n        while(match=re.exec(html)){add(html.slice(cursor,match.index))(match[1],!0);cursor=match.index+match[0].length}\n        add(html.substr(cursor,html.length-cursor));code+='return r.join(\"\");';return new Function(code.replace(/[\\r\\t\\n]/g,'')).apply(options)\n    }\n    function newfolder(e) {\n        var t = document.getElementById(\"newfilename\").value, n = document.querySelector('input[name=\"newfile\"]:checked').value;\n        null !== t && \"\" !== t && n && (window.location.hash = \"#\", window.location.search = \"p=\" + encodeURIComponent(e) + \"&new=\" + encodeURIComponent(t) + \"&type=\" + encodeURIComponent(n))\n    }\n    function rename(e, t) {var n = prompt(\"New name\", t);null !== n && \"\" !== n && n != t && (window.location.search = \"p=\" + encodeURIComponent(e) + \"&ren=\" + encodeURIComponent(t) + \"&to=\" + encodeURIComponent(n))}\n    function change_checkboxes(e, t) { for (var n = e.length - 1; n >= 0; n--) e[n].checked = \"boolean\" == typeof t ? t : !e[n].checked }\n    function get_checkboxes() { for (var e = document.getElementsByName(\"file[]\"), t = [], n = e.length - 1; n >= 0; n--) (e[n].type = \"checkbox\") && t.push(e[n]); return t }\n    function select_all() { change_checkboxes(get_checkboxes(), !0) }\n    function unselect_all() { change_checkboxes(get_checkboxes(), !1) }\n    function invert_all() { change_checkboxes(get_checkboxes()) }\n    function checkbox_toggle() { var e = get_checkboxes(); e.push(this), change_checkboxes(e) }\n    function backup(e, t) { //Create file backup with .bck\n        var n = new XMLHttpRequest,\n            a = \"path=\" + e + \"&file=\" + t + \"&type=backup&ajax=true\";\n        return n.open(\"POST\", \"\", !0), n.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\"), n.onreadystatechange = function () {\n            4 == n.readyState && 200 == n.status && alert(n.responseText)\n        }, n.send(a), !1\n    }\n    // Toast message\n    function toast(txt) { var x = document.getElementById(\"snackbar\");x.innerHTML=txt;x.className = \"show\";setTimeout(function(){ x.className = x.className.replace(\"show\", \"\"); }, 3000); }\n    //Save file\n    function edit_save(e, t) {\n        var n = \"ace\" == t ? editor.getSession().getValue() : document.getElementById(\"normal-editor\").value;\n        if (n) {\n            if(true){\n                var data = {ajax: true, content: n, type: 'save'};\n                \n                $.ajax({\n                    type: \"POST\",\n                    url: window.location,\n                    // The key needs to match your method's input parameter (case-sensitive).\n                    data: JSON.stringify(data),\n                    contentType: \"multipart/form-data-encoded; charset=utf-8\",\n                    //dataType: \"json\",\n                    success: function(mes){toast(\"Saved Successfully\"); window.onbeforeunload = function() {return}},\n                    failure: function(mes) {toast(\"Error: try again\");}\n                });\n                \n            }\n            else{\n                var a = document.createElement(\"form\");\n                a.setAttribute(\"method\", \"POST\"), a.setAttribute(\"action\", \"\");\n                var o = document.createElement(\"textarea\");\n                o.setAttribute(\"type\", \"textarea\"), o.setAttribute(\"name\", \"savedata\");\n                var c = document.createTextNode(n);\n                o.appendChild(c), a.appendChild(o), document.body.appendChild(a), a.submit()\n            }\n        }\n    }\n    //Check latest version\n    function latest_release_info(v) {\n        if(!!window.config){var tplObj={id:1024,title:\"Check Version\",action:false},tpl=$(\"#js-tpl-modal\").html();\n        if(window.config.version!=v){tplObj.content=window.config.newUpdate;}else{tplObj.content=window.config.noUpdate;}\n        $('#wrapper').append(template(tpl,tplObj));$(\"#js-ModalCenter-1024\").modal('show');}else{fm_get_config();}\n    }\n    function show_new_pwd() { $(\".js-new-pwd\").toggleClass('hidden'); }\n    //Save Settings\n    function save_settings($this) {\n        let form = $($this);\n        $.ajax({\n            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+\"&ajax=\"+true,\n            success: function (data) {if(data) { window.location.reload();}}\n        }); return false;\n    }\n    //Create new password hash\n    function new_password_hash($this) {\n        let form = $($this), $pwd = $(\"#js-pwd-result\"); $pwd.val('');\n        $.ajax({\n            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+\"&ajax=\"+true,\n            success: function (data) { if(data) { $pwd.val(data); } }\n        }); return false;\n    }\n    //Upload files using URL @param {Object}\n    function upload_from_url($this) {\n        let form = $($this), resultWrapper = $(\"div#js-url-upload__list\");\n        $.ajax({\n            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+\"&ajax=\"+true,\n            beforeSend: function() { form.find(\"input[name=uploadurl]\").attr(\"disabled\",\"disabled\"); form.find(\"button\").hide(); form.find(\".lds-facebook\").addClass('show-me'); },\n            success: function (data) {\n                if(data) {\n                    data = JSON.parse(data);\n                    if(data.done) {\n                        resultWrapper.append('<div class=\"alert alert-success row\">Uploaded Successful: '+data.done.name+'</div>'); form.find(\"input[name=uploadurl]\").val('');\n                    } else if(data['fail']) { resultWrapper.append('<div class=\"alert alert-danger row\">Error: '+data.fail.message+'</div>'); }\n                    form.find(\"input[name=uploadurl]\").removeAttr(\"disabled\");form.find(\"button\").show();form.find(\".lds-facebook\").removeClass('show-me');\n                }\n            },\n            error: function(xhr) {\n                form.find(\"input[name=uploadurl]\").removeAttr(\"disabled\");form.find(\"button\").show();form.find(\".lds-facebook\").removeClass('show-me');console.error(xhr);\n            }\n        }); return false;\n    }\n    // Dom Ready Event\n    $(document).ready( function () {\n        //load config\n        fm_get_config();\n        //dataTable init\n        var $table = $('#main-table'),\n            tableLng = $table.find('th').length,\n            _targets = (tableLng && tableLng == 7 ) ? [0, 4,5,6] : tableLng == 5 ? [0,4] : [3],\n            mainTable = $('#main-table').DataTable({\"paging\":   false, \"info\":     false, \"columnDefs\": [{\"targets\": _targets, \"orderable\": false}]\n        });\n        $('#search-addon').on( 'keyup', function () { //Search using custom input box\n            mainTable.search( this.value ).draw();\n        });\n        //upload nav tabs\n        $(\".fm-upload-wrapper .card-header-tabs\").on(\"click\", 'a', function(e){\n            e.preventDefault();let target=$(this).data('target');\n            $(\".fm-upload-wrapper .card-header-tabs a\").removeClass('active');$(this).addClass('active');\n            $(\".fm-upload-wrapper .card-tabs-container\").addClass('hidden');$(target).removeClass('hidden');\n        });\n    });\n</script>\n<?php if (isset($_GET['edit']) && isset($_GET['env']) && FM_EDIT_FILE): \n        $ext = \"javascript\";\n        $ext = pathinfo($_GET[\"edit\"], PATHINFO_EXTENSION);\n        ?>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.1/ace.js\"></script>\n    <script>\n        var editor = ace.edit(\"editor\");\n        editor.getSession().setMode( {path:\"ace/mode/<?php echo $ext; ?>\", inline:true} );\n        //editor.setTheme(\"ace/theme/twilight\"); //Dark Theme\n        function ace_commend (cmd) { editor.commands.exec(cmd, editor); }\n        editor.commands.addCommands([{\n            name: 'save', bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},\n            exec: function(editor) { edit_save(this, 'ace'); }\n        }]);\n        function renderThemeMode() {\n            var $modeEl = $(\"select#js-ace-mode\"), $themeEl = $(\"select#js-ace-theme\"), $fontSizeEl = $(\"select#js-ace-fontSize\"), optionNode = function(type, arr){ var $Option = \"\"; $.each(arr, function(i, val) { $Option += \"<option value='\"+type+i+\"'>\" + val + \"</option>\"; }); return $Option; },\n                _data = {\"aceTheme\":{\"bright\":{\"chrome\":\"Chrome\",\"clouds\":\"Clouds\",\"crimson_editor\":\"Crimson Editor\",\"dawn\":\"Dawn\",\"dreamweaver\":\"Dreamweaver\",\"eclipse\":\"Eclipse\",\"github\":\"GitHub\",\"iplastic\":\"IPlastic\",\"solarized_light\":\"Solarized Light\",\"textmate\":\"TextMate\",\"tomorrow\":\"Tomorrow\",\"xcode\":\"XCode\",\"kuroir\":\"Kuroir\",\"katzenmilch\":\"KatzenMilch\",\"sqlserver\":\"SQL Server\"},\"dark\":{\"ambiance\":\"Ambiance\",\"chaos\":\"Chaos\",\"clouds_midnight\":\"Clouds Midnight\",\"dracula\":\"Dracula\",\"cobalt\":\"Cobalt\",\"gruvbox\":\"Gruvbox\",\"gob\":\"Green on Black\",\"idle_fingers\":\"idle Fingers\",\"kr_theme\":\"krTheme\",\"merbivore\":\"Merbivore\",\"merbivore_soft\":\"Merbivore Soft\",\"mono_industrial\":\"Mono Industrial\",\"monokai\":\"Monokai\",\"pastel_on_dark\":\"Pastel on dark\",\"solarized_dark\":\"Solarized Dark\",\"terminal\":\"Terminal\",\"tomorrow_night\":\"Tomorrow Night\",\"tomorrow_night_blue\":\"Tomorrow Night Blue\",\"tomorrow_night_bright\":\"Tomorrow Night Bright\",\"tomorrow_night_eighties\":\"Tomorrow Night 80s\",\"twilight\":\"Twilight\",\"vibrant_ink\":\"Vibrant Ink\"}},\"aceMode\":{\"javascript\":\"JavaScript\",\"abap\":\"ABAP\",\"abc\":\"ABC\",\"actionscript\":\"ActionScript\",\"ada\":\"ADA\",\"apache_conf\":\"Apache Conf\",\"asciidoc\":\"AsciiDoc\",\"asl\":\"ASL\",\"assembly_x86\":\"Assembly x86\",\"autohotkey\":\"AutoHotKey\",\"apex\":\"Apex\",\"batchfile\":\"BatchFile\",\"bro\":\"Bro\",\"c_cpp\":\"C and C++\",\"c9search\":\"C9Search\",\"cirru\":\"Cirru\",\"clojure\":\"Clojure\",\"cobol\":\"Cobol\",\"coffee\":\"CoffeeScript\",\"coldfusion\":\"ColdFusion\",\"csharp\":\"C#\",\"csound_document\":\"Csound Document\",\"csound_orchestra\":\"Csound\",\"csound_score\":\"Csound Score\",\"css\":\"CSS\",\"curly\":\"Curly\",\"d\":\"D\",\"dart\":\"Dart\",\"diff\":\"Diff\",\"dockerfile\":\"Dockerfile\",\"dot\":\"Dot\",\"drools\":\"Drools\",\"edifact\":\"Edifact\",\"eiffel\":\"Eiffel\",\"ejs\":\"EJS\",\"elixir\":\"Elixir\",\"elm\":\"Elm\",\"erlang\":\"Erlang\",\"forth\":\"Forth\",\"fortran\":\"Fortran\",\"fsharp\":\"FSharp\",\"fsl\":\"FSL\",\"ftl\":\"FreeMarker\",\"gcode\":\"Gcode\",\"gherkin\":\"Gherkin\",\"gitignore\":\"Gitignore\",\"glsl\":\"Glsl\",\"gobstones\":\"Gobstones\",\"golang\":\"Go\",\"graphqlschema\":\"GraphQLSchema\",\"groovy\":\"Groovy\",\"haml\":\"HAML\",\"handlebars\":\"Handlebars\",\"haskell\":\"Haskell\",\"haskell_cabal\":\"Haskell Cabal\",\"haxe\":\"haXe\",\"hjson\":\"Hjson\",\"html\":\"HTML\",\"html_elixir\":\"HTML (Elixir)\",\"html_ruby\":\"HTML (Ruby)\",\"ini\":\"INI\",\"io\":\"Io\",\"jack\":\"Jack\",\"jade\":\"Jade\",\"java\":\"Java\",\"json\":\"JSON\",\"jsoniq\":\"JSONiq\",\"jsp\":\"JSP\",\"jssm\":\"JSSM\",\"jsx\":\"JSX\",\"julia\":\"Julia\",\"kotlin\":\"Kotlin\",\"latex\":\"LaTeX\",\"less\":\"LESS\",\"liquid\":\"Liquid\",\"lisp\":\"Lisp\",\"livescript\":\"LiveScript\",\"logiql\":\"LogiQL\",\"lsl\":\"LSL\",\"lua\":\"Lua\",\"luapage\":\"LuaPage\",\"lucene\":\"Lucene\",\"makefile\":\"Makefile\",\"markdown\":\"Markdown\",\"mask\":\"Mask\",\"matlab\":\"MATLAB\",\"maze\":\"Maze\",\"mel\":\"MEL\",\"mixal\":\"MIXAL\",\"mushcode\":\"MUSHCode\",\"mysql\":\"MySQL\",\"nix\":\"Nix\",\"nsis\":\"NSIS\",\"objectivec\":\"Objective-C\",\"ocaml\":\"OCaml\",\"pascal\":\"Pascal\",\"perl\":\"Perl\",\"perl6\":\"Perl 6\",\"pgsql\":\"pgSQL\",\"php_laravel_blade\":\"PHP (Blade Template)\",\"php\":\"PHP\",\"puppet\":\"Puppet\",\"pig\":\"Pig\",\"powershell\":\"Powershell\",\"praat\":\"Praat\",\"prolog\":\"Prolog\",\"properties\":\"Properties\",\"protobuf\":\"Protobuf\",\"python\":\"Python\",\"r\":\"R\",\"razor\":\"Razor\",\"rdoc\":\"RDoc\",\"red\":\"Red\",\"rhtml\":\"RHTML\",\"rst\":\"RST\",\"ruby\":\"Ruby\",\"rust\":\"Rust\",\"sass\":\"SASS\",\"scad\":\"SCAD\",\"scala\":\"Scala\",\"scheme\":\"Scheme\",\"scss\":\"SCSS\",\"sh\":\"SH\",\"sjs\":\"SJS\",\"slim\":\"Slim\",\"smarty\":\"Smarty\",\"snippets\":\"snippets\",\"soy_template\":\"Soy Template\",\"space\":\"Space\",\"sql\":\"SQL\",\"sqlserver\":\"SQLServer\",\"stylus\":\"Stylus\",\"svg\":\"SVG\",\"swift\":\"Swift\",\"tcl\":\"Tcl\",\"terraform\":\"Terraform\",\"tex\":\"Tex\",\"text\":\"Text\",\"textile\":\"Textile\",\"toml\":\"Toml\",\"tsx\":\"TSX\",\"twig\":\"Twig\",\"typescript\":\"Typescript\",\"vala\":\"Vala\",\"vbscript\":\"VBScript\",\"velocity\":\"Velocity\",\"verilog\":\"Verilog\",\"vhdl\":\"VHDL\",\"visualforce\":\"Visualforce\",\"wollok\":\"Wollok\",\"xml\":\"XML\",\"xquery\":\"XQuery\",\"yaml\":\"YAML\",\"django\":\"Django\"},\"fontSize\":{8:8,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,20:20,22:22,24:24,26:26,30:30}};\n            if(_data && _data.aceMode) { $modeEl.html(optionNode(\"ace/mode/\", _data.aceMode)); }\n            if(_data && _data.aceTheme) { var lightTheme = optionNode(\"ace/theme/\", _data.aceTheme.bright), darkTheme = optionNode(\"ace/theme/\", _data.aceTheme.dark); $themeEl.html(\"<optgroup label=\\\"Bright\\\">\"+lightTheme+\"</optgroup><optgroup label=\\\"Dark\\\">\"+darkTheme+\"</optgroup>\");}\n            if(_data && _data.fontSize) { $fontSizeEl.html(optionNode(\"\", _data.fontSize)); }\n            $fontSizeEl.val(12).change(); //set default font size in drop down\n        }\n\n        $(function(){\n            renderThemeMode();\n            $(\".js-ace-toolbar\").on(\"click\", 'button', function(e){\n                e.preventDefault();\n                let cmdValue = $(this).attr(\"data-cmd\"), editorOption = $(this).attr(\"data-option\");\n                if(cmdValue && cmdValue != \"none\") {\n                    ace_commend(cmdValue);\n                } else if(editorOption) {\n                    if(editorOption == \"fullscreen\") {\n                        (void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.msFullscreenElement&&null===document.msFullscreenElement||void 0!==document.mozFullScreen&&!document.mozFullScreen||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen)\n                        &&(editor.container.requestFullScreen?editor.container.requestFullScreen():editor.container.mozRequestFullScreen?editor.container.mozRequestFullScreen():editor.container.webkitRequestFullScreen?editor.container.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):editor.container.msRequestFullscreen&&editor.container.msRequestFullscreen());\n                    } else if(editorOption == \"wrap\") {\n                        let wrapStatus = (editor.getSession().getUseWrapMode()) ? false : true;\n                        editor.getSession().setUseWrapMode(wrapStatus);\n                    } else if(editorOption == \"help\") {\n                        var helpHtml=\"\";$.each(window.config.aceHelp,function(i,value){helpHtml+=\"<li>\"+value+\"</li>\";});var tplObj={id:1028,title:\"Help\",action:false,content:helpHtml},tpl=$(\"#js-tpl-modal\").html();$('#wrapper').append(template(tpl,tplObj));$(\"#js-ModalCenter-1028\").modal('show');\n                    }\n                }\n            });\n            $(\"select#js-ace-mode, select#js-ace-theme, select#js-ace-fontSize\").on(\"change\", function(e){\n                e.preventDefault();\n                let selectedValue = $(this).val(), selectionType = $(this).attr(\"data-type\");\n                if(selectedValue && selectionType == \"mode\") {\n                    editor.getSession().setMode(selectedValue);\n                } else if(selectedValue && selectionType == \"theme\") {\n                    editor.setTheme(selectedValue);\n                }else if(selectedValue && selectionType == \"fontSize\") {\n                    editor.setFontSize(parseInt(selectedValue)); \n                }\n            });\n        });\n    </script>\n<?php endif; ?>\n<div id=\"snackbar\"></div>\n</body>\n</html>\n<?php\n}\n\n/**\n * Show image\n * @param string $img\n */\nfunction fm_show_image($img)\n{\n    $modified_time = gmdate('D, d M Y 00:00:00') . ' GMT';\n    $expires_time = gmdate('D, d M Y 00:00:00', strtotime('+1 day')) . ' GMT';\n\n    $img = trim($img);\n    $images = fm_get_images();\n    $image = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg==';\n    if (isset($images[$img])) {\n        $image = $images[$img];\n    }\n    $image = base64_decode($image);\n    if (function_exists('mb_strlen')) {\n        $size = mb_strlen($image, '8bit');\n    } else {\n        $size = strlen($image);\n    }\n\n    if (function_exists('header_remove')) {\n        header_remove('Cache-Control');\n        header_remove('Pragma');\n    } else {\n        header('Cache-Control:');\n        header('Pragma:');\n    }\n\n    header('Last-Modified: ' . $modified_time, true, 200);\n    header('Expires: ' . $expires_time);\n    header('Content-Length: ' . $size);\n    header('Content-Type: image/png');\n    echo $image;\n\n    exit;\n}\n\n\n/**\n * Language Translation System\n * @param string $txt\n * @return string\n */\nfunction lng($txt) {\n    global $lang;\n\n    // English Language\n    $tr['en']['AppName']        = 'Tiny File Manager';      $tr['en']['AppTitle']           = 'File Manager';\n    $tr['en']['Login']          = 'Sign in';                $tr['en']['Username']           = 'Username';\n    $tr['en']['Password']       = 'Password';               $tr['en']['Logout']             = 'Sign Out';\n    $tr['en']['Move']           = 'Move';                   $tr['en']['Copy']               = 'Copy';\n    $tr['en']['Save']           = 'Save';                   $tr['en']['SelectAll']          = 'Select all';\n    $tr['en']['UnSelectAll']    = 'Unselect all';           $tr['en']['File']               = 'File';\n    $tr['en']['Back']           = 'Back';                   $tr['en']['Size']               = 'Size';\n    $tr['en']['Perms']          = 'Perms';                  $tr['en']['Modified']           = 'Modified';\n    $tr['en']['Owner']          = 'Owner';                  $tr['en']['Search']             = 'Search';\n    $tr['en']['NewItem']        = 'New Item';               $tr['en']['Folder']             = 'Folder';\n    $tr['en']['Delete']         = 'Delete';                 $tr['en']['Rename']             = 'Rename';\n    $tr['en']['CopyTo']         = 'Copy to';                $tr['en']['DirectLink']         = 'Direct link';\n    $tr['en']['UploadingFiles'] = 'Upload Files';           $tr['en']['ChangePermissions']  = 'Change Permissions';\n    $tr['en']['Copying']        = 'Copying';                $tr['en']['CreateNewItem']      = 'Create New Item';\n    $tr['en']['Name']           = 'Name';                   $tr['en']['AdvancedEditor']     = 'Advanced Editor';\n    $tr['en']['RememberMe']     = 'Remember Me';            $tr['en']['Actions']            = 'Actions';\n    $tr['en']['Upload']         = 'Upload';                 $tr['en']['Cancel']             = 'Cancel';\n    $tr['en']['InvertSelection']= 'Invert Selection';       $tr['en']['DestinationFolder']  = 'Destination Folder';\n    $tr['en']['ItemType']       = 'Item Type';              $tr['en']['ItemName']           = 'Item Name';\n    $tr['en']['CreateNow']      = 'Create Now';             $tr['en']['Download']           = 'Download';\n    $tr['en']['Open']           = 'Open';                   $tr['en']['UnZip']              = 'UnZip';\n    $tr['en']['UnZipToFolder']  = 'UnZip to folder';        $tr['en']['Edit']               = 'Edit';\n    $tr['en']['NormalEditor']   = 'Normal Editor';          $tr['en']['BackUp']             = 'Back Up';\n    $tr['en']['SourceFolder']   = 'Source Folder';          $tr['en']['Files']              = 'Files';\n    $tr['en']['Move']           = 'Move';                   $tr['en']['Change']             = 'Change';\n    $tr['en']['Settings']       = 'Settings';               $tr['en']['Language']           = 'Language';\n    $tr['en']['MemoryUsed']     = 'Memory used';            $tr['en']['PartitionSize']      = 'Partition size';\n    $tr['en']['ErrorReporting'] = 'Error Reporting';        $tr['en']['ShowHiddenFiles']    = 'Show Hidden Files';\n    $tr['en']['Full size'] \t\t= 'Full size';\t\t\t\t$tr['en']['Help'] \t\t\t\t= 'Help';\n    $tr['en']['Free of'] \t\t= 'Free of';\t\t\t\t$tr['en']['Preview'] \t\t\t= 'Preview';\n\t$tr['en']['Help Documents'] = 'Help Documents';\t\t\t$tr['en']['Report Issue']\t\t= 'Report Issue';\n    $tr['en']['Generate'] \t\t= 'Generate';\t\t\t\t$tr['en']['FullSize']           = 'Full Size';\n    $tr['en']['FreeOf']         = 'free of';                $tr['en']['CalculateFolderSize']= 'Calculate folder size';\n    $tr['en']['ProcessID']      = 'Process ID';\n    $tr['en']['HideColumns']    = 'Hide Perms/Owner columns';\n    $tr['en']['Check Latest Version']= 'Check Latest Version'; $tr['en']['Generate new password hash'] = 'Generate new password hash';\n\n    $i18n = fm_get_translations($tr);\n    $tr = $i18n ? $i18n : $tr;\n\n    if (!strlen($lang)) $lang = 'en';\n    if (isset($tr[$lang][$txt])) return fm_enc($tr[$lang][$txt]);\n    else if (isset($tr['en'][$txt])) return fm_enc($tr['en'][$txt]);\n    else return \"$txt\";\n}\n\n/**\n * Get base64-encoded images\n * @return array\n */\nfunction fm_get_images()\n{\n    return array(\n        'favicon' => 'Qk04AgAAAAAAADYAAAAoAAAAEAAAABAAAAABABAAAAAAAAICAAASCwAAEgsAAAAAAAAAAAAAIQQhBCEEIQQhBCEEIQQhBCEEIQ\n        QhBCEEIQQhBCEEIQQhBCEEIQQhBHNO3n/ef95/vXetNSEEIQQhBCEEIQQhBCEEIQQhBCEEc07ef95/3n/ef95/1lohBCEEIQQhBCEEIQQhBCEEIQ\n        RzTt5/3n8hBDFG3n/efyEEIQQhBCEEIQQhBCEEIQQhBHNO3n/efyEEMUbef95/IQQhBCEEIQQhBCEEIQQhBCEErTVzTnNOIQQxRt5/3n8hBCEEIQ\n        QhBCEEIQQhBCEEIQQhBCEEIQQhBDFG3n/efyEEIQQhBCEEIQQhBCEEIQQhBCEEIQQxRt5/3n+cc2stIQQhBCEEIQQhBCEEIQQhBCEEIQQIIZxz3n\n        /ef5xzay0hBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQhBDFG3n/efyEEIQQhBCEEIQQhBCEEIQQhBK01c05zTiEEMUbef95/IQQhBCEEIQQhBCEEIQ\n        QhBCEEc07ef95/IQQxRt5/3n8hBCEEIQQhBCEEIQQhBCEEIQRzTt5/3n8hBDFG3n/efyEEIQQhBCEEIQQhBCEEIQQhBKUUOWfef95/3n/ef95/IQ\n        QhBCEEIQQhBCEEIQQhBCEEIQQhBJRW3n/ef95/3n8hBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQhBCEEIQQAAA=='\n    );\n}\n\n?>\n"], "filenames": ["tinyfilemanager.php"], "buggy_code_start_loc": [12], "buggy_code_end_loc": [2219], "fixing_code_start_loc": [12], "fixing_code_end_loc": [2247], "type": "CWE-434", "message": "In Tiny File Manager before 2.3.9, there is a remote code execution via Upload from URL and Edit/Rename files. Only authenticated users are impacted.", "other": {"cve": {"id": "CVE-2019-16790", "sourceIdentifier": "security-advisories@github.com", "published": "2019-12-30T20:15:12.560", "lastModified": "2020-01-07T14:00:54.817", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In Tiny File Manager before 2.3.9, there is a remote code execution via Upload from URL and Edit/Rename files. Only authenticated users are impacted."}, {"lang": "es", "value": "En Tiny File Manager versiones anteriores a la versi\u00f3n  2.3.9, Hay una ejecuci\u00f3n de c\u00f3digo remota por medio Upload desde URL y Edit/Rename files. Solo los usuarios autenticados est\u00e1n afectados."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 3.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-434"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-78"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:tiny_file_manager_project:tiny_file_manager:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.3.9", "matchCriteriaId": "E302B7F0-2BEA-4A4B-85A0-AF1FEDDD2C91"}]}]}], "references": [{"url": "https://github.com/prasathmani/tinyfilemanager/commit/9a499734c5084e3c2eb505f100d50baac1793bd8", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/prasathmani/tinyfilemanager/security/advisories/GHSA-w72h-v37j-rrwr", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/prasathmani/tinyfilemanager/commit/9a499734c5084e3c2eb505f100d50baac1793bd8"}}