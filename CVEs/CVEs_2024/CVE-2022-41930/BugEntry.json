{"buggy_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.4\" reference=\"XWiki.XWikiUserProfileSheet\" locale=\"\">\n  <web>XWiki</web>\n  <name>XWikiUserProfileSheet</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.XWikiUserSheet</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title/>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.0</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n#if (\"$!request.userId\" != \"\" &amp;&amp; ($request.action == \"disable\" || $request.action == \"enable\") &amp;&amp; $services.csrf.isTokenValid($request.csrf))\n#set ($user = $xwiki.getUser($request.userId))\n#if ($user.getUser().exists($xcontext.context))\n  #set ($disabled = ($request.action == \"disable\"))\n  #set ($discard = $user.setDisabledStatus($disabled))\n  #set ($success = ($disabled &amp;&amp; $user.isDisabled()) || (!$disabled &amp;&amp; !$user.isDisabled()))\n#else\n  #set ($success = false)\n#end\n#jsonResponse({\n    'success': $success\n  })\n#end\n{{/velocity}}</content>\n  <object>\n    <name>XWiki.XWikiUserProfileSheet</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>bbea39b8-1682-4af2-91fd-8ac0b2b2e9d2</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require(['jquery', 'xwiki-meta'], function ($, xm) {\n  'use strict';\n  $(function() {\n    /**\n     * Save the new user status.\n     */\n    var changeUserStatus = function (action) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.network.saving'))\", 'inprogress');\n      var url = new XWiki.Document(XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService', XWiki.EntityType.DOCUMENT)).getURL('get', 'outputSyntax=plain');\n      $.post(url, {\n        'action': action,\n        'csrf': xm.form_token,\n        'user': XWiki.Model.serialize(xm.documentReference),\n        'target': 'user'\n      }).then(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.network.done'))\", 'done');\n        if (action == 'watchUser') {\n          $('.notificationWatchUserNotFollowing').addClass('hidden');\n          $('.notificationWatchUserFollowing').removeClass('hidden')\n        } else {\n          $('.notificationWatchUserFollowing').addClass('hidden');\n          $('.notificationWatchUserNotFollowing').removeClass('hidden');\n        }\n      }).catch(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.network.error'))\", 'error');\n      });\n    };\n\n    var setUserDisableStatus = function(action) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.status.saving'))\", 'inprogress');\n      var url = new XWiki.Document(XWiki.Model.resolve('XWiki.XWikiUserProfileSheet', XWiki.EntityType.DOCUMENT)).getURL('get', 'outputSyntax=plain');\n      $.post(url, {\n        'action': action,\n        'csrf': xm.form_token,\n        'userId': XWiki.Model.serialize(xm.documentReference)\n      }).then(data =&gt; {\n        notification.hide();\n        if (data.success) {\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.status.done'))\", 'done');\n          if (action == 'disable') {\n            $('#disable').addClass('hidden');\n            $('#enable').removeClass('hidden');\n          } else {\n            $('#disable').removeClass('hidden');\n            $('#enable').addClass('hidden');\n          }\n        } else {\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.status.error'))\", 'error');\n        }\n      }).catch(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.status.error'))\", 'error');\n      });\n    };\n\n    $('#disable').on('click', function(event) {\n      setUserDisableStatus('disable');\n    });\n\n    $('#enable').on('click', function(event) {\n      setUserDisableStatus('enable');\n    });\n\n    /**\n     * DOM events\n     */\n    $('.notificationWatchUserAdd').on('click', function(event) {\n      changeUserStatus('watchUser');\n    });\n    $('.notificationWatchUserRemove').on('click', function(event) {\n      changeUserStatus('unwatchUser');\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>Notifications Watch/Unwatch user</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.XWikiUserProfileSheet</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>69c76935-fbd0-4167-af11-8ad356c88ba9</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#template('colorThemeInit.vm')\n\n.activity-follow {\n  padding-bottom: 10px;\n  margin-bottom: 20px;\n}\n\n.activity-follow .unfollow {\n  background: transparent 0 center url(\"$xwiki.getSkinFile('icons/silk/cross.png')\") no-repeat;\n  color: $theme.notificationErrorColor;\n  display: inline-block;\n  overflow: hidden;\n  font-size: 83.3%;\n  text-indent: 17px;\n  vertical-align: middle;\n  width: 16px;\n}\n.activity-follow .unfollow:hover {\n  overflow: visible;\n  text-decoration: none;\n  width: auto;\n}\n\n.activity-follow .follow, .activity-follow .following {\n  background: $theme.menuAddEntryBackgroundColor 2px center url(\"$xwiki.getSkinFile('icons/silk/accept.png')\") no-repeat;\n  border-radius: 4px;\n  color: $theme.menuAddEntryLinkColor !important;\n  display: inline-block;\n  font-size: 83.3%;\n  line-height: 1.6em;\n  min-height: 16px;\n  padding: 3px 6px 3px 22px;\n}\n.activity-follow .follow {\n  background-image: url(\"$xwiki.getSkinFile('icons/silk/add.png')\");\n}\n\n.notificationWatchUser {\n  position: relative;\n}\n\n.notificationWatchUser &gt; p {\n  font-size: 0.85em;\n  font-weight: 700;\n  margin-bottom: 0.3em;\n  text-transform: uppercase;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>'Follow' css</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.XWikiUserProfileSheet</name>\n    <number>0</number>\n    <className>XWiki.UIExtensionClass</className>\n    <guid>acaf53a0-3959-4261-a985-d0f441a1db41</guid>\n    <class>\n      <name>XWiki.UIExtensionClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>3</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>4</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>2</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <content>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>content</name>\n        <number>1</number>\n        <prettyName>Executed Content</prettyName>\n        <rows>25</rows>\n        <size>120</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </content>\n      <extensionPointId>\n        <disabled>0</disabled>\n        <name>extensionPointId</name>\n        <number>5</number>\n        <prettyName>Extension Point ID</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </extensionPointId>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>6</number>\n        <prettyName>Extension ID</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parameters>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>parameters</name>\n        <number>7</number>\n        <prettyName>Extension Parameters</prettyName>\n        <rows>10</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </parameters>\n      <scope>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>scope</name>\n        <number>8</number>\n        <prettyName>Extension Scope</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>wiki=Current Wiki|user=Current User|global=Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </scope>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <content>{{velocity}}\n#set ($discard = $xwiki.jsx.use('XWiki.XWikiUserProfileSheet'))\n#set ($discard = $xwiki.ssx.use('XWiki.XWikiUserProfileSheet'))\n#set ($discard = $xwiki.ssx.use('XWiki.XWikiUserSheet'))\n##\n#set ($inEditMode = $xcontext.action == 'edit' || $xcontext.action == 'inline')\n#set ($xwikiUsersClassName = 'XWiki.XWikiUsers')\n#set ($obj = $doc.getObject($xwikiUsersClassName))\n##\n#if (!$obj)\n= $services.localization.render('xe.admin.users.sheet') =\n\n{{info}}$services.localization.render('xe.admin.users.applyonusers'){{/info}}\n\n#else\n## Make sure we only care about properties of the user object and don't get polluted by other objects that might be in the user's profile page.\n#set ($discard = $doc.use($obj))\n##\n#set ($sheetDocumentReference = $services.model.createDocumentReference($xcontext.database, 'XWiki', 'AdminUserProfileSheet'))\n#set ($sheetDocument = $xwiki.getDocument($sheetDocumentReference))\n#set ($xwikiUsersClass = $xwiki.getClass($xwikiUsersClassName))\n##\n#set ($sectionsObjectClassName = 'XWiki.UserProfileSectionsClass')\n#set ($sectionObjectClassName = 'XWiki.UserProfileSectionClass')\n#set ($isDisabled = $xwiki.getUser($doc.fullName).isDisabled())\n##\n#if ($hasAdmin &amp;&amp; $isDisabled)\n{{warning}}\n$services.localization.render('platform.core.profile.category.profile.disabled')\n{{/warning}}\n#end\n\n{{html clean='false' wiki='true'}}\n#if (!$inEditMode)\n  &lt;div class=\"vcard\"&gt;\n  &lt;span class=\"fn hidden\"&gt;$xwiki.getUserName($doc.fullName, false)&lt;/span&gt;\n#end\n  &lt;div class=\"#if($xcontext.action == 'view')half #{else}full #{end}column xform\"&gt;\n    #if ($hasAdmin &amp;&amp; !$inEditMode &amp;&amp; !$isMyProfile)\n      #if ($isDisabled)\n        #set ($enableClass = \"\")\n        #set ($disableClass = \"hidden\")\n      #else\n        #set ($enableClass = \"hidden\")\n        #set ($disableClass = \"\")\n      #end\n      &lt;a href=\"#\" id=\"enable\" class=\"btn btn-success $enableClass\"&gt;$services.icon.renderHTML('unlock') $services.localization.render('platform.core.profile.category.profile.enableAccount')&lt;/a&gt;\n      &lt;a href=\"#\" id=\"disable\" class=\"btn btn-warning $disableClass\"&gt;$services.icon.renderHTML('lock') $services.localization.render('platform.core.profile.category.profile.disableAccount')&lt;/a&gt;\n    #end\n    &lt;div class='userInfo'&gt;\n    #if($xcontext.action == 'view' &amp;&amp; $hasEdit)\n      &lt;div class='editProfileCategory'&gt;\n        &lt;a title=\"$escapetool.xml($services.localization.render('platform.core.profile.category.profile.edit'))\" \n              href=\"$doc.getURL('edit', 'editor=inline&amp;amp;category=profile')\"&gt;\n          &lt;span class='sr-only'&gt;$escapetool.xml($services.localization.render('platform.core.profile.category.profile.edit'))&lt;/span&gt;\n        &lt;/a&gt;\n      &lt;/div&gt;\n    #end\n    ## Please do not insert extra empty lines here (as it affects the validity of the rendered xhtml)\n    #set ($sectionsObject = $sheetDocument.getObject($sectionsObjectClassName))\n    #set ($sectionsToDisplayString = $sectionsObject.getProperty('sections').value)\n    #set ($sectionsToDisplay = $sectionsToDisplayString.split('\\s+'))\n    #foreach ($sectionId in $sectionsToDisplay)\n      #set ($sectionObject = $sheetDocument.getObject($sectionObjectClassName, 'id', $sectionId))\n      #set ($sectionName = \"$!sectionObject.getProperty('name').value\")\n      ## The section name will be evaluated. The admin can specify a static string or a call to $msg(...) to provide internationalization support.\n      #set ($sectionName = \"#evaluate($!sectionName)\")\n      ## If there is no section name specified, use the default translations prefix for the user profile, maybe we get lucky.\n      #if (\"$!sectionName\" == '')\n        #set ($sectionName = $services.localization.render(\"platform.core.profile.section.${sectionId}\"))\n      #end\n      ## If that does not work either, just display the sectionID.\n      #if (\"$!sectionName\" == \"platform.core.profile.section.${sectionId}\")\n        #set ($sectionName = $sectionId)\n      #end\n      #set ($sectionPropertiesString = $sectionObject.getProperty('properties').value)\n      #set ($sectionProperties = $sectionPropertiesString.split('\\s+'))\n      #if ($sectionProperties &amp;&amp; $sectionProperties.size() &gt; 0)\n        &lt;h2&gt;$sectionName&lt;/h2&gt;\n        &lt;dl&gt;\n        #foreach ($sectionProperty in $sectionProperties)\n          #set ($vCardData = $sectionProperty.split(':'))\n          #set ($vCardProperty = '')\n          #if ($vCardData.size() == 2)\n            #set ($vCardProperty = $vCardData[0])\n            #set ($sectionProperty = $vCardData[1])\n          #end\n          #if (\"$!sectionProperty\" != '' &amp;&amp; $xwikiUsersClass.get($sectionProperty))\n          &lt;dt&gt;\n            &lt;label #if($inEditMode)for=\"${xwikiUsersClassName}_${obj.number}_${sectionProperty}\"#{end}&gt;$doc.displayPrettyName(\"${sectionProperty}\")&lt;/label&gt;\n          &lt;/dt&gt;\n          &lt;dd #if(\"$!vCardProperty\" != '' &amp;&amp; !$inEditMode)class=\"$vCardProperty\"#{end}&gt;$doc.display($sectionProperty)&lt;/dd&gt;\n          #end\n        #end\n        &lt;/dl&gt;\n      #end\n    #end\n    &lt;/div&gt;\n  &lt;/div&gt;\n  #if (!$inEditMode)\n    &lt;div class='half column'&gt;\n      #set ($isMessageStreamActive = $services.messageStream.isActive())\n      #if ($isMessageStreamActive &amp;&amp; !$isGuest)\n      &lt;div class='userMessage profile-section'&gt;\n        &lt;h1&gt;$escapetool.xml($services.localization.render('platform.core.profile.section.sendMessage'))&lt;/h1&gt;\n\n          {{messageSender /}}\n\n      &lt;/div&gt;\n      #end\n      &lt;div class='userRecentChanges'&gt;\n      #if ($xcontext.user == $doc.fullName)\n        &lt;h2&gt;$escapetool.xml($services.localization.render('platform.core.profile.section.activity'))&lt;/h2&gt;\n      #else\n        &lt;h2&gt;\n          $escapetool.xml($services.localization.render('platform.core.profile.section.activityof',\n            [$xwiki.getUserName($doc.fullName, false)]))\n        &lt;/h2&gt;\n        #if ($hasWatch)\n        $xwiki.ssx.use('XWiki.XWikiUserProfileSheet')##\n        &lt;div class='activity-follow'&gt;\n          #set ($xredirect = $doc.getURL($xcontext.action, $request.queryString))\n          #if ($services.watchlist.isWatched(${doc.prefixedFullName}, \"USER\"))\n          &lt;span class='following'&gt;$services.localization.render('xe.activity.messages.following')&lt;/span&gt;\n          &lt;a class='action unfollow' href=\"$doc.getURL('view', \"xpage=watch&amp;amp;do=removeuser&amp;amp;xredirect=${escapetool.url($xredirect)}\")\"&gt;$services.localization.render('xe.activity.messages.unfollow')&lt;/a&gt;\n          #else\n          &lt;a class='action follow' href=\"$doc.getURL('view', \"xpage=watch&amp;amp;do=adduser&amp;amp;xredirect=${escapetool.url($xredirect)}\")\"&gt;$services.localization.render('xe.activity.messages.follow')&lt;/a&gt;\n          #end\n        &lt;/div&gt;\n        #end\n        &lt;div class=\"activity-follow\"&gt;\n        #if(\"$!services.notification.watch\" != '' &amp;&amp; $services.notification.watch.isEnabled() &amp;&amp; !$isGuest &amp;&amp; !$isSuperAdmin)\n          ## TODO: replace it, somehow, by a UIX or a custom user sheet\n          #set ($discard = $xwiki.ssx.use('XWiki.XWikiUserProfileSheet'))\n          #set ($discard = $xwiki.jsx.use('XWiki.XWikiUserProfileSheet'))\n          &lt;div class=\"notificationWatchUser\"&gt;\n            &lt;p&gt;$services.icon.renderHTML('bell') $escapetool.xml($services.localization.render('user.profile.notifications'))&lt;/p&gt;\n            #set ($userId = $services.model.serialize($doc.documentReference, 'default'))\n            #set ($isUserWatched = $services.notification.watch.isUserWatched($userId))\n            &lt;div class=\"notificationWatchUserFollowing #if(!$isUserWatched)hidden#end\"&gt;\n              &lt;button type=\"button\" class=\"btn btn-success dropdown-toggle btn-xs\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n                $services.icon.renderHTML('check') $escapetool.xml($services.localization.render('user.profile.network.following')) &lt;span class=\"caret\"&gt;&lt;/span&gt;\n              &lt;/button&gt;\n              &lt;ul class=\"dropdown-menu\"&gt;\n                &lt;li&gt;&lt;a href=\"#\" class=\"notificationWatchUserRemove\"&gt;$services.icon.renderHTML('cross') $escapetool.xml($services.localization.render('user.profile.network.unfollow'))&lt;/a&gt;&lt;/li&gt;\n              &lt;/ul&gt;\n            &lt;/div&gt;\n            &lt;div class=\"notificationWatchUserNotFollowing  #if($isUserWatched)hidden#end\"&gt;\n              &lt;button type=\"button\" class=\"btn btn-danger dropdown-toggle btn-xs\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n                $escapetool.xml($services.localization.render('user.profile.network.notfollowing')) &lt;span class=\"caret\"&gt;&lt;/span&gt;\n              &lt;/button&gt;\n              &lt;ul class=\"dropdown-menu\"&gt;\n                &lt;li&gt;&lt;a href=\"#\" class=\"notificationWatchUserAdd\"&gt;$services.icon.renderHTML('eye') $escapetool.xml($services.localization.render('user.profile.network.follow'))&lt;/a&gt;&lt;/li&gt;\n              &lt;/ul&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        #end\n        &lt;/div&gt;\n      #end\n{{/html}}\n\n{{notifications useUserPreferences=\"false\" displayOwnEvents=\"true\" users=\"${doc.prefixedFullName}\" displayRSSLink=\"false\" /}}\n\n{{html clean='false'}}\n      &lt;/div&gt;\n    &lt;/div&gt;\n  #end\n  &lt;div class='clearfloats'&gt;&amp;nbsp;&lt;/div&gt;\n#if(!$inEditMode)\n  ## Close the vcard\n  &lt;/div&gt;\n#end\n{{/html}}##\n#end\n{{/velocity}}</content>\n    </property>\n    <property>\n      <extensionPointId>org.xwiki.plaftorm.user.profile.menu</extensionPointId>\n    </property>\n    <property>\n      <name>org.xwiki.platform.user.profile.menu.userProfile</name>\n    </property>\n    <property>\n      <parameters>id=profile\nicon=user\npriority=10</parameters>\n    </property>\n    <property>\n      <scope>wiki</scope>\n    </property>\n  </object>\n</xwikidoc>\n"], "fixing_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.4\" reference=\"XWiki.XWikiUserProfileSheet\" locale=\"\">\n  <web>XWiki</web>\n  <name>XWikiUserProfileSheet</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.XWikiUserSheet</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title/>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.0</syntaxId>\n  <hidden>true</hidden>\n  <content>{{velocity}}\n#if ($hasAdmin &amp;&amp; \"$!request.userId\" != \"\" &amp;&amp; ($request.action == \"disable\" || $request.action == \"enable\") &amp;&amp; $services.csrf.isTokenValid($request.csrf))\n#set ($user = $xwiki.getUser($request.userId))\n#set ($isCurrentUser = $user.getUser().userReference.equals($xcontext.userReference))\n#if (!$isCurrentUser &amp;&amp; $user.getUser().exists($xcontext.context))\n  #set ($disabled = ($request.action == \"disable\"))\n  #set ($discard = $user.setDisabledStatus($disabled))\n  #set ($success = ($disabled &amp;&amp; $user.isDisabled()) || (!$disabled &amp;&amp; !$user.isDisabled()))\n#else\n  #set ($success = false)\n#end\n#jsonResponse({\n    'success': $success\n  })\n#end\n{{/velocity}}</content>\n  <object>\n    <name>XWiki.XWikiUserProfileSheet</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>bbea39b8-1682-4af2-91fd-8ac0b2b2e9d2</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require(['jquery', 'xwiki-meta'], function ($, xm) {\n  'use strict';\n  $(function() {\n    /**\n     * Save the new user status.\n     */\n    var changeUserStatus = function (action) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.network.saving'))\", 'inprogress');\n      var url = new XWiki.Document(XWiki.Model.resolve('XWiki.Notifications.Code.NotificationPreferenceService', XWiki.EntityType.DOCUMENT)).getURL('get', 'outputSyntax=plain');\n      $.post(url, {\n        'action': action,\n        'csrf': xm.form_token,\n        'user': XWiki.Model.serialize(xm.documentReference),\n        'target': 'user'\n      }).then(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.network.done'))\", 'done');\n        if (action == 'watchUser') {\n          $('.notificationWatchUserNotFollowing').addClass('hidden');\n          $('.notificationWatchUserFollowing').removeClass('hidden')\n        } else {\n          $('.notificationWatchUserFollowing').addClass('hidden');\n          $('.notificationWatchUserNotFollowing').removeClass('hidden');\n        }\n      }).catch(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.network.error'))\", 'error');\n      });\n    };\n\n    var setUserDisableStatus = function(action) {\n      var notification = new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.status.saving'))\", 'inprogress');\n      var url = new XWiki.Document(XWiki.Model.resolve('XWiki.XWikiUserProfileSheet', XWiki.EntityType.DOCUMENT)).getURL('get', 'outputSyntax=plain');\n      $.post(url, {\n        'action': action,\n        'csrf': xm.form_token,\n        'userId': XWiki.Model.serialize(xm.documentReference)\n      }).then(data =&gt; {\n        notification.hide();\n        if (data.success) {\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.status.done'))\", 'done');\n          if (action == 'disable') {\n            $('#disable').addClass('hidden');\n            $('#enable').removeClass('hidden');\n          } else {\n            $('#disable').removeClass('hidden');\n            $('#enable').addClass('hidden');\n          }\n        } else {\n          new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.status.error'))\", 'error');\n        }\n      }).catch(() =&gt; {\n        notification.hide();\n        new XWiki.widgets.Notification(\"$escapetool.javascript($services.localization.render('user.profile.status.error'))\", 'error');\n      });\n    };\n\n    $('#disable').on('click', function(event) {\n      setUserDisableStatus('disable');\n    });\n\n    $('#enable').on('click', function(event) {\n      setUserDisableStatus('enable');\n    });\n\n    /**\n     * DOM events\n     */\n    $('.notificationWatchUserAdd').on('click', function(event) {\n      changeUserStatus('watchUser');\n    });\n    $('.notificationWatchUserRemove').on('click', function(event) {\n      changeUserStatus('unwatchUser');\n    });\n  });\n});</code>\n    </property>\n    <property>\n      <name>Notifications Watch/Unwatch user</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.XWikiUserProfileSheet</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>69c76935-fbd0-4167-af11-8ad356c88ba9</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>#template('colorThemeInit.vm')\n\n.activity-follow {\n  padding-bottom: 10px;\n  margin-bottom: 20px;\n}\n\n.activity-follow .unfollow {\n  background: transparent 0 center url(\"$xwiki.getSkinFile('icons/silk/cross.png')\") no-repeat;\n  color: $theme.notificationErrorColor;\n  display: inline-block;\n  overflow: hidden;\n  font-size: 83.3%;\n  text-indent: 17px;\n  vertical-align: middle;\n  width: 16px;\n}\n.activity-follow .unfollow:hover {\n  overflow: visible;\n  text-decoration: none;\n  width: auto;\n}\n\n.activity-follow .follow, .activity-follow .following {\n  background: $theme.menuAddEntryBackgroundColor 2px center url(\"$xwiki.getSkinFile('icons/silk/accept.png')\") no-repeat;\n  border-radius: 4px;\n  color: $theme.menuAddEntryLinkColor !important;\n  display: inline-block;\n  font-size: 83.3%;\n  line-height: 1.6em;\n  min-height: 16px;\n  padding: 3px 6px 3px 22px;\n}\n.activity-follow .follow {\n  background-image: url(\"$xwiki.getSkinFile('icons/silk/add.png')\");\n}\n\n.notificationWatchUser {\n  position: relative;\n}\n\n.notificationWatchUser &gt; p {\n  font-size: 0.85em;\n  font-weight: 700;\n  margin-bottom: 0.3em;\n  text-transform: uppercase;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name>'Follow' css</name>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>currentPage</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.XWikiUserProfileSheet</name>\n    <number>0</number>\n    <className>XWiki.UIExtensionClass</className>\n    <guid>acaf53a0-3959-4261-a985-d0f441a1db41</guid>\n    <class>\n      <name>XWiki.UIExtensionClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>3</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>4</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>2</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <content>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>content</name>\n        <number>1</number>\n        <prettyName>Executed Content</prettyName>\n        <rows>25</rows>\n        <size>120</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </content>\n      <extensionPointId>\n        <disabled>0</disabled>\n        <name>extensionPointId</name>\n        <number>5</number>\n        <prettyName>Extension Point ID</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </extensionPointId>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>6</number>\n        <prettyName>Extension ID</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parameters>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>parameters</name>\n        <number>7</number>\n        <prettyName>Extension Parameters</prettyName>\n        <rows>10</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </parameters>\n      <scope>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>scope</name>\n        <number>8</number>\n        <prettyName>Extension Scope</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>wiki=Current Wiki|user=Current User|global=Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </scope>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <content>{{velocity}}\n#set ($discard = $xwiki.jsx.use('XWiki.XWikiUserProfileSheet'))\n#set ($discard = $xwiki.ssx.use('XWiki.XWikiUserProfileSheet'))\n#set ($discard = $xwiki.ssx.use('XWiki.XWikiUserSheet'))\n##\n#set ($inEditMode = $xcontext.action == 'edit' || $xcontext.action == 'inline')\n#set ($xwikiUsersClassName = 'XWiki.XWikiUsers')\n#set ($obj = $doc.getObject($xwikiUsersClassName))\n##\n#if (!$obj)\n= $services.localization.render('xe.admin.users.sheet') =\n\n{{info}}$services.localization.render('xe.admin.users.applyonusers'){{/info}}\n\n#else\n## Make sure we only care about properties of the user object and don't get polluted by other objects that might be in the user's profile page.\n#set ($discard = $doc.use($obj))\n##\n#set ($sheetDocumentReference = $services.model.createDocumentReference($xcontext.database, 'XWiki', 'AdminUserProfileSheet'))\n#set ($sheetDocument = $xwiki.getDocument($sheetDocumentReference))\n#set ($xwikiUsersClass = $xwiki.getClass($xwikiUsersClassName))\n##\n#set ($sectionsObjectClassName = 'XWiki.UserProfileSectionsClass')\n#set ($sectionObjectClassName = 'XWiki.UserProfileSectionClass')\n#set ($isDisabled = $xwiki.getUser($doc.fullName).isDisabled())\n##\n#if ($hasAdmin &amp;&amp; $isDisabled)\n{{warning}}\n$services.localization.render('platform.core.profile.category.profile.disabled')\n{{/warning}}\n#end\n\n{{html clean='false' wiki='true'}}\n#if (!$inEditMode)\n  &lt;div class=\"vcard\"&gt;\n  &lt;span class=\"fn hidden\"&gt;$xwiki.getUserName($doc.fullName, false)&lt;/span&gt;\n#end\n  &lt;div class=\"#if($xcontext.action == 'view')half #{else}full #{end}column xform\"&gt;\n    #if ($hasAdmin &amp;&amp; !$inEditMode &amp;&amp; !$isMyProfile)\n      #if ($isDisabled)\n        #set ($enableClass = \"\")\n        #set ($disableClass = \"hidden\")\n      #else\n        #set ($enableClass = \"hidden\")\n        #set ($disableClass = \"\")\n      #end\n      &lt;a href=\"#\" id=\"enable\" class=\"btn btn-success $enableClass\"&gt;$services.icon.renderHTML('unlock') $services.localization.render('platform.core.profile.category.profile.enableAccount')&lt;/a&gt;\n      &lt;a href=\"#\" id=\"disable\" class=\"btn btn-warning $disableClass\"&gt;$services.icon.renderHTML('lock') $services.localization.render('platform.core.profile.category.profile.disableAccount')&lt;/a&gt;\n    #end\n    &lt;div class='userInfo'&gt;\n    #if($xcontext.action == 'view' &amp;&amp; $hasEdit)\n      &lt;div class='editProfileCategory'&gt;\n        &lt;a title=\"$escapetool.xml($services.localization.render('platform.core.profile.category.profile.edit'))\" \n              href=\"$doc.getURL('edit', 'editor=inline&amp;amp;category=profile')\"&gt;\n          &lt;span class='sr-only'&gt;$escapetool.xml($services.localization.render('platform.core.profile.category.profile.edit'))&lt;/span&gt;\n        &lt;/a&gt;\n      &lt;/div&gt;\n    #end\n    ## Please do not insert extra empty lines here (as it affects the validity of the rendered xhtml)\n    #set ($sectionsObject = $sheetDocument.getObject($sectionsObjectClassName))\n    #set ($sectionsToDisplayString = $sectionsObject.getProperty('sections').value)\n    #set ($sectionsToDisplay = $sectionsToDisplayString.split('\\s+'))\n    #foreach ($sectionId in $sectionsToDisplay)\n      #set ($sectionObject = $sheetDocument.getObject($sectionObjectClassName, 'id', $sectionId))\n      #set ($sectionName = \"$!sectionObject.getProperty('name').value\")\n      ## The section name will be evaluated. The admin can specify a static string or a call to $msg(...) to provide internationalization support.\n      #set ($sectionName = \"#evaluate($!sectionName)\")\n      ## If there is no section name specified, use the default translations prefix for the user profile, maybe we get lucky.\n      #if (\"$!sectionName\" == '')\n        #set ($sectionName = $services.localization.render(\"platform.core.profile.section.${sectionId}\"))\n      #end\n      ## If that does not work either, just display the sectionID.\n      #if (\"$!sectionName\" == \"platform.core.profile.section.${sectionId}\")\n        #set ($sectionName = $sectionId)\n      #end\n      #set ($sectionPropertiesString = $sectionObject.getProperty('properties').value)\n      #set ($sectionProperties = $sectionPropertiesString.split('\\s+'))\n      #if ($sectionProperties &amp;&amp; $sectionProperties.size() &gt; 0)\n        &lt;h2&gt;$sectionName&lt;/h2&gt;\n        &lt;dl&gt;\n        #foreach ($sectionProperty in $sectionProperties)\n          #set ($vCardData = $sectionProperty.split(':'))\n          #set ($vCardProperty = '')\n          #if ($vCardData.size() == 2)\n            #set ($vCardProperty = $vCardData[0])\n            #set ($sectionProperty = $vCardData[1])\n          #end\n          #if (\"$!sectionProperty\" != '' &amp;&amp; $xwikiUsersClass.get($sectionProperty))\n          &lt;dt&gt;\n            &lt;label #if($inEditMode)for=\"${xwikiUsersClassName}_${obj.number}_${sectionProperty}\"#{end}&gt;$doc.displayPrettyName(\"${sectionProperty}\")&lt;/label&gt;\n          &lt;/dt&gt;\n          &lt;dd #if(\"$!vCardProperty\" != '' &amp;&amp; !$inEditMode)class=\"$vCardProperty\"#{end}&gt;$doc.display($sectionProperty)&lt;/dd&gt;\n          #end\n        #end\n        &lt;/dl&gt;\n      #end\n    #end\n    &lt;/div&gt;\n  &lt;/div&gt;\n  #if (!$inEditMode)\n    &lt;div class='half column'&gt;\n      #set ($isMessageStreamActive = $services.messageStream.isActive())\n      #if ($isMessageStreamActive &amp;&amp; !$isGuest)\n      &lt;div class='userMessage profile-section'&gt;\n        &lt;h1&gt;$escapetool.xml($services.localization.render('platform.core.profile.section.sendMessage'))&lt;/h1&gt;\n\n          {{messageSender /}}\n\n      &lt;/div&gt;\n      #end\n      &lt;div class='userRecentChanges'&gt;\n      #if ($xcontext.user == $doc.fullName)\n        &lt;h2&gt;$escapetool.xml($services.localization.render('platform.core.profile.section.activity'))&lt;/h2&gt;\n      #else\n        &lt;h2&gt;\n          $escapetool.xml($services.localization.render('platform.core.profile.section.activityof',\n            [$xwiki.getUserName($doc.fullName, false)]))\n        &lt;/h2&gt;\n        #if ($hasWatch)\n        $xwiki.ssx.use('XWiki.XWikiUserProfileSheet')##\n        &lt;div class='activity-follow'&gt;\n          #set ($xredirect = $doc.getURL($xcontext.action, $request.queryString))\n          #if ($services.watchlist.isWatched(${doc.prefixedFullName}, \"USER\"))\n          &lt;span class='following'&gt;$services.localization.render('xe.activity.messages.following')&lt;/span&gt;\n          &lt;a class='action unfollow' href=\"$doc.getURL('view', \"xpage=watch&amp;amp;do=removeuser&amp;amp;xredirect=${escapetool.url($xredirect)}\")\"&gt;$services.localization.render('xe.activity.messages.unfollow')&lt;/a&gt;\n          #else\n          &lt;a class='action follow' href=\"$doc.getURL('view', \"xpage=watch&amp;amp;do=adduser&amp;amp;xredirect=${escapetool.url($xredirect)}\")\"&gt;$services.localization.render('xe.activity.messages.follow')&lt;/a&gt;\n          #end\n        &lt;/div&gt;\n        #end\n        &lt;div class=\"activity-follow\"&gt;\n        #if(\"$!services.notification.watch\" != '' &amp;&amp; $services.notification.watch.isEnabled() &amp;&amp; !$isGuest &amp;&amp; !$isSuperAdmin)\n          ## TODO: replace it, somehow, by a UIX or a custom user sheet\n          #set ($discard = $xwiki.ssx.use('XWiki.XWikiUserProfileSheet'))\n          #set ($discard = $xwiki.jsx.use('XWiki.XWikiUserProfileSheet'))\n          &lt;div class=\"notificationWatchUser\"&gt;\n            &lt;p&gt;$services.icon.renderHTML('bell') $escapetool.xml($services.localization.render('user.profile.notifications'))&lt;/p&gt;\n            #set ($userId = $services.model.serialize($doc.documentReference, 'default'))\n            #set ($isUserWatched = $services.notification.watch.isUserWatched($userId))\n            &lt;div class=\"notificationWatchUserFollowing #if(!$isUserWatched)hidden#end\"&gt;\n              &lt;button type=\"button\" class=\"btn btn-success dropdown-toggle btn-xs\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n                $services.icon.renderHTML('check') $escapetool.xml($services.localization.render('user.profile.network.following')) &lt;span class=\"caret\"&gt;&lt;/span&gt;\n              &lt;/button&gt;\n              &lt;ul class=\"dropdown-menu\"&gt;\n                &lt;li&gt;&lt;a href=\"#\" class=\"notificationWatchUserRemove\"&gt;$services.icon.renderHTML('cross') $escapetool.xml($services.localization.render('user.profile.network.unfollow'))&lt;/a&gt;&lt;/li&gt;\n              &lt;/ul&gt;\n            &lt;/div&gt;\n            &lt;div class=\"notificationWatchUserNotFollowing  #if($isUserWatched)hidden#end\"&gt;\n              &lt;button type=\"button\" class=\"btn btn-danger dropdown-toggle btn-xs\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n                $escapetool.xml($services.localization.render('user.profile.network.notfollowing')) &lt;span class=\"caret\"&gt;&lt;/span&gt;\n              &lt;/button&gt;\n              &lt;ul class=\"dropdown-menu\"&gt;\n                &lt;li&gt;&lt;a href=\"#\" class=\"notificationWatchUserAdd\"&gt;$services.icon.renderHTML('eye') $escapetool.xml($services.localization.render('user.profile.network.follow'))&lt;/a&gt;&lt;/li&gt;\n              &lt;/ul&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        #end\n        &lt;/div&gt;\n      #end\n{{/html}}\n\n{{notifications useUserPreferences=\"false\" displayOwnEvents=\"true\" users=\"${doc.prefixedFullName}\" displayRSSLink=\"false\" /}}\n\n{{html clean='false'}}\n      &lt;/div&gt;\n    &lt;/div&gt;\n  #end\n  &lt;div class='clearfloats'&gt;&amp;nbsp;&lt;/div&gt;\n#if(!$inEditMode)\n  ## Close the vcard\n  &lt;/div&gt;\n#end\n{{/html}}##\n#end\n{{/velocity}}</content>\n    </property>\n    <property>\n      <extensionPointId>org.xwiki.plaftorm.user.profile.menu</extensionPointId>\n    </property>\n    <property>\n      <name>org.xwiki.platform.user.profile.menu.userProfile</name>\n    </property>\n    <property>\n      <parameters>id=profile\nicon=user\npriority=10</parameters>\n    </property>\n    <property>\n      <scope>wiki</scope>\n    </property>\n  </object>\n</xwikidoc>\n"], "filenames": ["xwiki-platform-core/xwiki-platform-user/xwiki-platform-user-profile/xwiki-platform-user-profile-ui/src/main/resources/XWiki/XWikiUserProfileSheet.xml"], "buggy_code_start_loc": [40], "buggy_code_end_loc": [43], "fixing_code_start_loc": [40], "fixing_code_end_loc": [44], "type": "CWE-862", "message": "org.xwiki.platform:xwiki-platform-user-profile-ui is missing authorization to enable or disable users. Any user (logged in or not) with access to the page XWiki.XWikiUserProfileSheet can enable or disable any user profile. This might allow to a disabled user to re-enable themselves, or to an attacker to disable any user of the wiki. The problem has been patched in XWiki 13.10.7, 14.5RC1 and 14.4.2. Workarounds: The problem can be patched immediately by editing the page `XWiki.XWikiUserProfileSheet` in the wiki and by performing the changes contained in https://github.com/xwiki/xwiki-platform/commit/5be1cc0adf917bf10899c47723fa451e950271fa.", "other": {"cve": {"id": "CVE-2022-41930", "sourceIdentifier": "security-advisories@github.com", "published": "2022-11-23T19:15:12.807", "lastModified": "2022-11-30T16:50:46.400", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "org.xwiki.platform:xwiki-platform-user-profile-ui is missing authorization to enable or disable users. Any user (logged in or not) with access to the page XWiki.XWikiUserProfileSheet can enable or disable any user profile. This might allow to a disabled user to re-enable themselves, or to an attacker to disable any user of the wiki. The problem has been patched in XWiki 13.10.7, 14.5RC1 and 14.4.2. Workarounds: The problem can be patched immediately by editing the page `XWiki.XWikiUserProfileSheet` in the wiki and by performing the changes contained in https://github.com/xwiki/xwiki-platform/commit/5be1cc0adf917bf10899c47723fa451e950271fa."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "LOW", "baseScore": 8.2, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 4.2}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-862"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "12.4", "versionEndExcluding": "13.10.7", "matchCriteriaId": "335CB44E-1A04-4C58-9FD9-3D6DF92B1035"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.0.0", "versionEndExcluding": "14.4.2", "matchCriteriaId": "B5DF0A47-B3DD-4A49-BA56-35374D029F02"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:14.4.3:*:*:*:*:*:*:*", "matchCriteriaId": "C9646DA8-7C5A-458E-975C-A67099D43047"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:14.4.4:*:*:*:*:*:*:*", "matchCriteriaId": "CDAB9E27-2E41-44EA-BBCB-8015B22272B7"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/5be1cc0adf917bf10899c47723fa451e950271fa", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-p5v9-g8w8-5q4v", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-19792", "source": "security-advisories@github.com", "tags": ["Exploit", "Issue Tracking", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/5be1cc0adf917bf10899c47723fa451e950271fa"}}