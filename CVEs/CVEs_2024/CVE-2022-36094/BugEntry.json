{"buggy_code": ["## ---------------------------------------------------------------------------\n## See the NOTICE file distributed with this work for additional\n## information regarding copyright ownership.\n##\n## This is free software; you can redistribute it and/or modify it\n## under the terms of the GNU Lesser General Public License as\n## published by the Free Software Foundation; either version 2.1 of\n## the License, or (at your option) any later version.\n##\n## This software is distributed in the hope that it will be useful,\n## but WITHOUT ANY WARRANTY; without even the implied warranty of\n## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n## Lesser General Public License for more details.\n##\n## You should have received a copy of the GNU Lesser General Public\n## License along with this software; if not, write to the Free\n## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n## 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n## ---------------------------------------------------------------------------\n#template(\"startpage.vm\")\n<div class=\"main layoutsubsection\">\n<div id=\"mainContentArea\">\n<h3>$services.localization.render(\"core.viewers.attachments.revisions\", [$attachment.filename])</h3>\n#if (\"$tdoc.realLocale\" != '')\n#set($lang = \"&language=${tdoc.realLocale}\")\n#else\n#set($lang = \"\")\n#end\n<table class=\"wiki-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n    <tr>\n        <th></th><th>$services.localization.render('version')</th><th>$services.localization.render('size')</th>\n        <th>$services.localization.render('author')</th><th>$services.localization.render('date')</th>\n    </tr>\n#foreach ($version in $attachment.getVersions())\n    <tr#if($foreach.count % 2 == 1) class=\"table-odd\"#else class=\"table-even\"#end>\n#set($attachrev = $attachment.getAttachmentRevision($version.toString()))\n#if(\"$!{request.rid}\" != \"\")\n  #set($url = $doc.getAttachmentRevisionURL(\"${attachment.filename}\", ${version.toString()}, \"rid=${request.rid}\"))\n#else\n  #set($url = $doc.getAttachmentRevisionURL(\"${attachment.filename}\", ${version.toString()}))\n#end\n#if ($attachment.isImage())\n        <td><img src=\"${url}\" alt=\"${attachment.filename}\" width=\"80\" />\n#else\n        <td class=\"mime\">#mimetypeimg($attachment.getMimeType().toLowerCase() $attachment.getFilename().toLowerCase())\n#end\n        </td>\n        <td><a href=\"$url\">$version</a></td>\n        <td>$attachrev.longSize</td>\n        <td>$xwiki.getUserName($attachrev.getAuthor())</td>\n        <td>$xwiki.formatDate($attachrev.getDate())</td>\n    </tr>\n#end\n</table>\n</div>## mainContentArea\n</div>## main\n#template(\"endpage.vm\")\n"], "fixing_code": ["## ---------------------------------------------------------------------------\n## See the NOTICE file distributed with this work for additional\n## information regarding copyright ownership.\n##\n## This is free software; you can redistribute it and/or modify it\n## under the terms of the GNU Lesser General Public License as\n## published by the Free Software Foundation; either version 2.1 of\n## the License, or (at your option) any later version.\n##\n## This software is distributed in the hope that it will be useful,\n## but WITHOUT ANY WARRANTY; without even the implied warranty of\n## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n## Lesser General Public License for more details.\n##\n## You should have received a copy of the GNU Lesser General Public\n## License along with this software; if not, write to the Free\n## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n## 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n## ---------------------------------------------------------------------------\n#template(\"startpage.vm\")\n<div class=\"main layoutsubsection\">\n<div id=\"mainContentArea\">\n<h3>$services.localization.render(\"core.viewers.attachments.revisions\", [$escapetool.xml($attachment.filename)])</h3>\n#if (\"$tdoc.realLocale\" != '')\n#set($lang = \"&language=${tdoc.realLocale}\")\n#else\n#set($lang = \"\")\n#end\n<table class=\"wiki-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n    <tr>\n        <th></th><th>$services.localization.render('version')</th><th>$services.localization.render('size')</th>\n        <th>$services.localization.render('author')</th><th>$services.localization.render('date')</th>\n    </tr>\n#foreach ($version in $attachment.getVersions())\n    <tr#if($foreach.count % 2 == 1) class=\"table-odd\"#else class=\"table-even\"#end>\n#set($attachrev = $attachment.getAttachmentRevision($version.toString()))\n#if(\"$!{request.rid}\" != \"\")\n  #set($url = $doc.getAttachmentRevisionURL(\"${attachment.filename}\", ${version.toString()}, \"rid=${request.rid}\"))\n#else\n  #set($url = $doc.getAttachmentRevisionURL(\"${attachment.filename}\", ${version.toString()}))\n#end\n#if ($attachment.isImage())\n        <td><img src=\"${url}\" alt=\"${escapetool.xml($attachment.filename)}\" width=\"80\" />\n#else\n        <td class=\"mime\">#mimetypeimg($attachment.getMimeType().toLowerCase() $attachment.getFilename().toLowerCase())\n#end\n        </td>\n        <td><a href=\"$url\">$version</a></td>\n        <td>$attachrev.longSize</td>\n        <td>$xwiki.getUserName($attachrev.getAuthor())</td>\n        <td>$xwiki.formatDate($attachrev.getDate())</td>\n    </tr>\n#end\n</table>\n</div>## mainContentArea\n</div>## main\n#template(\"endpage.vm\")\n"], "filenames": ["xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/viewattachrev.vm"], "buggy_code_start_loc": [23], "buggy_code_end_loc": [44], "fixing_code_start_loc": [23], "fixing_code_end_loc": [44], "type": "CWE-79", "message": "XWiki Platform Web Parent POM contains Web resources for the XWiki platform, a generic wiki platform. Starting with version 1.0 and prior to versions 13.10.6 and 14.30-rc-1, it's possible to store JavaScript which will be executed by anyone viewing the history of an attachment containing javascript in its name. This issue has been patched in XWiki 13.10.6 and 14.3RC1. As a workaround, it is possible to replace `viewattachrev.vm`, the entry point for this attack, by a patched version from the patch without updating XWiki.", "other": {"cve": {"id": "CVE-2022-36094", "sourceIdentifier": "security-advisories@github.com", "published": "2022-09-08T20:15:08.600", "lastModified": "2022-09-14T20:30:16.987", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Platform Web Parent POM contains Web resources for the XWiki platform, a generic wiki platform. Starting with version 1.0 and prior to versions 13.10.6 and 14.30-rc-1, it's possible to store JavaScript which will be executed by anyone viewing the history of an attachment containing javascript in its name. This issue has been patched in XWiki 13.10.6 and 14.3RC1. As a workaround, it is possible to replace `viewattachrev.vm`, the entry point for this attack, by a patched version from the patch without updating XWiki."}, {"lang": "es", "value": "XWiki Platform Web Parent POM contiene recursos web para la plataforma XWiki, una plataforma wiki gen\u00e9rica.&#xa0;A partir de la versi\u00f3n 1.0 y en versiones anteriores a 13.10.6 y 14.30-rc-1, es posible almacenar JavaScript que ejecutar\u00e1 cualquiera que visualice el historial de un archivo adjunto que contenga javascript en su nombre.&#xa0;Este problema ha sido parcheado en XWiki versiones 13.10.6 y 14.3RC1.&#xa0;Como mitigaci\u00f3n, es posible reemplazar \"viewattachrev.vm\", el punto de entrada de este ataque, por una versi\u00f3n parcheada del parche sin actualizar XWiki"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.0, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.3, "impactScore": 6.0}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "LOW", "baseScore": 8.9, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.3, "impactScore": 6.0}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}, {"lang": "en", "value": "CWE-80"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "1.0", "versionEndExcluding": "13.10.6", "matchCriteriaId": "1F89B834-9C47-4E94-9F96-F9F6B09799E5"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.0", "versionEndExcluding": "14.3", "matchCriteriaId": "9B57E523-06A8-4964-84FE-361C9AA26990"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/047ce9fa4a7c13f3883438aaf54fc50f287a7e8e", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-mxf2-4r22-5hq9", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-19612", "source": "security-advisories@github.com", "tags": ["Exploit", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/047ce9fa4a7c13f3883438aaf54fc50f287a7e8e"}}