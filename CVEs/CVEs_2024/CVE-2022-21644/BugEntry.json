{"buggy_code": ["<!DOCTYPE html>\n<html lang=\"<?php echo $U->getSetting(\"site.lang\"); ?>\" dir=\"ltr\">\n    <head>\n        <style>\n            tbody > tr > th {\n                font-weight: normal;\n            }\n        </style>\n        <meta charset=\"utf-8\">\n        <title><?php echo $U->getLang(\"admin\") ?> - <?php echo $U->getLang(\"admin.user.search\"); ?></title>\n    </head>\n    <body>\n        <a href=\"javascript:window.close()\"><?php echo $U->getLang(\"admin.exit\"); ?></a>\n        <p><?php echo $U->getLang(\"admin.user.search.intro\"); ?></p>\n        <form>\n            <label for=\"Name\"><?php echo $U->getLang(\"admin.user.field.username\"); ?>:</label><br />\n            <input type=\"text\" name=\"Name\" /><br />\n            <label for=\"Mail\"><?php echo $U->getLang(\"admin.user.field.mail\"); ?>:</label><br />\n            <input type=\"mail\" name=\"Mail\" /><br />\n            <input type=\"hidden\" name=\"URL\" value=\"usersearch\" />\n            <input type=\"submit\" value=\"<?php echo $U->getLang(\"admin.user.search.action\"); ?>\" />\n        </form>\n        <?php\n            if(isset($_GET[\"Name\"])){\n                if($_GET[\"Name\"] !== \"\"){\n                    $sql = \"SELECT * FROM User WHERE Username='\".$_GET[\"Name\"].\"';\";\n                    $db_erg = mysqli_query($U->db_link, $sql);\n                }\n            }\n            if(isset($_GET[\"Mail\"])){\n                if($_GET[\"Mail\"] !== \"\"){\n                    $sql = \"SELECT * FROM User WHERE Mail='\".$_GET[\"Mail\"].\"';\";\n                    $db_erg = mysqli_query($U->db_link, $sql);\n                }\n            }\n            if(isset($_GET[\"Mail\"]) || isset($_GET[\"Name\"])){\n                $userhere = False;\n                while($row = mysqli_fetch_array($db_erg, MYSQLI_ASSOC)){\n                    $userhere = True;\n        ?>\n                    <h4><?php echo str_replace(\"%a\",$row[\"Username\"],$U->getLang(\"admin.user.search.title\")); ?></h4>\n                    <table>\n                        <tbody>\n                            <tr>\n                                <th>\n                                    Id:\n                                </th>\n                                <th>\n                                    <?php echo $row[\"Id\"]; ?>\n                                </th>\n                            </tr>\n                            <tr>\n                                <th>\n                                    <?php echo $U->getLang(\"admin.user.field.mail\"); ?>:\n                                </th>\n                                <th>\n                                    <?php echo $row[\"Mail\"]; ?>\n                                </th>\n                            </tr>\n                            <tr>\n                                <th>\n                                    <?php echo $U->getLang(\"admin.user.field.admin\"); ?>\n                                </th>\n                                <th>\n                                    <?php echo $row[\"Type\"]; ?>\n                                </th>\n                            </tr>\n                            <tr>\n                                <th>\n                                    <?php echo $U->getLang(\"admin.user.field.blocked\"); ?>\n                                </th>\n                                <th>\n                                    <?php echo $row[\"blocked\"]; ?>\n                                </th>\n                            </tr>\n                        </tbody>\n                    </table>\n        <?php\n                }\n                if(!$userhere&&$_GET[\"Mail\"] !== \"\"){\n                    echo str_replace(\"%a\", $U->getLang(\"admin.user.field.mail\"), str_replace(\"%b\", $_GET[\"Mail\"], $U->getLang(\"admin.user.notFound.property\")));\n                }\n                if(!$userhere&&$_GET[\"Name\"] !== \"\"){\n                    echo str_replace(\"%a\", $U->getLang(\"admin.user.field.username\"), str_replace(\"%b\", $_GET[\"Name\"], $U->getLang(\"admin.user.notFound.property\")));\n                }\n            }\n        ?>\n    </body>\n</html>"], "fixing_code": ["<?php\n    if($U->userHasPermission(\"Backend\", \"User\",\"Search\")){\n?>\n    <!DOCTYPE html>\n    <html lang=\"<?php echo $U->getSetting(\"site.lang\"); ?>\" dir=\"ltr\">\n        <head>\n            <style>\n                tbody > tr > th {\n                    font-weight: normal;\n                }\n            </style>\n            <meta charset=\"utf-8\">\n            <title><?php echo $U->getLang(\"admin\") ?> - <?php echo $U->getLang(\"admin.user.search\"); ?></title>\n        </head>\n        <body>\n            <a href=\"javascript:window.close()\"><?php echo $U->getLang(\"admin.exit\"); ?></a>\n            <p><?php echo $U->getLang(\"admin.user.search.intro\"); ?></p>\n            <form>\n                <label for=\"Name\"><?php echo $U->getLang(\"admin.user.field.username\"); ?>:</label><br />\n                <input type=\"text\" name=\"Name\" /><br />\n                <label for=\"Mail\"><?php echo $U->getLang(\"admin.user.field.mail\"); ?>:</label><br />\n                <input type=\"mail\" name=\"Mail\" /><br />\n                <input type=\"hidden\" name=\"URL\" value=\"usersearch\" />\n                <input type=\"submit\" value=\"<?php echo $U->getLang(\"admin.user.search.action\"); ?>\" />\n            </form>\n            <?php\n                if(isset($_GET[\"Name\"])){\n                    if($_GET[\"Name\"] !== \"\"){\n                        $sql = \"SELECT * FROM User WHERE Username='\".mysqli::real_escape_string($_GET[\"Name\"]).\"';\";\n                        $dbRes = mysqli_query($U->db_link, $sql);\n                    }\n                }\n                if(isset($_GET[\"Mail\"])){\n                    if($_GET[\"Mail\"] !== \"\"){\n                        $sql = \"SELECT * FROM User WHERE Mail='\".mysqli::real_escape_string($_GET[\"Mail\"]).\"';\";\n                        $dbRes = mysqli_query($U->db_link, $sql);\n                    }\n                }\n                if(isset($_GET[\"Id\"])){\n                    if($_GET[\"Id\"] !== \"\"){\n                        $sql = \"SELECT * FROM User WHERE Id='\".mysqli::real_escape_string($_GET[\"Id\"]).\"';\";\n                        $dbRes = mysqli_query($U->db_link, $sql);\n                    }\n                }\n                if(isset($_GET[\"Mail\"]) || isset($_GET[\"Name\"]) || isset($_GET[\"Id\"])){\n                    $userhere = False;\n                    while($row = mysqli_fetch_array($dbRes, MYSQLI_ASSOC)){\n                        $userhere = True;\n            ?>\n                        <h4><?php echo str_replace(\"%a\",$row[\"Username\"],$U->getLang(\"admin.user.search.title\")); ?></h4>\n                        <table>\n                            <tbody>\n                                <tr>\n                                    <th>\n                                        Id:\n                                    </th>\n                                    <th>\n                                        <?php echo $row[\"Id\"]; ?>\n                                    </th>\n                                </tr>\n                                <tr>\n                                    <th>\n                                        <?php echo $U->getLang(\"admin.user.field.mail\"); ?>:\n                                    </th>\n                                    <th>\n                                        <?php echo $row[\"Mail\"]; ?>\n                                    </th>\n                                </tr>\n                                <tr>\n                                    <th>\n                                        <?php echo $U->getLang(\"admin.user.field.permissionlevel\"); ?>\n                                    </th>\n                                    <th>\n                                        <?php echo $U->getPermissionName($row[\"Type\"]); ?>\n                                    </th>\n                                </tr>\n                                <tr>\n                                    <th>\n                                        <?php echo $U->getLang(\"admin.user.field.blocked\"); ?>\n                                    </th>\n                                    <th>\n                                        <?php echo $row[\"blocked\"]==0?$U->getLang(\"admin.no\"):$U->getLang(\"admin.yes\"); ?>\n                                    </th>\n                                </tr>\n                            </tbody>\n                        </table>\n            <?php\n                    }\n                    if(!$userhere&&isset($_GET[\"Mail\"])&&$_GET[\"Mail\"]!==\"\"){\n                        echo str_replace(\"%a\", $U->getLang(\"admin.user.field.mail\"), str_replace(\"%b\", $_GET[\"Mail\"], $U->getLang(\"admin.user.notFound.property\")));\n                    }\n                    if(!$userhere&&isset($_GET[\"Name\"])&&$_GET[\"Name\"]!==\"\"){\n                        echo str_replace(\"%a\", $U->getLang(\"admin.user.field.username\"), str_replace(\"%b\", $_GET[\"Name\"], $U->getLang(\"admin.user.notFound.property\")));\n                    }\n                    if(!$userhere&&isset($_GET[\"Id\"])){\n                        echo str_replace(\"%a\", $U->getLang(\"admin.user.field.id\"), str_replace(\"%b\", $_GET[\"Id\"], $U->getLang(\"admin.user.notFound.property\")));\n                    }\n                }\n            ?>\n        </body>\n    </html>\n<?php\n  }else{\n?>\n  <!DOCTYPE html>\n  <html lang=\"<?php echo $U->getSetting(\"site.lang\"); ?>\" dir=\"ltr\">\n    <head>\n      <meta charset=\"utf-8\">\n      <title><?php echo $U->getLang(\"admin\") ?> - <?php echo $U->getLang(\"admin.settings\"); ?></title>\n    </head>\n    <body>\n        <a href=\"javascript:window.close()\"><?php echo $U->getLang(\"admin.exit\"); ?></a>\n      <p><?php echo $U->getLang(\"rights.error\"); ?></p>\n    </body>\n  </html>\n<?php\n  }\n?>\n"], "filenames": ["admin/pages/usersearch.php"], "buggy_code_start_loc": [1], "buggy_code_end_loc": [90], "fixing_code_start_loc": [1], "fixing_code_end_loc": [119], "type": "CWE-89", "message": "USOC is an open source CMS with a focus on simplicity. In affected versions USOC allows for SQL injection via usersearch.php. In search terms provided by the user were not sanitized and were used directly to construct a sql statement. The only users permitted to search are site admins. Users are advised to upgrade as soon as possible. There are not workarounds for this issue.", "other": {"cve": {"id": "CVE-2022-21644", "sourceIdentifier": "security-advisories@github.com", "published": "2022-01-04T20:15:07.860", "lastModified": "2022-01-21T14:24:50.440", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "USOC is an open source CMS with a focus on simplicity. In affected versions USOC allows for SQL injection via usersearch.php. In search terms provided by the user were not sanitized and were used directly to construct a sql statement. The only users permitted to search are site admins. Users are advised to upgrade as soon as possible. There are not workarounds for this issue."}, {"lang": "es", "value": "USOC es un CMS de c\u00f3digo abierto centrado en la simplicidad. En las versiones afectadas, USOC permite la inyecci\u00f3n SQL por medio del archivo usersearch.php. En los t\u00e9rminos de b\u00fasqueda proporcionados por el usuario no eran saneados y eran usados directamente para construir una sentencia sql. Los \u00fanicos usuarios que pueden realizar b\u00fasquedas son los administradores del sitio. Se aconseja a usuarios que actualicen lo antes posible. No se presentan medidas de mitigaci\u00f3n para este problema."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.2, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.2, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.1, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.3, "impactScore": 6.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:useful_simple_open-source_cms_project:useful_simple_open-source_cms:*:*:*:*:*:*:*:*", "versionEndExcluding": "pb2.4bfx2", "matchCriteriaId": "2DBB6ACF-B401-4A14-A2F3-2E0EB6DE5852"}]}]}], "references": [{"url": "https://github.com/Aaron-Junker/USOC/commit/06217c66c8f9b114726b21633eabcd88ac9034aa", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/Aaron-Junker/USOC/security/advisories/GHSA-89jg-6fr3-9q4h", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Aaron-Junker/USOC/commit/06217c66c8f9b114726b21633eabcd88ac9034aa"}}