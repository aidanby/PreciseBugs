{"buggy_code": ["<?\r\n\r\n/*\r\n// +--------------------------------------------------------------------------+\r\n// | Project:    TBDevYSE - TBDev Yuna Scatari Edition                        |\r\n// +--------------------------------------------------------------------------+\r\n// | This file is part of TBDevYSE. TBDevYSE is based on TBDev,               |\r\n// | originally by RedBeard of TorrentBits, extensively modified by           |\r\n// | Gartenzwerg.                                                             |\r\n// |                                                                          |\r\n// | TBDevYSE is free software; you can redistribute it and/or modify         |\r\n// | it under the terms of the GNU General Public License as published by     |\r\n// | the Free Software Foundation; either version 2 of the License, or        |\r\n// | (at your option) any later version.                                      |\r\n// |                                                                          |\r\n// | TBDevYSE is distributed in the hope that it will be useful,              |\r\n// | but WITHOUT ANY WARRANTY; without even the implied warranty of           |\r\n// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            |\r\n// | GNU General Public License for more details.                             |\r\n// |                                                                          |\r\n// | You should have received a copy of the GNU General Public License        |\r\n// | along with TBDevYSE; if not, write to the Free Software Foundation,      |\r\n// | Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA            |\r\n// +--------------------------------------------------------------------------+\r\n// |                                               Do not remove above lines! |\r\n// +--------------------------------------------------------------------------+\r\n*/\r\n\r\nrequire \"include/bittorrent.php\";\r\n\r\n// 0 - No debug; 1 - Show and run SQL query; 2 - Show SQL query only\r\n$DEBUG_MODE = 0;\r\n/*\r\nfunction get_user_icons($arr, $big = false)\r\n{\r\n\tif ($big)\r\n\t{\r\n\t\t$donorpic = \"starbig.gif\";\r\n\t\t$warnedpic = \"warnedbig.gif\";\r\n\t\t$disabledpic = \"disabledbig.gif\";\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$donorpic = \"star.gif\";\r\n\t\t$warnedpic = \"warned.gif\";\r\n\t\t$disabledpic = \"disabled.gif\";\r\n\t}\r\n\t$pics = $arr[\"donor\"] == \"yes\" ? \"<img src=pic/$donorpic alt='Donor' border=0 style=\\\"margin-left: 2pt\\\">\" : \"\";\r\n\tif ($arr[\"enabled\"] == \"yes\")\r\n\t\t$pics .= $arr[\"warned\"] == \"yes\" ? \"<img src=pic/$warnedpic alt=\\\"Warned\\\" border=0>\" : \"\";\r\n\telse\r\n\t\t$pics .= \"<img src=pic/$disabledpic alt=\\\"Disabled\\\" border=0 style=\\\"margin-left: 2pt\\\">\\n\";\r\n\treturn $pics;\r\n}\r\n*/\r\n\r\ndbconn();\r\nloggedinorreturn();\r\n\r\nif (get_user_class() < UC_MODERATOR)\r\n\tstderr($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n\r\nstdhead(\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\");\r\necho \"<h1>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd</h1>\\n\";\r\n\r\nif ($_GET['h'])\r\n{\r\n\tbegin_frame(\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd<font color=#009900> - \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</font>\");\r\n?>\r\n<ul>\r\n<li>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</li>\r\n<li>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd * \ufffd ? \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd, Email \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd, \ufffd\ufffd\ufffd-\ufffd\ufffd \ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd (\ufffd.\ufffd. 'wyz Max*' \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\r\n'wyz' \ufffd \ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd 'Max'. \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd '~' \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd, \ufffd.\ufffd. '~alfiest' \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\r\n\ufffd \ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd 'alfiest' \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd).</li>\r\n<li>\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd 'Inf' \ufffd '---' \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.</li>\r\n<li>\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd CIDR \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\r\n(\ufffd.\ufffd. 255.255.255.0 \ufffd\ufffd-\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd /24).</li>\r\n<li>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd GB.</li>\r\n<li>For search parameters with multiple text fields the second will be\r\nignored unless relevant for the type of search chosen.</li>\r\n<li>'\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd' \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd-\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd,\r\n'\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd IP' \ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd IP \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.</li>\r\n<li>The 'p' columns in the results show partial stats, that is, those\r\nof the torrents in progress.</li>\r\n<li>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd,\r\n\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd, \ufffd\ufffd\ufffd \ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\r\n<?\r\n\tend_frame();\r\n}\r\nelse\r\n{\r\n\techo \"<p align=center>(<a href='\".$_SERVER[\"PHP_SELF\"].\"?h=1'>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</a>)\";\r\n\techo \"&nbsp;-&nbsp;(<a href='\".$_SERVER[\"PHP_SELF\"].\"'>\ufffd\ufffd\ufffd\ufffd\ufffd</a>)</p>\\n\";\r\n}\r\n\r\n$highlight = \" bgcolor=#BBAF9B\";\r\n\r\n?>\r\n\r\n<form method=get action=<?=htmlspecialchars_uni($_SERVER[\"PHP_SELF\"]);?>>\r\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\">\r\n<tr>\r\n\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd:</td>\r\n  <td<?=$_GET['n']?$highlight:\"\"?>><input name=\"n\" type=\"text\" value=\"<?=$_GET['n']?>\" size=35></td>\r\n\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n  <td<?=$_GET['r']?$highlight:\"\"?>><select name=\"rt\">\r\n    <?\r\n\t$options = array(\"\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t    echo \"<option value=$i \".(($_GET['rt']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n\t}\r\n\t?>\r\n    </select>\r\n    <input name=\"r\" type=\"text\" value=\"<?=$_GET['r']?>\" size=\"5\" maxlength=\"4\">\r\n    <input name=\"r2\" type=\"text\" value=\"<?=$_GET['r2']?>\" size=\"5\" maxlength=\"4\"></td>\r\n\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n  <td<?=$_GET['st']?$highlight:\"\"?>><select name=\"st\">\r\n    <?\r\n\t$options = array(\"(\ufffd\ufffd\ufffd\ufffd\ufffd)\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t    echo \"<option value=$i \".(($_GET['st']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n\t}\r\n    ?>\r\n    </select></td></tr>\r\n<tr><td valign=\"middle\" class=rowhead>Email:</td>\r\n  <td<?=$_GET['em']?$highlight:\"\"?>><input name=\"em\" type=\"text\" value=\"<?=$_GET['em']?>\" size=\"35\"></td>\r\n  <td valign=\"middle\" class=rowhead>IP:</td>\r\n  <td<?=$_GET['ip']?$highlight:\"\"?>><input name=\"ip\" type=\"text\" value=\"<?=$_GET['ip']?>\" maxlength=\"17\"></td>\r\n\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n  <td<?=$_GET['as']?$highlight:\"\"?>><select name=\"as\">\r\n    <?\r\n    $options = array(\"(\ufffd\ufffd\ufffd\ufffd\ufffd)\",\"\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\");\r\n    for ($i = 0; $i < count($options); $i++){\r\n      echo \"<option value=$i \".(($_GET['as']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n    }\r\n    ?>\r\n    </select></td></tr>\r\n<tr>\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n  <td<?=$_GET['co']?$highlight:\"\"?>><input name=\"co\" type=\"text\" value=\"<?=$_GET['co']?>\" size=\"35\"></td>\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n  <td<?=$_GET['ma']?$highlight:\"\"?>><input name=\"ma\" type=\"text\" value=\"<?=$_GET['ma']?>\" maxlength=\"17\"></td>\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n  <td<?=($_GET['c'] && $_GET['c'] != 1)?$highlight:\"\"?>><select name=\"c\"><option value='1'>(\ufffd\ufffd\ufffd\ufffd\ufffd)</option>\r\n  <?\r\n  $class = $_GET['c'];\r\n  if (!is_valid_id($class))\r\n  \t$class = '';\r\n  for ($i = 2;;++$i) {\r\n\t\tif ($c = get_user_class_name($i-2))\r\n       \t print(\"<option value=\" . $i . ($class && $class == $i? \" selected\" : \"\") . \">$c</option>\\n\");\r\n\t  else\r\n\t   \tbreak;\r\n\t}\r\n\t?>\r\n    </select></td></tr>\r\n<tr>\r\n\r\n    <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n\r\n  <td<?=$_GET['d']?$highlight:\"\"?>><select name=\"dt\">\r\n    <?\r\n\t$options = array(\"\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t  echo \"<option value=$i \".(($_GET['dt']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n\t}\r\n    ?>\r\n    </select>\r\n\r\n    <input name=\"d\" type=\"text\" value=\"<?=$_GET['d']?>\" size=\"12\" maxlength=\"10\">\r\n\r\n    <input name=\"d2\" type=\"text\" value=\"<?=$_GET['d2']?>\" size=\"12\" maxlength=\"10\"></td>\r\n\r\n\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n\r\n  <td<?=$_GET['ul']?$highlight:\"\"?>><select name=\"ult\" id=\"ult\">\r\n    <?\r\n    $options = array(\"\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\");\r\n    for ($i = 0; $i < count($options); $i++){\r\n  \t  echo \"<option value=$i \".(($_GET['ult']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n    }\r\n    ?>\r\n    </select>\r\n\r\n    <input name=\"ul\" type=\"text\" id=\"ul\" size=\"8\" maxlength=\"7\" value=\"<?=$_GET['ul']?>\">\r\n\r\n    <input name=\"ul2\" type=\"text\" id=\"ul2\" size=\"8\" maxlength=\"7\" value=\"<?=$_GET['ul2']?>\"></td>\r\n  <td valign=\"middle\" class=\"rowhead\">\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n\r\n  <td<?=$_GET['do']?$highlight:\"\"?>><select name=\"do\">\r\n    <?\r\n    $options = array(\"(\ufffd\ufffd\ufffd\ufffd\ufffd)\",\"\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t  echo \"<option value=$i \".(($_GET['do']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n    }\r\n    ?>\r\n\t</select></td></tr>\r\n<tr>\r\n\r\n<td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n\r\n  <td <?=$_GET['ls']?$highlight:\"\"?>><select name=\"lst\">\r\n  <?\r\n  $options = array(\"\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\");\r\n  for ($i = 0; $i < count($options); $i++){\r\n    echo \"<option value=$i \".(($_GET['lst']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n  }\r\n  ?>\r\n  </select>\r\n\r\n  <input name=\"ls\" type=\"text\" value=\"<?=$_GET['ls']?>\" size=\"12\" maxlength=\"10\">\r\n\r\n  <input name=\"ls2\" type=\"text\" value=\"<?=$_GET['ls2']?>\" size=\"12\" maxlength=\"10\"></td>\r\n\t  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n\r\n  <td<?=$_GET['dl']?$highlight:\"\"?>><select name=\"dlt\" id=\"dlt\">\r\n  <?\r\n\t$options = array(\"\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t  echo \"<option value=$i \".(($_GET['dlt']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n\t}\r\n\t?>\r\n    </select>\r\n\r\n    <input name=\"dl\" type=\"text\" id=\"dl\" size=\"8\" maxlength=\"7\" value=\"<?=$_GET['dl']?>\">\r\n\r\n    <input name=\"dl2\" type=\"text\" id=\"dl2\" size=\"8\" maxlength=\"7\" value=\"<?=$_GET['dl2']?>\"></td>\r\n\r\n\t<td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n\r\n\t<td<?=$_GET['w']?$highlight:\"\"?>><select name=\"w\">\r\n  <?\r\n  $options = array(\"(\ufffd\ufffd\ufffd\ufffd\ufffd)\",\"\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t\techo \"<option value=$i \".(($_GET['w']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n  }\r\n  ?>\r\n\t</select></td></tr>\r\n\r\n<tr><td class=\"rowhead\"></td><td></td>\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd&nbsp;\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\r\n\t<td<?=$_GET['ac']?$highlight:\"\"?>><input name=\"ac\" type=\"checkbox\" value=\"1\" <?=($_GET['ac'])?\"checked\":\"\" ?>></td>\r\n  <td valign=\"middle\" class=rowhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd&nbsp;IP: </td>\r\n  <td<?=$_GET['dip']?$highlight:\"\"?>><input name=\"dip\" type=\"checkbox\" value=\"1\" <?=($_GET['dip'])?\"checked\":\"\" ?>></td>\r\n  </tr>\r\n<tr><td colspan=\"6\" align=center><input name=\"submit\" type=submit class=btn value=\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd></td></tr>\r\n</table>\r\n<br /><br />\r\n</form>\r\n\r\n<?\r\n\r\n// Validates date in the form [yy]yy-mm-dd;\r\n// Returns date if valid, 0 otherwise.\r\nfunction mkdate($date){\r\n  if (strpos($date,'-'))\r\n  \t$a = explode('-', $date);\r\n  elseif (strpos($date,'/'))\r\n  \t$a = explode('/', $date);\r\n  else\r\n  \treturn 0;\r\n  for ($i=0;$i<3;$i++)\r\n  \tif (!is_numeric($a[$i]))\r\n    \treturn 0;\r\n    if (checkdate($a[1], $a[2], $a[0]))\r\n    \treturn  date (\"Y-m-d\", mktime (0,0,0,$a[1],$a[2],$a[0]));\r\n    else\r\n\t\t\treturn 0;\r\n}\r\n\r\n// ratio as a string\r\nfunction ratios($up,$down, $color = True)\r\n{\r\n\tif ($down > 0)\r\n\t{\r\n\t\t$r = number_format($up / $down, 2);\r\n    if ($color)\r\n\t\t\t$r = \"<font color=\".get_ratio_color($r).\">$r</font>\";\r\n\t}\r\n\telse\r\n\t\tif ($up > 0)\r\n\t  \t$r = \"Inf.\";\r\n\t  else\r\n\t  \t$r = \"---\";\r\n\treturn $r;\r\n}\r\n\r\n// checks for the usual wildcards *, ? plus mySQL ones\r\nfunction haswildcard($text){\r\n\tif (strpos($text,'*') === False && strpos($text,'?') === False\r\n\t\t\t&& strpos($text,'%') === False && strpos($text,'_') === False)\r\n  \treturn False;\r\n  else\r\n  \treturn True;\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\nif (count($_GET) > 0 && !$_GET['h'])\r\n{\r\n\t// name\r\n  $names = explode(' ',trim($_GET['n']));\r\n  if ($names[0] !== \"\")\r\n  {\r\n\t\tforeach($names as $name)\r\n\t\t{\r\n\t  \tif (substr($name,0,1) == '~')\r\n\t  \t{\r\n      \tif ($name == '~') continue;\r\n   \t    $names_exc[] = substr($name,1);\r\n      }\r\n\t    else\r\n\t    \t$names_inc[] = $name;\r\n\t  }\r\n\r\n    if (is_array($names_inc))\r\n    {\r\n\t  \t$where_is .= isset($where_is)?\" AND (\":\"(\";\r\n\t    foreach($names_inc as $name)\r\n\t    {\r\n      \tif (!haswildcard($name))\r\n\t        $name_is .= (isset($name_is)?\" OR \":\"\").\"u.username = \".sqlesc($name);\r\n\t      else\r\n\t      {\r\n\t        $name = str_replace(array('?','*'), array('_','%'), $name);\r\n\t        $name_is .= (isset($name_is)?\" OR \":\"\").\"u.username LIKE \".sqlesc($name);\r\n\t      }\r\n\t    }\r\n      $where_is .= $name_is.\")\";\r\n      unset($name_is);\r\n\t  }\r\n\r\n    if (is_array($names_exc))\r\n    {\r\n\t  \t$where_is .= isset($where_is)?\" AND NOT (\":\" NOT (\";\r\n\t    foreach($names_exc as $name)\r\n\t    {\r\n\t    \tif (!haswildcard($name))\r\n\t      \t$name_is .= (isset($name_is)?\" OR \":\"\").\"u.username = \".sqlesc($name);\r\n\t      else\r\n\t      {\r\n\t      \t$name = str_replace(array('?','*'), array('_','%'), $name);\r\n\t        $name_is .= (isset($name_is)?\" OR \":\"\").\"u.username LIKE \".sqlesc($name);\r\n\t      }\r\n\t    }\r\n      $where_is .= $name_is.\")\";\r\n\t  }\r\n\t  $q .= ($q ? \"&amp;\" : \"\") . \"n=\".urlencode(trim($_GET['n']));\r\n  }\r\n\r\n  // email\r\n  $emaila = explode(' ', trim($_GET['em']));\r\n  if ($emaila[0] !== \"\")\r\n  {\r\n  \t$where_is .= isset($where_is)?\" AND (\":\"(\";\r\n    foreach($emaila as $email)\r\n    {\r\n\t  \tif (strpos($email,'*') === False && strpos($email,'?') === False\r\n\t    \t\t&& strpos($email,'%') === False)\r\n\t    {\r\n      \tif (validemail($email) !== 1)\r\n      \t{\r\n\t        stdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd E-mail.\");\r\n\t        stdfoot();\r\n\t      \tdie();\r\n\t      }\r\n\t      $email_is .= (isset($email_is)?\" OR \":\"\").\"u.email =\".sqlesc($email);\r\n      }\r\n      else\r\n      {\r\n\t    \t$sql_email = str_replace(array('?','*'), array('_','%'), $email);\r\n\t      $email_is .= (isset($email_is)?\" OR \":\"\").\"u.email LIKE \".sqlesc($sql_email);\r\n\t    }\r\n    }\r\n\t\t$where_is .= $email_is.\")\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"em=\".urlencode(trim($_GET['em']));\r\n  }\r\n\r\n  //class\r\n  // NB: the c parameter is passed as two units above the real one\r\n  $class = $_GET['c'] - 2;\r\n\tif (is_valid_id($class + 1))\r\n\t{\r\n  \t$where_is .= (isset($where_is)?\" AND \":\"\").\"u.class=$class\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"c=\".($class+2);\r\n  }\r\n\r\n  // IP\r\n  $ip = trim($_GET['ip']);\r\n  if ($ip)\r\n  {\r\n  \t$regex = \"/^(((1?\\d{1,2})|(2[0-4]\\d)|(25[0-5]))(\\.\\b|$)){4}$/\";\r\n    if (!preg_match($regex, $ip))\r\n    {\r\n    \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd IP.\");\r\n    \tstdfoot();\r\n    \tdie();\r\n    }\r\n\r\n    $mask = trim($_GET['ma']);\r\n    if ($mask == \"\" || $mask == \"255.255.255.255\")\r\n    \t$where_is .= (isset($where_is)?\" AND \":\"\").\"u.ip = '$ip'\";\r\n    else\r\n    {\r\n    \tif (substr($mask,0,1) == \"/\")\r\n    \t{\r\n      \t$n = substr($mask, 1, strlen($mask) - 1);\r\n        if (!is_numeric($n) or $n < 0 or $n > 32)\r\n        {\r\n        \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n        \tstdfoot();\r\n          die();\r\n        }\r\n        else\r\n\t      \t$mask = long2ip(pow(2,32) - pow(2,32-$n));\r\n      }\r\n      elseif (!preg_match($regex, $mask))\r\n      {\r\n\t\t\t\tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n\t\t\t\tstdfoot();\r\n\t      die();\r\n      }\r\n      $where_is .= (isset($where_is)?\" AND \":\"\").\"INET_ATON(u.ip) & INET_ATON('$mask') = INET_ATON('$ip') & INET_ATON('$mask')\";\r\n      $q .= ($q ? \"&amp;\" : \"\") . \"ma=$mask\";\r\n    }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ip=$ip\";\r\n  }\r\n\r\n  // ratio\r\n  $ratio = trim($_GET['r']);\r\n  if ($ratio)\r\n  {\r\n  \tif ($ratio == '---')\r\n  \t{\r\n    \t$ratio2 = \"\";\r\n      $where_is .= isset($where_is)?\" AND \":\"\";\r\n      $where_is .= \" u.uploaded = 0 and u.downloaded = 0\";\r\n    }\r\n    elseif (strtolower(substr($ratio,0,3)) == 'inf')\r\n    {\r\n    \t$ratio2 = \"\";\r\n      $where_is .= isset($where_is)?\" AND \":\"\";\r\n      $where_is .= \" u.uploaded > 0 and u.downloaded = 0\";\r\n    }\r\n    else\r\n    {\r\n    \tif (!is_numeric($ratio) || $ratio < 0)\r\n    \t{\r\n      \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      $where_is .= isset($where_is)?\" AND \":\"\";\r\n      $where_is .= \" (u.uploaded/u.downloaded)\";\r\n      $ratiotype = $_GET['rt'];\r\n      $q .= ($q ? \"&amp;\" : \"\") . \"rt=$ratiotype\";\r\n      if ($ratiotype == \"3\")\r\n      {\r\n      \t$ratio2 = trim($_GET['r2']);\r\n        if(!$ratio2)\r\n        {\r\n        \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n        \tstdfoot();\r\n          die();\r\n        }\r\n        if (!is_numeric($ratio2) or $ratio2 < $ratio)\r\n        {\r\n        \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n        \tstdfoot();\r\n        \tdie();\r\n        }\r\n        $where_is .= \" BETWEEN $ratio and $ratio2\";\r\n        $q .= ($q ? \"&amp;\" : \"\") . \"r2=$ratio2\";\r\n      }\r\n      elseif ($ratiotype == \"2\")\r\n      \t$where_is .= \" < $ratio\";\r\n      elseif ($ratiotype == \"1\")\r\n      \t$where_is .= \" > $ratio\";\r\n      else\r\n      \t$where_is .= \" BETWEEN ($ratio - 0.004) and ($ratio + 0.004)\";\r\n    }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"r=$ratio\";\r\n  }\r\n\r\n  // comment\r\n  $comments = explode(' ',trim($_GET['co']));\r\n  if ($comments[0] !== \"\")\r\n  {\r\n\t\tforeach($comments as $comment)\r\n\t\t{\r\n\t    if (substr($comment,0,1) == '~')\r\n\t    {\r\n      \tif ($comment == '~') continue;\r\n   \t    $comments_exc[] = substr($comment,1);\r\n      }\r\n      else\r\n\t    \t$comments_inc[] = $comment;\r\n\t  }\r\n\r\n    if (is_array($comments_inc))\r\n    {\r\n\t  \t$where_is .= isset($where_is)?\" AND (\":\"(\";\r\n\t    foreach($comments_inc as $comment)\r\n\t    {\r\n\t    \tif (!haswildcard($comment))\r\n\t\t    \t$comment_is .= (isset($comment_is)?\" OR \":\"\").\"u.modcomment LIKE \".sqlesc(\"%\".$comment.\"%\");\r\n        else\r\n        {\r\n\t      \t$comment = str_replace(array('?','*'), array('_','%'), $comment);\r\n\t        $comment_is .= (isset($comment_is)?\" OR \":\"\").\"u.modcomment LIKE \".sqlesc($comment);\r\n        }\r\n      }\r\n      $where_is .= $comment_is.\")\";\r\n      unset($comment_is);\r\n    }\r\n\r\n    if (is_array($comments_exc))\r\n    {\r\n\t  \t$where_is .= isset($where_is)?\" AND NOT (\":\" NOT (\";\r\n\t    foreach($comments_exc as $comment)\r\n\t    {\r\n\t    \tif (!haswildcard($comment))\r\n\t\t    \t$comment_is .= (isset($comment_is)?\" OR \":\"\").\"u.modcomment LIKE \".sqlesc(\"%\".$comment.\"%\");\r\n        else\r\n        {\r\n\t      \t$comment = str_replace(array('?','*'), array('_','%'), $comment);\r\n\t        $comment_is .= (isset($comment_is)?\" OR \":\"\").\"u.modcomment LIKE \".sqlesc($comment);\r\n\t      }\r\n      }\r\n      $where_is .= $comment_is.\")\";\r\n\t  }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"co=\".urlencode(trim($_GET['co']));\r\n  }\r\n\r\n  $unit = 1073741824;\t\t// 1GB\r\n\r\n  // uploaded\r\n  $ul = trim($_GET['ul']);\r\n  if ($ul)\r\n  {\r\n  \tif (!is_numeric($ul) || $ul < 0)\r\n  \t{\r\n    \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n    \tstdfoot();\r\n      die();\r\n    }\r\n    $where_is .= isset($where_is)?\" AND \":\"\";\r\n    $where_is .= \" u.uploaded \";\r\n    $ultype = $_GET['ult'];\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ult=$ultype\";\r\n    if ($ultype == \"3\")\r\n    {\r\n\t    $ul2 = trim($_GET['ul2']);\r\n    \tif(!$ul2)\r\n    \t{\r\n      \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      if (!is_numeric($ul2) or $ul2 < $ul)\r\n      {\r\n      \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      $where_is .= \" BETWEEN \".$ul*$unit.\" and \".$ul2*$unit;\r\n      $q .= ($q ? \"&amp;\" : \"\") . \"ul2=$ul2\";\r\n    }\r\n    elseif ($ultype == \"2\")\r\n    \t$where_is .= \" < \".$ul*$unit;\r\n    elseif ($ultype == \"1\")\r\n    \t$where_is .= \" >\". $ul*$unit;\r\n    else\r\n    \t$where_is .= \" BETWEEN \".($ul - 0.004)*$unit.\" and \".($ul + 0.004)*$unit;\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ul=$ul\";\r\n  }\r\n\r\n  // downloaded\r\n  $dl = trim($_GET['dl']);\r\n  if ($dl)\r\n  {\r\n  \tif (!is_numeric($dl) || $dl < 0)\r\n  \t{\r\n    \tstdmsg($tracker_lang['error'], \"Bad downloaded amount.\");\r\n    \tstdfoot();\r\n      die();\r\n    }\r\n    $where_is .= isset($where_is)?\" AND \":\"\";\r\n    $where_is .= \" u.downloaded \";\r\n    $dltype = $_GET['dlt'];\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"dlt=$dltype\";\r\n    if ($dltype == \"3\")\r\n    {\r\n    \t$dl2 = trim($_GET['dl2']);\r\n      if(!$dl2)\r\n      {\r\n      \tstdmsg($tracker_lang['error'], \"Two downloaded amounts needed for this type of search.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      if (!is_numeric($dl2) or $dl2 < $dl)\r\n      {\r\n      \tstdmsg($tracker_lang['error'], \"Bad second downloaded amount.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      $where_is .= \" BETWEEN \".$dl*$unit.\" and \".$dl2*$unit;\r\n      $q .= ($q ? \"&amp;\" : \"\") . \"dl2=$dl2\";\r\n    }\r\n    elseif ($dltype == \"2\")\r\n    \t$where_is .= \" < \".$dl*$unit;\r\n    elseif ($dltype == \"1\")\r\n     \t$where_is .= \" > \".$dl*$unit;\r\n    else\r\n     \t$where_is .= \" BETWEEN \".($dl - 0.004)*$unit.\" and \".($dl + 0.004)*$unit;\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"dl=$dl\";\r\n  }\r\n\r\n  // date joined\r\n  $date = trim($_GET['d']);\r\n  if ($date)\r\n  {\r\n  \tif (!$date = mkdate($date))\r\n  \t{\r\n    \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd.\");\r\n    \tstdfoot();\r\n      die();\r\n    }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"d=$date\";\r\n    $datetype = $_GET['dt'];\r\n\t\t$q .= ($q ? \"&amp;\" : \"\") . \"dt=$datetype\";\r\n    if ($datetype == \"0\")\r\n    // For mySQL 4.1.1 or above use instead\r\n    // $where_is .= (isset($where_is)?\" AND \":\"\").\"DATE(added) = DATE('$date')\";\r\n    $where_is .= (isset($where_is)?\" AND \":\"\").\r\n    \t\t\"(UNIX_TIMESTAMP(added) - UNIX_TIMESTAMP('$date')) BETWEEN 0 and 86400\";\r\n    else\r\n    {\r\n      $where_is .= (isset($where_is)?\" AND \":\"\").\"u.added \";\r\n      if ($datetype == \"3\")\r\n      {\r\n        $date2 = mkdate(trim($_GET['d2']));\r\n        if ($date2)\r\n        {\r\n          if (!$date = mkdate($date))\r\n          {\r\n            stdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd.\");\r\n            stdfoot();\r\n            die();\r\n          }\r\n          $q .= ($q ? \"&amp;\" : \"\") . \"d2=$date2\";\r\n          $where_is .= \" BETWEEN '$date' and '$date2'\";\r\n        }\r\n        else\r\n        {\r\n          stdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n          stdfoot();\r\n          die();\r\n        }\r\n      }\r\n      elseif ($datetype == \"1\")\r\n        $where_is .= \"< '$date'\";\r\n      elseif ($datetype == \"2\")\r\n        $where_is .= \"> '$date'\";\r\n    }\r\n  }\r\n\r\n\t// date last seen\r\n  $last = trim($_GET['ls']);\r\n  if ($last)\r\n  {\r\n  \tif (!$last = mkdate($last))\r\n  \t{\r\n    \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd.\");\r\n    \tstdfoot();\r\n      die();\r\n    }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ls=$last\";\r\n    $lasttype = $_GET['lst'];\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"lst=$lasttype\";\r\n    if ($lasttype == \"0\")\r\n    // For mySQL 4.1.1 or above use instead\r\n    // $where_is .= (isset($where_is)?\" AND \":\"\").\"DATE(added) = DATE('$date')\";\r\n    \t$where_is .= (isset($where_is)?\" AND \":\"\").\r\n      \t\t\"(UNIX_TIMESTAMP(last_access) - UNIX_TIMESTAMP('$last')) BETWEEN 0 and 86400\";\r\n    else\r\n    {\r\n    \t$where_is .= (isset($where_is)?\" AND \":\"\").\"u.last_access \";\r\n      if ($lasttype == \"3\")\r\n      {\r\n      \t$last2 = mkdate(trim($_GET['ls2']));\r\n        if ($last2)\r\n        {\r\n        \t$where_is .= \" BETWEEN '$last' and '$last2'\";\r\n\t        $q .= ($q ? \"&amp;\" : \"\") . \"ls2=$last2\";\r\n        }\r\n        else\r\n        {\r\n        \tstdmsg($tracker_lang['error'], \"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n        \tstdfoot();\r\n        \tdie();\r\n        }\r\n      }\r\n      elseif ($lasttype == \"1\")\r\n    \t\t$where_is .= \"< '$last'\";\r\n      elseif ($lasttype == \"2\")\r\n      \t$where_is .= \"> '$last'\";\r\n    }\r\n  }\r\n\r\n  // status\r\n  $status = $_GET['st'];\r\n  if ($status)\r\n  {\r\n  \t$where_is .= ((isset($where_is))?\" AND \":\"\");\r\n    if ($status == \"1\")\r\n    \t$where_is .= \"u.status = 'confirmed'\";\r\n    else\r\n    \t$where_is .= \"u.status = 'pending'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"st=$status\";\r\n  }\r\n\r\n  // account status\r\n  $accountstatus = $_GET['as'];\r\n  if ($accountstatus)\r\n  {\r\n  \t$where_is .= (isset($where_is))?\" AND \":\"\";\r\n    if ($accountstatus == \"1\")\r\n    \t$where_is .= \" u.enabled = 'yes'\";\r\n    else\r\n    \t$where_is .= \" u.enabled = 'no'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"as=$accountstatus\";\r\n  }\r\n\r\n  //donor\r\n\t$donor = $_GET['do'];\r\n  if ($donor)\r\n  {\r\n\t\t$where_is .= (isset($where_is))?\" AND \":\"\";\r\n    if ($donor == 1)\r\n    \t$where_is .= \" u.donor = 'yes'\";\r\n    else\r\n    \t$where_is .= \" u.donor = 'no'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"do=$donor\";\r\n  }\r\n\r\n  //warned\r\n\t$warned = $_GET['w'];\r\n  if ($warned)\r\n  {\r\n\t\t$where_is .= (isset($where_is))?\" AND \":\"\";\r\n    if ($warned == 1)\r\n    \t$where_is .= \" u.warned = 'yes'\";\r\n    else\r\n    \t$where_is .= \" u.warned = 'no'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"w=$warned\";\r\n  }\r\n\r\n  // disabled IP\r\n  $disabled = $_GET['dip'];\r\n  if ($disabled)\r\n  {\r\n  \t$distinct = \"DISTINCT \";\r\n    $join_is .= \" LEFT JOIN users AS u2 ON u.ip = u2.ip\";\r\n\t\t$where_is .= ((isset($where_is))?\" AND \":\"\").\"u2.enabled = 'no'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"dip=$disabled\";\r\n  }\r\n\r\n  // active\r\n  $active = $_GET['ac'];\r\n  if ($active == \"1\")\r\n  {\r\n  \t$distinct = \"DISTINCT \";\r\n    $join_is .= \" LEFT JOIN peers AS p ON u.id = p.userid\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ac=$active\";\r\n  }\r\n\r\n\r\n  $from_is = \"users AS u\".$join_is;\r\n  $distinct = isset($distinct)?$distinct:\"\";\r\n\r\n  $queryc = \"SELECT COUNT(\".$distinct.\"u.id) FROM \".$from_is.\r\n  \t\t(($where_is == \"\")?\"\":\" WHERE $where_is \");\r\n\r\n  $querypm = \"FROM \".$from_is.(($where_is == \"\")?\" \":\" WHERE $where_is \");\r\n\r\n  $select_is = \"u.id, u.username, u.email, u.status, u.added, u.last_access, u.ip,\r\n  \tu.class, u.uploaded, u.downloaded, u.donor, u.modcomment, u.enabled, u.warned\";\r\n\r\n  $query = \"SELECT \".$distinct.\" \".$select_is.\" \".$querypm;\r\n\r\n//    <temporary>    /////////////////////////////////////////////////////\r\n  if ($DEBUG_MODE > 0)\r\n  {\r\n  \tstdmsg(\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",$queryc);\r\n    echo \"<BR><BR>\";\r\n    stdmsg(\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",$query);\r\n    echo \"<BR><BR>\";\r\n    stdmsg(\"URL \",$q);\r\n    if ($DEBUG_MODE == 2)\r\n    \tdie();\r\n    echo \"<BR><BR>\";\r\n  }\r\n//    </temporary>   /////////////////////////////////////////////////////\r\n\r\n  $res = sql_query($queryc) or sqlerr(__FILE__, __LINE__);\r\n  $arr = mysql_fetch_row($res);\r\n  $count = $arr[0];\r\n\r\n  $q = isset($q)?($q.\"&amp;\"):\"\";\r\n\r\n  $perpage = 30;\r\n\r\n  list($pagertop, $pagerbottom, $limit) = pager($perpage, $count, $_SERVER[\"PHP_SELF\"].\"?\".$q);\r\n\r\n  $query .= $limit;\r\n\r\n  $res = sql_query($query) or sqlerr(__FILE__, __LINE__);\r\n\r\n  if (mysql_num_rows($res) == 0)\r\n  \tstdmsg(\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\",\"\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd \ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd.\");\r\n  else\r\n  {\r\n  \tif ($count > $perpage)\r\n  \t\techo $pagertop;\r\n    echo \"<table border=1 cellspacing=0 cellpadding=5>\\n\";\r\n    echo \"<tr><td class=colhead align=left>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</td>\r\n    \t\t<td class=colhead align=left>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</td>\r\n        <td class=colhead align=left>IP</td>\r\n        <td class=colhead align=left>Email</td>\".\r\n        \"<td class=colhead align=left>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\".\r\n        \"<td class=colhead align=left>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd:</td>\".\r\n        \"<td class=colhead align=left>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</td>\".\r\n        \"<td class=colhead align=left>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</td>\".\r\n        \"<td class=colhead>pR</td>\".\r\n        \"<td class=colhead>pUL</td>\".\r\n        \"<td class=colhead>pDL</td>\".\r\n        \"<td class=colhead>\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd</td></tr>\";\r\n    while ($user = mysql_fetch_array($res))\r\n    {\r\n    \tif ($user['added'] == '0000-00-00 00:00:00')\r\n      \t$user['added'] = '---';\r\n      if ($user['last_access'] == '0000-00-00 00:00:00')\r\n      \t$user['last_access'] = '---';\r\n\r\n      if ($user['ip'])\r\n      {\r\n\t    \t$nip = ip2long($user['ip']);\r\n        $auxres = sql_query(\"SELECT COUNT(*) FROM bans WHERE $nip >= first AND $nip <= last\") or sqlerr(__FILE__, __LINE__);\r\n        $array = mysql_fetch_row($auxres);\r\n    \t  if ($array[0] == 0)\r\n      \t\t$ipstr = $user['ip'];\r\n\t  \t  else\r\n\t      \t$ipstr = \"<a href='testip.php?ip=\" . $user['ip'] . \"'><font color='#FF0000'><b>\" . $user['ip'] . \"</b></font></a>\";\r\n\t\t\t}\r\n\t\t\telse\r\n      \t$ipstr = \"---\";\r\n\r\n      $auxres = sql_query(\"SELECT SUM(uploaded) AS pul, SUM(downloaded) AS pdl FROM peers WHERE userid = \" . $user['id']) or sqlerr(__FILE__, __LINE__);\r\n      $array = mysql_fetch_array($auxres);\r\n\r\n      $pul = $array['pul'];\r\n      $pdl = $array['pdl'];\r\n\r\n      $n_posts = $n[0];\r\n\r\n      $auxres = sql_query(\"SELECT COUNT(id) FROM comments WHERE user = \".$user['id']) or sqlerr(__FILE__, __LINE__);\r\n\t\t\t// Use LEFT JOIN to exclude orphan comments\r\n      // $auxres = sql_query(\"SELECT COUNT(c.id) FROM comments AS c LEFT JOIN torrents as t ON c.torrent = t.id WHERE c.user = '\".$user['id'].\"'\") or sqlerr(__FILE__, __LINE__);\r\n      $n = mysql_fetch_row($auxres);\r\n      $n_comments = $n[0];\r\n\r\n    \techo \"<tr><td><b><a href='userdetails.php?id=\" . $user['id'] . \"'>\" .\r\n      \t\t$user['username'].\"</a></b>\" . get_user_icons($user) . \"</td>\" .\r\n//      \t\t($user[\"donor\"] == \"yes\" ? \"<img src=pic/star.gif alt=\\\"Donor\\\">\" : \"\") .\r\n//\t\t\t\t\t($user[\"warned\"] == \"yes\" ? \"<img src=\\\"pic/warned.gif\\\" alt=\\\"Warned\\\">\" : \"\") . \"</td>\r\n          \"<td>\" . ratios($user['uploaded'], $user['downloaded']) . \"</td>\r\n          <td>\" . $ipstr . \"</td><td>\" . $user['email'] . \"</td>\r\n          <td><div align=center>\" . $user['added'] . \"</div></td>\r\n          <td><div align=center>\" . $user['last_access'] . \"</div></td>\r\n          <td><div align=center>\" . $user['status'] . \"</div></td>\r\n          <td><div align=center>\" . $user['enabled'].\"</div></td>\r\n          <td><div align=center>\" . ratios($pul,$pdl) . \"</div></td>\" .\r\n          \"<td><div align=right>\" . mksize($pul) . \"</div></td>\r\n          <td><div align=right>\" . mksize($pdl) . \"</div></td>\".\r\n          \"<td><div align=right>\".($n_comments?\"<a href=userhistory.php?action=viewcomments&id=\".$user['id'].\">$n_comments</a>\":$n_comments).\"</div></td>\".\r\n          \"</tr>\\n\";\r\n    }\r\n    echo \"</table>\";\r\n    if ($count > $perpage)\r\n    \techo \"$pagerbottom\";\r\n\r\n?>\r\n    <br /><br />\r\n    <form method=post action=message.php> \r\n      <table border=\"1\" cellpadding=\"5\" cellspacing=\"0\"> \r\n        <tr> \r\n          <td> \r\n            <div align=\"center\"> \r\n            \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd \ufffd\ufffd\ufffd\ufffd\ufffd\ufffd<br /> \r\n              <input name=\"pmees\" type=\"hidden\" value=\"<?echo $querypm?>\" size=10> \r\n              <input name=\"PM\" type=\"submit\" value=\"PM\" class=btn> \r\n              <input name=\"n_pms\" type=\"hidden\" value=\"<?echo $count?>\" size=10> \r\n              <input name=\"action\" type=\"hidden\" value=\"mass_pm\" size=10> \r\n            </div></td> \r\n        </tr> \r\n      </table> \r\n    </form>\r\n<?\r\n\r\n  }\r\n}\r\n\r\nprint(\"<p>$pagemenu<br />$browsemenu</p>\");\r\nstdfoot();\r\ndie;\r\n\r\n?>"], "fixing_code": ["<?\r\n\r\n/*\r\n// +--------------------------------------------------------------------------+\r\n// | Project:    TBDevYSE - TBDev Yuna Scatari Edition                        |\r\n// +--------------------------------------------------------------------------+\r\n// | This file is part of TBDevYSE. TBDevYSE is based on TBDev,               |\r\n// | originally by RedBeard of TorrentBits, extensively modified by           |\r\n// | Gartenzwerg.                                                             |\r\n// |                                                                          |\r\n// | TBDevYSE is free software; you can redistribute it and/or modify         |\r\n// | it under the terms of the GNU General Public License as published by     |\r\n// | the Free Software Foundation; either version 2 of the License, or        |\r\n// | (at your option) any later version.                                      |\r\n// |                                                                          |\r\n// | TBDevYSE is distributed in the hope that it will be useful,              |\r\n// | but WITHOUT ANY WARRANTY; without even the implied warranty of           |\r\n// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            |\r\n// | GNU General Public License for more details.                             |\r\n// |                                                                          |\r\n// | You should have received a copy of the GNU General Public License        |\r\n// | along with TBDevYSE; if not, write to the Free Software Foundation,      |\r\n// | Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA            |\r\n// +--------------------------------------------------------------------------+\r\n// |                                               Do not remove above lines! |\r\n// +--------------------------------------------------------------------------+\r\n*/\r\n\r\nrequire \"include/bittorrent.php\";\r\n\r\n// 0 - No debug; 1 - Show and run SQL query; 2 - Show SQL query only\r\n$DEBUG_MODE = 0;\r\n/*\r\nfunction get_user_icons($arr, $big = false)\r\n{\r\n\tif ($big)\r\n\t{\r\n\t\t$donorpic = \"starbig.gif\";\r\n\t\t$warnedpic = \"warnedbig.gif\";\r\n\t\t$disabledpic = \"disabledbig.gif\";\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$donorpic = \"star.gif\";\r\n\t\t$warnedpic = \"warned.gif\";\r\n\t\t$disabledpic = \"disabled.gif\";\r\n\t}\r\n\t$pics = $arr[\"donor\"] == \"yes\" ? \"<img src=pic/$donorpic alt='Donor' border=0 style=\\\"margin-left: 2pt\\\">\" : \"\";\r\n\tif ($arr[\"enabled\"] == \"yes\")\r\n\t\t$pics .= $arr[\"warned\"] == \"yes\" ? \"<img src=pic/$warnedpic alt=\\\"Warned\\\" border=0>\" : \"\";\r\n\telse\r\n\t\t$pics .= \"<img src=pic/$disabledpic alt=\\\"Disabled\\\" border=0 style=\\\"margin-left: 2pt\\\">\\n\";\r\n\treturn $pics;\r\n}\r\n*/\r\n\r\ndbconn();\r\nloggedinorreturn();\r\n\r\nif (get_user_class() < UC_MODERATOR)\r\n\tstderr($tracker_lang['error'], \"\u041e\u0442\u043a\u0430\u0437\u0430\u043d\u043e \u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0435.\");\r\n\r\nstdhead(\"\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0439 \u043f\u043e\u0438\u0441\u043a\");\r\necho \"<h1>\u0410\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0439 \u043f\u043e\u0438\u0441\u043a</h1>\\n\";\r\n\r\nif ($_GET['h'])\r\n{\r\n\tbegin_frame(\"\u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f<font color=#009900> - \u0427\u0438\u0442\u0430\u0442\u044c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e</font>\");\r\n?>\r\n<ul>\r\n<li>\u041f\u0443\u0441\u0442\u044b\u0435 \u043f\u043e\u043b\u044f \u0431\u0443\u0434\u0443\u0442 \u043f\u0440\u043e\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b</li>\r\n<li>\u0428\u0430\u0431\u043b\u043e\u043d\u044b * \u0438 ? \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u044b \u0432 \u0418\u043c\u0435\u043d\u0438, Email \u0438 \u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u044f\u0445, \u0442\u0430\u043a-\u0436\u0435 \u0438 \u0432 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u0445 \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u043c\u0438 \u043f\u0440\u043e\u0431\u0435\u043b\u0430\u043c\u0438 (\u0442.\u0435. 'wyz Max*' \u0432 \u0418\u043c\u0435\u043d\u0438 \u0432\u044b\u0432\u0435\u0434\u0435\u0442 \u043e\u0431\u043e\u0438\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439\r\n'wyz' \u0438 \u0442\u0435\u0445 \u0443 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0438\u043c\u0435\u043d\u0430 \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0442\u044c\u0441\u044f \u043d\u0430 'Max'. \u041f\u043e\u0445\u043e\u0436\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0430 '~' \u0434\u043b\u044f \u043e\u0442\u0440\u0438\u0446\u0430\u043d\u0438\u044f, \u0442.\u0435. '~alfiest' \u0432 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u044f\u0445 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0442 \u043f\u043e\u0438\u0441\u043a \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439\r\n\u043a \u0442\u0435\u043c \u0443 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043d\u0435\u0442\u0443 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f 'alfiest' \u0432 \u0438\u0445\u043d\u0438\u0445 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u044f\u0445).</li>\r\n<li>\u041f\u043e\u043b\u0435 \u0420\u0435\u0439\u0442\u0438\u043d\u0433 \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 'Inf' \u0438 '---' \u043d\u0430\u0440\u0430\u0432\u043d\u0435 \u0441 \u0447\u0438\u0441\u043b\u043e\u0432\u044b\u043c\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\u043c\u0438.</li>\r\n<li>\u041c\u0430\u0441\u043a\u0430 \u043f\u043e\u0434\u0441\u0435\u0442\u0438 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u0432\u0435\u0434\u0435\u043d\u0430 \u0438\u043b\u0438 \u0432 \u0434\u0435\u0441\u044f\u0442\u0438\u0447\u043d\u043e \u0442\u043e\u0447\u0435\u0447\u043d\u043e\u0439 \u0438\u043b\u0438 CIDR \u0437\u0430\u043f\u0438\u0441\u0438\r\n(\u0442.\u0435. 255.255.255.0 \u0442\u043e-\u0436\u0435 \u0441\u0430\u043c\u043e\u0435 \u0447\u0442\u043e \u0438 /24).</li>\r\n<li>\u0420\u0430\u0437\u0434\u0430\u043b \u0438 \u0421\u043a\u0430\u0447\u0430\u043b \u0432\u0432\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 GB.</li>\r\n<li>For search parameters with multiple text fields the second will be\r\nignored unless relevant for the type of search chosen.</li>\r\n<li>'\u0422\u043e\u043b\u044c\u043a\u043e \u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0445' \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0432\u0430\u0435\u0442 \u043f\u043e\u0438\u0441\u043a \u043a \u0442\u0435\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\u043c \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0441\u0435\u0439\u0447\u0430\u0441 \u0447\u0442\u043e-\u0442\u043e \u043a\u0430\u0447\u0430\u044e\u0442 \u0438\u043b\u0438 \u0440\u0430\u0437\u0434\u0430\u044e\u0442,\r\n'\u041e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u044b\u0435 IP' \u043a \u0442\u0435\u043c \u0447\u044c\u0438 IP \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u044b.</li>\r\n<li>The 'p' columns in the results show partial stats, that is, those\r\nof the torrents in progress.</li>\r\n<li>\u041a\u043e\u043b\u043e\u043d\u043a\u0430 \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u0441\u0442\u043e\u0432 \u0432 \u0444\u043e\u0440\u0443\u043c\u0435 \u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432 \u043a \u0442\u043e\u0440\u0440\u0435\u043d\u0442\u0430\u043c,\r\n\u0441\u043e\u043e\u0442\u0432\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e, \u043a\u0430\u043a \u0438 \u0432\u0435\u0434\u0435\u0442 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0438\u0441\u0442\u043e\u0440\u0438\u0438.\r\n<?\r\n\tend_frame();\r\n}\r\nelse\r\n{\r\n\techo \"<p align=center>(<a href='\".$_SERVER[\"PHP_SELF\"].\"?h=1'>\u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f</a>)\";\r\n\techo \"&nbsp;-&nbsp;(<a href='\".$_SERVER[\"PHP_SELF\"].\"'>\u0421\u0431\u0440\u043e\u0441</a>)</p>\\n\";\r\n}\r\n\r\n$highlight = \" bgcolor=#BBAF9B\";\r\n\r\n?>\r\n\r\n<form method=get action=<?=htmlspecialchars_uni($_SERVER[\"PHP_SELF\"]);?>>\r\n<table border=\"1\" cellspacing=\"0\" cellpadding=\"5\">\r\n<tr>\r\n\r\n  <td valign=\"middle\" class=rowhead>\u0418\u043c\u044f:</td>\r\n  <td<?=$_GET['n']?$highlight:\"\"?>><input name=\"n\" type=\"text\" value=\"<?=htmlspecialchars_uni($_GET['n'])?>\" size=35></td>\r\n\r\n  <td valign=\"middle\" class=rowhead>\u0420\u0435\u0439\u0442\u0438\u043d\u0433:</td>\r\n  <td<?=$_GET['r']?$highlight:\"\"?>><select name=\"rt\">\r\n    <?\r\n\t$options = array(\"\u0440\u0430\u0432\u0435\u043d\",\"\u0432\u044b\u0448\u0435\",\"\u043d\u0438\u0436\u0435\",\"\u043c\u0435\u0436\u0434\u0443\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t    echo \"<option value=$i \".(($_GET['rt']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n\t}\r\n\t?>\r\n    </select>\r\n    <input name=\"r\" type=\"text\" value=\"<?=floatval($_GET['r'])?>\" size=\"5\" maxlength=\"4\">\r\n    <input name=\"r2\" type=\"text\" value=\"<?=floatval($_GET['r2'])?>\" size=\"5\" maxlength=\"4\"></td>\r\n\r\n  <td valign=\"middle\" class=rowhead>\u0421\u0442\u0430\u0442\u0443\u0441:</td>\r\n  <td<?=$_GET['st']?$highlight:\"\"?>><select name=\"st\">\r\n    <?\r\n\t$options = array(\"(\u041b\u044e\u0431\u043e\u0439)\",\"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\",\"\u041d\u0435 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t    echo \"<option value=$i \".(($_GET['st']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n\t}\r\n    ?>\r\n    </select></td></tr>\r\n<tr><td valign=\"middle\" class=rowhead>Email:</td>\r\n  <td<?=$_GET['em']?$highlight:\"\"?>><input name=\"em\" type=\"text\" value=\"<?=htmlspecialchars_uni($_GET['em'])?>\" size=\"35\"></td>\r\n  <td valign=\"middle\" class=rowhead>IP:</td>\r\n  <td<?=$_GET['ip']?$highlight:\"\"?>><input name=\"ip\" type=\"text\" value=\"<?=htmlspecialchars_uni($_GET['ip'])?>\" maxlength=\"17\"></td>\r\n\r\n  <td valign=\"middle\" class=rowhead>\u041e\u0442\u043a\u043b\u044e\u0447\u0435\u043d:</td>\r\n  <td<?=$_GET['as']?$highlight:\"\"?>><select name=\"as\">\r\n    <?\r\n    $options = array(\"(\u041b\u044e\u0431\u043e\u0439)\",\"\u041d\u0435\u0442\",\"\u0414\u0430\");\r\n    for ($i = 0; $i < count($options); $i++){\r\n      echo \"<option value=$i \".(($_GET['as']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n    }\r\n    ?>\r\n    </select></td></tr>\r\n<tr>\r\n  <td valign=\"middle\" class=rowhead>\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439:</td>\r\n  <td<?=$_GET['co']?$highlight:\"\"?>><input name=\"co\" type=\"text\" value=\"<?=htmlspecialchars_uni($_GET['co'])?>\" size=\"35\"></td>\r\n  <td valign=\"middle\" class=rowhead>\u041c\u0430\u0441\u043a\u0430:</td>\r\n  <td<?=$_GET['ma']?$highlight:\"\"?>><input name=\"ma\" type=\"text\" value=\"<?=htmlspecialchars_uni($_GET['ma'])?>\" maxlength=\"17\"></td>\r\n  <td valign=\"middle\" class=rowhead>\u041a\u043b\u0430\u0441\u0441:</td>\r\n  <td<?=($_GET['c'] && $_GET['c'] != 1)?$highlight:\"\"?>><select name=\"c\"><option value='1'>(\u041b\u044e\u0431\u043e\u0439)</option>\r\n  <?\r\n  $class = $_GET['c'];\r\n  if (!is_valid_id($class))\r\n  \t$class = '';\r\n  for ($i = 2;;++$i) {\r\n\t\tif ($c = get_user_class_name($i-2))\r\n       \t print(\"<option value=\" . $i . ($class && $class == $i? \" selected\" : \"\") . \">$c</option>\\n\");\r\n\t  else\r\n\t   \tbreak;\r\n\t}\r\n\t?>\r\n    </select></td></tr>\r\n<tr>\r\n\r\n    <td valign=\"middle\" class=rowhead>\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f:</td>\r\n\r\n  <td<?=$_GET['d']?$highlight:\"\"?>><select name=\"dt\">\r\n    <?\r\n\t$options = array(\"\u0432\",\"\u0440\u0430\u043d\u044c\u0448\u0435\",\"\u043f\u043e\u0441\u043b\u0435\",\"\u043c\u0435\u0436\u0434\u0443\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t  echo \"<option value=$i \".(($_GET['dt']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n\t}\r\n    ?>\r\n    </select>\r\n\r\n    <input name=\"d\" type=\"text\" value=\"<?=htmlspecialchars_uni($_GET['d'])?>\" size=\"12\" maxlength=\"10\">\r\n\r\n    <input name=\"d2\" type=\"text\" value=\"<?=htmlspecialchars_uni($_GET['d2'])?>\" size=\"12\" maxlength=\"10\"></td>\r\n\r\n\r\n  <td valign=\"middle\" class=rowhead>\u0420\u0430\u0437\u0434\u0430\u043b:</td>\r\n\r\n  <td<?=$_GET['ul']?$highlight:\"\"?>><select name=\"ult\" id=\"ult\">\r\n    <?\r\n    $options = array(\"\u0440\u043e\u0432\u043d\u043e\",\"\u0431\u043e\u043b\u044c\u0448\u0435\",\"\u043c\u0435\u043d\u044c\u0448\u0435\",\"\u043c\u0435\u0436\u0434\u0443\");\r\n    for ($i = 0; $i < count($options); $i++){\r\n  \t  echo \"<option value=$i \".(($_GET['ult']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n    }\r\n    ?>\r\n    </select>\r\n\r\n    <input name=\"ul\" type=\"text\" id=\"ul\" size=\"8\" maxlength=\"7\" value=\"<?=intval($_GET['ul'])?>\">\r\n\r\n    <input name=\"ul2\" type=\"text\" id=\"ul2\" size=\"8\" maxlength=\"7\" value=\"<?=intval($_GET['ul2'])?>\"></td>\r\n  <td valign=\"middle\" class=\"rowhead\">\u0414\u043e\u043d\u043e\u0440:</td>\r\n\r\n  <td<?=$_GET['do']?$highlight:\"\"?>><select name=\"do\">\r\n    <?\r\n    $options = array(\"(\u041b\u044e\u0431\u043e\u0439)\",\"\u0414\u0430\",\"\u041d\u0435\u0442\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t  echo \"<option value=$i \".(($_GET['do']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n    }\r\n    ?>\r\n\t</select></td></tr>\r\n<tr>\r\n\r\n<td valign=\"middle\" class=rowhead>\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u044c:</td>\r\n\r\n  <td <?=$_GET['ls']?$highlight:\"\"?>><select name=\"lst\">\r\n  <?\r\n  $options = array(\"\u0432\",\"\u0440\u0430\u043d\u044c\u0448\u0435\",\"\u043f\u043e\u0441\u043b\u0435\",\"\u043c\u0435\u0436\u0434\u0443\");\r\n  for ($i = 0; $i < count($options); $i++){\r\n    echo \"<option value=$i \".(($_GET['lst']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n  }\r\n  ?>\r\n  </select>\r\n\r\n  <input name=\"ls\" type=\"text\" value=\"<?=intval($_GET['ls'])?>\" size=\"12\" maxlength=\"10\">\r\n\r\n  <input name=\"ls2\" type=\"text\" value=\"<?=intval($_GET['ls2'])?>\" size=\"12\" maxlength=\"10\"></td>\r\n\t  <td valign=\"middle\" class=rowhead>\u0421\u043a\u0430\u0447\u0430\u043b:</td>\r\n\r\n  <td<?=$_GET['dl']?$highlight:\"\"?>><select name=\"dlt\" id=\"dlt\">\r\n  <?\r\n\t$options = array(\"\u0440\u043e\u0432\u043d\u043e\",\"\u0431\u043e\u043b\u044c\u0448\u0435\",\"\u043c\u0435\u043d\u044c\u0448\u0435\",\"\u043c\u0435\u0436\u0434\u0443\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t  echo \"<option value=$i \".(($_GET['dlt']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n\t}\r\n\t?>\r\n    </select>\r\n\r\n    <input name=\"dl\" type=\"text\" id=\"dl\" size=\"8\" maxlength=\"7\" value=\"<?=intval($_GET['dl'])?>\">\r\n\r\n    <input name=\"dl2\" type=\"text\" id=\"dl2\" size=\"8\" maxlength=\"7\" value=\"<?=intval($_GET['dl2'])?>\"></td>\r\n\r\n\t<td valign=\"middle\" class=rowhead>\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d:</td>\r\n\r\n\t<td<?=$_GET['w']?$highlight:\"\"?>><select name=\"w\">\r\n  <?\r\n  $options = array(\"(\u041b\u044e\u0431\u043e\u0439)\",\"\u0414\u0430\",\"\u041d\u0435\u0442\");\r\n\tfor ($i = 0; $i < count($options); $i++){\r\n\t\techo \"<option value=$i \".(($_GET['w']==\"$i\")?\"selected\":\"\").\">\".$options[$i].\"</option>\\n\";\r\n  }\r\n  ?>\r\n\t</select></td></tr>\r\n\r\n<tr><td class=\"rowhead\"></td><td></td>\r\n  <td valign=\"middle\" class=rowhead>\u0422\u043e\u043b\u044c\u043a\u043e&nbsp;\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0435:</td>\r\n\t<td<?=$_GET['ac']?$highlight:\"\"?>><input name=\"ac\" type=\"checkbox\" value=\"1\" <?=($_GET['ac'])?\"checked\":\"\" ?>></td>\r\n  <td valign=\"middle\" class=rowhead>\u0417\u0430\u0431\u0430\u043d\u0435\u043d\u044b\u0435&nbsp;IP: </td>\r\n  <td<?=$_GET['dip']?$highlight:\"\"?>><input name=\"dip\" type=\"checkbox\" value=\"1\" <?=($_GET['dip'])?\"checked\":\"\" ?>></td>\r\n  </tr>\r\n<tr><td colspan=\"6\" align=center><input name=\"submit\" type=submit class=btn value=\u0418\u0441\u043a\u0430\u0442\u044c></td></tr>\r\n</table>\r\n<br /><br />\r\n</form>\r\n\r\n<?\r\n\r\n// Validates date in the form [yy]yy-mm-dd;\r\n// Returns date if valid, 0 otherwise.\r\nfunction mkdate($date){\r\n  if (strpos($date,'-'))\r\n  \t$a = explode('-', $date);\r\n  elseif (strpos($date,'/'))\r\n  \t$a = explode('/', $date);\r\n  else\r\n  \treturn 0;\r\n  for ($i=0;$i<3;$i++)\r\n  \tif (!is_numeric($a[$i]))\r\n    \treturn 0;\r\n    if (checkdate($a[1], $a[2], $a[0]))\r\n    \treturn  date (\"Y-m-d\", mktime (0,0,0,$a[1],$a[2],$a[0]));\r\n    else\r\n\t\t\treturn 0;\r\n}\r\n\r\n// ratio as a string\r\nfunction ratios($up,$down, $color = True)\r\n{\r\n\tif ($down > 0)\r\n\t{\r\n\t\t$r = number_format($up / $down, 2);\r\n    if ($color)\r\n\t\t\t$r = \"<font color=\".get_ratio_color($r).\">$r</font>\";\r\n\t}\r\n\telse\r\n\t\tif ($up > 0)\r\n\t  \t$r = \"Inf.\";\r\n\t  else\r\n\t  \t$r = \"---\";\r\n\treturn $r;\r\n}\r\n\r\n// checks for the usual wildcards *, ? plus mySQL ones\r\nfunction haswildcard($text){\r\n\tif (strpos($text,'*') === False && strpos($text,'?') === False\r\n\t\t\t&& strpos($text,'%') === False && strpos($text,'_') === False)\r\n  \treturn False;\r\n  else\r\n  \treturn True;\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\nif (count($_GET) > 0 && !$_GET['h'])\r\n{\r\n\t// name\r\n  $names = explode(' ',trim($_GET['n']));\r\n  if ($names[0] !== \"\")\r\n  {\r\n\t\tforeach($names as $name)\r\n\t\t{\r\n\t  \tif (substr($name,0,1) == '~')\r\n\t  \t{\r\n      \tif ($name == '~') continue;\r\n   \t    $names_exc[] = substr($name,1);\r\n      }\r\n\t    else\r\n\t    \t$names_inc[] = $name;\r\n\t  }\r\n\r\n    if (is_array($names_inc))\r\n    {\r\n\t  \t$where_is .= isset($where_is)?\" AND (\":\"(\";\r\n\t    foreach($names_inc as $name)\r\n\t    {\r\n      \tif (!haswildcard($name))\r\n\t        $name_is .= (isset($name_is)?\" OR \":\"\").\"u.username = \".sqlesc($name);\r\n\t      else\r\n\t      {\r\n\t        $name = str_replace(array('?','*'), array('_','%'), $name);\r\n\t        $name_is .= (isset($name_is)?\" OR \":\"\").\"u.username LIKE \".sqlesc($name);\r\n\t      }\r\n\t    }\r\n      $where_is .= $name_is.\")\";\r\n      unset($name_is);\r\n\t  }\r\n\r\n    if (is_array($names_exc))\r\n    {\r\n\t  \t$where_is .= isset($where_is)?\" AND NOT (\":\" NOT (\";\r\n\t    foreach($names_exc as $name)\r\n\t    {\r\n\t    \tif (!haswildcard($name))\r\n\t      \t$name_is .= (isset($name_is)?\" OR \":\"\").\"u.username = \".sqlesc($name);\r\n\t      else\r\n\t      {\r\n\t      \t$name = str_replace(array('?','*'), array('_','%'), $name);\r\n\t        $name_is .= (isset($name_is)?\" OR \":\"\").\"u.username LIKE \".sqlesc($name);\r\n\t      }\r\n\t    }\r\n      $where_is .= $name_is.\")\";\r\n\t  }\r\n\t  $q .= ($q ? \"&amp;\" : \"\") . \"n=\".urlencode(trim($_GET['n']));\r\n  }\r\n\r\n  // email\r\n  $emaila = explode(' ', trim($_GET['em']));\r\n  if ($emaila[0] !== \"\")\r\n  {\r\n  \t$where_is .= isset($where_is)?\" AND (\":\"(\";\r\n    foreach($emaila as $email)\r\n    {\r\n\t  \tif (strpos($email,'*') === False && strpos($email,'?') === False\r\n\t    \t\t&& strpos($email,'%') === False)\r\n\t    {\r\n      \tif (validemail($email) !== 1)\r\n      \t{\r\n\t        stdmsg($tracker_lang['error'], \"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 E-mail.\");\r\n\t        stdfoot();\r\n\t      \tdie();\r\n\t      }\r\n\t      $email_is .= (isset($email_is)?\" OR \":\"\").\"u.email =\".sqlesc($email);\r\n      }\r\n      else\r\n      {\r\n\t    \t$sql_email = str_replace(array('?','*'), array('_','%'), $email);\r\n\t      $email_is .= (isset($email_is)?\" OR \":\"\").\"u.email LIKE \".sqlesc($sql_email);\r\n\t    }\r\n    }\r\n\t\t$where_is .= $email_is.\")\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"em=\".urlencode(trim($_GET['em']));\r\n  }\r\n\r\n  //class\r\n  // NB: the c parameter is passed as two units above the real one\r\n  $class = $_GET['c'] - 2;\r\n\tif (is_valid_id($class + 1))\r\n\t{\r\n  \t$where_is .= (isset($where_is)?\" AND \":\"\").\"u.class=$class\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"c=\".($class+2);\r\n  }\r\n\r\n  // IP\r\n  $ip = trim($_GET['ip']);\r\n  if ($ip)\r\n  {\r\n  \t$regex = \"/^(((1?\\d{1,2})|(2[0-4]\\d)|(25[0-5]))(\\.\\b|$)){4}$/\";\r\n    if (!preg_match($regex, $ip))\r\n    {\r\n    \tstdmsg($tracker_lang['error'], \"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 IP.\");\r\n    \tstdfoot();\r\n    \tdie();\r\n    }\r\n\r\n    $mask = trim($_GET['ma']);\r\n    if ($mask == \"\" || $mask == \"255.255.255.255\")\r\n    \t$where_is .= (isset($where_is)?\" AND \":\"\").\"u.ip = '$ip'\";\r\n    else\r\n    {\r\n    \tif (substr($mask,0,1) == \"/\")\r\n    \t{\r\n      \t$n = substr($mask, 1, strlen($mask) - 1);\r\n        if (!is_numeric($n) or $n < 0 or $n > 32)\r\n        {\r\n        \tstdmsg($tracker_lang['error'], \"\u041d\u0435\u0432\u0435\u0440\u043d\u0430\u044f \u043c\u0430\u0441\u043a\u0430 \u043f\u043e\u0434\u0441\u0435\u0442\u0438.\");\r\n        \tstdfoot();\r\n          die();\r\n        }\r\n        else\r\n\t      \t$mask = long2ip(pow(2,32) - pow(2,32-$n));\r\n      }\r\n      elseif (!preg_match($regex, $mask))\r\n      {\r\n\t\t\t\tstdmsg($tracker_lang['error'], \"\u041d\u0435\u0432\u0435\u0440\u043d\u0430\u044f \u043c\u0430\u0441\u043a\u0430 \u043f\u043e\u0434\u0441\u0435\u0442\u0438.\");\r\n\t\t\t\tstdfoot();\r\n\t      die();\r\n      }\r\n      $where_is .= (isset($where_is)?\" AND \":\"\").\"INET_ATON(u.ip) & INET_ATON('$mask') = INET_ATON('$ip') & INET_ATON('$mask')\";\r\n      $q .= ($q ? \"&amp;\" : \"\") . \"ma=$mask\";\r\n    }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ip=$ip\";\r\n  }\r\n\r\n  // ratio\r\n  $ratio = trim($_GET['r']);\r\n  if ($ratio)\r\n  {\r\n  \tif ($ratio == '---')\r\n  \t{\r\n    \t$ratio2 = \"\";\r\n      $where_is .= isset($where_is)?\" AND \":\"\";\r\n      $where_is .= \" u.uploaded = 0 and u.downloaded = 0\";\r\n    }\r\n    elseif (strtolower(substr($ratio,0,3)) == 'inf')\r\n    {\r\n    \t$ratio2 = \"\";\r\n      $where_is .= isset($where_is)?\" AND \":\"\";\r\n      $where_is .= \" u.uploaded > 0 and u.downloaded = 0\";\r\n    }\r\n    else\r\n    {\r\n    \tif (!is_numeric($ratio) || $ratio < 0)\r\n    \t{\r\n      \tstdmsg($tracker_lang['error'], \"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      $where_is .= isset($where_is)?\" AND \":\"\";\r\n      $where_is .= \" (u.uploaded/u.downloaded)\";\r\n      $ratiotype = $_GET['rt'];\r\n      $q .= ($q ? \"&amp;\" : \"\") . \"rt=$ratiotype\";\r\n      if ($ratiotype == \"3\")\r\n      {\r\n      \t$ratio2 = trim($_GET['r2']);\r\n        if(!$ratio2)\r\n        {\r\n        \tstdmsg($tracker_lang['error'], \"\u041d\u0443\u0436\u043d\u044b \u0434\u0432\u0430 \u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0430 \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0442\u0438\u043f\u0430 \u043f\u043e\u0438\u0441\u043a\u0430.\");\r\n        \tstdfoot();\r\n          die();\r\n        }\r\n        if (!is_numeric($ratio2) or $ratio2 < $ratio)\r\n        {\r\n        \tstdmsg($tracker_lang['error'], \"\u041f\u043b\u043e\u0445\u043e\u0439 \u0432\u0442\u043e\u0440\u043e\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433.\");\r\n        \tstdfoot();\r\n        \tdie();\r\n        }\r\n        $where_is .= \" BETWEEN $ratio and $ratio2\";\r\n        $q .= ($q ? \"&amp;\" : \"\") . \"r2=$ratio2\";\r\n      }\r\n      elseif ($ratiotype == \"2\")\r\n      \t$where_is .= \" < $ratio\";\r\n      elseif ($ratiotype == \"1\")\r\n      \t$where_is .= \" > $ratio\";\r\n      else\r\n      \t$where_is .= \" BETWEEN ($ratio - 0.004) and ($ratio + 0.004)\";\r\n    }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"r=$ratio\";\r\n  }\r\n\r\n  // comment\r\n  $comments = explode(' ',trim($_GET['co']));\r\n  if ($comments[0] !== \"\")\r\n  {\r\n\t\tforeach($comments as $comment)\r\n\t\t{\r\n\t    if (substr($comment,0,1) == '~')\r\n\t    {\r\n      \tif ($comment == '~') continue;\r\n   \t    $comments_exc[] = substr($comment,1);\r\n      }\r\n      else\r\n\t    \t$comments_inc[] = $comment;\r\n\t  }\r\n\r\n    if (is_array($comments_inc))\r\n    {\r\n\t  \t$where_is .= isset($where_is)?\" AND (\":\"(\";\r\n\t    foreach($comments_inc as $comment)\r\n\t    {\r\n\t    \tif (!haswildcard($comment))\r\n\t\t    \t$comment_is .= (isset($comment_is)?\" OR \":\"\").\"u.modcomment LIKE \".sqlesc(\"%\".$comment.\"%\");\r\n        else\r\n        {\r\n\t      \t$comment = str_replace(array('?','*'), array('_','%'), $comment);\r\n\t        $comment_is .= (isset($comment_is)?\" OR \":\"\").\"u.modcomment LIKE \".sqlesc($comment);\r\n        }\r\n      }\r\n      $where_is .= $comment_is.\")\";\r\n      unset($comment_is);\r\n    }\r\n\r\n    if (is_array($comments_exc))\r\n    {\r\n\t  \t$where_is .= isset($where_is)?\" AND NOT (\":\" NOT (\";\r\n\t    foreach($comments_exc as $comment)\r\n\t    {\r\n\t    \tif (!haswildcard($comment))\r\n\t\t    \t$comment_is .= (isset($comment_is)?\" OR \":\"\").\"u.modcomment LIKE \".sqlesc(\"%\".$comment.\"%\");\r\n        else\r\n        {\r\n\t      \t$comment = str_replace(array('?','*'), array('_','%'), $comment);\r\n\t        $comment_is .= (isset($comment_is)?\" OR \":\"\").\"u.modcomment LIKE \".sqlesc($comment);\r\n\t      }\r\n      }\r\n      $where_is .= $comment_is.\")\";\r\n\t  }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"co=\".urlencode(trim($_GET['co']));\r\n  }\r\n\r\n  $unit = 1073741824;\t\t// 1GB\r\n\r\n  // uploaded\r\n  $ul = trim($_GET['ul']);\r\n  if ($ul)\r\n  {\r\n  \tif (!is_numeric($ul) || $ul < 0)\r\n  \t{\r\n    \tstdmsg($tracker_lang['error'], \"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0437\u0430\u043b\u0438\u0442\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438.\");\r\n    \tstdfoot();\r\n      die();\r\n    }\r\n    $where_is .= isset($where_is)?\" AND \":\"\";\r\n    $where_is .= \" u.uploaded \";\r\n    $ultype = $_GET['ult'];\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ult=$ultype\";\r\n    if ($ultype == \"3\")\r\n    {\r\n\t    $ul2 = trim($_GET['ul2']);\r\n    \tif(!$ul2)\r\n    \t{\r\n      \tstdmsg($tracker_lang['error'], \"\u041d\u0443\u0436\u043d\u044b \u0434\u0432\u0430 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u0437\u0430\u043b\u0438\u0442\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0442\u0438\u043f\u0430 \u043f\u043e\u0438\u0441\u043a\u0430.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      if (!is_numeric($ul2) or $ul2 < $ul)\r\n      {\r\n      \tstdmsg($tracker_lang['error'], \"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u0432\u0442\u043e\u0440\u043e\u0439 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0437\u0430\u043b\u0438\u0442\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      $where_is .= \" BETWEEN \".$ul*$unit.\" and \".$ul2*$unit;\r\n      $q .= ($q ? \"&amp;\" : \"\") . \"ul2=$ul2\";\r\n    }\r\n    elseif ($ultype == \"2\")\r\n    \t$where_is .= \" < \".$ul*$unit;\r\n    elseif ($ultype == \"1\")\r\n    \t$where_is .= \" >\". $ul*$unit;\r\n    else\r\n    \t$where_is .= \" BETWEEN \".($ul - 0.004)*$unit.\" and \".($ul + 0.004)*$unit;\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ul=$ul\";\r\n  }\r\n\r\n  // downloaded\r\n  $dl = trim($_GET['dl']);\r\n  if ($dl)\r\n  {\r\n  \tif (!is_numeric($dl) || $dl < 0)\r\n  \t{\r\n    \tstdmsg($tracker_lang['error'], \"Bad downloaded amount.\");\r\n    \tstdfoot();\r\n      die();\r\n    }\r\n    $where_is .= isset($where_is)?\" AND \":\"\";\r\n    $where_is .= \" u.downloaded \";\r\n    $dltype = $_GET['dlt'];\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"dlt=$dltype\";\r\n    if ($dltype == \"3\")\r\n    {\r\n    \t$dl2 = trim($_GET['dl2']);\r\n      if(!$dl2)\r\n      {\r\n      \tstdmsg($tracker_lang['error'], \"Two downloaded amounts needed for this type of search.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      if (!is_numeric($dl2) or $dl2 < $dl)\r\n      {\r\n      \tstdmsg($tracker_lang['error'], \"Bad second downloaded amount.\");\r\n      \tstdfoot();\r\n        die();\r\n      }\r\n      $where_is .= \" BETWEEN \".$dl*$unit.\" and \".$dl2*$unit;\r\n      $q .= ($q ? \"&amp;\" : \"\") . \"dl2=$dl2\";\r\n    }\r\n    elseif ($dltype == \"2\")\r\n    \t$where_is .= \" < \".$dl*$unit;\r\n    elseif ($dltype == \"1\")\r\n     \t$where_is .= \" > \".$dl*$unit;\r\n    else\r\n     \t$where_is .= \" BETWEEN \".($dl - 0.004)*$unit.\" and \".($dl + 0.004)*$unit;\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"dl=$dl\";\r\n  }\r\n\r\n  // date joined\r\n  $date = trim($_GET['d']);\r\n  if ($date)\r\n  {\r\n  \tif (!$date = mkdate($date))\r\n  \t{\r\n    \tstdmsg($tracker_lang['error'], \"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u0434\u0430\u0442\u0430.\");\r\n    \tstdfoot();\r\n      die();\r\n    }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"d=$date\";\r\n    $datetype = $_GET['dt'];\r\n\t\t$q .= ($q ? \"&amp;\" : \"\") . \"dt=$datetype\";\r\n    if ($datetype == \"0\")\r\n    // For mySQL 4.1.1 or above use instead\r\n    // $where_is .= (isset($where_is)?\" AND \":\"\").\"DATE(added) = DATE('$date')\";\r\n    $where_is .= (isset($where_is)?\" AND \":\"\").\r\n    \t\t\"(UNIX_TIMESTAMP(added) - UNIX_TIMESTAMP('$date')) BETWEEN 0 and 86400\";\r\n    else\r\n    {\r\n      $where_is .= (isset($where_is)?\" AND \":\"\").\"u.added \";\r\n      if ($datetype == \"3\")\r\n      {\r\n        $date2 = mkdate(trim($_GET['d2']));\r\n        if ($date2)\r\n        {\r\n          if (!$date = mkdate($date))\r\n          {\r\n            stdmsg($tracker_lang['error'], \"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u0434\u0430\u0442\u0430.\");\r\n            stdfoot();\r\n            die();\r\n          }\r\n          $q .= ($q ? \"&amp;\" : \"\") . \"d2=$date2\";\r\n          $where_is .= \" BETWEEN '$date' and '$date2'\";\r\n        }\r\n        else\r\n        {\r\n          stdmsg($tracker_lang['error'], \"\u041d\u0443\u0436\u043d\u044b \u0434\u0432\u0435 \u0434\u0430\u0442\u044b \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0442\u0438\u043f\u0430 \u043f\u043e\u0438\u0441\u043a\u0430.\");\r\n          stdfoot();\r\n          die();\r\n        }\r\n      }\r\n      elseif ($datetype == \"1\")\r\n        $where_is .= \"< '$date'\";\r\n      elseif ($datetype == \"2\")\r\n        $where_is .= \"> '$date'\";\r\n    }\r\n  }\r\n\r\n\t// date last seen\r\n  $last = trim($_GET['ls']);\r\n  if ($last)\r\n  {\r\n  \tif (!$last = mkdate($last))\r\n  \t{\r\n    \tstdmsg($tracker_lang['error'], \"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u0430\u044f \u0434\u0430\u0442\u0430.\");\r\n    \tstdfoot();\r\n      die();\r\n    }\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ls=$last\";\r\n    $lasttype = $_GET['lst'];\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"lst=$lasttype\";\r\n    if ($lasttype == \"0\")\r\n    // For mySQL 4.1.1 or above use instead\r\n    // $where_is .= (isset($where_is)?\" AND \":\"\").\"DATE(added) = DATE('$date')\";\r\n    \t$where_is .= (isset($where_is)?\" AND \":\"\").\r\n      \t\t\"(UNIX_TIMESTAMP(last_access) - UNIX_TIMESTAMP('$last')) BETWEEN 0 and 86400\";\r\n    else\r\n    {\r\n    \t$where_is .= (isset($where_is)?\" AND \":\"\").\"u.last_access \";\r\n      if ($lasttype == \"3\")\r\n      {\r\n      \t$last2 = mkdate(trim($_GET['ls2']));\r\n        if ($last2)\r\n        {\r\n        \t$where_is .= \" BETWEEN '$last' and '$last2'\";\r\n\t        $q .= ($q ? \"&amp;\" : \"\") . \"ls2=$last2\";\r\n        }\r\n        else\r\n        {\r\n        \tstdmsg($tracker_lang['error'], \"\u0412\u0442\u043e\u0440\u0430\u044f \u0434\u0430\u0442\u0430 \u043d\u0435\u0432\u0435\u0440\u043d\u0430.\");\r\n        \tstdfoot();\r\n        \tdie();\r\n        }\r\n      }\r\n      elseif ($lasttype == \"1\")\r\n    \t\t$where_is .= \"< '$last'\";\r\n      elseif ($lasttype == \"2\")\r\n      \t$where_is .= \"> '$last'\";\r\n    }\r\n  }\r\n\r\n  // status\r\n  $status = $_GET['st'];\r\n  if ($status)\r\n  {\r\n  \t$where_is .= ((isset($where_is))?\" AND \":\"\");\r\n    if ($status == \"1\")\r\n    \t$where_is .= \"u.status = 'confirmed'\";\r\n    else\r\n    \t$where_is .= \"u.status = 'pending'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"st=$status\";\r\n  }\r\n\r\n  // account status\r\n  $accountstatus = $_GET['as'];\r\n  if ($accountstatus)\r\n  {\r\n  \t$where_is .= (isset($where_is))?\" AND \":\"\";\r\n    if ($accountstatus == \"1\")\r\n    \t$where_is .= \" u.enabled = 'yes'\";\r\n    else\r\n    \t$where_is .= \" u.enabled = 'no'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"as=$accountstatus\";\r\n  }\r\n\r\n  //donor\r\n\t$donor = $_GET['do'];\r\n  if ($donor)\r\n  {\r\n\t\t$where_is .= (isset($where_is))?\" AND \":\"\";\r\n    if ($donor == 1)\r\n    \t$where_is .= \" u.donor = 'yes'\";\r\n    else\r\n    \t$where_is .= \" u.donor = 'no'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"do=$donor\";\r\n  }\r\n\r\n  //warned\r\n\t$warned = $_GET['w'];\r\n  if ($warned)\r\n  {\r\n\t\t$where_is .= (isset($where_is))?\" AND \":\"\";\r\n    if ($warned == 1)\r\n    \t$where_is .= \" u.warned = 'yes'\";\r\n    else\r\n    \t$where_is .= \" u.warned = 'no'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"w=$warned\";\r\n  }\r\n\r\n  // disabled IP\r\n  $disabled = $_GET['dip'];\r\n  if ($disabled)\r\n  {\r\n  \t$distinct = \"DISTINCT \";\r\n    $join_is .= \" LEFT JOIN users AS u2 ON u.ip = u2.ip\";\r\n\t\t$where_is .= ((isset($where_is))?\" AND \":\"\").\"u2.enabled = 'no'\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"dip=$disabled\";\r\n  }\r\n\r\n  // active\r\n  $active = $_GET['ac'];\r\n  if ($active == \"1\")\r\n  {\r\n  \t$distinct = \"DISTINCT \";\r\n    $join_is .= \" LEFT JOIN peers AS p ON u.id = p.userid\";\r\n    $q .= ($q ? \"&amp;\" : \"\") . \"ac=$active\";\r\n  }\r\n\r\n\r\n  $from_is = \"users AS u\".$join_is;\r\n  $distinct = isset($distinct)?$distinct:\"\";\r\n\r\n  $queryc = \"SELECT COUNT(\".$distinct.\"u.id) FROM \".$from_is.\r\n  \t\t(($where_is == \"\")?\"\":\" WHERE $where_is \");\r\n\r\n  $querypm = \"FROM \".$from_is.(($where_is == \"\")?\" \":\" WHERE $where_is \");\r\n\r\n  $select_is = \"u.id, u.username, u.email, u.status, u.added, u.last_access, u.ip,\r\n  \tu.class, u.uploaded, u.downloaded, u.donor, u.modcomment, u.enabled, u.warned\";\r\n\r\n  $query = \"SELECT \".$distinct.\" \".$select_is.\" \".$querypm;\r\n\r\n//    <temporary>    /////////////////////////////////////////////////////\r\n  if ($DEBUG_MODE > 0)\r\n  {\r\n  \tstdmsg(\"\u0417\u0430\u043f\u0440\u043e\u0441 \u043f\u043e\u0434\u0441\u0447\u0435\u0442\u0430\",$queryc);\r\n    echo \"<BR><BR>\";\r\n    stdmsg(\"\u041f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441\",$query);\r\n    echo \"<BR><BR>\";\r\n    stdmsg(\"URL \",$q);\r\n    if ($DEBUG_MODE == 2)\r\n    \tdie();\r\n    echo \"<BR><BR>\";\r\n  }\r\n//    </temporary>   /////////////////////////////////////////////////////\r\n\r\n  $res = sql_query($queryc) or sqlerr(__FILE__, __LINE__);\r\n  $arr = mysql_fetch_row($res);\r\n  $count = $arr[0];\r\n\r\n  $q = isset($q)?($q.\"&amp;\"):\"\";\r\n\r\n  $perpage = 30;\r\n\r\n  list($pagertop, $pagerbottom, $limit) = pager($perpage, $count, $_SERVER[\"PHP_SELF\"].\"?\".$q);\r\n\r\n  $query .= $limit;\r\n\r\n  $res = sql_query($query) or sqlerr(__FILE__, __LINE__);\r\n\r\n  if (mysql_num_rows($res) == 0)\r\n  \tstdmsg(\"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435\",\"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0431\u044b\u043b \u043d\u0430\u0439\u0434\u0435\u043d.\");\r\n  else\r\n  {\r\n  \tif ($count > $perpage)\r\n  \t\techo $pagertop;\r\n    echo \"<table border=1 cellspacing=0 cellpadding=5>\\n\";\r\n    echo \"<tr><td class=colhead align=left>\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c</td>\r\n    \t\t<td class=colhead align=left>\u0420\u0435\u0439\u0442\u0438\u043d\u0433</td>\r\n        <td class=colhead align=left>IP</td>\r\n        <td class=colhead align=left>Email</td>\".\r\n        \"<td class=colhead align=left>\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f:</td>\".\r\n        \"<td class=colhead align=left>\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u044f\u044f \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u044c:</td>\".\r\n        \"<td class=colhead align=left>\u0421\u0442\u0430\u0442\u0443\u0441</td>\".\r\n        \"<td class=colhead align=left>\u0412\u043a\u043b\u044e\u0447\u0435\u043d</td>\".\r\n        \"<td class=colhead>pR</td>\".\r\n        \"<td class=colhead>pUL</td>\".\r\n        \"<td class=colhead>pDL</td>\".\r\n        \"<td class=colhead>\u0418\u0441\u0442\u043e\u0440\u0438\u044f</td></tr>\";\r\n    while ($user = mysql_fetch_array($res))\r\n    {\r\n    \tif ($user['added'] == '0000-00-00 00:00:00')\r\n      \t$user['added'] = '---';\r\n      if ($user['last_access'] == '0000-00-00 00:00:00')\r\n      \t$user['last_access'] = '---';\r\n\r\n      if ($user['ip'])\r\n      {\r\n\t    \t$nip = ip2long($user['ip']);\r\n        $auxres = sql_query(\"SELECT COUNT(*) FROM bans WHERE $nip >= first AND $nip <= last\") or sqlerr(__FILE__, __LINE__);\r\n        $array = mysql_fetch_row($auxres);\r\n    \t  if ($array[0] == 0)\r\n      \t\t$ipstr = $user['ip'];\r\n\t  \t  else\r\n\t      \t$ipstr = \"<a href='testip.php?ip=\" . $user['ip'] . \"'><font color='#FF0000'><b>\" . $user['ip'] . \"</b></font></a>\";\r\n\t\t\t}\r\n\t\t\telse\r\n      \t$ipstr = \"---\";\r\n\r\n      $auxres = sql_query(\"SELECT SUM(uploaded) AS pul, SUM(downloaded) AS pdl FROM peers WHERE userid = \" . $user['id']) or sqlerr(__FILE__, __LINE__);\r\n      $array = mysql_fetch_array($auxres);\r\n\r\n      $pul = $array['pul'];\r\n      $pdl = $array['pdl'];\r\n\r\n      $n_posts = $n[0];\r\n\r\n      $auxres = sql_query(\"SELECT COUNT(id) FROM comments WHERE user = \".$user['id']) or sqlerr(__FILE__, __LINE__);\r\n\t\t\t// Use LEFT JOIN to exclude orphan comments\r\n      // $auxres = sql_query(\"SELECT COUNT(c.id) FROM comments AS c LEFT JOIN torrents as t ON c.torrent = t.id WHERE c.user = '\".$user['id'].\"'\") or sqlerr(__FILE__, __LINE__);\r\n      $n = mysql_fetch_row($auxres);\r\n      $n_comments = $n[0];\r\n\r\n    \techo \"<tr><td><b><a href='userdetails.php?id=\" . $user['id'] . \"'>\" .\r\n      \t\t$user['username'].\"</a></b>\" . get_user_icons($user) . \"</td>\" .\r\n//      \t\t($user[\"donor\"] == \"yes\" ? \"<img src=pic/star.gif alt=\\\"Donor\\\">\" : \"\") .\r\n//\t\t\t\t\t($user[\"warned\"] == \"yes\" ? \"<img src=\\\"pic/warned.gif\\\" alt=\\\"Warned\\\">\" : \"\") . \"</td>\r\n          \"<td>\" . ratios($user['uploaded'], $user['downloaded']) . \"</td>\r\n          <td>\" . $ipstr . \"</td><td>\" . $user['email'] . \"</td>\r\n          <td><div align=center>\" . $user['added'] . \"</div></td>\r\n          <td><div align=center>\" . $user['last_access'] . \"</div></td>\r\n          <td><div align=center>\" . $user['status'] . \"</div></td>\r\n          <td><div align=center>\" . $user['enabled'].\"</div></td>\r\n          <td><div align=center>\" . ratios($pul,$pdl) . \"</div></td>\" .\r\n          \"<td><div align=right>\" . mksize($pul) . \"</div></td>\r\n          <td><div align=right>\" . mksize($pdl) . \"</div></td>\".\r\n          \"<td><div align=right>\".($n_comments?\"<a href=userhistory.php?action=viewcomments&id=\".$user['id'].\">$n_comments</a>\":$n_comments).\"</div></td>\".\r\n          \"</tr>\\n\";\r\n    }\r\n    echo \"</table>\";\r\n    if ($count > $perpage)\r\n    \techo \"$pagerbottom\";\r\n\r\n?>\r\n    <br /><br />\r\n    <form method=post action=message.php> \r\n      <table border=\"1\" cellpadding=\"5\" cellspacing=\"0\"> \r\n        <tr> \r\n          <td> \r\n            <div align=\"center\"> \r\n            \u0420\u0430\u0441\u0441\u044b\u043b\u043a\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u043c \u044e\u0437\u0435\u0440\u0430\u043c<br /> \r\n              <input name=\"pmees\" type=\"hidden\" value=\"<?echo $querypm?>\" size=10> \r\n              <input name=\"PM\" type=\"submit\" value=\"PM\" class=btn> \r\n              <input name=\"n_pms\" type=\"hidden\" value=\"<?echo $count?>\" size=10> \r\n              <input name=\"action\" type=\"hidden\" value=\"mass_pm\" size=10> \r\n            </div></td> \r\n        </tr> \r\n      </table> \r\n    </form>\r\n<?\r\n\r\n  }\r\n}\r\n\r\nprint(\"<p>$pagemenu<br />$browsemenu</p>\");\r\nstdfoot();\r\ndie;\r\n\r\n?>"], "filenames": ["usersearch.php"], "buggy_code_start_loc": [61], "buggy_code_end_loc": [906], "fixing_code_start_loc": [61], "fixing_code_end_loc": [906], "type": "CWE-79", "message": "A vulnerability has been found in Yuna Scatari TBDev up to 2.1.17 and classified as problematic. Affected by this vulnerability is the function get_user_icons of the file usersearch.php. The manipulation of the argument n/r/r2/em/ip/co/ma/d/d2/ul/ul2/ls/ls2/dl/dl2 leads to cross site scripting. The attack can be launched remotely. Upgrading to version 2.1.18 is able to address this issue. The name of the patch is 0ba3fd4be29dd48fa4455c236a9403b3149a4fd4. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-217147.", "other": {"cve": {"id": "CVE-2014-125027", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-31T16:15:08.650", "lastModified": "2023-01-09T15:05:52.733", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability has been found in Yuna Scatari TBDev up to 2.1.17 and classified as problematic. Affected by this vulnerability is the function get_user_icons of the file usersearch.php. The manipulation of the argument n/r/r2/em/ip/co/ma/d/d2/ul/ul2/ls/ls2/dl/dl2 leads to cross site scripting. The attack can be launched remotely. Upgrading to version 2.1.18 is able to address this issue. The name of the patch is 0ba3fd4be29dd48fa4455c236a9403b3149a4fd4. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-217147."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:tbdev_project:tbdev:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.1.18", "matchCriteriaId": "439649A9-B9A7-479F-A452-9F1903BD4508"}]}]}], "references": [{"url": "https://github.com/yunasc/tbdev/commit/0ba3fd4be29dd48fa4455c236a9403b3149a4fd4", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/yunasc/tbdev/releases/tag/v2.1.18", "source": "cna@vuldb.com", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217147", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.217147", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/yunasc/tbdev/commit/0ba3fd4be29dd48fa4455c236a9403b3149a4fd4"}}