{"buggy_code": ["<h1><?php include(erLhcoreClassDesign::designtpl('lhfile/titles/configuration.tpl.php'));?></h1>\r\n\r\n<?php if (isset($errors)) : ?>\r\n\t<?php include(erLhcoreClassDesign::designtpl('lhkernel/validation_error.tpl.php'));?>\r\n<?php endif; ?>\r\n\r\n<?php if (isset($updated) && $updated == 'done') : $msg = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Settings updated'); ?>\r\n\t<?php include(erLhcoreClassDesign::designtpl('lhkernel/alert_success.tpl.php'));?>\r\n<?php endif; ?>\r\n\r\n<form action=\"\" ng-non-bindable method=\"post\">\r\n\r\n    <div class=\"row\">\r\n        <div class=\"col-6\">\r\n            <div class=\"form-group\">\r\n                <label><input type=\"checkbox\" name=\"ActiveFileUploadUser\" value=\"on\" <?php isset($file_data['active_user_upload']) && ($file_data['active_user_upload'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Files upload for users is active'); ?></label>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-6\">\r\n            <div class=\"form-group\">\r\n                <label><input type=\"checkbox\" name=\"AllowOnlyOneFileUpload\" value=\"on\" <?php isset($file_data['one_file_upload']) && ($file_data['one_file_upload'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Allow visitor to choose only one file for the upload'); ?></label>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-6\">\r\n            <div class=\"form-group\">\r\n                <label><input type=\"checkbox\" name=\"ActiveFileUploadAdmin\" value=\"on\" <?php isset($file_data['active_admin_upload']) && ($file_data['active_admin_upload'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Files upload for operators is active'); ?></label>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-6\">\r\n            <div class=\"form-group\">\r\n                <label><input type=\"checkbox\" name=\"removeMetaTag\" value=\"on\" <?php isset($file_data['remove_meta']) && ($file_data['remove_meta'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Remove meta information from images'); ?></label>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n<div class=\"row form-group\">\r\n\t<div class=\"col-md-6\">\r\n\t\t<label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Allowed files types for operators'); ?></label>\r\n\t\t<input type=\"text\" class=\"form-control\" name=\"AllowedFileTypes\" value=\"<?php isset($file_data['ft_op']) ? print $file_data['ft_op'] : '' ?>\" />\r\n\t</div>\r\n\t<div class=\"col-md-6\">\r\n\t\t<label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Allowed files types for users'); ?></label>\r\n\t\t<input type=\"text\" class=\"form-control\" name=\"AllowedFileTypesUser\" value=\"<?php isset($file_data['ft_us']) ? print $file_data['ft_us'] : '' ?>\" />\r\n\t</div>\r\n</div>\r\n\r\n<div class=\"row form-group\">\r\n\t<div class=\"col-md-6\">\r\n\t\t<label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Maximum file size in KB'); ?></label>\r\n\t\t<input type=\"text\" class=\"form-control\" name=\"MaximumFileSize\" value=\"<?php isset($file_data['fs_max']) ? print $file_data['fs_max'] : '' ?>\" />\r\n\t</div>\r\n</div>\r\n\r\n    <h3><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','ClamAV antivirus configuration'); ?></h3>\r\n\r\n    <div class=\"form-group\">\r\n        <label><input type=\"checkbox\" name=\"AntivirusFileScanEnabled\" value=\"on\" <?php isset($file_data['clamav_enabled']) && ($file_data['clamav_enabled'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Uploaded files from visitors are scanned'); ?></label>\r\n    </div>\r\n\r\n    <div class=\"row form-group\">\r\n        <div class=\"col-md-6\">\r\n            <label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','ClamAV socket path'); ?></label>\r\n            <input type=\"text\" class=\"form-control\" name=\"ClamAVSocketPath\" value=\"<?php isset($file_data['clamd_sock']) ? print $file_data['clamd_sock'] : print '/var/run/clamav/clamd.sock' ?>\" />\r\n        </div>\r\n        <div class=\"col-md-6\">\r\n            <label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','ClamAV socket length'); ?></label>\r\n            <input type=\"text\" class=\"form-control\" name=\"ClamAVSocketLength\" value=\"<?php isset($file_data['clamd_sock_len']) ? print $file_data['clamd_sock_len'] : print '20000' ?>\" />\r\n        </div>\r\n    </div>\r\n\r\n    <hr>\r\n\r\n    <h3><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Voice messages'); ?></h3>\r\n\r\n    <div class=\"row\">\r\n        <div class=\"col-md-6\">\r\n            <div class=\"form-group\">\r\n                <label>\r\n                    <input type=\"checkbox\" name=\"soundMessages\" value=\"on\" <?php isset($file_data['sound_messages']) && ($file_data['sound_messages'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Voice messages for visitors is active'); ?>\r\n                </label>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-6\">\r\n            <div class=\"form-group\">\r\n                <label>\r\n                    <input type=\"checkbox\" name=\"soundMessagesOp\" value=\"on\" <?php isset($file_data['sound_messages_op']) && ($file_data['sound_messages_op'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Voice messages for operators is active'); ?>\r\n                </label>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-6\">\r\n            <label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Voice message max length in seconds'); ?></label>\r\n            <input type=\"text\" class=\"form-control\" name=\"soundLength\" value=\"<?php isset($file_data['sound_length']) ? print $file_data['sound_length'] : print '30' ?>\" />\r\n        </div>\r\n    </div>\r\n\r\n    <hr>\r\n\r\n    <h3><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Maintenance'); ?></h3>\r\n\r\n    <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Files will be deleted only if days is > 0')?></p>\r\n\r\n    <div class=\"row\">\r\n        <div class=\"col-4\">\r\n            <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Delete files'); ?></p>\r\n            <label><input type=\"checkbox\" name=\"typeDelete[]\" <?php if (isset($file_data['mtype_delete']) && in_array('visitors',$file_data['mtype_delete'])) : ?>checked=\"checked\"<?php endif;?> value=\"visitors\">Visitors</label><br/>\r\n            <label><input type=\"checkbox\" name=\"typeDelete[]\" <?php if (isset($file_data['mtype_delete']) && in_array('operators',$file_data['mtype_delete'])) : ?>checked=\"checked\"<?php endif;?> value=\"operators\">Operators</label>\r\n        </div>\r\n        <div class=\"col-4\">\r\n            <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','if file is (OR)'); ?></p>\r\n            <label><input type=\"checkbox\" name=\"typeChatDelete[]\" <?php if (isset($file_data['mtype_cdelete']) && in_array('unassigned',$file_data['mtype_cdelete'])) : ?>checked=\"checked\"<?php endif;?> value=\"unassigned\">Unassigned to chat</label><br/>\r\n            <label><input type=\"checkbox\" name=\"typeChatDelete[]\" <?php if (isset($file_data['mtype_cdelete']) && in_array('assigned',$file_data['mtype_cdelete'])) : ?>checked=\"checked\"<?php endif;?> value=\"assigned\">Assigned to chat</label><br/>\r\n        </div>\r\n        <div class=\"col-4\">\r\n            <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','And operator file is older than n days'); ?></p>\r\n            <div class=\"form-group\">\r\n                <input type=\"text\" class=\"form-control\" name=\"mdays_older\" value=\"<?php if (isset($file_data['mdays_older'])) : ?><?php echo htmlspecialchars($file_data['mdays_older'])?><?php endif?>\" />\r\n            </div>\r\n\r\n            <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','And visitor file is older than n days'); ?></p>\r\n            <div class=\"form-group\">\r\n                <input type=\"text\" class=\"form-control\" name=\"mdays_older_visitor\" value=\"<?php if (isset($file_data['mdays_older_visitor'])) : ?><?php echo htmlspecialchars($file_data['mdays_older_visitor'])?><?php endif?>\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <input type=\"submit\" class=\"btn btn-secondary\" name=\"StoreFileConfiguration\" value=\"<?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('system/buttons','Save'); ?>\" />\r\n\r\n</form>\r\n\r\n\r\n", "<?php\r\n\r\n$tpl = erLhcoreClassTemplate::getInstance('lhfile/configuration.tpl.php');\r\n\r\n$fileData = erLhcoreClassModelChatConfig::fetch('file_configuration');\r\n$data = (array)$fileData->data;\r\n\r\n\r\nif (isset($_POST['StoreFileConfiguration'])) {\r\n    $definition = array(\r\n        'AllowedFileTypes' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string'\r\n        ),\r\n        'AllowedFileTypesUser' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string'\r\n        ),\r\n        'ClamAVSocketPath' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string'\r\n        ),\r\n        'ClamAVSocketLength' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int'\r\n        ),\r\n        'MaximumFileSize' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int'\r\n        ),\r\n        'ActiveFileUploadUser' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'AllowOnlyOneFileUpload' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'ActiveFileUploadAdmin' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'AntivirusFileScanEnabled' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'typeDelete' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string', null, FILTER_REQUIRE_ARRAY\r\n        ),\r\n        'typeChatDelete' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string', null, FILTER_REQUIRE_ARRAY\r\n        ),\r\n        'mdays_older' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int', array('min_range' => 1)\r\n        ),\r\n        'mdays_older_visitor' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int', array('min_range' => 1)\r\n        ),\r\n        'soundLength' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int', array('min_range' => 1)\r\n        ),\r\n        'removeMetaTag' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'soundMessages' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'soundMessagesOp' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n    );\r\n\r\n\r\n    $Errors = array();\r\n\r\n    $form = new ezcInputForm(INPUT_POST, $definition);\r\n    $Errors = array();\r\n\r\n\r\n    if ($form->hasValidData('typeDelete') && is_array($form->typeDelete)) {\r\n        $data['mtype_delete'] = $form->typeDelete;\r\n    } else {\r\n        $data['mtype_delete'] = array();\r\n    }\r\n\r\n    if ($form->hasValidData('typeChatDelete') && is_array($form->typeChatDelete)) {\r\n        $data['mtype_cdelete'] = $form->typeChatDelete;\r\n    } else {\r\n        $data['mtype_cdelete'] = array();\r\n    }\r\n\r\n    if ($form->hasValidData('mdays_older')) {\r\n        $data['mdays_older'] = $form->mdays_older;\r\n    } else {\r\n        $data['mdays_older'] = null;\r\n    }\r\n\r\n    if ($form->hasValidData('mdays_older_visitor')) {\r\n        $data['mdays_older_visitor'] = $form->mdays_older_visitor;\r\n    } else {\r\n        $data['mdays_older_visitor'] = null;\r\n    }\r\n\r\n    if ($form->hasValidData('ActiveFileUploadUser') && $form->ActiveFileUploadUser == true) {\r\n        $data['active_user_upload'] = true;\r\n    } else {\r\n        $data['active_user_upload'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('ActiveFileUploadAdmin') && $form->ActiveFileUploadAdmin == true) {\r\n        $data['active_admin_upload'] = true;\r\n    } else {\r\n        $data['active_admin_upload'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('AllowOnlyOneFileUpload') && $form->AllowOnlyOneFileUpload == true) {\r\n        $data['one_file_upload'] = true;\r\n    } else {\r\n        $data['one_file_upload'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('removeMetaTag') && $form->removeMetaTag == true) {\r\n        $data['remove_meta'] = true;\r\n    } else {\r\n        $data['remove_meta'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('AntivirusFileScanEnabled') && $form->AntivirusFileScanEnabled == true) {\r\n        $data['clamav_enabled'] = true;\r\n    } else {\r\n        $data['clamav_enabled'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('soundMessages') && $form->soundMessages == true) {\r\n        $data['sound_messages'] = true;\r\n    } else {\r\n        $data['sound_messages'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('soundMessagesOp') && $form->soundMessagesOp == true) {\r\n        $data['sound_messages_op'] = true;\r\n    } else {\r\n        $data['sound_messages_op'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('soundLength')) {\r\n        $data['sound_length'] = $form->soundLength;\r\n    } else {\r\n        $data['sound_length'] = 30;\r\n    }\r\n\r\n    if ($form->hasValidData('AllowedFileTypes') && $form->AllowedFileTypes != '') {\r\n        $data['ft_op'] = $form->AllowedFileTypes;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configurations', 'Please enter valid file type!');\r\n    }\r\n\r\n    if ($form->hasValidData('AllowedFileTypesUser') && $form->AllowedFileTypesUser != '') {\r\n        $data['ft_us'] = $form->AllowedFileTypesUser;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration', 'Please enter valid file type!');\r\n    }\r\n\r\n    if ($form->hasValidData('MaximumFileSize')) {\r\n        $data['fs_max'] = $form->MaximumFileSize;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration', 'Please enter valid maximum file size!');\r\n    }\r\n\r\n    if ($form->hasValidData('ClamAVSocketPath')) {\r\n        $data['clamd_sock'] = $form->ClamAVSocketPath;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration', 'Please enter valid maximum file size!');\r\n    }\r\n\r\n    if ($form->hasValidData('ClamAVSocketLength')) {\r\n        $data['clamd_sock_len'] = $form->ClamAVSocketLength;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration', 'Please enter valid maximum file size!');\r\n    }\r\n\r\n    if (empty($Errors)) {\r\n\r\n        $fileData->value = serialize($data);\r\n        $fileData->saveThis();\r\n\r\n        // Cleanup cache to recompile templates etc.\r\n        $CacheManager = erConfigClassLhCacheConfig::getInstance();\r\n        $CacheManager->expireCache();\r\n\r\n        $tpl->set('updated', 'done');\r\n    } else {\r\n        $tpl->set('errors', $Errors);\r\n    }\r\n\r\n}\r\n\r\n$tpl->set('file_data', $data);\r\n$Result['content'] = $tpl->fetch();\r\n$Result['path'] = array(\r\n    array('url' => erLhcoreClassDesign::baseurl('system/configuration'), 'title' => erTranslationClassLhTranslation::getInstance()->getTranslation('system/configuration', 'System configuration')),\r\n    array('url' => erLhcoreClassDesign::baseurl('file/configuration'), 'title' => erTranslationClassLhTranslation::getInstance()->getTranslation('system/configuration', 'File configuration')));\r\n\r\nerLhcoreClassChatEventDispatcher::getInstance()->dispatch('file.configuration_path', array('result' => & $Result));\r\n\r\n?>"], "fixing_code": ["<h1><?php include(erLhcoreClassDesign::designtpl('lhfile/titles/configuration.tpl.php'));?></h1>\r\n\r\n<?php if (isset($errors)) : ?>\r\n\t<?php include(erLhcoreClassDesign::designtpl('lhkernel/validation_error.tpl.php'));?>\r\n<?php endif; ?>\r\n\r\n<?php if (isset($updated) && $updated == 'done') : $msg = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Settings updated'); ?>\r\n\t<?php include(erLhcoreClassDesign::designtpl('lhkernel/alert_success.tpl.php'));?>\r\n<?php endif; ?>\r\n\r\n<form action=\"\" ng-non-bindable method=\"post\">\r\n\r\n    <?php include(erLhcoreClassDesign::designtpl('lhkernel/csfr_token.tpl.php'));?>\r\n\r\n    <div class=\"row\">\r\n        <div class=\"col-6\">\r\n            <div class=\"form-group\">\r\n                <label><input type=\"checkbox\" name=\"ActiveFileUploadUser\" value=\"on\" <?php isset($file_data['active_user_upload']) && ($file_data['active_user_upload'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Files upload for users is active'); ?></label>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-6\">\r\n            <div class=\"form-group\">\r\n                <label><input type=\"checkbox\" name=\"AllowOnlyOneFileUpload\" value=\"on\" <?php isset($file_data['one_file_upload']) && ($file_data['one_file_upload'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Allow visitor to choose only one file for the upload'); ?></label>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-6\">\r\n            <div class=\"form-group\">\r\n                <label><input type=\"checkbox\" name=\"ActiveFileUploadAdmin\" value=\"on\" <?php isset($file_data['active_admin_upload']) && ($file_data['active_admin_upload'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Files upload for operators is active'); ?></label>\r\n            </div>\r\n        </div>\r\n        <div class=\"col-6\">\r\n            <div class=\"form-group\">\r\n                <label><input type=\"checkbox\" name=\"removeMetaTag\" value=\"on\" <?php isset($file_data['remove_meta']) && ($file_data['remove_meta'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Remove meta information from images'); ?></label>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n<div class=\"row form-group\">\r\n\t<div class=\"col-md-6\">\r\n\t\t<label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Allowed files types for operators'); ?></label>\r\n\t\t<input type=\"text\" class=\"form-control\" name=\"AllowedFileTypes\" value=\"<?php isset($file_data['ft_op']) ? print $file_data['ft_op'] : '' ?>\" />\r\n\t</div>\r\n\t<div class=\"col-md-6\">\r\n\t\t<label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Allowed files types for users'); ?></label>\r\n\t\t<input type=\"text\" class=\"form-control\" name=\"AllowedFileTypesUser\" value=\"<?php isset($file_data['ft_us']) ? print $file_data['ft_us'] : '' ?>\" />\r\n\t</div>\r\n</div>\r\n\r\n<div class=\"row form-group\">\r\n\t<div class=\"col-md-6\">\r\n\t\t<label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Maximum file size in KB'); ?></label>\r\n\t\t<input type=\"text\" class=\"form-control\" name=\"MaximumFileSize\" value=\"<?php isset($file_data['fs_max']) ? print $file_data['fs_max'] : '' ?>\" />\r\n\t</div>\r\n</div>\r\n\r\n    <h3><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','ClamAV antivirus configuration'); ?></h3>\r\n\r\n    <div class=\"form-group\">\r\n        <label><input type=\"checkbox\" name=\"AntivirusFileScanEnabled\" value=\"on\" <?php isset($file_data['clamav_enabled']) && ($file_data['clamav_enabled'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Uploaded files from visitors are scanned'); ?></label>\r\n    </div>\r\n\r\n    <div class=\"row form-group\">\r\n        <div class=\"col-md-6\">\r\n            <label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','ClamAV socket path'); ?></label>\r\n            <input type=\"text\" class=\"form-control\" name=\"ClamAVSocketPath\" value=\"<?php isset($file_data['clamd_sock']) ? print $file_data['clamd_sock'] : print '/var/run/clamav/clamd.sock' ?>\" />\r\n        </div>\r\n        <div class=\"col-md-6\">\r\n            <label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','ClamAV socket length'); ?></label>\r\n            <input type=\"text\" class=\"form-control\" name=\"ClamAVSocketLength\" value=\"<?php isset($file_data['clamd_sock_len']) ? print $file_data['clamd_sock_len'] : print '20000' ?>\" />\r\n        </div>\r\n    </div>\r\n\r\n    <hr>\r\n\r\n    <h3><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Voice messages'); ?></h3>\r\n\r\n    <div class=\"row\">\r\n        <div class=\"col-md-6\">\r\n            <div class=\"form-group\">\r\n                <label>\r\n                    <input type=\"checkbox\" name=\"soundMessages\" value=\"on\" <?php isset($file_data['sound_messages']) && ($file_data['sound_messages'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Voice messages for visitors is active'); ?>\r\n                </label>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-6\">\r\n            <div class=\"form-group\">\r\n                <label>\r\n                    <input type=\"checkbox\" name=\"soundMessagesOp\" value=\"on\" <?php isset($file_data['sound_messages_op']) && ($file_data['sound_messages_op'] == true) ? print 'checked=\"checked\"' : '' ?> /><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Voice messages for operators is active'); ?>\r\n                </label>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"col-md-6\">\r\n            <label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Voice message max length in seconds'); ?></label>\r\n            <input type=\"text\" class=\"form-control\" name=\"soundLength\" value=\"<?php isset($file_data['sound_length']) ? print $file_data['sound_length'] : print '30' ?>\" />\r\n        </div>\r\n    </div>\r\n\r\n    <hr>\r\n\r\n    <h3><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Maintenance'); ?></h3>\r\n\r\n    <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Files will be deleted only if days is > 0')?></p>\r\n\r\n    <div class=\"row\">\r\n        <div class=\"col-4\">\r\n            <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','Delete files'); ?></p>\r\n            <label><input type=\"checkbox\" name=\"typeDelete[]\" <?php if (isset($file_data['mtype_delete']) && in_array('visitors',$file_data['mtype_delete'])) : ?>checked=\"checked\"<?php endif;?> value=\"visitors\">Visitors</label><br/>\r\n            <label><input type=\"checkbox\" name=\"typeDelete[]\" <?php if (isset($file_data['mtype_delete']) && in_array('operators',$file_data['mtype_delete'])) : ?>checked=\"checked\"<?php endif;?> value=\"operators\">Operators</label>\r\n        </div>\r\n        <div class=\"col-4\">\r\n            <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','if file is (OR)'); ?></p>\r\n            <label><input type=\"checkbox\" name=\"typeChatDelete[]\" <?php if (isset($file_data['mtype_cdelete']) && in_array('unassigned',$file_data['mtype_cdelete'])) : ?>checked=\"checked\"<?php endif;?> value=\"unassigned\">Unassigned to chat</label><br/>\r\n            <label><input type=\"checkbox\" name=\"typeChatDelete[]\" <?php if (isset($file_data['mtype_cdelete']) && in_array('assigned',$file_data['mtype_cdelete'])) : ?>checked=\"checked\"<?php endif;?> value=\"assigned\">Assigned to chat</label><br/>\r\n        </div>\r\n        <div class=\"col-4\">\r\n            <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','And operator file is older than n days'); ?></p>\r\n            <div class=\"form-group\">\r\n                <input type=\"text\" class=\"form-control\" name=\"mdays_older\" value=\"<?php if (isset($file_data['mdays_older'])) : ?><?php echo htmlspecialchars($file_data['mdays_older'])?><?php endif?>\" />\r\n            </div>\r\n\r\n            <p><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration','And visitor file is older than n days'); ?></p>\r\n            <div class=\"form-group\">\r\n                <input type=\"text\" class=\"form-control\" name=\"mdays_older_visitor\" value=\"<?php if (isset($file_data['mdays_older_visitor'])) : ?><?php echo htmlspecialchars($file_data['mdays_older_visitor'])?><?php endif?>\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <input type=\"submit\" class=\"btn btn-secondary\" name=\"StoreFileConfiguration\" value=\"<?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('system/buttons','Save'); ?>\" />\r\n\r\n</form>\r\n\r\n\r\n", "<?php\r\n\r\n$tpl = erLhcoreClassTemplate::getInstance('lhfile/configuration.tpl.php');\r\n\r\n$fileData = erLhcoreClassModelChatConfig::fetch('file_configuration');\r\n$data = (array)$fileData->data;\r\n\r\n\r\nif (isset($_POST['StoreFileConfiguration'])) {\r\n\r\n    if (!isset($_POST['csfr_token']) || !$currentUser->validateCSFRToken($_POST['csfr_token'])) {\r\n        erLhcoreClassModule::redirect('file/configuration');\r\n        exit;\r\n    }\r\n\r\n    $definition = array(\r\n        'AllowedFileTypes' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string'\r\n        ),\r\n        'AllowedFileTypesUser' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string'\r\n        ),\r\n        'ClamAVSocketPath' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string'\r\n        ),\r\n        'ClamAVSocketLength' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int'\r\n        ),\r\n        'MaximumFileSize' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int'\r\n        ),\r\n        'ActiveFileUploadUser' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'AllowOnlyOneFileUpload' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'ActiveFileUploadAdmin' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'AntivirusFileScanEnabled' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'typeDelete' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string', null, FILTER_REQUIRE_ARRAY\r\n        ),\r\n        'typeChatDelete' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'string', null, FILTER_REQUIRE_ARRAY\r\n        ),\r\n        'mdays_older' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int', array('min_range' => 1)\r\n        ),\r\n        'mdays_older_visitor' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int', array('min_range' => 1)\r\n        ),\r\n        'soundLength' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'int', array('min_range' => 1)\r\n        ),\r\n        'removeMetaTag' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'soundMessages' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n        'soundMessagesOp' => new ezcInputFormDefinitionElement(\r\n            ezcInputFormDefinitionElement::OPTIONAL, 'boolean'\r\n        ),\r\n    );\r\n\r\n\r\n    $Errors = array();\r\n\r\n    $form = new ezcInputForm(INPUT_POST, $definition);\r\n    $Errors = array();\r\n\r\n\r\n    if ($form->hasValidData('typeDelete') && is_array($form->typeDelete)) {\r\n        $data['mtype_delete'] = $form->typeDelete;\r\n    } else {\r\n        $data['mtype_delete'] = array();\r\n    }\r\n\r\n    if ($form->hasValidData('typeChatDelete') && is_array($form->typeChatDelete)) {\r\n        $data['mtype_cdelete'] = $form->typeChatDelete;\r\n    } else {\r\n        $data['mtype_cdelete'] = array();\r\n    }\r\n\r\n    if ($form->hasValidData('mdays_older')) {\r\n        $data['mdays_older'] = $form->mdays_older;\r\n    } else {\r\n        $data['mdays_older'] = null;\r\n    }\r\n\r\n    if ($form->hasValidData('mdays_older_visitor')) {\r\n        $data['mdays_older_visitor'] = $form->mdays_older_visitor;\r\n    } else {\r\n        $data['mdays_older_visitor'] = null;\r\n    }\r\n\r\n    if ($form->hasValidData('ActiveFileUploadUser') && $form->ActiveFileUploadUser == true) {\r\n        $data['active_user_upload'] = true;\r\n    } else {\r\n        $data['active_user_upload'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('ActiveFileUploadAdmin') && $form->ActiveFileUploadAdmin == true) {\r\n        $data['active_admin_upload'] = true;\r\n    } else {\r\n        $data['active_admin_upload'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('AllowOnlyOneFileUpload') && $form->AllowOnlyOneFileUpload == true) {\r\n        $data['one_file_upload'] = true;\r\n    } else {\r\n        $data['one_file_upload'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('removeMetaTag') && $form->removeMetaTag == true) {\r\n        $data['remove_meta'] = true;\r\n    } else {\r\n        $data['remove_meta'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('AntivirusFileScanEnabled') && $form->AntivirusFileScanEnabled == true) {\r\n        $data['clamav_enabled'] = true;\r\n    } else {\r\n        $data['clamav_enabled'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('soundMessages') && $form->soundMessages == true) {\r\n        $data['sound_messages'] = true;\r\n    } else {\r\n        $data['sound_messages'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('soundMessagesOp') && $form->soundMessagesOp == true) {\r\n        $data['sound_messages_op'] = true;\r\n    } else {\r\n        $data['sound_messages_op'] = false;\r\n    }\r\n\r\n    if ($form->hasValidData('soundLength')) {\r\n        $data['sound_length'] = $form->soundLength;\r\n    } else {\r\n        $data['sound_length'] = 30;\r\n    }\r\n\r\n    if ($form->hasValidData('AllowedFileTypes') && $form->AllowedFileTypes != '') {\r\n        $data['ft_op'] = $form->AllowedFileTypes;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configurations', 'Please enter valid file type!');\r\n    }\r\n\r\n    if ($form->hasValidData('AllowedFileTypesUser') && $form->AllowedFileTypesUser != '') {\r\n        $data['ft_us'] = $form->AllowedFileTypesUser;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration', 'Please enter valid file type!');\r\n    }\r\n\r\n    if ($form->hasValidData('MaximumFileSize')) {\r\n        $data['fs_max'] = $form->MaximumFileSize;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration', 'Please enter valid maximum file size!');\r\n    }\r\n\r\n    if ($form->hasValidData('ClamAVSocketPath')) {\r\n        $data['clamd_sock'] = $form->ClamAVSocketPath;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration', 'Please enter valid maximum file size!');\r\n    }\r\n\r\n    if ($form->hasValidData('ClamAVSocketLength')) {\r\n        $data['clamd_sock_len'] = $form->ClamAVSocketLength;\r\n    } else {\r\n        $Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('file/configuration', 'Please enter valid maximum file size!');\r\n    }\r\n\r\n    if (empty($Errors)) {\r\n\r\n        $fileData->value = serialize($data);\r\n        $fileData->saveThis();\r\n\r\n        // Cleanup cache to recompile templates etc.\r\n        $CacheManager = erConfigClassLhCacheConfig::getInstance();\r\n        $CacheManager->expireCache();\r\n\r\n        $tpl->set('updated', 'done');\r\n    } else {\r\n        $tpl->set('errors', $Errors);\r\n    }\r\n\r\n}\r\n\r\n$tpl->set('file_data', $data);\r\n$Result['content'] = $tpl->fetch();\r\n$Result['path'] = array(\r\n    array('url' => erLhcoreClassDesign::baseurl('system/configuration'), 'title' => erTranslationClassLhTranslation::getInstance()->getTranslation('system/configuration', 'System configuration')),\r\n    array('url' => erLhcoreClassDesign::baseurl('file/configuration'), 'title' => erTranslationClassLhTranslation::getInstance()->getTranslation('system/configuration', 'File configuration')));\r\n\r\nerLhcoreClassChatEventDispatcher::getInstance()->dispatch('file.configuration_path', array('result' => & $Result));\r\n\r\n?>"], "filenames": ["lhc_web/design/defaulttheme/tpl/lhfile/configuration.tpl.php", "lhc_web/modules/lhfile/configuration.php"], "buggy_code_start_loc": [11, 9], "buggy_code_end_loc": [11, 9], "fixing_code_start_loc": [12, 10], "fixing_code_end_loc": [14, 16], "type": "CWE-352", "message": "livehelperchat is vulnerable to Cross-Site Request Forgery (CSRF)", "other": {"cve": {"id": "CVE-2022-0231", "sourceIdentifier": "security@huntr.dev", "published": "2022-01-14T12:15:07.877", "lastModified": "2022-01-21T17:34:16.313", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "livehelperchat is vulnerable to Cross-Site Request Forgery (CSRF)"}, {"lang": "es", "value": "livehelperchat es vulnerable a un ataque de tipo Cross-Site Request Forgery (CSRF)"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 5.7, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:livehelperchat:live_helper_chat:*:*:*:*:*:*:*:*", "versionEndIncluding": "3.91", "matchCriteriaId": "E95A7F37-84A7-453B-B438-B9B720A77CE4"}]}]}], "references": [{"url": "https://github.com/livehelperchat/livehelperchat/commit/6ad1349dc5e7503b00c5017499a0a895d7654a61", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/adaf98cf-60ab-40e0-aa3b-42ba0d3b7cbf", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/livehelperchat/livehelperchat/commit/6ad1349dc5e7503b00c5017499a0a895d7654a61"}}