{"buggy_code": ["<?php\n\ndeclare(strict_types=1);\n\nnamespace kaidoMC\\RegionProtect;\n\nuse kaidoMC\\RegionProtect\\EventListener;\nuse kaidoMC\\RegionProtect\\Provider\\VectorAdjust;\nuse kaidoMC\\RegionProtect\\Utils\\Configuration;\nuse kaidoMC\\RegionProtect\\Utils\\SelectVector;\n\nuse jojoe77777\\FormAPI\\CustomForm;\n\nuse pocketmine\\player\\Player;\n\nuse pocketmine\\command\\CommandSender;\nuse pocketmine\\command\\Command;\n\nuse pocketmine\\plugin\\PluginBase;\n\nuse pocketmine\\utils\\SingleTonTrait;\nuse pocketmine\\utils\\TextFormat;\n\nclass RegionProtect extends PluginBase {\n\tuse SingleTonTrait;\n\n\t/**\n\t * @var VectorAdjust $vectorAdjust;\n\t */\n\tprivate VectorAdjust $vectorAdjust;\n\n\tprotected function onLoad(): void {\n\t\tself::setInstance($this);\n\t\tif (!is_dir($this->getDataFolder() . \"regions/\")) {\n\t\t\t@mkdir($this->getDataFolder() . \"regions/\");\n\t\t}\n\t\t$this->saveDefaultConfig();\n\t}\n\n\tprotected function onEnable(): void {\n\t\tConfiguration::initConfig($this);\n\t\t$this->vectorAdjust = new VectorAdjust($this);\n\t\t$this->getServer()->getPluginManager()->registerEvents(new EventListener($this), $this);\n\t}\n\n\t/**\n\t * @param CommandSender $sender\n\t * @param Command $command\n\t * @param string $label\n\t * @param array $args\n\t * @return bool\n\t */\n\tpublic function onCommand(CommandSender $sender, Command $command, string $label, array $args): bool {\n\t\tif (!($sender instanceof Player)) {\n\t\t\t$sender->sendMessage(\"Use this command in game!\");\n\t\t\treturn false;\n\t\t}\n\t\tif (isset($args[0])) {\n\t\t\tswitch ($args[0]) {\n\t\t\t\tcase \"wand\":\n\t\t\t\t\t$sender->getInventory()->addItem(SelectVector::getItem($sender));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"create\":\n\t\t\t\t\tif ((SelectVector::getFirstVector($sender) != null) and (SelectVector::getSecondVector($sender) != null)) {\n\t\t\t\t\t\t$this->getBasicForm($sender);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$sender->sendMessage(\"Unable to create if one of the two slots is not filled in completely.\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"delete\":\n\t\t\t\t\tif (!isset($args[1])) {\n\t\t\t\t\t\t$sender->sendMessage(TextFormat::RED . \"You must enter a region title to perform the removal process!\");\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tarray_shift($args);\n\t\t\t\t\t$this->getVectorAdjust()->removeLocation($sender, join(\" \", $args));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"edit\":\n\t\t\t\t\tif (!isset($args[1])) {\n\t\t\t\t\t\t$sender->sendMessage(TextFormat::RED . \"You need to enter the title of the region to be able to edit it.\n\");\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tarray_shift($args);\n\t\t\t\t\t$this->getVectorAdjust()->adjustLocation($sender, join(\" \", $args));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"list\":\n\t\t\t\t\t$sender->sendMessage(TextFormat::YELLOW . \"Total Regions in the world: (\" . count($this->getVectorAdjust()->getLocations()) . \")\");\n\t\t\t\t\tforeach ($this->getVectorAdjust()->getLocations() as $file) {\n\t\t\t\t\t\t$config = $this->getVectorAdjust()->getLocation(explode(\".\", $file)[0]);\n\t\t\t\t\t\tif ($config != null) {\n\t\t\t\t\t\t\tif ($config->get(\"World\") != $sender->getWorld()->getDisplayName()) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$sender->sendMessage(TextFormat::GREEN . explode(\".\", $file)[0] . \": \" . TextFormat::DARK_GRAY . $config->get(\"FirstVector\")[\"X\"] . \" \" . $config->get(\"FirstVector\")[\"Y\"] . \" \" . $config->get(\"FirstVector\")[\"Z\"]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$sender->sendMessage(\"Usage: /region <wand|create|edit|delete|list>\");\n\t\t\t}\n\t\t} else {\n\t\t\t$sender->sendMessage(\"Usage: /region <wand|create|edit|delete|list>\");\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * @param Player $sender\n\t */\n\tprivate function getBasicForm(Player $sender): void {\n\t\t$firstVector = SelectVector::getFirstVector($sender);\n\t\t$secondVector = SelectVector::getSecondVector($sender);\n\t\t$X1 = $firstVector->getX();\n\t\t$X2 = $secondVector->getX();\n\t\t$Y1 = $firstVector->getY();\n\t\t$Y2 = $secondVector->getY();\n\t\t$Z1 = $firstVector->getZ();\n\t\t$Z2 = $secondVector->getZ();\n\n\t\t$form = new CustomForm(function (Player $sender, ?array $result) use ($X1, $X2, $Y1, $Y2, $Z1, $Z2): void {\n\t\t\tif ($result === null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ($result[2] != null and $result[3] != null) {\n\t\t\t\t$this->getVectorAdjust()->setLocation($sender, $result[2], $result[3], [$X1, $Y1, $Z1], [$X2, $Y2, $Z2]);\n\t\t\t} else {\n\t\t\t\t$sender->sendMessage(TextFormat::RED . \"Invalid information, please try again!\");\n\t\t\t}\n\t\t});\n\t\t$form->setTitle(\"Adjust Location\");\n\t\t$form->addLabel(\"Selected information:\");\n\t\t$form->addLabel(\"World: \" . $sender->getWorld()->getDisplayName() . \"\\nFirst Position: \" . $X1 . \" \" . $Y1 . \" \" . $Z1 . \"\\nSecond Position:  \" . $X2 . \" \" . $Y2 . \" \" . $Z2);\n\t\t$form->addInput(\"Enter the title of the region.\", \"Mushroom\", \"Cow\");\n\t\t$form->addInput(\"Enter the name of the region (The content will be displayed when the player enters the region). \", \"Mushroom\", \"Kingdom\");\n\t\t$sender->sendForm($form);\n\t}\n\n\t/**\n\t * @return VectorAdjust\n\t */\n\tpublic function getVectorAdjust(): VectorAdjust {\n\t\treturn $this->vectorAdjust;\n\t}\n}\n"], "fixing_code": ["<?php\n\ndeclare(strict_types=1);\n\nnamespace kaidoMC\\RegionProtect;\n\nuse kaidoMC\\RegionProtect\\EventListener;\nuse kaidoMC\\RegionProtect\\Provider\\VectorAdjust;\nuse kaidoMC\\RegionProtect\\Utils\\Configuration;\nuse kaidoMC\\RegionProtect\\Utils\\SelectVector;\n\nuse jojoe77777\\FormAPI\\CustomForm;\n\nuse pocketmine\\player\\Player;\n\nuse pocketmine\\command\\CommandSender;\nuse pocketmine\\command\\Command;\n\nuse pocketmine\\plugin\\PluginBase;\n\nuse pocketmine\\utils\\SingleTonTrait;\nuse pocketmine\\utils\\TextFormat;\n\nclass RegionProtect extends PluginBase {\n\tuse SingleTonTrait;\n\n\t/**\n\t * @var VectorAdjust $vectorAdjust;\n\t */\n\tprivate VectorAdjust $vectorAdjust;\n\n\tprotected function onLoad(): void {\n\t\tself::setInstance($this);\n\t\tif (!is_dir($this->getDataFolder() . \"regions/\")) {\n\t\t\t@mkdir($this->getDataFolder() . \"regions/\");\n\t\t}\n\t\t$this->saveDefaultConfig();\n\t}\n\n\tprotected function onEnable(): void {\n\t\tConfiguration::initConfig($this);\n\t\t$this->vectorAdjust = new VectorAdjust($this);\n\t\t$this->getServer()->getPluginManager()->registerEvents(new EventListener($this), $this);\n\t}\n\n\t/**\n\t * @param CommandSender $sender\n\t * @param Command $command\n\t * @param string $label\n\t * @param array $args\n\t * @return bool\n\t */\n\tpublic function onCommand(CommandSender $sender, Command $command, string $label, array $args): bool {\n\t\tif (!($sender instanceof Player)) {\n\t\t\t$sender->sendMessage(\"Use this command in game!\");\n\t\t\treturn false;\n\t\t}\n\t\tif (isset($args[0])) {\n\t\t\tswitch ($args[0]) {\n\t\t\t\tcase \"wand\":\n\t\t\t\t\t$sender->getInventory()->addItem(SelectVector::getItem($sender));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"create\":\n\t\t\t\t\tif ((SelectVector::getFirstVector($sender) != null) and (SelectVector::getSecondVector($sender) != null)) {\n\t\t\t\t\t\t$this->getBasicForm($sender);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$sender->sendMessage(\"Unable to create if one of the two slots is not filled in completely.\");\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"delete\":\n\t\t\t\t\tif (!isset($args[1])) {\n\t\t\t\t\t\t$sender->sendMessage(TextFormat::RED . \"You must enter a region title to perform the removal process!\");\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tarray_shift($args);\n\t\t\t\t\t$this->getVectorAdjust()->removeLocation($sender, join(\" \", $args));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"edit\":\n\t\t\t\t\tif (!isset($args[1])) {\n\t\t\t\t\t\t$sender->sendMessage(TextFormat::RED . \"You need to enter the title of the region to be able to edit it.\n\");\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tarray_shift($args);\n\t\t\t\t\t$this->getVectorAdjust()->adjustLocation($sender, join(\" \", $args));\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"list\":\n\t\t\t\t\t$sender->sendMessage(TextFormat::YELLOW . \"Total Regions in the world: (\" . count($this->getVectorAdjust()->getLocations()) . \")\");\n\t\t\t\t\tforeach ($this->getVectorAdjust()->getLocations() as $file) {\n\t\t\t\t\t\t$config = $this->getVectorAdjust()->getLocation(explode(\".\", $file)[0]);\n\t\t\t\t\t\tif ($config != null) {\n\t\t\t\t\t\t\tif ($config->get(\"World\") != $sender->getWorld()->getDisplayName()) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$sender->sendMessage(TextFormat::GREEN . explode(\".\", $file)[0] . \": \" . TextFormat::DARK_GRAY . $config->get(\"FirstVector\")[\"X\"] . \" \" . $config->get(\"FirstVector\")[\"Y\"] . \" \" . $config->get(\"FirstVector\")[\"Z\"]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$sender->sendMessage(\"Usage: /region <wand|create|edit|delete|list>\");\n\t\t\t}\n\t\t} else {\n\t\t\t$sender->sendMessage(\"Usage: /region <wand|create|edit|delete|list>\");\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * @param Player $sender\n\t */\n\tprivate function getBasicForm(Player $sender): void {\n\t\t$firstVector = SelectVector::getFirstVector($sender);\n\t\t$secondVector = SelectVector::getSecondVector($sender);\n\t\t$X1 = $firstVector->getX();\n\t\t$X2 = $secondVector->getX();\n\t\t$Y1 = $firstVector->getY();\n\t\t$Y2 = $secondVector->getY();\n\t\t$Z1 = $firstVector->getZ();\n\t\t$Z2 = $secondVector->getZ();\n\n\t\t$form = new CustomForm(function (Player $sender, ?array $result) use ($X1, $X2, $Y1, $Y2, $Z1, $Z2): void {\n\t\t\tif ($result === null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!preg_match('/^[\\w]+$/', $result[2])) {\n\t\t\t\t$sender->sendMessage(TextFormat::RED . \"Invalid region name! Only alphanumeric characters allowed.\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ($result[2] != null and $result[3] != null) {\n\t\t\t\t$this->getVectorAdjust()->setLocation($sender, $result[2], $result[3], [$X1, $Y1, $Z1], [$X2, $Y2, $Z2]);\n\t\t\t} else {\n\t\t\t\t$sender->sendMessage(TextFormat::RED . \"Invalid information, please try again!\");\n\t\t\t}\n\t\t});\n\t\t$form->setTitle(\"Adjust Location\");\n\t\t$form->addLabel(\"Selected information:\");\n\t\t$form->addLabel(\"World: \" . $sender->getWorld()->getDisplayName() . \"\\nFirst Position: \" . $X1 . \" \" . $Y1 . \" \" . $Z1 . \"\\nSecond Position:  \" . $X2 . \" \" . $Y2 . \" \" . $Z2);\n\t\t$form->addInput(\"Enter the title of the region.\", \"Mushroom\", \"Cow\");\n\t\t$form->addInput(\"Enter the name of the region (The content will be displayed when the player enters the region). \", \"Mushroom\", \"Kingdom\");\n\t\t$sender->sendForm($form);\n\t}\n\n\t/**\n\t * @return VectorAdjust\n\t */\n\tpublic function getVectorAdjust(): VectorAdjust {\n\t\treturn $this->vectorAdjust;\n\t}\n}\n"], "filenames": ["src/kaidoMC/RegionProtect/RegionProtect.php"], "buggy_code_start_loc": [124], "buggy_code_end_loc": [124], "fixing_code_start_loc": [125], "fixing_code_end_loc": [129], "type": "CWE-88", "message": "RegionProtect is a plugin that allows users to manage certain events in certain regions of the world. Versions prior to 1.1.0 contain a YAML injection vulnerability that can cause an instant server crash if the passed arguments are not matched. Version 1.1.0 contains a patch for this issue. As a workaround, restrict operator permissions to untrusted people and avoid entering arguments likely to cause a crash.", "other": {"cve": {"id": "CVE-2022-29215", "sourceIdentifier": "security-advisories@github.com", "published": "2022-05-21T00:15:11.917", "lastModified": "2022-06-07T02:18:18.850", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "RegionProtect is a plugin that allows users to manage certain events in certain regions of the world. Versions prior to 1.1.0 contain a YAML injection vulnerability that can cause an instant server crash if the passed arguments are not matched. Version 1.1.0 contains a patch for this issue. As a workaround, restrict operator permissions to untrusted people and avoid entering arguments likely to cause a crash."}, {"lang": "es", "value": "RegionProtect es un plugin que permite a usuarios administrar determinados eventos en determinadas regiones del mundo. Las versiones anteriores a 1.1.0 contienen una vulnerabilidad de inyecci\u00f3n de YAML que puede causar un bloqueo instant\u00e1neo del servidor si los argumentos pasados no coinciden. La versi\u00f3n 1.1.0 contiene un parche para este problema. Como mitigaci\u00f3n, restrinja los permisos de los operadores a personas que no sean confiables y evite introducir argumentos que puedan causar un bloqueo"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:N/I:N/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "PARTIAL", "baseScore": 5.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 10.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-88"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-88"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:regionprotect_project:regionprotect:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.1.0", "matchCriteriaId": "8BDBEA71-B6CE-42BB-902A-797957622530"}]}]}], "references": [{"url": "https://github.com/kaidomc-pm-pl/RegionProtect/commit/0060d421358ab59acb6a168eab0d11c43d2d105d", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/kaidomc-pm-pl/RegionProtect/security/advisories/GHSA-7gr2-w2r3-r9vf", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/kaidomc-pm-pl/RegionProtect/commit/0060d421358ab59acb6a168eab0d11c43d2d105d"}}