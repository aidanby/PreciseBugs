{"buggy_code": ["CHANGELOG Roundcube Webmail\n===========================\n\nRELEASE 1.3.12\n--------------\n - Security: Better fix for CVE-2020-12641\n - Security: Fix XSS issue in template object 'username' (#7406) \n - Security: Fix couple of XSS issues in Installer (#7406)\n\nRELEASE 1.3.11\n--------------\n- Enigma: Fix compatibility with Mail_Mime >= 1.10.5\n- Fix permissions on some folders created by bin/install-jsdeps.sh script (#6930)\n- Fix bug where inline images could have been ignored if Content-Id header contained redundant spaces (#6980)\n- Fix PHP Warning: Use of undefined constant LOG_EMERGE (#6991)\n- Fix PHP warning: \"array_merge(): Expected parameter 2 to be an array, null given in sendmail.inc (#7003)\n- Security: Fix XSS issue in handling of CDATA in HTML messages\n- Security: Fix remote code execution via crafted 'im_convert_path' or 'im_identify_path' settings\n- Security: Fix local file inclusion (and code execution) via crafted 'plugins' option\n- Security: Fix CSRF bypass that could be used to log out an authenticated user (#7302)\n\nRELEASE 1.3.10\n--------------\n- Managesieve: Fix so \"Create filter\" option does not show up when Filters menu is disabled (#6723)\n- Enigma: Fix bug where revoked users/keys were not greyed out in key info\n- Enigma: Fix error message when trying to encrypt with a revoked key (#6607)\n- Enigma: Fix \"decryption oracle\" bug [CVE-2019-10740] (#6638)\n- Fix compatibility with kolab/net_ldap3 > 1.0.7 (#6785)\n- Fix bug where bmp images couldn't be displayed on some systems (#6728)\n- Fix bug in parsing vCard data using PHP 7.3 due to an invalid regexp (#6744)\n- Fix bug where bold/strong text was converted to upper-case on html-to-text conversion (6758)\n- Fix bug in rcube_utils::parse_hosts() where %t, %d, %z could return only tld (#6746)\n- Fix bug where Next/Prev button in mail view didn't work with multi-folder search result (#6793)\n- Fix bug where selection of columns on messages list wasn't working\n- Fix bug in converting multi-page Tiff images to Jpeg (#6824)\n- Fix wrong messages order after returning to a multi-folder search result (#6836)\n- Fix PHP 7.4 deprecation: implode() wrong parameter order (#6866)\n- Fix bug where it was possible to bypass the position:fixed CSS check in received messages (#6898)\n- Fix bug where some strict remote URIs in url() style were unintentionally blocked (#6899)\n- Fix bug where it was possible to bypass the CSS jail in HTML messages using :root pseudo-class (#6897)\n- Fix bug where it was possible to bypass href URI check with data:application/xhtml+xml URIs (#6896)\n\nRELEASE 1.3.9\n-------------\n- Fix TinyMCE download location (#6694)\n- Fix bug where a message/rfc822 part without a filename wasn't listed on the attachments list (#6494)\n- Fix handling of empty entries in vCard import (#6564)\n- Fix bug in parsing some IMAP command responses that include unsolicited replies (#6577)\n- Fix PHP 7.2 compatibility in debug_logger plugin (#6586)\n- Fix so ANY record is not used for email domain validation, use A, MX, CNAME, AAAA instead (#6581)\n- Fix so mime_content_type check in Installer uses files that should always be available (i.e. from program/resources) (#6599)\n- Fix missing CSRF token on a link to download too-big message part (#6621)\n- Fix bug when aborting dragging with ESC key didn't stop the move action (#6623)\n- Fix bug where next row wasn't selected after deleting a collapsed thread (#6655)\n\nRELEASE 1.3.8\n-------------\n- Fix PHP warnings on dummy QUOTA responses in Courier-IMAP 4.17.1 (#6374)\n- Fix so fallback from BINARY to BODY FETCH is used also on [PARSE] errors in dovecot 2.3 (#6383)\n- Enigma: Fix deleting keys with authentication subkeys (#6381)\n- Fix invalid regular expressions that throw warnings on PHP 7.3 (#6398)\n- Fix so Classic skin splitter does not escape out of window (#6397)\n- Fix XSS issue in handling invalid style tag content (#6410)\n- Fix compatibility with MySQL 8 - error on 'system' table use\n- Managesieve: Fix bug where show_real_foldernames setting wasn't respected (#6422)\n- New_user_identity: Fix %fu/%u vars substitution in user specific LDAP params (#6419)\n- Fix support for \"allow-from <uri>\" in \"x_frame_options\" config option (#6449)\n- Fix bug where valid content between HTML comments could have been skipped in some cases (#6464)\n- Fix multiple VCard field search (#6466)\n- Fix session issue on long running requests (#6470)\n\nRELEASE 1.3.7\n-------------\n- Fix PHP Warning: Use of undefined constant IDNA_DEFAULT on systems without php-intl (#6244)\n- Fix bug where some parts of quota information could have been ignored (#6280)\n- Fix bug where some escape sequences in html styles could bypass security checks\n- Fix bug where some forbidden characters on Cyrus-IMAP were not prevented from use in folder names\n- Fix bug where only attachments with the same name would be ignored on zip download (#6301)\n- Fix bug where unicode contact names could have been broken/emptied or caused DB errors (#6299)\n- Fix bug where after \"mark all folders as read\" action message counters were not reset (#6307)\n- Enigma: [EFAIL] Don't decrypt PGP messages with no MDC protection (#6289)\n- Fix bug where some HTML comments could have been malformed by HTML parser (#6333)\n\nRELEASE 1.3.6\n-------------\n- Fix parsing date strings (e.g. from a Date: mail header) with comments (#6216)\n- Fix PHP 7.2: count(): Parameter must be an array in enchant-based spellchecker (#6234)\n- Fix possible IMAP command injection and type juggling vulnerabilities (#6229)\n- Enigma: Fix key selection for signing\n- Enigma: Enable keypair generation on Internet Explorer 11\n- Fix check_request() bypass in places using get_uids() [CVE-2018-9846] (#6238)\n- Fix bug where usernames without domain part could be malformed or converted to lower-case on logon (#6224)\n\nRELEASE 1.3.5\n-------------\n- Managesieve: Fix bug where text: syntax was forced for strings longer than 1024 characters (#6143)\n- Managesieve: Fix missing Save button in Edit Filter Set page of Classic skin (#6154)\n- Fix duplicated labels in Test SMTP Config section (#6166)\n- Fix PHP Warning: exif_read_data(...): Illegal IFD size (#6169)\n- Enigma: Fix key generation in Safari by upgrade to OpenPGP 2.6.2 (#6149)\n- Fix security issue in remote content blocking on HTML image and style tags (#6178)\n- Added 9pt and 11pt to the list of font sizes in HTML editor\n- Fix handling encoding of HTML tags in \"inline\" JSON output (#6207)\n- Fix bug where some unix timestamps were not handled correctly by rcube_utils::anytodatetime() (#6212)\n\nRELEASE 1.3.4\n-------------\n- Fix bug where contacts search could skip some records (#6130)\n- Fix possible information leak - add more strict sql error check on user creation (#6125)\n- Fix a couple of warnings on PHP 7.2 (#6098)\n- Fix broken long filenames when using imap4d server - workaround server bug (#6048)\n- Fix so temp_dir misconfiguration prints an error to the log (#6045)\n- Fix untagged COPYUID responses handling - again (#5982)\n- Fix PHP warning \"idn_to_utf8(): INTL_IDNA_VARIANT_2003 is deprecated\" with PHP 7.2 (#6075)\n- Fix bug where Archive folder wasn't auto-created on login with create_default_folders=true\n- Fix performance issue when parsing malformed and long Date header (#6087)\n- Fix syntax error in mssql.initial.sql (#6097)\n- Fix bug where contacts export by selection returned no more than 10 entries (#6103)\n- Fix searching contacts by address in LDAP source (#6084)\n- Fix X-Frame-Options:ALLOW-FROM support, remove custom click-jacking protection (#6057)\n\nRELEASE 1.3.3\n-------------\n- Fix decoding of mailto: links with + character in HTML messages (#6020)\n- Fix false reporting of failed upgrade in installto.sh (#6019)\n- Fix file disclosure vulnerability caused by insufficient input validation [CVE-2017-16651] (#6026)\n- Fix mangled non-ASCII characters in links in HTML messages (#6028)\n\nRELEASE 1.3.2\n-------------\n- Improve detection for Egde browser and add pointer event support (#5922)\n- Fix bug where pink image was used instead of a thumbnail when image resize fails (#5933)\n- Fix so files size/count limit is verified (client-side) also on drag-n-drop uploads (#5940)\n- Fix invalid template loading on a message error in preview frame (#5941)\n- Fix bug where HTML messages could have been rendered empty on some systems (#5957)\n- Fix wording of \"Mark previewed messages as read\" to \"Mark messages as read\" (#5952)\n- Enigma: Fix decryption of messages encoded with non-ascii charset (#5962)\n- Fix missing cursor in HTML editor on mail reply (#5969)\n- Fix (again) bug where image data URIs in css style were treated as evil/remote in mail preview (#5580)\n- Fix bug where mail search could return empty result on servers without SORT capability (#5973)\n- Fix bug where assets_path wasn't added to some watermark frames\n- Fix so untagged COPYUID responses are also supported according to RFC6851 (#5982)\n- Fix issue caused by non-default session.cookie_lifetime setting (#5961)\n- Fix Edge encoding bug when pasting text into the HTML editor, update to TinyMCE 4.5.8 (#5885)\n- Fix handling of unknown Content-Disposition type (#6002)\n- Fix truncated folder name on messages list in multi-folder mode, for folders with non-ascii characters (#6004)\n- Fix bug where removing the last subfolder did not hide toggle button on its parent record (#6007)\n- Fix bug where ghost messages could be added to the list after fast delete (#5941)\n\nRELEASE 1.3.1\n-------------\n- Don't ignore (global) userlogins/sendmail logs in per_user_logging mode\n- Add Preferences > Mailbox View > Main Options > Layout (#5829)\n- Password: Fix compatibility with PHP 7+ in cpanel_webmail driver (#5820)\n- Managesieve: Fix parsing dot-staffed lines in multiline text (#5838)\n- Managesieve: Fix AM/PM suffix in vacation time selectors\n- Managesieve: Fix bug where 'exists' operator was reset to 'contains' (#5899)\n- Remove non-printable characters from filenames on download/display (#5880)\n- Fix decoding non-ascii attachment names from TNEF attachments (#5646, #5799)\n- Fix uninitialized string offset in rcube_utils::bin2ascii() and make sure rcube_utils::random_bytes() result has always requested length (#5788)\n- Fix bug where HTML messages with @media styles could moddify style of page body (#5811)\n- Fix style issue on selected and unfocused message that is part of a thread (#5798)\n- Fix bug where a.button style from managesieve plugin could impact other elements (#5800)\n- Fix position of selected icon for (Mailvelope) Encrypt button\n- Fix fatal error when using DMY- or MDY-based date format in PostgreSQL (#5808)\n- Fix bug where errors were not printed when using bin/update.sh (#5834)\n- Fix PHP 7.2 warnings on count() use (#5845)\n- Fix bug where Chrome could not upload the same file that was selected before (#5854)\n- Fix duplicate messages on the list after deleting messages on the next to the last page (#5862)\n- Fix bug where messages count was not updated after delete when imap_cache is set (#5872)\n- Fix potential XSS vulnerability with malformed HTML message markup\n- Fix sending message with \"Too many public recipients\" dialog buttons (#5924)\n- Bring back double-click behavior on the message list which was removed in 1.3.0 (#5823)\n- Enigma: Fix decrypting an encrypted+signed message when signature verification fails (#5914)\n\nRELEASE 1.3.0\n-------------\n- Update to TinyMCE 4.5.7\n- Fix bug where invalid recipients could be silently discarded (#5739)\n- Fix conflict with _gid cookie of Google Analytics (#5748)\n- Print error from CLI scripts when system/exec function is disabled (#5744)\n- Fix bug where comment notation within style tag would cause the whole style to be ignored (#5747)\n- Fix bug where it wasn't possible to scroll folders list in Edge (#5750)\n- Fix folders list sorting on Windows - if php-intl is available (#5732)\n- Fix addressbook searching by gender (#5757)\n- Fix prevention from using % and * characters in folder name (#5762)\n- Fix POST parameter reflection in default_charset selector (#5768)\n- Enigma: Fix compatibility with assets_dir\n- Managesieve: Skip redundant LISTSCRIPTS command\n- Fix SQL syntax error on MariaDB 10.2 (#5774)\n- Fix bug where zipdownload ignored files with the same name (#5777)\n- Fix bug where it wasn't possible to set timezone to auto-detected value (#5782)\n\nRELEASE 1.3-rc\n--------------\n- \"Flattened\" the larry theme: fresher look by removing shadows and gradients\n- Support logging to php://stdout (#5721)\n- Add support for DelSp=Yes in format=flowed messages (#5702)\n- Update to jQuery 3.2.1\n- Update to TinyMCE 4.5.6\n- Plugin API: Call message_part_structure hook for sub-parts of multipart/alternative message (#5678)\n- Enigma: Always use detached signatures (#5624)\n- Enigma: Fix handling of messages with nested PGP encrypted parts (#5634)\n- Minimize unwanted message loading in preview frame on drag (#5616)\n- Fix failing database schema check in all engines except mysql (#5730)\n- Fix autocomplete popup closing with click outside the input, don't handle Tab key as Enter (#5606)\n- Fix jsdeps.json synchronization on update, warn about missing requirements of install-jsdeps.sh (#5598)\n- Fix missing thread expand icon on search result in widescreen mode (#5613)\n- Fix bug where image data URIs in css style were treated as evil/remote in mail preview (#5580)\n- Fix bug where external content in src attribute of input/video tags was not secured (#5583)\n- Fix PHP error on update of a contact with multiple email addresses when using PHP 7.1 (#5587)\n- Fix bug where mail content frame couldn't be reset in some corner cases (#5608)\n- Fix bug where some classic skin images were not displayed in IE/Edge (#5614)\n- Fix bug where signature couldn't be added above the quote in Firefox 51 (#5628)\n- Fix regression where groups with email address were resolved to its members' addresses\n- Fix update of group name in the contacts list header on group rename (#5648)\n- Add rewrite rule to disable access to /vendor/bin folder in .htaccess (#5630)\n- Fix bug where it was too easy accidentally move a folder when using the subscription checkbox (#5655)\n- Managesieve: Fix parser issue with empty lines between comments (#5657)\n- Managesieve: Fix possible defect in handling \\r\\n in scripts (#5685)\n- Fix/rephrase \"unsaved changes\" warning when cancelling a draft (#5610)\n- Fix XSS issue in handling of a style tag inside of an svg element [CVE-2017-6820]\n- Fix bug where settings/upload.inc could not be used by plugins (#5694)\n- Fix regression in LDAP fuzzy search where it always used prefix search instead (#5713)\n- Fix bug where namespace prefix could not be truncated on folders list if show_real_foldernames=true (#5695)\n- Fix undesired effects when postgres database uses different timezone than PHP host (#5708)\n- Installer: Fix DB schema initialization on MS SQL Server\n- Fix bug where base_dn setting was ignored inside group_filters (#5720)\n- Password: Fix security issue in virtualmin and sasl drivers [CVE-2017-8114]\n\nRELEASE 1.3-beta\n----------------\n- Nicely handle contact deletion on contact edit (#5522)\n- vcard_attachments: Add possibility to attach contact vCard to composed message (#4997)\n- Preserve message internal/received date on import in mbox format (#5559)\n- Zipdownload: Fix date format in mbox \"From line\"\n- Possibility to display QR code for contacts data (#5030)\n- Added identicon plugin\n- Widescreen layout aka three column view (#5093)\n- Unify automatic marking as \\Seen in preview pane, full-page and extwin views (#5071)\n- Disable double-click on the list when preview pane is on (#5199)\n- Support hostname and hostname:port in force_https option (#5511)\n- Support ALLOW-FROM in x_frame_options (#5122)\n- Allow to omit a subject when sending an email (#5068)\n- Warn about too many disclosed recipients in composed email [max_disclosed_recipients] (#5132)\n- identity_select: Support Received header (#5085)\n- Plugin API: Added get_compose_responses hook (#5457)\n- Display error when trying to upload more files than specified in max_file_uploads (#5483)\n- Add missing sql upgrade file for 'ip' column resize in session table (#5465)\n- Do not show inline images of unsupported mimetype (#5463)\n- Password: Added replacement variables support in password_pop_host (#5539)\n- Password: Don't store passwords in temp files when using dovecotpw (#5531)\n- Password: Added LDAP PPolicy driver (#5364)\n- Password: Added cpanel_webmail driver (#5549)\n- Password: Added possibility to nicely redirect from other plugins on password expiration (#5468)\n- Implement separate action to mark all messages in a folder as \\Seen (#5006)\n- Implement marking as \\Seen in all folders or in a folder and its subfolders (#5076)\n- Archive: Don't reload messages list when it's not needed (#5225)\n- Archive: Add option to automatically mark archived messages as \\Seen (#5142)\n- Improve randomness of password salts and random hashes (#5266)\n- Password/cPanel: Add support for hash authentication and reseller accounts (#5252)\n- Support host-specific imap_conn_options/smtp_conn_options/managesieve_conn_options (#5136)\n- Center and scale images in attachment preview frame (#5421)\n- Added max_message_size option enforced when attaching files to a composed message (#4993)\n- Added Search button in quick search menus (#5312)\n- Implement \"one click\" attachment/messages/photo upload (#5024)\n- Squirrelmail_usercopy: Add option to define character set of data files\n- Removed useless 'created' column from 'session' table (#5389)\n- Dropped legacy browsers support (#5167)\n    - Removed legacy_browser plugin\n    - Removed hacks for IE < 10\n    - Update to jQuery 3.1.1 and jQuery-UI 1.12.0\n    - compile .min.js files with ECMASCRIPT5 option\n- Require PHP >= 5.4\n- Add possibility to preview and download attachments in mail compose (#5053)\n- Add possibility to rename attachments in mail compose (#4996)\n- Remove backward compatibility \"layer\" of bc.php (#4902)\n- Support WEBP images in mail messages (#5362)\n- Support MathML in HTML message preview (#5182)\n- Rename Addressbook to Contacts (#5233)\n- Remove PHP mail() support, smtp_server is required now (#5340)\n- Display full message subject in onmouseover on truncated subject in mail view (#5346)\n- Enigma: Support GnuPG 2.1 (#5313)\n- Enigma: Support key generation for multiple identities (#5383)\n- Enigma: Import keys from key-server(s) (#5286)\n- Enigma: Search missing public keys on a key-server in mail compose (#5286)\n- Enigma: Delete user keys when using deluser.sh script\n- Enigma: Fix redundant list-secret-keys/list-public-keys calls on signing/encryption\n- Enigma: Implement PGP encryption and signing in one go (#5302)\n- Enigma: Display signature verification status for encrypted+signed messages (#5302)\n- Display different attachment icon on encrypted messages\n- Display different confirmation text when moving messages to Trash (#5220)\n- Indicate that a collapsed thread has flagged children (#5013)\n- Implemented message/rfc822 attachment preview\n- Update to jsTimezoneDetect 1.0.6\n- Managesieve: Add (optional) RAW script editor (#5414)\n- Managesieve: Add option to automatically set vacation :from address (#5428)\n- Managesieve: Support 'string' test from variables extension [RFC 5229] (#5248)\n- Managesieve: Support 'duplicate' extension [RFC 7352]\n- Managesieve: Unhide advanced rule controls if there are inputs with errors\n- Managesieve: Display warning message when filter form contains errors\n- Control search engine crawlers via X-Robots-Tag header instead of <meta> and robots.txt (#5098)\n- Fixed redundancy in sql caching system and compatibility with Galera Cluster (#5439)\n    - Removed redundant 'created' column from cache and cache_shared tables\n    - Removed use of redundant data records\n    - Added missing primary keys (dictionary, cache, cache_shared tables)\n- Fix so templating system does not mess with external (e.g. email) content (#5499)\n- Fix redundant keep-alive/refresh after session error on compose page (#5500)\n- Managesieve: Fix handling of scripts with nested rules (#5540)\n- Fix variable substitution in ldap host for some use-cases, e.g. new_user_identity (#5544)\n- Enigma: Fix PHP fatal error when decrypting a message with invalid signature (#5555)\n- Fix adding images to new identity signatures\n- Fix rsync error handling in installto.sh script (#5562)\n- Fix some advanced search issues with multiple addressbooks (#5572)\n- Fix so group/addressbook selection is retained on page refresh\n\nRELEASE 1.2.3\n-------------\n- Searching in both contacts and groups when LDAP addressbook with group_filters option is used\n- Fix vulnerability in handling of mail()'s 5th argument\n- Fix To: header encoding in mail sent with mail() method (#5475)\n- Fix flickering of header topline in min-mode (#5426)\n- Fix bug where folders list would scroll to top when clicking on subscription checkbox (#5447)\n- Fix decoding of GB2312/GBK text when iconv is not installed (#5448)\n- Fix regression where creation of default folders wasn't functioning without prefix (#5460)\n- Enigma: Fix bug where last records on keys list were hidden (#5461)\n- Enigma: Fix key search with keyword containing non-ascii characters (#5459)\n- Fix bug where deleting folders with subfolders could fail in some cases (#5466)\n- Fix bug where IMAP password could be exposed via error message (#5472)\n- Fix bug where it wasn't possible to store more that 2MB objects in memcache/apc,\n  Added memcache_max_allowed_packet and apc_max_allowed_packet settings (#5452)\n- Fix \"Illegal string offset\" warning in rcube::log_bug() on PHP 7.1 (#5508)\n- Fix storing \"empty\" values in rcube_cache/rcube_cache_shared (#5519)\n- Fix missing content check when image resize fails on attachment thumbnail generation (#5485)\n- Fix displaying attached images with wrong Content-Type specified (#5527)\n\nRELEASE 1.2.2\n-------------\n- Enigma: Add possibility to configure gpg-agent binary location (enigma_pgp_agent)\n- Enigma: Fix signature verification with some IMAP servers, e.g. Gmail, DBMail (#5371)\n- Enigma: Make recipient key searches case-insensitive (#5434)\n- Fix regression in resizing JPEG images with Imagick (#5376)\n- Managesieve: Fix parsing of vacation date-time with non-default date_format (#5372)\n- Use SymLinksIfOwnerMatch in .htaccess instead of FollowSymLinks disabled on some hosts for security reasons (#5370)\n- Wash position:fixed style in HTML mail for better security (#5264)\n- Fix bug where memcache_debug didn't work for session operations\n- Fix bug where Message-ID domain part was tied to username instead of current identity (#5385)\n- Fix bug where blocked.gif couldn't be attached to reply/forward with insecure content\n- Fix E_DEPRECATED warning when using Auth_SASL::factory() (#5401)\n- Fix bug where names of downloaded files could be malformed when derived from the message subject (#5404)\n- Fix so \"All\" messages selection is resetted on search reset (#5413)\n- Fix bug where folder creation could fail if personal namespace contained more than one entry (#5403)\n- Fix error causing empty INBOX listing in Firefox when using an URL with user:password specified (#5400)\n- Fix PHP warning when handling shared namespace with empty prefix (#5420)\n- Fix so folders list is scrolled to the selected folder on page load (#5424)\n- Fix so when moving to Trash we make sure the folder exists (#5192)\n- Fix displaying size of attachments with zero size\n- Fix so \"Action disabled\" error uses more appropriate 404 code (#5440)\n\nRELEASE 1.2.1\n-------------\n- Update TinyMCE to version 4.3.13 (#5309)\n- Fix bug where errors could have been not logged when per_user_logging=true\n- Fix bug where message list columns could be in wrong order after column drag-n-drop and list sorting\n- Fix so minified publickey.js (with cache-buster) is used when available (#5254)\n- Fix (replace) application/x-tar file extension test as it might not exist in nginx config (#5253)\n- Fix PHP warning when password_hosts is set, but is not an array (#5260)\n- Fix redundant keep-alive requests when session_lifetime is greater than ~20000 (#5273)\n- Fix so subfolders of INBOX can be set as Archive (#5274)\n- Fix bug where multi-folder search could choose a wrong folder in \"this and subfolders\" scope (#5282)\n- Fix bug where multi-folder search didn't work for unsubscribed INBOX (#5259)\n- Fix bug where \"no body\" alert could be displayed when sending mailvelope email\n- Enigma: Fix keys import from inside of an encrypted message (#5285)\n- Enigma: Fix malformed signed messages with force_7bit=true (#5292)\n- Enigma: Add possibility to configure gpg binary location (enigma_pgp_binary)\n- Enigma: Add possibility to export private keys (#5321)\n- Fix searching by email address in contacts with multiple addresses (#5291)\n- Fix handling of --delete argument in moduserprefs.sh script (#5296)\n- Workaround PHP issue by calling closelog() on script shutdown when using log_driver=syslog (#5289)\n- Fix so upgrade script makes sure program/lib directory does not contain old libraries (#5287)\n- Fix subscription checkbox state on error in folder subscribe/unsubscribe action (#5243)\n- Fix bug where microsecond format in logged date didn't work in some cases\n- Fix conflict in new_user_dialog and password_force_new_user settings (#5275)\n- Don't create multipart/alternative messages with empty text/plain part (#5283)\n- Use contact_search_name format in popup on results in compose contacts search\n- Fix handling of 'mailto' and 'error' arguments in message_before_send hook (#5347)\n- Fix missing localization of HTML editor when assets_dir != INSTALL_PATH\n- Fix handling of blockquote tags with mixed case on html2text conversion (#5363)\n- Fix javascript errors in IE on page with iframe that points to another domain\n\nRELEASE 1.2.0\n-------------\n- Enigma: Added enigma_debug option\n- Fix message list multi-select/deselect issue (#5219)\n- Fix bug where getting HTML editor content could steal focus from other form controls (#5223)\n- Fix bug where contact search menu fields where always unchecked in Larry skin\n- Fix autoloading of 'html' class\n- Fix bug where Encrypt button appears when switching editor to HTML (#5235)\n- Fix XSS issue in href attribute on area tag (#5240)\n\nRELEASE 1.2-rc\n--------------\n- Managesieve: Refactored script parser to be 100x faster\n- Enigma: added option to force users to use signing/encryption\n- Enigma: Added option to attach public keys to sent mail (#5152)\n- Enigma: Handle messages with text before an encrypted block (#5149)\n- Enigma: Handle encrypted/signed content inside message/rfc822 attachments\n- Enigma: Fix missing html/plain switch on multipart/signed messages (#4963)\n- Enigma: Disable format=flowed for signed plain text messages (#4960)\n- Enigma: Fix handling of encrypted + signed messages (#4950)\n- Enigma: Fix invalid boundary use in signed messages structure\n- Enable use of TLSv1.1 and TLSv1.2 for IMAP (#4955)\n- Save copy of original .htaccess file when using installto.sh script (#4947)\n- Fix regression where some message attachments could be missing on edit/forward (#4939)\n- Fix regression in displaying contents of message/rfc822 parts (#4937)\n- Fix handling of message/rfc822 attachments on replies and forwards (#4938)\n- Fix PDF support detection in Firefox > 19 (#4941)\n- Fix path traversal vulnerability in setting a skin [CVE-2015-8770] (#4945)\n- Fix so drag-n-drop of text (e.g. recipient addresses) on compose page actually works (#4944)\n- Fix .htaccess rewrite rules to not block .well-known URIs (#4943)\n- Fix mail view scaling on iOS (#4915)\n- Fix PHP7 warning \"session_start(): Session callback expects true/false return value\" (#4948)\n- Fix XSS issue in SVG images handling [CVE-2015-8864, CVE-2016-4068] (#4949)\n- Fix missing language name in \"Add to Dictionary\" request in HTML mode (#4951)\n- Fix (again) security issue in DBMail driver of password plugin [CVE-2015-2181] (#4958)\n- Fix bug where Archive/Junk buttons were not active after page jump with select=all mode (#4961)\n- Fix bug in long recipients list parsing for cases where recipient name contained @-char (#4964)\n- Plugin API: Added addressbook_export hook\n- Fix additional_message_headers plugin compatibility with Mail_Mime >= 1.9 (#4966)\n- Hide DSN option in Preferences when smtp_server is not used (#4967)\n- Fix handling of body parameter in mail compose request\n- Protect download urls against CSRF using unique request tokens [CVE-2016-4069] (#4957)\n- newmail_notifier: Refactor desktop notifications\n- Fix so contactlist_fields option can be set via config file\n- Fix so SPECIAL-USE assignments are forced only until user sets special folders (#4782)\n- Fix performance in reverting order of THREAD result\n- Fix converting mail addresses with @www. into mailto links (#5197)\n\nRELEASE 1.2-beta\n----------------\n- Update TinyMCE to version 4.2\n- Added support for Redis session handler\n- Removed some deprecated methods: https://github.com/roundcube/roundcubemail/commit/454b0b1c\n- Remove backward compatibility \"layer\" of bc.php (#4902)\n- Add possibility to define date format in write operations for ldap attributes (#3956)\n- Display attachment size in compose (#1329)\n- Added possibility to drag-n-drop attachments from mail preview to compose window\n- Implemented mail messages searching with predefined date interval\n- PGP encryption support via Mailvelope integration\n- PGP encryption support via Enigma plugin\n- PHP7 compatibility fixes (#4836)\n- Security: Added brute-force attack prevention via login rate limit (#4922)\n- Security: Added options to validate username/password on logon (#4884)\n- Security: Improve randomness of security tokens (#4899)\n- Security: Use random security tokens instead of hashes based on encryption key (#4829)\n- Security: Improved encrypt/decrypt methods with option to choose the cipher_method (#4492)\n- Make optional adding of standard signature separator - sig_separator (#3276)\n- Optimize folder_size() on Cyrus IMAP by using special folder annotation (#4894)\n- Make optional hidding of folders with name starting with a dot - imap_skip_hidden_folders (#4870)\n- Add option to enable HTML editor always, except when replying to plain text messages (#4352)\n- Emoticons: Added option to switch on/off emoticons in compose editor (#2076)\n- Emoticons: Added option to switch on/off emoticons in plain text messages\n- Emoticons: All emoticons-related functionality is handled by the plugin now\n- Installer: Add button to save generated config file in system temp directory (#3553)\n- Remove common subject prefixes Re:, Re[x]:, Re-x: on reply (#4882)\n- Added GSSAPI/Kerberos authentication plugin - krb_authentication\n- Password: Allow temporarily disabling the plugin functionality with a notice\n- Require Mbstring and OpenSSL extensions (#5166)\n- Add --config and --type options to moduserprefs.sh script (#4651)\n- Implemented memcache_debug and apc_debug options\n- Installer: Remove system() function use (#4695)\n- Password plugin: Added 'kpasswd' driver by Peter Allgeyer\n- Add initdb.sh to create database from initial.sql script with prefix support (#4722)\n- Plugin API: Added disabled_plugins an disabled_buttons options in html_editor hook\n- Plugin API: Added html2text hook\n- Plugin API: Added message_part_body hook\n- Plugin API: Added message_ready hook\n- Plugin API: Add special onload() method to execute plugin actions before startup (session and GUI initialization)\n- Implemented UI element to jump to specified page of the messages list (#1677)\n- Fix searching of contacts to allow remote images for known senders (#4886)\n- Fix bug where clicking date column with 'arrival' sorting would switch to sorting by 'date' (#4690)\n- Fix bug where message content could overlap attachments list in Larry skin (#4876)\n- Fix so microseconds macro (u) in log_date_format works (#4855)\n- Fix so unrecognized TNEF attachments are displayed on the list of attachments (#5138)\n- Fix so database_attachments::cleanup() does not remove attachments from other sessions (#4907)\n- Fix responses list update issue after response name change (#4917)\n- Fix bug where message preview was unintentionally reset on check-recent action (#4921)\n- Fix bug where HTML messages with invalid/excessive css styles couldn't be displayed (#4905)\n- Fix redundant blank lines when using HTML and top posting (#4927)\n- Fix redundant blank lines on start of text after html to text conversion (#4928)\n- Fix HTML sanitizer to skip <!-- node type X --> in output (#4932)\n- Fix invalid LDAP query in ACL user autocompletion (#4934)\n\nRELEASE 1.1.3\n-------------\n- Fix closing of nested menus (#4854)\n- Fix so E_DEPRECATED errors from PEAR libs are ignored by error_reporting change (#4770)\n- Fix compatibility with PHP 5.3 in rcube_ldap class (#4842)\n- Get rid of Mail_mimeDecode package dependency (#4836)\n- Fix \"Importing...\" message does not hide on error (#4840)\n- Fix Compose action in addressbook for results from multiple addressbooks (#4834)\n- Fix bug where some messages in multi-folder search couldn't be viewed/printed/downloaded (#4843)\n- Fix unintentional messages list page change on page switch in compose addressbook (#4844)\n- Fix race-condition in saving user preferences and loading plugin config (#4845)\n- Fix so plain text signature field uses monospace font (#4848)\n- Fix so links with href == content aren't added to links list on html to text conversion (#4847)\n- Fix handling of non-break spaces in html to text conversion (#4849)\n- Fix self-reply detection issues (#4852)\n- Fix multi-folder search result sorting by arrival date (#4858)\n- Fix so *-request@ addresses in Sender: header are also ignored on reply-all (#4860)\n- Update to TinyMCE 4.1.10 (#5164)\n- Fix draft removal after a message is sent and storing sent message is disabled (#4869)\n- Fix so imap folder attribute comparisons are case-insensitive (#4868)\n- Fix bug where new messages weren't added to the list in search mode\n- Fix wrong positioning of message list header on page scroll in Webkit browsers (#4646)\n- Fix some javascript errors in rare situations (#4853)\n- Fix error when using back button after sending an email (#4628)\n- Fix removing signature when switching to identity with an empty sig in HTML mode (#4872)\n- Disable links list generation on html-to-text conversion of identities or composed message (#4850)\n- Fix \"washing\" of style elements wrapped into many lines\n- Fix so input field (e.g. search box) does not loose focus on list load (#4862)\n- Fix so css of one html part does not apply to other text parts on message display (#4887)\n- Fix XSS issue in drag-n-drop file uploads [CVE-2015-8105] (#4900)\n- Fix handling of plus character in mailto: links (#4891)\n- Fix so adding CC/BCC recipients from the sidebar unhides compose form fields in Classic skin (#4874)\n- Fix so gc.sh script removes also expired sessions from sql database (#4893)\n- Fix support for Mozilla-based browsers, e.g. Pale Moon (#4895)\n- Fix various issues with Turkish (and similar) locales (#4896)\n- Fix so In-Reply-To header is set also for MDN receipts (#4897)\n- Fix missing HTTP_X_FORWARDED_FOR address in generated Received header\n- Fix issue where Content-Length of some attachments could be set to wrong value causing browser errors (#4877)\n\nRELEASE 1.1.2\n-------------\n- Add new plugin hook 'identity_create_after' providing the ID of the inserted identity (#4807)\n- Add option to place signature at bottom of the quoted text even in top-posting mode [sig_below]\n- Fix handling of %-encoded entities in mailto: URLs (#4799)\n- Fix zipped messages downloads after selecting all messages in a folder (#4797)\n- Fix vpopmaild driver of password plugin\n- Fix PHP warning: Non-static method PEAR::setErrorHandling() should not be called statically (#4798)\n- Fix tables listing routine on mysql and postgres so it skips system or other database tables and views (#4796)\n- Fix message list header in classic skin on window resize in Internet Explorer (#4732)\n- Fix so text/calendar parts are listed as attachments even if not marked as such (#4795)\n- Fix lack of signature separator for plain text signatures in html mode (#4802)\n- Fix font artifact in Google Chrome on Windows (#4803)\n- Fix bug where forced extwin page reload could exit from the extwin mode (#4801)\n- Fix bug where some unrelated attachments in multipart/related message were not listed (#4805)\n- Fix mouseup event handling when dragging a list record (#4808)\n- Fix bug where preview_pane setting wasn't always saved into user preferences (#4809)\n- Fix bug where messages count was not updated after message move/delete with skip_deleted=false (#4814)\n- Fix security issue in contact photo handling (#4817)\n- Fix possible memcache/apc cache data consistency issues (#4820)\n- Fix bug where imap_conn_options were ignored in IMAP connection test (#4822)\n- Fix bug where some files could have \"executable\" extension when stored in temp folder (#4815)\n- Fix attached file path unsetting in database_attachments plugin (#4823)\n- Fix issues when using moduserprefs.sh without --user argument (#4825)\n- Fix potential info disclosure issue by protecting directory access (#4816)\n- Fix blank image in html_signature when saving identity changes (#4833)\n- Installer: Use openssl_random_pseudo_bytes() (if available) to generate des_key (#4827)\n- Fix XSS vulnerability in _mbox argument handling (#4837)\n\nRELEASE 1.1.1\n-------------\n- ACL: Allow other plugins to adjust the list of permissions and groups to edit\n- Add possibility to print contact information (of a single contact)\n- Add possibility to configure max_allowed_packet value for all database engines (#4772)\n- Improved handling of storage errors after message is sent\n- Update to TinyMCE 4.1.9\n- Unified request* event arguments handling, added support for _unlock and _action parameters\n- Security: Generate random hash for the per-user local storage prefix (#4768)\n- Fix refreshing of drafts list when sending a message which was saved in meantime (#4745)\n- Fix saving/sending emoticon images when assets_dir is set\n- Fix PHP fatal error when visiting Vacation interface and there's no sieve script yet (#4778)\n- Fix setting max packet size for DB caches and check packet size also in shared cache\n- Fix needless security warning on BMP attachments display (#4771)\n- Fix handling of some improper constructs in format=flowed text as per the RFC3676[4.5] (#4773)\n- Fix performance of rcube_db_mysql::get_variable()\n- Fix missing or not up-to-date CATEGORIES entry in vCard export (#4766)\n- Fix fatal errors on systems without mbstring extension or mb_regex_encoding() function (#4769)\n- Fix cursor position on reply below the quote in HTML mode (#4759)\n- Fix so \"over quota\" errors are displayed also in message compose page\n- Fix duplicate entries suppression in autocomplete result (#4776)\n- Fix \"Non-static method PEAR::isError() should not be called statically\" errors (#4770)\n- Fix parsing invalid HTML messages with BOM after <!DOCTYPE> (#4777)\n- Fix duplicate entry on timezones list in rcube_config::timezone_name_from_abbr() (#4779)\n- Fix so localized folder name is displayed in multi-folder search result (#4750)\n- Fix javascript error after creating a folder which is a subfolder of another one (#4781)\n- Fix bug where subject of sent/saved message was removed if mbstring wasn't installed (#4780)\n- Fix missing vcard_attachment icon on messages list (#4783)\n- Fix storing signatures with big images in MySQL database (#4785)\n- Fix Opera browser detection in javascript (#4786)\n- Fix so search filter, scope and fields are reset on folder change\n- Fix rows count when messages search fails (#4760)\n- Fix bug where spellchecking in HTML editor do not work after switching editor type more than once (#4789)\n- Fix bug where TinyMCE area height was too small on slow network connection (#4788)\n- Fix backtick character handling in sql queries (#4790)\n- Fix redirect URL for attachments loaded in an iframe when behind a proxy (#4724)\n- Fix menu container references to point to the actual <ul> element (#4791)\n- Fix javascripts errors in IE8 - lack of Event.which, focusing a hidden element (#4793)\n\nRELEASE 1.1.0\n-------------\n- Make SMTP error log more verbose - include server response and error code\n- Fix download options menu (added by zipdownload plugin) in classic skin (#4740)\n- Fix blocked.gif image usage with assets_dir set\n- Fix bug where max_group_members was ignored when adding a new contact (#4733)\n- Hide MDN and DSN options in compose if disabled by admin (#4735)\n- Fix checks based on window.ActiveXObject in IE > 10\n- Fix XSS issue in style attribute handling [CVE-2015-1433] (#4739)\n- Fix bug where Drafts list wasn't updated on draft-save action in new window (#4737)\n- Fix so \"set as default\" option is hidden if identities_level > 1 (#4738)\n- Fix bug where search was reset after returning from compose visited for reply\n- Fix javascript error in \"IE 8.0/Tablet PC\" browser (#4730)\n- Fix bug where Reply-To address was ignored on reply to messages sent by self (#4742)\n- Fix bug where empty fieldmap config entries caused empty results of ldap search (#4741)\n- Fix bug where drafts list wasn't refreshed after draft message was sent from another window (#4745)\n- Fix keyboard navigation and css in datepicker widget across many Firefox versions\n- Fix false warning when opening attached text/plain files (#4748)\n- Fix bug where signature could have been inserted twice after plain-to-html switch (#4746)\n- Fix security issue in DBMail driver of password plugin (#4757)\n- Enable FollowSymLinks option in .htaccess file which is required by rewrite rules (#4754)\n- Fix so JSON.parse() errors on localStorage items are ignored (#4752)\n\nRELEASE 1.1-rc\n--------------\n- Update jQuery to version 2.1.3\n- Allow to override any config option through env variables\n- Improve system security by using optional special URL with security token - use_secure_urls\n- Allow to define separate server/path for image/js/css files - assets_url/assets_dir\n- Sync vendor folder if exists in source package (#4700)\n- Avoid useless reloading list when resetting search with active filter (#4654)\n- Fix invalid folder selection if clicked while busy (#4709)\n- Fix import of multiple contact email addresses from Outlook-csv format (#4714)\n- Fix drag-n-drop to folders expanded while dragging (#4708)\n- Fix import of multiple contact groups from Google-csv format (#4710)\n- Fix import of contacts with multiple email addresses from Google-csv format (#4719)\n- Fix bugs where CSRF attacks were still possible on some requests [CVE-2014-9587]\n- Fix some rcube_utils::anytodatetime() corner cases with timezone mismatches (#4712)\n- Improve move-to and contact-export button in classic skin (#4713)\n- Fix wrong icon for download button in classic skin\n- Fix bug where sent message was saved in Sent folder even if disabled by user (#4729)\n\nRELEASE 1.1-beta\n----------------\n- Fix skin path handling in plugin context (#4111)\n- Prevent memory exhaustion on image resizing with GD on Windows (#4580)\n- Add plugin hook for database table name lookups as requested in #4538\n- Added Oracle database support\n- Support contacts import in GMail CSV format\n- Added namespace filter in Folder Manager\n- Added folder searching in Folder Manager\n- Fix restoring draft messages from localStorage if editor mode differs (#4631)\n- Added config option/user preference to disable saving messages in localStorage (#4606)\n- Added config option 'imap_log_session' to enable Roundcube <-> IMAP session ID logging\n- Added config option 'log_session_id' to control the length of the session identifier in logs\n- Implemented 'storage_connected' API hook after successful IMAP login (#4638)\n- Intergrate Net_LDAP3 and rcube_ldap_generic classes\n- Add option (disabled_actions) to disable UI elements/actions (#4478)\n- Support password encryption using openssl extension (#4614)\n- Create/rename groups in UI dialogs (#4592)\n- Added 'contact_search_name' option to define autocompletion entry format\n- Display quota information for current folder not INBOX only (#3442)\n- Support images in HTML signatures (#3917)\n- Display full quota information in popup (#2103, #2746)\n- Mail compose: Selecting contact inserts recipient to previously focused input - to/cc/bcc accordingly (#4487)\n- Close \"no subject\" prompt with Enter key (#4463)\n- Password: Add option to force new users to change their password (#2963)\n- Improve support for screen readers and assistive technology using WCAG 2.0 and WAI ARIA standards\n- Enable basic keyboard navigation throughout the UI (#3333)\n- Select/scroll to previously selected message when returning from message page (#4146)\n- Display a warning if popup window was blocked (#4472)\n- Remove (was: ...) from message subject on reply (#4359)\n- Update to TinyMCE 4.1 (#4168)\n- Enable autolink plugin in TinyMCE (#4029)\n- Support image operations with Imagick extension (#4498)\n- Support upload progress with session.upload_progress and PECL uploadprogress module (#3934)\n- Make identity name field optional (#4435)\n- Utility script to remove user records from the local database\n- Plugin API: Added message_saved hook (#4503)\n- Plugin API: Added imap_search_before hook\n- Support messages import from zip archives\n- Zipdownload: Added mbox format support (#2354)\n- Drop support for IE6, move IE7/IE8 support to legacy_browser plugin\n- Update to jQuery-2.1.1\n- Search across multiple folders (#1676)\n- Improve UI integration of ACL settings\n- Drop support for PHP < 5.3.7\n- Set In-Reply-To and References for forwarded messages (#4465)\n- Removed redundant default_folders config option (#4500)\n- Implemented IMAP SPECIAL-USE extension support [RFC6154] (#3326)\n- Optimize some framed pages content for better performance (#4517)\n- Improve text messages display and conversion to HTML (#4091)\n- Don't remove links when html signature is converted to text (#4473)\n- Fix page title when using search filter (#4636)\n- Fix mbox files import\n- Fix some character sets detection (#4694)\n- Fix so attachment charset is set in headers of forward/draft message (#4676)\n- Fix bug where wrong charset could be used for text attachment preview page (#4674)\n\nRELEASE 1.0.5\n-------------\n- Fix wrong icon for download button in classic skin\n- Fix checks based on window.ActiveXObject in IE > 10\n- Fix XSS issue in style attribute handling (#4739)\n- Fix bug where Drafts list wasn't updated on draft-save action in new window (#4737)\n- Fix so \"set as default\" option is hidden if identities_level > 1 (#4738)\n- Fix javascript error in \"IE 8.0/Tablet PC\" browser (#4730)\n- Fix bug where empty fieldmap config entries caused empty results of ldap search (#4741)\n- Fix bug where sent message was saved in Sent folder even if disabled by user (#4729)\n\nRELEASE 1.0.4\n-------------\n- Disable TinyMCE contextmenu plugin as there are more cons than pros in using it (#4684)\n- Fix bug where show_real_foldernames setting wasn't honored on compose page (#4705)\n- Fix issue where Archive folder wasn't protected in Folder Manager (#4706)\n- Fix compatibility with PHP 5.2. in rcube_imap_generic (#4682)\n- Fix setting flags on servers with no PERMANENTFLAGS response (#4667)\n- Fix regression in SHAA password generation in ldap driver of password plugin (#4670)\n- Fix displaying of HTML messages with absolutely positioned elements in Larry skin (#4672)\n- Fix font style display issue in HTML messages with styled <span> elements (#4671)\n- Fix download of attachments that are part of TNEF message (#4668)\n- Fix handling of uuencoded messages if messages_cache is enabled (#4675)\n- Fix handling of base64-encoded attachments with extra spaces (#4678)\n- Fix handling of UNKNOWN-CTE response, try do decode content client-side (#4650)\n- Fix bug where creating subfolders in shared folders wasn't possible without ACL extension (#4680)\n- Fix reply scrolling issue with text mode and start message below the quote (#4681)\n- Fix possible issues in skin/skin_path config handling (#4689)\n- Fix lack of delimiter for recipient addresses in smtp_log (#4703)\n- Fix generation of Blowfish-based password hashes (#4721)\n- Fix bugs where CSRF attacks were still possible on some requests [CVE-2014-9587]\n\nRELEASE 1.0.3\n-------------\n- Initialize HTML editor before restoring a message from localStorage (#4631)\n- Add 'sig_max_lines' config option to default config file (#5162)\n- Add config option to specify IMAP connection socket parameters - imap_conn_options (#4589)\n- Add option to set default message list mode - default_list_mode (#3157)\n- Enable contextmenu plugin for TinyMCE editor (#3062)\n- Fix insert-signature command in external compose window if opened from inline compose screen (#4663)\n- Fix some mime-type to extension mapping checks in Installer (#4610)\n- Fix errors when using localStorage in Safari's private browsing mode (#4619)\n- Fix bug where $Forwarded flag was being set even if server didn't support it (#4621)\n- Fix various iCloud vCard issues, added fallback for external photos (#4617)\n- Fix invalid Content-Type header when send_format_flowed=false (#4616)\n- Fix errors when adding/updating contacts in active search (#4630)\n- Fix incorrect thumbnail rotation with GD and exif orientation data (#4641)\n- Fix contacts list update after adding/deleting/moving a contact (#4640, #4644)\n- Fix handling of email addresses with quoted domain part (#4647)\n- Fix comm_path update on task switch (#4648)\n- Fix error in MSSQL update script 2013061000.sql (#4658)\n- Fix validation of email addresses with IDNA domains (#4661)\n\nRELEASE 1.0.2\n-------------\n- Fix storing unsaved drafts in localStorage (#4529)\n- Add configurable LDAP_OPT_DEREF option (#4546)\n- Fix so when switching editor mode original version of signature is used (#4032)\n- Fix unintentional draft autosave request if autosave is disabled (#4550)\n- Fix malformed References: header in send/saved mail (#4552)\n- Fix handling unicode characters in links (#4555)\n- Fix incorrect handling of HTML comments in messages sanitization code (#4558)\n- Fix so current page is reset on list-mode change (#4561)\n- Fix so responses menu hides on click in classic skin (#4566)\n- Fix unintentional line-height style modification in HTML messages (#4567)\n- Fix broken normalize_string(), add support for ISO-8859-2 (#4568)\n- Support csv contacts import in German localization (#4570)\n- Fix so message list and counters are updated when a message is opened in new window (#4569)\n- Fix malformed recipient name when composing a message by clicking on mailto link (#4583)\n- Fix list reload after sending message in another window (#4576)\n- Fix so address format errors are ignored when saving a draft (#4594)\n- Fix incorrect label translation in return receipt (#4598)\n- Fix security issue in delete-response action - allow only ajax request\n- Fix Delete button state after deleting identity/response (#4603)\n- Fix bug where contacts with no email address were listed on compose addressbook (#4602)\n- Fix images import from various vCard formats (#4604)\n- Fix sorting messages by size on servers without SORT capability (#4608)\n\nRELEASE 1.0.1\n-------------\n- Support 'error' and 'body_file' return attribs in 'message_before_send' hook (#4467)\n- Apply user-specific replacements to group's base_dn property (#4512)\n- Fix missing email address when importing contacts from outlook csv (#4535)\n- Fix bug where \"With attachment\" option in search filter wasn't selected after return from mail view (#4508)\n- Fix \"washing\" of unicoded style attributes (#4510)\n- Fix unintentional redirect from compose page in Webkit browsers (#4516)\n- Fix messages index cache update under some conditions (e.g. proxy) (#4505)\n- Fix lack of translation of special folders in some configurations (#4520)\n- Fix XSS issue in plain text spellchecker (#4524)\n- Fix invalid page title for some folders (1489804)\n- Fix redundant alert message on over-size uploads (#4528)\n- Fix next message display after removing a message (#4521)\n- Fix missing Mail-Followup-To header in sent mail (#4534)\n- Fix error when spell-checking an empty text (#4536)\n- Avoid popupmenus being closed when scrollbar is clicked (#4537)\n- Add proxy_whitelist configuration option (#4496)\n- Fix identities_level=4 handling in new_user_dialog plugin (#4540)\n- Fix various db_prefix issues (#4539)\n- Fix too small length of users.preferences column data type on MySQL\n- Fix redundant warning when switching from html to text in empty editor (#4530)\n- Fix invalid host validation on login (#4541)\n- Fix IMAP connection test in installer so it is aware of imap_auth_type (#4502)\n\nRELEASE 1.0.0\n-------------\n- Added toolbar button to move message in message view\n- Fix style of disabled protocol handler link on IE (#4460)\n- Fix message import dialog when no file is selected (#4488)\n- Fix opening compose screen in new window after saving as draft (#4479)\n- Fix directories check in Installer on Windows (#4462)\n- Fix issue when default_addressbook option is set to integer value (#4379)\n- Fix Opera > 15 detection (#4455)\n- Fix security issue in DomainFactory driver of Password plugin\n- Fix invalid X-Draft-Info on forwarded message draft (#4464)\n- Fix regression in handling of 'attachments' result in message_compose hook (#4474)\n- Fix issue where msgexport.sh printed the message to STDOUT instead of a file (#4476)\n- Fix fatal error in database_attachments plugin under some conditions (#4495)\n\nRELEASE 1.0-rc\n--------------\n- Small CSS fix with message notice boxes in Larry skin (#4429)\n- Include groups in contacts search on mail compose (#4186)\n- Add mime-type mapping for .7z files (#4436)\n- Invoke update scripts with php to circumvent execution restrictions (#4330)\n- Fix drag & drop message/contact moving on touch device (#4395)\n- Fix canned responses in HTML mode (#4446)\n- Check/create default folders on every login not only the first (#4391)\n- Update to jQuery-1.11.0 and jQuery-UI-1.9.2\n- Support SMTP socket context options via new config option 'smtp_conn_options'\n- Fix compatibility with PHP 5.2 in html.php file (#4438)\n- Remove expand/collapse with plus/minus keys (on numeric keypad) (#4437)\n- Fix issue where filesystem path was added to all-attachments (zip) file (#4433)\n- Fix case-sensitivity of email addresses handling on compose (#1899)\n- Don't alter Message-ID of a draft when sending (#4381)\n- Fix issue where deprecated syntax for HTML lists was not handled properly (#3975)\n- Display different icons when Trash folder is empty or full (#2108)\n- Remember last position of more headers switch (#3660)\n- Fix so message flags modified by another client are applied on the list on refresh (#1639)\n- Fix broken text/* attachments when forwarding/editing a message (#4393)\n- Improved minified files handling, added css minification (#3041)\n- Fix handling of X-Forwarded-For header with multiple addresses (#4424)\n- Fix border issue on folders list in classic skin (#4419)\n- Implemented menu actions to copy/move messages, added folder-selector widget (#863)\n- Fix security rules in .htaccess preventing access to base URL without the ending slash (#4422)\n- Fix regression where only first new folder was placed in correct place on the list (#4418)\n- Fix issue where children of selected and collapsed thread were skipped on various actions (#4410)\n- Fix issue where groups were not deleted when \"Replace entire addressbook\" option on contacts import was used (#4388)\n- Fix unreliable mimetype tests in Installer (#4408)\n- Fix performance of listing writeable folders (#4406)\n\nRELEASE 1.0-beta\n----------------\n- Fix handling of invalid closing tags in HTML messages (#4403)\n- Set real content-type for file downloads (#4400)\n- Update TinyMCE to version 3.5.10 (#4401)\n- Fix keyboard navigation in list widgets (#4367)\n- Allow plugins to grab the reference of opened windows (#4383)\n- Larry skin: Improved status message display for better visibility (#4115)\n- Fix Internet Explorer 11 detection (#4397)\n- Fix date column width to fit the widest possible date format (#4354)\n- Move certain user preference options to a collapsed \"advanced\" block (#4015)\n- Add file type icons for Powerpoint and Open Office presentations (#4269)\n- Fix operations on folders with trailing spaces in name (#4387)\n- Improve identity selection based on From: header (#4360)\n- Fix issue where mails with inline images of the same name contained only the first image multiple times (#4378)\n- Use left/right arrow keys to collapse/expand thread and spacebar to select a row, change Ctrl key behavior (#4367)\n- Fix an issue where using arrow keys to go up a list can result in selected message being under headers (#4375)\n- Fix an issue where Home/End keys don't focus list row properly, don't scrollTo properly (#4370)\n- Add an option to disable smart Reply-List behaviour - reply_all_mode (#3953)\n- Fix an issue where pressing minus key on contacts list was hiding list records (#4368)\n- Fix an issue where shift + arrow-up key wasn't selecting all messages in collapsed thread (#4371)\n- Added icon for priority column in messages list header (#4275)\n- New feature \"Canned Responses\" to save and recall boilerplate text snippets\n- Fix HTML part detection when encapsulated inside multipart/signed (#4357)\n- Add spellchecker backend for the After the Deadline service\n- Replace markdown-style [1] link indexes in plain text email bodies\n- Improved mailto: link arguments handling (#4351)\n- Use DOMDocument LIBXML_PARSEHUGE and LIBXML_COMPACT options if possible (#4316)\n- Support HTTP_HOST, SERVER_NAME and SERVER_ADDR values in include_host_config feature\n- Make default font size for HTML messages configurable (request #118)\n- Fix XSS issue in addressbook group name field [CVE-2013-5646] (#4337)\n- After message is sent refresh messages list of replied message folder (#4282)\n- Add option force specified domain in user login - username_domain_forced (#4290)\n- Add option to import Vcards with group assignments\n- Save groups membership in Vcard export (#3801)\n- Workaround broken PHP function timezone_name_from_abbr (#4289)\n- Make cached message size limit configurable - messages_cache_threshold (#4326)\n- Log also failed logins to userlogins log\n- Add temp_dir_ttl configuration option (#4318)\n- Allow setting INBOX as Sent folder (#4264)\n- Fix replacement variables in user-specific base_dn in some LDAP requests (#4299)\n- Fix image scaling issues when image has only one dimension smaller than the limit (#4296)\n- Fix issue where uploaded photo was lost when contact form did not validate (#4296)\n- Move identity selection based on non-standard headers into (new) identity_select plugin (#3835)\n- Fix downloading binary files with (wrong) text/* content-type (#4292)\n- Respect HTTP_X_FORWARDED_FOR and HTTP_X_REAL_IP variables for session IP check\n- Simplified configuration by merging it into one file + defaults (#3156)\n- Make message list header stay on top when scrolling (#353)\n- Add support for 'enchant' spellcheck engine\n- Check filetype detection in installer and update script (#4252)\n- Fix folder names truncation in Classic skin (#4265)\n- Make possible to disable some (broken) IMAP extensions with imap_disable_caps option (#4245)\n- Contacts drag-n-drop default action is to move contacts (#3962)\n- Added possibility to choose to move or copy contacts from drag-n-drop menu (#3962)\n- Fix Close link and remove About link on error pages (#4201)\n- Improved/unified attachment preview screen, added print button\n- Fix lack of space between searchfiler and quicksearchbar in Larry skin (#4233)\n- Cache LDAP's user_specific search and use vlv for better performance (#4247)\n- LDAP: auto-detect and use VLV indices for all search operations\n- LDAP: additional group configuration options for  address books\n- LDAP: separated address book implementation from a generic LDAP wrapper class\n- Allow address books to browse a multi-level group hierarchy in the contacts list\n- Fix session issues when local and database time differs (#2401)\n- Fix thread cache syncronization/validation (#4150)\n- Added feature to import messages to the currently selected folder\n- Add option show_real_foldernames to disable localization of special folders\n- Fix database cache expunge issues (#4229)\n- Fix date format issues on MS SQL Server (#4078)\n- Add imap_cache_ttl option to configure TTL of imap_cache\n- Make LDAP cache engine configurable via ldap_cache and ldap_cache_ttl options\n- Fix \"duplicate entry\" errors on inserts to imap cache tables (#4228)\n- Improved handling of Reply-To/Bcc addresses of identity in compose form (#4142)\n- Added user preference to open all popups as standard windows\n- Implemented shared cache (rcube_cache_shared)\n- Change Reply-All button label/title when mailing list is detected (#4092)\n- Fix SMTP connection using IPv6 address in smtp_server option (#4147)\n- Added attachment_reminder plugin\n- Make PHP code eval() free, use create_function()\n- Add option to display email address together with a name in mail preview (#3952)\n- Support CSV import from Atmail (#4161)\n- Add db_prefix configuration option in place of db_table_*/db_sequence_* options\n- Make possible to use db_prefix for schema initialization in Installer (#4175)\n- Fix updatedb.sh script so it recognizes also table prefix for external DDL files\n- Fix parsing invalid date string (#4155)\n- Add \"with attachment\" option to messages list filter (#1795)\n- Call resize handler in intervals to prevent lags and double onresize calls in Chrome (#4137)\n- Add rel=\"noreferrer\" for links in displayed messages (#4976)\n- Add ability to toggle between HTML and text while viewing a message (#3005)\n- Remove \"HTML message\" from attachments list while viewing a message in text mode (#3005)\n- Support IMAP MOVE extension [RFC 6851]\n- Add attachment menu with Open and Download options (#4116)\n- Display user-friendly message on IMAP \"over quota\" errors (#914)\n- Extended archive plugin with user-configurable options to store messages into subfolders\n- Fix export of selected contacts from search result (#4070)\n- Feature to export only selected contacts from addressbook (by Phil Weir)\n\nRELEASE 0.9.5\n-------------\n- Fix failing vCard import when email address field contains spaces (#4363)\n- Fix default spell-check configuration after Google suspended their spell service\n- Fix vulnerability in handling _session argument of utils/save-prefs [CVE-2013-6172] (#4362)\n- Fix iframe onload for upload errors handling (#4361)\n- Fix address matching in Return-Path header on identity selection (#4358)\n- Fix text wrapping issue with long unwrappable lines (#4356)\n- Fixed issues where HTML comments inside style tag would hang Internet Explorer\n- Hide Delivery Status Notification option when smtp_server is unset (#4339)\n- Display full attachment name using title attribute when name is too long to display (#4328)\n- Fix attachment icon issue when rare font/language is used (#4334)\n- Fix expanded thread root message styling after refreshing messages list (#4335)\n- Fix issue where From address was removed from Cc and Bcc fields when editing a draft (#4327)\n- Fix error_reporting directive check (#4331)\n- Fix de_DE localization of \"About\" label in Help plugin (#4333)\n\nRELEASE 0.9.4\n-------------\n- Make identities matching case insensitive (#1881)\n- Fix issue where too big message data was stored in cache causing sql errors (#4325)\n- Fix iframe scrollbars on webkit desktop browsers (#4319)\n- Fix issue where legacy config was overridden by default config (#4305)\n- Fix newmail_notifier issue where favicon wasn't changed back to default (#4324)\n- Fix setting of Junk and NonJunk flags by markasjunk plugin (#4303)\n- Fix lack of Reply-To address in header of forwarded message body (#4314)\n- Fix bugs when invoking contact creation form when read-only addressbook is selected (#4313)\n- Fix identity selection on reply (#4308)\n- Fix so additional headers are added to all messages sent (#4302)\n- Fix display issue after moving folder in Folder Manager (#4310)\n- Fix handling of non-default date formats (#4311)\n- Fix unquoted path in PREG expression on Windows (#4307)\n- Fix wrong close tag in /template/mail.html (#4312)\n\nRELEASE 0.9.3\n-------------\n- Fix setting refresh_interval to \"Never\" in Preferences (#4304)\n- Fixed iframe scrolling on touch devices\n- Optimized message list for touch devices\n- Fix purge action in folder manager (#4300)\n- Fix base URL resolving on attribute values with no quotes (#4297)\n- Fix wrong handling of links with '|' character (#4298)\n- Fix colorspace issue on image conversion using ImageMagick (#4294)\n- Fix XSS vulnerability when editing a message \"as new\" or draft [CVE-2013-5645] (#4283)\n- Fix XSS vulnerability when saving HTML signatures [CVE-2013-5645] (#4283)\n- Fix rewrite rule in .htaccess (#4278)\n- Fix detecting Turkish language in ISO-8859-9 encoding (#4284)\n- Fix identity-selection using Return-Path headers (#4279)\n- Fix parsing of links with ... in URL (#4251)\n- Fix compose priority selector when opening in new window (#4286)\n- Fix bug where signature wasn't changed on identity selection when editing a draft (#4272)\n- Fix IMAP SETMETADATA parameters quoting (#4274)\n- Fix \"could not load message\" error on valid empty message body (#4271)\n- Fix handling of message/rfc822 attachments on message forward and edit (#4262)\n- Fix parsing of square bracket characters in IMAP response strings (#4267)\n- Don't clear References and in-Reply-To when a message is \"edited as new\" (#4263)\n- Fix messages list sorting with THREAD=REFS\n- Remove deprecated (in PHP 5.5) PREG /e modifier usage (#4239)\n- Fix empty messages list when register_globals is enabled (#4232)\n- Fix so valid and set date.timezone is not required by installer checks (#4242)\n- Canonize boolean ini_get() results (#4249)\n- Fix so install do not fail when one of DB driver checks fails but other drivers exist (#4240)\n- Fix so exported vCard specifies encoding in v3-compatible format (#4244)\n\nRELEASE 0.9.2\n-------------\n- Fix image thumbnails display in print mode (#4220)\n- Fix height of message headers block (#4200)\n- Fix timeout issue on drag&drop uploads (#4238)\n- Fix default sorting of threaded list when THREAD=REFS isn't supported\n- Fix list mode switch to 'List' after saving list settings in Larry skin (#4236)\n- Fix error when there's no writeable addressbook source (#4235)\n- Fix zipdownload plugin issue with filenames charset (#4231)\n- Fix so non-inline images aren't skipped on forward (#4230)\n- Fix \"null\" instead of empty string on messages list in IE10 (#4227)\n- Fix legacy options handling\n- Fix so bounces addresses in Sender headers are skipped on Reply-All (#4140)\n- Fix bug where serialized strings were truncated in PDO::quote() (#4226)\n- Fix displaying messages with invalid self-closing HTML tags (#4223)\n- Fix PHP warning when responding to a message with many Return-Path headers (#4222)\n- Fix unintentional compose window resize (#4206)\n- Fix performance regression in text wrapping function (#4219)\n- Fix connection to posgtres db using unix socket (#4218)\n- Fix handling of comma when adding contact from contacts widget (#4199)\n- Fix bug where a message was opened in both preview pane and new window on double-click (#4212)\n- Fix fatal error when xdebug.max_nesting_level was exceeded in rcube_washtml (#4202)\n- Fix PHP warning in html_table::set_row_attribs() in PHP 5.4 (#4194)\n- Fix invalid option selected in default_font selector when font is unset (#4204)\n- Fix displaying contact with ID divisible by 100 in sql addressbook (#4211)\n- Fix browser warnings on PDF plugin detection (#4209)\n- Fix fatal error when parsing UUencoded messages (#4210)\n\nRELEASE 0.9.1\n-------------\n- Better German labels for from/to to avoid conflicts with 'sender' (#4188)\n- Fix problem where security warning was displayed for valid images with image/jpg type (#4196)\n- Fix handling of invalid email addresses in headers (#4193)\n- Fix IMAP connection issue with default_socket_timeout < 0 and imap_timeout < 0 (#4191)\n- Fix various PHP code bugs found using static analysis (#4190)\n- Fix backslash character handling on vCard import (#4189)\n- Fix csv import from Thunderbird with French localization (#4170)\n- Fix messages list focus issue in Opera and Webkit (#4169)\n- Fix Reply-To header handling in Reply-All action (#4157)\n- Fix so Sender: address is added to Cc: field on reply to all (#4140)\n- Fix so addressbook_search_mode works also for group search (#4183)\n- Fix removal of a contact from a group in LDAP addressbook (#4185)\n- Include SQL query in the log on SQL error (#4172)\n- Fix handling untagged responses in IMAP FETCH - \"could not load message\" error (#4180)\n- Fix very small window size in Chrome (#4087)\n- Fix list page reset when viewing a message in Larry skin (#4182)\n- Fix min_refresh_interval handling on preferences save (#4179)\n- Fix PDF support detection for Firefox PDF.js (#4113)\n- Fix possible collision in generated thumbnail cache key (#4177)\n- Fix exit code on bootsrap errors in CLI mode (#4160)\n- Fix error handling in CLI mode, use STDERR and non-empty exit code (#5161)\n- Fix error when using check_referer=true\n- Fix incorrect handling of some specific links (#4171)\n- Fix incorrect handling of leading spaces in text wrapping\n- Fix unintentional messages list jumps on click in Internet Explorer (#4167)\n- Fix list of required configuration options (#4166)\n- Fix DB error when creating a new contact and a group is selected (#4164)\n- Fix handling of deprecated boolean value of reply_mode option (#4165)\n\nRELEASE 0.9.0\n-------------\n- Fix display of HTML entities in protected folder name (#4159)\n- Set minimal permissions to temp files (#4131)\n- Improve content check for embedded images without filename (#4151)\n- Fix handling of invalid characters in message headers and output (#4153)\n- Fix selecting collapsed rows on select-all (#4156)\n- Avoid race-conditions with concurrent attachment uploads (#3739)\n- Fix possible header duplicates when using additional headers (#4154)\n- Fix session issues with use_https=true (#4125)\n- Fix blockquote width in sent mail (#4152)\n- Fix keyboard events on list widgets in Internet Explorer (#4148)\n\nRELEASE 0.9-rc2\n---------------\n- Fix security issue in save-pref command\n- Remove sig_above configuration option, use reply_mode only (#4135)\n- Refresh current folder in opener window after draft save or message sent (#4132)\n- Fix saving draft just after entering compose window (#4141)\n- Fix javascript error in IE9 when loading form with placeholders into an iframe (#4138)\n- Fix handling of some conditional comment tags in HTML message (#4136)\n- Fix so forward as attachment works if additional attachment is added by message_compose hook (#4134)\n- Better handling of session errors in ajax requests (#4105)\n- Fix HTML part detection for some specific message structures (#4130)\n- Don't show fake address - phishing prevention (#4120)\n- Fix forward as attachment bug with editormode != 1 (#4129)\n- Fix LIMIT/OFFSET queries handling on MS SQL Server (#4123)\n- Fix so task name can really contain all from a-z0-9_- characters (#4095)\n- Fix javascript errors when working in a page opened with taget=\"_blank\"\n- Mention SQLite database format change in UPGRADING file (#4122)\n- Increase maxlength to 254 chars for email input fields in addressbook (#4126)\n- Fix thumbnail size when GD extension is used for image resize (#4124)\n- Display notice that message is encrypted also for application/pkcs7-mime messages (#3815)\n\nRELEASE 0.9-rc\n--------------\n- Fix plain text spellchecker incorrect highlighting in non-ASCII text (#4114)\n- Add workaround for invalid message charset detection by IMAP servers (#4112)\n- Fix NUL characters in content-type of ms-tnef attachment (#4108)\n- Fix regression in handling LDAP contact identifiers (#4104)\n- Updated translations from Transifex\n- Fix buggy error template in a frame (#4092)\n- Add addressbook widget on compose page in classic skin\n- Add search box to compose address book widget (#3710)\n- Fix login in case when default_host is an array with one element (#4085)\n- Use LDAP fallback hosts on connect + bind instead of ldap_connect() only.\n- Add config option for LDAP bind timeout (sets LDAP_OPT_NETWORK_TIMEOUT option)\n- Submit Addressbook advanced search form with Enter key (#3843)\n- Also block remote images in HTML part view (#4013)\n- Improved database schema upgrade procedure, added updatedb.sh script\n- Force autocommit mode in mysql database driver (#4068)\n\nRELEASE 0.9-beta\n----------------\n- Fix searching by date in address book (#4058)\n- Improve charset detection by prioritizing charset according to user language (#2032)\n- Fix handling of escaped separator in vCard file (#4064)\n- Add option to use envelope From address for MDN responses (#4052)\n- Add possibility to search in message body only (#3977)\n- Support \"multipart/relative\" as an alias for \"multipart/related\" type (#4057)\n- Display PGP/MIME signature attachments as \"Digital Signature\" (#3845)\n- Workaround UW-IMAP bug where hierarchy separator is added to the shared folder name (#4051)\n- Fix version comparisons with -stable suffix (#4050)\n- Add unsupported alternative parts to attachments list (#4046)\n- Add Compose button on message view page (#3959)\n- Display 'Sender' header in message preview\n- Plugin API: Added message_before_send hook\n- Fix contact copy/add-to-group operations on search result (#4042)\n- Use matching identity in MDN response (#4043)\n- Fix handling of signatures on draft edit (#3996)\n- Fix so compacting of non-empty folder is possible also when messages list is empty (#4039)\n- Allow forwarding of multiple emails (#2941)\n- Fix big memory consumption of DB layer (#4037)\n- Fix broken message/part bodies when FETCH response contains more untagged lines (#4020)\n- Fix empty email on identities list after identity update (#4018)\n- Add new identities_level: (4) one identity with possibility to edit only signature\n- Use Delivered-To and Envelope-To headers for identity selection (#4024, #3835)\n- Fix XSS vulnerability using Flash files (#4014)\n- Always save drafts with format=flowed in order to keep original line wraps (#3997)\n- Select default_addressbook on the list in Address Book (#3624)\n- Fix so mobile phone has TYPE=CELL in exported vCard (#4004)\n- Support contacts import from CSV file (#2605)\n- Improved keep-alive action. Now the interval is based on session_lifetime (#3799)\n- Added cross-task 'refresh' request for system state updates (#3799)\n- Renamed config options: keep_alive to refresh_interval, min_keep_alive to min_refresh_interval\n- Fix handling of text/enriched content on message reply/forward/edit\n- Option to display attached images as thumbnails below message body\n- Upgraded to jQuery 1.8.3 and jQuery UI 1.9.1\n- Add config option to automatically generate LDAP attributes for new entries\n- Add user settings to open message view and compose form in new windows (#1886)\n- Better client-side timezone detection using the jsTimezoneDetect library (#3947)\n- Add option to disable saving sent mail in Sent folder - no_save_sent_messages (#3923)\n- Fix handling dont_override with message_sort_col and message_sort_order settings (#3970)\n- Fix handling of URLs with asterisk characters (#3969)\n- Remove automatic to-lowercase conversion of usernames (#3941)\n- Plugin API: Add 'email_list' argument for identities data in user_create hook\n- Integrated zipdownload plugin to download all attachments (#617)\n- Fix HTML special characters handling in message list/header display (#3812)\n- List related text/html part as attachment in plain text mode (#3918)\n- Use IMAP BINARY (RFC3516) extension to fetch message/part bodies\n- Fix folder creation under public namespace root (#3910)\n- Fix so \"Edit as new\" on draft creates a new message (#3924)\n- Fix invalid error message on deleting mail from read only folder (#3929)\n- Replace data URIs of images (pasted in HTML editor) with inline attachments (#3795)\n- Remove (too big) min-width on mail screen\n- Added template object 'frame'\n- Add option to enable HTML editor on forwarding (#3807)\n- Add option to not include original message on reply, rename option top_posting to reply_mode (#1615)\n- Added session_path config option and unified cookies settings in javascript\n- Added \"Undeleted\" option to messages list filter\n- Rewritten test scripts for PHPUnit\n- Add new DB abstraction layer based on PHP PDO, supporting SQLite3 (#3668)\n- Removed PEAR::MDB2 package\n- Removed users.alias column, added option ('user_aliases')\n  to use email address from identities as username (#3851)\n- Removed redundant cache.cache_id column (#3817)\n- Fix order of attachments in sent mail (#3740)\n- Fix Shift + delete button does not permanently delete messages (#3598)\n- Add Content-Length for attachments where possible (#1880)\n- Fix attachment sizes in message print page and attachment preview page (#3805)\n- Add mail attachments using drag & drop on HTML5 enabled browsers\n- Add workaround for invalid BODYSTRUCTURE response - parse message with Mail_mimeDecode package (#1966)\n- Display Tiff as Jpeg in browsers without Tiff support (#3757)\n- Don't display Pdf/Tiff/Flash attachments inline without browser support (#3757, #3394)\n- Add is_escaped attribute for html_select and html_textarea (#3782)\n- Fix issue where draft auto-save wasn't executed after some inactivity time\n- Add vCard import from multiple files at once (#3458)\n- Roundcube Framework:\n    Add possibility to replace IMAP driver with custom class\n    Add IMAP auto-connection feature, improving performance with caching enabled\n    Replace imap_init hook with storage_init (with additional 'driver' argument)\n    Improved performance by caching IMAP server's capabilities in session\n    Unified global functions naming (rcube_ prefix)\n    Better classes separation\n    Framework files moved to lib/Roundcube\n\nRELEASE 0.8.5\n-------------\n- Fix #countcontrols issue in IE<=8 when text is very long (#4060)\n- Fix unwanted horizontal scrollbar in message preview header (#4044)\n- Add workaround for IE<=8 bug where Content-Disposition:inline was ignored (#4028)\n- Fix XSS vulnerability in vbscript: and data:text links handling [CVE-2012-6121] (#4033)\n- Fix absolute positioning in HTML messages (#4007)\n- Fix cache (in)validation after setting \\Deleted flag\n- Fix keybord events on messages list in opera browser (#4011)\n- Fix selection of collapsed thread rows (#3978)\n- Fix wrapping of quoted text with format=flowed (#3561)\n\nRELEASE 0.8.4\n-------------\n- Fix regression where unintentional page reload was done after request abort (#3999)\n- Fix XSS vulnerability in handling of text/enriched messages (#4000)\n- Fix handling of 'media' attribute on linked css (#3989)\n- Fix excessive LFs at the end of composed message with top_posting=true (#3995)\n- Fix bug where leading blanks were stripped from quoted lines (#3994)\n\nRELEASE 0.8.3\n-------------\n- Fix AREA links handling (#3992)\n- Fix possible HTTP DoS on error in keep-alive requests (#3983)\n- Fix compatybility with MDB2 2.5.0b4 (#3982)\n- Fix a bug where saving a message in INBOX wasn't possible\n- Fix HTML part detection in messages with attachments (#3976)\n- Fix bug where wrong words were highlighted on spell-before-send check\n- Fix scrolling quirk in email preview frame using Opera 12 (#3973)\n- Fix displaying of multipart/alternative messages with empty parts (#3961)\n- Fix threaded list sorting on PHP < 5.2.9 (#3960)\n- Fix Warning: htmlspecialchars(): charset `RCMAIL_CHARSET' not supported warning in Installer (#3958)\n\nRELEASE 0.8.2\n-------------\n- Fix XSS vulnerability from HTTP User-Agent header (#3954)\n- Force fonts in compose fields to be all the same (#3926)\n- Fix handling vCard entries with TEL;TYPE=CELL (#3949)\n- Fix error where session wasn't updated after folder rename/delete (#3928)\n- Fix PLAIN authentication for some IMAP servers (#3916)\n- Fix encoding vCard file when contains PHOTO;ENCODING=b (#3922)\n- Fix focus issue in IE when selecting message row (#3881)\n- Add full headers view in message preview window (#3823)\n- Fix message display page issues - unified with message preview (#3856, #3895)\n- Fix displaying all headers when they contain malformed characters (#3911)\n- Fix decoding of HTML messages with UTF-16 charset specified (#3902)\n- Fix quota capability detection so it can be overwritten by a plugin (#3903)\n- Fix identity selection on reply (#3516)\n- Fix Larry's messages list filter in IE (#3890)\n- Fix more IE issues by disabling Compat. mode with X-UA-Compatible meta tag (#3886)\n- Fix setting locales under Solaris - use additional .UTF-8 suffix (#3887)\n- Fix email address validation for addresses with IP address in domain part\n- Fix Larry skin issues in IE7 compat. mode (#3879)\n- Fix so subscribed non-existing/non-accessible shared folder can be unsubscribed\n\nRELEASE 0.8.1\n-------------\n- Fix bug where domain name was converted to lower-case even with login_lc=false (#3859)\n- Fix lower-casing email address on replies (#3863)\n- Fix line separator in exported messages (#3866)\n- Fix XSS issue where plain signatures wasn't secured in HTML mode [CVE-2012-4668] (#3875)\n- Fix XSS issue where href=\"javascript:\" wasn't secured [CVE-2012-3508] (#3875)\n- Fix impossible to create message with empty plain text part (#3873)\n- Fix stripped apostrophes when replying in plain text to HTML message (#3869)\n- Fix inactive Save search option after advanced search (#3870)\n- Fix Remove from group option is active for contact search result (#3871)\n- Disable autocapitalization in login form on iPad/iPhone (#3872)\n- Fix focus on the list when list row is clicked (#3865)\n- Added separate From and To columns apart from smart From/To column (#2970)\n- Fix fallback to Larry skin when configured skin isn't available (#3857)\n- Fix (workaround) delete operations with some versions of memcache (#3858)\n- Fix (disable) request validation for spell and spell_html actions\n\nRELEASE 0.8.0\n-------------\n- Don't show product version on login screen (can be enabled by config)\n- Renamed old default skin to 'classic'. Larry is the new default skin.\n- Support connections to memcached socket file (#3848)\n- Enable TinyMCE inlinepopups plugin\n- Update to TinyMCE 3.5.6\n- Correctly escape localized labels in javascript variable (#3842)\n- Update Net_SMTP/Auth_SASL packages to fix Digest-MD5/Cram-MD5 authentication (#3846)\n- Don't add attachments content into reply/forward/draft message body (#3837)\n- Fix 'no connection' errors on page unloads (#3832)\n- Plugin API: Add 'unauthenticated' hook (#3545)\n- Show explicit error message when provided hostname is invalid (#3834)\n- Fix wrong compose screen elements focus in IE9 (#3826)\n- Fix fatal error when date.timezone isn't set (#3831)\n- Update to TinyMCE 3.5.4.1\n- Better icons with distinct shapes for priority columns (#3706)\n- Show dedicated icon for multipart/report messages (#3813)\n- Properly hide text of icon links/buttons (#3820)\n- Fix handling of unitless CSS size values in HTML message (#3821)\n- Fix removing contact photo using LDAP addressbook (#3737)\n- Fix storing X-ANNIVERSARY date in vCard format (#3816)\n- Update to Mail_Mime-1.8.5 (#3810)\n- Fix XSS vulnerability in message subject handling using Larry skin [CVE-2012-3507] (#3809)\n- Fix handling of links with various URI schemes e.g. \"skype:\" (#3521)\n- Fix handling of links inside PRE elements on html to text conversion\n- Fix indexing of links on html to text conversion\n- Decode header value in rcube_mime::get() by default (#3803)\n- Fix errors with enabled PHP magic_quotes_sybase option (#3798)\n- Fix SQL query for contacts listing on MS SQL Server (#3797)\n- Fix window.resize handler on IE8 and Opera (#3758)\n- Don't let error message popups cover the login form (#3794)\n- Update to TinyMCE 3.5.2\n- Don't show errors when moving contacts into groups they are already in (#3788)\n- Make folders with unread messages in subfolders bold again (#2892)\n- Abbreviate long attachment file names with ellipsis (#3793)\n- Fix html2text conversion of strong|b|a|th|h tags when used in upper case\n- Add listcontrols template container in Larry skin (#3792)\n- Fix host autoselection when default_host is an array (#3790)\n- Move messages forwarding mode setting into Preferences\n- Fix HTML entities handling in HTML editor (#3780)\n- Fix listing shared folders on Courier IMAP (#3767)\n\nRELEASE 0.8-rc\n--------------\n- Added new translations in Belarusian, Interlingua and Malayalam\n- Flipped compose options arrow (#3772)\n- Fix handling of large uuencode attachments (#3771)\n- Fix handling of \"usemap\" attribute (#3770)\n- Fix handling of some HTML tags e.g. IMG (#3769)\n- Use similar language as a fallback for plugin localization (#3726)\n- Fix issue where signature wasn't re-added on draft compose (#3659)\n- Update to TinyMCE 3.5 (#3762)\n- Fixed multi-threaded autocompletion when number of threads > number of sources\n- Allow to configure the number of values allowed for each LDAP attribute\n- Support for serialized LDAP address values (usually delimited with a $)\n- Less restrictive session auth checks, repeat keep-alive requests on failure (#3755)\n- Fix redirect to mail/compose on re-login (#3585)\n- Add IE8 hack for messages list issue (#3317)\n- Fix handling errors on draft auto-save\n- Fix importing vCard photo with ENCODING param specified (#3746)\n- Support multiple name/email pairs for Bcc and Reply-To identity settings (#3752)\n- Set flexible width to login form fields (#3735)\n- Fix re-draw bug on list columns change in IE8 (#3318)\n- Allow mass-removal of addresses from a group (#3259)\n- Fix removing all contacts on import to LDAP addressbook\n- Fix so \"Back\" from compose/show doesn't reset search request (#3594)\n- Add option to delete messages instead of moving to Trash when in Junk folder (#2805)\n- Fix invisible cursor when replying to a html message (#3100)\n- Reset IP stored in session when destroying session data (#3485)\n- Fix bug where memory_limit = -1 wasn't handled properly\n- Support LDAP RFC2256's country object class read/write (#3535)\n- Upgraded to jQuery 1.7.2\n- Image resize with GD extension (#3712)\n- Fix lack of warning when switching task in compose window (#3725)\n- Fix bug where it wasn't possible to enter ( or & characters in autocomplete fields\n- Request all needed fields from address book backends (#3721)\n- Unified (single) spellchecker button\n- Scroll long lists on drag&drop (#2249)\n- Copy all skins in installto script (#3705)\n\nRELEASE 0.8-beta\n----------------\n- Upgraded to jQuery 1.7.1 (#3673) and jQuery UI 1.8.18\n- Add Russian to the spellchecker languages list (#3542)\n- Remember custom skin selection after logout (#3688)\n- Make sure About tab is always the last tab (#3609)\n- Fix issue with folder creation under INBOX. namespace (#3683)\n- Added mailto: protocol handler registration link in User Preferences (#2729)\n- Handle identity details box with an iframe (#3066)\n- Fix issue where some text from original message was missing on reply (#3675)\n- Fix autoselect_host() for login (#3639)\n- Changed license to GNU GPLv3+ with exceptions for skins & plugins\n- Added address book widget on compose screen\n- Use proper timezones from PHP's internal timezonedb (#1973)\n- Add separate pagesize setting for mail messages and contacts (#3617)\n- Deprecate $DB, $USER, $IMAP global variables, Use $RCMAIL instead\n- Add option to set default font for HTML message (#894)\n- Fix issues with big memory allocation of IMAP results\n- Prevent from memory_limit exceeding when trying to parse big messages bodies (#3164)\n- Add possibility to add SASL mechanisms for SMTP in smtp_connect hook (#3399)\n- Mark (with different color) folders with recent messages (#2479)\n- Added About tab in Settings\n- TinyMCE updated to 3.4.6\n\nRELEASE 0.7.2\n-------------\n- Fix encoding of attachment with comma in name (#3717)\n- Fix handling of % character in IMAP protocol (#3711)\n- Fix duplicate names handling in addressbook searches (#3704)\n- Fix displaying of HTML messages from Disqus (#3702)\n- Disable E_STRICT warnings on PHP 5.4\n- Prevent from folder selection on virtual folder collapsing (#3681)\n- Fix automatic unsubscribe of non-existent folders\n- Fix double-quotes handling in recipient names\n- User configurable setting how to display contact names in list\n- Make contacts list sorting configurable for the admin/user\n- Fix parse errors in DDL files for MS SQL Server\n- Revert SORT=DISPLAY support, removed by mistake (#3664)\n- Add lost translation label in de_DE (#3654)\n- Fix drafts update issues when edited from preview pane (#3653)\n- Fix wrong variable name in rcube_ldap.php (#3643)\n- Make mime type detection based on filename extension to be case-insensitive\n- Fix failure on MySQL database upgrade from 0.7 - text column can't have default value (#3642)\n\n\nRELEASE 0.7.1\n-------------\n- Fix bug in handling of base href and inline content (#3634)\n- Fix SQL Error when saving a contact with many email addresses (#3630)\n- Fix strict email address searching if contact has more than one address\n- Remove duplicated 'organization' label (#3631)\n- Fix so editor selector is hidden when 'htmleditor' is listed in 'dont_override'\n- Fix wrong (long) label usage (#3627)\n- Fix handling of INBOX's subfolders in special folders config (#3623)\n- Add ifModule statement for setting Options -Indexes in .htaccess file (#3620)\n- Fix crashes with eAccelerator (#3608)\n- Fix searching on IMAP servers without CHARSET specifier support (#3619)\n- Fix expanding folders during drag&drop (#3611)\n- Fix wrong postgres sequence name in upgrade from 0.6\n- Fix broken CREATE INDEX queries in SQLite DDL files (#3607)\n\nRELEASE 0.7\n-----------\n- Make Roundcube render the Email Standards Project Acid Test correctly\n- Replace prompt() with jQuery UI dialog (#1603)\n- Fix navigation in messages search results\n- Improved handling of some malformed values encoded with quoted-printable (#3590)\n- Add possibility to do LDAP bind before searching for bind DN\n- Fix handling of empty <U> tags in HTML messages (#3584)\n- Add content filter for embedded attachments to protect from XSS on IE [CVE-2012-1253] (#3372)\n- Use strpos() instead of strstr() when possible (#3581)\n- Fix handling HTML entities when converting HTML to text (#3582)\n- Fix fit_string_to_size() renders browser and ui unresponsive (#3577)\n- Fix handling of invalid characters in request (#3536)\n- Fix merging some configuration options in update.sh script (#2181)\n- Fix so TEXT key will remove all HEADER keys in IMAP SEARCH (#3578)\n- Fix handling contact photo url with https:// prefix (#3575)\n- Fix possible infinite redirect on attachment preview (#3572)\n- Improved clickjacking protection for browsers which don't support X-Frame-Options headers\n- Fixed bug where similar folder names were highlighted wrong (#3345)\n- Fixed bug in handling link with '!' character in it (#3569)\n- Fixed bug where session ID's length was limited to 40 characters (#3570)\n- TinyMCE security issue: removed moxieplayer (embedding flv and mp4 is not supported anymore)\n\nRELEASE 0.7-beta\n----------------\n- Fix handling of HTML form elements in messages (#1604)\n- Fix regression in setting recipient to self when replying to a Sent message (#3101)\n- Fix listing of folders in hidden namespaces (#2895)\n- Don't consider \\Noselect flag when building folders tree (#3448)\n- Fix sorting autocomplete results (#3504)\n- Add option to set session name (#2630)\n- Add option to skip alternative email addresses in autocompletion\n- Fix inconsistent behaviour of Compose button in Drafts folder, add Edit button for drafts\n- Fix problem with parsing HTML message body with non-unicode characters (#3312)\n- Add option to define matching method for addressbook search (#2720, #3378)\n- Make email recipients separator configurable\n- Fix so folders with \\Noinferiors attribute aren't listed in parent selector\n- Fix handling of curly brackets in URLs (#3555)\n- Fix handling of dates (birthday/anniversary) in contact data (#3552)\n- Fix error on opening searched LDAP contact (#3550)\n- Fix redundant line break in flowed format (#3551)\n- Fix IDN address validation issue (#3544)\n- Fix JS error when dst_active checkbox doesn't exist (#3540)\n- Autocomplete LDAP records when adding contacts from mail (#3498)\n- Plugin API: added 'ready' hook (#3492)\n- Ignore DSN request when it isn't supported by SMTP server (#3300)\n- Make sure LDAP name fields aren't arrays (#3523)\n- Fixed imap test to non-default port when using ssl (#3532)\n- Force all files to be overwritten when updating (#3531)\n- Fix issue where it wasn't possible to change list view mode in folder manager for INBOX (#3522)\n- Fix namespace handling in special folders settings (#3527)\n- Disable time limit for CLI scripts (#3524)\n- Fix misleading display when chaning editor type (#3519)\n- Add loading indicator on contact delete\n- Fix bug where after delete message rows can be added to the list of another folder (#3263)\n- Add notice on autocompletion that not all records were displayed\n- Add option 'searchonly' for LDAP address books\n- Add Priority filter to the messages list\n- Cache synchronization using QRESYNC/CONDSTORE\n- Trigger 'new_messages' hook for all checked folders (#3503)\n- Make date/time format user configurable; drop 'date_today' config option\n- Fix setting title for truncated subject in IE (#3141)\n- Fix displaying multipart/alternative messages with only one part (#3400)\n- Rewritten messages caching:\n  Indexes are stored in a separate table, so there's no need to store all messages in a folder\n  Added threads data caching\n  Flags are stored separately, so flag change doesn't cause DELETE+INSERT, just UPDATE\n- Improved FETCH response handling\n- Improvements in response tokenization method\n- Use 'From' and 'To' labels instead of 'Sender' and 'Recipient'\n- Fix username case-insensitivity issue in MySQL (#3462)\n- Addressbook Saved Searches\n- Added spellchecker exceptions dictionary (shared or per-user)\n- Added possibility to ignore words containing caps, numbers, symbols (spellcheck_ignore_* options)\n- Added 'priority' column on messages list (#2884)\n- Localize forwarded message header (#3487)\n\nRELEASE 0.6\n-----------\n- Fix bug where the last identity is used on reply (#3516)\n- Fix locked folder rename option on servers supporting RFC2086 only (#3508)\n- Fix session race conditions when composing new messages\n- Fix encoding of LDAP contacts identifiers (#3501)\n- jQuery 1.6.4\n- Fix handling of binary attachments encoded with quoted-printable (#3494)\n- Fix text-overflow:ellipsis issues on messages list in FF7 and Webkit (#3490)\n- Fix handling of links with IP address\n- Fix compacting folder resets message list filter (#3499)\n\nRELEASE 0.6-rc\n----------------\n- Send X-Frame-Options headers to protect from clickjacking (#3079)\n- Fallback to mail_domain in LDAP variable replacements; added 'host' to 'user_create' hook arguments (#3464)\n- Fixed wrong vCard type parameter mobile (#3496)\n- Fixed vCard WORKFAX issue (#3476)\n- Add vCard's Profile URL support (#3491)\n- jQuery 1.6.3\n- Fix imap_cache setting to values other than 'db' (#3489)\n- Fix handling of attachments inside message/rfc822 parts (#3466)\n- Make list of mimetypes that open in preview window configurable (#3175)\n- Added plugin hook 'message_part_get' for attachment downloads\n- Added unique connection identifier to IMAP debug messages\n- Fix image type check for contact photo uploads\n\nRELEASE 0.6-beta\n----------------\n- Fixed selecting identity on reply/forward (#3434)\n- Add option to hide selected LDAP addressbook on the list\n- Add client-side checking of uploaded files size\n- Add newlines between organization, department, jobtitle (#3468)\n- Recalculate date when replying to a message and localize the cite header (#3212)\n- Fix handling of email addresses with quoted local part (#3401)\n- Fix EOL character in vCard exports (#3357)\n- Added optional \"multithreading\" autocomplete feature\n- Plugin API: Added 'config_get' hook\n- Fixed new_user_identity plugin to work with updated rcube_ldap class (#3443)\n- Plugin API: added folder_delete and folder_rename hooks\n- Added possibility to undo last contact delete operation\n- Fix sorting of contact groups after group create (#3258)\n- Add optional textual upload progress indicator (#2330)\n- Fix parsing URLs containing commas (#3425)\n- Added vertical splitter for books/groups list in addressbook (#3389)\n- Improved namespace roots handling in folder manager\n- Added searching in all addressbook sources\n- Added addressbook source selection in contacts import\n- Implement LDAPv3 Virtual List View (VLV) for paged results listing\n- Use 'address_template' config option when adding a new address block (#3406)\n- Added addressbook advanced search\n- Add popup with basic fields selection for addressbook search\n- Case-insensitive matching in autocompletion (#3398)\n- Added option to force spellchecking before sending a message (#1862)\n- Fix handling of \"<\" character in contact data, search fields and folder names (#3349)\n- Fix saving \"<\" character in identity name and organization fields (#3349)\n- Added option to specify to which address book add new contacts\n- Added plugin hook for keep-alive requests\n- Store user preferences in session when write-master is not available and session is stored in memcache, write them later\n- Improve performence of folder manager operations\n- Fix default_port option handling in Installer when config.inc.php file exists (#3390)\n- Removed option focus_on_new_message, added newmail_notifier plugin\n- Added general rcube_cache class with Memcache and APC support\n- Improved caching performance by skipping writes of unchanged data\n- Option enable_caching replaced by imap_cache and messages_cache options\n- Fix WORKFAX saving in address book (#3380)\n- Add forward-as-attachment feature\n- jQuery-1.6.2 (#5158, #3154)\n- Improve display name composition when saving contacts (#3153)\n- Fix problems with subfolders of INBOX folder on some IMAP servers (#3247)\n- Fix handling of folders that doesn't belong to any namespace (#3184)\n- Enable multiselection for attachments uploading in capable browsers (#2266)\n- Add possibility to change HTML editor configuration by skin\n- Fix a bug where selecting too many contacts would produce too large URI request (#3369)\n- Improve performance by including files with absolute path (#3337)\n- Move folder name truncation to client/skin (#1822)\n- Added plugin hook for request token creation\n- Replace LDAP vars in group queries (#3329)\n- Fix vcard folding with uncode characters (#3353)\n- Keep all submitted data if contact form validation fails (#3350)\n- Handle uncode strings in rcube_addressbook::normalize_string() (#3351)\n- Fix handling of debug_level=4 in ajax requests (#3327)\n- Enable TinyMCE's contextmenu (#3062)\n- Allow multiple concurrent compose sessions\n- New config option for custom logo\n- Allow skins to define/override texts with <roundcube:label />\n- Add simple ACL rights/namespace handling in folder manager\n- Force IE to send referers (#3306)\n- Better display of vcard import results (#1861)\n- Improved vcard import\n- Interactive update script with improved DB schema check\n- Fix problem with contactgroupmembers table creation on MySQL 4.x, add index on contact_id column\n- Add LDAP SASL bind and proxy authentication (#2810)\n- Replying to a sent message puts the old recipient as the new recipient (#3101)\n- Fulltext search over (almost) all data for contacts\n- Extend address book with rich contact information\n\nRELEASE 0.5.4\n-------------\n- Fix XSS vulnerability in UI messages [CVE-2011-2937] (#3469)\n\nRELEASE 0.5.3\n-------------\n- Fix identities \"reply-to\" and \"bcc\" fields have a bogus value when left empty (#3405)\n- Fix issue which cases IMAP disconnection when encrypt() method was used (#3374)\n- Fix some CSS issues in Settings for Internet Explorer \n- Fixed handling of folder with name \"0\" in folder selector\n- Fix bug where messages were deleted instead moved to trash folder after Shift key was used (#3376)\n- Fix relative URLs handling according to a <base> in HTML (#3368)\n- Fix handling of top-level domains with more than 5 chars or unicode chars (#3366)\n- Fix usage of non-standard HTTP error codes (#3297)\n- Fix PHP warning on mistaken in_array() usage (#3375)\n\nRELEASE 0.5.2\n-------------\n- TinyMCE 3.4.2 now compatible with IE9\n- PEAR::Net_SMTP 1.5.2, fixed timeout issue (#3332)\n- Fix bug where template name without plugin prefix was used in render_page hook\n- Support 'abort' and 'result' response in 'preferences_save' hook, add error handling\n- Fix bug where some content would cause hang on html2text conversion (#3348)\n- Improve space-stuffing handling in format=flowed messages (#3346)\n- Fix bug where some dates would produce SQL error in MySQL (#3342)\n- Added workaround for some IMAP server with broken STATUS response (#3344)\n- Fix bug where default_charset was not used for text messages (#3328)\n- Stateless request tokens. No keep-alive necessary on login page (#3325)\n- Force names of unique constraints in PostgreSQL DDL\n- Add code for prevention from IMAP connection hangs when server closes socket unexpectedly\n- Remove redundant DELETE query (for old session deletion) on login\n- Get around unreliable rand() and mt_rand() in session ID generation (#2516)\n- Fix some emails are not shown using Cyrus IMAP (#3316)\n- Fix handling of mime-encoded words with non-integral number of octets in a word (#3301)\n- Fix parsing links with non-printable characters inside (#3305)\n- Fixed de_CH Localization bugs (#3279)\n- Add variable for 'Today' label in date_today option (#2394)\n- Fix dont_override setting does not override existing user preferences (#3205)\n- Use only one from IMAP authentication methods to prevent login delays (1487784)\n- Support strftime format in date_today option\n- Fix SQL query in rcube_user::query() so it uses index on MySQL again\n- Removed redundant </form> tags from contact add/edit pages\n- Fix CSS error in contact details screen on IE7 (#3281)\n\nRELEASE 0.5.1\n-------------\n- Fix handling of attachments with invalid content type (#3275)\n- Add workaround for DBMail's bug http://www.dbmail.org/mantis/view.php?id=881 (#3274)\n- Use IMAP's ID extension (RFC2971) to print more info into debug log\n- Security: add optional referer check to prevent CSRF in GET requests\n- Fix email_dns_check setting not used for identities/contacts (#3251)\n- Fix ICANN example addresses doesn't validate (#3253)\n- Security: protect login form submission from CSRF [CVE-2011-1491]\n- Security: prevent from relaying malicious requests through modcss.inc [CVE-2011-1492]\n- Fix handling of non-image attachments in multipart/related messages (#3261)\n- Fix IDNA support when IDN/INTL modules are in use (#3253)\n- Fix handling of invalid HTML comments in messages (#3269)\n- Fix parsing FETCH response for very long headers (#3264)\n- Fix add/remove columns in message list when message_sort_order isn't set (#3262)\n- Check mime headers before attempt to parse them (#3256)\n- Quote header values in show_additional_headers plugin (#3255)\n- Fix settings UI on IE 6 (#3246)\n- Remove double borders in folder listing (#3236)\n- Separate full message headers UI element from headers table (#3238)\n- Add part MIME ID to message_part_* hooks (#3241) \n- Improve parsing of MS Outlook vCards (#3239)\n- Updated PEAR::Net_Socket to 1.0.10\n- Updated PEAR::Net_IDNA2 to 0.1.1\n- Fix handling of comments inside an email address spec. (#3210)\n- Show full mail subject as title when hovering a cut subject link (#3141)\n- Fix randomly disappearing folders list in IE (#3231)\n- Fix list column add/removal in IE (#3230)\n- Fix login redirect issues (#3221)\n- Require PHP 5.2.1 or greater\n- Fix %h/%z variables in username_domain option (#3228)\n- Workaround for setting charset in case of malformed bodystructure response (#3227)\n- Fix impossible to subscribe to protected folders (#3199)\n- Fix setting timezone in Preferences (#3232)\n\nRELEASE 0.5\n-----------\n- Fix double-login/session issue (#3124)\n- Wrap HTML parts with <html><body> and add Doctype declaration (#3119)\n- Make rcube_autoload silently skip unknown classes (#3128)\n- Fix charset detection in vcards with encoded values (#1934)\n- Better CSS cursors for splitters (#2954)\n- Show the same message only once (#3186)\n- Fix namespaces handling (#3192)\n- Add handling of multifolder METADATA/ANNOTATION responses\n- Fix handling of INBOX when personal namespace prefix is non-empty (#3200)\n- Fix handling square brackets in links (#3209)\n- Add description of 'use_https' option in main.inc.php.dist file\n\nRELEASE 0.5-RC\n--------------\n- Plugin API: Add 'pass' argument in 'authenticate' hook (#3147)\n- Fix attachments of type message/rfc822 are not listed on attachments list\n- Add 'login_lc' config option for case-insensitive authentication (#3131)\n- Fix window is blur'ed in IE when selecting a message (#3161)\n- Fix cursor position on compose form in Webkit browsers (#2796)\n- Fix setting charset of attachment filenames (#3136)\n- Allow setting autocomplete attribute for all inputs separately (#3158)\n- New Folder Manager UI\n- Fix invalid Request when creating a folder (#3165)\n- Add folder size and quota indicator in folder manager (#2112)\n- Add possibility to move a subfolder into root folder (#2890)\n- Fix copying all messages in a folder copies only messages from current page\n- Improve performance of moving or copying of all messages in a folder\n- Fix plaintext versions of HTML messages don't contain placeholders for emotions (#1657)\n- Improve performance of folder rename and delete actions\n- Better support for READ-ONLY and NOPERM responses handling (#3108)\n- Add confirmation message on purge/expunge command response\n- Fix handling of untagged responses for AUTHENTICATE command (#3171)\n- Add username and IP address to log message on unsuccessful login (#3176)\n- Improved Mail-Followup-To and Mail-Reply-To headers handling\n- Fix charset conversion for text attachments without charset specification (#3181)\n\nRELEASE 0.5-BETA\n----------------\n- Make session data storage more robust against garbage session data (#3148)\n- Config option for autocomplete on login screen\n- Allow plugin templates to include local files (#3146)\n- List groups in address detail view and allow to subscribe/unsubscribe from there (#2862)\n- Messages caching: performance improvements, fixed syncing, fixes related with #2857\n- Add link to identities in compose window (#2843)\n- Add Internationalized Domain Name (IDNA) support (#729)\n- Add option to automatically send read notifications for known senders (#2199)\n- Add option to \"Return receipt\" will be always checked (#2571)\n- Fix HTML to plain text conversion doesn't handle citation blocks (#2992)\n- Use custom sorting when SORT is disabled by IMAP admin (#3020)\n- Allow setting some washtml options from plugin (#2727)\n- Add option do bind for an individual LDAP address book (#3048)\n- Change reply prefix to display email address only if sender name doesn't exist (#2709)\n- Plugin API: improved 'abort' flag handling, added 'result' item in some hooks (#2988)\n- Fix mailto optional params in plain text messages aren't handled (#3071)\n- Add Reply-to-List feature (#977)\n- Add Mail-Followup-To/Mail-Reply-To support (#1937)\n- Fix confirmation message isn't displayed after sending mail on Chrome (#2437)\n- Fix keyboard doesn't work with autocomplete list with Chrome (#3073)\n- Improve tabs to fixed width and add tabs in identities info (#3030)\n- Add unique index on users.username+users.mail_host\n- Make htmleditor option more consistent and add option to use HTML on reply to HTML message (#2164)\n- Use empty envelope sender address for message disposition notifications (RFC 2298.3)\n- Support SMTP Delivery Status Notifications - RFC 3461 (#2409)\n- Use css sprite image for messages list\n- Add (different) attachment icon for messages of type multipart/report (#2426)\n- Prevent from inserting empty link when composing HTML message (#3007)\n- Add caching support in id2uid and uid2id functions (#3065)\n- Add SASL proxy authentication for SMTP (#2811)\n- Improve displaying of UI messages (#3033)\n- Fix double e-mail filed in identity form (#3088)\n- Display IMAP errors for LIST/THREAD/SEARCH commands (#2981)\n- Add LITERAL+ (IMAP4 non-synchronizing literals) support (RFC 2088)\n- Add separate column for message status icon (#2788)\n- Add ACL extension support into IMAP classes (RFC 4314)\n- Add ANNOTATEMORE extension support into IMAP classes (draft-daboo-imap-annotatemore)\n- Add METADATA extension support into IMAP classes (RFC 5464)\n- Fix decoding of e-mail address strings in message headers (#3097)\n- Fix handling of attachments when Content-Disposition is not inline nor attachment (#3086)\n- Improve performance of unseen messages counting (#3090)\n- Improve performance of messages counting using ESEARCH extension (RFC4731)\n- Add LIST-STATUS support in rcube_imap_generic class (RFC 5819)\n- Add SASL-IR support in IMAP (RFC 4959)\n- Add LOGINDISABLED support (RFC 2595)\n- Add support for AUTH=PLAIN in IMAP authentication\n- Re-implemented SMTP proxy authentication support\n- Add support for IMAP proxy authentication (#2808)\n- Add support for AUTH=DIGEST-MD5 in IMAP (RFC 2831)\n- Fix parent folder with unread subfolder not bold when message is open (#3104)\n- Add basic IMAP LIST's \\Noselect option support\n- Add support for selection options from LIST-EXTENDED extension (RFC 5258)\n- Don't list subscribed but non-existent folders (#2474)\n- Fix handling of URLs with tilde (~) or semicolon (;) character (#3110, #3111)\n- Plugin API: added 'contact_form' hook\n- Add SORT=DISPLAY support (RFC 5957)\n- Plugin API: add possibility to disable plugin in AJAX mode, 'noajax' property\n- Plugin API: add possibility to disable plugin in framed mode, 'noframe' property\n- Improve performance of setting IMAP flags using .SILENT suffix\n- Improve performance of message cache status checking with skip_disabled=true\n- Support contact's email addresses up to 255 characters long (#3116)\n- Add option to place replies in the folder of the message being replied to (#2248)\n- Add missing confirmation/error messages on contact/group/message actions (#2935)\n- Add 'loading' message on message move/copy/delete/mark actions\n- Improve responsiveness of messages displaying (#3039)\n- Add option for minimum length of autocomplete's string (#2625)\n- Fix operations on messages in unsubscribed folder (#3126)\n- Add support for shared folders (#525)\n- Fix handling of folders with name \"0\" (#3133)\n- Fix handling of folders with \"<>\" characters in name\n- jQuery 1.4.4\n- Fix handling of HTML entity strings in plain text messages\n- Fix focused elements aren't unfocused when clicking on the list (#3137)\n- Fix error in MSSQL DDL scripts (#3130)\n- Lock submit button in onsubmit event on login page (#3078)\n- Don't set attachment's charset in Content-type header (#3136)\n- Fix handling of message bodies (quoted-printable encoded) with NULL characters (#2448)\n- Add workaround for MSOE's multipart/related messages with non-related attachments\n\nRELEASE 0.4.2\n-------------\n- Fix handling of backslash as IMAP delimiter\n- Fix charset replacement in HTML message bodies (#3067)\n- Fix: contact group input is empty when using rename action more than once on the same group record\n- Fix \"Server Error! (Not Found)\" when using utils/save-pref action (#3069)\n- Fix handling of Thunderbird's vCards (#3070)\n\nRELEASE 0.4.1\n-------------\n- Fix space-stuffing in format=flowed messages (#3064)\n- Fix msgexport.sh now using the new imap wrapper\n- Avoid displaying password on shell (#3010)\n- Only lower-case user name if first login attempt failed (#2600)\n- Make alias setting in squirrelmail_usercopy plugin configurable (patch by pommi, #3056)\n- Prevent from saving a non-existing skin path in user prefs (#3004)\n- Improve handling of single-part messages with bogus BODYSTRUCTURE (#2976)\n- Fix path to SQL files when using pgsql/mysqli/sqlsrv drivers (#2979)\n- Fix upgrade script for SQLite (#2980)\n- Fixes in SQL init script + added update script for MSSQL database\n- Remove redundant date in syslog messages (#3008)\n- Fix contacts list page controls when a group is selected (#3009)\n- Fix SMTP test in Installer (#3014)\n- Fix \"Select all\" causes message to be opened in folder with exactly one message (#2987)\n- Fix Tab key doesn't work in HTML editor in Google Chrome (#2995)\n- Fix TinyMCE uses zh_CN when zh_TW locale is set (#2998)\n- Fix TinyMCE buttons are hidden in Opera (#2993)\n- Fix JS error on IE when trying to send HTML message with enabled spellchecker (#3006)\n- Display inline images with known extensions and non-image content-type (#3002)\n- Fix \"Threaded\" checkbox after subfolder creation (#2997)\n- Fix timezone string in sent mail (#3021)\n- Show disabled checkboxes for protected folders instead of dots (#1898)\n- Added fieldsets in Identity form, added 'identity_form' hook\n- Re-added 'Close' button in upload form (#2999, #2917)\n- Fix handling of charsets with LATIN-* label\n- Fix messages background image handling in some cases (#3043)\n- Fix format=flowed handling (#3042)\n- Fix when IMAP connection fails in 'get' action session shouldn't be destroyed (#3046)\n- Fix list_cols is not updated after column dragging (#3050)\n- Support %z variable in host configuration options (#3054)\n\nRELEASE 0.4\n-----------\n- Fix disappearing upload form disappears when user selects a file on Safari (#2917)\n- Don't replace error messages with loading info (#2534)\n- Fix JS errors on compose mode switch (#2952)\n- Fix message structure parsing when it lacks optional fields (#2960)\n- Include all recipients in sendmail log\n- Support HTTP_X_FORWARDED_PROTO header for HTTPS detecting (#2950)\n- Fix default IMAP port configuration (#2948)\n- Create Sent folder when starting to compose a new message (#2900)\n- Fix handling of messages with Content-Type: application/* and no filename (#840)\n- Improved compose screen: resizable body and attachments list, vertical splitter, options menu\n- Fix RC forgets search results (#722)\n- TinyMCE 3.3.7\n- Improve parsing of styled empty tags in HTML messages (#2908)\n- Add %dc variable support in base_dn/bind_dn config (#2881)\n- Add button to hide/unhide the preview pane (#955)\n- Fix no-cache headers on https to prevent content caching by proxies (#2897)\n- Fix attachment filenames broken with TNEF decoder using long filenames (#2894)\n- Use user's timezone in Date header, not server's timezone (#2393)\n- Add option to set separate footer for HTML messages (#2784)\n- Add real SMTP error description to displayed error messages (#2233)\n- Fix some IMAP errors handling when opening the message (#1848)\n- Fix related parts aren't displayed when got mimetype other than image/* (#2629)\n- Multiple identity and database support for squirrelmail_usercopy plugin (#2686)\n- Support dynamic hostname (%d/%n) variables in configuration options (#1843)\n- Add 'messages_list' hook (#2504)\n- Add request* event triggers in http_post/http_request (#2340)\n- Fix use RFC-compliant line-delimiter when saving messages on IMAP (#2828)\n- Add 'imap_timeout' option (#2869)\n- Fix forwarding of messages with winmail attachments\n- Fix handling of uuencoded attachments in message body (#2163)\n- Added list_mailboxes hook in rcube_imap::list_unsubscribed() (#2791)\n- Fix wrong message on file upload error (#2839)\n- Add support for data URI scheme [RFC2397] (#2851)\n- Added 'actionbefore', 'actionafter', 'responsebefore', 'responseafter' events\n- Fix double-addition of e-mail domain to content ID in HTML images\n- Read and send messages with format=flowed (#1052), fixes word wrapping issues (#2703)\n- Fix duplicated attachments when forwarding a message (#2670)\n- Fix message/rfc822 attachments containing only attachments are not parsed properly (#2854)\n- Fix %00 character in winmail.dat attachments names (#2850)\n- Fix handling errors of folder deletion (#2821)\n- Parse untagged CAPABILITY response for LOGIN command (#2853)\n- Renamed all php-cli scripts to use .sh extension\n- Some files from /bin + spellchecking actions moved to the new 'utils' task\n- Added thread tree icons\n- Extend contact groups support (#2802)\n- Fix check-recent action issues and performance (#2690)\n- Fix messages order after checking for recent (#1249)\n- Fix autocomplete shows entries without email (#2640)\n- Fix listupdate event doesn't trigger on search response (#2824)\n- Fix select_all_mode value after selecting a message (#2834)\n- Set focus to editor on reply in HTML mode (#2768)\n- Fix composing in HTML jumps cursor to body instead of recipients (#2796)\n- Allow columns order change per user - drag&drop (#2124)\n- Add References header in read receipt (#2801)\n- Fix database constraint violation when opening a message (#2814)\n- Add 'loading' message while login is in progress (#2790)\n- Fix quota_zero_as_unlimited (#2786)\n- Fix folder subscription checking (#2804)\n- Fix INBOX appears (sometimes) twice in mailbox list (#2794)\n- Fix listing of attachments of some types e.g. \"x-epoc/x-sisx-app\" (#2779)\n- Fix DB Schema checking when some db_table_* options are not set (#2780)\n\nRELEASE 0.4-beta\n----------------\n- Add sizelimit and timelimit variables in LDAP config (#2704)\n- Hide IMAP host dropdown when single host is defined (#2553)\n- Add images pre-loading on login page (#623)\n- Add HTTP_X_REAL_IP and HTTP_X_FORWARDED_FOR to successful logins log (#2634)\n- Fix setting spellcheck languages with extended codes (#2747)\n- Fix messages list scrolling in FF3.6 (#2657)\n- Fix quicksearch input focus (#2770)\n- Always set changed date when flagging a DB record as deleted + provide a cleanup script\n- Fix address book/group selection (#2760)\n- Assign newly created contacts to the active group (#2764)\n- Added option not to mark messages as read when viewed in preview pane (#1513)\n- Allow plugins modify the Sent folder when composing (#2708)\n- Added optional (max_recipients) support to restrict total number of recipients per message (#1167)\n- Re-organize editor buttons, add blockquote and search buttons\n- Make possible to write inside or after a quoted html message (#1878)\n- Fix bugs on unexpected IMAP connection close (#2449, #2507)\n- Iloha's imap.inc rewritten into rcube_imap_generic class\n- Added contact groups in address book (not finished yet)\n- Added PageUp/PageDown/Home/End keys support on lists (#2627)\n- Added possibility to select all messages in a folder (#1312)\n- Added 'imap_force_caps' option for after-login CAPABILITY checking (#2087)\n- Password: Support dovecotpw encryption\n- TinyMCE 3.3.1\n- Implemented messages copying using drag&drop + SHIFT (#863)\n- Improved performance of folders operations (#2689)\n- Fix blocked.gif attachment is not attached to the message (#2685)\n- Managesieve: import from Horde-INGO\n- Managesieve: support for more than one match (#2362)\n- Managesieve: support for selectively disabling rules within a single sieve script (#2198)\n- Threaded message listing now available\n- Added sorting by ARRIVAL and CC\n- Message list columns configurable by the user\n- Removed 'index_sort' option, now we're using empty 'message_sort_col' for this\n- virtuser_query: support other identity data (#2413)\n- Options virtuser_* replaced with virtuser_* plugins\n- Plugin API: Implemented 'email2user' and 'user2email' hooks\n- Fix forwarding message omits CC header (#2538)\n- Add 'default_charset' option to user preferences (#1855)\n- Add 'delete_always' option to user preferences\n- Support/Require tls:// prefix in 'smtp_server' option for TLS connections\n- Fix inconsistent behaviour of 'delete_always' option (#2533)\n- Fix deleting all messages from last list page (#2528)\n- Flag original messages when sending a draft (#2458)\n- Changed signature separator when top-posting (#2555)\n- Let the admin define defaults for search modifiers (#2211)\n- Fix long e-mail addresses validation (#2641)\n- Remember search modifiers in user prefs (#2411)\n- Added force_7bit option to force MIME encoding of plain/text messages (#2679)\n- Use case sensitive check when checking for default folders (#2567)\n- Fix checking for new mail: now checks unseen count of inbox (#2123)\n- Improve performance by avoiding unnecessary updates to the session table (#2552)\n- Fix invalid <font> tags which cause HTML message rendering problems (#2687)\n- Fix CVE-2010-0464: Disable DNS prefetching (#2639)\n- Fix Received headers to behave better with SpamAssassin (#2682)\n- Password: Make passwords encoding consistent with core, add 'password_charset' global option (#2658)\n- Fix adding contacts SQL error on mysql (#2645)\n- Squirrelmail_usercopy: support reply-to field (#2678)\n- Fix IE spellcheck suggestion popup issue (#2656)\n- Fix email address auto-completion shows regexp pattern (#2498)\n- Fix merging of configuration parameters: user prefs always survive (#2584) \n- Fix quota indicator value after folder purge/expunge (#2671)\n- Fix external mailto links support for use as protocol handler (#2328)\n- Fix attachment excessive memory use, support messages of any size (#1245)\n- Fix setting task name according to auth state\n- Password: fix vpopmaild driver (#2662)\n- Add workaround for MySQL bug [http://bugs.mysql.com/bug.php?id=46293] (#2659)\n- Fix quoted text wrapping when replying to an HTML email in plain text (#897)\n- Fix handling of extended mailto links (with params) (#2573)\n- Fix sorting by date of messages without date header on servers without SORT (#2521)\n- Fix inconsistency when not using default table names (#2652)\n- Fix folder rename/delete buttons do not appear on creation of first folder (#2653)\n- Fix character set conversion fails on systems where iconv doesn't accept //IGNORE (#2590)\n- Log in performance: Create default folders on first login only\n- Import contacts into the selected address book (by Phil Weir)\n- Add support for MDB2's 'sqlsrv' driver (#2602)\n- Use jQuery-1.4\n- Removed problematic browser-caching of messages\n- Fix incompatybility with suhosin.executor.disable_emodifier (#2549)\n- Use PLAIN auth when CRAM fails and imap_auth_type='check' (#2587)\n- Fix removal of <title> tag from HTML messages (#2629)\n- Fix 'force_https' to specified port when URL contains a port number (#2612)\n- Fix to-text converting of HTML entities inside b/strong/th/hX tags (#2621)\n- Bug in spellchecker suggestions when server charset != UTF8 (#2607)\n- Managesieve: Fix requires generation for multiple actions (#2603)\n- Fix LDAP problem with special characters in RDN (#2548)\n- Improved handling of message parts of type message/rfc822\n- Plugin API: added 'quota' hook\n- Fix parsing conditional comments in HTML messages (#2569)\n- Use built-in json_encode() for proper JSON format in AJAX replies\n- Allow setting only selected params in 'message_compose' hook (#2543)\n- Plugin API: added 'message_compose_body' hook (#2520)\n- Fix counters of all folders are checked in 'getunread' action  with check_all_folders disabled (#2399)\n- Fix displaying alternative parts in messages of type message/rfc822 (#2488)\n- Fix possible messages exposure when using Roundcube behind a proxy (#2516)\n- Fix unicode para and line separators in javascript response (#2542)\n- Additional_message_headers: allow unsetting headers, support plugin's config file (#2505)\n- Fix displaying of hidden directories in skins list (#2535)\n- Fix open_basedir restriction error when reading skins list (#2537)\n- Fix pasting from Office apps into html editor (#2508)\n- Fix empty <a> tags parsing (#2509)\n- Don't cut off attachment names when using non-RFC2231 encoding (#1912)\n- Allow inserting signatures above replied message body (#991)\n- Managesieve 2.0: multi-script support\n- Fix imap_auth_type regression (#2502)\n\nRELEASE 0.3.1\n------------------\n- Specify toolbar container in compose template (#2489)\n- Fix $_SERVER['HTTPS'] check for SSL forcing on IIS (#2486)\n- Avoid unnecessary page loads for selected tab (#2324)\n- Fix quota indicator issues by content generation on client-size (#2454, #2470)\n- Don't display disabled sections in Settings (#2380)\n- Added server-side e-mail address validation with 'email_dns_check' option (#2175)\n- Fix login page loading into an iframe when session expires (#2253)\n- Allow setting port number in 'force_https' option (#2373)\n- Option 'force_https' replaced by 'force_https' plugin\n- Fix IE issue with non-UTF-8 characters in AJAX response (#2422)\n- Partially fixed \"empty body\" issue by showing raw body of malformed message (#2427)\n- Fix importing/sending to email address with whitespace (#2467)\n- Added XIMSS (CommuniGate) driver for Password plugin\n- Fix newly attached files are not saved in drafts w/o editing any text (#2457)\n- Added attachment upload indicator with parallel upload (#2344)\n- Use default_charset for bodies of messages without charset definition (#2446)\n- Password: added cPanel driver\n- Fix return to first page from e-mail screen (#2385)\n- Fix handling HTML comments in HTML messages (#2448)\n- Fix folder/messagelist controls alignment - icons used (#2356)\n- Fix LDAP addressbook shows 'Contact not found' error sometimes (#2438)\n- Fix cache status checking + improve cache operations performance (#2384)\n- Prevent from setting INBOX as any of special folders (#2390)\n- Fix regular expression for e-mail address (#2417)\n- Fix Received header format\n- Implemented sorting by message index - added 'index_sort' option (#2240)\n- Fix dl() use in installer (#2415)\n- Added 'ldap_debug' option\n- Fix \"Empty startup greeting\" bug (#2369)\n- Fix setting user name in 'new_user_identity' plugin (#2405)\n- Fix incorrect count of new messages in folder list when using multiple IMAP clients (#2289)\n- Fix all folders checking for new messages with disabled caching (#2399)\n- Support skins in 'archive' and 'markasjunk' plugins\n- Added 'html_editor' hook (#2353)\n- Fix DB constraint violation when populating messages cache (#2338)\n- Password: added password strength options (#2348)\n- Fix LDAP partial result warning (#1928)\n- Fix delete in message view deletes permanently with flag_for_deletion=true (#2382)\n- Use faster/secure mt_rand() (#2376)\n- Fix roundcube hangs on empty inbox with bincimapd (#2375)\n- Fix wrong headers for IE on servers without $_SERVER['HTTPS'] (#2232)\n- Force IE style headers for attachments in non-HTTPS session, 'use_https' option (#2023)\n- Check 'post_max_size' for upload max filesize (#2372) \n- Password Plugin: Fix %d inserts username instead of domain (#2371)\n- Fix rcube_mdb2::affected_rows() (#2366)\n\nRELEASE 0.3-stable\n------------------\n- Fix gn and givenName should be synonymous in LDAP addressbook (#2208)\n- Add mail_domain to LDAP email entries without @ sign (#1652)\n- Fix saving empty values in LDAP contact data (#2113)\n- Fix LDAP contact update when RDN field is changed (#2119)\n- Fix LDAP attributes case senitivity problems (#2155)\n- Fix LDAP addressbook browsing when only one directory is used (#2314)\n- Fix endless loop on error response for APPEND command (#2346)\n- Don't require date.timezone setting in installer (#2284)\n- Fix date sorting problem with Courier IMAP server (#2351)\n- Unselect pressed buttons on mouse up (#2283)\n- Don't set php_value error_log in .htaccess but mention in INSTALL (#2230)\n- Fix too small status/flag/attachment columns in Safari 4 (#2349)\n- Fix selection disabling while dragging splitter in webkit browsers (#2342)\n- Added 'new_messages' plugin hook (#2298)\n- Added 'logout_after' plugin hook (#2333)\n- Added 'message_compose' hook\n- Added 'imap_connect' hook (#2256)\n- Fix vcard_attachments plugin (#2326)\n- Updated PEAR::Auth_SASL to 1.0.3 version\n- Use sequence names only with PostgreSQL (#2310)\n- Re-designed User Preferences interface \n- Fix MS SQL DDL (#2312)\n- Fix rcube_mdb2.php: call to setCharset not implemented in mssql driver (#2311)\n- Added 'display_next' option\n- Fix rcube_mdb2::unixtimestamp for MS SQL (#2308)\n- Fix HTML washing to respect character encoding\n- Fix endless loop in iil_C_Login() with Courier IMAP (#2303)\n- Fix #messagemenu display on IE (#2299)\n- Speedup UI by using sprites for (toolbar) buttons\n- Fix charset names with X- prefix handling\n- Fix displaying of HTML messages with unknown/malformed tags (#2296)\n\nRELEASE 0.3-RC1\n---------------\n- Fix import of vCard entries with params (#1857)\n- Fix HTML messages output with empty block elements (#2271)\n- Use request tokens to protect POST requests from CSRF [CVE-2009-4076, CVE-2009-4077]\n- Added hook when killing a session\n- Added hook to write_log function (#2268)\n- Performance improvements by use UID commands (#2046)\n- Fix HTML editor tabIndex setting (#2269)\n- Added 'imap_debug' and 'smtp_debug' options\n- Support strftime's format modifiers in date_* options (#1354)\n- Support %h variable in 'smtp_server' option (#2101)\n- Show SMTP errors in browser (#2233)\n- Allow WBR tag in HTML message (#2259)\n- Use spl_autoload_register() instead of __autoload (#2250)\n- Add hook for identities listing (#2257)\n- Trigger hook 'smtp_connect' when opening an SMTP connection (#2255)\n- Added config option to enforce HTTPS connections\n- Fix non-unicode characters caching in unicode database (#1209)\n- Performance improvements of messages caching\n- Fix empty Date header issue (#2229)\n- Open collapsed folders during drag & drop (#2221)\n- Fixed link text replacements (#2120)\n- Also trigger 'insertrow' events on page load (#2151)\n- No link on subject in IE browsers (#1438)\n- Fixed filename encoding according to RFC2231 (#2192)\n- Added message Edit feature (#727, #1101)\n- Fix message Etag generation for counter issues (#1996)\n- Fix messages searching on MailEnable IMAP (#2097)\n- Fixed many 'skip_deleted' issues (#2006)\n- Fixed messages list sorting on servers without SORT capability\n- Colorized signatures in plain text messages\n- Reviewed/fixed skip_deleted/read_when_deleted/flag_for_deletion options handling in UI\n- Fix displaying of big maximum upload filesize (#2205)\n- Added possibility to invert messages selection\n- After move/delete from 'show' action display next message instead of messages list (#2203)\n- Fixed problem with double quote at the end of folder name (#2200)\n- Speedup UI by using CSS sprites and etags/expires/deflate in Apache config (#1397,#2128)\n- Support UID EXPUNGE: remove only moved/deleted messages\n- Add drag cancelling with ESC key (#1036)\n- Support initial identity name from virtuser_query (#807)\n- Added message menu, removed Print and Source buttons\n- Added possibility to save message as .eml file (#2178)\n- Added 1 minute interval in autosave options (#2173)\n- Support UTF-7 encoding in messages (#2156)\n- Better support for malformed character names (#2093)\n\nRELEASE 0.3-BETA\n----------------\n- Plugin API + jQuery engine\n- Added possibility to encrypt received header, option 'http_received_header_encrypt',\n  added some more logic in encrypt/decrypt functions for security\n- Fix Answered/Forwarded flag setting for messages in subfolders\n- Fix autocomplete problem with capital letters (#2122)\n- Support UUencode content encoding (#2163)\n- Minimize chance of race condition in session handling (#1260)\n- Fix session handling on non-session SQL query error (#2078)\n- Fix html editor mode setting when reopening draft message (#2158)\n- Added quick search box menu (#1010)\n- Fix wrong column sort order icons (#2149)\n- Updated TinyMCE to 3.2.3 version\n- Fix attachment names encoding when charset isn't specified in attachment part (#1483)\n- Fix message normal priority problem (#2146)\n- Fix autocomplete spinning wheel does not disappear (#2132)\n- Added log_date_format option (#2060)\n- Fix text wrapping in HTML editor after switching from plain text to HTML (#1917)\n- Fix auto-complete function hangs with plus sign (#2141)\n- Fix AJAX requests errors handler (#1503)\n- Speed up message list displaying on IE\n- Fix read/write database recognition (#2137)\n\nRELEASE 0.2.2\n-------------\n- Fix quicksearchbox look in Chrome and Konqueror (#1380)\n- Fix UTF-8 byte-order mark removing (#1911)\n- Fix folders subscribtions on Konqueror (#1380) \n- Fix debug console on Konqueror and Safari\n- Fix messagelist focus issue when modifying status of selected messages (#2134)\n- Support STARTTLS in IMAP connection (#1714)\n- Fix DEL key problem in search boxes (#1923)\n- Support several e-mail addresses per user from virtuser_file (#2036)\n- Fix drag&drop with scrolling on IE (#2117)\n- Fix adding signature separator in html mode (#1768)\n- Fix opening attachment marks message as read (#2131)\n- Fix 'temp_dir' does not support relative path under Windows (#1157)\n- Fix \"Initialize Database\" button missing from installer (#2130)\n- Fix compose window doesn't fit 1024x768 window (#1807)\n- Fix service not available error when pressing back from compose dialog (#1942)\n- Fix using mail() on Windows (#2111)\n- Fix word wrapping in message-part's <PRE>s for printing (#2118)\n- Fix incorrect word wrapping in outgoing plaintext multibyte messages (#2062)\n- Fix double footer in HTML message with embedded images\n- Fix TNEF implementation bug (#2107)\n- Fix incorrect row id parsing for LDAP contacts list (#2116) \n- Fix 'mode' parameter in sqlite DSN (#2106)\n\nRELEASE 0.2.1\n------------------\n- Use US-ASCII as failover when Unicode searching fails (#2097)\n- Fix errors handling in IMAP command continuations (#2097)\n- Fix FETCH result parsing for servers returning flags at the end of result (#2098)\n- Fix datetime columns defaults in mysql's DDL (#2012)\n- Fix attaching more than nine inline images (#2094)\n- Support 'UNICODE-1-1-UTF-7' alias for UTF-7 encoding (#2093)\n- Fix mime-type detection using a hard-coded map (#1735)\n- Don't return empty string if charset conversion failed (#2092)\n- Disable concurrent autocomplete query results display (#2082)\n- Fix new lines stripped from message footer (#2088)\n- Fix IE problem with mouse click autocomplete (#2080)\n- Fix html body washing on reply/forward + fix attachments handling (#2034)\n- Fix multiple recipients input parsing (#2077)\n- Fix replying to message with html attachment (#2034)\n- Use default_charset for messages without specified charset (#2027, #1484961)\n- Support non-standard \"GMT-XXXX\" literal in date header (#2074)\n- Added TNEF support to decode MS Outlook attachments (winmail.dat)\n- Fix \"value continuation\" MIME headers by adding required semicolon (#2073)\n- Fix pressing select all/unread multiple times (#2069)\n- Fix selecting all unread does not honor new messages (#2070)\n- Fix some base64 encoded attachments handling (#2071)\n- Support NGINX as IMAP backend: better BAD response handling (#2066)\n- Performance fix: don't fetch attachment parts headers twice to parse filename\n- Fix checking for recent messages on various IMAP servers (#2055)\n- Performance fix: Don't fetch quota and recent messages in \"message view\" mode\n- Fix displaying of alternative-inside-alternative messages (#2061)\n- Fix MDNSent flag checking, use arbitrary keywords (asterisk) flag (#2059)\n- Fix creation of folders with '&' sign in name\n- Fix parsing of email addresses without angle brackets (#2048)\n- Save spellcheck corrections when switching from plain to html editor (and spellchecking is on)\n- Fix large search results on server without SORT capability (#2031)\n- Get rid of preg_replace() with eval modifier and create_function usage (#2042)\n- Bring back <base> and <link> tags in HTML messages\n- Fix XSS vulnerability through background attributes [CVE-2009-0413]\n- Fix problems with backslash as IMAP hierarchy delimiter (#1116)\n- Secure vcard export by getting rid of preg's 'e' modifier use (#2045)\n- Fix authentication when submitting form with existing session (#2037)\n- Allow absolute URLs to images in HTML messages/sigs (#2029)\n- Fix message body which contains both inline attachments and emotions\n- Fix SQL query execution errors handling in rcube_mdb2 class (#1907)\n- Fix address names with '@' sign handling (#2022)\n- Improve messages display performance\n- Fix messages searching with 'to:' modifier\n\nRELEASE 0.2-STABLE\n------------------\n- Fix mark popup in IE 7 (#1785)\n- Fix line-break issue when copy & paste in Firefox (#1832)\n- Fix autocomplete \"unknown server error\" (#2008)\n- Fix STARTTLS before AUTH in SMTP connection (#1415)\n- Support multiple quota values in QUOTAROOT resonse (#1999)\n- Only abbreviate file name for IE < 7 browsers (#1548)\n- Performance: allow setting imap rootdir and delimiter before connect (#1628)\n- Fix sorting of folders with more than 2 levels (#1953)\n- Fix search results page jumps in LDAP addressbook (#1689)\n- Fix empty line before the signature in IE (#1769)\n- Fix horizontal scrollbar in preview pane on IE (#1228)\n- Add Robots meta tag in login page and installer (#1385)\n- Added 'show_images' option, removed 'addrbook_show_images' (#1977)\n- Option to check for new mails in all folders (#1053)\n- Don't set client busy when checking for new messages (#1706)\n- Allow UTF-8 folder names in config (#1960)\n- Add junk_mbox option configuration in installer (#1960)\n- Do serverside addressbook queries for autocompletion (#1925)\n- Allow setting attachment col position in 'list_cols' option\n- Allow override 'list_cols' via skin (#1958)\n- Fix 'cache' table cleanup on session destroy (#1913)\n- Increase speed of session destroy and garbage clean up\n- Fix session timeout when DB server got clock skew (#1890)\n- Fix handling of some malformed messages (#1099)\n- Speed up raw message body handling\n- Better HTML entities conversion in html2text (#1916)\n- Fix big memory consumption and speed up searching on servers without SORT capability\n- Fix setting locale to tr_TR, ku and az_AZ (#1872) \n- Use SORT for searching on servers with SORT capability\n- Added message status filter\n- Fix empty file sending (#1801)\n- Improved searching with many criterias (calling one SEARCH command)\n- Fix HTML editor initialization on IE (#1731)\n- Add warning when switching editor mode from html to plain (#1888)\n- Make identities list scrollable (#1930)\n- Fix problem with numeric folder names (#1922)\n- Added BYE response simple support to prevent from endless loops in imap.inc (#777)\n- Fix unread message unintentionally marked as read if read_when_deleted=true (#1819)\n- Remove port number from SERVER_NAME in smtp_helo_host (#1915)\n- Don't send disposition notification receipts for messages marked as 'read' (#1918)\n- Added 'keep_alive' and 'min_keep_alive' options (#1777)\n- Added option 'identities_level', removed 'multiple_identities'\n- Allow deleting identities when multiple_identities=false (#1840)\n- Added option focus_on_new_message (#1789)\n- Fix html2text class autoloading on Windows (#1904)\n- Fix html signature formatting when identity save error occurred (#1833)\n- Add feedback and set busy when moving folder (#1897)\n- Fix 'Empty' link visibility for some languages e.g. Slovak (#1889)\n- Fix messages count bar overlapping (#1703)\n- Fix adding signature in drafts compose mode (#1884)\n- Fix iil_C_Sort() to support very long and/or divided responses (#1713)\n- Fix matching case sensitivity when setting identity on reply (#1881)\n- Prefer default identity on reply\n- Fix imap searching on ISMail server (#1870)\n- Add css class for flagged messages (#1868)\n- Write username instead of id in sendmail log (#1879)\n- Fix htmlspecialchars() use for PHP version < 5.2.3 (#1877)\n- Fix js keywords escaping in json_serialize() for IE/Opera (#1874)\n- Added bin/killcache.php script (#1839)\n- Add support for SJIS, GB2312, BIG5 in rc_detect_encoding()\n- Fix vCard file encoding detection for non-UTF-8 strings (#1820)\n- Add 'skip_deleted' option in User Preferences (#1850)\n- Minimize \"inline\" javascript scripts use (#1838)\n- Fix css class setting for folders with names matching defined classes names (#1772)\n- Fix race conditions when changing mailbox\n- Fix spellchecking when switching to html editor (#1779)\n- Fix compose window width/height (#1807)\n- Allow calling msgimport.sh/msgexport.sh from any directory (#1837)\n- Localized filesize units (#1760)\n- Better handling of \"no identity\" and \"no email in identity\" situations (#1592)\n- Added 'mime_param_folding' option with possibility to choose long/non-ascii attachment names encoding eg. to be readable in MS Outlook/OE (#1743)\n- Added \"advanced options\" feature in User Preferences\n- Fix unread counter when displaying cached massage in preview panel (#1720)\n- Fix htmleditor spellchecking on MS Windows (#1808)\n- Fix problem with non-ascii attachment names in Mail_mime (#1700, #1576)\n- Fix language autodetection (#1812)\n- Fix button label in folders management (#1816)\n- Fix collapsed folder not indicating unread msgs count of all subfolders (#1814)\n- Fix handling of apostrophes in filenames decoded according to rfc2231\n\nRELEASE 0.2-BETA\n----------------\n- Made config files location configurable (#1664)\n- Reduced memory footprint when forwarding attachments (#1764)\n- Allow and use spellcheck attribute for input/textarea fields (#1545)\n- Added icons for forwarded/forwarded+replied messages (#1691)\n- Added Reply-To to forwarded emails (#1739)\n- Display progress message for folders create/delete/rename (#1774)\n- Smart Tags and NOBR tag support in html messages (#1780, #1748)\n- Redesign of the identities settings (#836)\n- Add config option to disable creation/deletion of identities (#1139)\n- Added 'sendmail_delay' option to restrict messages sending interval (#1135)\n- Added vertical splitter for folders list resizing\n- Added possibility to view all headers in message view\n- Fixed splitter drag/resize on Opera (#1626)\n- Fixed quota img height/width setting from template (#1396)\n- Refactor drag & drop functionality. Don't rely on browser events anymore (#1108)\n- Insert \"virtual\" folders in subscription list (#1333)\n- Added link to open message in new window\n- Enable export of address book contacts as vCard\n- Add feature to import contacts from vcard files (#395)\n- Respect Content-Location headers in multipart/related messages according to RFC2110 (#1464)\n- Allowed max. attachment size now indicated in compose screen (#1523)\n- Also capture backspace key in list mode (#1186)\n- Allow application/pgp parts to be displayed (#1309)\n- Correctly handle options in mailto-links (#1671)\n- Immediately save sort_col/sort_order in user prefs (#1698)\n- Truncate very long (above 50 characters) attachment filenames when displaying\n- Allow to auto-detect client language if none set (#1095)\n- Auto-detect the client timezone (user configurable)\n- Add RFC2231 header value continuations support for attachment filenames + hack for servers that not support that feature\n- Fix Reply-To header displaying (#1738)\n- Mark form buttons that provide the most obvious operation (mainaction)\n- Added option 'quota_zero_as_unlimited' (#1206)\n- Added PRE handling in html2text class (#1301)\n- Added folder hierarchy collapsing\n- Added options to use syslog instead of log file (#1389)\n- Added Logging & Debugging section in Installer\n- Fix In-Reply-To and References headers when composing saved draft message (#1718)\n- Fix html message charset conversion for charsets with underline (#1717) \n- Fix buttons status after contacts deletion (#1675)\n- Fix escaping of To: and From: fields when building message body for reply or forward in the HTML editor (#1432)\n- Use current mailbox name in template (#1690)\n- Better fix for skipping untagged responses (#1694)\n- Added pspell support patch by Kris Steinhoff (#781)\n- Enable spellchecker for HTML editor (#1589)\n- Respect spellcheck_uri in tinyMCE spellchecker (#941)\n- Case insensitive contacts searching using PostgreSQL (#1692)\n- Make default imap folders configurable for each user (#1558)\n- Save outgoing mail to selectable folder (#1324581)\n- Fix hiding of mark menu when clicking th button again (#1463)\n- Use long date format in print mode (#1643)\n- Updated TinyMCE to version 3.1.0.1\n- Re-enable autocomplete attribute for login form (#1661)\n- Check PERMANENTFLAGS before saving $MDNSent flag (#1478, #1485163)\n- Added flag column on messages list (#1220)\n- Patched Mail/MimePart.php (http://pear.php.net/bugs/bug.php?id=14232)\n- Allow trash/junk subfolders to be purged (#1568)\n- Store compose parameters in session and redirect to a unique URL\n- Fixed CRAM-MD5 authentication (#1364)\n- Fixed forwarding messages with one HTML attachment (#1103)\n- Fixed encoding of message/rfc822 attachments and image/pjpeg handling (#1439)\n- Added option to select skin in user preferences\n- Added option to configure displaying of attached images below the message body\n- Added option to display images in messages from known senders (#1204)\n- User preferences grouped in more fieldsets\n- Fix corrupted MIME headers of messages in Sent folder (#1587)\n- Fixed bug in MDB2 package: http://pear.php.net/bugs/bug.php?id=14124\n- Use keypress instead of keydown to select list's row (#1362)\n- Don't call expunge and don't remove message row after message move if flag_for_deletion is set to true (#1505)\n\nRELEASE 0.2-ALPHA\n-----------------\n- Added option to disable autocompletion from selected LDAP address books (#1445)\n- TLS support in LDAP connections: 'use_tls' property (#1581)\n- Fixed removing messages from search set after deleting them (#1583)\n- imap.inc: Fixed iil_C_FetchStructureString() to handle many \n  literal strings in response (#1483)\n- Support for subfolders in default/protected folders (#1250)\n- Disallowed delimiter in folder name (#1351)\n- Support \" and \\ in folder names\n- Escape \\ in login (#1214)\n- Better HTML sanitization with the DOM-based washtml script (#1276)\n- Fixed sorting of folders with non-ascii characters\n- Fixed Mysql DDL for default identities creation (#1554)\n- In Preferences added possibility to configure 'read_when_deleted',\n  'mdn_requests', 'flag_for_deletion' options\n- Made IMAP auth type configurable (#683)\n- Fixed empty values with FROM_UNIXTIME() in rcube_mdb2 (#1540)\n- Fixed attachment list on IE 6/7 (#1355)\n- Fixed JavaScript in compose.html that shows cc/bcc fields if populated\n- Make password input fields of type password in installer (#1417)\n- Don't attempt to delete cache entries if enable_caching is FALSE (#1537)\n- Optimized messages sorting on servers without sort capability (#1535)\n- Corrected message headers decoding when charset isn't specified and improved\n  support for native languages (#1536, #1534)\n- Expanded LDAP configuration options to support LDAP server writes.\n- Installer: encode special characters in DB username/password (#1529)\n- Fixed management of folders with national characters in names (#1526, #1504)\n- Fixed identities saving when using MDB2 pgsql driver (#1525)\n- Fixed BCC header reset (#1501)\n- Improved messages list performance - patch from Justin Heesemann\n- Append skin_path to images location only when it starts with '/' sign (#1398)\n- Fix IMAP response in message body when message has no body (#1479)\n- Fixed non-RFC dates formatting (#1429)\n- Fixed typo in set_charset() (#1498)\n- Decode entities when inserting HTML signature to plain text message (#1497)\n- HTML editing is now working with PHP5 updates and TinyMCE v3.0.6\n- Fixed signature loading on Windows (#1169)\n- Added language support to HTML editing (#1401)\n- Fixed remove signature when replying (#446)\n- Fixed problem with line with a space at the end (#1440)\n- Fixed <!DOCTYPE> tag filtering (#1066)\n- Fixed <?xml> tag filtering (#1075)\n- Added sections (fieldset+label) in Settings interface\n- Mark as read in one action with message preview (#1486)\n- Deleted redundant quota reads (#1486)\n- Added options for empty trash and expunge inbox on logout (#707)\n- Removed lines wrapping when displaying message\n- Fixed month localization\n- Changed codebase to PHP5 with autoloader\n\nRELEASE 0.1.1\n-------------\n- Clear selection when selecting single item (#1461)\n- Remove hard-coded image size in skin templates (#1423)\n- Database schema improvements (dropped unnecessary indexes)\n- Fixed creating a new folder with a comma in its name (#1263)\n- Fixed sorting of messages when default mailbox is empty (#1020)\n- Improve message previewpane - less loading (#1019)\n- Fixed login form autoompletion (#1378)\n- Fixed virtuser_query option for mdb2 backend (#1409)\n- Fixed attachment resoting from Drafts when message body was empty (#1144)\n- Fixed usage of ob_gzhandler (#1390)\n- Fixed message part window in IE6 (#1211)\n- Fixed decoding of mime-encoded strings (#938)\n- Fixed some iconv/mb_string problems (#1202)\n- Correctly quote mailbox name when using in URL (#1016)\n- Fixed \"headers already sent\" errors (#1399)\n\nRELEASE 0.1-STABLE\n------------------\n- Added interactive installer script\n- Fix folder adding/renaming inspired by #1349\n- Localize folder name in page title (#1338)\n- Fix code using wrong variable name (#818)\n- Allow to send mail with BCC recipients only\n- condense TinyMCE toolbar down to one line, removing table buttons (#1306)\n- Add function to mark the selected messages as read/unread (#641)\n- Also do charset decoding as suggested in RFC 2231 (fix #1022)\n- Show message count in folder list and hint when creating a subfolder\n- Distinguish ssl and tls for imap connections (#1252)\n- Added some charset aliases to fix typical mis-labelling (#1185)\n- Remember decision to display images for a certain message during session (#1310)\n- Truncate attachment filenames to 55 characters due to an IE bug (#1313)\n- Make sending of read receipts configurable\n- Respect config when localize folder names (#1280)\n- Also respect receipt and priority settings when re-opening a draft message\n- Remember search results (closes #722), patch by the_glu\n- Add Received header on outgoing mail\n- Upgrade to TinyMCE 2.1.3\n- Allow inserting image attachments into HTML messages while composing (#1179)\n- Implement Message-Disposition-Notification (Receipts)\n- Fix overriding of session vars when register_globals is on (#1255)\n- Fix bug with case-sensitive folder names (#973)\n- Don't create default folders by default\n- Fixed some potential security risks (audited by Andris)\n- Only show new messages if they match the current search (#925)\n- Switch to/from when searcing in Sent folder (#1177)\n- Correctly read the References header (#1236)\n- Unset old cookie before sending a new value (#1232)\n- Correctly decode attachments when downloading them (#1235 and #1484642)\n- Suppress IE errors when clearing attachments form (#1043)\n- Log error when login fails due to auto_create_user turned off\n- Filter linked/imported CSS files (closes #844)\n- Improve message compose screen (closes #1060)\n- Select next row after removing one from list (#1063)\n\nRELEASE 0.1-RC2\n---------------\n- Enable drag-&-dropping of folders to a new parent and allow to create subfolders (#637)\n- Suppress IE errors when clearing attachments form (#1043)\n- Set preferences field in user table to NULL (#1062)\n- Log error when login fails due to auto_create_user turned off\n- Filter linked/imported CSS files (closes #844)\n- Improve message compose screen (closes #1060)\n- Select next row after removing one from list (#1063)\n- Make smtp HELO/EHLO hostname configurable (#851)\n- IPv6 Compatibility (#1023), Patch #1484373\n- Unlock interface when message sending fails (#1188)\n- Eval PHP code in template includes (if configured)\n- Show message when folder is empty. Mo more static text in table (#1068)\n- Only display unread count in page title when new messages arrived\n- Fixed wrong delete button tooltip (#785)\n- Fixed charset encoding bug (#1091)\n- Applied patch for LDAP version (#1175)\n- Improved XHTML validation\n- Fix message list selection (#1174)\n- Better fix lowercased usernames (#1120)\n- Update pngbehavior Script as suggested in #1134\n- Fixed moving/deleting messages when more than 1 is selected\n- Applied patch for LDAP contacts listing by Glen Ogilvie\n- Applied patch for more address fields in LDAP contacts (#1074)\n- Add alternative for getallheaders() (fix #1146)\n- Identify mailboxes case-sensitive\n- Sort mailbox list case-insensitive (closes #1032)\n- Fix display of multipart messages from Apple Mail (closes #823)\n- Protect AJAX request from being fetched by a foreign site (XSS)\n- Make autocomplete for loginform configurable by the skin template\n- Fix compose function from address book (closes #1089)\n- Added //IGNORE to iconv call (patch #1086, closes #821)\n- Check if mbstring supports charset (#1003 and #1004)\n- Prefer iconv over mbstring (as suggested in #1004)\n- Check filesize of template includes (#1079)\n- Fixed bug with buttons not dimming/enabling properly after switching folders\n- Fixed compose window becoming unresponsive after saving a draft (#1132)\n- Re-enabled \"Back\" button in compose window now that bug #1132 is fixed\n- Fixed unresponsive interface issue when downloading attachments (#1138)\n- Lowered status message time from 5 to 3 seconds to improve responsiveness\n- Raised .htaccess upload_max_filesize from 2M to 5M to differ from default php.ini\n- Increased \"mailboxcontrols\" mail.css width from 160 to 170px to fix non-english languages (#1140)\n- Fix status message bug #1114 with regard to #1041\n- Fix address adding bug reported by David Koblas\n- Applied socket error patch by Thomas Mangin\n- Pass-by-reference workarround for PHP5 in sendmail.inc\n- Fixed buggy imap_root settings (closes #1056)\n- Prevent default events on subject links (#1071)\n- Use HTTP-POST requests for actions that change state\n\nRELEASE 0.1-RC1\n---------------\n- Use global filters and bind username/ for Ldap searches (#909)\n- Hide quota display if imap server does not support it\n- Hide address groups if no LDAP servers configured\n- Add link to message subjects (closes #982)\n- Better SQL query for contact listing/search (closes #1051)\n- Fixed marking as read in preview pane (closes #1048)\n- CSS hack to display attachments correctly in IE6\n- Wrap message body text (closes #901)\n- LDAP access is back in address book (closes #864)\n- Added search function for contacts\n- New Template parsing and output encoding\n- Fixed bugs #884 and #793\n- Fixed message moving procedure (closes #1013)\n- Fixed display of multiple attachments (closes #647)\n- Fixed check for new messages (closes #1015)\n- List attachments without filename\n- New session authentication: Change sessid cookie when login, authentication with sessauth cookie is now configurable.\n  Should close bugs #774 and #1484299\n- Correctly translate mailbox names (closes #993)\n- Quote e-mail address links (closes #1007)\n- Updated PEAR::Mail_mime package\n- Accept single quotes for HTML attributes when modifying message body (thanks Jason)\n- Sanitize input for new users/identities (thanks Colin Alston)\n- Don't download HTML message parts\n- Convert HTML parts to plaintext if 'prefer_html' is off\n- Correctly parse message/rfc822 parts (closes #838)\n- Also use user_id for unique key in messages table (closes #857)\n- Hide contacts drop down on blur (closes #946)\n- Make entries in contacts drop down clickable\n- Turn off browser autocompletion on login page\n- Quote <? in text/html message parts\n- Hide border around radio buttons\n- Applied patch for attachment download by crichardson (closes #943)\n- Fixed bug in Postgres DB handling (closes #852)\n- Fixed bug of invalid calls to fetchRow() in rcube_db.inc (closes #996)\n- Fixed array_merge bug (closes #997)\n- Fixed flag for deletion in list view (closes #987)\n- Finally support semicolons as recipient separator (closes ##976)\n- Fixed message headers (subject) encoding\n- check if safe mode is on or not (closes #990)\n- Show \"no subject\" in message list if subject is missing (closes #971)\n- Solved page caching of message preview (closes #905)\n- Only use gzip compression if configured (closes #967)\n- Fixed priority selector issue (#903)\n- Fixed some CSS issues in default skin (closes #951 and #911)\n- Prevent from double quoting of numeric HTML character references (closes #978)\n- Fixed display of HTML message attachments (closes #927)\n- Applied patch for preview caching (closes #933)\n- Added error handling for attachment uploads\n- Use multibyte safe string functions where necessary (closes #798)\n- Applied security patch to validate the submitted host value (by Kees Cook)\n- Applied security patch to validate input values when deleting contacts (by Kees Cook)\n- Applied security patch that sanitizes emoticon paths when attaching them (by Kees Cook)\n- Applied a patch to more aggressively sanitize a HTML message\n- Visualize blocked images in HTML messages\n- Fixed wrong message listing when showing search results (closes #890)\n- Show remote images when opening HTML message part as attachment\n- Improve memory usage when sending mail (closes #871)\n- Mark messages as read once the preview is loaded (closes #1484132)\n- Include smtp final response in log (closes #862)\n- Corrected date string in sent message header (closes #887)\n- Correclty choose \"To\" column in sent and draft mailboxes (closes #769)\n- Changed srong tooltips for message browse buttons (closes #757)\n- Fixed signature delimiter character to be standard (Bug #830)\n- Fixed XSS vulnerability (Bug #877)\n- Remove newlines from mail headers (Bug #827)\n- Selection issues when moving/deleting (Bug #837)\n- Applied patch of Clement Moulin for imap host auto-selection\n- ISO-encode IMAP password for plaintext login (Bugs #792 & #723)\n- Fixed folder name encoding in subscription list (Bug #879)\n- Fixed JS errors in identity list (Bug #885)\n- Translate foldernames in folder form (closes #879)\n- Added first and last buttons to message list, address book\n  and message detail\n- Pressing Shift-Del bypasses Trash folder\n- Enable purge command for Junk folder\n- Fetch all aliases if virtuser_query is used instead\n- Re-enabled multi select of contacts (Bug #817)\n- Enable contact editing right after creation (Bug #644)\n- Correct UTF-7 to UTF-8 conversion if mbstring is not available\n- Fixed IMAP fetch of message body (Bug #819)\n- Fixed safe_mode problems (Bug #539)\n- Fixed wrong header encoding (Bug #1483976)\n- Made automatic draft saving configurable\n- Fixed JS bug when renaming folders (Bug #799)\n- Added quota display as image (by Brett Patterson)\n- Corrected creation of a message-id\n- New indentation for quoted message text\n- Improved HTML validity\n- Fixed URL character set (Ticket #616)\n- Fixed saving of contact into MySQL from LDAP query results (Ticket #681)\n- Fixed folder renaming: unsubscribe before rename (Bug #750)\n- Finalized new message parsing (+ chaching)\n- Fixed wrong usage of mbstring (Bug #645)\n- Set default spelling language (Ticket #764)\n- Added support for Nox Spell Server\n- Re-built message parsing (Bug #422)\n  Now based on the message structure delivered by the IMAP server.\n- Fixed some XSS and SQL injection issues\n- Fixed charset problems with folder renaming\n", "<?php\n\n/*\n +-----------------------------------------------------------------------+\n | Main configuration file with default settings                         |\n |                                                                       |\n | This file is part of the Roundcube Webmail client                     |\n | Copyright (C) 2005-2013, The Roundcube Dev Team                       |\n |                                                                       |\n | Licensed under the GNU General Public License version 3 or            |\n | any later version with exceptions for skins & plugins.                |\n | See the README file for a full license statement.                     |\n +-----------------------------------------------------------------------+\n*/\n\n$config = array();\n\n// ----------------------------------\n// SQL DATABASE\n// ----------------------------------\n\n// Database connection string (DSN) for read+write operations\n// Format (compatible with PEAR MDB2): db_provider://user:password@host/database\n// Currently supported db_providers: mysql, pgsql, sqlite, mssql, sqlsrv, oracle\n// For examples see http://pear.php.net/manual/en/package.database.mdb2.intro-dsn.php\n// NOTE: for SQLite use absolute path (Linux): 'sqlite:////full/path/to/sqlite.db?mode=0646'\n//       or (Windows): 'sqlite:///C:/full/path/to/sqlite.db'\n$config['db_dsnw'] = 'mysql://roundcube:@localhost/roundcubemail';\n\n// Database DSN for read-only operations (if empty write database will be used)\n// useful for database replication\n$config['db_dsnr'] = '';\n\n// Disable the use of already established dsnw connections for subsequent reads\n$config['db_dsnw_noread'] = false;\n\n// use persistent db-connections\n// beware this will not \"always\" work as expected\n// see: http://www.php.net/manual/en/features.persistent-connections.php\n$config['db_persistent'] = false;\n\n// you can define specific table (and sequence) names prefix\n$config['db_prefix'] = '';\n\n// Mapping of table names and connections to use for ALL operations.\n// This can be used in a setup with replicated databases and a DB master\n// where read/write access to cache tables should not go to master.\n$config['db_table_dsn'] = array(\n//    'cache' => 'r',\n//    'cache_index' => 'r',\n//    'cache_thread' => 'r',\n//    'cache_messages' => 'r',\n);\n\n// It is possible to specify database variable values e.g. some limits here.\n// Use them if your server is not MySQL or for better performance.\n// For example Roundcube uses max_allowed_packet value (in bytes)\n// which limits query size for database cache operations.\n$config['db_max_allowed_packet'] = null;\n\n\n// ----------------------------------\n// LOGGING/DEBUGGING\n// ----------------------------------\n\n// system error reporting, sum of: 1 = log; 4 = show\n$config['debug_level'] = 1;\n\n// log driver:  'syslog', 'stdout' or 'file'.\n$config['log_driver'] = 'file';\n\n// date format for log entries\n// (read http://php.net/manual/en/function.date.php for all format characters)  \n$config['log_date_format'] = 'd-M-Y H:i:s O';\n\n// length of the session ID to prepend each log line with\n// set to 0 to avoid session IDs being logged.\n$config['log_session_id'] = 8;\n\n// Syslog ident string to use, if using the 'syslog' log driver.\n$config['syslog_id'] = 'roundcube';\n\n// Syslog facility to use, if using the 'syslog' log driver.\n// For possible values see installer or http://php.net/manual/en/function.openlog.php\n$config['syslog_facility'] = LOG_USER;\n\n// Activate this option if logs should be written to per-user directories.\n// Data will only be logged if a directory <log_dir>/<username>/ exists and is writable.\n$config['per_user_logging'] = false;\n\n// Log sent messages to <log_dir>/sendmail or to syslog\n$config['smtp_log'] = true;\n\n// Log successful/failed logins to <log_dir>/userlogins or to syslog\n$config['log_logins'] = false;\n\n// Log session authentication errors to <log_dir>/session or to syslog\n$config['log_session'] = false;\n\n// Log SQL queries to <log_dir>/sql or to syslog\n$config['sql_debug'] = false;\n\n// Log IMAP conversation to <log_dir>/imap or to syslog\n$config['imap_debug'] = false;\n\n// Log LDAP conversation to <log_dir>/ldap or to syslog\n$config['ldap_debug'] = false;\n\n// Log SMTP conversation to <log_dir>/smtp or to syslog\n$config['smtp_debug'] = false;\n\n// Log Memcache conversation to <log_dir>/memcache or to syslog\n$config['memcache_debug'] = false;\n\n// Log APC conversation to <log_dir>/apc or to syslog\n$config['apc_debug'] = false;\n\n\n// ----------------------------------\n// IMAP\n// ----------------------------------\n\n// The IMAP host chosen to perform the log-in.\n// Leave blank to show a textbox at login, give a list of hosts\n// to display a pulldown menu or set one host as string.\n// To use SSL/TLS connection, enter hostname with prefix ssl:// or tls://\n// Supported replacement variables:\n// %n - hostname ($_SERVER['SERVER_NAME'])\n// %t - hostname without the first part\n// %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)\n// %s - domain name after the '@' from e-mail address provided at login screen\n// For example %n = mail.domain.tld, %t = domain.tld\n// WARNING: After hostname change update of mail_host column in users table is\n//          required to match old user data records with the new host.\n$config['default_host'] = 'localhost';\n\n// TCP port used for IMAP connections\n$config['default_port'] = 143;\n\n// IMAP AUTH type (DIGEST-MD5, CRAM-MD5, LOGIN, PLAIN or null to use\n// best server supported one)\n$config['imap_auth_type'] = null;\n\n// IMAP socket context options\n// See http://php.net/manual/en/context.ssl.php\n// The example below enables server certificate validation\n//$config['imap_conn_options'] = array(\n//  'ssl'         => array(\n//     'verify_peer'  => true,\n//     'verify_depth' => 3,\n//     'cafile'       => '/etc/openssl/certs/ca.crt',\n//   ),\n// );\n// Note: These can be also specified as an array of options indexed by hostname\n$config['imap_conn_options'] = null;\n\n// IMAP connection timeout, in seconds. Default: 0 (use default_socket_timeout)\n$config['imap_timeout'] = 0;\n\n// Optional IMAP authentication identifier to be used as authorization proxy\n$config['imap_auth_cid'] = null;\n\n// Optional IMAP authentication password to be used for imap_auth_cid\n$config['imap_auth_pw'] = null;\n\n// If you know your imap's folder delimiter, you can specify it here.\n// Otherwise it will be determined automatically\n$config['imap_delimiter'] = null;\n\n// If you know your imap's folder vendor, you can specify it here.\n// Otherwise it will be determined automatically. Use lower-case\n// identifiers, e.g. 'dovecot', 'cyrus', 'gmail', 'hmail', 'uw-imap'.\n$config['imap_vendor'] = null;\n\n// If IMAP server doesn't support NAMESPACE extension, but you're\n// using shared folders or personal root folder is non-empty, you'll need to\n// set these options. All can be strings or arrays of strings.\n// Folders need to be ended with directory separator, e.g. \"INBOX.\"\n// (special directory \"~\" is an exception to this rule)\n// These can be used also to overwrite server's namespaces\n$config['imap_ns_personal'] = null;\n$config['imap_ns_other']    = null;\n$config['imap_ns_shared']   = null;\n\n// By default IMAP capabilities are readed after connection to IMAP server\n// In some cases, e.g. when using IMAP proxy, there's a need to refresh the list\n// after login. Set to True if you've got this case.\n$config['imap_force_caps'] = false;\n\n// By default list of subscribed folders is determined using LIST-EXTENDED\n// extension if available. Some servers (dovecot 1.x) returns wrong results\n// for shared namespaces in this case. https://github.com/roundcube/roundcubemail/issues/2474\n// Enable this option to force LSUB command usage instead.\n// Deprecated: Use imap_disabled_caps = array('LIST-EXTENDED')\n$config['imap_force_lsub'] = false;\n\n// Some server configurations (e.g. Courier) doesn't list folders in all namespaces\n// Enable this option to force listing of folders in all namespaces\n$config['imap_force_ns'] = false;\n\n// Some servers return hidden folders (name starting witha dot)\n// from user home directory. IMAP RFC does not forbid that.\n// Enable this option to hide them and disable possibility to create such.\n$config['imap_skip_hidden_folders'] = false;\n\n// List of disabled imap extensions.\n// Use if your IMAP server has broken implementation of some feature\n// and you can't remove it from CAPABILITY string on server-side.\n// For example UW-IMAP server has broken ESEARCH.\n// Note: Because the list is cached, re-login is required after change.\n$config['imap_disabled_caps'] = array();\n\n// Log IMAP session identifiers after each IMAP login.\n// This is used to relate IMAP session with Roundcube user sessions\n$config['imap_log_session'] = false;\n\n// Type of IMAP indexes cache. Supported values: 'db', 'apc' and 'memcache'.\n$config['imap_cache'] = null;\n\n// Enables messages cache. Only 'db' cache is supported.\n// This requires an IMAP server that supports QRESYNC and CONDSTORE\n// extensions (RFC7162). See synchronize() in program/lib/Roundcube/rcube_imap_cache.php\n// for further info, or if you experience syncing problems.\n$config['messages_cache'] = false;\n\n// Lifetime of IMAP indexes cache. Possible units: s, m, h, d, w\n$config['imap_cache_ttl'] = '10d';\n\n// Lifetime of messages cache. Possible units: s, m, h, d, w\n$config['messages_cache_ttl'] = '10d';\n\n// Maximum cached message size in kilobytes.\n// Note: On MySQL this should be less than (max_allowed_packet - 30%)\n$config['messages_cache_threshold'] = 50;\n\n\n// ----------------------------------\n// SMTP\n// ----------------------------------\n\n// SMTP server host (for sending mails).\n// Enter hostname with prefix tls:// to use STARTTLS, or use\n// prefix ssl:// to use the deprecated SSL over SMTP (aka SMTPS)\n// Supported replacement variables:\n// %h - user's IMAP hostname\n// %n - hostname ($_SERVER['SERVER_NAME'])\n// %t - hostname without the first part\n// %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)\n// %z - IMAP domain (IMAP hostname without the first part)\n// For example %n = mail.domain.tld, %t = domain.tld\n$config['smtp_server'] = 'localhost';\n\n// SMTP port (default is 25; use 587 for STARTTLS or 465 for the\n// deprecated SSL over SMTP (aka SMTPS))\n$config['smtp_port'] = 25;\n\n// SMTP username (if required) if you use %u as the username Roundcube\n// will use the current username for login\n$config['smtp_user'] = '';\n\n// SMTP password (if required) if you use %p as the password Roundcube\n// will use the current user's password for login\n$config['smtp_pass'] = '';\n\n// SMTP AUTH type (DIGEST-MD5, CRAM-MD5, LOGIN, PLAIN or empty to use\n// best server supported one)\n$config['smtp_auth_type'] = '';\n\n// Optional SMTP authentication identifier to be used as authorization proxy\n$config['smtp_auth_cid'] = null;\n\n// Optional SMTP authentication password to be used for smtp_auth_cid\n$config['smtp_auth_pw'] = null;\n\n// SMTP HELO host \n// Hostname to give to the remote server for SMTP 'HELO' or 'EHLO' messages \n// Leave this blank and you will get the server variable 'server_name' or \n// localhost if that isn't defined.\n$config['smtp_helo_host'] = '';\n\n// SMTP connection timeout, in seconds. Default: 0 (use default_socket_timeout)\n// Note: There's a known issue where using ssl connection with\n// timeout > 0 causes connection errors (https://bugs.php.net/bug.php?id=54511)\n$config['smtp_timeout'] = 0;\n\n// SMTP socket context options\n// See http://php.net/manual/en/context.ssl.php\n// The example below enables server certificate validation, and\n// requires 'smtp_timeout' to be non zero.\n// $config['smtp_conn_options'] = array(\n//   'ssl'         => array(\n//     'verify_peer'  => true,\n//     'verify_depth' => 3,\n//     'cafile'       => '/etc/openssl/certs/ca.crt',\n//   ),\n// );\n// Note: These can be also specified as an array of options indexed by hostname\n$config['smtp_conn_options'] = null;\n\n\n// ----------------------------------\n// LDAP\n// ----------------------------------\n\n// Type of LDAP cache. Supported values: 'db', 'apc' and 'memcache'.\n$config['ldap_cache'] = 'db';\n\n// Lifetime of LDAP cache. Possible units: s, m, h, d, w\n$config['ldap_cache_ttl'] = '10m';\n\n\n// ----------------------------------\n// CACHE(S)\n// ----------------------------------\n\n// Use these hosts for accessing memcached\n// Define any number of hosts in the form of hostname:port or unix:///path/to/socket.file\n$config['memcache_hosts'] = null; // e.g. array( 'localhost:11211', '192.168.1.12:11211', 'unix:///var/tmp/memcached.sock' );\n\n// Controls the use of a persistent connections to memcache servers\n// See http://php.net/manual/en/memcache.addserver.php\n$config['memcache_pconnect'] = true;\n\n// Value in seconds which will be used for connecting to the daemon\n// See http://php.net/manual/en/memcache.addserver.php\n$config['memcache_timeout'] = 1;\n\n// Controls how often a failed server will be retried (value in seconds).\n// Setting this parameter to -1 disables automatic retry.\n// See http://php.net/manual/en/memcache.addserver.php\n$config['memcache_retry_interval'] = 15;\n\n// use these hosts for accessing Redis.\n// Currently only one host is supported. cluster support may come in a future release.\n// You can pass 4 fields, host, port, database and password.\n// Unset fields will be set to the default values host=127.0.0.1, port=6379, database=0, password=  (empty)\n$config['redis_hosts'] = null; // e.g. array( 'localhost:6379' );  array( '192.168.1.1:6379:1:secret' );\n\n// Maximum size of an object in memcache (in bytes). Default: 2MB\n$config['memcache_max_allowed_packet'] = '2M';\n\n// Maximum size of an object in APC cache (in bytes). Default: 2MB\n$config['apc_max_allowed_packet'] = '2M';\n\n\n// ----------------------------------\n// SYSTEM\n// ----------------------------------\n\n// THIS OPTION WILL ALLOW THE INSTALLER TO RUN AND CAN EXPOSE SENSITIVE CONFIG DATA.\n// ONLY ENABLE IT IF YOU'RE REALLY SURE WHAT YOU'RE DOING!\n$config['enable_installer'] = false;\n\n// don't allow these settings to be overridden by the user\n$config['dont_override'] = array();\n\n// List of disabled UI elements/actions\n$config['disabled_actions'] = array();\n\n// define which settings should be listed under the 'advanced' block\n// which is hidden by default\n$config['advanced_prefs'] = array();\n\n// provide an URL where a user can get support for this Roundcube installation\n// PLEASE DO NOT LINK TO THE ROUNDCUBE.NET WEBSITE HERE!\n$config['support_url'] = '';\n\n// replace Roundcube logo with this image\n// specify an URL relative to the document root of this Roundcube installation\n// an array can be used to specify different logos for specific template files, '*' for default logo\n// for example array(\"*\" => \"/images/roundcube_logo.png\", \"messageprint\" => \"/images/roundcube_logo_print.png\")\n$config['skin_logo'] = null;\n\n// automatically create a new Roundcube user when log-in the first time.\n// a new user will be created once the IMAP login succeeds.\n// set to false if only registered users can use this service\n$config['auto_create_user'] = true;\n\n// Enables possibility to log in using email address from user identities\n$config['user_aliases'] = false;\n\n// use this folder to store log files\n// must be writeable for the user who runs PHP process (Apache user if mod_php is being used)\n// This is used by the 'file' log driver.\n$config['log_dir'] = RCUBE_INSTALL_PATH . 'logs/';\n\n// use this folder to store temp files\n// must be writeable for the user who runs PHP process (Apache user if mod_php is being used)\n$config['temp_dir'] = RCUBE_INSTALL_PATH . 'temp/';\n\n// expire files in temp_dir after 48 hours\n// possible units: s, m, h, d, w\n$config['temp_dir_ttl'] = '48h';\n\n// Enforce connections over https\n// With this option enabled, all non-secure connections will be redirected.\n// It can be also a port number, hostname or hostname:port if they are\n// different than default HTTP_HOST:443\n$config['force_https'] = false;\n\n// tell PHP that it should work as under secure connection\n// even if it doesn't recognize it as secure ($_SERVER['HTTPS'] is not set)\n// e.g. when you're running Roundcube behind a https proxy\n// this option is mutually exclusive to 'force_https' and only either one of them should be set to true.\n$config['use_https'] = false;\n\n// Allow browser-autocompletion on login form.\n// 0 - disabled, 1 - username and host only, 2 - username, host, password\n$config['login_autocomplete'] = 0;\n\n// Forces conversion of logins to lower case.\n// 0 - disabled, 1 - only domain part, 2 - domain and local part.\n// If users authentication is case-insensitive this must be enabled.\n// Note: After enabling it all user records need to be updated, e.g. with query:\n//       UPDATE users SET username = LOWER(username);\n$config['login_lc'] = 2;\n\n// Maximum length (in bytes) of logon username and password.\n$config['login_username_maxlen'] = 1024;\n$config['login_password_maxlen'] = 1024;\n\n// Logon username filter. Regular expression for use with preg_match().\n// Example: '/^[a-z0-9_@.-]+$/'\n$config['login_username_filter'] = null;\n\n// Brute-force attacks prevention.\n// The value specifies maximum number of failed logon attempts per minute.\n$config['login_rate_limit'] = 3;\n\n// Includes should be interpreted as PHP files\n$config['skin_include_php'] = false;\n\n// display software version on login screen\n$config['display_version'] = false;\n\n// Session lifetime in minutes\n$config['session_lifetime'] = 10;\n\n// Session domain: .example.org\n$config['session_domain'] = '';\n\n// Session name. Default: 'roundcube_sessid'\n$config['session_name'] = null;\n\n// Session authentication cookie name. Default: 'roundcube_sessauth'\n$config['session_auth_name'] = null;\n\n// Session path. Defaults to PHP session.cookie_path setting.\n$config['session_path'] = null;\n\n// Backend to use for session storage. Can either be 'db' (default), 'redis', 'memcache', or 'php'\n//\n// If set to 'memcache', a list of servers need to be specified in 'memcache_hosts'\n// Make sure the Memcache extension (http://pecl.php.net/package/memcache) version >= 2.0.0 is installed\n//\n// If set to 'redis', a server needs to be specified in 'redis_hosts'\n// Make sure the Redis extension (http://pecl.php.net/package/redis) version >= 2.0.0 is installed\n//\n// Setting this value to 'php' will use the default session save handler configured in PHP\n$config['session_storage'] = 'db';\n\n// check client IP in session authorization\n$config['ip_check'] = false;\n\n// List of trusted proxies\n// X_FORWARDED_* and X_REAL_IP headers are only accepted from these IPs\n$config['proxy_whitelist'] = array();\n\n// check referer of incoming requests\n$config['referer_check'] = false;\n\n// X-Frame-Options HTTP header value sent to prevent from Clickjacking.\n// Possible values: sameorigin|deny|allow-from <uri>.\n// Set to false in order to disable sending the header.\n$config['x_frame_options'] = 'sameorigin';\n\n// This key is used for encrypting purposes, like storing of imap password\n// in the session. For historical reasons it's called DES_key, but it's used\n// with any configured cipher_method (see below).\n$config['des_key'] = 'rcmail-!24ByteDESkey*Str';\n\n// Encryption algorithm. You can use any method supported by openssl.\n// Default is set for backward compatibility to DES-EDE3-CBC,\n// but you can choose e.g. AES-256-CBC which we consider a better choice.\n$config['cipher_method'] = 'DES-EDE3-CBC';\n\n// Automatically add this domain to user names for login\n// Only for IMAP servers that require full e-mail addresses for login\n// Specify an array with 'host' => 'domain' values to support multiple hosts\n// Supported replacement variables:\n// %h - user's IMAP hostname\n// %n - hostname ($_SERVER['SERVER_NAME'])\n// %t - hostname without the first part\n// %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)\n// %z - IMAP domain (IMAP hostname without the first part)\n// For example %n = mail.domain.tld, %t = domain.tld\n$config['username_domain'] = '';\n\n// Force domain configured in username_domain to be used for login.\n// Any domain in username will be replaced by username_domain.\n$config['username_domain_forced'] = false;\n\n// This domain will be used to form e-mail addresses of new users\n// Specify an array with 'host' => 'domain' values to support multiple hosts\n// Supported replacement variables:\n// %h - user's IMAP hostname\n// %n - http hostname ($_SERVER['SERVER_NAME'])\n// %d - domain (http hostname without the first part)\n// %z - IMAP domain (IMAP hostname without the first part)\n// For example %n = mail.domain.tld, %t = domain.tld\n$config['mail_domain'] = '';\n\n// Password character set.\n// If your authentication backend supports it, use \"UTF-8\".\n// Otherwise, use the appropriate character set.\n// Defaults to ISO-8859-1 for backward compatibility.\n$config['password_charset'] = 'ISO-8859-1';\n\n// How many seconds must pass between emails sent by a user\n$config['sendmail_delay'] = 0;\n\n// Message size limit. Note that SMTP server(s) may use a different value.\n// This limit is verified when user attaches files to a composed message.\n// Size in bytes (possible unit suffix: K, M, G)\n$config['max_message_size'] = '100M';\n\n// Maximum number of recipients per message (including To, Cc, Bcc).\n// Default: 0 (no limit)\n$config['max_recipients'] = 0;\n\n// Maximum number of recipients per message exluding Bcc header.\n// This is a soft limit, which means we only display a warning to the user.\n// Default: 5\n$config['max_disclosed_recipients'] = 5;\n\n// Maximum allowed number of members of an address group. Default: 0 (no limit)\n// If 'max_recipients' is set this value should be less or equal\n$config['max_group_members'] = 0;\n\n// Name your service. This is displayed on the login screen and in the window title\n$config['product_name'] = 'Roundcube Webmail';\n\n// Add this user-agent to message headers when sending\n$config['useragent'] = 'Roundcube Webmail/'.RCMAIL_VERSION;\n\n// try to load host-specific configuration\n// see https://github.com/roundcube/roundcubemail/wiki/Configuration:-Multi-Domain-Setup\n// for more details\n$config['include_host_config'] = false;\n\n// path to a text file which will be added to each sent message\n// paths are relative to the Roundcube root folder\n$config['generic_message_footer'] = '';\n\n// path to a text file which will be added to each sent HTML message\n// paths are relative to the Roundcube root folder\n$config['generic_message_footer_html'] = '';\n\n// add a received header to outgoing mails containing the creators IP and hostname\n$config['http_received_header'] = false;\n\n// Whether or not to encrypt the IP address and the host name\n// these could, in some circles, be considered as sensitive information;\n// however, for the administrator, these could be invaluable help\n// when tracking down issues.\n$config['http_received_header_encrypt'] = false;\n\n// number of chars allowed for line when wrapping text.\n// text wrapping is done when composing/sending messages\n$config['line_length'] = 72;\n\n// send plaintext messages as format=flowed\n$config['send_format_flowed'] = true;\n\n// According to RFC2298, return receipt envelope sender address must be empty.\n// If this option is true, Roundcube will use user's identity as envelope sender for MDN responses.\n$config['mdn_use_from'] = false;\n\n// Set identities access level:\n// 0 - many identities with possibility to edit all params\n// 1 - many identities with possibility to edit all params but not email address\n// 2 - one identity with possibility to edit all params\n// 3 - one identity with possibility to edit all params but not email address\n// 4 - one identity with possibility to edit only signature\n$config['identities_level'] = 0;\n\n// Maximum size of uploaded image in kilobytes\n// Images (in html signatures) are stored in database as data URIs\n$config['identity_image_size'] = 64;\n\n// Mimetypes supported by the browser.\n// attachments of these types will open in a preview window\n// either a comma-separated list or an array: 'text/plain,text/html,text/xml,image/jpeg,image/gif,image/png,application/pdf'\n$config['client_mimetypes'] = null;  # null == default\n\n// Path to a local mime magic database file for PHPs finfo extension.\n// Set to null if the default path should be used.\n$config['mime_magic'] = null;\n\n// Absolute path to a local mime.types mapping table file.\n// This is used to derive mime-types from the filename extension or vice versa.\n// Such a file is usually part of the apache webserver. If you don't find a file named mime.types on your system,\n// download it from http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types\n$config['mime_types'] = null;\n\n// path to imagemagick identify binary (if not set we'll use Imagick or GD extensions)\n$config['im_identify_path'] = null;\n\n// path to imagemagick convert binary (if not set we'll use Imagick or GD extensions)\n$config['im_convert_path'] = null;\n\n// Size of thumbnails from image attachments displayed below the message content.\n// Note: whether images are displayed at all depends on the 'inline_images' option.\n// Set to 0 to display images in full size.\n$config['image_thumbnail_size'] = 240;\n\n// maximum size of uploaded contact photos in pixel\n$config['contact_photo_size'] = 160;\n\n// Enable DNS checking for e-mail address validation\n$config['email_dns_check'] = false;\n\n// Disables saving sent messages in Sent folder (like gmail) (Default: false)\n// Note: useful when SMTP server stores sent mail in user mailbox\n$config['no_save_sent_messages'] = false;\n\n// Improve system security by using special URL with security token.\n// This can be set to a number defining token length. Default: 16.\n// Warning: This requires http server configuration. Sample:\n//    RewriteRule ^/roundcubemail/[a-zA-Z0-9]{16}/(.*) /roundcubemail/$1 [PT]\n//    Alias /roundcubemail /var/www/roundcubemail/\n// Note: Use assets_path to not prevent the browser from caching assets\n$config['use_secure_urls'] = false;\n\n// Allows to define separate server/path for image/js/css files\n// Warning: If the domain is different cross-domain access to some\n// resources need to be allowed\n// Sample:\n//    <FilesMatch \".(eot|ttf|woff)\">\n//    Header set Access-Control-Allow-Origin \"*\"\n//    </FilesMatch>\n$config['assets_path'] = '';\n\n// While assets_path is for the browser, assets_dir informs\n// PHP code about the location of asset files in filesystem\n$config['assets_dir'] = '';\n\n\n// ----------------------------------\n// PLUGINS\n// ----------------------------------\n\n// List of active plugins (in plugins/ directory)\n$config['plugins'] = array();\n\n// ----------------------------------\n// USER INTERFACE\n// ----------------------------------\n\n// default messages sort column. Use empty value for default server's sorting, \n// or 'arrival', 'date', 'subject', 'from', 'to', 'fromto', 'size', 'cc'\n$config['message_sort_col'] = '';\n\n// default messages sort order\n$config['message_sort_order'] = 'DESC';\n\n// These cols are shown in the message list. Available cols are:\n// subject, from, to, fromto, cc, replyto, date, size, status, flag, attachment, priority\n$config['list_cols'] = array('subject', 'status', 'fromto', 'date', 'size', 'flag', 'attachment');\n\n// the default locale setting (leave empty for auto-detection)\n// RFC1766 formatted language name like en_US, de_DE, de_CH, fr_FR, pt_BR\n$config['language'] = null;\n\n// use this format for date display (date or strftime format)\n$config['date_format'] = 'Y-m-d';\n\n// give this choice of date formats to the user to select from\n// Note: do not use ambiguous formats like m/d/Y\n$config['date_formats'] = array('Y-m-d', 'Y/m/d', 'Y.m.d', 'd-m-Y', 'd/m/Y', 'd.m.Y', 'j.n.Y');\n\n// use this format for time display (date or strftime format)\n$config['time_format'] = 'H:i';\n\n// give this choice of time formats to the user to select from\n$config['time_formats'] = array('G:i', 'H:i', 'g:i a', 'h:i A');\n\n// use this format for short date display (derived from date_format and time_format)\n$config['date_short'] = 'D H:i';\n\n// use this format for detailed date/time formatting (derived from date_format and time_format)\n$config['date_long'] = 'Y-m-d H:i';\n\n// store draft message is this mailbox\n// leave blank if draft messages should not be stored\n// NOTE: Use folder names with namespace prefix (INBOX. on Courier-IMAP)\n$config['drafts_mbox'] = 'Drafts';\n\n// store spam messages in this mailbox\n// NOTE: Use folder names with namespace prefix (INBOX. on Courier-IMAP)\n$config['junk_mbox'] = 'Junk';\n\n// store sent message is this mailbox\n// leave blank if sent messages should not be stored\n// NOTE: Use folder names with namespace prefix (INBOX. on Courier-IMAP)\n$config['sent_mbox'] = 'Sent';\n\n// move messages to this folder when deleting them\n// leave blank if they should be deleted directly\n// NOTE: Use folder names with namespace prefix (INBOX. on Courier-IMAP)\n$config['trash_mbox'] = 'Trash';\n\n// automatically create the above listed default folders on user login\n$config['create_default_folders'] = false;\n\n// protect the default folders from renames, deletes, and subscription changes\n$config['protect_default_folders'] = true;\n\n// Disable localization of the default folder names listed above\n$config['show_real_foldernames'] = false;\n\n// if in your system 0 quota means no limit set this option to true \n$config['quota_zero_as_unlimited'] = false;\n\n// Make use of the built-in spell checker. It is based on GoogieSpell.\n$config['enable_spellcheck'] = true;\n\n// Enables spellchecker exceptions dictionary.\n// Setting it to 'shared' will make the dictionary shared by all users.\n$config['spellcheck_dictionary'] = false;\n\n// Set the spell checking engine. Possible values:\n// - 'googie'  - the default (also used for connecting to Nox Spell Server, see 'spellcheck_uri' setting)\n// - 'pspell'  - requires the PHP Pspell module and aspell installed\n// - 'enchant' - requires the PHP Enchant module\n// - 'atd'     - install your own After the Deadline server or check with the people at http://www.afterthedeadline.com before using their API\n// Since Google shut down their public spell checking service, the default settings\n// connect to http://spell.roundcube.net which is a hosted service provided by Roundcube.\n// You can connect to any other googie-compliant service by setting 'spellcheck_uri' accordingly.\n$config['spellcheck_engine'] = 'googie';\n\n// For locally installed Nox Spell Server or After the Deadline services,\n// please specify the URI to call it.\n// Get Nox Spell Server from http://orangoo.com/labs/?page_id=72 or\n// the After the Deadline package from http://www.afterthedeadline.com.\n// Leave empty to use the public API of service.afterthedeadline.com\n$config['spellcheck_uri'] = '';\n\n// These languages can be selected for spell checking.\n// Configure as a PHP style hash array: array('en'=>'English', 'de'=>'Deutsch');\n// Leave empty for default set of available language.\n$config['spellcheck_languages'] = NULL;\n\n// Makes that words with all letters capitalized will be ignored (e.g. GOOGLE)\n$config['spellcheck_ignore_caps'] = false;\n\n// Makes that words with numbers will be ignored (e.g. g00gle)\n$config['spellcheck_ignore_nums'] = false;\n\n// Makes that words with symbols will be ignored (e.g. g@@gle)\n$config['spellcheck_ignore_syms'] = false;\n\n// Use this char/string to separate recipients when composing a new message\n$config['recipients_separator'] = ',';\n\n// Number of lines at the end of a message considered to contain the signature.\n// Increase this value if signatures are not properly detected and colored\n$config['sig_max_lines'] = 15;\n\n// don't let users set pagesize to more than this value if set\n$config['max_pagesize'] = 200;\n\n// Minimal value of user's 'refresh_interval' setting (in seconds)\n$config['min_refresh_interval'] = 60;\n\n// Enables files upload indicator. Requires APC installed and enabled apc.rfc1867 option.\n// By default refresh time is set to 1 second. You can set this value to true\n// or any integer value indicating number of seconds.\n$config['upload_progress'] = false;\n\n// Specifies for how many seconds the Undo button will be available\n// after object delete action. Currently used with supporting address book sources.\n// Setting it to 0, disables the feature.\n$config['undo_timeout'] = 0;\n\n// A static list of canned responses which are immutable for the user\n$config['compose_responses_static'] = array(\n//  array('name' => 'Canned Response 1', 'text' => 'Static Response One'),\n//  array('name' => 'Canned Response 2', 'text' => 'Static Response Two'),\n);\n\n// ----------------------------------\n// ADDRESSBOOK SETTINGS\n// ----------------------------------\n\n// This indicates which type of address book to use. Possible choises:\n// 'sql' (default), 'ldap' and ''.\n// If set to 'ldap' then it will look at using the first writable LDAP\n// address book as the primary address book and it will not display the\n// SQL address book in the 'Address Book' view.\n// If set to '' then no address book will be displayed or only the\n// addressbook which is created by a plugin (like CardDAV).\n$config['address_book_type'] = 'sql';\n\n// In order to enable public ldap search, configure an array like the Verisign\n// example further below. if you would like to test, simply uncomment the example.\n// Array key must contain only safe characters, ie. a-zA-Z0-9_\n$config['ldap_public'] = array();\n\n// If you are going to use LDAP for individual address books, you will need to \n// set 'user_specific' to true and use the variables to generate the appropriate DNs to access it.\n//\n// The recommended directory structure for LDAP is to store all the address book entries\n// under the users main entry, e.g.:\n//\n//  o=root\n//   ou=people\n//    uid=user@domain\n//  mail=contact@contactdomain\n//\n// So the base_dn would be uid=%fu,ou=people,o=root\n// The bind_dn would be the same as based_dn or some super user login.\n/* \n * example config for Verisign directory\n *\n$config['ldap_public']['Verisign'] = array(\n  'name'          => 'Verisign.com',\n  // Replacement variables supported in host names:\n  // %h - user's IMAP hostname\n  // %n - hostname ($_SERVER['SERVER_NAME'])\n  // %t - hostname without the first part\n  // %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)\n  // %z - IMAP domain (IMAP hostname without the first part)\n  // For example %n = mail.domain.tld, %t = domain.tld\n  'hosts'         => array('directory.verisign.com'),\n  'port'          => 389,\n  'use_tls'       => false,\n  'ldap_version'  => 3,       // using LDAPv3\n  'network_timeout' => 10,    // The timeout (in seconds) for connect + bind arrempts. This is only supported in PHP >= 5.3.0 with OpenLDAP 2.x\n  'user_specific' => false,   // If true the base_dn, bind_dn and bind_pass default to the user's IMAP login.\n  // When 'user_specific' is enabled following variables can be used in base_dn/bind_dn config:\n  // %fu - The full username provided, assumes the username is an email\n  //       address, uses the username_domain value if not an email address.\n  // %u  - The username prior to the '@'.\n  // %d  - The domain name after the '@'.\n  // %dc - The domain name hierarchal string e.g. \"dc=test,dc=domain,dc=com\"\n  // %dn - DN found by ldap search when search_filter/search_base_dn are used\n  'base_dn'       => '',\n  'bind_dn'       => '',\n  'bind_pass'     => '',\n  // It's possible to bind for an individual address book\n  // The login name is used to search for the DN to bind with\n  'search_base_dn' => '',\n  'search_filter'  => '',   // e.g. '(&(objectClass=posixAccount)(uid=%u))'\n  // DN and password to bind as before searching for bind DN, if anonymous search is not allowed\n  'search_bind_dn' => '',\n  'search_bind_pw' => '',\n  // Base DN and filter used for resolving the user's domain root DN which feeds the %dc variables\n  // Leave empty to skip this lookup and derive the root DN from the username domain\n  'domain_base_dn' => '',\n  'domain_filter'  => '',\n  // Optional map of replacement strings => attributes used when binding for an individual address book\n  'search_bind_attrib' => array(),  // e.g. array('%udc' => 'ou')\n  // Default for %dn variable if search doesn't return DN value\n  'search_dn_default' => '',\n  // Optional authentication identifier to be used as SASL authorization proxy\n  // bind_dn need to be empty\n  'auth_cid'       => '',\n  // SASL authentication method (for proxy auth), e.g. DIGEST-MD5\n  'auth_method'    => '',\n  // Indicates if the addressbook shall be hidden from the list.\n  // With this option enabled you can still search/view contacts.\n  'hidden'        => false,\n  // Indicates if the addressbook shall not list contacts but only allows searching.\n  'searchonly'    => false,\n  // Indicates if we can write to the LDAP directory or not.\n  // If writable is true then these fields need to be populated:\n  // LDAP_Object_Classes, required_fields, LDAP_rdn\n  'writable'       => false,\n  // To create a new contact these are the object classes to specify\n  // (or any other classes you wish to use).\n  'LDAP_Object_Classes' => array('top', 'inetOrgPerson'),\n  // The RDN field that is used for new entries, this field needs\n  // to be one of the search_fields, the base of base_dn is appended\n  // to the RDN to insert into the LDAP directory.\n  'LDAP_rdn'       => 'cn',\n  // The required fields needed to build a new contact as required by\n  // the object classes (can include additional fields not required by the object classes).\n  'required_fields' => array('cn', 'sn', 'mail'),\n  'search_fields'   => array('mail', 'cn'),  // fields to search in\n  // mapping of contact fields to directory attributes\n  //   1. for every attribute one can specify the number of values (limit) allowed.\n  //      default is 1, a wildcard * means unlimited\n  //   2. another possible parameter is separator character for composite fields\n  //   3. it's possible to define field format for write operations, e.g. for date fields\n  //      example: 'birthday:date[YmdHis\\\\Z]'\n  'fieldmap' => array(\n    // Roundcube  => LDAP:limit\n    'name'        => 'cn',\n    'surname'     => 'sn',\n    'firstname'   => 'givenName',\n    'jobtitle'    => 'title',\n    'email'       => 'mail:*',\n    'phone:home'  => 'homePhone',\n    'phone:work'  => 'telephoneNumber',\n    'phone:mobile' => 'mobile',\n    'phone:pager' => 'pager',\n    'phone:workfax' => 'facsimileTelephoneNumber',\n    'street'      => 'street',\n    'zipcode'     => 'postalCode',\n    'region'      => 'st',\n    'locality'    => 'l',\n    // if you country is a complex object, you need to configure 'sub_fields' below\n    'country'      => 'c',\n    'organization' => 'o',\n    'department'   => 'ou',\n    'jobtitle'     => 'title',\n    'notes'        => 'description',\n    'photo'        => 'jpegPhoto',\n    // these currently don't work:\n    // 'manager'       => 'manager',\n    // 'assistant'     => 'secretary',\n  ),\n  // Map of contact sub-objects (attribute name => objectClass(es)), e.g. 'c' => 'country'\n  'sub_fields' => array(),\n  // Generate values for the following LDAP attributes automatically when creating a new record\n  'autovalues' => array(\n  // 'uid'  => 'md5(microtime())',               // You may specify PHP code snippets which are then eval'ed \n  // 'mail' => '{givenname}.{sn}@mydomain.com',  // or composite strings with placeholders for existing attributes\n  ),\n  'sort'           => 'cn',         // The field to sort the listing by.\n  'scope'          => 'sub',        // search mode: sub|base|list\n  'filter'         => '(objectClass=inetOrgPerson)',      // used for basic listing (if not empty) and will be &'d with search queries. example: status=act\n  'fuzzy_search'   => true,         // server allows wildcard search\n  'vlv'            => false,        // Enable Virtual List View to more efficiently fetch paginated data (if server supports it)\n  'vlv_search'     => false,        // Use Virtual List View functions for autocompletion searches (if server supports it)\n  'numsub_filter'  => '(objectClass=organizationalUnit)',   // with VLV, we also use numSubOrdinates to query the total number of records. Set this filter to get all numSubOrdinates attributes for counting\n  'config_root_dn' => 'cn=config',  // Root DN to search config entries (e.g. vlv indexes)\n  'sizelimit'      => '0',          // Enables you to limit the count of entries fetched. Setting this to 0 means no limit.\n  'timelimit'      => '0',          // Sets the number of seconds how long is spend on the search. Setting this to 0 means no limit.\n  'referrals'      => false,        // Sets the LDAP_OPT_REFERRALS option. Mostly used in multi-domain Active Directory setups\n  'dereference'    => 0,            // Sets the LDAP_OPT_DEREF option. One of: LDAP_DEREF_NEVER, LDAP_DEREF_SEARCHING, LDAP_DEREF_FINDING, LDAP_DEREF_ALWAYS\n                                    // Used where addressbook contains aliases to objects elsewhere in the LDAP tree.\n\n  // definition for contact groups (uncomment if no groups are supported)\n  // for the groups base_dn, the user replacements %fu, %u, $d and %dc work as for base_dn (see above)\n  // if the groups base_dn is empty, the contact base_dn is used for the groups as well\n  // -> in this case, assure that groups and contacts are separated due to the concernig filters! \n  'groups'  => array(\n    'base_dn'           => '',\n    'scope'             => 'sub',       // Search mode: sub|base|list\n    'filter'            => '(objectClass=groupOfNames)',\n    'object_classes'    => array('top', 'groupOfNames'),   // Object classes to be assigned to new groups\n    'member_attr'       => 'member',   // Name of the default member attribute, e.g. uniqueMember\n    'name_attr'         => 'cn',       // Attribute to be used as group name\n    'email_attr'        => 'mail',     // Group email address attribute (e.g. for mailing lists)\n    'member_filter'     => '(objectclass=*)',  // Optional filter to use when querying for group members\n    'vlv'               => false,      // Use VLV controls to list groups\n    'class_member_attr' => array(      // Mapping of group object class to member attribute used in these objects\n      'groupofnames'       => 'member',\n      'groupofuniquenames' => 'uniquemember'\n    ),\n  ),\n  // this configuration replaces the regular groups listing in the directory tree with\n  // a hard-coded list of groups, each listing entries with the configured base DN and filter.\n  // if the 'groups' option from above is set, it'll be shown as the first entry with the name 'Groups'\n  'group_filters' => array(\n    'departments' => array(\n      'name'    => 'Company Departments',\n      'scope'   => 'list',\n      'base_dn' => 'ou=Groups,dc=mydomain,dc=com',\n      'filter'  => '(|(objectclass=groupofuniquenames)(objectclass=groupofurls))',\n      'name_attr' => 'cn',\n    ),\n    'customers' => array(\n      'name'    => 'Customers',\n      'scope'   => 'sub',\n      'base_dn' => 'ou=Customers,dc=mydomain,dc=com',\n      'filter'  => '(objectClass=inetOrgPerson)',\n      'name_attr' => 'sn',\n    ),\n  ),\n);\n*/\n\n// An ordered array of the ids of the addressbooks that should be searched\n// when populating address autocomplete fields server-side. ex: array('sql','Verisign');\n$config['autocomplete_addressbooks'] = array('sql');\n\n// The minimum number of characters required to be typed in an autocomplete field\n// before address books will be searched. Most useful for LDAP directories that\n// may need to do lengthy results building given overly-broad searches\n$config['autocomplete_min_length'] = 1;\n\n// Number of parallel autocomplete requests.\n// If there's more than one address book, n parallel (async) requests will be created,\n// where each request will search in one address book. By default (0), all address\n// books are searched in one request.\n$config['autocomplete_threads'] = 0;\n\n// Max. numer of entries in autocomplete popup. Default: 15.\n$config['autocomplete_max'] = 15;\n\n// show address fields in this order\n// available placeholders: {street}, {locality}, {zipcode}, {country}, {region}\n$config['address_template'] = '{street}<br/>{locality} {zipcode}<br/>{country} {region}';\n\n// Matching mode for addressbook search (including autocompletion)\n// 0 - partial (*abc*), default\n// 1 - strict (abc)\n// 2 - prefix (abc*)\n// Note: For LDAP sources fuzzy_search must be enabled to use 'partial' or 'prefix' mode\n$config['addressbook_search_mode'] = 0;\n\n// List of fields used on contacts list and for autocompletion searches\n// Warning: These are field names not LDAP attributes (see 'fieldmap' setting)!\n$config['contactlist_fields'] = array('name', 'firstname', 'surname', 'email');\n\n// Template of contact entry on the autocompletion list.\n// You can use contact fields as: name, email, organization, department, etc.\n// See program/steps/addressbook/func.inc for a list\n$config['contact_search_name'] = '{name} <{email}>';\n\n// ----------------------------------\n// USER PREFERENCES\n// ----------------------------------\n\n// Use this charset as fallback for message decoding\n$config['default_charset'] = 'ISO-8859-1';\n\n// skin name: folder from skins/\n$config['skin'] = 'larry';\n\n// Enables using standard browser windows (that can be handled as tabs)\n// instead of popup windows\n$config['standard_windows'] = false;\n\n// show up to X items in messages list view\n$config['mail_pagesize'] = 50;\n\n// show up to X items in contacts list view\n$config['addressbook_pagesize'] = 50;\n\n// sort contacts by this col (preferably either one of name, firstname, surname)\n$config['addressbook_sort_col'] = 'surname';\n\n// The way how contact names are displayed in the list.\n// 0: prefix firstname middlename surname suffix (only if display name is not set)\n// 1: firstname middlename surname\n// 2: surname firstname middlename\n// 3: surname, firstname middlename\n$config['addressbook_name_listing'] = 0;\n\n// use this timezone to display date/time\n// valid timezone identifiers are listed here: php.net/manual/en/timezones.php\n// 'auto' will use the browser's timezone settings\n$config['timezone'] = 'auto';\n\n// prefer displaying HTML messages\n$config['prefer_html'] = true;\n\n// display remote inline images\n// 0 - Never, always ask\n// 1 - Ask if sender is not in address book\n// 2 - Always show inline images\n$config['show_images'] = 0;\n\n// open messages in new window\n$config['message_extwin'] = false;\n\n// open message compose form in new window\n$config['compose_extwin'] = false;\n\n// compose html formatted messages by default\n//  0 - never,\n//  1 - always,\n//  2 - on reply to HTML message,\n//  3 - on forward or reply to HTML message\n//  4 - always, except when replying to plain text message\n$config['htmleditor'] = 0;\n\n// save copies of compose messages in the browser's local storage\n// for recovery in case of browser crashes and session timeout.\n$config['compose_save_localstorage'] = true;\n\n// show pretty dates as standard\n$config['prettydate'] = true;\n\n// save compose message every 300 seconds (5min)\n$config['draft_autosave'] = 300;\n\n// Interface layout. Default: 'widescreen'.\n//  'widescreen' - three columns\n//  'desktop'    - two columns, preview on bottom\n//  'list'       - two columns, no preview\n$config['layout'] = 'widescreen';\n\n// Mark as read when viewing a message (delay in seconds)\n// Set to -1 if messages should not be marked as read\n$config['mail_read_time'] = 0;\n\n// Clear Trash on logout\n$config['logout_purge'] = false;\n\n// Compact INBOX on logout\n$config['logout_expunge'] = false;\n\n// Display attached images below the message body \n$config['inline_images'] = true;\n\n// Encoding of long/non-ascii attachment names:\n// 0 - Full RFC 2231 compatible\n// 1 - RFC 2047 for 'name' and RFC 2231 for 'filename' parameter (Thunderbird's default)\n// 2 - Full 2047 compatible\n$config['mime_param_folding'] = 1;\n\n// Set true if deleted messages should not be displayed\n// This will make the application run slower\n$config['skip_deleted'] = false;\n\n// Set true to Mark deleted messages as read as well as deleted\n// False means that a message's read status is not affected by marking it as deleted\n$config['read_when_deleted'] = true;\n\n// Set to true to never delete messages immediately\n// Use 'Purge' to remove messages marked as deleted\n$config['flag_for_deletion'] = false;\n\n// Default interval for auto-refresh requests (in seconds)\n// These are requests for system state updates e.g. checking for new messages, etc.\n// Setting it to 0 disables the feature.\n$config['refresh_interval'] = 60;\n\n// If true all folders will be checked for recent messages\n$config['check_all_folders'] = false;\n\n// If true, after message delete/move, the next message will be displayed\n$config['display_next'] = true;\n\n// Default messages listing mode. One of 'threads' or 'list'.\n$config['default_list_mode'] = 'list';\n\n// 0 - Do not expand threads\n// 1 - Expand all threads automatically\n// 2 - Expand only threads with unread messages\n$config['autoexpand_threads'] = 0;\n\n// When replying:\n// -1 - don't cite the original message\n// 0  - place cursor below the original message\n// 1  - place cursor above original message (top posting)\n$config['reply_mode'] = 0;\n\n// When replying strip original signature from message\n$config['strip_existing_sig'] = true;\n\n// Show signature:\n// 0 - Never\n// 1 - Always\n// 2 - New messages only\n// 3 - Forwards and Replies only\n$config['show_sig'] = 1;\n\n// By default the signature is placed depending on cursor position (reply_mode).\n// Sometimes it might be convenient to start the reply on top but keep\n// the signature below the quoted text (sig_below = true).\n$config['sig_below'] = false;\n\n// Enables adding of standard separator to the signature\n$config['sig_separator'] = true;\n\n// Use MIME encoding (quoted-printable) for 8bit characters in message body\n$config['force_7bit'] = false;\n\n// Defaults of the search field configuration.\n// The array can contain a per-folder list of header fields which should be considered when searching\n// The entry with key '*' stands for all folders which do not have a specific list set.\n// Please note that folder names should to be in sync with $config['*_mbox'] options\n$config['search_mods'] = null;  // Example: array('*' => array('subject'=>1, 'from'=>1), 'Sent' => array('subject'=>1, 'to'=>1));\n\n// Defaults of the addressbook search field configuration.\n$config['addressbook_search_mods'] = null;  // Example: array('name'=>1, 'firstname'=>1, 'surname'=>1, 'email'=>1, '*'=>1);\n\n// 'Delete always'\n// This setting reflects if mail should be always deleted\n// when moving to Trash fails. This is necessary in some setups\n// when user is over quota and Trash is included in the quota.\n$config['delete_always'] = false;\n\n// Directly delete messages in Junk instead of moving to Trash\n$config['delete_junk'] = false;\n\n// Behavior if a received message requests a message delivery notification (read receipt)\n// 0 = ask the user, 1 = send automatically, 2 = ignore (never send or ask)\n// 3 = send automatically if sender is in addressbook, otherwise ask the user\n// 4 = send automatically if sender is in addressbook, otherwise ignore\n$config['mdn_requests'] = 0;\n\n// Return receipt checkbox default state\n$config['mdn_default'] = 0;\n\n// Delivery Status Notification checkbox default state\n// Note: This can be used only if smtp_server is non-empty\n$config['dsn_default'] = 0;\n\n// Place replies in the folder of the message being replied to\n$config['reply_same_folder'] = false;\n\n// Sets default mode of Forward feature to \"forward as attachment\"\n$config['forward_attachment'] = false;\n\n// Defines address book (internal index) to which new contacts will be added\n// By default it is the first writeable addressbook.\n// Note: Use '0' for built-in address book.\n$config['default_addressbook'] = null;\n\n// Enables spell checking before sending a message.\n$config['spellcheck_before_send'] = false;\n\n// Skip alternative email addresses in autocompletion (show one address per contact)\n$config['autocomplete_single'] = false;\n\n// Default font for composed HTML message.\n// Supported values: Andale Mono, Arial, Arial Black, Book Antiqua, Courier New,\n// Georgia, Helvetica, Impact, Tahoma, Terminal, Times New Roman, Trebuchet MS, Verdana\n$config['default_font'] = 'Verdana';\n\n// Default font size for composed HTML message.\n// Supported sizes: 8pt, 10pt, 12pt, 14pt, 18pt, 24pt, 36pt\n$config['default_font_size'] = '10pt';\n\n// Enables display of email address with name instead of a name (and address in title)\n$config['message_show_email'] = false;\n\n// Default behavior of Reply-All button:\n// 0 - Reply-All always\n// 1 - Reply-List if mailing list is detected\n$config['reply_all_mode'] = 0;\n", "<?php\n\n/**\n +-----------------------------------------------------------------------+\n | This file is part of the Roundcube Webmail client                     |\n | Copyright (C) 2008-2014, The Roundcube Dev Team                       |\n |                                                                       |\n | Licensed under the GNU General Public License version 3 or            |\n | any later version with exceptions for skins & plugins.                |\n | See the README file for a full license statement.                     |\n |                                                                       |\n | PURPOSE:                                                              |\n |   Class to read configuration settings                                |\n +-----------------------------------------------------------------------+\n | Author: Thomas Bruederli <roundcube@gmail.com>                        |\n +-----------------------------------------------------------------------+\n*/\n\n/**\n * Configuration class for Roundcube\n *\n * @package    Framework\n * @subpackage Core\n */\nclass rcube_config\n{\n    const DEFAULT_SKIN = 'larry';\n\n    private $env       = '';\n    private $paths     = array();\n    private $prop      = array();\n    private $errors    = array();\n    private $userprefs = array();\n\n\n    /**\n     * Renamed options\n     *\n     * @var array\n     */\n    private $legacy_props = array(\n        // new name => old name\n        'mail_pagesize'        => 'pagesize',\n        'addressbook_pagesize' => 'pagesize',\n        'reply_mode'           => 'top_posting',\n        'refresh_interval'     => 'keep_alive',\n        'min_refresh_interval' => 'min_keep_alive',\n        'messages_cache_ttl'   => 'message_cache_lifetime',\n        'mail_read_time'       => 'preview_pane_mark_read',\n        'redundant_attachments_cache_ttl' => 'redundant_attachments_memcache_ttl',\n    );\n\n    /**\n     * Object constructor\n     *\n     * @param string $env Environment suffix for config files to load\n     */\n    public function __construct($env = '')\n    {\n        $this->env = $env;\n\n        if ($paths = getenv('RCUBE_CONFIG_PATH')) {\n            $this->paths = explode(PATH_SEPARATOR, $paths);\n            // make all paths absolute\n            foreach ($this->paths as $i => $path) {\n                if (!rcube_utils::is_absolute_path($path)) {\n                    if ($realpath = realpath(RCUBE_INSTALL_PATH . $path)) {\n                        $this->paths[$i] = unslashify($realpath) . '/';\n                    }\n                    else {\n                        unset($this->paths[$i]);\n                    }\n                }\n                else {\n                    $this->paths[$i] = unslashify($path) . '/';\n                }\n            }\n        }\n\n        if (defined('RCUBE_CONFIG_DIR') && !in_array(RCUBE_CONFIG_DIR, $this->paths)) {\n            $this->paths[] = RCUBE_CONFIG_DIR;\n        }\n\n        if (empty($this->paths)) {\n            $this->paths[] = RCUBE_INSTALL_PATH . 'config/';\n        }\n\n        $this->load();\n\n        // Defaults, that we do not require you to configure,\n        // but contain information that is used in various locations in the code:\n        if (empty($this->prop['contactlist_fields'])) {\n            $this->set('contactlist_fields', array('name', 'firstname', 'surname', 'email'));\n        }\n    }\n\n    /**\n     * @brief Guess the type the string may fit into.\n     *\n     * Look inside the string to determine what type might be best as a container.\n     *\n     * @param mixed $value The value to inspect\n     *\n     * @return The guess at the type.\n     */\n    private function guess_type($value)\n    {\n        $type = 'string';\n\n        // array requires hint to be passed.\n\n        if (preg_match('/^[-+]?(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?$/', $value)) {\n            $type = 'double';\n        }\n        else if (preg_match('/^\\d+$/', $value)) {\n            $type = 'integer';\n        }\n        else if (preg_match('/^(t(rue)?)|(f(alse)?)$/i', $value)) {\n            $type = 'boolean';\n        }\n\n        return $type;\n    }\n\n    /**\n     * @brief Parse environment variable into PHP type.\n     *\n     * Perform an appropriate parsing of the string to create the desired PHP type.\n     *\n     * @param string $string String to parse into PHP type\n     * @param string $type   Type of value to return\n     *\n     * @return Appropriately typed interpretation of $string.\n     */\n    private function parse_env($string, $type)\n    {\n        $_ = $string;\n\n        switch ($type) {\n        case 'boolean':\n            $_ = (boolean) $_;\n            break;\n        case 'integer':\n            $_ = (integer) $_;\n            break;\n        case 'double':\n            $_ = (double) $_;\n            break;\n        case 'string':\n            break;\n        case 'array':\n            $_ = json_decode($_, true);\n            break;\n        case 'object':\n            $_ = json_decode($_, false);\n            break;\n        case 'resource':\n        case 'NULL':\n        default:\n            $_ = $this->parse_env($_, $this->guess_type($_));\n        }\n\n        return $_;\n    }\n\n    /**\n     * @brief Get environment variable value.\n     *\n     * Retrieve an environment variable's value or if it's not found, return the\n     * provided default value.\n     *\n     * @param string $varname       Environment variable name\n     * @param mixed  $default_value Default value to return if necessary\n     * @param string $type          Type of value to return\n     *\n     * @return Value of the environment variable or default if not found.\n     */\n    private function getenv_default($varname, $default_value, $type = null)\n    {\n        $value = getenv($varname);\n\n        if ($value === false) {\n            $value = $default_value;\n        }\n        else {\n            $value = $this->parse_env($value, $type ?: gettype($default_value));\n        }\n\n        return $value;\n    }\n\n    /**\n     * Load config from local config file\n     *\n     * @todo Remove global $CONFIG\n     */\n    private function load()\n    {\n        // Load default settings\n        if (!$this->load_from_file('defaults.inc.php')) {\n            $this->errors[] = 'defaults.inc.php was not found.';\n        }\n\n        // load main config file\n        if (!$this->load_from_file('config.inc.php')) {\n            // Old configuration files\n            if (!$this->load_from_file('main.inc.php') || !$this->load_from_file('db.inc.php')) {\n                $this->errors[] = 'config.inc.php was not found.';\n            }\n            else if (rand(1,100) == 10) {  // log warning on every 100th request (average)\n                trigger_error(\"config.inc.php was not found. Please migrate your config by running bin/update.sh\", E_USER_WARNING);\n            }\n        }\n\n        // load host-specific configuration\n        $this->load_host_config();\n\n        // set skin (with fallback to old 'skin_path' property)\n        if (empty($this->prop['skin'])) {\n            if (!empty($this->prop['skin_path'])) {\n                $this->prop['skin'] = str_replace('skins/', '', unslashify($this->prop['skin_path']));\n            }\n            else {\n                $this->prop['skin'] = self::DEFAULT_SKIN;\n            }\n        }\n\n        // larry is the new default skin :-)\n        if ($this->prop['skin'] == 'default') {\n            $this->prop['skin'] = self::DEFAULT_SKIN;\n        }\n\n        // fix paths\n        foreach (array('log_dir' => 'logs', 'temp_dir' => 'temp') as $key => $dir) {\n            foreach (array($this->prop[$key], '../' . $this->prop[$key], RCUBE_INSTALL_PATH . $dir) as $path) {\n                if ($path && ($realpath = realpath(unslashify($path)))) {\n                    $this->prop[$key] = $realpath;\n                    break;\n                }\n            }\n        }\n\n        // fix default imap folders encoding\n        foreach (array('drafts_mbox', 'junk_mbox', 'sent_mbox', 'trash_mbox') as $folder) {\n            $this->prop[$folder] = rcube_charset::convert($this->prop[$folder], RCUBE_CHARSET, 'UTF7-IMAP');\n        }\n\n        // set PHP error logging according to config\n        if ($this->prop['debug_level'] & 1) {\n            ini_set('log_errors', 1);\n\n            if ($this->prop['log_driver'] == 'syslog') {\n                ini_set('error_log', 'syslog');\n            }\n            else {\n                ini_set('error_log', $this->prop['log_dir'].'/errors');\n            }\n        }\n\n        // enable display_errors in 'show' level, but not for ajax requests\n        ini_set('display_errors', intval(empty($_REQUEST['_remote']) && ($this->prop['debug_level'] & 4)));\n\n        // remove deprecated properties\n        unset($this->prop['dst_active']);\n\n        // export config data\n        $GLOBALS['CONFIG'] = &$this->prop;\n    }\n\n    /**\n     * Load a host-specific config file if configured\n     * This will merge the host specific configuration with the given one\n     */\n    private function load_host_config()\n    {\n        if (empty($this->prop['include_host_config'])) {\n            return;\n        }\n\n        foreach (array('HTTP_HOST', 'SERVER_NAME', 'SERVER_ADDR') as $key) {\n            $fname = null;\n            $name  = $_SERVER[$key];\n\n            if (!$name) {\n                continue;\n            }\n\n            if (is_array($this->prop['include_host_config'])) {\n                $fname = $this->prop['include_host_config'][$name];\n            }\n            else {\n                $fname = preg_replace('/[^a-z0-9\\.\\-_]/i', '', $name) . '.inc.php';\n            }\n\n            if ($fname && $this->load_from_file($fname)) {\n                return;\n            }\n        }\n    }\n\n    /**\n     * Read configuration from a file\n     * and merge with the already stored config values\n     *\n     * @param string $file Name of the config file to be loaded\n     *\n     * @return booelan True on success, false on failure\n     */\n    public function load_from_file($file)\n    {\n        $success = false;\n\n        foreach ($this->resolve_paths($file) as $fpath) {\n            if ($fpath && is_file($fpath) && is_readable($fpath)) {\n                // use output buffering, we don't need any output here\n                ob_start();\n                include($fpath);\n                ob_end_clean();\n\n                if (is_array($config)) {\n                    $this->merge($config);\n                    $success = true;\n                }\n                // deprecated name of config variable\n                if (is_array($rcmail_config)) {\n                    $this->merge($rcmail_config);\n                    $success = true;\n                }\n            }\n        }\n\n        return $success;\n    }\n\n    /**\n     * Helper method to resolve absolute paths to the given config file.\n     * This also takes the 'env' property into account.\n     *\n     * @param string  $file    Filename or absolute file path\n     * @param boolean $use_env Return -$env file path if exists\n     *\n     * @return array List of candidates in config dir path(s)\n     */\n    public function resolve_paths($file, $use_env = true)\n    {\n        $files    = array();\n        $abs_path = rcube_utils::is_absolute_path($file);\n\n        foreach ($this->paths as $basepath) {\n            $realpath = $abs_path ? $file : realpath($basepath . '/' . $file);\n\n            // check if <file>-env.ini exists\n            if ($realpath && $use_env && !empty($this->env)) {\n                $envfile = preg_replace('/\\.(inc.php)$/', '-' . $this->env . '.\\\\1', $realpath);\n                if (is_file($envfile)) {\n                    $realpath = $envfile;\n                }\n            }\n\n            if ($realpath) {\n                $files[] = $realpath;\n\n                // no need to continue the loop if an absolute file path is given\n                if ($abs_path) {\n                    break;\n                }\n            }\n        }\n\n        return $files;\n    }\n\n    /**\n     * Getter for a specific config parameter\n     *\n     * @param  string $name Parameter name\n     * @param  mixed  $def  Default value if not set\n     *\n     * @return mixed  The requested config value\n     */\n    public function get($name, $def = null)\n    {\n        if (isset($this->prop[$name])) {\n            $result = $this->prop[$name];\n        }\n        else {\n            $result = $def;\n        }\n\n        $result = $this->getenv_default('ROUNDCUBE_' . strtoupper($name), $result);\n        $rcube  = rcube::get_instance();\n\n        if ($name == 'timezone') {\n            if (empty($result) || $result == 'auto') {\n                $result = $this->client_timezone();\n            }\n        }\n        else if ($name == 'client_mimetypes') {\n            if (!$result && !$def) {\n                $result = 'text/plain,text/html,text/xml'\n                    . ',image/jpeg,image/gif,image/png,image/bmp,image/tiff,image/webp'\n                    . ',application/x-javascript,application/pdf,application/x-shockwave-flash';\n            }\n            if ($result && is_string($result)) {\n                $result = explode(',', $result);\n            }\n        }\n\n        $plugin = $rcube->plugins->exec_hook('config_get', array(\n            'name' => $name, 'default' => $def, 'result' => $result));\n\n        return $plugin['result'];\n    }\n\n    /**\n     * Setter for a config parameter\n     *\n     * @param string $name  Parameter name\n     * @param mixed  $value Parameter value\n     */\n    public function set($name, $value)\n    {\n        $this->prop[$name] = $value;\n    }\n\n    /**\n     * Override config options with the given values (eg. user prefs)\n     *\n     * @param array $prefs Hash array with config props to merge over\n     */\n    public function merge($prefs)\n    {\n        $prefs = $this->fix_legacy_props($prefs);\n        $this->prop = array_merge($this->prop, $prefs, $this->userprefs);\n    }\n\n    /**\n     * Merge the given prefs over the current config\n     * and make sure that they survive further merging.\n     *\n     * @param array $prefs Hash array with user prefs\n     */\n    public function set_user_prefs($prefs)\n    {\n        $prefs = $this->fix_legacy_props($prefs);\n\n        // Honor the dont_override setting for any existing user preferences\n        $dont_override = $this->get('dont_override');\n        if (is_array($dont_override) && !empty($dont_override)) {\n            foreach ($dont_override as $key) {\n                unset($prefs[$key]);\n            }\n        }\n\n        // larry is the new default skin :-)\n        if ($prefs['skin'] == 'default') {\n            $prefs['skin'] = self::DEFAULT_SKIN;\n        }\n\n        $this->userprefs = $prefs;\n        $this->prop      = array_merge($this->prop, $prefs);\n    }\n\n    /**\n     * Getter for all config options\n     *\n     * @return array Hash array containing all config properties\n     */\n    public function all()\n    {\n        $props = $this->prop;\n\n        foreach ($props as $prop_name => $prop_value) {\n            $props[$prop_name] = $this->getenv_default('ROUNDCUBE_' . strtoupper($prop_name), $prop_value);\n        }\n\n        $rcube  = rcube::get_instance();\n        $plugin = $rcube->plugins->exec_hook('config_get', array(\n            'name' => '*', 'result' => $props));\n\n        return $plugin['result'];\n    }\n\n    /**\n     * Special getter for user's timezone offset including DST\n     *\n     * @return float Timezone offset (in hours)\n     * @deprecated\n     */\n    public function get_timezone()\n    {\n        if ($tz = $this->get('timezone')) {\n            try {\n                $tz = new DateTimeZone($tz);\n                return $tz->getOffset(new DateTime('now')) / 3600;\n            }\n            catch (Exception $e) {\n            }\n        }\n\n        return 0;\n    }\n\n    /**\n     * Return requested DES crypto key.\n     *\n     * @param string $key Crypto key name\n     *\n     * @return string Crypto key\n     */\n    public function get_crypto_key($key)\n    {\n        // Bomb out if the requested key does not exist\n        if (!array_key_exists($key, $this->prop) || empty($this->prop[$key])) {\n            rcube::raise_error(array(\n                'code' => 500, 'type' => 'php',\n                'file' => __FILE__, 'line' => __LINE__,\n                'message' => \"Request for unconfigured crypto key \\\"$key\\\"\"\n            ), true, true);\n        }\n\n        return $this->prop[$key];\n    }\n\n    /**\n     * Return configured crypto method.\n     *\n     * @return string Crypto method\n     */\n    public function get_crypto_method()\n    {\n        return $this->get('cipher_method') ?: 'DES-EDE3-CBC';\n    }\n\n    /**\n     * Try to autodetect operating system and find the correct line endings\n     *\n     * @return string The appropriate mail header delimiter\n     * @deprecated Since 1.3 we don't use mail()\n     */\n    public function header_delimiter()\n    {\n        // use the configured delimiter for headers\n        if (!empty($this->prop['mail_header_delimiter'])) {\n            $delim = $this->prop['mail_header_delimiter'];\n            if ($delim == \"\\n\" || $delim == \"\\r\\n\") {\n                return $delim;\n            }\n            else {\n                rcube::raise_error(array(\n                    'code' => 500, 'type' => 'php',\n                    'file' => __FILE__, 'line' => __LINE__,\n                    'message' => \"Invalid mail_header_delimiter setting\"\n                ), true, false);\n            }\n        }\n\n        $php_os = strtolower(substr(PHP_OS, 0, 3));\n\n        if ($php_os == 'win')\n            return \"\\r\\n\";\n\n        if ($php_os == 'mac')\n            return \"\\r\\n\";\n\n        return \"\\n\";\n    }\n\n    /**\n     * Return the mail domain configured for the given host\n     *\n     * @param string  $host   IMAP host\n     * @param boolean $encode If true, domain name will be converted to IDN ASCII\n     *\n     * @return string Resolved SMTP host\n     */\n    public function mail_domain($host, $encode=true)\n    {\n        $domain = $host;\n\n        if (is_array($this->prop['mail_domain'])) {\n            if (isset($this->prop['mail_domain'][$host])) {\n                $domain = $this->prop['mail_domain'][$host];\n            }\n        }\n        else if (!empty($this->prop['mail_domain'])) {\n            $domain = rcube_utils::parse_host($this->prop['mail_domain']);\n        }\n\n        if ($encode) {\n            $domain = rcube_utils::idn_to_ascii($domain);\n        }\n\n        return $domain;\n    }\n\n    /**\n     * Getter for error state\n     *\n     * @return mixed Error message on error, False if no errors\n     */\n    public function get_error()\n    {\n        return empty($this->errors) ? false : join(\"\\n\", $this->errors);\n    }\n\n    /**\n     * Internal getter for client's (browser) timezone identifier\n     */\n    private function client_timezone()\n    {\n        // @TODO: remove this legacy timezone handling in the future\n        $props = $this->fix_legacy_props(array('timezone' => $_SESSION['timezone']));\n\n        if (!empty($props['timezone'])) {\n            try {\n                $tz = new DateTimeZone($props['timezone']);\n                return $tz->getName();\n            }\n            catch (Exception $e) { /* gracefully ignore */ }\n        }\n\n        // fallback to server's timezone\n        return date_default_timezone_get();\n    }\n\n    /**\n     * Convert legacy options into new ones\n     *\n     * @param array $props Hash array with config props\n     *\n     * @return array Converted config props\n     */\n    private function fix_legacy_props($props)\n    {\n        foreach ($this->legacy_props as $new => $old) {\n            if (isset($props[$old])) {\n                if (!isset($props[$new])) {\n                    $props[$new] = $props[$old];\n                }\n                unset($props[$old]);\n            }\n        }\n\n        // convert deprecated numeric timezone value\n        if (isset($props['timezone']) && is_numeric($props['timezone'])) {\n            if ($tz = self::timezone_name_from_abbr($props['timezone'])) {\n                $props['timezone'] = $tz;\n            }\n            else {\n                unset($props['timezone']);\n            }\n        }\n\n        // translate old `preview_pane` settings to `layout`\n        if (isset($props['preview_pane']) && !isset($props['layout'])) {\n            $props['layout'] = $props['preview_pane'] ? 'desktop' : 'list';\n            unset($props['preview_pane']);\n        }\n\n        return $props;\n    }\n\n    /**\n     * timezone_name_from_abbr() replacement. Converts timezone offset\n     * into timezone name abbreviation.\n     *\n     * @param float $offset Timezone offset (in hours)\n     *\n     * @return string Timezone abbreviation\n     */\n    static public function timezone_name_from_abbr($offset)\n    {\n        // List of timezones here is not complete - https://bugs.php.net/bug.php?id=44780\n        if ($tz = timezone_name_from_abbr('', $offset * 3600, 0)) {\n            return $tz;\n        }\n\n        // try with more complete list (#1489261)\n        $timezones = array(\n            '-660' => \"Pacific/Apia\",\n            '-600' => \"Pacific/Honolulu\",\n            '-570' => \"Pacific/Marquesas\",\n            '-540' => \"America/Anchorage\",\n            '-480' => \"America/Los_Angeles\",\n            '-420' => \"America/Denver\",\n            '-360' => \"America/Chicago\",\n            '-300' => \"America/New_York\",\n            '-270' => \"America/Caracas\",\n            '-240' => \"America/Halifax\",\n            '-210' => \"Canada/Newfoundland\",\n            '-180' => \"America/Sao_Paulo\",\n             '-60' => \"Atlantic/Azores\",\n               '0' => \"Europe/London\",\n              '60' => \"Europe/Paris\",\n             '120' => \"Europe/Helsinki\",\n             '180' => \"Europe/Moscow\",\n             '210' => \"Asia/Tehran\",\n             '240' => \"Asia/Dubai\",\n             '270' => \"Asia/Kabul\",\n             '300' => \"Asia/Karachi\",\n             '330' => \"Asia/Kolkata\",\n             '345' => \"Asia/Katmandu\",\n             '360' => \"Asia/Yekaterinburg\",\n             '390' => \"Asia/Rangoon\",\n             '420' => \"Asia/Krasnoyarsk\",\n             '480' => \"Asia/Shanghai\",\n             '525' => \"Australia/Eucla\",\n             '540' => \"Asia/Tokyo\",\n             '570' => \"Australia/Adelaide\",\n             '600' => \"Australia/Melbourne\",\n             '630' => \"Australia/Lord_Howe\",\n             '660' => \"Asia/Vladivostok\",\n             '690' => \"Pacific/Norfolk\",\n             '720' => \"Pacific/Auckland\",\n             '765' => \"Pacific/Chatham\",\n             '780' => \"Pacific/Enderbury\",\n             '840' => \"Pacific/Kiritimati\",\n        );\n\n        return $timezones[(string) intval($offset * 60)];\n    }\n}\n", "<?php\n\n/**\n +-----------------------------------------------------------------------+\n | program/steps/mail/func.inc                                           |\n |                                                                       |\n | This file is part of the Roundcube Webmail client                     |\n | Copyright (C) 2005-2014, The Roundcube Dev Team                       |\n |                                                                       |\n | Licensed under the GNU General Public License version 3 or            |\n | any later version with exceptions for skins & plugins.                |\n | See the README file for a full license statement.                     |\n |                                                                       |\n | PURPOSE:                                                              |\n |   Provide webmail functionality and GUI objects                       |\n |                                                                       |\n +-----------------------------------------------------------------------+\n | Author: Thomas Bruederli <roundcube@gmail.com>                        |\n | Author: Aleksander Machniak <alec@alec.pl>                            |\n +-----------------------------------------------------------------------+\n*/\n\n// always instantiate storage object (but not connect to server yet)\n$RCMAIL->storage_init();\n\n// init environment - set current folder, page, list mode\nrcmail_init_env();\n\n// set message set for search result\nif (!empty($_REQUEST['_search']) && isset($_SESSION['search'])\n    && $_SESSION['search_request'] == $_REQUEST['_search']\n) {\n    $RCMAIL->storage->set_search_set($_SESSION['search']);\n\n    $OUTPUT->set_env('search_request', $_REQUEST['_search']);\n    $OUTPUT->set_env('search_text', $_SESSION['last_text_search']);\n}\n\n// remove mbox part from _uid\nif (($_uid  = rcube_utils::get_input_value('_uid', rcube_utils::INPUT_GPC)) && !is_array($_uid) && preg_match('/^\\d+-.+/', $_uid)) {\n  list($_uid, $mbox) = explode('-', $_uid, 2);\n  if (isset($_GET['_uid']))  $_GET['_uid']  = $_uid;\n  if (isset($_POST['_uid'])) $_POST['_uid'] = $_uid;\n  $_REQUEST['_uid'] = $_uid;\n  unset($_uid);\n\n  // override mbox\n  if (!empty($mbox)) {\n    $_GET['_mbox']  = $mbox;\n    $_POST['_mbox'] = $mbox;\n    $RCMAIL->storage->set_folder(($_SESSION['mbox'] = $mbox));\n  }\n}\n\nif (!empty($_SESSION['browser_caps']) && !$OUTPUT->ajax_call) {\n    $OUTPUT->set_env('browser_capabilities', $_SESSION['browser_caps']);\n}\n\n// set main env variables, labels and page title\nif (empty($RCMAIL->action) || $RCMAIL->action == 'list') {\n    // connect to storage server and trigger error on failure\n    $RCMAIL->storage_connect();\n\n    $mbox_name = $RCMAIL->storage->get_folder();\n\n    if (empty($RCMAIL->action)) {\n        $OUTPUT->set_env('search_mods', rcmail_search_mods());\n\n        if (!empty($_SESSION['search_scope']))\n            $OUTPUT->set_env('search_scope', $_SESSION['search_scope']);\n\n        rcmail_list_pagetitle();\n    }\n\n    $threading = (bool) $RCMAIL->storage->get_threading();\n    $delimiter = $RCMAIL->storage->get_hierarchy_delimiter();\n\n    // set current mailbox and some other vars in client environment\n    $OUTPUT->set_env('mailbox', $mbox_name);\n    $OUTPUT->set_env('pagesize', $RCMAIL->storage->get_pagesize());\n    $OUTPUT->set_env('current_page', max(1, $_SESSION['page']));\n    $OUTPUT->set_env('delimiter', $delimiter);\n    $OUTPUT->set_env('threading', $threading);\n    $OUTPUT->set_env('threads', $threading || $RCMAIL->storage->get_capability('THREAD'));\n    $OUTPUT->set_env('reply_all_mode', (int) $RCMAIL->config->get('reply_all_mode'));\n    $OUTPUT->set_env('layout', $RCMAIL->config->get('layout') ?: 'widescreen');\n\n    if ($RCMAIL->storage->get_capability('QUOTA')) {\n        $OUTPUT->set_env('quota', true);\n    }\n\n    // set special folders\n    foreach (array('drafts', 'trash', 'junk') as $mbox) {\n        if ($folder = $RCMAIL->config->get($mbox . '_mbox')) {\n            $OUTPUT->set_env($mbox . '_mailbox', $folder);\n        }\n    }\n\n    if (!empty($_GET['_uid'])) {\n        $OUTPUT->set_env('list_uid', $_GET['_uid']);\n    }\n\n    // set configuration\n    $RCMAIL->set_env_config(array('delete_junk', 'flag_for_deletion', 'read_when_deleted',\n        'skip_deleted', 'display_next', 'message_extwin', 'forward_attachment'));\n\n    if (!$OUTPUT->ajax_call) {\n        $OUTPUT->add_label('checkingmail', 'deletemessage', 'movemessagetotrash',\n            'movingmessage', 'copyingmessage', 'deletingmessage', 'markingmessage',\n            'copy', 'move', 'quota', 'replyall', 'replylist', 'stillsearching',\n            'flagged', 'unflagged', 'unread', 'deleted', 'replied', 'forwarded',\n            'priority', 'withattachment', 'fileuploaderror', 'mark', 'markallread',\n            'folders-cur', 'folders-sub', 'folders-all', 'cancel');\n    }\n}\n\n// register UI objects\n$OUTPUT->add_handlers(array(\n    'mailboxlist'         => array($RCMAIL, 'folder_list'),\n    'quotadisplay'        => array($RCMAIL, 'quota_display'),\n    'messages'            => 'rcmail_message_list',\n    'messagecountdisplay' => 'rcmail_messagecount_display',\n    'listmenulink'        => 'rcmail_options_menu_link',\n    'mailboxname'         => 'rcmail_mailbox_name_display',\n    'messageheaders'      => 'rcmail_message_headers',\n    'messagefullheaders'  => 'rcmail_message_full_headers',\n    'messagebody'         => 'rcmail_message_body',\n    'messagecontentframe' => 'rcmail_messagecontent_frame',\n    'messageimportform'   => 'rcmail_message_import_form',\n    'searchfilter'        => 'rcmail_search_filter',\n    'searchinterval'      => 'rcmail_search_interval',\n    'searchform'          => array($OUTPUT, 'search_form'),\n));\n\n// register action aliases\n$RCMAIL->register_action_map(array(\n    'refresh' => 'check_recent.inc',\n    'preview' => 'show.inc',\n    'print'   => 'show.inc',\n    'move'    => 'move_del.inc',\n    'delete'  => 'move_del.inc',\n    'send'    => 'sendmail.inc',\n    'expunge' => 'folders.inc',\n    'purge'   => 'folders.inc',\n    'remove-attachment'  => 'attachments.inc',\n    'rename-attachment'  => 'attachments.inc',\n    'display-attachment' => 'attachments.inc',\n    'upload'             => 'attachments.inc',\n    'group-expand'       => 'autocomplete.inc',\n));\n\n\n/**\n * Sets storage properties and session\n */\nfunction rcmail_init_env()\n{\n    global $RCMAIL;\n\n    $default_threading  = $RCMAIL->config->get('default_list_mode', 'list') == 'threads';\n    $a_threading        = $RCMAIL->config->get('message_threading', array());\n    $message_sort_col   = $RCMAIL->config->get('message_sort_col');\n    $message_sort_order = $RCMAIL->config->get('message_sort_order');\n\n    // set imap properties and session vars\n    if (!strlen($mbox = rcube_utils::get_input_value('_mbox', rcube_utils::INPUT_GPC, true))) {\n        $mbox = strlen($_SESSION['mbox']) ? $_SESSION['mbox'] : 'INBOX';\n    }\n\n    // we handle 'page' argument on 'list' and 'getunread' to prevent from\n    // race condition and unintentional page overwrite in session\n    if ($RCMAIL->action == 'list' || $RCMAIL->action == 'getunread') {\n        if (!($page = intval($_GET['_page']))) {\n            $page = $_SESSION['page'] ?: 1;\n        }\n\n        $_SESSION['page'] = $page;\n    }\n\n    $RCMAIL->storage->set_folder($_SESSION['mbox'] = $mbox);\n    $RCMAIL->storage->set_page($_SESSION['page']);\n\n    // set default sort col/order to session\n    if (!isset($_SESSION['sort_col'])) {\n        $_SESSION['sort_col'] = $message_sort_col ?: '';\n    }\n    if (!isset($_SESSION['sort_order'])) {\n        $_SESSION['sort_order'] = strtoupper($message_sort_order) == 'ASC' ? 'ASC' : 'DESC';\n    }\n\n    // set threads mode\n    if (isset($_GET['_threads'])) {\n        if ($_GET['_threads']) {\n            // re-set current page number when listing mode changes\n            if (!$a_threading[$_SESSION['mbox']]) {\n                $RCMAIL->storage->set_page($_SESSION['page'] = 1);\n            }\n\n            $a_threading[$_SESSION['mbox']] = true;\n        }\n        else {\n            // re-set current page number when listing mode changes\n            if ($a_threading[$_SESSION['mbox']]) {\n                $RCMAIL->storage->set_page($_SESSION['page'] = 1);\n            }\n\n            $a_threading[$_SESSION['mbox']] = false;\n        }\n\n        $RCMAIL->user->save_prefs(array('message_threading' => $a_threading));\n    }\n\n    $threading = isset($a_threading[$_SESSION['mbox']]) ? $a_threading[$_SESSION['mbox']] : $default_threading;\n\n    $RCMAIL->storage->set_threading($threading);\n}\n\n/**\n * Sets page title\n */\nfunction rcmail_list_pagetitle()\n{\n    global $RCMAIL;\n\n    if ($RCMAIL->output->get_env('search_request')) {\n        $pagetitle = $RCMAIL->gettext('searchresult');\n    }\n    else {\n        $mbox_name = $RCMAIL->output->get_env('mailbox') ?: $RCMAIL->storage->get_folder();\n        $delimiter = $RCMAIL->storage->get_hierarchy_delimiter();\n        $pagetitle = $RCMAIL->localize_foldername($mbox_name, true);\n        $pagetitle = str_replace($delimiter, \" \\xC2\\xBB \", $pagetitle);\n    }\n\n    $RCMAIL->output->set_pagetitle($pagetitle);\n}\n\n/**\n * Returns default search mods\n */\nfunction rcmail_search_mods()\n{\n    global $RCMAIL;\n\n    $mods = $RCMAIL->config->get('search_mods');\n\n    if (empty($mods)) {\n        $mods = array('*' => array('subject' => 1, 'from' => 1));\n\n        foreach (array('sent', 'drafts') as $mbox) {\n            if ($mbox = $RCMAIL->config->get($mbox . '_mbox')) {\n                $mods[$mbox] = array('subject' => 1, 'to' => 1);\n            }\n        }\n    }\n\n    return $mods;\n}\n\n/**\n * Returns 'to' if current folder is configured Sent or Drafts\n * or their subfolders, otherwise returns 'from'.\n *\n * @return string Column name\n */\nfunction rcmail_message_list_smart_column_name()\n{\n    global $RCMAIL;\n\n    $delim       = $RCMAIL->storage->get_hierarchy_delimiter();\n    $mbox        = $RCMAIL->output->get_env('mailbox') ?: $RCMAIL->storage->get_folder();\n    $sent_mbox   = $RCMAIL->config->get('sent_mbox');\n    $drafts_mbox = $RCMAIL->config->get('drafts_mbox');\n\n    if ((strpos($mbox.$delim, $sent_mbox.$delim) === 0 || strpos($mbox.$delim, $drafts_mbox.$delim) === 0)\n        && strtoupper($mbox) != 'INBOX'\n    ) {\n        return 'to';\n    }\n\n    return 'from';\n}\n\n/**\n * Returns configured messages list sorting column name\n * The name is context-sensitive, which means if sorting is set to 'fromto'\n * it will return 'from' or 'to' according to current folder type.\n *\n * @return string Column name\n */\nfunction rcmail_sort_column()\n{\n    global $RCMAIL;\n\n    if (isset($_SESSION['sort_col'])) {\n        $column = $_SESSION['sort_col'];\n    }\n    else {\n        $column = $RCMAIL->config->get('message_sort_col');\n    }\n\n    // get name of smart From/To column in folder context\n    if ($column == 'fromto') {\n        $column = rcmail_message_list_smart_column_name();\n    }\n\n    return $column;\n}\n\n/**\n * Returns configured message list sorting order\n *\n * @return string Sorting order (ASC|DESC)\n */\nfunction rcmail_sort_order()\n{\n    global $RCMAIL;\n\n    if (isset($_SESSION['sort_order'])) {\n        return $_SESSION['sort_order'];\n    }\n\n    return $RCMAIL->config->get('message_sort_order');\n}\n\n/**\n * return the message list as HTML table\n */\nfunction rcmail_message_list($attrib)\n{\n    global $RCMAIL, $OUTPUT;\n\n    // add some labels to client\n    $OUTPUT->add_label('from', 'to');\n\n    // add id to message list table if not specified\n    if (!strlen($attrib['id'])) {\n        $attrib['id'] = 'rcubemessagelist';\n    }\n\n    // define list of cols to be displayed based on parameter or config\n    if (empty($attrib['columns'])) {\n        $list_cols   = $RCMAIL->config->get('list_cols');\n        $a_show_cols = !empty($list_cols) && is_array($list_cols) ? $list_cols : array('subject');\n\n        $OUTPUT->set_env('col_movable', !in_array('list_cols', (array)$RCMAIL->config->get('dont_override')));\n    }\n    else {\n        $a_show_cols = preg_split('/[\\s,;]+/', str_replace(array(\"'\", '\"'), '', $attrib['columns']));\n        $attrib['columns'] = $a_show_cols;\n    }\n\n    // save some variables for use in ajax list\n    $_SESSION['list_attrib'] = $attrib;\n\n    // make sure 'threads' and 'subject' columns are present\n    if (!in_array('subject', $a_show_cols))\n        array_unshift($a_show_cols, 'subject');\n    if (!in_array('threads', $a_show_cols))\n        array_unshift($a_show_cols, 'threads');\n\n    $listcols = $a_show_cols;\n\n    // Widescreen layout uses hardcoded list of columns\n    if ($RCMAIL->config->get('layout', 'widescreen') == 'widescreen') {\n        $a_show_cols = array('threads', 'subject', 'fromto', 'date', 'flag', 'attachment');\n        $listcols    = $a_show_cols;\n        array_shift($listcols);\n    }\n\n    // set client env\n    $OUTPUT->add_gui_object('messagelist', $attrib['id']);\n    $OUTPUT->set_env('autoexpand_threads', intval($RCMAIL->config->get('autoexpand_threads')));\n    $OUTPUT->set_env('sort_col', $_SESSION['sort_col']);\n    $OUTPUT->set_env('sort_order', $_SESSION['sort_order']);\n    $OUTPUT->set_env('messages', array());\n    $OUTPUT->set_env('listcols', $listcols);\n\n    $OUTPUT->include_script('list.js');\n\n    $table = new html_table($attrib);\n\n    if (!$attrib['noheader']) {\n        foreach (rcmail_message_list_head($attrib, $a_show_cols) as $cell)\n            $table->add_header(array('class' => $cell['className'], 'id' => $cell['id']), $cell['html']);\n    }\n\n    return $table->show();\n}\n\n/**\n * return javascript commands to add rows to the message list\n */\nfunction rcmail_js_message_list($a_headers, $insert_top=false, $a_show_cols=null)\n{\n    global $RCMAIL, $OUTPUT;\n\n    if (empty($a_show_cols)) {\n        if (!empty($_SESSION['list_attrib']['columns']))\n            $a_show_cols = $_SESSION['list_attrib']['columns'];\n        else {\n            $list_cols   = $RCMAIL->config->get('list_cols');\n            $a_show_cols = !empty($list_cols) && is_array($list_cols) ? $list_cols : array('subject');\n        }\n    }\n    else {\n        if (!is_array($a_show_cols)) {\n            $a_show_cols = preg_split('/[\\s,;]+/', str_replace(array(\"'\", '\"'), '', $a_show_cols));\n        }\n        $head_replace = true;\n    }\n\n    $delimiter   = $RCMAIL->storage->get_hierarchy_delimiter();\n    $search_set  = $RCMAIL->storage->get_search_set();\n    $multifolder = $search_set && $search_set[1]->multi;\n\n    // add/remove 'folder' column to the list on multi-folder searches\n    if ($multifolder && !in_array('folder', $a_show_cols)) {\n        $a_show_cols[] = 'folder';\n        $head_replace = true;\n    }\n    else if (!$multifolder && ($found = array_search('folder', $a_show_cols)) !== false) {\n        unset($a_show_cols[$found]);\n        $head_replace = true;\n    }\n\n    $mbox = $RCMAIL->output->get_env('mailbox') ?: $RCMAIL->storage->get_folder();\n\n    // make sure 'threads' and 'subject' columns are present\n    if (!in_array('subject', $a_show_cols))\n        array_unshift($a_show_cols, 'subject');\n    if (!in_array('threads', $a_show_cols))\n        array_unshift($a_show_cols, 'threads');\n\n    // Make sure there are no duplicated columns (#1486999)\n    $a_show_cols = array_unique($a_show_cols);\n    $_SESSION['list_attrib']['columns'] = $a_show_cols;\n\n    // Widescreen layout uses hardcoded list of columns\n    if ($RCMAIL->config->get('layout', 'widescreen') == 'widescreen') {\n        $a_show_cols = array('threads', 'subject', 'fromto', 'date', 'flag', 'attachment');\n    }\n\n    // Plugins may set header's list_cols/list_flags and other rcube_message_header variables\n    // and list columns\n    $plugin = $RCMAIL->plugins->exec_hook('messages_list',\n        array('messages' => $a_headers, 'cols' => $a_show_cols));\n\n    $a_show_cols = $plugin['cols'];\n    $a_headers   = $plugin['messages'];\n\n    if ($RCMAIL->config->get('layout', 'widescreen') == 'widescreen') {\n        if (!$RCMAIL->storage->get_threading()) {\n            if (($idx = array_search('threads', $a_show_cols)) !== false) {\n                unset($a_show_cols[$idx]);\n            }\n        }\n    }\n\n    $thead = $head_replace ? rcmail_message_list_head($_SESSION['list_attrib'], $a_show_cols) : NULL;\n\n    // get name of smart From/To column in folder context\n    if (array_search('fromto', $a_show_cols) !== false) {\n        $smart_col = rcmail_message_list_smart_column_name();\n    }\n\n    $OUTPUT->command('set_message_coltypes', array_values($a_show_cols), $thead, $smart_col);\n\n    if ($multifolder && $_SESSION['search_scope'] == 'all') {\n        $OUTPUT->command('select_folder', '');\n    }\n\n    $OUTPUT->set_env('multifolder_listing', $multifolder);\n\n    if (empty($a_headers)) {\n        return;\n    }\n\n    // remove 'threads', 'attachment', 'flag', 'status' columns, we don't need them here\n    foreach (array('threads', 'attachment', 'flag', 'status', 'priority') as $col) {\n        if (($key = array_search($col, $a_show_cols)) !== FALSE) {\n            unset($a_show_cols[$key]);\n        }\n    }\n\n    $sort_col = $_SESSION['sort_col'];\n\n    // loop through message headers\n    foreach ($a_headers as $header) {\n        if (empty($header) || !$header->size) {\n            continue;\n        }\n\n        // make message UIDs unique by appending the folder name\n        if ($multifolder) {\n            $header->uid .= '-'.$header->folder;\n            $header->flags['skip_mbox_check'] = true;\n            if ($header->parent_uid)\n                $header->parent_uid .= '-'.$header->folder;\n        }\n\n        $a_msg_cols  = array();\n        $a_msg_flags = array();\n\n        // format each col; similar as in rcmail_message_list()\n        foreach ($a_show_cols as $col) {\n            $col_name = $col == 'fromto' ? $smart_col : $col;\n\n            if (in_array($col_name, array('from', 'to', 'cc', 'replyto'))) {\n                $cont = rcmail_address_string($header->$col_name, 3, false, null, $header->charset);\n                if (empty($cont)) $cont = '&nbsp;'; // for widescreen mode\n            }\n            else if ($col == 'subject') {\n                $cont = trim(rcube_mime::decode_header($header->$col, $header->charset));\n                if (!$cont) $cont = $RCMAIL->gettext('nosubject');\n                $cont = rcube::Q($cont);\n            }\n            else if ($col == 'size')\n                $cont = $RCMAIL->show_bytes($header->$col);\n            else if ($col == 'date')\n                $cont = $RCMAIL->format_date($sort_col == 'arrival' ? $header->internaldate : $header->date);\n            else if ($col == 'folder') {\n                if ($last_folder !== $header->folder) {\n                    $last_folder      = $header->folder;\n                    $last_folder_name = $RCMAIL->localize_foldername($last_folder, true);\n                    $last_folder_name = str_replace($delimiter, \" \\xC2\\xBB \", $last_folder_name);\n                }\n\n                $cont = rcube::Q($last_folder_name);\n            }\n            else\n                $cont = rcube::Q($header->$col);\n\n            $a_msg_cols[$col] = $cont;\n        }\n\n        $a_msg_flags = array_change_key_case(array_map('intval', (array) $header->flags));\n        if ($header->depth)\n            $a_msg_flags['depth'] = $header->depth;\n        else if ($header->has_children)\n            $roots[] = $header->uid;\n        if ($header->parent_uid)\n            $a_msg_flags['parent_uid'] = $header->parent_uid;\n        if ($header->has_children)\n            $a_msg_flags['has_children'] = $header->has_children;\n        if ($header->unread_children)\n            $a_msg_flags['unread_children'] = $header->unread_children;\n        if ($header->flagged_children)\n            $a_msg_flags['flagged_children'] = $header->flagged_children;\n        if ($header->others['list-post'])\n            $a_msg_flags['ml'] = 1;\n        if ($header->priority)\n            $a_msg_flags['prio'] = (int) $header->priority;\n\n        $a_msg_flags['ctype'] = rcube::Q($header->ctype);\n        $a_msg_flags['mbox']  = $header->folder;\n\n        // merge with plugin result (Deprecated, use $header->flags)\n        if (!empty($header->list_flags) && is_array($header->list_flags))\n            $a_msg_flags = array_merge($a_msg_flags, $header->list_flags);\n        if (!empty($header->list_cols) && is_array($header->list_cols))\n            $a_msg_cols = array_merge($a_msg_cols, $header->list_cols);\n\n        $OUTPUT->command('add_message_row', $header->uid, $a_msg_cols, $a_msg_flags, $insert_top);\n    }\n\n    if ($RCMAIL->storage->get_threading()) {\n        $OUTPUT->command('init_threads', (array) $roots, $mbox);\n    }\n}\n\n/*\n * Creates <THEAD> for message list table\n */\nfunction rcmail_message_list_head($attrib, $a_show_cols)\n{\n    global $RCMAIL;\n\n    // check to see if we have some settings for sorting\n    $sort_col   = $_SESSION['sort_col'];\n    $sort_order = $_SESSION['sort_order'];\n\n    $dont_override  = (array) $RCMAIL->config->get('dont_override');\n    $disabled_sort  = in_array('message_sort_col', $dont_override);\n    $disabled_order = in_array('message_sort_order', $dont_override);\n\n    $RCMAIL->output->set_env('disabled_sort_col', $disabled_sort);\n    $RCMAIL->output->set_env('disabled_sort_order', $disabled_order);\n\n    // define sortable columns\n    if ($disabled_sort)\n        $a_sort_cols = $sort_col && !$disabled_order ? array($sort_col) : array();\n    else\n        $a_sort_cols = array('subject', 'date', 'from', 'to', 'fromto', 'size', 'cc');\n\n    if (!empty($attrib['optionsmenuicon'])) {\n        $list_menu = rcmail_options_menu_link($attrib);\n    }\n\n    $cells = $coltypes = array();\n\n    // get name of smart From/To column in folder context\n    if (array_search('fromto', $a_show_cols) !== false) {\n        $smart_col = rcmail_message_list_smart_column_name();\n    }\n\n    foreach ($a_show_cols as $col) {\n        $label    = '';\n        $sortable = false;\n        $rel_col  = $col == 'date' && $sort_col == 'arrival' ? 'arrival' : $col;\n\n        // get column name\n        switch ($col) {\n        case 'flag':\n            $col_name = html::span('flagged', $RCMAIL->gettext('flagged'));\n            break;\n        case 'attachment':\n        case 'priority':\n            $col_name = html::span($col, $RCMAIL->gettext($col));\n            break;\n        case 'status':\n            $col_name = html::span($col, $RCMAIL->gettext('readstatus'));\n            break;\n        case 'threads':\n            $col_name = (string) $list_menu;\n            break;\n        case 'fromto':\n            $label    = $RCMAIL->gettext($smart_col);\n            $col_name = rcube::Q($label);\n            break;\n        default:\n            $label    = $RCMAIL->gettext($col);\n            $col_name = rcube::Q($label);\n        }\n\n        // make sort links\n        if (in_array($col, $a_sort_cols)) {\n            $sortable = true;\n            $col_name = html::a(array(\n                    'href'  => \"./#sort\",\n                    'class' => 'sortcol',\n                    'rel'   => $rel_col,\n                    'title' => $RCMAIL->gettext('sortby')\n                ), $col_name);\n        }\n        else if ($col_name[0] != '<') {\n            $col_name = '<span class=\"' . $col .'\">' . $col_name . '</span>';\n        }\n\n        $sort_class = $rel_col == $sort_col && !$disabled_order ? \" sorted$sort_order\" : '';\n        $class_name = $col.$sort_class;\n\n        // put it all together\n        $cells[] = array('className' => $class_name, 'id' => \"rcm$col\", 'html' => $col_name);\n        $coltypes[$col] = array('className' => $class_name, 'id' => \"rcm$col\", 'label' => $label, 'sortable' => $sortable);\n    }\n\n    $RCMAIL->output->set_env('coltypes', $coltypes);\n    return $cells;\n}\n\nfunction rcmail_options_menu_link($attrib)\n{\n    global $RCMAIL;\n\n    $onclick = 'return ' . rcmail_output::JS_OBJECT_NAME . \".command('menu-open', 'messagelistmenu', this, event)\";\n    $inner   = $title = $RCMAIL->gettext('listoptions');\n\n    if (is_string($attrib['optionsmenuicon']) && $attrib['optionsmenuicon'] != 'true') {\n        $inner = html::img(array('src' => $RCMAIL->output->abs_url($attrib['optionsmenuicon'], true), 'alt' => $title));\n    }\n\n    return html::a(array(\n            'href'     => '#list-options',\n            'onclick'  => $onclick,\n            'class'    => 'listmenu',\n            'id'       => 'listmenulink',\n            'title'    => $title,\n            'tabindex' => '0',\n    ), $inner);\n}\n\n/**\n * Return an HTML iframe for loading mail content\n */\nfunction rcmail_messagecontent_frame($attrib)\n{\n    global $OUTPUT;\n\n    if (empty($attrib['id'])) {\n        $attrib['id'] = 'rcmailcontentwindow';\n    }\n\n    return $OUTPUT->frame($attrib, true);\n}\n\nfunction rcmail_messagecount_display($attrib)\n{\n    global $RCMAIL;\n\n    if (!$attrib['id']) {\n        $attrib['id'] = 'rcmcountdisplay';\n    }\n\n    $RCMAIL->output->add_gui_object('countdisplay', $attrib['id']);\n\n    $content =  $RCMAIL->action != 'show' ? rcmail_get_messagecount_text() : $RCMAIL->gettext('loading');\n\n    return html::span($attrib, $content);\n}\n\nfunction rcmail_get_messagecount_text($count = null, $page = null)\n{\n    global $RCMAIL;\n\n    if ($page === null) {\n        $page = $RCMAIL->storage->get_page();\n    }\n\n    $page_size = $RCMAIL->storage->get_pagesize();\n    $start_msg = ($page-1) * $page_size + 1;\n    $max       = $count;\n\n    if ($max === null && $RCMAIL->action) {\n        $max = $RCMAIL->storage->count(null, $RCMAIL->storage->get_threading() ? 'THREADS' : 'ALL');\n    }\n\n    if (!$max) {\n        $out = $RCMAIL->storage->get_search_set() ? $RCMAIL->gettext('nomessages') : $RCMAIL->gettext('mailboxempty');\n    }\n    else {\n        $out = $RCMAIL->gettext(array('name' => $RCMAIL->storage->get_threading() ? 'threadsfromto' : 'messagesfromto',\n            'vars' => array('from'  => $start_msg,\n            'to'    => min($max, $start_msg + $page_size - 1),\n            'count' => $max)));\n    }\n\n    return rcube::Q($out);\n}\n\nfunction rcmail_mailbox_name_display($attrib)\n{\n    global $RCMAIL;\n\n    if (!$attrib['id']) {\n        $attrib['id'] = 'rcmmailboxname';\n    }\n\n    $RCMAIL->output->add_gui_object('mailboxname', $attrib['id']);\n\n    return html::span($attrib, rcmail_get_mailbox_name_text());\n}\n\nfunction rcmail_get_mailbox_name_text()\n{\n    global $RCMAIL;\n    return $RCMAIL->localize_foldername($RCMAIL->output->get_env('mailbox') ?: $RCMAIL->storage->get_folder());\n}\n\nfunction rcmail_send_unread_count($mbox_name, $force=false, $count=null, $mark='')\n{\n    global $RCMAIL;\n\n    $old_unseen = rcmail_get_unseen_count($mbox_name);\n    $unseen     = $count;\n\n    if ($unseen === null) {\n        $unseen = $RCMAIL->storage->count($mbox_name, 'UNSEEN', $force);\n    }\n\n    if ($unseen !== $old_unseen || ($mbox_name == 'INBOX')) {\n        $RCMAIL->output->command('set_unread_count', $mbox_name, $unseen,\n            ($mbox_name == 'INBOX'), $unseen && $mark ? $mark : '');\n    }\n\n    rcmail_set_unseen_count($mbox_name, $unseen);\n\n    return $unseen;\n}\n\nfunction rcmail_set_unseen_count($mbox_name, $count)\n{\n    // @TODO: this data is doubled (session and cache tables) if caching is enabled\n\n    // Make sure we have an array here (#1487066)\n    if (!is_array($_SESSION['unseen_count'])) {\n        $_SESSION['unseen_count'] = array();\n    }\n\n    $_SESSION['unseen_count'][$mbox_name] = $count;\n}\n\nfunction rcmail_get_unseen_count($mbox_name)\n{\n    if (is_array($_SESSION['unseen_count']) && array_key_exists($mbox_name, $_SESSION['unseen_count'])) {\n        return $_SESSION['unseen_count'][$mbox_name];\n    }\n}\n\n/**\n * Sets message is_safe flag according to 'show_images' option value\n *\n * @param object rcube_message Message\n */\nfunction rcmail_check_safe($message)\n{\n    global $RCMAIL;\n\n    if (!$message->is_safe\n        && ($show_images = $RCMAIL->config->get('show_images'))\n        && $message->has_html_part()\n    ) {\n        switch ($show_images) {\n        case 1: // known senders only\n            // get default addressbook, like in addcontact.inc\n            $CONTACTS = $RCMAIL->get_address_book(-1, true);\n\n            if ($CONTACTS && $message->sender['mailto']) {\n                $result = $CONTACTS->search('email', $message->sender['mailto'], 1, false);\n                if ($result->count) {\n                    $message->set_safe(true);\n                }\n            }\n\n            $RCMAIL->plugins->exec_hook('message_check_safe', array('message' => $message));\n            break;\n\n        case 2: // always\n            $message->set_safe(true);\n            break;\n        }\n    }\n\n    return !empty($message->is_safe);\n}\n\n/**\n * Cleans up the given message HTML Body (for displaying)\n *\n * @param string HTML\n * @param array  Display parameters \n * @param array  CID map replaces (inline images)\n * @return string Clean HTML\n */\nfunction rcmail_wash_html($html, $p, $cid_replaces = array())\n{\n    global $REMOTE_OBJECTS;\n\n    $p += array('safe' => false, 'inline_html' => true);\n\n    // charset was converted to UTF-8 in rcube_storage::get_message_part(),\n    // change/add charset specification in HTML accordingly,\n    // washtml cannot work without that\n    $meta = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset='.RCUBE_CHARSET.'\" />';\n\n    // remove old meta tag and add the new one, making sure\n    // that it is placed in the head (#1488093)\n    $html = preg_replace('/<meta[^>]+charset=[a-z0-9-_]+[^>]*>/Ui', '', $html);\n    $html = preg_replace('/(<head[^>]*>)/Ui', '\\\\1'.$meta, $html, -1, $rcount);\n    if (!$rcount) {\n        $html = '<head>' . $meta . '</head>' . $html;\n    }\n\n    // clean HTML with washhtml by Frederic Motte\n    $wash_opts = array(\n        'show_washed'   => false,\n        'allow_remote'  => $p['safe'],\n        'blocked_src'   => 'program/resources/blocked.gif',\n        'charset'       => RCUBE_CHARSET,\n        'cid_map'       => $cid_replaces,\n        'html_elements' => array('body'),\n    );\n\n    if (!$p['inline_html']) {\n        $wash_opts['html_elements'] = array('html','head','title','body');\n    }\n    if ($p['safe']) {\n        $wash_opts['html_elements'][] = 'link';\n        $wash_opts['html_attribs'] = array('rel','type');\n    }\n\n    // overwrite washer options with options from plugins\n    if (isset($p['html_elements']))\n        $wash_opts['html_elements'] = $p['html_elements'];\n    if (isset($p['html_attribs']))\n        $wash_opts['html_attribs'] = $p['html_attribs'];\n\n    // initialize HTML washer\n    $washer = new rcube_washtml($wash_opts);\n\n    if (!$p['skip_washer_form_callback']) {\n        $washer->add_callback('form', 'rcmail_washtml_callback');\n    }\n\n    // allow CSS styles, will be sanitized by rcmail_washtml_callback()\n    if (!$p['skip_washer_style_callback']) {\n        $washer->add_callback('style', 'rcmail_washtml_callback');\n    }\n\n    // modify HTML links to open a new window if clicked\n    if (!$p['skip_washer_link_callback']) {\n        $washer->add_callback('a', 'rcmail_washtml_link_callback');\n        $washer->add_callback('area', 'rcmail_washtml_link_callback');\n\n        if ($p['safe'])\n            $washer->add_callback('link', 'rcmail_washtml_link_callback');\n    }\n\n    // Remove non-UTF8 characters (#1487813)\n    $html = rcube_charset::clean($html);\n\n    $html = $washer->wash($html);\n    $REMOTE_OBJECTS = $washer->extlinks;\n\n    return $html;\n}\n\n/**\n * Convert the given message part to proper HTML\n * which can be displayed the message view\n *\n * @param string             Message part body\n * @param rcube_message_part Message part\n * @param array              Display parameters array\n *\n * @return string Formatted HTML string\n */\nfunction rcmail_print_body($body, $part, $p = array())\n{\n    global $RCMAIL;\n\n    // trigger plugin hook\n    $data = $RCMAIL->plugins->exec_hook('message_part_before',\n        array('type' => $part->ctype_secondary, 'body' => $body, 'id' => $part->mime_id)\n            + $p + array('safe' => false, 'plain' => false, 'inline_html' => true));\n\n    // convert html to text/plain\n    if ($data['plain'] && ($data['type'] == 'html' || $data['type'] == 'enriched')) {\n        if ($data['type'] == 'enriched') {\n            $data['body'] = rcube_enriched::to_html($data['body']);\n        }\n\n        $body = $RCMAIL->html2text($data['body']);\n        $part->ctype_secondary = 'plain';\n    }\n    // text/html\n    else if ($data['type'] == 'html') {\n        $body = rcmail_wash_html($data['body'], $data, $part->replaces);\n        $part->ctype_secondary = $data['type'];\n    }\n    // text/enriched\n    else if ($data['type'] == 'enriched') {\n        $body = rcube_enriched::to_html($data['body']);\n        $body = rcmail_wash_html($body, $data, $part->replaces);\n        $part->ctype_secondary = 'html';\n    }\n    else {\n        // assert plaintext\n        $body = $data['body'];\n        $part->ctype_secondary = $data['type'] = 'plain';\n    }\n\n    // free some memory (hopefully)\n    unset($data['body']);\n\n    // plaintext postprocessing\n    if ($part->ctype_secondary == 'plain') {\n        $flowed = $part->ctype_parameters['format'] == 'flowed';\n        $delsp = $part->ctype_parameters['delsp'] == 'yes';\n        $body = rcmail_plain_body($body, $flowed, $delsp);\n    }\n\n    // allow post-processing of the message body\n    $data = $RCMAIL->plugins->exec_hook('message_part_after',\n        array('type' => $part->ctype_secondary, 'body' => $body, 'id' => $part->mime_id) + $data);\n\n    return $data['body'];\n}\n\n/**\n * Handle links and citation marks in plain text message\n *\n * @param string  Plain text string\n * @param boolean Set to True if the source text is in format=flowed\n *\n * @return string Formatted HTML string\n */\nfunction rcmail_plain_body($body, $flowed = false, $delsp = false)\n{\n    $options   = array('flowed' => $flowed, 'wrap' => !$flowed, 'replacer' => 'rcmail_string_replacer',\n        'delsp' => $delsp);\n    $text2html = new rcube_text2html($body, false, $options);\n    $body      = $text2html->get_html();\n\n    return $body;\n}\n\n/**\n * Callback function for washtml cleaning class\n */\nfunction rcmail_washtml_callback($tagname, $attrib, $content, $washtml)\n{\n    switch ($tagname) {\n    case 'form':\n        $out = html::div('form', $content);\n        break;\n\n    case 'style':\n        // Crazy big styles may freeze the browser (#1490539)\n        // remove content with more than 5k lines\n        if (substr_count($content, \"\\n\") > 5000) {\n            $out = '';\n            break;\n        }\n\n        // decode all escaped entities and reduce to ascii strings\n        $decoded  = rcube_utils::xss_entity_decode($content);\n        $stripped = preg_replace('/[^a-zA-Z\\(:;]/', '', $decoded);\n\n        // now check for evil strings like expression, behavior or url()\n        if (!preg_match('/expression|behavior|javascript:|import[^a]/i', $stripped)) {\n            if (!$washtml->get_config('allow_remote') && preg_match('/url\\((?!data:image)/', $stripped)) {\n                $washtml->extlinks = true;\n            }\n            else {\n                $out = html::tag('style', array('type' => 'text/css'), $decoded);\n            }\n            break;\n        }\n\n    default:\n        $out = '';\n    }\n\n    return $out;\n}\n\n/**\n * return table with message headers\n */\nfunction rcmail_message_headers($attrib, $headers=null)\n{\n    global $MESSAGE, $PRINT_MODE, $RCMAIL;\n    static $sa_attrib;\n\n    // keep header table attrib\n    if (is_array($attrib) && !$sa_attrib && !$attrib['valueof']) {\n        $sa_attrib = $attrib;\n    }\n    else if (!is_array($attrib) && is_array($sa_attrib)) {\n        $attrib = $sa_attrib;\n    }\n\n    if (!isset($MESSAGE)) {\n        return false;\n    }\n\n    // get associative array of headers object\n    if (!$headers) {\n        $headers_obj = $MESSAGE->headers;\n        $headers     = get_object_vars($MESSAGE->headers);\n    }\n    else if (is_object($headers)) {\n        $headers_obj = $headers;\n        $headers     = get_object_vars($headers_obj);\n    }\n    else {\n        $headers_obj = rcube_message_header::from_array($headers);\n    }\n\n    // show these headers\n    $standard_headers = array('subject', 'from', 'sender', 'to', 'cc', 'bcc', 'replyto',\n        'mail-reply-to', 'mail-followup-to', 'date', 'priority');\n    $exclude_headers = $attrib['exclude'] ? explode(',', $attrib['exclude']) : array();\n    $output_headers  = array();\n\n    foreach ($standard_headers as $hkey) {\n        if ($headers[$hkey])\n            $value = $headers[$hkey];\n        else if ($headers['others'][$hkey])\n            $value = $headers['others'][$hkey];\n        else if (!$attrib['valueof'])\n            continue;\n\n        if (in_array($hkey, $exclude_headers))\n            continue;\n\n        $ishtml       = false;\n        $header_title = $RCMAIL->gettext(preg_replace('/(^mail-|-)/', '', $hkey));\n\n        if ($hkey == 'date') {\n            if ($PRINT_MODE)\n                $header_value = $RCMAIL->format_date($value, $RCMAIL->config->get('date_long', 'x'));\n            else\n                $header_value = $RCMAIL->format_date($value);\n        }\n        else if ($hkey == 'priority') {\n            if ($value) {\n                $header_value = html::span('prio' . $value, rcube::Q(rcmail_localized_priority($value)));\n                $ishtml       = true;\n            }\n            else {\n                continue;\n            }\n        }\n        else if ($hkey == 'replyto') {\n            if ($headers['replyto'] != $headers['from']) {\n                $header_value = rcmail_address_string($value, $attrib['max'], true,\n                    $attrib['addicon'], $headers['charset'], $header_title);\n                $ishtml = true;\n            }\n            else {\n                continue;\n            }\n        }\n        else if ($hkey == 'mail-reply-to') {\n            if ($headers['mail-replyto'] != $headers['replyto']\n                && $headers['replyto'] != $headers['from']\n            ) {\n                $header_value = rcmail_address_string($value, $attrib['max'], true,\n                    $attrib['addicon'], $headers['charset'], $header_title);\n                $ishtml = true;\n            }\n            else {\n                continue;\n            }\n        }\n        else if ($hkey == 'sender') {\n            if ($headers['sender'] != $headers['from']) {\n                $header_value = rcmail_address_string($value, $attrib['max'], true,\n                    $attrib['addicon'], $headers['charset'], $header_title);\n                $ishtml = true;\n            }\n            else {\n                continue;\n            }\n        }\n        else if ($hkey == 'mail-followup-to') {\n            $header_value = rcmail_address_string($value, $attrib['max'], true,\n                $attrib['addicon'], $headers['charset'], $header_title);\n            $ishtml = true;\n        }\n        else if (in_array($hkey, array('from', 'to', 'cc', 'bcc'))) {\n            $header_value = rcmail_address_string($value, $attrib['max'], true,\n                $attrib['addicon'], $headers['charset'], $header_title);\n            $ishtml = true;\n        }\n        else if ($hkey == 'subject' && empty($value)) {\n            $header_value = $RCMAIL->gettext('nosubject');\n        }\n        else {\n            $value        = is_array($value) ? implode(' ', $value) : $value;\n            $header_value = trim(rcube_mime::decode_header($value, $headers['charset']));\n        }\n\n        $output_headers[$hkey] = array(\n            'title' => $header_title,\n            'value' => $header_value,\n            'raw'   => $value,\n            'html'  => $ishtml,\n        );\n    }\n\n    $plugin = $RCMAIL->plugins->exec_hook('message_headers_output', array(\n        'output'  => $output_headers,\n        'headers' => $headers_obj,\n        'exclude' => $exclude_headers, // readonly\n        'folder'  => $MESSAGE->folder, // readonly\n        'uid'     => $MESSAGE->uid,    // readonly\n    ));\n\n    // single header value is requested\n    if (!empty($attrib['valueof'])) {\n        $row = $plugin['output'][$attrib['valueof']];\n        return $row['html'] ? $row['value'] : rcube::Q($row['value']);\n    }\n\n    // compose html table\n    $table = new html_table(array('cols' => 2));\n\n    foreach ($plugin['output'] as $hkey => $row) {\n        $val = $row['html'] ? $row['value'] : rcube::Q($row['value']);\n\n        $table->add(array('class' => 'header-title'), rcube::Q($row['title']));\n        $table->add(array('class' => 'header '.$hkey), $val);\n    }\n\n    return $table->show($attrib);\n}\n\n/**\n * Convert Priority header value into a localized string\n */\nfunction rcmail_localized_priority($value)\n{\n    global $RCMAIL;\n\n    $labels_map = array(\n        '1' => 'highest',\n        '2' => 'high',\n        '3' => 'normal',\n        '4' => 'low',\n        '5' => 'lowest',\n    );\n\n    if ($value && $labels_map[$value]) {\n        return $RCMAIL->gettext($labels_map[$value]);\n    }\n\n    return '';\n}\n\n/**\n * return block to show full message headers\n */\nfunction rcmail_message_full_headers($attrib)\n{\n    global $OUTPUT, $RCMAIL;\n\n    $html = html::div(array('id' => \"all-headers\", 'class' => \"all\", 'style' => 'display:none'), html::div(array('id' => 'headers-source'), ''));\n    $html .= html::div(array(\n            'class'   => \"more-headers show-headers\",\n            'onclick' => \"return \".rcmail_output::JS_OBJECT_NAME.\".command('show-headers','',this)\",\n            'title'   => $RCMAIL->gettext('togglefullheaders')\n        ), '');\n\n    $OUTPUT->add_gui_object('all_headers_row', 'all-headers');\n    $OUTPUT->add_gui_object('all_headers_box', 'headers-source');\n\n    return html::div($attrib, $html);\n}\n\n/**\n * Handler for the 'messagebody' GUI object\n *\n * @param array Named parameters\n * @return string HTML content showing the message body\n */\nfunction rcmail_message_body($attrib)\n{\n    global $OUTPUT, $MESSAGE, $RCMAIL, $REMOTE_OBJECTS;\n\n    if (!is_array($MESSAGE->parts) && empty($MESSAGE->body)) {\n        return '';\n    }\n\n    if (!$attrib['id'])\n        $attrib['id'] = 'rcmailMsgBody';\n\n    $safe_mode = $MESSAGE->is_safe || intval($_GET['_safe']);\n    $out       = '';\n    $part_no   = 0;\n    $token     = $RCMAIL->get_request_token();\n\n    $header_attrib = array();\n    foreach ($attrib as $attr => $value) {\n        if (preg_match('/^headertable([a-z]+)$/i', $attr, $regs)) {\n            $header_attrib[$regs[1]] = $value;\n        }\n    }\n\n    if (!empty($MESSAGE->parts)) {\n        foreach ($MESSAGE->parts as $part) {\n            if ($part->type == 'headers') {\n                $out .= html::div('message-partheaders', rcmail_message_headers(count($header_attrib) ? $header_attrib : null, $part->headers));\n            }\n            else if ($part->type == 'content') {\n                // unsupported (e.g. encrypted)\n                if ($part->realtype) {\n                    if ($part->realtype == 'multipart/encrypted' || $part->realtype == 'application/pkcs7-mime') {\n                        if (!empty($_SESSION['browser_caps']['pgpmime']) && ($pgp_mime_part = $MESSAGE->get_multipart_encrypted_part())) {\n                            $out .= html::span('part-notice', $RCMAIL->gettext('externalmessagedecryption'));\n                            $OUTPUT->set_env('pgp_mime_part', $pgp_mime_part->mime_id);\n                            $OUTPUT->set_env('pgp_mime_container', '#' . $attrib['id']);\n                            $OUTPUT->add_label('loadingdata');\n                        }\n\n                        if (!$MESSAGE->encrypted_part) {\n                            $out .= html::span('part-notice', $RCMAIL->gettext('encryptedmessage'));\n                        }\n                    }\n                    continue;\n                }\n                else if (!$part->size) {\n                    continue;\n                }\n                // Check if we have enough memory to handle the message in it\n                // #1487424: we need up to 10x more memory than the body\n                else if (!rcube_utils::mem_check($part->size * 10)) {\n                    $out .= html::span('part-notice', $RCMAIL->gettext('messagetoobig'). ' '\n                        . html::a('?_task=mail&_action=get&_download=1&_uid='.$MESSAGE->uid.'&_part='.$part->mime_id.'&_token='.$token\n                            .'&_mbox='. urlencode($MESSAGE->folder), $RCMAIL->gettext('download')));\n                    continue;\n                }\n\n                // fetch part body\n                $body = $MESSAGE->get_part_body($part->mime_id, true);\n\n                // message is cached but not exists (#1485443), or other error\n                if ($body === false) {\n                    rcmail_message_error($MESSAGE->uid);\n                }\n\n                $plugin = $RCMAIL->plugins->exec_hook('message_body_prefix',\n                    array('part' => $part, 'prefix' => ''));\n\n                // Set attributes of the part container\n                $container_class  = $part->ctype_secondary == 'html' ? 'message-htmlpart' : 'message-part';\n                $container_id     = $container_class . (++$part_no);\n                $container_attrib = array('class' => $container_class, 'id' => $container_id);\n\n                // Assign container ID to a global variable for use in rcmail_washtml_link_callback()\n                $GLOBALS['rcmail_html_container_id'] = $container_id;\n\n                // Parse the part content for display\n                $body = rcmail_print_body($body, $part, array('safe' => $safe_mode, 'plain' => !$RCMAIL->config->get('prefer_html')));\n\n                // check if the message body is PGP encrypted\n                if (strpos($body, '-----BEGIN PGP MESSAGE-----') !== false) {\n                    $OUTPUT->set_env('is_pgp_content', '#' . $container_id);\n                }\n\n                if ($part->ctype_secondary == 'html') {\n                    $body = rcmail_html4inline($body, $container_id, 'rcmBody', $container_attrib, $safe_mode);\n                }\n\n                $out .= html::div($container_attrib, $plugin['prefix'] . $body);\n            }\n        }\n    }\n    else {\n        // Check if we have enough memory to handle the message in it\n        // #1487424: we need up to 10x more memory than the body\n        if (!rcube_utils::mem_check(strlen($MESSAGE->body) * 10)) {\n            $out .= html::span('part-notice', $RCMAIL->gettext('messagetoobig'). ' '\n                . html::a('?_task=mail&_action=get&_download=1&_uid='.$MESSAGE->uid.'&_part=0&_token='.$token\n                    .'&_mbox='. urlencode($MESSAGE->folder), $RCMAIL->gettext('download')));\n        }\n        else {\n            $plugin = $RCMAIL->plugins->exec_hook('message_body_prefix',\n                array('part' => $MESSAGE, 'prefix' => ''));\n\n            $out .= html::div('message-part',\n                $plugin['prefix'] . rcmail_plain_body($MESSAGE->body));\n        }\n    }\n\n    // list images after mail body\n    if ($RCMAIL->config->get('inline_images', true) && !empty($MESSAGE->attachments)) {\n        $thumbnail_size   = $RCMAIL->config->get('image_thumbnail_size', 240);\n        $client_mimetypes = (array)$RCMAIL->config->get('client_mimetypes');\n\n        foreach ($MESSAGE->attachments as $attach_prop) {\n            // skip inline images\n            if ($attach_prop->content_id && $attach_prop->disposition == 'inline') {\n                continue;\n            }\n\n            // Content-Type: image/*...\n            if ($mimetype = rcmail_part_image_type($attach_prop)) {\n                // display thumbnails\n                if ($thumbnail_size) {\n                    $supported = in_array($mimetype, $client_mimetypes);\n                    $show_link = array(\n                        'href'    => $MESSAGE->get_part_url($attach_prop->mime_id, false),\n                        'onclick' => sprintf(\n                            'return %s.command(\\'load-attachment\\',\\'%s\\',this)',\n                            rcmail_output::JS_OBJECT_NAME,\n                            $attach_prop->mime_id)\n                    );\n\n                    $out .= html::p(array('class' => 'image-attachment', 'style' => $supported ? '' : 'display:none'),\n                        html::a($show_link + array('class' => 'image-link', 'style' => sprintf('width:%dpx', $thumbnail_size)),\n                            html::img(array(\n                                'class' => 'image-thumbnail',\n                                'src'   => $MESSAGE->get_part_url($attach_prop->mime_id, 'image') . '&_thumb=1',\n                                'title' => $attach_prop->filename,\n                                'alt'   => $attach_prop->filename,\n                                'style' => sprintf('max-width:%dpx; max-height:%dpx', $thumbnail_size, $thumbnail_size),\n                                'onload' => $supported ? '' : '$(this).parents(\\'p.image-attachment\\').show()',\n                            ))\n                        ) .\n                        html::span('image-filename', rcube::Q($attach_prop->filename)) .\n                        html::span('image-filesize', rcube::Q($RCMAIL->message_part_size($attach_prop))) .\n                        html::span('attachment-links',\n                            ($supported ? html::a($show_link, $RCMAIL->gettext('showattachment')) . '&nbsp;' : '') .\n                                html::a($show_link['href'] . '&_download=1', $RCMAIL->gettext('download'))\n                        ) .\n                        html::br(array('style' => 'clear:both'))\n                    );\n                }\n                else {\n                    $out .= html::tag('fieldset', 'image-attachment',\n                        html::tag('legend', 'image-filename', rcube::Q($attach_prop->filename)) .\n                        html::p(array('align' => 'center'),\n                            html::img(array(\n                                'src'   => $MESSAGE->get_part_url($attach_prop->mime_id, 'image'),\n                                'title' => $attach_prop->filename,\n                                'alt'   => $attach_prop->filename,\n                        )))\n                    );\n                }\n            }\n        }\n    }\n\n    // tell client that there are blocked remote objects\n    if ($REMOTE_OBJECTS && !$safe_mode) {\n        $OUTPUT->set_env('blockedobjects', true);\n    }\n\n    return html::div($attrib, $out);\n}\n\nfunction rcmail_part_image_type($part)\n{\n    $mimetype = strtolower($part->mimetype);\n\n    // Skip TIFF/WEBP images if browser doesn't support this format\n    // ...until we can convert them to JPEG\n    $tiff_support = !empty($_SESSION['browser_caps']) && !empty($_SESSION['browser_caps']['tiff']);\n    $tiff_support = $tiff_support || rcube_image::is_convertable('image/tiff');\n    $webp_support = !empty($_SESSION['browser_caps']) && !empty($_SESSION['browser_caps']['webp']);\n    $webp_support = $webp_support || rcube_image::is_convertable('image/webp');\n\n    if ((!$tiff_support && $mimetype == 'image/tiff') || (!$webp_support && $mimetype == 'image/webp')) {\n        return;\n    }\n\n    // Content-Type: image/*...\n    if (strpos($mimetype, 'image/') === 0) {\n        return rcmail_fix_mimetype($mimetype);\n    }\n\n    // Many clients use application/octet-stream, we'll detect mimetype\n    // by checking filename extension\n\n    // Supported image filename extensions to image type map\n    $types = array(\n        'jpg'  => 'image/jpeg',\n        'jpeg' => 'image/jpeg',\n        'png'  => 'image/png',\n        'gif'  => 'image/gif',\n        'bmp'  => 'image/bmp',\n    );\n    if ($tiff_support) {\n        $types['tif']  = 'image/tiff';\n        $types['tiff'] = 'image/tiff';\n    }\n    if ($webp_support) {\n        $types['webp'] = 'image/webp';\n    }\n\n    if ($part->filename\n        && $mimetype == 'application/octet-stream'\n        && preg_match('/\\.([^.]+)$/i', $part->filename, $m)\n        && ($extension = strtolower($m[1]))\n        && isset($types[$extension])\n    ) {\n        return $types[$extension];\n    }\n}\n\n/**\n * Modify a HTML message that it can be displayed inside a HTML page\n */\nfunction rcmail_html4inline($body, $container_id, $body_class='', &$attributes=array(), $allow_remote=false)\n{\n    $last_style_pos = 0;\n    $cont_id        = $container_id . ($body_class ? ' div.'.$body_class : '');\n\n    // find STYLE tags\n    while (($pos = stripos($body, '<style', $last_style_pos)) && ($pos2 = stripos($body, '</style>', $pos))) {\n        $pos = strpos($body, '>', $pos) + 1;\n        $len = $pos2 - $pos;\n\n        // replace all css definitions with #container [def]\n        $styles = substr($body, $pos, $len);\n        $styles = rcube_utils::mod_css_styles($styles, $cont_id, $allow_remote);\n\n        $body = substr_replace($body, $styles, $pos, $len);\n        $last_style_pos = $pos2 + strlen($styles) - $len;\n    }\n\n    $body = preg_replace(array(\n            // add comments around html and other tags\n            '/(<!DOCTYPE[^>]*>)/i',\n            '/(<\\?xml[^>]*>)/i',\n            '/(<\\/?html[^>]*>)/i',\n            '/(<\\/?head[^>]*>)/i',\n            '/(<title[^>]*>.*<\\/title>)/Ui',\n            '/(<\\/?meta[^>]*>)/i',\n            // quote <? of php and xml files that are specified as text/html\n            '/<\\?/',\n            '/\\?>/',\n            // replace <body> with <div>\n            '/<body([^>]*)>/i',\n            '/<\\/body>/i',\n        ),\n        array(\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '&lt;?',\n            '?&gt;',\n            '<div class=\"' . $body_class . '\"\\\\1>',\n            '</div>',\n        ),\n        $body);\n\n    // Handle body attributes that doesn't play nicely with div elements\n    $regexp = '/<div class=\"' . preg_quote($body_class, '/') . '\"([^>]*)/';\n    if (preg_match($regexp, $body, $m)) {\n        $style = array();\n        $attrs = $m[0];\n\n        // Get bgcolor, we'll set it as background-color of the message container\n        if ($m[1] && preg_match('/bgcolor=[\"\\']*([a-z0-9#]+)[\"\\']*/i', $attrs, $mb)) {\n            $style['background-color'] = $mb[1];\n            $attrs = preg_replace('/bgcolor=[\"\\']*[a-z0-9#]+[\"\\']*/i', '', $attrs);\n        }\n\n        // Get background, we'll set it as background-image of the message container\n        if ($m[1] && preg_match('/background=[\"\\']*([^\"\\'>\\s]+)[\"\\']*/', $attrs, $mb)) {\n            $style['background-image'] = 'url('.$mb[1].')';\n            $attrs = preg_replace('/background=[\"\\']*([^\"\\'>\\s]+)[\"\\']*/', '', $attrs);\n        }\n\n        if (!empty($style)) {\n            $body = preg_replace($regexp, rtrim($attrs), $body, 1);\n        }\n\n        // handle body styles related to background image\n        if ($style['background-image']) {\n            // get body style\n            if (preg_match('/#'.preg_quote($cont_id, '/').'\\s+\\{([^}]+)}/i', $body, $m)) {\n                // get background related style\n                $regexp = '/(background-position|background-repeat)\\s*:\\s*([^;]+);/i';\n                if (preg_match_all($regexp, $m[1], $matches, PREG_SET_ORDER)) {\n                    foreach ($matches as $m) {\n                        $style[$m[1]] = $m[2];\n                    }\n                }\n            }\n        }\n\n        if (!empty($style)) {\n            foreach ($style as $idx => $val) {\n                $style[$idx] = $idx . ': ' . $val;\n            }\n\n            $attributes['style'] = implode('; ', $style);\n        }\n    }\n    // make sure there's 'rcmBody' div, we need it for proper css modification\n    // its name is hardcoded in rcmail_message_body() also\n    else {\n        $body = '<div class=\"' . $body_class . '\">' . $body . '</div>';\n    }\n\n    return $body;\n}\n\n/**\n * Parse link (a, link, area) attributes and set correct target\n */\nfunction rcmail_washtml_link_callback($tag, $attribs, $content, $washtml)\n{\n    global $RCMAIL;\n\n    $attrib = html::parse_attrib_string($attribs);\n\n    // Remove non-printable characters in URL (#1487805)\n    if ($attrib['href']) {\n        $attrib['href'] = preg_replace('/[\\x00-\\x1F]/', '', $attrib['href']);\n    }\n\n    if ($tag == 'link' && preg_match('/^https?:\\/\\//i', $attrib['href'])) {\n        $tempurl = 'tmp-' . md5($attrib['href']) . '.css';\n        $_SESSION['modcssurls'][$tempurl] = $attrib['href'];\n        $attrib['href'] = $RCMAIL->url(array('task' => 'utils', 'action' => 'modcss', 'u' => $tempurl, 'c' => $GLOBALS['rcmail_html_container_id']));\n        $end = ' />';\n    }\n    else if (preg_match('/^mailto:(.+)/i', $attrib['href'], $mailto)) {\n        list($mailto, $url) = explode('?', html_entity_decode($mailto[1], ENT_QUOTES, 'UTF-8'), 2);\n\n        // #6020: use raw encoding for correct \"+\" character handling as specified in RFC6068\n        $url       = rawurldecode($url);\n        $mailto    = rawurldecode($mailto);\n        $addresses = rcube_mime::decode_address_list($mailto, null, true);\n        $mailto    = array();\n\n        // do sanity checks on recipients\n        foreach ($addresses as $idx => $addr) {\n            if (rcube_utils::check_email($addr['mailto'], false)) {\n                $addresses[$idx] = $addr['mailto'];\n                $mailto[]        = $addr['string'];\n            }\n            else {\n                unset($addresses[$idx]);\n            }\n        }\n\n        if (!empty($addresses)) {\n            $attrib['href']    = 'mailto:' . implode(',', $addresses);\n            $attrib['onclick'] = sprintf(\n                \"return %s.command('compose','%s',this)\",\n                rcmail_output::JS_OBJECT_NAME,\n                rcube::JQ(implode(',', $mailto) . ($url ? \"?$url\" : '')));\n        }\n        else {\n            $attrib['href']    = '#NOP';\n            $attrib['onclick'] = '';\n        }\n    }\n    else if (empty($attrib['href']) && !isset($attrib['name'])) {\n        $attrib['href']    = './#NOP';\n        $attrib['onclick'] = 'return false';\n    }\n    else if (!empty($attrib['href']) && $attrib['href'][0] != '#') {\n        $attrib['target'] = '_blank';\n    }\n\n    // Better security by adding rel=\"noreferrer\" (#1484686)\n    if (($tag == 'a' || $tag == 'area') && $attrib['href'] && $attrib['href'][0] != '#') {\n        $attrib['rel'] = 'noreferrer';\n    }\n\n    // allowed attributes for a|link|area tags\n    $allow = array('href','name','target','onclick','id','class','style','title',\n        'rel','type','media','alt','coords','nohref','hreflang','shape');\n\n    return html::tag($tag, $attrib, $content, $allow);\n}\n\n/**\n * Decode address string and re-format it as HTML links\n */\nfunction rcmail_address_string($input, $max=null, $linked=false, $addicon=null, $default_charset=null, $title=null)\n{\n    global $RCMAIL, $PRINT_MODE;\n\n    $a_parts = rcube_mime::decode_address_list($input, null, true, $default_charset);\n\n    if (!count($a_parts)) {\n        return $input;\n    }\n\n    $c   = count($a_parts);\n    $j   = 0;\n    $out = '';\n    $allvalues  = array();\n    $show_email = $RCMAIL->config->get('message_show_email');\n\n    if ($addicon && !isset($_SESSION['writeable_abook'])) {\n        $_SESSION['writeable_abook'] = $RCMAIL->get_address_sources(true) ? true : false;\n    }\n\n    foreach ($a_parts as $part) {\n        $j++;\n\n        $name   = $part['name'];\n        $mailto = $part['mailto'];\n        $string = $part['string'];\n        $valid  = rcube_utils::check_email($mailto, false);\n\n        // phishing email prevention (#1488981), e.g. \"valid@email.addr <phishing@email.addr>\"\n        if (!$show_email && $valid && $name && $name != $mailto && strpos($name, '@')) {\n            $name = '';\n        }\n\n        // IDNA ASCII to Unicode\n        if ($name == $mailto)\n            $name = rcube_utils::idn_to_utf8($name);\n        if ($string == $mailto)\n            $string = rcube_utils::idn_to_utf8($string);\n        $mailto = rcube_utils::idn_to_utf8($mailto);\n\n        if ($PRINT_MODE) {\n            $address = sprintf('%s &lt;%s&gt;', rcube::Q($name), rcube::Q($mailto));\n        }\n        else if ($valid) {\n            if ($linked) {\n                $attrs = array(\n                    'href'    => 'mailto:' . $mailto,\n                    'class'   => 'rcmContactAddress',\n                    'onclick' => sprintf(\"return %s.command('compose','%s',this)\",\n                        rcmail_output::JS_OBJECT_NAME, rcube::JQ(format_email_recipient($mailto, $name))),\n                );\n\n                if ($show_email && $name && $mailto) {\n                    $content = rcube::Q($name ? sprintf('%s <%s>', $name, $mailto) : $mailto);\n                }\n                else {\n                    $content = rcube::Q($name ?: $mailto);\n                    $attrs['title'] = $mailto;\n                }\n\n                $address = html::a($attrs, $content);\n            }\n            else {\n                $address = html::span(array('title' => $mailto, 'class' => \"rcmContactAddress\"),\n                    rcube::Q($name ?: $mailto));\n            }\n\n            if ($addicon && $_SESSION['writeable_abook']) {\n                $address .= html::a(array(\n                        'href'    => \"#add\",\n                        'title'   => $RCMAIL->gettext('addtoaddressbook'),\n                        'class'   => 'rcmaddcontact',\n                        'onclick' => sprintf(\"return %s.command('add-contact','%s',this)\",\n                            rcmail_output::JS_OBJECT_NAME, rcube::JQ($string)),\n                    ),\n                    html::img(array(\n                        'src'   => $RCMAIL->output->abs_url($addicon, true),\n                        'alt'   => \"Add contact\",\n                        'class' => 'noselect',\n                )));\n            }\n        }\n        else {\n            $address = $name ? rcube::Q($name) : '';\n            if ($mailto) {\n                $address = trim($address . ' ' . rcube::Q($name ? sprintf('<%s>', $mailto) : $mailto));\n            }\n        }\n\n        $address = html::span('adr', $address);\n        $allvalues[] = $address;\n\n        if (!$moreadrs) {\n            $out .= ($out ? ', ' : '') . $address;\n        }\n\n        if ($max && $j == $max && $c > $j) {\n            if ($linked) {\n                $moreadrs = $c - $j;\n            }\n            else {\n                $out .= '...';\n                break;\n            }\n        }\n    }\n\n    if ($moreadrs) {\n        $label = rcube::Q($RCMAIL->gettext(array('name' => 'andnmore', 'vars' => array('nr' => $moreadrs))));\n\n        if ($PRINT_MODE) {\n            $out .= ' ' . html::a(array(\n                    'href'    => '#more',\n                    'class'   => 'morelink',\n                    'onclick' => '$(this).hide().next().show()',\n                ), $label)\n                . html::span(array('style' => 'display:none'), join(', ', $allvalues));\n        }\n        else {\n            $out .= ' ' . html::a(array(\n                    'href'    => '#more',\n                    'class'   => 'morelink',\n                    'onclick' => sprintf(\"return %s.show_popup_dialog('%s','%s')\",\n                        rcmail_output::JS_OBJECT_NAME,\n                        rcube::JQ(join(', ', $allvalues)),\n                        rcube::JQ($title))\n                ), $label);\n        }\n    }\n\n    return $out;\n}\n\n/**\n * Wrap text to a given number of characters per line\n * but respect the mail quotation of replies messages (>).\n * Finally add another quotation level by prepending the lines\n * with >\n *\n * @param string Text to wrap\n * @param int    The line width\n * @return string The wrapped text\n */\nfunction rcmail_wrap_and_quote($text, $length = 72)\n{\n    // Rebuild the message body with a maximum of $max chars, while keeping quoted message.\n    $max   = max(75, $length + 8);\n    $lines = preg_split('/\\r?\\n/', trim($text));\n    $out   = '';\n\n    foreach ($lines as $line) {\n        // don't wrap already quoted lines\n        if ($line[0] == '>') {\n            $line = '>' . rtrim($line);\n        }\n        else if (mb_strlen($line) > $max) {\n            $newline = '';\n\n            foreach (explode(\"\\n\", rcube_mime::wordwrap($line, $length - 2)) as $l) {\n                $newline .= strlen($l) ? \"> $l\\n\" : \">\\n\";\n            }\n\n            $line = rtrim($newline);\n        }\n        else {\n            $line = '> ' . $line;\n        }\n\n        // Append the line\n        $out .= $line . \"\\n\";\n    }\n\n    return rtrim($out, \"\\n\");\n}\n\nfunction rcmail_draftinfo_encode($p)\n{\n    $parts = array();\n    foreach ($p as $key => $val) {\n        $encode  = $key == 'folder' || strpos($val, ';') !== false;\n        $parts[] = $key . '=' . ($encode ? 'B::' . base64_encode($val) : $val);\n    }\n\n    return join('; ', $parts);\n}\n\nfunction rcmail_draftinfo_decode($str)\n{\n    $info = array();\n\n    foreach (preg_split('/;\\s+/', $str) as $part) {\n        list($key, $val) = explode('=', $part, 2);\n        if (strpos($val, 'B::') === 0) {\n            $val = base64_decode(substr($val, 3));\n        }\n        else if ($key == 'folder') {\n            $val = base64_decode($val);\n        }\n\n        $info[$key] = $val;\n    }\n\n    return $info;\n}\n\n/**\n * Send the MDN response\n *\n * @param mixed $message    Original message object (rcube_message) or UID\n * @param array $smtp_error SMTP error array (reference)\n *\n * @return boolean Send status\n */\nfunction rcmail_send_mdn($message, &$smtp_error)\n{\n    global $RCMAIL;\n\n    if (!is_object($message) || !is_a($message, 'rcube_message')) {\n        $message = new rcube_message($message);\n    }\n\n    if ($message->headers->mdn_to && empty($message->headers->flags['MDNSENT']) &&\n        ($RCMAIL->storage->check_permflag('MDNSENT') || $RCMAIL->storage->check_permflag('*'))\n    ) {\n        $identity  = rcmail_identity_select($message);\n        $sender    = format_email_recipient($identity['email'], $identity['name']);\n        $recipient = array_shift(rcube_mime::decode_address_list(\n            $message->headers->mdn_to, 1, true, $message->headers->charset));\n        $mailto    = $recipient['mailto'];\n\n        $compose = new Mail_mime(\"\\r\\n\");\n\n        $compose->setParam('text_encoding', 'quoted-printable');\n        $compose->setParam('html_encoding', 'quoted-printable');\n        $compose->setParam('head_encoding', 'quoted-printable');\n        $compose->setParam('head_charset', RCUBE_CHARSET);\n        $compose->setParam('html_charset', RCUBE_CHARSET);\n        $compose->setParam('text_charset', RCUBE_CHARSET);\n\n        // compose headers array\n        $headers = array(\n            'Date'       => $RCMAIL->user_date(),\n            'From'       => $sender,\n            'To'         => $message->headers->mdn_to,\n            'Subject'    => $RCMAIL->gettext('receiptread') . ': ' . $message->subject,\n            'Message-ID' => $RCMAIL->gen_message_id($identity['email']),\n            'X-Sender'   => $identity['email'],\n            'References' => trim($message->headers->references . ' ' . $message->headers->messageID),\n            'In-Reply-To' => $message->headers->messageID,\n        );\n\n        $report = \"Final-Recipient: rfc822; {$identity['email']}\\r\\n\"\n            . \"Original-Message-ID: {$message->headers->messageID}\\r\\n\"\n            . \"Disposition: manual-action/MDN-sent-manually; displayed\\r\\n\";\n\n        if ($message->headers->to) {\n            $report .= \"Original-Recipient: {$message->headers->to}\\r\\n\";\n        }\n\n        if ($agent = $RCMAIL->config->get('useragent')) {\n            $headers['User-Agent'] = $agent;\n            $report .= \"Reporting-UA: $agent\\r\\n\";\n        }\n\n        $to   = rcube_mime::decode_mime_string($message->headers->to, $message->headers->charset);\n        $date = $RCMAIL->format_date($message->headers->date, $RCMAIL->config->get('date_long'));\n        $body = $RCMAIL->gettext(\"yourmessage\") . \"\\r\\n\\r\\n\" .\n            \"\\t\" . $RCMAIL->gettext(\"to\") . \": {$to}\\r\\n\" .\n            \"\\t\" . $RCMAIL->gettext(\"subject\") . \": {$message->subject}\\r\\n\" .\n            \"\\t\" . $RCMAIL->gettext(\"date\") . \": {$date}\\r\\n\" .\n            \"\\r\\n\" . $RCMAIL->gettext(\"receiptnote\");\n\n        $compose->headers(array_filter($headers));\n        $compose->setContentType('multipart/report', array('report-type'=> 'disposition-notification'));\n        $compose->setTXTBody(rcube_mime::wordwrap($body, 75, \"\\r\\n\"));\n        $compose->addAttachment($report, 'message/disposition-notification', 'MDNPart2.txt', false, '7bit', 'inline');\n\n        // SMTP options\n        $options = array('mdn_use_from' => (bool) $RCMAIL->config->get('mdn_use_from'));\n\n        $sent = $RCMAIL->deliver_message($compose, $identity['email'], $mailto, $smtp_error, $body_file, $options, true);\n\n        if ($sent) {\n            $RCMAIL->storage->set_flag($message->uid, 'MDNSENT');\n            return true;\n        }\n    }\n\n    return false;\n}\n\n/**\n * Detect recipient identity from specified message\n */\nfunction rcmail_identity_select($MESSAGE, $identities = null, $compose_mode = 'reply')\n{\n    $a_recipients = array();\n    $a_names      = array();\n\n    if ($identities === null) {\n        $identities = rcmail::get_instance()->user->list_identities(null, true);\n    }\n\n    // extract all recipients of the reply-message\n    if (is_object($MESSAGE->headers) && in_array($compose_mode, array('reply', 'forward'))) {\n        $a_to = rcube_mime::decode_address_list($MESSAGE->headers->to, null, true, $MESSAGE->headers->charset);\n        foreach ($a_to as $addr) {\n            if (!empty($addr['mailto'])) {\n                $a_recipients[] = strtolower($addr['mailto']);\n                $a_names[]      = $addr['name'];\n            }\n        }\n\n        if (!empty($MESSAGE->headers->cc)) {\n            $a_cc = rcube_mime::decode_address_list($MESSAGE->headers->cc, null, true, $MESSAGE->headers->charset);\n            foreach ($a_cc as $addr) {\n                if (!empty($addr['mailto'])) {\n                    $a_recipients[] = strtolower($addr['mailto']);\n                    $a_names[]      = $addr['name'];\n                }\n            }\n        }\n    }\n\n    // decode From: address\n    $from = rcube_mime::decode_address_list($MESSAGE->headers->from, null, true, $MESSAGE->headers->charset);\n    $from = array_shift($from);\n    $from['mailto'] = strtolower($from['mailto']);\n\n    $from_idx   = null;\n    $found_idx  = array('to' => null, 'from' => null);\n    $check_from = in_array($compose_mode, array('draft', 'edit', 'reply'));\n\n    // Select identity\n    foreach ($identities as $idx => $ident) {\n        // use From: header when in edit/draft or reply-to-self\n        if ($check_from && $from['mailto'] == strtolower($ident['email_ascii'])) {\n            // remember first matching identity address\n            if ($found_idx['from'] === null) {\n                $found_idx['from'] = $idx;\n            }\n            // match identity name\n            if ($from['name'] && $ident['name'] && $from['name'] == $ident['name']) {\n                $from_idx = $idx;\n                break;\n            }\n        }\n        // use replied/forwarded message recipients\n        else if (($found = array_search(strtolower($ident['email_ascii']), $a_recipients)) !== false) {\n            // remember first matching identity address\n            if ($found_idx['to'] === null) {\n                $found_idx['to'] = $idx;\n            }\n            // match identity name\n            if ($a_names[$found] && $ident['name'] && $a_names[$found] == $ident['name']) {\n                $from_idx = $idx;\n                break;\n            }\n        }\n    }\n\n    // If matching by name+address didn't find any matches,\n    // get first found identity (address) if any\n    if ($from_idx === null) {\n        $from_idx = $found_idx['from'] !== null ? $found_idx['from'] : $found_idx['to'];\n    }\n\n    // Try Return-Path\n    if ($from_idx === null && ($return_path = $MESSAGE->headers->others['return-path'])) {\n        $return_path = array_map('strtolower', (array) $return_path);\n\n        foreach ($identities as $idx => $ident) {\n            // Return-Path header contains an email address, but on some mailing list\n            // it can be e.g. <pear-dev-return-55250-local=domain.tld@lists.php.net>\n            // where local@domain.tld is the address we're looking for (#1489241)\n            $ident1 = strtolower($ident['email_ascii']);\n            $ident2 = str_replace('@', '=', $ident1);\n            $ident1 = '<' . $ident1 . '>';\n            $ident2 = '-' . $ident2 . '@';\n\n            foreach ($return_path as $path) {\n                if ($path == $ident1 || stripos($path, $ident2)) {\n                    $from_idx = $idx;\n                    break 2;\n                }\n            }\n        }\n    }\n\n    // See identity_select plugin for example usage of this hook\n    $plugin = rcmail::get_instance()->plugins->exec_hook('identity_select',\n        array('message' => $MESSAGE, 'identities' => $identities, 'selected' => $from_idx));\n\n    $selected = $plugin['selected'];\n\n    // default identity is always first on the list\n    return $identities[$selected !== null ? $selected : 0];\n}\n\n// Fixes some content-type names\nfunction rcmail_fix_mimetype($name)\n{\n    $map = array(\n        'image/x-ms-bmp' => 'image/bmp', // #1490282\n    );\n\n    $name = strtolower($name);\n\n    if ($alias = $map[$name]) {\n        $name = $alias;\n    }\n    // Some versions of Outlook create garbage Content-Type:\n    // application/pdf.A520491B_3BF7_494D_8855_7FAC2C6C0608\n    else if (preg_match('/^application\\/pdf.+/', $name)) {\n        $name = 'application/pdf';\n    }\n    // treat image/pjpeg (image/pjpg, image/jpg) as image/jpeg (#1489097)\n    else if (preg_match('/^image\\/p?jpe?g$/', $name)) {\n        $name = 'image/jpeg';\n    }\n\n    return $name;\n}\n\n// return attachment filename, handle empty filename case\nfunction rcmail_attachment_name($attachment, $display = false)\n{\n    global $RCMAIL;\n\n    $filename = (string) $attachment->filename;\n    $filename = preg_replace('/[\\x00-\\x1F\\x7F]/', '', $filename);\n\n    if ($filename === '') {\n        if ($attachment->mimetype == 'text/html') {\n            $filename = $RCMAIL->gettext('htmlmessage');\n        }\n        else {\n            $ext      = (array) rcube_mime::get_mime_extensions($attachment->mimetype);\n            $ext      = array_shift($ext);\n            $filename = $RCMAIL->gettext('messagepart') . ' ' . $attachment->mime_id;\n            if ($ext) {\n                $filename .= '.' . $ext;\n            }\n        }\n    }\n\n    // Display smart names for some known mimetypes\n    if ($display) {\n        if (preg_match('/application\\/(pgp|pkcs7)-signature/i', $attachment->mimetype)) {\n            $filename = $RCMAIL->gettext('digitalsig');\n        }\n    }\n\n    return $filename;\n}\n\nfunction rcmail_search_filter($attrib)\n{\n    global $RCMAIL;\n\n    if (!strlen($attrib['id'])) {\n        $attrib['id'] = 'rcmlistfilter';\n    }\n\n    $attrib['onchange'] = rcmail_output::JS_OBJECT_NAME.'.filter_mailbox(this.value)';\n\n    // Content-Type values of messages with attachments\n    // the same as in app.js:add_message_row()\n    $ctypes = array('application/', 'multipart/m', 'multipart/signed', 'multipart/report');\n\n    // Build search string of \"with attachment\" filter\n    $attachment = trim(str_repeat(' OR', count($ctypes)-1));\n    foreach ($ctypes as $type) {\n        $attachment .= ' HEADER Content-Type ' . rcube_imap_generic::escape($type);\n    }\n\n    $select = new html_select($attrib);\n    $select->add($RCMAIL->gettext('all'), 'ALL');\n    $select->add($RCMAIL->gettext('unread'), 'UNSEEN');\n    $select->add($RCMAIL->gettext('flagged'), 'FLAGGED');\n    $select->add($RCMAIL->gettext('unanswered'), 'UNANSWERED');\n    if (!$RCMAIL->config->get('skip_deleted')) {\n        $select->add($RCMAIL->gettext('deleted'), 'DELETED');\n        $select->add($RCMAIL->gettext('undeleted'), 'UNDELETED');\n    }\n    $select->add($RCMAIL->gettext('withattachment'), $attachment);\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('highest'), 'HEADER X-PRIORITY 1');\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('high'), 'HEADER X-PRIORITY 2');\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('normal'), 'NOT HEADER X-PRIORITY 1 NOT HEADER X-PRIORITY 2 NOT HEADER X-PRIORITY 4 NOT HEADER X-PRIORITY 5');\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('low'), 'HEADER X-PRIORITY 4');\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('lowest'), 'HEADER X-PRIORITY 5');\n\n    $RCMAIL->output->add_gui_object('search_filter', $attrib['id']);\n\n    return $select->show($_REQUEST['_search'] ? $_SESSION['search_filter'] : 'ALL');\n}\n\nfunction rcmail_search_interval($attrib)\n{\n    global $RCMAIL;\n\n    if (!strlen($attrib['id'])) {\n        $attrib['id'] = 'rcmsearchinterval';\n    }\n\n    $select = new html_select($attrib);\n    $select->add('', '');\n\n    foreach (array('1W', '1M', '1Y', '-1W', '-1M', '-1Y') as $value) {\n        $select->add($RCMAIL->gettext('searchinterval' . $value), $value);\n    }\n\n    $RCMAIL->output->add_gui_object('search_interval', $attrib['id']);\n\n    return $select->show($_REQUEST['_search'] ? $_SESSION['search_interval'] : '');\n}\n\nfunction rcmail_message_error()\n{\n    global $RCMAIL;\n\n    // Set env variables for messageerror.html template\n    if ($RCMAIL->action == 'show') {\n        $mbox_name = $RCMAIL->storage->get_folder();\n\n        $RCMAIL->output->set_env('mailbox', $mbox_name);\n        $RCMAIL->output->set_env('uid', null);\n    }\n\n    // display error message\n    $RCMAIL->output->show_message('messageopenerror', 'error');\n    // ... display message error page\n    $RCMAIL->output->send('messageerror');\n}\n\nfunction rcmail_message_import_form($attrib = array())\n{\n    global $RCMAIL;\n\n    $RCMAIL->output->add_label('selectimportfile','importwait');\n\n    $input_attr = array(\n        'multiple' => true,\n        'name'     => '_file[]',\n        'accept'   => \".eml, .mbox, message/rfc822, text/*\",\n    );\n\n    $attrib['prefix'] = html::tag('input', array('type' => 'hidden', 'name' => '_unlock', 'value' => ''))\n        . html::tag('input', array('type' => 'hidden', 'name' => '_framed', 'value' => '1'));\n\n    return $RCMAIL->upload_form($attrib, 'importform', 'import-messages', $input_attr);\n}\n\n/**\n * Add groups from the given address source to the address book widget\n */\nfunction rcmail_compose_contact_groups($abook, $source_id, $search = null, $search_mode = 0)\n{\n    global $RCMAIL, $OUTPUT;\n\n    $jsresult = array();\n    foreach ($abook->list_groups($search, $search_mode) as $group) {\n        $abook->reset();\n        $abook->set_group($group['ID']);\n\n        // group (distribution list) with email address(es)\n        if ($group['email']) {\n            foreach ((array)$group['email'] as $email) {\n                $row_id = 'G'.$group['ID'];\n                $jsresult[$row_id] = format_email_recipient($email, $group['name']);\n                $OUTPUT->command('add_contact_row', $row_id, array(\n                    'contactgroup' => html::span(array('title' => $email), rcube::Q($group['name']))), 'group');\n            }\n        }\n        // make virtual groups clickable to list their members\n        else if ($group['virtual']) {\n            $row_id = 'G'.$group['ID'];\n            $OUTPUT->command('add_contact_row', $row_id, array(\n                'contactgroup' => html::a(array(\n                    'href' => '#list',\n                    'rel' => $group['ID'],\n                    'title' => $RCMAIL->gettext('listgroup'),\n                    'onclick' => sprintf(\"return %s.command('pushgroup',{'source':'%s','id':'%s'},this,event)\",\n                                    rcmail_output::JS_OBJECT_NAME, $source_id, $group['ID']),\n                ), rcube::Q($group['name']) . '&nbsp;' . html::span('action', '&raquo;'))),\n                'group',\n                array('ID' => $group['ID'], 'name' => $group['name'], 'virtual' => true));\n        }\n        // show group with count\n        else if (($result = $abook->count()) && $result->count) {\n            $row_id = 'E'.$group['ID'];\n            $jsresult[$row_id] = $group['name'];\n            $OUTPUT->command('add_contact_row', $row_id, array(\n                'contactgroup' => rcube::Q($group['name'] . ' (' . intval($result->count) . ')')), 'group');\n        }\n    }\n\n    $abook->reset();\n    $abook->set_group(0);\n\n    return $jsresult;\n}\n\nfunction rcmail_save_attachment($message, $pid, $compose_id, $params = array())\n{\n    global $COMPOSE;\n\n    $rcmail  = rcmail::get_instance();\n    $storage = $rcmail->get_storage();\n\n    if ($pid) {\n        // attachment requested\n        $part     = $message->mime_parts[$pid];\n        $size     = $part->size;\n        $mimetype = $part->ctype_primary . '/' . $part->ctype_secondary;\n        $filename = $params['filename'] ?: rcmail_attachment_name($part);\n    }\n    else if (is_object($message)) {\n        // the whole message requested\n        $size     = $message->size;\n        $mimetype = 'message/rfc822';\n        $filename = $params['filename'] ?: 'message_rfc822.eml';\n    }\n    else if (is_string($message)) {\n        // the whole message requested\n        $size     = strlen($message);\n        $data     = $message;\n        $mimetype = $params['mimetype'];\n        $filename = $params['filename'];\n    }\n\n    if (!isset($data)) {\n        // don't load too big attachments into memory\n        if (!rcube_utils::mem_check($size)) {\n            $temp_dir = unslashify($rcmail->config->get('temp_dir'));\n            $path     = tempnam($temp_dir, 'rcmAttmnt');\n\n            if ($fp = fopen($path, 'w')) {\n                if ($pid) {\n                    // part body\n                    $message->get_part_body($pid, false, 0, $fp);\n                }\n                else {\n                    // complete message\n                    $storage->get_raw_body($message->uid, $fp);\n                }\n\n                fclose($fp);\n            }\n            else {\n                return false;\n            }\n        }\n        else if ($pid) {\n            // part body\n            $data = $message->get_part_body($pid);\n        }\n        else {\n            // complete message\n            $data = $storage->get_raw_body($message->uid);\n        }\n    }\n\n    $attachment = array(\n        'group'      => $compose_id,\n        'name'       => $filename,\n        'mimetype'   => $mimetype,\n        'content_id' => $part ? $part->content_id : null,\n        'data'       => $data,\n        'path'       => $path,\n        'size'       => $path ? filesize($path) : strlen($data),\n        'charset'    => $part ? $part->charset : $params['charset'],\n    );\n\n    $attachment = $rcmail->plugins->exec_hook('attachment_save', $attachment);\n\n    if ($attachment['status']) {\n        unset($attachment['data'], $attachment['status'], $attachment['content_id'], $attachment['abort']);\n\n        // rcube_session::append() replaces current session data with the old values\n        // (in rcube_session::reload()). This is a problem in 'compose' action, because before\n        // the first append() use we set some important data in the session.\n        // It also overwrites attachments list. Fixing reload() is not so simple if possible\n        // as we don't really know what has been added and what removed in meantime.\n        // So, for now we'll do not use append() on 'compose' action (#1490608).\n\n        if ($rcmail->action == 'compose') {\n            $COMPOSE['attachments'][$attachment['id']] = $attachment;\n        }\n        else {\n            $rcmail->session->append('compose_data_' . $compose_id . '.attachments', $attachment['id'], $attachment);\n        }\n\n        return $attachment;\n    }\n    else if ($path) {\n        @unlink($path);\n    }\n\n    return false;\n}\n\n// Return mimetypes supported by the browser\nfunction rcmail_supported_mimetypes()\n{\n    $rcmail = rcube::get_instance();\n\n    // mimetypes supported by the browser (default settings)\n    $mimetypes = (array) $rcmail->config->get('client_mimetypes');\n\n    // Remove unsupported types, which makes that attachment which cannot be\n    // displayed in a browser will be downloaded directly without displaying an overlay page\n    if (empty($_SESSION['browser_caps']['pdf']) && ($key = array_search('application/pdf', $mimetypes)) !== false) {\n        unset($mimetypes[$key]);\n    }\n\n    if (empty($_SESSION['browser_caps']['flash']) && ($key = array_search('application/x-shockwave-flash', $mimetypes)) !== false) {\n        unset($mimetypes[$key]);\n    }\n\n    foreach (array('tiff', 'webp') as $type) {\n        if (empty($_SESSION['browser_caps'][$type]) && ($key = array_search('image/' . $type, $mimetypes)) !== false) {\n            // can we convert it to jpeg?\n            if (!rcube_image::is_convertable('image/' . $type)) {\n                unset($mimetypes[$key]);\n            }\n        }\n    }\n\n    // @TODO: support mail preview for compose attachments\n    if ($rcmail->action != 'compose' && !in_array('message/rfc822', $mimetypes)) {\n        $mimetypes[] = 'message/rfc822';\n    }\n\n    return array_values($mimetypes);\n}\n", "<?php\n\n/**\n +-----------------------------------------------------------------------+\n | program/steps/mail/show.inc                                           |\n |                                                                       |\n | This file is part of the Roundcube Webmail client                     |\n | Copyright (C) 2005-2013, The Roundcube Dev Team                       |\n |                                                                       |\n | Licensed under the GNU General Public License version 3 or            |\n | any later version with exceptions for skins & plugins.                |\n | See the README file for a full license statement.                     |\n |                                                                       |\n | PURPOSE:                                                              |\n |   Display a mail message similar as a usual mail application does     |\n |                                                                       |\n +-----------------------------------------------------------------------+\n | Author: Thomas Bruederli <roundcube@gmail.com>                        |\n +-----------------------------------------------------------------------+\n*/\n\n$PRINT_MODE = $RCMAIL->action == 'print';\n\n// Read browser capabilities and store them in session\nif ($caps = rcube_utils::get_input_value('_caps', rcube_utils::INPUT_GET)) {\n    $browser_caps = array();\n    foreach (explode(',', $caps) as $cap) {\n        $cap = explode('=', $cap);\n        $browser_caps[$cap[0]] = $cap[1];\n    }\n    $_SESSION['browser_caps'] = $browser_caps;\n}\n\n$msg_id    = rcube_utils::get_input_value('_uid', rcube_utils::INPUT_GET);\n$uid       = preg_replace('/\\.[0-9.]+$/', '', $msg_id);\n$mbox_name = $RCMAIL->storage->get_folder();\n\n// similar code as in program/steps/mail/get.inc\nif ($uid) {\n    // set message format (need to be done before rcube_message construction)\n    if (!empty($_GET['_format'])) {\n        $prefer_html = $_GET['_format'] == 'html';\n        $RCMAIL->config->set('prefer_html', $prefer_html);\n        $_SESSION['msg_formats'][$mbox_name.':'.$uid] = $prefer_html;\n    }\n    else if (isset($_SESSION['msg_formats'][$mbox_name.':'.$uid])) {\n        $RCMAIL->config->set('prefer_html', $_SESSION['msg_formats'][$mbox_name.':'.$uid]);\n    }\n\n    $MESSAGE = new rcube_message($msg_id, $mbox_name, intval($_GET['_safe']));\n\n    // if message not found (wrong UID)...\n    if (empty($MESSAGE->headers)) {\n        rcmail_message_error($uid);\n    }\n\n    // show images?\n    rcmail_check_safe($MESSAGE);\n\n    // set message charset as default\n    if (!empty($MESSAGE->headers->charset)) {\n        $RCMAIL->storage->set_charset($MESSAGE->headers->charset);\n    }\n\n    $OUTPUT->set_pagetitle(abbreviate_string($MESSAGE->subject, 128, '...', true));\n\n    // set message environment\n    $OUTPUT->set_env('uid', $msg_id);\n    $OUTPUT->set_env('safemode', $MESSAGE->is_safe);\n    $OUTPUT->set_env('message_context', $MESSAGE->context);\n    $OUTPUT->set_env('sender', $MESSAGE->sender['string']);\n    $OUTPUT->set_env('mailbox', $mbox_name);\n    $OUTPUT->set_env('username', $RCMAIL->get_user_name());\n    $OUTPUT->set_env('permaurl', $RCMAIL->url(array('_action' => 'show', '_uid' => $msg_id, '_mbox' => $mbox_name)));\n\n    if ($MESSAGE->headers->get('list-post', false)) {\n        $OUTPUT->set_env('list_post', true);\n    }\n\n    // set environment\n    $OUTPUT->set_env('delimiter', $RCMAIL->storage->get_hierarchy_delimiter());\n    $OUTPUT->set_env('mimetypes', rcmail_supported_mimetypes());\n\n    // set configuration\n    $RCMAIL->set_env_config(array('delete_junk', 'flag_for_deletion', 'read_when_deleted',\n        'skip_deleted', 'display_next', 'forward_attachment'));\n\n    // set special folders\n    foreach (array('drafts', 'trash', 'junk') as $mbox) {\n        if ($folder = $RCMAIL->config->get($mbox . '_mbox')) {\n            $OUTPUT->set_env($mbox . '_mailbox', $folder);\n        }\n    }\n\n    if ($MESSAGE->has_html_part()) {\n        $prefer_html = $RCMAIL->config->get('prefer_html');\n        $OUTPUT->set_env('optional_format', $prefer_html ? 'text' : 'html');\n    }\n\n    if (!$OUTPUT->ajax_call) {\n        $OUTPUT->add_label('checkingmail', 'deletemessage', 'movemessagetotrash',\n            'movingmessage', 'deletingmessage', 'markingmessage', 'replyall', 'replylist');\n    }\n\n    // check for unset disposition notification\n    if ($MESSAGE->headers->mdn_to\n        && $MESSAGE->context === null\n        && empty($MESSAGE->headers->flags['MDNSENT'])\n        && empty($MESSAGE->headers->flags['SEEN'])\n        && ($RCMAIL->storage->check_permflag('MDNSENT') || $RCMAIL->storage->check_permflag('*'))\n        && $mbox_name != $RCMAIL->config->get('drafts_mbox')\n        && $mbox_name != $RCMAIL->config->get('sent_mbox')\n    ) {\n        $mdn_cfg = intval($RCMAIL->config->get('mdn_requests'));\n\n        if ($mdn_cfg == 1 || (($mdn_cfg == 3 || $mdn_cfg ==  4) && rcmail_contact_exists($MESSAGE->sender['mailto']))) {\n            // Send MDN\n            if (rcmail_send_mdn($MESSAGE, $smtp_error))\n                $OUTPUT->show_message('receiptsent', 'confirmation');\n            else if ($smtp_error)\n                $OUTPUT->show_message($smtp_error['label'], 'error', $smtp_error['vars']);\n            else\n                $OUTPUT->show_message('errorsendingreceipt', 'error');\n        }\n        else if ($mdn_cfg != 2 && $mdn_cfg != 4) {\n            // Ask user\n            $OUTPUT->add_label('mdnrequest');\n            $OUTPUT->set_env('mdn_request', true);\n        }\n    }\n\n    if (empty($MESSAGE->headers->flags['SEEN']) && $MESSAGE->context === null) {\n        $v = intval($RCMAIL->config->get('mail_read_time'));\n        if ($v > 0) {\n            $OUTPUT->set_env('mail_read_time', $v);\n        }\n        else if ($v == 0) {\n            $RCMAIL->output->command('set_unread_message', $MESSAGE->uid, $mbox_name);\n            $RCMAIL->plugins->exec_hook('message_read', array(\n                    'uid'     => $MESSAGE->uid,\n                    'mailbox' => $mbox_name,\n                    'message' => $MESSAGE,\n            ));\n\n            $set_seen_flag = true;\n        }\n    }\n}\n\n\n$OUTPUT->add_handlers(array(\n    'messageattachments' => 'rcmail_message_attachments',\n    'mailboxname'        => 'rcmail_mailbox_name_display',\n    'messageobjects'     => 'rcmail_message_objects',\n    'contactphoto'       => 'rcmail_message_contactphoto',\n));\n\n\nif ($RCMAIL->action == 'print' && $OUTPUT->template_exists('messageprint'))\n    $OUTPUT->send('messageprint', false);\nelse if ($RCMAIL->action == 'preview' && $OUTPUT->template_exists('messagepreview'))\n    $OUTPUT->send('messagepreview', false);\nelse\n    $OUTPUT->send('message', false);\n\n\n// mark message as read\nif (!empty($set_seen_flag)) {\n    if ($RCMAIL->storage->set_flag($MESSAGE->uid, 'SEEN', $mbox_name)) {\n        if ($count = rcmail_get_unseen_count($mbox_name)) {\n            rcmail_set_unseen_count($mbox_name, $count - 1);\n        }\n    }\n}\n\nexit;\n\n\nfunction rcmail_message_attachments($attrib)\n{\n    global $PRINT_MODE, $MESSAGE, $RCMAIL;\n\n    $out = $ol = '';\n    $attachments = array();\n\n    if (count($MESSAGE->attachments)) {\n        foreach ($MESSAGE->attachments as $attach_prop) {\n            $filename = rcmail_attachment_name($attach_prop, true);\n            $filesize = $RCMAIL->message_part_size($attach_prop);\n\n            if ($PRINT_MODE) {\n                $ol .= html::tag('li', array('id' => 'attach' . $attach_prop->mime_id),\n                    rcube::Q(sprintf(\"%s (%s)\", $filename, $filesize)));\n            }\n            else {\n                if ($attrib['maxlength'] && mb_strlen($filename) > $attrib['maxlength']) {\n                    $title    = $filename;\n                    $filename = abbreviate_string($filename, $attrib['maxlength']);\n                }\n                else {\n                    $title = '';\n                }\n\n                $size     = ' ' . html::span('attachment-size', '(' . rcube::Q($filesize) . ')');\n                $mimetype = rcmail_fix_mimetype($attach_prop->mimetype);\n                $class    = rcube_utils::file2class($mimetype, $filename);\n                $id       = 'attach' . $attach_prop->mime_id;\n                $link     = html::a(array(\n                    'href'        => $MESSAGE->get_part_url($attach_prop->mime_id, false),\n                    'onclick'     => sprintf('return %s.command(\\'load-attachment\\',\\'%s\\',this)',\n                        rcmail_output::JS_OBJECT_NAME, $attach_prop->mime_id),\n                    'onmouseover' => $title ? '' : 'rcube_webmail.long_subject_title_ex(this, 0)',\n                    'title'       => $title,\n                    ), rcube::Q($filename) . $size);\n\n                $ol .= html::tag('li', array('class' => $class, 'id' => $id), $link);\n\n                $attachments[$attach_prop->mime_id] = $mimetype;\n            }\n        }\n\n        $out = html::tag('ul', $attrib, $ol, html::$common_attrib);\n\n        $RCMAIL->output->set_env('attachments', $attachments);\n        $RCMAIL->output->add_gui_object('attachments', $attrib['id']);\n    }\n\n    return $out;\n}\n\nfunction rcmail_remote_objects_msg()\n{\n    global $MESSAGE, $RCMAIL;\n\n    $attrib['id']    = 'remote-objects-message';\n    $attrib['class'] = 'notice';\n    $attrib['style'] = 'display: none';\n\n    $msg = rcube::Q($RCMAIL->gettext('blockedimages')) . '&nbsp;';\n    $msg .= html::a(array(\n            'href'    => \"#loadimages\",\n            'onclick' => rcmail_output::JS_OBJECT_NAME.\".command('load-images')\"\n        ),\n        rcube::Q($RCMAIL->gettext('showimages')));\n\n    // add link to save sender in addressbook and reload message\n    if ($MESSAGE->sender['mailto'] && $RCMAIL->config->get('show_images') == 1) {\n        $msg .= ' ' . html::a(array(\n                'href'    => \"#alwaysload\",\n                'onclick' => rcmail_output::JS_OBJECT_NAME.\".command('always-load')\",\n                'style'   => \"white-space:nowrap\"\n            ),\n            rcube::Q($RCMAIL->gettext(array('name' => 'alwaysshow', 'vars' => array('sender' => $MESSAGE->sender['mailto'])))));\n    }\n\n    $RCMAIL->output->add_gui_object('remoteobjectsmsg', $attrib['id']);\n\n    return html::div($attrib, $msg);\n}\n\nfunction rcmail_message_buttons()\n{\n    global $RCMAIL, $MESSAGE;\n\n    $delim = $RCMAIL->storage->get_hierarchy_delimiter();\n    $dbox  = $RCMAIL->config->get('drafts_mbox');\n\n    // the message is not a draft\n    if ($MESSAGE->folder != $dbox && strpos($MESSAGE->folder, $dbox.$delim) !== 0) {\n        return '';\n    }\n\n    $attrib['id']    = 'message-buttons';\n    $attrib['class'] = 'notice';\n\n    $msg = rcube::Q($RCMAIL->gettext('isdraft')) . '&nbsp;';\n    $msg .= html::a(array(\n            'href'    => \"#edit\",\n            'onclick' => rcmail_output::JS_OBJECT_NAME.\".command('edit')\"\n        ),\n        rcube::Q($RCMAIL->gettext('edit')));\n\n    return html::div($attrib, $msg);\n}\n\nfunction rcmail_message_objects($attrib)\n{\n    global $RCMAIL, $MESSAGE;\n\n    if (!$attrib['id'])\n        $attrib['id'] = 'message-objects';\n\n    $content = array(\n        rcmail_message_buttons(),\n        rcmail_remote_objects_msg(),\n    );\n\n    $plugin = $RCMAIL->plugins->exec_hook('message_objects',\n        array('content' => $content, 'message' => $MESSAGE));\n\n    $content = implode(\"\\n\", $plugin['content']);\n\n    return html::div($attrib, $content);\n}\n\nfunction rcmail_contact_exists($email)\n{\n    global $RCMAIL;\n\n    if ($email) {\n        // @TODO: search in all address books?\n        $CONTACTS = $RCMAIL->get_address_book(-1, true);\n\n        if (is_object($CONTACTS)) {\n            $existing = $CONTACTS->search('email', $email, 1, false);\n            if ($existing->count) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\nfunction rcmail_message_contactphoto($attrib)\n{\n    global $RCMAIL, $MESSAGE;\n\n    $placeholder = $attrib['placeholder'] ? $RCMAIL->output->abs_url($attrib['placeholder'], true) : null;\n    $placeholder = $RCMAIL->output->asset_url($placeholder ?: 'program/resources/blank.gif');\n\n    if ($MESSAGE->sender) {\n        $photo_img = $RCMAIL->url(array(\n            '_task'   => 'addressbook',\n            '_action' => 'photo',\n            '_email'  => $MESSAGE->sender['mailto'],\n        ));\n\n        $attrib['onerror'] = \"this.src = '$placeholder'\";\n    }\n    else {\n        $photo_img = $placeholder;\n    }\n\n    return html::img(array('src' => $photo_img, 'alt' => $RCMAIL->gettext('contactphoto')) + $attrib);\n}\n"], "fixing_code": ["CHANGELOG Roundcube Webmail\n===========================\n\n- Security: Fix cross-site scripting (XSS) via malicious XML attachment\n\nRELEASE 1.3.12\n--------------\n- Security: Better fix for CVE-2020-12641\n- Security: Fix XSS issue in template object 'username' (#7406)\n- Security: Fix couple of XSS issues in Installer (#7406)\n\nRELEASE 1.3.11\n--------------\n- Enigma: Fix compatibility with Mail_Mime >= 1.10.5\n- Fix permissions on some folders created by bin/install-jsdeps.sh script (#6930)\n- Fix bug where inline images could have been ignored if Content-Id header contained redundant spaces (#6980)\n- Fix PHP Warning: Use of undefined constant LOG_EMERGE (#6991)\n- Fix PHP warning: \"array_merge(): Expected parameter 2 to be an array, null given in sendmail.inc (#7003)\n- Security: Fix XSS issue in handling of CDATA in HTML messages\n- Security: Fix remote code execution via crafted 'im_convert_path' or 'im_identify_path' settings\n- Security: Fix local file inclusion (and code execution) via crafted 'plugins' option\n- Security: Fix CSRF bypass that could be used to log out an authenticated user (#7302)\n\nRELEASE 1.3.10\n--------------\n- Managesieve: Fix so \"Create filter\" option does not show up when Filters menu is disabled (#6723)\n- Enigma: Fix bug where revoked users/keys were not greyed out in key info\n- Enigma: Fix error message when trying to encrypt with a revoked key (#6607)\n- Enigma: Fix \"decryption oracle\" bug [CVE-2019-10740] (#6638)\n- Fix compatibility with kolab/net_ldap3 > 1.0.7 (#6785)\n- Fix bug where bmp images couldn't be displayed on some systems (#6728)\n- Fix bug in parsing vCard data using PHP 7.3 due to an invalid regexp (#6744)\n- Fix bug where bold/strong text was converted to upper-case on html-to-text conversion (6758)\n- Fix bug in rcube_utils::parse_hosts() where %t, %d, %z could return only tld (#6746)\n- Fix bug where Next/Prev button in mail view didn't work with multi-folder search result (#6793)\n- Fix bug where selection of columns on messages list wasn't working\n- Fix bug in converting multi-page Tiff images to Jpeg (#6824)\n- Fix wrong messages order after returning to a multi-folder search result (#6836)\n- Fix PHP 7.4 deprecation: implode() wrong parameter order (#6866)\n- Fix bug where it was possible to bypass the position:fixed CSS check in received messages (#6898)\n- Fix bug where some strict remote URIs in url() style were unintentionally blocked (#6899)\n- Fix bug where it was possible to bypass the CSS jail in HTML messages using :root pseudo-class (#6897)\n- Fix bug where it was possible to bypass href URI check with data:application/xhtml+xml URIs (#6896)\n\nRELEASE 1.3.9\n-------------\n- Fix TinyMCE download location (#6694)\n- Fix bug where a message/rfc822 part without a filename wasn't listed on the attachments list (#6494)\n- Fix handling of empty entries in vCard import (#6564)\n- Fix bug in parsing some IMAP command responses that include unsolicited replies (#6577)\n- Fix PHP 7.2 compatibility in debug_logger plugin (#6586)\n- Fix so ANY record is not used for email domain validation, use A, MX, CNAME, AAAA instead (#6581)\n- Fix so mime_content_type check in Installer uses files that should always be available (i.e. from program/resources) (#6599)\n- Fix missing CSRF token on a link to download too-big message part (#6621)\n- Fix bug when aborting dragging with ESC key didn't stop the move action (#6623)\n- Fix bug where next row wasn't selected after deleting a collapsed thread (#6655)\n\nRELEASE 1.3.8\n-------------\n- Fix PHP warnings on dummy QUOTA responses in Courier-IMAP 4.17.1 (#6374)\n- Fix so fallback from BINARY to BODY FETCH is used also on [PARSE] errors in dovecot 2.3 (#6383)\n- Enigma: Fix deleting keys with authentication subkeys (#6381)\n- Fix invalid regular expressions that throw warnings on PHP 7.3 (#6398)\n- Fix so Classic skin splitter does not escape out of window (#6397)\n- Fix XSS issue in handling invalid style tag content (#6410)\n- Fix compatibility with MySQL 8 - error on 'system' table use\n- Managesieve: Fix bug where show_real_foldernames setting wasn't respected (#6422)\n- New_user_identity: Fix %fu/%u vars substitution in user specific LDAP params (#6419)\n- Fix support for \"allow-from <uri>\" in \"x_frame_options\" config option (#6449)\n- Fix bug where valid content between HTML comments could have been skipped in some cases (#6464)\n- Fix multiple VCard field search (#6466)\n- Fix session issue on long running requests (#6470)\n\nRELEASE 1.3.7\n-------------\n- Fix PHP Warning: Use of undefined constant IDNA_DEFAULT on systems without php-intl (#6244)\n- Fix bug where some parts of quota information could have been ignored (#6280)\n- Fix bug where some escape sequences in html styles could bypass security checks\n- Fix bug where some forbidden characters on Cyrus-IMAP were not prevented from use in folder names\n- Fix bug where only attachments with the same name would be ignored on zip download (#6301)\n- Fix bug where unicode contact names could have been broken/emptied or caused DB errors (#6299)\n- Fix bug where after \"mark all folders as read\" action message counters were not reset (#6307)\n- Enigma: [EFAIL] Don't decrypt PGP messages with no MDC protection (#6289)\n- Fix bug where some HTML comments could have been malformed by HTML parser (#6333)\n\nRELEASE 1.3.6\n-------------\n- Fix parsing date strings (e.g. from a Date: mail header) with comments (#6216)\n- Fix PHP 7.2: count(): Parameter must be an array in enchant-based spellchecker (#6234)\n- Fix possible IMAP command injection and type juggling vulnerabilities (#6229)\n- Enigma: Fix key selection for signing\n- Enigma: Enable keypair generation on Internet Explorer 11\n- Fix check_request() bypass in places using get_uids() [CVE-2018-9846] (#6238)\n- Fix bug where usernames without domain part could be malformed or converted to lower-case on logon (#6224)\n\nRELEASE 1.3.5\n-------------\n- Managesieve: Fix bug where text: syntax was forced for strings longer than 1024 characters (#6143)\n- Managesieve: Fix missing Save button in Edit Filter Set page of Classic skin (#6154)\n- Fix duplicated labels in Test SMTP Config section (#6166)\n- Fix PHP Warning: exif_read_data(...): Illegal IFD size (#6169)\n- Enigma: Fix key generation in Safari by upgrade to OpenPGP 2.6.2 (#6149)\n- Fix security issue in remote content blocking on HTML image and style tags (#6178)\n- Added 9pt and 11pt to the list of font sizes in HTML editor\n- Fix handling encoding of HTML tags in \"inline\" JSON output (#6207)\n- Fix bug where some unix timestamps were not handled correctly by rcube_utils::anytodatetime() (#6212)\n\nRELEASE 1.3.4\n-------------\n- Fix bug where contacts search could skip some records (#6130)\n- Fix possible information leak - add more strict sql error check on user creation (#6125)\n- Fix a couple of warnings on PHP 7.2 (#6098)\n- Fix broken long filenames when using imap4d server - workaround server bug (#6048)\n- Fix so temp_dir misconfiguration prints an error to the log (#6045)\n- Fix untagged COPYUID responses handling - again (#5982)\n- Fix PHP warning \"idn_to_utf8(): INTL_IDNA_VARIANT_2003 is deprecated\" with PHP 7.2 (#6075)\n- Fix bug where Archive folder wasn't auto-created on login with create_default_folders=true\n- Fix performance issue when parsing malformed and long Date header (#6087)\n- Fix syntax error in mssql.initial.sql (#6097)\n- Fix bug where contacts export by selection returned no more than 10 entries (#6103)\n- Fix searching contacts by address in LDAP source (#6084)\n- Fix X-Frame-Options:ALLOW-FROM support, remove custom click-jacking protection (#6057)\n\nRELEASE 1.3.3\n-------------\n- Fix decoding of mailto: links with + character in HTML messages (#6020)\n- Fix false reporting of failed upgrade in installto.sh (#6019)\n- Fix file disclosure vulnerability caused by insufficient input validation [CVE-2017-16651] (#6026)\n- Fix mangled non-ASCII characters in links in HTML messages (#6028)\n\nRELEASE 1.3.2\n-------------\n- Improve detection for Egde browser and add pointer event support (#5922)\n- Fix bug where pink image was used instead of a thumbnail when image resize fails (#5933)\n- Fix so files size/count limit is verified (client-side) also on drag-n-drop uploads (#5940)\n- Fix invalid template loading on a message error in preview frame (#5941)\n- Fix bug where HTML messages could have been rendered empty on some systems (#5957)\n- Fix wording of \"Mark previewed messages as read\" to \"Mark messages as read\" (#5952)\n- Enigma: Fix decryption of messages encoded with non-ascii charset (#5962)\n- Fix missing cursor in HTML editor on mail reply (#5969)\n- Fix (again) bug where image data URIs in css style were treated as evil/remote in mail preview (#5580)\n- Fix bug where mail search could return empty result on servers without SORT capability (#5973)\n- Fix bug where assets_path wasn't added to some watermark frames\n- Fix so untagged COPYUID responses are also supported according to RFC6851 (#5982)\n- Fix issue caused by non-default session.cookie_lifetime setting (#5961)\n- Fix Edge encoding bug when pasting text into the HTML editor, update to TinyMCE 4.5.8 (#5885)\n- Fix handling of unknown Content-Disposition type (#6002)\n- Fix truncated folder name on messages list in multi-folder mode, for folders with non-ascii characters (#6004)\n- Fix bug where removing the last subfolder did not hide toggle button on its parent record (#6007)\n- Fix bug where ghost messages could be added to the list after fast delete (#5941)\n\nRELEASE 1.3.1\n-------------\n- Don't ignore (global) userlogins/sendmail logs in per_user_logging mode\n- Add Preferences > Mailbox View > Main Options > Layout (#5829)\n- Password: Fix compatibility with PHP 7+ in cpanel_webmail driver (#5820)\n- Managesieve: Fix parsing dot-staffed lines in multiline text (#5838)\n- Managesieve: Fix AM/PM suffix in vacation time selectors\n- Managesieve: Fix bug where 'exists' operator was reset to 'contains' (#5899)\n- Remove non-printable characters from filenames on download/display (#5880)\n- Fix decoding non-ascii attachment names from TNEF attachments (#5646, #5799)\n- Fix uninitialized string offset in rcube_utils::bin2ascii() and make sure rcube_utils::random_bytes() result has always requested length (#5788)\n- Fix bug where HTML messages with @media styles could moddify style of page body (#5811)\n- Fix style issue on selected and unfocused message that is part of a thread (#5798)\n- Fix bug where a.button style from managesieve plugin could impact other elements (#5800)\n- Fix position of selected icon for (Mailvelope) Encrypt button\n- Fix fatal error when using DMY- or MDY-based date format in PostgreSQL (#5808)\n- Fix bug where errors were not printed when using bin/update.sh (#5834)\n- Fix PHP 7.2 warnings on count() use (#5845)\n- Fix bug where Chrome could not upload the same file that was selected before (#5854)\n- Fix duplicate messages on the list after deleting messages on the next to the last page (#5862)\n- Fix bug where messages count was not updated after delete when imap_cache is set (#5872)\n- Fix potential XSS vulnerability with malformed HTML message markup\n- Fix sending message with \"Too many public recipients\" dialog buttons (#5924)\n- Bring back double-click behavior on the message list which was removed in 1.3.0 (#5823)\n- Enigma: Fix decrypting an encrypted+signed message when signature verification fails (#5914)\n\nRELEASE 1.3.0\n-------------\n- Update to TinyMCE 4.5.7\n- Fix bug where invalid recipients could be silently discarded (#5739)\n- Fix conflict with _gid cookie of Google Analytics (#5748)\n- Print error from CLI scripts when system/exec function is disabled (#5744)\n- Fix bug where comment notation within style tag would cause the whole style to be ignored (#5747)\n- Fix bug where it wasn't possible to scroll folders list in Edge (#5750)\n- Fix folders list sorting on Windows - if php-intl is available (#5732)\n- Fix addressbook searching by gender (#5757)\n- Fix prevention from using % and * characters in folder name (#5762)\n- Fix POST parameter reflection in default_charset selector (#5768)\n- Enigma: Fix compatibility with assets_dir\n- Managesieve: Skip redundant LISTSCRIPTS command\n- Fix SQL syntax error on MariaDB 10.2 (#5774)\n- Fix bug where zipdownload ignored files with the same name (#5777)\n- Fix bug where it wasn't possible to set timezone to auto-detected value (#5782)\n\nRELEASE 1.3-rc\n--------------\n- \"Flattened\" the larry theme: fresher look by removing shadows and gradients\n- Support logging to php://stdout (#5721)\n- Add support for DelSp=Yes in format=flowed messages (#5702)\n- Update to jQuery 3.2.1\n- Update to TinyMCE 4.5.6\n- Plugin API: Call message_part_structure hook for sub-parts of multipart/alternative message (#5678)\n- Enigma: Always use detached signatures (#5624)\n- Enigma: Fix handling of messages with nested PGP encrypted parts (#5634)\n- Minimize unwanted message loading in preview frame on drag (#5616)\n- Fix failing database schema check in all engines except mysql (#5730)\n- Fix autocomplete popup closing with click outside the input, don't handle Tab key as Enter (#5606)\n- Fix jsdeps.json synchronization on update, warn about missing requirements of install-jsdeps.sh (#5598)\n- Fix missing thread expand icon on search result in widescreen mode (#5613)\n- Fix bug where image data URIs in css style were treated as evil/remote in mail preview (#5580)\n- Fix bug where external content in src attribute of input/video tags was not secured (#5583)\n- Fix PHP error on update of a contact with multiple email addresses when using PHP 7.1 (#5587)\n- Fix bug where mail content frame couldn't be reset in some corner cases (#5608)\n- Fix bug where some classic skin images were not displayed in IE/Edge (#5614)\n- Fix bug where signature couldn't be added above the quote in Firefox 51 (#5628)\n- Fix regression where groups with email address were resolved to its members' addresses\n- Fix update of group name in the contacts list header on group rename (#5648)\n- Add rewrite rule to disable access to /vendor/bin folder in .htaccess (#5630)\n- Fix bug where it was too easy accidentally move a folder when using the subscription checkbox (#5655)\n- Managesieve: Fix parser issue with empty lines between comments (#5657)\n- Managesieve: Fix possible defect in handling \\r\\n in scripts (#5685)\n- Fix/rephrase \"unsaved changes\" warning when cancelling a draft (#5610)\n- Fix XSS issue in handling of a style tag inside of an svg element [CVE-2017-6820]\n- Fix bug where settings/upload.inc could not be used by plugins (#5694)\n- Fix regression in LDAP fuzzy search where it always used prefix search instead (#5713)\n- Fix bug where namespace prefix could not be truncated on folders list if show_real_foldernames=true (#5695)\n- Fix undesired effects when postgres database uses different timezone than PHP host (#5708)\n- Installer: Fix DB schema initialization on MS SQL Server\n- Fix bug where base_dn setting was ignored inside group_filters (#5720)\n- Password: Fix security issue in virtualmin and sasl drivers [CVE-2017-8114]\n\nRELEASE 1.3-beta\n----------------\n- Nicely handle contact deletion on contact edit (#5522)\n- vcard_attachments: Add possibility to attach contact vCard to composed message (#4997)\n- Preserve message internal/received date on import in mbox format (#5559)\n- Zipdownload: Fix date format in mbox \"From line\"\n- Possibility to display QR code for contacts data (#5030)\n- Added identicon plugin\n- Widescreen layout aka three column view (#5093)\n- Unify automatic marking as \\Seen in preview pane, full-page and extwin views (#5071)\n- Disable double-click on the list when preview pane is on (#5199)\n- Support hostname and hostname:port in force_https option (#5511)\n- Support ALLOW-FROM in x_frame_options (#5122)\n- Allow to omit a subject when sending an email (#5068)\n- Warn about too many disclosed recipients in composed email [max_disclosed_recipients] (#5132)\n- identity_select: Support Received header (#5085)\n- Plugin API: Added get_compose_responses hook (#5457)\n- Display error when trying to upload more files than specified in max_file_uploads (#5483)\n- Add missing sql upgrade file for 'ip' column resize in session table (#5465)\n- Do not show inline images of unsupported mimetype (#5463)\n- Password: Added replacement variables support in password_pop_host (#5539)\n- Password: Don't store passwords in temp files when using dovecotpw (#5531)\n- Password: Added LDAP PPolicy driver (#5364)\n- Password: Added cpanel_webmail driver (#5549)\n- Password: Added possibility to nicely redirect from other plugins on password expiration (#5468)\n- Implement separate action to mark all messages in a folder as \\Seen (#5006)\n- Implement marking as \\Seen in all folders or in a folder and its subfolders (#5076)\n- Archive: Don't reload messages list when it's not needed (#5225)\n- Archive: Add option to automatically mark archived messages as \\Seen (#5142)\n- Improve randomness of password salts and random hashes (#5266)\n- Password/cPanel: Add support for hash authentication and reseller accounts (#5252)\n- Support host-specific imap_conn_options/smtp_conn_options/managesieve_conn_options (#5136)\n- Center and scale images in attachment preview frame (#5421)\n- Added max_message_size option enforced when attaching files to a composed message (#4993)\n- Added Search button in quick search menus (#5312)\n- Implement \"one click\" attachment/messages/photo upload (#5024)\n- Squirrelmail_usercopy: Add option to define character set of data files\n- Removed useless 'created' column from 'session' table (#5389)\n- Dropped legacy browsers support (#5167)\n    - Removed legacy_browser plugin\n    - Removed hacks for IE < 10\n    - Update to jQuery 3.1.1 and jQuery-UI 1.12.0\n    - compile .min.js files with ECMASCRIPT5 option\n- Require PHP >= 5.4\n- Add possibility to preview and download attachments in mail compose (#5053)\n- Add possibility to rename attachments in mail compose (#4996)\n- Remove backward compatibility \"layer\" of bc.php (#4902)\n- Support WEBP images in mail messages (#5362)\n- Support MathML in HTML message preview (#5182)\n- Rename Addressbook to Contacts (#5233)\n- Remove PHP mail() support, smtp_server is required now (#5340)\n- Display full message subject in onmouseover on truncated subject in mail view (#5346)\n- Enigma: Support GnuPG 2.1 (#5313)\n- Enigma: Support key generation for multiple identities (#5383)\n- Enigma: Import keys from key-server(s) (#5286)\n- Enigma: Search missing public keys on a key-server in mail compose (#5286)\n- Enigma: Delete user keys when using deluser.sh script\n- Enigma: Fix redundant list-secret-keys/list-public-keys calls on signing/encryption\n- Enigma: Implement PGP encryption and signing in one go (#5302)\n- Enigma: Display signature verification status for encrypted+signed messages (#5302)\n- Display different attachment icon on encrypted messages\n- Display different confirmation text when moving messages to Trash (#5220)\n- Indicate that a collapsed thread has flagged children (#5013)\n- Implemented message/rfc822 attachment preview\n- Update to jsTimezoneDetect 1.0.6\n- Managesieve: Add (optional) RAW script editor (#5414)\n- Managesieve: Add option to automatically set vacation :from address (#5428)\n- Managesieve: Support 'string' test from variables extension [RFC 5229] (#5248)\n- Managesieve: Support 'duplicate' extension [RFC 7352]\n- Managesieve: Unhide advanced rule controls if there are inputs with errors\n- Managesieve: Display warning message when filter form contains errors\n- Control search engine crawlers via X-Robots-Tag header instead of <meta> and robots.txt (#5098)\n- Fixed redundancy in sql caching system and compatibility with Galera Cluster (#5439)\n    - Removed redundant 'created' column from cache and cache_shared tables\n    - Removed use of redundant data records\n    - Added missing primary keys (dictionary, cache, cache_shared tables)\n- Fix so templating system does not mess with external (e.g. email) content (#5499)\n- Fix redundant keep-alive/refresh after session error on compose page (#5500)\n- Managesieve: Fix handling of scripts with nested rules (#5540)\n- Fix variable substitution in ldap host for some use-cases, e.g. new_user_identity (#5544)\n- Enigma: Fix PHP fatal error when decrypting a message with invalid signature (#5555)\n- Fix adding images to new identity signatures\n- Fix rsync error handling in installto.sh script (#5562)\n- Fix some advanced search issues with multiple addressbooks (#5572)\n- Fix so group/addressbook selection is retained on page refresh\n\nRELEASE 1.2.3\n-------------\n- Searching in both contacts and groups when LDAP addressbook with group_filters option is used\n- Fix vulnerability in handling of mail()'s 5th argument\n- Fix To: header encoding in mail sent with mail() method (#5475)\n- Fix flickering of header topline in min-mode (#5426)\n- Fix bug where folders list would scroll to top when clicking on subscription checkbox (#5447)\n- Fix decoding of GB2312/GBK text when iconv is not installed (#5448)\n- Fix regression where creation of default folders wasn't functioning without prefix (#5460)\n- Enigma: Fix bug where last records on keys list were hidden (#5461)\n- Enigma: Fix key search with keyword containing non-ascii characters (#5459)\n- Fix bug where deleting folders with subfolders could fail in some cases (#5466)\n- Fix bug where IMAP password could be exposed via error message (#5472)\n- Fix bug where it wasn't possible to store more that 2MB objects in memcache/apc,\n  Added memcache_max_allowed_packet and apc_max_allowed_packet settings (#5452)\n- Fix \"Illegal string offset\" warning in rcube::log_bug() on PHP 7.1 (#5508)\n- Fix storing \"empty\" values in rcube_cache/rcube_cache_shared (#5519)\n- Fix missing content check when image resize fails on attachment thumbnail generation (#5485)\n- Fix displaying attached images with wrong Content-Type specified (#5527)\n\nRELEASE 1.2.2\n-------------\n- Enigma: Add possibility to configure gpg-agent binary location (enigma_pgp_agent)\n- Enigma: Fix signature verification with some IMAP servers, e.g. Gmail, DBMail (#5371)\n- Enigma: Make recipient key searches case-insensitive (#5434)\n- Fix regression in resizing JPEG images with Imagick (#5376)\n- Managesieve: Fix parsing of vacation date-time with non-default date_format (#5372)\n- Use SymLinksIfOwnerMatch in .htaccess instead of FollowSymLinks disabled on some hosts for security reasons (#5370)\n- Wash position:fixed style in HTML mail for better security (#5264)\n- Fix bug where memcache_debug didn't work for session operations\n- Fix bug where Message-ID domain part was tied to username instead of current identity (#5385)\n- Fix bug where blocked.gif couldn't be attached to reply/forward with insecure content\n- Fix E_DEPRECATED warning when using Auth_SASL::factory() (#5401)\n- Fix bug where names of downloaded files could be malformed when derived from the message subject (#5404)\n- Fix so \"All\" messages selection is resetted on search reset (#5413)\n- Fix bug where folder creation could fail if personal namespace contained more than one entry (#5403)\n- Fix error causing empty INBOX listing in Firefox when using an URL with user:password specified (#5400)\n- Fix PHP warning when handling shared namespace with empty prefix (#5420)\n- Fix so folders list is scrolled to the selected folder on page load (#5424)\n- Fix so when moving to Trash we make sure the folder exists (#5192)\n- Fix displaying size of attachments with zero size\n- Fix so \"Action disabled\" error uses more appropriate 404 code (#5440)\n\nRELEASE 1.2.1\n-------------\n- Update TinyMCE to version 4.3.13 (#5309)\n- Fix bug where errors could have been not logged when per_user_logging=true\n- Fix bug where message list columns could be in wrong order after column drag-n-drop and list sorting\n- Fix so minified publickey.js (with cache-buster) is used when available (#5254)\n- Fix (replace) application/x-tar file extension test as it might not exist in nginx config (#5253)\n- Fix PHP warning when password_hosts is set, but is not an array (#5260)\n- Fix redundant keep-alive requests when session_lifetime is greater than ~20000 (#5273)\n- Fix so subfolders of INBOX can be set as Archive (#5274)\n- Fix bug where multi-folder search could choose a wrong folder in \"this and subfolders\" scope (#5282)\n- Fix bug where multi-folder search didn't work for unsubscribed INBOX (#5259)\n- Fix bug where \"no body\" alert could be displayed when sending mailvelope email\n- Enigma: Fix keys import from inside of an encrypted message (#5285)\n- Enigma: Fix malformed signed messages with force_7bit=true (#5292)\n- Enigma: Add possibility to configure gpg binary location (enigma_pgp_binary)\n- Enigma: Add possibility to export private keys (#5321)\n- Fix searching by email address in contacts with multiple addresses (#5291)\n- Fix handling of --delete argument in moduserprefs.sh script (#5296)\n- Workaround PHP issue by calling closelog() on script shutdown when using log_driver=syslog (#5289)\n- Fix so upgrade script makes sure program/lib directory does not contain old libraries (#5287)\n- Fix subscription checkbox state on error in folder subscribe/unsubscribe action (#5243)\n- Fix bug where microsecond format in logged date didn't work in some cases\n- Fix conflict in new_user_dialog and password_force_new_user settings (#5275)\n- Don't create multipart/alternative messages with empty text/plain part (#5283)\n- Use contact_search_name format in popup on results in compose contacts search\n- Fix handling of 'mailto' and 'error' arguments in message_before_send hook (#5347)\n- Fix missing localization of HTML editor when assets_dir != INSTALL_PATH\n- Fix handling of blockquote tags with mixed case on html2text conversion (#5363)\n- Fix javascript errors in IE on page with iframe that points to another domain\n\nRELEASE 1.2.0\n-------------\n- Enigma: Added enigma_debug option\n- Fix message list multi-select/deselect issue (#5219)\n- Fix bug where getting HTML editor content could steal focus from other form controls (#5223)\n- Fix bug where contact search menu fields where always unchecked in Larry skin\n- Fix autoloading of 'html' class\n- Fix bug where Encrypt button appears when switching editor to HTML (#5235)\n- Fix XSS issue in href attribute on area tag (#5240)\n\nRELEASE 1.2-rc\n--------------\n- Managesieve: Refactored script parser to be 100x faster\n- Enigma: added option to force users to use signing/encryption\n- Enigma: Added option to attach public keys to sent mail (#5152)\n- Enigma: Handle messages with text before an encrypted block (#5149)\n- Enigma: Handle encrypted/signed content inside message/rfc822 attachments\n- Enigma: Fix missing html/plain switch on multipart/signed messages (#4963)\n- Enigma: Disable format=flowed for signed plain text messages (#4960)\n- Enigma: Fix handling of encrypted + signed messages (#4950)\n- Enigma: Fix invalid boundary use in signed messages structure\n- Enable use of TLSv1.1 and TLSv1.2 for IMAP (#4955)\n- Save copy of original .htaccess file when using installto.sh script (#4947)\n- Fix regression where some message attachments could be missing on edit/forward (#4939)\n- Fix regression in displaying contents of message/rfc822 parts (#4937)\n- Fix handling of message/rfc822 attachments on replies and forwards (#4938)\n- Fix PDF support detection in Firefox > 19 (#4941)\n- Fix path traversal vulnerability in setting a skin [CVE-2015-8770] (#4945)\n- Fix so drag-n-drop of text (e.g. recipient addresses) on compose page actually works (#4944)\n- Fix .htaccess rewrite rules to not block .well-known URIs (#4943)\n- Fix mail view scaling on iOS (#4915)\n- Fix PHP7 warning \"session_start(): Session callback expects true/false return value\" (#4948)\n- Fix XSS issue in SVG images handling [CVE-2015-8864, CVE-2016-4068] (#4949)\n- Fix missing language name in \"Add to Dictionary\" request in HTML mode (#4951)\n- Fix (again) security issue in DBMail driver of password plugin [CVE-2015-2181] (#4958)\n- Fix bug where Archive/Junk buttons were not active after page jump with select=all mode (#4961)\n- Fix bug in long recipients list parsing for cases where recipient name contained @-char (#4964)\n- Plugin API: Added addressbook_export hook\n- Fix additional_message_headers plugin compatibility with Mail_Mime >= 1.9 (#4966)\n- Hide DSN option in Preferences when smtp_server is not used (#4967)\n- Fix handling of body parameter in mail compose request\n- Protect download urls against CSRF using unique request tokens [CVE-2016-4069] (#4957)\n- newmail_notifier: Refactor desktop notifications\n- Fix so contactlist_fields option can be set via config file\n- Fix so SPECIAL-USE assignments are forced only until user sets special folders (#4782)\n- Fix performance in reverting order of THREAD result\n- Fix converting mail addresses with @www. into mailto links (#5197)\n\nRELEASE 1.2-beta\n----------------\n- Update TinyMCE to version 4.2\n- Added support for Redis session handler\n- Removed some deprecated methods: https://github.com/roundcube/roundcubemail/commit/454b0b1c\n- Remove backward compatibility \"layer\" of bc.php (#4902)\n- Add possibility to define date format in write operations for ldap attributes (#3956)\n- Display attachment size in compose (#1329)\n- Added possibility to drag-n-drop attachments from mail preview to compose window\n- Implemented mail messages searching with predefined date interval\n- PGP encryption support via Mailvelope integration\n- PGP encryption support via Enigma plugin\n- PHP7 compatibility fixes (#4836)\n- Security: Added brute-force attack prevention via login rate limit (#4922)\n- Security: Added options to validate username/password on logon (#4884)\n- Security: Improve randomness of security tokens (#4899)\n- Security: Use random security tokens instead of hashes based on encryption key (#4829)\n- Security: Improved encrypt/decrypt methods with option to choose the cipher_method (#4492)\n- Make optional adding of standard signature separator - sig_separator (#3276)\n- Optimize folder_size() on Cyrus IMAP by using special folder annotation (#4894)\n- Make optional hidding of folders with name starting with a dot - imap_skip_hidden_folders (#4870)\n- Add option to enable HTML editor always, except when replying to plain text messages (#4352)\n- Emoticons: Added option to switch on/off emoticons in compose editor (#2076)\n- Emoticons: Added option to switch on/off emoticons in plain text messages\n- Emoticons: All emoticons-related functionality is handled by the plugin now\n- Installer: Add button to save generated config file in system temp directory (#3553)\n- Remove common subject prefixes Re:, Re[x]:, Re-x: on reply (#4882)\n- Added GSSAPI/Kerberos authentication plugin - krb_authentication\n- Password: Allow temporarily disabling the plugin functionality with a notice\n- Require Mbstring and OpenSSL extensions (#5166)\n- Add --config and --type options to moduserprefs.sh script (#4651)\n- Implemented memcache_debug and apc_debug options\n- Installer: Remove system() function use (#4695)\n- Password plugin: Added 'kpasswd' driver by Peter Allgeyer\n- Add initdb.sh to create database from initial.sql script with prefix support (#4722)\n- Plugin API: Added disabled_plugins an disabled_buttons options in html_editor hook\n- Plugin API: Added html2text hook\n- Plugin API: Added message_part_body hook\n- Plugin API: Added message_ready hook\n- Plugin API: Add special onload() method to execute plugin actions before startup (session and GUI initialization)\n- Implemented UI element to jump to specified page of the messages list (#1677)\n- Fix searching of contacts to allow remote images for known senders (#4886)\n- Fix bug where clicking date column with 'arrival' sorting would switch to sorting by 'date' (#4690)\n- Fix bug where message content could overlap attachments list in Larry skin (#4876)\n- Fix so microseconds macro (u) in log_date_format works (#4855)\n- Fix so unrecognized TNEF attachments are displayed on the list of attachments (#5138)\n- Fix so database_attachments::cleanup() does not remove attachments from other sessions (#4907)\n- Fix responses list update issue after response name change (#4917)\n- Fix bug where message preview was unintentionally reset on check-recent action (#4921)\n- Fix bug where HTML messages with invalid/excessive css styles couldn't be displayed (#4905)\n- Fix redundant blank lines when using HTML and top posting (#4927)\n- Fix redundant blank lines on start of text after html to text conversion (#4928)\n- Fix HTML sanitizer to skip <!-- node type X --> in output (#4932)\n- Fix invalid LDAP query in ACL user autocompletion (#4934)\n\nRELEASE 1.1.3\n-------------\n- Fix closing of nested menus (#4854)\n- Fix so E_DEPRECATED errors from PEAR libs are ignored by error_reporting change (#4770)\n- Fix compatibility with PHP 5.3 in rcube_ldap class (#4842)\n- Get rid of Mail_mimeDecode package dependency (#4836)\n- Fix \"Importing...\" message does not hide on error (#4840)\n- Fix Compose action in addressbook for results from multiple addressbooks (#4834)\n- Fix bug where some messages in multi-folder search couldn't be viewed/printed/downloaded (#4843)\n- Fix unintentional messages list page change on page switch in compose addressbook (#4844)\n- Fix race-condition in saving user preferences and loading plugin config (#4845)\n- Fix so plain text signature field uses monospace font (#4848)\n- Fix so links with href == content aren't added to links list on html to text conversion (#4847)\n- Fix handling of non-break spaces in html to text conversion (#4849)\n- Fix self-reply detection issues (#4852)\n- Fix multi-folder search result sorting by arrival date (#4858)\n- Fix so *-request@ addresses in Sender: header are also ignored on reply-all (#4860)\n- Update to TinyMCE 4.1.10 (#5164)\n- Fix draft removal after a message is sent and storing sent message is disabled (#4869)\n- Fix so imap folder attribute comparisons are case-insensitive (#4868)\n- Fix bug where new messages weren't added to the list in search mode\n- Fix wrong positioning of message list header on page scroll in Webkit browsers (#4646)\n- Fix some javascript errors in rare situations (#4853)\n- Fix error when using back button after sending an email (#4628)\n- Fix removing signature when switching to identity with an empty sig in HTML mode (#4872)\n- Disable links list generation on html-to-text conversion of identities or composed message (#4850)\n- Fix \"washing\" of style elements wrapped into many lines\n- Fix so input field (e.g. search box) does not loose focus on list load (#4862)\n- Fix so css of one html part does not apply to other text parts on message display (#4887)\n- Fix XSS issue in drag-n-drop file uploads [CVE-2015-8105] (#4900)\n- Fix handling of plus character in mailto: links (#4891)\n- Fix so adding CC/BCC recipients from the sidebar unhides compose form fields in Classic skin (#4874)\n- Fix so gc.sh script removes also expired sessions from sql database (#4893)\n- Fix support for Mozilla-based browsers, e.g. Pale Moon (#4895)\n- Fix various issues with Turkish (and similar) locales (#4896)\n- Fix so In-Reply-To header is set also for MDN receipts (#4897)\n- Fix missing HTTP_X_FORWARDED_FOR address in generated Received header\n- Fix issue where Content-Length of some attachments could be set to wrong value causing browser errors (#4877)\n\nRELEASE 1.1.2\n-------------\n- Add new plugin hook 'identity_create_after' providing the ID of the inserted identity (#4807)\n- Add option to place signature at bottom of the quoted text even in top-posting mode [sig_below]\n- Fix handling of %-encoded entities in mailto: URLs (#4799)\n- Fix zipped messages downloads after selecting all messages in a folder (#4797)\n- Fix vpopmaild driver of password plugin\n- Fix PHP warning: Non-static method PEAR::setErrorHandling() should not be called statically (#4798)\n- Fix tables listing routine on mysql and postgres so it skips system or other database tables and views (#4796)\n- Fix message list header in classic skin on window resize in Internet Explorer (#4732)\n- Fix so text/calendar parts are listed as attachments even if not marked as such (#4795)\n- Fix lack of signature separator for plain text signatures in html mode (#4802)\n- Fix font artifact in Google Chrome on Windows (#4803)\n- Fix bug where forced extwin page reload could exit from the extwin mode (#4801)\n- Fix bug where some unrelated attachments in multipart/related message were not listed (#4805)\n- Fix mouseup event handling when dragging a list record (#4808)\n- Fix bug where preview_pane setting wasn't always saved into user preferences (#4809)\n- Fix bug where messages count was not updated after message move/delete with skip_deleted=false (#4814)\n- Fix security issue in contact photo handling (#4817)\n- Fix possible memcache/apc cache data consistency issues (#4820)\n- Fix bug where imap_conn_options were ignored in IMAP connection test (#4822)\n- Fix bug where some files could have \"executable\" extension when stored in temp folder (#4815)\n- Fix attached file path unsetting in database_attachments plugin (#4823)\n- Fix issues when using moduserprefs.sh without --user argument (#4825)\n- Fix potential info disclosure issue by protecting directory access (#4816)\n- Fix blank image in html_signature when saving identity changes (#4833)\n- Installer: Use openssl_random_pseudo_bytes() (if available) to generate des_key (#4827)\n- Fix XSS vulnerability in _mbox argument handling (#4837)\n\nRELEASE 1.1.1\n-------------\n- ACL: Allow other plugins to adjust the list of permissions and groups to edit\n- Add possibility to print contact information (of a single contact)\n- Add possibility to configure max_allowed_packet value for all database engines (#4772)\n- Improved handling of storage errors after message is sent\n- Update to TinyMCE 4.1.9\n- Unified request* event arguments handling, added support for _unlock and _action parameters\n- Security: Generate random hash for the per-user local storage prefix (#4768)\n- Fix refreshing of drafts list when sending a message which was saved in meantime (#4745)\n- Fix saving/sending emoticon images when assets_dir is set\n- Fix PHP fatal error when visiting Vacation interface and there's no sieve script yet (#4778)\n- Fix setting max packet size for DB caches and check packet size also in shared cache\n- Fix needless security warning on BMP attachments display (#4771)\n- Fix handling of some improper constructs in format=flowed text as per the RFC3676[4.5] (#4773)\n- Fix performance of rcube_db_mysql::get_variable()\n- Fix missing or not up-to-date CATEGORIES entry in vCard export (#4766)\n- Fix fatal errors on systems without mbstring extension or mb_regex_encoding() function (#4769)\n- Fix cursor position on reply below the quote in HTML mode (#4759)\n- Fix so \"over quota\" errors are displayed also in message compose page\n- Fix duplicate entries suppression in autocomplete result (#4776)\n- Fix \"Non-static method PEAR::isError() should not be called statically\" errors (#4770)\n- Fix parsing invalid HTML messages with BOM after <!DOCTYPE> (#4777)\n- Fix duplicate entry on timezones list in rcube_config::timezone_name_from_abbr() (#4779)\n- Fix so localized folder name is displayed in multi-folder search result (#4750)\n- Fix javascript error after creating a folder which is a subfolder of another one (#4781)\n- Fix bug where subject of sent/saved message was removed if mbstring wasn't installed (#4780)\n- Fix missing vcard_attachment icon on messages list (#4783)\n- Fix storing signatures with big images in MySQL database (#4785)\n- Fix Opera browser detection in javascript (#4786)\n- Fix so search filter, scope and fields are reset on folder change\n- Fix rows count when messages search fails (#4760)\n- Fix bug where spellchecking in HTML editor do not work after switching editor type more than once (#4789)\n- Fix bug where TinyMCE area height was too small on slow network connection (#4788)\n- Fix backtick character handling in sql queries (#4790)\n- Fix redirect URL for attachments loaded in an iframe when behind a proxy (#4724)\n- Fix menu container references to point to the actual <ul> element (#4791)\n- Fix javascripts errors in IE8 - lack of Event.which, focusing a hidden element (#4793)\n\nRELEASE 1.1.0\n-------------\n- Make SMTP error log more verbose - include server response and error code\n- Fix download options menu (added by zipdownload plugin) in classic skin (#4740)\n- Fix blocked.gif image usage with assets_dir set\n- Fix bug where max_group_members was ignored when adding a new contact (#4733)\n- Hide MDN and DSN options in compose if disabled by admin (#4735)\n- Fix checks based on window.ActiveXObject in IE > 10\n- Fix XSS issue in style attribute handling [CVE-2015-1433] (#4739)\n- Fix bug where Drafts list wasn't updated on draft-save action in new window (#4737)\n- Fix so \"set as default\" option is hidden if identities_level > 1 (#4738)\n- Fix bug where search was reset after returning from compose visited for reply\n- Fix javascript error in \"IE 8.0/Tablet PC\" browser (#4730)\n- Fix bug where Reply-To address was ignored on reply to messages sent by self (#4742)\n- Fix bug where empty fieldmap config entries caused empty results of ldap search (#4741)\n- Fix bug where drafts list wasn't refreshed after draft message was sent from another window (#4745)\n- Fix keyboard navigation and css in datepicker widget across many Firefox versions\n- Fix false warning when opening attached text/plain files (#4748)\n- Fix bug where signature could have been inserted twice after plain-to-html switch (#4746)\n- Fix security issue in DBMail driver of password plugin (#4757)\n- Enable FollowSymLinks option in .htaccess file which is required by rewrite rules (#4754)\n- Fix so JSON.parse() errors on localStorage items are ignored (#4752)\n\nRELEASE 1.1-rc\n--------------\n- Update jQuery to version 2.1.3\n- Allow to override any config option through env variables\n- Improve system security by using optional special URL with security token - use_secure_urls\n- Allow to define separate server/path for image/js/css files - assets_url/assets_dir\n- Sync vendor folder if exists in source package (#4700)\n- Avoid useless reloading list when resetting search with active filter (#4654)\n- Fix invalid folder selection if clicked while busy (#4709)\n- Fix import of multiple contact email addresses from Outlook-csv format (#4714)\n- Fix drag-n-drop to folders expanded while dragging (#4708)\n- Fix import of multiple contact groups from Google-csv format (#4710)\n- Fix import of contacts with multiple email addresses from Google-csv format (#4719)\n- Fix bugs where CSRF attacks were still possible on some requests [CVE-2014-9587]\n- Fix some rcube_utils::anytodatetime() corner cases with timezone mismatches (#4712)\n- Improve move-to and contact-export button in classic skin (#4713)\n- Fix wrong icon for download button in classic skin\n- Fix bug where sent message was saved in Sent folder even if disabled by user (#4729)\n\nRELEASE 1.1-beta\n----------------\n- Fix skin path handling in plugin context (#4111)\n- Prevent memory exhaustion on image resizing with GD on Windows (#4580)\n- Add plugin hook for database table name lookups as requested in #4538\n- Added Oracle database support\n- Support contacts import in GMail CSV format\n- Added namespace filter in Folder Manager\n- Added folder searching in Folder Manager\n- Fix restoring draft messages from localStorage if editor mode differs (#4631)\n- Added config option/user preference to disable saving messages in localStorage (#4606)\n- Added config option 'imap_log_session' to enable Roundcube <-> IMAP session ID logging\n- Added config option 'log_session_id' to control the length of the session identifier in logs\n- Implemented 'storage_connected' API hook after successful IMAP login (#4638)\n- Intergrate Net_LDAP3 and rcube_ldap_generic classes\n- Add option (disabled_actions) to disable UI elements/actions (#4478)\n- Support password encryption using openssl extension (#4614)\n- Create/rename groups in UI dialogs (#4592)\n- Added 'contact_search_name' option to define autocompletion entry format\n- Display quota information for current folder not INBOX only (#3442)\n- Support images in HTML signatures (#3917)\n- Display full quota information in popup (#2103, #2746)\n- Mail compose: Selecting contact inserts recipient to previously focused input - to/cc/bcc accordingly (#4487)\n- Close \"no subject\" prompt with Enter key (#4463)\n- Password: Add option to force new users to change their password (#2963)\n- Improve support for screen readers and assistive technology using WCAG 2.0 and WAI ARIA standards\n- Enable basic keyboard navigation throughout the UI (#3333)\n- Select/scroll to previously selected message when returning from message page (#4146)\n- Display a warning if popup window was blocked (#4472)\n- Remove (was: ...) from message subject on reply (#4359)\n- Update to TinyMCE 4.1 (#4168)\n- Enable autolink plugin in TinyMCE (#4029)\n- Support image operations with Imagick extension (#4498)\n- Support upload progress with session.upload_progress and PECL uploadprogress module (#3934)\n- Make identity name field optional (#4435)\n- Utility script to remove user records from the local database\n- Plugin API: Added message_saved hook (#4503)\n- Plugin API: Added imap_search_before hook\n- Support messages import from zip archives\n- Zipdownload: Added mbox format support (#2354)\n- Drop support for IE6, move IE7/IE8 support to legacy_browser plugin\n- Update to jQuery-2.1.1\n- Search across multiple folders (#1676)\n- Improve UI integration of ACL settings\n- Drop support for PHP < 5.3.7\n- Set In-Reply-To and References for forwarded messages (#4465)\n- Removed redundant default_folders config option (#4500)\n- Implemented IMAP SPECIAL-USE extension support [RFC6154] (#3326)\n- Optimize some framed pages content for better performance (#4517)\n- Improve text messages display and conversion to HTML (#4091)\n- Don't remove links when html signature is converted to text (#4473)\n- Fix page title when using search filter (#4636)\n- Fix mbox files import\n- Fix some character sets detection (#4694)\n- Fix so attachment charset is set in headers of forward/draft message (#4676)\n- Fix bug where wrong charset could be used for text attachment preview page (#4674)\n\nRELEASE 1.0.5\n-------------\n- Fix wrong icon for download button in classic skin\n- Fix checks based on window.ActiveXObject in IE > 10\n- Fix XSS issue in style attribute handling (#4739)\n- Fix bug where Drafts list wasn't updated on draft-save action in new window (#4737)\n- Fix so \"set as default\" option is hidden if identities_level > 1 (#4738)\n- Fix javascript error in \"IE 8.0/Tablet PC\" browser (#4730)\n- Fix bug where empty fieldmap config entries caused empty results of ldap search (#4741)\n- Fix bug where sent message was saved in Sent folder even if disabled by user (#4729)\n\nRELEASE 1.0.4\n-------------\n- Disable TinyMCE contextmenu plugin as there are more cons than pros in using it (#4684)\n- Fix bug where show_real_foldernames setting wasn't honored on compose page (#4705)\n- Fix issue where Archive folder wasn't protected in Folder Manager (#4706)\n- Fix compatibility with PHP 5.2. in rcube_imap_generic (#4682)\n- Fix setting flags on servers with no PERMANENTFLAGS response (#4667)\n- Fix regression in SHAA password generation in ldap driver of password plugin (#4670)\n- Fix displaying of HTML messages with absolutely positioned elements in Larry skin (#4672)\n- Fix font style display issue in HTML messages with styled <span> elements (#4671)\n- Fix download of attachments that are part of TNEF message (#4668)\n- Fix handling of uuencoded messages if messages_cache is enabled (#4675)\n- Fix handling of base64-encoded attachments with extra spaces (#4678)\n- Fix handling of UNKNOWN-CTE response, try do decode content client-side (#4650)\n- Fix bug where creating subfolders in shared folders wasn't possible without ACL extension (#4680)\n- Fix reply scrolling issue with text mode and start message below the quote (#4681)\n- Fix possible issues in skin/skin_path config handling (#4689)\n- Fix lack of delimiter for recipient addresses in smtp_log (#4703)\n- Fix generation of Blowfish-based password hashes (#4721)\n- Fix bugs where CSRF attacks were still possible on some requests [CVE-2014-9587]\n\nRELEASE 1.0.3\n-------------\n- Initialize HTML editor before restoring a message from localStorage (#4631)\n- Add 'sig_max_lines' config option to default config file (#5162)\n- Add config option to specify IMAP connection socket parameters - imap_conn_options (#4589)\n- Add option to set default message list mode - default_list_mode (#3157)\n- Enable contextmenu plugin for TinyMCE editor (#3062)\n- Fix insert-signature command in external compose window if opened from inline compose screen (#4663)\n- Fix some mime-type to extension mapping checks in Installer (#4610)\n- Fix errors when using localStorage in Safari's private browsing mode (#4619)\n- Fix bug where $Forwarded flag was being set even if server didn't support it (#4621)\n- Fix various iCloud vCard issues, added fallback for external photos (#4617)\n- Fix invalid Content-Type header when send_format_flowed=false (#4616)\n- Fix errors when adding/updating contacts in active search (#4630)\n- Fix incorrect thumbnail rotation with GD and exif orientation data (#4641)\n- Fix contacts list update after adding/deleting/moving a contact (#4640, #4644)\n- Fix handling of email addresses with quoted domain part (#4647)\n- Fix comm_path update on task switch (#4648)\n- Fix error in MSSQL update script 2013061000.sql (#4658)\n- Fix validation of email addresses with IDNA domains (#4661)\n\nRELEASE 1.0.2\n-------------\n- Fix storing unsaved drafts in localStorage (#4529)\n- Add configurable LDAP_OPT_DEREF option (#4546)\n- Fix so when switching editor mode original version of signature is used (#4032)\n- Fix unintentional draft autosave request if autosave is disabled (#4550)\n- Fix malformed References: header in send/saved mail (#4552)\n- Fix handling unicode characters in links (#4555)\n- Fix incorrect handling of HTML comments in messages sanitization code (#4558)\n- Fix so current page is reset on list-mode change (#4561)\n- Fix so responses menu hides on click in classic skin (#4566)\n- Fix unintentional line-height style modification in HTML messages (#4567)\n- Fix broken normalize_string(), add support for ISO-8859-2 (#4568)\n- Support csv contacts import in German localization (#4570)\n- Fix so message list and counters are updated when a message is opened in new window (#4569)\n- Fix malformed recipient name when composing a message by clicking on mailto link (#4583)\n- Fix list reload after sending message in another window (#4576)\n- Fix so address format errors are ignored when saving a draft (#4594)\n- Fix incorrect label translation in return receipt (#4598)\n- Fix security issue in delete-response action - allow only ajax request\n- Fix Delete button state after deleting identity/response (#4603)\n- Fix bug where contacts with no email address were listed on compose addressbook (#4602)\n- Fix images import from various vCard formats (#4604)\n- Fix sorting messages by size on servers without SORT capability (#4608)\n\nRELEASE 1.0.1\n-------------\n- Support 'error' and 'body_file' return attribs in 'message_before_send' hook (#4467)\n- Apply user-specific replacements to group's base_dn property (#4512)\n- Fix missing email address when importing contacts from outlook csv (#4535)\n- Fix bug where \"With attachment\" option in search filter wasn't selected after return from mail view (#4508)\n- Fix \"washing\" of unicoded style attributes (#4510)\n- Fix unintentional redirect from compose page in Webkit browsers (#4516)\n- Fix messages index cache update under some conditions (e.g. proxy) (#4505)\n- Fix lack of translation of special folders in some configurations (#4520)\n- Fix XSS issue in plain text spellchecker (#4524)\n- Fix invalid page title for some folders (1489804)\n- Fix redundant alert message on over-size uploads (#4528)\n- Fix next message display after removing a message (#4521)\n- Fix missing Mail-Followup-To header in sent mail (#4534)\n- Fix error when spell-checking an empty text (#4536)\n- Avoid popupmenus being closed when scrollbar is clicked (#4537)\n- Add proxy_whitelist configuration option (#4496)\n- Fix identities_level=4 handling in new_user_dialog plugin (#4540)\n- Fix various db_prefix issues (#4539)\n- Fix too small length of users.preferences column data type on MySQL\n- Fix redundant warning when switching from html to text in empty editor (#4530)\n- Fix invalid host validation on login (#4541)\n- Fix IMAP connection test in installer so it is aware of imap_auth_type (#4502)\n\nRELEASE 1.0.0\n-------------\n- Added toolbar button to move message in message view\n- Fix style of disabled protocol handler link on IE (#4460)\n- Fix message import dialog when no file is selected (#4488)\n- Fix opening compose screen in new window after saving as draft (#4479)\n- Fix directories check in Installer on Windows (#4462)\n- Fix issue when default_addressbook option is set to integer value (#4379)\n- Fix Opera > 15 detection (#4455)\n- Fix security issue in DomainFactory driver of Password plugin\n- Fix invalid X-Draft-Info on forwarded message draft (#4464)\n- Fix regression in handling of 'attachments' result in message_compose hook (#4474)\n- Fix issue where msgexport.sh printed the message to STDOUT instead of a file (#4476)\n- Fix fatal error in database_attachments plugin under some conditions (#4495)\n\nRELEASE 1.0-rc\n--------------\n- Small CSS fix with message notice boxes in Larry skin (#4429)\n- Include groups in contacts search on mail compose (#4186)\n- Add mime-type mapping for .7z files (#4436)\n- Invoke update scripts with php to circumvent execution restrictions (#4330)\n- Fix drag & drop message/contact moving on touch device (#4395)\n- Fix canned responses in HTML mode (#4446)\n- Check/create default folders on every login not only the first (#4391)\n- Update to jQuery-1.11.0 and jQuery-UI-1.9.2\n- Support SMTP socket context options via new config option 'smtp_conn_options'\n- Fix compatibility with PHP 5.2 in html.php file (#4438)\n- Remove expand/collapse with plus/minus keys (on numeric keypad) (#4437)\n- Fix issue where filesystem path was added to all-attachments (zip) file (#4433)\n- Fix case-sensitivity of email addresses handling on compose (#1899)\n- Don't alter Message-ID of a draft when sending (#4381)\n- Fix issue where deprecated syntax for HTML lists was not handled properly (#3975)\n- Display different icons when Trash folder is empty or full (#2108)\n- Remember last position of more headers switch (#3660)\n- Fix so message flags modified by another client are applied on the list on refresh (#1639)\n- Fix broken text/* attachments when forwarding/editing a message (#4393)\n- Improved minified files handling, added css minification (#3041)\n- Fix handling of X-Forwarded-For header with multiple addresses (#4424)\n- Fix border issue on folders list in classic skin (#4419)\n- Implemented menu actions to copy/move messages, added folder-selector widget (#863)\n- Fix security rules in .htaccess preventing access to base URL without the ending slash (#4422)\n- Fix regression where only first new folder was placed in correct place on the list (#4418)\n- Fix issue where children of selected and collapsed thread were skipped on various actions (#4410)\n- Fix issue where groups were not deleted when \"Replace entire addressbook\" option on contacts import was used (#4388)\n- Fix unreliable mimetype tests in Installer (#4408)\n- Fix performance of listing writeable folders (#4406)\n\nRELEASE 1.0-beta\n----------------\n- Fix handling of invalid closing tags in HTML messages (#4403)\n- Set real content-type for file downloads (#4400)\n- Update TinyMCE to version 3.5.10 (#4401)\n- Fix keyboard navigation in list widgets (#4367)\n- Allow plugins to grab the reference of opened windows (#4383)\n- Larry skin: Improved status message display for better visibility (#4115)\n- Fix Internet Explorer 11 detection (#4397)\n- Fix date column width to fit the widest possible date format (#4354)\n- Move certain user preference options to a collapsed \"advanced\" block (#4015)\n- Add file type icons for Powerpoint and Open Office presentations (#4269)\n- Fix operations on folders with trailing spaces in name (#4387)\n- Improve identity selection based on From: header (#4360)\n- Fix issue where mails with inline images of the same name contained only the first image multiple times (#4378)\n- Use left/right arrow keys to collapse/expand thread and spacebar to select a row, change Ctrl key behavior (#4367)\n- Fix an issue where using arrow keys to go up a list can result in selected message being under headers (#4375)\n- Fix an issue where Home/End keys don't focus list row properly, don't scrollTo properly (#4370)\n- Add an option to disable smart Reply-List behaviour - reply_all_mode (#3953)\n- Fix an issue where pressing minus key on contacts list was hiding list records (#4368)\n- Fix an issue where shift + arrow-up key wasn't selecting all messages in collapsed thread (#4371)\n- Added icon for priority column in messages list header (#4275)\n- New feature \"Canned Responses\" to save and recall boilerplate text snippets\n- Fix HTML part detection when encapsulated inside multipart/signed (#4357)\n- Add spellchecker backend for the After the Deadline service\n- Replace markdown-style [1] link indexes in plain text email bodies\n- Improved mailto: link arguments handling (#4351)\n- Use DOMDocument LIBXML_PARSEHUGE and LIBXML_COMPACT options if possible (#4316)\n- Support HTTP_HOST, SERVER_NAME and SERVER_ADDR values in include_host_config feature\n- Make default font size for HTML messages configurable (request #118)\n- Fix XSS issue in addressbook group name field [CVE-2013-5646] (#4337)\n- After message is sent refresh messages list of replied message folder (#4282)\n- Add option force specified domain in user login - username_domain_forced (#4290)\n- Add option to import Vcards with group assignments\n- Save groups membership in Vcard export (#3801)\n- Workaround broken PHP function timezone_name_from_abbr (#4289)\n- Make cached message size limit configurable - messages_cache_threshold (#4326)\n- Log also failed logins to userlogins log\n- Add temp_dir_ttl configuration option (#4318)\n- Allow setting INBOX as Sent folder (#4264)\n- Fix replacement variables in user-specific base_dn in some LDAP requests (#4299)\n- Fix image scaling issues when image has only one dimension smaller than the limit (#4296)\n- Fix issue where uploaded photo was lost when contact form did not validate (#4296)\n- Move identity selection based on non-standard headers into (new) identity_select plugin (#3835)\n- Fix downloading binary files with (wrong) text/* content-type (#4292)\n- Respect HTTP_X_FORWARDED_FOR and HTTP_X_REAL_IP variables for session IP check\n- Simplified configuration by merging it into one file + defaults (#3156)\n- Make message list header stay on top when scrolling (#353)\n- Add support for 'enchant' spellcheck engine\n- Check filetype detection in installer and update script (#4252)\n- Fix folder names truncation in Classic skin (#4265)\n- Make possible to disable some (broken) IMAP extensions with imap_disable_caps option (#4245)\n- Contacts drag-n-drop default action is to move contacts (#3962)\n- Added possibility to choose to move or copy contacts from drag-n-drop menu (#3962)\n- Fix Close link and remove About link on error pages (#4201)\n- Improved/unified attachment preview screen, added print button\n- Fix lack of space between searchfiler and quicksearchbar in Larry skin (#4233)\n- Cache LDAP's user_specific search and use vlv for better performance (#4247)\n- LDAP: auto-detect and use VLV indices for all search operations\n- LDAP: additional group configuration options for  address books\n- LDAP: separated address book implementation from a generic LDAP wrapper class\n- Allow address books to browse a multi-level group hierarchy in the contacts list\n- Fix session issues when local and database time differs (#2401)\n- Fix thread cache syncronization/validation (#4150)\n- Added feature to import messages to the currently selected folder\n- Add option show_real_foldernames to disable localization of special folders\n- Fix database cache expunge issues (#4229)\n- Fix date format issues on MS SQL Server (#4078)\n- Add imap_cache_ttl option to configure TTL of imap_cache\n- Make LDAP cache engine configurable via ldap_cache and ldap_cache_ttl options\n- Fix \"duplicate entry\" errors on inserts to imap cache tables (#4228)\n- Improved handling of Reply-To/Bcc addresses of identity in compose form (#4142)\n- Added user preference to open all popups as standard windows\n- Implemented shared cache (rcube_cache_shared)\n- Change Reply-All button label/title when mailing list is detected (#4092)\n- Fix SMTP connection using IPv6 address in smtp_server option (#4147)\n- Added attachment_reminder plugin\n- Make PHP code eval() free, use create_function()\n- Add option to display email address together with a name in mail preview (#3952)\n- Support CSV import from Atmail (#4161)\n- Add db_prefix configuration option in place of db_table_*/db_sequence_* options\n- Make possible to use db_prefix for schema initialization in Installer (#4175)\n- Fix updatedb.sh script so it recognizes also table prefix for external DDL files\n- Fix parsing invalid date string (#4155)\n- Add \"with attachment\" option to messages list filter (#1795)\n- Call resize handler in intervals to prevent lags and double onresize calls in Chrome (#4137)\n- Add rel=\"noreferrer\" for links in displayed messages (#4976)\n- Add ability to toggle between HTML and text while viewing a message (#3005)\n- Remove \"HTML message\" from attachments list while viewing a message in text mode (#3005)\n- Support IMAP MOVE extension [RFC 6851]\n- Add attachment menu with Open and Download options (#4116)\n- Display user-friendly message on IMAP \"over quota\" errors (#914)\n- Extended archive plugin with user-configurable options to store messages into subfolders\n- Fix export of selected contacts from search result (#4070)\n- Feature to export only selected contacts from addressbook (by Phil Weir)\n\nRELEASE 0.9.5\n-------------\n- Fix failing vCard import when email address field contains spaces (#4363)\n- Fix default spell-check configuration after Google suspended their spell service\n- Fix vulnerability in handling _session argument of utils/save-prefs [CVE-2013-6172] (#4362)\n- Fix iframe onload for upload errors handling (#4361)\n- Fix address matching in Return-Path header on identity selection (#4358)\n- Fix text wrapping issue with long unwrappable lines (#4356)\n- Fixed issues where HTML comments inside style tag would hang Internet Explorer\n- Hide Delivery Status Notification option when smtp_server is unset (#4339)\n- Display full attachment name using title attribute when name is too long to display (#4328)\n- Fix attachment icon issue when rare font/language is used (#4334)\n- Fix expanded thread root message styling after refreshing messages list (#4335)\n- Fix issue where From address was removed from Cc and Bcc fields when editing a draft (#4327)\n- Fix error_reporting directive check (#4331)\n- Fix de_DE localization of \"About\" label in Help plugin (#4333)\n\nRELEASE 0.9.4\n-------------\n- Make identities matching case insensitive (#1881)\n- Fix issue where too big message data was stored in cache causing sql errors (#4325)\n- Fix iframe scrollbars on webkit desktop browsers (#4319)\n- Fix issue where legacy config was overridden by default config (#4305)\n- Fix newmail_notifier issue where favicon wasn't changed back to default (#4324)\n- Fix setting of Junk and NonJunk flags by markasjunk plugin (#4303)\n- Fix lack of Reply-To address in header of forwarded message body (#4314)\n- Fix bugs when invoking contact creation form when read-only addressbook is selected (#4313)\n- Fix identity selection on reply (#4308)\n- Fix so additional headers are added to all messages sent (#4302)\n- Fix display issue after moving folder in Folder Manager (#4310)\n- Fix handling of non-default date formats (#4311)\n- Fix unquoted path in PREG expression on Windows (#4307)\n- Fix wrong close tag in /template/mail.html (#4312)\n\nRELEASE 0.9.3\n-------------\n- Fix setting refresh_interval to \"Never\" in Preferences (#4304)\n- Fixed iframe scrolling on touch devices\n- Optimized message list for touch devices\n- Fix purge action in folder manager (#4300)\n- Fix base URL resolving on attribute values with no quotes (#4297)\n- Fix wrong handling of links with '|' character (#4298)\n- Fix colorspace issue on image conversion using ImageMagick (#4294)\n- Fix XSS vulnerability when editing a message \"as new\" or draft [CVE-2013-5645] (#4283)\n- Fix XSS vulnerability when saving HTML signatures [CVE-2013-5645] (#4283)\n- Fix rewrite rule in .htaccess (#4278)\n- Fix detecting Turkish language in ISO-8859-9 encoding (#4284)\n- Fix identity-selection using Return-Path headers (#4279)\n- Fix parsing of links with ... in URL (#4251)\n- Fix compose priority selector when opening in new window (#4286)\n- Fix bug where signature wasn't changed on identity selection when editing a draft (#4272)\n- Fix IMAP SETMETADATA parameters quoting (#4274)\n- Fix \"could not load message\" error on valid empty message body (#4271)\n- Fix handling of message/rfc822 attachments on message forward and edit (#4262)\n- Fix parsing of square bracket characters in IMAP response strings (#4267)\n- Don't clear References and in-Reply-To when a message is \"edited as new\" (#4263)\n- Fix messages list sorting with THREAD=REFS\n- Remove deprecated (in PHP 5.5) PREG /e modifier usage (#4239)\n- Fix empty messages list when register_globals is enabled (#4232)\n- Fix so valid and set date.timezone is not required by installer checks (#4242)\n- Canonize boolean ini_get() results (#4249)\n- Fix so install do not fail when one of DB driver checks fails but other drivers exist (#4240)\n- Fix so exported vCard specifies encoding in v3-compatible format (#4244)\n\nRELEASE 0.9.2\n-------------\n- Fix image thumbnails display in print mode (#4220)\n- Fix height of message headers block (#4200)\n- Fix timeout issue on drag&drop uploads (#4238)\n- Fix default sorting of threaded list when THREAD=REFS isn't supported\n- Fix list mode switch to 'List' after saving list settings in Larry skin (#4236)\n- Fix error when there's no writeable addressbook source (#4235)\n- Fix zipdownload plugin issue with filenames charset (#4231)\n- Fix so non-inline images aren't skipped on forward (#4230)\n- Fix \"null\" instead of empty string on messages list in IE10 (#4227)\n- Fix legacy options handling\n- Fix so bounces addresses in Sender headers are skipped on Reply-All (#4140)\n- Fix bug where serialized strings were truncated in PDO::quote() (#4226)\n- Fix displaying messages with invalid self-closing HTML tags (#4223)\n- Fix PHP warning when responding to a message with many Return-Path headers (#4222)\n- Fix unintentional compose window resize (#4206)\n- Fix performance regression in text wrapping function (#4219)\n- Fix connection to posgtres db using unix socket (#4218)\n- Fix handling of comma when adding contact from contacts widget (#4199)\n- Fix bug where a message was opened in both preview pane and new window on double-click (#4212)\n- Fix fatal error when xdebug.max_nesting_level was exceeded in rcube_washtml (#4202)\n- Fix PHP warning in html_table::set_row_attribs() in PHP 5.4 (#4194)\n- Fix invalid option selected in default_font selector when font is unset (#4204)\n- Fix displaying contact with ID divisible by 100 in sql addressbook (#4211)\n- Fix browser warnings on PDF plugin detection (#4209)\n- Fix fatal error when parsing UUencoded messages (#4210)\n\nRELEASE 0.9.1\n-------------\n- Better German labels for from/to to avoid conflicts with 'sender' (#4188)\n- Fix problem where security warning was displayed for valid images with image/jpg type (#4196)\n- Fix handling of invalid email addresses in headers (#4193)\n- Fix IMAP connection issue with default_socket_timeout < 0 and imap_timeout < 0 (#4191)\n- Fix various PHP code bugs found using static analysis (#4190)\n- Fix backslash character handling on vCard import (#4189)\n- Fix csv import from Thunderbird with French localization (#4170)\n- Fix messages list focus issue in Opera and Webkit (#4169)\n- Fix Reply-To header handling in Reply-All action (#4157)\n- Fix so Sender: address is added to Cc: field on reply to all (#4140)\n- Fix so addressbook_search_mode works also for group search (#4183)\n- Fix removal of a contact from a group in LDAP addressbook (#4185)\n- Include SQL query in the log on SQL error (#4172)\n- Fix handling untagged responses in IMAP FETCH - \"could not load message\" error (#4180)\n- Fix very small window size in Chrome (#4087)\n- Fix list page reset when viewing a message in Larry skin (#4182)\n- Fix min_refresh_interval handling on preferences save (#4179)\n- Fix PDF support detection for Firefox PDF.js (#4113)\n- Fix possible collision in generated thumbnail cache key (#4177)\n- Fix exit code on bootsrap errors in CLI mode (#4160)\n- Fix error handling in CLI mode, use STDERR and non-empty exit code (#5161)\n- Fix error when using check_referer=true\n- Fix incorrect handling of some specific links (#4171)\n- Fix incorrect handling of leading spaces in text wrapping\n- Fix unintentional messages list jumps on click in Internet Explorer (#4167)\n- Fix list of required configuration options (#4166)\n- Fix DB error when creating a new contact and a group is selected (#4164)\n- Fix handling of deprecated boolean value of reply_mode option (#4165)\n\nRELEASE 0.9.0\n-------------\n- Fix display of HTML entities in protected folder name (#4159)\n- Set minimal permissions to temp files (#4131)\n- Improve content check for embedded images without filename (#4151)\n- Fix handling of invalid characters in message headers and output (#4153)\n- Fix selecting collapsed rows on select-all (#4156)\n- Avoid race-conditions with concurrent attachment uploads (#3739)\n- Fix possible header duplicates when using additional headers (#4154)\n- Fix session issues with use_https=true (#4125)\n- Fix blockquote width in sent mail (#4152)\n- Fix keyboard events on list widgets in Internet Explorer (#4148)\n\nRELEASE 0.9-rc2\n---------------\n- Fix security issue in save-pref command\n- Remove sig_above configuration option, use reply_mode only (#4135)\n- Refresh current folder in opener window after draft save or message sent (#4132)\n- Fix saving draft just after entering compose window (#4141)\n- Fix javascript error in IE9 when loading form with placeholders into an iframe (#4138)\n- Fix handling of some conditional comment tags in HTML message (#4136)\n- Fix so forward as attachment works if additional attachment is added by message_compose hook (#4134)\n- Better handling of session errors in ajax requests (#4105)\n- Fix HTML part detection for some specific message structures (#4130)\n- Don't show fake address - phishing prevention (#4120)\n- Fix forward as attachment bug with editormode != 1 (#4129)\n- Fix LIMIT/OFFSET queries handling on MS SQL Server (#4123)\n- Fix so task name can really contain all from a-z0-9_- characters (#4095)\n- Fix javascript errors when working in a page opened with taget=\"_blank\"\n- Mention SQLite database format change in UPGRADING file (#4122)\n- Increase maxlength to 254 chars for email input fields in addressbook (#4126)\n- Fix thumbnail size when GD extension is used for image resize (#4124)\n- Display notice that message is encrypted also for application/pkcs7-mime messages (#3815)\n\nRELEASE 0.9-rc\n--------------\n- Fix plain text spellchecker incorrect highlighting in non-ASCII text (#4114)\n- Add workaround for invalid message charset detection by IMAP servers (#4112)\n- Fix NUL characters in content-type of ms-tnef attachment (#4108)\n- Fix regression in handling LDAP contact identifiers (#4104)\n- Updated translations from Transifex\n- Fix buggy error template in a frame (#4092)\n- Add addressbook widget on compose page in classic skin\n- Add search box to compose address book widget (#3710)\n- Fix login in case when default_host is an array with one element (#4085)\n- Use LDAP fallback hosts on connect + bind instead of ldap_connect() only.\n- Add config option for LDAP bind timeout (sets LDAP_OPT_NETWORK_TIMEOUT option)\n- Submit Addressbook advanced search form with Enter key (#3843)\n- Also block remote images in HTML part view (#4013)\n- Improved database schema upgrade procedure, added updatedb.sh script\n- Force autocommit mode in mysql database driver (#4068)\n\nRELEASE 0.9-beta\n----------------\n- Fix searching by date in address book (#4058)\n- Improve charset detection by prioritizing charset according to user language (#2032)\n- Fix handling of escaped separator in vCard file (#4064)\n- Add option to use envelope From address for MDN responses (#4052)\n- Add possibility to search in message body only (#3977)\n- Support \"multipart/relative\" as an alias for \"multipart/related\" type (#4057)\n- Display PGP/MIME signature attachments as \"Digital Signature\" (#3845)\n- Workaround UW-IMAP bug where hierarchy separator is added to the shared folder name (#4051)\n- Fix version comparisons with -stable suffix (#4050)\n- Add unsupported alternative parts to attachments list (#4046)\n- Add Compose button on message view page (#3959)\n- Display 'Sender' header in message preview\n- Plugin API: Added message_before_send hook\n- Fix contact copy/add-to-group operations on search result (#4042)\n- Use matching identity in MDN response (#4043)\n- Fix handling of signatures on draft edit (#3996)\n- Fix so compacting of non-empty folder is possible also when messages list is empty (#4039)\n- Allow forwarding of multiple emails (#2941)\n- Fix big memory consumption of DB layer (#4037)\n- Fix broken message/part bodies when FETCH response contains more untagged lines (#4020)\n- Fix empty email on identities list after identity update (#4018)\n- Add new identities_level: (4) one identity with possibility to edit only signature\n- Use Delivered-To and Envelope-To headers for identity selection (#4024, #3835)\n- Fix XSS vulnerability using Flash files (#4014)\n- Always save drafts with format=flowed in order to keep original line wraps (#3997)\n- Select default_addressbook on the list in Address Book (#3624)\n- Fix so mobile phone has TYPE=CELL in exported vCard (#4004)\n- Support contacts import from CSV file (#2605)\n- Improved keep-alive action. Now the interval is based on session_lifetime (#3799)\n- Added cross-task 'refresh' request for system state updates (#3799)\n- Renamed config options: keep_alive to refresh_interval, min_keep_alive to min_refresh_interval\n- Fix handling of text/enriched content on message reply/forward/edit\n- Option to display attached images as thumbnails below message body\n- Upgraded to jQuery 1.8.3 and jQuery UI 1.9.1\n- Add config option to automatically generate LDAP attributes for new entries\n- Add user settings to open message view and compose form in new windows (#1886)\n- Better client-side timezone detection using the jsTimezoneDetect library (#3947)\n- Add option to disable saving sent mail in Sent folder - no_save_sent_messages (#3923)\n- Fix handling dont_override with message_sort_col and message_sort_order settings (#3970)\n- Fix handling of URLs with asterisk characters (#3969)\n- Remove automatic to-lowercase conversion of usernames (#3941)\n- Plugin API: Add 'email_list' argument for identities data in user_create hook\n- Integrated zipdownload plugin to download all attachments (#617)\n- Fix HTML special characters handling in message list/header display (#3812)\n- List related text/html part as attachment in plain text mode (#3918)\n- Use IMAP BINARY (RFC3516) extension to fetch message/part bodies\n- Fix folder creation under public namespace root (#3910)\n- Fix so \"Edit as new\" on draft creates a new message (#3924)\n- Fix invalid error message on deleting mail from read only folder (#3929)\n- Replace data URIs of images (pasted in HTML editor) with inline attachments (#3795)\n- Remove (too big) min-width on mail screen\n- Added template object 'frame'\n- Add option to enable HTML editor on forwarding (#3807)\n- Add option to not include original message on reply, rename option top_posting to reply_mode (#1615)\n- Added session_path config option and unified cookies settings in javascript\n- Added \"Undeleted\" option to messages list filter\n- Rewritten test scripts for PHPUnit\n- Add new DB abstraction layer based on PHP PDO, supporting SQLite3 (#3668)\n- Removed PEAR::MDB2 package\n- Removed users.alias column, added option ('user_aliases')\n  to use email address from identities as username (#3851)\n- Removed redundant cache.cache_id column (#3817)\n- Fix order of attachments in sent mail (#3740)\n- Fix Shift + delete button does not permanently delete messages (#3598)\n- Add Content-Length for attachments where possible (#1880)\n- Fix attachment sizes in message print page and attachment preview page (#3805)\n- Add mail attachments using drag & drop on HTML5 enabled browsers\n- Add workaround for invalid BODYSTRUCTURE response - parse message with Mail_mimeDecode package (#1966)\n- Display Tiff as Jpeg in browsers without Tiff support (#3757)\n- Don't display Pdf/Tiff/Flash attachments inline without browser support (#3757, #3394)\n- Add is_escaped attribute for html_select and html_textarea (#3782)\n- Fix issue where draft auto-save wasn't executed after some inactivity time\n- Add vCard import from multiple files at once (#3458)\n- Roundcube Framework:\n    Add possibility to replace IMAP driver with custom class\n    Add IMAP auto-connection feature, improving performance with caching enabled\n    Replace imap_init hook with storage_init (with additional 'driver' argument)\n    Improved performance by caching IMAP server's capabilities in session\n    Unified global functions naming (rcube_ prefix)\n    Better classes separation\n    Framework files moved to lib/Roundcube\n\nRELEASE 0.8.5\n-------------\n- Fix #countcontrols issue in IE<=8 when text is very long (#4060)\n- Fix unwanted horizontal scrollbar in message preview header (#4044)\n- Add workaround for IE<=8 bug where Content-Disposition:inline was ignored (#4028)\n- Fix XSS vulnerability in vbscript: and data:text links handling [CVE-2012-6121] (#4033)\n- Fix absolute positioning in HTML messages (#4007)\n- Fix cache (in)validation after setting \\Deleted flag\n- Fix keybord events on messages list in opera browser (#4011)\n- Fix selection of collapsed thread rows (#3978)\n- Fix wrapping of quoted text with format=flowed (#3561)\n\nRELEASE 0.8.4\n-------------\n- Fix regression where unintentional page reload was done after request abort (#3999)\n- Fix XSS vulnerability in handling of text/enriched messages (#4000)\n- Fix handling of 'media' attribute on linked css (#3989)\n- Fix excessive LFs at the end of composed message with top_posting=true (#3995)\n- Fix bug where leading blanks were stripped from quoted lines (#3994)\n\nRELEASE 0.8.3\n-------------\n- Fix AREA links handling (#3992)\n- Fix possible HTTP DoS on error in keep-alive requests (#3983)\n- Fix compatybility with MDB2 2.5.0b4 (#3982)\n- Fix a bug where saving a message in INBOX wasn't possible\n- Fix HTML part detection in messages with attachments (#3976)\n- Fix bug where wrong words were highlighted on spell-before-send check\n- Fix scrolling quirk in email preview frame using Opera 12 (#3973)\n- Fix displaying of multipart/alternative messages with empty parts (#3961)\n- Fix threaded list sorting on PHP < 5.2.9 (#3960)\n- Fix Warning: htmlspecialchars(): charset `RCMAIL_CHARSET' not supported warning in Installer (#3958)\n\nRELEASE 0.8.2\n-------------\n- Fix XSS vulnerability from HTTP User-Agent header (#3954)\n- Force fonts in compose fields to be all the same (#3926)\n- Fix handling vCard entries with TEL;TYPE=CELL (#3949)\n- Fix error where session wasn't updated after folder rename/delete (#3928)\n- Fix PLAIN authentication for some IMAP servers (#3916)\n- Fix encoding vCard file when contains PHOTO;ENCODING=b (#3922)\n- Fix focus issue in IE when selecting message row (#3881)\n- Add full headers view in message preview window (#3823)\n- Fix message display page issues - unified with message preview (#3856, #3895)\n- Fix displaying all headers when they contain malformed characters (#3911)\n- Fix decoding of HTML messages with UTF-16 charset specified (#3902)\n- Fix quota capability detection so it can be overwritten by a plugin (#3903)\n- Fix identity selection on reply (#3516)\n- Fix Larry's messages list filter in IE (#3890)\n- Fix more IE issues by disabling Compat. mode with X-UA-Compatible meta tag (#3886)\n- Fix setting locales under Solaris - use additional .UTF-8 suffix (#3887)\n- Fix email address validation for addresses with IP address in domain part\n- Fix Larry skin issues in IE7 compat. mode (#3879)\n- Fix so subscribed non-existing/non-accessible shared folder can be unsubscribed\n\nRELEASE 0.8.1\n-------------\n- Fix bug where domain name was converted to lower-case even with login_lc=false (#3859)\n- Fix lower-casing email address on replies (#3863)\n- Fix line separator in exported messages (#3866)\n- Fix XSS issue where plain signatures wasn't secured in HTML mode [CVE-2012-4668] (#3875)\n- Fix XSS issue where href=\"javascript:\" wasn't secured [CVE-2012-3508] (#3875)\n- Fix impossible to create message with empty plain text part (#3873)\n- Fix stripped apostrophes when replying in plain text to HTML message (#3869)\n- Fix inactive Save search option after advanced search (#3870)\n- Fix Remove from group option is active for contact search result (#3871)\n- Disable autocapitalization in login form on iPad/iPhone (#3872)\n- Fix focus on the list when list row is clicked (#3865)\n- Added separate From and To columns apart from smart From/To column (#2970)\n- Fix fallback to Larry skin when configured skin isn't available (#3857)\n- Fix (workaround) delete operations with some versions of memcache (#3858)\n- Fix (disable) request validation for spell and spell_html actions\n\nRELEASE 0.8.0\n-------------\n- Don't show product version on login screen (can be enabled by config)\n- Renamed old default skin to 'classic'. Larry is the new default skin.\n- Support connections to memcached socket file (#3848)\n- Enable TinyMCE inlinepopups plugin\n- Update to TinyMCE 3.5.6\n- Correctly escape localized labels in javascript variable (#3842)\n- Update Net_SMTP/Auth_SASL packages to fix Digest-MD5/Cram-MD5 authentication (#3846)\n- Don't add attachments content into reply/forward/draft message body (#3837)\n- Fix 'no connection' errors on page unloads (#3832)\n- Plugin API: Add 'unauthenticated' hook (#3545)\n- Show explicit error message when provided hostname is invalid (#3834)\n- Fix wrong compose screen elements focus in IE9 (#3826)\n- Fix fatal error when date.timezone isn't set (#3831)\n- Update to TinyMCE 3.5.4.1\n- Better icons with distinct shapes for priority columns (#3706)\n- Show dedicated icon for multipart/report messages (#3813)\n- Properly hide text of icon links/buttons (#3820)\n- Fix handling of unitless CSS size values in HTML message (#3821)\n- Fix removing contact photo using LDAP addressbook (#3737)\n- Fix storing X-ANNIVERSARY date in vCard format (#3816)\n- Update to Mail_Mime-1.8.5 (#3810)\n- Fix XSS vulnerability in message subject handling using Larry skin [CVE-2012-3507] (#3809)\n- Fix handling of links with various URI schemes e.g. \"skype:\" (#3521)\n- Fix handling of links inside PRE elements on html to text conversion\n- Fix indexing of links on html to text conversion\n- Decode header value in rcube_mime::get() by default (#3803)\n- Fix errors with enabled PHP magic_quotes_sybase option (#3798)\n- Fix SQL query for contacts listing on MS SQL Server (#3797)\n- Fix window.resize handler on IE8 and Opera (#3758)\n- Don't let error message popups cover the login form (#3794)\n- Update to TinyMCE 3.5.2\n- Don't show errors when moving contacts into groups they are already in (#3788)\n- Make folders with unread messages in subfolders bold again (#2892)\n- Abbreviate long attachment file names with ellipsis (#3793)\n- Fix html2text conversion of strong|b|a|th|h tags when used in upper case\n- Add listcontrols template container in Larry skin (#3792)\n- Fix host autoselection when default_host is an array (#3790)\n- Move messages forwarding mode setting into Preferences\n- Fix HTML entities handling in HTML editor (#3780)\n- Fix listing shared folders on Courier IMAP (#3767)\n\nRELEASE 0.8-rc\n--------------\n- Added new translations in Belarusian, Interlingua and Malayalam\n- Flipped compose options arrow (#3772)\n- Fix handling of large uuencode attachments (#3771)\n- Fix handling of \"usemap\" attribute (#3770)\n- Fix handling of some HTML tags e.g. IMG (#3769)\n- Use similar language as a fallback for plugin localization (#3726)\n- Fix issue where signature wasn't re-added on draft compose (#3659)\n- Update to TinyMCE 3.5 (#3762)\n- Fixed multi-threaded autocompletion when number of threads > number of sources\n- Allow to configure the number of values allowed for each LDAP attribute\n- Support for serialized LDAP address values (usually delimited with a $)\n- Less restrictive session auth checks, repeat keep-alive requests on failure (#3755)\n- Fix redirect to mail/compose on re-login (#3585)\n- Add IE8 hack for messages list issue (#3317)\n- Fix handling errors on draft auto-save\n- Fix importing vCard photo with ENCODING param specified (#3746)\n- Support multiple name/email pairs for Bcc and Reply-To identity settings (#3752)\n- Set flexible width to login form fields (#3735)\n- Fix re-draw bug on list columns change in IE8 (#3318)\n- Allow mass-removal of addresses from a group (#3259)\n- Fix removing all contacts on import to LDAP addressbook\n- Fix so \"Back\" from compose/show doesn't reset search request (#3594)\n- Add option to delete messages instead of moving to Trash when in Junk folder (#2805)\n- Fix invisible cursor when replying to a html message (#3100)\n- Reset IP stored in session when destroying session data (#3485)\n- Fix bug where memory_limit = -1 wasn't handled properly\n- Support LDAP RFC2256's country object class read/write (#3535)\n- Upgraded to jQuery 1.7.2\n- Image resize with GD extension (#3712)\n- Fix lack of warning when switching task in compose window (#3725)\n- Fix bug where it wasn't possible to enter ( or & characters in autocomplete fields\n- Request all needed fields from address book backends (#3721)\n- Unified (single) spellchecker button\n- Scroll long lists on drag&drop (#2249)\n- Copy all skins in installto script (#3705)\n\nRELEASE 0.8-beta\n----------------\n- Upgraded to jQuery 1.7.1 (#3673) and jQuery UI 1.8.18\n- Add Russian to the spellchecker languages list (#3542)\n- Remember custom skin selection after logout (#3688)\n- Make sure About tab is always the last tab (#3609)\n- Fix issue with folder creation under INBOX. namespace (#3683)\n- Added mailto: protocol handler registration link in User Preferences (#2729)\n- Handle identity details box with an iframe (#3066)\n- Fix issue where some text from original message was missing on reply (#3675)\n- Fix autoselect_host() for login (#3639)\n- Changed license to GNU GPLv3+ with exceptions for skins & plugins\n- Added address book widget on compose screen\n- Use proper timezones from PHP's internal timezonedb (#1973)\n- Add separate pagesize setting for mail messages and contacts (#3617)\n- Deprecate $DB, $USER, $IMAP global variables, Use $RCMAIL instead\n- Add option to set default font for HTML message (#894)\n- Fix issues with big memory allocation of IMAP results\n- Prevent from memory_limit exceeding when trying to parse big messages bodies (#3164)\n- Add possibility to add SASL mechanisms for SMTP in smtp_connect hook (#3399)\n- Mark (with different color) folders with recent messages (#2479)\n- Added About tab in Settings\n- TinyMCE updated to 3.4.6\n\nRELEASE 0.7.2\n-------------\n- Fix encoding of attachment with comma in name (#3717)\n- Fix handling of % character in IMAP protocol (#3711)\n- Fix duplicate names handling in addressbook searches (#3704)\n- Fix displaying of HTML messages from Disqus (#3702)\n- Disable E_STRICT warnings on PHP 5.4\n- Prevent from folder selection on virtual folder collapsing (#3681)\n- Fix automatic unsubscribe of non-existent folders\n- Fix double-quotes handling in recipient names\n- User configurable setting how to display contact names in list\n- Make contacts list sorting configurable for the admin/user\n- Fix parse errors in DDL files for MS SQL Server\n- Revert SORT=DISPLAY support, removed by mistake (#3664)\n- Add lost translation label in de_DE (#3654)\n- Fix drafts update issues when edited from preview pane (#3653)\n- Fix wrong variable name in rcube_ldap.php (#3643)\n- Make mime type detection based on filename extension to be case-insensitive\n- Fix failure on MySQL database upgrade from 0.7 - text column can't have default value (#3642)\n\n\nRELEASE 0.7.1\n-------------\n- Fix bug in handling of base href and inline content (#3634)\n- Fix SQL Error when saving a contact with many email addresses (#3630)\n- Fix strict email address searching if contact has more than one address\n- Remove duplicated 'organization' label (#3631)\n- Fix so editor selector is hidden when 'htmleditor' is listed in 'dont_override'\n- Fix wrong (long) label usage (#3627)\n- Fix handling of INBOX's subfolders in special folders config (#3623)\n- Add ifModule statement for setting Options -Indexes in .htaccess file (#3620)\n- Fix crashes with eAccelerator (#3608)\n- Fix searching on IMAP servers without CHARSET specifier support (#3619)\n- Fix expanding folders during drag&drop (#3611)\n- Fix wrong postgres sequence name in upgrade from 0.6\n- Fix broken CREATE INDEX queries in SQLite DDL files (#3607)\n\nRELEASE 0.7\n-----------\n- Make Roundcube render the Email Standards Project Acid Test correctly\n- Replace prompt() with jQuery UI dialog (#1603)\n- Fix navigation in messages search results\n- Improved handling of some malformed values encoded with quoted-printable (#3590)\n- Add possibility to do LDAP bind before searching for bind DN\n- Fix handling of empty <U> tags in HTML messages (#3584)\n- Add content filter for embedded attachments to protect from XSS on IE [CVE-2012-1253] (#3372)\n- Use strpos() instead of strstr() when possible (#3581)\n- Fix handling HTML entities when converting HTML to text (#3582)\n- Fix fit_string_to_size() renders browser and ui unresponsive (#3577)\n- Fix handling of invalid characters in request (#3536)\n- Fix merging some configuration options in update.sh script (#2181)\n- Fix so TEXT key will remove all HEADER keys in IMAP SEARCH (#3578)\n- Fix handling contact photo url with https:// prefix (#3575)\n- Fix possible infinite redirect on attachment preview (#3572)\n- Improved clickjacking protection for browsers which don't support X-Frame-Options headers\n- Fixed bug where similar folder names were highlighted wrong (#3345)\n- Fixed bug in handling link with '!' character in it (#3569)\n- Fixed bug where session ID's length was limited to 40 characters (#3570)\n- TinyMCE security issue: removed moxieplayer (embedding flv and mp4 is not supported anymore)\n\nRELEASE 0.7-beta\n----------------\n- Fix handling of HTML form elements in messages (#1604)\n- Fix regression in setting recipient to self when replying to a Sent message (#3101)\n- Fix listing of folders in hidden namespaces (#2895)\n- Don't consider \\Noselect flag when building folders tree (#3448)\n- Fix sorting autocomplete results (#3504)\n- Add option to set session name (#2630)\n- Add option to skip alternative email addresses in autocompletion\n- Fix inconsistent behaviour of Compose button in Drafts folder, add Edit button for drafts\n- Fix problem with parsing HTML message body with non-unicode characters (#3312)\n- Add option to define matching method for addressbook search (#2720, #3378)\n- Make email recipients separator configurable\n- Fix so folders with \\Noinferiors attribute aren't listed in parent selector\n- Fix handling of curly brackets in URLs (#3555)\n- Fix handling of dates (birthday/anniversary) in contact data (#3552)\n- Fix error on opening searched LDAP contact (#3550)\n- Fix redundant line break in flowed format (#3551)\n- Fix IDN address validation issue (#3544)\n- Fix JS error when dst_active checkbox doesn't exist (#3540)\n- Autocomplete LDAP records when adding contacts from mail (#3498)\n- Plugin API: added 'ready' hook (#3492)\n- Ignore DSN request when it isn't supported by SMTP server (#3300)\n- Make sure LDAP name fields aren't arrays (#3523)\n- Fixed imap test to non-default port when using ssl (#3532)\n- Force all files to be overwritten when updating (#3531)\n- Fix issue where it wasn't possible to change list view mode in folder manager for INBOX (#3522)\n- Fix namespace handling in special folders settings (#3527)\n- Disable time limit for CLI scripts (#3524)\n- Fix misleading display when chaning editor type (#3519)\n- Add loading indicator on contact delete\n- Fix bug where after delete message rows can be added to the list of another folder (#3263)\n- Add notice on autocompletion that not all records were displayed\n- Add option 'searchonly' for LDAP address books\n- Add Priority filter to the messages list\n- Cache synchronization using QRESYNC/CONDSTORE\n- Trigger 'new_messages' hook for all checked folders (#3503)\n- Make date/time format user configurable; drop 'date_today' config option\n- Fix setting title for truncated subject in IE (#3141)\n- Fix displaying multipart/alternative messages with only one part (#3400)\n- Rewritten messages caching:\n  Indexes are stored in a separate table, so there's no need to store all messages in a folder\n  Added threads data caching\n  Flags are stored separately, so flag change doesn't cause DELETE+INSERT, just UPDATE\n- Improved FETCH response handling\n- Improvements in response tokenization method\n- Use 'From' and 'To' labels instead of 'Sender' and 'Recipient'\n- Fix username case-insensitivity issue in MySQL (#3462)\n- Addressbook Saved Searches\n- Added spellchecker exceptions dictionary (shared or per-user)\n- Added possibility to ignore words containing caps, numbers, symbols (spellcheck_ignore_* options)\n- Added 'priority' column on messages list (#2884)\n- Localize forwarded message header (#3487)\n\nRELEASE 0.6\n-----------\n- Fix bug where the last identity is used on reply (#3516)\n- Fix locked folder rename option on servers supporting RFC2086 only (#3508)\n- Fix session race conditions when composing new messages\n- Fix encoding of LDAP contacts identifiers (#3501)\n- jQuery 1.6.4\n- Fix handling of binary attachments encoded with quoted-printable (#3494)\n- Fix text-overflow:ellipsis issues on messages list in FF7 and Webkit (#3490)\n- Fix handling of links with IP address\n- Fix compacting folder resets message list filter (#3499)\n\nRELEASE 0.6-rc\n----------------\n- Send X-Frame-Options headers to protect from clickjacking (#3079)\n- Fallback to mail_domain in LDAP variable replacements; added 'host' to 'user_create' hook arguments (#3464)\n- Fixed wrong vCard type parameter mobile (#3496)\n- Fixed vCard WORKFAX issue (#3476)\n- Add vCard's Profile URL support (#3491)\n- jQuery 1.6.3\n- Fix imap_cache setting to values other than 'db' (#3489)\n- Fix handling of attachments inside message/rfc822 parts (#3466)\n- Make list of mimetypes that open in preview window configurable (#3175)\n- Added plugin hook 'message_part_get' for attachment downloads\n- Added unique connection identifier to IMAP debug messages\n- Fix image type check for contact photo uploads\n\nRELEASE 0.6-beta\n----------------\n- Fixed selecting identity on reply/forward (#3434)\n- Add option to hide selected LDAP addressbook on the list\n- Add client-side checking of uploaded files size\n- Add newlines between organization, department, jobtitle (#3468)\n- Recalculate date when replying to a message and localize the cite header (#3212)\n- Fix handling of email addresses with quoted local part (#3401)\n- Fix EOL character in vCard exports (#3357)\n- Added optional \"multithreading\" autocomplete feature\n- Plugin API: Added 'config_get' hook\n- Fixed new_user_identity plugin to work with updated rcube_ldap class (#3443)\n- Plugin API: added folder_delete and folder_rename hooks\n- Added possibility to undo last contact delete operation\n- Fix sorting of contact groups after group create (#3258)\n- Add optional textual upload progress indicator (#2330)\n- Fix parsing URLs containing commas (#3425)\n- Added vertical splitter for books/groups list in addressbook (#3389)\n- Improved namespace roots handling in folder manager\n- Added searching in all addressbook sources\n- Added addressbook source selection in contacts import\n- Implement LDAPv3 Virtual List View (VLV) for paged results listing\n- Use 'address_template' config option when adding a new address block (#3406)\n- Added addressbook advanced search\n- Add popup with basic fields selection for addressbook search\n- Case-insensitive matching in autocompletion (#3398)\n- Added option to force spellchecking before sending a message (#1862)\n- Fix handling of \"<\" character in contact data, search fields and folder names (#3349)\n- Fix saving \"<\" character in identity name and organization fields (#3349)\n- Added option to specify to which address book add new contacts\n- Added plugin hook for keep-alive requests\n- Store user preferences in session when write-master is not available and session is stored in memcache, write them later\n- Improve performence of folder manager operations\n- Fix default_port option handling in Installer when config.inc.php file exists (#3390)\n- Removed option focus_on_new_message, added newmail_notifier plugin\n- Added general rcube_cache class with Memcache and APC support\n- Improved caching performance by skipping writes of unchanged data\n- Option enable_caching replaced by imap_cache and messages_cache options\n- Fix WORKFAX saving in address book (#3380)\n- Add forward-as-attachment feature\n- jQuery-1.6.2 (#5158, #3154)\n- Improve display name composition when saving contacts (#3153)\n- Fix problems with subfolders of INBOX folder on some IMAP servers (#3247)\n- Fix handling of folders that doesn't belong to any namespace (#3184)\n- Enable multiselection for attachments uploading in capable browsers (#2266)\n- Add possibility to change HTML editor configuration by skin\n- Fix a bug where selecting too many contacts would produce too large URI request (#3369)\n- Improve performance by including files with absolute path (#3337)\n- Move folder name truncation to client/skin (#1822)\n- Added plugin hook for request token creation\n- Replace LDAP vars in group queries (#3329)\n- Fix vcard folding with uncode characters (#3353)\n- Keep all submitted data if contact form validation fails (#3350)\n- Handle uncode strings in rcube_addressbook::normalize_string() (#3351)\n- Fix handling of debug_level=4 in ajax requests (#3327)\n- Enable TinyMCE's contextmenu (#3062)\n- Allow multiple concurrent compose sessions\n- New config option for custom logo\n- Allow skins to define/override texts with <roundcube:label />\n- Add simple ACL rights/namespace handling in folder manager\n- Force IE to send referers (#3306)\n- Better display of vcard import results (#1861)\n- Improved vcard import\n- Interactive update script with improved DB schema check\n- Fix problem with contactgroupmembers table creation on MySQL 4.x, add index on contact_id column\n- Add LDAP SASL bind and proxy authentication (#2810)\n- Replying to a sent message puts the old recipient as the new recipient (#3101)\n- Fulltext search over (almost) all data for contacts\n- Extend address book with rich contact information\n\nRELEASE 0.5.4\n-------------\n- Fix XSS vulnerability in UI messages [CVE-2011-2937] (#3469)\n\nRELEASE 0.5.3\n-------------\n- Fix identities \"reply-to\" and \"bcc\" fields have a bogus value when left empty (#3405)\n- Fix issue which cases IMAP disconnection when encrypt() method was used (#3374)\n- Fix some CSS issues in Settings for Internet Explorer \n- Fixed handling of folder with name \"0\" in folder selector\n- Fix bug where messages were deleted instead moved to trash folder after Shift key was used (#3376)\n- Fix relative URLs handling according to a <base> in HTML (#3368)\n- Fix handling of top-level domains with more than 5 chars or unicode chars (#3366)\n- Fix usage of non-standard HTTP error codes (#3297)\n- Fix PHP warning on mistaken in_array() usage (#3375)\n\nRELEASE 0.5.2\n-------------\n- TinyMCE 3.4.2 now compatible with IE9\n- PEAR::Net_SMTP 1.5.2, fixed timeout issue (#3332)\n- Fix bug where template name without plugin prefix was used in render_page hook\n- Support 'abort' and 'result' response in 'preferences_save' hook, add error handling\n- Fix bug where some content would cause hang on html2text conversion (#3348)\n- Improve space-stuffing handling in format=flowed messages (#3346)\n- Fix bug where some dates would produce SQL error in MySQL (#3342)\n- Added workaround for some IMAP server with broken STATUS response (#3344)\n- Fix bug where default_charset was not used for text messages (#3328)\n- Stateless request tokens. No keep-alive necessary on login page (#3325)\n- Force names of unique constraints in PostgreSQL DDL\n- Add code for prevention from IMAP connection hangs when server closes socket unexpectedly\n- Remove redundant DELETE query (for old session deletion) on login\n- Get around unreliable rand() and mt_rand() in session ID generation (#2516)\n- Fix some emails are not shown using Cyrus IMAP (#3316)\n- Fix handling of mime-encoded words with non-integral number of octets in a word (#3301)\n- Fix parsing links with non-printable characters inside (#3305)\n- Fixed de_CH Localization bugs (#3279)\n- Add variable for 'Today' label in date_today option (#2394)\n- Fix dont_override setting does not override existing user preferences (#3205)\n- Use only one from IMAP authentication methods to prevent login delays (1487784)\n- Support strftime format in date_today option\n- Fix SQL query in rcube_user::query() so it uses index on MySQL again\n- Removed redundant </form> tags from contact add/edit pages\n- Fix CSS error in contact details screen on IE7 (#3281)\n\nRELEASE 0.5.1\n-------------\n- Fix handling of attachments with invalid content type (#3275)\n- Add workaround for DBMail's bug http://www.dbmail.org/mantis/view.php?id=881 (#3274)\n- Use IMAP's ID extension (RFC2971) to print more info into debug log\n- Security: add optional referer check to prevent CSRF in GET requests\n- Fix email_dns_check setting not used for identities/contacts (#3251)\n- Fix ICANN example addresses doesn't validate (#3253)\n- Security: protect login form submission from CSRF [CVE-2011-1491]\n- Security: prevent from relaying malicious requests through modcss.inc [CVE-2011-1492]\n- Fix handling of non-image attachments in multipart/related messages (#3261)\n- Fix IDNA support when IDN/INTL modules are in use (#3253)\n- Fix handling of invalid HTML comments in messages (#3269)\n- Fix parsing FETCH response for very long headers (#3264)\n- Fix add/remove columns in message list when message_sort_order isn't set (#3262)\n- Check mime headers before attempt to parse them (#3256)\n- Quote header values in show_additional_headers plugin (#3255)\n- Fix settings UI on IE 6 (#3246)\n- Remove double borders in folder listing (#3236)\n- Separate full message headers UI element from headers table (#3238)\n- Add part MIME ID to message_part_* hooks (#3241) \n- Improve parsing of MS Outlook vCards (#3239)\n- Updated PEAR::Net_Socket to 1.0.10\n- Updated PEAR::Net_IDNA2 to 0.1.1\n- Fix handling of comments inside an email address spec. (#3210)\n- Show full mail subject as title when hovering a cut subject link (#3141)\n- Fix randomly disappearing folders list in IE (#3231)\n- Fix list column add/removal in IE (#3230)\n- Fix login redirect issues (#3221)\n- Require PHP 5.2.1 or greater\n- Fix %h/%z variables in username_domain option (#3228)\n- Workaround for setting charset in case of malformed bodystructure response (#3227)\n- Fix impossible to subscribe to protected folders (#3199)\n- Fix setting timezone in Preferences (#3232)\n\nRELEASE 0.5\n-----------\n- Fix double-login/session issue (#3124)\n- Wrap HTML parts with <html><body> and add Doctype declaration (#3119)\n- Make rcube_autoload silently skip unknown classes (#3128)\n- Fix charset detection in vcards with encoded values (#1934)\n- Better CSS cursors for splitters (#2954)\n- Show the same message only once (#3186)\n- Fix namespaces handling (#3192)\n- Add handling of multifolder METADATA/ANNOTATION responses\n- Fix handling of INBOX when personal namespace prefix is non-empty (#3200)\n- Fix handling square brackets in links (#3209)\n- Add description of 'use_https' option in main.inc.php.dist file\n\nRELEASE 0.5-RC\n--------------\n- Plugin API: Add 'pass' argument in 'authenticate' hook (#3147)\n- Fix attachments of type message/rfc822 are not listed on attachments list\n- Add 'login_lc' config option for case-insensitive authentication (#3131)\n- Fix window is blur'ed in IE when selecting a message (#3161)\n- Fix cursor position on compose form in Webkit browsers (#2796)\n- Fix setting charset of attachment filenames (#3136)\n- Allow setting autocomplete attribute for all inputs separately (#3158)\n- New Folder Manager UI\n- Fix invalid Request when creating a folder (#3165)\n- Add folder size and quota indicator in folder manager (#2112)\n- Add possibility to move a subfolder into root folder (#2890)\n- Fix copying all messages in a folder copies only messages from current page\n- Improve performance of moving or copying of all messages in a folder\n- Fix plaintext versions of HTML messages don't contain placeholders for emotions (#1657)\n- Improve performance of folder rename and delete actions\n- Better support for READ-ONLY and NOPERM responses handling (#3108)\n- Add confirmation message on purge/expunge command response\n- Fix handling of untagged responses for AUTHENTICATE command (#3171)\n- Add username and IP address to log message on unsuccessful login (#3176)\n- Improved Mail-Followup-To and Mail-Reply-To headers handling\n- Fix charset conversion for text attachments without charset specification (#3181)\n\nRELEASE 0.5-BETA\n----------------\n- Make session data storage more robust against garbage session data (#3148)\n- Config option for autocomplete on login screen\n- Allow plugin templates to include local files (#3146)\n- List groups in address detail view and allow to subscribe/unsubscribe from there (#2862)\n- Messages caching: performance improvements, fixed syncing, fixes related with #2857\n- Add link to identities in compose window (#2843)\n- Add Internationalized Domain Name (IDNA) support (#729)\n- Add option to automatically send read notifications for known senders (#2199)\n- Add option to \"Return receipt\" will be always checked (#2571)\n- Fix HTML to plain text conversion doesn't handle citation blocks (#2992)\n- Use custom sorting when SORT is disabled by IMAP admin (#3020)\n- Allow setting some washtml options from plugin (#2727)\n- Add option do bind for an individual LDAP address book (#3048)\n- Change reply prefix to display email address only if sender name doesn't exist (#2709)\n- Plugin API: improved 'abort' flag handling, added 'result' item in some hooks (#2988)\n- Fix mailto optional params in plain text messages aren't handled (#3071)\n- Add Reply-to-List feature (#977)\n- Add Mail-Followup-To/Mail-Reply-To support (#1937)\n- Fix confirmation message isn't displayed after sending mail on Chrome (#2437)\n- Fix keyboard doesn't work with autocomplete list with Chrome (#3073)\n- Improve tabs to fixed width and add tabs in identities info (#3030)\n- Add unique index on users.username+users.mail_host\n- Make htmleditor option more consistent and add option to use HTML on reply to HTML message (#2164)\n- Use empty envelope sender address for message disposition notifications (RFC 2298.3)\n- Support SMTP Delivery Status Notifications - RFC 3461 (#2409)\n- Use css sprite image for messages list\n- Add (different) attachment icon for messages of type multipart/report (#2426)\n- Prevent from inserting empty link when composing HTML message (#3007)\n- Add caching support in id2uid and uid2id functions (#3065)\n- Add SASL proxy authentication for SMTP (#2811)\n- Improve displaying of UI messages (#3033)\n- Fix double e-mail filed in identity form (#3088)\n- Display IMAP errors for LIST/THREAD/SEARCH commands (#2981)\n- Add LITERAL+ (IMAP4 non-synchronizing literals) support (RFC 2088)\n- Add separate column for message status icon (#2788)\n- Add ACL extension support into IMAP classes (RFC 4314)\n- Add ANNOTATEMORE extension support into IMAP classes (draft-daboo-imap-annotatemore)\n- Add METADATA extension support into IMAP classes (RFC 5464)\n- Fix decoding of e-mail address strings in message headers (#3097)\n- Fix handling of attachments when Content-Disposition is not inline nor attachment (#3086)\n- Improve performance of unseen messages counting (#3090)\n- Improve performance of messages counting using ESEARCH extension (RFC4731)\n- Add LIST-STATUS support in rcube_imap_generic class (RFC 5819)\n- Add SASL-IR support in IMAP (RFC 4959)\n- Add LOGINDISABLED support (RFC 2595)\n- Add support for AUTH=PLAIN in IMAP authentication\n- Re-implemented SMTP proxy authentication support\n- Add support for IMAP proxy authentication (#2808)\n- Add support for AUTH=DIGEST-MD5 in IMAP (RFC 2831)\n- Fix parent folder with unread subfolder not bold when message is open (#3104)\n- Add basic IMAP LIST's \\Noselect option support\n- Add support for selection options from LIST-EXTENDED extension (RFC 5258)\n- Don't list subscribed but non-existent folders (#2474)\n- Fix handling of URLs with tilde (~) or semicolon (;) character (#3110, #3111)\n- Plugin API: added 'contact_form' hook\n- Add SORT=DISPLAY support (RFC 5957)\n- Plugin API: add possibility to disable plugin in AJAX mode, 'noajax' property\n- Plugin API: add possibility to disable plugin in framed mode, 'noframe' property\n- Improve performance of setting IMAP flags using .SILENT suffix\n- Improve performance of message cache status checking with skip_disabled=true\n- Support contact's email addresses up to 255 characters long (#3116)\n- Add option to place replies in the folder of the message being replied to (#2248)\n- Add missing confirmation/error messages on contact/group/message actions (#2935)\n- Add 'loading' message on message move/copy/delete/mark actions\n- Improve responsiveness of messages displaying (#3039)\n- Add option for minimum length of autocomplete's string (#2625)\n- Fix operations on messages in unsubscribed folder (#3126)\n- Add support for shared folders (#525)\n- Fix handling of folders with name \"0\" (#3133)\n- Fix handling of folders with \"<>\" characters in name\n- jQuery 1.4.4\n- Fix handling of HTML entity strings in plain text messages\n- Fix focused elements aren't unfocused when clicking on the list (#3137)\n- Fix error in MSSQL DDL scripts (#3130)\n- Lock submit button in onsubmit event on login page (#3078)\n- Don't set attachment's charset in Content-type header (#3136)\n- Fix handling of message bodies (quoted-printable encoded) with NULL characters (#2448)\n- Add workaround for MSOE's multipart/related messages with non-related attachments\n\nRELEASE 0.4.2\n-------------\n- Fix handling of backslash as IMAP delimiter\n- Fix charset replacement in HTML message bodies (#3067)\n- Fix: contact group input is empty when using rename action more than once on the same group record\n- Fix \"Server Error! (Not Found)\" when using utils/save-pref action (#3069)\n- Fix handling of Thunderbird's vCards (#3070)\n\nRELEASE 0.4.1\n-------------\n- Fix space-stuffing in format=flowed messages (#3064)\n- Fix msgexport.sh now using the new imap wrapper\n- Avoid displaying password on shell (#3010)\n- Only lower-case user name if first login attempt failed (#2600)\n- Make alias setting in squirrelmail_usercopy plugin configurable (patch by pommi, #3056)\n- Prevent from saving a non-existing skin path in user prefs (#3004)\n- Improve handling of single-part messages with bogus BODYSTRUCTURE (#2976)\n- Fix path to SQL files when using pgsql/mysqli/sqlsrv drivers (#2979)\n- Fix upgrade script for SQLite (#2980)\n- Fixes in SQL init script + added update script for MSSQL database\n- Remove redundant date in syslog messages (#3008)\n- Fix contacts list page controls when a group is selected (#3009)\n- Fix SMTP test in Installer (#3014)\n- Fix \"Select all\" causes message to be opened in folder with exactly one message (#2987)\n- Fix Tab key doesn't work in HTML editor in Google Chrome (#2995)\n- Fix TinyMCE uses zh_CN when zh_TW locale is set (#2998)\n- Fix TinyMCE buttons are hidden in Opera (#2993)\n- Fix JS error on IE when trying to send HTML message with enabled spellchecker (#3006)\n- Display inline images with known extensions and non-image content-type (#3002)\n- Fix \"Threaded\" checkbox after subfolder creation (#2997)\n- Fix timezone string in sent mail (#3021)\n- Show disabled checkboxes for protected folders instead of dots (#1898)\n- Added fieldsets in Identity form, added 'identity_form' hook\n- Re-added 'Close' button in upload form (#2999, #2917)\n- Fix handling of charsets with LATIN-* label\n- Fix messages background image handling in some cases (#3043)\n- Fix format=flowed handling (#3042)\n- Fix when IMAP connection fails in 'get' action session shouldn't be destroyed (#3046)\n- Fix list_cols is not updated after column dragging (#3050)\n- Support %z variable in host configuration options (#3054)\n\nRELEASE 0.4\n-----------\n- Fix disappearing upload form disappears when user selects a file on Safari (#2917)\n- Don't replace error messages with loading info (#2534)\n- Fix JS errors on compose mode switch (#2952)\n- Fix message structure parsing when it lacks optional fields (#2960)\n- Include all recipients in sendmail log\n- Support HTTP_X_FORWARDED_PROTO header for HTTPS detecting (#2950)\n- Fix default IMAP port configuration (#2948)\n- Create Sent folder when starting to compose a new message (#2900)\n- Fix handling of messages with Content-Type: application/* and no filename (#840)\n- Improved compose screen: resizable body and attachments list, vertical splitter, options menu\n- Fix RC forgets search results (#722)\n- TinyMCE 3.3.7\n- Improve parsing of styled empty tags in HTML messages (#2908)\n- Add %dc variable support in base_dn/bind_dn config (#2881)\n- Add button to hide/unhide the preview pane (#955)\n- Fix no-cache headers on https to prevent content caching by proxies (#2897)\n- Fix attachment filenames broken with TNEF decoder using long filenames (#2894)\n- Use user's timezone in Date header, not server's timezone (#2393)\n- Add option to set separate footer for HTML messages (#2784)\n- Add real SMTP error description to displayed error messages (#2233)\n- Fix some IMAP errors handling when opening the message (#1848)\n- Fix related parts aren't displayed when got mimetype other than image/* (#2629)\n- Multiple identity and database support for squirrelmail_usercopy plugin (#2686)\n- Support dynamic hostname (%d/%n) variables in configuration options (#1843)\n- Add 'messages_list' hook (#2504)\n- Add request* event triggers in http_post/http_request (#2340)\n- Fix use RFC-compliant line-delimiter when saving messages on IMAP (#2828)\n- Add 'imap_timeout' option (#2869)\n- Fix forwarding of messages with winmail attachments\n- Fix handling of uuencoded attachments in message body (#2163)\n- Added list_mailboxes hook in rcube_imap::list_unsubscribed() (#2791)\n- Fix wrong message on file upload error (#2839)\n- Add support for data URI scheme [RFC2397] (#2851)\n- Added 'actionbefore', 'actionafter', 'responsebefore', 'responseafter' events\n- Fix double-addition of e-mail domain to content ID in HTML images\n- Read and send messages with format=flowed (#1052), fixes word wrapping issues (#2703)\n- Fix duplicated attachments when forwarding a message (#2670)\n- Fix message/rfc822 attachments containing only attachments are not parsed properly (#2854)\n- Fix %00 character in winmail.dat attachments names (#2850)\n- Fix handling errors of folder deletion (#2821)\n- Parse untagged CAPABILITY response for LOGIN command (#2853)\n- Renamed all php-cli scripts to use .sh extension\n- Some files from /bin + spellchecking actions moved to the new 'utils' task\n- Added thread tree icons\n- Extend contact groups support (#2802)\n- Fix check-recent action issues and performance (#2690)\n- Fix messages order after checking for recent (#1249)\n- Fix autocomplete shows entries without email (#2640)\n- Fix listupdate event doesn't trigger on search response (#2824)\n- Fix select_all_mode value after selecting a message (#2834)\n- Set focus to editor on reply in HTML mode (#2768)\n- Fix composing in HTML jumps cursor to body instead of recipients (#2796)\n- Allow columns order change per user - drag&drop (#2124)\n- Add References header in read receipt (#2801)\n- Fix database constraint violation when opening a message (#2814)\n- Add 'loading' message while login is in progress (#2790)\n- Fix quota_zero_as_unlimited (#2786)\n- Fix folder subscription checking (#2804)\n- Fix INBOX appears (sometimes) twice in mailbox list (#2794)\n- Fix listing of attachments of some types e.g. \"x-epoc/x-sisx-app\" (#2779)\n- Fix DB Schema checking when some db_table_* options are not set (#2780)\n\nRELEASE 0.4-beta\n----------------\n- Add sizelimit and timelimit variables in LDAP config (#2704)\n- Hide IMAP host dropdown when single host is defined (#2553)\n- Add images pre-loading on login page (#623)\n- Add HTTP_X_REAL_IP and HTTP_X_FORWARDED_FOR to successful logins log (#2634)\n- Fix setting spellcheck languages with extended codes (#2747)\n- Fix messages list scrolling in FF3.6 (#2657)\n- Fix quicksearch input focus (#2770)\n- Always set changed date when flagging a DB record as deleted + provide a cleanup script\n- Fix address book/group selection (#2760)\n- Assign newly created contacts to the active group (#2764)\n- Added option not to mark messages as read when viewed in preview pane (#1513)\n- Allow plugins modify the Sent folder when composing (#2708)\n- Added optional (max_recipients) support to restrict total number of recipients per message (#1167)\n- Re-organize editor buttons, add blockquote and search buttons\n- Make possible to write inside or after a quoted html message (#1878)\n- Fix bugs on unexpected IMAP connection close (#2449, #2507)\n- Iloha's imap.inc rewritten into rcube_imap_generic class\n- Added contact groups in address book (not finished yet)\n- Added PageUp/PageDown/Home/End keys support on lists (#2627)\n- Added possibility to select all messages in a folder (#1312)\n- Added 'imap_force_caps' option for after-login CAPABILITY checking (#2087)\n- Password: Support dovecotpw encryption\n- TinyMCE 3.3.1\n- Implemented messages copying using drag&drop + SHIFT (#863)\n- Improved performance of folders operations (#2689)\n- Fix blocked.gif attachment is not attached to the message (#2685)\n- Managesieve: import from Horde-INGO\n- Managesieve: support for more than one match (#2362)\n- Managesieve: support for selectively disabling rules within a single sieve script (#2198)\n- Threaded message listing now available\n- Added sorting by ARRIVAL and CC\n- Message list columns configurable by the user\n- Removed 'index_sort' option, now we're using empty 'message_sort_col' for this\n- virtuser_query: support other identity data (#2413)\n- Options virtuser_* replaced with virtuser_* plugins\n- Plugin API: Implemented 'email2user' and 'user2email' hooks\n- Fix forwarding message omits CC header (#2538)\n- Add 'default_charset' option to user preferences (#1855)\n- Add 'delete_always' option to user preferences\n- Support/Require tls:// prefix in 'smtp_server' option for TLS connections\n- Fix inconsistent behaviour of 'delete_always' option (#2533)\n- Fix deleting all messages from last list page (#2528)\n- Flag original messages when sending a draft (#2458)\n- Changed signature separator when top-posting (#2555)\n- Let the admin define defaults for search modifiers (#2211)\n- Fix long e-mail addresses validation (#2641)\n- Remember search modifiers in user prefs (#2411)\n- Added force_7bit option to force MIME encoding of plain/text messages (#2679)\n- Use case sensitive check when checking for default folders (#2567)\n- Fix checking for new mail: now checks unseen count of inbox (#2123)\n- Improve performance by avoiding unnecessary updates to the session table (#2552)\n- Fix invalid <font> tags which cause HTML message rendering problems (#2687)\n- Fix CVE-2010-0464: Disable DNS prefetching (#2639)\n- Fix Received headers to behave better with SpamAssassin (#2682)\n- Password: Make passwords encoding consistent with core, add 'password_charset' global option (#2658)\n- Fix adding contacts SQL error on mysql (#2645)\n- Squirrelmail_usercopy: support reply-to field (#2678)\n- Fix IE spellcheck suggestion popup issue (#2656)\n- Fix email address auto-completion shows regexp pattern (#2498)\n- Fix merging of configuration parameters: user prefs always survive (#2584) \n- Fix quota indicator value after folder purge/expunge (#2671)\n- Fix external mailto links support for use as protocol handler (#2328)\n- Fix attachment excessive memory use, support messages of any size (#1245)\n- Fix setting task name according to auth state\n- Password: fix vpopmaild driver (#2662)\n- Add workaround for MySQL bug [http://bugs.mysql.com/bug.php?id=46293] (#2659)\n- Fix quoted text wrapping when replying to an HTML email in plain text (#897)\n- Fix handling of extended mailto links (with params) (#2573)\n- Fix sorting by date of messages without date header on servers without SORT (#2521)\n- Fix inconsistency when not using default table names (#2652)\n- Fix folder rename/delete buttons do not appear on creation of first folder (#2653)\n- Fix character set conversion fails on systems where iconv doesn't accept //IGNORE (#2590)\n- Log in performance: Create default folders on first login only\n- Import contacts into the selected address book (by Phil Weir)\n- Add support for MDB2's 'sqlsrv' driver (#2602)\n- Use jQuery-1.4\n- Removed problematic browser-caching of messages\n- Fix incompatybility with suhosin.executor.disable_emodifier (#2549)\n- Use PLAIN auth when CRAM fails and imap_auth_type='check' (#2587)\n- Fix removal of <title> tag from HTML messages (#2629)\n- Fix 'force_https' to specified port when URL contains a port number (#2612)\n- Fix to-text converting of HTML entities inside b/strong/th/hX tags (#2621)\n- Bug in spellchecker suggestions when server charset != UTF8 (#2607)\n- Managesieve: Fix requires generation for multiple actions (#2603)\n- Fix LDAP problem with special characters in RDN (#2548)\n- Improved handling of message parts of type message/rfc822\n- Plugin API: added 'quota' hook\n- Fix parsing conditional comments in HTML messages (#2569)\n- Use built-in json_encode() for proper JSON format in AJAX replies\n- Allow setting only selected params in 'message_compose' hook (#2543)\n- Plugin API: added 'message_compose_body' hook (#2520)\n- Fix counters of all folders are checked in 'getunread' action  with check_all_folders disabled (#2399)\n- Fix displaying alternative parts in messages of type message/rfc822 (#2488)\n- Fix possible messages exposure when using Roundcube behind a proxy (#2516)\n- Fix unicode para and line separators in javascript response (#2542)\n- Additional_message_headers: allow unsetting headers, support plugin's config file (#2505)\n- Fix displaying of hidden directories in skins list (#2535)\n- Fix open_basedir restriction error when reading skins list (#2537)\n- Fix pasting from Office apps into html editor (#2508)\n- Fix empty <a> tags parsing (#2509)\n- Don't cut off attachment names when using non-RFC2231 encoding (#1912)\n- Allow inserting signatures above replied message body (#991)\n- Managesieve 2.0: multi-script support\n- Fix imap_auth_type regression (#2502)\n\nRELEASE 0.3.1\n------------------\n- Specify toolbar container in compose template (#2489)\n- Fix $_SERVER['HTTPS'] check for SSL forcing on IIS (#2486)\n- Avoid unnecessary page loads for selected tab (#2324)\n- Fix quota indicator issues by content generation on client-size (#2454, #2470)\n- Don't display disabled sections in Settings (#2380)\n- Added server-side e-mail address validation with 'email_dns_check' option (#2175)\n- Fix login page loading into an iframe when session expires (#2253)\n- Allow setting port number in 'force_https' option (#2373)\n- Option 'force_https' replaced by 'force_https' plugin\n- Fix IE issue with non-UTF-8 characters in AJAX response (#2422)\n- Partially fixed \"empty body\" issue by showing raw body of malformed message (#2427)\n- Fix importing/sending to email address with whitespace (#2467)\n- Added XIMSS (CommuniGate) driver for Password plugin\n- Fix newly attached files are not saved in drafts w/o editing any text (#2457)\n- Added attachment upload indicator with parallel upload (#2344)\n- Use default_charset for bodies of messages without charset definition (#2446)\n- Password: added cPanel driver\n- Fix return to first page from e-mail screen (#2385)\n- Fix handling HTML comments in HTML messages (#2448)\n- Fix folder/messagelist controls alignment - icons used (#2356)\n- Fix LDAP addressbook shows 'Contact not found' error sometimes (#2438)\n- Fix cache status checking + improve cache operations performance (#2384)\n- Prevent from setting INBOX as any of special folders (#2390)\n- Fix regular expression for e-mail address (#2417)\n- Fix Received header format\n- Implemented sorting by message index - added 'index_sort' option (#2240)\n- Fix dl() use in installer (#2415)\n- Added 'ldap_debug' option\n- Fix \"Empty startup greeting\" bug (#2369)\n- Fix setting user name in 'new_user_identity' plugin (#2405)\n- Fix incorrect count of new messages in folder list when using multiple IMAP clients (#2289)\n- Fix all folders checking for new messages with disabled caching (#2399)\n- Support skins in 'archive' and 'markasjunk' plugins\n- Added 'html_editor' hook (#2353)\n- Fix DB constraint violation when populating messages cache (#2338)\n- Password: added password strength options (#2348)\n- Fix LDAP partial result warning (#1928)\n- Fix delete in message view deletes permanently with flag_for_deletion=true (#2382)\n- Use faster/secure mt_rand() (#2376)\n- Fix roundcube hangs on empty inbox with bincimapd (#2375)\n- Fix wrong headers for IE on servers without $_SERVER['HTTPS'] (#2232)\n- Force IE style headers for attachments in non-HTTPS session, 'use_https' option (#2023)\n- Check 'post_max_size' for upload max filesize (#2372) \n- Password Plugin: Fix %d inserts username instead of domain (#2371)\n- Fix rcube_mdb2::affected_rows() (#2366)\n\nRELEASE 0.3-stable\n------------------\n- Fix gn and givenName should be synonymous in LDAP addressbook (#2208)\n- Add mail_domain to LDAP email entries without @ sign (#1652)\n- Fix saving empty values in LDAP contact data (#2113)\n- Fix LDAP contact update when RDN field is changed (#2119)\n- Fix LDAP attributes case senitivity problems (#2155)\n- Fix LDAP addressbook browsing when only one directory is used (#2314)\n- Fix endless loop on error response for APPEND command (#2346)\n- Don't require date.timezone setting in installer (#2284)\n- Fix date sorting problem with Courier IMAP server (#2351)\n- Unselect pressed buttons on mouse up (#2283)\n- Don't set php_value error_log in .htaccess but mention in INSTALL (#2230)\n- Fix too small status/flag/attachment columns in Safari 4 (#2349)\n- Fix selection disabling while dragging splitter in webkit browsers (#2342)\n- Added 'new_messages' plugin hook (#2298)\n- Added 'logout_after' plugin hook (#2333)\n- Added 'message_compose' hook\n- Added 'imap_connect' hook (#2256)\n- Fix vcard_attachments plugin (#2326)\n- Updated PEAR::Auth_SASL to 1.0.3 version\n- Use sequence names only with PostgreSQL (#2310)\n- Re-designed User Preferences interface \n- Fix MS SQL DDL (#2312)\n- Fix rcube_mdb2.php: call to setCharset not implemented in mssql driver (#2311)\n- Added 'display_next' option\n- Fix rcube_mdb2::unixtimestamp for MS SQL (#2308)\n- Fix HTML washing to respect character encoding\n- Fix endless loop in iil_C_Login() with Courier IMAP (#2303)\n- Fix #messagemenu display on IE (#2299)\n- Speedup UI by using sprites for (toolbar) buttons\n- Fix charset names with X- prefix handling\n- Fix displaying of HTML messages with unknown/malformed tags (#2296)\n\nRELEASE 0.3-RC1\n---------------\n- Fix import of vCard entries with params (#1857)\n- Fix HTML messages output with empty block elements (#2271)\n- Use request tokens to protect POST requests from CSRF [CVE-2009-4076, CVE-2009-4077]\n- Added hook when killing a session\n- Added hook to write_log function (#2268)\n- Performance improvements by use UID commands (#2046)\n- Fix HTML editor tabIndex setting (#2269)\n- Added 'imap_debug' and 'smtp_debug' options\n- Support strftime's format modifiers in date_* options (#1354)\n- Support %h variable in 'smtp_server' option (#2101)\n- Show SMTP errors in browser (#2233)\n- Allow WBR tag in HTML message (#2259)\n- Use spl_autoload_register() instead of __autoload (#2250)\n- Add hook for identities listing (#2257)\n- Trigger hook 'smtp_connect' when opening an SMTP connection (#2255)\n- Added config option to enforce HTTPS connections\n- Fix non-unicode characters caching in unicode database (#1209)\n- Performance improvements of messages caching\n- Fix empty Date header issue (#2229)\n- Open collapsed folders during drag & drop (#2221)\n- Fixed link text replacements (#2120)\n- Also trigger 'insertrow' events on page load (#2151)\n- No link on subject in IE browsers (#1438)\n- Fixed filename encoding according to RFC2231 (#2192)\n- Added message Edit feature (#727, #1101)\n- Fix message Etag generation for counter issues (#1996)\n- Fix messages searching on MailEnable IMAP (#2097)\n- Fixed many 'skip_deleted' issues (#2006)\n- Fixed messages list sorting on servers without SORT capability\n- Colorized signatures in plain text messages\n- Reviewed/fixed skip_deleted/read_when_deleted/flag_for_deletion options handling in UI\n- Fix displaying of big maximum upload filesize (#2205)\n- Added possibility to invert messages selection\n- After move/delete from 'show' action display next message instead of messages list (#2203)\n- Fixed problem with double quote at the end of folder name (#2200)\n- Speedup UI by using CSS sprites and etags/expires/deflate in Apache config (#1397,#2128)\n- Support UID EXPUNGE: remove only moved/deleted messages\n- Add drag cancelling with ESC key (#1036)\n- Support initial identity name from virtuser_query (#807)\n- Added message menu, removed Print and Source buttons\n- Added possibility to save message as .eml file (#2178)\n- Added 1 minute interval in autosave options (#2173)\n- Support UTF-7 encoding in messages (#2156)\n- Better support for malformed character names (#2093)\n\nRELEASE 0.3-BETA\n----------------\n- Plugin API + jQuery engine\n- Added possibility to encrypt received header, option 'http_received_header_encrypt',\n  added some more logic in encrypt/decrypt functions for security\n- Fix Answered/Forwarded flag setting for messages in subfolders\n- Fix autocomplete problem with capital letters (#2122)\n- Support UUencode content encoding (#2163)\n- Minimize chance of race condition in session handling (#1260)\n- Fix session handling on non-session SQL query error (#2078)\n- Fix html editor mode setting when reopening draft message (#2158)\n- Added quick search box menu (#1010)\n- Fix wrong column sort order icons (#2149)\n- Updated TinyMCE to 3.2.3 version\n- Fix attachment names encoding when charset isn't specified in attachment part (#1483)\n- Fix message normal priority problem (#2146)\n- Fix autocomplete spinning wheel does not disappear (#2132)\n- Added log_date_format option (#2060)\n- Fix text wrapping in HTML editor after switching from plain text to HTML (#1917)\n- Fix auto-complete function hangs with plus sign (#2141)\n- Fix AJAX requests errors handler (#1503)\n- Speed up message list displaying on IE\n- Fix read/write database recognition (#2137)\n\nRELEASE 0.2.2\n-------------\n- Fix quicksearchbox look in Chrome and Konqueror (#1380)\n- Fix UTF-8 byte-order mark removing (#1911)\n- Fix folders subscribtions on Konqueror (#1380) \n- Fix debug console on Konqueror and Safari\n- Fix messagelist focus issue when modifying status of selected messages (#2134)\n- Support STARTTLS in IMAP connection (#1714)\n- Fix DEL key problem in search boxes (#1923)\n- Support several e-mail addresses per user from virtuser_file (#2036)\n- Fix drag&drop with scrolling on IE (#2117)\n- Fix adding signature separator in html mode (#1768)\n- Fix opening attachment marks message as read (#2131)\n- Fix 'temp_dir' does not support relative path under Windows (#1157)\n- Fix \"Initialize Database\" button missing from installer (#2130)\n- Fix compose window doesn't fit 1024x768 window (#1807)\n- Fix service not available error when pressing back from compose dialog (#1942)\n- Fix using mail() on Windows (#2111)\n- Fix word wrapping in message-part's <PRE>s for printing (#2118)\n- Fix incorrect word wrapping in outgoing plaintext multibyte messages (#2062)\n- Fix double footer in HTML message with embedded images\n- Fix TNEF implementation bug (#2107)\n- Fix incorrect row id parsing for LDAP contacts list (#2116) \n- Fix 'mode' parameter in sqlite DSN (#2106)\n\nRELEASE 0.2.1\n------------------\n- Use US-ASCII as failover when Unicode searching fails (#2097)\n- Fix errors handling in IMAP command continuations (#2097)\n- Fix FETCH result parsing for servers returning flags at the end of result (#2098)\n- Fix datetime columns defaults in mysql's DDL (#2012)\n- Fix attaching more than nine inline images (#2094)\n- Support 'UNICODE-1-1-UTF-7' alias for UTF-7 encoding (#2093)\n- Fix mime-type detection using a hard-coded map (#1735)\n- Don't return empty string if charset conversion failed (#2092)\n- Disable concurrent autocomplete query results display (#2082)\n- Fix new lines stripped from message footer (#2088)\n- Fix IE problem with mouse click autocomplete (#2080)\n- Fix html body washing on reply/forward + fix attachments handling (#2034)\n- Fix multiple recipients input parsing (#2077)\n- Fix replying to message with html attachment (#2034)\n- Use default_charset for messages without specified charset (#2027, #1484961)\n- Support non-standard \"GMT-XXXX\" literal in date header (#2074)\n- Added TNEF support to decode MS Outlook attachments (winmail.dat)\n- Fix \"value continuation\" MIME headers by adding required semicolon (#2073)\n- Fix pressing select all/unread multiple times (#2069)\n- Fix selecting all unread does not honor new messages (#2070)\n- Fix some base64 encoded attachments handling (#2071)\n- Support NGINX as IMAP backend: better BAD response handling (#2066)\n- Performance fix: don't fetch attachment parts headers twice to parse filename\n- Fix checking for recent messages on various IMAP servers (#2055)\n- Performance fix: Don't fetch quota and recent messages in \"message view\" mode\n- Fix displaying of alternative-inside-alternative messages (#2061)\n- Fix MDNSent flag checking, use arbitrary keywords (asterisk) flag (#2059)\n- Fix creation of folders with '&' sign in name\n- Fix parsing of email addresses without angle brackets (#2048)\n- Save spellcheck corrections when switching from plain to html editor (and spellchecking is on)\n- Fix large search results on server without SORT capability (#2031)\n- Get rid of preg_replace() with eval modifier and create_function usage (#2042)\n- Bring back <base> and <link> tags in HTML messages\n- Fix XSS vulnerability through background attributes [CVE-2009-0413]\n- Fix problems with backslash as IMAP hierarchy delimiter (#1116)\n- Secure vcard export by getting rid of preg's 'e' modifier use (#2045)\n- Fix authentication when submitting form with existing session (#2037)\n- Allow absolute URLs to images in HTML messages/sigs (#2029)\n- Fix message body which contains both inline attachments and emotions\n- Fix SQL query execution errors handling in rcube_mdb2 class (#1907)\n- Fix address names with '@' sign handling (#2022)\n- Improve messages display performance\n- Fix messages searching with 'to:' modifier\n\nRELEASE 0.2-STABLE\n------------------\n- Fix mark popup in IE 7 (#1785)\n- Fix line-break issue when copy & paste in Firefox (#1832)\n- Fix autocomplete \"unknown server error\" (#2008)\n- Fix STARTTLS before AUTH in SMTP connection (#1415)\n- Support multiple quota values in QUOTAROOT resonse (#1999)\n- Only abbreviate file name for IE < 7 browsers (#1548)\n- Performance: allow setting imap rootdir and delimiter before connect (#1628)\n- Fix sorting of folders with more than 2 levels (#1953)\n- Fix search results page jumps in LDAP addressbook (#1689)\n- Fix empty line before the signature in IE (#1769)\n- Fix horizontal scrollbar in preview pane on IE (#1228)\n- Add Robots meta tag in login page and installer (#1385)\n- Added 'show_images' option, removed 'addrbook_show_images' (#1977)\n- Option to check for new mails in all folders (#1053)\n- Don't set client busy when checking for new messages (#1706)\n- Allow UTF-8 folder names in config (#1960)\n- Add junk_mbox option configuration in installer (#1960)\n- Do serverside addressbook queries for autocompletion (#1925)\n- Allow setting attachment col position in 'list_cols' option\n- Allow override 'list_cols' via skin (#1958)\n- Fix 'cache' table cleanup on session destroy (#1913)\n- Increase speed of session destroy and garbage clean up\n- Fix session timeout when DB server got clock skew (#1890)\n- Fix handling of some malformed messages (#1099)\n- Speed up raw message body handling\n- Better HTML entities conversion in html2text (#1916)\n- Fix big memory consumption and speed up searching on servers without SORT capability\n- Fix setting locale to tr_TR, ku and az_AZ (#1872) \n- Use SORT for searching on servers with SORT capability\n- Added message status filter\n- Fix empty file sending (#1801)\n- Improved searching with many criterias (calling one SEARCH command)\n- Fix HTML editor initialization on IE (#1731)\n- Add warning when switching editor mode from html to plain (#1888)\n- Make identities list scrollable (#1930)\n- Fix problem with numeric folder names (#1922)\n- Added BYE response simple support to prevent from endless loops in imap.inc (#777)\n- Fix unread message unintentionally marked as read if read_when_deleted=true (#1819)\n- Remove port number from SERVER_NAME in smtp_helo_host (#1915)\n- Don't send disposition notification receipts for messages marked as 'read' (#1918)\n- Added 'keep_alive' and 'min_keep_alive' options (#1777)\n- Added option 'identities_level', removed 'multiple_identities'\n- Allow deleting identities when multiple_identities=false (#1840)\n- Added option focus_on_new_message (#1789)\n- Fix html2text class autoloading on Windows (#1904)\n- Fix html signature formatting when identity save error occurred (#1833)\n- Add feedback and set busy when moving folder (#1897)\n- Fix 'Empty' link visibility for some languages e.g. Slovak (#1889)\n- Fix messages count bar overlapping (#1703)\n- Fix adding signature in drafts compose mode (#1884)\n- Fix iil_C_Sort() to support very long and/or divided responses (#1713)\n- Fix matching case sensitivity when setting identity on reply (#1881)\n- Prefer default identity on reply\n- Fix imap searching on ISMail server (#1870)\n- Add css class for flagged messages (#1868)\n- Write username instead of id in sendmail log (#1879)\n- Fix htmlspecialchars() use for PHP version < 5.2.3 (#1877)\n- Fix js keywords escaping in json_serialize() for IE/Opera (#1874)\n- Added bin/killcache.php script (#1839)\n- Add support for SJIS, GB2312, BIG5 in rc_detect_encoding()\n- Fix vCard file encoding detection for non-UTF-8 strings (#1820)\n- Add 'skip_deleted' option in User Preferences (#1850)\n- Minimize \"inline\" javascript scripts use (#1838)\n- Fix css class setting for folders with names matching defined classes names (#1772)\n- Fix race conditions when changing mailbox\n- Fix spellchecking when switching to html editor (#1779)\n- Fix compose window width/height (#1807)\n- Allow calling msgimport.sh/msgexport.sh from any directory (#1837)\n- Localized filesize units (#1760)\n- Better handling of \"no identity\" and \"no email in identity\" situations (#1592)\n- Added 'mime_param_folding' option with possibility to choose long/non-ascii attachment names encoding eg. to be readable in MS Outlook/OE (#1743)\n- Added \"advanced options\" feature in User Preferences\n- Fix unread counter when displaying cached massage in preview panel (#1720)\n- Fix htmleditor spellchecking on MS Windows (#1808)\n- Fix problem with non-ascii attachment names in Mail_mime (#1700, #1576)\n- Fix language autodetection (#1812)\n- Fix button label in folders management (#1816)\n- Fix collapsed folder not indicating unread msgs count of all subfolders (#1814)\n- Fix handling of apostrophes in filenames decoded according to rfc2231\n\nRELEASE 0.2-BETA\n----------------\n- Made config files location configurable (#1664)\n- Reduced memory footprint when forwarding attachments (#1764)\n- Allow and use spellcheck attribute for input/textarea fields (#1545)\n- Added icons for forwarded/forwarded+replied messages (#1691)\n- Added Reply-To to forwarded emails (#1739)\n- Display progress message for folders create/delete/rename (#1774)\n- Smart Tags and NOBR tag support in html messages (#1780, #1748)\n- Redesign of the identities settings (#836)\n- Add config option to disable creation/deletion of identities (#1139)\n- Added 'sendmail_delay' option to restrict messages sending interval (#1135)\n- Added vertical splitter for folders list resizing\n- Added possibility to view all headers in message view\n- Fixed splitter drag/resize on Opera (#1626)\n- Fixed quota img height/width setting from template (#1396)\n- Refactor drag & drop functionality. Don't rely on browser events anymore (#1108)\n- Insert \"virtual\" folders in subscription list (#1333)\n- Added link to open message in new window\n- Enable export of address book contacts as vCard\n- Add feature to import contacts from vcard files (#395)\n- Respect Content-Location headers in multipart/related messages according to RFC2110 (#1464)\n- Allowed max. attachment size now indicated in compose screen (#1523)\n- Also capture backspace key in list mode (#1186)\n- Allow application/pgp parts to be displayed (#1309)\n- Correctly handle options in mailto-links (#1671)\n- Immediately save sort_col/sort_order in user prefs (#1698)\n- Truncate very long (above 50 characters) attachment filenames when displaying\n- Allow to auto-detect client language if none set (#1095)\n- Auto-detect the client timezone (user configurable)\n- Add RFC2231 header value continuations support for attachment filenames + hack for servers that not support that feature\n- Fix Reply-To header displaying (#1738)\n- Mark form buttons that provide the most obvious operation (mainaction)\n- Added option 'quota_zero_as_unlimited' (#1206)\n- Added PRE handling in html2text class (#1301)\n- Added folder hierarchy collapsing\n- Added options to use syslog instead of log file (#1389)\n- Added Logging & Debugging section in Installer\n- Fix In-Reply-To and References headers when composing saved draft message (#1718)\n- Fix html message charset conversion for charsets with underline (#1717) \n- Fix buttons status after contacts deletion (#1675)\n- Fix escaping of To: and From: fields when building message body for reply or forward in the HTML editor (#1432)\n- Use current mailbox name in template (#1690)\n- Better fix for skipping untagged responses (#1694)\n- Added pspell support patch by Kris Steinhoff (#781)\n- Enable spellchecker for HTML editor (#1589)\n- Respect spellcheck_uri in tinyMCE spellchecker (#941)\n- Case insensitive contacts searching using PostgreSQL (#1692)\n- Make default imap folders configurable for each user (#1558)\n- Save outgoing mail to selectable folder (#1324581)\n- Fix hiding of mark menu when clicking th button again (#1463)\n- Use long date format in print mode (#1643)\n- Updated TinyMCE to version 3.1.0.1\n- Re-enable autocomplete attribute for login form (#1661)\n- Check PERMANENTFLAGS before saving $MDNSent flag (#1478, #1485163)\n- Added flag column on messages list (#1220)\n- Patched Mail/MimePart.php (http://pear.php.net/bugs/bug.php?id=14232)\n- Allow trash/junk subfolders to be purged (#1568)\n- Store compose parameters in session and redirect to a unique URL\n- Fixed CRAM-MD5 authentication (#1364)\n- Fixed forwarding messages with one HTML attachment (#1103)\n- Fixed encoding of message/rfc822 attachments and image/pjpeg handling (#1439)\n- Added option to select skin in user preferences\n- Added option to configure displaying of attached images below the message body\n- Added option to display images in messages from known senders (#1204)\n- User preferences grouped in more fieldsets\n- Fix corrupted MIME headers of messages in Sent folder (#1587)\n- Fixed bug in MDB2 package: http://pear.php.net/bugs/bug.php?id=14124\n- Use keypress instead of keydown to select list's row (#1362)\n- Don't call expunge and don't remove message row after message move if flag_for_deletion is set to true (#1505)\n\nRELEASE 0.2-ALPHA\n-----------------\n- Added option to disable autocompletion from selected LDAP address books (#1445)\n- TLS support in LDAP connections: 'use_tls' property (#1581)\n- Fixed removing messages from search set after deleting them (#1583)\n- imap.inc: Fixed iil_C_FetchStructureString() to handle many \n  literal strings in response (#1483)\n- Support for subfolders in default/protected folders (#1250)\n- Disallowed delimiter in folder name (#1351)\n- Support \" and \\ in folder names\n- Escape \\ in login (#1214)\n- Better HTML sanitization with the DOM-based washtml script (#1276)\n- Fixed sorting of folders with non-ascii characters\n- Fixed Mysql DDL for default identities creation (#1554)\n- In Preferences added possibility to configure 'read_when_deleted',\n  'mdn_requests', 'flag_for_deletion' options\n- Made IMAP auth type configurable (#683)\n- Fixed empty values with FROM_UNIXTIME() in rcube_mdb2 (#1540)\n- Fixed attachment list on IE 6/7 (#1355)\n- Fixed JavaScript in compose.html that shows cc/bcc fields if populated\n- Make password input fields of type password in installer (#1417)\n- Don't attempt to delete cache entries if enable_caching is FALSE (#1537)\n- Optimized messages sorting on servers without sort capability (#1535)\n- Corrected message headers decoding when charset isn't specified and improved\n  support for native languages (#1536, #1534)\n- Expanded LDAP configuration options to support LDAP server writes.\n- Installer: encode special characters in DB username/password (#1529)\n- Fixed management of folders with national characters in names (#1526, #1504)\n- Fixed identities saving when using MDB2 pgsql driver (#1525)\n- Fixed BCC header reset (#1501)\n- Improved messages list performance - patch from Justin Heesemann\n- Append skin_path to images location only when it starts with '/' sign (#1398)\n- Fix IMAP response in message body when message has no body (#1479)\n- Fixed non-RFC dates formatting (#1429)\n- Fixed typo in set_charset() (#1498)\n- Decode entities when inserting HTML signature to plain text message (#1497)\n- HTML editing is now working with PHP5 updates and TinyMCE v3.0.6\n- Fixed signature loading on Windows (#1169)\n- Added language support to HTML editing (#1401)\n- Fixed remove signature when replying (#446)\n- Fixed problem with line with a space at the end (#1440)\n- Fixed <!DOCTYPE> tag filtering (#1066)\n- Fixed <?xml> tag filtering (#1075)\n- Added sections (fieldset+label) in Settings interface\n- Mark as read in one action with message preview (#1486)\n- Deleted redundant quota reads (#1486)\n- Added options for empty trash and expunge inbox on logout (#707)\n- Removed lines wrapping when displaying message\n- Fixed month localization\n- Changed codebase to PHP5 with autoloader\n\nRELEASE 0.1.1\n-------------\n- Clear selection when selecting single item (#1461)\n- Remove hard-coded image size in skin templates (#1423)\n- Database schema improvements (dropped unnecessary indexes)\n- Fixed creating a new folder with a comma in its name (#1263)\n- Fixed sorting of messages when default mailbox is empty (#1020)\n- Improve message previewpane - less loading (#1019)\n- Fixed login form autoompletion (#1378)\n- Fixed virtuser_query option for mdb2 backend (#1409)\n- Fixed attachment resoting from Drafts when message body was empty (#1144)\n- Fixed usage of ob_gzhandler (#1390)\n- Fixed message part window in IE6 (#1211)\n- Fixed decoding of mime-encoded strings (#938)\n- Fixed some iconv/mb_string problems (#1202)\n- Correctly quote mailbox name when using in URL (#1016)\n- Fixed \"headers already sent\" errors (#1399)\n\nRELEASE 0.1-STABLE\n------------------\n- Added interactive installer script\n- Fix folder adding/renaming inspired by #1349\n- Localize folder name in page title (#1338)\n- Fix code using wrong variable name (#818)\n- Allow to send mail with BCC recipients only\n- condense TinyMCE toolbar down to one line, removing table buttons (#1306)\n- Add function to mark the selected messages as read/unread (#641)\n- Also do charset decoding as suggested in RFC 2231 (fix #1022)\n- Show message count in folder list and hint when creating a subfolder\n- Distinguish ssl and tls for imap connections (#1252)\n- Added some charset aliases to fix typical mis-labelling (#1185)\n- Remember decision to display images for a certain message during session (#1310)\n- Truncate attachment filenames to 55 characters due to an IE bug (#1313)\n- Make sending of read receipts configurable\n- Respect config when localize folder names (#1280)\n- Also respect receipt and priority settings when re-opening a draft message\n- Remember search results (closes #722), patch by the_glu\n- Add Received header on outgoing mail\n- Upgrade to TinyMCE 2.1.3\n- Allow inserting image attachments into HTML messages while composing (#1179)\n- Implement Message-Disposition-Notification (Receipts)\n- Fix overriding of session vars when register_globals is on (#1255)\n- Fix bug with case-sensitive folder names (#973)\n- Don't create default folders by default\n- Fixed some potential security risks (audited by Andris)\n- Only show new messages if they match the current search (#925)\n- Switch to/from when searcing in Sent folder (#1177)\n- Correctly read the References header (#1236)\n- Unset old cookie before sending a new value (#1232)\n- Correctly decode attachments when downloading them (#1235 and #1484642)\n- Suppress IE errors when clearing attachments form (#1043)\n- Log error when login fails due to auto_create_user turned off\n- Filter linked/imported CSS files (closes #844)\n- Improve message compose screen (closes #1060)\n- Select next row after removing one from list (#1063)\n\nRELEASE 0.1-RC2\n---------------\n- Enable drag-&-dropping of folders to a new parent and allow to create subfolders (#637)\n- Suppress IE errors when clearing attachments form (#1043)\n- Set preferences field in user table to NULL (#1062)\n- Log error when login fails due to auto_create_user turned off\n- Filter linked/imported CSS files (closes #844)\n- Improve message compose screen (closes #1060)\n- Select next row after removing one from list (#1063)\n- Make smtp HELO/EHLO hostname configurable (#851)\n- IPv6 Compatibility (#1023), Patch #1484373\n- Unlock interface when message sending fails (#1188)\n- Eval PHP code in template includes (if configured)\n- Show message when folder is empty. Mo more static text in table (#1068)\n- Only display unread count in page title when new messages arrived\n- Fixed wrong delete button tooltip (#785)\n- Fixed charset encoding bug (#1091)\n- Applied patch for LDAP version (#1175)\n- Improved XHTML validation\n- Fix message list selection (#1174)\n- Better fix lowercased usernames (#1120)\n- Update pngbehavior Script as suggested in #1134\n- Fixed moving/deleting messages when more than 1 is selected\n- Applied patch for LDAP contacts listing by Glen Ogilvie\n- Applied patch for more address fields in LDAP contacts (#1074)\n- Add alternative for getallheaders() (fix #1146)\n- Identify mailboxes case-sensitive\n- Sort mailbox list case-insensitive (closes #1032)\n- Fix display of multipart messages from Apple Mail (closes #823)\n- Protect AJAX request from being fetched by a foreign site (XSS)\n- Make autocomplete for loginform configurable by the skin template\n- Fix compose function from address book (closes #1089)\n- Added //IGNORE to iconv call (patch #1086, closes #821)\n- Check if mbstring supports charset (#1003 and #1004)\n- Prefer iconv over mbstring (as suggested in #1004)\n- Check filesize of template includes (#1079)\n- Fixed bug with buttons not dimming/enabling properly after switching folders\n- Fixed compose window becoming unresponsive after saving a draft (#1132)\n- Re-enabled \"Back\" button in compose window now that bug #1132 is fixed\n- Fixed unresponsive interface issue when downloading attachments (#1138)\n- Lowered status message time from 5 to 3 seconds to improve responsiveness\n- Raised .htaccess upload_max_filesize from 2M to 5M to differ from default php.ini\n- Increased \"mailboxcontrols\" mail.css width from 160 to 170px to fix non-english languages (#1140)\n- Fix status message bug #1114 with regard to #1041\n- Fix address adding bug reported by David Koblas\n- Applied socket error patch by Thomas Mangin\n- Pass-by-reference workarround for PHP5 in sendmail.inc\n- Fixed buggy imap_root settings (closes #1056)\n- Prevent default events on subject links (#1071)\n- Use HTTP-POST requests for actions that change state\n\nRELEASE 0.1-RC1\n---------------\n- Use global filters and bind username/ for Ldap searches (#909)\n- Hide quota display if imap server does not support it\n- Hide address groups if no LDAP servers configured\n- Add link to message subjects (closes #982)\n- Better SQL query for contact listing/search (closes #1051)\n- Fixed marking as read in preview pane (closes #1048)\n- CSS hack to display attachments correctly in IE6\n- Wrap message body text (closes #901)\n- LDAP access is back in address book (closes #864)\n- Added search function for contacts\n- New Template parsing and output encoding\n- Fixed bugs #884 and #793\n- Fixed message moving procedure (closes #1013)\n- Fixed display of multiple attachments (closes #647)\n- Fixed check for new messages (closes #1015)\n- List attachments without filename\n- New session authentication: Change sessid cookie when login, authentication with sessauth cookie is now configurable.\n  Should close bugs #774 and #1484299\n- Correctly translate mailbox names (closes #993)\n- Quote e-mail address links (closes #1007)\n- Updated PEAR::Mail_mime package\n- Accept single quotes for HTML attributes when modifying message body (thanks Jason)\n- Sanitize input for new users/identities (thanks Colin Alston)\n- Don't download HTML message parts\n- Convert HTML parts to plaintext if 'prefer_html' is off\n- Correctly parse message/rfc822 parts (closes #838)\n- Also use user_id for unique key in messages table (closes #857)\n- Hide contacts drop down on blur (closes #946)\n- Make entries in contacts drop down clickable\n- Turn off browser autocompletion on login page\n- Quote <? in text/html message parts\n- Hide border around radio buttons\n- Applied patch for attachment download by crichardson (closes #943)\n- Fixed bug in Postgres DB handling (closes #852)\n- Fixed bug of invalid calls to fetchRow() in rcube_db.inc (closes #996)\n- Fixed array_merge bug (closes #997)\n- Fixed flag for deletion in list view (closes #987)\n- Finally support semicolons as recipient separator (closes ##976)\n- Fixed message headers (subject) encoding\n- check if safe mode is on or not (closes #990)\n- Show \"no subject\" in message list if subject is missing (closes #971)\n- Solved page caching of message preview (closes #905)\n- Only use gzip compression if configured (closes #967)\n- Fixed priority selector issue (#903)\n- Fixed some CSS issues in default skin (closes #951 and #911)\n- Prevent from double quoting of numeric HTML character references (closes #978)\n- Fixed display of HTML message attachments (closes #927)\n- Applied patch for preview caching (closes #933)\n- Added error handling for attachment uploads\n- Use multibyte safe string functions where necessary (closes #798)\n- Applied security patch to validate the submitted host value (by Kees Cook)\n- Applied security patch to validate input values when deleting contacts (by Kees Cook)\n- Applied security patch that sanitizes emoticon paths when attaching them (by Kees Cook)\n- Applied a patch to more aggressively sanitize a HTML message\n- Visualize blocked images in HTML messages\n- Fixed wrong message listing when showing search results (closes #890)\n- Show remote images when opening HTML message part as attachment\n- Improve memory usage when sending mail (closes #871)\n- Mark messages as read once the preview is loaded (closes #1484132)\n- Include smtp final response in log (closes #862)\n- Corrected date string in sent message header (closes #887)\n- Correclty choose \"To\" column in sent and draft mailboxes (closes #769)\n- Changed srong tooltips for message browse buttons (closes #757)\n- Fixed signature delimiter character to be standard (Bug #830)\n- Fixed XSS vulnerability (Bug #877)\n- Remove newlines from mail headers (Bug #827)\n- Selection issues when moving/deleting (Bug #837)\n- Applied patch of Clement Moulin for imap host auto-selection\n- ISO-encode IMAP password for plaintext login (Bugs #792 & #723)\n- Fixed folder name encoding in subscription list (Bug #879)\n- Fixed JS errors in identity list (Bug #885)\n- Translate foldernames in folder form (closes #879)\n- Added first and last buttons to message list, address book\n  and message detail\n- Pressing Shift-Del bypasses Trash folder\n- Enable purge command for Junk folder\n- Fetch all aliases if virtuser_query is used instead\n- Re-enabled multi select of contacts (Bug #817)\n- Enable contact editing right after creation (Bug #644)\n- Correct UTF-7 to UTF-8 conversion if mbstring is not available\n- Fixed IMAP fetch of message body (Bug #819)\n- Fixed safe_mode problems (Bug #539)\n- Fixed wrong header encoding (Bug #1483976)\n- Made automatic draft saving configurable\n- Fixed JS bug when renaming folders (Bug #799)\n- Added quota display as image (by Brett Patterson)\n- Corrected creation of a message-id\n- New indentation for quoted message text\n- Improved HTML validity\n- Fixed URL character set (Ticket #616)\n- Fixed saving of contact into MySQL from LDAP query results (Ticket #681)\n- Fixed folder renaming: unsubscribe before rename (Bug #750)\n- Finalized new message parsing (+ chaching)\n- Fixed wrong usage of mbstring (Bug #645)\n- Set default spelling language (Ticket #764)\n- Added support for Nox Spell Server\n- Re-built message parsing (Bug #422)\n  Now based on the message structure delivered by the IMAP server.\n- Fixed some XSS and SQL injection issues\n- Fixed charset problems with folder renaming\n", "<?php\n\n/*\n +-----------------------------------------------------------------------+\n | Main configuration file with default settings                         |\n |                                                                       |\n | This file is part of the Roundcube Webmail client                     |\n | Copyright (C) 2005-2013, The Roundcube Dev Team                       |\n |                                                                       |\n | Licensed under the GNU General Public License version 3 or            |\n | any later version with exceptions for skins & plugins.                |\n | See the README file for a full license statement.                     |\n +-----------------------------------------------------------------------+\n*/\n\n$config = array();\n\n// ----------------------------------\n// SQL DATABASE\n// ----------------------------------\n\n// Database connection string (DSN) for read+write operations\n// Format (compatible with PEAR MDB2): db_provider://user:password@host/database\n// Currently supported db_providers: mysql, pgsql, sqlite, mssql, sqlsrv, oracle\n// For examples see http://pear.php.net/manual/en/package.database.mdb2.intro-dsn.php\n// NOTE: for SQLite use absolute path (Linux): 'sqlite:////full/path/to/sqlite.db?mode=0646'\n//       or (Windows): 'sqlite:///C:/full/path/to/sqlite.db'\n$config['db_dsnw'] = 'mysql://roundcube:@localhost/roundcubemail';\n\n// Database DSN for read-only operations (if empty write database will be used)\n// useful for database replication\n$config['db_dsnr'] = '';\n\n// Disable the use of already established dsnw connections for subsequent reads\n$config['db_dsnw_noread'] = false;\n\n// use persistent db-connections\n// beware this will not \"always\" work as expected\n// see: http://www.php.net/manual/en/features.persistent-connections.php\n$config['db_persistent'] = false;\n\n// you can define specific table (and sequence) names prefix\n$config['db_prefix'] = '';\n\n// Mapping of table names and connections to use for ALL operations.\n// This can be used in a setup with replicated databases and a DB master\n// where read/write access to cache tables should not go to master.\n$config['db_table_dsn'] = array(\n//    'cache' => 'r',\n//    'cache_index' => 'r',\n//    'cache_thread' => 'r',\n//    'cache_messages' => 'r',\n);\n\n// It is possible to specify database variable values e.g. some limits here.\n// Use them if your server is not MySQL or for better performance.\n// For example Roundcube uses max_allowed_packet value (in bytes)\n// which limits query size for database cache operations.\n$config['db_max_allowed_packet'] = null;\n\n\n// ----------------------------------\n// LOGGING/DEBUGGING\n// ----------------------------------\n\n// system error reporting, sum of: 1 = log; 4 = show\n$config['debug_level'] = 1;\n\n// log driver:  'syslog', 'stdout' or 'file'.\n$config['log_driver'] = 'file';\n\n// date format for log entries\n// (read http://php.net/manual/en/function.date.php for all format characters)  \n$config['log_date_format'] = 'd-M-Y H:i:s O';\n\n// length of the session ID to prepend each log line with\n// set to 0 to avoid session IDs being logged.\n$config['log_session_id'] = 8;\n\n// Syslog ident string to use, if using the 'syslog' log driver.\n$config['syslog_id'] = 'roundcube';\n\n// Syslog facility to use, if using the 'syslog' log driver.\n// For possible values see installer or http://php.net/manual/en/function.openlog.php\n$config['syslog_facility'] = LOG_USER;\n\n// Activate this option if logs should be written to per-user directories.\n// Data will only be logged if a directory <log_dir>/<username>/ exists and is writable.\n$config['per_user_logging'] = false;\n\n// Log sent messages to <log_dir>/sendmail or to syslog\n$config['smtp_log'] = true;\n\n// Log successful/failed logins to <log_dir>/userlogins or to syslog\n$config['log_logins'] = false;\n\n// Log session authentication errors to <log_dir>/session or to syslog\n$config['log_session'] = false;\n\n// Log SQL queries to <log_dir>/sql or to syslog\n$config['sql_debug'] = false;\n\n// Log IMAP conversation to <log_dir>/imap or to syslog\n$config['imap_debug'] = false;\n\n// Log LDAP conversation to <log_dir>/ldap or to syslog\n$config['ldap_debug'] = false;\n\n// Log SMTP conversation to <log_dir>/smtp or to syslog\n$config['smtp_debug'] = false;\n\n// Log Memcache conversation to <log_dir>/memcache or to syslog\n$config['memcache_debug'] = false;\n\n// Log APC conversation to <log_dir>/apc or to syslog\n$config['apc_debug'] = false;\n\n\n// ----------------------------------\n// IMAP\n// ----------------------------------\n\n// The IMAP host chosen to perform the log-in.\n// Leave blank to show a textbox at login, give a list of hosts\n// to display a pulldown menu or set one host as string.\n// To use SSL/TLS connection, enter hostname with prefix ssl:// or tls://\n// Supported replacement variables:\n// %n - hostname ($_SERVER['SERVER_NAME'])\n// %t - hostname without the first part\n// %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)\n// %s - domain name after the '@' from e-mail address provided at login screen\n// For example %n = mail.domain.tld, %t = domain.tld\n// WARNING: After hostname change update of mail_host column in users table is\n//          required to match old user data records with the new host.\n$config['default_host'] = 'localhost';\n\n// TCP port used for IMAP connections\n$config['default_port'] = 143;\n\n// IMAP AUTH type (DIGEST-MD5, CRAM-MD5, LOGIN, PLAIN or null to use\n// best server supported one)\n$config['imap_auth_type'] = null;\n\n// IMAP socket context options\n// See http://php.net/manual/en/context.ssl.php\n// The example below enables server certificate validation\n//$config['imap_conn_options'] = array(\n//  'ssl'         => array(\n//     'verify_peer'  => true,\n//     'verify_depth' => 3,\n//     'cafile'       => '/etc/openssl/certs/ca.crt',\n//   ),\n// );\n// Note: These can be also specified as an array of options indexed by hostname\n$config['imap_conn_options'] = null;\n\n// IMAP connection timeout, in seconds. Default: 0 (use default_socket_timeout)\n$config['imap_timeout'] = 0;\n\n// Optional IMAP authentication identifier to be used as authorization proxy\n$config['imap_auth_cid'] = null;\n\n// Optional IMAP authentication password to be used for imap_auth_cid\n$config['imap_auth_pw'] = null;\n\n// If you know your imap's folder delimiter, you can specify it here.\n// Otherwise it will be determined automatically\n$config['imap_delimiter'] = null;\n\n// If you know your imap's folder vendor, you can specify it here.\n// Otherwise it will be determined automatically. Use lower-case\n// identifiers, e.g. 'dovecot', 'cyrus', 'gmail', 'hmail', 'uw-imap'.\n$config['imap_vendor'] = null;\n\n// If IMAP server doesn't support NAMESPACE extension, but you're\n// using shared folders or personal root folder is non-empty, you'll need to\n// set these options. All can be strings or arrays of strings.\n// Folders need to be ended with directory separator, e.g. \"INBOX.\"\n// (special directory \"~\" is an exception to this rule)\n// These can be used also to overwrite server's namespaces\n$config['imap_ns_personal'] = null;\n$config['imap_ns_other']    = null;\n$config['imap_ns_shared']   = null;\n\n// By default IMAP capabilities are readed after connection to IMAP server\n// In some cases, e.g. when using IMAP proxy, there's a need to refresh the list\n// after login. Set to True if you've got this case.\n$config['imap_force_caps'] = false;\n\n// By default list of subscribed folders is determined using LIST-EXTENDED\n// extension if available. Some servers (dovecot 1.x) returns wrong results\n// for shared namespaces in this case. https://github.com/roundcube/roundcubemail/issues/2474\n// Enable this option to force LSUB command usage instead.\n// Deprecated: Use imap_disabled_caps = array('LIST-EXTENDED')\n$config['imap_force_lsub'] = false;\n\n// Some server configurations (e.g. Courier) doesn't list folders in all namespaces\n// Enable this option to force listing of folders in all namespaces\n$config['imap_force_ns'] = false;\n\n// Some servers return hidden folders (name starting witha dot)\n// from user home directory. IMAP RFC does not forbid that.\n// Enable this option to hide them and disable possibility to create such.\n$config['imap_skip_hidden_folders'] = false;\n\n// List of disabled imap extensions.\n// Use if your IMAP server has broken implementation of some feature\n// and you can't remove it from CAPABILITY string on server-side.\n// For example UW-IMAP server has broken ESEARCH.\n// Note: Because the list is cached, re-login is required after change.\n$config['imap_disabled_caps'] = array();\n\n// Log IMAP session identifiers after each IMAP login.\n// This is used to relate IMAP session with Roundcube user sessions\n$config['imap_log_session'] = false;\n\n// Type of IMAP indexes cache. Supported values: 'db', 'apc' and 'memcache'.\n$config['imap_cache'] = null;\n\n// Enables messages cache. Only 'db' cache is supported.\n// This requires an IMAP server that supports QRESYNC and CONDSTORE\n// extensions (RFC7162). See synchronize() in program/lib/Roundcube/rcube_imap_cache.php\n// for further info, or if you experience syncing problems.\n$config['messages_cache'] = false;\n\n// Lifetime of IMAP indexes cache. Possible units: s, m, h, d, w\n$config['imap_cache_ttl'] = '10d';\n\n// Lifetime of messages cache. Possible units: s, m, h, d, w\n$config['messages_cache_ttl'] = '10d';\n\n// Maximum cached message size in kilobytes.\n// Note: On MySQL this should be less than (max_allowed_packet - 30%)\n$config['messages_cache_threshold'] = 50;\n\n\n// ----------------------------------\n// SMTP\n// ----------------------------------\n\n// SMTP server host (for sending mails).\n// Enter hostname with prefix tls:// to use STARTTLS, or use\n// prefix ssl:// to use the deprecated SSL over SMTP (aka SMTPS)\n// Supported replacement variables:\n// %h - user's IMAP hostname\n// %n - hostname ($_SERVER['SERVER_NAME'])\n// %t - hostname without the first part\n// %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)\n// %z - IMAP domain (IMAP hostname without the first part)\n// For example %n = mail.domain.tld, %t = domain.tld\n$config['smtp_server'] = 'localhost';\n\n// SMTP port (default is 25; use 587 for STARTTLS or 465 for the\n// deprecated SSL over SMTP (aka SMTPS))\n$config['smtp_port'] = 25;\n\n// SMTP username (if required) if you use %u as the username Roundcube\n// will use the current username for login\n$config['smtp_user'] = '';\n\n// SMTP password (if required) if you use %p as the password Roundcube\n// will use the current user's password for login\n$config['smtp_pass'] = '';\n\n// SMTP AUTH type (DIGEST-MD5, CRAM-MD5, LOGIN, PLAIN or empty to use\n// best server supported one)\n$config['smtp_auth_type'] = '';\n\n// Optional SMTP authentication identifier to be used as authorization proxy\n$config['smtp_auth_cid'] = null;\n\n// Optional SMTP authentication password to be used for smtp_auth_cid\n$config['smtp_auth_pw'] = null;\n\n// SMTP HELO host \n// Hostname to give to the remote server for SMTP 'HELO' or 'EHLO' messages \n// Leave this blank and you will get the server variable 'server_name' or \n// localhost if that isn't defined.\n$config['smtp_helo_host'] = '';\n\n// SMTP connection timeout, in seconds. Default: 0 (use default_socket_timeout)\n// Note: There's a known issue where using ssl connection with\n// timeout > 0 causes connection errors (https://bugs.php.net/bug.php?id=54511)\n$config['smtp_timeout'] = 0;\n\n// SMTP socket context options\n// See http://php.net/manual/en/context.ssl.php\n// The example below enables server certificate validation, and\n// requires 'smtp_timeout' to be non zero.\n// $config['smtp_conn_options'] = array(\n//   'ssl'         => array(\n//     'verify_peer'  => true,\n//     'verify_depth' => 3,\n//     'cafile'       => '/etc/openssl/certs/ca.crt',\n//   ),\n// );\n// Note: These can be also specified as an array of options indexed by hostname\n$config['smtp_conn_options'] = null;\n\n\n// ----------------------------------\n// LDAP\n// ----------------------------------\n\n// Type of LDAP cache. Supported values: 'db', 'apc' and 'memcache'.\n$config['ldap_cache'] = 'db';\n\n// Lifetime of LDAP cache. Possible units: s, m, h, d, w\n$config['ldap_cache_ttl'] = '10m';\n\n\n// ----------------------------------\n// CACHE(S)\n// ----------------------------------\n\n// Use these hosts for accessing memcached\n// Define any number of hosts in the form of hostname:port or unix:///path/to/socket.file\n$config['memcache_hosts'] = null; // e.g. array( 'localhost:11211', '192.168.1.12:11211', 'unix:///var/tmp/memcached.sock' );\n\n// Controls the use of a persistent connections to memcache servers\n// See http://php.net/manual/en/memcache.addserver.php\n$config['memcache_pconnect'] = true;\n\n// Value in seconds which will be used for connecting to the daemon\n// See http://php.net/manual/en/memcache.addserver.php\n$config['memcache_timeout'] = 1;\n\n// Controls how often a failed server will be retried (value in seconds).\n// Setting this parameter to -1 disables automatic retry.\n// See http://php.net/manual/en/memcache.addserver.php\n$config['memcache_retry_interval'] = 15;\n\n// use these hosts for accessing Redis.\n// Currently only one host is supported. cluster support may come in a future release.\n// You can pass 4 fields, host, port, database and password.\n// Unset fields will be set to the default values host=127.0.0.1, port=6379, database=0, password=  (empty)\n$config['redis_hosts'] = null; // e.g. array( 'localhost:6379' );  array( '192.168.1.1:6379:1:secret' );\n\n// Maximum size of an object in memcache (in bytes). Default: 2MB\n$config['memcache_max_allowed_packet'] = '2M';\n\n// Maximum size of an object in APC cache (in bytes). Default: 2MB\n$config['apc_max_allowed_packet'] = '2M';\n\n\n// ----------------------------------\n// SYSTEM\n// ----------------------------------\n\n// THIS OPTION WILL ALLOW THE INSTALLER TO RUN AND CAN EXPOSE SENSITIVE CONFIG DATA.\n// ONLY ENABLE IT IF YOU'RE REALLY SURE WHAT YOU'RE DOING!\n$config['enable_installer'] = false;\n\n// don't allow these settings to be overridden by the user\n$config['dont_override'] = array();\n\n// List of disabled UI elements/actions\n$config['disabled_actions'] = array();\n\n// define which settings should be listed under the 'advanced' block\n// which is hidden by default\n$config['advanced_prefs'] = array();\n\n// provide an URL where a user can get support for this Roundcube installation\n// PLEASE DO NOT LINK TO THE ROUNDCUBE.NET WEBSITE HERE!\n$config['support_url'] = '';\n\n// replace Roundcube logo with this image\n// specify an URL relative to the document root of this Roundcube installation\n// an array can be used to specify different logos for specific template files, '*' for default logo\n// for example array(\"*\" => \"/images/roundcube_logo.png\", \"messageprint\" => \"/images/roundcube_logo_print.png\")\n$config['skin_logo'] = null;\n\n// automatically create a new Roundcube user when log-in the first time.\n// a new user will be created once the IMAP login succeeds.\n// set to false if only registered users can use this service\n$config['auto_create_user'] = true;\n\n// Enables possibility to log in using email address from user identities\n$config['user_aliases'] = false;\n\n// use this folder to store log files\n// must be writeable for the user who runs PHP process (Apache user if mod_php is being used)\n// This is used by the 'file' log driver.\n$config['log_dir'] = RCUBE_INSTALL_PATH . 'logs/';\n\n// use this folder to store temp files\n// must be writeable for the user who runs PHP process (Apache user if mod_php is being used)\n$config['temp_dir'] = RCUBE_INSTALL_PATH . 'temp/';\n\n// expire files in temp_dir after 48 hours\n// possible units: s, m, h, d, w\n$config['temp_dir_ttl'] = '48h';\n\n// Enforce connections over https\n// With this option enabled, all non-secure connections will be redirected.\n// It can be also a port number, hostname or hostname:port if they are\n// different than default HTTP_HOST:443\n$config['force_https'] = false;\n\n// tell PHP that it should work as under secure connection\n// even if it doesn't recognize it as secure ($_SERVER['HTTPS'] is not set)\n// e.g. when you're running Roundcube behind a https proxy\n// this option is mutually exclusive to 'force_https' and only either one of them should be set to true.\n$config['use_https'] = false;\n\n// Allow browser-autocompletion on login form.\n// 0 - disabled, 1 - username and host only, 2 - username, host, password\n$config['login_autocomplete'] = 0;\n\n// Forces conversion of logins to lower case.\n// 0 - disabled, 1 - only domain part, 2 - domain and local part.\n// If users authentication is case-insensitive this must be enabled.\n// Note: After enabling it all user records need to be updated, e.g. with query:\n//       UPDATE users SET username = LOWER(username);\n$config['login_lc'] = 2;\n\n// Maximum length (in bytes) of logon username and password.\n$config['login_username_maxlen'] = 1024;\n$config['login_password_maxlen'] = 1024;\n\n// Logon username filter. Regular expression for use with preg_match().\n// Example: '/^[a-z0-9_@.-]+$/'\n$config['login_username_filter'] = null;\n\n// Brute-force attacks prevention.\n// The value specifies maximum number of failed logon attempts per minute.\n$config['login_rate_limit'] = 3;\n\n// Includes should be interpreted as PHP files\n$config['skin_include_php'] = false;\n\n// display software version on login screen\n$config['display_version'] = false;\n\n// Session lifetime in minutes\n$config['session_lifetime'] = 10;\n\n// Session domain: .example.org\n$config['session_domain'] = '';\n\n// Session name. Default: 'roundcube_sessid'\n$config['session_name'] = null;\n\n// Session authentication cookie name. Default: 'roundcube_sessauth'\n$config['session_auth_name'] = null;\n\n// Session path. Defaults to PHP session.cookie_path setting.\n$config['session_path'] = null;\n\n// Backend to use for session storage. Can either be 'db' (default), 'redis', 'memcache', or 'php'\n//\n// If set to 'memcache', a list of servers need to be specified in 'memcache_hosts'\n// Make sure the Memcache extension (http://pecl.php.net/package/memcache) version >= 2.0.0 is installed\n//\n// If set to 'redis', a server needs to be specified in 'redis_hosts'\n// Make sure the Redis extension (http://pecl.php.net/package/redis) version >= 2.0.0 is installed\n//\n// Setting this value to 'php' will use the default session save handler configured in PHP\n$config['session_storage'] = 'db';\n\n// check client IP in session authorization\n$config['ip_check'] = false;\n\n// List of trusted proxies\n// X_FORWARDED_* and X_REAL_IP headers are only accepted from these IPs\n$config['proxy_whitelist'] = array();\n\n// check referer of incoming requests\n$config['referer_check'] = false;\n\n// X-Frame-Options HTTP header value sent to prevent from Clickjacking.\n// Possible values: sameorigin|deny|allow-from <uri>.\n// Set to false in order to disable sending the header.\n$config['x_frame_options'] = 'sameorigin';\n\n// This key is used for encrypting purposes, like storing of imap password\n// in the session. For historical reasons it's called DES_key, but it's used\n// with any configured cipher_method (see below).\n$config['des_key'] = 'rcmail-!24ByteDESkey*Str';\n\n// Encryption algorithm. You can use any method supported by openssl.\n// Default is set for backward compatibility to DES-EDE3-CBC,\n// but you can choose e.g. AES-256-CBC which we consider a better choice.\n$config['cipher_method'] = 'DES-EDE3-CBC';\n\n// Automatically add this domain to user names for login\n// Only for IMAP servers that require full e-mail addresses for login\n// Specify an array with 'host' => 'domain' values to support multiple hosts\n// Supported replacement variables:\n// %h - user's IMAP hostname\n// %n - hostname ($_SERVER['SERVER_NAME'])\n// %t - hostname without the first part\n// %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)\n// %z - IMAP domain (IMAP hostname without the first part)\n// For example %n = mail.domain.tld, %t = domain.tld\n$config['username_domain'] = '';\n\n// Force domain configured in username_domain to be used for login.\n// Any domain in username will be replaced by username_domain.\n$config['username_domain_forced'] = false;\n\n// This domain will be used to form e-mail addresses of new users\n// Specify an array with 'host' => 'domain' values to support multiple hosts\n// Supported replacement variables:\n// %h - user's IMAP hostname\n// %n - http hostname ($_SERVER['SERVER_NAME'])\n// %d - domain (http hostname without the first part)\n// %z - IMAP domain (IMAP hostname without the first part)\n// For example %n = mail.domain.tld, %t = domain.tld\n$config['mail_domain'] = '';\n\n// Password character set.\n// If your authentication backend supports it, use \"UTF-8\".\n// Otherwise, use the appropriate character set.\n// Defaults to ISO-8859-1 for backward compatibility.\n$config['password_charset'] = 'ISO-8859-1';\n\n// How many seconds must pass between emails sent by a user\n$config['sendmail_delay'] = 0;\n\n// Message size limit. Note that SMTP server(s) may use a different value.\n// This limit is verified when user attaches files to a composed message.\n// Size in bytes (possible unit suffix: K, M, G)\n$config['max_message_size'] = '100M';\n\n// Maximum number of recipients per message (including To, Cc, Bcc).\n// Default: 0 (no limit)\n$config['max_recipients'] = 0;\n\n// Maximum number of recipients per message exluding Bcc header.\n// This is a soft limit, which means we only display a warning to the user.\n// Default: 5\n$config['max_disclosed_recipients'] = 5;\n\n// Maximum allowed number of members of an address group. Default: 0 (no limit)\n// If 'max_recipients' is set this value should be less or equal\n$config['max_group_members'] = 0;\n\n// Name your service. This is displayed on the login screen and in the window title\n$config['product_name'] = 'Roundcube Webmail';\n\n// Add this user-agent to message headers when sending\n$config['useragent'] = 'Roundcube Webmail/'.RCMAIL_VERSION;\n\n// try to load host-specific configuration\n// see https://github.com/roundcube/roundcubemail/wiki/Configuration:-Multi-Domain-Setup\n// for more details\n$config['include_host_config'] = false;\n\n// path to a text file which will be added to each sent message\n// paths are relative to the Roundcube root folder\n$config['generic_message_footer'] = '';\n\n// path to a text file which will be added to each sent HTML message\n// paths are relative to the Roundcube root folder\n$config['generic_message_footer_html'] = '';\n\n// add a received header to outgoing mails containing the creators IP and hostname\n$config['http_received_header'] = false;\n\n// Whether or not to encrypt the IP address and the host name\n// these could, in some circles, be considered as sensitive information;\n// however, for the administrator, these could be invaluable help\n// when tracking down issues.\n$config['http_received_header_encrypt'] = false;\n\n// number of chars allowed for line when wrapping text.\n// text wrapping is done when composing/sending messages\n$config['line_length'] = 72;\n\n// send plaintext messages as format=flowed\n$config['send_format_flowed'] = true;\n\n// According to RFC2298, return receipt envelope sender address must be empty.\n// If this option is true, Roundcube will use user's identity as envelope sender for MDN responses.\n$config['mdn_use_from'] = false;\n\n// Set identities access level:\n// 0 - many identities with possibility to edit all params\n// 1 - many identities with possibility to edit all params but not email address\n// 2 - one identity with possibility to edit all params\n// 3 - one identity with possibility to edit all params but not email address\n// 4 - one identity with possibility to edit only signature\n$config['identities_level'] = 0;\n\n// Maximum size of uploaded image in kilobytes\n// Images (in html signatures) are stored in database as data URIs\n$config['identity_image_size'] = 64;\n\n// Mimetypes supported by the browser.\n// Attachments of these types will open in a preview window.\n// Either a comma-separated list or an array. Default list includes:\n//     text/plain,text/html,\n//     image/jpeg,image/gif,image/png,image/bmp,image/tiff,image/webp,\n//     application/x-javascript,application/pdf,application/x-shockwave-flash\n$config['client_mimetypes'] = null;\n\n// Path to a local mime magic database file for PHPs finfo extension.\n// Set to null if the default path should be used.\n$config['mime_magic'] = null;\n\n// Absolute path to a local mime.types mapping table file.\n// This is used to derive mime-types from the filename extension or vice versa.\n// Such a file is usually part of the apache webserver. If you don't find a file named mime.types on your system,\n// download it from http://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types\n$config['mime_types'] = null;\n\n// path to imagemagick identify binary (if not set we'll use Imagick or GD extensions)\n$config['im_identify_path'] = null;\n\n// path to imagemagick convert binary (if not set we'll use Imagick or GD extensions)\n$config['im_convert_path'] = null;\n\n// Size of thumbnails from image attachments displayed below the message content.\n// Note: whether images are displayed at all depends on the 'inline_images' option.\n// Set to 0 to display images in full size.\n$config['image_thumbnail_size'] = 240;\n\n// maximum size of uploaded contact photos in pixel\n$config['contact_photo_size'] = 160;\n\n// Enable DNS checking for e-mail address validation\n$config['email_dns_check'] = false;\n\n// Disables saving sent messages in Sent folder (like gmail) (Default: false)\n// Note: useful when SMTP server stores sent mail in user mailbox\n$config['no_save_sent_messages'] = false;\n\n// Improve system security by using special URL with security token.\n// This can be set to a number defining token length. Default: 16.\n// Warning: This requires http server configuration. Sample:\n//    RewriteRule ^/roundcubemail/[a-zA-Z0-9]{16}/(.*) /roundcubemail/$1 [PT]\n//    Alias /roundcubemail /var/www/roundcubemail/\n// Note: Use assets_path to not prevent the browser from caching assets\n$config['use_secure_urls'] = false;\n\n// Allows to define separate server/path for image/js/css files\n// Warning: If the domain is different cross-domain access to some\n// resources need to be allowed\n// Sample:\n//    <FilesMatch \".(eot|ttf|woff)\">\n//    Header set Access-Control-Allow-Origin \"*\"\n//    </FilesMatch>\n$config['assets_path'] = '';\n\n// While assets_path is for the browser, assets_dir informs\n// PHP code about the location of asset files in filesystem\n$config['assets_dir'] = '';\n\n\n// ----------------------------------\n// PLUGINS\n// ----------------------------------\n\n// List of active plugins (in plugins/ directory)\n$config['plugins'] = array();\n\n// ----------------------------------\n// USER INTERFACE\n// ----------------------------------\n\n// default messages sort column. Use empty value for default server's sorting, \n// or 'arrival', 'date', 'subject', 'from', 'to', 'fromto', 'size', 'cc'\n$config['message_sort_col'] = '';\n\n// default messages sort order\n$config['message_sort_order'] = 'DESC';\n\n// These cols are shown in the message list. Available cols are:\n// subject, from, to, fromto, cc, replyto, date, size, status, flag, attachment, priority\n$config['list_cols'] = array('subject', 'status', 'fromto', 'date', 'size', 'flag', 'attachment');\n\n// the default locale setting (leave empty for auto-detection)\n// RFC1766 formatted language name like en_US, de_DE, de_CH, fr_FR, pt_BR\n$config['language'] = null;\n\n// use this format for date display (date or strftime format)\n$config['date_format'] = 'Y-m-d';\n\n// give this choice of date formats to the user to select from\n// Note: do not use ambiguous formats like m/d/Y\n$config['date_formats'] = array('Y-m-d', 'Y/m/d', 'Y.m.d', 'd-m-Y', 'd/m/Y', 'd.m.Y', 'j.n.Y');\n\n// use this format for time display (date or strftime format)\n$config['time_format'] = 'H:i';\n\n// give this choice of time formats to the user to select from\n$config['time_formats'] = array('G:i', 'H:i', 'g:i a', 'h:i A');\n\n// use this format for short date display (derived from date_format and time_format)\n$config['date_short'] = 'D H:i';\n\n// use this format for detailed date/time formatting (derived from date_format and time_format)\n$config['date_long'] = 'Y-m-d H:i';\n\n// store draft message is this mailbox\n// leave blank if draft messages should not be stored\n// NOTE: Use folder names with namespace prefix (INBOX. on Courier-IMAP)\n$config['drafts_mbox'] = 'Drafts';\n\n// store spam messages in this mailbox\n// NOTE: Use folder names with namespace prefix (INBOX. on Courier-IMAP)\n$config['junk_mbox'] = 'Junk';\n\n// store sent message is this mailbox\n// leave blank if sent messages should not be stored\n// NOTE: Use folder names with namespace prefix (INBOX. on Courier-IMAP)\n$config['sent_mbox'] = 'Sent';\n\n// move messages to this folder when deleting them\n// leave blank if they should be deleted directly\n// NOTE: Use folder names with namespace prefix (INBOX. on Courier-IMAP)\n$config['trash_mbox'] = 'Trash';\n\n// automatically create the above listed default folders on user login\n$config['create_default_folders'] = false;\n\n// protect the default folders from renames, deletes, and subscription changes\n$config['protect_default_folders'] = true;\n\n// Disable localization of the default folder names listed above\n$config['show_real_foldernames'] = false;\n\n// if in your system 0 quota means no limit set this option to true \n$config['quota_zero_as_unlimited'] = false;\n\n// Make use of the built-in spell checker. It is based on GoogieSpell.\n$config['enable_spellcheck'] = true;\n\n// Enables spellchecker exceptions dictionary.\n// Setting it to 'shared' will make the dictionary shared by all users.\n$config['spellcheck_dictionary'] = false;\n\n// Set the spell checking engine. Possible values:\n// - 'googie'  - the default (also used for connecting to Nox Spell Server, see 'spellcheck_uri' setting)\n// - 'pspell'  - requires the PHP Pspell module and aspell installed\n// - 'enchant' - requires the PHP Enchant module\n// - 'atd'     - install your own After the Deadline server or check with the people at http://www.afterthedeadline.com before using their API\n// Since Google shut down their public spell checking service, the default settings\n// connect to http://spell.roundcube.net which is a hosted service provided by Roundcube.\n// You can connect to any other googie-compliant service by setting 'spellcheck_uri' accordingly.\n$config['spellcheck_engine'] = 'googie';\n\n// For locally installed Nox Spell Server or After the Deadline services,\n// please specify the URI to call it.\n// Get Nox Spell Server from http://orangoo.com/labs/?page_id=72 or\n// the After the Deadline package from http://www.afterthedeadline.com.\n// Leave empty to use the public API of service.afterthedeadline.com\n$config['spellcheck_uri'] = '';\n\n// These languages can be selected for spell checking.\n// Configure as a PHP style hash array: array('en'=>'English', 'de'=>'Deutsch');\n// Leave empty for default set of available language.\n$config['spellcheck_languages'] = NULL;\n\n// Makes that words with all letters capitalized will be ignored (e.g. GOOGLE)\n$config['spellcheck_ignore_caps'] = false;\n\n// Makes that words with numbers will be ignored (e.g. g00gle)\n$config['spellcheck_ignore_nums'] = false;\n\n// Makes that words with symbols will be ignored (e.g. g@@gle)\n$config['spellcheck_ignore_syms'] = false;\n\n// Use this char/string to separate recipients when composing a new message\n$config['recipients_separator'] = ',';\n\n// Number of lines at the end of a message considered to contain the signature.\n// Increase this value if signatures are not properly detected and colored\n$config['sig_max_lines'] = 15;\n\n// don't let users set pagesize to more than this value if set\n$config['max_pagesize'] = 200;\n\n// Minimal value of user's 'refresh_interval' setting (in seconds)\n$config['min_refresh_interval'] = 60;\n\n// Enables files upload indicator. Requires APC installed and enabled apc.rfc1867 option.\n// By default refresh time is set to 1 second. You can set this value to true\n// or any integer value indicating number of seconds.\n$config['upload_progress'] = false;\n\n// Specifies for how many seconds the Undo button will be available\n// after object delete action. Currently used with supporting address book sources.\n// Setting it to 0, disables the feature.\n$config['undo_timeout'] = 0;\n\n// A static list of canned responses which are immutable for the user\n$config['compose_responses_static'] = array(\n//  array('name' => 'Canned Response 1', 'text' => 'Static Response One'),\n//  array('name' => 'Canned Response 2', 'text' => 'Static Response Two'),\n);\n\n// ----------------------------------\n// ADDRESSBOOK SETTINGS\n// ----------------------------------\n\n// This indicates which type of address book to use. Possible choises:\n// 'sql' (default), 'ldap' and ''.\n// If set to 'ldap' then it will look at using the first writable LDAP\n// address book as the primary address book and it will not display the\n// SQL address book in the 'Address Book' view.\n// If set to '' then no address book will be displayed or only the\n// addressbook which is created by a plugin (like CardDAV).\n$config['address_book_type'] = 'sql';\n\n// In order to enable public ldap search, configure an array like the Verisign\n// example further below. if you would like to test, simply uncomment the example.\n// Array key must contain only safe characters, ie. a-zA-Z0-9_\n$config['ldap_public'] = array();\n\n// If you are going to use LDAP for individual address books, you will need to \n// set 'user_specific' to true and use the variables to generate the appropriate DNs to access it.\n//\n// The recommended directory structure for LDAP is to store all the address book entries\n// under the users main entry, e.g.:\n//\n//  o=root\n//   ou=people\n//    uid=user@domain\n//  mail=contact@contactdomain\n//\n// So the base_dn would be uid=%fu,ou=people,o=root\n// The bind_dn would be the same as based_dn or some super user login.\n/* \n * example config for Verisign directory\n *\n$config['ldap_public']['Verisign'] = array(\n  'name'          => 'Verisign.com',\n  // Replacement variables supported in host names:\n  // %h - user's IMAP hostname\n  // %n - hostname ($_SERVER['SERVER_NAME'])\n  // %t - hostname without the first part\n  // %d - domain (http hostname $_SERVER['HTTP_HOST'] without the first part)\n  // %z - IMAP domain (IMAP hostname without the first part)\n  // For example %n = mail.domain.tld, %t = domain.tld\n  'hosts'         => array('directory.verisign.com'),\n  'port'          => 389,\n  'use_tls'       => false,\n  'ldap_version'  => 3,       // using LDAPv3\n  'network_timeout' => 10,    // The timeout (in seconds) for connect + bind arrempts. This is only supported in PHP >= 5.3.0 with OpenLDAP 2.x\n  'user_specific' => false,   // If true the base_dn, bind_dn and bind_pass default to the user's IMAP login.\n  // When 'user_specific' is enabled following variables can be used in base_dn/bind_dn config:\n  // %fu - The full username provided, assumes the username is an email\n  //       address, uses the username_domain value if not an email address.\n  // %u  - The username prior to the '@'.\n  // %d  - The domain name after the '@'.\n  // %dc - The domain name hierarchal string e.g. \"dc=test,dc=domain,dc=com\"\n  // %dn - DN found by ldap search when search_filter/search_base_dn are used\n  'base_dn'       => '',\n  'bind_dn'       => '',\n  'bind_pass'     => '',\n  // It's possible to bind for an individual address book\n  // The login name is used to search for the DN to bind with\n  'search_base_dn' => '',\n  'search_filter'  => '',   // e.g. '(&(objectClass=posixAccount)(uid=%u))'\n  // DN and password to bind as before searching for bind DN, if anonymous search is not allowed\n  'search_bind_dn' => '',\n  'search_bind_pw' => '',\n  // Base DN and filter used for resolving the user's domain root DN which feeds the %dc variables\n  // Leave empty to skip this lookup and derive the root DN from the username domain\n  'domain_base_dn' => '',\n  'domain_filter'  => '',\n  // Optional map of replacement strings => attributes used when binding for an individual address book\n  'search_bind_attrib' => array(),  // e.g. array('%udc' => 'ou')\n  // Default for %dn variable if search doesn't return DN value\n  'search_dn_default' => '',\n  // Optional authentication identifier to be used as SASL authorization proxy\n  // bind_dn need to be empty\n  'auth_cid'       => '',\n  // SASL authentication method (for proxy auth), e.g. DIGEST-MD5\n  'auth_method'    => '',\n  // Indicates if the addressbook shall be hidden from the list.\n  // With this option enabled you can still search/view contacts.\n  'hidden'        => false,\n  // Indicates if the addressbook shall not list contacts but only allows searching.\n  'searchonly'    => false,\n  // Indicates if we can write to the LDAP directory or not.\n  // If writable is true then these fields need to be populated:\n  // LDAP_Object_Classes, required_fields, LDAP_rdn\n  'writable'       => false,\n  // To create a new contact these are the object classes to specify\n  // (or any other classes you wish to use).\n  'LDAP_Object_Classes' => array('top', 'inetOrgPerson'),\n  // The RDN field that is used for new entries, this field needs\n  // to be one of the search_fields, the base of base_dn is appended\n  // to the RDN to insert into the LDAP directory.\n  'LDAP_rdn'       => 'cn',\n  // The required fields needed to build a new contact as required by\n  // the object classes (can include additional fields not required by the object classes).\n  'required_fields' => array('cn', 'sn', 'mail'),\n  'search_fields'   => array('mail', 'cn'),  // fields to search in\n  // mapping of contact fields to directory attributes\n  //   1. for every attribute one can specify the number of values (limit) allowed.\n  //      default is 1, a wildcard * means unlimited\n  //   2. another possible parameter is separator character for composite fields\n  //   3. it's possible to define field format for write operations, e.g. for date fields\n  //      example: 'birthday:date[YmdHis\\\\Z]'\n  'fieldmap' => array(\n    // Roundcube  => LDAP:limit\n    'name'        => 'cn',\n    'surname'     => 'sn',\n    'firstname'   => 'givenName',\n    'jobtitle'    => 'title',\n    'email'       => 'mail:*',\n    'phone:home'  => 'homePhone',\n    'phone:work'  => 'telephoneNumber',\n    'phone:mobile' => 'mobile',\n    'phone:pager' => 'pager',\n    'phone:workfax' => 'facsimileTelephoneNumber',\n    'street'      => 'street',\n    'zipcode'     => 'postalCode',\n    'region'      => 'st',\n    'locality'    => 'l',\n    // if you country is a complex object, you need to configure 'sub_fields' below\n    'country'      => 'c',\n    'organization' => 'o',\n    'department'   => 'ou',\n    'jobtitle'     => 'title',\n    'notes'        => 'description',\n    'photo'        => 'jpegPhoto',\n    // these currently don't work:\n    // 'manager'       => 'manager',\n    // 'assistant'     => 'secretary',\n  ),\n  // Map of contact sub-objects (attribute name => objectClass(es)), e.g. 'c' => 'country'\n  'sub_fields' => array(),\n  // Generate values for the following LDAP attributes automatically when creating a new record\n  'autovalues' => array(\n  // 'uid'  => 'md5(microtime())',               // You may specify PHP code snippets which are then eval'ed \n  // 'mail' => '{givenname}.{sn}@mydomain.com',  // or composite strings with placeholders for existing attributes\n  ),\n  'sort'           => 'cn',         // The field to sort the listing by.\n  'scope'          => 'sub',        // search mode: sub|base|list\n  'filter'         => '(objectClass=inetOrgPerson)',      // used for basic listing (if not empty) and will be &'d with search queries. example: status=act\n  'fuzzy_search'   => true,         // server allows wildcard search\n  'vlv'            => false,        // Enable Virtual List View to more efficiently fetch paginated data (if server supports it)\n  'vlv_search'     => false,        // Use Virtual List View functions for autocompletion searches (if server supports it)\n  'numsub_filter'  => '(objectClass=organizationalUnit)',   // with VLV, we also use numSubOrdinates to query the total number of records. Set this filter to get all numSubOrdinates attributes for counting\n  'config_root_dn' => 'cn=config',  // Root DN to search config entries (e.g. vlv indexes)\n  'sizelimit'      => '0',          // Enables you to limit the count of entries fetched. Setting this to 0 means no limit.\n  'timelimit'      => '0',          // Sets the number of seconds how long is spend on the search. Setting this to 0 means no limit.\n  'referrals'      => false,        // Sets the LDAP_OPT_REFERRALS option. Mostly used in multi-domain Active Directory setups\n  'dereference'    => 0,            // Sets the LDAP_OPT_DEREF option. One of: LDAP_DEREF_NEVER, LDAP_DEREF_SEARCHING, LDAP_DEREF_FINDING, LDAP_DEREF_ALWAYS\n                                    // Used where addressbook contains aliases to objects elsewhere in the LDAP tree.\n\n  // definition for contact groups (uncomment if no groups are supported)\n  // for the groups base_dn, the user replacements %fu, %u, $d and %dc work as for base_dn (see above)\n  // if the groups base_dn is empty, the contact base_dn is used for the groups as well\n  // -> in this case, assure that groups and contacts are separated due to the concernig filters! \n  'groups'  => array(\n    'base_dn'           => '',\n    'scope'             => 'sub',       // Search mode: sub|base|list\n    'filter'            => '(objectClass=groupOfNames)',\n    'object_classes'    => array('top', 'groupOfNames'),   // Object classes to be assigned to new groups\n    'member_attr'       => 'member',   // Name of the default member attribute, e.g. uniqueMember\n    'name_attr'         => 'cn',       // Attribute to be used as group name\n    'email_attr'        => 'mail',     // Group email address attribute (e.g. for mailing lists)\n    'member_filter'     => '(objectclass=*)',  // Optional filter to use when querying for group members\n    'vlv'               => false,      // Use VLV controls to list groups\n    'class_member_attr' => array(      // Mapping of group object class to member attribute used in these objects\n      'groupofnames'       => 'member',\n      'groupofuniquenames' => 'uniquemember'\n    ),\n  ),\n  // this configuration replaces the regular groups listing in the directory tree with\n  // a hard-coded list of groups, each listing entries with the configured base DN and filter.\n  // if the 'groups' option from above is set, it'll be shown as the first entry with the name 'Groups'\n  'group_filters' => array(\n    'departments' => array(\n      'name'    => 'Company Departments',\n      'scope'   => 'list',\n      'base_dn' => 'ou=Groups,dc=mydomain,dc=com',\n      'filter'  => '(|(objectclass=groupofuniquenames)(objectclass=groupofurls))',\n      'name_attr' => 'cn',\n    ),\n    'customers' => array(\n      'name'    => 'Customers',\n      'scope'   => 'sub',\n      'base_dn' => 'ou=Customers,dc=mydomain,dc=com',\n      'filter'  => '(objectClass=inetOrgPerson)',\n      'name_attr' => 'sn',\n    ),\n  ),\n);\n*/\n\n// An ordered array of the ids of the addressbooks that should be searched\n// when populating address autocomplete fields server-side. ex: array('sql','Verisign');\n$config['autocomplete_addressbooks'] = array('sql');\n\n// The minimum number of characters required to be typed in an autocomplete field\n// before address books will be searched. Most useful for LDAP directories that\n// may need to do lengthy results building given overly-broad searches\n$config['autocomplete_min_length'] = 1;\n\n// Number of parallel autocomplete requests.\n// If there's more than one address book, n parallel (async) requests will be created,\n// where each request will search in one address book. By default (0), all address\n// books are searched in one request.\n$config['autocomplete_threads'] = 0;\n\n// Max. numer of entries in autocomplete popup. Default: 15.\n$config['autocomplete_max'] = 15;\n\n// show address fields in this order\n// available placeholders: {street}, {locality}, {zipcode}, {country}, {region}\n$config['address_template'] = '{street}<br/>{locality} {zipcode}<br/>{country} {region}';\n\n// Matching mode for addressbook search (including autocompletion)\n// 0 - partial (*abc*), default\n// 1 - strict (abc)\n// 2 - prefix (abc*)\n// Note: For LDAP sources fuzzy_search must be enabled to use 'partial' or 'prefix' mode\n$config['addressbook_search_mode'] = 0;\n\n// List of fields used on contacts list and for autocompletion searches\n// Warning: These are field names not LDAP attributes (see 'fieldmap' setting)!\n$config['contactlist_fields'] = array('name', 'firstname', 'surname', 'email');\n\n// Template of contact entry on the autocompletion list.\n// You can use contact fields as: name, email, organization, department, etc.\n// See program/steps/addressbook/func.inc for a list\n$config['contact_search_name'] = '{name} <{email}>';\n\n// ----------------------------------\n// USER PREFERENCES\n// ----------------------------------\n\n// Use this charset as fallback for message decoding\n$config['default_charset'] = 'ISO-8859-1';\n\n// skin name: folder from skins/\n$config['skin'] = 'larry';\n\n// Enables using standard browser windows (that can be handled as tabs)\n// instead of popup windows\n$config['standard_windows'] = false;\n\n// show up to X items in messages list view\n$config['mail_pagesize'] = 50;\n\n// show up to X items in contacts list view\n$config['addressbook_pagesize'] = 50;\n\n// sort contacts by this col (preferably either one of name, firstname, surname)\n$config['addressbook_sort_col'] = 'surname';\n\n// The way how contact names are displayed in the list.\n// 0: prefix firstname middlename surname suffix (only if display name is not set)\n// 1: firstname middlename surname\n// 2: surname firstname middlename\n// 3: surname, firstname middlename\n$config['addressbook_name_listing'] = 0;\n\n// use this timezone to display date/time\n// valid timezone identifiers are listed here: php.net/manual/en/timezones.php\n// 'auto' will use the browser's timezone settings\n$config['timezone'] = 'auto';\n\n// prefer displaying HTML messages\n$config['prefer_html'] = true;\n\n// display remote inline images\n// 0 - Never, always ask\n// 1 - Ask if sender is not in address book\n// 2 - Always show inline images\n$config['show_images'] = 0;\n\n// open messages in new window\n$config['message_extwin'] = false;\n\n// open message compose form in new window\n$config['compose_extwin'] = false;\n\n// compose html formatted messages by default\n//  0 - never,\n//  1 - always,\n//  2 - on reply to HTML message,\n//  3 - on forward or reply to HTML message\n//  4 - always, except when replying to plain text message\n$config['htmleditor'] = 0;\n\n// save copies of compose messages in the browser's local storage\n// for recovery in case of browser crashes and session timeout.\n$config['compose_save_localstorage'] = true;\n\n// show pretty dates as standard\n$config['prettydate'] = true;\n\n// save compose message every 300 seconds (5min)\n$config['draft_autosave'] = 300;\n\n// Interface layout. Default: 'widescreen'.\n//  'widescreen' - three columns\n//  'desktop'    - two columns, preview on bottom\n//  'list'       - two columns, no preview\n$config['layout'] = 'widescreen';\n\n// Mark as read when viewing a message (delay in seconds)\n// Set to -1 if messages should not be marked as read\n$config['mail_read_time'] = 0;\n\n// Clear Trash on logout\n$config['logout_purge'] = false;\n\n// Compact INBOX on logout\n$config['logout_expunge'] = false;\n\n// Display attached images below the message body \n$config['inline_images'] = true;\n\n// Encoding of long/non-ascii attachment names:\n// 0 - Full RFC 2231 compatible\n// 1 - RFC 2047 for 'name' and RFC 2231 for 'filename' parameter (Thunderbird's default)\n// 2 - Full 2047 compatible\n$config['mime_param_folding'] = 1;\n\n// Set true if deleted messages should not be displayed\n// This will make the application run slower\n$config['skip_deleted'] = false;\n\n// Set true to Mark deleted messages as read as well as deleted\n// False means that a message's read status is not affected by marking it as deleted\n$config['read_when_deleted'] = true;\n\n// Set to true to never delete messages immediately\n// Use 'Purge' to remove messages marked as deleted\n$config['flag_for_deletion'] = false;\n\n// Default interval for auto-refresh requests (in seconds)\n// These are requests for system state updates e.g. checking for new messages, etc.\n// Setting it to 0 disables the feature.\n$config['refresh_interval'] = 60;\n\n// If true all folders will be checked for recent messages\n$config['check_all_folders'] = false;\n\n// If true, after message delete/move, the next message will be displayed\n$config['display_next'] = true;\n\n// Default messages listing mode. One of 'threads' or 'list'.\n$config['default_list_mode'] = 'list';\n\n// 0 - Do not expand threads\n// 1 - Expand all threads automatically\n// 2 - Expand only threads with unread messages\n$config['autoexpand_threads'] = 0;\n\n// When replying:\n// -1 - don't cite the original message\n// 0  - place cursor below the original message\n// 1  - place cursor above original message (top posting)\n$config['reply_mode'] = 0;\n\n// When replying strip original signature from message\n$config['strip_existing_sig'] = true;\n\n// Show signature:\n// 0 - Never\n// 1 - Always\n// 2 - New messages only\n// 3 - Forwards and Replies only\n$config['show_sig'] = 1;\n\n// By default the signature is placed depending on cursor position (reply_mode).\n// Sometimes it might be convenient to start the reply on top but keep\n// the signature below the quoted text (sig_below = true).\n$config['sig_below'] = false;\n\n// Enables adding of standard separator to the signature\n$config['sig_separator'] = true;\n\n// Use MIME encoding (quoted-printable) for 8bit characters in message body\n$config['force_7bit'] = false;\n\n// Defaults of the search field configuration.\n// The array can contain a per-folder list of header fields which should be considered when searching\n// The entry with key '*' stands for all folders which do not have a specific list set.\n// Please note that folder names should to be in sync with $config['*_mbox'] options\n$config['search_mods'] = null;  // Example: array('*' => array('subject'=>1, 'from'=>1), 'Sent' => array('subject'=>1, 'to'=>1));\n\n// Defaults of the addressbook search field configuration.\n$config['addressbook_search_mods'] = null;  // Example: array('name'=>1, 'firstname'=>1, 'surname'=>1, 'email'=>1, '*'=>1);\n\n// 'Delete always'\n// This setting reflects if mail should be always deleted\n// when moving to Trash fails. This is necessary in some setups\n// when user is over quota and Trash is included in the quota.\n$config['delete_always'] = false;\n\n// Directly delete messages in Junk instead of moving to Trash\n$config['delete_junk'] = false;\n\n// Behavior if a received message requests a message delivery notification (read receipt)\n// 0 = ask the user, 1 = send automatically, 2 = ignore (never send or ask)\n// 3 = send automatically if sender is in addressbook, otherwise ask the user\n// 4 = send automatically if sender is in addressbook, otherwise ignore\n$config['mdn_requests'] = 0;\n\n// Return receipt checkbox default state\n$config['mdn_default'] = 0;\n\n// Delivery Status Notification checkbox default state\n// Note: This can be used only if smtp_server is non-empty\n$config['dsn_default'] = 0;\n\n// Place replies in the folder of the message being replied to\n$config['reply_same_folder'] = false;\n\n// Sets default mode of Forward feature to \"forward as attachment\"\n$config['forward_attachment'] = false;\n\n// Defines address book (internal index) to which new contacts will be added\n// By default it is the first writeable addressbook.\n// Note: Use '0' for built-in address book.\n$config['default_addressbook'] = null;\n\n// Enables spell checking before sending a message.\n$config['spellcheck_before_send'] = false;\n\n// Skip alternative email addresses in autocompletion (show one address per contact)\n$config['autocomplete_single'] = false;\n\n// Default font for composed HTML message.\n// Supported values: Andale Mono, Arial, Arial Black, Book Antiqua, Courier New,\n// Georgia, Helvetica, Impact, Tahoma, Terminal, Times New Roman, Trebuchet MS, Verdana\n$config['default_font'] = 'Verdana';\n\n// Default font size for composed HTML message.\n// Supported sizes: 8pt, 10pt, 12pt, 14pt, 18pt, 24pt, 36pt\n$config['default_font_size'] = '10pt';\n\n// Enables display of email address with name instead of a name (and address in title)\n$config['message_show_email'] = false;\n\n// Default behavior of Reply-All button:\n// 0 - Reply-All always\n// 1 - Reply-List if mailing list is detected\n$config['reply_all_mode'] = 0;\n", "<?php\n\n/**\n +-----------------------------------------------------------------------+\n | This file is part of the Roundcube Webmail client                     |\n | Copyright (C) 2008-2014, The Roundcube Dev Team                       |\n |                                                                       |\n | Licensed under the GNU General Public License version 3 or            |\n | any later version with exceptions for skins & plugins.                |\n | See the README file for a full license statement.                     |\n |                                                                       |\n | PURPOSE:                                                              |\n |   Class to read configuration settings                                |\n +-----------------------------------------------------------------------+\n | Author: Thomas Bruederli <roundcube@gmail.com>                        |\n +-----------------------------------------------------------------------+\n*/\n\n/**\n * Configuration class for Roundcube\n *\n * @package    Framework\n * @subpackage Core\n */\nclass rcube_config\n{\n    const DEFAULT_SKIN = 'larry';\n\n    private $env       = '';\n    private $paths     = array();\n    private $prop      = array();\n    private $errors    = array();\n    private $userprefs = array();\n\n\n    /**\n     * Renamed options\n     *\n     * @var array\n     */\n    private $legacy_props = array(\n        // new name => old name\n        'mail_pagesize'        => 'pagesize',\n        'addressbook_pagesize' => 'pagesize',\n        'reply_mode'           => 'top_posting',\n        'refresh_interval'     => 'keep_alive',\n        'min_refresh_interval' => 'min_keep_alive',\n        'messages_cache_ttl'   => 'message_cache_lifetime',\n        'mail_read_time'       => 'preview_pane_mark_read',\n        'redundant_attachments_cache_ttl' => 'redundant_attachments_memcache_ttl',\n    );\n\n    /**\n     * Object constructor\n     *\n     * @param string $env Environment suffix for config files to load\n     */\n    public function __construct($env = '')\n    {\n        $this->env = $env;\n\n        if ($paths = getenv('RCUBE_CONFIG_PATH')) {\n            $this->paths = explode(PATH_SEPARATOR, $paths);\n            // make all paths absolute\n            foreach ($this->paths as $i => $path) {\n                if (!rcube_utils::is_absolute_path($path)) {\n                    if ($realpath = realpath(RCUBE_INSTALL_PATH . $path)) {\n                        $this->paths[$i] = unslashify($realpath) . '/';\n                    }\n                    else {\n                        unset($this->paths[$i]);\n                    }\n                }\n                else {\n                    $this->paths[$i] = unslashify($path) . '/';\n                }\n            }\n        }\n\n        if (defined('RCUBE_CONFIG_DIR') && !in_array(RCUBE_CONFIG_DIR, $this->paths)) {\n            $this->paths[] = RCUBE_CONFIG_DIR;\n        }\n\n        if (empty($this->paths)) {\n            $this->paths[] = RCUBE_INSTALL_PATH . 'config/';\n        }\n\n        $this->load();\n\n        // Defaults, that we do not require you to configure,\n        // but contain information that is used in various locations in the code:\n        if (empty($this->prop['contactlist_fields'])) {\n            $this->set('contactlist_fields', array('name', 'firstname', 'surname', 'email'));\n        }\n    }\n\n    /**\n     * @brief Guess the type the string may fit into.\n     *\n     * Look inside the string to determine what type might be best as a container.\n     *\n     * @param mixed $value The value to inspect\n     *\n     * @return The guess at the type.\n     */\n    private function guess_type($value)\n    {\n        $type = 'string';\n\n        // array requires hint to be passed.\n\n        if (preg_match('/^[-+]?(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?$/', $value)) {\n            $type = 'double';\n        }\n        else if (preg_match('/^\\d+$/', $value)) {\n            $type = 'integer';\n        }\n        else if (preg_match('/^(t(rue)?)|(f(alse)?)$/i', $value)) {\n            $type = 'boolean';\n        }\n\n        return $type;\n    }\n\n    /**\n     * @brief Parse environment variable into PHP type.\n     *\n     * Perform an appropriate parsing of the string to create the desired PHP type.\n     *\n     * @param string $string String to parse into PHP type\n     * @param string $type   Type of value to return\n     *\n     * @return Appropriately typed interpretation of $string.\n     */\n    private function parse_env($string, $type)\n    {\n        $_ = $string;\n\n        switch ($type) {\n        case 'boolean':\n            $_ = (boolean) $_;\n            break;\n        case 'integer':\n            $_ = (integer) $_;\n            break;\n        case 'double':\n            $_ = (double) $_;\n            break;\n        case 'string':\n            break;\n        case 'array':\n            $_ = json_decode($_, true);\n            break;\n        case 'object':\n            $_ = json_decode($_, false);\n            break;\n        case 'resource':\n        case 'NULL':\n        default:\n            $_ = $this->parse_env($_, $this->guess_type($_));\n        }\n\n        return $_;\n    }\n\n    /**\n     * @brief Get environment variable value.\n     *\n     * Retrieve an environment variable's value or if it's not found, return the\n     * provided default value.\n     *\n     * @param string $varname       Environment variable name\n     * @param mixed  $default_value Default value to return if necessary\n     * @param string $type          Type of value to return\n     *\n     * @return Value of the environment variable or default if not found.\n     */\n    private function getenv_default($varname, $default_value, $type = null)\n    {\n        $value = getenv($varname);\n\n        if ($value === false) {\n            $value = $default_value;\n        }\n        else {\n            $value = $this->parse_env($value, $type ?: gettype($default_value));\n        }\n\n        return $value;\n    }\n\n    /**\n     * Load config from local config file\n     *\n     * @todo Remove global $CONFIG\n     */\n    private function load()\n    {\n        // Load default settings\n        if (!$this->load_from_file('defaults.inc.php')) {\n            $this->errors[] = 'defaults.inc.php was not found.';\n        }\n\n        // load main config file\n        if (!$this->load_from_file('config.inc.php')) {\n            // Old configuration files\n            if (!$this->load_from_file('main.inc.php') || !$this->load_from_file('db.inc.php')) {\n                $this->errors[] = 'config.inc.php was not found.';\n            }\n            else if (rand(1,100) == 10) {  // log warning on every 100th request (average)\n                trigger_error(\"config.inc.php was not found. Please migrate your config by running bin/update.sh\", E_USER_WARNING);\n            }\n        }\n\n        // load host-specific configuration\n        $this->load_host_config();\n\n        // set skin (with fallback to old 'skin_path' property)\n        if (empty($this->prop['skin'])) {\n            if (!empty($this->prop['skin_path'])) {\n                $this->prop['skin'] = str_replace('skins/', '', unslashify($this->prop['skin_path']));\n            }\n            else {\n                $this->prop['skin'] = self::DEFAULT_SKIN;\n            }\n        }\n\n        // larry is the new default skin :-)\n        if ($this->prop['skin'] == 'default') {\n            $this->prop['skin'] = self::DEFAULT_SKIN;\n        }\n\n        // fix paths\n        foreach (array('log_dir' => 'logs', 'temp_dir' => 'temp') as $key => $dir) {\n            foreach (array($this->prop[$key], '../' . $this->prop[$key], RCUBE_INSTALL_PATH . $dir) as $path) {\n                if ($path && ($realpath = realpath(unslashify($path)))) {\n                    $this->prop[$key] = $realpath;\n                    break;\n                }\n            }\n        }\n\n        // fix default imap folders encoding\n        foreach (array('drafts_mbox', 'junk_mbox', 'sent_mbox', 'trash_mbox') as $folder) {\n            $this->prop[$folder] = rcube_charset::convert($this->prop[$folder], RCUBE_CHARSET, 'UTF7-IMAP');\n        }\n\n        // set PHP error logging according to config\n        if ($this->prop['debug_level'] & 1) {\n            ini_set('log_errors', 1);\n\n            if ($this->prop['log_driver'] == 'syslog') {\n                ini_set('error_log', 'syslog');\n            }\n            else {\n                ini_set('error_log', $this->prop['log_dir'].'/errors');\n            }\n        }\n\n        // enable display_errors in 'show' level, but not for ajax requests\n        ini_set('display_errors', intval(empty($_REQUEST['_remote']) && ($this->prop['debug_level'] & 4)));\n\n        // remove deprecated properties\n        unset($this->prop['dst_active']);\n\n        // export config data\n        $GLOBALS['CONFIG'] = &$this->prop;\n    }\n\n    /**\n     * Load a host-specific config file if configured\n     * This will merge the host specific configuration with the given one\n     */\n    private function load_host_config()\n    {\n        if (empty($this->prop['include_host_config'])) {\n            return;\n        }\n\n        foreach (array('HTTP_HOST', 'SERVER_NAME', 'SERVER_ADDR') as $key) {\n            $fname = null;\n            $name  = $_SERVER[$key];\n\n            if (!$name) {\n                continue;\n            }\n\n            if (is_array($this->prop['include_host_config'])) {\n                $fname = $this->prop['include_host_config'][$name];\n            }\n            else {\n                $fname = preg_replace('/[^a-z0-9\\.\\-_]/i', '', $name) . '.inc.php';\n            }\n\n            if ($fname && $this->load_from_file($fname)) {\n                return;\n            }\n        }\n    }\n\n    /**\n     * Read configuration from a file\n     * and merge with the already stored config values\n     *\n     * @param string $file Name of the config file to be loaded\n     *\n     * @return booelan True on success, false on failure\n     */\n    public function load_from_file($file)\n    {\n        $success = false;\n\n        foreach ($this->resolve_paths($file) as $fpath) {\n            if ($fpath && is_file($fpath) && is_readable($fpath)) {\n                // use output buffering, we don't need any output here\n                ob_start();\n                include($fpath);\n                ob_end_clean();\n\n                if (is_array($config)) {\n                    $this->merge($config);\n                    $success = true;\n                }\n                // deprecated name of config variable\n                if (is_array($rcmail_config)) {\n                    $this->merge($rcmail_config);\n                    $success = true;\n                }\n            }\n        }\n\n        return $success;\n    }\n\n    /**\n     * Helper method to resolve absolute paths to the given config file.\n     * This also takes the 'env' property into account.\n     *\n     * @param string  $file    Filename or absolute file path\n     * @param boolean $use_env Return -$env file path if exists\n     *\n     * @return array List of candidates in config dir path(s)\n     */\n    public function resolve_paths($file, $use_env = true)\n    {\n        $files    = array();\n        $abs_path = rcube_utils::is_absolute_path($file);\n\n        foreach ($this->paths as $basepath) {\n            $realpath = $abs_path ? $file : realpath($basepath . '/' . $file);\n\n            // check if <file>-env.ini exists\n            if ($realpath && $use_env && !empty($this->env)) {\n                $envfile = preg_replace('/\\.(inc.php)$/', '-' . $this->env . '.\\\\1', $realpath);\n                if (is_file($envfile)) {\n                    $realpath = $envfile;\n                }\n            }\n\n            if ($realpath) {\n                $files[] = $realpath;\n\n                // no need to continue the loop if an absolute file path is given\n                if ($abs_path) {\n                    break;\n                }\n            }\n        }\n\n        return $files;\n    }\n\n    /**\n     * Getter for a specific config parameter\n     *\n     * @param  string $name Parameter name\n     * @param  mixed  $def  Default value if not set\n     *\n     * @return mixed  The requested config value\n     */\n    public function get($name, $def = null)\n    {\n        if (isset($this->prop[$name])) {\n            $result = $this->prop[$name];\n        }\n        else {\n            $result = $def;\n        }\n\n        $result = $this->getenv_default('ROUNDCUBE_' . strtoupper($name), $result);\n        $rcube  = rcube::get_instance();\n\n        if ($name == 'timezone') {\n            if (empty($result) || $result == 'auto') {\n                $result = $this->client_timezone();\n            }\n        }\n        else if ($name == 'client_mimetypes') {\n            if (!$result && !$def) {\n                $result = 'text/plain,text/html'\n                    . ',image/jpeg,image/gif,image/png,image/bmp,image/tiff,image/webp'\n                    . ',application/x-javascript,application/pdf,application/x-shockwave-flash';\n            }\n            if ($result && is_string($result)) {\n                $result = explode(',', $result);\n            }\n        }\n\n        $plugin = $rcube->plugins->exec_hook('config_get', array(\n            'name' => $name, 'default' => $def, 'result' => $result));\n\n        return $plugin['result'];\n    }\n\n    /**\n     * Setter for a config parameter\n     *\n     * @param string $name  Parameter name\n     * @param mixed  $value Parameter value\n     */\n    public function set($name, $value)\n    {\n        $this->prop[$name] = $value;\n    }\n\n    /**\n     * Override config options with the given values (eg. user prefs)\n     *\n     * @param array $prefs Hash array with config props to merge over\n     */\n    public function merge($prefs)\n    {\n        $prefs = $this->fix_legacy_props($prefs);\n        $this->prop = array_merge($this->prop, $prefs, $this->userprefs);\n    }\n\n    /**\n     * Merge the given prefs over the current config\n     * and make sure that they survive further merging.\n     *\n     * @param array $prefs Hash array with user prefs\n     */\n    public function set_user_prefs($prefs)\n    {\n        $prefs = $this->fix_legacy_props($prefs);\n\n        // Honor the dont_override setting for any existing user preferences\n        $dont_override = $this->get('dont_override');\n        if (is_array($dont_override) && !empty($dont_override)) {\n            foreach ($dont_override as $key) {\n                unset($prefs[$key]);\n            }\n        }\n\n        // larry is the new default skin :-)\n        if ($prefs['skin'] == 'default') {\n            $prefs['skin'] = self::DEFAULT_SKIN;\n        }\n\n        $this->userprefs = $prefs;\n        $this->prop      = array_merge($this->prop, $prefs);\n    }\n\n    /**\n     * Getter for all config options\n     *\n     * @return array Hash array containing all config properties\n     */\n    public function all()\n    {\n        $props = $this->prop;\n\n        foreach ($props as $prop_name => $prop_value) {\n            $props[$prop_name] = $this->getenv_default('ROUNDCUBE_' . strtoupper($prop_name), $prop_value);\n        }\n\n        $rcube  = rcube::get_instance();\n        $plugin = $rcube->plugins->exec_hook('config_get', array(\n            'name' => '*', 'result' => $props));\n\n        return $plugin['result'];\n    }\n\n    /**\n     * Special getter for user's timezone offset including DST\n     *\n     * @return float Timezone offset (in hours)\n     * @deprecated\n     */\n    public function get_timezone()\n    {\n        if ($tz = $this->get('timezone')) {\n            try {\n                $tz = new DateTimeZone($tz);\n                return $tz->getOffset(new DateTime('now')) / 3600;\n            }\n            catch (Exception $e) {\n            }\n        }\n\n        return 0;\n    }\n\n    /**\n     * Return requested DES crypto key.\n     *\n     * @param string $key Crypto key name\n     *\n     * @return string Crypto key\n     */\n    public function get_crypto_key($key)\n    {\n        // Bomb out if the requested key does not exist\n        if (!array_key_exists($key, $this->prop) || empty($this->prop[$key])) {\n            rcube::raise_error(array(\n                'code' => 500, 'type' => 'php',\n                'file' => __FILE__, 'line' => __LINE__,\n                'message' => \"Request for unconfigured crypto key \\\"$key\\\"\"\n            ), true, true);\n        }\n\n        return $this->prop[$key];\n    }\n\n    /**\n     * Return configured crypto method.\n     *\n     * @return string Crypto method\n     */\n    public function get_crypto_method()\n    {\n        return $this->get('cipher_method') ?: 'DES-EDE3-CBC';\n    }\n\n    /**\n     * Try to autodetect operating system and find the correct line endings\n     *\n     * @return string The appropriate mail header delimiter\n     * @deprecated Since 1.3 we don't use mail()\n     */\n    public function header_delimiter()\n    {\n        // use the configured delimiter for headers\n        if (!empty($this->prop['mail_header_delimiter'])) {\n            $delim = $this->prop['mail_header_delimiter'];\n            if ($delim == \"\\n\" || $delim == \"\\r\\n\") {\n                return $delim;\n            }\n            else {\n                rcube::raise_error(array(\n                    'code' => 500, 'type' => 'php',\n                    'file' => __FILE__, 'line' => __LINE__,\n                    'message' => \"Invalid mail_header_delimiter setting\"\n                ), true, false);\n            }\n        }\n\n        $php_os = strtolower(substr(PHP_OS, 0, 3));\n\n        if ($php_os == 'win')\n            return \"\\r\\n\";\n\n        if ($php_os == 'mac')\n            return \"\\r\\n\";\n\n        return \"\\n\";\n    }\n\n    /**\n     * Return the mail domain configured for the given host\n     *\n     * @param string  $host   IMAP host\n     * @param boolean $encode If true, domain name will be converted to IDN ASCII\n     *\n     * @return string Resolved SMTP host\n     */\n    public function mail_domain($host, $encode=true)\n    {\n        $domain = $host;\n\n        if (is_array($this->prop['mail_domain'])) {\n            if (isset($this->prop['mail_domain'][$host])) {\n                $domain = $this->prop['mail_domain'][$host];\n            }\n        }\n        else if (!empty($this->prop['mail_domain'])) {\n            $domain = rcube_utils::parse_host($this->prop['mail_domain']);\n        }\n\n        if ($encode) {\n            $domain = rcube_utils::idn_to_ascii($domain);\n        }\n\n        return $domain;\n    }\n\n    /**\n     * Getter for error state\n     *\n     * @return mixed Error message on error, False if no errors\n     */\n    public function get_error()\n    {\n        return empty($this->errors) ? false : join(\"\\n\", $this->errors);\n    }\n\n    /**\n     * Internal getter for client's (browser) timezone identifier\n     */\n    private function client_timezone()\n    {\n        // @TODO: remove this legacy timezone handling in the future\n        $props = $this->fix_legacy_props(array('timezone' => $_SESSION['timezone']));\n\n        if (!empty($props['timezone'])) {\n            try {\n                $tz = new DateTimeZone($props['timezone']);\n                return $tz->getName();\n            }\n            catch (Exception $e) { /* gracefully ignore */ }\n        }\n\n        // fallback to server's timezone\n        return date_default_timezone_get();\n    }\n\n    /**\n     * Convert legacy options into new ones\n     *\n     * @param array $props Hash array with config props\n     *\n     * @return array Converted config props\n     */\n    private function fix_legacy_props($props)\n    {\n        foreach ($this->legacy_props as $new => $old) {\n            if (isset($props[$old])) {\n                if (!isset($props[$new])) {\n                    $props[$new] = $props[$old];\n                }\n                unset($props[$old]);\n            }\n        }\n\n        // convert deprecated numeric timezone value\n        if (isset($props['timezone']) && is_numeric($props['timezone'])) {\n            if ($tz = self::timezone_name_from_abbr($props['timezone'])) {\n                $props['timezone'] = $tz;\n            }\n            else {\n                unset($props['timezone']);\n            }\n        }\n\n        // translate old `preview_pane` settings to `layout`\n        if (isset($props['preview_pane']) && !isset($props['layout'])) {\n            $props['layout'] = $props['preview_pane'] ? 'desktop' : 'list';\n            unset($props['preview_pane']);\n        }\n\n        return $props;\n    }\n\n    /**\n     * timezone_name_from_abbr() replacement. Converts timezone offset\n     * into timezone name abbreviation.\n     *\n     * @param float $offset Timezone offset (in hours)\n     *\n     * @return string Timezone abbreviation\n     */\n    static public function timezone_name_from_abbr($offset)\n    {\n        // List of timezones here is not complete - https://bugs.php.net/bug.php?id=44780\n        if ($tz = timezone_name_from_abbr('', $offset * 3600, 0)) {\n            return $tz;\n        }\n\n        // try with more complete list (#1489261)\n        $timezones = array(\n            '-660' => \"Pacific/Apia\",\n            '-600' => \"Pacific/Honolulu\",\n            '-570' => \"Pacific/Marquesas\",\n            '-540' => \"America/Anchorage\",\n            '-480' => \"America/Los_Angeles\",\n            '-420' => \"America/Denver\",\n            '-360' => \"America/Chicago\",\n            '-300' => \"America/New_York\",\n            '-270' => \"America/Caracas\",\n            '-240' => \"America/Halifax\",\n            '-210' => \"Canada/Newfoundland\",\n            '-180' => \"America/Sao_Paulo\",\n             '-60' => \"Atlantic/Azores\",\n               '0' => \"Europe/London\",\n              '60' => \"Europe/Paris\",\n             '120' => \"Europe/Helsinki\",\n             '180' => \"Europe/Moscow\",\n             '210' => \"Asia/Tehran\",\n             '240' => \"Asia/Dubai\",\n             '270' => \"Asia/Kabul\",\n             '300' => \"Asia/Karachi\",\n             '330' => \"Asia/Kolkata\",\n             '345' => \"Asia/Katmandu\",\n             '360' => \"Asia/Yekaterinburg\",\n             '390' => \"Asia/Rangoon\",\n             '420' => \"Asia/Krasnoyarsk\",\n             '480' => \"Asia/Shanghai\",\n             '525' => \"Australia/Eucla\",\n             '540' => \"Asia/Tokyo\",\n             '570' => \"Australia/Adelaide\",\n             '600' => \"Australia/Melbourne\",\n             '630' => \"Australia/Lord_Howe\",\n             '660' => \"Asia/Vladivostok\",\n             '690' => \"Pacific/Norfolk\",\n             '720' => \"Pacific/Auckland\",\n             '765' => \"Pacific/Chatham\",\n             '780' => \"Pacific/Enderbury\",\n             '840' => \"Pacific/Kiritimati\",\n        );\n\n        return $timezones[(string) intval($offset * 60)];\n    }\n}\n", "<?php\n\n/**\n +-----------------------------------------------------------------------+\n | program/steps/mail/func.inc                                           |\n |                                                                       |\n | This file is part of the Roundcube Webmail client                     |\n | Copyright (C) 2005-2014, The Roundcube Dev Team                       |\n |                                                                       |\n | Licensed under the GNU General Public License version 3 or            |\n | any later version with exceptions for skins & plugins.                |\n | See the README file for a full license statement.                     |\n |                                                                       |\n | PURPOSE:                                                              |\n |   Provide webmail functionality and GUI objects                       |\n |                                                                       |\n +-----------------------------------------------------------------------+\n | Author: Thomas Bruederli <roundcube@gmail.com>                        |\n | Author: Aleksander Machniak <alec@alec.pl>                            |\n +-----------------------------------------------------------------------+\n*/\n\n// always instantiate storage object (but not connect to server yet)\n$RCMAIL->storage_init();\n\n// init environment - set current folder, page, list mode\nrcmail_init_env();\n\n// set message set for search result\nif (!empty($_REQUEST['_search']) && isset($_SESSION['search'])\n    && $_SESSION['search_request'] == $_REQUEST['_search']\n) {\n    $RCMAIL->storage->set_search_set($_SESSION['search']);\n\n    $OUTPUT->set_env('search_request', $_REQUEST['_search']);\n    $OUTPUT->set_env('search_text', $_SESSION['last_text_search']);\n}\n\n// remove mbox part from _uid\nif (($_uid  = rcube_utils::get_input_value('_uid', rcube_utils::INPUT_GPC)) && !is_array($_uid) && preg_match('/^\\d+-.+/', $_uid)) {\n  list($_uid, $mbox) = explode('-', $_uid, 2);\n  if (isset($_GET['_uid']))  $_GET['_uid']  = $_uid;\n  if (isset($_POST['_uid'])) $_POST['_uid'] = $_uid;\n  $_REQUEST['_uid'] = $_uid;\n  unset($_uid);\n\n  // override mbox\n  if (!empty($mbox)) {\n    $_GET['_mbox']  = $mbox;\n    $_POST['_mbox'] = $mbox;\n    $RCMAIL->storage->set_folder(($_SESSION['mbox'] = $mbox));\n  }\n}\n\nif (!empty($_SESSION['browser_caps']) && !$OUTPUT->ajax_call) {\n    $OUTPUT->set_env('browser_capabilities', $_SESSION['browser_caps']);\n}\n\n// set main env variables, labels and page title\nif (empty($RCMAIL->action) || $RCMAIL->action == 'list') {\n    // connect to storage server and trigger error on failure\n    $RCMAIL->storage_connect();\n\n    $mbox_name = $RCMAIL->storage->get_folder();\n\n    if (empty($RCMAIL->action)) {\n        $OUTPUT->set_env('search_mods', rcmail_search_mods());\n\n        if (!empty($_SESSION['search_scope']))\n            $OUTPUT->set_env('search_scope', $_SESSION['search_scope']);\n\n        rcmail_list_pagetitle();\n    }\n\n    $threading = (bool) $RCMAIL->storage->get_threading();\n    $delimiter = $RCMAIL->storage->get_hierarchy_delimiter();\n\n    // set current mailbox and some other vars in client environment\n    $OUTPUT->set_env('mailbox', $mbox_name);\n    $OUTPUT->set_env('pagesize', $RCMAIL->storage->get_pagesize());\n    $OUTPUT->set_env('current_page', max(1, $_SESSION['page']));\n    $OUTPUT->set_env('delimiter', $delimiter);\n    $OUTPUT->set_env('threading', $threading);\n    $OUTPUT->set_env('threads', $threading || $RCMAIL->storage->get_capability('THREAD'));\n    $OUTPUT->set_env('reply_all_mode', (int) $RCMAIL->config->get('reply_all_mode'));\n    $OUTPUT->set_env('layout', $RCMAIL->config->get('layout') ?: 'widescreen');\n\n    if ($RCMAIL->storage->get_capability('QUOTA')) {\n        $OUTPUT->set_env('quota', true);\n    }\n\n    // set special folders\n    foreach (array('drafts', 'trash', 'junk') as $mbox) {\n        if ($folder = $RCMAIL->config->get($mbox . '_mbox')) {\n            $OUTPUT->set_env($mbox . '_mailbox', $folder);\n        }\n    }\n\n    if (!empty($_GET['_uid'])) {\n        $OUTPUT->set_env('list_uid', $_GET['_uid']);\n    }\n\n    // set configuration\n    $RCMAIL->set_env_config(array('delete_junk', 'flag_for_deletion', 'read_when_deleted',\n        'skip_deleted', 'display_next', 'message_extwin', 'forward_attachment'));\n\n    if (!$OUTPUT->ajax_call) {\n        $OUTPUT->add_label('checkingmail', 'deletemessage', 'movemessagetotrash',\n            'movingmessage', 'copyingmessage', 'deletingmessage', 'markingmessage',\n            'copy', 'move', 'quota', 'replyall', 'replylist', 'stillsearching',\n            'flagged', 'unflagged', 'unread', 'deleted', 'replied', 'forwarded',\n            'priority', 'withattachment', 'fileuploaderror', 'mark', 'markallread',\n            'folders-cur', 'folders-sub', 'folders-all', 'cancel');\n    }\n}\n\n// register UI objects\n$OUTPUT->add_handlers(array(\n    'mailboxlist'         => array($RCMAIL, 'folder_list'),\n    'quotadisplay'        => array($RCMAIL, 'quota_display'),\n    'messages'            => 'rcmail_message_list',\n    'messagecountdisplay' => 'rcmail_messagecount_display',\n    'listmenulink'        => 'rcmail_options_menu_link',\n    'mailboxname'         => 'rcmail_mailbox_name_display',\n    'messageheaders'      => 'rcmail_message_headers',\n    'messagefullheaders'  => 'rcmail_message_full_headers',\n    'messagebody'         => 'rcmail_message_body',\n    'messagecontentframe' => 'rcmail_messagecontent_frame',\n    'messageimportform'   => 'rcmail_message_import_form',\n    'searchfilter'        => 'rcmail_search_filter',\n    'searchinterval'      => 'rcmail_search_interval',\n    'searchform'          => array($OUTPUT, 'search_form'),\n));\n\n// register action aliases\n$RCMAIL->register_action_map(array(\n    'refresh' => 'check_recent.inc',\n    'preview' => 'show.inc',\n    'print'   => 'show.inc',\n    'move'    => 'move_del.inc',\n    'delete'  => 'move_del.inc',\n    'send'    => 'sendmail.inc',\n    'expunge' => 'folders.inc',\n    'purge'   => 'folders.inc',\n    'remove-attachment'  => 'attachments.inc',\n    'rename-attachment'  => 'attachments.inc',\n    'display-attachment' => 'attachments.inc',\n    'upload'             => 'attachments.inc',\n    'group-expand'       => 'autocomplete.inc',\n));\n\n\n/**\n * Sets storage properties and session\n */\nfunction rcmail_init_env()\n{\n    global $RCMAIL;\n\n    $default_threading  = $RCMAIL->config->get('default_list_mode', 'list') == 'threads';\n    $a_threading        = $RCMAIL->config->get('message_threading', array());\n    $message_sort_col   = $RCMAIL->config->get('message_sort_col');\n    $message_sort_order = $RCMAIL->config->get('message_sort_order');\n\n    // set imap properties and session vars\n    if (!strlen($mbox = rcube_utils::get_input_value('_mbox', rcube_utils::INPUT_GPC, true))) {\n        $mbox = strlen($_SESSION['mbox']) ? $_SESSION['mbox'] : 'INBOX';\n    }\n\n    // we handle 'page' argument on 'list' and 'getunread' to prevent from\n    // race condition and unintentional page overwrite in session\n    if ($RCMAIL->action == 'list' || $RCMAIL->action == 'getunread') {\n        if (!($page = intval($_GET['_page']))) {\n            $page = $_SESSION['page'] ?: 1;\n        }\n\n        $_SESSION['page'] = $page;\n    }\n\n    $RCMAIL->storage->set_folder($_SESSION['mbox'] = $mbox);\n    $RCMAIL->storage->set_page($_SESSION['page']);\n\n    // set default sort col/order to session\n    if (!isset($_SESSION['sort_col'])) {\n        $_SESSION['sort_col'] = $message_sort_col ?: '';\n    }\n    if (!isset($_SESSION['sort_order'])) {\n        $_SESSION['sort_order'] = strtoupper($message_sort_order) == 'ASC' ? 'ASC' : 'DESC';\n    }\n\n    // set threads mode\n    if (isset($_GET['_threads'])) {\n        if ($_GET['_threads']) {\n            // re-set current page number when listing mode changes\n            if (!$a_threading[$_SESSION['mbox']]) {\n                $RCMAIL->storage->set_page($_SESSION['page'] = 1);\n            }\n\n            $a_threading[$_SESSION['mbox']] = true;\n        }\n        else {\n            // re-set current page number when listing mode changes\n            if ($a_threading[$_SESSION['mbox']]) {\n                $RCMAIL->storage->set_page($_SESSION['page'] = 1);\n            }\n\n            $a_threading[$_SESSION['mbox']] = false;\n        }\n\n        $RCMAIL->user->save_prefs(array('message_threading' => $a_threading));\n    }\n\n    $threading = isset($a_threading[$_SESSION['mbox']]) ? $a_threading[$_SESSION['mbox']] : $default_threading;\n\n    $RCMAIL->storage->set_threading($threading);\n}\n\n/**\n * Sets page title\n */\nfunction rcmail_list_pagetitle()\n{\n    global $RCMAIL;\n\n    if ($RCMAIL->output->get_env('search_request')) {\n        $pagetitle = $RCMAIL->gettext('searchresult');\n    }\n    else {\n        $mbox_name = $RCMAIL->output->get_env('mailbox') ?: $RCMAIL->storage->get_folder();\n        $delimiter = $RCMAIL->storage->get_hierarchy_delimiter();\n        $pagetitle = $RCMAIL->localize_foldername($mbox_name, true);\n        $pagetitle = str_replace($delimiter, \" \\xC2\\xBB \", $pagetitle);\n    }\n\n    $RCMAIL->output->set_pagetitle($pagetitle);\n}\n\n/**\n * Returns default search mods\n */\nfunction rcmail_search_mods()\n{\n    global $RCMAIL;\n\n    $mods = $RCMAIL->config->get('search_mods');\n\n    if (empty($mods)) {\n        $mods = array('*' => array('subject' => 1, 'from' => 1));\n\n        foreach (array('sent', 'drafts') as $mbox) {\n            if ($mbox = $RCMAIL->config->get($mbox . '_mbox')) {\n                $mods[$mbox] = array('subject' => 1, 'to' => 1);\n            }\n        }\n    }\n\n    return $mods;\n}\n\n/**\n * Returns 'to' if current folder is configured Sent or Drafts\n * or their subfolders, otherwise returns 'from'.\n *\n * @return string Column name\n */\nfunction rcmail_message_list_smart_column_name()\n{\n    global $RCMAIL;\n\n    $delim       = $RCMAIL->storage->get_hierarchy_delimiter();\n    $mbox        = $RCMAIL->output->get_env('mailbox') ?: $RCMAIL->storage->get_folder();\n    $sent_mbox   = $RCMAIL->config->get('sent_mbox');\n    $drafts_mbox = $RCMAIL->config->get('drafts_mbox');\n\n    if ((strpos($mbox.$delim, $sent_mbox.$delim) === 0 || strpos($mbox.$delim, $drafts_mbox.$delim) === 0)\n        && strtoupper($mbox) != 'INBOX'\n    ) {\n        return 'to';\n    }\n\n    return 'from';\n}\n\n/**\n * Returns configured messages list sorting column name\n * The name is context-sensitive, which means if sorting is set to 'fromto'\n * it will return 'from' or 'to' according to current folder type.\n *\n * @return string Column name\n */\nfunction rcmail_sort_column()\n{\n    global $RCMAIL;\n\n    if (isset($_SESSION['sort_col'])) {\n        $column = $_SESSION['sort_col'];\n    }\n    else {\n        $column = $RCMAIL->config->get('message_sort_col');\n    }\n\n    // get name of smart From/To column in folder context\n    if ($column == 'fromto') {\n        $column = rcmail_message_list_smart_column_name();\n    }\n\n    return $column;\n}\n\n/**\n * Returns configured message list sorting order\n *\n * @return string Sorting order (ASC|DESC)\n */\nfunction rcmail_sort_order()\n{\n    global $RCMAIL;\n\n    if (isset($_SESSION['sort_order'])) {\n        return $_SESSION['sort_order'];\n    }\n\n    return $RCMAIL->config->get('message_sort_order');\n}\n\n/**\n * return the message list as HTML table\n */\nfunction rcmail_message_list($attrib)\n{\n    global $RCMAIL, $OUTPUT;\n\n    // add some labels to client\n    $OUTPUT->add_label('from', 'to');\n\n    // add id to message list table if not specified\n    if (!strlen($attrib['id'])) {\n        $attrib['id'] = 'rcubemessagelist';\n    }\n\n    // define list of cols to be displayed based on parameter or config\n    if (empty($attrib['columns'])) {\n        $list_cols   = $RCMAIL->config->get('list_cols');\n        $a_show_cols = !empty($list_cols) && is_array($list_cols) ? $list_cols : array('subject');\n\n        $OUTPUT->set_env('col_movable', !in_array('list_cols', (array)$RCMAIL->config->get('dont_override')));\n    }\n    else {\n        $a_show_cols = preg_split('/[\\s,;]+/', str_replace(array(\"'\", '\"'), '', $attrib['columns']));\n        $attrib['columns'] = $a_show_cols;\n    }\n\n    // save some variables for use in ajax list\n    $_SESSION['list_attrib'] = $attrib;\n\n    // make sure 'threads' and 'subject' columns are present\n    if (!in_array('subject', $a_show_cols))\n        array_unshift($a_show_cols, 'subject');\n    if (!in_array('threads', $a_show_cols))\n        array_unshift($a_show_cols, 'threads');\n\n    $listcols = $a_show_cols;\n\n    // Widescreen layout uses hardcoded list of columns\n    if ($RCMAIL->config->get('layout', 'widescreen') == 'widescreen') {\n        $a_show_cols = array('threads', 'subject', 'fromto', 'date', 'flag', 'attachment');\n        $listcols    = $a_show_cols;\n        array_shift($listcols);\n    }\n\n    // set client env\n    $OUTPUT->add_gui_object('messagelist', $attrib['id']);\n    $OUTPUT->set_env('autoexpand_threads', intval($RCMAIL->config->get('autoexpand_threads')));\n    $OUTPUT->set_env('sort_col', $_SESSION['sort_col']);\n    $OUTPUT->set_env('sort_order', $_SESSION['sort_order']);\n    $OUTPUT->set_env('messages', array());\n    $OUTPUT->set_env('listcols', $listcols);\n\n    $OUTPUT->include_script('list.js');\n\n    $table = new html_table($attrib);\n\n    if (!$attrib['noheader']) {\n        foreach (rcmail_message_list_head($attrib, $a_show_cols) as $cell)\n            $table->add_header(array('class' => $cell['className'], 'id' => $cell['id']), $cell['html']);\n    }\n\n    return $table->show();\n}\n\n/**\n * return javascript commands to add rows to the message list\n */\nfunction rcmail_js_message_list($a_headers, $insert_top=false, $a_show_cols=null)\n{\n    global $RCMAIL, $OUTPUT;\n\n    if (empty($a_show_cols)) {\n        if (!empty($_SESSION['list_attrib']['columns']))\n            $a_show_cols = $_SESSION['list_attrib']['columns'];\n        else {\n            $list_cols   = $RCMAIL->config->get('list_cols');\n            $a_show_cols = !empty($list_cols) && is_array($list_cols) ? $list_cols : array('subject');\n        }\n    }\n    else {\n        if (!is_array($a_show_cols)) {\n            $a_show_cols = preg_split('/[\\s,;]+/', str_replace(array(\"'\", '\"'), '', $a_show_cols));\n        }\n        $head_replace = true;\n    }\n\n    $delimiter   = $RCMAIL->storage->get_hierarchy_delimiter();\n    $search_set  = $RCMAIL->storage->get_search_set();\n    $multifolder = $search_set && $search_set[1]->multi;\n\n    // add/remove 'folder' column to the list on multi-folder searches\n    if ($multifolder && !in_array('folder', $a_show_cols)) {\n        $a_show_cols[] = 'folder';\n        $head_replace = true;\n    }\n    else if (!$multifolder && ($found = array_search('folder', $a_show_cols)) !== false) {\n        unset($a_show_cols[$found]);\n        $head_replace = true;\n    }\n\n    $mbox = $RCMAIL->output->get_env('mailbox') ?: $RCMAIL->storage->get_folder();\n\n    // make sure 'threads' and 'subject' columns are present\n    if (!in_array('subject', $a_show_cols))\n        array_unshift($a_show_cols, 'subject');\n    if (!in_array('threads', $a_show_cols))\n        array_unshift($a_show_cols, 'threads');\n\n    // Make sure there are no duplicated columns (#1486999)\n    $a_show_cols = array_unique($a_show_cols);\n    $_SESSION['list_attrib']['columns'] = $a_show_cols;\n\n    // Widescreen layout uses hardcoded list of columns\n    if ($RCMAIL->config->get('layout', 'widescreen') == 'widescreen') {\n        $a_show_cols = array('threads', 'subject', 'fromto', 'date', 'flag', 'attachment');\n    }\n\n    // Plugins may set header's list_cols/list_flags and other rcube_message_header variables\n    // and list columns\n    $plugin = $RCMAIL->plugins->exec_hook('messages_list',\n        array('messages' => $a_headers, 'cols' => $a_show_cols));\n\n    $a_show_cols = $plugin['cols'];\n    $a_headers   = $plugin['messages'];\n\n    if ($RCMAIL->config->get('layout', 'widescreen') == 'widescreen') {\n        if (!$RCMAIL->storage->get_threading()) {\n            if (($idx = array_search('threads', $a_show_cols)) !== false) {\n                unset($a_show_cols[$idx]);\n            }\n        }\n    }\n\n    $thead = $head_replace ? rcmail_message_list_head($_SESSION['list_attrib'], $a_show_cols) : NULL;\n\n    // get name of smart From/To column in folder context\n    if (array_search('fromto', $a_show_cols) !== false) {\n        $smart_col = rcmail_message_list_smart_column_name();\n    }\n\n    $OUTPUT->command('set_message_coltypes', array_values($a_show_cols), $thead, $smart_col);\n\n    if ($multifolder && $_SESSION['search_scope'] == 'all') {\n        $OUTPUT->command('select_folder', '');\n    }\n\n    $OUTPUT->set_env('multifolder_listing', $multifolder);\n\n    if (empty($a_headers)) {\n        return;\n    }\n\n    // remove 'threads', 'attachment', 'flag', 'status' columns, we don't need them here\n    foreach (array('threads', 'attachment', 'flag', 'status', 'priority') as $col) {\n        if (($key = array_search($col, $a_show_cols)) !== FALSE) {\n            unset($a_show_cols[$key]);\n        }\n    }\n\n    $sort_col = $_SESSION['sort_col'];\n\n    // loop through message headers\n    foreach ($a_headers as $header) {\n        if (empty($header) || !$header->size) {\n            continue;\n        }\n\n        // make message UIDs unique by appending the folder name\n        if ($multifolder) {\n            $header->uid .= '-'.$header->folder;\n            $header->flags['skip_mbox_check'] = true;\n            if ($header->parent_uid)\n                $header->parent_uid .= '-'.$header->folder;\n        }\n\n        $a_msg_cols  = array();\n        $a_msg_flags = array();\n\n        // format each col; similar as in rcmail_message_list()\n        foreach ($a_show_cols as $col) {\n            $col_name = $col == 'fromto' ? $smart_col : $col;\n\n            if (in_array($col_name, array('from', 'to', 'cc', 'replyto'))) {\n                $cont = rcmail_address_string($header->$col_name, 3, false, null, $header->charset);\n                if (empty($cont)) $cont = '&nbsp;'; // for widescreen mode\n            }\n            else if ($col == 'subject') {\n                $cont = trim(rcube_mime::decode_header($header->$col, $header->charset));\n                if (!$cont) $cont = $RCMAIL->gettext('nosubject');\n                $cont = rcube::Q($cont);\n            }\n            else if ($col == 'size')\n                $cont = $RCMAIL->show_bytes($header->$col);\n            else if ($col == 'date')\n                $cont = $RCMAIL->format_date($sort_col == 'arrival' ? $header->internaldate : $header->date);\n            else if ($col == 'folder') {\n                if ($last_folder !== $header->folder) {\n                    $last_folder      = $header->folder;\n                    $last_folder_name = $RCMAIL->localize_foldername($last_folder, true);\n                    $last_folder_name = str_replace($delimiter, \" \\xC2\\xBB \", $last_folder_name);\n                }\n\n                $cont = rcube::Q($last_folder_name);\n            }\n            else\n                $cont = rcube::Q($header->$col);\n\n            $a_msg_cols[$col] = $cont;\n        }\n\n        $a_msg_flags = array_change_key_case(array_map('intval', (array) $header->flags));\n        if ($header->depth)\n            $a_msg_flags['depth'] = $header->depth;\n        else if ($header->has_children)\n            $roots[] = $header->uid;\n        if ($header->parent_uid)\n            $a_msg_flags['parent_uid'] = $header->parent_uid;\n        if ($header->has_children)\n            $a_msg_flags['has_children'] = $header->has_children;\n        if ($header->unread_children)\n            $a_msg_flags['unread_children'] = $header->unread_children;\n        if ($header->flagged_children)\n            $a_msg_flags['flagged_children'] = $header->flagged_children;\n        if ($header->others['list-post'])\n            $a_msg_flags['ml'] = 1;\n        if ($header->priority)\n            $a_msg_flags['prio'] = (int) $header->priority;\n\n        $a_msg_flags['ctype'] = rcube::Q($header->ctype);\n        $a_msg_flags['mbox']  = $header->folder;\n\n        // merge with plugin result (Deprecated, use $header->flags)\n        if (!empty($header->list_flags) && is_array($header->list_flags))\n            $a_msg_flags = array_merge($a_msg_flags, $header->list_flags);\n        if (!empty($header->list_cols) && is_array($header->list_cols))\n            $a_msg_cols = array_merge($a_msg_cols, $header->list_cols);\n\n        $OUTPUT->command('add_message_row', $header->uid, $a_msg_cols, $a_msg_flags, $insert_top);\n    }\n\n    if ($RCMAIL->storage->get_threading()) {\n        $OUTPUT->command('init_threads', (array) $roots, $mbox);\n    }\n}\n\n/*\n * Creates <THEAD> for message list table\n */\nfunction rcmail_message_list_head($attrib, $a_show_cols)\n{\n    global $RCMAIL;\n\n    // check to see if we have some settings for sorting\n    $sort_col   = $_SESSION['sort_col'];\n    $sort_order = $_SESSION['sort_order'];\n\n    $dont_override  = (array) $RCMAIL->config->get('dont_override');\n    $disabled_sort  = in_array('message_sort_col', $dont_override);\n    $disabled_order = in_array('message_sort_order', $dont_override);\n\n    $RCMAIL->output->set_env('disabled_sort_col', $disabled_sort);\n    $RCMAIL->output->set_env('disabled_sort_order', $disabled_order);\n\n    // define sortable columns\n    if ($disabled_sort)\n        $a_sort_cols = $sort_col && !$disabled_order ? array($sort_col) : array();\n    else\n        $a_sort_cols = array('subject', 'date', 'from', 'to', 'fromto', 'size', 'cc');\n\n    if (!empty($attrib['optionsmenuicon'])) {\n        $list_menu = rcmail_options_menu_link($attrib);\n    }\n\n    $cells = $coltypes = array();\n\n    // get name of smart From/To column in folder context\n    if (array_search('fromto', $a_show_cols) !== false) {\n        $smart_col = rcmail_message_list_smart_column_name();\n    }\n\n    foreach ($a_show_cols as $col) {\n        $label    = '';\n        $sortable = false;\n        $rel_col  = $col == 'date' && $sort_col == 'arrival' ? 'arrival' : $col;\n\n        // get column name\n        switch ($col) {\n        case 'flag':\n            $col_name = html::span('flagged', $RCMAIL->gettext('flagged'));\n            break;\n        case 'attachment':\n        case 'priority':\n            $col_name = html::span($col, $RCMAIL->gettext($col));\n            break;\n        case 'status':\n            $col_name = html::span($col, $RCMAIL->gettext('readstatus'));\n            break;\n        case 'threads':\n            $col_name = (string) $list_menu;\n            break;\n        case 'fromto':\n            $label    = $RCMAIL->gettext($smart_col);\n            $col_name = rcube::Q($label);\n            break;\n        default:\n            $label    = $RCMAIL->gettext($col);\n            $col_name = rcube::Q($label);\n        }\n\n        // make sort links\n        if (in_array($col, $a_sort_cols)) {\n            $sortable = true;\n            $col_name = html::a(array(\n                    'href'  => \"./#sort\",\n                    'class' => 'sortcol',\n                    'rel'   => $rel_col,\n                    'title' => $RCMAIL->gettext('sortby')\n                ), $col_name);\n        }\n        else if ($col_name[0] != '<') {\n            $col_name = '<span class=\"' . $col .'\">' . $col_name . '</span>';\n        }\n\n        $sort_class = $rel_col == $sort_col && !$disabled_order ? \" sorted$sort_order\" : '';\n        $class_name = $col.$sort_class;\n\n        // put it all together\n        $cells[] = array('className' => $class_name, 'id' => \"rcm$col\", 'html' => $col_name);\n        $coltypes[$col] = array('className' => $class_name, 'id' => \"rcm$col\", 'label' => $label, 'sortable' => $sortable);\n    }\n\n    $RCMAIL->output->set_env('coltypes', $coltypes);\n    return $cells;\n}\n\nfunction rcmail_options_menu_link($attrib)\n{\n    global $RCMAIL;\n\n    $onclick = 'return ' . rcmail_output::JS_OBJECT_NAME . \".command('menu-open', 'messagelistmenu', this, event)\";\n    $inner   = $title = $RCMAIL->gettext('listoptions');\n\n    if (is_string($attrib['optionsmenuicon']) && $attrib['optionsmenuicon'] != 'true') {\n        $inner = html::img(array('src' => $RCMAIL->output->abs_url($attrib['optionsmenuicon'], true), 'alt' => $title));\n    }\n\n    return html::a(array(\n            'href'     => '#list-options',\n            'onclick'  => $onclick,\n            'class'    => 'listmenu',\n            'id'       => 'listmenulink',\n            'title'    => $title,\n            'tabindex' => '0',\n    ), $inner);\n}\n\n/**\n * Return an HTML iframe for loading mail content\n */\nfunction rcmail_messagecontent_frame($attrib)\n{\n    global $OUTPUT;\n\n    if (empty($attrib['id'])) {\n        $attrib['id'] = 'rcmailcontentwindow';\n    }\n\n    return $OUTPUT->frame($attrib, true);\n}\n\nfunction rcmail_messagecount_display($attrib)\n{\n    global $RCMAIL;\n\n    if (!$attrib['id']) {\n        $attrib['id'] = 'rcmcountdisplay';\n    }\n\n    $RCMAIL->output->add_gui_object('countdisplay', $attrib['id']);\n\n    $content =  $RCMAIL->action != 'show' ? rcmail_get_messagecount_text() : $RCMAIL->gettext('loading');\n\n    return html::span($attrib, $content);\n}\n\nfunction rcmail_get_messagecount_text($count = null, $page = null)\n{\n    global $RCMAIL;\n\n    if ($page === null) {\n        $page = $RCMAIL->storage->get_page();\n    }\n\n    $page_size = $RCMAIL->storage->get_pagesize();\n    $start_msg = ($page-1) * $page_size + 1;\n    $max       = $count;\n\n    if ($max === null && $RCMAIL->action) {\n        $max = $RCMAIL->storage->count(null, $RCMAIL->storage->get_threading() ? 'THREADS' : 'ALL');\n    }\n\n    if (!$max) {\n        $out = $RCMAIL->storage->get_search_set() ? $RCMAIL->gettext('nomessages') : $RCMAIL->gettext('mailboxempty');\n    }\n    else {\n        $out = $RCMAIL->gettext(array('name' => $RCMAIL->storage->get_threading() ? 'threadsfromto' : 'messagesfromto',\n            'vars' => array('from'  => $start_msg,\n            'to'    => min($max, $start_msg + $page_size - 1),\n            'count' => $max)));\n    }\n\n    return rcube::Q($out);\n}\n\nfunction rcmail_mailbox_name_display($attrib)\n{\n    global $RCMAIL;\n\n    if (!$attrib['id']) {\n        $attrib['id'] = 'rcmmailboxname';\n    }\n\n    $RCMAIL->output->add_gui_object('mailboxname', $attrib['id']);\n\n    return html::span($attrib, rcmail_get_mailbox_name_text());\n}\n\nfunction rcmail_get_mailbox_name_text()\n{\n    global $RCMAIL;\n    return $RCMAIL->localize_foldername($RCMAIL->output->get_env('mailbox') ?: $RCMAIL->storage->get_folder());\n}\n\nfunction rcmail_send_unread_count($mbox_name, $force=false, $count=null, $mark='')\n{\n    global $RCMAIL;\n\n    $old_unseen = rcmail_get_unseen_count($mbox_name);\n    $unseen     = $count;\n\n    if ($unseen === null) {\n        $unseen = $RCMAIL->storage->count($mbox_name, 'UNSEEN', $force);\n    }\n\n    if ($unseen !== $old_unseen || ($mbox_name == 'INBOX')) {\n        $RCMAIL->output->command('set_unread_count', $mbox_name, $unseen,\n            ($mbox_name == 'INBOX'), $unseen && $mark ? $mark : '');\n    }\n\n    rcmail_set_unseen_count($mbox_name, $unseen);\n\n    return $unseen;\n}\n\nfunction rcmail_set_unseen_count($mbox_name, $count)\n{\n    // @TODO: this data is doubled (session and cache tables) if caching is enabled\n\n    // Make sure we have an array here (#1487066)\n    if (!is_array($_SESSION['unseen_count'])) {\n        $_SESSION['unseen_count'] = array();\n    }\n\n    $_SESSION['unseen_count'][$mbox_name] = $count;\n}\n\nfunction rcmail_get_unseen_count($mbox_name)\n{\n    if (is_array($_SESSION['unseen_count']) && array_key_exists($mbox_name, $_SESSION['unseen_count'])) {\n        return $_SESSION['unseen_count'][$mbox_name];\n    }\n}\n\n/**\n * Sets message is_safe flag according to 'show_images' option value\n *\n * @param object rcube_message Message\n */\nfunction rcmail_check_safe($message)\n{\n    global $RCMAIL;\n\n    if (!$message->is_safe\n        && ($show_images = $RCMAIL->config->get('show_images'))\n        && $message->has_html_part()\n    ) {\n        switch ($show_images) {\n        case 1: // known senders only\n            // get default addressbook, like in addcontact.inc\n            $CONTACTS = $RCMAIL->get_address_book(-1, true);\n\n            if ($CONTACTS && $message->sender['mailto']) {\n                $result = $CONTACTS->search('email', $message->sender['mailto'], 1, false);\n                if ($result->count) {\n                    $message->set_safe(true);\n                }\n            }\n\n            $RCMAIL->plugins->exec_hook('message_check_safe', array('message' => $message));\n            break;\n\n        case 2: // always\n            $message->set_safe(true);\n            break;\n        }\n    }\n\n    return !empty($message->is_safe);\n}\n\n/**\n * Cleans up the given message HTML Body (for displaying)\n *\n * @param string HTML\n * @param array  Display parameters \n * @param array  CID map replaces (inline images)\n * @return string Clean HTML\n */\nfunction rcmail_wash_html($html, $p, $cid_replaces = array())\n{\n    global $REMOTE_OBJECTS;\n\n    $p += array('safe' => false, 'inline_html' => true);\n\n    // charset was converted to UTF-8 in rcube_storage::get_message_part(),\n    // change/add charset specification in HTML accordingly,\n    // washtml cannot work without that\n    $meta = '<meta http-equiv=\"Content-Type\" content=\"text/html; charset='.RCUBE_CHARSET.'\" />';\n\n    // remove old meta tag and add the new one, making sure\n    // that it is placed in the head (#1488093)\n    $html = preg_replace('/<meta[^>]+charset=[a-z0-9-_]+[^>]*>/Ui', '', $html);\n    $html = preg_replace('/(<head[^>]*>)/Ui', '\\\\1'.$meta, $html, -1, $rcount);\n    if (!$rcount) {\n        $html = '<head>' . $meta . '</head>' . $html;\n    }\n\n    // clean HTML with washhtml by Frederic Motte\n    $wash_opts = array(\n        'show_washed'   => false,\n        'allow_remote'  => $p['safe'],\n        'blocked_src'   => 'program/resources/blocked.gif',\n        'charset'       => RCUBE_CHARSET,\n        'cid_map'       => $cid_replaces,\n        'html_elements' => array('body'),\n    );\n\n    if (!$p['inline_html']) {\n        $wash_opts['html_elements'] = array('html','head','title','body');\n    }\n    if ($p['safe']) {\n        $wash_opts['html_elements'][] = 'link';\n        $wash_opts['html_attribs'] = array('rel','type');\n    }\n\n    // overwrite washer options with options from plugins\n    if (isset($p['html_elements']))\n        $wash_opts['html_elements'] = $p['html_elements'];\n    if (isset($p['html_attribs']))\n        $wash_opts['html_attribs'] = $p['html_attribs'];\n\n    // initialize HTML washer\n    $washer = new rcube_washtml($wash_opts);\n\n    if (!$p['skip_washer_form_callback']) {\n        $washer->add_callback('form', 'rcmail_washtml_callback');\n    }\n\n    // allow CSS styles, will be sanitized by rcmail_washtml_callback()\n    if (!$p['skip_washer_style_callback']) {\n        $washer->add_callback('style', 'rcmail_washtml_callback');\n    }\n\n    // modify HTML links to open a new window if clicked\n    if (!$p['skip_washer_link_callback']) {\n        $washer->add_callback('a', 'rcmail_washtml_link_callback');\n        $washer->add_callback('area', 'rcmail_washtml_link_callback');\n\n        if ($p['safe'])\n            $washer->add_callback('link', 'rcmail_washtml_link_callback');\n    }\n\n    // Remove non-UTF8 characters (#1487813)\n    $html = rcube_charset::clean($html);\n\n    $html = $washer->wash($html);\n    $REMOTE_OBJECTS = $washer->extlinks;\n\n    return $html;\n}\n\n/**\n * Convert the given message part to proper HTML\n * which can be displayed the message view\n *\n * @param string             Message part body\n * @param rcube_message_part Message part\n * @param array              Display parameters array\n *\n * @return string Formatted HTML string\n */\nfunction rcmail_print_body($body, $part, $p = array())\n{\n    global $RCMAIL;\n\n    // trigger plugin hook\n    $data = $RCMAIL->plugins->exec_hook('message_part_before',\n        array('type' => $part->ctype_secondary, 'body' => $body, 'id' => $part->mime_id)\n            + $p + array('safe' => false, 'plain' => false, 'inline_html' => true));\n\n    // convert html to text/plain\n    if ($data['plain'] && ($data['type'] == 'html' || $data['type'] == 'enriched')) {\n        if ($data['type'] == 'enriched') {\n            $data['body'] = rcube_enriched::to_html($data['body']);\n        }\n\n        $body = $RCMAIL->html2text($data['body']);\n        $part->ctype_secondary = 'plain';\n    }\n    // text/html\n    else if ($data['type'] == 'html') {\n        $body = rcmail_wash_html($data['body'], $data, $part->replaces);\n        $part->ctype_secondary = $data['type'];\n    }\n    // text/enriched\n    else if ($data['type'] == 'enriched') {\n        $body = rcube_enriched::to_html($data['body']);\n        $body = rcmail_wash_html($body, $data, $part->replaces);\n        $part->ctype_secondary = 'html';\n    }\n    else {\n        // assert plaintext\n        $body = $data['body'];\n        $part->ctype_secondary = $data['type'] = 'plain';\n    }\n\n    // free some memory (hopefully)\n    unset($data['body']);\n\n    // plaintext postprocessing\n    if ($part->ctype_secondary == 'plain') {\n        $flowed = $part->ctype_parameters['format'] == 'flowed';\n        $delsp = $part->ctype_parameters['delsp'] == 'yes';\n        $body = rcmail_plain_body($body, $flowed, $delsp);\n    }\n\n    // allow post-processing of the message body\n    $data = $RCMAIL->plugins->exec_hook('message_part_after',\n        array('type' => $part->ctype_secondary, 'body' => $body, 'id' => $part->mime_id) + $data);\n\n    return $data['body'];\n}\n\n/**\n * Handle links and citation marks in plain text message\n *\n * @param string  Plain text string\n * @param boolean Set to True if the source text is in format=flowed\n *\n * @return string Formatted HTML string\n */\nfunction rcmail_plain_body($body, $flowed = false, $delsp = false)\n{\n    $options   = array('flowed' => $flowed, 'wrap' => !$flowed, 'replacer' => 'rcmail_string_replacer',\n        'delsp' => $delsp);\n    $text2html = new rcube_text2html($body, false, $options);\n    $body      = $text2html->get_html();\n\n    return $body;\n}\n\n/**\n * Callback function for washtml cleaning class\n */\nfunction rcmail_washtml_callback($tagname, $attrib, $content, $washtml)\n{\n    switch ($tagname) {\n    case 'form':\n        $out = html::div('form', $content);\n        break;\n\n    case 'style':\n        // Crazy big styles may freeze the browser (#1490539)\n        // remove content with more than 5k lines\n        if (substr_count($content, \"\\n\") > 5000) {\n            $out = '';\n            break;\n        }\n\n        // decode all escaped entities and reduce to ascii strings\n        $decoded  = rcube_utils::xss_entity_decode($content);\n        $stripped = preg_replace('/[^a-zA-Z\\(:;]/', '', $decoded);\n\n        // now check for evil strings like expression, behavior or url()\n        if (!preg_match('/expression|behavior|javascript:|import[^a]/i', $stripped)) {\n            if (!$washtml->get_config('allow_remote') && preg_match('/url\\((?!data:image)/', $stripped)) {\n                $washtml->extlinks = true;\n            }\n            else {\n                $out = html::tag('style', array('type' => 'text/css'), $decoded);\n            }\n            break;\n        }\n\n    default:\n        $out = '';\n    }\n\n    return $out;\n}\n\n/**\n * return table with message headers\n */\nfunction rcmail_message_headers($attrib, $headers=null)\n{\n    global $MESSAGE, $PRINT_MODE, $RCMAIL;\n    static $sa_attrib;\n\n    // keep header table attrib\n    if (is_array($attrib) && !$sa_attrib && !$attrib['valueof']) {\n        $sa_attrib = $attrib;\n    }\n    else if (!is_array($attrib) && is_array($sa_attrib)) {\n        $attrib = $sa_attrib;\n    }\n\n    if (!isset($MESSAGE)) {\n        return false;\n    }\n\n    // get associative array of headers object\n    if (!$headers) {\n        $headers_obj = $MESSAGE->headers;\n        $headers     = get_object_vars($MESSAGE->headers);\n    }\n    else if (is_object($headers)) {\n        $headers_obj = $headers;\n        $headers     = get_object_vars($headers_obj);\n    }\n    else {\n        $headers_obj = rcube_message_header::from_array($headers);\n    }\n\n    // show these headers\n    $standard_headers = array('subject', 'from', 'sender', 'to', 'cc', 'bcc', 'replyto',\n        'mail-reply-to', 'mail-followup-to', 'date', 'priority');\n    $exclude_headers = $attrib['exclude'] ? explode(',', $attrib['exclude']) : array();\n    $output_headers  = array();\n\n    foreach ($standard_headers as $hkey) {\n        if ($headers[$hkey])\n            $value = $headers[$hkey];\n        else if ($headers['others'][$hkey])\n            $value = $headers['others'][$hkey];\n        else if (!$attrib['valueof'])\n            continue;\n\n        if (in_array($hkey, $exclude_headers))\n            continue;\n\n        $ishtml       = false;\n        $header_title = $RCMAIL->gettext(preg_replace('/(^mail-|-)/', '', $hkey));\n\n        if ($hkey == 'date') {\n            if ($PRINT_MODE)\n                $header_value = $RCMAIL->format_date($value, $RCMAIL->config->get('date_long', 'x'));\n            else\n                $header_value = $RCMAIL->format_date($value);\n        }\n        else if ($hkey == 'priority') {\n            if ($value) {\n                $header_value = html::span('prio' . $value, rcube::Q(rcmail_localized_priority($value)));\n                $ishtml       = true;\n            }\n            else {\n                continue;\n            }\n        }\n        else if ($hkey == 'replyto') {\n            if ($headers['replyto'] != $headers['from']) {\n                $header_value = rcmail_address_string($value, $attrib['max'], true,\n                    $attrib['addicon'], $headers['charset'], $header_title);\n                $ishtml = true;\n            }\n            else {\n                continue;\n            }\n        }\n        else if ($hkey == 'mail-reply-to') {\n            if ($headers['mail-replyto'] != $headers['replyto']\n                && $headers['replyto'] != $headers['from']\n            ) {\n                $header_value = rcmail_address_string($value, $attrib['max'], true,\n                    $attrib['addicon'], $headers['charset'], $header_title);\n                $ishtml = true;\n            }\n            else {\n                continue;\n            }\n        }\n        else if ($hkey == 'sender') {\n            if ($headers['sender'] != $headers['from']) {\n                $header_value = rcmail_address_string($value, $attrib['max'], true,\n                    $attrib['addicon'], $headers['charset'], $header_title);\n                $ishtml = true;\n            }\n            else {\n                continue;\n            }\n        }\n        else if ($hkey == 'mail-followup-to') {\n            $header_value = rcmail_address_string($value, $attrib['max'], true,\n                $attrib['addicon'], $headers['charset'], $header_title);\n            $ishtml = true;\n        }\n        else if (in_array($hkey, array('from', 'to', 'cc', 'bcc'))) {\n            $header_value = rcmail_address_string($value, $attrib['max'], true,\n                $attrib['addicon'], $headers['charset'], $header_title);\n            $ishtml = true;\n        }\n        else if ($hkey == 'subject' && empty($value)) {\n            $header_value = $RCMAIL->gettext('nosubject');\n        }\n        else {\n            $value        = is_array($value) ? implode(' ', $value) : $value;\n            $header_value = trim(rcube_mime::decode_header($value, $headers['charset']));\n        }\n\n        $output_headers[$hkey] = array(\n            'title' => $header_title,\n            'value' => $header_value,\n            'raw'   => $value,\n            'html'  => $ishtml,\n        );\n    }\n\n    $plugin = $RCMAIL->plugins->exec_hook('message_headers_output', array(\n        'output'  => $output_headers,\n        'headers' => $headers_obj,\n        'exclude' => $exclude_headers, // readonly\n        'folder'  => $MESSAGE->folder, // readonly\n        'uid'     => $MESSAGE->uid,    // readonly\n    ));\n\n    // single header value is requested\n    if (!empty($attrib['valueof'])) {\n        $row = $plugin['output'][$attrib['valueof']];\n        return $row['html'] ? $row['value'] : rcube::Q($row['value']);\n    }\n\n    // compose html table\n    $table = new html_table(array('cols' => 2));\n\n    foreach ($plugin['output'] as $hkey => $row) {\n        $val = $row['html'] ? $row['value'] : rcube::Q($row['value']);\n\n        $table->add(array('class' => 'header-title'), rcube::Q($row['title']));\n        $table->add(array('class' => 'header '.$hkey), $val);\n    }\n\n    return $table->show($attrib);\n}\n\n/**\n * Convert Priority header value into a localized string\n */\nfunction rcmail_localized_priority($value)\n{\n    global $RCMAIL;\n\n    $labels_map = array(\n        '1' => 'highest',\n        '2' => 'high',\n        '3' => 'normal',\n        '4' => 'low',\n        '5' => 'lowest',\n    );\n\n    if ($value && $labels_map[$value]) {\n        return $RCMAIL->gettext($labels_map[$value]);\n    }\n\n    return '';\n}\n\n/**\n * return block to show full message headers\n */\nfunction rcmail_message_full_headers($attrib)\n{\n    global $OUTPUT, $RCMAIL;\n\n    $html = html::div(array('id' => \"all-headers\", 'class' => \"all\", 'style' => 'display:none'), html::div(array('id' => 'headers-source'), ''));\n    $html .= html::div(array(\n            'class'   => \"more-headers show-headers\",\n            'onclick' => \"return \".rcmail_output::JS_OBJECT_NAME.\".command('show-headers','',this)\",\n            'title'   => $RCMAIL->gettext('togglefullheaders')\n        ), '');\n\n    $OUTPUT->add_gui_object('all_headers_row', 'all-headers');\n    $OUTPUT->add_gui_object('all_headers_box', 'headers-source');\n\n    return html::div($attrib, $html);\n}\n\n/**\n * Handler for the 'messagebody' GUI object\n *\n * @param array Named parameters\n * @return string HTML content showing the message body\n */\nfunction rcmail_message_body($attrib)\n{\n    global $OUTPUT, $MESSAGE, $RCMAIL, $REMOTE_OBJECTS;\n\n    if (!is_array($MESSAGE->parts) && empty($MESSAGE->body)) {\n        return '';\n    }\n\n    if (!$attrib['id'])\n        $attrib['id'] = 'rcmailMsgBody';\n\n    $safe_mode = $MESSAGE->is_safe || intval($_GET['_safe']);\n    $out       = '';\n    $part_no   = 0;\n    $token     = $RCMAIL->get_request_token();\n\n    $header_attrib = array();\n    foreach ($attrib as $attr => $value) {\n        if (preg_match('/^headertable([a-z]+)$/i', $attr, $regs)) {\n            $header_attrib[$regs[1]] = $value;\n        }\n    }\n\n    if (!empty($MESSAGE->parts)) {\n        foreach ($MESSAGE->parts as $part) {\n            if ($part->type == 'headers') {\n                $out .= html::div('message-partheaders', rcmail_message_headers(count($header_attrib) ? $header_attrib : null, $part->headers));\n            }\n            else if ($part->type == 'content') {\n                // unsupported (e.g. encrypted)\n                if ($part->realtype) {\n                    if ($part->realtype == 'multipart/encrypted' || $part->realtype == 'application/pkcs7-mime') {\n                        if (!empty($_SESSION['browser_caps']['pgpmime']) && ($pgp_mime_part = $MESSAGE->get_multipart_encrypted_part())) {\n                            $out .= html::span('part-notice', $RCMAIL->gettext('externalmessagedecryption'));\n                            $OUTPUT->set_env('pgp_mime_part', $pgp_mime_part->mime_id);\n                            $OUTPUT->set_env('pgp_mime_container', '#' . $attrib['id']);\n                            $OUTPUT->add_label('loadingdata');\n                        }\n\n                        if (!$MESSAGE->encrypted_part) {\n                            $out .= html::span('part-notice', $RCMAIL->gettext('encryptedmessage'));\n                        }\n                    }\n                    continue;\n                }\n                else if (!$part->size) {\n                    continue;\n                }\n                // Check if we have enough memory to handle the message in it\n                // #1487424: we need up to 10x more memory than the body\n                else if (!rcube_utils::mem_check($part->size * 10)) {\n                    $out .= html::span('part-notice', $RCMAIL->gettext('messagetoobig'). ' '\n                        . html::a('?_task=mail&_action=get&_download=1&_uid='.$MESSAGE->uid.'&_part='.$part->mime_id.'&_token='.$token\n                            .'&_mbox='. urlencode($MESSAGE->folder), $RCMAIL->gettext('download')));\n                    continue;\n                }\n\n                // fetch part body\n                $body = $MESSAGE->get_part_body($part->mime_id, true);\n\n                // message is cached but not exists (#1485443), or other error\n                if ($body === false) {\n                    rcmail_message_error($MESSAGE->uid);\n                }\n\n                $plugin = $RCMAIL->plugins->exec_hook('message_body_prefix',\n                    array('part' => $part, 'prefix' => ''));\n\n                // Set attributes of the part container\n                $container_class  = $part->ctype_secondary == 'html' ? 'message-htmlpart' : 'message-part';\n                $container_id     = $container_class . (++$part_no);\n                $container_attrib = array('class' => $container_class, 'id' => $container_id);\n\n                // Assign container ID to a global variable for use in rcmail_washtml_link_callback()\n                $GLOBALS['rcmail_html_container_id'] = $container_id;\n\n                // Parse the part content for display\n                $body = rcmail_print_body($body, $part, array('safe' => $safe_mode, 'plain' => !$RCMAIL->config->get('prefer_html')));\n\n                // check if the message body is PGP encrypted\n                if (strpos($body, '-----BEGIN PGP MESSAGE-----') !== false) {\n                    $OUTPUT->set_env('is_pgp_content', '#' . $container_id);\n                }\n\n                if ($part->ctype_secondary == 'html') {\n                    $body = rcmail_html4inline($body, $container_id, 'rcmBody', $container_attrib, $safe_mode);\n                }\n\n                $out .= html::div($container_attrib, $plugin['prefix'] . $body);\n            }\n        }\n    }\n    else {\n        // Check if we have enough memory to handle the message in it\n        // #1487424: we need up to 10x more memory than the body\n        if (!rcube_utils::mem_check(strlen($MESSAGE->body) * 10)) {\n            $out .= html::span('part-notice', $RCMAIL->gettext('messagetoobig'). ' '\n                . html::a('?_task=mail&_action=get&_download=1&_uid='.$MESSAGE->uid.'&_part=0&_token='.$token\n                    .'&_mbox='. urlencode($MESSAGE->folder), $RCMAIL->gettext('download')));\n        }\n        else {\n            $plugin = $RCMAIL->plugins->exec_hook('message_body_prefix',\n                array('part' => $MESSAGE, 'prefix' => ''));\n\n            $out .= html::div('message-part',\n                $plugin['prefix'] . rcmail_plain_body($MESSAGE->body));\n        }\n    }\n\n    // list images after mail body\n    if ($RCMAIL->config->get('inline_images', true) && !empty($MESSAGE->attachments)) {\n        $thumbnail_size   = $RCMAIL->config->get('image_thumbnail_size', 240);\n        $client_mimetypes = (array)$RCMAIL->config->get('client_mimetypes');\n\n        foreach ($MESSAGE->attachments as $attach_prop) {\n            // skip inline images\n            if ($attach_prop->content_id && $attach_prop->disposition == 'inline') {\n                continue;\n            }\n\n            // Content-Type: image/*...\n            if ($mimetype = rcmail_part_image_type($attach_prop)) {\n                // display thumbnails\n                if ($thumbnail_size) {\n                    $supported = in_array($mimetype, $client_mimetypes);\n                    $show_link = array(\n                        'href'    => $MESSAGE->get_part_url($attach_prop->mime_id, false),\n                        'onclick' => sprintf(\n                            'return %s.command(\\'load-attachment\\',\\'%s\\',this)',\n                            rcmail_output::JS_OBJECT_NAME,\n                            $attach_prop->mime_id)\n                    );\n\n                    $out .= html::p(array('class' => 'image-attachment', 'style' => $supported ? '' : 'display:none'),\n                        html::a($show_link + array('class' => 'image-link', 'style' => sprintf('width:%dpx', $thumbnail_size)),\n                            html::img(array(\n                                'class' => 'image-thumbnail',\n                                'src'   => $MESSAGE->get_part_url($attach_prop->mime_id, 'image') . '&_thumb=1',\n                                'title' => $attach_prop->filename,\n                                'alt'   => $attach_prop->filename,\n                                'style' => sprintf('max-width:%dpx; max-height:%dpx', $thumbnail_size, $thumbnail_size),\n                                'onload' => $supported ? '' : '$(this).parents(\\'p.image-attachment\\').show()',\n                            ))\n                        ) .\n                        html::span('image-filename', rcube::Q($attach_prop->filename)) .\n                        html::span('image-filesize', rcube::Q($RCMAIL->message_part_size($attach_prop))) .\n                        html::span('attachment-links',\n                            ($supported ? html::a($show_link, $RCMAIL->gettext('showattachment')) . '&nbsp;' : '') .\n                                html::a($show_link['href'] . '&_download=1', $RCMAIL->gettext('download'))\n                        ) .\n                        html::br(array('style' => 'clear:both'))\n                    );\n                }\n                else {\n                    $out .= html::tag('fieldset', 'image-attachment',\n                        html::tag('legend', 'image-filename', rcube::Q($attach_prop->filename)) .\n                        html::p(array('align' => 'center'),\n                            html::img(array(\n                                'src'   => $MESSAGE->get_part_url($attach_prop->mime_id, 'image'),\n                                'title' => $attach_prop->filename,\n                                'alt'   => $attach_prop->filename,\n                        )))\n                    );\n                }\n            }\n        }\n    }\n\n    // tell client that there are blocked remote objects\n    if ($REMOTE_OBJECTS && !$safe_mode) {\n        $OUTPUT->set_env('blockedobjects', true);\n    }\n\n    return html::div($attrib, $out);\n}\n\nfunction rcmail_part_image_type($part)\n{\n    $mimetype = strtolower($part->mimetype);\n\n    // Skip TIFF/WEBP images if browser doesn't support this format\n    // ...until we can convert them to JPEG\n    $tiff_support = !empty($_SESSION['browser_caps']) && !empty($_SESSION['browser_caps']['tiff']);\n    $tiff_support = $tiff_support || rcube_image::is_convertable('image/tiff');\n    $webp_support = !empty($_SESSION['browser_caps']) && !empty($_SESSION['browser_caps']['webp']);\n    $webp_support = $webp_support || rcube_image::is_convertable('image/webp');\n\n    if ((!$tiff_support && $mimetype == 'image/tiff') || (!$webp_support && $mimetype == 'image/webp')) {\n        return;\n    }\n\n    // Content-Type: image/*...\n    if (strpos($mimetype, 'image/') === 0) {\n        return rcmail_fix_mimetype($mimetype);\n    }\n\n    // Many clients use application/octet-stream, we'll detect mimetype\n    // by checking filename extension\n\n    // Supported image filename extensions to image type map\n    $types = array(\n        'jpg'  => 'image/jpeg',\n        'jpeg' => 'image/jpeg',\n        'png'  => 'image/png',\n        'gif'  => 'image/gif',\n        'bmp'  => 'image/bmp',\n    );\n    if ($tiff_support) {\n        $types['tif']  = 'image/tiff';\n        $types['tiff'] = 'image/tiff';\n    }\n    if ($webp_support) {\n        $types['webp'] = 'image/webp';\n    }\n\n    if ($part->filename\n        && $mimetype == 'application/octet-stream'\n        && preg_match('/\\.([^.]+)$/i', $part->filename, $m)\n        && ($extension = strtolower($m[1]))\n        && isset($types[$extension])\n    ) {\n        return $types[$extension];\n    }\n}\n\n/**\n * Modify a HTML message that it can be displayed inside a HTML page\n */\nfunction rcmail_html4inline($body, $container_id, $body_class='', &$attributes=array(), $allow_remote=false)\n{\n    $last_style_pos = 0;\n    $cont_id        = $container_id . ($body_class ? ' div.'.$body_class : '');\n\n    // find STYLE tags\n    while (($pos = stripos($body, '<style', $last_style_pos)) && ($pos2 = stripos($body, '</style>', $pos))) {\n        $pos = strpos($body, '>', $pos) + 1;\n        $len = $pos2 - $pos;\n\n        // replace all css definitions with #container [def]\n        $styles = substr($body, $pos, $len);\n        $styles = rcube_utils::mod_css_styles($styles, $cont_id, $allow_remote);\n\n        $body = substr_replace($body, $styles, $pos, $len);\n        $last_style_pos = $pos2 + strlen($styles) - $len;\n    }\n\n    $body = preg_replace(array(\n            // add comments around html and other tags\n            '/(<!DOCTYPE[^>]*>)/i',\n            '/(<\\?xml[^>]*>)/i',\n            '/(<\\/?html[^>]*>)/i',\n            '/(<\\/?head[^>]*>)/i',\n            '/(<title[^>]*>.*<\\/title>)/Ui',\n            '/(<\\/?meta[^>]*>)/i',\n            // quote <? of php and xml files that are specified as text/html\n            '/<\\?/',\n            '/\\?>/',\n            // replace <body> with <div>\n            '/<body([^>]*)>/i',\n            '/<\\/body>/i',\n        ),\n        array(\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '<!--\\\\1-->',\n            '&lt;?',\n            '?&gt;',\n            '<div class=\"' . $body_class . '\"\\\\1>',\n            '</div>',\n        ),\n        $body);\n\n    // Handle body attributes that doesn't play nicely with div elements\n    $regexp = '/<div class=\"' . preg_quote($body_class, '/') . '\"([^>]*)/';\n    if (preg_match($regexp, $body, $m)) {\n        $style = array();\n        $attrs = $m[0];\n\n        // Get bgcolor, we'll set it as background-color of the message container\n        if ($m[1] && preg_match('/bgcolor=[\"\\']*([a-z0-9#]+)[\"\\']*/i', $attrs, $mb)) {\n            $style['background-color'] = $mb[1];\n            $attrs = preg_replace('/bgcolor=[\"\\']*[a-z0-9#]+[\"\\']*/i', '', $attrs);\n        }\n\n        // Get background, we'll set it as background-image of the message container\n        if ($m[1] && preg_match('/background=[\"\\']*([^\"\\'>\\s]+)[\"\\']*/', $attrs, $mb)) {\n            $style['background-image'] = 'url('.$mb[1].')';\n            $attrs = preg_replace('/background=[\"\\']*([^\"\\'>\\s]+)[\"\\']*/', '', $attrs);\n        }\n\n        if (!empty($style)) {\n            $body = preg_replace($regexp, rtrim($attrs), $body, 1);\n        }\n\n        // handle body styles related to background image\n        if ($style['background-image']) {\n            // get body style\n            if (preg_match('/#'.preg_quote($cont_id, '/').'\\s+\\{([^}]+)}/i', $body, $m)) {\n                // get background related style\n                $regexp = '/(background-position|background-repeat)\\s*:\\s*([^;]+);/i';\n                if (preg_match_all($regexp, $m[1], $matches, PREG_SET_ORDER)) {\n                    foreach ($matches as $m) {\n                        $style[$m[1]] = $m[2];\n                    }\n                }\n            }\n        }\n\n        if (!empty($style)) {\n            foreach ($style as $idx => $val) {\n                $style[$idx] = $idx . ': ' . $val;\n            }\n\n            $attributes['style'] = implode('; ', $style);\n        }\n    }\n    // make sure there's 'rcmBody' div, we need it for proper css modification\n    // its name is hardcoded in rcmail_message_body() also\n    else {\n        $body = '<div class=\"' . $body_class . '\">' . $body . '</div>';\n    }\n\n    return $body;\n}\n\n/**\n * Parse link (a, link, area) attributes and set correct target\n */\nfunction rcmail_washtml_link_callback($tag, $attribs, $content, $washtml)\n{\n    global $RCMAIL;\n\n    $attrib = html::parse_attrib_string($attribs);\n\n    // Remove non-printable characters in URL (#1487805)\n    if ($attrib['href']) {\n        $attrib['href'] = preg_replace('/[\\x00-\\x1F]/', '', $attrib['href']);\n    }\n\n    if ($tag == 'link' && preg_match('/^https?:\\/\\//i', $attrib['href'])) {\n        $tempurl = 'tmp-' . md5($attrib['href']) . '.css';\n        $_SESSION['modcssurls'][$tempurl] = $attrib['href'];\n        $attrib['href'] = $RCMAIL->url(array('task' => 'utils', 'action' => 'modcss', 'u' => $tempurl, 'c' => $GLOBALS['rcmail_html_container_id']));\n        $end = ' />';\n    }\n    else if (preg_match('/^mailto:(.+)/i', $attrib['href'], $mailto)) {\n        list($mailto, $url) = explode('?', html_entity_decode($mailto[1], ENT_QUOTES, 'UTF-8'), 2);\n\n        // #6020: use raw encoding for correct \"+\" character handling as specified in RFC6068\n        $url       = rawurldecode($url);\n        $mailto    = rawurldecode($mailto);\n        $addresses = rcube_mime::decode_address_list($mailto, null, true);\n        $mailto    = array();\n\n        // do sanity checks on recipients\n        foreach ($addresses as $idx => $addr) {\n            if (rcube_utils::check_email($addr['mailto'], false)) {\n                $addresses[$idx] = $addr['mailto'];\n                $mailto[]        = $addr['string'];\n            }\n            else {\n                unset($addresses[$idx]);\n            }\n        }\n\n        if (!empty($addresses)) {\n            $attrib['href']    = 'mailto:' . implode(',', $addresses);\n            $attrib['onclick'] = sprintf(\n                \"return %s.command('compose','%s',this)\",\n                rcmail_output::JS_OBJECT_NAME,\n                rcube::JQ(implode(',', $mailto) . ($url ? \"?$url\" : '')));\n        }\n        else {\n            $attrib['href']    = '#NOP';\n            $attrib['onclick'] = '';\n        }\n    }\n    else if (empty($attrib['href']) && !isset($attrib['name'])) {\n        $attrib['href']    = './#NOP';\n        $attrib['onclick'] = 'return false';\n    }\n    else if (!empty($attrib['href']) && $attrib['href'][0] != '#') {\n        $attrib['target'] = '_blank';\n    }\n\n    // Better security by adding rel=\"noreferrer\" (#1484686)\n    if (($tag == 'a' || $tag == 'area') && $attrib['href'] && $attrib['href'][0] != '#') {\n        $attrib['rel'] = 'noreferrer';\n    }\n\n    // allowed attributes for a|link|area tags\n    $allow = array('href','name','target','onclick','id','class','style','title',\n        'rel','type','media','alt','coords','nohref','hreflang','shape');\n\n    return html::tag($tag, $attrib, $content, $allow);\n}\n\n/**\n * Decode address string and re-format it as HTML links\n */\nfunction rcmail_address_string($input, $max=null, $linked=false, $addicon=null, $default_charset=null, $title=null)\n{\n    global $RCMAIL, $PRINT_MODE;\n\n    $a_parts = rcube_mime::decode_address_list($input, null, true, $default_charset);\n\n    if (!count($a_parts)) {\n        return $input;\n    }\n\n    $c   = count($a_parts);\n    $j   = 0;\n    $out = '';\n    $allvalues  = array();\n    $show_email = $RCMAIL->config->get('message_show_email');\n\n    if ($addicon && !isset($_SESSION['writeable_abook'])) {\n        $_SESSION['writeable_abook'] = $RCMAIL->get_address_sources(true) ? true : false;\n    }\n\n    foreach ($a_parts as $part) {\n        $j++;\n\n        $name   = $part['name'];\n        $mailto = $part['mailto'];\n        $string = $part['string'];\n        $valid  = rcube_utils::check_email($mailto, false);\n\n        // phishing email prevention (#1488981), e.g. \"valid@email.addr <phishing@email.addr>\"\n        if (!$show_email && $valid && $name && $name != $mailto && strpos($name, '@')) {\n            $name = '';\n        }\n\n        // IDNA ASCII to Unicode\n        if ($name == $mailto)\n            $name = rcube_utils::idn_to_utf8($name);\n        if ($string == $mailto)\n            $string = rcube_utils::idn_to_utf8($string);\n        $mailto = rcube_utils::idn_to_utf8($mailto);\n\n        if ($PRINT_MODE) {\n            $address = sprintf('%s &lt;%s&gt;', rcube::Q($name), rcube::Q($mailto));\n        }\n        else if ($valid) {\n            if ($linked) {\n                $attrs = array(\n                    'href'    => 'mailto:' . $mailto,\n                    'class'   => 'rcmContactAddress',\n                    'onclick' => sprintf(\"return %s.command('compose','%s',this)\",\n                        rcmail_output::JS_OBJECT_NAME, rcube::JQ(format_email_recipient($mailto, $name))),\n                );\n\n                if ($show_email && $name && $mailto) {\n                    $content = rcube::Q($name ? sprintf('%s <%s>', $name, $mailto) : $mailto);\n                }\n                else {\n                    $content = rcube::Q($name ?: $mailto);\n                    $attrs['title'] = $mailto;\n                }\n\n                $address = html::a($attrs, $content);\n            }\n            else {\n                $address = html::span(array('title' => $mailto, 'class' => \"rcmContactAddress\"),\n                    rcube::Q($name ?: $mailto));\n            }\n\n            if ($addicon && $_SESSION['writeable_abook']) {\n                $address .= html::a(array(\n                        'href'    => \"#add\",\n                        'title'   => $RCMAIL->gettext('addtoaddressbook'),\n                        'class'   => 'rcmaddcontact',\n                        'onclick' => sprintf(\"return %s.command('add-contact','%s',this)\",\n                            rcmail_output::JS_OBJECT_NAME, rcube::JQ($string)),\n                    ),\n                    html::img(array(\n                        'src'   => $RCMAIL->output->abs_url($addicon, true),\n                        'alt'   => \"Add contact\",\n                        'class' => 'noselect',\n                )));\n            }\n        }\n        else {\n            $address = $name ? rcube::Q($name) : '';\n            if ($mailto) {\n                $address = trim($address . ' ' . rcube::Q($name ? sprintf('<%s>', $mailto) : $mailto));\n            }\n        }\n\n        $address = html::span('adr', $address);\n        $allvalues[] = $address;\n\n        if (!$moreadrs) {\n            $out .= ($out ? ', ' : '') . $address;\n        }\n\n        if ($max && $j == $max && $c > $j) {\n            if ($linked) {\n                $moreadrs = $c - $j;\n            }\n            else {\n                $out .= '...';\n                break;\n            }\n        }\n    }\n\n    if ($moreadrs) {\n        $label = rcube::Q($RCMAIL->gettext(array('name' => 'andnmore', 'vars' => array('nr' => $moreadrs))));\n\n        if ($PRINT_MODE) {\n            $out .= ' ' . html::a(array(\n                    'href'    => '#more',\n                    'class'   => 'morelink',\n                    'onclick' => '$(this).hide().next().show()',\n                ), $label)\n                . html::span(array('style' => 'display:none'), join(', ', $allvalues));\n        }\n        else {\n            $out .= ' ' . html::a(array(\n                    'href'    => '#more',\n                    'class'   => 'morelink',\n                    'onclick' => sprintf(\"return %s.show_popup_dialog('%s','%s')\",\n                        rcmail_output::JS_OBJECT_NAME,\n                        rcube::JQ(join(', ', $allvalues)),\n                        rcube::JQ($title))\n                ), $label);\n        }\n    }\n\n    return $out;\n}\n\n/**\n * Wrap text to a given number of characters per line\n * but respect the mail quotation of replies messages (>).\n * Finally add another quotation level by prepending the lines\n * with >\n *\n * @param string Text to wrap\n * @param int    The line width\n * @return string The wrapped text\n */\nfunction rcmail_wrap_and_quote($text, $length = 72)\n{\n    // Rebuild the message body with a maximum of $max chars, while keeping quoted message.\n    $max   = max(75, $length + 8);\n    $lines = preg_split('/\\r?\\n/', trim($text));\n    $out   = '';\n\n    foreach ($lines as $line) {\n        // don't wrap already quoted lines\n        if ($line[0] == '>') {\n            $line = '>' . rtrim($line);\n        }\n        else if (mb_strlen($line) > $max) {\n            $newline = '';\n\n            foreach (explode(\"\\n\", rcube_mime::wordwrap($line, $length - 2)) as $l) {\n                $newline .= strlen($l) ? \"> $l\\n\" : \">\\n\";\n            }\n\n            $line = rtrim($newline);\n        }\n        else {\n            $line = '> ' . $line;\n        }\n\n        // Append the line\n        $out .= $line . \"\\n\";\n    }\n\n    return rtrim($out, \"\\n\");\n}\n\nfunction rcmail_draftinfo_encode($p)\n{\n    $parts = array();\n    foreach ($p as $key => $val) {\n        $encode  = $key == 'folder' || strpos($val, ';') !== false;\n        $parts[] = $key . '=' . ($encode ? 'B::' . base64_encode($val) : $val);\n    }\n\n    return join('; ', $parts);\n}\n\nfunction rcmail_draftinfo_decode($str)\n{\n    $info = array();\n\n    foreach (preg_split('/;\\s+/', $str) as $part) {\n        list($key, $val) = explode('=', $part, 2);\n        if (strpos($val, 'B::') === 0) {\n            $val = base64_decode(substr($val, 3));\n        }\n        else if ($key == 'folder') {\n            $val = base64_decode($val);\n        }\n\n        $info[$key] = $val;\n    }\n\n    return $info;\n}\n\n/**\n * Send the MDN response\n *\n * @param mixed $message    Original message object (rcube_message) or UID\n * @param array $smtp_error SMTP error array (reference)\n *\n * @return boolean Send status\n */\nfunction rcmail_send_mdn($message, &$smtp_error)\n{\n    global $RCMAIL;\n\n    if (!is_object($message) || !is_a($message, 'rcube_message')) {\n        $message = new rcube_message($message);\n    }\n\n    if ($message->headers->mdn_to && empty($message->headers->flags['MDNSENT']) &&\n        ($RCMAIL->storage->check_permflag('MDNSENT') || $RCMAIL->storage->check_permflag('*'))\n    ) {\n        $identity  = rcmail_identity_select($message);\n        $sender    = format_email_recipient($identity['email'], $identity['name']);\n        $recipient = array_shift(rcube_mime::decode_address_list(\n            $message->headers->mdn_to, 1, true, $message->headers->charset));\n        $mailto    = $recipient['mailto'];\n\n        $compose = new Mail_mime(\"\\r\\n\");\n\n        $compose->setParam('text_encoding', 'quoted-printable');\n        $compose->setParam('html_encoding', 'quoted-printable');\n        $compose->setParam('head_encoding', 'quoted-printable');\n        $compose->setParam('head_charset', RCUBE_CHARSET);\n        $compose->setParam('html_charset', RCUBE_CHARSET);\n        $compose->setParam('text_charset', RCUBE_CHARSET);\n\n        // compose headers array\n        $headers = array(\n            'Date'       => $RCMAIL->user_date(),\n            'From'       => $sender,\n            'To'         => $message->headers->mdn_to,\n            'Subject'    => $RCMAIL->gettext('receiptread') . ': ' . $message->subject,\n            'Message-ID' => $RCMAIL->gen_message_id($identity['email']),\n            'X-Sender'   => $identity['email'],\n            'References' => trim($message->headers->references . ' ' . $message->headers->messageID),\n            'In-Reply-To' => $message->headers->messageID,\n        );\n\n        $report = \"Final-Recipient: rfc822; {$identity['email']}\\r\\n\"\n            . \"Original-Message-ID: {$message->headers->messageID}\\r\\n\"\n            . \"Disposition: manual-action/MDN-sent-manually; displayed\\r\\n\";\n\n        if ($message->headers->to) {\n            $report .= \"Original-Recipient: {$message->headers->to}\\r\\n\";\n        }\n\n        if ($agent = $RCMAIL->config->get('useragent')) {\n            $headers['User-Agent'] = $agent;\n            $report .= \"Reporting-UA: $agent\\r\\n\";\n        }\n\n        $to   = rcube_mime::decode_mime_string($message->headers->to, $message->headers->charset);\n        $date = $RCMAIL->format_date($message->headers->date, $RCMAIL->config->get('date_long'));\n        $body = $RCMAIL->gettext(\"yourmessage\") . \"\\r\\n\\r\\n\" .\n            \"\\t\" . $RCMAIL->gettext(\"to\") . \": {$to}\\r\\n\" .\n            \"\\t\" . $RCMAIL->gettext(\"subject\") . \": {$message->subject}\\r\\n\" .\n            \"\\t\" . $RCMAIL->gettext(\"date\") . \": {$date}\\r\\n\" .\n            \"\\r\\n\" . $RCMAIL->gettext(\"receiptnote\");\n\n        $compose->headers(array_filter($headers));\n        $compose->setContentType('multipart/report', array('report-type'=> 'disposition-notification'));\n        $compose->setTXTBody(rcube_mime::wordwrap($body, 75, \"\\r\\n\"));\n        $compose->addAttachment($report, 'message/disposition-notification', 'MDNPart2.txt', false, '7bit', 'inline');\n\n        // SMTP options\n        $options = array('mdn_use_from' => (bool) $RCMAIL->config->get('mdn_use_from'));\n\n        $sent = $RCMAIL->deliver_message($compose, $identity['email'], $mailto, $smtp_error, $body_file, $options, true);\n\n        if ($sent) {\n            $RCMAIL->storage->set_flag($message->uid, 'MDNSENT');\n            return true;\n        }\n    }\n\n    return false;\n}\n\n/**\n * Detect recipient identity from specified message\n */\nfunction rcmail_identity_select($MESSAGE, $identities = null, $compose_mode = 'reply')\n{\n    $a_recipients = array();\n    $a_names      = array();\n\n    if ($identities === null) {\n        $identities = rcmail::get_instance()->user->list_identities(null, true);\n    }\n\n    // extract all recipients of the reply-message\n    if (is_object($MESSAGE->headers) && in_array($compose_mode, array('reply', 'forward'))) {\n        $a_to = rcube_mime::decode_address_list($MESSAGE->headers->to, null, true, $MESSAGE->headers->charset);\n        foreach ($a_to as $addr) {\n            if (!empty($addr['mailto'])) {\n                $a_recipients[] = strtolower($addr['mailto']);\n                $a_names[]      = $addr['name'];\n            }\n        }\n\n        if (!empty($MESSAGE->headers->cc)) {\n            $a_cc = rcube_mime::decode_address_list($MESSAGE->headers->cc, null, true, $MESSAGE->headers->charset);\n            foreach ($a_cc as $addr) {\n                if (!empty($addr['mailto'])) {\n                    $a_recipients[] = strtolower($addr['mailto']);\n                    $a_names[]      = $addr['name'];\n                }\n            }\n        }\n    }\n\n    // decode From: address\n    $from = rcube_mime::decode_address_list($MESSAGE->headers->from, null, true, $MESSAGE->headers->charset);\n    $from = array_shift($from);\n    $from['mailto'] = strtolower($from['mailto']);\n\n    $from_idx   = null;\n    $found_idx  = array('to' => null, 'from' => null);\n    $check_from = in_array($compose_mode, array('draft', 'edit', 'reply'));\n\n    // Select identity\n    foreach ($identities as $idx => $ident) {\n        // use From: header when in edit/draft or reply-to-self\n        if ($check_from && $from['mailto'] == strtolower($ident['email_ascii'])) {\n            // remember first matching identity address\n            if ($found_idx['from'] === null) {\n                $found_idx['from'] = $idx;\n            }\n            // match identity name\n            if ($from['name'] && $ident['name'] && $from['name'] == $ident['name']) {\n                $from_idx = $idx;\n                break;\n            }\n        }\n        // use replied/forwarded message recipients\n        else if (($found = array_search(strtolower($ident['email_ascii']), $a_recipients)) !== false) {\n            // remember first matching identity address\n            if ($found_idx['to'] === null) {\n                $found_idx['to'] = $idx;\n            }\n            // match identity name\n            if ($a_names[$found] && $ident['name'] && $a_names[$found] == $ident['name']) {\n                $from_idx = $idx;\n                break;\n            }\n        }\n    }\n\n    // If matching by name+address didn't find any matches,\n    // get first found identity (address) if any\n    if ($from_idx === null) {\n        $from_idx = $found_idx['from'] !== null ? $found_idx['from'] : $found_idx['to'];\n    }\n\n    // Try Return-Path\n    if ($from_idx === null && ($return_path = $MESSAGE->headers->others['return-path'])) {\n        $return_path = array_map('strtolower', (array) $return_path);\n\n        foreach ($identities as $idx => $ident) {\n            // Return-Path header contains an email address, but on some mailing list\n            // it can be e.g. <pear-dev-return-55250-local=domain.tld@lists.php.net>\n            // where local@domain.tld is the address we're looking for (#1489241)\n            $ident1 = strtolower($ident['email_ascii']);\n            $ident2 = str_replace('@', '=', $ident1);\n            $ident1 = '<' . $ident1 . '>';\n            $ident2 = '-' . $ident2 . '@';\n\n            foreach ($return_path as $path) {\n                if ($path == $ident1 || stripos($path, $ident2)) {\n                    $from_idx = $idx;\n                    break 2;\n                }\n            }\n        }\n    }\n\n    // See identity_select plugin for example usage of this hook\n    $plugin = rcmail::get_instance()->plugins->exec_hook('identity_select',\n        array('message' => $MESSAGE, 'identities' => $identities, 'selected' => $from_idx));\n\n    $selected = $plugin['selected'];\n\n    // default identity is always first on the list\n    return $identities[$selected !== null ? $selected : 0];\n}\n\n// Fixes some content-type names\nfunction rcmail_fix_mimetype($name)\n{\n    $map = array(\n        'image/x-ms-bmp' => 'image/bmp', // #1490282\n    );\n\n    $name = strtolower($name);\n\n    if ($alias = $map[$name]) {\n        $name = $alias;\n    }\n    // Some versions of Outlook create garbage Content-Type:\n    // application/pdf.A520491B_3BF7_494D_8855_7FAC2C6C0608\n    else if (preg_match('/^application\\/pdf.+/', $name)) {\n        $name = 'application/pdf';\n    }\n    // treat image/pjpeg (image/pjpg, image/jpg) as image/jpeg (#1489097)\n    else if (preg_match('/^image\\/p?jpe?g$/', $name)) {\n        $name = 'image/jpeg';\n    }\n\n    return $name;\n}\n\n// return attachment filename, handle empty filename case\nfunction rcmail_attachment_name($attachment, $display = false)\n{\n    global $RCMAIL;\n\n    $filename = (string) $attachment->filename;\n    $filename = preg_replace('/[\\x00-\\x1F\\x7F]/', '', $filename);\n\n    if ($filename === '') {\n        if ($attachment->mimetype == 'text/html') {\n            $filename = $RCMAIL->gettext('htmlmessage');\n        }\n        else {\n            $ext      = (array) rcube_mime::get_mime_extensions($attachment->mimetype);\n            $ext      = array_shift($ext);\n            $filename = $RCMAIL->gettext('messagepart') . ' ' . $attachment->mime_id;\n            if ($ext) {\n                $filename .= '.' . $ext;\n            }\n        }\n    }\n\n    // Display smart names for some known mimetypes\n    if ($display) {\n        if (preg_match('/application\\/(pgp|pkcs7)-signature/i', $attachment->mimetype)) {\n            $filename = $RCMAIL->gettext('digitalsig');\n        }\n    }\n\n    return $filename;\n}\n\nfunction rcmail_search_filter($attrib)\n{\n    global $RCMAIL;\n\n    if (!strlen($attrib['id'])) {\n        $attrib['id'] = 'rcmlistfilter';\n    }\n\n    $attrib['onchange'] = rcmail_output::JS_OBJECT_NAME.'.filter_mailbox(this.value)';\n\n    // Content-Type values of messages with attachments\n    // the same as in app.js:add_message_row()\n    $ctypes = array('application/', 'multipart/m', 'multipart/signed', 'multipart/report');\n\n    // Build search string of \"with attachment\" filter\n    $attachment = trim(str_repeat(' OR', count($ctypes)-1));\n    foreach ($ctypes as $type) {\n        $attachment .= ' HEADER Content-Type ' . rcube_imap_generic::escape($type);\n    }\n\n    $select = new html_select($attrib);\n    $select->add($RCMAIL->gettext('all'), 'ALL');\n    $select->add($RCMAIL->gettext('unread'), 'UNSEEN');\n    $select->add($RCMAIL->gettext('flagged'), 'FLAGGED');\n    $select->add($RCMAIL->gettext('unanswered'), 'UNANSWERED');\n    if (!$RCMAIL->config->get('skip_deleted')) {\n        $select->add($RCMAIL->gettext('deleted'), 'DELETED');\n        $select->add($RCMAIL->gettext('undeleted'), 'UNDELETED');\n    }\n    $select->add($RCMAIL->gettext('withattachment'), $attachment);\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('highest'), 'HEADER X-PRIORITY 1');\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('high'), 'HEADER X-PRIORITY 2');\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('normal'), 'NOT HEADER X-PRIORITY 1 NOT HEADER X-PRIORITY 2 NOT HEADER X-PRIORITY 4 NOT HEADER X-PRIORITY 5');\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('low'), 'HEADER X-PRIORITY 4');\n    $select->add($RCMAIL->gettext('priority').': '.$RCMAIL->gettext('lowest'), 'HEADER X-PRIORITY 5');\n\n    $RCMAIL->output->add_gui_object('search_filter', $attrib['id']);\n\n    return $select->show($_REQUEST['_search'] ? $_SESSION['search_filter'] : 'ALL');\n}\n\nfunction rcmail_search_interval($attrib)\n{\n    global $RCMAIL;\n\n    if (!strlen($attrib['id'])) {\n        $attrib['id'] = 'rcmsearchinterval';\n    }\n\n    $select = new html_select($attrib);\n    $select->add('', '');\n\n    foreach (array('1W', '1M', '1Y', '-1W', '-1M', '-1Y') as $value) {\n        $select->add($RCMAIL->gettext('searchinterval' . $value), $value);\n    }\n\n    $RCMAIL->output->add_gui_object('search_interval', $attrib['id']);\n\n    return $select->show($_REQUEST['_search'] ? $_SESSION['search_interval'] : '');\n}\n\nfunction rcmail_message_error()\n{\n    global $RCMAIL;\n\n    // Set env variables for messageerror.html template\n    if ($RCMAIL->action == 'show') {\n        $mbox_name = $RCMAIL->storage->get_folder();\n\n        $RCMAIL->output->set_env('mailbox', $mbox_name);\n        $RCMAIL->output->set_env('uid', null);\n    }\n\n    // display error message\n    $RCMAIL->output->show_message('messageopenerror', 'error');\n    // ... display message error page\n    $RCMAIL->output->send('messageerror');\n}\n\nfunction rcmail_message_import_form($attrib = array())\n{\n    global $RCMAIL;\n\n    $RCMAIL->output->add_label('selectimportfile','importwait');\n\n    $input_attr = array(\n        'multiple' => true,\n        'name'     => '_file[]',\n        'accept'   => \".eml, .mbox, message/rfc822, text/*\",\n    );\n\n    $attrib['prefix'] = html::tag('input', array('type' => 'hidden', 'name' => '_unlock', 'value' => ''))\n        . html::tag('input', array('type' => 'hidden', 'name' => '_framed', 'value' => '1'));\n\n    return $RCMAIL->upload_form($attrib, 'importform', 'import-messages', $input_attr);\n}\n\n/**\n * Add groups from the given address source to the address book widget\n */\nfunction rcmail_compose_contact_groups($abook, $source_id, $search = null, $search_mode = 0)\n{\n    global $RCMAIL, $OUTPUT;\n\n    $jsresult = array();\n    foreach ($abook->list_groups($search, $search_mode) as $group) {\n        $abook->reset();\n        $abook->set_group($group['ID']);\n\n        // group (distribution list) with email address(es)\n        if ($group['email']) {\n            foreach ((array)$group['email'] as $email) {\n                $row_id = 'G'.$group['ID'];\n                $jsresult[$row_id] = format_email_recipient($email, $group['name']);\n                $OUTPUT->command('add_contact_row', $row_id, array(\n                    'contactgroup' => html::span(array('title' => $email), rcube::Q($group['name']))), 'group');\n            }\n        }\n        // make virtual groups clickable to list their members\n        else if ($group['virtual']) {\n            $row_id = 'G'.$group['ID'];\n            $OUTPUT->command('add_contact_row', $row_id, array(\n                'contactgroup' => html::a(array(\n                    'href' => '#list',\n                    'rel' => $group['ID'],\n                    'title' => $RCMAIL->gettext('listgroup'),\n                    'onclick' => sprintf(\"return %s.command('pushgroup',{'source':'%s','id':'%s'},this,event)\",\n                                    rcmail_output::JS_OBJECT_NAME, $source_id, $group['ID']),\n                ), rcube::Q($group['name']) . '&nbsp;' . html::span('action', '&raquo;'))),\n                'group',\n                array('ID' => $group['ID'], 'name' => $group['name'], 'virtual' => true));\n        }\n        // show group with count\n        else if (($result = $abook->count()) && $result->count) {\n            $row_id = 'E'.$group['ID'];\n            $jsresult[$row_id] = $group['name'];\n            $OUTPUT->command('add_contact_row', $row_id, array(\n                'contactgroup' => rcube::Q($group['name'] . ' (' . intval($result->count) . ')')), 'group');\n        }\n    }\n\n    $abook->reset();\n    $abook->set_group(0);\n\n    return $jsresult;\n}\n\nfunction rcmail_save_attachment($message, $pid, $compose_id, $params = array())\n{\n    global $COMPOSE;\n\n    $rcmail  = rcmail::get_instance();\n    $storage = $rcmail->get_storage();\n\n    if ($pid) {\n        // attachment requested\n        $part     = $message->mime_parts[$pid];\n        $size     = $part->size;\n        $mimetype = $part->ctype_primary . '/' . $part->ctype_secondary;\n        $filename = $params['filename'] ?: rcmail_attachment_name($part);\n    }\n    else if (is_object($message)) {\n        // the whole message requested\n        $size     = $message->size;\n        $mimetype = 'message/rfc822';\n        $filename = $params['filename'] ?: 'message_rfc822.eml';\n    }\n    else if (is_string($message)) {\n        // the whole message requested\n        $size     = strlen($message);\n        $data     = $message;\n        $mimetype = $params['mimetype'];\n        $filename = $params['filename'];\n    }\n\n    if (!isset($data)) {\n        // don't load too big attachments into memory\n        if (!rcube_utils::mem_check($size)) {\n            $temp_dir = unslashify($rcmail->config->get('temp_dir'));\n            $path     = tempnam($temp_dir, 'rcmAttmnt');\n\n            if ($fp = fopen($path, 'w')) {\n                if ($pid) {\n                    // part body\n                    $message->get_part_body($pid, false, 0, $fp);\n                }\n                else {\n                    // complete message\n                    $storage->get_raw_body($message->uid, $fp);\n                }\n\n                fclose($fp);\n            }\n            else {\n                return false;\n            }\n        }\n        else if ($pid) {\n            // part body\n            $data = $message->get_part_body($pid);\n        }\n        else {\n            // complete message\n            $data = $storage->get_raw_body($message->uid);\n        }\n    }\n\n    $attachment = array(\n        'group'      => $compose_id,\n        'name'       => $filename,\n        'mimetype'   => $mimetype,\n        'content_id' => $part ? $part->content_id : null,\n        'data'       => $data,\n        'path'       => $path,\n        'size'       => $path ? filesize($path) : strlen($data),\n        'charset'    => $part ? $part->charset : $params['charset'],\n    );\n\n    $attachment = $rcmail->plugins->exec_hook('attachment_save', $attachment);\n\n    if ($attachment['status']) {\n        unset($attachment['data'], $attachment['status'], $attachment['content_id'], $attachment['abort']);\n\n        // rcube_session::append() replaces current session data with the old values\n        // (in rcube_session::reload()). This is a problem in 'compose' action, because before\n        // the first append() use we set some important data in the session.\n        // It also overwrites attachments list. Fixing reload() is not so simple if possible\n        // as we don't really know what has been added and what removed in meantime.\n        // So, for now we'll do not use append() on 'compose' action (#1490608).\n\n        if ($rcmail->action == 'compose') {\n            $COMPOSE['attachments'][$attachment['id']] = $attachment;\n        }\n        else {\n            $rcmail->session->append('compose_data_' . $compose_id . '.attachments', $attachment['id'], $attachment);\n        }\n\n        return $attachment;\n    }\n    else if ($path) {\n        @unlink($path);\n    }\n\n    return false;\n}\n\n// Return mimetypes supported by the browser\nfunction rcmail_supported_mimetypes()\n{\n    $rcmail = rcube::get_instance();\n\n    // mimetypes supported by the browser (default settings)\n    $mimetypes = (array) $rcmail->config->get('client_mimetypes');\n\n    // Remove unsupported types, which makes that attachment which cannot be\n    // displayed in a browser will be downloaded directly without displaying an overlay page\n    if (empty($_SESSION['browser_caps']['pdf']) && ($key = array_search('application/pdf', $mimetypes)) !== false) {\n        unset($mimetypes[$key]);\n    }\n\n    if (empty($_SESSION['browser_caps']['flash']) && ($key = array_search('application/x-shockwave-flash', $mimetypes)) !== false) {\n        unset($mimetypes[$key]);\n    }\n\n    // We cannot securely preview XML files as we do not have a proper parser\n    if (($key = array_search('text/xml', $mimetypes)) !== false) {\n        unset($mimetypes[$key]);\n    }\n\n    foreach (array('tiff', 'webp') as $type) {\n        if (empty($_SESSION['browser_caps'][$type]) && ($key = array_search('image/' . $type, $mimetypes)) !== false) {\n            // can we convert it to jpeg?\n            if (!rcube_image::is_convertable('image/' . $type)) {\n                unset($mimetypes[$key]);\n            }\n        }\n    }\n\n    // @TODO: support mail preview for compose attachments\n    if ($rcmail->action != 'compose' && !in_array('message/rfc822', $mimetypes)) {\n        $mimetypes[] = 'message/rfc822';\n    }\n\n    return array_values($mimetypes);\n}\n", "<?php\n\n/**\n +-----------------------------------------------------------------------+\n | program/steps/mail/show.inc                                           |\n |                                                                       |\n | This file is part of the Roundcube Webmail client                     |\n | Copyright (C) 2005-2013, The Roundcube Dev Team                       |\n |                                                                       |\n | Licensed under the GNU General Public License version 3 or            |\n | any later version with exceptions for skins & plugins.                |\n | See the README file for a full license statement.                     |\n |                                                                       |\n | PURPOSE:                                                              |\n |   Display a mail message similar as a usual mail application does     |\n |                                                                       |\n +-----------------------------------------------------------------------+\n | Author: Thomas Bruederli <roundcube@gmail.com>                        |\n +-----------------------------------------------------------------------+\n*/\n\n$PRINT_MODE = $RCMAIL->action == 'print';\n\n// Read browser capabilities and store them in session\nif ($caps = rcube_utils::get_input_value('_caps', rcube_utils::INPUT_GET)) {\n    $browser_caps = array();\n    foreach (explode(',', $caps) as $cap) {\n        $cap = explode('=', $cap);\n        $browser_caps[$cap[0]] = $cap[1];\n    }\n    $_SESSION['browser_caps'] = $browser_caps;\n}\n\n$msg_id    = rcube_utils::get_input_value('_uid', rcube_utils::INPUT_GET);\n$uid       = preg_replace('/\\.[0-9.]+$/', '', $msg_id);\n$mbox_name = $RCMAIL->storage->get_folder();\n\n// similar code as in program/steps/mail/get.inc\nif ($uid) {\n    // set message format (need to be done before rcube_message construction)\n    if (!empty($_GET['_format'])) {\n        $prefer_html = $_GET['_format'] == 'html';\n        $RCMAIL->config->set('prefer_html', $prefer_html);\n        $_SESSION['msg_formats'][$mbox_name.':'.$uid] = $prefer_html;\n    }\n    else if (isset($_SESSION['msg_formats'][$mbox_name.':'.$uid])) {\n        $RCMAIL->config->set('prefer_html', $_SESSION['msg_formats'][$mbox_name.':'.$uid]);\n    }\n\n    $MESSAGE = new rcube_message($msg_id, $mbox_name, intval($_GET['_safe']));\n\n    // if message not found (wrong UID)...\n    if (empty($MESSAGE->headers)) {\n        rcmail_message_error($uid);\n    }\n\n    // show images?\n    rcmail_check_safe($MESSAGE);\n\n    // set message charset as default\n    if (!empty($MESSAGE->headers->charset)) {\n        $RCMAIL->storage->set_charset($MESSAGE->headers->charset);\n    }\n\n    $OUTPUT->set_pagetitle(abbreviate_string($MESSAGE->subject, 128, '...', true));\n\n    // set message environment\n    $OUTPUT->set_env('uid', $msg_id);\n    $OUTPUT->set_env('safemode', $MESSAGE->is_safe);\n    $OUTPUT->set_env('message_context', $MESSAGE->context);\n    $OUTPUT->set_env('sender', $MESSAGE->sender['string']);\n    $OUTPUT->set_env('mailbox', $mbox_name);\n    $OUTPUT->set_env('username', $RCMAIL->get_user_name());\n    $OUTPUT->set_env('permaurl', $RCMAIL->url(array('_action' => 'show', '_uid' => $msg_id, '_mbox' => $mbox_name)));\n    $OUTPUT->set_env('delimiter', $RCMAIL->storage->get_hierarchy_delimiter());\n    $OUTPUT->set_env('mimetypes', rcmail_supported_mimetypes());\n\n    if ($MESSAGE->headers->get('list-post', false)) {\n        $OUTPUT->set_env('list_post', true);\n    }\n\n    // set environment\n    $OUTPUT->set_env('delimiter', $RCMAIL->storage->get_hierarchy_delimiter());\n    $OUTPUT->set_env('mimetypes', rcmail_supported_mimetypes());\n\n    // set configuration\n    $RCMAIL->set_env_config(array('delete_junk', 'flag_for_deletion', 'read_when_deleted',\n        'skip_deleted', 'display_next', 'forward_attachment'));\n\n    // set special folders\n    foreach (array('drafts', 'trash', 'junk') as $mbox) {\n        if ($folder = $RCMAIL->config->get($mbox . '_mbox')) {\n            $OUTPUT->set_env($mbox . '_mailbox', $folder);\n        }\n    }\n\n    if ($MESSAGE->has_html_part()) {\n        $prefer_html = $RCMAIL->config->get('prefer_html');\n        $OUTPUT->set_env('optional_format', $prefer_html ? 'text' : 'html');\n    }\n\n    if (!$OUTPUT->ajax_call) {\n        $OUTPUT->add_label('checkingmail', 'deletemessage', 'movemessagetotrash',\n            'movingmessage', 'deletingmessage', 'markingmessage', 'replyall', 'replylist');\n    }\n\n    // check for unset disposition notification\n    if ($MESSAGE->headers->mdn_to\n        && $MESSAGE->context === null\n        && empty($MESSAGE->headers->flags['MDNSENT'])\n        && empty($MESSAGE->headers->flags['SEEN'])\n        && ($RCMAIL->storage->check_permflag('MDNSENT') || $RCMAIL->storage->check_permflag('*'))\n        && $mbox_name != $RCMAIL->config->get('drafts_mbox')\n        && $mbox_name != $RCMAIL->config->get('sent_mbox')\n    ) {\n        $mdn_cfg = intval($RCMAIL->config->get('mdn_requests'));\n\n        if ($mdn_cfg == 1 || (($mdn_cfg == 3 || $mdn_cfg ==  4) && rcmail_contact_exists($MESSAGE->sender['mailto']))) {\n            // Send MDN\n            if (rcmail_send_mdn($MESSAGE, $smtp_error))\n                $OUTPUT->show_message('receiptsent', 'confirmation');\n            else if ($smtp_error)\n                $OUTPUT->show_message($smtp_error['label'], 'error', $smtp_error['vars']);\n            else\n                $OUTPUT->show_message('errorsendingreceipt', 'error');\n        }\n        else if ($mdn_cfg != 2 && $mdn_cfg != 4) {\n            // Ask user\n            $OUTPUT->add_label('mdnrequest');\n            $OUTPUT->set_env('mdn_request', true);\n        }\n    }\n\n    if (empty($MESSAGE->headers->flags['SEEN']) && $MESSAGE->context === null) {\n        $v = intval($RCMAIL->config->get('mail_read_time'));\n        if ($v > 0) {\n            $OUTPUT->set_env('mail_read_time', $v);\n        }\n        else if ($v == 0) {\n            $RCMAIL->output->command('set_unread_message', $MESSAGE->uid, $mbox_name);\n            $RCMAIL->plugins->exec_hook('message_read', array(\n                    'uid'     => $MESSAGE->uid,\n                    'mailbox' => $mbox_name,\n                    'message' => $MESSAGE,\n            ));\n\n            $set_seen_flag = true;\n        }\n    }\n}\n\n\n$OUTPUT->add_handlers(array(\n    'messageattachments' => 'rcmail_message_attachments',\n    'mailboxname'        => 'rcmail_mailbox_name_display',\n    'messageobjects'     => 'rcmail_message_objects',\n    'contactphoto'       => 'rcmail_message_contactphoto',\n));\n\n\nif ($RCMAIL->action == 'print' && $OUTPUT->template_exists('messageprint'))\n    $OUTPUT->send('messageprint', false);\nelse if ($RCMAIL->action == 'preview' && $OUTPUT->template_exists('messagepreview'))\n    $OUTPUT->send('messagepreview', false);\nelse\n    $OUTPUT->send('message', false);\n\n\n// mark message as read\nif (!empty($set_seen_flag)) {\n    if ($RCMAIL->storage->set_flag($MESSAGE->uid, 'SEEN', $mbox_name)) {\n        if ($count = rcmail_get_unseen_count($mbox_name)) {\n            rcmail_set_unseen_count($mbox_name, $count - 1);\n        }\n    }\n}\n\nexit;\n\n\nfunction rcmail_message_attachments($attrib)\n{\n    global $PRINT_MODE, $MESSAGE, $RCMAIL;\n\n    $out = $ol = '';\n    $attachments = array();\n\n    if (count($MESSAGE->attachments)) {\n        foreach ($MESSAGE->attachments as $attach_prop) {\n            $filename = rcmail_attachment_name($attach_prop, true);\n            $filesize = $RCMAIL->message_part_size($attach_prop);\n\n            if ($PRINT_MODE) {\n                $ol .= html::tag('li', array('id' => 'attach' . $attach_prop->mime_id),\n                    rcube::Q(sprintf(\"%s (%s)\", $filename, $filesize)));\n            }\n            else {\n                if ($attrib['maxlength'] && mb_strlen($filename) > $attrib['maxlength']) {\n                    $title    = $filename;\n                    $filename = abbreviate_string($filename, $attrib['maxlength']);\n                }\n                else {\n                    $title = '';\n                }\n\n                $size     = ' ' . html::span('attachment-size', '(' . rcube::Q($filesize) . ')');\n                $mimetype = rcmail_fix_mimetype($attach_prop->mimetype);\n                $class    = rcube_utils::file2class($mimetype, $filename);\n                $id       = 'attach' . $attach_prop->mime_id;\n                $link     = html::a(array(\n                    'href'        => $MESSAGE->get_part_url($attach_prop->mime_id, false),\n                    'onclick'     => sprintf('return %s.command(\\'load-attachment\\',\\'%s\\',this)',\n                        rcmail_output::JS_OBJECT_NAME, $attach_prop->mime_id),\n                    'onmouseover' => $title ? '' : 'rcube_webmail.long_subject_title_ex(this, 0)',\n                    'title'       => $title,\n                    ), rcube::Q($filename) . $size);\n\n                $ol .= html::tag('li', array('class' => $class, 'id' => $id), $link);\n\n                $attachments[$attach_prop->mime_id] = $mimetype;\n            }\n        }\n\n        $out = html::tag('ul', $attrib, $ol, html::$common_attrib);\n\n        $RCMAIL->output->set_env('attachments', $attachments);\n        $RCMAIL->output->add_gui_object('attachments', $attrib['id']);\n    }\n\n    return $out;\n}\n\nfunction rcmail_remote_objects_msg()\n{\n    global $MESSAGE, $RCMAIL;\n\n    $attrib['id']    = 'remote-objects-message';\n    $attrib['class'] = 'notice';\n    $attrib['style'] = 'display: none';\n\n    $msg = rcube::Q($RCMAIL->gettext('blockedimages')) . '&nbsp;';\n    $msg .= html::a(array(\n            'href'    => \"#loadimages\",\n            'onclick' => rcmail_output::JS_OBJECT_NAME.\".command('load-images')\"\n        ),\n        rcube::Q($RCMAIL->gettext('showimages')));\n\n    // add link to save sender in addressbook and reload message\n    if ($MESSAGE->sender['mailto'] && $RCMAIL->config->get('show_images') == 1) {\n        $msg .= ' ' . html::a(array(\n                'href'    => \"#alwaysload\",\n                'onclick' => rcmail_output::JS_OBJECT_NAME.\".command('always-load')\",\n                'style'   => \"white-space:nowrap\"\n            ),\n            rcube::Q($RCMAIL->gettext(array('name' => 'alwaysshow', 'vars' => array('sender' => $MESSAGE->sender['mailto'])))));\n    }\n\n    $RCMAIL->output->add_gui_object('remoteobjectsmsg', $attrib['id']);\n\n    return html::div($attrib, $msg);\n}\n\nfunction rcmail_message_buttons()\n{\n    global $RCMAIL, $MESSAGE;\n\n    $delim = $RCMAIL->storage->get_hierarchy_delimiter();\n    $dbox  = $RCMAIL->config->get('drafts_mbox');\n\n    // the message is not a draft\n    if ($MESSAGE->folder != $dbox && strpos($MESSAGE->folder, $dbox.$delim) !== 0) {\n        return '';\n    }\n\n    $attrib['id']    = 'message-buttons';\n    $attrib['class'] = 'notice';\n\n    $msg = rcube::Q($RCMAIL->gettext('isdraft')) . '&nbsp;';\n    $msg .= html::a(array(\n            'href'    => \"#edit\",\n            'onclick' => rcmail_output::JS_OBJECT_NAME.\".command('edit')\"\n        ),\n        rcube::Q($RCMAIL->gettext('edit')));\n\n    return html::div($attrib, $msg);\n}\n\nfunction rcmail_message_objects($attrib)\n{\n    global $RCMAIL, $MESSAGE;\n\n    if (!$attrib['id'])\n        $attrib['id'] = 'message-objects';\n\n    $content = array(\n        rcmail_message_buttons(),\n        rcmail_remote_objects_msg(),\n    );\n\n    $plugin = $RCMAIL->plugins->exec_hook('message_objects',\n        array('content' => $content, 'message' => $MESSAGE));\n\n    $content = implode(\"\\n\", $plugin['content']);\n\n    return html::div($attrib, $content);\n}\n\nfunction rcmail_contact_exists($email)\n{\n    global $RCMAIL;\n\n    if ($email) {\n        // @TODO: search in all address books?\n        $CONTACTS = $RCMAIL->get_address_book(-1, true);\n\n        if (is_object($CONTACTS)) {\n            $existing = $CONTACTS->search('email', $email, 1, false);\n            if ($existing->count) {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}\n\nfunction rcmail_message_contactphoto($attrib)\n{\n    global $RCMAIL, $MESSAGE;\n\n    $placeholder = $attrib['placeholder'] ? $RCMAIL->output->abs_url($attrib['placeholder'], true) : null;\n    $placeholder = $RCMAIL->output->asset_url($placeholder ?: 'program/resources/blank.gif');\n\n    if ($MESSAGE->sender) {\n        $photo_img = $RCMAIL->url(array(\n            '_task'   => 'addressbook',\n            '_action' => 'photo',\n            '_email'  => $MESSAGE->sender['mailto'],\n        ));\n\n        $attrib['onerror'] = \"this.src = '$placeholder'\";\n    }\n    else {\n        $photo_img = $placeholder;\n    }\n\n    return html::img(array('src' => $photo_img, 'alt' => $RCMAIL->gettext('contactphoto')) + $attrib);\n}\n"], "filenames": ["CHANGELOG", "config/defaults.inc.php", "program/lib/Roundcube/rcube_config.php", "program/steps/mail/func.inc", "program/steps/mail/show.inc"], "buggy_code_start_loc": [3, 592, 400, 2361, 74], "buggy_code_end_loc": [9, 595, 401, 2361, 74], "fixing_code_start_loc": [4, 592, 400, 2362, 75], "fixing_code_end_loc": [11, 598, 401, 2367, 77], "type": "CWE-79", "message": "An issue was discovered in Roundcube Webmail before 1.3.12 and 1.4.x before 1.4.5. There is XSS via a malicious XML attachment because text/xml is among the allowed types for a preview.", "other": {"cve": {"id": "CVE-2020-13965", "sourceIdentifier": "cve@mitre.org", "published": "2020-06-09T03:15:11.250", "lastModified": "2020-07-23T20:06:24.363", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "An issue was discovered in Roundcube Webmail before 1.3.12 and 1.4.x before 1.4.5. There is XSS via a malicious XML attachment because text/xml is among the allowed types for a preview."}, {"lang": "es", "value": "Se detect\u00f3 un problema en Roundcube Webmail versiones anteriores a 1.3.12. Se presenta una vulnerabilidad de tipo XSS por medio de un archivo adjunto XML malicioso porque text/xml se encuentra entre los tipos permitidos para una vista previa"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:roundcube:webmail:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.3.12", "matchCriteriaId": "289A3A4F-39FC-46C8-9A65-566CF3D37242"}, {"vulnerable": true, "criteria": "cpe:2.3:a:roundcube:webmail:*:*:*:*:*:*:*:*", "versionStartIncluding": "1.4.0", "versionEndExcluding": "1.4.5", "matchCriteriaId": "BE4389EE-4AFC-4D15-8E9D-52FCD6302EE6"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:9.0:*:*:*:*:*:*:*", "matchCriteriaId": "DEECE5FC-CACF-4496-A3E7-164736409252"}, {"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:10.0:*:*:*:*:*:*:*", "matchCriteriaId": "07B237A9-69A3-4A9C-9DA0-4E06BD37AE73"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:fedoraproject:fedora:31:*:*:*:*:*:*:*", "matchCriteriaId": "80F0FA5D-8D3B-4C0E-81E2-87998286AF33"}, {"vulnerable": true, "criteria": "cpe:2.3:o:fedoraproject:fedora:32:*:*:*:*:*:*:*", "matchCriteriaId": "36D96259-24BD-44E2-96D9-78CE1D41F956"}]}]}], "references": [{"url": "https://github.com/DrunkenShells/Disclosures/tree/master/CVE-2020-13965-Cross%20Site-Scripting%20via%20Malicious%20XML%20Attachment-Roundcube", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://github.com/roundcube/roundcubemail/commit/884eb611627ef2bd5a2e20e02009ebb1eceecdc3", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/roundcube/roundcubemail/compare/1.4.4...1.4.5", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/roundcube/roundcubemail/releases/tag/1.3.12", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://github.com/roundcube/roundcubemail/releases/tag/1.4.5", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/DLESQ4LPJGMSWHQ4TBRTVQRDG7IXAZCW/", "source": "cve@mitre.org", "tags": ["Mailing List", "Third Party Advisory"]}, {"url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/ODPJXBHZ32QSP4MYT2OBCALYXSUJ47SK/", "source": "cve@mitre.org", "tags": ["Mailing List", "Third Party Advisory"]}, {"url": "https://roundcube.net/news/2020/06/02/security-updates-1.4.5-and-1.3.12", "source": "cve@mitre.org", "tags": ["Vendor Advisory"]}, {"url": "https://www.debian.org/security/2020/dsa-4700", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/roundcube/roundcubemail/commit/884eb611627ef2bd5a2e20e02009ebb1eceecdc3"}}