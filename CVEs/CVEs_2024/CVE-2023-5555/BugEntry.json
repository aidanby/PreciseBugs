{"buggy_code": ["frappe.ready(() => {\n\tfrappe.telemetry.capture(\"on_course_creation_page\", \"lms\");\n\t$(\".tags\").click((e) => {\n\t\te.preventDefault();\n\t\t$(\"#tags-input\").focus();\n\t});\n\n\t$(\"#tags-input\").focusout((e) => {\n\t\tcreate_tag(e);\n\t});\n\n\t$(\"#tags-input\").focus((e) => {\n\t\t$(e.target).keypress((e) => {\n\t\t\tif (e.which == 13 || e.which == 44) {\n\t\t\t\tcreate_tag(e);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t$(\"#tags-input\").val(\"\");\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(document).on(\"click\", \".btn-remove\", (e) => {\n\t\t$(e.target).parent().parent().remove();\n\t});\n\n\t$(\".btn-save-course\").click((e) => {\n\t\tsave_course(e);\n\t});\n\n\tif ($(\"#description\").length) {\n\t\tmake_editor();\n\t}\n\n\t$(\".field-input\").focusout((e) => {\n\t\tif ($(e.currentTarget).siblings(\".error-message\")) {\n\t\t\t$(e.currentTarget).siblings(\".error-message\").remove();\n\t\t}\n\t});\n\n\t$(\".btn-upload\").click((e) => {\n\t\tupload_file(e);\n\t});\n\n\t$(\"#paid-course\").click((e) => {\n\t\tsetup_paid_course(e);\n\t});\n});\n\nconst create_tag = (e) => {\n\tif ($(e.target).val() == \"\") {\n\t\treturn;\n\t}\n\tlet tag = `<button class=\"btn btn-secondary btn-sm mr-2 text-uppercase\">\n\t\t${$(e.target).val()}\n\t\t<span class=\"btn-remove\">\n\t\t\t<svg class=\"icon  icon-sm\">\n\t\t\t\t<use class=\"\" href=\"#icon-close\"></use>\n\t\t\t</svg>\n\t\t</span>\n\t</button>`;\n\t$(tag).insertBefore(\"#tags-input\");\n\t$(e.target).val(\"\");\n};\n\nconst save_course = (e) => {\n\tvalidate_mandatory();\n\tlet tags = $(\".tags button\")\n\t\t.map((i, el) => $(el).text().trim())\n\t\t.get();\n\n\tfrappe.call({\n\t\tmethod: \"lms.lms.doctype.lms_course.lms_course.save_course\",\n\t\targs: {\n\t\t\ttags: tags.join(\", \"),\n\t\t\ttitle: $(\"#title\").val(),\n\t\t\tshort_introduction: $(\"#intro\").val(),\n\t\t\tvideo_link: $(\"#video-link\").val(),\n\t\t\timage: $(\".image-preview\").attr(\"src\"),\n\t\t\tdescription: this.description.fields_dict[\"description\"].value,\n\t\t\tcourse: $(\"#title\").data(\"course\")\n\t\t\t\t? $(\"#title\").data(\"course\")\n\t\t\t\t: \"\",\n\t\t\tpublished: $(\"#published\").prop(\"checked\") ? 1 : 0,\n\t\t\tupcoming: $(\"#upcoming\").prop(\"checked\") ? 1 : 0,\n\t\t\tpaid_course: $(\"#paid-course\").prop(\"checked\") ? 1 : 0,\n\t\t\tcourse_price: $(\"#course-price\").val(),\n\t\t\tcurrency: $(\"#currency\").val(),\n\t\t},\n\t\tcallback: (data) => {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Saved\"),\n\t\t\t\tindicator: \"green\",\n\t\t\t});\n\t\t\tsetTimeout(() => {\n\t\t\t\twindow.location.href = `/courses/${data.message}/edit`;\n\t\t\t}, 1000);\n\t\t},\n\t});\n};\n\nconst validate_mandatory = () => {\n\tlet fields = $(\".field-label.reqd\");\n\tfields.each((i, el) => {\n\t\tlet input = $(el).closest(\".field-group\").find(\".field-input\");\n\t\tif (input.length && input.val().trim() == \"\") {\n\t\t\tif (input.siblings(\".error-message\").length == 0) {\n\t\t\t\tscroll_to_element(input);\n\t\t\t\tthrow_error(el, input);\n\t\t\t}\n\t\t\tthrow `${$(el).text().trim()} is mandatory`;\n\t\t}\n\t});\n\n\tif (!strip_html(this.description.fields_dict[\"description\"].value)) {\n\t\tscroll_to_element(\"#description\");\n\t\tthrow_error(\n\t\t\t\"#description\",\n\t\t\tthis.description.fields_dict[\"description\"].parent\n\t\t);\n\t\tthrow \"Description is mandatory\";\n\t}\n};\n\nconst throw_error = (el, input) => {\n\tlet error = document.createElement(\"p\");\n\terror.classList.add(\"error-message\");\n\terror.innerText = `Please enter a ${$(el).text().trim()}`;\n\t$(error).insertAfter($(input));\n};\n\nconst scroll_to_element = (element) => {\n\tif ($(element).length) {\n\t\t$([document.documentElement, document.body]).animate(\n\t\t\t{\n\t\t\t\tscrollTop: $(element).offset().top - 100,\n\t\t\t},\n\t\t\t1000\n\t\t);\n\t}\n};\n\nconst make_editor = () => {\n\tthis.description = new frappe.ui.FieldGroup({\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"description\",\n\t\t\t\tfieldtype: \"Text Editor\",\n\t\t\t\tdefault: $(\"#description-data\").html(),\n\t\t\t},\n\t\t],\n\t\tbody: $(\"#description\").get(0),\n\t});\n\tthis.description.make();\n\t$(\"#description .form-section:last\").removeClass(\"empty-section\");\n\t$(\"#description .frappe-control\").removeClass(\"hide-control\");\n\t$(\"#description .form-column\").addClass(\"p-0\");\n};\n\nconst upload_file = (e) => {\n\tnew frappe.ui.FileUploader({\n\t\tdisable_file_browser: true,\n\t\tfolder: \"Home/Attachments\",\n\t\tmake_attachments_public: true,\n\t\trestrictions: {\n\t\t\tallowed_file_types: [\"image/*\"],\n\t\t},\n\t\ton_success: (file_doc) => {\n\t\t\t$(e.target)\n\t\t\t\t.parent()\n\t\t\t\t.siblings(\"img\")\n\t\t\t\t.addClass(\"image-preview\")\n\t\t\t\t.attr(\"src\", file_doc.file_url);\n\t\t},\n\t});\n};\n\nconst setup_paid_course = (e) => {\n\tif ($(e.target).prop(\"checked\")) {\n\t\t$(\".price-field\").removeClass(\"hide\");\n\t\t$(\".price-field\").find(\".field-label\").addClass(\"reqd\");\n\t} else {\n\t\t$(\".price-field\").addClass(\"hide\");\n\t\t$(\".price-field\").find(\".field-label\").removeClass(\"reqd\");\n\t}\n};\n", "frappe.ready(() => {\n\t$(\"#load-more\").click((e) => {\n\t\tsearch(e);\n\t});\n\n\t$(\".close-search-empty-state\").click((e) => {\n\t\tclose_search_empty_state(e);\n\t});\n\n\t$(\"#search-user\").keyup(function () {\n\t\tlet timer;\n\t\tclearTimeout(timer);\n\t\ttimer = setTimeout(() => {\n\t\t\tsearch.apply(this, arguments);\n\t\t}, 300);\n\t});\n});\n\nconst search = (e) => {\n\t$(\"#search-empty-state\").addClass(\"hide\");\n\tlet start = $(e.currentTarget).data(\"start\");\n\tlet input = $(\"#search-user\").val();\n\tif ($(e.currentTarget).prop(\"nodeName\") == \"INPUT\") start = 0;\n\n\tfrappe.call({\n\t\tmethod: \"lms.overrides.user.search_users\",\n\t\targs: {\n\t\t\tstart: start,\n\t\t\ttext: input,\n\t\t},\n\t\tcallback: (data) => {\n\t\t\tif ($(e.currentTarget).prop(\"nodeName\") == \"INPUT\")\n\t\t\t\t$(\".member-parent\").empty();\n\n\t\t\tif (data.message.user_details.length)\n\t\t\t\t$(\"#load-more\").removeClass(\"hide\");\n\t\t\telse $(\"#search-empty-state\").removeClass(\"hide\");\n\n\t\t\t$(\".member-parent\").append(data.message.user_details);\n\t\t\tupdate_load_more_state(data);\n\t\t},\n\t});\n};\n\nconst close_search_empty_state = (e) => {\n\t$(\"#search-empty-state\").addClass(\"hide\");\n\t$(\"#search-user\").val(\"\").keyup();\n};\n\nconst update_load_more_state = (data) => {\n\t$(\"#load-more\").data(\"start\", data.message.start);\n\t$(\"#load-more\").data(\"count\", data.message.count);\n\tif ($(\".member-card\").length == $(\"#load-more\").data(\"count\")) {\n\t\t$(\"#load-more\").addClass(\"hide\");\n\t}\n};\n"], "fixing_code": ["frappe.ready(() => {\n\tfrappe.telemetry.capture(\"on_course_creation_page\", \"lms\");\n\t$(\".tags\").click((e) => {\n\t\te.preventDefault();\n\t\t$(\"#tags-input\").focus();\n\t});\n\n\t$(\"#tags-input\").focusout((e) => {\n\t\tcreate_tag(e);\n\t});\n\n\t$(\"#tags-input\").focus((e) => {\n\t\t$(e.target).keypress((e) => {\n\t\t\tif (e.which == 13 || e.which == 44) {\n\t\t\t\tcreate_tag(e);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t$(\"#tags-input\").val(\"\");\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t});\n\t});\n\n\t$(document).on(\"click\", \".btn-remove\", (e) => {\n\t\t$(e.target).parent().parent().remove();\n\t});\n\n\t$(\".btn-save-course\").click((e) => {\n\t\tsave_course(e);\n\t});\n\n\tif ($(\"#description\").length) {\n\t\tmake_editor();\n\t}\n\n\t$(\".field-input\").focusout((e) => {\n\t\tif ($(e.currentTarget).siblings(\".error-message\")) {\n\t\t\t$(e.currentTarget).siblings(\".error-message\").remove();\n\t\t}\n\t});\n\n\t$(\".btn-upload\").click((e) => {\n\t\tupload_file(e);\n\t});\n\n\t$(\"#paid-course\").click((e) => {\n\t\tsetup_paid_course(e);\n\t});\n});\n\nconst create_tag = (e) => {\n\tif ($(e.target).val() == \"\") {\n\t\treturn;\n\t}\n\n\tlet tag_value = $(e.target)\n\t\t.val()\n\t\t.replace(/</g, \"&lt;\")\n\t\t.replace(/>/g, \"&gt;\");\n\tlet tag = `<button class=\"btn btn-secondary btn-sm mr-2 text-uppercase\">\n\t\t${tag_value}\n\t\t<span class=\"btn-remove\">\n\t\t\t<svg class=\"icon  icon-sm\">\n\t\t\t\t<use class=\"\" href=\"#icon-close\"></use>\n\t\t\t</svg>\n\t\t</span>\n\t</button>`;\n\t$(tag).insertBefore(\"#tags-input\");\n\t$(e.target).val(\"\");\n};\n\nconst save_course = (e) => {\n\tvalidate_mandatory();\n\tlet tags = $(\".tags button\")\n\t\t.map((i, el) => $(el).text().trim())\n\t\t.get();\n\n\tfrappe.call({\n\t\tmethod: \"lms.lms.doctype.lms_course.lms_course.save_course\",\n\t\targs: {\n\t\t\ttags: tags.join(\", \"),\n\t\t\ttitle: $(\"#title\").val(),\n\t\t\tshort_introduction: $(\"#intro\").val(),\n\t\t\tvideo_link: $(\"#video-link\").val(),\n\t\t\timage: $(\".image-preview\").attr(\"src\"),\n\t\t\tdescription: this.description.fields_dict[\"description\"].value,\n\t\t\tcourse: $(\"#title\").data(\"course\")\n\t\t\t\t? $(\"#title\").data(\"course\")\n\t\t\t\t: \"\",\n\t\t\tpublished: $(\"#published\").prop(\"checked\") ? 1 : 0,\n\t\t\tupcoming: $(\"#upcoming\").prop(\"checked\") ? 1 : 0,\n\t\t\tpaid_course: $(\"#paid-course\").prop(\"checked\") ? 1 : 0,\n\t\t\tcourse_price: $(\"#course-price\").val(),\n\t\t\tcurrency: $(\"#currency\").val(),\n\t\t},\n\t\tcallback: (data) => {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Saved\"),\n\t\t\t\tindicator: \"green\",\n\t\t\t});\n\t\t\tsetTimeout(() => {\n\t\t\t\twindow.location.href = `/courses/${data.message}/edit`;\n\t\t\t}, 1000);\n\t\t},\n\t});\n};\n\nconst validate_mandatory = () => {\n\tlet fields = $(\".field-label.reqd\");\n\tfields.each((i, el) => {\n\t\tlet input = $(el).closest(\".field-group\").find(\".field-input\");\n\t\tif (input.length && input.val().trim() == \"\") {\n\t\t\tif (input.siblings(\".error-message\").length == 0) {\n\t\t\t\tscroll_to_element(input);\n\t\t\t\tthrow_error(el, input);\n\t\t\t}\n\t\t\tthrow `${$(el).text().trim()} is mandatory`;\n\t\t}\n\t});\n\n\tif (!strip_html(this.description.fields_dict[\"description\"].value)) {\n\t\tscroll_to_element(\"#description\");\n\t\tthrow_error(\n\t\t\t\"#description\",\n\t\t\tthis.description.fields_dict[\"description\"].parent\n\t\t);\n\t\tthrow \"Description is mandatory\";\n\t}\n};\n\nconst throw_error = (el, input) => {\n\tlet error = document.createElement(\"p\");\n\terror.classList.add(\"error-message\");\n\terror.innerText = `Please enter a ${$(el).text().trim()}`;\n\t$(error).insertAfter($(input));\n};\n\nconst scroll_to_element = (element) => {\n\tif ($(element).length) {\n\t\t$([document.documentElement, document.body]).animate(\n\t\t\t{\n\t\t\t\tscrollTop: $(element).offset().top - 100,\n\t\t\t},\n\t\t\t1000\n\t\t);\n\t}\n};\n\nconst make_editor = () => {\n\tthis.description = new frappe.ui.FieldGroup({\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"description\",\n\t\t\t\tfieldtype: \"Text Editor\",\n\t\t\t\tdefault: $(\"#description-data\").html(),\n\t\t\t},\n\t\t],\n\t\tbody: $(\"#description\").get(0),\n\t});\n\tthis.description.make();\n\t$(\"#description .form-section:last\").removeClass(\"empty-section\");\n\t$(\"#description .frappe-control\").removeClass(\"hide-control\");\n\t$(\"#description .form-column\").addClass(\"p-0\");\n};\n\nconst upload_file = (e) => {\n\tnew frappe.ui.FileUploader({\n\t\tdisable_file_browser: true,\n\t\tfolder: \"Home/Attachments\",\n\t\tmake_attachments_public: true,\n\t\trestrictions: {\n\t\t\tallowed_file_types: [\"image/*\"],\n\t\t},\n\t\ton_success: (file_doc) => {\n\t\t\t$(e.target)\n\t\t\t\t.parent()\n\t\t\t\t.siblings(\"img\")\n\t\t\t\t.addClass(\"image-preview\")\n\t\t\t\t.attr(\"src\", file_doc.file_url);\n\t\t},\n\t});\n};\n\nconst setup_paid_course = (e) => {\n\tif ($(e.target).prop(\"checked\")) {\n\t\t$(\".price-field\").removeClass(\"hide\");\n\t\t$(\".price-field\").find(\".field-label\").addClass(\"reqd\");\n\t} else {\n\t\t$(\".price-field\").addClass(\"hide\");\n\t\t$(\".price-field\").find(\".field-label\").removeClass(\"reqd\");\n\t}\n};\n", "frappe.ready(() => {\n\t$(\"#load-more\").click((e) => {\n\t\tsearch(e);\n\t});\n\n\t$(\".close-search-empty-state\").click((e) => {\n\t\tclose_search_empty_state(e);\n\t});\n\n\t$(\"#search-user\").keyup(function () {\n\t\tlet timer;\n\t\tclearTimeout(timer);\n\t\ttimer = setTimeout(() => {\n\t\t\tsearch.apply(this, arguments);\n\t\t}, 300);\n\t});\n});\n\nconst search = (e) => {\n\t$(\"#search-empty-state\").addClass(\"hide\");\n\tlet start = $(e.currentTarget).data(\"start\");\n\tlet input = $(\"#search-user\").val();\n\tif ($(e.currentTarget).prop(\"nodeName\") == \"INPUT\") start = 0;\n\n\tfrappe.call({\n\t\tmethod: \"lms.overrides.user.search_users\",\n\t\targs: {\n\t\t\tstart: start,\n\t\t\ttext: input,\n\t\t},\n\t\tcallback: (data) => {\n\t\t\tif ($(e.currentTarget).prop(\"nodeName\") == \"INPUT\")\n\t\t\t\t$(\".member-parent\").empty();\n\n\t\t\tif (data.message.user_details.length)\n\t\t\t\t$(\"#load-more\").removeClass(\"hide\");\n\t\t\telse $(\"#search-empty-state\").removeClass(\"hide\");\n\n\t\t\tlet user_details = data.message.user_details;\n\t\t\tuser_details\n\t\t\t\t.replace(/&/g, \"&amp;\")\n\t\t\t\t.replace(/</g, \"&lt;\")\n\t\t\t\t.replace(/\"/g, \"&quot;\");\n\t\t\t$(\".member-parent\").append(user_details);\n\t\t\tupdate_load_more_state(data);\n\t\t},\n\t});\n};\n\nconst close_search_empty_state = (e) => {\n\t$(\"#search-empty-state\").addClass(\"hide\");\n\t$(\"#search-user\").val(\"\").keyup();\n};\n\nconst update_load_more_state = (data) => {\n\t$(\"#load-more\").data(\"start\", data.message.start);\n\t$(\"#load-more\").data(\"count\", data.message.count);\n\tif ($(\".member-card\").length == $(\"#load-more\").data(\"count\")) {\n\t\t$(\"#load-more\").addClass(\"hide\");\n\t}\n};\n"], "filenames": ["lms/www/courses/create.js", "lms/www/people/index.js"], "buggy_code_start_loc": [53, 39], "buggy_code_end_loc": [56, 40], "fixing_code_start_loc": [54, 39], "fixing_code_end_loc": [61, 45], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Generic in GitHub repository frappe/lms prior to 5614a6203fb7d438be8e2b1e3030e4528d170ec4.", "other": {"cve": {"id": "CVE-2023-5555", "sourceIdentifier": "security@huntr.dev", "published": "2023-10-12T11:15:23.740", "lastModified": "2023-10-16T19:23:31.277", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Generic in GitHub repository frappe/lms prior to 5614a6203fb7d438be8e2b1e3030e4528d170ec4."}, {"lang": "es", "value": "Cross-Site Scripting (XSS) gen\u00e9rico en el repositorio de GitHub frappe/lms anterior a 5614a6203fb7d438be8e2b1e3030e4528d170ec4."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 7.1, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 4.2}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security@huntr.dev", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:frappe:frappe_lms:1.0.0:*:*:*:*:*:*:*", "matchCriteriaId": "B81A1AF8-32B4-4D2D-B8DB-A2FB12178542"}]}]}], "references": [{"url": "https://github.com/frappe/lms/commit/5614a6203fb7d438be8e2b1e3030e4528d170ec4", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/f6d688ee-b049-4f85-ac3e-f4d3e29e7b9f", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/frappe/lms/commit/5614a6203fb7d438be8e2b1e3030e4528d170ec4"}}