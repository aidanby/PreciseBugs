{"buggy_code": ["<?php\n/**\n * Plugin Name: Mark User as Spammer\n * Plugin URI: http://korobochkin.com/\n * Description: The ability to mark specific users as spammers like on Multisite install.\n * Author: Kolya Korobochkin\n * Author URI: http://korobochkin.com/\n * Version: 1.0.1\n * Text Domain: mark_user_as_spammer\n * Domain Path: /languages/\n * Requires at least: 4.1.1\n * Tested up to: 4.1.1\n * License: GPLv2 or later\n */\nclass Mark_User_As_Spammer {\n\n\t/*\n\t * @var array $selectors Indexed or empty array with users IDs.\n\t * @see Mark_User_As_Spammer::user_row_actions()\n\t * @see Mark_User_As_Spammer::admin_footer()\n\t */\n\tpublic static $selectors = array();\n\n\t/*\n\t * Do nothing.\n\t *\n\t * @since 1.0.0\n\t */\n\tprivate function __construct() {}\n\n\t/*\n\t * Run this stuff at the end of the file.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function run() {\n\t\tadd_action( 'plugins_loaded', array( __CLASS__, 'plugins_loaded' ) );\n\t\tadd_filter( 'authenticate', array( __CLASS__, 'authenticate' ), 99 );\n\t\tif ( is_admin() ) {\n\t\t\tadd_filter( 'user_row_actions', array( __CLASS__, 'user_row_actions' ), 10, 2);\n\t\t\tadd_action( 'load-users.php', array( __CLASS__, 'load_users_page' ) );\n\t\t\tadd_action( 'admin_notices',  array( __CLASS__, 'admin_notices' ) );\n\t\t}\n\t}\n\n\t/*\n\t * Load textdomain.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function plugins_loaded() {\n\t\tload_plugin_textdomain( 'mark_user_as_spammer', false, dirname( plugin_basename( __FILE__ ) ) . '/languages' );\n\t}\n\n\t/*\n\t * If user have meta mark_user_as_spammer (meta_key) and this meta equal === '1' (meta_value)\n\t * we don't allow to auth on site. It's the same method like Multisite uses.\n\t *\n\t * @since 1.0.0\n\t * @param object $user WordPress user object\n\t * @return object WordPress user object or WP_Error object with error description.\n\t */\n\tpublic static function authenticate( $user ) {\n\t\tif ( $user instanceof WP_User ) {\n\t\t\t$meta = get_user_meta( $user->ID, 'mark_user_as_spammer', true);\n\t\t\tif ( $meta === '1' ) {\n\t\t\t\t// Text copied from wp-includes/user.php (line 217)\n\t\t\t\treturn new WP_Error( 'spammer_account', __( '<strong>ERROR</strong>: Your account has been marked as a spammer.' ) );\n\t\t\t}\n\t\t}\n\t\t// Return $user if object is not an instantiated object of a WP_User class\n\t\treturn $user;\n\t}\n\n\t/*\n\t * Add link (<a href...) to user actions (on /wp-admin/users.php)\n\t * which can contain Ban or Unban actions (with nonces for protect site).\n\t *\n\t * @since 1.0.0\n\t * @param array $actions Array of actions (links) for each user.\n\t * @param object $user_object WordPress user object\n\t */\n\tpublic static function user_row_actions( $actions, $user_object ) {\n\t\t$meta = get_user_meta( $user_object->ID, 'mark_user_as_spammer', true);\n\n\t\t$is_spammer = false;\n\t\tif ( $meta === '1' ) {\n\t\t\t$is_spammer = true;\n\t\t\tself::$selectors[] = $user_object->ID;\n\t\t}\n\t\tunset( $meta );\n\n\t\t$url = add_query_arg(\n\t\t\tarray(\n\t\t\t\t'mark_user_as_spammer_action' => $is_spammer ? 'unban' : 'ban',\n\t\t\t\t'user_id' => $user_object->ID\n\t\t\t)\n\t\t);\n\n\t\t$url = wp_nonce_url(\n\t\t\t$url,\n\t\t\t( $is_spammer ? 'mark_user_as_spammer_unban_' : 'mark_user_as_spammer_ban_' ) . $user_object->ID,\n\t\t\t'mark_user_as_spammer_nonce'\n\t\t);\n\n\t\t$actions['spammer'] = '<a href=\"'\n\t\t\t. site_url( $url )\n\t\t\t. '\" class=\"mark-user-as-spammer\" title=\"' . (\n\t\t\t\t$is_spammer ?\n\t\t\t\t\tesc_attr_x ('Unban user. He will be able to log in on site.', 'Verb. Mark user (account) like non spammer account', 'mark_user_as_spammer')\n\t\t\t\t\t:\n\t\t\t\t\tesc_attr_x ('Ban user. He will not be able to log in on site and get an error that his account marked as spammer.', 'Verb. Mark user (account) like spammer account', 'mark_user_as_spammer')\n\t\t\t) .'\">'\n\t\t\t. (\n\t\t\t\t$is_spammer ?\n\t\t\t\t\t_x ('Unban', 'Verb. Mark user (account) like non spammer account', 'mark_user_as_spammer')\n\t\t\t\t\t:\n\t\t\t\t\t_x ('Ban', 'Verb. Mark user (account) like spammer account', 'mark_user_as_spammer')\n\t\t\t)\n\t\t    . '</a>';\n\t\treturn $actions;\n\t}\n\n\t/*\n\t * During load users page add admin_footer action for output styles for banned users (they marked with red background).\n\t * Check if current request contain an information related to this plugin.\n\t * If yes we trying to ban or unban user.\n\t * If request with update_user_meta return an error our plugin output the red (error) notice on page.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function load_users_page() {\n\t\t// Styles for banned accounts (red background)\n\t\tadd_action( 'admin_footer', array( __CLASS__, 'admin_footer' ) );\n\n\t\t// Current request related to this plugin?\n\t\tif (\n\t\t\t! empty( $_GET['mark_user_as_spammer_action'] )\n\t\t\t&&\n\t\t\tin_array( $_GET['mark_user_as_spammer_action'], array ('unban', 'ban'))\n\t\t\t&&\n\t\t\t! empty( $_GET['user_id'] )\n\t\t) {\n\t\t\t$user_id = absint( $_GET['user_id'] );\n\n\t\t\tif( $user_id > 0) {\n\t\t\t\t// No sanitize because we use in_array above\n\t\t\t\t$action = $_GET['mark_user_as_spammer_action'];\n\n\t\t\t\t// Only users with promote_users cap can do this (by default admin and super admin)\n\t\t\t\tif( !current_user_can( 'promote_users' ) ) {\n\t\t\t\t\twp_die( __( 'You do not have the permission to do that!', 'mark_user_as_spammer' ) );\n\t\t\t\t}\n\n\t\t\t\t// Check nonce (WordPress dies if nonce not valid and return 403)\n\t\t\t\tcheck_admin_referer( 'mark_user_as_spammer_' . $action . '_' .  $user_id,  'mark_user_as_spammer_nonce' );\n\n\t\t\t\tswitch ($action) {\n\t\t\t\t\tcase 'ban':\n\t\t\t\t\t\t$user_meta = '1';\n\t\t\t\t\t\t$message = 'spammed';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'unban':\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$user_meta = '0';\n\t\t\t\t\t\t$message = 'unspammed';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Update user meta in DB\n\t\t\t\t$update = update_user_meta(\n\t\t\t\t\t$user_id,\n\t\t\t\t\t'mark_user_as_spammer',\n\t\t\t\t\t$user_meta\n\t\t\t\t);\n\n\t\t\t\t$message = array( 'mark_user_as_spammer' => $message );\n\t\t\t\tif( !$update ) {\n\t\t\t\t\t$message['failed'] = '1';\n\t\t\t\t}\n\n\t\t\t\t// Delete args from URL and do redirect to current page with args with results of operation\n\t\t\t\twp_safe_redirect(\n\t\t\t\t\tadd_query_arg(\n\t\t\t\t\t\t$message, remove_query_arg( array ( 'mark_user_as_spammer_action', 'mark_user_as_spammer_nonce' ) )\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\texit();\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * Shows up the message block which inform about success or failure on block (unblock) user\n\t * Show up the error if update_user_meta return an error (checkout load_users_page() function above).\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function admin_notices() {\n\t\t// Logic grabbed from bbpress/includes/admin/topics.php\n\t\tif(\n\t\t\t!empty( $_GET['mark_user_as_spammer'])\n\t\t\t&&\n\t\t\tin_array( $_GET['mark_user_as_spammer'], array( 'spammed', 'unspammed' ) )\n\t\t\t&&\n\t\t\t!empty( $_GET['user_id'] )\n\t\t) {\n\t\t\t$user_id = absint( $_GET['user_id'] );\n\n\t\t\tif( $user_id > 0 ) {\n\t\t\t\t$is_failure = !empty( $_GET['failed'] ) ? true : false; // Was that a failure?\n\t\t\t\t$action = sanitize_text_field( $_GET['mark_user_as_spammer'] ); // Armor\n\n\t\t\t\tswitch( $action ) {\n\t\t\t\t\tcase 'spammed':\n\t\t\t\t\t\tif( $is_failure ) {\n\t\t\t\t\t\t\t$message = sprintf(\n\t\t\t\t\t\t\t\t_x( 'An error occured during blocking account with ID <code>%1$d</code>.', '%1$s - the account (user) ID (number)', 'mark_user_as_spammer' ),\n\t\t\t\t\t\t\t\t$user_id\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t$message = sprintf(\n\t\t\t\t\t\t\t\t_x( 'Account with ID <code>%1$d</code> have been successfully banned and no longer log in.', '%1$s - the account (user) ID (number)', 'mark_user_as_spammer' ),\n\t\t\t\t\t\t\t\t$user_id\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'unspammed':\n\t\t\t\t\t\tif( $is_failure ) {\n\t\t\t\t\t\t\t$message = sprintf(\n\t\t\t\t\t\t\t\t_x( 'An error occured during unblocing account with ID <code>%1$d</code>.', '%1$s - the account (user) ID (number)', 'mark_user_as_spammer' ),\n\t\t\t\t\t\t\t\t$user_id\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t$message = sprintf(\n\t\t\t\t\t\t\t\t_x( 'Account with ID <code>%1$d</code> have been successfully unbanned and now can log in.', '%1$s - the account (user) ID (number)', 'mark_user_as_spammer' ),\n\t\t\t\t\t\t\t\t$user_id\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$message = __( 'An error occured during something in Mark User as Spammer plugin.', 'mark_user_as_spammer' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t?>\n\t\t\t\t<div class=\"<?php echo $is_failure == true ? 'error' : 'updated'; ?> fade notice is-dismissible\">\n\t\t\t\t\t<p><?php echo $message; ?></p>\n\t\t\t\t</div>\n\t\t\t\t<?php\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * Highlight blocked (banned) users with red background (like Multisite).\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function admin_footer() {\n\t\tif( !empty( self::$selectors ) ) {\n\t\t\t?>\n\t\t\t<style media=\"all\" type=\"text/css\">\n\t\t\t\t<?php foreach( self::$selectors as $selector) {\n\t\t\t\t\techo '#user-' . $selector . ',';\n\t\t\t\t} ?> .mark-user_as_spammer_spammer { background: #faafaa; }\n\t\t\t</style>\n\t\t\t<?php\n\t\t}\n\t}\n\n\t/*\n\t * Uninstall action callback.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function on_uninstall() {\n\t\t// The uninstall plugin must be this file\n\t\t// The current user can activate plugins\n\t\tif( __FILE__ != WP_UNINSTALL_PLUGIN || ! current_user_can( 'activate_plugins') ){\n\t\t\treturn;\n\t\t}\n\n\t\t// Additional check\n\t\tcheck_admin_referer( 'bulk-plugins' );\n\n\t\t// Delete user metas with `mark_user_as_spammer` meta_value\n\t\tglobal $wpdb;\n\t\t$wpdb->delete( $wpdb->usermeta, array( 'meta_key' => 'mark_user_as_spammer' ), array ( '%s' ) );\n\t}\n}\nMark_User_As_Spammer::run();\n\nregister_uninstall_hook( __FILE__, array( 'Mark_User_As_Spammer', 'on_uninstall') );\n?>"], "fixing_code": ["<?php\n/**\n * Plugin Name: Mark User as Spammer\n * Plugin URI: http://korobochkin.com/\n * Description: The ability to mark specific users as spammers like on Multisite install.\n * Author: Kolya Korobochkin\n * Author URI: http://korobochkin.com/\n * Version: 1.0.1\n * Text Domain: mark_user_as_spammer\n * Domain Path: /languages/\n * Requires at least: 4.1.1\n * Tested up to: 4.1.1\n * License: GPLv2 or later\n */\nclass Mark_User_As_Spammer {\n\n\t/*\n\t * @var array $selectors Indexed or empty array with users IDs.\n\t * @see Mark_User_As_Spammer::user_row_actions()\n\t * @see Mark_User_As_Spammer::admin_footer()\n\t */\n\tpublic static $selectors = array();\n\n\t/*\n\t * Do nothing.\n\t *\n\t * @since 1.0.0\n\t */\n\tprivate function __construct() {}\n\n\t/*\n\t * Run this stuff at the end of the file.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function run() {\n\t\tadd_action( 'plugins_loaded', array( __CLASS__, 'plugins_loaded' ) );\n\t\tadd_filter( 'authenticate', array( __CLASS__, 'authenticate' ), 99 );\n\t\tif ( is_admin() ) {\n\t\t\tadd_filter( 'user_row_actions', array( __CLASS__, 'user_row_actions' ), 10, 2);\n\t\t\tadd_action( 'load-users.php', array( __CLASS__, 'load_users_page' ) );\n\t\t\tadd_action( 'admin_notices',  array( __CLASS__, 'admin_notices' ) );\n\t\t}\n\t}\n\n\t/*\n\t * Load textdomain.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function plugins_loaded() {\n\t\tload_plugin_textdomain( 'mark_user_as_spammer', false, dirname( plugin_basename( __FILE__ ) ) . '/languages' );\n\t}\n\n\t/*\n\t * If user have meta mark_user_as_spammer (meta_key) and this meta equal === '1' (meta_value)\n\t * we don't allow to auth on site. It's the same method like Multisite uses.\n\t *\n\t * @since 1.0.0\n\t * @param object $user WordPress user object\n\t * @return object WordPress user object or WP_Error object with error description.\n\t */\n\tpublic static function authenticate( $user ) {\n\t\tif ( $user instanceof WP_User ) {\n\t\t\t$meta = get_user_meta( $user->ID, 'mark_user_as_spammer', true);\n\t\t\tif ( $meta === '1' ) {\n\t\t\t\t// Text copied from wp-includes/user.php (line 217)\n\t\t\t\treturn new WP_Error( 'spammer_account', __( '<strong>ERROR</strong>: Your account has been marked as a spammer.' ) );\n\t\t\t}\n\t\t}\n\t\t// Return $user if object is not an instantiated object of a WP_User class\n\t\treturn $user;\n\t}\n\n\t/*\n\t * Add link (<a href...) to user actions (on /wp-admin/users.php)\n\t * which can contain Ban or Unban actions (with nonces for protect site).\n\t *\n\t * @since 1.0.0\n\t * @param array $actions Array of actions (links) for each user.\n\t * @param object $user_object WordPress user object\n\t */\n\tpublic static function user_row_actions( $actions, $user_object ) {\n\t\t$meta = get_user_meta( $user_object->ID, 'mark_user_as_spammer', true);\n\n\t\t$is_spammer = false;\n\t\tif ( $meta === '1' ) {\n\t\t\t$is_spammer = true;\n\t\t\tself::$selectors[] = $user_object->ID;\n\t\t}\n\t\tunset( $meta );\n\n\t\t$url = add_query_arg(\n\t\t\tarray(\n\t\t\t\t'mark_user_as_spammer_action' => $is_spammer ? 'unban' : 'ban',\n\t\t\t\t'user_id' => $user_object->ID\n\t\t\t)\n\t\t);\n\n\t\t$url = wp_nonce_url(\n\t\t\t$url,\n\t\t\t( $is_spammer ? 'mark_user_as_spammer_unban_' : 'mark_user_as_spammer_ban_' ) . $user_object->ID,\n\t\t\t'mark_user_as_spammer_nonce'\n\t\t);\n\n\t\t$url = site_url( $url );\n\n\t\t/*\n\t\t * Always use esc_url() before output link!\n\t\t * wp_nonce_url() already pass url to esc_html and script tags will be encoded but we need armor to protect URL from XSS\n\t\t */\n\t\t$url = esc_url( $url );\n\n\t\t$actions['spammer'] = '<a href=\"'\n\t\t\t. $url\n\t\t\t. '\" class=\"mark-user-as-spammer\" title=\"' . (\n\t\t\t\t$is_spammer ?\n\t\t\t\t\tesc_attr_x ('Unban user. He will be able to log in on site.', 'Verb. Mark user (account) like non spammer account', 'mark_user_as_spammer')\n\t\t\t\t\t:\n\t\t\t\t\tesc_attr_x ('Ban user. He will not be able to log in on site and get an error that his account marked as spammer.', 'Verb. Mark user (account) like spammer account', 'mark_user_as_spammer')\n\t\t\t) .'\">'\n\t\t\t. (\n\t\t\t\t$is_spammer ?\n\t\t\t\t\t_x ('Unban', 'Verb. Mark user (account) like non spammer account', 'mark_user_as_spammer')\n\t\t\t\t\t:\n\t\t\t\t\t_x ('Ban', 'Verb. Mark user (account) like spammer account', 'mark_user_as_spammer')\n\t\t\t)\n\t\t    . '</a>';\n\t\treturn $actions;\n\t}\n\n\t/*\n\t * During load users page add admin_footer action for output styles for banned users (they marked with red background).\n\t * Check if current request contain an information related to this plugin.\n\t * If yes we trying to ban or unban user.\n\t * If request with update_user_meta return an error our plugin output the red (error) notice on page.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function load_users_page() {\n\t\t// Styles for banned accounts (red background)\n\t\tadd_action( 'admin_footer', array( __CLASS__, 'admin_footer' ) );\n\n\t\t// Current request related to this plugin?\n\t\tif (\n\t\t\t! empty( $_GET['mark_user_as_spammer_action'] )\n\t\t\t&&\n\t\t\tin_array( $_GET['mark_user_as_spammer_action'], array ('unban', 'ban'))\n\t\t\t&&\n\t\t\t! empty( $_GET['user_id'] )\n\t\t) {\n\t\t\t$user_id = absint( $_GET['user_id'] );\n\n\t\t\tif( $user_id > 0) {\n\t\t\t\t// No sanitize because we use in_array above\n\t\t\t\t$action = $_GET['mark_user_as_spammer_action'];\n\n\t\t\t\t// Only users with promote_users cap can do this (by default admin and super admin)\n\t\t\t\tif( !current_user_can( 'promote_users' ) ) {\n\t\t\t\t\twp_die( __( 'You do not have the permission to do that!', 'mark_user_as_spammer' ) );\n\t\t\t\t}\n\n\t\t\t\t// Check nonce (WordPress dies if nonce not valid and return 403)\n\t\t\t\tcheck_admin_referer( 'mark_user_as_spammer_' . $action . '_' .  $user_id,  'mark_user_as_spammer_nonce' );\n\n\t\t\t\tswitch ($action) {\n\t\t\t\t\tcase 'ban':\n\t\t\t\t\t\t$user_meta = '1';\n\t\t\t\t\t\t$message = 'spammed';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'unban':\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$user_meta = '0';\n\t\t\t\t\t\t$message = 'unspammed';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Update user meta in DB\n\t\t\t\t$update = update_user_meta(\n\t\t\t\t\t$user_id,\n\t\t\t\t\t'mark_user_as_spammer',\n\t\t\t\t\t$user_meta\n\t\t\t\t);\n\n\t\t\t\t$message = array( 'mark_user_as_spammer' => $message );\n\t\t\t\tif( !$update ) {\n\t\t\t\t\t$message['failed'] = '1';\n\t\t\t\t}\n\n\t\t\t\t// Delete args from URL and do redirect to current page with args with results of operation\n\t\t\t\twp_safe_redirect(\n\t\t\t\t\tadd_query_arg(\n\t\t\t\t\t\t$message, remove_query_arg( array ( 'mark_user_as_spammer_action', 'mark_user_as_spammer_nonce' ) )\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\texit();\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * Shows up the message block which inform about success or failure on block (unblock) user\n\t * Show up the error if update_user_meta return an error (checkout load_users_page() function above).\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function admin_notices() {\n\t\t// Logic grabbed from bbpress/includes/admin/topics.php\n\t\tif(\n\t\t\t!empty( $_GET['mark_user_as_spammer'])\n\t\t\t&&\n\t\t\tin_array( $_GET['mark_user_as_spammer'], array( 'spammed', 'unspammed' ) )\n\t\t\t&&\n\t\t\t!empty( $_GET['user_id'] )\n\t\t) {\n\t\t\t$user_id = absint( $_GET['user_id'] );\n\n\t\t\tif( $user_id > 0 ) {\n\t\t\t\t$is_failure = !empty( $_GET['failed'] ) ? true : false; // Was that a failure?\n\t\t\t\t$action = sanitize_text_field( $_GET['mark_user_as_spammer'] ); // Armor\n\n\t\t\t\tswitch( $action ) {\n\t\t\t\t\tcase 'spammed':\n\t\t\t\t\t\tif( $is_failure ) {\n\t\t\t\t\t\t\t$message = sprintf(\n\t\t\t\t\t\t\t\t_x( 'An error occured during blocking account with ID <code>%1$d</code>.', '%1$s - the account (user) ID (number)', 'mark_user_as_spammer' ),\n\t\t\t\t\t\t\t\t$user_id\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t$message = sprintf(\n\t\t\t\t\t\t\t\t_x( 'Account with ID <code>%1$d</code> have been successfully banned and no longer log in.', '%1$s - the account (user) ID (number)', 'mark_user_as_spammer' ),\n\t\t\t\t\t\t\t\t$user_id\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'unspammed':\n\t\t\t\t\t\tif( $is_failure ) {\n\t\t\t\t\t\t\t$message = sprintf(\n\t\t\t\t\t\t\t\t_x( 'An error occured during unblocing account with ID <code>%1$d</code>.', '%1$s - the account (user) ID (number)', 'mark_user_as_spammer' ),\n\t\t\t\t\t\t\t\t$user_id\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t$message = sprintf(\n\t\t\t\t\t\t\t\t_x( 'Account with ID <code>%1$d</code> have been successfully unbanned and now can log in.', '%1$s - the account (user) ID (number)', 'mark_user_as_spammer' ),\n\t\t\t\t\t\t\t\t$user_id\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$message = __( 'An error occured during something in Mark User as Spammer plugin.', 'mark_user_as_spammer' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t?>\n\t\t\t\t<div class=\"<?php echo $is_failure == true ? 'error' : 'updated'; ?> fade notice is-dismissible\">\n\t\t\t\t\t<p><?php echo $message; ?></p>\n\t\t\t\t</div>\n\t\t\t\t<?php\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * Highlight blocked (banned) users with red background (like Multisite).\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function admin_footer() {\n\t\tif( !empty( self::$selectors ) ) {\n\t\t\t?>\n\t\t\t<style media=\"all\" type=\"text/css\">\n\t\t\t\t<?php foreach( self::$selectors as $selector) {\n\t\t\t\t\techo '#user-' . $selector . ',';\n\t\t\t\t} ?> .mark-user_as_spammer_spammer { background: #faafaa; }\n\t\t\t</style>\n\t\t\t<?php\n\t\t}\n\t}\n\n\t/*\n\t * Uninstall action callback.\n\t *\n\t * @since 1.0.0\n\t */\n\tpublic static function on_uninstall() {\n\t\t// The uninstall plugin must be this file\n\t\t// The current user can activate plugins\n\t\tif( __FILE__ != WP_UNINSTALL_PLUGIN || ! current_user_can( 'activate_plugins') ){\n\t\t\treturn;\n\t\t}\n\n\t\t// Additional check\n\t\tcheck_admin_referer( 'bulk-plugins' );\n\n\t\t// Delete user metas with `mark_user_as_spammer` meta_value\n\t\tglobal $wpdb;\n\t\t$wpdb->delete( $wpdb->usermeta, array( 'meta_key' => 'mark_user_as_spammer' ), array ( '%s' ) );\n\t}\n}\nMark_User_As_Spammer::run();\n\nregister_uninstall_hook( __FILE__, array( 'Mark_User_As_Spammer', 'on_uninstall') );\n?>"], "filenames": ["plugin/plugin.php"], "buggy_code_start_loc": [105], "buggy_code_end_loc": [108], "fixing_code_start_loc": [106], "fixing_code_end_loc": [116], "type": "CWE-79", "message": "A vulnerability was found in Mark User as Spammer Plugin 1.0.0/1.0.1. It has been declared as problematic. Affected by this vulnerability is the function user_row_actions of the file plugin/plugin.php. The manipulation of the argument url leads to cross site scripting. The attack can be launched remotely. Upgrading to version 1.0.2 is able to address this issue. The name of the patch is e7059727274d2767c240c55c02c163eaa4ba6c62. It is recommended to upgrade the affected component. The identifier VDB-222325 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2015-10093", "sourceIdentifier": "cna@vuldb.com", "published": "2023-03-06T07:15:10.103", "lastModified": "2023-03-10T22:43:58.713", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in Mark User as Spammer Plugin 1.0.0/1.0.1. It has been declared as problematic. Affected by this vulnerability is the function user_row_actions of the file plugin/plugin.php. The manipulation of the argument url leads to cross site scripting. The attack can be launched remotely. Upgrading to version 1.0.2 is able to address this issue. The name of the patch is e7059727274d2767c240c55c02c163eaa4ba6c62. It is recommended to upgrade the affected component. The identifier VDB-222325 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:H/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 2.6, "baseSeverity": "LOW"}, "exploitabilityScore": 1.2, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:H/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "HIGH", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 2.1}, "baseSeverity": "LOW", "exploitabilityScore": 3.9, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:mark_user_as_spammer_project:mark_user_as_spammer:1.0.0:*:*:*:*:wordpress:*:*", "matchCriteriaId": "E08C5F02-BF4D-4B6F-A419-01069655A9D3"}, {"vulnerable": true, "criteria": "cpe:2.3:a:mark_user_as_spammer_project:mark_user_as_spammer:1.0.1:*:*:*:*:wordpress:*:*", "matchCriteriaId": "F59B14AB-53B5-4CDD-995F-95054DA80DC9"}]}]}], "references": [{"url": "https://github.com/korobochkin/mark-user-as-spammer/commit/e7059727274d2767c240c55c02c163eaa4ba6c62", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/korobochkin/mark-user-as-spammer/releases/tag/v1.0.2", "source": "cna@vuldb.com", "tags": ["Release Notes"]}, {"url": "https://vuldb.com/?ctiid.222325", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.222325", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/korobochkin/mark-user-as-spammer/commit/e7059727274d2767c240c55c02c163eaa4ba6c62"}}