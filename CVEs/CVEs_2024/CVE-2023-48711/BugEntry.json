{"buggy_code": ["{\n  \"name\": \"google-translate-api-browser\",\n  \"version\": \"4.1.1\",\n  \"description\": \"A free and unlimited API for Google Translate that works in browser\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/cjvnjde/google-translate-api-browser\"\n  },\n  \"scripts\": {\n    \"build\": \"webpack\",\n    \"watch\": \"webpack --watch\"\n  },\n  \"exports\": {\n    \"types\": {\n      \"node\": \"./dist/index.server.d.ts\",\n      \"browser\": \"./dist/index.browser.d.ts\"\n    },\n    \"node\": {\n      \"require\": \"./dist/node/cjs.js\"\n    },\n    \"browser\": {\n      \"require\": \"./dist/browser/cjs.js\",\n      \"import\": \"./dist/browser/esm.js\"\n    }\n  },\n  \"keywords\": [\n    \"translate\",\n    \"translator\",\n    \"google\",\n    \"translate\",\n    \"api\",\n    \"free\",\n    \"language\"\n  ],\n  \"author\": {\n    \"name\": \"Vitalij Nykyforenko\",\n    \"email\": \"vitalij.nykyforenko@gmail.com\"\n  },\n  \"license\": \"MIT\",\n  \"devDependencies\": {\n    \"@types/node\": \"^18.13.0\",\n    \"ts-loader\": \"^9.4.2\",\n    \"typescript\": \"4.9.5\",\n    \"webpack\": \"^5.89.0\",\n    \"webpack-cli\": \"^5.0.1\"\n  }\n}\n", "import { defaultTranslateOptions } from \"./defaultTranslateOptions\";\nimport { TranslateOptions } from \"./TranslateOptions\";\n\nexport function generateRequestUrl(options: Partial<Omit<TranslateOptions, 'raw'>> = {}): string {\n  const translateOptions = { ...defaultTranslateOptions, ...options };\n\n  const queryParams = {\n    rpcids: translateOptions.rpcids,\n    'source-path': '/',\n    hl: translateOptions.hl,\n    'soc-app': '1',\n    'soc-platform': '1',\n    'soc-device': '1',\n    rt: 'c'\n  };\n  const searchParams = new URLSearchParams(queryParams);\n\n  return `https://translate.google.${translateOptions.tld}/_/TranslateWebserverUi/data/batchexecute?${searchParams}`;\n}\n", "export type LanguageData = {\n  language: {\n    didYouMean: boolean;\n    iso: string;\n  };\n  text: {\n    autoCorrected: boolean;\n    value: string;\n    didYouMean: boolean;\n  }\n}\n\nexport type TranslationResult = {\n  text: string;\n  pronunciation: string;\n  from: LanguageData;\n  raw?: any;\n}\n\nexport function normaliseResponse(rawBody: string, raw = false): TranslationResult {\n  const content = rawBody.match(/\"\\[.*]\"/)\n\n  let data: any[] | null = null\n\n  if (content) {\n    let valuableContent = content[0]\n\n    data = JSON.parse(JSON.parse(valuableContent))\n  }\n\n  if (!data) {\n    throw new Error('No data')\n  }\n\n  const result: TranslationResult = {\n    text: data[1][0][0][5][0][0],\n    pronunciation: data[0][0],\n    from: {\n      language: {\n        didYouMean: Boolean(data[0][1]),\n        iso: data[2],\n      },\n      text: {\n        autoCorrected: Boolean(data[1][0][0][3]),\n        value: Boolean(data[0][1]) ? data[0][1][0][4] : data[0][6][0],\n        didYouMean: Boolean(data[0][1]),\n      },\n    },\n  };\n\n  if (raw) {\n    result.raw = rawBody;\n  }\n\n  return result;\n}\n", "import { generateRequestUrl } from \"./generateRequestUrl\";\nimport { defaultTranslateOptions } from \"./defaultTranslateOptions\";\nimport { TranslateOptions } from \"./TranslateOptions\";\nimport { normaliseResponse, TranslationResult } from \"./normaliseResponse\";\nimport * as https from 'node:https';\n\nexport function translate(text: string, options: Partial<TranslateOptions> = {}): Promise<TranslationResult> {\n  const translateOptions = { ...defaultTranslateOptions, ...options };\n\n  return new Promise((resolve, reject) => {\n    const encodedData = encodeURIComponent(`[[[\"${translateOptions.rpcids}\",\"[[\\\\\"${text}\\\\\",\\\\\"${translateOptions.from}\\\\\",\\\\\"${translateOptions.to}\\\\\",true],[1]]\",null,\"generic\"]]]`);\n    const body = `f.req=${encodedData}&`;\n\n    const url = generateRequestUrl(translateOptions);\n\n    const req = https.request(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Content-Length': Buffer.byteLength(body)\n      }\n    }, (resp) => {\n      let data = '';\n\n      resp.on('data', (chunk) => {\n        data += chunk;\n      });\n\n      resp.on('end', () => {\n        resolve(normaliseResponse(data))\n      });\n    }).on('error', (err) => {\n      reject(err)\n    })\n\n    req.write(body);\n    req.end();\n  })\n}\n"], "fixing_code": ["{\n  \"name\": \"google-translate-api-browser\",\n  \"version\": \"4.1.3\",\n  \"description\": \"A free and unlimited API for Google Translate that works in browser\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/cjvnjde/google-translate-api-browser\"\n  },\n  \"scripts\": {\n    \"build\": \"webpack\",\n    \"watch\": \"webpack --watch\"\n  },\n  \"exports\": {\n    \"types\": {\n      \"node\": \"./dist/index.server.d.ts\",\n      \"browser\": \"./dist/index.browser.d.ts\"\n    },\n    \"node\": {\n      \"require\": \"./dist/node/cjs.js\"\n    },\n    \"browser\": {\n      \"require\": \"./dist/browser/cjs.js\",\n      \"import\": \"./dist/browser/esm.js\"\n    }\n  },\n  \"keywords\": [\n    \"translate\",\n    \"translator\",\n    \"google\",\n    \"translate\",\n    \"api\",\n    \"free\",\n    \"language\"\n  ],\n  \"author\": {\n    \"name\": \"Vitalij Nykyforenko\",\n    \"email\": \"vitalij.nykyforenko@gmail.com\"\n  },\n  \"license\": \"MIT\",\n  \"devDependencies\": {\n    \"@types/node\": \"^18.13.0\",\n    \"ts-loader\": \"^9.4.2\",\n    \"typescript\": \"4.9.5\",\n    \"webpack\": \"^5.89.0\",\n    \"webpack-cli\": \"^5.0.1\"\n  }\n}\n", "import { defaultTranslateOptions } from \"./defaultTranslateOptions\";\nimport { TranslateOptions } from \"./TranslateOptions\";\n\nfunction validateTLD(tld: string) {\n  return Boolean(tld.match(/^[a-zA-Z]{2,63}$/));\n}\n\nexport function generateRequestUrl(options: Partial<Omit<TranslateOptions, 'raw'>> = {}): string {\n  const translateOptions = { ...defaultTranslateOptions, ...options };\n\n  if (!validateTLD(translateOptions.tld)) {\n    throw new Error(\"Invalid TLD: Must be 2-63 letters only\")\n  }\n\n  const queryParams = {\n    rpcids: translateOptions.rpcids,\n    'source-path': '/',\n    hl: translateOptions.hl,\n    'soc-app': '1',\n    'soc-platform': '1',\n    'soc-device': '1',\n    rt: 'c'\n  };\n  const searchParams = new URLSearchParams(queryParams);\n\n  return `https://translate.google.${translateOptions.tld}/_/TranslateWebserverUi/data/batchexecute?${searchParams}`;\n}\n", "export type LanguageData = {\n  language: {\n    didYouMean: boolean;\n    iso: string;\n  };\n  text: {\n    autoCorrected: boolean;\n    value: string;\n    didYouMean: boolean;\n  }\n}\n\nexport type TranslationResult = {\n  text: string;\n  pronunciation: string;\n  from: LanguageData;\n  raw?: any;\n}\n\nexport function normaliseResponse(rawBody: string, raw = false): TranslationResult {\n  const content = rawBody.match(/\"\\[.*]\"/)\n\n  let data: any[] | null = null\n\n  if (content) {\n    let valuableContent = content[0]\n\n    data = JSON.parse(JSON.parse(valuableContent))\n  }\n\n  if (!data) {\n    throw new Error('Data is either empty or corrupted')\n  }\n\n  const result: TranslationResult = {\n    text: data[1][0][0][5][0][0],\n    pronunciation: data[0][0],\n    from: {\n      language: {\n        didYouMean: Boolean(data[0][1]),\n        iso: data[2],\n      },\n      text: {\n        autoCorrected: Boolean(data[1][0][0][3]),\n        value: Boolean(data[0][1]) ? data[0][1][0][4] : data[0][6][0],\n        didYouMean: Boolean(data[0][1]),\n      },\n    },\n  };\n\n  if (raw) {\n    result.raw = rawBody;\n  }\n\n  return result;\n}\n", "import { generateRequestUrl } from \"./generateRequestUrl\";\nimport { defaultTranslateOptions } from \"./defaultTranslateOptions\";\nimport { TranslateOptions } from \"./TranslateOptions\";\nimport { normaliseResponse, TranslationResult } from \"./normaliseResponse\";\nimport * as https from 'node:https';\n\nexport function createRequestBody(text: string, translateOptions: Pick<TranslateOptions, \"to\" | \"from\" | \"rpcids\">) {\n    const encodedData = encodeURIComponent(`[[[\"${translateOptions.rpcids}\",\"[[\\\\\"${text}\\\\\",\\\\\"${translateOptions.from}\\\\\",\\\\\"${translateOptions.to}\\\\\",true],[1]]\",null,\"generic\"]]]`);\n    return `f.req=${encodedData}&`;\n}\n\nexport function translate(text: string, options: Partial<TranslateOptions> = {}): Promise<TranslationResult> {\n  const translateOptions = { ...defaultTranslateOptions, ...options };\n\n  return new Promise((resolve, reject) => {\n    const body = createRequestBody(text, translateOptions);\n    const url = generateRequestUrl(translateOptions);\n\n    const req = https.request(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Content-Length': Buffer.byteLength(body)\n      }\n    }, (resp) => {\n      let data = '';\n\n      resp.on('data', (chunk) => {\n        data += chunk;\n      });\n\n      resp.on('end', () => {\n        resolve(normaliseResponse(data))\n      });\n    }).on('error', reject);\n\n    req.write(body);\n    req.end();\n  })\n}\n"], "filenames": ["package.json", "src/generateRequestUrl.ts", "src/normaliseResponse.ts", "src/translate.server.ts"], "buggy_code_start_loc": [3, 3, 32, 6], "buggy_code_end_loc": [4, 5, 33, 35], "fixing_code_start_loc": [3, 4, 32, 7], "fixing_code_end_loc": [4, 14, 33, 36], "type": "CWE-918", "message": "google-translate-api-browser is an npm package which interfaces with the google translate web api. A Server-Side Request Forgery (SSRF) Vulnerability is present in applications utilizing the `google-translate-api-browser` package and exposing the `translateOptions` to the end user. An attacker can set a malicious `tld`, causing the application to return unsafe URLs pointing towards local resources. The `translateOptions.tld` field is not properly sanitized before being placed in the Google translate URL. This can allow an attacker with control over the `translateOptions` to set the `tld` to a payload such as `@127.0.0.1`. This causes the full URL to become `https://translate.google.@127.0.0.1/...`, where `translate.google.` is the username used to connect to localhost. An attacker can send requests within internal networks and the local host. Should any HTTPS application be present on the internal network with a vulnerability exploitable via a GET call, then it would be possible to exploit this using this vulnerability. This issue has been addressed in release version 4.1.3. Users are advised to upgrade. There are no known workarounds for this vulnerability.", "other": {"cve": {"id": "CVE-2023-48711", "sourceIdentifier": "security-advisories@github.com", "published": "2023-11-24T17:15:07.563", "lastModified": "2023-12-01T20:13:43.540", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "google-translate-api-browser is an npm package which interfaces with the google translate web api. A Server-Side Request Forgery (SSRF) Vulnerability is present in applications utilizing the `google-translate-api-browser` package and exposing the `translateOptions` to the end user. An attacker can set a malicious `tld`, causing the application to return unsafe URLs pointing towards local resources. The `translateOptions.tld` field is not properly sanitized before being placed in the Google translate URL. This can allow an attacker with control over the `translateOptions` to set the `tld` to a payload such as `@127.0.0.1`. This causes the full URL to become `https://translate.google.@127.0.0.1/...`, where `translate.google.` is the username used to connect to localhost. An attacker can send requests within internal networks and the local host. Should any HTTPS application be present on the internal network with a vulnerability exploitable via a GET call, then it would be possible to exploit this using this vulnerability. This issue has been addressed in release version 4.1.3. Users are advised to upgrade. There are no known workarounds for this vulnerability."}, {"lang": "es", "value": "google-translate-api-browser es un paquete npm que interact\u00faa con la API web del traductor de Google. Una vulnerabilidad de Server-Side Request Forgery (SSRF) est\u00e1 presente en aplicaciones que utilizan el paquete `google-translate-api-browser` y exponen `translateOptions` al usuario final. Un atacante puede configurar un \"tld\" malicioso, lo que hace que la aplicaci\u00f3n devuelva URL no seguras que apunten a recursos locales. El campo `translateOptions.tld` no se sanitiza adecuadamente antes de colocarlo en la URL del traductor de Google. Esto puede permitir que un atacante con control sobre `translateOptions` establezca el `tld` en un payload como `@127.0.0.1`. Esto hace que la URL completa se convierta en `https://translate.google.@127.0.0.1/...`, donde `translate.google.` es el nombre de usuario utilizado para conectarse a localhost. Un atacante puede enviar solicitudes dentro de las redes internas y del host local. Si alguna aplicaci\u00f3n HTTPS estuviera presente en la red interna con una vulnerabilidad explotable mediante una llamada GET, entonces ser\u00eda posible explotarla utilizando esta vulnerabilidad. Este problema se solucion\u00f3 en la versi\u00f3n 4.1.3. Se recomienda a los usuarios que actualicen. No se conocen workarounds para esta vulnerabilidad."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.7, "baseSeverity": "LOW"}, "exploitabilityScore": 2.2, "impactScore": 1.4}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.7, "baseSeverity": "LOW"}, "exploitabilityScore": 2.2, "impactScore": 1.4}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-918"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:cjvnjde:google_translate_api_browser:*:*:*:*:*:*:*:*", "versionEndExcluding": "4.1.3", "matchCriteriaId": "A73DA45E-F35C-4348-ACBE-222AA968B50E"}]}]}], "references": [{"url": "https://github.com/cjvnjde/google-translate-api-browser/commit/33c2eac4a21c6504409e7b06dd16e6346f93d34b", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/cjvnjde/google-translate-api-browser/security/advisories/GHSA-4233-7q5q-m7p6", "source": "security-advisories@github.com", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/cjvnjde/google-translate-api-browser/commit/33c2eac4a21c6504409e7b06dd16e6346f93d34b"}}