{"buggy_code": ["<?php\r\n\r\nclass SOYInquiryApplication{\r\n\r\n\tfunction init(){\r\n\r\n\t\t$level = CMSApplication::getAppAuthLevel();\r\n\r\n\t\tCMSApplication::setTabs(array(\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u65b0\u7740\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID),\r\n\t\t\t\t\"icon\" => \"home\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u554f\u3044\u5408\u308f\u305b\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID . \".Inquiry\"),\r\n\t\t\t\t\"icon\" => \"list-alt\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u30d5\u30a9\u30fc\u30e0\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID . \".Form\"),\r\n\t\t\t\t\"icon\" => \"edit\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u8a2d\u5b9a\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID . \".Config\"),\r\n\t\t\t\t\"visible\" => ($level == 1) ? true : false,\r\n\t\t\t\t\"icon\" => \"cog\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u30d8\u30eb\u30d7\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID . \".Help\"),\r\n\t\t\t\t\"visible\" => ($level == 1) ? true : false,\r\n\t\t\t\t\"icon\" => \"question\"\r\n\t\t\t)\r\n\t\t));\r\n\r\n\t\tCMSApplication::main(array($this,\"main\"));\r\n\r\n\t\tCMSApplication::addLink(SOY2PageController::createRelativeLink(\"./webapp/\" . APPLICATION_ID . \"/js/tools/soy2_data_picker.css\"));\r\n\t\tCMSApplication::addScript(SOY2PageController::createRelativeLink(\"./webapp/\" . APPLICATION_ID . \"/js/tools/soy2_data_picker.js\"));\r\n\r\n\t\t//\u8a2d\u5b9a\u306e\u8aad\u307f\u8fbc\u307f\r\n\t\tinclude_once(dirname(__FILE__) . \"/config.php\");\r\n\r\n\t\t//DB\u306e\u521d\u671f\u5316\u3092\u884c\u3046\r\n\t\tif(!file_exists(SOYINQUIRY_DB_FILE)){\r\n\t\t\tSOY2Logic::createInstance(\"logic.InitLogic\", array(\r\n\t\t\t\t\"initCheckFile\" => SOYINQUIRY_DB_FILE,\r\n\t\t\t))->init();\r\n\t\t}\r\n\r\n\t\t//SOY2HTML\u306e\u8a2d\u5b9a\r\n\t\tSOY2HTMLPlugin::addPlugin(\"page\",\"PagePlugin\");\r\n\t\tSOY2HTMLPlugin::addPlugin(\"link\",\"LinkPlugin\");\r\n\t\tSOY2HTMLPlugin::addPlugin(\"src\",\"SrcPlugin\");\r\n\t\tSOY2HTMLPlugin::addPlugin(\"display\",\"DisplayPlugin\");\r\n\t\tSOY2HTMLPlugin::addPlugin(\"panel\",\"PanelPlugin\");\r\n\r\n\t\t//CSS\u306e\u8aad\u307f\u8fbc\u307f\r\n\t\t$cssLink = SOY2PageController::createRelativeLink(\"./webapp/\".APPLICATION_ID.\"/css/three.css\");\r\n\t\tif(method_exists(\"CMSApplication\", \"getVersion\")){\r\n\t\t\t$cssLink .= \"?\".CMSApplication::getVersion();\r\n\t\t}\r\n\t\tCMSApplication::addLink($cssLink);\r\n\r\n\t}\r\n\r\n\tfunction main(){\r\n\r\n\t\t//\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u30d0\u30c3\u30c1\r\n\t\tif(isset($_GET[\"bat\"]) && file_exists(dirname(__FILE__) . \"/src/bat/\" . $_GET[\"bat\"] . \".php\")){\r\n\t\t\tinclude(dirname(__FILE__) . \"/src/bat/\" . $_GET[\"bat\"] . \".php\");\r\n\t\t\texit;\r\n\t\t}\r\n\r\n\t\t$arguments = CMSApplication::getArguments();\r\n\r\n\t\t$classPath = array();\r\n\t\t$args = array();\r\n\t\t$flag = false;\r\n\t\tforeach($arguments as $key => $value){\r\n\t\t\tif(is_numeric($value)){\r\n\t\t\t\t$flag = true;\r\n\t\t\t}\r\n\r\n\t\t\tif($flag){\r\n\t\t\t\t$args[] = $value;\r\n\t\t\t}else{\r\n\t\t\t\t$classPath[] = $value;\r\n\t\t\t}\r\n\t\t}\r\n\t\t$path = implode(\".\",$classPath);\r\n\t\t$classPath = $path;\r\n\r\n\t\tif(strlen($classPath)<1)$classPath = \"Index\";\r\n\t\t$classPath .= 'Page';\r\n\r\n\t\t//\u4e00\u56de\u3060\u3051IndexPage\u3092\u8a66\u3059\u3002\r\n\t\tif(!SOY2HTMLFactory::pageExists($classPath)){\r\n\t\t\t$classPath = $path;\r\n\r\n\t\t\tif(!preg_match('/.+Page$/',$classPath)){\r\n\t\t\t\t$classPath .= '.IndexPage';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\u30bf\u30d6\u306e\u8a2d\u5b9a\r\n\t\tif(preg_match('/^Inquiry/',$classPath)){\r\n\t\t\tCMSApplication::setActiveTab(1);\r\n\t\t}\r\n\t\tif(preg_match('/^Form/',$classPath)){\r\n\t\t\tCMSApplication::setActiveTab(2);\r\n\t\t}\r\n\t\tif(preg_match('/^Config/',$classPath)){\r\n\t\t\tCMSApplication::setActiveTab(3);\r\n\t\t}\r\n\t\tif(preg_match('/^Help/',$classPath)){\r\n\t\t\tCMSApplication::setActiveTab(4);\r\n\t\t}\r\n\r\n\t\tif(!SOY2HTMLFactory::pageExists($classPath)){\r\n\t\t\treturn $classPath;\r\n\t\t}\r\n\r\n\t\t$webPage = &SOY2HTMLFactory::createInstance($classPath, array(\r\n\t\t\t\"arguments\" => $args\r\n\t\t));\r\n\r\n\t\ttry{\r\n\t\t\tob_start();\r\n\t\t\t$webPage->display();\r\n\t\t\t$html = ob_get_contents();\r\n\t\t\tob_end_clean();\r\n\t\t}catch(Exception $e){\r\n\r\n\t\t}\r\n\r\n\t\treturn $html;\r\n\t}\r\n\r\n}\r\n\r\n$app = new SOYInquiryApplication();\r\n$app->init();\r\n"], "fixing_code": ["<?php\r\n\r\nclass SOYInquiryApplication{\r\n\r\n\tfunction init(){\r\n\r\n\t\t$level = CMSApplication::getAppAuthLevel();\r\n\r\n\t\tCMSApplication::setTabs(array(\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u65b0\u7740\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID),\r\n\t\t\t\t\"icon\" => \"home\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u554f\u3044\u5408\u308f\u305b\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID . \".Inquiry\"),\r\n\t\t\t\t\"icon\" => \"list-alt\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u30d5\u30a9\u30fc\u30e0\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID . \".Form\"),\r\n\t\t\t\t\"icon\" => \"edit\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u8a2d\u5b9a\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID . \".Config\"),\r\n\t\t\t\t\"visible\" => ($level == 1) ? true : false,\r\n\t\t\t\t\"icon\" => \"cog\"\r\n\t\t\t),\r\n\t\t\tarray(\r\n\t\t\t\t\"label\" => \"\u30d8\u30eb\u30d7\",\r\n\t\t\t\t\"href\" => SOY2PageController::createLink(APPLICATION_ID . \".Help\"),\r\n\t\t\t\t\"visible\" => ($level == 1) ? true : false,\r\n\t\t\t\t\"icon\" => \"question\"\r\n\t\t\t)\r\n\t\t));\r\n\r\n\t\tCMSApplication::main(array($this,\"main\"));\r\n\r\n\t\tCMSApplication::addLink(SOY2PageController::createRelativeLink(\"./webapp/\" . APPLICATION_ID . \"/js/tools/soy2_data_picker.css\"));\r\n\t\tCMSApplication::addScript(SOY2PageController::createRelativeLink(\"./webapp/\" . APPLICATION_ID . \"/js/tools/soy2_data_picker.js\"));\r\n\r\n\t\t//\u8a2d\u5b9a\u306e\u8aad\u307f\u8fbc\u307f\r\n\t\tinclude_once(dirname(__FILE__) . \"/config.php\");\r\n\r\n\t\t//DB\u306e\u521d\u671f\u5316\u3092\u884c\u3046\r\n\t\tif(!file_exists(SOYINQUIRY_DB_FILE)){\r\n\t\t\tSOY2Logic::createInstance(\"logic.InitLogic\", array(\r\n\t\t\t\t\"initCheckFile\" => SOYINQUIRY_DB_FILE,\r\n\t\t\t))->init();\r\n\t\t}\r\n\r\n\t\t//SOY2HTML\u306e\u8a2d\u5b9a\r\n\t\tSOY2HTMLPlugin::addPlugin(\"page\",\"PagePlugin\");\r\n\t\tSOY2HTMLPlugin::addPlugin(\"link\",\"LinkPlugin\");\r\n\t\tSOY2HTMLPlugin::addPlugin(\"src\",\"SrcPlugin\");\r\n\t\tSOY2HTMLPlugin::addPlugin(\"display\",\"DisplayPlugin\");\r\n\t\tSOY2HTMLPlugin::addPlugin(\"panel\",\"PanelPlugin\");\r\n\r\n\t\t//CSS\u306e\u8aad\u307f\u8fbc\u307f\r\n\t\t$cssLink = SOY2PageController::createRelativeLink(\"./webapp/\".APPLICATION_ID.\"/css/three.css\");\r\n\t\tif(method_exists(\"CMSApplication\", \"getVersion\")){\r\n\t\t\t$cssLink .= \"?\".CMSApplication::getVersion();\r\n\t\t}\r\n\t\tCMSApplication::addLink($cssLink);\r\n\r\n\t}\r\n\r\n\tfunction main(){\r\n\r\n\t\t//\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u30d0\u30c3\u30c1\r\n\t\tif(isset($_GET[\"bat\"]) && file_exists(dirname(__FILE__) . \"/src/bat/\" . $_GET[\"bat\"] . \".php\")){\r\n\t\t\tinclude(dirname(__FILE__) . \"/src/bat/\" . $_GET[\"bat\"] . \".php\");\r\n\t\t\texit;\r\n\t\t}\r\n\r\n\t\t$arguments = CMSApplication::getArguments();\r\n\r\n\t\t$classPath = array();\r\n\t\t$args = array();\r\n\t\t$flag = false;\r\n\t\tforeach($arguments as $key => $value){\r\n\t\t\tif(is_numeric($value)){\r\n\t\t\t\t$flag = true;\r\n\t\t\t}\r\n\r\n\t\t\tif($flag){\r\n\t\t\t\t$args[] = $value;\r\n\t\t\t}else{\r\n\t\t\t\t$classPath[] = $value;\r\n\t\t\t}\r\n\t\t}\r\n\t\t$path = implode(\".\",$classPath);\r\n\t\t$classPath = $path;\r\n\r\n\t\tif(strlen($classPath)<1)$classPath = \"Index\";\r\n\t\t$classPath .= 'Page';\r\n\r\n\t\t//\u4e00\u56de\u3060\u3051IndexPage\u3092\u8a66\u3059\u3002\r\n\t\tif(!SOY2HTMLFactory::pageExists($classPath)){\r\n\t\t\t$classPath = $path;\r\n\r\n\t\t\tif(!preg_match('/.+Page$/',$classPath)){\r\n\t\t\t\t$classPath .= '.IndexPage';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\u30bf\u30d6\u306e\u8a2d\u5b9a\r\n\t\tif(preg_match('/^Inquiry/',$classPath)){\r\n\t\t\tCMSApplication::setActiveTab(1);\r\n\t\t}\r\n\t\tif(preg_match('/^Form/',$classPath)){\r\n\t\t\tCMSApplication::setActiveTab(2);\r\n\t\t}\r\n\t\tif(preg_match('/^Config/',$classPath)){\r\n\t\t\tCMSApplication::setActiveTab(3);\r\n\t\t}\r\n\t\tif(preg_match('/^Help/',$classPath)){\r\n\t\t\tCMSApplication::setActiveTab(4);\r\n\t\t}\r\n\r\n\t\tif(!SOY2HTMLFactory::pageExists($classPath)){\r\n\t\t\treturn \"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\";\r\n\t\t}\r\n\r\n\t\t$webPage = &SOY2HTMLFactory::createInstance($classPath, array(\r\n\t\t\t\"arguments\" => $args\r\n\t\t));\r\n\r\n\t\ttry{\r\n\t\t\tob_start();\r\n\t\t\t$webPage->display();\r\n\t\t\t$html = ob_get_contents();\r\n\t\t\tob_end_clean();\r\n\t\t}catch(Exception $e){\r\n\r\n\t\t}\r\n\r\n\t\treturn $html;\r\n\t}\r\n\r\n}\r\n\r\n$app = new SOYInquiryApplication();\r\n$app->init();\r\n"], "filenames": ["cms/app/webapp/inquiry/admin.php"], "buggy_code_start_loc": [124], "buggy_code_end_loc": [125], "fixing_code_start_loc": [124], "fixing_code_end_loc": [125], "type": "CWE-79", "message": "SoyCMS 3.0.2 and earlier is affected by Reflected Cross-Site Scripting (XSS) which leads to Remote Code Execution (RCE) from a known vulnerability. This allows remote attackers to force the administrator to edit files once the adminsitrator loads a specially crafted webpage.", "other": {"cve": {"id": "CVE-2020-15183", "sourceIdentifier": "security-advisories@github.com", "published": "2020-09-17T20:15:13.417", "lastModified": "2020-09-23T20:00:52.373", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "SoyCMS 3.0.2 and earlier is affected by Reflected Cross-Site Scripting (XSS) which leads to Remote Code Execution (RCE) from a known vulnerability. This allows remote attackers to force the administrator to edit files once the adminsitrator loads a specially crafted webpage."}, {"lang": "es", "value": "SoyCMS versiones 3.0.2 y anteriores, est\u00e1n afectadas por una vulnerabilidad de tipo Cross-Site Scripting (XSS) Reflejado que conlleva a una Ejecuci\u00f3n de C\u00f3digo Remota (RCE) a partir de una vulnerabilidad conocida.&#xa0;Esto permite a atacantes remotos forzar al administrador a editar archivos una vez que el administrador carga una p\u00e1gina web especialmente dise\u00f1ada"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.4, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.7, "impactScore": 6.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:soycms_project:soycms:*:*:*:*:*:*:*:*", "versionEndIncluding": "3.0.2", "matchCriteriaId": "DC0B8010-14FC-4DEC-8396-5532F44A5A2F"}]}]}], "references": [{"url": "https://github.com/inunosinsi/soycms/commit/045a222016f99b56557b0d8f39bbfc653d2c4707", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/inunosinsi/soycms/security/advisories/GHSA-33q6-4xmp-2f48", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}, {"url": "https://youtu.be/uAMAwH35ups", "source": "security-advisories@github.com", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/inunosinsi/soycms/commit/045a222016f99b56557b0d8f39bbfc653d2c4707"}}