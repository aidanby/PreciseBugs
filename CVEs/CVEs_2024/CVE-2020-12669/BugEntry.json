{"buggy_code": ["<?php\n/* Copyright (C) 2005-2015 Laurent Destailleur  <eldy@users.sourceforge.net>\n *\n * This file is a modified version of datepicker.php from phpBSM to fix some\n * bugs, to add new features and to dramatically increase speed.\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n *       \\file       htdocs/core/get_menudiv.php\n *       \\brief      File to return menu into a div tree, to be used by other frontend\n */\n\n//if (! defined('NOREQUIREUSER'))   define('NOREQUIREUSER','1');\t// Not disabled cause need to load personalized language\n//if (! defined('NOREQUIREDB'))   define('NOREQUIREDB','1');\t\t// Not disabled cause need to load personalized language\n//if (! defined('NOREQUIRESOC'))    define('NOREQUIRESOC','1');\n//if (! defined('NOREQUIRETRAN')) define('NOREQUIRETRAN','1');\t\t// Not disabled cause need to do translations\nif (!defined('NOCSRFCHECK'))     define('NOCSRFCHECK', 1);\nif (!defined('NOTOKENRENEWAL'))  define('NOTOKENRENEWAL', 1);\n//if (! defined('NOLOGIN')) define('NOLOGIN',1);\t\t\t\t\t// Not disabled cause need to load personalized language\nif (!defined('NOREQUIREMENU'))  define('NOREQUIREMENU', 1);\nif (!defined('NOREQUIREHTML'))  define('NOREQUIREHTML', 1);\n\nif (!defined('DISABLE_JQUERY_TABLEDND'))   define('DISABLE_JQUERY_TABLEDND', 1);\nif (!defined('DISABLE_JQUERY_JNOTIFY'))    define('DISABLE_JQUERY_JNOTIFY', 1);\nif (!defined('DISABLE_JQUERY_FLOT'))       define('DISABLE_JQUERY_FLOT', 1);\nif (!defined('DISABLE_JQUERY_JEDITABLE'))  define('DISABLE_JQUERY_JEDITABLE', 1);\nif (!defined('DISABLE_CKEDITOR'))          define('DISABLE_CKEDITOR', 1);\nif (!defined('DISABLE_BROWSER_NOTIF'))     define('DISABLE_BROWSER_NOTIF', 1);\nif (!defined('DISABLE_DATE_PICKER'))       define('DISABLE_DATE_PICKER', 1);\nif (!defined('DISABLE_SELECT2'))           define('DISABLE_SELECT2', 1);\n\nrequire_once '../main.inc.php';\n\nif (GETPOST('lang', 'aZ09')) $langs->setDefaultLang(GETPOST('lang', 'aZ09')); // If language was forced on URL by the main.inc.php\n\n$langs->load(\"main\");\n$right = ($langs->trans(\"DIRECTION\") == 'rtl' ? 'left' : 'right');\n$left = ($langs->trans(\"DIRECTION\") == 'rtl' ? 'right' : 'left');\n\n\n/*\n * View\n */\n\n$title = $langs->trans(\"Menu\");\n\n// URL http://mydolibarr/core/get_menudiv.php?dol_use_jmobile=1 can be used for tests\n$head = '<!-- Menu -->'.\"\\n\";\n$arrayofjs = array();\n$arrayofcss = array();\ntop_htmlhead($head, $title, 0, 0, $arrayofjs, $arrayofcss);\n\nprint '<body>'.\"\\n\";\n\n// Javascript to make menu active like Jmobile did.\nprint '\n<style>\n    /*Lets hide the non active LIs by default*/\n    body {\n        font-size: 16px;\n    }\n    body ul {\n        margin: 0;\n        padding-left: 0;\n    }\n    body ul li {\n        list-style: none;\n    }\n    body ul ul {\n        display: none;\n    }\n\n    a.alilevel0 {\n        background-image: url(\\''.DOL_URL_ROOT.'/theme/'.$conf->theme.'/img/next.png\\') !important;\n        background-repeat: no-repeat !important;\n        background-position-x: 10px;\n        background-position-y: 16px;\n        padding: 1em 15px 1em 40px;\n    }\n    li.lilevel0 font.vsmenudisabled {\n        /* background-image: url(/dolibarr_dev/htdocs/theme/eldy/img/next.png) !important; */\n        background-repeat: no-repeat !important;\n        background-position-x: 10px;\n        background-position-y: 16px;\n        padding: 1em 15px 1em 40px;\n        background: #f8f8f8;\n        display: block;\n        font-size: 16px !important;\n    }\n    li.lilevel1 {\n        padding: 1em 15px 0.5em 40px;\n        border-top: 1px solid #aaa;\n        margin-right: 0px;\n    \tmargin-left: 0px;\n        border-right: 0px ! important;\n    }\n    li.lilevel1:first-child {\n        margin-right: 0px;\n        margin-left: 0px;\n    }\n    li.lilevel1 a {\n        padding-bottom: 5px;\n    }\n    li.lilevel1 a, li.lilevel1 {\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel2 a {\n        padding: 0.7em 15px 0.7em 40px;\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel3 a {\n        padding: 0.6em 15px 0.6em 60px;\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel4 a {\n        padding: 0.2em 15px 8px 60px;\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel5 a {\n        padding: 0.2em 15px 0.2em 60px;\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel3:last-child {\n        padding-bottom: 10px;\n    }\n    a.alilevel0, li.lilevel1 a {\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n        display: block;\n    }\n</style>\n\n<script type=\"text/javascript\">\n$(document).ready(function(){\n    $(\"body ul\").click(function(){\n        console.log(\"We click on body ul\");\n\n        $(this).siblings().find(\"li ul\").slideUp(0);\n\n        $(this).find(\"li ul\").slideToggle(200);\n\n        target = $(this);\n        $(\\'html, body\\').animate({\n          scrollTop: target.offset().top\n        }, 300);\n\n    })\n});\n</script>\n';\n\n\nif (empty($user->socid))\t// If internal user or not defined\n{\n\t$conf->standard_menu = (empty($conf->global->MAIN_MENU_STANDARD_FORCED) ? (empty($conf->global->MAIN_MENU_STANDARD) ? 'eldy_menu.php' : $conf->global->MAIN_MENU_STANDARD) : $conf->global->MAIN_MENU_STANDARD_FORCED);\n}\nelse                        \t// If external user\n{\n\t$conf->standard_menu = (empty($conf->global->MAIN_MENUFRONT_STANDARD_FORCED) ? (empty($conf->global->MAIN_MENUFRONT_STANDARD) ? 'eldy_menu.php' : $conf->global->MAIN_MENUFRONT_STANDARD) : $conf->global->MAIN_MENUFRONT_STANDARD_FORCED);\n}\n\n// Load the menu manager (only if not already done)\n$file_menu = $conf->standard_menu;\nif (GETPOST('menu')) $file_menu = GETPOST('menu'); // example: menu=eldy_menu.php\nif (!class_exists('MenuManager'))\n{\n\t$menufound = 0;\n\t$dirmenus = array_merge(array(\"/core/menus/\"), (array) $conf->modules_parts['menus']);\n\tforeach ($dirmenus as $dirmenu)\n\t{\n\t\t$menufound = dol_include_once($dirmenu.\"standard/\".$file_menu);\n\t\tif ($menufound) break;\n\t}\n\tif (!$menufound)\t// If failed to include, we try with standard\n\t{\n\t\tdol_syslog(\"You define a menu manager '\".$file_menu.\"' that can not be loaded.\", LOG_WARNING);\n\t\t$file_menu = 'eldy_menu.php';\n\t\tinclude_once DOL_DOCUMENT_ROOT.\"/core/menus/standard/\".$file_menu;\n\t}\n}\n$menumanager = new MenuManager($db, empty($user->socid) ? 0 : 1);\n$menumanager->loadMenu('all', 'all'); // Load this->tabMenu with sql menu entries\n//var_dump($menumanager);exit;\n$menumanager->showmenu('jmobile');\n\nprint '</body>';\n\nprint '</html>'.\"\\n\";\n\n$db->close();\n"], "fixing_code": ["<?php\n/* Copyright (C) 2005-2015 Laurent Destailleur  <eldy@users.sourceforge.net>\n *\n * This file is a modified version of datepicker.php from phpBSM to fix some\n * bugs, to add new features and to dramatically increase speed.\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n *       \\file       htdocs/core/get_menudiv.php\n *       \\brief      File to return menu into a div tree, to be used by other frontend\n */\n\n//if (! defined('NOREQUIREUSER'))   define('NOREQUIREUSER','1');\t// Not disabled cause need to load personalized language\n//if (! defined('NOREQUIREDB'))   define('NOREQUIREDB','1');\t\t// Not disabled cause need to load personalized language\n//if (! defined('NOREQUIRESOC'))    define('NOREQUIRESOC','1');\n//if (! defined('NOREQUIRETRAN')) define('NOREQUIRETRAN','1');\t\t// Not disabled cause need to do translations\nif (!defined('NOCSRFCHECK'))     define('NOCSRFCHECK', 1);\nif (!defined('NOTOKENRENEWAL'))  define('NOTOKENRENEWAL', 1);\n//if (! defined('NOLOGIN')) define('NOLOGIN',1);\t\t\t\t\t// Not disabled cause need to load personalized language\nif (!defined('NOREQUIREMENU'))  define('NOREQUIREMENU', 1);\nif (!defined('NOREQUIREHTML'))  define('NOREQUIREHTML', 1);\n\nif (!defined('DISABLE_JQUERY_TABLEDND'))   define('DISABLE_JQUERY_TABLEDND', 1);\nif (!defined('DISABLE_JQUERY_JNOTIFY'))    define('DISABLE_JQUERY_JNOTIFY', 1);\nif (!defined('DISABLE_JQUERY_FLOT'))       define('DISABLE_JQUERY_FLOT', 1);\nif (!defined('DISABLE_JQUERY_JEDITABLE'))  define('DISABLE_JQUERY_JEDITABLE', 1);\nif (!defined('DISABLE_CKEDITOR'))          define('DISABLE_CKEDITOR', 1);\nif (!defined('DISABLE_BROWSER_NOTIF'))     define('DISABLE_BROWSER_NOTIF', 1);\nif (!defined('DISABLE_DATE_PICKER'))       define('DISABLE_DATE_PICKER', 1);\nif (!defined('DISABLE_SELECT2'))           define('DISABLE_SELECT2', 1);\n\nrequire_once '../main.inc.php';\n\nif (GETPOST('lang', 'aZ09')) $langs->setDefaultLang(GETPOST('lang', 'aZ09')); // If language was forced on URL by the main.inc.php\n\n$langs->load(\"main\");\n$right = ($langs->trans(\"DIRECTION\") == 'rtl' ? 'left' : 'right');\n$left = ($langs->trans(\"DIRECTION\") == 'rtl' ? 'right' : 'left');\n\n\n/*\n * View\n */\n\n$title = $langs->trans(\"Menu\");\n\n// URL http://mydolibarr/core/get_menudiv.php?dol_use_jmobile=1 can be used for tests\n$head = '<!-- Menu -->'.\"\\n\";\n$arrayofjs = array();\n$arrayofcss = array();\ntop_htmlhead($head, $title, 0, 0, $arrayofjs, $arrayofcss);\n\nprint '<body>'.\"\\n\";\n\n// Javascript to make menu active like Jmobile did.\nprint '\n<style>\n    /*Lets hide the non active LIs by default*/\n    body {\n        font-size: 16px;\n    }\n    body ul {\n        margin: 0;\n        padding-left: 0;\n    }\n    body ul li {\n        list-style: none;\n    }\n    body ul ul {\n        display: none;\n    }\n\n    a.alilevel0 {\n        background-image: url(\\''.DOL_URL_ROOT.'/theme/'.$conf->theme.'/img/next.png\\') !important;\n        background-repeat: no-repeat !important;\n        background-position-x: 10px;\n        background-position-y: 16px;\n        padding: 1em 15px 1em 40px;\n    }\n    li.lilevel0 font.vsmenudisabled {\n        /* background-image: url(/dolibarr_dev/htdocs/theme/eldy/img/next.png) !important; */\n        background-repeat: no-repeat !important;\n        background-position-x: 10px;\n        background-position-y: 16px;\n        padding: 1em 15px 1em 40px;\n        background: #f8f8f8;\n        display: block;\n        font-size: 16px !important;\n    }\n    li.lilevel1 {\n        padding: 1em 15px 0.5em 40px;\n        border-top: 1px solid #aaa;\n        margin-right: 0px;\n    \tmargin-left: 0px;\n        border-right: 0px ! important;\n    }\n    li.lilevel1:first-child {\n        margin-right: 0px;\n        margin-left: 0px;\n    }\n    li.lilevel1 a {\n        padding-bottom: 5px;\n    }\n    li.lilevel1 a, li.lilevel1 {\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel2 a {\n        padding: 0.7em 15px 0.7em 40px;\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel3 a {\n        padding: 0.6em 15px 0.6em 60px;\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel4 a {\n        padding: 0.2em 15px 8px 60px;\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel5 a {\n        padding: 0.2em 15px 0.2em 60px;\n        color: #000;\n        cursor: pointer;\n        display: block;\n    }\n    li.lilevel3:last-child {\n        padding-bottom: 10px;\n    }\n    a.alilevel0, li.lilevel1 a {\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n        display: block;\n    }\n</style>\n\n<script type=\"text/javascript\">\n$(document).ready(function(){\n    $(\"body ul\").click(function(){\n        console.log(\"We click on body ul\");\n\n        $(this).siblings().find(\"li ul\").slideUp(0);\n\n        $(this).find(\"li ul\").slideToggle(200);\n\n        target = $(this);\n        $(\\'html, body\\').animate({\n          scrollTop: target.offset().top\n        }, 300);\n\n    })\n});\n</script>\n';\n\n\nif (empty($user->socid))\t// If internal user or not defined\n{\n\t$conf->standard_menu = (empty($conf->global->MAIN_MENU_STANDARD_FORCED) ? (empty($conf->global->MAIN_MENU_STANDARD) ? 'eldy_menu.php' : $conf->global->MAIN_MENU_STANDARD) : $conf->global->MAIN_MENU_STANDARD_FORCED);\n}\nelse                        \t// If external user\n{\n\t$conf->standard_menu = (empty($conf->global->MAIN_MENUFRONT_STANDARD_FORCED) ? (empty($conf->global->MAIN_MENUFRONT_STANDARD) ? 'eldy_menu.php' : $conf->global->MAIN_MENUFRONT_STANDARD) : $conf->global->MAIN_MENUFRONT_STANDARD_FORCED);\n}\n\n// Load the menu manager (only if not already done)\n$file_menu = $conf->standard_menu;\nif (GETPOST('menu', 'aZ09')) $file_menu = GETPOST('menu', 'aZ09');     // example: menu=eldy_menu.php\nif (!class_exists('MenuManager'))\n{\n\t$menufound = 0;\n\t$dirmenus = array_merge(array(\"/core/menus/\"), (array) $conf->modules_parts['menus']);\n\tforeach ($dirmenus as $dirmenu)\n\t{\n\t\t$menufound = dol_include_once($dirmenu.\"standard/\".$file_menu);\n\t\tif ($menufound) break;\n\t}\n\tif (!$menufound)\t// If failed to include, we try with standard\n\t{\n\t\tdol_syslog(\"You define a menu manager '\".$file_menu.\"' that can not be loaded.\", LOG_WARNING);\n\t\t$file_menu = 'eldy_menu.php';\n\t\tinclude_once DOL_DOCUMENT_ROOT.\"/core/menus/standard/\".$file_menu;\n\t}\n}\n$menumanager = new MenuManager($db, empty($user->socid) ? 0 : 1);\n$menumanager->loadMenu('all', 'all'); // Load this->tabMenu with sql menu entries\n//var_dump($menumanager);exit;\n$menumanager->showmenu('jmobile');\n\nprint '</body>';\n\nprint '</html>'.\"\\n\";\n\n$db->close();\n"], "filenames": ["htdocs/core/get_menudiv.php"], "buggy_code_start_loc": [188], "buggy_code_end_loc": [189], "fixing_code_start_loc": [188], "fixing_code_end_loc": [189], "type": "CWE-20", "message": "core/get_menudiv.php in Dolibarr before 11.0.4 allows remote authenticated attackers to bypass intended access restrictions via a non-alphanumeric menu parameter.", "other": {"cve": {"id": "CVE-2020-12669", "sourceIdentifier": "cve@mitre.org", "published": "2020-05-06T19:15:12.707", "lastModified": "2021-07-21T11:39:23.747", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "core/get_menudiv.php in Dolibarr before 11.0.4 allows remote authenticated attackers to bypass intended access restrictions via a non-alphanumeric menu parameter."}, {"lang": "es", "value": "El archivo core/get_menudiv.php en Dolibarr versiones anteriores a 1.0.4, permite a atacantes autenticados remotos omitir restricciones de acceso previstas por medio de un par\u00e1metro de men\u00fa no alfanum\u00e9rico."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-20"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:dolibarr:dolibarr:*:*:*:*:*:*:*:*", "versionEndExcluding": "11.0.4", "matchCriteriaId": "A1AAD4AB-7E1C-45C1-86CA-795ACB838232"}]}]}], "references": [{"url": "https://github.com/Dolibarr/dolibarr/commit/c1b530f58f6f01081ddbeaa2092ef308c3ec2727", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://sourceforge.net/projects/dolibarr/files/Dolibarr%20ERP-CRM/11.0.4/", "source": "cve@mitre.org", "tags": ["Product", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Dolibarr/dolibarr/commit/c1b530f58f6f01081ddbeaa2092ef308c3ec2727"}}