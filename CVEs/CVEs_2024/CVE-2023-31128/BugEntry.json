{"buggy_code": ["\nname: Additional tests for pull requests\n\non:\n    pull_request:\n\njobs:\n    \n    changelog:\n        name: Check if the changelog was updated\n        runs-on: ubuntu-latest\n        \n        steps:\n            -   name: Checkout the app\n                uses: actions/checkout@v3\n                with:\n                    fetch-depth: 2\n            \n            -   name: Get the diff\n                id: diff\n                run: |\n                    git diff HEAD~1 -- CHANGELOG.md\n                    lines=$(git diff HEAD~1 -- CHANGELOG.md | wc -l)\n                    echo \"lines=$lines\" >> $GITHUB_OUTPUT\n            \n            -   name: Get all changed file names\n                id: file-names\n                run: |\n                    lines=\"$(git diff HEAD~1 --name-only)\"\n                    echo \"Changed files:\"\n                    echo \"$lines\"\n                    totalcnt=\"$(echo \"$lines\" | wc -l)\"\n                    echo \"totalcount=$totalcnt\" >> $GITHUB_OUTPUT\n                    #\n                    cnt=\"$(echo \"$lines\" | grep -v '^package-lock.json$' | grep -v '^\\.github/workflows/' | wc -l)\"\n                    echo \"num=$cnt\" >> $GITHUB_OUTPUT\n                    #\n                    echo \"That are $totalcnt changed files. After reducing the number there are $cnt files left.\"\n\n            -   name: Error/warn if the number of diff lines is zero\n                run: |\n                    if [ ${{ steps.file-names.outputs.num }} -gt 0 ]; then\n                    echo \"::error file=CHANGELOG.md::There was no change in the changelog detected. Please fill in a valid entry into that file.\"\n                    exit 1\n                    else\n                    echo \"::warning file=CHANGELOG.md::There was no change in the changelog detected. There are in total ${{ steps.file-names.outputs.totalcount }} changed files.\"\n                    fi\n                if: ${{ steps.diff.outputs.lines == 0 }}\n    \n    todo-checker:\n        name: Check for added todo messages\n        runs-on: ubuntu-latest\n        steps:\n            -   name: Git version output\n                run: git version\n            -   name: Manual checkout of the app (base repo)\n                run: |\n                    REPO=\"https://${GITHUB_ACTOR}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\"\n                    BRANCH=\"${GITHUB_REF/#refs\\/heads\\//}\"\n\n                    git clone --filter=tree:0 \"$REPO\" .\n            -   name: Manual checkout of the app (PR head)\n                run: |\n                    git remote add head \"${{ github.event.pull_request.head.repo.html_url }}\"\n                    git fetch head --filter=tree:0\n                    \n                    git checkout -b head-branch head/${{ github.head_ref }}\n            -   name: Status of current git workspace\n                run: |\n                    git branch\n                    git status\n            -   name: Check for open TODO annotations in source code\n                uses: ./.github/actions/check-todo\n\n    appinfo:\n        name: Check for matching app info file\n        runs-on: ubuntu-latest\n\n        steps:\n            -   name: Checkout of the app\n                uses: actions/checkout@v3\n                with:\n                    fetch-depth: 1\n                \n            -   name: Install dependencies\n                run: |\n                    sudo apt-get update\n                    sudo apt-get install jq\n                    pip install yq\n\n            -   name: Perform the test\n                env:\n                    MAIN_FILE: appinfo/info.xml\n                    DIST_FILE: .github/actions/deploy/appinfo/info.xml.dist\n                run: |\n                    echo \"Normalize the actual appinfo file\"    \n                    xq -x 'del(.info.version)' \"$MAIN_FILE\" > /tmp/main-info.xml\n                    xq -x 'del(.info.version)' \"$DIST_FILE\" > /tmp/dist-info.xml\n\n                    echo '::group::Debug output'\n                    tail -n 100 /tmp/main-info.xml /tmp/dist-info.xml\n                    echo '::endgroup::'\n\n                    if ! diff -q /tmp/main-info.xml /tmp/dist-info.xml > /dev/null; then\n                    echo '::error::The app info file differs from the dist file. Please check manually!'\n                    exit 1\n                    fi\n\n            -   name: Download schema\n                run: wget https://raw.githubusercontent.com/nextcloud/appstore/master/nextcloudappstore/api/v1/release/info.xsd\n\n            -   name: Lint info.xml\n                uses: ChristophWurst/xmllint-action@v1\n                with:\n                    xml-file: ./appinfo/info.xml\n                    xml-schema-file: ./info.xsd\n    \n    package-lint:\n        name: Make sure the package.json is well-formatted\n        runs-on: ubuntu-latest\n\n        steps:\n            -   name: Checkout of the app\n                uses: actions/checkout@v3\n                with:\n                    fetch-depth: 1\n            -   name: Get the date\n                id: date\n                run: echo \"date=$(date +%Y-%m-%d)\" >> $GITHUB_OUTPUT\n            -   name: Cache NPM cache\n                uses: actions/cache@v3.3.1\n                with:\n                    path: |\n                        ~/.npm\n                        node_modules\n                    key: ${{ runner.os }}-node-${{ steps.date.outputs.date }}-${{ hashFiles('package-lock.json') }}\n                    restore-keys: |\n                        ${{ runner.os }}-node-${{ steps.date.outputs.date }}-\n                        ${{ runner.os }}-node-\n\n            -   name: Install NPM modules\n                run: npm ci\n\n            -   name: Perform the test\n                run: |\n                    npm run package-lint\n\n                    if [ $(git diff --name-only package.json | wc -l) -gt 0 ]; then\n                    echo '::error file=package.json::The package.json file is not validly formatted.'\n                    echo '::notice::It is suggested to run `npm run package-lint` and commit locally.'\n                    exit 1\n                    fi\n\n    fixup-check:\n        name: Block fixup and squash commits\n        runs-on: ubuntu-latest\n\n        steps:\n            -   name: Run check\n                uses: xt0rted/block-autosquash-commits-action@v2\n                with:\n                    repo-token: ${{ secrets.GITHUB_TOKEN }}\n"], "fixing_code": ["\nname: Additional tests for pull requests\n\non:\n    pull_request:\n\njobs:\n    \n    changelog:\n        name: Check if the changelog was updated\n        runs-on: ubuntu-latest\n        \n        steps:\n            -   name: Checkout the app\n                uses: actions/checkout@v3\n                with:\n                    fetch-depth: 2\n            \n            -   name: Get the diff\n                id: diff\n                run: |\n                    git diff HEAD~1 -- CHANGELOG.md\n                    lines=$(git diff HEAD~1 -- CHANGELOG.md | wc -l)\n                    echo \"lines=$lines\" >> $GITHUB_OUTPUT\n            \n            -   name: Get all changed file names\n                id: file-names\n                run: |\n                    lines=\"$(git diff HEAD~1 --name-only)\"\n                    echo \"Changed files:\"\n                    echo \"$lines\"\n                    totalcnt=\"$(echo \"$lines\" | wc -l)\"\n                    echo \"totalcount=$totalcnt\" >> $GITHUB_OUTPUT\n                    #\n                    cnt=\"$(echo \"$lines\" | grep -v '^package-lock.json$' | grep -v '^\\.github/workflows/' | wc -l)\"\n                    echo \"num=$cnt\" >> $GITHUB_OUTPUT\n                    #\n                    echo \"That are $totalcnt changed files. After reducing the number there are $cnt files left.\"\n\n            -   name: Error/warn if the number of diff lines is zero\n                run: |\n                    if [ ${{ steps.file-names.outputs.num }} -gt 0 ]; then\n                    echo \"::error file=CHANGELOG.md::There was no change in the changelog detected. Please fill in a valid entry into that file.\"\n                    exit 1\n                    else\n                    echo \"::warning file=CHANGELOG.md::There was no change in the changelog detected. There are in total ${{ steps.file-names.outputs.totalcount }} changed files.\"\n                    fi\n                if: ${{ steps.diff.outputs.lines == 0 }}\n    \n    todo-checker:\n        name: Check for added todo messages\n        runs-on: ubuntu-latest\n        steps:\n            -   name: Git version output\n                run: git version\n            -   name: Manual checkout of the app (base repo)\n                run: |\n                    REPO=\"https://${GITHUB_ACTOR}:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git\"\n                    BRANCH=\"${GITHUB_REF/#refs\\/heads\\//}\"\n\n                    git clone --filter=tree:0 \"$REPO\" .\n            -   name: Manual checkout of the app (PR head)\n                env:\n                    URL: ${{ github.event.pull_request.head.repo.html_url }}\n                    HEAD_REF: ${{ github.head_ref }}\n                run: |\n                    git remote add head \"$URL\"\n                    git fetch head --filter=tree:0\n                    \n                    git checkout -b head-branch head/$HEAD_REF\n            -   name: Status of current git workspace\n                run: |\n                    git branch\n                    git status\n            -   name: Check for open TODO annotations in source code\n                uses: ./.github/actions/check-todo\n\n    appinfo:\n        name: Check for matching app info file\n        runs-on: ubuntu-latest\n\n        steps:\n            -   name: Checkout of the app\n                uses: actions/checkout@v3\n                with:\n                    fetch-depth: 1\n                \n            -   name: Install dependencies\n                run: |\n                    sudo apt-get update\n                    sudo apt-get install jq\n                    pip install yq\n\n            -   name: Perform the test\n                env:\n                    MAIN_FILE: appinfo/info.xml\n                    DIST_FILE: .github/actions/deploy/appinfo/info.xml.dist\n                run: |\n                    echo \"Normalize the actual appinfo file\"    \n                    xq -x 'del(.info.version)' \"$MAIN_FILE\" > /tmp/main-info.xml\n                    xq -x 'del(.info.version)' \"$DIST_FILE\" > /tmp/dist-info.xml\n\n                    echo '::group::Debug output'\n                    tail -n 100 /tmp/main-info.xml /tmp/dist-info.xml\n                    echo '::endgroup::'\n\n                    if ! diff -q /tmp/main-info.xml /tmp/dist-info.xml > /dev/null; then\n                    echo '::error::The app info file differs from the dist file. Please check manually!'\n                    exit 1\n                    fi\n\n            -   name: Download schema\n                run: wget https://raw.githubusercontent.com/nextcloud/appstore/master/nextcloudappstore/api/v1/release/info.xsd\n\n            -   name: Lint info.xml\n                uses: ChristophWurst/xmllint-action@v1\n                with:\n                    xml-file: ./appinfo/info.xml\n                    xml-schema-file: ./info.xsd\n    \n    package-lint:\n        name: Make sure the package.json is well-formatted\n        runs-on: ubuntu-latest\n\n        steps:\n            -   name: Checkout of the app\n                uses: actions/checkout@v3\n                with:\n                    fetch-depth: 1\n            -   name: Get the date\n                id: date\n                run: echo \"date=$(date +%Y-%m-%d)\" >> $GITHUB_OUTPUT\n            -   name: Cache NPM cache\n                uses: actions/cache@v3.3.1\n                with:\n                    path: |\n                        ~/.npm\n                        node_modules\n                    key: ${{ runner.os }}-node-${{ steps.date.outputs.date }}-${{ hashFiles('package-lock.json') }}\n                    restore-keys: |\n                        ${{ runner.os }}-node-${{ steps.date.outputs.date }}-\n                        ${{ runner.os }}-node-\n\n            -   name: Install NPM modules\n                run: npm ci\n\n            -   name: Perform the test\n                run: |\n                    npm run package-lint\n\n                    if [ $(git diff --name-only package.json | wc -l) -gt 0 ]; then\n                    echo '::error file=package.json::The package.json file is not validly formatted.'\n                    echo '::notice::It is suggested to run `npm run package-lint` and commit locally.'\n                    exit 1\n                    fi\n\n    fixup-check:\n        name: Block fixup and squash commits\n        runs-on: ubuntu-latest\n\n        steps:\n            -   name: Run check\n                uses: xt0rted/block-autosquash-commits-action@v2\n                with:\n                    repo-token: ${{ secrets.GITHUB_TOKEN }}\n"], "filenames": [".github/workflows/pull-checks.yml"], "buggy_code_start_loc": [62], "buggy_code_end_loc": [68], "fixing_code_start_loc": [63], "fixing_code_end_loc": [71], "type": "CWE-78", "message": "NextCloud Cookbook is a recipe library app. Prior to commit a46d9855 on the `master` branch and commit 489bb744 on the `main-0.9.x` branch, the `pull-checks.yml` workflow is vulnerable to command injection attacks because of using an untrusted `github.head_ref` field. The `github.head_ref` value is an attacker-controlled value. Assigning the value to `zzz\";echo${IFS}\"hello\";#` can lead to command injection. Since the permission is not restricted, the attacker has a write-access to the repository. This issue is fixed in commit a46d9855 on the `master` branch and commit 489bb744 on the `main-0.9.x` branch. There is no risk for the user of the app within the NextCloud server. This only affects the main repository and possible forks of it. Those who have forked the NextCloud Cookbook repository should make sure their forks are on the latest version to prevent code injection attacks and similar.", "other": {"cve": {"id": "CVE-2023-31128", "sourceIdentifier": "security-advisories@github.com", "published": "2023-05-26T22:15:14.797", "lastModified": "2023-06-05T14:15:52.127", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "NextCloud Cookbook is a recipe library app. Prior to commit a46d9855 on the `master` branch and commit 489bb744 on the `main-0.9.x` branch, the `pull-checks.yml` workflow is vulnerable to command injection attacks because of using an untrusted `github.head_ref` field. The `github.head_ref` value is an attacker-controlled value. Assigning the value to `zzz\";echo${IFS}\"hello\";#` can lead to command injection. Since the permission is not restricted, the attacker has a write-access to the repository. This issue is fixed in commit a46d9855 on the `master` branch and commit 489bb744 on the `main-0.9.x` branch. There is no risk for the user of the app within the NextCloud server. This only affects the main repository and possible forks of it. Those who have forked the NextCloud Cookbook repository should make sure their forks are on the latest version to prevent code injection attacks and similar."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.1, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.2}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-78"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-78"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:nextcloud:cookbook:*:*:*:*:*:*:*:*", "versionStartIncluding": "0.9.0", "versionEndExcluding": "0.9.19", "matchCriteriaId": "191FEC7E-1FA0-4040-A961-BF2BB5FB726E"}]}]}], "references": [{"url": "https://github.com/nextcloud/cookbook/blob/a14d6ffc4d45e1447556f68606129dfd6c1505cf/.github/workflows/pull-checks.yml#L67", "source": "security-advisories@github.com", "tags": ["Product"]}, {"url": "https://github.com/nextcloud/cookbook/commit/489bb744", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/nextcloud/cookbook/commit/a46d98559e2c64292da9ffb06138cccc2e50ae1b", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/nextcloud/cookbook/security/advisories/GHSA-c5pc-mf2f-xq8h", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}, {"url": "https://securitylab.github.com/research/github-actions-untrusted-input/", "source": "security-advisories@github.com", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/nextcloud/cookbook/commit/a46d98559e2c64292da9ffb06138cccc2e50ae1b"}}