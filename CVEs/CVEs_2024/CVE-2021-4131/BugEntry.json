{"buggy_code": ["<?php if ($currentUser->hasAccessTo('lhsystem','expirecache')) : ?>\t\t\r\n\t<li><a href=\"<?php echo erLhcoreClassDesign::baseurl('system/expirecache')?>\"><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('pagelayout/pagelayout','Clean cache');?></a></li>\t\t\t\r\n<?php endif; ?>", "<?php\n\n\n$CacheManager = erConfigClassLhCacheConfig::getInstance();\n$CacheManager->expireCache(true);\nheader('Location: ' . $_SERVER['HTTP_REFERER']);\nexit;\n\n?>", "<?php\n\n$Module = array( \"name\" => \"System configuration\");\n\n$ViewList = array();\n\n$ViewList['htmlcode'] = array(\n    'params' => array(),\n    'functions' => array( 'generatejs' )\n);\n\n$ViewList['htmlcodebeta'] = array(\n    'params' => array(),\n    'functions' => array( 'generatejs' )\n);\n\n$ViewList['embedcode'] = array(\n    'params' => array(),\n    'functions' => array( 'generatejs' )\n);\n\n$ViewList['configuration'] = array(\n    'params' => array(),\n    'functions' => array( 'use' )\n);\n\n$ViewList['offlinesettings'] = array(\n    'params' => array(),\n    'functions' => array( 'offlinesettings' )\n);\n\n$ViewList['usersactions'] = array(\n    'params' => array(),\n    'functions' => array( 'usersactions' )\n);\n\n$ViewList['expirecache'] = array(\n    'params' => array(),\n    'functions' => array( 'expirecache' )\n);\n\n$ViewList['smtp'] = array(\n    'params' => array(),\n    'functions' => array( 'configuresmtp' )\n);\n\n$ViewList['recaptcha'] = array(\n    'params' => array(),\n    'functions' => array( 'configurerecaptcha' )\n);\n\n$ViewList['timezone'] = array(\n    'params' => array(),\n    'functions' => array( 'timezone' )\n);\n\n$ViewList['languages'] = array(\n    'params' => array(),\n    'uparams' => array('updated','sa'),\n    'functions' => array( 'changelanguage' )\n);\n\n$ViewList['update'] = array(\n    'params' => array(),\n    'uparams' => array('action','scope'),\n    'functions' => array( 'performupdate' )\n);\n\n$ViewList['ga'] = array(\n    'params' => array(),\n    'uparams' => array(),\n    'functions' => array( 'ga_configuration' )\n);\n\n$ViewList['transferconfiguration'] = array(\n    'params' => array(),\n    'uparams' => array('action'),\n    'functions' => array( 'transferconfiguration' )\n);\n\n$ViewList['autodbupdate'] = array(\n    'params' => array('hash'),\n    'uparams' => array()\n);\n\n$ViewList['singlesetting'] = array(\n    'params' => array('identifier'),\n    'uparams' => array(),\n    'functions' => array( 'singlesetting' )\n);\n\n$FunctionList['use'] = array('explain' => 'Allow user to see configuration links');\n$FunctionList['expirecache'] = array('explain' => 'Allow user to clear cache');\n$FunctionList['generatejs'] = array('explain' => 'Allow user to access HTML generation');\n$FunctionList['configuresmtp'] = array('explain' => 'Allow user to configure SMTP');\n$FunctionList['configurelanguages'] = array('explain' => 'Allow user to configure languages');\n$FunctionList['changelanguage'] = array('explain' => 'Allow user to change his languages');\n$FunctionList['timezone'] = array('explain' => 'Allow user to change global time zone');\n$FunctionList['performupdate'] = array('explain' => 'Allow user to update Live Helper Chat');\n$FunctionList['changetemplates'] = array('explain' => 'Allow user to change e-mail templates');\n$FunctionList['generate_js_tab'] = array('explain' => 'User can see embed code tab');\n$FunctionList['transferconfiguration'] = array('explain' => 'User can configure transfer options');\n$FunctionList['offlinesettings'] = array('explain' => 'Allow user to change offline settings');\n$FunctionList['configurerecaptcha'] = array('explain' => 'Allow user to configure recaptcha');\n$FunctionList['auditlog'] = array('explain' => 'Allow user to see audit log');\n$FunctionList['usersactions'] = array('explain' => 'Allow user to see operators real time chats statistic');\n$FunctionList['ga_configuration'] = array('explain' => 'Allow user to configure Events Tracking');\n$FunctionList['singlesetting'] = array('explain' => 'Allow user to change app settings');\n\n?>"], "fixing_code": ["<?php if ($currentUser->hasAccessTo('lhsystem','expirecache')) : ?>\t\t\r\n\t<li><a class=\"csfr-required\" href=\"<?php echo erLhcoreClassDesign::baseurl('system/expirecache')?>\"><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('pagelayout/pagelayout','Clean cache');?></a></li>\r\n<?php endif; ?>", "<?php\n\n$currentUser = erLhcoreClassUser::instance();\n\nif (!$currentUser->validateCSFRToken($Params['user_parameters_unordered']['csfr'])) {\n    die('Invalid CSFR Token');\n    exit;\n}\n\n$CacheManager = erConfigClassLhCacheConfig::getInstance();\n$CacheManager->expireCache(true);\nheader('Location: ' . $_SERVER['HTTP_REFERER']);\nexit;\n\n?>", "<?php\n\n$Module = array( \"name\" => \"System configuration\");\n\n$ViewList = array();\n\n$ViewList['htmlcode'] = array(\n    'params' => array(),\n    'functions' => array( 'generatejs' )\n);\n\n$ViewList['htmlcodebeta'] = array(\n    'params' => array(),\n    'functions' => array( 'generatejs' )\n);\n\n$ViewList['embedcode'] = array(\n    'params' => array(),\n    'functions' => array( 'generatejs' )\n);\n\n$ViewList['configuration'] = array(\n    'params' => array(),\n    'functions' => array( 'use' )\n);\n\n$ViewList['offlinesettings'] = array(\n    'params' => array(),\n    'functions' => array( 'offlinesettings' )\n);\n\n$ViewList['usersactions'] = array(\n    'params' => array(),\n    'functions' => array( 'usersactions' )\n);\n\n$ViewList['expirecache'] = array(\n    'params' => array(),\n    'functions' => array( 'expirecache' ),\n    'uparams' => array('csfr')\n);\n\n$ViewList['smtp'] = array(\n    'params' => array(),\n    'functions' => array( 'configuresmtp' )\n);\n\n$ViewList['recaptcha'] = array(\n    'params' => array(),\n    'functions' => array( 'configurerecaptcha' )\n);\n\n$ViewList['timezone'] = array(\n    'params' => array(),\n    'functions' => array( 'timezone' )\n);\n\n$ViewList['languages'] = array(\n    'params' => array(),\n    'uparams' => array('updated','sa'),\n    'functions' => array( 'changelanguage' )\n);\n\n$ViewList['update'] = array(\n    'params' => array(),\n    'uparams' => array('action','scope'),\n    'functions' => array( 'performupdate' )\n);\n\n$ViewList['ga'] = array(\n    'params' => array(),\n    'uparams' => array(),\n    'functions' => array( 'ga_configuration' )\n);\n\n$ViewList['transferconfiguration'] = array(\n    'params' => array(),\n    'uparams' => array('action'),\n    'functions' => array( 'transferconfiguration' )\n);\n\n$ViewList['autodbupdate'] = array(\n    'params' => array('hash'),\n    'uparams' => array()\n);\n\n$ViewList['singlesetting'] = array(\n    'params' => array('identifier'),\n    'uparams' => array(),\n    'functions' => array( 'singlesetting' )\n);\n\n$FunctionList['use'] = array('explain' => 'Allow user to see configuration links');\n$FunctionList['expirecache'] = array('explain' => 'Allow user to clear cache');\n$FunctionList['generatejs'] = array('explain' => 'Allow user to access HTML generation');\n$FunctionList['configuresmtp'] = array('explain' => 'Allow user to configure SMTP');\n$FunctionList['configurelanguages'] = array('explain' => 'Allow user to configure languages');\n$FunctionList['changelanguage'] = array('explain' => 'Allow user to change his languages');\n$FunctionList['timezone'] = array('explain' => 'Allow user to change global time zone');\n$FunctionList['performupdate'] = array('explain' => 'Allow user to update Live Helper Chat');\n$FunctionList['changetemplates'] = array('explain' => 'Allow user to change e-mail templates');\n$FunctionList['generate_js_tab'] = array('explain' => 'User can see embed code tab');\n$FunctionList['transferconfiguration'] = array('explain' => 'User can configure transfer options');\n$FunctionList['offlinesettings'] = array('explain' => 'Allow user to change offline settings');\n$FunctionList['configurerecaptcha'] = array('explain' => 'Allow user to configure recaptcha');\n$FunctionList['auditlog'] = array('explain' => 'Allow user to see audit log');\n$FunctionList['usersactions'] = array('explain' => 'Allow user to see operators real time chats statistic');\n$FunctionList['ga_configuration'] = array('explain' => 'Allow user to configure Events Tracking');\n$FunctionList['singlesetting'] = array('explain' => 'Allow user to change app settings');\n\n?>"], "filenames": ["lhc_web/design/defaulttheme/tpl/lhsystem/configuration_links/expirecache.tpl.php", "lhc_web/modules/lhsystem/expirecache.php", "lhc_web/modules/lhsystem/module.php"], "buggy_code_start_loc": [2, 2, 39], "buggy_code_end_loc": [3, 2, 40], "fixing_code_start_loc": [2, 3, 39], "fixing_code_end_loc": [3, 9, 41], "type": "CWE-352", "message": "livehelperchat is vulnerable to Cross-Site Request Forgery (CSRF)", "other": {"cve": {"id": "CVE-2021-4131", "sourceIdentifier": "security@huntr.dev", "published": "2021-12-18T07:15:06.663", "lastModified": "2021-12-21T16:21:10.787", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "livehelperchat is vulnerable to Cross-Site Request Forgery (CSRF)"}, {"lang": "es", "value": "livehelperchat es vulnerable a un ataque de tipo Cross-Site Request Forgery (CSRF)"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.8}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:livehelperchat:live_helper_chat:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.0", "matchCriteriaId": "9C340059-AF21-4164-8C85-B627CC108D5D"}]}]}], "references": [{"url": "https://github.com/livehelperchat/livehelperchat/commit/3b5d0a8a43595a7f05f2a81b76623a8d7e5ad19f", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/52dfac87-4fd3-4dfb-83d2-d39916764d43", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/livehelperchat/livehelperchat/commit/3b5d0a8a43595a7f05f2a81b76623a8d7e5ad19f"}}