{"buggy_code": ["# CHANGES\n## RosarioSIS Student Information System\n\nChanges in 8.9.2\n----------------\n- Fix invalidate User School in session on login in index.php\n\nChanges in 8.9.1\n----------------\n- Fix regression since 8.6 Mailing Labels widget HTML in Widgets.php\n\nChanges in 8.9\n--------------\n- Fix GetTeacher() when newly inserted teacher in GetTeacher.fnc.php\n- Remove Half Day option in AddAbsences.php, Administration.php, TakeAttendance.php, Courses.php, Courses.fnc.php & Rollover.php\n- JS Hide \"+ New Period\" link onclick in Courses.php\n- CSS FlatSIS fix bottom button line height in stylesheet.css\n- Add help texts & translations for the Scheduling > Courses program in Help_en.php & help.po\n- Correct typos in Spanish help texts in help.po\n- Fix Locked column value on list export in Schedule.php\n- Student / User Photo input: only accept .jpg,.jpeg,.png,.gif in General_Info.inc.php\n- Increase Food Service icon width to 48px in FS_Icons.inc.php & MenuItems.php\n- HTML add Add-on upload input title in Modules.inc.php & Plugins.inc.php\n- Fix do not resubmit form on List Export in Incomes.php & Expenses.php\n- Fix List Export columns: hide Delete & show File Attached in Expenses.php, Incomes.php, Salaries.php, StaffPayments.php, StudentFees.php & StudentPayments.php\n- Check AllowEdit() on Event deletion in Calendar.php\n- Food Service icon upload in MenuItems.php\n- Add French & Spanish translation for \"Icon successfully uploaded.\" in rosariosis.po\n\nChanges in 8.8\n--------------\n- Fix proc_open() PHP function not allowed in PDF.php\n- Fix PHP Warning A non-numeric value encountered in ReportCards.fnc.php\n- Fix PHP Fatal error Unsupported operand types in Teacher Programs: do not search Students List, unset in CustomFields.fnc.php\n- Add 'staff_' prefix to first & last inputs on Find a User form in GetStaffList.fnc.php & Search.fnc.php\n- Remove icons from Ungraded column, use only number in StudentGrades.php\n- Exclude 0 points assignments from Ungraded count in StudentGrades.php\n- Date select increase years options from +5 to +20 in Date.php\n- JS Raise height by 1 submenu item so we stay above browser URL in warehouse.js\n- Add Min. and Max. GPA to Last row in Grades.fnc.php & ReportCards.fnc.php\n- Add Class Rank to Last row in Grades.fnc.php & ReportCards.fnc.php\n\nChanges in 8.7\n--------------\n- Rector fix bad code in functions/, classes/core/, ProgramFunctions/\n- Update tested on: not compatible with Internet Explorer in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- Add ProgramFunctions/SendEmail.fnc.php|send_error action hook in SendEmail.fnc.php\n- EasyCodingStandard use short array notation in functions/, classes/core/, ProgramFunctions/, modules/ & plugins/\n- Fix month + year format, remove day (regression since 7.1) in Dashboard.inc.php\n- ProgramUserConfig() always return array, not null in Config.fnc.php & \\_makeLetterGrade.fnc.php\n- Allow redirect to Take Attendance, no fatal error if no current MP in Portal.php\n- CSS fix checkbox & radio input vertical align on Firefox in stylesheet.css\n- CSS fix menu hover right arrow position when module name on 2 lines in stylesheet.css\n- CSS fix font-size auto-adjust on iPhone in stylesheet.css\n- Fix typo in English string, update translations in Rollover.php & rosariosis.mo\n- JS fix menu & scroll issue on smartphone landscape > 735px in warehouse.js & jquery-fixed.menu.js\n- FlatSIS theme: use Grunt to minify in Gruntfile.js\n- FlatSIS theme: do not import WPadmin theme stylesheet anymore in stylesheet.css, stylesheet_wkhtmltopdf.css\n- Fix SQL TRANSCRIPT_GRADES view, grades were duplicated for each school year in rosariosis.sql & Update.fnc.php\n\nChanges in 8.6.1\n----------------\n- Add .webp image to FileExtensionWhiteList() in FileUpload.fnc.php\n- Fix SQL error table name \"sam\" specified more than once in Widget.php\n\nChanges in 8.6\n--------------\n- Add (Student) Widgets class in classes/core/Widgets.php\n- Add (Student) Widget interface and individual Widget classes in classes/core/Widget.php\n- Use RosarioSIS\\Widgets in Widgets.fnc.php\n- Add StaffWidgets class in classes/core/StaffWidgets.php\n- Add StaffWidget interface and individual StaffWidget classes in classes/core/StaffWidget.php\n- Use RosarioSIS\\StaffWidgets in StaffWidgets.fnc.php\n- Admin Student Payments Delete restriction: also exclude Refund in StudentPayments.php & Student_Billing/functions.inc.php\n- Fix PHP Fatal error unsupported operand types when (Staff)Widgets() & $extra used for Parent / Student in Widgets.fnc.php & StaffWidgets.fnc.php\n- Fix PHP Fatal error canBuild() must be compatible with Widget::canBuild(array $modules) in Widget.php & StaffWidget.php\n- Fix SQL error more than one row returned by a subquery in Search.fnc.php\n\nChanges in 8.5.2\n----------------\n- Fix PHP Fatal error cannot redeclare `_rosarioLoginURL()` (regression since 8.3) in MarkDownHTML.fnc.php\n\nChanges in 8.5.1\n----------------\n- Fix SQL syntax error in ORDER BY (regression since 8.3.1) in Substitutions.php\n\nChanges in 8.5\n--------------\n- Fix SQL error duplicate key value violates unique constraint \"food_service_menus_title\" in Menus.php\n- SQL add PRIMARY KEY to STAFF_EXCEPTIONS table in rosariosis.sql\n- SQL PROFILE_EXCEPTIONS & STAFF_EXCEPTIONS tables: Add Admin Student Payments Delete restriction in Update.fnc.php & rosariosis.sql\n- Add Admin Student Payments Delete restriction in Profiles.php & Exceptions.php\n- Add Admin Student Payments Delete restriction in StudentPayments.php & Student_Billing/functions.inc.php\n- Fix SQL error numeric field overflow when entering percent > 100 in MassCreateAssignments.php\n- HTML Sort Order input type number in MarkingPeriods.php\n\nChanges in 8.4\n--------------\n- SQL GRADEBOOK_GRADES table: Change comment column type to text in Update.fnc.php & rosariosis.sql\n- Increase Grades Comment input maxlength to 500 chars in Grades.php\n- Fix use more coherent number_format() precision & no thousand separator in Percent.php, Assignments.php, StudentGrades.php, Grades.fnc.php & EditReportCardGrades.php\n- SQL order fields list by Category & SORT_ORDER in AssignOtherInfo.php\n- Fix SQL error numeric field overflow when entering percent > 100 in Assignments.php\n- Comments length > 60 chars, responsive table ColorBox in EditReportCardGrades.php, FinalGrades.php, Grades.php, InputFinalGrades.php & StudentGrades.php\n- Add File Attached to Incomes in Incomes.php & Accounting/functions.inc.php\n- Add File Attached to Expenses in Expenses.php\n- SQL ACCOUNTING_INCOMES table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Fix SQL error when no user in session in Template.fnc.php\n- Correct help text note for User deletion in Help_en.php & help.po\n\nChanges in 8.3.1\n----------------\n- Fix SQL exclude fields of 'files' type in Substitutions.php\n- SQL order fields list by Category & SORT_ORDER in Substitutions.php\n- Fix force numeric separator \".\" when no en_US locale, use C locale in Warehouse.php\n- Fix Advanced Search > General Info text fields when adding Username in Search.fnc.php\n\nChanges in 8.3\n--------------\n- Fix PHP Warning non-numeric value encountered, use rounded percent grade in StudentGrades.php\n- Security Fix reflected XSS: encode HTML special chars for search_term in Courses.php\n- Add File Attached to Staff Payments in StaffPayments.php & Accounting/functions.inc.php\n- Add File Attached to Payments in StudentPayments.php & Student_Billing/functions.inc.php\n- SQL ACCOUNTING_PAYMENTS table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- SQL BILLING_PAYMENTS table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add help note for student deletion & translate in Help_en.php & help.po\n- Add RosarioSIS URL to image path in MarkDownHTML.fnc.php\n- Fix SQL error invalid byte sequence for encoding \"UTF8\": 0xde 0x20 in Security.php\n\nChanges in 8.2.1\n----------------\n- Fix SQL for Warning when only 0 points assignments in Assigments.php\n\nChanges in 8.2\n--------------\n- Fix replace regex: remove slash & allow space in FileUpload.fnc.php\n- Always Use Last Year's Picture if Missing in PrintClassLists.php\n- Fix #329 SQL error division by zero in t_update_mp_stats(): set min Credits to 1 in Courses.fnc.php\n- Fix SQL error when Teacher name has single quote in Courses.php\n- CSS FlatSIS remove useless line-height for tabs in stylesheet.css\n\nChanges in 8.1.1\n----------------\n- Fix security issue #328 unauthenticated access to Side.php in Warehouse.php, thanks to @ijdpuzon\n- Fix security issue #328 sanitize `$_POST` school, syear, mp & period parameters in Side.php\n\nChanges in 8.1\n--------------\n- Remove @ error control operator on pg_exec: allow PHP Warning in database.inc.php\n- Fix Address Field sequence name in AddressFields.php\n- Remove deprecated DBSeqConvertSerialName() function in database.inc.php\n- Fix Conflict Warning displayed twice in Courses.php\n- Fix PHP Notice Undefined index in miscExport.fnc.php\n- Fix SQL error when Student / Staff ID is hacked / not an integer in URL in Current.php\n- SQL ACCOUNTING_SALARIES table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add File Attached to Salaries in Salaries.php & Accounting/functions.inc.php\n- SQL BILLING_FEES table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add File Attached to Fees in StudentFees.php & Student_Billing/functions.inc.php\n- Fix Student Widgets for Advanced Search exports in GetStaffList.fnc.php, GetStuList.fnc.php & Search.inc.php\n- Add Export fields list (form) & Export fields list + extra SQL (student list) action hooks in Export.php & Actions.php\n- Do not remove Full Day and Half Day school periods from the Schedule table in PrintSchedules.php\n- Fix 403 Forbidden error due to pipe \"|\" in URL when using Apache 5G rules in Widgets.fnc.php\n\nChanges in 8.0.4\n----------------\n- Fix default Student/Parent program in Attendance/Menu.php\n\nChanges in 8.0.3\n----------------\n- Fix #324 Show Student Photo in Transcripts.fnc.php\n\nChanges in 8.0.2\n----------------\n- Fix User Widgets Search Terms in Users/Search.inc.php\n\nChanges in 8.0.1\n----------------\n- Fix #322 PHP syntax error, unexpected ')' in DailySummary.php\n\nChanges in 8.0\n--------------\n- Add Total from Payments & Total from Fees fields to Advanced Report in Export.php\n- Upgrade grunt, grunt-contrib-cssmin, grunt-contrib-uglify & grunt-contrib-watch & remove grunt-phpdoc in package.json & Gruntfile.js\n- CSS minification optimizations in stylesheet.css & stylesheet_wkhtmltopdf.css\n- JS uglify optimizations in plugins.min.js & plugins.min.js.map\n- Upgrade Chart.js from 2.9.3 to 3.4.1 & save 40KB in chart.min.js & Charts.fnc.php\n- Fix \"The gradebook configuration has been modified.\" note appearing twice in Grades/Configuration.php\n- Add warning in case all Assignments in Type have 0 Points (Extra Credit) in Assignments.php\n- Update French & Spanish translations in rosariosis.po\n- CSS FlatSIS shorten menu width & submenu links height + better contrast in stylesheet.css\n- CSS FlatSIS list square bullets in stylesheet.css\n- Default theme is now FlatSIS in rosariosis.sql\n- CSS remove .radio-attendance-code class in stylesheet.css, rtl.css & TakeAttendance.php\n- CSS remove Open Sans SVG fonts, format is deprecated in font.css & WPadmin/fonts/open\n- Upgrade marked.js 0.8.2 to version 1.2.9 in assets/js/marked/\n- Fix SQL error when $staff_id is 0 (no user in session) in Config.fnc.php\n- Remove Waived Fees from list in Student_Billing/functions.inc.php\n- New ROSARIO_DISABLE_ADDON_DELETE optional config constant in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- Add-on disable delete in Modules.inc.php & Plugins.inc.php\n- Merge Daily Transactions & Daily Totals programs in DailyTransactions.php & DailyTotals.php\n- Remove Daily Totals program from Student Billing & Accounting menus in Menu.php & rosariosis.sql\n- Fix Totals calculus in Accounting/includes/DailyTotals.php\n- Multibyte strings: check if not UTF-8 first to avoid cost of setting in Warehouse.php\n- Fix false positive Hacking Attempt on Print button click when no user in session in Warehouse.php\n- Merge Attendance Chart & Absence Summary programs in DailySummary.php & StudentSummary.php & Help_en.php\n- Remove Absence Summary program from Attendance menu in Menu.php, Help_en.php & rosariosis.sql\n\nChanges in 7.9.3\n----------------\n- Fix #318 PHP warning non-numeric value encountered for $LO_dir in ListOutput.fnc.php, thanks to @AhmadKakarr\n\nChanges in 7.9.2\n----------------\n- Fix SQL error when single quote in Course Title in InputFinalGrades.php\n- Fix include Semester course periods in the Schedule table in Schedule.inc.php\n- Fix #316 CSRF security issue set cookie samesite to strict, thanks to @huntrdev\n\nChanges in 7.9.1\n----------------\n- Fix remove file when has single quote in its name and actually delete file in Student.php, User.php & Schools.php\n- Fix download backup filename when contains spaces: use double quotes in DatabaseBackup.php\n\nChanges in 7.9\n--------------\n- Update default School Year to 2021 in rosariosis.sql & config.inc.sample.php\n\nChanges in 7.8.4\n----------------\n- Fix User Marking Period title in GradeBreakdown.php\n- SQL ORDER BY Teacher name in GradeBreakdown.php\n\nChanges in 7.8.3\n----------------\n- Fix trim 0 (float) when percent > 1,000: do not use comma for thousand separator in Grades.php & ProgressReports.php\n\nChanges in 7.8.2\n----------------\n- Fix try searching plural forms adding an 's' to singular form and with number set to 1 in Translator.php\n\nChanges in 7.8.1\n----------------\n- CSS Edge browser fix: Do not merge focus-within styles with hover styles in stylesheet.css, stylesheet_wkhtmltopdf.css & rtl.css\n\nChanges in 7.8\n--------------\n- Handle `multiple` files attribute in warehouse.js & Inputs.php\n- Add FileUploadMultiple(). Handle `multiple` files attribute for FileUpload() in FileUpload.fnc.php\n- Remove Reset button from Find a Student / User forms in Students/Search.inc.php & Users/Search.inc.php\n- CSS & JS open submenu on focus & focus-within in warehouse.js, stylesheet.css & rtl.css\n- CSS menu link & button color on focus in stylesheet.css & colors.css\n- Fix check students Course Status in PrintClassLists.php, PrintClassPictures.php, ClassSearchWidget.fnc.php, Referrals.php, EmailReferral.fnc.php & Widgets.fnc.php\n- Add Include Inactive Students checkbox in MasterScheduleReport.php & RequestsReport.php\n- Fix unset current student (check Course Status) when MP updated in Side.php\n- SQL fix Discipline Referrals using WHERE EXISTS in Widgets.fnc.php\n- Numeric Discipline field: invert values so BETWEEN works in Widgets.fnc.php\n- Numeric Discipline field: input type number in Widgets.fnc.php\n- Fix SQL error missing FROM ADDRESS table in GetStuList.fnc.php\n\nChanges in 7.7\n--------------\n- Move Dashboard() call outside in Dashboard.fnc.php & Portal.php\n- Add .xlsm,.key,.midi,.aif,.mpeg,.h264,.mkv,.log,.email,.eml,.emlx,.msg,.vcf extensions to white list in FileUpload.fnc.php\n- Add \"Last Name Middle Name First Name\" option to Display Name in GetStuList.fnc.php & Configuration.php\n- Fix SQL error escape course title in StudentGrades.php\n- SQL Remove Salaries having a Payment (same Amount & Comments (Title), after or on Assigned Date) in Accounting/functions.inc.php\n- SQL match Payment Comments LIKE Fee Title in Student_Billing/functions.inc.php\n- CSS fix list line-height in FlatSIS/stylesheet_wkhtmltopdf.css\n\nChanges in 7.6.1\n----------------\n- Fix #307 XSS update CodeIgniter Security class in classes/Security.php, thanks to @DustinBorn\n- Move Portal Poll vote code to modfunc in PortalPollNotes.php & Portal.php\n- Fix #308 Unauthenticated SQL injection. Use sanitized `$_REQUEST` in Portal.php, thanks to @DustinBorn\n- Fix #308 sanitize key. Pass array keys through function in Warehouse.php, thanks to @DustinBorn\n- Fix #309 unset `$_SESSION` so user cannot maintain dummy session in PasswordReset.php, thanks to @DustinBorn\n- Remove use of `$_SESSION['STAFF_ID'] === '-1'` in User.fnc.php & PasswordReset.php\n\nChanges in 7.6\n--------------\n- Fix login password with single quote, use POST in index.php & Preferences.php\n- HTML Use #! instead of JS return false to not go back to top in Buttons.php & Profiles.php\n- JS remove warehouse.min.js & include warehouse.js inside plugins.min.js in Gruntfile.js, assets/js/ & Warehouse.php\n- Fix PHP8 compatibility issues (warnings & fatal errors), system wide\n- Fix save new Grade with \"0\" as Title in ReportCardGrades.php\n- PHP8 no xmlrpc ext: load xmlrpc compat functions in plugins/Moodle/client.php, xmlrpc.php, XML_RPC.php, XmlrpcDecoder.php & XmlrpcEncoder.php\n- Fix xmlrpc nested arrays, use param & value elements instead in XmlrpcEncoder.php\n- Fix SQL Total points only select assignments for CP teacher (teacher may have changed) in Grades.php, InputFinalGrades.php, StudentGrades.php & GradebookBreakdown.php\n- Fix SQL Grades sort order in GradebookBreakdown.php\n- Add Login form link action hook in index.php & Actions.php\n- SQL fix Report Card Grades insert in rosariosis_fr.sql\n- SQL fix ORDER Report Cards by Student name & Course list by Title in ReportCards.fnc.php\n- SQL fix error invalid input syntax for integer in DailySummary.php\n- Replace tested on Ubuntu 16.04 with 18.04 (Buster) in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n\nChanges in 7.5\n--------------\n- HTML fix Student Assignment Submission display in StudentAssignments.fnc.php\n- Percent rounding to 2 decimal places is new School default in \\_makeLetterGrade.fnc.php\n- CSS Fix widefat table border color when rendered in PDF inside Chrome in colors.css\n- Add phpwkhtmltopdf class & remove Wkhtmltopdf class in classes/\n- Use phpwkhtmltopdf class instead of Wkhtmltopdf (more reliable & faster) in PDF.php\n- Add Report Cards PDF footer action hook in ReportCards.fnc.php & Actions.php\n- Transcripts PDF header action hook: echo your custom text before or append it to $header_html to display it after in Transcripts.fnc.php\n- Transcripts PDF footer action hook: echo your custom text before or append it to $footer_html to display it after in Transcripts.fnc.php\n- Add .transcript-certificate-block1 & .transcript-certificate-block2 CSS classes in Transcripts.fnc.php\n- Add .report-card-free-text CSS class in ReportCards.fnc.php\n- Delete any attendance for this day & student prior to update in FixDailyAttendance.php\n- Use \\_makeLetterGrade() for Percent grade so it reflects Teacher's Score rounding configuration in Grades.php & ProgressReports.php\n- Fix Add Credits only for Report Cards in ReportCards.fnc.php\n- Fix SQL error invalid input syntax for integer (Class Rank input) in Widgets.fnc.php\n- HTML Grades GPA Widget: use number input & check Weighted by default in Widgets.fnc.php\n\nChanges in 7.4\n--------------\n- List sort comment: trim & fix position in ListOutput.fnc.php\n- Fix #303 Raw value in comment so we can sort Percent column the right way in Grades.php, thanks to @dd02\n- Add Database Backup link to header in Rollover.php\n- Add Course Widget configuration option: Popup window or Pull-Down in Configuration.php & Help_en.php\n- Add Course Widget: select / Pull-Down in Widgets.fnc.php\n- Update French & Spanish translations in rosariosis.po, help.po\n- Add Total Credits in ReportCards.fnc.php\n- Do not display \"General Comments\" title if no comments in ReportCards.fnc.php\n- HTML display rows of 3 School Period checkboxes in AddAbsences.php\n- Comment input maxlength increased to 500 in InputFinalGrades.php\n- Comment Code input field is required in ReportCardCommentCodes.php\n- Add php-zip extension to list in INSTALL.md\n- Check for zip extension in diagnostic.php\n- Fix SQL error integer out of range in Food_Service/Students/Accounts.php\n- French translation: replace \"Effacer\" with \"Supprimer\" in rosariosis.po & help.po\n- Fix Teacher Programs Progress Report PDF, do not echo form in TeacherPrograms.php\n\nChanges in 7.3.1\n----------------\n- Fix admin override: no input div when values are not saved yet in Grades/Configuration.php\n- Fix #304 Do not include Excused (`*` or -1) grades in GradebookBreakdown.php, thanks to @dd02\n- Fix #304 regression since 5.0 Count students in GradebookBreakdown.php, thanks to @dd02\n- Fix #304 Totals count exclude Extra Credit assignments when Total Points is 0 for the Type, thanks to @dd02\n\nChanges in 7.3\n--------------\n- SQL Replace AND p.ATTENDANCE='Y' with AND cp.DOES_ATTENDANCE IS NOT NULL in Letters.php, StudentLabels.fnc.php, HonorRoll.fnc.php & Reminders.php\n- SQL remove unused SELECT ROOM in HonorRoll.fnc.php\n- Translate database on add-on install: run 'install_fr.sql' file in Modules.inc.php, Plugins.inc.php, modules/README.md & plugins/README.md\n- CSS remove wildcard rules in stylesheet.css & wkhtmltopdf.css\n- CSS remove browser input outline on focus in colors.css\n- Fix Format Phone Number for US in GetStuList.fnc.php, thanks to @dzungdo\n- Attendance dashboard limit Absences to past days in Dashboard.inc.php\n- Fix #299 Remove trailing slash \"/\" or dash \"-\" or dot \".\" from date in DailySummary.php\n- Fix #300 Include Full Day and Half Day school periods in the schedule table in PrintSchedules.php, thanks to @dzungdo\n- Update translations complete % in locale/REFERENCE.md\n- Add tested on CentOS & Google Chrome in INSTALL.md & INSTALL.pdf, thanks to @dd02\n- Add Before First Login form action hook in index.php & Actions.php\n- Fix regression since 7.0 not rolled items are checked in Rollover.php\n\nChanges in 7.2.4\n----------------\n- Take in Account Calendar Day Minutes in UpdateAttendanceDaily.fnc.php\n- Fix regression since 5.3 Return false if School Periods Length sum is 0 in UpdateAttendanceDaily.fnc.php, thanks to @dzungdo\n\nChanges in 7.2.3\n----------------\n- Fix regression since 5.9 search text User Field in Search.fnc.php, thanks to @dzungdo\n\nChanges in 7.2.2\n----------------\n- Fix SQL error foreign keys: Roll Schools before rolling Student Enrollment in Rollover.php\n- Fix SQL error table ADDRESS specified more than once in GetStuList.fnc.php\n\nChanges in 7.2.1\n----------------\n- Fix ParseMLField for Username field category in Preferences.php\n- Fix PHP Warning check requested locale exists in Warehouse.php\n- Add Attendance Codes help for (Lunch) Categories in Help_en.php & help.po\n- Fix SQL error multiple rows returned by a subquery in CreateParents.php\n\nChanges in 7.2\n--------------\n- Add Grade Level breakdown in StudentFieldBreakdown.php\n- Add link to Student Info in AddDrop.php\n- Limit students to User schools in AddDrop.php\n- Order Day, Month & Year inputs depending on User date preference in Date.php\n- SQL fix only display enrolled students in AddStudents.php\n- Link to Student Info redirects to right school in AddStudents.php\n- Reset password variable for each Contact in CreateParents.php\n\nChanges in 7.1.4\n----------------\n- Fix infinite loop when username already exists in CreateParents.php\n\nChanges in 7.1.3\n----------------\n- Fix #297 regression since 6.9 & SQL error in StudentSummary.php\n\nChanges in 7.1.2\n----------------\n- Fix SQL error Include Inactive Students for admin in PrintClassLists.php\n\nChanges in 7.1.1\n----------------\n- Fix #296 Include Inactive Students for admin in PrintClassLists.php\n\nChanges in 7.1\n--------------\n- Final Grading Percentages: add \"No quarters found\" error in Configuration.php\n- Add Start Date input in Scheduler.php\n- Export (Excel) date to YYYY-MM-DD format (ISO) in Date.php & Preferences.php\n- Select Date Format: Add Preferences( 'DATE' ) in User.fnc.php, Preferences.php, Date.php & Side.php\n- Fix SQL error TITLE column limit to 50 characters in GradeLevels.php\n- HTML remove radio buttons (File Attached or Embed Link) in PortalNotes.php & PortalPollsNotes.fnc.php\n- Add Grade Level breakdown in StudentBreakdown.php\n- Include Credits in ReportCards.fnc.php\n\nChanges in 7.0.4\n----------------\n- Fix #295 regression since 7.0 cannot save N/A date in Date.php\n\nChanges in 7.0.3\n----------------\n- Fix Multiple School Periods: Course Period School Period does not match, skip in Scheduler.php\n\nChanges in 7.0.2\n----------------\n- JS Fix search form onsubmit in Export.php\n\nChanges in 7.0.1\n----------------\n- Fix #292 System error \"blocked access to local file\" with wkhtmltopdf 0.12.6 in Wkhtmltopdf.php\n\nChanges in 7.0\n--------------\n- Update Markdownify from v2.1.11 to v2.3.1 in classes/Markdownify/*\n- Update Parsedown from v1.6.0 to v1.7.4 in classes/Parsedown.php\n- Update MoTranslator from v3.4 to v4.0 in Warehouse.php, Help.fnc.php & classes/MoTranslator/*\n- Fix 'School' translation when using MoTranslator in Schedule.inc.php & rosariosis.po\n- Fix '%s Handbook' translation when using MoTranslator in Help.php\n- CSS fix align \"+\" New Event icon to bottom in Calendar.php, CalendarDay.inc.php, stylesheet.css & zreponsive.css\n- Fix Day Number when multiple calendars and school years in CalendarDay.inc.php, DayToNumber.inc.php\n- Fix Numbered days display in SchoolPeriodsSelectInput.fnc.php & Courses.fnc.php\n- SQL improve Numbered days in AddAbsences.php, Administration.php, DailySummary.php, TakeAttendance.php, TeacherCompletion.php, UpdateAttendanceDaily.fnc.php & Portal.php\n- Place Rollover under Utilities separator in Menu.php\n- Merge Schedule Report & Master Schedule Report in Menu.php, MasterScheduleReport.php, ScheduleReport.php & rosariosis.sql\n- Add Students column to report in RequestsReport.php\n- Merge Requests Report & Unfilled Requests in Menu.php, RequestsReport.php, UnfilledRequests.php, Scheduler.php, Help_en.php & rosariosis.sql\n- Merge Average Daily Attendance & Average Attendance by Day in Menu.php, Percent.php, Help_en.php, help.po & rosariosis.sql\n- Remove \"Happy []...\" text in Portal.php\n- HTML remove \"Demographics\" header to gain space on PDF in AttendanceSummary.php\n- SQL Update ATTENDANCE_CODE (admin) when is NULL in TakeAttendance.php\n- CSS Add .widefat.files class in StudentsUsersInfo.fnc.php & stylesheet.css\n- CSS WPadmin more padding for list rows, menu links & footer help in stylesheet.css\n- CSS FlatSIS less padding for list row, header & popTable in stylesheet.css\n- CSS FlatSIS reduce body line-height & fix Dashboard tipmsg border in stylesheet.css\n- Format \"Show Available Seats\" & \"Print Schedule\" headers in Schedule.php\n- Remove $fy_id global variable in Schedule.php\n- HTML Add tooltips & notes in Rollover.php\n- Fix current CP Marking Period check on update in Courses.php\n- Fix limit list results to 1000, do not remove 1st result in ListOutput.fnc.php\n- Add $RosarioErrorsAddress config variable in config.inc.sample.php\n- Fix $RosarioNotifyAddress config variable description in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- SQL no access to Custom \"My Report\" program for admin by default in rosariosis.sql\n- JS MarkdownToHTML No MarkDown in text, return raw text in warehouse.js\n- Fix Delete from other Student/User Info tabs in Student.php & User.php\n- Remove deprecated since 4.5 rollover_* action hooks in Rollover.php & Actions.php\n- Fix Error: There is no column for The value for 0. This value was not saved in SaveData.fnc.php\n- Fix Do not Save / Export Medical tab lists in Medical.inc.php\n\n\n### Old versions CHANGES\n- [CHANGES for versions 5 and 6](CHANGES_V5_6.md).\n- [CHANGES for versions 3 and 4](CHANGES_V3_4.md).\n- [CHANGES for versions 1 and 2](CHANGES_V1_2.md).\n", "<?php\n/**\n * File Upload functions\n *\n * @package RosarioSIS\n * @subpackage ProgramFunctions\n */\n\n/**\n * File Upload\n *\n * @example FileUpload( 'photo', $StudentPicturesPath . UserSyear() . '/', array( '.jpg', '.jpeg' ), 2, $error, '.jpg', UserStudentID() );\n *\n * @global $_FILES\n *\n * @param string $input            Name of the input file field, for example 'photo'.\n * @param string $path             Final path with trailing slash, for example $StudentPicturesPath . UserSyear() . '/'.\n * @param array  $ext_white_list   Extensions white list, for example array('.jpg', '.jpeg').\n * @param float  $size_limit       Size Limit in Mb, set it to 0 to use server limit (upload_max_filesize).\n * @param array  $error            The global errors array.\n * @param string $final_ext        Final file extension (useful for .jpg, if .jpeg submitted) (optional).\n * @param string $file_name_no_ext Final file name without extension, for example UserStudentID() (optional).\n *\n * @return string|boolean Full path to file, or false if error\n */\nfunction FileUpload( $input, $path, $ext_white_list, $size_limit, &$error, $final_ext = '', $file_name_no_ext = '' )\n{\n\t$file_name = $full_path = false;\n\n\tif ( ! $final_ext )\n\t{\n\t\t$final_ext = empty( $_FILES[ $input ]['tmp_name'] ) ? '' :\n\t\t\tmb_strtolower( mb_strrchr( $_FILES[ $input ]['name'], '.' ) );\n\t}\n\n\tif ( $file_name_no_ext )\n\t{\n\t\t$file_name = $file_name_no_ext . $final_ext;\n\t}\n\n\tif ( empty( $_FILES[ $input ]['tmp_name'] )\n\t\t|| ! is_uploaded_file( $_FILES[ $input ]['tmp_name'] ) )\n\t{\n\t\t// Check the post_max_size & php_value upload_max_filesize values in the php.ini file.\n\t\t$error[] = _( 'File not uploaded' );\n\t}\n\n\telseif ( ! in_array( mb_strtolower( mb_strrchr( $_FILES[ $input ]['name'], '.' ) ), $ext_white_list ) )\n\t{\n\t\t$error[] = sprintf(\n\t\t\t_( 'Wrong file type: %s (%s required)' ),\n\t\t\t$_FILES[ $input ]['type'],\n\t\t\timplode( ', ', $ext_white_list )\n\t\t);\n\t}\n\n\telseif ( $size_limit\n\t\t&& $_FILES[ $input ]['size'] > $size_limit * 1024 * 1024 )\n\t{\n\t\t$error[] = sprintf(\n\t\t\t_( 'File size > %01.2fMb: %01.2fMb' ),\n\t\t\t$size_limit,\n\t\t\t( $_FILES[ $input ]['size'] / 1024 ) / 1024\n\t\t);\n\t}\n\n\t// If folder doesnt exist, create it!\n\telseif ( ! is_dir( $path )\n\t\t&& ! @mkdir( $path, 0755, true ) ) // Fix shared hosting: permission 755 for directories.\n\t{\n\t\t$error[] = sprintf( _( 'Folder not created' ) . ': %s', $path );\n\t}\n\n\telseif ( ! is_writable( $path ) )\n\t{\n\t\t// See PHP / Apache user rights for folder.\n\t\t$error[] = sprintf( _( 'Folder not writable' ) . ': %s', $path );\n\t}\n\n\t// Store file.\n\telseif ( ! move_uploaded_file(\n\t\t$_FILES[ $input ]['tmp_name'],\n\t\t$full_path = ( $path . ( $file_name ?\n\t\t\t$file_name :\n\t\t\tno_accents( mb_substr(\n\t\t\t\t$_FILES[ $input ]['name'],\n\t\t\t\t0,\n\t\t\t\tmb_strrpos( $_FILES[ $input ]['name'], '.' )\n\t\t\t) ) . $final_ext\n\t\t) )\n\t) )\n\t{\n\t\t$error[] = sprintf( _( 'File invalid or not moveable' ) . ': %s', $_FILES[ $input ]['tmp_name'] );\n\t}\n\n\treturn $full_path;\n}\n\n\n/**\n * Image File Upload\n *\n * @example ImageUpload( 'photo', array( 'width' => 150, 'height' => '150' ), $StudentPicturesPath . UserSyear() . '/', array(), '.jpg', UserStudentID() );\n * @example ImageUpload( $base64_img, array( 'width' => 640, 'height' => '320' ) );\n *\n * @since 3.3\n *\n * @uses FileUpload()\n * @uses ImageResizeGD class.\n *\n * @param string $input            Name of the input file field, for example 'photo', or base64 encoded data, src attribute value.\n * @param array  $target_dim       Target dimensions to determine if can be resized. Defaults to array( 'width' => 994, 'height' => 1405 ) (optional).\n * @param string $path             Final path with trailing slash, for example $StudentPicturesPath . UserSyear() . '/'. Defaults to \"assets/FileUploads/[Syear]/[staff_or_student_ID]/\" (optional).\n * @param array  $ext_white_list   Extensions white list, for example array('.jpg', '.jpeg').\n * @param string $final_ext        Final file extension (useful for .jpg, if .jpeg submitted) (optional).\n * @param string $file_name_no_ext Final file name without extension, for example UserStudentID() (optional).\n *\n * @return string|boolean Full path to file, or false if error\n */\nfunction ImageUpload( $input, $target_dim = [], $path = '', $ext_white_list = [], $final_ext = null, $file_name_no_ext = '' )\n{\n\tglobal $FileUploadsPath,\n\t\t$PNGQuantPath,\n\t\t$error;\n\n\trequire_once 'classes/ImageResizeGD.php';\n\n\t$is_base64 = ( strpos( $input, 'data:image' ) === 0 );\n\n\tif ( ! $path )\n\t{\n\t\t// Path defaults to \"assets/FileUploads/[Syear]/[staff_or_student_ID]/\".\n\t\t$user_folder = User( 'STAFF_ID' ) ? 'staff_' . User( 'STAFF_ID' ) : 'student_' . UserStudentID();\n\n\t\t$path = $FileUploadsPath . UserSyear() . '/' . $user_folder . '/';\n\t}\n\n\tif ( ! $ext_white_list )\n\t{\n\t\t// Defaults to JPG, PNG & GIF.\n\t\t$ext_white_list = [ '.jpg', '.jpeg', '.png', '.gif' ];\n\t}\n\n\t// Defaults to horizontal PDF target dimensions.\n\t$target_dim_default = [ 'width' => 994, 'height' => 1405 ];\n\n\t$target_dim = array_replace_recursive( $target_dim_default, (array) $target_dim );\n\n\tif ( ImageResizeGD::test() )\n\t{\n\t\t// If folder doesnt exist, create it!\n\t\tif ( ! is_dir( $path )\n\t\t\t&& ! @mkdir( $path, 0755, true ) ) // Fix shared hosting: permission 755 for directories.\n\t\t{\n\t\t\t$error[] = sprintf( _( 'Folder not created' ) . ': %s', $path );\n\n\t\t\treturn ( $is_base64 ? $input : false );\n\t\t}\n\t\telseif ( ! is_writable( $path ) )\n\t\t{\n\t\t\t// See PHP / Apache user rights for folder.\n\t\t\t$error[] = sprintf( _( 'Folder not writable' ) . ': %s', $path );\n\n\t\t\treturn ( $is_base64 ? $input : false );\n\t\t}\n\n\t\tif ( ! $is_base64 )\n\t\t{\n\t\t\tif ( ! is_uploaded_file( $_FILES[ $input ]['tmp_name'] ) )\n\t\t\t{\n\t\t\t\t// Check the post_max_size & php_value upload_max_filesize values in the php.ini file.\n\t\t\t\t$error[] = _( 'File not uploaded' );\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$image_path_or_string = $_FILES[ $input ]['tmp_name'];\n\n\t\t\t$original_image_size = filesize( $image_path_or_string );\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$image_path_or_string = $input;\n\n\t\t\t// http://stackoverflow.com/questions/5373544/php-size-of-base64-encode-string-file\n\t\t\t$original_image_size = (int) ( strlen( rtrim( $image_path_or_string, '=' ) ) * 3 / 4 );\n\t\t}\n\n\t\t// Build file name.\n\t\tif ( $file_name_no_ext )\n\t\t{\n\t\t\t$file_name = $file_name_no_ext . $final_ext;\n\t\t}\n\t\telseif ( $is_base64 )\n\t\t{\n\t\t\t// Use MD5 sum for base64 images.\n\t\t\t$file_name = md5( $image_path_or_string ) . $final_ext;\n\n\t\t\t$full_path = $path . $file_name;\n\n\t\t\t// Check if file already exists?\n\t\t\tif ( $final_ext\n\t\t\t\t&& file_exists( $full_path ) )\n\t\t\t{\n\t\t\t\treturn $full_path;\n\t\t\t}\n\t\t\telseif ( file_exists( $full_path . '.jpg' ) )\n\t\t\t{\n\t\t\t\treturn $full_path . '.jpg';\n\t\t\t}\n\t\t\telseif ( file_exists( $full_path . '.png' ) )\n\t\t\t{\n\t\t\t\treturn $full_path . '.png';\n\t\t\t}\n\t\t\telseif ( file_exists( $full_path . '.gif' ) )\n\t\t\t{\n\t\t\t\treturn $full_path . '.gif';\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Use original file name.\n\t\t\t$file_name = no_accents( mb_substr(\n\t\t\t\t$_FILES[ $input ]['name'],\n\t\t\t\t0,\n\t\t\t\tmb_strrpos( $_FILES[ $input ]['name'], '.' )\n\t\t\t) ) . $final_ext;\n\t\t}\n\n\t\t$extension = null;\n\n\t\tif ( mb_strtolower( $final_ext ) === '.jpg'\n\t\t\t|| mb_strtolower( $final_ext ) === '.jpeg' )\n\t\t{\n\t\t\t$extension = IMAGETYPE_JPEG;\n\t\t}\n\t\telseif ( mb_strtolower( $final_ext ) === '.png' )\n\t\t{\n\t\t\t$extension = IMAGETYPE_PNG;\n\t\t}\n\t\telseif ( mb_strtolower( $final_ext ) === '.gif' )\n\t\t{\n\t\t\t$extension = IMAGETYPE_GIF;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\t$target_jpg_compression = 85;\n\n\t\t\t$image_resize_gd = new ImageResizeGD(\n\t\t\t\t$image_path_or_string,\n\t\t\t\t$target_jpg_compression,\n\t\t\t\t9,\n\t\t\t\t$PNGQuantPath\n\t\t\t);\n\n\t\t\t// 3x or 2x Retina factor depending if small target image.\n\t\t\t$factor = $target_dim['width'] < 994 ? 3 : 2;\n\n\t\t\tif ( $image_resize_gd->getSourceWidth() > $target_dim['width'] * $factor\n\t\t\t\t|| $image_resize_gd->getSourceHeight() > $target_dim['height'] * $factor )\n\t\t\t{\n\t\t\t\t// Image dimensions > target dimensions *2 or 3 (enough for Retina), resize & compress more.\n\t\t\t\t$image_resize_gd->resizeWithinDimensions(\n\t\t\t\t\t$target_dim['width'] * $factor,\n\t\t\t\t\t$target_dim['height'] * $factor\n\t\t\t\t);\n\n\t\t\t\t$target_jpg_compression = 65;\n\t\t\t}\n\t\t\telseif ( $image_resize_gd->getSourceWidth() > $target_dim['width']\n\t\t\t\t|| $image_resize_gd->getSourceHeight() > $target_dim['height'] )\n\t\t\t{\n\t\t\t\t// Image dimensions > target dimensions, compress a bit more.\n\t\t\t\t$target_jpg_compression = 75;\n\t\t\t}\n\n\t\t\t// Upload image and return path.\n\t\t\t$full_path = $image_resize_gd->saveImageFile(\n\t\t\t\t$path . $file_name,\n\t\t\t\t$extension,\n\t\t\t\t$target_jpg_compression,\n\t\t\t\t// White background for JPEG.\n\t\t\t\t( $extension === IMAGETYPE_JPEG ? 'FFFFFF' : null )\n\t\t\t);\n\n\t\t\tif ( filesize( $full_path ) < $original_image_size )\n\t\t\t{\n\t\t\t\treturn $full_path;\n\t\t\t}\n\t\t\telseif ( $is_base64 )\n\t\t\t{\n\t\t\t\t// Our \"optimized\" file results bigger than the original one...\n\t\t\t\t$image_data = $image_path_or_string;\n\n\t\t\t\t$image_data = substr( $image_data, ( strpos( $image_data, 'base64' ) + 6 ) );\n\n\t\t\t\t$image_data = base64_decode( $image_data );\n\n\t\t\t\t// Save the original base64 image instead.\n\t\t\t\tfile_put_contents( $full_path, $image_data );\n\n\t\t\t\treturn $full_path;\n\t\t\t}\n\t\t}\n\t\tcatch ( Exception $e )\n\t\t{\n\t\t\t$error[] = 'ImageResizeGD: ' . $e->getMessage();\n\t\t}\n\t\tcatch ( InvalidArgumentException $e )\n\t\t{\n\t\t\t$error[] = 'ImageResizeGD: ' . $e->getMessage();\n\t\t}\n\t}\n\n\t// No GD library or ImageResizeGD exception...\n\tif ( $is_base64 )\n\t{\n\t\t// We return the base64 image as is...\n\t\treturn $input;\n\t}\n\n\t// Use regular FileUpload() function.\n\treturn (string) FileUpload(\n\t\t$input,\n\t\t$path,\n\t\t$ext_white_list,\n\t\t0,\n\t\t$error,\n\t\t(string) $final_ext,\n\t\t$file_name_no_ext\n\t);\n}\n\n\n/**\n * Files field Upload and Update\n * Upload custom Files field & update corresponding DB table.\n * Input name must BEGIN with $request, for example: \"valuesCUSTOM_3\".\n *\n * @since 4.6\n *\n * @example FilesUploadUpdate( 'SCHOOLS', 'values',\t$FileUploadsPath . 'Schools/' . UserSchool() . '/' );\n *\n * @uses FileUpload()\n *\n * @param string $table   DB Table name.\n * @param string $request Request part of the input name.\n * @param string $path    Path, folder where the files will be uploaded to.\n *\n * @return string Empty or last file full path.\n */\nfunction FilesUploadUpdate( $table, $request, $path )\n{\n\tglobal $error;\n\n\tif ( ! $table\n\t\t|| ! $path\n\t\t|| empty( $_FILES ) )\n\t{\n\t\treturn '';\n\t}\n\n\t$new_file = '';\n\n\tforeach ( $_FILES as $input => $file )\n\t{\n\t\tif ( mb_strpos( $input, $request ) !== 0 )\n\t\t{\n\t\t\t// Input name must BEGIN with $request, for example: \"valuesCUSTOM_3\".\n\t\t\tcontinue;\n\t\t}\n\n\t\t$file_name_no_ext = no_accents( mb_substr(\n\t\t\t$_FILES[ $input ]['name'],\n\t\t\t0,\n\t\t\tmb_strrpos( $_FILES[ $input ]['name'], '.' )\n\t\t) );\n\n\t\t$file_name_no_ext .= '_' . date( 'Y-m-d_His' );\n\n\t\t$new_file = FileUpload(\n\t\t\t$input,\n\t\t\t$path,\n\t\t\tFileExtensionWhiteList(),\n\t\t\t0,\n\t\t\t$error,\n\t\t\t'',\n\t\t\t$file_name_no_ext\n\t\t);\n\n\t\tif ( $new_file )\n\t\t{\n\t\t\t$value_append = $new_file . '||';\n\n\t\t\t$column = str_replace( $request, '', $input );\n\n\t\t\tif ( $table === 'SCHOOLS' )\n\t\t\t{\n\t\t\t\t$where_sql = \"ID='\" . UserSchool() . \"' AND SYEAR='\" . UserSyear() . \"'\";\n\t\t\t}\n\t\t\telseif ( $table === 'STUDENTS' )\n\t\t\t{\n\t\t\t\t$where_sql = \"STUDENT_ID='\" . UserStudentID() . \"'\";\n\t\t\t}\n\t\t\telseif ( $table === 'ADDRESS' )\n\t\t\t{\n\t\t\t\t$where_sql = \"ADDRESS_ID='\" . $_REQUEST['address_id'] . \"'\";\n\t\t\t}\n\t\t\telseif ( $table === 'PEOPLE' )\n\t\t\t{\n\t\t\t\t$where_sql = \"PERSON_ID='\" . $_REQUEST['person_id'] . \"'\";\n\t\t\t}\n\t\t\telseif ( $table === 'STAFF' )\n\t\t\t{\n\t\t\t\t$where_sql = \"STAFF_ID='\" . UserStaffID() . \"'\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$where_sql = \"ID='\" . $_REQUEST['id'] . \"'\";\n\t\t\t}\n\n\t\t\tDBQuery( \"UPDATE \" . DBEscapeIdentifier( $table ) . \"\n\t\t\t\tSET \" . DBEscapeIdentifier( $column ) . \"=COALESCE(\" .\n\t\t\t\tDBEscapeIdentifier( $column ) . \",'')||'\" . DBEscapeString( $value_append ) . \"'\n\t\t\t\tWHERE \" . $where_sql );\n\t\t}\n\t}\n\n\treturn $new_file;\n}\n\n/**\n * Handle `multiple` files attribute for FileUpload().\n * Move $_FILES[ $input ][...][ $i ] to $_FILES[ {$input}_{$i} ] so FileUpload() can handle it.\n *\n * @since 7.8\n *\n * @example foreach ( FileUploadMultiple( 'files' ) as $input ) { FileUpload( $input ) }\n *\n * @param string $input Input name, without square brackets [].\n *\n * @return array Empty if no files. $input if not multiple. {$input}_{$i} if multiple.\n */\nfunction FileUploadMultiple( $input )\n{\n\tif ( ! isset( $_FILES[ $input ] ) )\n\t{\n\t\treturn [];\n\t}\n\n\tif ( ! is_array( $_FILES[ $input ]['name'] ) )\n\t{\n\t\t// Not multiple files, return $input.\n\t\treturn [ $input ];\n\t}\n\n\t$inputs = [];\n\n\t$files = [];\n\n\tforeach ( $_FILES[ $input ] as $attribute => $files_info )\n\t{\n\t\tforeach ( $files_info as $i => $file_info )\n\t\t{\n\t\t\tif ( ! isset( $files[ $i ] ) )\n\t\t\t{\n\t\t\t\t$files[ $i ] = [];\n\t\t\t}\n\n\t\t\t$files[ $i ][ $attribute ] = $file_info;\n\t\t}\n\t}\n\n\tforeach ( $files as $i => $file )\n\t{\n\n\t\t$input_new_index = $input . '_' . $i;\n\n\t\t$inputs[] = $input_new_index;\n\n\t\t// Move $_FILES[ $input ][...][ $i ] to $_FILES[ {$input}_{$i} ] so FileUpload() can handle it.\n\t\t$_FILES[ $input_new_index ] = $file;\n\t}\n\n\tunset( $_FILES[ $input ] );\n\n\treturn $inputs;\n}\n\n/**\n * Removes accents from string.\n * Also replaces characters others than letters, space, numbers & points\n * with underscores '_'.\n * Perfect to sanitize a filename.\n *\n * @since 3.4 uses PHP intl extension or return microtime in case string does not contain ASCII chars.\n * @since 8.2 Fix replace regex: remove slash & allow space\n *\n * @link http://stackoverflow.com/questions/1017599/how-do-i-remove-accents-from-characters-in-a-php-string\n *\n * @example no_accents( '\u0440\u0443\u043b\u043e\u043d\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439' )\n * Will return 'rulonpol_zovatelej' if PHP intl extension is activated\n * Else it will return microtime, for example '14976328319110'\n *\n * @example no_accents( '\u96c6\u56e2\u5206\u914d\u5b66\u751f\u4fe1\u606f' )\n * Will return 'ji_tuan_fen_pei_xue_sheng_xin_xi' if PHP intl extension is activated\n * Else it will return microtime, for example '14976328319110'\n *\n * @param string $string String with maybe accents.\n *\n * @return string String with no accents or microtime.\n */\nfunction no_accents( $string )\n{\n\tif ( ! preg_match( '/[\\x80-\\xff]/', $string) )\n\t{\n\t\t// Replace characters others than letters, space, numbers & points with underscores  \"_\".\n\t\t$string = preg_replace(\n\t\t\t'/([^ _\\-.a-z0-9]+)/i',\n\t\t\t'_',\n\t\t\t$string\n\t\t);\n\t}\n\n\tif ( function_exists( 'transliterator_transliterate' ) )\n\t{\n\t\t/**\n\t\t * Requires PHP intl extension.\n\t\t * Will transliterate to latin ASCII chars.\n\t\t *\n\t\t * @example \u0440\u0443\u043b\u043e\u043d\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 => rulonpol_zovatelej\n\t\t * @example \u96c6\u56e2\u5206\u914d\u5b66\u751f\u4fe1\u606f => ji_tuan_fen_pei_xue_sheng_xin_xi\n\t\t */\n\t\t$string = transliterator_transliterate(\n\t\t\t'Any-Latin; Latin-ASCII; Lower()',\n\t\t\t$string\n\t\t);\n\n\t\t// Replace characters others than letters, space, numbers & points with underscores  \"_\".\n\t\t$string = preg_replace(\n\t\t\t'/([^ _\\-.a-z0-9]+)/i',\n\t\t\t'_',\n\t\t\t$string\n\t\t);\n\n\t\treturn $string;\n\t}\n\n\t$c195 = chr( 195 );\n\t$c196 = chr( 196 );\n\t$c197 = chr( 197 );\n\n\t$chars = [\n\t// Decompositions for Latin-1 Supplement.\n\t$c195 . chr(128) => 'A', $c195 . chr(129) => 'A',\n\t$c195 . chr(130) => 'A', $c195 . chr(131) => 'A',\n\t$c195 . chr(132) => 'A', $c195 . chr(133) => 'A',\n\t$c195 . chr(135) => 'C', $c195 . chr(136) => 'E',\n\t$c195 . chr(137) => 'E', $c195 . chr(138) => 'E',\n\t$c195 . chr(139) => 'E', $c195 . chr(140) => 'I',\n\t$c195 . chr(141) => 'I', $c195 . chr(142) => 'I',\n\t$c195 . chr(143) => 'I', $c195 . chr(145) => 'N',\n\t$c195 . chr(146) => 'O', $c195 . chr(147) => 'O',\n\t$c195 . chr(148) => 'O', $c195 . chr(149) => 'O',\n\t$c195 . chr(150) => 'O', $c195 . chr(153) => 'U',\n\t$c195 . chr(154) => 'U', $c195 . chr(155) => 'U',\n\t$c195 . chr(156) => 'U', $c195 . chr(157) => 'Y',\n\t$c195 . chr(159) => 's', $c195 . chr(160) => 'a',\n\t$c195 . chr(161) => 'a', $c195 . chr(162) => 'a',\n\t$c195 . chr(163) => 'a', $c195 . chr(164) => 'a',\n\t$c195 . chr(165) => 'a', $c195 . chr(167) => 'c',\n\t$c195 . chr(168) => 'e', $c195 . chr(169) => 'e',\n\t$c195 . chr(170) => 'e', $c195 . chr(171) => 'e',\n\t$c195 . chr(172) => 'i', $c195 . chr(173) => 'i',\n\t$c195 . chr(174) => 'i', $c195 . chr(175) => 'i',\n\t$c195 . chr(177) => 'n', $c195 . chr(178) => 'o',\n\t$c195 . chr(179) => 'o', $c195 . chr(180) => 'o',\n\t$c195 . chr(181) => 'o',\n\t$c195 . chr(182) => 'o', $c195 . chr(185) => 'u',\n\t$c195 . chr(186) => 'u', $c195 . chr(187) => 'u',\n\t$c195 . chr(188) => 'u', $c195 . chr(189) => 'y',\n\t$c195 . chr(191) => 'y',\n\t// Decompositions for Latin Extended-A.\n\t$c196 . chr(128) => 'A', $c196 . chr(129) => 'a',\n\t$c196 . chr(130) => 'A', $c196 . chr(131) => 'a',\n\t$c196 . chr(132) => 'A', $c196 . chr(133) => 'a',\n\t$c196 . chr(134) => 'C', $c196 . chr(135) => 'c',\n\t$c196 . chr(136) => 'C', $c196 . chr(137) => 'c',\n\t$c196 . chr(138) => 'C', $c196 . chr(139) => 'c',\n\t$c196 . chr(140) => 'C', $c196 . chr(141) => 'c',\n\t$c196 . chr(142) => 'D', $c196 . chr(143) => 'd',\n\t$c196 . chr(144) => 'D', $c196 . chr(145) => 'd',\n\t$c196 . chr(146) => 'E', $c196 . chr(147) => 'e',\n\t$c196 . chr(148) => 'E', $c196 . chr(149) => 'e',\n\t$c196 . chr(150) => 'E', $c196 . chr(151) => 'e',\n\t$c196 . chr(152) => 'E', $c196 . chr(153) => 'e',\n\t$c196 . chr(154) => 'E', $c196 . chr(155) => 'e',\n\t$c196 . chr(156) => 'G', $c196 . chr(157) => 'g',\n\t$c196 . chr(158) => 'G', $c196 . chr(159) => 'g',\n\t$c196 . chr(160) => 'G', $c196 . chr(161) => 'g',\n\t$c196 . chr(162) => 'G', $c196 . chr(163) => 'g',\n\t$c196 . chr(164) => 'H', $c196 . chr(165) => 'h',\n\t$c196 . chr(166) => 'H', $c196 . chr(167) => 'h',\n\t$c196 . chr(168) => 'I', $c196 . chr(169) => 'i',\n\t$c196 . chr(170) => 'I', $c196 . chr(171) => 'i',\n\t$c196 . chr(172) => 'I', $c196 . chr(173) => 'i',\n\t$c196 . chr(174) => 'I', $c196 . chr(175) => 'i',\n\t$c196 . chr(176) => 'I', $c196 . chr(177) => 'i',\n\t$c196 . chr(178) => 'IJ',$c196 . chr(179) => 'ij',\n\t$c196 . chr(180) => 'J', $c196 . chr(181) => 'j',\n\t$c196 . chr(182) => 'K', $c196 . chr(183) => 'k',\n\t$c196 . chr(184) => 'k', $c196 . chr(185) => 'L',\n\t$c196 . chr(186) => 'l', $c196 . chr(187) => 'L',\n\t$c196 . chr(188) => 'l', $c196 . chr(189) => 'L',\n\t$c196 . chr(190) => 'l', $c196 . chr(191) => 'L',\n\t$c197 . chr(128) => 'l', $c197 . chr(129) => 'L',\n\t$c197 . chr(130) => 'l', $c197 . chr(131) => 'N',\n\t$c197 . chr(132) => 'n', $c197 . chr(133) => 'N',\n\t$c197 . chr(134) => 'n', $c197 . chr(135) => 'N',\n\t$c197 . chr(136) => 'n', $c197 . chr(137) => 'N',\n\t$c197 . chr(138) => 'n', $c197 . chr(139) => 'N',\n\t$c197 . chr(140) => 'O', $c197 . chr(141) => 'o',\n\t$c197 . chr(142) => 'O', $c197 . chr(143) => 'o',\n\t$c197 . chr(144) => 'O', $c197 . chr(145) => 'o',\n\t$c197 . chr(146) => 'OE',$c197 . chr(147) => 'oe',\n\t$c197 . chr(148) => 'R', $c197 . chr(149) => 'r',\n\t$c197 . chr(150) => 'R', $c197 . chr(151) => 'r',\n\t$c197 . chr(152) => 'R', $c197 . chr(153) => 'r',\n\t$c197 . chr(154) => 'S', $c197 . chr(155) => 's',\n\t$c197 . chr(156) => 'S', $c197 . chr(157) => 's',\n\t$c197 . chr(158) => 'S', $c197 . chr(159) => 's',\n\t$c197 . chr(160) => 'S', $c197 . chr(161) => 's',\n\t$c197 . chr(162) => 'T', $c197 . chr(163) => 't',\n\t$c197 . chr(164) => 'T', $c197 . chr(165) => 't',\n\t$c197 . chr(166) => 'T', $c197 . chr(167) => 't',\n\t$c197 . chr(168) => 'U', $c197 . chr(169) => 'u',\n\t$c197 . chr(170) => 'U', $c197 . chr(171) => 'u',\n\t$c197 . chr(172) => 'U', $c197 . chr(173) => 'u',\n\t$c197 . chr(174) => 'U', $c197 . chr(175) => 'u',\n\t$c197 . chr(176) => 'U', $c197 . chr(177) => 'u',\n\t$c197 . chr(178) => 'U', $c197 . chr(179) => 'u',\n\t$c197 . chr(180) => 'W', $c197 . chr(181) => 'w',\n\t$c197 . chr(182) => 'Y', $c197 . chr(183) => 'y',\n\t$c197 . chr(184) => 'Y', $c197 . chr(185) => 'Z',\n\t$c197 . chr(186) => 'z', $c197 . chr(187) => 'Z',\n\t$c197 . chr(188) => 'z', $c197 . chr(189) => 'Z',\n\t$c197 . chr(190) => 'z', $c197 . chr(191) => 's'\n\t];\n\n\t$string = strtr( $string, $chars );\n\n\t// Replace characters others than letters, space, numbers & points with underscores  \"_\".\n\t$string = preg_replace(\n\t\t'/([^ _\\-.a-z0-9]+)/i',\n\t\t'_',\n\t\t$string\n\t);\n\n\tif ( $string === '_' )\n\t{\n\t\t// String does not contain any latin ASCII char return microtime!\n\t\t$string = number_format( microtime( true ), 4, '', '' );\n\t}\n\n\treturn $string;\n}\n\n\n\n/**\n * Get server maximum file upload size (Mb)\n *\n * @see  php.ini directives (upload_max_filesize & post_max_size)\n *\n * @uses ReturnMegabytes() function\n *\n * @return float maximum file upload size in Mega Bytes (Mb)\n */\nfunction FileUploadMaxSize()\n{\n\t// Size is limited by server configuration (upload_max_filesize & post_max_size).\n\treturn (float) min(\n\t\tReturnMegabytes( ini_get( 'post_max_size' ) ),\n\t\tReturnMegabytes( ini_get( 'upload_max_filesize' ) )\n\t);\n}\n\n\n/**\n * Return value in Mega Bytes (MB)\n *\n * @example ReturnMegabytes( ini_get( 'upload_max_filesize' ) )\n *\n * @param  string $val php.ini value, shorthand notation.\n *\n * @return string      value in Mega Bytes (MB)\n */\nfunction ReturnMegabytes( $val ) {\n\n\t$val = trim( $val );\n\n\t$last = strtolower( $val[ strlen( $val ) - 1 ] );\n\n\t$val = (int) $val;\n\n\tswitch ( $last ) {\n\n\t\t// The 'G' modifier is available since PHP 5.1.0.\n\t\tcase 'g':\n\n\t\t\t$val *= 1024;\n\n\t\tcase 'm':\n\n\t\t\t$val *= 1;\n\n\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t$val /= 1024;\n\n\t\tcase 'k':\n\n\t\t\t$val /= 1024;\n\t}\n\n\treturn $val;\n}\n\n\n/**\n * Human filesize\n * Converts bytes into human readable file size.\n *\n * @example $file_size = HumanFilesize( filesize( $file_name ) );\n *\n * @link http://php.net/manual/en/function.filesize.php#106569\n *\n * @since  2.9\n *\n * @param  integer $bytes    File size in Bytes.\n * @param  integer $decimals Decimals (optional). Defaults to 1.\n *\n * @return string            Human readable file size.\n */\nfunction HumanFilesize( $bytes, $decimals = 1 )\n{\n\t$sz = 'BKMGTP';\n\n\t$factor = floor( ( strlen( $bytes ) - 1 ) / 3 );\n\n\treturn sprintf( \"%.{$decimals}f\", $bytes / pow( 1024, $factor ) ) . @$sz[ $factor ];\n}\n\n\n/**\n * Extensions white list.\n * Common file types.\n * Obviously, we won't include executable types\n * .php, .sql, .js, .exe...\n * If you file type is not white listed,\n * put it in a ZIP archive!\n *\n * @since 3.8.1\n *\n * @link http://fileinfo.com/filetypes/common\n */\nfunction FileExtensionWhiteList() {\n\treturn [\n\t\t// Micro$oft Office.\n\t\t'.doc',\n\t\t'.docx',\n\t\t'.xls',\n\t\t'.xlsm',\n\t\t'.xlsx',\n\t\t'.xlr',\n\t\t'.pps',\n\t\t'.ppt',\n\t\t'.pptx',\n\t\t'.wps',\n\t\t'.wpd',\n\t\t'.rtf',\n\t\t// Libre Office.\n\t\t'.odt',\n\t\t'.ods',\n\t\t'.odp',\n\t\t// Keynote presentation.\n\t\t'.key',\n\t\t// Images.\n\t\t'.jpg',\n\t\t'.jpeg',\n\t\t'.png',\n\t\t'.gif',\n\t\t'.bmp',\n\t\t'.svg',\n\t\t'.ico',\n\t\t'.psd',\n\t\t'.ai',\n\t\t'.eps',\n\t\t'.ps',\n\t\t'.webp',\n\t\t// Audio.\n\t\t'.mp3',\n\t\t'.ogg',\n\t\t'.wav',\n\t\t'.mid',\n\t\t'.midi',\n\t\t'.wma',\n\t\t'.aif',\n\t\t// Video.\n\t\t'.avi',\n\t\t'.mp4',\n\t\t'.mpg',\n\t\t'.mpeg',\n\t\t'.ogv',\n\t\t'.webm',\n\t\t'.wmv',\n\t\t'.h264',\n\t\t'.mkv',\n\t\t'.mov',\n\t\t'.m4v',\n\t\t'.flv', // @deprecated Adobe Flash.\n\t\t'.swf', // @deprecated Adobe Flash.\n\t\t// Text.\n\t\t'.txt',\n\t\t'.pdf',\n\t\t'.md',\n\t\t'.csv',\n\t\t'.tex',\n\t\t'.log',\n\t\t// Email.\n\t\t'.email',\n\t\t'.eml',\n\t\t'.emlx',\n\t\t'.msg',\n\t\t'.vcf',\n\t\t// Web.\n\t\t'.xml',\n\t\t'.xhtml',\n\t\t'.html',\n\t\t'.htm',\n\t\t'.css',\n\t\t'.rss',\n\t\t// Compressed.\n\t\t'.zip',\n\t\t'.rar',\n\t\t'.7z',\n\t\t'.tar',\n\t\t'.gz',\n\t];\n}\n"], "fixing_code": ["# CHANGES\n## RosarioSIS Student Information System\n\nChanges in 8.9.3\n----------------\n- Fix stored XSS security issue: do not allow unsanitized SVG in FileUpload.fnc.php, thanks to @scgajge12 & @crowdoverflow\n\nChanges in 8.9.2\n----------------\n- Fix invalidate User School in session on login in index.php\n\nChanges in 8.9.1\n----------------\n- Fix regression since 8.6 Mailing Labels widget HTML in Widgets.php\n\nChanges in 8.9\n--------------\n- Fix GetTeacher() when newly inserted teacher in GetTeacher.fnc.php\n- Remove Half Day option in AddAbsences.php, Administration.php, TakeAttendance.php, Courses.php, Courses.fnc.php & Rollover.php\n- JS Hide \"+ New Period\" link onclick in Courses.php\n- CSS FlatSIS fix bottom button line height in stylesheet.css\n- Add help texts & translations for the Scheduling > Courses program in Help_en.php & help.po\n- Correct typos in Spanish help texts in help.po\n- Fix Locked column value on list export in Schedule.php\n- Student / User Photo input: only accept .jpg,.jpeg,.png,.gif in General_Info.inc.php\n- Increase Food Service icon width to 48px in FS_Icons.inc.php & MenuItems.php\n- HTML add Add-on upload input title in Modules.inc.php & Plugins.inc.php\n- Fix do not resubmit form on List Export in Incomes.php & Expenses.php\n- Fix List Export columns: hide Delete & show File Attached in Expenses.php, Incomes.php, Salaries.php, StaffPayments.php, StudentFees.php & StudentPayments.php\n- Check AllowEdit() on Event deletion in Calendar.php\n- Food Service icon upload in MenuItems.php\n- Add French & Spanish translation for \"Icon successfully uploaded.\" in rosariosis.po\n\nChanges in 8.8\n--------------\n- Fix proc_open() PHP function not allowed in PDF.php\n- Fix PHP Warning A non-numeric value encountered in ReportCards.fnc.php\n- Fix PHP Fatal error Unsupported operand types in Teacher Programs: do not search Students List, unset in CustomFields.fnc.php\n- Add 'staff_' prefix to first & last inputs on Find a User form in GetStaffList.fnc.php & Search.fnc.php\n- Remove icons from Ungraded column, use only number in StudentGrades.php\n- Exclude 0 points assignments from Ungraded count in StudentGrades.php\n- Date select increase years options from +5 to +20 in Date.php\n- JS Raise height by 1 submenu item so we stay above browser URL in warehouse.js\n- Add Min. and Max. GPA to Last row in Grades.fnc.php & ReportCards.fnc.php\n- Add Class Rank to Last row in Grades.fnc.php & ReportCards.fnc.php\n\nChanges in 8.7\n--------------\n- Rector fix bad code in functions/, classes/core/, ProgramFunctions/\n- Update tested on: not compatible with Internet Explorer in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- Add ProgramFunctions/SendEmail.fnc.php|send_error action hook in SendEmail.fnc.php\n- EasyCodingStandard use short array notation in functions/, classes/core/, ProgramFunctions/, modules/ & plugins/\n- Fix month + year format, remove day (regression since 7.1) in Dashboard.inc.php\n- ProgramUserConfig() always return array, not null in Config.fnc.php & \\_makeLetterGrade.fnc.php\n- Allow redirect to Take Attendance, no fatal error if no current MP in Portal.php\n- CSS fix checkbox & radio input vertical align on Firefox in stylesheet.css\n- CSS fix menu hover right arrow position when module name on 2 lines in stylesheet.css\n- CSS fix font-size auto-adjust on iPhone in stylesheet.css\n- Fix typo in English string, update translations in Rollover.php & rosariosis.mo\n- JS fix menu & scroll issue on smartphone landscape > 735px in warehouse.js & jquery-fixed.menu.js\n- FlatSIS theme: use Grunt to minify in Gruntfile.js\n- FlatSIS theme: do not import WPadmin theme stylesheet anymore in stylesheet.css, stylesheet_wkhtmltopdf.css\n- Fix SQL TRANSCRIPT_GRADES view, grades were duplicated for each school year in rosariosis.sql & Update.fnc.php\n\nChanges in 8.6.1\n----------------\n- Add .webp image to FileExtensionWhiteList() in FileUpload.fnc.php\n- Fix SQL error table name \"sam\" specified more than once in Widget.php\n\nChanges in 8.6\n--------------\n- Add (Student) Widgets class in classes/core/Widgets.php\n- Add (Student) Widget interface and individual Widget classes in classes/core/Widget.php\n- Use RosarioSIS\\Widgets in Widgets.fnc.php\n- Add StaffWidgets class in classes/core/StaffWidgets.php\n- Add StaffWidget interface and individual StaffWidget classes in classes/core/StaffWidget.php\n- Use RosarioSIS\\StaffWidgets in StaffWidgets.fnc.php\n- Admin Student Payments Delete restriction: also exclude Refund in StudentPayments.php & Student_Billing/functions.inc.php\n- Fix PHP Fatal error unsupported operand types when (Staff)Widgets() & $extra used for Parent / Student in Widgets.fnc.php & StaffWidgets.fnc.php\n- Fix PHP Fatal error canBuild() must be compatible with Widget::canBuild(array $modules) in Widget.php & StaffWidget.php\n- Fix SQL error more than one row returned by a subquery in Search.fnc.php\n\nChanges in 8.5.2\n----------------\n- Fix PHP Fatal error cannot redeclare `_rosarioLoginURL()` (regression since 8.3) in MarkDownHTML.fnc.php\n\nChanges in 8.5.1\n----------------\n- Fix SQL syntax error in ORDER BY (regression since 8.3.1) in Substitutions.php\n\nChanges in 8.5\n--------------\n- Fix SQL error duplicate key value violates unique constraint \"food_service_menus_title\" in Menus.php\n- SQL add PRIMARY KEY to STAFF_EXCEPTIONS table in rosariosis.sql\n- SQL PROFILE_EXCEPTIONS & STAFF_EXCEPTIONS tables: Add Admin Student Payments Delete restriction in Update.fnc.php & rosariosis.sql\n- Add Admin Student Payments Delete restriction in Profiles.php & Exceptions.php\n- Add Admin Student Payments Delete restriction in StudentPayments.php & Student_Billing/functions.inc.php\n- Fix SQL error numeric field overflow when entering percent > 100 in MassCreateAssignments.php\n- HTML Sort Order input type number in MarkingPeriods.php\n\nChanges in 8.4\n--------------\n- SQL GRADEBOOK_GRADES table: Change comment column type to text in Update.fnc.php & rosariosis.sql\n- Increase Grades Comment input maxlength to 500 chars in Grades.php\n- Fix use more coherent number_format() precision & no thousand separator in Percent.php, Assignments.php, StudentGrades.php, Grades.fnc.php & EditReportCardGrades.php\n- SQL order fields list by Category & SORT_ORDER in AssignOtherInfo.php\n- Fix SQL error numeric field overflow when entering percent > 100 in Assignments.php\n- Comments length > 60 chars, responsive table ColorBox in EditReportCardGrades.php, FinalGrades.php, Grades.php, InputFinalGrades.php & StudentGrades.php\n- Add File Attached to Incomes in Incomes.php & Accounting/functions.inc.php\n- Add File Attached to Expenses in Expenses.php\n- SQL ACCOUNTING_INCOMES table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Fix SQL error when no user in session in Template.fnc.php\n- Correct help text note for User deletion in Help_en.php & help.po\n\nChanges in 8.3.1\n----------------\n- Fix SQL exclude fields of 'files' type in Substitutions.php\n- SQL order fields list by Category & SORT_ORDER in Substitutions.php\n- Fix force numeric separator \".\" when no en_US locale, use C locale in Warehouse.php\n- Fix Advanced Search > General Info text fields when adding Username in Search.fnc.php\n\nChanges in 8.3\n--------------\n- Fix PHP Warning non-numeric value encountered, use rounded percent grade in StudentGrades.php\n- Security Fix reflected XSS: encode HTML special chars for search_term in Courses.php\n- Add File Attached to Staff Payments in StaffPayments.php & Accounting/functions.inc.php\n- Add File Attached to Payments in StudentPayments.php & Student_Billing/functions.inc.php\n- SQL ACCOUNTING_PAYMENTS table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- SQL BILLING_PAYMENTS table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add help note for student deletion & translate in Help_en.php & help.po\n- Add RosarioSIS URL to image path in MarkDownHTML.fnc.php\n- Fix SQL error invalid byte sequence for encoding \"UTF8\": 0xde 0x20 in Security.php\n\nChanges in 8.2.1\n----------------\n- Fix SQL for Warning when only 0 points assignments in Assigments.php\n\nChanges in 8.2\n--------------\n- Fix replace regex: remove slash & allow space in FileUpload.fnc.php\n- Always Use Last Year's Picture if Missing in PrintClassLists.php\n- Fix #329 SQL error division by zero in t_update_mp_stats(): set min Credits to 1 in Courses.fnc.php\n- Fix SQL error when Teacher name has single quote in Courses.php\n- CSS FlatSIS remove useless line-height for tabs in stylesheet.css\n\nChanges in 8.1.1\n----------------\n- Fix security issue #328 unauthenticated access to Side.php in Warehouse.php, thanks to @ijdpuzon\n- Fix security issue #328 sanitize `$_POST` school, syear, mp & period parameters in Side.php\n\nChanges in 8.1\n--------------\n- Remove @ error control operator on pg_exec: allow PHP Warning in database.inc.php\n- Fix Address Field sequence name in AddressFields.php\n- Remove deprecated DBSeqConvertSerialName() function in database.inc.php\n- Fix Conflict Warning displayed twice in Courses.php\n- Fix PHP Notice Undefined index in miscExport.fnc.php\n- Fix SQL error when Student / Staff ID is hacked / not an integer in URL in Current.php\n- SQL ACCOUNTING_SALARIES table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add File Attached to Salaries in Salaries.php & Accounting/functions.inc.php\n- SQL BILLING_FEES table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add File Attached to Fees in StudentFees.php & Student_Billing/functions.inc.php\n- Fix Student Widgets for Advanced Search exports in GetStaffList.fnc.php, GetStuList.fnc.php & Search.inc.php\n- Add Export fields list (form) & Export fields list + extra SQL (student list) action hooks in Export.php & Actions.php\n- Do not remove Full Day and Half Day school periods from the Schedule table in PrintSchedules.php\n- Fix 403 Forbidden error due to pipe \"|\" in URL when using Apache 5G rules in Widgets.fnc.php\n\nChanges in 8.0.4\n----------------\n- Fix default Student/Parent program in Attendance/Menu.php\n\nChanges in 8.0.3\n----------------\n- Fix #324 Show Student Photo in Transcripts.fnc.php\n\nChanges in 8.0.2\n----------------\n- Fix User Widgets Search Terms in Users/Search.inc.php\n\nChanges in 8.0.1\n----------------\n- Fix #322 PHP syntax error, unexpected ')' in DailySummary.php\n\nChanges in 8.0\n--------------\n- Add Total from Payments & Total from Fees fields to Advanced Report in Export.php\n- Upgrade grunt, grunt-contrib-cssmin, grunt-contrib-uglify & grunt-contrib-watch & remove grunt-phpdoc in package.json & Gruntfile.js\n- CSS minification optimizations in stylesheet.css & stylesheet_wkhtmltopdf.css\n- JS uglify optimizations in plugins.min.js & plugins.min.js.map\n- Upgrade Chart.js from 2.9.3 to 3.4.1 & save 40KB in chart.min.js & Charts.fnc.php\n- Fix \"The gradebook configuration has been modified.\" note appearing twice in Grades/Configuration.php\n- Add warning in case all Assignments in Type have 0 Points (Extra Credit) in Assignments.php\n- Update French & Spanish translations in rosariosis.po\n- CSS FlatSIS shorten menu width & submenu links height + better contrast in stylesheet.css\n- CSS FlatSIS list square bullets in stylesheet.css\n- Default theme is now FlatSIS in rosariosis.sql\n- CSS remove .radio-attendance-code class in stylesheet.css, rtl.css & TakeAttendance.php\n- CSS remove Open Sans SVG fonts, format is deprecated in font.css & WPadmin/fonts/open\n- Upgrade marked.js 0.8.2 to version 1.2.9 in assets/js/marked/\n- Fix SQL error when $staff_id is 0 (no user in session) in Config.fnc.php\n- Remove Waived Fees from list in Student_Billing/functions.inc.php\n- New ROSARIO_DISABLE_ADDON_DELETE optional config constant in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- Add-on disable delete in Modules.inc.php & Plugins.inc.php\n- Merge Daily Transactions & Daily Totals programs in DailyTransactions.php & DailyTotals.php\n- Remove Daily Totals program from Student Billing & Accounting menus in Menu.php & rosariosis.sql\n- Fix Totals calculus in Accounting/includes/DailyTotals.php\n- Multibyte strings: check if not UTF-8 first to avoid cost of setting in Warehouse.php\n- Fix false positive Hacking Attempt on Print button click when no user in session in Warehouse.php\n- Merge Attendance Chart & Absence Summary programs in DailySummary.php & StudentSummary.php & Help_en.php\n- Remove Absence Summary program from Attendance menu in Menu.php, Help_en.php & rosariosis.sql\n\nChanges in 7.9.3\n----------------\n- Fix #318 PHP warning non-numeric value encountered for $LO_dir in ListOutput.fnc.php, thanks to @AhmadKakarr\n\nChanges in 7.9.2\n----------------\n- Fix SQL error when single quote in Course Title in InputFinalGrades.php\n- Fix include Semester course periods in the Schedule table in Schedule.inc.php\n- Fix #316 CSRF security issue set cookie samesite to strict, thanks to @huntrdev\n\nChanges in 7.9.1\n----------------\n- Fix remove file when has single quote in its name and actually delete file in Student.php, User.php & Schools.php\n- Fix download backup filename when contains spaces: use double quotes in DatabaseBackup.php\n\nChanges in 7.9\n--------------\n- Update default School Year to 2021 in rosariosis.sql & config.inc.sample.php\n\nChanges in 7.8.4\n----------------\n- Fix User Marking Period title in GradeBreakdown.php\n- SQL ORDER BY Teacher name in GradeBreakdown.php\n\nChanges in 7.8.3\n----------------\n- Fix trim 0 (float) when percent > 1,000: do not use comma for thousand separator in Grades.php & ProgressReports.php\n\nChanges in 7.8.2\n----------------\n- Fix try searching plural forms adding an 's' to singular form and with number set to 1 in Translator.php\n\nChanges in 7.8.1\n----------------\n- CSS Edge browser fix: Do not merge focus-within styles with hover styles in stylesheet.css, stylesheet_wkhtmltopdf.css & rtl.css\n\nChanges in 7.8\n--------------\n- Handle `multiple` files attribute in warehouse.js & Inputs.php\n- Add FileUploadMultiple(). Handle `multiple` files attribute for FileUpload() in FileUpload.fnc.php\n- Remove Reset button from Find a Student / User forms in Students/Search.inc.php & Users/Search.inc.php\n- CSS & JS open submenu on focus & focus-within in warehouse.js, stylesheet.css & rtl.css\n- CSS menu link & button color on focus in stylesheet.css & colors.css\n- Fix check students Course Status in PrintClassLists.php, PrintClassPictures.php, ClassSearchWidget.fnc.php, Referrals.php, EmailReferral.fnc.php & Widgets.fnc.php\n- Add Include Inactive Students checkbox in MasterScheduleReport.php & RequestsReport.php\n- Fix unset current student (check Course Status) when MP updated in Side.php\n- SQL fix Discipline Referrals using WHERE EXISTS in Widgets.fnc.php\n- Numeric Discipline field: invert values so BETWEEN works in Widgets.fnc.php\n- Numeric Discipline field: input type number in Widgets.fnc.php\n- Fix SQL error missing FROM ADDRESS table in GetStuList.fnc.php\n\nChanges in 7.7\n--------------\n- Move Dashboard() call outside in Dashboard.fnc.php & Portal.php\n- Add .xlsm,.key,.midi,.aif,.mpeg,.h264,.mkv,.log,.email,.eml,.emlx,.msg,.vcf extensions to white list in FileUpload.fnc.php\n- Add \"Last Name Middle Name First Name\" option to Display Name in GetStuList.fnc.php & Configuration.php\n- Fix SQL error escape course title in StudentGrades.php\n- SQL Remove Salaries having a Payment (same Amount & Comments (Title), after or on Assigned Date) in Accounting/functions.inc.php\n- SQL match Payment Comments LIKE Fee Title in Student_Billing/functions.inc.php\n- CSS fix list line-height in FlatSIS/stylesheet_wkhtmltopdf.css\n\nChanges in 7.6.1\n----------------\n- Fix #307 XSS update CodeIgniter Security class in classes/Security.php, thanks to @DustinBorn\n- Move Portal Poll vote code to modfunc in PortalPollNotes.php & Portal.php\n- Fix #308 Unauthenticated SQL injection. Use sanitized `$_REQUEST` in Portal.php, thanks to @DustinBorn\n- Fix #308 sanitize key. Pass array keys through function in Warehouse.php, thanks to @DustinBorn\n- Fix #309 unset `$_SESSION` so user cannot maintain dummy session in PasswordReset.php, thanks to @DustinBorn\n- Remove use of `$_SESSION['STAFF_ID'] === '-1'` in User.fnc.php & PasswordReset.php\n\nChanges in 7.6\n--------------\n- Fix login password with single quote, use POST in index.php & Preferences.php\n- HTML Use #! instead of JS return false to not go back to top in Buttons.php & Profiles.php\n- JS remove warehouse.min.js & include warehouse.js inside plugins.min.js in Gruntfile.js, assets/js/ & Warehouse.php\n- Fix PHP8 compatibility issues (warnings & fatal errors), system wide\n- Fix save new Grade with \"0\" as Title in ReportCardGrades.php\n- PHP8 no xmlrpc ext: load xmlrpc compat functions in plugins/Moodle/client.php, xmlrpc.php, XML_RPC.php, XmlrpcDecoder.php & XmlrpcEncoder.php\n- Fix xmlrpc nested arrays, use param & value elements instead in XmlrpcEncoder.php\n- Fix SQL Total points only select assignments for CP teacher (teacher may have changed) in Grades.php, InputFinalGrades.php, StudentGrades.php & GradebookBreakdown.php\n- Fix SQL Grades sort order in GradebookBreakdown.php\n- Add Login form link action hook in index.php & Actions.php\n- SQL fix Report Card Grades insert in rosariosis_fr.sql\n- SQL fix ORDER Report Cards by Student name & Course list by Title in ReportCards.fnc.php\n- SQL fix error invalid input syntax for integer in DailySummary.php\n- Replace tested on Ubuntu 16.04 with 18.04 (Buster) in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n\nChanges in 7.5\n--------------\n- HTML fix Student Assignment Submission display in StudentAssignments.fnc.php\n- Percent rounding to 2 decimal places is new School default in \\_makeLetterGrade.fnc.php\n- CSS Fix widefat table border color when rendered in PDF inside Chrome in colors.css\n- Add phpwkhtmltopdf class & remove Wkhtmltopdf class in classes/\n- Use phpwkhtmltopdf class instead of Wkhtmltopdf (more reliable & faster) in PDF.php\n- Add Report Cards PDF footer action hook in ReportCards.fnc.php & Actions.php\n- Transcripts PDF header action hook: echo your custom text before or append it to $header_html to display it after in Transcripts.fnc.php\n- Transcripts PDF footer action hook: echo your custom text before or append it to $footer_html to display it after in Transcripts.fnc.php\n- Add .transcript-certificate-block1 & .transcript-certificate-block2 CSS classes in Transcripts.fnc.php\n- Add .report-card-free-text CSS class in ReportCards.fnc.php\n- Delete any attendance for this day & student prior to update in FixDailyAttendance.php\n- Use \\_makeLetterGrade() for Percent grade so it reflects Teacher's Score rounding configuration in Grades.php & ProgressReports.php\n- Fix Add Credits only for Report Cards in ReportCards.fnc.php\n- Fix SQL error invalid input syntax for integer (Class Rank input) in Widgets.fnc.php\n- HTML Grades GPA Widget: use number input & check Weighted by default in Widgets.fnc.php\n\nChanges in 7.4\n--------------\n- List sort comment: trim & fix position in ListOutput.fnc.php\n- Fix #303 Raw value in comment so we can sort Percent column the right way in Grades.php, thanks to @dd02\n- Add Database Backup link to header in Rollover.php\n- Add Course Widget configuration option: Popup window or Pull-Down in Configuration.php & Help_en.php\n- Add Course Widget: select / Pull-Down in Widgets.fnc.php\n- Update French & Spanish translations in rosariosis.po, help.po\n- Add Total Credits in ReportCards.fnc.php\n- Do not display \"General Comments\" title if no comments in ReportCards.fnc.php\n- HTML display rows of 3 School Period checkboxes in AddAbsences.php\n- Comment input maxlength increased to 500 in InputFinalGrades.php\n- Comment Code input field is required in ReportCardCommentCodes.php\n- Add php-zip extension to list in INSTALL.md\n- Check for zip extension in diagnostic.php\n- Fix SQL error integer out of range in Food_Service/Students/Accounts.php\n- French translation: replace \"Effacer\" with \"Supprimer\" in rosariosis.po & help.po\n- Fix Teacher Programs Progress Report PDF, do not echo form in TeacherPrograms.php\n\nChanges in 7.3.1\n----------------\n- Fix admin override: no input div when values are not saved yet in Grades/Configuration.php\n- Fix #304 Do not include Excused (`*` or -1) grades in GradebookBreakdown.php, thanks to @dd02\n- Fix #304 regression since 5.0 Count students in GradebookBreakdown.php, thanks to @dd02\n- Fix #304 Totals count exclude Extra Credit assignments when Total Points is 0 for the Type, thanks to @dd02\n\nChanges in 7.3\n--------------\n- SQL Replace AND p.ATTENDANCE='Y' with AND cp.DOES_ATTENDANCE IS NOT NULL in Letters.php, StudentLabels.fnc.php, HonorRoll.fnc.php & Reminders.php\n- SQL remove unused SELECT ROOM in HonorRoll.fnc.php\n- Translate database on add-on install: run 'install_fr.sql' file in Modules.inc.php, Plugins.inc.php, modules/README.md & plugins/README.md\n- CSS remove wildcard rules in stylesheet.css & wkhtmltopdf.css\n- CSS remove browser input outline on focus in colors.css\n- Fix Format Phone Number for US in GetStuList.fnc.php, thanks to @dzungdo\n- Attendance dashboard limit Absences to past days in Dashboard.inc.php\n- Fix #299 Remove trailing slash \"/\" or dash \"-\" or dot \".\" from date in DailySummary.php\n- Fix #300 Include Full Day and Half Day school periods in the schedule table in PrintSchedules.php, thanks to @dzungdo\n- Update translations complete % in locale/REFERENCE.md\n- Add tested on CentOS & Google Chrome in INSTALL.md & INSTALL.pdf, thanks to @dd02\n- Add Before First Login form action hook in index.php & Actions.php\n- Fix regression since 7.0 not rolled items are checked in Rollover.php\n\nChanges in 7.2.4\n----------------\n- Take in Account Calendar Day Minutes in UpdateAttendanceDaily.fnc.php\n- Fix regression since 5.3 Return false if School Periods Length sum is 0 in UpdateAttendanceDaily.fnc.php, thanks to @dzungdo\n\nChanges in 7.2.3\n----------------\n- Fix regression since 5.9 search text User Field in Search.fnc.php, thanks to @dzungdo\n\nChanges in 7.2.2\n----------------\n- Fix SQL error foreign keys: Roll Schools before rolling Student Enrollment in Rollover.php\n- Fix SQL error table ADDRESS specified more than once in GetStuList.fnc.php\n\nChanges in 7.2.1\n----------------\n- Fix ParseMLField for Username field category in Preferences.php\n- Fix PHP Warning check requested locale exists in Warehouse.php\n- Add Attendance Codes help for (Lunch) Categories in Help_en.php & help.po\n- Fix SQL error multiple rows returned by a subquery in CreateParents.php\n\nChanges in 7.2\n--------------\n- Add Grade Level breakdown in StudentFieldBreakdown.php\n- Add link to Student Info in AddDrop.php\n- Limit students to User schools in AddDrop.php\n- Order Day, Month & Year inputs depending on User date preference in Date.php\n- SQL fix only display enrolled students in AddStudents.php\n- Link to Student Info redirects to right school in AddStudents.php\n- Reset password variable for each Contact in CreateParents.php\n\nChanges in 7.1.4\n----------------\n- Fix infinite loop when username already exists in CreateParents.php\n\nChanges in 7.1.3\n----------------\n- Fix #297 regression since 6.9 & SQL error in StudentSummary.php\n\nChanges in 7.1.2\n----------------\n- Fix SQL error Include Inactive Students for admin in PrintClassLists.php\n\nChanges in 7.1.1\n----------------\n- Fix #296 Include Inactive Students for admin in PrintClassLists.php\n\nChanges in 7.1\n--------------\n- Final Grading Percentages: add \"No quarters found\" error in Configuration.php\n- Add Start Date input in Scheduler.php\n- Export (Excel) date to YYYY-MM-DD format (ISO) in Date.php & Preferences.php\n- Select Date Format: Add Preferences( 'DATE' ) in User.fnc.php, Preferences.php, Date.php & Side.php\n- Fix SQL error TITLE column limit to 50 characters in GradeLevels.php\n- HTML remove radio buttons (File Attached or Embed Link) in PortalNotes.php & PortalPollsNotes.fnc.php\n- Add Grade Level breakdown in StudentBreakdown.php\n- Include Credits in ReportCards.fnc.php\n\nChanges in 7.0.4\n----------------\n- Fix #295 regression since 7.0 cannot save N/A date in Date.php\n\nChanges in 7.0.3\n----------------\n- Fix Multiple School Periods: Course Period School Period does not match, skip in Scheduler.php\n\nChanges in 7.0.2\n----------------\n- JS Fix search form onsubmit in Export.php\n\nChanges in 7.0.1\n----------------\n- Fix #292 System error \"blocked access to local file\" with wkhtmltopdf 0.12.6 in Wkhtmltopdf.php\n\nChanges in 7.0\n--------------\n- Update Markdownify from v2.1.11 to v2.3.1 in classes/Markdownify/*\n- Update Parsedown from v1.6.0 to v1.7.4 in classes/Parsedown.php\n- Update MoTranslator from v3.4 to v4.0 in Warehouse.php, Help.fnc.php & classes/MoTranslator/*\n- Fix 'School' translation when using MoTranslator in Schedule.inc.php & rosariosis.po\n- Fix '%s Handbook' translation when using MoTranslator in Help.php\n- CSS fix align \"+\" New Event icon to bottom in Calendar.php, CalendarDay.inc.php, stylesheet.css & zreponsive.css\n- Fix Day Number when multiple calendars and school years in CalendarDay.inc.php, DayToNumber.inc.php\n- Fix Numbered days display in SchoolPeriodsSelectInput.fnc.php & Courses.fnc.php\n- SQL improve Numbered days in AddAbsences.php, Administration.php, DailySummary.php, TakeAttendance.php, TeacherCompletion.php, UpdateAttendanceDaily.fnc.php & Portal.php\n- Place Rollover under Utilities separator in Menu.php\n- Merge Schedule Report & Master Schedule Report in Menu.php, MasterScheduleReport.php, ScheduleReport.php & rosariosis.sql\n- Add Students column to report in RequestsReport.php\n- Merge Requests Report & Unfilled Requests in Menu.php, RequestsReport.php, UnfilledRequests.php, Scheduler.php, Help_en.php & rosariosis.sql\n- Merge Average Daily Attendance & Average Attendance by Day in Menu.php, Percent.php, Help_en.php, help.po & rosariosis.sql\n- Remove \"Happy []...\" text in Portal.php\n- HTML remove \"Demographics\" header to gain space on PDF in AttendanceSummary.php\n- SQL Update ATTENDANCE_CODE (admin) when is NULL in TakeAttendance.php\n- CSS Add .widefat.files class in StudentsUsersInfo.fnc.php & stylesheet.css\n- CSS WPadmin more padding for list rows, menu links & footer help in stylesheet.css\n- CSS FlatSIS less padding for list row, header & popTable in stylesheet.css\n- CSS FlatSIS reduce body line-height & fix Dashboard tipmsg border in stylesheet.css\n- Format \"Show Available Seats\" & \"Print Schedule\" headers in Schedule.php\n- Remove $fy_id global variable in Schedule.php\n- HTML Add tooltips & notes in Rollover.php\n- Fix current CP Marking Period check on update in Courses.php\n- Fix limit list results to 1000, do not remove 1st result in ListOutput.fnc.php\n- Add $RosarioErrorsAddress config variable in config.inc.sample.php\n- Fix $RosarioNotifyAddress config variable description in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- SQL no access to Custom \"My Report\" program for admin by default in rosariosis.sql\n- JS MarkdownToHTML No MarkDown in text, return raw text in warehouse.js\n- Fix Delete from other Student/User Info tabs in Student.php & User.php\n- Remove deprecated since 4.5 rollover_* action hooks in Rollover.php & Actions.php\n- Fix Error: There is no column for The value for 0. This value was not saved in SaveData.fnc.php\n- Fix Do not Save / Export Medical tab lists in Medical.inc.php\n\n\n### Old versions CHANGES\n- [CHANGES for versions 5 and 6](CHANGES_V5_6.md).\n- [CHANGES for versions 3 and 4](CHANGES_V3_4.md).\n- [CHANGES for versions 1 and 2](CHANGES_V1_2.md).\n", "<?php\n/**\n * File Upload functions\n *\n * @package RosarioSIS\n * @subpackage ProgramFunctions\n */\n\n/**\n * File Upload\n *\n * @example FileUpload( 'photo', $StudentPicturesPath . UserSyear() . '/', array( '.jpg', '.jpeg' ), 2, $error, '.jpg', UserStudentID() );\n *\n * @global $_FILES\n *\n * @param string $input            Name of the input file field, for example 'photo'.\n * @param string $path             Final path with trailing slash, for example $StudentPicturesPath . UserSyear() . '/'.\n * @param array  $ext_white_list   Extensions white list, for example array('.jpg', '.jpeg').\n * @param float  $size_limit       Size Limit in Mb, set it to 0 to use server limit (upload_max_filesize).\n * @param array  $error            The global errors array.\n * @param string $final_ext        Final file extension (useful for .jpg, if .jpeg submitted) (optional).\n * @param string $file_name_no_ext Final file name without extension, for example UserStudentID() (optional).\n *\n * @return string|boolean Full path to file, or false if error\n */\nfunction FileUpload( $input, $path, $ext_white_list, $size_limit, &$error, $final_ext = '', $file_name_no_ext = '' )\n{\n\t$file_name = $full_path = false;\n\n\tif ( ! $final_ext )\n\t{\n\t\t$final_ext = empty( $_FILES[ $input ]['tmp_name'] ) ? '' :\n\t\t\tmb_strtolower( mb_strrchr( $_FILES[ $input ]['name'], '.' ) );\n\t}\n\n\tif ( $file_name_no_ext )\n\t{\n\t\t$file_name = $file_name_no_ext . $final_ext;\n\t}\n\n\tif ( empty( $_FILES[ $input ]['tmp_name'] )\n\t\t|| ! is_uploaded_file( $_FILES[ $input ]['tmp_name'] ) )\n\t{\n\t\t// Check the post_max_size & php_value upload_max_filesize values in the php.ini file.\n\t\t$error[] = _( 'File not uploaded' );\n\t}\n\n\telseif ( ! in_array( mb_strtolower( mb_strrchr( $_FILES[ $input ]['name'], '.' ) ), $ext_white_list ) )\n\t{\n\t\t$error[] = sprintf(\n\t\t\t_( 'Wrong file type: %s (%s required)' ),\n\t\t\t$_FILES[ $input ]['type'],\n\t\t\timplode( ', ', $ext_white_list )\n\t\t);\n\t}\n\n\telseif ( $size_limit\n\t\t&& $_FILES[ $input ]['size'] > $size_limit * 1024 * 1024 )\n\t{\n\t\t$error[] = sprintf(\n\t\t\t_( 'File size > %01.2fMb: %01.2fMb' ),\n\t\t\t$size_limit,\n\t\t\t( $_FILES[ $input ]['size'] / 1024 ) / 1024\n\t\t);\n\t}\n\n\t// If folder doesnt exist, create it!\n\telseif ( ! is_dir( $path )\n\t\t&& ! @mkdir( $path, 0755, true ) ) // Fix shared hosting: permission 755 for directories.\n\t{\n\t\t$error[] = sprintf( _( 'Folder not created' ) . ': %s', $path );\n\t}\n\n\telseif ( ! is_writable( $path ) )\n\t{\n\t\t// See PHP / Apache user rights for folder.\n\t\t$error[] = sprintf( _( 'Folder not writable' ) . ': %s', $path );\n\t}\n\n\t// Store file.\n\telseif ( ! move_uploaded_file(\n\t\t$_FILES[ $input ]['tmp_name'],\n\t\t$full_path = ( $path . ( $file_name ?\n\t\t\t$file_name :\n\t\t\tno_accents( mb_substr(\n\t\t\t\t$_FILES[ $input ]['name'],\n\t\t\t\t0,\n\t\t\t\tmb_strrpos( $_FILES[ $input ]['name'], '.' )\n\t\t\t) ) . $final_ext\n\t\t) )\n\t) )\n\t{\n\t\t$error[] = sprintf( _( 'File invalid or not moveable' ) . ': %s', $_FILES[ $input ]['tmp_name'] );\n\t}\n\n\treturn $full_path;\n}\n\n\n/**\n * Image File Upload\n *\n * @example ImageUpload( 'photo', array( 'width' => 150, 'height' => '150' ), $StudentPicturesPath . UserSyear() . '/', array(), '.jpg', UserStudentID() );\n * @example ImageUpload( $base64_img, array( 'width' => 640, 'height' => '320' ) );\n *\n * @since 3.3\n *\n * @uses FileUpload()\n * @uses ImageResizeGD class.\n *\n * @param string $input            Name of the input file field, for example 'photo', or base64 encoded data, src attribute value.\n * @param array  $target_dim       Target dimensions to determine if can be resized. Defaults to array( 'width' => 994, 'height' => 1405 ) (optional).\n * @param string $path             Final path with trailing slash, for example $StudentPicturesPath . UserSyear() . '/'. Defaults to \"assets/FileUploads/[Syear]/[staff_or_student_ID]/\" (optional).\n * @param array  $ext_white_list   Extensions white list, for example array('.jpg', '.jpeg').\n * @param string $final_ext        Final file extension (useful for .jpg, if .jpeg submitted) (optional).\n * @param string $file_name_no_ext Final file name without extension, for example UserStudentID() (optional).\n *\n * @return string|boolean Full path to file, or false if error\n */\nfunction ImageUpload( $input, $target_dim = [], $path = '', $ext_white_list = [], $final_ext = null, $file_name_no_ext = '' )\n{\n\tglobal $FileUploadsPath,\n\t\t$PNGQuantPath,\n\t\t$error;\n\n\trequire_once 'classes/ImageResizeGD.php';\n\n\t$is_base64 = ( strpos( $input, 'data:image' ) === 0 );\n\n\tif ( ! $path )\n\t{\n\t\t// Path defaults to \"assets/FileUploads/[Syear]/[staff_or_student_ID]/\".\n\t\t$user_folder = User( 'STAFF_ID' ) ? 'staff_' . User( 'STAFF_ID' ) : 'student_' . UserStudentID();\n\n\t\t$path = $FileUploadsPath . UserSyear() . '/' . $user_folder . '/';\n\t}\n\n\tif ( ! $ext_white_list )\n\t{\n\t\t// Defaults to JPG, PNG & GIF.\n\t\t$ext_white_list = [ '.jpg', '.jpeg', '.png', '.gif' ];\n\t}\n\n\t// Defaults to horizontal PDF target dimensions.\n\t$target_dim_default = [ 'width' => 994, 'height' => 1405 ];\n\n\t$target_dim = array_replace_recursive( $target_dim_default, (array) $target_dim );\n\n\tif ( ImageResizeGD::test() )\n\t{\n\t\t// If folder doesnt exist, create it!\n\t\tif ( ! is_dir( $path )\n\t\t\t&& ! @mkdir( $path, 0755, true ) ) // Fix shared hosting: permission 755 for directories.\n\t\t{\n\t\t\t$error[] = sprintf( _( 'Folder not created' ) . ': %s', $path );\n\n\t\t\treturn ( $is_base64 ? $input : false );\n\t\t}\n\t\telseif ( ! is_writable( $path ) )\n\t\t{\n\t\t\t// See PHP / Apache user rights for folder.\n\t\t\t$error[] = sprintf( _( 'Folder not writable' ) . ': %s', $path );\n\n\t\t\treturn ( $is_base64 ? $input : false );\n\t\t}\n\n\t\tif ( ! $is_base64 )\n\t\t{\n\t\t\tif ( ! is_uploaded_file( $_FILES[ $input ]['tmp_name'] ) )\n\t\t\t{\n\t\t\t\t// Check the post_max_size & php_value upload_max_filesize values in the php.ini file.\n\t\t\t\t$error[] = _( 'File not uploaded' );\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t$image_path_or_string = $_FILES[ $input ]['tmp_name'];\n\n\t\t\t$original_image_size = filesize( $image_path_or_string );\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$image_path_or_string = $input;\n\n\t\t\t// http://stackoverflow.com/questions/5373544/php-size-of-base64-encode-string-file\n\t\t\t$original_image_size = (int) ( strlen( rtrim( $image_path_or_string, '=' ) ) * 3 / 4 );\n\t\t}\n\n\t\t// Build file name.\n\t\tif ( $file_name_no_ext )\n\t\t{\n\t\t\t$file_name = $file_name_no_ext . $final_ext;\n\t\t}\n\t\telseif ( $is_base64 )\n\t\t{\n\t\t\t// Use MD5 sum for base64 images.\n\t\t\t$file_name = md5( $image_path_or_string ) . $final_ext;\n\n\t\t\t$full_path = $path . $file_name;\n\n\t\t\t// Check if file already exists?\n\t\t\tif ( $final_ext\n\t\t\t\t&& file_exists( $full_path ) )\n\t\t\t{\n\t\t\t\treturn $full_path;\n\t\t\t}\n\t\t\telseif ( file_exists( $full_path . '.jpg' ) )\n\t\t\t{\n\t\t\t\treturn $full_path . '.jpg';\n\t\t\t}\n\t\t\telseif ( file_exists( $full_path . '.png' ) )\n\t\t\t{\n\t\t\t\treturn $full_path . '.png';\n\t\t\t}\n\t\t\telseif ( file_exists( $full_path . '.gif' ) )\n\t\t\t{\n\t\t\t\treturn $full_path . '.gif';\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Use original file name.\n\t\t\t$file_name = no_accents( mb_substr(\n\t\t\t\t$_FILES[ $input ]['name'],\n\t\t\t\t0,\n\t\t\t\tmb_strrpos( $_FILES[ $input ]['name'], '.' )\n\t\t\t) ) . $final_ext;\n\t\t}\n\n\t\t$extension = null;\n\n\t\tif ( mb_strtolower( $final_ext ) === '.jpg'\n\t\t\t|| mb_strtolower( $final_ext ) === '.jpeg' )\n\t\t{\n\t\t\t$extension = IMAGETYPE_JPEG;\n\t\t}\n\t\telseif ( mb_strtolower( $final_ext ) === '.png' )\n\t\t{\n\t\t\t$extension = IMAGETYPE_PNG;\n\t\t}\n\t\telseif ( mb_strtolower( $final_ext ) === '.gif' )\n\t\t{\n\t\t\t$extension = IMAGETYPE_GIF;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\t$target_jpg_compression = 85;\n\n\t\t\t$image_resize_gd = new ImageResizeGD(\n\t\t\t\t$image_path_or_string,\n\t\t\t\t$target_jpg_compression,\n\t\t\t\t9,\n\t\t\t\t$PNGQuantPath\n\t\t\t);\n\n\t\t\t// 3x or 2x Retina factor depending if small target image.\n\t\t\t$factor = $target_dim['width'] < 994 ? 3 : 2;\n\n\t\t\tif ( $image_resize_gd->getSourceWidth() > $target_dim['width'] * $factor\n\t\t\t\t|| $image_resize_gd->getSourceHeight() > $target_dim['height'] * $factor )\n\t\t\t{\n\t\t\t\t// Image dimensions > target dimensions *2 or 3 (enough for Retina), resize & compress more.\n\t\t\t\t$image_resize_gd->resizeWithinDimensions(\n\t\t\t\t\t$target_dim['width'] * $factor,\n\t\t\t\t\t$target_dim['height'] * $factor\n\t\t\t\t);\n\n\t\t\t\t$target_jpg_compression = 65;\n\t\t\t}\n\t\t\telseif ( $image_resize_gd->getSourceWidth() > $target_dim['width']\n\t\t\t\t|| $image_resize_gd->getSourceHeight() > $target_dim['height'] )\n\t\t\t{\n\t\t\t\t// Image dimensions > target dimensions, compress a bit more.\n\t\t\t\t$target_jpg_compression = 75;\n\t\t\t}\n\n\t\t\t// Upload image and return path.\n\t\t\t$full_path = $image_resize_gd->saveImageFile(\n\t\t\t\t$path . $file_name,\n\t\t\t\t$extension,\n\t\t\t\t$target_jpg_compression,\n\t\t\t\t// White background for JPEG.\n\t\t\t\t( $extension === IMAGETYPE_JPEG ? 'FFFFFF' : null )\n\t\t\t);\n\n\t\t\tif ( filesize( $full_path ) < $original_image_size )\n\t\t\t{\n\t\t\t\treturn $full_path;\n\t\t\t}\n\t\t\telseif ( $is_base64 )\n\t\t\t{\n\t\t\t\t// Our \"optimized\" file results bigger than the original one...\n\t\t\t\t$image_data = $image_path_or_string;\n\n\t\t\t\t$image_data = substr( $image_data, ( strpos( $image_data, 'base64' ) + 6 ) );\n\n\t\t\t\t$image_data = base64_decode( $image_data );\n\n\t\t\t\t// Save the original base64 image instead.\n\t\t\t\tfile_put_contents( $full_path, $image_data );\n\n\t\t\t\treturn $full_path;\n\t\t\t}\n\t\t}\n\t\tcatch ( Exception $e )\n\t\t{\n\t\t\t$error[] = 'ImageResizeGD: ' . $e->getMessage();\n\t\t}\n\t\tcatch ( InvalidArgumentException $e )\n\t\t{\n\t\t\t$error[] = 'ImageResizeGD: ' . $e->getMessage();\n\t\t}\n\t}\n\n\t// No GD library or ImageResizeGD exception...\n\tif ( $is_base64 )\n\t{\n\t\t// We return the base64 image as is...\n\t\treturn $input;\n\t}\n\n\t// Use regular FileUpload() function.\n\treturn (string) FileUpload(\n\t\t$input,\n\t\t$path,\n\t\t$ext_white_list,\n\t\t0,\n\t\t$error,\n\t\t(string) $final_ext,\n\t\t$file_name_no_ext\n\t);\n}\n\n\n/**\n * Files field Upload and Update\n * Upload custom Files field & update corresponding DB table.\n * Input name must BEGIN with $request, for example: \"valuesCUSTOM_3\".\n *\n * @since 4.6\n *\n * @example FilesUploadUpdate( 'SCHOOLS', 'values',\t$FileUploadsPath . 'Schools/' . UserSchool() . '/' );\n *\n * @uses FileUpload()\n *\n * @param string $table   DB Table name.\n * @param string $request Request part of the input name.\n * @param string $path    Path, folder where the files will be uploaded to.\n *\n * @return string Empty or last file full path.\n */\nfunction FilesUploadUpdate( $table, $request, $path )\n{\n\tglobal $error;\n\n\tif ( ! $table\n\t\t|| ! $path\n\t\t|| empty( $_FILES ) )\n\t{\n\t\treturn '';\n\t}\n\n\t$new_file = '';\n\n\tforeach ( $_FILES as $input => $file )\n\t{\n\t\tif ( mb_strpos( $input, $request ) !== 0 )\n\t\t{\n\t\t\t// Input name must BEGIN with $request, for example: \"valuesCUSTOM_3\".\n\t\t\tcontinue;\n\t\t}\n\n\t\t$file_name_no_ext = no_accents( mb_substr(\n\t\t\t$_FILES[ $input ]['name'],\n\t\t\t0,\n\t\t\tmb_strrpos( $_FILES[ $input ]['name'], '.' )\n\t\t) );\n\n\t\t$file_name_no_ext .= '_' . date( 'Y-m-d_His' );\n\n\t\t$new_file = FileUpload(\n\t\t\t$input,\n\t\t\t$path,\n\t\t\tFileExtensionWhiteList(),\n\t\t\t0,\n\t\t\t$error,\n\t\t\t'',\n\t\t\t$file_name_no_ext\n\t\t);\n\n\t\tif ( $new_file )\n\t\t{\n\t\t\t$value_append = $new_file . '||';\n\n\t\t\t$column = str_replace( $request, '', $input );\n\n\t\t\tif ( $table === 'SCHOOLS' )\n\t\t\t{\n\t\t\t\t$where_sql = \"ID='\" . UserSchool() . \"' AND SYEAR='\" . UserSyear() . \"'\";\n\t\t\t}\n\t\t\telseif ( $table === 'STUDENTS' )\n\t\t\t{\n\t\t\t\t$where_sql = \"STUDENT_ID='\" . UserStudentID() . \"'\";\n\t\t\t}\n\t\t\telseif ( $table === 'ADDRESS' )\n\t\t\t{\n\t\t\t\t$where_sql = \"ADDRESS_ID='\" . $_REQUEST['address_id'] . \"'\";\n\t\t\t}\n\t\t\telseif ( $table === 'PEOPLE' )\n\t\t\t{\n\t\t\t\t$where_sql = \"PERSON_ID='\" . $_REQUEST['person_id'] . \"'\";\n\t\t\t}\n\t\t\telseif ( $table === 'STAFF' )\n\t\t\t{\n\t\t\t\t$where_sql = \"STAFF_ID='\" . UserStaffID() . \"'\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$where_sql = \"ID='\" . $_REQUEST['id'] . \"'\";\n\t\t\t}\n\n\t\t\tDBQuery( \"UPDATE \" . DBEscapeIdentifier( $table ) . \"\n\t\t\t\tSET \" . DBEscapeIdentifier( $column ) . \"=COALESCE(\" .\n\t\t\t\tDBEscapeIdentifier( $column ) . \",'')||'\" . DBEscapeString( $value_append ) . \"'\n\t\t\t\tWHERE \" . $where_sql );\n\t\t}\n\t}\n\n\treturn $new_file;\n}\n\n/**\n * Handle `multiple` files attribute for FileUpload().\n * Move $_FILES[ $input ][...][ $i ] to $_FILES[ {$input}_{$i} ] so FileUpload() can handle it.\n *\n * @since 7.8\n *\n * @example foreach ( FileUploadMultiple( 'files' ) as $input ) { FileUpload( $input ) }\n *\n * @param string $input Input name, without square brackets [].\n *\n * @return array Empty if no files. $input if not multiple. {$input}_{$i} if multiple.\n */\nfunction FileUploadMultiple( $input )\n{\n\tif ( ! isset( $_FILES[ $input ] ) )\n\t{\n\t\treturn [];\n\t}\n\n\tif ( ! is_array( $_FILES[ $input ]['name'] ) )\n\t{\n\t\t// Not multiple files, return $input.\n\t\treturn [ $input ];\n\t}\n\n\t$inputs = [];\n\n\t$files = [];\n\n\tforeach ( $_FILES[ $input ] as $attribute => $files_info )\n\t{\n\t\tforeach ( $files_info as $i => $file_info )\n\t\t{\n\t\t\tif ( ! isset( $files[ $i ] ) )\n\t\t\t{\n\t\t\t\t$files[ $i ] = [];\n\t\t\t}\n\n\t\t\t$files[ $i ][ $attribute ] = $file_info;\n\t\t}\n\t}\n\n\tforeach ( $files as $i => $file )\n\t{\n\n\t\t$input_new_index = $input . '_' . $i;\n\n\t\t$inputs[] = $input_new_index;\n\n\t\t// Move $_FILES[ $input ][...][ $i ] to $_FILES[ {$input}_{$i} ] so FileUpload() can handle it.\n\t\t$_FILES[ $input_new_index ] = $file;\n\t}\n\n\tunset( $_FILES[ $input ] );\n\n\treturn $inputs;\n}\n\n/**\n * Removes accents from string.\n * Also replaces characters others than letters, space, numbers & points\n * with underscores '_'.\n * Perfect to sanitize a filename.\n *\n * @since 3.4 uses PHP intl extension or return microtime in case string does not contain ASCII chars.\n * @since 8.2 Fix replace regex: remove slash & allow space\n *\n * @link http://stackoverflow.com/questions/1017599/how-do-i-remove-accents-from-characters-in-a-php-string\n *\n * @example no_accents( '\u0440\u0443\u043b\u043e\u043d\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439' )\n * Will return 'rulonpol_zovatelej' if PHP intl extension is activated\n * Else it will return microtime, for example '14976328319110'\n *\n * @example no_accents( '\u96c6\u56e2\u5206\u914d\u5b66\u751f\u4fe1\u606f' )\n * Will return 'ji_tuan_fen_pei_xue_sheng_xin_xi' if PHP intl extension is activated\n * Else it will return microtime, for example '14976328319110'\n *\n * @param string $string String with maybe accents.\n *\n * @return string String with no accents or microtime.\n */\nfunction no_accents( $string )\n{\n\tif ( ! preg_match( '/[\\x80-\\xff]/', $string) )\n\t{\n\t\t// Replace characters others than letters, space, numbers & points with underscores  \"_\".\n\t\t$string = preg_replace(\n\t\t\t'/([^ _\\-.a-z0-9]+)/i',\n\t\t\t'_',\n\t\t\t$string\n\t\t);\n\t}\n\n\tif ( function_exists( 'transliterator_transliterate' ) )\n\t{\n\t\t/**\n\t\t * Requires PHP intl extension.\n\t\t * Will transliterate to latin ASCII chars.\n\t\t *\n\t\t * @example \u0440\u0443\u043b\u043e\u043d\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 => rulonpol_zovatelej\n\t\t * @example \u96c6\u56e2\u5206\u914d\u5b66\u751f\u4fe1\u606f => ji_tuan_fen_pei_xue_sheng_xin_xi\n\t\t */\n\t\t$string = transliterator_transliterate(\n\t\t\t'Any-Latin; Latin-ASCII; Lower()',\n\t\t\t$string\n\t\t);\n\n\t\t// Replace characters others than letters, space, numbers & points with underscores  \"_\".\n\t\t$string = preg_replace(\n\t\t\t'/([^ _\\-.a-z0-9]+)/i',\n\t\t\t'_',\n\t\t\t$string\n\t\t);\n\n\t\treturn $string;\n\t}\n\n\t$c195 = chr( 195 );\n\t$c196 = chr( 196 );\n\t$c197 = chr( 197 );\n\n\t$chars = [\n\t// Decompositions for Latin-1 Supplement.\n\t$c195 . chr(128) => 'A', $c195 . chr(129) => 'A',\n\t$c195 . chr(130) => 'A', $c195 . chr(131) => 'A',\n\t$c195 . chr(132) => 'A', $c195 . chr(133) => 'A',\n\t$c195 . chr(135) => 'C', $c195 . chr(136) => 'E',\n\t$c195 . chr(137) => 'E', $c195 . chr(138) => 'E',\n\t$c195 . chr(139) => 'E', $c195 . chr(140) => 'I',\n\t$c195 . chr(141) => 'I', $c195 . chr(142) => 'I',\n\t$c195 . chr(143) => 'I', $c195 . chr(145) => 'N',\n\t$c195 . chr(146) => 'O', $c195 . chr(147) => 'O',\n\t$c195 . chr(148) => 'O', $c195 . chr(149) => 'O',\n\t$c195 . chr(150) => 'O', $c195 . chr(153) => 'U',\n\t$c195 . chr(154) => 'U', $c195 . chr(155) => 'U',\n\t$c195 . chr(156) => 'U', $c195 . chr(157) => 'Y',\n\t$c195 . chr(159) => 's', $c195 . chr(160) => 'a',\n\t$c195 . chr(161) => 'a', $c195 . chr(162) => 'a',\n\t$c195 . chr(163) => 'a', $c195 . chr(164) => 'a',\n\t$c195 . chr(165) => 'a', $c195 . chr(167) => 'c',\n\t$c195 . chr(168) => 'e', $c195 . chr(169) => 'e',\n\t$c195 . chr(170) => 'e', $c195 . chr(171) => 'e',\n\t$c195 . chr(172) => 'i', $c195 . chr(173) => 'i',\n\t$c195 . chr(174) => 'i', $c195 . chr(175) => 'i',\n\t$c195 . chr(177) => 'n', $c195 . chr(178) => 'o',\n\t$c195 . chr(179) => 'o', $c195 . chr(180) => 'o',\n\t$c195 . chr(181) => 'o',\n\t$c195 . chr(182) => 'o', $c195 . chr(185) => 'u',\n\t$c195 . chr(186) => 'u', $c195 . chr(187) => 'u',\n\t$c195 . chr(188) => 'u', $c195 . chr(189) => 'y',\n\t$c195 . chr(191) => 'y',\n\t// Decompositions for Latin Extended-A.\n\t$c196 . chr(128) => 'A', $c196 . chr(129) => 'a',\n\t$c196 . chr(130) => 'A', $c196 . chr(131) => 'a',\n\t$c196 . chr(132) => 'A', $c196 . chr(133) => 'a',\n\t$c196 . chr(134) => 'C', $c196 . chr(135) => 'c',\n\t$c196 . chr(136) => 'C', $c196 . chr(137) => 'c',\n\t$c196 . chr(138) => 'C', $c196 . chr(139) => 'c',\n\t$c196 . chr(140) => 'C', $c196 . chr(141) => 'c',\n\t$c196 . chr(142) => 'D', $c196 . chr(143) => 'd',\n\t$c196 . chr(144) => 'D', $c196 . chr(145) => 'd',\n\t$c196 . chr(146) => 'E', $c196 . chr(147) => 'e',\n\t$c196 . chr(148) => 'E', $c196 . chr(149) => 'e',\n\t$c196 . chr(150) => 'E', $c196 . chr(151) => 'e',\n\t$c196 . chr(152) => 'E', $c196 . chr(153) => 'e',\n\t$c196 . chr(154) => 'E', $c196 . chr(155) => 'e',\n\t$c196 . chr(156) => 'G', $c196 . chr(157) => 'g',\n\t$c196 . chr(158) => 'G', $c196 . chr(159) => 'g',\n\t$c196 . chr(160) => 'G', $c196 . chr(161) => 'g',\n\t$c196 . chr(162) => 'G', $c196 . chr(163) => 'g',\n\t$c196 . chr(164) => 'H', $c196 . chr(165) => 'h',\n\t$c196 . chr(166) => 'H', $c196 . chr(167) => 'h',\n\t$c196 . chr(168) => 'I', $c196 . chr(169) => 'i',\n\t$c196 . chr(170) => 'I', $c196 . chr(171) => 'i',\n\t$c196 . chr(172) => 'I', $c196 . chr(173) => 'i',\n\t$c196 . chr(174) => 'I', $c196 . chr(175) => 'i',\n\t$c196 . chr(176) => 'I', $c196 . chr(177) => 'i',\n\t$c196 . chr(178) => 'IJ',$c196 . chr(179) => 'ij',\n\t$c196 . chr(180) => 'J', $c196 . chr(181) => 'j',\n\t$c196 . chr(182) => 'K', $c196 . chr(183) => 'k',\n\t$c196 . chr(184) => 'k', $c196 . chr(185) => 'L',\n\t$c196 . chr(186) => 'l', $c196 . chr(187) => 'L',\n\t$c196 . chr(188) => 'l', $c196 . chr(189) => 'L',\n\t$c196 . chr(190) => 'l', $c196 . chr(191) => 'L',\n\t$c197 . chr(128) => 'l', $c197 . chr(129) => 'L',\n\t$c197 . chr(130) => 'l', $c197 . chr(131) => 'N',\n\t$c197 . chr(132) => 'n', $c197 . chr(133) => 'N',\n\t$c197 . chr(134) => 'n', $c197 . chr(135) => 'N',\n\t$c197 . chr(136) => 'n', $c197 . chr(137) => 'N',\n\t$c197 . chr(138) => 'n', $c197 . chr(139) => 'N',\n\t$c197 . chr(140) => 'O', $c197 . chr(141) => 'o',\n\t$c197 . chr(142) => 'O', $c197 . chr(143) => 'o',\n\t$c197 . chr(144) => 'O', $c197 . chr(145) => 'o',\n\t$c197 . chr(146) => 'OE',$c197 . chr(147) => 'oe',\n\t$c197 . chr(148) => 'R', $c197 . chr(149) => 'r',\n\t$c197 . chr(150) => 'R', $c197 . chr(151) => 'r',\n\t$c197 . chr(152) => 'R', $c197 . chr(153) => 'r',\n\t$c197 . chr(154) => 'S', $c197 . chr(155) => 's',\n\t$c197 . chr(156) => 'S', $c197 . chr(157) => 's',\n\t$c197 . chr(158) => 'S', $c197 . chr(159) => 's',\n\t$c197 . chr(160) => 'S', $c197 . chr(161) => 's',\n\t$c197 . chr(162) => 'T', $c197 . chr(163) => 't',\n\t$c197 . chr(164) => 'T', $c197 . chr(165) => 't',\n\t$c197 . chr(166) => 'T', $c197 . chr(167) => 't',\n\t$c197 . chr(168) => 'U', $c197 . chr(169) => 'u',\n\t$c197 . chr(170) => 'U', $c197 . chr(171) => 'u',\n\t$c197 . chr(172) => 'U', $c197 . chr(173) => 'u',\n\t$c197 . chr(174) => 'U', $c197 . chr(175) => 'u',\n\t$c197 . chr(176) => 'U', $c197 . chr(177) => 'u',\n\t$c197 . chr(178) => 'U', $c197 . chr(179) => 'u',\n\t$c197 . chr(180) => 'W', $c197 . chr(181) => 'w',\n\t$c197 . chr(182) => 'Y', $c197 . chr(183) => 'y',\n\t$c197 . chr(184) => 'Y', $c197 . chr(185) => 'Z',\n\t$c197 . chr(186) => 'z', $c197 . chr(187) => 'Z',\n\t$c197 . chr(188) => 'z', $c197 . chr(189) => 'Z',\n\t$c197 . chr(190) => 'z', $c197 . chr(191) => 's'\n\t];\n\n\t$string = strtr( $string, $chars );\n\n\t// Replace characters others than letters, space, numbers & points with underscores  \"_\".\n\t$string = preg_replace(\n\t\t'/([^ _\\-.a-z0-9]+)/i',\n\t\t'_',\n\t\t$string\n\t);\n\n\tif ( $string === '_' )\n\t{\n\t\t// String does not contain any latin ASCII char return microtime!\n\t\t$string = number_format( microtime( true ), 4, '', '' );\n\t}\n\n\treturn $string;\n}\n\n\n\n/**\n * Get server maximum file upload size (Mb)\n *\n * @see  php.ini directives (upload_max_filesize & post_max_size)\n *\n * @uses ReturnMegabytes() function\n *\n * @return float maximum file upload size in Mega Bytes (Mb)\n */\nfunction FileUploadMaxSize()\n{\n\t// Size is limited by server configuration (upload_max_filesize & post_max_size).\n\treturn (float) min(\n\t\tReturnMegabytes( ini_get( 'post_max_size' ) ),\n\t\tReturnMegabytes( ini_get( 'upload_max_filesize' ) )\n\t);\n}\n\n\n/**\n * Return value in Mega Bytes (MB)\n *\n * @example ReturnMegabytes( ini_get( 'upload_max_filesize' ) )\n *\n * @param  string $val php.ini value, shorthand notation.\n *\n * @return string      value in Mega Bytes (MB)\n */\nfunction ReturnMegabytes( $val ) {\n\n\t$val = trim( $val );\n\n\t$last = strtolower( $val[ strlen( $val ) - 1 ] );\n\n\t$val = (int) $val;\n\n\tswitch ( $last ) {\n\n\t\t// The 'G' modifier is available since PHP 5.1.0.\n\t\tcase 'g':\n\n\t\t\t$val *= 1024;\n\n\t\tcase 'm':\n\n\t\t\t$val *= 1;\n\n\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t$val /= 1024;\n\n\t\tcase 'k':\n\n\t\t\t$val /= 1024;\n\t}\n\n\treturn $val;\n}\n\n\n/**\n * Human filesize\n * Converts bytes into human readable file size.\n *\n * @example $file_size = HumanFilesize( filesize( $file_name ) );\n *\n * @link http://php.net/manual/en/function.filesize.php#106569\n *\n * @since  2.9\n *\n * @param  integer $bytes    File size in Bytes.\n * @param  integer $decimals Decimals (optional). Defaults to 1.\n *\n * @return string            Human readable file size.\n */\nfunction HumanFilesize( $bytes, $decimals = 1 )\n{\n\t$sz = 'BKMGTP';\n\n\t$factor = floor( ( strlen( $bytes ) - 1 ) / 3 );\n\n\treturn sprintf( \"%.{$decimals}f\", $bytes / pow( 1024, $factor ) ) . @$sz[ $factor ];\n}\n\n\n/**\n * Extensions white list.\n * Common file types.\n * Obviously, we won't include executable types\n * .php, .sql, .js, .exe...\n * If you file type is not white listed,\n * put it in a ZIP archive!\n *\n * @since 3.8.1\n *\n * @link http://fileinfo.com/filetypes/common\n */\nfunction FileExtensionWhiteList() {\n\treturn [\n\t\t// Micro$oft Office.\n\t\t'.doc',\n\t\t'.docx',\n\t\t'.xls',\n\t\t'.xlsm',\n\t\t'.xlsx',\n\t\t'.xlr',\n\t\t'.pps',\n\t\t'.ppt',\n\t\t'.pptx',\n\t\t'.wps',\n\t\t'.wpd',\n\t\t'.rtf',\n\t\t// Libre Office.\n\t\t'.odt',\n\t\t'.ods',\n\t\t'.odp',\n\t\t// Keynote presentation.\n\t\t'.key',\n\t\t// Images.\n\t\t'.jpg',\n\t\t'.jpeg',\n\t\t'.png',\n\t\t'.gif',\n\t\t'.bmp',\n\t\t// @since 8.9.3 Fix stored XSS security issue: do not allow unsanitized SVG\n\t\t// '.svg',\n\t\t'.ico',\n\t\t'.psd',\n\t\t'.ai',\n\t\t'.eps',\n\t\t'.ps',\n\t\t'.webp',\n\t\t// Audio.\n\t\t'.mp3',\n\t\t'.ogg',\n\t\t'.wav',\n\t\t'.mid',\n\t\t'.midi',\n\t\t'.wma',\n\t\t'.aif',\n\t\t// Video.\n\t\t'.avi',\n\t\t'.mp4',\n\t\t'.mpg',\n\t\t'.mpeg',\n\t\t'.ogv',\n\t\t'.webm',\n\t\t'.wmv',\n\t\t'.h264',\n\t\t'.mkv',\n\t\t'.mov',\n\t\t'.m4v',\n\t\t'.flv', // @deprecated Adobe Flash.\n\t\t'.swf', // @deprecated Adobe Flash.\n\t\t// Text.\n\t\t'.txt',\n\t\t'.pdf',\n\t\t'.md',\n\t\t'.csv',\n\t\t'.tex',\n\t\t'.log',\n\t\t// Email.\n\t\t'.email',\n\t\t'.eml',\n\t\t'.emlx',\n\t\t'.msg',\n\t\t'.vcf',\n\t\t// Web.\n\t\t'.xml',\n\t\t'.xhtml',\n\t\t'.html',\n\t\t'.htm',\n\t\t'.css',\n\t\t'.rss',\n\t\t// Compressed.\n\t\t'.zip',\n\t\t'.rar',\n\t\t'.7z',\n\t\t'.tar',\n\t\t'.gz',\n\t];\n}\n"], "filenames": ["CHANGES.md", "ProgramFunctions/FileUpload.fnc.php"], "buggy_code_start_loc": [2, 797], "buggy_code_end_loc": [2, 798], "fixing_code_start_loc": [3, 797], "fixing_code_end_loc": [7, 799], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository francoisjacquet/rosariosis prior to 8.9.3.", "other": {"cve": {"id": "CVE-2022-3072", "sourceIdentifier": "security@huntr.dev", "published": "2022-09-01T08:15:07.650", "lastModified": "2022-09-02T18:46:38.467", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository francoisjacquet/rosariosis prior to 8.9.3."}, {"lang": "es", "value": "Una vulnerabilidad de tipo Cross-site Scripting (XSS) - Almacenado en el repositorio GitHub francoisjacquet/rosariosis versiones anteriores a 8.9.3"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.0, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.1, "impactScore": 5.9}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:rosariosis:rosariosis:*:*:*:*:*:*:*:*", "versionEndExcluding": "8.9.3", "matchCriteriaId": "A881AD77-AB60-451F-ADC9-5D7BCEF1A582"}]}]}], "references": [{"url": "https://github.com/francoisjacquet/rosariosis/commit/dcd3b86156bf9e981944e1a9e01ea23d8ad7c83a", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/9755ae6a-b08b-40a0-8089-c723b2d9ca52", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/francoisjacquet/rosariosis/commit/dcd3b86156bf9e981944e1a9e01ea23d8ad7c83a"}}