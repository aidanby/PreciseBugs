{"buggy_code": ["<?php\n/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) baserCMS Users Community <https://basercms.net/community/>\n *\n * @copyright       Copyright (c) baserCMS Users Community\n * @link            https://basercms.net baserCMS Project\n * @package         Baser.Controller.Component\n * @since           baserCMS v 4.0.0\n * @license         https://basercms.net/license/index.html\n */\n\n/**\n * Class BcContentsComponent\n *\n * \u968e\u5c64\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u9023\u643a\u3057\u305f\u30d5\u30a9\u30fc\u30e0\u753b\u9762\u3092\u4f5c\u6210\u3059\u308b\u70ba\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\n *\n * \u300a\u5f79\u5272\u300b\n * - \u30b3\u30f3\u30c6\u30f3\u30c4\u4e00\u89a7\u3078\u306e\u30d1\u30f3\u304f\u305a\u3092\u81ea\u52d5\u8ffd\u52a0\n * - \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3067\u30b3\u30f3\u30c6\u30f3\u30c4\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\n *        Controller / View \u306b\u3066\u3001$this->request->params['Content'] \u3067\u53c2\u7167\u3067\u304d\u308b\n * - \u30b3\u30f3\u30c6\u30f3\u30c4\u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u3092\u81ea\u52d5\u8868\u793a\n * - \u30b3\u30f3\u30c6\u30f3\u30c4\u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u8a2d\u5b9a\n * - \u30b3\u30f3\u30c6\u30f3\u30c4\u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u306e\u521d\u671f\u5024\u3092\u8a2d\u5b9a\n *\n * @package Baser.Controller.Component\n */\nclass BcContentsComponent extends Component\n{\n\n\t/**\n\t * Content \u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3067\u5229\u7528\u3059\u308b\u304b\u3069\u3046\u304b\n\t * settings \u3067\u6307\u5b9a\u3059\u308b\n\t *\n\t * @var bool\n\t */\n\tpublic $useForm = false;\n\n\t/**\n\t * \u30d3\u30e5\u30fc\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u5229\u7528\u3059\u308b\u304b\u3069\u3046\u304b\n\t *\n\t * @var bool\n\t * @deprecated 5.0.0 since 4.0.0\n\t *    CakePHP3\u3067\u306f\u3001\u30d3\u30e5\u30fc\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u5ec3\u6b62\u3068\u306a\u308b\u70ba\u3001\u5225\u306e\u65b9\u6cd5\u306b\u79fb\u884c\u3059\u308b\n\t */\n\tpublic $useViewCache = false;\n\n\t/**\n\t * \u30b3\u30f3\u30c6\u30f3\u30c4\u7de8\u96c6\u7528\u306e\u30a2\u30af\u30b7\u30e7\u30f3\u540d\n\t * \u5224\u5b9a\u306b\u5229\u7528\n\t * settings \u3067\u6307\u5b9a\u3059\u308b\n\t *\n\t * @var string\n\t */\n\tpublic $editAction = 'admin_edit';\n\n\t/**\n\t * \u30b3\u30f3\u30c6\u30f3\u30c4\u65b0\u898f\u767b\u9332\u7528\u306e\u30a2\u30af\u30b7\u30e7\u30f3\u540d\n\t * \u5224\u5b9a\u306b\u5229\u7528\n\t * settings \u3067\u6307\u5b9a\u3059\u308b\n\t *\n\t * @var string\n\t */\n\tpublic $addAction = 'admin_add';\n\n\t/**\n\t * \u30b3\u30f3\u30c6\u30f3\u30c4\u30bf\u30a4\u30d7\n\t * settings \u3067\u6307\u5b9a\u3059\u308b\n\t *\n\t * @var string\n\t */\n\tpublic $type = null;\n\n\t/**\n\t * \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\n\t *\n\t * @var Controller\n\t */\n\tprotected $_Controller = null;\n\n\t/**\n\t * \u30d7\u30ec\u30d3\u30e5\u30fc\u30e2\u30fc\u30c9\n\t *\n\t * @var string default Or alias\n\t */\n\tpublic $preview = null;\n\n\t/**\n\t * Initialize\n\t *\n\t * @param Controller $controller Controller with components to initialize\n\t * @return void\n\t */\n\tpublic function initialize(Controller $controller)\n\t{\n\t\t$this->_Controller = $controller;\n\t\t$controller->uses[] = 'Content';\n\t\tif (!$this->type) {\n\t\t\tif ($controller->plugin) {\n\t\t\t\t$this->type = $controller->plugin . '.' . $controller->modelClass;\n\t\t\t} else {\n\t\t\t\t$this->type = $controller->modelClass;\n\t\t\t}\n\t\t}\n\t\tif (!BcUtil::isAdminSystem()) {\n\t\t\t// \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u8a2d\u5b9a\n\t\t\t$this->setupFront();\n\t\t} else {\n\t\t\t// \u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a\n\t\t\t$this->setupAdmin();\n\t\t}\n\t}\n\n\t/**\n\t * \u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a\n\t */\n\tpublic function setupAdmin()\n\t{\n\t\t$items = Configure::read('BcContents.items');\n\t\t$createdSettings = [];\n\t\tforeach($items as $name => $settings) {\n\t\t\tforeach($settings as $type => $setting) {\n\t\t\t\t$setting['plugin'] = $name;\n\t\t\t\t$setting['type'] = $type;\n\t\t\t\t$createdSettings[$type] = $setting;\n\t\t\t}\n\t\t}\n\t\t$this->settings['items'] = $createdSettings;\n\t}\n\n\t/**\n\t * \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\t */\n\tpublic function setupFront()\n\t{\n\t\t$controller = $this->_Controller;\n\t\t// \u30d7\u30ec\u30d3\u30e5\u30fc\u6642\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\n\t\tif (!empty($controller->request->query['preview'])) {\n\t\t\t$this->preview = $this->_Controller->request->query['preview'];\n\t\t\tif (!empty($controller->request->data['Content'])) {\n\t\t\t\t$controller->request->params['Content'] = $controller->request->data['Content'];\n\t\t\t\t$controller->Security->validatePost = false;\n\t\t\t\t$controller->Security->csrfCheck = false;\n\t\t\t}\n\t\t}\n\n\t\t// \u8868\u793a\u8a2d\u5b9a\n\t\tif (!empty($controller->request->params['Content'])) {\n\t\t\t// \u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u8a2d\u5b9a\n\t\t\t$controller->layout = $controller->request->params['Content']['layout_template'];\n\t\t\tif (!$controller->layout) {\n\t\t\t\t$controller->layout = $this->getParentLayoutTemplate($controller->request->params['Content']['id']);\n\t\t\t}\n\t\t\t// \u30d1\u30f3\u304f\u305a\n\t\t\t$controller->crumbs = $this->getCrumbs($controller->request->params['Content']['id']);\n\t\t\t// \u8aac\u660e\u6587\n\t\t\t$controller->set('description', $controller->request->params['Content']['description']);\n\t\t\t// \u30bf\u30a4\u30c8\u30eb\n\t\t\t$controller->pageTitle = $controller->request->params['Content']['title'];\n\t\t}\n\n\t}\n\n\t/**\n\t * \u30d1\u30f3\u304f\u305a\u7528\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\n\t *\n\t * @param $id\n\t * @return array\n\t */\n\tpublic function getCrumbs($id)\n\t{\n\t\t// ===========================================================================================\n\t\t// 2016/09/22 ryuring\n\t\t// PHP 7.0.8 \u74b0\u5883\u306b\u3066\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u4e00\u89a7\u8ffd\u52a0\u6642\u3001\u691c\u7d22\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306e\u70ba\u3001BcContentsComponent \u304c\n\t\t// \u547c\u3073\u51fa\u3055\u308c\u308b\u304c\u3001\u305d\u306e\u969b\u3001\u30e2\u30c7\u30eb\u306e\u30de\u30b8\u30c3\u30af\u30e1\u30bd\u30c3\u30c9\u306e\u623b\u308a\u5024\u3092\u8fd4\u3059\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u51e6\u7406\u304c\u30b9\u30c8\u30c3\u30d7\u3057\u3066\u3057\u307e\u3046\u3002\n\t\t// \u305d\u306e\u70ba\u3001\u30d3\u30d8\u30a4\u30d3\u30a2\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u76f4\u63a5\u5b9f\u884c\u3057\u3066\u5bfe\u51e6\u3057\u305f\u3002\n\t\t// CakePHP\u3082\u3001PHP\u81ea\u4f53\u306e\u30a8\u30e9\u30fc\u3082\u767a\u751f\u305b\u305a\u3001\u305f\u3060\u6b62\u307e\u308b\u3002PHP7\u306e\u30d0\u30b0\uff1fPHP\u5074\u306e\u30e1\u30e2\u30ea\u30fc\u3092256M\u306b\u3057\u3066\u3082\u5909\u308f\u3089\u305a\u3002\n\t\t// ===========================================================================================\n\t\t$contents = $this->_Controller->Content->Behaviors->Tree->getPath($this->_Controller->Content, $id, [], -1);\n\t\tunset($contents[count($contents) - 1]);\n\t\t$crumbs = [];\n\t\tforeach($contents as $content) {\n\t\t\tif (!$content['Content']['site_root']) {\n\t\t\t\t$crumb = [\n\t\t\t\t\t'name' => $content['Content']['title'],\n\t\t\t\t\t'url' => $content['Content']['url']\n\t\t\t\t];\n\t\t\t\t$crumbs[] = $crumb;\n\t\t\t}\n\t\t}\n\t\treturn $crumbs;\n\t}\n\n\t/**\n\t * Content \u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\n\t *\n\t * @param int $entityId\n\t * @return array\n\t */\n\tpublic function getContent($entityId = null)\n\t{\n\t\treturn $this->_Controller->Content->findByType($this->type, $entityId);\n\t}\n\n\t/**\n\t * Before render\n\t *\n\t * @param Controller $controller\n\t * @return void\n\t */\n\tpublic function beforeRender(Controller $controller)\n\t{\n\t\tparent::beforeRender($controller);\n\t\tif (BcUtil::isAdminSystem()) {\n\t\t\t$controller->set('contentsSettings', $this->settings['items']);\n\t\t\t// \u30d1\u30f3\u304f\u305a\u3092\u30bb\u30c3\u30c8\n\t\t\tarray_unshift($controller->crumbs, ['name' => __d('baser', '\u30b3\u30f3\u30c6\u30f3\u30c4\u4e00\u89a7'), 'url' => ['plugin' => null, 'controller' => 'contents', 'action' => 'index']]);\n\t\t\tif ($controller->subMenuElements && !in_array('contents', $controller->subMenuElements)) {\n\t\t\t\tarray_unshift($controller->subMenuElements, 'contents');\n\t\t\t} else {\n\t\t\t\t$controller->subMenuElements = ['contents'];\n\t\t\t}\n\t\t\tif ($this->useForm && in_array($controller->request->action, [$this->editAction, $this->addAction, 'admin_edit_alias']) && !empty($controller->request->data['Content'])) {\n\t\t\t\t$siteId = 0;\n\t\t\t\t$id = null;\n\t\t\t\tif($controller->request->data('Content.site_id')) {\n\t\t\t\t\t$siteId = $controller->request->data('Content.site_id');\n\t\t\t\t}\n\t\t\t\tif($controller->request->data('Content.id')) {\n\t\t\t\t\t$id = $controller->request->data('Content.id');\n\t\t\t\t}\n\t\t\t\t// \u30d5\u30a9\u30fc\u30e0\u3092\u30bb\u30c3\u30c8\n\t\t\t\t$this->settingForm($controller, $siteId, $id);\n\t\t\t\t// \u30d5\u30a9\u30fc\u30e0\u3092\u8aad\u307f\u8fbc\u3080\u70ba\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u8a2d\u5b9a\n\t\t\t\t// \u5185\u90e8\u3067 useForm \u3092\u53c2\u7167\u3067\u304d\u306a\u3044\u70ba\u3001\u3053\u3053\u306b\u8a18\u8ff0\u3002\n\t\t\t\t// \u30d5\u30a9\u30fc\u30e0\u306e\u8a2d\u5b9a\u3057\u304b\u3067\u304d\u306a\u3044\u30a4\u30d9\u30f3\u30c8\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u3002\n\t\t\t\t// TODO \u6539\u5584\u8981\n\t\t\t\tApp::uses('BcContentsEventListener', 'Event');\n\t\t\t\tCakeEventManager::instance()->attach(new BcContentsEventListener());\n\t\t\t}\n\t\t} else {\n\t\t\t// \u30d3\u30e5\u30fc\u30ad\u30e3\u30c3\u30b7\u30e5\u8a2d\u5b9a\n\t\t\tif (empty($controller->request->query['preview'])) {\n\t\t\t\t// @deprecated 5.0.0 since 4.0.0\n\t\t\t\t//\tCakePHP3\u3067\u306f\u3001\u30d3\u30e5\u30fc\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u5ec3\u6b62\u3068\u306a\u308b\u70ba\u3001\u5225\u306e\u65b9\u6cd5\u306b\u79fb\u884c\u3059\u308b\n\t\t\t\tif ($this->useViewCache && !BcUtil::loginUser('admin') && !isConsole() && !empty($controller->request->params['Content'])) {\n\t\t\t\t\t$controller->helpers[] = 'BcCache';\n\t\t\t\t\t// php 8\u7cfb\u3067\u306f'+5 min'\u306a\u3069\u3001string\u578b\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u305f\u5834\u5408\u30015\u5206\u5f8c\u3068\u5224\u5b9a\u3055\u308c\u306a\u3044\u554f\u984c\u3092\u89e3\u6d88\n\t\t\t\t\t$cacheTime = $controller->Content->getCacheTime($controller->request->params['Content']);\n\t\t\t\t\t$controller->cacheAction = is_numeric($cacheTime) ? $cacheTime : strtotime($cacheTime) - time();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\n\t/**\n\t * \u30b3\u30f3\u30c6\u30f3\u30c4\u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u3092\u8a2d\u5b9a\u3059\u308b\n\t *\n\t * @param Controller $controller\n\t * @return void\n\t */\n\tpublic function settingForm(Controller $controller, $currentSiteId, $currentContentId = null)\n\t{\n\n\t\t// \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30bd\u30fc\u30b9\u3092\u8a2d\u5b9a\n\t\t$options = [];\n\t\tif ($controller->name == 'ContentFolders') {\n\t\t\t$options['excludeId'] = $currentContentId;\n\t\t}\n\t\t$data = $controller->request->data;\n\n\t\t$theme = $this->_Controller->siteConfigs['theme'];\n\t\t$site = BcSite::findById($data['Content']['site_id']);\n\t\tif ($site->theme) {\n\t\t\t$theme = $site->theme;\n\t\t}\n\t\t$templates = array_merge(\n\t\t\tBcUtil::getTemplateList('Layouts', '', $theme),\n\t\t\tBcUtil::getTemplateList('Layouts', $this->_Controller->plugin, $theme)\n\t\t);\n\t\tif (!empty($data['Content']['id']) && $data['Content']['id'] != 1) {\n\t\t\t$parentTemplate = $this->getParentLayoutTemplate($data['Content']['id']);\n\t\t\tif (in_array($parentTemplate, $templates)) {\n\t\t\t\tunset($templates[$parentTemplate]);\n\t\t\t}\n\t\t\tarray_unshift($templates, ['' => __d('baser', '\u89aa\u30d5\u30a9\u30eb\u30c0\u306e\u8a2d\u5b9a\u306b\u5f93\u3046') . '\uff08' . $parentTemplate . '\uff09']);\n\t\t}\n\t\t$data['Content']['name'] = urldecode($data['Content']['name']);\n\t\tif (Configure::read('BcApp.autoUpdateContentCreatedDate')) {\n\t\t\t$data['Content']['modified_date'] = date('Y-m-d H:i:s');\n\t\t}\n\t\t$controller->set('layoutTemplates', $templates);\n\t\t$controller->set('parentContents', $controller->Content->getContentFolderList($currentSiteId, $options));\n\t\t$controller->set('authors', $controller->User->getUserList());\n\t\t$Site = ClassRegistry::init('Site');\n\t\tif(!empty($data['Content']['id'])) {\n\t\t\t$site = $controller->Content->find('first', ['conditions' => ['Content.id' => $data['Content']['id']]]);\n\t\t\t$relatedContents = $Site->getRelatedContents($data['Content']['id']);\n\t\t} else {\n\t\t\t$site = $controller->Content->find('first', ['conditions' => ['Content.id' => $data['Content']['parent_id']]]);\n\t\t\t$relatedContents = [];\n\t\t}\n\t\tif (!is_null($site['Site']['main_site_id'])) {\n\t\t\t$mainSiteId = $site['Site']['main_site_id'];\n\t\t} else {\n\t\t\t$mainSiteId = 0;\n\t\t}\n\n\t\t$siteList = [0 => ''] + $controller->Content->Site->find('list', ['fields' => ['id', 'display_name']]);\n\t\t$controller->set('sites', $siteList);\n\t\t$controller->set('mainSiteDisplayName', $controller->siteConfigs['main_site_display_name']);\n\t\t$data['Site'] = $site['Site'];\n\t\t$controller->set('mainSiteId', $mainSiteId);\n\t\t$controller->set('relatedContents', $relatedContents);\n\t\t$related = false;\n\t\tif (($data['Site']['relate_main_site'] && $data['Content']['main_site_content_id'] && $data['Content']['alias_id']) ||\n\t\t\t$data['Site']['relate_main_site'] && $data['Content']['main_site_content_id'] && $data['Content']['type'] == 'ContentFolder') {\n\t\t\t$related = true;\n\t\t}\n\t\t$controller->request->data = $data;\n\t\t$currentSiteId = $siteId = $controller->request->data['Site']['id'];\n\t\tif (is_null($currentSiteId)) {\n\t\t\t$currentSiteId = 0;\n\t\t}\n\t\t$controller->set('currentSiteId', $currentSiteId);\n\t\t$controller->set('related', $related);\n\t}\n\n\t/**\n\t * \u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u53d6\u5f97\u3059\u308b\n\t *\n\t * @param $id\n\t * @return string $parentTemplate|false\n\t */\n\tpublic function getParentLayoutTemplate($id)\n\t{\n\t\tif (!$id) {\n\t\t\treturn false;\n\t\t}\n\t\t// ===========================================================================================\n\t\t// 2016/09/22 ryuring\n\t\t// PHP 7.0.8 \u74b0\u5883\u306b\u3066\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u4e00\u89a7\u8ffd\u52a0\u6642\u3001\u691c\u7d22\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306e\u70ba\u3001BcContentsComponent \u304c\n\t\t// \u547c\u3073\u51fa\u3055\u308c\u308b\u304c\u3001\u305d\u306e\u969b\u3001\u30e2\u30c7\u30eb\u306e\u30de\u30b8\u30c3\u30af\u30e1\u30bd\u30c3\u30c9\u306e\u623b\u308a\u5024\u3092\u8fd4\u3059\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u51e6\u7406\u304c\u30b9\u30c8\u30c3\u30d7\u3057\u3066\u3057\u307e\u3046\u3002\n\t\t// \u305d\u306e\u70ba\u3001\u30d3\u30d8\u30a4\u30d3\u30a2\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u76f4\u63a5\u5b9f\u884c\u3057\u3066\u5bfe\u51e6\u3057\u305f\u3002\n\t\t// CakePHP\u3082\u3001PHP\u81ea\u4f53\u306e\u30a8\u30e9\u30fc\u3082\u767a\u751f\u305b\u305a\u3001\u305f\u3060\u6b62\u307e\u308b\u3002PHP7\u306e\u30d0\u30b0\uff1fPHP\u5074\u306e\u30e1\u30e2\u30ea\u30fc\u3092256M\u306b\u3057\u3066\u3082\u5909\u308f\u3089\u305a\u3002\n\t\t// ===========================================================================================\n\t\t$contents = $this->_Controller->Content->Behaviors->Tree->getPath($this->_Controller->Content, $id);\n\t\t$contents = array_reverse($contents);\n\t\tunset($contents[0]);\n\t\tif (!$contents) {\n\t\t\treturn false;\n\t\t}\n\t\t$parentTemplates = Hash::extract($contents, '{n}.Content.layout_template');\n\t\tforeach($parentTemplates as $parentTemplate) {\n\t\t\tif ($parentTemplate) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn $parentTemplate;\n\t}\n\n\t/**\n\t * \u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30bf\u30a4\u30d7\u306e\u4e00\u89a7\u3092\u53d6\u5f97\u3059\u308b\n\t *\n\t * @return array\n\t */\n\tpublic function getTypes()\n\t{\n\t\t$types = [];\n\t\tforeach($this->settings['items'] as $key => $value) {\n\t\t\t$types[$key] = $value['title'];\n\t\t}\n\t\treturn $types;\n\t}\n\n}\n"], "fixing_code": ["<?php\n/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) baserCMS Users Community <https://basercms.net/community/>\n *\n * @copyright       Copyright (c) baserCMS Users Community\n * @link            https://basercms.net baserCMS Project\n * @package         Baser.Controller.Component\n * @since           baserCMS v 4.0.0\n * @license         https://basercms.net/license/index.html\n */\n\n/**\n * Class BcContentsComponent\n *\n * \u968e\u5c64\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u9023\u643a\u3057\u305f\u30d5\u30a9\u30fc\u30e0\u753b\u9762\u3092\u4f5c\u6210\u3059\u308b\u70ba\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\n *\n * \u300a\u5f79\u5272\u300b\n * - \u30b3\u30f3\u30c6\u30f3\u30c4\u4e00\u89a7\u3078\u306e\u30d1\u30f3\u304f\u305a\u3092\u81ea\u52d5\u8ffd\u52a0\n * - \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3067\u30b3\u30f3\u30c6\u30f3\u30c4\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\n *        Controller / View \u306b\u3066\u3001$this->request->params['Content'] \u3067\u53c2\u7167\u3067\u304d\u308b\n * - \u30b3\u30f3\u30c6\u30f3\u30c4\u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u3092\u81ea\u52d5\u8868\u793a\n * - \u30b3\u30f3\u30c6\u30f3\u30c4\u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u8a2d\u5b9a\n * - \u30b3\u30f3\u30c6\u30f3\u30c4\u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u306e\u521d\u671f\u5024\u3092\u8a2d\u5b9a\n *\n * @package Baser.Controller.Component\n */\nclass BcContentsComponent extends Component\n{\n\n\t/**\n\t * Content \u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3067\u5229\u7528\u3059\u308b\u304b\u3069\u3046\u304b\n\t * settings \u3067\u6307\u5b9a\u3059\u308b\n\t *\n\t * @var bool\n\t */\n\tpublic $useForm = false;\n\n\t/**\n\t * \u30d3\u30e5\u30fc\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u5229\u7528\u3059\u308b\u304b\u3069\u3046\u304b\n\t *\n\t * @var bool\n\t * @deprecated 5.0.0 since 4.0.0\n\t *    CakePHP3\u3067\u306f\u3001\u30d3\u30e5\u30fc\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u5ec3\u6b62\u3068\u306a\u308b\u70ba\u3001\u5225\u306e\u65b9\u6cd5\u306b\u79fb\u884c\u3059\u308b\n\t */\n\tpublic $useViewCache = false;\n\n\t/**\n\t * \u30b3\u30f3\u30c6\u30f3\u30c4\u7de8\u96c6\u7528\u306e\u30a2\u30af\u30b7\u30e7\u30f3\u540d\n\t * \u5224\u5b9a\u306b\u5229\u7528\n\t * settings \u3067\u6307\u5b9a\u3059\u308b\n\t *\n\t * @var string\n\t */\n\tpublic $editAction = 'admin_edit';\n\n\t/**\n\t * \u30b3\u30f3\u30c6\u30f3\u30c4\u65b0\u898f\u767b\u9332\u7528\u306e\u30a2\u30af\u30b7\u30e7\u30f3\u540d\n\t * \u5224\u5b9a\u306b\u5229\u7528\n\t * settings \u3067\u6307\u5b9a\u3059\u308b\n\t *\n\t * @var string\n\t */\n\tpublic $addAction = 'admin_add';\n\n\t/**\n\t * \u30b3\u30f3\u30c6\u30f3\u30c4\u30bf\u30a4\u30d7\n\t * settings \u3067\u6307\u5b9a\u3059\u308b\n\t *\n\t * @var string\n\t */\n\tpublic $type = null;\n\n\t/**\n\t * \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\n\t *\n\t * @var Controller\n\t */\n\tprotected $_Controller = null;\n\n\t/**\n\t * \u30d7\u30ec\u30d3\u30e5\u30fc\u30e2\u30fc\u30c9\n\t *\n\t * @var string default Or alias\n\t */\n\tpublic $preview = null;\n\n\t/**\n\t * Initialize\n\t *\n\t * @param Controller $controller Controller with components to initialize\n\t * @return void\n\t */\n\tpublic function initialize(Controller $controller)\n\t{\n\t\t$this->_Controller = $controller;\n\t\t$controller->uses[] = 'Content';\n\t\tif (!$this->type) {\n\t\t\tif ($controller->plugin) {\n\t\t\t\t$this->type = $controller->plugin . '.' . $controller->modelClass;\n\t\t\t} else {\n\t\t\t\t$this->type = $controller->modelClass;\n\t\t\t}\n\t\t}\n\t\tif (!BcUtil::isAdminSystem()) {\n\t\t\t// \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u8a2d\u5b9a\n\t\t\t$this->setupFront();\n\t\t} else {\n\t\t\t// \u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a\n\t\t\t$this->setupAdmin();\n\t\t}\n\t}\n\n\t/**\n\t * \u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a\n\t */\n\tpublic function setupAdmin()\n\t{\n\t\t$items = Configure::read('BcContents.items');\n\t\t$createdSettings = [];\n\t\tforeach($items as $name => $settings) {\n\t\t\tforeach($settings as $type => $setting) {\n\t\t\t\t$setting['plugin'] = $name;\n\t\t\t\t$setting['type'] = $type;\n\t\t\t\t$createdSettings[$type] = $setting;\n\t\t\t}\n\t\t}\n\t\t$this->settings['items'] = $createdSettings;\n\t}\n\n\t/**\n\t * \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\t */\n\tpublic function setupFront()\n\t{\n\t\t$controller = $this->_Controller;\n\t\t// \u30d7\u30ec\u30d3\u30e5\u30fc\u6642\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\n\t\tif (!empty($controller->request->query['preview'])) {\n\t\t\t$this->preview = $this->_Controller->request->query['preview'];\n\t\t\tif (!empty($controller->request->data['Content'])) {\n\t\t\t\t$controller->request->params['Content'] = $controller->request->data['Content'];\n\t\t\t\t$controller->Security->validatePost = false;\n\t\t\t}\n\t\t}\n\n\t\t// \u8868\u793a\u8a2d\u5b9a\n\t\tif (!empty($controller->request->params['Content'])) {\n\t\t\t// \u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u8a2d\u5b9a\n\t\t\t$controller->layout = $controller->request->params['Content']['layout_template'];\n\t\t\tif (!$controller->layout) {\n\t\t\t\t$controller->layout = $this->getParentLayoutTemplate($controller->request->params['Content']['id']);\n\t\t\t}\n\t\t\t// \u30d1\u30f3\u304f\u305a\n\t\t\t$controller->crumbs = $this->getCrumbs($controller->request->params['Content']['id']);\n\t\t\t// \u8aac\u660e\u6587\n\t\t\t$controller->set('description', $controller->request->params['Content']['description']);\n\t\t\t// \u30bf\u30a4\u30c8\u30eb\n\t\t\t$controller->pageTitle = $controller->request->params['Content']['title'];\n\t\t}\n\n\t}\n\n\t/**\n\t * \u30d1\u30f3\u304f\u305a\u7528\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\n\t *\n\t * @param $id\n\t * @return array\n\t */\n\tpublic function getCrumbs($id)\n\t{\n\t\t// ===========================================================================================\n\t\t// 2016/09/22 ryuring\n\t\t// PHP 7.0.8 \u74b0\u5883\u306b\u3066\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u4e00\u89a7\u8ffd\u52a0\u6642\u3001\u691c\u7d22\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306e\u70ba\u3001BcContentsComponent \u304c\n\t\t// \u547c\u3073\u51fa\u3055\u308c\u308b\u304c\u3001\u305d\u306e\u969b\u3001\u30e2\u30c7\u30eb\u306e\u30de\u30b8\u30c3\u30af\u30e1\u30bd\u30c3\u30c9\u306e\u623b\u308a\u5024\u3092\u8fd4\u3059\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u51e6\u7406\u304c\u30b9\u30c8\u30c3\u30d7\u3057\u3066\u3057\u307e\u3046\u3002\n\t\t// \u305d\u306e\u70ba\u3001\u30d3\u30d8\u30a4\u30d3\u30a2\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u76f4\u63a5\u5b9f\u884c\u3057\u3066\u5bfe\u51e6\u3057\u305f\u3002\n\t\t// CakePHP\u3082\u3001PHP\u81ea\u4f53\u306e\u30a8\u30e9\u30fc\u3082\u767a\u751f\u305b\u305a\u3001\u305f\u3060\u6b62\u307e\u308b\u3002PHP7\u306e\u30d0\u30b0\uff1fPHP\u5074\u306e\u30e1\u30e2\u30ea\u30fc\u3092256M\u306b\u3057\u3066\u3082\u5909\u308f\u3089\u305a\u3002\n\t\t// ===========================================================================================\n\t\t$contents = $this->_Controller->Content->Behaviors->Tree->getPath($this->_Controller->Content, $id, [], -1);\n\t\tunset($contents[count($contents) - 1]);\n\t\t$crumbs = [];\n\t\tforeach($contents as $content) {\n\t\t\tif (!$content['Content']['site_root']) {\n\t\t\t\t$crumb = [\n\t\t\t\t\t'name' => $content['Content']['title'],\n\t\t\t\t\t'url' => $content['Content']['url']\n\t\t\t\t];\n\t\t\t\t$crumbs[] = $crumb;\n\t\t\t}\n\t\t}\n\t\treturn $crumbs;\n\t}\n\n\t/**\n\t * Content \u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\n\t *\n\t * @param int $entityId\n\t * @return array\n\t */\n\tpublic function getContent($entityId = null)\n\t{\n\t\treturn $this->_Controller->Content->findByType($this->type, $entityId);\n\t}\n\n\t/**\n\t * Before render\n\t *\n\t * @param Controller $controller\n\t * @return void\n\t */\n\tpublic function beforeRender(Controller $controller)\n\t{\n\t\tparent::beforeRender($controller);\n\t\tif (BcUtil::isAdminSystem()) {\n\t\t\t$controller->set('contentsSettings', $this->settings['items']);\n\t\t\t// \u30d1\u30f3\u304f\u305a\u3092\u30bb\u30c3\u30c8\n\t\t\tarray_unshift($controller->crumbs, ['name' => __d('baser', '\u30b3\u30f3\u30c6\u30f3\u30c4\u4e00\u89a7'), 'url' => ['plugin' => null, 'controller' => 'contents', 'action' => 'index']]);\n\t\t\tif ($controller->subMenuElements && !in_array('contents', $controller->subMenuElements)) {\n\t\t\t\tarray_unshift($controller->subMenuElements, 'contents');\n\t\t\t} else {\n\t\t\t\t$controller->subMenuElements = ['contents'];\n\t\t\t}\n\t\t\tif ($this->useForm && in_array($controller->request->action, [$this->editAction, $this->addAction, 'admin_edit_alias']) && !empty($controller->request->data['Content'])) {\n\t\t\t\t$siteId = 0;\n\t\t\t\t$id = null;\n\t\t\t\tif($controller->request->data('Content.site_id')) {\n\t\t\t\t\t$siteId = $controller->request->data('Content.site_id');\n\t\t\t\t}\n\t\t\t\tif($controller->request->data('Content.id')) {\n\t\t\t\t\t$id = $controller->request->data('Content.id');\n\t\t\t\t}\n\t\t\t\t// \u30d5\u30a9\u30fc\u30e0\u3092\u30bb\u30c3\u30c8\n\t\t\t\t$this->settingForm($controller, $siteId, $id);\n\t\t\t\t// \u30d5\u30a9\u30fc\u30e0\u3092\u8aad\u307f\u8fbc\u3080\u70ba\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u8a2d\u5b9a\n\t\t\t\t// \u5185\u90e8\u3067 useForm \u3092\u53c2\u7167\u3067\u304d\u306a\u3044\u70ba\u3001\u3053\u3053\u306b\u8a18\u8ff0\u3002\n\t\t\t\t// \u30d5\u30a9\u30fc\u30e0\u306e\u8a2d\u5b9a\u3057\u304b\u3067\u304d\u306a\u3044\u30a4\u30d9\u30f3\u30c8\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u3002\n\t\t\t\t// TODO \u6539\u5584\u8981\n\t\t\t\tApp::uses('BcContentsEventListener', 'Event');\n\t\t\t\tCakeEventManager::instance()->attach(new BcContentsEventListener());\n\t\t\t}\n\t\t} else {\n\t\t\t// \u30d3\u30e5\u30fc\u30ad\u30e3\u30c3\u30b7\u30e5\u8a2d\u5b9a\n\t\t\tif (empty($controller->request->query['preview'])) {\n\t\t\t\t// @deprecated 5.0.0 since 4.0.0\n\t\t\t\t//\tCakePHP3\u3067\u306f\u3001\u30d3\u30e5\u30fc\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u5ec3\u6b62\u3068\u306a\u308b\u70ba\u3001\u5225\u306e\u65b9\u6cd5\u306b\u79fb\u884c\u3059\u308b\n\t\t\t\tif ($this->useViewCache && !BcUtil::loginUser('admin') && !isConsole() && !empty($controller->request->params['Content'])) {\n\t\t\t\t\t$controller->helpers[] = 'BcCache';\n\t\t\t\t\t// php 8\u7cfb\u3067\u306f'+5 min'\u306a\u3069\u3001string\u578b\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u305f\u5834\u5408\u30015\u5206\u5f8c\u3068\u5224\u5b9a\u3055\u308c\u306a\u3044\u554f\u984c\u3092\u89e3\u6d88\n\t\t\t\t\t$cacheTime = $controller->Content->getCacheTime($controller->request->params['Content']);\n\t\t\t\t\t$controller->cacheAction = is_numeric($cacheTime) ? $cacheTime : strtotime($cacheTime) - time();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\n\t/**\n\t * \u30b3\u30f3\u30c6\u30f3\u30c4\u4fdd\u5b58\u30d5\u30a9\u30fc\u30e0\u3092\u8a2d\u5b9a\u3059\u308b\n\t *\n\t * @param Controller $controller\n\t * @return void\n\t */\n\tpublic function settingForm(Controller $controller, $currentSiteId, $currentContentId = null)\n\t{\n\n\t\t// \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30bd\u30fc\u30b9\u3092\u8a2d\u5b9a\n\t\t$options = [];\n\t\tif ($controller->name == 'ContentFolders') {\n\t\t\t$options['excludeId'] = $currentContentId;\n\t\t}\n\t\t$data = $controller->request->data;\n\n\t\t$theme = $this->_Controller->siteConfigs['theme'];\n\t\t$site = BcSite::findById($data['Content']['site_id']);\n\t\tif ($site->theme) {\n\t\t\t$theme = $site->theme;\n\t\t}\n\t\t$templates = array_merge(\n\t\t\tBcUtil::getTemplateList('Layouts', '', $theme),\n\t\t\tBcUtil::getTemplateList('Layouts', $this->_Controller->plugin, $theme)\n\t\t);\n\t\tif (!empty($data['Content']['id']) && $data['Content']['id'] != 1) {\n\t\t\t$parentTemplate = $this->getParentLayoutTemplate($data['Content']['id']);\n\t\t\tif (in_array($parentTemplate, $templates)) {\n\t\t\t\tunset($templates[$parentTemplate]);\n\t\t\t}\n\t\t\tarray_unshift($templates, ['' => __d('baser', '\u89aa\u30d5\u30a9\u30eb\u30c0\u306e\u8a2d\u5b9a\u306b\u5f93\u3046') . '\uff08' . $parentTemplate . '\uff09']);\n\t\t}\n\t\t$data['Content']['name'] = urldecode($data['Content']['name']);\n\t\tif (Configure::read('BcApp.autoUpdateContentCreatedDate')) {\n\t\t\t$data['Content']['modified_date'] = date('Y-m-d H:i:s');\n\t\t}\n\t\t$controller->set('layoutTemplates', $templates);\n\t\t$controller->set('parentContents', $controller->Content->getContentFolderList($currentSiteId, $options));\n\t\t$controller->set('authors', $controller->User->getUserList());\n\t\t$Site = ClassRegistry::init('Site');\n\t\tif(!empty($data['Content']['id'])) {\n\t\t\t$site = $controller->Content->find('first', ['conditions' => ['Content.id' => $data['Content']['id']]]);\n\t\t\t$relatedContents = $Site->getRelatedContents($data['Content']['id']);\n\t\t} else {\n\t\t\t$site = $controller->Content->find('first', ['conditions' => ['Content.id' => $data['Content']['parent_id']]]);\n\t\t\t$relatedContents = [];\n\t\t}\n\t\tif (!is_null($site['Site']['main_site_id'])) {\n\t\t\t$mainSiteId = $site['Site']['main_site_id'];\n\t\t} else {\n\t\t\t$mainSiteId = 0;\n\t\t}\n\n\t\t$siteList = [0 => ''] + $controller->Content->Site->find('list', ['fields' => ['id', 'display_name']]);\n\t\t$controller->set('sites', $siteList);\n\t\t$controller->set('mainSiteDisplayName', $controller->siteConfigs['main_site_display_name']);\n\t\t$data['Site'] = $site['Site'];\n\t\t$controller->set('mainSiteId', $mainSiteId);\n\t\t$controller->set('relatedContents', $relatedContents);\n\t\t$related = false;\n\t\tif (($data['Site']['relate_main_site'] && $data['Content']['main_site_content_id'] && $data['Content']['alias_id']) ||\n\t\t\t$data['Site']['relate_main_site'] && $data['Content']['main_site_content_id'] && $data['Content']['type'] == 'ContentFolder') {\n\t\t\t$related = true;\n\t\t}\n\t\t$controller->request->data = $data;\n\t\t$currentSiteId = $siteId = $controller->request->data['Site']['id'];\n\t\tif (is_null($currentSiteId)) {\n\t\t\t$currentSiteId = 0;\n\t\t}\n\t\t$controller->set('currentSiteId', $currentSiteId);\n\t\t$controller->set('related', $related);\n\t}\n\n\t/**\n\t * \u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u53d6\u5f97\u3059\u308b\n\t *\n\t * @param $id\n\t * @return string $parentTemplate|false\n\t */\n\tpublic function getParentLayoutTemplate($id)\n\t{\n\t\tif (!$id) {\n\t\t\treturn false;\n\t\t}\n\t\t// ===========================================================================================\n\t\t// 2016/09/22 ryuring\n\t\t// PHP 7.0.8 \u74b0\u5883\u306b\u3066\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u4e00\u89a7\u8ffd\u52a0\u6642\u3001\u691c\u7d22\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306e\u70ba\u3001BcContentsComponent \u304c\n\t\t// \u547c\u3073\u51fa\u3055\u308c\u308b\u304c\u3001\u305d\u306e\u969b\u3001\u30e2\u30c7\u30eb\u306e\u30de\u30b8\u30c3\u30af\u30e1\u30bd\u30c3\u30c9\u306e\u623b\u308a\u5024\u3092\u8fd4\u3059\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u51e6\u7406\u304c\u30b9\u30c8\u30c3\u30d7\u3057\u3066\u3057\u307e\u3046\u3002\n\t\t// \u305d\u306e\u70ba\u3001\u30d3\u30d8\u30a4\u30d3\u30a2\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u76f4\u63a5\u5b9f\u884c\u3057\u3066\u5bfe\u51e6\u3057\u305f\u3002\n\t\t// CakePHP\u3082\u3001PHP\u81ea\u4f53\u306e\u30a8\u30e9\u30fc\u3082\u767a\u751f\u305b\u305a\u3001\u305f\u3060\u6b62\u307e\u308b\u3002PHP7\u306e\u30d0\u30b0\uff1fPHP\u5074\u306e\u30e1\u30e2\u30ea\u30fc\u3092256M\u306b\u3057\u3066\u3082\u5909\u308f\u3089\u305a\u3002\n\t\t// ===========================================================================================\n\t\t$contents = $this->_Controller->Content->Behaviors->Tree->getPath($this->_Controller->Content, $id);\n\t\t$contents = array_reverse($contents);\n\t\tunset($contents[0]);\n\t\tif (!$contents) {\n\t\t\treturn false;\n\t\t}\n\t\t$parentTemplates = Hash::extract($contents, '{n}.Content.layout_template');\n\t\tforeach($parentTemplates as $parentTemplate) {\n\t\t\tif ($parentTemplate) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn $parentTemplate;\n\t}\n\n\t/**\n\t * \u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30bf\u30a4\u30d7\u306e\u4e00\u89a7\u3092\u53d6\u5f97\u3059\u308b\n\t *\n\t * @return array\n\t */\n\tpublic function getTypes()\n\t{\n\t\t$types = [];\n\t\tforeach($this->settings['items'] as $key => $value) {\n\t\t\t$types[$key] = $value['title'];\n\t\t}\n\t\treturn $types;\n\t}\n\n}\n"], "filenames": ["lib/Baser/Controller/Component/BcContentsComponent.php"], "buggy_code_start_loc": [143], "buggy_code_end_loc": [144], "fixing_code_start_loc": [142], "fixing_code_end_loc": [142], "type": "CWE-352", "message": "baserCMS is a website development framework. Prior to version 4.8.0, there is a cross site request forgery vulnerability in the content preview feature of baserCMS. Version 4.8.0 contains a patch for this issue.", "other": {"cve": {"id": "CVE-2023-43649", "sourceIdentifier": "security-advisories@github.com", "published": "2023-10-30T19:15:08.257", "lastModified": "2023-11-06T19:37:27.737", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "baserCMS is a website development framework. Prior to version 4.8.0, there is a cross site request forgery vulnerability in the content preview feature of baserCMS. Version 4.8.0 contains a patch for this issue."}, {"lang": "es", "value": "baserCMS es un framework de desarrollo de sitios web. Antes de la versi\u00f3n 4.8.0, hab\u00eda una vulnerabilidad de Cross-Site Request Forgery (CSRF) en la funci\u00f3n de vista previa de contenido de baserCMS. La versi\u00f3n 4.8.0 contiene un parche para este problema."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 4.7, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.2, "impactScore": 3.4}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:basercms:basercms:*:*:*:*:*:*:*:*", "versionEndExcluding": "4.8.0", "matchCriteriaId": "3B92C5C4-A119-435E-95BF-F6595C49737C"}]}]}], "references": [{"url": "https://basercms.net/security/JVN_99052047", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}, {"url": "https://github.com/baserproject/basercms/commit/874c55433fead93e0be9df96fd28740f8047c8b6", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/baserproject/basercms/security/advisories/GHSA-fw9x-cqjq-7jx5", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/baserproject/basercms/commit/874c55433fead93e0be9df96fd28740f8047c8b6"}}