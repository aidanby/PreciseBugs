{"buggy_code": ["/**\n * @jest-environment jsdom\n */\n\nimport { sanitize } from '../src';\n\ndescribe('sanitizer', () => {\n  it('wraps contents in a div', () => {\n    expect(\n      sanitize('<span>test</span>', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><span>test</span></div>');\n  });\n\n  it('removes non-whitelisted tags while preserving their contents', () => {\n    expect(sanitize('<b>test</b><test>test</test>', '', { id: 'test' })).toBe(\n      '<div id=\"test\"><b>test</b>test</div>'\n    );\n\n    expect(\n      sanitize(\n        '<b>test</b><table><test>test</test><thead><tr><th>test</th></tr></thead></table>',\n        '',\n        { id: 'test' }\n      )\n    ).toBe(\n      '<div id=\"test\"><b>test</b>test<table><thead><tr><th>test</th></tr></thead></table></div>'\n    );\n  });\n\n  it('removes non-whitelisted attributes', () => {\n    expect(\n      sanitize('<img onerror=\"alert(\\'XSS\\')\" src=\"invalid:\" />', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><img></div>');\n  });\n\n  it('removes non-whitelisted CSS properties', () => {\n    expect(\n      sanitize('<span style=\"pointer-events: all;\">test</span>', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><span style=\"\">test</span></div>');\n  });\n\n  it('removes blacklisted tags and their contents', () => {\n    expect(\n      sanitize('<b>test</b><script>test</script>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(\n      sanitize('<b>test</b><noscript>test</noscript>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(\n      sanitize('<b>test</b><noembed>test</noembed>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(\n      sanitize('<b>test</b><iframe>test</iframe>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(\n      sanitize('<b>test</b><textarea>test</textarea>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(sanitize('<b>test</b><title>test</title>', '', { id: 'test' })).toBe(\n      '<div id=\"test\"><b>test</b></div>'\n    );\n    expect(sanitize('<b>test</b><svg><rect /></svg>', '', { id: 'test' })).toBe(\n      '<div id=\"test\"><b>test</b></div>'\n    );\n  });\n\n  it('rewrites URLs on <a> elements', () => {\n    expect(\n      sanitize('<a href=\"https://example.com/\"></a>', '', {\n        id: 'test',\n        rewriteExternalLinks: (url: String) => './redirect?url=' + url,\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"./redirect?url=https://example.com/\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n  });\n\n  it('rewrites URLs on CSS url()', () => {\n    expect(\n      sanitize(\n        '<span style=\"background: url(\\'https://example.com/image.jpg\\')\"></span>',\n        '',\n        {\n          id: 'test',\n          rewriteExternalResources: (url: String) => './redirect?url=' + url,\n        }\n      )\n    ).toBe(\n      '<div id=\"test\"><span style=\"background: url(./redirect?url=https://example.com/image.jpg);\"></span></div>'\n    );\n  });\n\n  it('removes non-whitelisted URL schemas', () => {\n    expect(\n      sanitize('<a href=\"ftp://test.com\"></a>', '', {\n        id: 'test',\n      })\n    ).toBe(\n      '<div id=\"test\"><a rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize(\n        '<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\" />',\n        '',\n        {\n          id: 'test',\n        }\n      )\n    ).toBe('<div id=\"test\"><img></div>');\n  });\n\n  it(\"doesn't remove whitelisted URL schemas\", () => {\n    expect(\n      sanitize('<a href=\"http://test.com\"></a>', '', {\n        id: 'test',\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"http://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<img src=\"https://example.com/img.png\" />', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><img src=\"https://example.com/img.png\"></div>');\n\n    expect(\n      sanitize('<a href=\"mailto:test@example.com\"></a>', '', {\n        id: 'test',\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"mailto:test@example.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n  });\n\n  it('allows URL schemas specified in allowedSchemas', () => {\n    expect(\n      sanitize('<a href=\"http://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['http'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"http://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize(\n        '<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\" />',\n        '',\n        {\n          id: 'test',\n          allowedSchemas: ['data'],\n        }\n      )\n    ).toBe(\n      '<div id=\"test\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\"></div>'\n    );\n  });\n\n  it('all schemas specified in allowedSchemas are case-insensitive', () => {\n    expect(\n      sanitize('<a href=\"HTTP://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['http'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"HTTP://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<a href=\"http://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['HTTP'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"http://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<a href=\"htTP://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['HTTP'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"htTP://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<a href=\"HTtp://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['http'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"HTtp://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n  });\n\n  it('adds rel=\"noopener noreferrer\" to <a> (and only <a>)', () => {\n    expect(\n      sanitize('<a></a>', '', {\n        id: 'test',\n      })\n    ).toBe(\n      '<div id=\"test\"><a rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<img />', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><img></div>');\n  });\n\n  it('formats raw text', () => {\n    expect(\n      sanitize('', 'test', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><p>test</p></div>');\n    expect(\n      sanitize('', 'test\\ntest', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><p>test</p>\\n<p>test</p></div>');\n  });\n\n  it('moves styles from <head> to <body>', () => {\n    expect(\n      sanitize(\n        '<html><head><style>p {color: red;}</style></head><body></body></html>',\n        '',\n        {\n          id: 'test',\n        }\n      )\n    ).toBe('<div id=\"test\"><style>#test p {color: red;}</style></div>');\n  });\n\n  it('removes comments', () => {\n    expect(\n      sanitize('<div><!-- hello --></div>', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><div></div></div>');\n  });\n\n  it('removes wrapper div when noWrapper is enabled', () => {\n    expect(\n      sanitize('<div class=\"foo\"></div>', '', {\n        noWrapper: true,\n      })\n    ).toBe('<div class=\"foo\"></div>');\n  });\n\n  it('prefixes ids and classes in CSS', () => {\n    expect(\n      sanitize(\n        `<style>a {background: red !important;}\n.test {background: red;}\n#test {background: red;}</style>`,\n        '',\n        { id: 'test' }\n      )\n    ).toBe(`<div id=\"test\"><style>#test a {background: red !important;}\n#test .test_test {background: red;}\n#test #test_test {background: red;}</style></div>`);\n  });\n\n  it('preserves CSS priority', () => {\n    expect(\n      sanitize(\n        `<style>a {background: red !important;}\nb {background: red;}</style>`,\n        '',\n        { noWrapper: true }\n      )\n    ).toBe(`<style>a {background: red !important;}\nb {background: red;}</style>`);\n  });\n\n  it('drops !important when preserveCssPriority is set to false', () => {\n    expect(\n      sanitize(\n        `<style>a {background: red !important;}\nb {background: red;}</style>`,\n        '',\n        { noWrapper: true, preserveCssPriority: false }\n      )\n    ).toBe(`<style>a {background: red;}\nb {background: red;}</style>`);\n  });\n});\n", "import {\n  allowedTags,\n  allowedCssProperties,\n  removeWithContents,\n} from './constants';\n\nexport interface SanitizerOptions {\n  /**\n   * Wrapper element id.\n   */\n  id?: string;\n\n  /**\n   * Removes all HTML tags from the contents.\n   */\n  dropAllHtmlTags?: boolean;\n\n  /**\n   * Replaces CSS url() and src= attribute values with return values of this function.\n   */\n  rewriteExternalResources?: (url: string) => string;\n\n  /**\n   * Replaces href= attribute values with return values of this function.\n   */\n  rewriteExternalLinks?: (url: string) => string;\n\n  /**\n   * Allowed schemas, default: ['http', 'https', 'mailto'].\n   */\n  allowedSchemas?: string[];\n\n  /**\n   * Remove wrapper <div> from the output, default: false.\n   */\n  noWrapper?: boolean;\n\n  /**\n   * Preserves CSS priority (!important), default: true.\n   */\n  preserveCssPriority?: boolean;\n}\n\nfunction prependIdToSelectorText(selectorText: string, id: string) {\n  if (!id) return selectorText;\n  return selectorText\n    .split(',')\n    .map(selector => selector.trim())\n    .map(selector => {\n      const s = selector\n        .replace(/\\./g, '.' + id + '_')\n        .replace(/#/g, '#' + id + '_');\n      if (s.toLowerCase().startsWith('body')) {\n        return '#' + id + ' ' + s.substring(4);\n      } else {\n        return '#' + id + ' ' + s;\n      }\n    })\n    .join(',');\n}\n\nfunction sanitizeCssValue(\n  cssValue: string,\n  allowedSchemas: string[],\n  rewriteExternalResources?: (url: string) => string\n) {\n  return cssValue\n    .trim()\n    .replace(/expression\\((.*?)\\)/g, '')\n    .replace(/url\\([\"']?(.*?)[\"']?\\)/g, (match, url) => {\n      let quote = '';\n      if (match.startsWith('url(\"')) {\n        quote = '\"';\n      } else if (match.startsWith(\"url('\")) {\n        quote = \"'\";\n      }\n\n      if (allowedSchemas.includes(url.toLowerCase().split(':')[0])) {\n        if (rewriteExternalResources) {\n          return 'url(' + quote + rewriteExternalResources(url) + quote + ')';\n        } else {\n          return match;\n        }\n      } else {\n        return '';\n      }\n    });\n}\n\nfunction sanitizeCssStyle(\n  style: CSSStyleDeclaration | undefined,\n  allowedSchemas: string[],\n  preserveCssPriority: boolean,\n  rewriteExternalResources?: (url: string) => string\n) {\n  if (!style) {\n    return;\n  }\n\n  const properties: string[] = [];\n\n  for (let i = 0; i < style.length; i++) {\n    const name = style[i];\n    properties.push(name);\n  }\n\n  for (const name of properties) {\n    if (allowedCssProperties.includes(name)) {\n      const value = style.getPropertyValue(name);\n      style.setProperty(\n        name,\n        sanitizeCssValue(value, allowedSchemas, rewriteExternalResources),\n        preserveCssPriority ? style.getPropertyPriority(name) : undefined\n      );\n    } else {\n      style.removeProperty(name);\n    }\n  }\n}\n\nfunction sanitizeCssRule(\n  rule: CSSStyleRule,\n  id: string,\n  allowedSchemas: string[],\n  preserveCssPriority: boolean,\n  rewriteExternalResources?: (url: string) => string\n) {\n  rule.selectorText = prependIdToSelectorText(rule.selectorText, id);\n  sanitizeCssStyle(\n    rule.style,\n    allowedSchemas,\n    preserveCssPriority,\n    rewriteExternalResources\n  );\n}\n\nconst defaultAllowedSchemas = ['http', 'https', 'mailto'];\n\nfunction sanitizeHtml(\n  input: string,\n  {\n    dropAllHtmlTags = false,\n    rewriteExternalLinks,\n    rewriteExternalResources,\n    id = 'msg_' +\n      String.fromCharCode(\n        ...new Array(24)\n          .fill(undefined)\n          .map(() => ((Math.random() * 25) % 25) + 65)\n      ),\n    allowedSchemas = defaultAllowedSchemas,\n    preserveCssPriority = true,\n    noWrapper = false,\n  }: SanitizerOptions\n): string {\n  if (noWrapper) id = '';\n  const doc = new DOMParser().parseFromString(input, 'text/html');\n\n  // Ensure allowed schemas are lower case.\n  allowedSchemas = Array.isArray(allowedSchemas)\n    ? allowedSchemas.map(schema => schema.toLowerCase())\n    : defaultAllowedSchemas;\n\n  // Remove comments.\n  const commentIter = doc.createNodeIterator(\n    doc.documentElement,\n    NodeFilter.SHOW_COMMENT\n  );\n\n  let node: Node | null;\n  while ((node = commentIter.nextNode())) {\n    node.parentNode?.removeChild(node);\n  }\n\n  const removeTags = [...removeWithContents];\n  if (dropAllHtmlTags) {\n    removeTags.push('style');\n  }\n\n  // Remove disallowed tags.\n  const disallowedList = doc.querySelectorAll(removeTags.join(', '));\n  disallowedList.forEach(element => element.remove());\n\n  // Move styles from head to body.\n  const styleList = doc.querySelectorAll('head > style');\n  styleList.forEach(element => {\n    doc.body.appendChild(element);\n  });\n\n  // Filter other tags.\n  const toRemove: Element[] = [];\n  const elementIter = doc.createNodeIterator(\n    doc.body,\n    NodeFilter.SHOW_ELEMENT,\n    {\n      acceptNode: () => {\n        return NodeFilter.FILTER_ACCEPT;\n      },\n    }\n  );\n\n  while ((node = elementIter.nextNode())) {\n    const element = node as HTMLElement;\n    const tagName = element.tagName.toLowerCase();\n    if (tagName === 'body' || tagName === 'html') {\n      continue;\n    }\n\n    if (dropAllHtmlTags) {\n      if (node.textContent) {\n        const textNode = doc.createTextNode(node.textContent);\n        node.parentNode?.replaceChild(textNode, node);\n      } else {\n        node.parentNode?.removeChild(node);\n      }\n\n      continue;\n    }\n\n    if (tagName in allowedTags) {\n      const allowedAttributes = allowedTags[tagName];\n      for (const attribute of element.getAttributeNames()) {\n        if (!allowedAttributes.includes(attribute)) {\n          element.removeAttribute(attribute);\n        } else if (attribute === 'class' && !noWrapper) {\n          element.setAttribute(\n            attribute,\n            element\n              .getAttribute(attribute)\n              ?.split(' ')\n              .map(className => id + '_' + className)\n              .join(' ') ?? ''\n          );\n        } else if (attribute === 'id' && !noWrapper) {\n          element.setAttribute(\n            attribute,\n            id + '_' + (element.getAttribute(attribute) ?? '')\n          );\n        } else if (attribute === 'href' || attribute === 'src') {\n          const value = element.getAttribute(attribute) ?? '';\n          if (!allowedSchemas.includes(value.toLowerCase().split(':')[0])) {\n            element.removeAttribute(attribute);\n          } else if (attribute === 'href' && rewriteExternalLinks) {\n            element.setAttribute(attribute, rewriteExternalLinks(value));\n          } else if (attribute === 'src' && rewriteExternalResources) {\n            element.setAttribute(attribute, rewriteExternalResources(value));\n          }\n        }\n      }\n\n      // Sanitize CSS.\n      sanitizeCssStyle(\n        element.style,\n        allowedSchemas,\n        preserveCssPriority,\n        rewriteExternalResources\n      );\n\n      if (tagName === 'a') {\n        // Add rel=\"noopener noreferrer\" to <a>\n        element.setAttribute('rel', 'noopener noreferrer');\n\n        // Add target=\"_blank\" to <a>\n        element.setAttribute('target', '_blank');\n      }\n    } else {\n      element.insertAdjacentHTML('afterend', element.innerHTML);\n      toRemove.push(element);\n    }\n  }\n\n  for (const element of toRemove) {\n    try {\n      try {\n        element.parentNode?.removeChild(element);\n      } catch {\n        element.outerHTML = '';\n      }\n    } catch {\n      try {\n        element.remove();\n      } catch {}\n    }\n  }\n\n  // Prepend wrapper ID.\n  const bodyStyleList = doc.querySelectorAll('body style');\n  bodyStyleList.forEach(element => {\n    const styleElement = element as HTMLStyleElement;\n    const stylesheet = styleElement.sheet as CSSStyleSheet;\n    const newRules: CSSRule[] = [];\n\n    if (!stylesheet.cssRules) {\n      styleElement.textContent = '';\n      return;\n    }\n\n    for (let i = 0; i < stylesheet.cssRules.length; i++) {\n      const rule = stylesheet.cssRules[i] as CSSStyleRule;\n\n      if ('selectorText' in rule) {\n        sanitizeCssRule(\n          rule,\n          id,\n          allowedSchemas,\n          preserveCssPriority,\n          rewriteExternalResources\n        );\n        newRules.push(rule);\n      } else if ('cssRules' in rule) {\n        const mediaRule = (rule as any) as CSSMediaRule;\n        const newRulesMedia: CSSRule[] = [];\n\n        for (let i = 0; i < mediaRule.cssRules.length; i++) {\n          const rule = mediaRule.cssRules[i] as CSSStyleRule;\n\n          if (rule.type === rule.STYLE_RULE) {\n            sanitizeCssRule(\n              rule,\n              id,\n              allowedSchemas,\n              preserveCssPriority,\n              rewriteExternalResources\n            );\n            newRulesMedia.push(rule);\n          }\n        }\n\n        while (mediaRule.cssRules.length > 0) {\n          mediaRule.deleteRule(0);\n        }\n\n        for (const rule of newRulesMedia) {\n          mediaRule.insertRule(rule.cssText, mediaRule.cssRules.length);\n        }\n\n        newRules.push(mediaRule);\n      }\n    }\n\n    styleElement.textContent = newRules.map(rule => rule.cssText).join('\\n');\n  });\n\n  // Wrap body inside of a div with the generated ID.\n  if (noWrapper) {\n    return doc.body.innerHTML;\n  } else {\n    const div = doc.createElement('div');\n    div.id = id;\n    div.innerHTML = doc.body.innerHTML;\n    return div.outerHTML;\n  }\n}\n\nfunction sanitizeText(text: string) {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport function sanitize(\n  html: string,\n  text?: string,\n  options?: SanitizerOptions\n): string {\n  let contents = html ?? '';\n  if (contents?.length === 0 && text) {\n    contents = sanitizeText(text)\n      .split('\\n')\n      .map(line => '<p>' + line + '</p>')\n      .join('\\n');\n  }\n\n  return sanitizeHtml(contents, options ?? {});\n}\n"], "fixing_code": ["/**\n * @jest-environment jsdom\n */\n\nimport { sanitize } from '../src';\n\ndescribe('sanitizer', () => {\n  it('wraps contents in a div', () => {\n    expect(\n      sanitize('<span>test</span>', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><span>test</span></div>');\n  });\n\n  it('removes non-whitelisted tags while preserving their contents', () => {\n    expect(sanitize('<b>test</b><test>test</test>', '', { id: 'test' })).toBe(\n      '<div id=\"test\"><b>test</b>test</div>'\n    );\n\n    expect(\n      sanitize(\n        '<b>test</b><table><test>test</test><thead><tr><th>test</th></tr></thead></table>',\n        '',\n        { id: 'test' }\n      )\n    ).toBe(\n      '<div id=\"test\"><b>test</b>test<table><thead><tr><th>test</th></tr></thead></table></div>'\n    );\n  });\n\n  it('removes non-whitelisted attributes', () => {\n    expect(\n      sanitize('<img onerror=\"alert(\\'XSS\\')\" src=\"invalid:\" />', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><img></div>');\n  });\n\n  it('removes non-whitelisted CSS properties', () => {\n    expect(\n      sanitize('<span style=\"pointer-events: all;\">test</span>', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><span style=\"\">test</span></div>');\n  });\n\n  it('removes blacklisted tags and their contents', () => {\n    expect(\n      sanitize('<b>test</b><script>test</script>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(\n      sanitize('<b>test</b><noscript>test</noscript>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(\n      sanitize('<b>test</b><noembed>test</noembed>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(\n      sanitize('<b>test</b><iframe>test</iframe>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(\n      sanitize('<b>test</b><textarea>test</textarea>', '', { id: 'test' })\n    ).toBe('<div id=\"test\"><b>test</b></div>');\n    expect(sanitize('<b>test</b><title>test</title>', '', { id: 'test' })).toBe(\n      '<div id=\"test\"><b>test</b></div>'\n    );\n    expect(sanitize('<b>test</b><svg><rect /></svg>', '', { id: 'test' })).toBe(\n      '<div id=\"test\"><b>test</b></div>'\n    );\n  });\n\n  it('rewrites URLs on <a> elements', () => {\n    expect(\n      sanitize('<a href=\"https://example.com/\"></a>', '', {\n        id: 'test',\n        rewriteExternalLinks: (url: String) => './redirect?url=' + url,\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"./redirect?url=https://example.com/\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n  });\n\n  it('rewrites URLs on CSS url()', () => {\n    expect(\n      sanitize(\n        '<span style=\"background: url(\\'https://example.com/image.jpg\\')\"></span>',\n        '',\n        {\n          id: 'test',\n          rewriteExternalResources: (url: String) => './redirect?url=' + url,\n        }\n      )\n    ).toBe(\n      '<div id=\"test\"><span style=\"background: url(./redirect?url=https://example.com/image.jpg);\"></span></div>'\n    );\n  });\n\n  it('removes non-whitelisted URL schemas', () => {\n    expect(\n      sanitize('<a href=\"ftp://test.com\"></a>', '', {\n        id: 'test',\n      })\n    ).toBe(\n      '<div id=\"test\"><a rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize(\n        '<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\" />',\n        '',\n        {\n          id: 'test',\n        }\n      )\n    ).toBe('<div id=\"test\"><img></div>');\n  });\n\n  it(\"doesn't remove whitelisted URL schemas\", () => {\n    expect(\n      sanitize('<a href=\"http://test.com\"></a>', '', {\n        id: 'test',\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"http://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<img src=\"https://example.com/img.png\" />', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><img src=\"https://example.com/img.png\"></div>');\n\n    expect(\n      sanitize('<a href=\"mailto:test@example.com\"></a>', '', {\n        id: 'test',\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"mailto:test@example.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n  });\n\n  it('allows URL schemas specified in allowedSchemas', () => {\n    expect(\n      sanitize('<a href=\"http://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['http'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"http://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize(\n        '<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\" />',\n        '',\n        {\n          id: 'test',\n          allowedSchemas: ['data'],\n        }\n      )\n    ).toBe(\n      '<div id=\"test\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\"></div>'\n    );\n  });\n\n  it('all schemas specified in allowedSchemas are case-insensitive', () => {\n    expect(\n      sanitize('<a href=\"HTTP://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['http'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"HTTP://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<a href=\"http://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['HTTP'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"http://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<a href=\"htTP://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['HTTP'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"htTP://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<a href=\"HTtp://test.com\"></a>', '', {\n        id: 'test',\n        allowedSchemas: ['http'],\n      })\n    ).toBe(\n      '<div id=\"test\"><a href=\"HTtp://test.com\" rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n  });\n\n  it('adds rel=\"noopener noreferrer\" to <a> (and only <a>)', () => {\n    expect(\n      sanitize('<a></a>', '', {\n        id: 'test',\n      })\n    ).toBe(\n      '<div id=\"test\"><a rel=\"noopener noreferrer\" target=\"_blank\"></a></div>'\n    );\n\n    expect(\n      sanitize('<img />', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><img></div>');\n  });\n\n  it('formats raw text', () => {\n    expect(\n      sanitize('', 'test', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><p>test</p></div>');\n    expect(\n      sanitize('', 'test\\ntest', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><p>test</p>\\n<p>test</p></div>');\n  });\n\n  it('moves styles from <head> to <body>', () => {\n    expect(\n      sanitize(\n        '<html><head><style>p {color: red;}</style></head><body></body></html>',\n        '',\n        {\n          id: 'test',\n        }\n      )\n    ).toBe('<div id=\"test\"><style>#test p {color: red;}</style></div>');\n  });\n\n  it('removes comments', () => {\n    expect(\n      sanitize('<div><!-- hello --></div>', '', {\n        id: 'test',\n      })\n    ).toBe('<div id=\"test\"><div></div></div>');\n  });\n\n  it('removes wrapper div when noWrapper is enabled', () => {\n    expect(\n      sanitize('<div class=\"foo\"></div>', '', {\n        noWrapper: true,\n      })\n    ).toBe('<div class=\"foo\"></div>');\n  });\n\n  it('prefixes ids and classes in CSS', () => {\n    expect(\n      sanitize(\n        `<style>a {background: red !important;}\n.test {background: red;}\n#test {background: red;}</style>`,\n        '',\n        { id: 'test' }\n      )\n    ).toBe(`<div id=\"test\"><style>#test a {background: red !important;}\n#test .test_test {background: red;}\n#test #test_test {background: red;}</style></div>`);\n  });\n\n  it('preserves CSS priority', () => {\n    expect(\n      sanitize(\n        `<style>a {background: red !important;}\nb {background: red;}</style>`,\n        '',\n        { noWrapper: true }\n      )\n    ).toBe(`<style>a {background: red !important;}\nb {background: red;}</style>`);\n  });\n\n  it('drops !important when preserveCssPriority is set to false', () => {\n    expect(\n      sanitize(\n        `<style>a {background: red !important;}\nb {background: red;}</style>`,\n        '',\n        { noWrapper: true, preserveCssPriority: false }\n      )\n    ).toBe(`<style>a {background: red;}\nb {background: red;}</style>`);\n  });\n\n  it('removes @keyframes rules from CSS', () => {\n    expect(\n      sanitize(\n        `<style>@keyframes test {\n          0% {\n              transform: rotate(0deg);\n          }\n\n          100% {\n              transform: rotate(360deg);\n          }\n        }</style>`,\n        '',\n        { noWrapper: true, preserveCssPriority: false }\n      )\n    ).toBe(`<style></style>`);\n  });\n\n  it('removes @supports rules from CSS', () => {\n    expect(\n      sanitize(\n        `<style>@supports (display: grid) {\n            div {\n              display: grid;\n            }\n          }</style>`,\n        '',\n        { noWrapper: true, preserveCssPriority: false }\n      )\n    ).toBe(`<style></style>`);\n  });\n\n  it('removes @font-face rules from CSS', () => {\n    expect(\n      sanitize(\n        `<style>@font-face {\n            font-family: \"Open Sans\";\n            src: url(\"/fonts/OpenSans-Regular-webfont.woff2\") format(\"woff2\"),\n                 url(\"/fonts/OpenSans-Regular-webfont.woff\") format(\"woff\");\n          }</style>`,\n        '',\n        { noWrapper: true, preserveCssPriority: false }\n      )\n    ).toBe(`<style></style>`);\n  });\n\n  it('removes @import rules from CSS', () => {\n    expect(\n      sanitize(`<style>@import 'custom.css';</style>`, '', {\n        noWrapper: true,\n        preserveCssPriority: false,\n      })\n    ).toBe(`<style></style>`);\n  });\n});\n", "import {\n  allowedTags,\n  allowedCssProperties,\n  removeWithContents,\n} from './constants';\n\nexport interface SanitizerOptions {\n  /**\n   * Wrapper element id.\n   */\n  id?: string;\n\n  /**\n   * Removes all HTML tags from the contents.\n   */\n  dropAllHtmlTags?: boolean;\n\n  /**\n   * Replaces CSS url() and src= attribute values with return values of this function.\n   */\n  rewriteExternalResources?: (url: string) => string;\n\n  /**\n   * Replaces href= attribute values with return values of this function.\n   */\n  rewriteExternalLinks?: (url: string) => string;\n\n  /**\n   * Allowed schemas, default: ['http', 'https', 'mailto'].\n   */\n  allowedSchemas?: string[];\n\n  /**\n   * Remove wrapper <div> from the output, default: false.\n   */\n  noWrapper?: boolean;\n\n  /**\n   * Preserves CSS priority (!important), default: true.\n   */\n  preserveCssPriority?: boolean;\n}\n\nfunction prependIdToSelectorText(selectorText: string, id: string) {\n  if (!id) return selectorText;\n  return selectorText\n    .split(',')\n    .map(selector => selector.trim())\n    .map(selector => {\n      const s = selector\n        .replace(/\\./g, '.' + id + '_')\n        .replace(/#/g, '#' + id + '_');\n      if (s.toLowerCase().startsWith('body')) {\n        return '#' + id + ' ' + s.substring(4);\n      } else {\n        return '#' + id + ' ' + s;\n      }\n    })\n    .join(',');\n}\n\nfunction sanitizeCssValue(\n  cssValue: string,\n  allowedSchemas: string[],\n  rewriteExternalResources?: (url: string) => string\n) {\n  return cssValue\n    .trim()\n    .replace(/expression\\((.*?)\\)/g, '')\n    .replace(/url\\([\"']?(.*?)[\"']?\\)/g, (match, url) => {\n      let quote = '';\n      if (match.startsWith('url(\"')) {\n        quote = '\"';\n      } else if (match.startsWith(\"url('\")) {\n        quote = \"'\";\n      }\n\n      if (allowedSchemas.includes(url.toLowerCase().split(':')[0])) {\n        if (rewriteExternalResources) {\n          return 'url(' + quote + rewriteExternalResources(url) + quote + ')';\n        } else {\n          return match;\n        }\n      } else {\n        return '';\n      }\n    });\n}\n\nfunction sanitizeCssStyle(\n  style: CSSStyleDeclaration | undefined,\n  allowedSchemas: string[],\n  preserveCssPriority: boolean,\n  rewriteExternalResources?: (url: string) => string\n) {\n  if (!style) {\n    return;\n  }\n\n  const properties: string[] = [];\n\n  for (let i = 0; i < style.length; i++) {\n    const name = style[i];\n    properties.push(name);\n  }\n\n  for (const name of properties) {\n    if (allowedCssProperties.includes(name)) {\n      const value = style.getPropertyValue(name);\n      style.setProperty(\n        name,\n        sanitizeCssValue(value, allowedSchemas, rewriteExternalResources),\n        preserveCssPriority ? style.getPropertyPriority(name) : undefined\n      );\n    } else {\n      style.removeProperty(name);\n    }\n  }\n}\n\nfunction sanitizeCssRule(\n  rule: CSSStyleRule,\n  id: string,\n  allowedSchemas: string[],\n  preserveCssPriority: boolean,\n  rewriteExternalResources?: (url: string) => string\n) {\n  rule.selectorText = prependIdToSelectorText(rule.selectorText, id);\n  sanitizeCssStyle(\n    rule.style,\n    allowedSchemas,\n    preserveCssPriority,\n    rewriteExternalResources\n  );\n}\n\nconst defaultAllowedSchemas = ['http', 'https', 'mailto'];\n\nfunction sanitizeHtml(\n  input: string,\n  {\n    dropAllHtmlTags = false,\n    rewriteExternalLinks,\n    rewriteExternalResources,\n    id = 'msg_' +\n      String.fromCharCode(\n        ...new Array(24)\n          .fill(undefined)\n          .map(() => ((Math.random() * 25) % 25) + 65)\n      ),\n    allowedSchemas = defaultAllowedSchemas,\n    preserveCssPriority = true,\n    noWrapper = false,\n  }: SanitizerOptions\n): string {\n  if (noWrapper) id = '';\n  const doc = new DOMParser().parseFromString(input, 'text/html');\n\n  // Ensure allowed schemas are lower case.\n  allowedSchemas = Array.isArray(allowedSchemas)\n    ? allowedSchemas.map(schema => schema.toLowerCase())\n    : defaultAllowedSchemas;\n\n  // Remove comments.\n  const commentIter = doc.createNodeIterator(\n    doc.documentElement,\n    NodeFilter.SHOW_COMMENT\n  );\n\n  let node: Node | null;\n  while ((node = commentIter.nextNode())) {\n    node.parentNode?.removeChild(node);\n  }\n\n  const removeTags = [...removeWithContents];\n  if (dropAllHtmlTags) {\n    removeTags.push('style');\n  }\n\n  // Remove disallowed tags.\n  const disallowedList = doc.querySelectorAll(removeTags.join(', '));\n  disallowedList.forEach(element => element.remove());\n\n  // Move styles from head to body.\n  const styleList = doc.querySelectorAll('head > style');\n  styleList.forEach(element => {\n    doc.body.appendChild(element);\n  });\n\n  // Filter other tags.\n  const toRemove: Element[] = [];\n  const elementIter = doc.createNodeIterator(\n    doc.body,\n    NodeFilter.SHOW_ELEMENT,\n    {\n      acceptNode: () => {\n        return NodeFilter.FILTER_ACCEPT;\n      },\n    }\n  );\n\n  while ((node = elementIter.nextNode())) {\n    const element = node as HTMLElement;\n    const tagName = element.tagName.toLowerCase();\n    if (tagName === 'body' || tagName === 'html') {\n      continue;\n    }\n\n    if (dropAllHtmlTags) {\n      if (node.textContent) {\n        const textNode = doc.createTextNode(node.textContent);\n        node.parentNode?.replaceChild(textNode, node);\n      } else {\n        node.parentNode?.removeChild(node);\n      }\n\n      continue;\n    }\n\n    if (tagName in allowedTags) {\n      const allowedAttributes = allowedTags[tagName];\n      for (const attribute of element.getAttributeNames()) {\n        if (!allowedAttributes.includes(attribute)) {\n          element.removeAttribute(attribute);\n        } else if (attribute === 'class' && !noWrapper) {\n          element.setAttribute(\n            attribute,\n            element\n              .getAttribute(attribute)\n              ?.split(' ')\n              .map(className => id + '_' + className)\n              .join(' ') ?? ''\n          );\n        } else if (attribute === 'id' && !noWrapper) {\n          element.setAttribute(\n            attribute,\n            id + '_' + (element.getAttribute(attribute) ?? '')\n          );\n        } else if (attribute === 'href' || attribute === 'src') {\n          const value = element.getAttribute(attribute) ?? '';\n          if (!allowedSchemas.includes(value.toLowerCase().split(':')[0])) {\n            element.removeAttribute(attribute);\n          } else if (attribute === 'href' && rewriteExternalLinks) {\n            element.setAttribute(attribute, rewriteExternalLinks(value));\n          } else if (attribute === 'src' && rewriteExternalResources) {\n            element.setAttribute(attribute, rewriteExternalResources(value));\n          }\n        }\n      }\n\n      // Sanitize CSS.\n      sanitizeCssStyle(\n        element.style,\n        allowedSchemas,\n        preserveCssPriority,\n        rewriteExternalResources\n      );\n\n      if (tagName === 'a') {\n        // Add rel=\"noopener noreferrer\" to <a>\n        element.setAttribute('rel', 'noopener noreferrer');\n\n        // Add target=\"_blank\" to <a>\n        element.setAttribute('target', '_blank');\n      }\n    } else {\n      element.insertAdjacentHTML('afterend', element.innerHTML);\n      toRemove.push(element);\n    }\n  }\n\n  for (const element of toRemove) {\n    try {\n      try {\n        element.parentNode?.removeChild(element);\n      } catch {\n        element.outerHTML = '';\n      }\n    } catch {\n      try {\n        element.remove();\n      } catch {}\n    }\n  }\n\n  // Prepend wrapper ID.\n  const bodyStyleList = doc.querySelectorAll('body style');\n  bodyStyleList.forEach(element => {\n    const styleElement = element as HTMLStyleElement;\n    const stylesheet = styleElement.sheet as CSSStyleSheet;\n    const newRules: CSSRule[] = [];\n\n    if (!stylesheet.cssRules) {\n      styleElement.textContent = '';\n      return;\n    }\n\n    for (let i = 0; i < stylesheet.cssRules.length; i++) {\n      const rule = stylesheet.cssRules[i] as CSSStyleRule;\n\n      if ('selectorText' in rule) {\n        sanitizeCssRule(\n          rule,\n          id,\n          allowedSchemas,\n          preserveCssPriority,\n          rewriteExternalResources\n        );\n        newRules.push(rule);\n      } else if ('cssRules' in rule && 'media' in rule) {\n        // According to https://www.caniemail.com/,\n        // out of all at-rules, Gmail only supports @media.\n        const mediaRule = (rule as any) as CSSMediaRule;\n        const newRulesMedia: CSSRule[] = [];\n\n        for (let i = 0; i < mediaRule.cssRules.length; i++) {\n          const rule = mediaRule.cssRules[i] as CSSStyleRule;\n\n          if (rule.type === rule.STYLE_RULE) {\n            sanitizeCssRule(\n              rule,\n              id,\n              allowedSchemas,\n              preserveCssPriority,\n              rewriteExternalResources\n            );\n            newRulesMedia.push(rule);\n          }\n        }\n\n        while (mediaRule.cssRules.length > 0) {\n          mediaRule.deleteRule(0);\n        }\n\n        for (const rule of newRulesMedia) {\n          mediaRule.insertRule(rule.cssText, mediaRule.cssRules.length);\n        }\n\n        newRules.push(mediaRule);\n      }\n    }\n\n    styleElement.textContent = newRules.map(rule => rule.cssText).join('\\n');\n  });\n\n  // Wrap body inside of a div with the generated ID.\n  if (noWrapper) {\n    return doc.body.innerHTML;\n  } else {\n    const div = doc.createElement('div');\n    div.id = id;\n    div.innerHTML = doc.body.innerHTML;\n    return div.outerHTML;\n  }\n}\n\nfunction sanitizeText(text: string) {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport function sanitize(\n  html: string,\n  text?: string,\n  options?: SanitizerOptions\n): string {\n  let contents = html ?? '';\n  if (contents?.length === 0 && text) {\n    contents = sanitizeText(text)\n      .split('\\n')\n      .map(line => '<p>' + line + '</p>')\n      .join('\\n');\n  }\n\n  return sanitizeHtml(contents, options ?? {});\n}\n"], "filenames": ["__tests__/sanitize.test.ts", "src/index.ts"], "buggy_code_start_loc": [297, 310], "buggy_code_end_loc": [297, 311], "fixing_code_start_loc": [298, 310], "fixing_code_end_loc": [353, 313], "type": "CWE-754", "message": "lettersanitizer is a DOM-based HTML email sanitizer for in-browser email rendering. All versions of lettersanitizer below 1.0.2 are affected by a denial of service issue when processing a CSS at-rule `@keyframes`. This package is depended on by [react-letter](https://github.com/mat-sz/react-letter), therefore everyone using react-letter is also at risk. The problem has been patched in version 1.0.2.", "other": {"cve": {"id": "CVE-2022-31103", "sourceIdentifier": "security-advisories@github.com", "published": "2022-06-27T23:15:08.170", "lastModified": "2022-07-06T19:34:01.380", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "lettersanitizer is a DOM-based HTML email sanitizer for in-browser email rendering. All versions of lettersanitizer below 1.0.2 are affected by a denial of service issue when processing a CSS at-rule `@keyframes`. This package is depended on by [react-letter](https://github.com/mat-sz/react-letter), therefore everyone using react-letter is also at risk. The problem has been patched in version 1.0.2."}, {"lang": "es", "value": "lettersanitizer es un saneador de correo electr\u00f3nico HTML basado en el DOM para la representaci\u00f3n del correo electr\u00f3nico en el navegador. Todas las versiones de lettersanitizer anteriores a 1.0.2, est\u00e1n afectadas por un problema de denegaci\u00f3n de servicio cuando es procesada una regla CSS \"@keyframes\". Este paquete depende de [react-letter](https://github.com/mat-sz/react-letter), por lo que todos usando react-letter tambi\u00e9n est\u00e1n en riesgo. El problema ha sido parcheado en versi\u00f3n 1.0.2"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:N/I:N/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "PARTIAL", "baseScore": 5.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 10.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-754"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:lettersanitizer_project:lettersanitizer:*:*:*:*:*:node.js:*:*", "versionEndExcluding": "1.0.2", "matchCriteriaId": "7996CE4F-0FF7-4D5F-A65D-99A97283CE50"}]}]}], "references": [{"url": "https://github.com/mat-sz/lettersanitizer/commit/96d3dfe2ef0465d47324ed4d13e91ba0816a173f", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/mat-sz/lettersanitizer/security/advisories/GHSA-7r3r-gq8p-v9jj", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}, {"url": "https://github.com/mat-sz/react-letter/issues/17", "source": "security-advisories@github.com", "tags": ["Issue Tracking", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/mat-sz/lettersanitizer/commit/96d3dfe2ef0465d47324ed4d13e91ba0816a173f"}}