{"buggy_code": ["# Changelog\n\n## 1.0.10 (December 22, 2016)\n\n### Fixed\n- Fixed Vue Warnings in Debug Bar\n- Fixed URL replacement to undefined when using pagination (IE, Opera)\n\n### Security\n- Stored XSS in email templates, discovered by Raphael de la Vienne\n\n## 1.0.9 (November 9, 2016)\n\n### Fixed\n- Fixed self update command\n- Fixed an localisation issue which could lead to JS crashes (e.g. finder)\n\n## 1.0.8 (August 18, 2016)\n\n### Fixed\n- Fixed internalization route in maintenance mode\n- Fixed admin logout if an route alias exists\n- Fixed location widget settings\n\n### Changed\n- Make re-login modal available in front end by default\n\n## 1.0.7 (August 11, 2016)\n\n### Changed\n- Permission to access admin area now includes the right to use the site in maintenance mode\n\n### Fixed\n- Fixed JS error during user role sorting\n- Fixed unintentional duplication of dashboard widgets in rare cases\n- Fixed re-login in maintenance mode for certain API routes\n- Fixed login interceptor to not intercept CORS requests\n\n## 1.0.6 (August 8, 2016)\n\n### Added\n- Twig debug mode\n- Float filter for request arguments\n\n### Fixed\n- Fixed wrong user role assignment in very rare cases (SQLite)\n\n### Security\n- XSS vulnerabilities at 404 page, discovered by Onur Yilmaz (https://www.netsparker.com)\n- XSS vulnerabilities at login page, discovered by Raphael de la Vienne and Luuk Spreeuwenberg\n- SQL injection vulnerability, which can be misused by users with admin privileges, discovered by Raphael de la Vienne and Luuk Spreeuwenberg\n\n## 1.0.5 (July 1, 2016)\n\n### Fixed\n- Fixed asset upload\n\n## 1.0.4 (June 29, 2016)\n\n### Added\n- Added node's access check\n\n### Fixed\n- Fixed access check for user and site settings\n- Fixed admin dashboard for Safari private window\n- Fixed a situation where a node could be assigned as its own parent\n- Fixed backend password recovery\n- Fixed user approval if verification is activated as well\n- Fixed user verification state\n\n## 1.0.3 (May 11, 2016)\n\n### Added\n- Parse MySQL Port from hostname in installer\n- SSL support for location widget\n\n### Changed\n- Improved widget visibility settings\n- Redirect to extensions/themes overview after install and activation from marketplace\n- Changed signature of setup command\n\n### Fixed\n- Fixed touch support in backend\n- Fixed superfluous request caching\n- Fixed widget settings validation\n- Fixed relative date for languages without plural\n- Fixed non expiring local storage\n- Fixed style and script helper for use in Twig templates\n\n## 1.0.2 (April 22, 2016)\n\n### Fixed\n- Fixed notice when og:image in site meta settings not defined\n\n## 1.0.1 (April 21, 2016)\n\n### Added\n- Added OpenGraph image option for site nodes\n- Added file extension check for storage uploads\n- Added maintenance logo option\n- Added cache break for language file\n\n### Changed\n- Smoothed packages updates\n- Optimized .htaccess\n\n### Fixed\n- Fixed save shortcut in Firefox\n- Fixed reordering in site tree\n- Fixed missing territory data\n- Fixed redirect after login\n- Fixed missing initial active state at pagination\n- Fixed duplicated request occasionally caused by pagination\n\n## 1.0.0 (April 13, 2016)\n\n### Fixed\n- Temporarily fixed menu params bug\n\n## 0.11.3 (April 7, 2016)\n\n### Fixed\n- Fixed blank widget settings page\n- Fixed missing marketplace icons\n- Fixed RFC 3986 encoding of static URLs\n- Fixed render params\n- Fixed CLI command enables extensions\n- Fixed db prefix check in installer\n- Fixed different prefixes with SQLLite\n- Fixed SQLite collations\n\n### Removed\n- Removed Guzzle dependency\n\n### Changed\n- CLI setup command requires admin password to be specified\n\n## 0.11.2 (April 1, 2016)\n\n### Fixed\n- Fixed missing extension icons\n\n## 0.11.1 (April 1, 2016)\n\n### Changed\n- Dashboard: Use drag handle\n\n### Fixed\n- Fixed wrapping sidebar if content in main column is to large\n- Fixed adding of new images in editor\n\n## 0.11.0 (March 30, 2016)\n\n### Added\n- Added OpenGraph and Twitter Cards\n- Added CLI command to setup Pagekit installation\n- Added redirect after login to user settings\n- Added view.init event\n- Added global params object to view\n- Added file picker\n- Added support for script tag attributes 'defer' and 'async'\n\n### Changed\n- Transfer widget and menu positions on theme change\n- Image-, video-, link-picker: Preserve existing attributes\n- Video-picker: Switched from shortcodes to html representation\n- Video-picker: Improved URL matching\n- Link preview: Support for html\n- Editor preview: Remove script and style tags\n- Installer: SQLite is now default\n- Installer: Show SQLite only if available\n- SelfUpdater: Check new requirements before update\n- Removed system messages from template.php\n\n### Fixed\n- Fixed info page for high directory depths\n- Fixed overflow container in modals\n- Fixed password reset link\n- Fixed canonical links\n\n## 0.10.4 (March 1, 2016)\n\n### Added\n- Added filter cache for lists and searches\n- Remember last finder position and view setting\n- Added pagination cache and pagination links\n- Added changelog to update view\n- Added extension dependency update command for developer\n- Added prefer-source option to package install and update command\n- Added filter and ordering highlighting\n\n### Changed\n- Bundled Pagekit installer\n- Updated to Symfony 3.0\n- Hide Trash menu from Site node picker\n- Deny cross site redirects after login and logout\n- Session Cookie uses HttpOnly flag now\n- Nicer login, registration and profile pages\n- Nicer update notification on dashboard\n- Improved ORM Metadata cache breaker\n- Reenabled Packagist for zip uploads\n\n### Fixed\n- Fixed username validation in installer and backend (#513)\n- Fixed widget settings\n- Fixed embedded Youtube videos (#533)\n- Fixed Gravatar retina resolution\n- Fixed Gravatar mutual exclusion\n- Fixed Finder thumbnails for file names containing HTML special chars\n- Fixed distinguish Pagekit instances at same domain\n- Fixed selecting items at site tree and widget settings\n- Fixed image picker in editor now keeps class attributes\n- Fixed ExceptionHandler response\n- Fixed an issue which could lead to an open_basedir restriction exception\n- Fixed registration verification mail\n- Fixed user authenticated role assignment\n- Fixed package upload zip verification\n- Fixed single quote issue by using RFC4627-compliant JSON within embedded script tags (#551)\n\n## 0.10.3 (February 19, 2016)\n\n### Changed\n- Increased package installation speed by disabling usage of Packagist repository (Pagekit API now provides a subset of required Packagist dependencies)\n- Prepared self updater for bundled versions of Pagekit\n\n## 0.10.2 (January 11, 2016)\n\n### Added\n- Show login modal for unauthorized ajax requests\n- Added events to DebugBar\n- Added current route info to DebugBar\n- Added request switcher to DebugBar\n\n### Changed\n- Updated requirements\n- Enforce reinstall of packages (#479)\n- Allow comment posting for 'authenticated' users by default (#518)\n\n### Fixed\n- Fixed auto updater\n- Fixed \"Add\" new roles (#512)\n- Fixed package upload\n- Cleanup package dependencies (#488)\n- Fixed installation without PDO_MYSQL (#516)\n\n## 0.10.1 (December 17, 2015)\n\n### Added\n- Added version cache break for JS and CSS\n- Added 'storage:' file path\n\n### Changed\n- Updated Vue-Resource\n- Improved handling of Gravatar images\n\n### Fixed\n- Fixed admin panel for IE\n- Fixed system messages\n- Fixed editor preview handles Vuejs markup\n- Fixed redirects on login and logout\n\n## 0.10.0 (December 15, 2015)\n\n### Added\n- Added options in video picker\n\n### Changed\n- Switched to Vuejs 1.0\n- Optimized site tree\n- Optimized user settings\n\n### Fixed\n- On widget copy, theme settings are copied too\n- Fixed password edit on user view\n\n## 0.9.5 (October 30, 2015)\n\n### Added\n- Added widget copy API function\n- Added preliminary update notifications to dashboard\n\n### Changed\n- Random string generator uses low strength now (#478)\n\n### Fixed\n- Installer error messages use correct locale now\n- Canonical routes are absolute now\n\n## 0.9.4 (October 14, 2015)\n\n### Added\n- Added Twig support\n- Resource paths for themes are added by default\n\n### Changed\n- Made type in module definition for extensions/themes obsolete\n\n### Fixed\n- Fixed date conversion to ISO8601\n- Fixed feed charset and feed title escaping\n- Openweathermap.org requires Api key now\n\n## 0.9.3 (October 8, 2015)\n\n### Fixed\n- Fixed freezing browser in marketplace\n\n## 0.9.2 (October 8, 2015)\n\n### Added\n- Added Https for Pagekit API (#415)\n- Added site title to browser title\n- Added Mysql character set compatibility (#434, #465)\n- Added sections tabs in user edit view (#390)\n\n### Changed\n- Site tree adds its leaf node routes first (#420)\n- User authentication uses separate table\n- Changed config file generation\n\n### Removed\n- Removed usage of environment variables (#428)\n- Removed site description\n- Removed Pagekit version from generator tag\n\n### Fixed\n- Fixed user widget ordering\n- Fixed nodes reordering\n- Fixed Finder component for non Unix OS's (#448)\n- Fixed HttpExceptions returning with Code 500\n- Fixed internal URLs not being resolved in feeds (#466)\n- Fixed theme updates (#472)\n- Fixed extensions and themes view in IE\n- Fixed permissions issue on site edit (#471)\n- Fixed redirect to login, if failed, due to insufficient user rights\n\n## 0.9.1 (September 11, 2015)\n\n### Added\n- Added additional system requirements (#410)\n- Added link to gitter chat\n\n### Changed\n- By default \"display errors\" are set to \"off\"\n\n### Fixed\n- Fixed auto login\n- Fixed login widget (#423)\n\n## 0.9.0 (September 10, 2015)\n\n### Added\n- Added site tree\n- Added new default theme\n- Added new admin panel\n- Added data-reactive components with Vue.js\n- Added package management using Composer\n\n### Changed\n- Major codebase update\n\n## 0.8.8 (November 17, 2014)\n\n### Added\n- Added pagination in Blog extension\n- Added languages from Transifex\n\n### Changed\n- Updated UIkit to 2.11.1\n\n### Fixed\n- Fixed comment status bug\n- Fixed reordering menu bug\n- Fixed Marketplace grid\n- Fixed thumbnail grid in Storage\n- Fixed several issues for shared hosters\n\n## 0.8.7 (September 8, 2014)\n\n### Added\n- Added OAuth API\n\n### Changed\n- Updated library dependencies\n\n### Fixed\n- Fixed option cache issue\n\n## 0.8.6 (August 28, 2014)\n\n### Changed\n- Changed requirejs scripts ordering\n\n### Removed\n- Removed 'settings' from extension/theme config, use 'parameters' instead\n- Removed GLOB_BRACE for Solaris compatibility\n\n### Fixed\n- Fixed Blog/Page url handling\n- Fixed Blog extension settings\n\n## 0.8.5 (August 22, 2014)\n\n### Added\n- Added Marketplace pagination\n- Beautified system emails\n- Added admin theme font subset latin, latin-ext\n\n### Changed\n- Updated UIkit to 2.9\n\n### Removed\n- Removed username in password reset\n\n### Fixed\n- Simple plugin regex\n- Fixed Gravatar on https\n\n## 0.8.4 (July 25, 2014)\n\n### Added\n- Added Finnish, French, Spanish, Russian translations\n- Added pagination in user manager\n\n### Changed\n- Changed mod_rewrite check\n- Widgets render themselves now\n- Changed comments settings in blog\n- The app root no longer needs to be writable if the config already exists\n\n### Fixed\n- Fixed Comments ordering (blog)\n- Fixed Comments auto approval (blog)\n- Fixed Finder (Windows)\n- Fixed demo data for SQLite versions < 3.7.11\n- Fixed language registration for themes and extensions\n- Fixed blank renderer in theme skeleton\n- Fixed redirect after installation\n- Fixed Apache configuration to serve SVG files with correct mime type\n- Fixed verify mail action\n", "<?php\n\nreturn [\n\n    'application' => [\n\n        'version' => '1.0.10'\n\n    ],\n\n    'auth' => [\n\n        'table' => '@system_auth',\n        'cookie' => [\n            'name' => 'pagekit_auth',\n            'lifetime' => 315360000\n        ]\n\n    ],\n\n    'debug' => [\n\n        'file' => \"sqlite:$path/tmp/temp/debug.db\"\n\n    ],\n\n    'session' => [\n\n        'storage' => 'database',\n        'lifetime' => 900,\n        'files' => \"$path/tmp/sessions\",\n        'table' => '@system_session',\n        'cookie' => [\n            'name' => 'pagekit_session',\n            'httponly' => true\n        ]\n\n    ],\n\n    'filesystem' => [\n\n        'path' => $path\n\n    ],\n\n    'system/cache' => [\n\n        'caches' => [\n\n            'cache' => [\n\n                'storage' => 'auto',\n                'path' => \"$path/tmp/cache\",\n                'prefix' => sha1($path)\n\n            ],\n\n            'cache.phpfile' => [\n\n                'storage' => 'phpfile',\n                'path' => \"$path/tmp/cache\"\n\n            ]\n\n        ]\n\n    ],\n\n    'system/dashboard' => [\n\n        'defaults' => [\n\n            'userdefault' => [\n                'id' => 'userdefault',\n                'type' => 'user',\n                'show' => 'login',\n                'display' => 'thumbnail'\n            ]\n        ]\n\n    ]\n\n];\n", "<template>\n\n    <div class=\"uk-margin uk-flex uk-flex-space-between uk-flex-wrap\" data-uk-margin>\n        <div data-uk-margin>\n            <h2 class=\"uk-margin-remove\">{{ 'System' | trans }}</h2>\n        </div>\n        <div data-uk-margin>\n            <button class=\"uk-button uk-button-primary\" type=\"submit\">{{ 'Save' | trans }}</button>\n        </div>\n    </div>\n\n    <div class=\"uk-form-row\">\n        <label for=\"form-storage\" class=\"uk-form-label\">{{ 'Storage' | trans }}</label>\n        <div class=\"uk-form-controls\">\n            <input id=\"form-storage\" class=\"uk-form-width-large\" type=\"text\" placeholder=\"/storage\" v-model=\"$root.config['system/finder'].storage\">\n        </div>\n    </div>\n\n    <div class=\"uk-form-row\">\n        <label for=\"form-fileextensions\" class=\"uk-form-label\">{{ 'File Extensions' | trans }}</label>\n        <div class=\"uk-form-controls\">\n            <input id=\"form-fileextensions\" class=\"uk-form-width-large\" type=\"text\" v-model=\"$root.options['system/finder']['extensions']\">\n            <p class=\"uk-form-help-block\">{{ 'Allowed file extensions for the storage upload.' | trans }}</p>\n        </div>\n    </div>\n\n    <div class=\"uk-form-row\">\n        <span class=\"uk-form-label\">{{ 'Developer' | trans }}</span>\n        <div class=\"uk-form-controls uk-form-controls-text\">\n            <p class=\"uk-form-controls-condensed\">\n                <label><input type=\"checkbox\" value=\"1\" v-model=\"$root.config.application.debug\"> {{ 'Enable debug mode' | trans }}</label>\n            </p>\n            <p class=\"uk-form-controls-condensed\">\n                <label><input type=\"checkbox\" value=\"1\" v-model=\"$root.config.debug.enabled\" :disabled=\"!sqlite\"> {{ 'Enable debug toolbar' | trans }}</label>\n            </p>\n            <p class=\"uk-form-help-block\" v-if=\"!sqlite\">{{ 'Please enable the SQLite database extension.' | trans }}</p>\n        </div>\n    </div>\n\n</template>\n\n<script>\n\n    module.exports = {\n\n        section: {\n            label: 'System',\n            icon: 'pk-icon-large-settings',\n            priority: 10\n        },\n\n        props: ['config', 'options'],\n\n        data: function () {\n            return window.$system;\n        }\n\n    };\n\n</script>\n", "<?php\n\nnamespace Pagekit\\User\\Controller;\n\nuse Pagekit\\Application as App;\nuse Pagekit\\Application\\Exception;\nuse Pagekit\\User\\Model\\User;\n\nclass ResetPasswordController\n{\n\n    public function indexAction()\n    {\n        if (App::user()->isAuthenticated()) {\n            return App::redirect();\n        }\n\n        return [\n            '$view' => [\n                'title' => __('Reset'),\n                'name' => 'system/user/reset-request.php',\n            ],\n            'error' => ''\n        ];\n    }\n\n    /**\n     * @Request({\"email\": \"string\"})\n     */\n    public function requestAction($email)\n    {\n        try {\n\n            if (App::user()->isAuthenticated()) {\n                return App::redirect();\n            }\n\n            if (!App::csrf()->validate()) {\n                throw new Exception(__('Invalid token. Please try again.'));\n            }\n\n            if (empty($email)) {\n                throw new Exception(__('Enter a valid email address.'));\n            }\n\n            if (!$user = User::findByEmail($email)) {\n                throw new Exception(__('Unknown email address.'));\n            }\n\n            if ($user->isBlocked()) {\n                throw new Exception(__('Your account has not been activated or is blocked.'));\n            }\n\n            $user->activation = App::get('auth.random')->generateString(32);\n\n            $url = App::url('@user/resetpassword/confirm', ['user' => $user->username, 'key' => $user->activation], 0);\n\n            try {\n\n                $mail = App::mailer()->create();\n                $mail->setTo($user->email)\n                    ->setSubject(__('Reset password for %site%.', ['%site%' => App::module('system/site')->config('title')]))\n                    ->setBody(App::view('system/user:mails/reset.php', compact('user', 'url', 'mail')), 'text/html')\n                    ->send();\n\n            } catch (\\Exception $e) {\n                throw new Exception(__('Unable to send confirmation link.'));\n            }\n\n            $user->save();\n\n            App::message()->success(__('Check your email for the confirmation link.'));\n\n            return App::redirect('@user/login');\n\n        } catch (Exception $e) {\n            return [\n                '$view' => [\n                    'title' => __('Reset'),\n                    'name' => 'system/user/reset-request.php',\n                ],\n                'error' => $e->getMessage()\n            ];\n        }\n    }\n\n    /**\n     * @Request({\"user\", \"key\"})\n     */\n    public function confirmAction($username = \"\", $activation = \"\")\n    {\n        if (empty($username) || empty($activation) || !$user = User::where(compact('username', 'activation'))->first()) {\n            App::abort(400, __('Invalid key.'));\n        }\n\n        if ($user->isBlocked()) {\n            App::abort(400, __('Your account has not been activated or is blocked.'));\n        }\n\n        if ('POST' === App::request()->getMethod()) {\n\n            try {\n\n                if (!App::csrf()->validate()) {\n                    throw new Exception(__('Invalid token. Please try again.'));\n                }\n\n                $password = App::request()->request->get('password');\n\n                if (empty($password)) {\n                    throw new Exception(__('Enter password.'));\n                }\n\n                if ($password != trim($password)) {\n                    throw new Exception(__('Invalid password.'));\n                }\n\n                $user->password = App::get('auth.password')->hash($password);\n                $user->activation = null;\n                $user->save();\n\n                App::message()->success(__('Your password has been reset.'));\n\n                return App::redirect('@user/login');\n\n            } catch (Exception $e) {\n                $error = $e->getMessage();\n            }\n        }\n\n        return [\n            '$view' => [\n                'title' => __('Reset Confirm'),\n                'name' => 'system/user/reset-confirm.php'\n            ],\n            'username' => $username,\n            'activation' => $activation,\n            'error' => isset($error) ? $error : ''\n        ];\n    }\n\n}\n", "<?php $view->script('uikit-form-password') ?>\n\n<form class=\"pk-user pk-user-reset uk-form uk-form-stacked uk-width-medium-1-2 uk-width-large-1-3 uk-container-center\" action=\"<?= $view->url('@user/resetpassword/confirm', ['user' => $username, 'key' => $activation]) ?>\" method=\"post\">\n\n    <?php if($error): ?>\n    <div class=\"uk-alert uk-alert-danger\">\n        <?= $error; ?>\n    </div>\n    <?php endif; ?>\n\n    <h1 class=\"uk-h2 uk-text-center\"><?= __('Password Confirmation') ?></h1>\n\n    <div class=\"uk-form-row js-password\">\n        <div class=\"uk-form-password uk-width-1-1\">\n            <input class=\"uk-width-1-1\" type=\"password\" name=\"password\" value=\"\" placeholder=\"<?= __('New Password') ?>\">\n            <a href=\"\" class=\"uk-form-password-toggle\" tabindex=\"-1\" data-uk-form-password=\"{ lblShow: '<?= __('Show') ?>', lblHide: '<?= __('Hide') ?>' }\"><?= __('Show') ?></a>\n        </div>\n    </div>\n\n    <p class=\"uk-form-row\">\n        <button class=\"uk-button uk-button-primary uk-button-large uk-width-1-1\" type=\"submit\"><?= __('Confirm') ?></button>\n    </p>\n\n    <?php $view->token()->get() ?>\n\n</form>\n"], "fixing_code": ["# Changelog\n\n## 1.0.11 (January 20, 2017)\n\n### Security\n- Fixed replay attack with password reset links when debug toolbar is enabled, discovered by SecureLayer7 \n\n## 1.0.10 (December 22, 2016)\n\n### Fixed\n- Fixed Vue Warnings in Debug Bar\n- Fixed URL replacement to undefined when using pagination (IE, Opera)\n\n### Security\n- Stored XSS in email templates, discovered by Raphael de la Vienne\n\n## 1.0.9 (November 9, 2016)\n\n### Fixed\n- Fixed self update command\n- Fixed an localisation issue which could lead to JS crashes (e.g. finder)\n\n## 1.0.8 (August 18, 2016)\n\n### Fixed\n- Fixed internalization route in maintenance mode\n- Fixed admin logout if an route alias exists\n- Fixed location widget settings\n\n### Changed\n- Make re-login modal available in front end by default\n\n## 1.0.7 (August 11, 2016)\n\n### Changed\n- Permission to access admin area now includes the right to use the site in maintenance mode\n\n### Fixed\n- Fixed JS error during user role sorting\n- Fixed unintentional duplication of dashboard widgets in rare cases\n- Fixed re-login in maintenance mode for certain API routes\n- Fixed login interceptor to not intercept CORS requests\n\n## 1.0.6 (August 8, 2016)\n\n### Added\n- Twig debug mode\n- Float filter for request arguments\n\n### Fixed\n- Fixed wrong user role assignment in very rare cases (SQLite)\n\n### Security\n- XSS vulnerabilities at 404 page, discovered by Onur Yilmaz (https://www.netsparker.com)\n- XSS vulnerabilities at login page, discovered by Raphael de la Vienne and Luuk Spreeuwenberg\n- SQL injection vulnerability, which can be misused by users with admin privileges, discovered by Raphael de la Vienne and Luuk Spreeuwenberg\n\n## 1.0.5 (July 1, 2016)\n\n### Fixed\n- Fixed asset upload\n\n## 1.0.4 (June 29, 2016)\n\n### Added\n- Added node's access check\n\n### Fixed\n- Fixed access check for user and site settings\n- Fixed admin dashboard for Safari private window\n- Fixed a situation where a node could be assigned as its own parent\n- Fixed backend password recovery\n- Fixed user approval if verification is activated as well\n- Fixed user verification state\n\n## 1.0.3 (May 11, 2016)\n\n### Added\n- Parse MySQL Port from hostname in installer\n- SSL support for location widget\n\n### Changed\n- Improved widget visibility settings\n- Redirect to extensions/themes overview after install and activation from marketplace\n- Changed signature of setup command\n\n### Fixed\n- Fixed touch support in backend\n- Fixed superfluous request caching\n- Fixed widget settings validation\n- Fixed relative date for languages without plural\n- Fixed non expiring local storage\n- Fixed style and script helper for use in Twig templates\n\n## 1.0.2 (April 22, 2016)\n\n### Fixed\n- Fixed notice when og:image in site meta settings not defined\n\n## 1.0.1 (April 21, 2016)\n\n### Added\n- Added OpenGraph image option for site nodes\n- Added file extension check for storage uploads\n- Added maintenance logo option\n- Added cache break for language file\n\n### Changed\n- Smoothed packages updates\n- Optimized .htaccess\n\n### Fixed\n- Fixed save shortcut in Firefox\n- Fixed reordering in site tree\n- Fixed missing territory data\n- Fixed redirect after login\n- Fixed missing initial active state at pagination\n- Fixed duplicated request occasionally caused by pagination\n\n## 1.0.0 (April 13, 2016)\n\n### Fixed\n- Temporarily fixed menu params bug\n\n## 0.11.3 (April 7, 2016)\n\n### Fixed\n- Fixed blank widget settings page\n- Fixed missing marketplace icons\n- Fixed RFC 3986 encoding of static URLs\n- Fixed render params\n- Fixed CLI command enables extensions\n- Fixed db prefix check in installer\n- Fixed different prefixes with SQLLite\n- Fixed SQLite collations\n\n### Removed\n- Removed Guzzle dependency\n\n### Changed\n- CLI setup command requires admin password to be specified\n\n## 0.11.2 (April 1, 2016)\n\n### Fixed\n- Fixed missing extension icons\n\n## 0.11.1 (April 1, 2016)\n\n### Changed\n- Dashboard: Use drag handle\n\n### Fixed\n- Fixed wrapping sidebar if content in main column is to large\n- Fixed adding of new images in editor\n\n## 0.11.0 (March 30, 2016)\n\n### Added\n- Added OpenGraph and Twitter Cards\n- Added CLI command to setup Pagekit installation\n- Added redirect after login to user settings\n- Added view.init event\n- Added global params object to view\n- Added file picker\n- Added support for script tag attributes 'defer' and 'async'\n\n### Changed\n- Transfer widget and menu positions on theme change\n- Image-, video-, link-picker: Preserve existing attributes\n- Video-picker: Switched from shortcodes to html representation\n- Video-picker: Improved URL matching\n- Link preview: Support for html\n- Editor preview: Remove script and style tags\n- Installer: SQLite is now default\n- Installer: Show SQLite only if available\n- SelfUpdater: Check new requirements before update\n- Removed system messages from template.php\n\n### Fixed\n- Fixed info page for high directory depths\n- Fixed overflow container in modals\n- Fixed password reset link\n- Fixed canonical links\n\n## 0.10.4 (March 1, 2016)\n\n### Added\n- Added filter cache for lists and searches\n- Remember last finder position and view setting\n- Added pagination cache and pagination links\n- Added changelog to update view\n- Added extension dependency update command for developer\n- Added prefer-source option to package install and update command\n- Added filter and ordering highlighting\n\n### Changed\n- Bundled Pagekit installer\n- Updated to Symfony 3.0\n- Hide Trash menu from Site node picker\n- Deny cross site redirects after login and logout\n- Session Cookie uses HttpOnly flag now\n- Nicer login, registration and profile pages\n- Nicer update notification on dashboard\n- Improved ORM Metadata cache breaker\n- Reenabled Packagist for zip uploads\n\n### Fixed\n- Fixed username validation in installer and backend (#513)\n- Fixed widget settings\n- Fixed embedded Youtube videos (#533)\n- Fixed Gravatar retina resolution\n- Fixed Gravatar mutual exclusion\n- Fixed Finder thumbnails for file names containing HTML special chars\n- Fixed distinguish Pagekit instances at same domain\n- Fixed selecting items at site tree and widget settings\n- Fixed image picker in editor now keeps class attributes\n- Fixed ExceptionHandler response\n- Fixed an issue which could lead to an open_basedir restriction exception\n- Fixed registration verification mail\n- Fixed user authenticated role assignment\n- Fixed package upload zip verification\n- Fixed single quote issue by using RFC4627-compliant JSON within embedded script tags (#551)\n\n## 0.10.3 (February 19, 2016)\n\n### Changed\n- Increased package installation speed by disabling usage of Packagist repository (Pagekit API now provides a subset of required Packagist dependencies)\n- Prepared self updater for bundled versions of Pagekit\n\n## 0.10.2 (January 11, 2016)\n\n### Added\n- Show login modal for unauthorized ajax requests\n- Added events to DebugBar\n- Added current route info to DebugBar\n- Added request switcher to DebugBar\n\n### Changed\n- Updated requirements\n- Enforce reinstall of packages (#479)\n- Allow comment posting for 'authenticated' users by default (#518)\n\n### Fixed\n- Fixed auto updater\n- Fixed \"Add\" new roles (#512)\n- Fixed package upload\n- Cleanup package dependencies (#488)\n- Fixed installation without PDO_MYSQL (#516)\n\n## 0.10.1 (December 17, 2015)\n\n### Added\n- Added version cache break for JS and CSS\n- Added 'storage:' file path\n\n### Changed\n- Updated Vue-Resource\n- Improved handling of Gravatar images\n\n### Fixed\n- Fixed admin panel for IE\n- Fixed system messages\n- Fixed editor preview handles Vuejs markup\n- Fixed redirects on login and logout\n\n## 0.10.0 (December 15, 2015)\n\n### Added\n- Added options in video picker\n\n### Changed\n- Switched to Vuejs 1.0\n- Optimized site tree\n- Optimized user settings\n\n### Fixed\n- On widget copy, theme settings are copied too\n- Fixed password edit on user view\n\n## 0.9.5 (October 30, 2015)\n\n### Added\n- Added widget copy API function\n- Added preliminary update notifications to dashboard\n\n### Changed\n- Random string generator uses low strength now (#478)\n\n### Fixed\n- Installer error messages use correct locale now\n- Canonical routes are absolute now\n\n## 0.9.4 (October 14, 2015)\n\n### Added\n- Added Twig support\n- Resource paths for themes are added by default\n\n### Changed\n- Made type in module definition for extensions/themes obsolete\n\n### Fixed\n- Fixed date conversion to ISO8601\n- Fixed feed charset and feed title escaping\n- Openweathermap.org requires Api key now\n\n## 0.9.3 (October 8, 2015)\n\n### Fixed\n- Fixed freezing browser in marketplace\n\n## 0.9.2 (October 8, 2015)\n\n### Added\n- Added Https for Pagekit API (#415)\n- Added site title to browser title\n- Added Mysql character set compatibility (#434, #465)\n- Added sections tabs in user edit view (#390)\n\n### Changed\n- Site tree adds its leaf node routes first (#420)\n- User authentication uses separate table\n- Changed config file generation\n\n### Removed\n- Removed usage of environment variables (#428)\n- Removed site description\n- Removed Pagekit version from generator tag\n\n### Fixed\n- Fixed user widget ordering\n- Fixed nodes reordering\n- Fixed Finder component for non Unix OS's (#448)\n- Fixed HttpExceptions returning with Code 500\n- Fixed internal URLs not being resolved in feeds (#466)\n- Fixed theme updates (#472)\n- Fixed extensions and themes view in IE\n- Fixed permissions issue on site edit (#471)\n- Fixed redirect to login, if failed, due to insufficient user rights\n\n## 0.9.1 (September 11, 2015)\n\n### Added\n- Added additional system requirements (#410)\n- Added link to gitter chat\n\n### Changed\n- By default \"display errors\" are set to \"off\"\n\n### Fixed\n- Fixed auto login\n- Fixed login widget (#423)\n\n## 0.9.0 (September 10, 2015)\n\n### Added\n- Added site tree\n- Added new default theme\n- Added new admin panel\n- Added data-reactive components with Vue.js\n- Added package management using Composer\n\n### Changed\n- Major codebase update\n\n## 0.8.8 (November 17, 2014)\n\n### Added\n- Added pagination in Blog extension\n- Added languages from Transifex\n\n### Changed\n- Updated UIkit to 2.11.1\n\n### Fixed\n- Fixed comment status bug\n- Fixed reordering menu bug\n- Fixed Marketplace grid\n- Fixed thumbnail grid in Storage\n- Fixed several issues for shared hosters\n\n## 0.8.7 (September 8, 2014)\n\n### Added\n- Added OAuth API\n\n### Changed\n- Updated library dependencies\n\n### Fixed\n- Fixed option cache issue\n\n## 0.8.6 (August 28, 2014)\n\n### Changed\n- Changed requirejs scripts ordering\n\n### Removed\n- Removed 'settings' from extension/theme config, use 'parameters' instead\n- Removed GLOB_BRACE for Solaris compatibility\n\n### Fixed\n- Fixed Blog/Page url handling\n- Fixed Blog extension settings\n\n## 0.8.5 (August 22, 2014)\n\n### Added\n- Added Marketplace pagination\n- Beautified system emails\n- Added admin theme font subset latin, latin-ext\n\n### Changed\n- Updated UIkit to 2.9\n\n### Removed\n- Removed username in password reset\n\n### Fixed\n- Simple plugin regex\n- Fixed Gravatar on https\n\n## 0.8.4 (July 25, 2014)\n\n### Added\n- Added Finnish, French, Spanish, Russian translations\n- Added pagination in user manager\n\n### Changed\n- Changed mod_rewrite check\n- Widgets render themselves now\n- Changed comments settings in blog\n- The app root no longer needs to be writable if the config already exists\n\n### Fixed\n- Fixed Comments ordering (blog)\n- Fixed Comments auto approval (blog)\n- Fixed Finder (Windows)\n- Fixed demo data for SQLite versions < 3.7.11\n- Fixed language registration for themes and extensions\n- Fixed blank renderer in theme skeleton\n- Fixed redirect after installation\n- Fixed Apache configuration to serve SVG files with correct mime type\n- Fixed verify mail action\n", "<?php\n\nreturn [\n\n    'application' => [\n\n        'version' => '1.0.11'\n\n    ],\n\n    'auth' => [\n\n        'table' => '@system_auth',\n        'cookie' => [\n            'name' => 'pagekit_auth',\n            'lifetime' => 315360000\n        ]\n\n    ],\n\n    'debug' => [\n\n        'file' => \"sqlite:$path/tmp/temp/debug.db\"\n\n    ],\n\n    'session' => [\n\n        'storage' => 'database',\n        'lifetime' => 900,\n        'files' => \"$path/tmp/sessions\",\n        'table' => '@system_session',\n        'cookie' => [\n            'name' => 'pagekit_session',\n            'httponly' => true\n        ]\n\n    ],\n\n    'filesystem' => [\n\n        'path' => $path\n\n    ],\n\n    'system/cache' => [\n\n        'caches' => [\n\n            'cache' => [\n\n                'storage' => 'auto',\n                'path' => \"$path/tmp/cache\",\n                'prefix' => sha1($path)\n\n            ],\n\n            'cache.phpfile' => [\n\n                'storage' => 'phpfile',\n                'path' => \"$path/tmp/cache\"\n\n            ]\n\n        ]\n\n    ],\n\n    'system/dashboard' => [\n\n        'defaults' => [\n\n            'userdefault' => [\n                'id' => 'userdefault',\n                'type' => 'user',\n                'show' => 'login',\n                'display' => 'thumbnail'\n            ]\n        ]\n\n    ]\n\n];\n", "<template>\n\n    <div class=\"uk-margin uk-flex uk-flex-space-between uk-flex-wrap\" data-uk-margin>\n        <div data-uk-margin>\n            <h2 class=\"uk-margin-remove\">{{ 'System' | trans }}</h2>\n        </div>\n        <div data-uk-margin>\n            <button class=\"uk-button uk-button-primary\" type=\"submit\">{{ 'Save' | trans }}</button>\n        </div>\n    </div>\n\n    <div class=\"uk-form-row\">\n        <label for=\"form-storage\" class=\"uk-form-label\">{{ 'Storage' | trans }}</label>\n        <div class=\"uk-form-controls\">\n            <input id=\"form-storage\" class=\"uk-form-width-large\" type=\"text\" placeholder=\"/storage\" v-model=\"$root.config['system/finder'].storage\">\n        </div>\n    </div>\n\n    <div class=\"uk-form-row\">\n        <label for=\"form-fileextensions\" class=\"uk-form-label\">{{ 'File Extensions' | trans }}</label>\n        <div class=\"uk-form-controls\">\n            <input id=\"form-fileextensions\" class=\"uk-form-width-large\" type=\"text\" v-model=\"$root.options['system/finder']['extensions']\">\n            <p class=\"uk-form-help-block\">{{ 'Allowed file extensions for the storage upload.' | trans }}</p>\n        </div>\n    </div>\n\n    <div class=\"uk-form-row\">\n        <span class=\"uk-form-label\">{{ 'Developer' | trans }}</span>\n        <div class=\"uk-form-controls uk-form-controls-text\">\n            <p class=\"uk-form-controls-condensed\">\n                <label><input type=\"checkbox\" value=\"1\" v-model=\"$root.config.application.debug\"> {{ 'Enable debug mode' | trans }}</label>\n            </p>\n            <p class=\"uk-form-controls-condensed\">\n                <label><input type=\"checkbox\" value=\"1\" v-model=\"$root.config.debug.enabled\" :disabled=\"!sqlite\"> {{ 'Enable debug toolbar' | trans }}</label>\n            </p>\n            <p class=\"uk-form-help-block\" v-if=\"!sqlite\">{{ 'Please enable the SQLite database extension.' | trans }}</p>\n            <p class=\"uk-form-help-block\" v-if=\"$root.config.application.debug || $root.config.debug.enabled\">{{ 'Please note that enabling debug mode or toolbar has serious security implications.' | trans }}</p>\n        </div>\n    </div>\n\n</template>\n\n<script>\n\n    module.exports = {\n\n        section: {\n            label: 'System',\n            icon: 'pk-icon-large-settings',\n            priority: 10\n        },\n\n        props: ['config', 'options'],\n\n        data: function () {\n            return window.$system;\n        }\n\n    };\n\n</script>\n", "<?php\n\nnamespace Pagekit\\User\\Controller;\n\nuse Pagekit\\Application as App;\nuse Pagekit\\Application\\Exception;\nuse Pagekit\\User\\Model\\User;\n\nclass ResetPasswordController\n{\n\n    public function indexAction()\n    {\n        if (App::user()->isAuthenticated()) {\n            return App::redirect();\n        }\n\n        return [\n            '$view' => [\n                'title' => __('Reset'),\n                'name' => 'system/user/reset-request.php',\n            ],\n            'error' => ''\n        ];\n    }\n\n    /**\n     * @Request({\"email\"})\n     */\n    public function requestAction($email)\n    {\n        try {\n\n            if (App::user()->isAuthenticated()) {\n                return App::redirect();\n            }\n\n            if (!App::csrf()->validate()) {\n                throw new Exception(__('Invalid token. Please try again.'));\n            }\n\n            if (empty($email)) {\n                throw new Exception(__('Enter a valid email address.'));\n            }\n\n            if (!$user = User::findByEmail($email)) {\n                throw new Exception(__('Unknown email address.'));\n            }\n\n            if ($user->isBlocked()) {\n                throw new Exception(__('Your account has not been activated or is blocked.'));\n            }\n\n            $key = App::get('auth.random')->generateString(32);\n            $url = App::url('@user/resetpassword/confirm', compact('key'), 0);\n\n            try {\n\n                $mail = App::mailer()->create();\n                $mail->setTo($user->email)\n                    ->setSubject(__('Reset password for %site%.', ['%site%' => App::module('system/site')->config('title')]))\n                    ->setBody(App::view('system/user:mails/reset.php', compact('user', 'url', 'mail')), 'text/html')\n                    ->send();\n\n            } catch (\\Exception $e) {\n                throw new Exception(__('Unable to send confirmation link.'));\n            }\n\n            $user->activation = $key;\n            $user->save();\n\n            App::message()->success(__('Check your email for the confirmation link.'));\n\n            return App::redirect('@user/login');\n\n        } catch (Exception $e) {\n            return [\n                '$view' => [\n                    'title' => __('Reset'),\n                    'name' => 'system/user/reset-request.php',\n                ],\n                'error' => $e->getMessage()\n            ];\n        }\n    }\n\n    /**\n     * @Request({\"key\", \"password\"})\n     */\n    public function confirmAction($activation = '', $password = '')\n    {\n        if ($activation and $user = User::where(compact('activation'))->first()) {\n\n            App::session()->set('activation', [\n                'key' => $activation,\n                'user' => $user->id,\n            ]);\n\n            $user->activation = null;\n            $user->save();\n        }\n\n        if (!$data = App::session()->get('activation') or $data['key'] != $activation) {\n            App::abort(400, __('Invalid key.'));\n        }\n\n        if (!$user = User::find($data['user']) or $user->isBlocked()) {\n            App::abort(400, __('Your account has not been activated or is blocked.'));\n        }\n\n        if ('POST' === App::request()->getMethod()) {\n\n            try {\n\n                if (!App::csrf()->validate()) {\n                    throw new Exception(__('Invalid token. Please try again.'));\n                }\n\n                if (empty($password)) {\n                    throw new Exception(__('Enter password.'));\n                }\n\n                if ($password != trim($password)) {\n                    throw new Exception(__('Invalid password.'));\n                }\n\n                $user->activation = null;\n                $user->password = App::get('auth.password')->hash($password);\n                $user->save();\n\n                App::session()->remove('activation');\n                App::message()->success(__('Your password has been reset.'));\n\n                return App::redirect('@user/login');\n\n            } catch (Exception $e) {\n                $error = $e->getMessage();\n            }\n        }\n\n        return [\n            '$view' => [\n                'title' => __('Reset Confirm'),\n                'name' => 'system/user/reset-confirm.php'\n            ],\n            'activation' => $activation,\n            'error' => isset($error) ? $error : ''\n        ];\n    }\n\n}\n", "<?php $view->script('uikit-form-password') ?>\n\n<form class=\"pk-user pk-user-reset uk-form uk-form-stacked uk-width-medium-1-2 uk-width-large-1-3 uk-container-center\" action=\"<?= $view->url('@user/resetpassword/confirm', ['key' => $activation]) ?>\" method=\"post\">\n\n    <?php if($error): ?>\n    <div class=\"uk-alert uk-alert-danger\">\n        <?= $error; ?>\n    </div>\n    <?php endif; ?>\n\n    <h1 class=\"uk-h2 uk-text-center\"><?= __('Password Confirmation') ?></h1>\n\n    <div class=\"uk-form-row js-password\">\n        <div class=\"uk-form-password uk-width-1-1\">\n            <input class=\"uk-width-1-1\" type=\"password\" name=\"password\" value=\"\" placeholder=\"<?= __('New Password') ?>\">\n            <a href=\"\" class=\"uk-form-password-toggle\" tabindex=\"-1\" data-uk-form-password=\"{ lblShow: '<?= __('Show') ?>', lblHide: '<?= __('Hide') ?>' }\"><?= __('Show') ?></a>\n        </div>\n    </div>\n\n    <p class=\"uk-form-row\">\n        <button class=\"uk-button uk-button-primary uk-button-large uk-width-1-1\" type=\"submit\"><?= __('Confirm') ?></button>\n    </p>\n\n    <?php $view->token()->get() ?>\n\n</form>\n"], "filenames": ["CHANGELOG.md", "app/system/config.php", "app/system/modules/settings/app/components/system.vue", "app/system/modules/user/src/Controller/ResetPasswordController.php", "app/system/modules/user/views/reset-confirm.php"], "buggy_code_start_loc": [1, 7, 36, 28, 3], "buggy_code_end_loc": [1, 8, 36, 137, 4], "fixing_code_start_loc": [2, 7, 37, 28, 3], "fixing_code_end_loc": [7, 8, 38, 145, 4], "type": "CWE-640", "message": "An issue was discovered in Pagekit CMS before 1.0.11. In this vulnerability the remote attacker is able to reset the registered user's password, when the debug toolbar is enabled. The password is successfully recovered using this exploit. The SecureLayer7 ID is SL7_PGKT_01.", "other": {"cve": {"id": "CVE-2017-5594", "sourceIdentifier": "cve@mitre.org", "published": "2017-01-25T18:59:00.153", "lastModified": "2021-01-08T13:52:39.273", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "An issue was discovered in Pagekit CMS before 1.0.11. In this vulnerability the remote attacker is able to reset the registered user's password, when the debug toolbar is enabled. The password is successfully recovered using this exploit. The SecureLayer7 ID is SL7_PGKT_01."}, {"lang": "es", "value": "Se descubri\u00f3 un problema en Pagekit CMS en versiones anteriores a 1.0.11. En esta vulnerabilidad el atacante remoto es capaz de restablecer la contrase\u00f1a del usuario registrado, cuando la barra de herramienta de depuraci\u00f3n est\u00e1 habilitada. La contrase\u00f1a se recupera con \u00e9xito utilizando este exploit. El ID de SecureLayer7 es SL7_PGKT_01."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.6, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:N/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-640"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:pagekit:pagekit:*:*:*:*:*:*:*:*", "versionEndIncluding": "1.0.10", "matchCriteriaId": "6AADEFDE-AA29-4ABE-A1DA-BBE3841838B1"}]}]}], "references": [{"url": "http://www.securityfocus.com/bid/95806", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/pagekit/pagekit/commit/e0454f9c037c427a5ff76a57e78dbf8cc00c268b", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://securelayer7.net/download/pdf/SecureLayer7-Pentest-report-Pagekit-CMS.pdf", "source": "cve@mitre.org", "tags": ["Technical Description", "Third Party Advisory"]}, {"url": "https://securelayer7.net/download/poc/password-reset-vulnerability-exploit-ruby-pagekit-cms.rb.txt", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://www.exploit-db.com/exploits/41143/", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/pagekit/pagekit/commit/e0454f9c037c427a5ff76a57e78dbf8cc00c268b"}}