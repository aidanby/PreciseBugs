{"buggy_code": ["<?php\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\n//check permissions\n\trequire_once \"resources/check_auth.php\";\n\tif (permission_exists('conference_profile_param_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get variables used to control the order\n\t$order_by = $_GET[\"order_by\"];\n\t$order = $_GET[\"order\"];\n\n//additional includes\n\trequire_once \"resources/header.php\";\n\trequire_once \"resources/paging.php\";\n\n//prepare to page the results\n\t$sql = \"select count(*) from v_conference_profile_params \";\n\t$sql .= \"where conference_profile_uuid = :conference_profile_uuid \";\n\t$parameters['conference_profile_uuid'] = $conference_profile_uuid;\n\t$database = new database;\n\t$num_rows = $database->select($sql, $parameters, 'column');\n\tunset($sql);\n\n//prepare to page the results\n\t$rows_per_page = ($_SESSION['domain']['paging']['numeric'] != '') ? $_SESSION['domain']['paging']['numeric'] : 50;\n\t$param = \"\";\n\t$page = $_GET['page'];\n\tif (strlen($page) == 0) { $page = 0; $_GET['page'] = 0; }\n\tlist($paging_controls, $rows_per_page, $var3) = paging($num_rows, $param, $rows_per_page);\n\t$offset = $rows_per_page * $page;\n\n//get the list\n\t$sql = \"select * from v_conference_profile_params \";\n\t$sql .= \"where conference_profile_uuid = :conference_profile_uuid \";\n\t$sql .= order_by($order_by, $order);\n\t$sql .= limit_offset($rows_per_page, $offset);\n\t$database = new database;\n\t$result = $database->select($sql, $parameters, 'all');\n\tunset($sql, $parameters);\n\n//alternate the row style\n\t$c = 0;\n\t$row_style[\"0\"] = \"row_style0\";\n\t$row_style[\"1\"] = \"row_style1\";\n\n//show the content\n\techo \"<table width='100%' border='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td align='left' colspan='2'>\\n\";\n\techo \"\t\t\t\".$text['title_description-conference_profile_param'].\"<br /><br />\\n\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\n\techo \"<table class='tr_hover' width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"<tr>\\n\";\n\techo th_order_by('profile_param_name', $text['label-profile_param_name'], $order_by, $order);\n\techo th_order_by('profile_param_value', $text['label-profile_param_value'], $order_by, $order);\n\techo th_order_by('profile_param_enabled', $text['label-profile_param_enabled'], $order_by, $order);\n\techo th_order_by('profile_param_description', $text['label-profile_param_description'], $order_by, $order);\n\techo \"<td class='list_control_icons'>\";\n\tif (permission_exists('conference_profile_param_add')) {\n\t\techo \"<a href='conference_profile_param_edit.php?conference_profile_uuid=\".$_GET['id'].\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \"&nbsp;\\n\";\n\t}\n\techo \"</td>\\n\";\n\techo \"<tr>\\n\";\n\n\tif (is_array($result) && sizeof($result) != 0) {\n\t\tforeach($result as $row) {\n\t\t\tif (permission_exists('conference_profile_param_edit')) {\n\t\t\t\t$tr_link = \"href='conference_profile_param_edit.php?conference_profile_uuid=\".$row['conference_profile_uuid'].\"&id=\".$row['conference_profile_param_uuid'].\"'\";\n\t\t\t}\n\t\t\techo \"<tr \".$tr_link.\">\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['profile_param_name']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['profile_param_value']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['profile_param_enabled']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['profile_param_description']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td class='list_control_icons'>\";\n\t\t\tif (permission_exists('conference_profile_param_edit')) {\n\t\t\t\techo \"<a href='conference_profile_param_edit.php?conference_profile_uuid=\".escape($row['conference_profile_uuid']).\"&id=\".escape($row['conference_profile_param_uuid']).\"' alt='\".$text['button-edit'].\"'>$v_link_label_edit</a>\";\n\t\t\t}\n\t\t\tif (permission_exists('conference_profile_param_delete')) {\n\t\t\t\techo \"<a href='conference_profile_param_delete.php?conference_profile_uuid=\".escape($row['conference_profile_uuid']).\"&id=\".escape($row['conference_profile_param_uuid']).\"' alt='\".$text['button-delete'].\"' onclick=\\\"return confirm('\".$text['confirm-delete'].\"')\\\">$v_link_label_delete</a>\";\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t} //end foreach\n\t\tunset($result);\n\t} //end if results\n\n\techo \"<tr>\\n\";\n\techo \"<td colspan='5' align='left'>\\n\";\n\techo \"\t<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='33.3%' nowrap='nowrap'>&nbsp;</td>\\n\";\n\techo \"\t\t<td width='33.3%' align='center' nowrap='nowrap'>$paging_controls</td>\\n\";\n\techo \"\t\t<td class='list_control_icons'>\";\n\tif (permission_exists('conference_profile_param_add')) {\n\t\techo \t\t\"<a href='conference_profile_param_edit.php?conference_profile_uuid=\".$_GET['id'].\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \t\t\"&nbsp;\";\n\t}\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n \techo \"\t</table>\\n\";\n\techo \"</td>\\n\";\n\techo \"</tr>\\n\";\n\techo \"</table>\";\n\techo \"<br /><br />\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "fixing_code": ["<?php\n\n//includes\n\trequire_once \"root.php\";\n\trequire_once \"resources/require.php\";\n\n//check permissions\n\trequire_once \"resources/check_auth.php\";\n\tif (permission_exists('conference_profile_param_view')) {\n\t\t//access granted\n\t}\n\telse {\n\t\techo \"access denied\";\n\t\texit;\n\t}\n\n//add multi-lingual support\n\t$language = new text;\n\t$text = $language->get();\n\n//get variables used to control the order\n\t$order_by = $_GET[\"order_by\"];\n\t$order = $_GET[\"order\"];\n\n//additional includes\n\trequire_once \"resources/header.php\";\n\trequire_once \"resources/paging.php\";\n\n//prepare to page the results\n\t$sql = \"select count(*) from v_conference_profile_params \";\n\t$sql .= \"where conference_profile_uuid = :conference_profile_uuid \";\n\t$parameters['conference_profile_uuid'] = $conference_profile_uuid;\n\t$database = new database;\n\t$num_rows = $database->select($sql, $parameters, 'column');\n\tunset($sql);\n\n//prepare to page the results\n\t$rows_per_page = ($_SESSION['domain']['paging']['numeric'] != '') ? $_SESSION['domain']['paging']['numeric'] : 50;\n\t$param = \"\";\n\t$page = $_GET['page'];\n\tif (strlen($page) == 0) { $page = 0; $_GET['page'] = 0; }\n\tlist($paging_controls, $rows_per_page, $var3) = paging($num_rows, $param, $rows_per_page);\n\t$offset = $rows_per_page * $page;\n\n//get the list\n\t$sql = \"select * from v_conference_profile_params \";\n\t$sql .= \"where conference_profile_uuid = :conference_profile_uuid \";\n\t$sql .= order_by($order_by, $order);\n\t$sql .= limit_offset($rows_per_page, $offset);\n\t$database = new database;\n\t$result = $database->select($sql, $parameters, 'all');\n\tunset($sql, $parameters);\n\n//alternate the row style\n\t$c = 0;\n\t$row_style[\"0\"] = \"row_style0\";\n\t$row_style[\"1\"] = \"row_style1\";\n\n//show the content\n\techo \"<table width='100%' border='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td align='left' colspan='2'>\\n\";\n\techo \"\t\t\t\".$text['title_description-conference_profile_param'].\"<br /><br />\\n\";\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n\techo \"</table>\\n\";\n\n\techo \"<table class='tr_hover' width='100%' border='0' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"<tr>\\n\";\n\techo th_order_by('profile_param_name', $text['label-profile_param_name'], $order_by, $order);\n\techo th_order_by('profile_param_value', $text['label-profile_param_value'], $order_by, $order);\n\techo th_order_by('profile_param_enabled', $text['label-profile_param_enabled'], $order_by, $order);\n\techo th_order_by('profile_param_description', $text['label-profile_param_description'], $order_by, $order);\n\techo \"<td class='list_control_icons'>\";\n\tif (permission_exists('conference_profile_param_add')) {\n\t\techo \"<a href='conference_profile_param_edit.php?conference_profile_uuid=\".escape($_GET['id']).\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \"&nbsp;\\n\";\n\t}\n\techo \"</td>\\n\";\n\techo \"<tr>\\n\";\n\n\tif (is_array($result) && sizeof($result) != 0) {\n\t\tforeach($result as $row) {\n\t\t\tif (permission_exists('conference_profile_param_edit')) {\n\t\t\t\t$tr_link = \"href='conference_profile_param_edit.php?conference_profile_uuid=\".$row['conference_profile_uuid'].\"&id=\".$row['conference_profile_param_uuid'].\"'\";\n\t\t\t}\n\t\t\techo \"<tr \".$tr_link.\">\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['profile_param_name']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['profile_param_value']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['profile_param_enabled']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td valign='top' class='\".$row_style[$c].\"'>\".escape($row['profile_param_description']).\"&nbsp;</td>\\n\";\n\t\t\techo \"\t<td class='list_control_icons'>\";\n\t\t\tif (permission_exists('conference_profile_param_edit')) {\n\t\t\t\techo \"<a href='conference_profile_param_edit.php?conference_profile_uuid=\".escape($row['conference_profile_uuid']).\"&id=\".escape($row['conference_profile_param_uuid']).\"' alt='\".$text['button-edit'].\"'>$v_link_label_edit</a>\";\n\t\t\t}\n\t\t\tif (permission_exists('conference_profile_param_delete')) {\n\t\t\t\techo \"<a href='conference_profile_param_delete.php?conference_profile_uuid=\".escape($row['conference_profile_uuid']).\"&id=\".escape($row['conference_profile_param_uuid']).\"' alt='\".$text['button-delete'].\"' onclick=\\\"return confirm('\".$text['confirm-delete'].\"')\\\">$v_link_label_delete</a>\";\n\t\t\t}\n\t\t\techo \"\t</td>\\n\";\n\t\t\techo \"</tr>\\n\";\n\t\t\tif ($c==0) { $c=1; } else { $c=0; }\n\t\t} //end foreach\n\t\tunset($result);\n\t} //end if results\n\n\techo \"<tr>\\n\";\n\techo \"<td colspan='5' align='left'>\\n\";\n\techo \"\t<table width='100%' cellpadding='0' cellspacing='0'>\\n\";\n\techo \"\t<tr>\\n\";\n\techo \"\t\t<td width='33.3%' nowrap='nowrap'>&nbsp;</td>\\n\";\n\techo \"\t\t<td width='33.3%' align='center' nowrap='nowrap'>$paging_controls</td>\\n\";\n\techo \"\t\t<td class='list_control_icons'>\";\n\tif (permission_exists('conference_profile_param_add')) {\n\t\techo \t\t\"<a href='conference_profile_param_edit.php?conference_profile_uuid=\".escape($_GET['id']).\"' alt='\".$text['button-add'].\"'>$v_link_label_add</a>\";\n\t}\n\telse {\n\t\techo \t\t\"&nbsp;\";\n\t}\n\techo \"\t\t</td>\\n\";\n\techo \"\t</tr>\\n\";\n \techo \"\t</table>\\n\";\n\techo \"</td>\\n\";\n\techo \"</tr>\\n\";\n\techo \"</table>\";\n\techo \"<br /><br />\";\n\n//include the footer\n\trequire_once \"resources/footer.php\";\n\n?>\n"], "filenames": ["app/conference_profiles/conference_profile_params.php"], "buggy_code_start_loc": [76], "buggy_code_end_loc": [117], "fixing_code_start_loc": [76], "fixing_code_end_loc": [117], "type": "CWE-79", "message": "In FusionPBX up to v4.5.7, the file app\\conference_profiles\\conference_profile_params.php uses an unsanitized \"id\" variable coming from the URL, which is reflected on 2 occasions in HTML, leading to XSS.", "other": {"cve": {"id": "CVE-2019-16981", "sourceIdentifier": "cve@mitre.org", "published": "2019-10-21T16:15:17.757", "lastModified": "2023-02-03T21:47:40.940", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In FusionPBX up to v4.5.7, the file app\\conference_profiles\\conference_profile_params.php uses an unsanitized \"id\" variable coming from the URL, which is reflected on 2 occasions in HTML, leading to XSS."}, {"lang": "es", "value": "En FusionPBX versiones hasta v4.5.7, el archivo app\\conference_profiles\\conference_profile_params.php utiliza una variable \"id\" no saneada que proviene de la URL, que es reflejada en 2 ocasiones en HTML, conllevando a una vulnerabilidad de tipo XSS."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fusionpbx:fusionpbx:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.5.7", "matchCriteriaId": "A5A0C1F9-8032-46C6-8DD4-DB91FACF7330"}]}]}], "references": [{"url": "https://github.com/fusionpbx/fusionpbx/commit/021ff8f8e51cd1254d19e88e7aedc4b795067f8d", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://resp3ctblog.wordpress.com/2019/10/19/fusionpbx-xss-13/", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fusionpbx/fusionpbx/commit/021ff8f8e51cd1254d19e88e7aedc4b795067f8d"}}