{"buggy_code": ["<?php\n    echo $this->Html->script('d3');\n    echo $this->Html->script('cal-heatmap');\n    echo $this->Html->css('cal-heatmap');\n?>\n<div class = \"index\">\n    <h2><?php echo __('Statistics');?></h2>\n    <?php\n        echo $this->element('Users/statisticsMenu');\n        $types = array(\n                'local' => array('selected' => false, 'text' => __('Local organisations')),\n                'external' => array('selected' => false, 'text' => __('Known remote organisations')),\n                'all' => array('selected' => false, 'text' => __('All organisations'))\n        );\n        $types[$scope]['selected'] = true;\n    ?>\n    <h4><?php echo __('Organisation list');?></h4>\n    <p><?php echo __('Quick overview over the organisations residing on or known by this instance.');?></p>\n    <div class=\"tabMenuFixedContainer\" style=\"display:inline-block;\">\n            <?php\n                foreach ($types as $key => $value):\n            ?>\n                <span class=\"tabMenuFixed tabMenuFixedCenter tabMenuSides useCursorPointer <?php if ($value['selected']) echo 'tabMenuActive'; ?>\" onclick=\"window.location='/users/statistics/orgs/scope:<?php echo h($key);?>'\"><?php echo h($value['text']); ?></span>\n            <?php\n                endforeach;\n            ?>\n    </div>\n    <table class=\"table table-striped table-hover table-condensed\" style=\"width:50%;\">\n    <tr>\n            <th><?php echo __('Logo');?></th>\n            <th><?php echo __('Name');?></th>\n            <th><?php echo __('Users');?></th>\n            <th><?php echo __('Events');?></th>\n            <th><?php echo __('Attributes');?></th>\n            <th><?php echo __('Nationality');?></th>\n            <th><?php echo __('Type');?></th>\n            <th><?php echo __('Sector');?></th>\n            <th><?php echo __('Activity (1 year)');?></th>\n    </tr>\n    <?php\n        foreach ($orgs as $data):\n    ?>\n        <tr class=\"org_row\" data-orgid=\"<?php echo h($data['id']); ?>\">\n            <td class=\"short\">\n                <?php\n                    echo $this->OrgImg->getOrgImg(array('name' => $data['name'], 'id' => $data['id'], 'size' => 24));\n                ?>\n            </td>\n            <td class=\"short\"><?php echo h($data['name']); ?></td>\n            <td class=\"short\"><span class=\"<?php echo isset($data['userCount']) ? 'blue bold' : 'grey'; ?>\"><?php echo isset($data['userCount']) ? h($data['userCount']) : '0';?></span></td>\n            <td class=\"short\"><span class=\"<?php echo isset($data['eventCount']) ? 'blue bold' : 'grey'; ?>\"><?php echo isset($data['eventCount']) ? h($data['eventCount']) : '0';?></span></td>\n            <td class=\"short\"><span class=\"<?php echo isset($data['attributeCount']) ? 'blue bold' : 'grey'; ?>\"><?php echo isset($data['attributeCount']) ? h($data['attributeCount']) : '0';?></span></td>\n            <td class=\"shortish\"><?php echo isset($data['nationality']) && $data['nationality'] !== 'Not specified' ? h($data['nationality']) : '&nbsp;'; ?></td>\n            <td class=\"shortish\"><?php echo isset($data['type']) ? h($data['type']) : '&nbsp;'; ?></td>\n            <td class=\"shortish\"><?php echo isset($data['sector']) ? h($data['sector']) : '&nbsp;'; ?></td>\n            <td class=\"shortish\">\n                <?php\n                    if (isset($data['orgActivity'])) {\n                        echo $this->element('sparkline', array('scope' => 'organisation', 'id' => $data['id'], 'csv' => $data['orgActivity']['csv']));\n                    }\n                ?>\n            </td>\n        </tr>\n    <?php\n        endforeach;\n    ?>\n    </table>\n</div>\n<?php\n    echo $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'globalActions', 'menuItem' => 'statistics'));\n?>\n<script type=\"text/javascript\">\n    $('.org_row').click(function() {\n        window.location = \"<?php echo $baseurl; ?>/organisations/view/\" + $(this).data('orgid');\n    });\n</script>\n"], "fixing_code": ["<?php\n    echo $this->Html->script('d3');\n    echo $this->Html->script('cal-heatmap');\n    echo $this->Html->css('cal-heatmap');\n?>\n<div class = \"index\">\n    <h2><?php echo __('Statistics');?></h2>\n    <?php\n        echo $this->element('Users/statisticsMenu');\n        $types = array(\n                'local' => array('selected' => false, 'text' => __('Local organisations')),\n                'external' => array('selected' => false, 'text' => __('Known remote organisations')),\n                'all' => array('selected' => false, 'text' => __('All organisations'))\n        );\n        if (isset($types[$scope])) {\n            $types[$scope]['selected'] = true;\n        }\n    ?>\n    <h4><?php echo __('Organisation list');?></h4>\n    <p><?php echo __('Quick overview over the organisations residing on or known by this instance.');?></p>\n    <div class=\"tabMenuFixedContainer\" style=\"display:inline-block;\">\n            <?php\n                foreach ($types as $key => $value):\n            ?>\n                <span class=\"tabMenuFixed tabMenuFixedCenter tabMenuSides useCursorPointer <?php if ($value['selected']) echo 'tabMenuActive'; ?>\" onclick=\"window.location='/users/statistics/orgs/scope:<?php echo h($key);?>'\"><?php echo h($value['text']); ?></span>\n            <?php\n                endforeach;\n            ?>\n    </div>\n    <table class=\"table table-striped table-hover table-condensed\" style=\"width:50%;\">\n    <tr>\n            <th><?php echo __('Logo');?></th>\n            <th><?php echo __('Name');?></th>\n            <th><?php echo __('Users');?></th>\n            <th><?php echo __('Events');?></th>\n            <th><?php echo __('Attributes');?></th>\n            <th><?php echo __('Nationality');?></th>\n            <th><?php echo __('Type');?></th>\n            <th><?php echo __('Sector');?></th>\n            <th><?php echo __('Activity (1 year)');?></th>\n    </tr>\n    <?php\n        foreach ($orgs as $data):\n    ?>\n        <tr class=\"org_row\" data-orgid=\"<?php echo h($data['id']); ?>\">\n            <td class=\"short\">\n                <?php\n                    echo $this->OrgImg->getOrgImg(array('name' => $data['name'], 'id' => $data['id'], 'size' => 24));\n                ?>\n            </td>\n            <td class=\"short\"><?php echo h($data['name']); ?></td>\n            <td class=\"short\"><span class=\"<?php echo isset($data['userCount']) ? 'blue bold' : 'grey'; ?>\"><?php echo isset($data['userCount']) ? h($data['userCount']) : '0';?></span></td>\n            <td class=\"short\"><span class=\"<?php echo isset($data['eventCount']) ? 'blue bold' : 'grey'; ?>\"><?php echo isset($data['eventCount']) ? h($data['eventCount']) : '0';?></span></td>\n            <td class=\"short\"><span class=\"<?php echo isset($data['attributeCount']) ? 'blue bold' : 'grey'; ?>\"><?php echo isset($data['attributeCount']) ? h($data['attributeCount']) : '0';?></span></td>\n            <td class=\"shortish\"><?php echo isset($data['nationality']) && $data['nationality'] !== 'Not specified' ? h($data['nationality']) : '&nbsp;'; ?></td>\n            <td class=\"shortish\"><?php echo isset($data['type']) ? h($data['type']) : '&nbsp;'; ?></td>\n            <td class=\"shortish\"><?php echo isset($data['sector']) ? h($data['sector']) : '&nbsp;'; ?></td>\n            <td class=\"shortish\">\n                <?php\n                    if (isset($data['orgActivity'])) {\n                        echo $this->element('sparkline', array('scope' => 'organisation', 'id' => $data['id'], 'csv' => $data['orgActivity']['csv']));\n                    }\n                ?>\n            </td>\n        </tr>\n    <?php\n        endforeach;\n    ?>\n    </table>\n</div>\n<?php\n    echo $this->element('/genericElements/SideMenu/side_menu', array('menuList' => 'globalActions', 'menuItem' => 'statistics'));\n?>\n<script type=\"text/javascript\">\n    $('.org_row').click(function() {\n        window.location = \"<?php echo $baseurl; ?>/organisations/view/\" + $(this).data('orgid');\n    });\n</script>\n"], "filenames": ["app/View/Users/statistics_orgs.ctp"], "buggy_code_start_loc": [15], "buggy_code_end_loc": [16], "fixing_code_start_loc": [15], "fixing_code_end_loc": [18], "type": "CWE-79", "message": "MISP 2.4.122 has reflected XSS via unsanitized URL parameters. This is related to app/View/Users/statistics_orgs.ctp.", "other": {"cve": {"id": "CVE-2020-10246", "sourceIdentifier": "cve@mitre.org", "published": "2020-03-09T19:15:15.240", "lastModified": "2023-03-01T18:39:29.767", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "MISP 2.4.122 has reflected XSS via unsanitized URL parameters. This is related to app/View/Users/statistics_orgs.ctp."}, {"lang": "es", "value": "MISP versi\u00f3n 2.4.122, presenta una vulnerabilidad de tipo XSS reflejado por medio de par\u00e1metros URL no saneados. Esto est\u00e1 relacionado con el archivo app/View/Users/statistics_orgs.ctp."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp:misp:2.4.122:*:*:*:*:*:*:*", "matchCriteriaId": "14439417-C970-4F58-96CC-E0B1C9566B74"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/43a0757fb33769d9ad4ca09e8f2ac572f9f6a491", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/MISP/MISP/releases/tag/v2.4.123", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/43a0757fb33769d9ad4ca09e8f2ac572f9f6a491"}}