{"buggy_code": ["# Changelog\n\nAll notable changes to Gogs are documented in this file.\n\n## 0.13.0+dev (`main`)\n\n### Added\n\n- An unlisted option is added when create or migrate a repository. Unlisted repositories are public but not being listed for users without direct access in the UI. [#5733](https://github.com/gogs/gogs/issues/5733)\n- New configuration option `[git.timeout] DIFF` for customizing operation timeout of `git diff`. [#6315](https://github.com/gogs/gogs/issues/6315)\n- New configuration option `[server] SSH_SERVER_MACS` for setting list of accepted MACs for connections to builtin SSH server. [#6434](https://github.com/gogs/gogs/issues/6434)\n- Support specifying custom schema for PostgreSQL. [#6695](https://github.com/gogs/gogs/pull/6695)\n- Support rendering Mermaid diagrams in Markdown. [#6776](https://github.com/gogs/gogs/pull/6776)\n- New languages support: Mongolian. [#6510](https://github.com/gogs/gogs/pull/6510)\n\n### Changed\n\n- The default branch has been changed to `main`. [#6285](https://github.com/gogs/gogs/pull/6285)\n- MSSQL as database backend is deprecated, installation page no longer shows it as an option. Existing installations and manually craft configuration file continue to work. [#6295](https://github.com/gogs/gogs/pull/6295)\n- Use [Task](https://github.com/go-task/task) as the build tool. [#6297](https://github.com/gogs/gogs/pull/6297)\n- The required Go version to compile source code changed to 1.16.\n- Access tokens are now stored using their SHA256 hashes instead of raw values. [#7008](https://github.com/gogs/gogs/pull/7008)\n\n### Fixed\n\n- _Security:_ OS Command Injection in file editor. [#7000](https://github.com/gogs/gogs/issues/7000)\n- _Security:_ Sanitize `DisplayName` in repository issue list. [#7009](https://github.com/gogs/gogs/pull/7009)\n- Unable to use LDAP authentication on ARM machines. [#6761](https://github.com/gogs/gogs/issues/6761)\n- Unable to init repository during creation on Windows. [#6967](https://github.com/gogs/gogs/issues/6967)\n- Mysterious panic on `Value not found for type *repo.HTTPContext`. [#6963](https://github.com/gogs/gogs/issues/6963)\n\n### Removed\n\n- \u26a0\ufe0f Migrations before 0.12 are removed, installations not on 0.12 should upgrade to it to run the migrations and then upgrade to 0.13.\n- Configuration section `[mailer]` is no longer used, please use `[email]`.\n- Configuration section `[service]` is no longer used, please use `[auth]`.\n- Configuration option `APP_NAME` is no longer used, please use `BRAND_NAME`.\n- Configuration option `[security] REVERSE_PROXY_AUTHENTICATION_USER` is no longer used, please use `[auth] REVERSE_PROXY_AUTHENTICATION_HEADER`.\n- Configuration option `[auth] ACTIVE_CODE_LIVE_MINUTES` is no longer used, please use `[auth] ACTIVATE_CODE_LIVES`.\n- Configuration option `[auth] RESET_PASSWD_CODE_LIVE_MINUTES` is no longer used, please use `[auth] RESET_PASSWORD_CODE_LIVES`.\n- Configuration option `[auth] ENABLE_CAPTCHA` is no longer used, please use `[auth] ENABLE_REGISTRATION_CAPTCHA`.\n- Configuration option `[auth] ENABLE_NOTIFY_MAIL` is no longer used, please use `[user] ENABLE_EMAIL_NOTIFICATION`.\n- Configuration option `[auth] REGISTER_EMAIL_CONFIRM` is no longer used, please use `[auth] REQUIRE_EMAIL_CONFIRMATION`.\n- Configuration option `[session] GC_INTERVAL_TIME` is no longer used, please use `[session] GC_INTERVAL`.\n- Configuration option `[session] SESSION_LIFE_TIME` is no longer used, please use `[session] MAX_LIFE_TIME`.\n- Configuration option `[server] ROOT_URL` is no longer used, please use `[server] EXTERNAL_URL`.\n- Configuration option `[server] LANDING_PAGE` is no longer used, please use `[server] LANDING_URL`.\n- Configuration option `[database] DB_TYPE` is no longer used, please use `[database] TYPE`.\n- Configuration option `[database] PASSWD` is no longer used, please use `[database] PASSWORD`.\n- Remove option to use Makefile as the build tool. [#6980](https://github.com/gogs/gogs/pull/6980)\n\n## 0.12.8\n\n### Changed\n\n- All users (including admins) need to use the configuration option `[security] LOCAL_NETWORK_ALLOWLIST` to allow repository migration and webhooks to be able to access local network addresses, which is a comma separated list of hostnames. [#6988](https://github.com/gogs/gogs/pull/6988)\n\n### Fixed\n\n- _Security:_ SSRF in webhook. [#6901](https://github.com/gogs/gogs/issues/6901)\n- _Security:_ XSS in cookies. [#6953](https://github.com/gogs/gogs/issues/6953)\n- _Security:_ OS Command Injection in file uploading. [#6968](https://github.com/gogs/gogs/issues/6968)\n- _Security:_ Remote Command Execution in file editing. [#6555](https://github.com/gogs/gogs/issues/6555)\n\n## 0.12.7\n\n### Fixed\n\n- _Security:_ Stored XSS in issues. [#6919](https://github.com/gogs/gogs/issues/6919)\n- Invalid character in `Access-Control-Allow-Credentials` response header. [#4983](https://github.com/gogs/gogs/issues/4983)\n- Mysterious `ssh: overflow reading version string` errors from builtin SSH server. [#6882](https://github.com/gogs/gogs/issues/6882)\n\n## 0.12.6\n\n### Fixed\n\n- _Security:_ Remote command execution in file uploading. [#6833](https://github.com/gogs/gogs/issues/6833)\n- _Regression:_ Unable to migrate repository from other local Git hosting. Added a new configuration option `[security] LOCAL_NETWORK_ALLOWLIST`, which is a comma separated list of hostnames that are explicitly allowed to be accessed within the local network. [#6841](https://github.com/gogs/gogs/issues/6841)\n- Slow start of Docker containers using NAS devices. [#6554](https://github.com/gogs/gogs/issues/6554)\n\n## 0.12.5\n\n### Fixed\n\n- _Security:_ Potential SSRF in repository migration. [#6754](https://github.com/gogs/gogs/issues/6754)\n- _Security:_ Improper PAM authorization handling. [#6810](https://github.com/gogs/gogs/issues/6810)\n\n## 0.12.4\n\n### Fixed\n\n- _Security:_ Potential SSRF attack by CRLF injection via repository migration. [#6413](https://github.com/gogs/gogs/issues/6413)\n- _Regression:_ Fixed smart links for issues stops rendering. [#6506](https://github.com/gogs/gogs/issues/6506)\n- Added `X-Frame-Options` header to prevent Clickjacking. [#6409](https://github.com/gogs/gogs/issues/6409)\n\n## 0.12.3\n\n### Fixed\n\n- _Regression:_ When running Gogs on Windows, push commits no longer fail on a daily basis with the error \"pre-receive hook declined\". [#6316](https://github.com/gogs/gogs/issues/6316)\n- Auto-linked commit SHAs now have correct links. [#6300](https://github.com/gogs/gogs/issues/6300)\n- Git LFS client (with version >= 2.5.0) wasn't able to upload files with known format (e.g. PNG, JPEG), and the server is expecting the HTTP Header `Content-Type` to be `application/octet-stream`. The server now tells the LFS client to always use `Content-Type: application/octet-stream` when upload files.\n\n## 0.12.2\n\n### Fixed\n\n- _Regression:_ Pages are correctly rendered when requesting `?go-get=1` for subdirectories. [#6314](https://github.com/gogs/gogs/issues/6314)\n- _Regression:_ Submodule with a relative path is linked correctly. [#6319](https://github.com/gogs/gogs/issues/6319)\n- Backup can be processed when `--target` is specified on Windows. [#6339](https://github.com/gogs/gogs/issues/6339)\n- Commit message contains keywords look like an issue reference no longer fails the push entirely. [#6289](https://github.com/gogs/gogs/issues/6289)\n\n## 0.12.1\n\n### Fixed\n\n- The `updated_at` field is now correctly updated when updates an issue. [#6209](https://github.com/gogs/gogs/issues/6209)\n- Fixed a regression which created `login_source.cfg` column to have `VARCHAR(255)` instead of `TEXT` in MySQL. [#6280](https://github.com/gogs/gogs/issues/6280)\n\n## 0.12.0\n\n### Added\n\n- Support for Git LFS, you can read documentation for both [user](https://github.com/gogs/gogs/blob/main/docs/user/lfs.md) and [admin](https://github.com/gogs/gogs/blob/main/docs/admin/lfs.md). [#1322](https://github.com/gogs/gogs/issues/1322)\n- Allow admin to remove observers from the repository. [#5803](https://github.com/gogs/gogs/pull/5803)\n- Use `Last-Modified` HTTP header for raw files. [#5811](https://github.com/gogs/gogs/issues/5811)\n- Support syntax highlighting for SAS code files (i.e. `.r`, `.sas`, `.tex`, `.yaml`). [#5856](https://github.com/gogs/gogs/pull/5856)\n- Able to fill in pull request title with a template. [#5901](https://github.com/gogs/gogs/pull/5901)\n- Able to override static files under `public/` directory, please refer to [documentation](https://gogs.io/docs/features/custom_template) for usage. [#5920](https://github.com/gogs/gogs/pull/5920)\n- New API endpoint `GET /admin/teams/:teamid/members` to list members of a team. [#5877](https://github.com/gogs/gogs/issues/5877)\n- Support backup with retention policy for Docker deployments. [#6140](https://github.com/gogs/gogs/pull/6140)\n\n### Changed\n\n- The organization profile page has changed to display at most 12 members. [#5506](https://github.com/gogs/gogs/issues/5506)\n- The required Go version to compile source code changed to 1.14.\n- All assets are now embedded into binary and served from memory by default. Set `[server] LOAD_ASSETS_FROM_DISK = true` to load them from disk. [#5920](https://github.com/gogs/gogs/pull/5920)\n- Application and Go versions are removed from page footer and only show in the admin dashboard.\n- Build tag for running as Windows Service has been changed from `miniwinsvc` to `minwinsvc`.\n- Configuration option `APP_NAME` is deprecated and will end support in 0.13.0, please start using `BRAND_NAME`.\n- Configuration option `[server] ROOT_URL` is deprecated and will end support in 0.13.0, please start using `[server] EXTERNAL_URL`.\n- Configuration option `[server] LANDING_PAGE` is deprecated and will end support in 0.13.0, please start using `[server] LANDING_URL`.\n- Configuration option `[database] DB_TYPE` is deprecated and will end support in 0.13.0, please start using `[database] TYPE`.\n- Configuration option `[database] PASSWD` is deprecated and will end support in 0.13.0, please start using `[database] PASSWORD`.\n- Configuration option `[security] REVERSE_PROXY_AUTHENTICATION_USER` is deprecated and will end support in 0.13.0, please start using `[auth] REVERSE_PROXY_AUTHENTICATION_HEADER`.\n- Configuration section `[mailer]` is deprecated and will end support in 0.13.0, please start using `[email]`.\n- Configuration section `[service]` is deprecated and will end support in 0.13.0, please start using `[auth]`.\n- Configuration option `[auth] ACTIVE_CODE_LIVE_MINUTES` is deprecated and will end support in 0.13.0, please start using `[auth] ACTIVATE_CODE_LIVES`.\n- Configuration option `[auth] RESET_PASSWD_CODE_LIVE_MINUTES` is deprecated and will end support in 0.13.0, please start using `[auth] RESET_PASSWORD_CODE_LIVES`.\n- Configuration option `[auth] REGISTER_EMAIL_CONFIRM` is deprecated and will end support in 0.13.0, please start using `[auth] REQUIRE_EMAIL_CONFIRMATION`.\n- Configuration option `[auth] ENABLE_CAPTCHA` is deprecated and will end support in 0.13.0, please start using `[auth] ENABLE_REGISTRATION_CAPTCHA`.\n- Configuration option `[auth] ENABLE_NOTIFY_MAIL` is deprecated and will end support in 0.13.0, please start using `[user] ENABLE_EMAIL_NOTIFICATION`.\n- Configuration option `[session] GC_INTERVAL_TIME` is deprecated and will end support in 0.13.0, please start using `[session] GC_INTERVAL`.\n- Configuration option `[session] SESSION_LIFE_TIME` is deprecated and will end support in 0.13.0, please start using `[session] MAX_LIFE_TIME`.\n- The name `-` is reserved and cannot be used for users or organizations.\n\n### Fixed\n\n- [Security] Potential open redirection with i18n.\n- [Security] Potential ability to delete files outside a repository.\n- [Security] Potential ability to set primary email on others' behalf from their verified emails.\n- [Security] Potential XSS attack via `.ipynb`. [#5170](https://github.com/gogs/gogs/issues/5170)\n- [Security] Potential SSRF attack via webhooks. [#5366](https://github.com/gogs/gogs/issues/5366)\n- [Security] Potential CSRF attack in admin panel. [#5367](https://github.com/gogs/gogs/issues/5367)\n- [Security] Potential stored XSS attack in some browsers. [#5397](https://github.com/gogs/gogs/issues/5397)\n- [Security] Potential RCE on mirror repositories. [#5767](https://github.com/gogs/gogs/issues/5767)\n- [Security] Potential XSS attack with raw markdown API. [#5907](https://github.com/gogs/gogs/pull/5907)\n- File both modified and renamed within a commit treated as separate files. [#5056](https://github.com/gogs/gogs/issues/5056)\n- Unable to restore the database backup to MySQL 8.0 with syntax error. [#5602](https://github.com/gogs/gogs/issues/5602)\n- Open/close milestone redirects to a 404 page. [#5677](https://github.com/gogs/gogs/issues/5677)\n- Disallow multiple tokens with same name. [#5587](https://github.com/gogs/gogs/issues/5587) [#5820](https://github.com/gogs/gogs/pull/5820)\n- Enable Federated Avatar Lookup could cause server to crash. [#5848](https://github.com/gogs/gogs/issues/5848)\n- Private repositories are hidden in the organization's view. [#5869](https://github.com/gogs/gogs/issues/5869)\n- Users have access to base repository cannot view commits in forks. [#5878](https://github.com/gogs/gogs/issues/5878)\n- Server error when changing email address in user settings page. [#5899](https://github.com/gogs/gogs/issues/5899)\n- Fall back to use RFC 3339 as time layout when misconfigured. [#6098](https://github.com/gogs/gogs/issues/6098)\n- Unable to update team with server error. [#6185](https://github.com/gogs/gogs/issues/6185)\n- Webhooks are not fired after push when `[service] REQUIRE_SIGNIN_VIEW = true`.\n- Files with identical content are randomly displayed one of them.\n\n### Removed\n\n- Configuration option `[other] SHOW_FOOTER_VERSION`\n- Configuration option `[server] STATIC_ROOT_PATH`\n- Configuration option `[repository] MIRROR_QUEUE_LENGTH`\n- Configuration option `[repository] PULL_REQUEST_QUEUE_LENGTH`\n- Configuration option `[session] ENABLE_SET_COOKIE`\n- Configuration option `[release.attachment] PATH`\n- Configuration option `[webhook] QUEUE_LENGTH`\n- Build tag `sqlite`, which means CGO is now required.\n\n---\n\n**Older change logs can be found on [GitHub](https://github.com/gogs/gogs/releases?after=v0.12.0).**\n", "// Copyright 2020 The Gogs Authors. All rights reserved.\n// Use of this source code is governed by a MIT-style\n// license that can be found in the LICENSE file.\n\npackage pathutil\n\nimport (\n\t\"path\"\n\t\"strings\"\n)\n\n// Clean cleans up given path and returns a relative path that goes straight down.\nfunc Clean(p string) string {\n\treturn strings.Trim(path.Clean(\"/\"+p), \"/\")\n}\n", "// Copyright 2020 The Gogs Authors. All rights reserved.\n// Use of this source code is governed by a MIT-style\n// license that can be found in the LICENSE file.\n\npackage pathutil\n\nimport (\n\t\"testing\"\n\n\t\"github.com/stretchr/testify/assert\"\n)\n\nfunc TestClean(t *testing.T) {\n\ttests := []struct {\n\t\tpath   string\n\t\texpVal string\n\t}{\n\t\t{\n\t\t\tpath:   \"../../../readme.txt\",\n\t\t\texpVal: \"readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:   \"a/../../../readme.txt\",\n\t\t\texpVal: \"readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:   \"/../a/b/../c/../readme.txt\",\n\t\t\texpVal: \"a/readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:   \"/a/readme.txt\",\n\t\t\texpVal: \"a/readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:   \"/\",\n\t\t\texpVal: \"\",\n\t\t},\n\n\t\t{\n\t\t\tpath:   \"/a/b/c/readme.txt\",\n\t\t\texpVal: \"a/b/c/readme.txt\",\n\t\t},\n\t}\n\tfor _, test := range tests {\n\t\tt.Run(\"\", func(t *testing.T) {\n\t\t\tassert.Equal(t, test.expVal, Clean(test.path))\n\t\t})\n\t}\n}\n"], "fixing_code": ["# Changelog\n\nAll notable changes to Gogs are documented in this file.\n\n## 0.13.0+dev (`main`)\n\n### Added\n\n- An unlisted option is added when create or migrate a repository. Unlisted repositories are public but not being listed for users without direct access in the UI. [#5733](https://github.com/gogs/gogs/issues/5733)\n- New configuration option `[git.timeout] DIFF` for customizing operation timeout of `git diff`. [#6315](https://github.com/gogs/gogs/issues/6315)\n- New configuration option `[server] SSH_SERVER_MACS` for setting list of accepted MACs for connections to builtin SSH server. [#6434](https://github.com/gogs/gogs/issues/6434)\n- Support specifying custom schema for PostgreSQL. [#6695](https://github.com/gogs/gogs/pull/6695)\n- Support rendering Mermaid diagrams in Markdown. [#6776](https://github.com/gogs/gogs/pull/6776)\n- New languages support: Mongolian. [#6510](https://github.com/gogs/gogs/pull/6510)\n\n### Changed\n\n- The default branch has been changed to `main`. [#6285](https://github.com/gogs/gogs/pull/6285)\n- MSSQL as database backend is deprecated, installation page no longer shows it as an option. Existing installations and manually craft configuration file continue to work. [#6295](https://github.com/gogs/gogs/pull/6295)\n- Use [Task](https://github.com/go-task/task) as the build tool. [#6297](https://github.com/gogs/gogs/pull/6297)\n- The required Go version to compile source code changed to 1.16.\n- Access tokens are now stored using their SHA256 hashes instead of raw values. [#7008](https://github.com/gogs/gogs/pull/7008)\n\n### Fixed\n\n- _Security:_ OS Command Injection in file editor. [#7000](https://github.com/gogs/gogs/issues/7000)\n- _Security:_ Sanitize `DisplayName` in repository issue list. [#7009](https://github.com/gogs/gogs/pull/7009)\n- _Security:_ Path Traversal in file editor on Windows. [#7001](https://github.com/gogs/gogs/issues/7001)\n- Unable to use LDAP authentication on ARM machines. [#6761](https://github.com/gogs/gogs/issues/6761)\n- Unable to init repository during creation on Windows. [#6967](https://github.com/gogs/gogs/issues/6967)\n- Mysterious panic on `Value not found for type *repo.HTTPContext`. [#6963](https://github.com/gogs/gogs/issues/6963)\n\n### Removed\n\n- \u26a0\ufe0f Migrations before 0.12 are removed, installations not on 0.12 should upgrade to it to run the migrations and then upgrade to 0.13.\n- Configuration section `[mailer]` is no longer used, please use `[email]`.\n- Configuration section `[service]` is no longer used, please use `[auth]`.\n- Configuration option `APP_NAME` is no longer used, please use `BRAND_NAME`.\n- Configuration option `[security] REVERSE_PROXY_AUTHENTICATION_USER` is no longer used, please use `[auth] REVERSE_PROXY_AUTHENTICATION_HEADER`.\n- Configuration option `[auth] ACTIVE_CODE_LIVE_MINUTES` is no longer used, please use `[auth] ACTIVATE_CODE_LIVES`.\n- Configuration option `[auth] RESET_PASSWD_CODE_LIVE_MINUTES` is no longer used, please use `[auth] RESET_PASSWORD_CODE_LIVES`.\n- Configuration option `[auth] ENABLE_CAPTCHA` is no longer used, please use `[auth] ENABLE_REGISTRATION_CAPTCHA`.\n- Configuration option `[auth] ENABLE_NOTIFY_MAIL` is no longer used, please use `[user] ENABLE_EMAIL_NOTIFICATION`.\n- Configuration option `[auth] REGISTER_EMAIL_CONFIRM` is no longer used, please use `[auth] REQUIRE_EMAIL_CONFIRMATION`.\n- Configuration option `[session] GC_INTERVAL_TIME` is no longer used, please use `[session] GC_INTERVAL`.\n- Configuration option `[session] SESSION_LIFE_TIME` is no longer used, please use `[session] MAX_LIFE_TIME`.\n- Configuration option `[server] ROOT_URL` is no longer used, please use `[server] EXTERNAL_URL`.\n- Configuration option `[server] LANDING_PAGE` is no longer used, please use `[server] LANDING_URL`.\n- Configuration option `[database] DB_TYPE` is no longer used, please use `[database] TYPE`.\n- Configuration option `[database] PASSWD` is no longer used, please use `[database] PASSWORD`.\n- Remove option to use Makefile as the build tool. [#6980](https://github.com/gogs/gogs/pull/6980)\n\n## 0.12.8\n\n### Changed\n\n- All users (including admins) need to use the configuration option `[security] LOCAL_NETWORK_ALLOWLIST` to allow repository migration and webhooks to be able to access local network addresses, which is a comma separated list of hostnames. [#6988](https://github.com/gogs/gogs/pull/6988)\n\n### Fixed\n\n- _Security:_ SSRF in webhook. [#6901](https://github.com/gogs/gogs/issues/6901)\n- _Security:_ XSS in cookies. [#6953](https://github.com/gogs/gogs/issues/6953)\n- _Security:_ OS Command Injection in file uploading. [#6968](https://github.com/gogs/gogs/issues/6968)\n- _Security:_ Remote Command Execution in file editing. [#6555](https://github.com/gogs/gogs/issues/6555)\n\n## 0.12.7\n\n### Fixed\n\n- _Security:_ Stored XSS in issues. [#6919](https://github.com/gogs/gogs/issues/6919)\n- Invalid character in `Access-Control-Allow-Credentials` response header. [#4983](https://github.com/gogs/gogs/issues/4983)\n- Mysterious `ssh: overflow reading version string` errors from builtin SSH server. [#6882](https://github.com/gogs/gogs/issues/6882)\n\n## 0.12.6\n\n### Fixed\n\n- _Security:_ Remote command execution in file uploading. [#6833](https://github.com/gogs/gogs/issues/6833)\n- _Regression:_ Unable to migrate repository from other local Git hosting. Added a new configuration option `[security] LOCAL_NETWORK_ALLOWLIST`, which is a comma separated list of hostnames that are explicitly allowed to be accessed within the local network. [#6841](https://github.com/gogs/gogs/issues/6841)\n- Slow start of Docker containers using NAS devices. [#6554](https://github.com/gogs/gogs/issues/6554)\n\n## 0.12.5\n\n### Fixed\n\n- _Security:_ Potential SSRF in repository migration. [#6754](https://github.com/gogs/gogs/issues/6754)\n- _Security:_ Improper PAM authorization handling. [#6810](https://github.com/gogs/gogs/issues/6810)\n\n## 0.12.4\n\n### Fixed\n\n- _Security:_ Potential SSRF attack by CRLF injection via repository migration. [#6413](https://github.com/gogs/gogs/issues/6413)\n- _Regression:_ Fixed smart links for issues stops rendering. [#6506](https://github.com/gogs/gogs/issues/6506)\n- Added `X-Frame-Options` header to prevent Clickjacking. [#6409](https://github.com/gogs/gogs/issues/6409)\n\n## 0.12.3\n\n### Fixed\n\n- _Regression:_ When running Gogs on Windows, push commits no longer fail on a daily basis with the error \"pre-receive hook declined\". [#6316](https://github.com/gogs/gogs/issues/6316)\n- Auto-linked commit SHAs now have correct links. [#6300](https://github.com/gogs/gogs/issues/6300)\n- Git LFS client (with version >= 2.5.0) wasn't able to upload files with known format (e.g. PNG, JPEG), and the server is expecting the HTTP Header `Content-Type` to be `application/octet-stream`. The server now tells the LFS client to always use `Content-Type: application/octet-stream` when upload files.\n\n## 0.12.2\n\n### Fixed\n\n- _Regression:_ Pages are correctly rendered when requesting `?go-get=1` for subdirectories. [#6314](https://github.com/gogs/gogs/issues/6314)\n- _Regression:_ Submodule with a relative path is linked correctly. [#6319](https://github.com/gogs/gogs/issues/6319)\n- Backup can be processed when `--target` is specified on Windows. [#6339](https://github.com/gogs/gogs/issues/6339)\n- Commit message contains keywords look like an issue reference no longer fails the push entirely. [#6289](https://github.com/gogs/gogs/issues/6289)\n\n## 0.12.1\n\n### Fixed\n\n- The `updated_at` field is now correctly updated when updates an issue. [#6209](https://github.com/gogs/gogs/issues/6209)\n- Fixed a regression which created `login_source.cfg` column to have `VARCHAR(255)` instead of `TEXT` in MySQL. [#6280](https://github.com/gogs/gogs/issues/6280)\n\n## 0.12.0\n\n### Added\n\n- Support for Git LFS, you can read documentation for both [user](https://github.com/gogs/gogs/blob/main/docs/user/lfs.md) and [admin](https://github.com/gogs/gogs/blob/main/docs/admin/lfs.md). [#1322](https://github.com/gogs/gogs/issues/1322)\n- Allow admin to remove observers from the repository. [#5803](https://github.com/gogs/gogs/pull/5803)\n- Use `Last-Modified` HTTP header for raw files. [#5811](https://github.com/gogs/gogs/issues/5811)\n- Support syntax highlighting for SAS code files (i.e. `.r`, `.sas`, `.tex`, `.yaml`). [#5856](https://github.com/gogs/gogs/pull/5856)\n- Able to fill in pull request title with a template. [#5901](https://github.com/gogs/gogs/pull/5901)\n- Able to override static files under `public/` directory, please refer to [documentation](https://gogs.io/docs/features/custom_template) for usage. [#5920](https://github.com/gogs/gogs/pull/5920)\n- New API endpoint `GET /admin/teams/:teamid/members` to list members of a team. [#5877](https://github.com/gogs/gogs/issues/5877)\n- Support backup with retention policy for Docker deployments. [#6140](https://github.com/gogs/gogs/pull/6140)\n\n### Changed\n\n- The organization profile page has changed to display at most 12 members. [#5506](https://github.com/gogs/gogs/issues/5506)\n- The required Go version to compile source code changed to 1.14.\n- All assets are now embedded into binary and served from memory by default. Set `[server] LOAD_ASSETS_FROM_DISK = true` to load them from disk. [#5920](https://github.com/gogs/gogs/pull/5920)\n- Application and Go versions are removed from page footer and only show in the admin dashboard.\n- Build tag for running as Windows Service has been changed from `miniwinsvc` to `minwinsvc`.\n- Configuration option `APP_NAME` is deprecated and will end support in 0.13.0, please start using `BRAND_NAME`.\n- Configuration option `[server] ROOT_URL` is deprecated and will end support in 0.13.0, please start using `[server] EXTERNAL_URL`.\n- Configuration option `[server] LANDING_PAGE` is deprecated and will end support in 0.13.0, please start using `[server] LANDING_URL`.\n- Configuration option `[database] DB_TYPE` is deprecated and will end support in 0.13.0, please start using `[database] TYPE`.\n- Configuration option `[database] PASSWD` is deprecated and will end support in 0.13.0, please start using `[database] PASSWORD`.\n- Configuration option `[security] REVERSE_PROXY_AUTHENTICATION_USER` is deprecated and will end support in 0.13.0, please start using `[auth] REVERSE_PROXY_AUTHENTICATION_HEADER`.\n- Configuration section `[mailer]` is deprecated and will end support in 0.13.0, please start using `[email]`.\n- Configuration section `[service]` is deprecated and will end support in 0.13.0, please start using `[auth]`.\n- Configuration option `[auth] ACTIVE_CODE_LIVE_MINUTES` is deprecated and will end support in 0.13.0, please start using `[auth] ACTIVATE_CODE_LIVES`.\n- Configuration option `[auth] RESET_PASSWD_CODE_LIVE_MINUTES` is deprecated and will end support in 0.13.0, please start using `[auth] RESET_PASSWORD_CODE_LIVES`.\n- Configuration option `[auth] REGISTER_EMAIL_CONFIRM` is deprecated and will end support in 0.13.0, please start using `[auth] REQUIRE_EMAIL_CONFIRMATION`.\n- Configuration option `[auth] ENABLE_CAPTCHA` is deprecated and will end support in 0.13.0, please start using `[auth] ENABLE_REGISTRATION_CAPTCHA`.\n- Configuration option `[auth] ENABLE_NOTIFY_MAIL` is deprecated and will end support in 0.13.0, please start using `[user] ENABLE_EMAIL_NOTIFICATION`.\n- Configuration option `[session] GC_INTERVAL_TIME` is deprecated and will end support in 0.13.0, please start using `[session] GC_INTERVAL`.\n- Configuration option `[session] SESSION_LIFE_TIME` is deprecated and will end support in 0.13.0, please start using `[session] MAX_LIFE_TIME`.\n- The name `-` is reserved and cannot be used for users or organizations.\n\n### Fixed\n\n- [Security] Potential open redirection with i18n.\n- [Security] Potential ability to delete files outside a repository.\n- [Security] Potential ability to set primary email on others' behalf from their verified emails.\n- [Security] Potential XSS attack via `.ipynb`. [#5170](https://github.com/gogs/gogs/issues/5170)\n- [Security] Potential SSRF attack via webhooks. [#5366](https://github.com/gogs/gogs/issues/5366)\n- [Security] Potential CSRF attack in admin panel. [#5367](https://github.com/gogs/gogs/issues/5367)\n- [Security] Potential stored XSS attack in some browsers. [#5397](https://github.com/gogs/gogs/issues/5397)\n- [Security] Potential RCE on mirror repositories. [#5767](https://github.com/gogs/gogs/issues/5767)\n- [Security] Potential XSS attack with raw markdown API. [#5907](https://github.com/gogs/gogs/pull/5907)\n- File both modified and renamed within a commit treated as separate files. [#5056](https://github.com/gogs/gogs/issues/5056)\n- Unable to restore the database backup to MySQL 8.0 with syntax error. [#5602](https://github.com/gogs/gogs/issues/5602)\n- Open/close milestone redirects to a 404 page. [#5677](https://github.com/gogs/gogs/issues/5677)\n- Disallow multiple tokens with same name. [#5587](https://github.com/gogs/gogs/issues/5587) [#5820](https://github.com/gogs/gogs/pull/5820)\n- Enable Federated Avatar Lookup could cause server to crash. [#5848](https://github.com/gogs/gogs/issues/5848)\n- Private repositories are hidden in the organization's view. [#5869](https://github.com/gogs/gogs/issues/5869)\n- Users have access to base repository cannot view commits in forks. [#5878](https://github.com/gogs/gogs/issues/5878)\n- Server error when changing email address in user settings page. [#5899](https://github.com/gogs/gogs/issues/5899)\n- Fall back to use RFC 3339 as time layout when misconfigured. [#6098](https://github.com/gogs/gogs/issues/6098)\n- Unable to update team with server error. [#6185](https://github.com/gogs/gogs/issues/6185)\n- Webhooks are not fired after push when `[service] REQUIRE_SIGNIN_VIEW = true`.\n- Files with identical content are randomly displayed one of them.\n\n### Removed\n\n- Configuration option `[other] SHOW_FOOTER_VERSION`\n- Configuration option `[server] STATIC_ROOT_PATH`\n- Configuration option `[repository] MIRROR_QUEUE_LENGTH`\n- Configuration option `[repository] PULL_REQUEST_QUEUE_LENGTH`\n- Configuration option `[session] ENABLE_SET_COOKIE`\n- Configuration option `[release.attachment] PATH`\n- Configuration option `[webhook] QUEUE_LENGTH`\n- Build tag `sqlite`, which means CGO is now required.\n\n---\n\n**Older change logs can be found on [GitHub](https://github.com/gogs/gogs/releases?after=v0.12.0).**\n", "// Copyright 2020 The Gogs Authors. All rights reserved.\n// Use of this source code is governed by a MIT-style\n// license that can be found in the LICENSE file.\n\npackage pathutil\n\nimport (\n\t\"path\"\n\t\"strings\"\n)\n\n// Clean cleans up given path and returns a relative path that goes straight\n// down to prevent path traversal.\nfunc Clean(p string) string {\n\tp = strings.ReplaceAll(p, `\\`, \"/\")\n\treturn strings.Trim(path.Clean(\"/\"+p), \"/\")\n}\n", "// Copyright 2020 The Gogs Authors. All rights reserved.\n// Use of this source code is governed by a MIT-style\n// license that can be found in the LICENSE file.\n\npackage pathutil\n\nimport (\n\t\"testing\"\n\n\t\"github.com/stretchr/testify/assert\"\n)\n\nfunc TestClean(t *testing.T) {\n\ttests := []struct {\n\t\tpath    string\n\t\twantVal string\n\t}{\n\t\t{\n\t\t\tpath:    \"../../../readme.txt\",\n\t\t\twantVal: \"readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:    \"a/../../../readme.txt\",\n\t\t\twantVal: \"readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:    \"/../a/b/../c/../readme.txt\",\n\t\t\twantVal: \"a/readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:    \"/a/readme.txt\",\n\t\t\twantVal: \"a/readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:    \"/\",\n\t\t\twantVal: \"\",\n\t\t},\n\n\t\t{\n\t\t\tpath:    \"/a/b/c/readme.txt\",\n\t\t\twantVal: \"a/b/c/readme.txt\",\n\t\t},\n\n\t\t// Windows-specific\n\t\t{\n\t\t\tpath:    `..\\..\\..\\readme.txt`,\n\t\t\twantVal: \"readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:    `a\\..\\..\\..\\readme.txt`,\n\t\t\twantVal: \"readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:    `\\..\\a\\b\\..\\c\\..\\readme.txt`,\n\t\t\twantVal: \"a/readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:    `\\a\\readme.txt`,\n\t\t\twantVal: \"a/readme.txt\",\n\t\t},\n\t\t{\n\t\t\tpath:    `..\\..\\..\\../README.md`,\n\t\t\twantVal: \"README.md\",\n\t\t},\n\t\t{\n\t\t\tpath:    `\\`,\n\t\t\twantVal: \"\",\n\t\t},\n\n\t\t{\n\t\t\tpath:    `\\a\\b\\c\\readme.txt`,\n\t\t\twantVal: `a/b/c/readme.txt`,\n\t\t},\n\t}\n\tfor _, test := range tests {\n\t\tt.Run(test.path, func(t *testing.T) {\n\t\t\tassert.Equal(t, test.wantVal, Clean(test.path))\n\t\t})\n\t}\n}\n"], "filenames": ["CHANGELOG.md", "internal/pathutil/pathutil.go", "internal/pathutil/pathutil_test.go"], "buggy_code_start_loc": [27, 12, 15], "buggy_code_end_loc": [27, 13, 47], "fixing_code_start_loc": [28, 12, 15], "fixing_code_end_loc": [29, 16, 78], "type": "CWE-22", "message": "Path Traversal in GitHub repository gogs/gogs prior to 0.12.9.", "other": {"cve": {"id": "CVE-2022-1992", "sourceIdentifier": "security@huntr.dev", "published": "2022-06-09T17:15:08.683", "lastModified": "2022-06-15T16:59:14.337", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Path Traversal in GitHub repository gogs/gogs prior to 0.12.9."}, {"lang": "es", "value": "Un Salto de Ruta en el repositorio de GitHub gogs/gogs versiones anteriores a 0.12.9"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.1, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.2}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 10.0, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 6.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:N/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.4}, "baseSeverity": "MEDIUM", "exploitabilityScore": 10.0, "impactScore": 4.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-22"}]}, {"source": "security@huntr.dev", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-22"}]}], "configurations": [{"operator": "AND", "nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:gogs:gogs:*:*:*:*:*:*:*:*", "versionEndExcluding": "0.12.9", "matchCriteriaId": "4DAD0C2A-2575-4160-90B2-D024A0A41B0A"}]}, {"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": false, "criteria": "cpe:2.3:o:microsoft:windows:-:*:*:*:*:*:*:*", "matchCriteriaId": "A2572D17-1DE6-457B-99CC-64AFD54487EA"}]}]}], "references": [{"url": "https://github.com/gogs/gogs/commit/2ca014250fbf0bba94c914d9e43b1f6d8eca3bb0", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/2e8cdc57-a9cf-46ae-9088-87f09e6c90ab", "source": "security@huntr.dev", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/gogs/gogs/commit/2ca014250fbf0bba94c914d9e43b1f6d8eca3bb0"}}