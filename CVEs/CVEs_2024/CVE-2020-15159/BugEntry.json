{"buggy_code": ["<?php\n/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) baserCMS Users Community <https://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttps://basercms.net baserCMS Project\n * @package\t\t\tBaser.View\n * @since\t\t\tbaserCMS v 0.1.0\n * @license\t\t\thttps://basercms.net/license/index.html\n */\n\n/**\n * [ADMIN] \u30c6\u30fc\u30de\u30d5\u30a9\u30eb\u30c0\u767b\u9332\u30fb\u7de8\u96c6\n *\n * @var BcAppView $this\n */\n$this->BcBaser->js('admin/theme_files/form_folder');\n$parentPrams = $params = explode('/', $path);\nif ($this->request->action !== 'admin_add_folder') {\n\tunset($parentPrams[count($parentPrams)-1]);\n}\n?>\n\n\n<!-- current -->\n<div class=\"em-box bca-current-box\">\n\t<?php echo __d('baser', '\u73fe\u5728\u306e\u4f4d\u7f6e')?>\uff1a<?php echo $currentPath ?>\n</div>\n\n<?php if ($this->request->action == 'admin_add_folder'): ?>\n\t<?php echo $this->BcForm->create('ThemeFolder', ['id' => 'TemplateForm', 'url' => array_merge(['controller' => 'theme_files', 'action' => 'add_folder', $theme, $type], $params)]) ?>\n<?php else: ?>\n\t<?php echo $this->BcForm->create('ThemeFolder', ['id' => 'TemplateForm', 'url' => array_merge(['controller' => 'theme_files', 'action' => 'edit_folder', $theme, $type], $params)]) ?>\n<?php endif ?>\n\n<?php echo $this->BcFormTable->dispatchBefore() ?>\n\n<?php if($theme\t!= 'core' && !$isWritable): ?>\n\t<div id=\"AlertMessage\">\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u306e\u3067\u7de8\u96c6\u3067\u304d\u307e\u305b\u3093\u3002</div>\n<?php endif ?>\n\n<?php echo $this->BcForm->input('ThemeFolder.parent', ['type' => 'hidden']) ?>\n<?php echo $this->BcForm->input('ThemeFolder.pastname', ['type' => 'hidden']) ?>\n\n<!-- form -->\n<div class=\"section\">\n\t<table cellpadding=\"0\" cellspacing=\"0\" id=\"FormTable\" class=\"form-table bca-form-table\">\n\t\t<tr>\n\t\t\t<th class=\"col-head bca-form-table__label\"><?php echo $this->BcForm->label('ThemeFolder.name', __d('baser', '\u30d5\u30a9\u30eb\u30c0\u540d')) ?>&nbsp;<span class=\"bca-label\" data-bca-label-type=\"required\"><?php echo __d('baser', '\u5fc5\u9808') ?></span></th>\n\t\t\t<td class=\"col-input bca-form-table__input\">\n\t\t\t\t<?php if ($this->request->action != 'admin_view_folder'): ?>\n\t\t\t\t\t<?php echo $this->BcForm->input('ThemeFolder.name', ['type' => 'text', 'size' => 40, 'maxlength' => 255, 'autofocus' => true]) ?>\n\t\t\t\t\t<i class=\"bca-icon--question-circle btn help bca-help\"></i>\n\t\t\t\t\t<div id=\"helptextName\" class=\"helptext\">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li><?php echo __d('baser', '\u30d5\u30a9\u30eb\u30c0\u540d\u306f\u534a\u89d2\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002')?></li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<?php echo $this->BcForm->error('ThemeFolder.name') ?>\n\t\t\t\t<?php else: ?>\n\t\t\t\t\t<?php echo $this->BcForm->input('ThemeFolder.name', ['type' => 'text', 'size' => 40, 'readonly' => 'readonly']) ?>\n\t\t\t\t<?php endif ?>\n\t\t\t</td>\n\t\t</tr>\n\t\t<?php echo $this->BcForm->dispatchAfterForm() ?>\n\t</table>\n</div>\n\n<?php echo $this->BcFormTable->dispatchAfter() ?>\n\n<div class=\"submit bca-actions\">\n\t<?php if ($this->request->action == 'admin_add_folder'): ?>\n\t\t<div class=\"bca-actions__main\">\n\t\t\t<?php echo $this->BcForm->button(__d('baser', '\u4fdd\u5b58'), ['div' => false, 'class' => 'button bca-btn bca-actions__item', 'data-bca-btn-type' => 'save', 'data-bca-btn-size' => 'lg', 'data-bca-btn-width' => 'lg','id' => 'BtnSave']) ?>\n\t\t</div>\n\t<?php elseif ($this->request->action == 'admin_edit_folder'): ?>\n\t\t<?php if($isWritable): ?>\n\t\t\t<div class=\"bca-actions__main\">\n\t\t\t\t<?php echo $this->BcForm->button(__d('baser', '\u4fdd\u5b58'), ['div' => false, 'class' => 'button bca-btn bca-actions__item', 'data-bca-btn-type' => 'save', 'data-bca-btn-size' => 'lg', 'data-bca-btn-width' => 'lg','id' => 'BtnSave']) ?>\n\t\t\t</div>\n\t\t\t<div class=\"bca-actions__sub\">\n\t\t\t\t<?php $this->BcBaser->link(__d('baser', '\u524a\u9664'), array_merge(['action' => 'del', $theme, $type], $params), ['class' => 'submit-token button bca-btn bca-actions__item', 'data-bca-btn-type' => 'delete', 'data-bca-btn-size' => 'sm'], sprintf(__d('baser', '%s \u3092\u672c\u5f53\u306b\u524a\u9664\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u304b\uff1f'), $this->BcForm->value('ThemeFolder.name')), false\t) ?>\n\t\t\t</div>\n\t\t<?php endif ?>\t\n\t<?php else: ?>\n\t\t<?php if (!$safeModeOn): ?>\n\t\t\t<?php if ($theme == 'core'): ?>\n\t\t\t\t<?php $this->BcBaser->link(__d('baser', '\u73fe\u5728\u306e\u30c6\u30fc\u30de\u306b\u30b3\u30d4\u30fc'), array_merge(['action' => 'copy_folder_to_theme', $theme, $plugin, $type], $params), ['class' => 'submit-token btn-red button bca-btn'], sprintf(__d('baser', '\u672c\u5f53\u306b\u73fe\u5728\u306e\u30c6\u30fc\u30de\u300c%s\u300d\u306b\u30b3\u30d4\u30fc\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u304b\uff1f\\n\u65e2\u306b\u5b58\u5728\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f\u4e0a\u66f8\u304d\u3055\u308c\u307e\u3059\u3002'), Inflector::camelize($siteConfig['theme']))); ?>\n\t\t\t<?php endif ?>\n\t\t<?php else: ?>\n\t\t\t<?php echo __d('baser', '\u6a5f\u80fd\u5236\u9650\u306e\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u73fe\u5728\u306e\u30c6\u30fc\u30de\u3078\u306e\u30b3\u30d4\u30fc\u306f\u3067\u304d\u307e\u305b\u3093\u3002') ?>\n\t\t<?php endif ?>\n\t<?php endif ?>\n</div>\n\n<?php if ($this->request->action == 'admin_add_folder' || $this->request->action == 'admin_edit_folder'): ?>\n\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], explode('/', $path)), ['class' => 'btn-gray button bca-btn', 'data-bca-btn-type' => 'back-to-list']); ?>\n<?php else: ?>\n\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], explode('/', dirname($path))), ['class' => 'btn-gray button bca-btn', 'data-bca-btn-type' => 'back-to-list']); ?>\n<?php endif ?>", "<?php\n/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) baserCMS Users Community <https://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttps://basercms.net baserCMS Project\n * @package\t\t\tBaser.View\n * @since\t\t\tbaserCMS v 0.1.0\n * @license\t\t\thttps://basercms.net/license/index.html\n */\n\n/**\n * [ADMIN] \u30c6\u30fc\u30de\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\n */\n$writable = true;\nif ((is_dir($fullpath) && !is_writable($fullpath)) || $theme == 'core') {\n\t$writable = false;\n}\n$this->BcBaser->js([\n\t'admin/libs/jquery.baser_ajax_data_list',\n\t'admin/libs/jquery.baser_ajax_batch',\n\t'admin/libs/baser_ajax_data_list_config',\n\t'admin/libs/baser_ajax_batch_config'\n]);\n$params = explode('/', $path);\n?>\n\n\n<script type=\"text/javascript\">\n$(function(){\n\t$(\"#ThemeFileFile\").change(function(){\n\t\t$(\"#Waiting\").show();\n\t\t$(\"#ThemeFileUpload\").submit();\n\t});\n\t$.baserAjaxDataList.init();\n\t$.baserAjaxBatch.init({ url: $(\"#AjaxBatchUrl\").html()});\n});\n</script>\n\n<?php $this->BcBaser->element('submenus/theme_files'); ?>\n\n<div id=\"AjaxBatchUrl\" style=\"display:none\"><?php $this->BcBaser->url(array_merge(['controller' => 'theme_files', 'action' => 'ajax_batch', $theme, $type], $params)) ?></div>\n<div id=\"AlertMessage\" class=\"message\" style=\"display:none\"></div>\n<div id=\"MessageBox\" style=\"display:none\"><div id=\"flashMessage\" class=\"notice-message\"></div></div>\n\n<!-- current -->\n<div class=\"em-box bca-current-box\"><?php echo __d('baser', '\u73fe\u5728\u306e\u4f4d\u7f6e') ?>\uff1a<?php echo $currentPath ?>\n\t<?php if (!$writable): ?>\n\t\t\u3000<span style=\"color:#FF3300\">[<?php echo __d('baser', '\u66f8\u8fbc\u4e0d\u53ef') ?>]</span>\n\t<?php endif ?>\n</div>\n\n<div id=\"DataList\" class=\"bca-data-list\"><?php $this->BcBaser->element('theme_files/index_list') ?></div>\n\n<div class=\"bca-actions\" data-bca-type=\"type2\">\n\t<?php if ($writable): ?>\n  <div class=\"bca-actions__form\">\n\t\t<?php echo $this->BcForm->create('ThemeFile', ['id' => 'ThemeFileUpload', 'url' => array_merge(['action' => 'upload', $theme, $plugin, $type], $params), 'enctype' => 'multipart/form-data']) ?>\n\t\t  <?php echo $this->BcForm->input('ThemeFile.file', ['type' => 'file']) ?>\n\t\t<?php echo $this->BcForm->end() ?>\n  </div>\n  <?php endif ?>\n  <div class=\"bca-actions__adds\">\n    <?php if ($writable): ?>\n\t\t<?php $this->BcBaser->link('<i class=\"bca-icon--folder\"></i> ' . __d('baser', '\u30d5\u30a9\u30eb\u30c0\u65b0\u898f\u4f5c\u6210'), array_merge(['action' => 'add_folder', $theme, $type], $params),\n      [\n        'class' => 'bca-btn',\n        'data-bca-btn-type' => 'add'\n      ]\n    ) ?>\n\t  <?php endif ?>\n    <?php if (($path || $type != 'etc') && $type != 'img' && $writable): ?>\n      <?php $this->BcBaser->link('<i class=\"bca-icon--file\"></i> ' . __d('baser', '\u30d5\u30a1\u30a4\u30eb\u65b0\u898f\u4f5c\u6210'), array_merge(['action' => 'add', $theme, $type], $params),\n        [\n          'class' => 'bca-btn',\n          'data-bca-btn-type' => 'add'\n        ]\n      ) ?>\n    <?php endif ?>\n  </div>\n</div>\n", "<?php\n/**\n * baserCMS :  Based Website Development Project <http://basercms.net>\n * Copyright (c) baserCMS Users Community <http://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttp://basercms.net baserCMS Project\n * @package\t\t\tUploader.Config\n * @since\t\t\tbaserCMS v 3.0.10\n * @license\t\t\thttp://basercms.net/license/index.html\n */\n\n/**\n * \u30b7\u30b9\u30c6\u30e0\u30ca\u30d3\n */\n$config['BcApp.adminNavigation'] = [\n\t'Plugins' => [\n\t\t'menus' => [\n\t\t\t'UploaderConfigs' => ['title' => '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u57fa\u672c\u8a2d\u5b9a', 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_configs', 'action' => 'index']],\n\t\t]\n\t],\n\t'Contents' => [\n\t\t'Uploader' => [\n\t\t\t'title' => __d('baser', '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7ba1\u7406'),\n\t\t\t'type' => 'uploader',\n\t\t\t'icon' => 'bca-icon--uploader',\n\t\t\t'menus' => [\n\t\t\t\t'UplaoderFiles' => ['title' => __d('baser', '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb'), 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_files', 'action' => 'index']],\n\t\t\t\t'UploaderCategories' => [\n\t\t\t\t\t'title' => __d('baser', '\u30ab\u30c6\u30b4\u30ea'), \n\t\t\t\t\t'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_categories', 'action' => 'index'],\n\t\t\t\t\t'currentRegex' => '/\\/uploader\\/uploader_categories\\/[^\\/]+?/s'\n\t\t\t\t],\n\t\t\t]\n\t\t],\n\t],\n];\n// @deprecated 5.0.0 since 4.2.0 BcApp.adminNavigation \u306e\u5f62\u5f0f\u306b\u5909\u66f4\n$config['BcApp.adminNavi.uploader'] = [\n\t\t'name'\t\t=> __d('baser', '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u30d7\u30e9\u30b0\u30a4\u30f3'),\n\t\t'contents'\t=> [\n\t\t\t['name' => __d('baser', '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7'),\t'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_files', 'action' => 'index']],\n\t\t\t['name' => __d('baser', '\u30ab\u30c6\u30b4\u30ea\u4e00\u89a7'), 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_categories', 'action' => 'index']],\n\t\t\t['name' => __d('baser', '\u30ab\u30c6\u30b4\u30ea\u65b0\u898f\u767b\u9332'), 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_categories', 'action' => 'add']],\n\t\t\t['name' => __d('baser', '\u57fa\u672c\u8a2d\u5b9a'), 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_configs', 'action' => 'index']],\n\t]\n];\n$config['Uploader'] = [\n\t\t// \u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u30b0\u30eb\u30fc\u30d7\u4ee5\u5916\u306e\u30e6\u30fc\u30b6\u30fc\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u306a\u30d5\u30a1\u30a4\u30eb\uff08\u62e1\u5f35\u5b50\u3092\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u6307\u5b9a\u3059\u308b\uff09\n\t\t'allowedExt' => 'gif,jpg,png,pdf,zip,doc,docx,xls,xlsx,ppt,pptx'\n];\n", "<?php\n/**\n * baserCMS :  Based Website Development Project <http://basercms.net>\n * Copyright (c) baserCMS Users Community <http://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttp://basercms.net baserCMS Project\n * @package\t\t\tUploader.Model\n * @since\t\t\tbaserCMS v 3.0.10\n * @license\t\t\thttp://basercms.net/license/index.html\n */\n\n/**\n * \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u30e2\u30c7\u30eb\n *\n * @package\t\tUploader.Model\n */\nclass UploaderFile extends AppModel {\n\n/**\n * \u30d7\u30e9\u30b0\u30a4\u30f3\u540d\n *\n * @var string\n */\n\tpublic $plugin = 'Uploader';\n\n/**\n * behaviors\n *\n * @var array\n */\n\tpublic $actsAs = [\n\t\t'BcUpload' => [\n\t\t\t'saveDir' => 'uploads',\n\t\t\t'existsCheckDirs' => ['uploads/limited'],\n\t\t\t'fields' => [\n\t\t\t\t'name' => ['type'\t=> 'all']\n\t]]];\n\n/**\n * \u516c\u958b\u671f\u9593\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\n *\n * @return bool\n */\n\tpublic function checkPeriod() {\n\t\tif(!empty($this->data['UploaderFile']['publish_begin']) && !empty($this->data['UploaderFile']['publish_end'])) {\n\t\t\tif(strtotime($this->data['UploaderFile']['publish_begin']) > strtotime($this->data['UploaderFile']['publish_end'])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n/**\n * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\n *\n * @param\tint\t\t$id\n * @param\tstring\t$table\n * @param\tstring\t$ds\n */\n\tpublic function __construct($id = false, $table = null, $ds = null) {\n\t\t$this->validate = [\n\t\t\t'publish_begin' => [\n\t\t\t\t'checkPeriod' => [\n\t\t\t\t\t'rule' => 'checkPeriod',\n\t\t\t\t\t'message' => __d('baser', '\u516c\u958b\u671f\u9593\u304c\u4e0d\u6b63\u3067\u3059\u3002')\n\t\t\t\t]\n\t\t\t],\n\t\t\t'publish_end' => [\n\t\t\t\t'checkPeriod' => [\n\t\t\t\t\t'rule' => 'checkPeriod',\n\t\t\t\t\t'message' => __d('baser', '\u516c\u958b\u671f\u9593\u304c\u4e0d\u6b63\u3067\u3059\u3002')\n\t\t\t\t]\n\t\t\t]\n\t\t];\n\t\tif(!BcUtil::isAdminUser()) {\n\t\t\t$this->validate['name'] = [\n\t\t\t\t'fileExt' => [\n\t\t\t\t\t'rule' => ['fileExt', Configure::read('Uploader.allowedExt')],\n\t\t\t\t\t'message' => __d('baser', '\u8a31\u53ef\u3055\u308c\u3066\u3044\u306a\u3044\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3067\u3059\u3002')\n\t\t\t\t]\n\t\t\t];\n\t\t}\n\t\tparent::__construct($id, $table, $ds);\n\t\t$sizes = array('large', 'midium', 'small', 'mobile_large', 'mobile_small');\n\t\t$UploaderConfig = ClassRegistry::init('Uploader.UploaderConfig');\n\t\t$uploaderConfigs = $UploaderConfig->findExpanded();\n\t\t$imagecopy = array();\n\t\t\n\t\tforeach($sizes as $size) {\n\t\t\tif(!isset($uploaderConfigs[$size.'_width']) || !isset($uploaderConfigs[$size.'_height'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$imagecopy[$size] = array('suffix'\t=> '__'.$size);\n\t\t\t$imagecopy[$size]['width'] = $uploaderConfigs[$size.'_width'];\n\t\t\t$imagecopy[$size]['height'] = $uploaderConfigs[$size.'_height'];\n\t\t\tif(isset($uploaderConfigs[$size.'_thumb'])) {\n\t\t\t\t$imagecopy[$size]['thumb'] = $uploaderConfigs[$size.'_thumb'];\n\t\t\t}\n\t\t}\n\t\t\n\t\t$settings = $this->actsAs['BcUpload'];\n\t\t$settings['fields']['name']['imagecopy'] = $imagecopy;\n\t\t$this->Behaviors->attach('BcUpload', $settings);\n\n\t\t// BcUploadBehavior \u3088\u308a\u512a\u5148\u9806\u4f4d\u3092\u3042\u3052\u308b\u70ba\u767b\u9332\u3001\u30a4\u30d9\u30f3\u30c8\u3092\u767b\u9332\u3057\u306a\u304a\u3059\n\t\t$this->getEventManager()->detach([$this, 'beforeDelete'], 'Model.beforeDelete');\n\t\t$this->getEventManager()->attach([$this, 'beforeDelete'], 'Model.beforeDelete', ['priority' => 5]);\n\n\t}\n\n/**\n * Before Save\n *\n * @param array $options\n * @return bool\n */\n\tpublic function beforeSave($options = array()) {\n\t\tparent::beforeSave($options);\n\t\t\n\t\tif(!empty($this->data['UploaderFile']['id'])) {\n\t\t\t\n\t\t\t$savePath = WWW_ROOT . 'files' . DS . $this->actsAs['BcUpload']['saveDir'] . DS;\n\t\t\t$sizes = array('large', 'midium', 'small', 'mobile_large', 'mobile_small');\n\t\t\t$pathinfo = pathinfo($this->data['UploaderFile']['name']);\n\t\t\t\n\t\t\tif(!empty($this->data['UploaderFile']['publish_begin']) || !empty($this->data['UploaderFile']['publish_end'])) {\n\t\t\t\tif(file_exists($savePath . $this->data['UploaderFile']['name'])) {\n\t\t\t\t\trename($savePath . $this->data['UploaderFile']['name'], $savePath . 'limited' . DS . $this->data['UploaderFile']['name']);\n\t\t\t\t}\n\t\t\t\tforeach($sizes as $size) {\n\t\t\t\t\t$file = $pathinfo['filename'] . '__' . $size . '.' . $pathinfo['extension'];\n\t\t\t\t\tif(file_exists($savePath . $file)) {\n\t\t\t\t\t\trename($savePath . $file, $savePath . 'limited' . DS . $file);\n\t\t\t\t\t}\n\t\t\t\t}\t\n\t\t\t} else {\n\t\t\t\tif(file_exists($savePath . 'limited' . DS . $this->data['UploaderFile']['name'])) {\n\t\t\t\t\trename($savePath . 'limited' . DS . $this->data['UploaderFile']['name'], $savePath . $this->data['UploaderFile']['name']);\n\t\t\t\t}\n\t\t\t\tforeach($sizes as $size) {\n\t\t\t\t\t$file = $pathinfo['filename'] . '__' . $size . '.' . $pathinfo['extension'];\n\t\t\t\t\tif(file_exists($savePath . 'limited' . DS . $file)) {\n\t\t\t\t\t\trename($savePath . 'limited' . DS . $file, $savePath . $file);\n\t\t\t\t\t}\n\t\t\t\t}\t\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn true;\n\t}\n\n/**\n * \u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\n *\n * @param\tstring\t$fileName\n * @return\tbool\n */\n\tpublic function fileExists($fileName, $limited = false) {\n\t\t\n\t\tif($limited) {\n\t\t\t$savePath = WWW_ROOT . 'files' . DS . $this->actsAs['BcUpload']['saveDir'] . DS . 'limited' . DS . $fileName;\n\t\t} else {\n\t\t\t$savePath = WWW_ROOT . 'files' . DS . $this->actsAs['BcUpload']['saveDir'] . DS . $fileName;\n\t\t}\n\t\treturn file_exists($savePath);\n\n\t}\n\n/**\n * \u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\n * \n * @param\tstring\t$fileName\n * @return\tarray\n */\n\tpublic function filesExists($fileName, $limited = null) {\n\t\tif(is_null($limited)) {\n\t\t\t$data = $this->find('first', array('conditions' => array('UploaderFile.name' => $fileName), 'recursive' => -1));\n\t\t\t$limited = false;\n\t\t\tif(!empty($data['UploaderFile']['publish_begin']) || !empty($data['UploaderFile']['publish_end'])) {\n\t\t\t\t$limited = true;\n\t\t\t}\n\t\t}\n\t\t$pathinfo = pathinfo($fileName);\n\t\t$ext = $pathinfo['extension'];\n\t\t$basename = mb_basename($fileName,'.'.$ext);\n\t\t$files['small'] = $this->fileExists($basename.'__small'.'.'.$ext, $limited);\n\t\t$files['midium'] = $this->fileExists($basename.'__midium'.'.'.$ext, $limited);\n\t\t$files['large'] = $this->fileExists($basename.'__large'.'.'.$ext, $limited);\n\t\treturn $files;\n\t}\n\n/**\n * \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\u3059\u308b\n *\n * @param\tstring\t$field\t\t\t\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\n * @param\tarray\t$options\n * @return\tmixed\t$controlSource\t\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30bd\u30fc\u30b9\n */\n\tpublic function getControlSource($field = null, $options = array()) {\n\t\tswitch ($field) {\n\t\t\tcase 'user_id':\n\t\t\t\t$User = ClassRegistry::getObject('User');\n\t\t\t\treturn $User->getUserList($options);\n\t\t\tcase 'uploader_category_id':\n\t\t\t\t$UploaderCategory = ClassRegistry::init('Uploader.UploaderCategory');\n\t\t\t\treturn $UploaderCategory->find('list', array('order' => 'UploaderCategory.id'));\n\t\t}\n\t\treturn false;\n\t}\n\n/**\n * \u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u79f0\u3092\u53d6\u5f97\u3059\u308b\n * @param $fileName\n * @return mixed\n */\n\tpublic function getSourceFileName($fileName) {\n\t\t$sizes = array('large', 'midium', 'small', 'mobile_large', 'mobile_small');\n\t\treturn preg_replace('/__(' . implode('|', $sizes) . ')\\./', '.', $fileName);\n\t}\n\n/**\n * Before Delete\n *\n * @param bool $cascade\n * @return bool\n */\n\tpublic function beforeDelete($cascade = true) {\n\t\t$data = $this->read(null, $this->id);\n\t\tif(!empty($data['UploaderFile']['publish_begin']) || !empty($data['UploaderFile']['publish_end'])) {\n\t\t\t$this->Behaviors->BcUpload->savePath['UploaderFile'] .= 'limited' . DS;\n\t\t} else {\n\t\t\t$this->Behaviors->BcUpload->savePath['UploaderFile'] = preg_replace('/' . preg_quote('limited' . DS, '/') . '$/', '', $this->Behaviors->BcUpload->savePath['UploaderFile']);\n\t\t}\n\t\treturn parent::beforeDelete($cascade);\n\t}\n\t\n}\n\n", "<?php\n/**\n * baserCMS :  Based Website Development Project <http://basercms.net>\n * Copyright (c) baserCMS Users Community <http://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttp://basercms.net baserCMS Project\n * @package\t\t\tBaser.View\n * @since\t\t\tbaserCMS v 0.1.0\n * @license\t\t\thttp://basercms.net/license/index.html\n */\n\n/**\n * [ADMIN] \u30c6\u30fc\u30de\u30d5\u30a9\u30eb\u30c0\u767b\u9332\u30fb\u7de8\u96c6\n *\n * @var BcAppView $this\n */\n$this->BcBaser->js('admin/theme_files/form_folder');\n$parentPrams = $params = explode('/', $path);\nif ($this->request->action !== 'admin_add_folder') {\n\tunset($parentPrams[count($parentPrams)-1]);\n}\n?>\n\n\n<div class=\"em-box align-left\">\n<?php echo __d('baser', '\u73fe\u5728\u306e\u4f4d\u7f6e')?>\uff1a<?php echo $currentPath ?>\n</div>\n\n<?php if ($this->request->action == 'admin_add_folder'): ?>\n\t<?php echo $this->BcForm->create('ThemeFolder', ['id' => 'TemplateForm', 'url' => array_merge(['controller' => 'theme_files', 'action' => 'add_folder', $theme, $type], $params)]) ?>\n<?php else: ?>\n\t<?php echo $this->BcForm->create('ThemeFolder', ['id' => 'TemplateForm', 'url' => array_merge(['controller' => 'theme_files', 'action' => 'edit_folder', $theme, $type], $params)]) ?>\n<?php endif ?>\n\n<?php echo $this->BcFormTable->dispatchBefore() ?>\n\n<?php if($theme\t!= 'core' && !$isWritable): ?>\n\t<div id=\"AlertMessage\"><?php echo __d('baser', '\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u306e\u3067\u7de8\u96c6\u3067\u304d\u307e\u305b\u3093\u3002')?></div>\n<?php endif ?>\n\n<?php echo $this->BcForm->input('ThemeFolder.parent', ['type' => 'hidden']) ?>\n<?php echo $this->BcForm->input('ThemeFolder.pastname', ['type' => 'hidden']) ?>\n\n<!-- form -->\n<div class=\"section\">\n\t<table cellpadding=\"0\" cellspacing=\"0\" id=\"FormTable\" class=\"form-table\">\n\t\t<tr>\n\t\t\t<th class=\"col-head\"><?php echo $this->BcForm->label('ThemeFolder.name', __d('baser', '\u30d5\u30a9\u30eb\u30c0\u540d')) ?>&nbsp;<span class=\"required\">*</span></th>\n\t\t\t<td class=\"col-input\">\n\t\t\t\t<?php if ($this->request->action != 'admin_view_folder'): ?>\n\t\t\t\t\t<?php echo $this->BcForm->input('ThemeFolder.name', ['type' => 'text', 'size' => 40, 'maxlength' => 255, 'autofocus' => true]) ?>\n\t\t\t\t\t<?php echo $this->Html->image('admin/icn_help.png', ['id' => 'helpName', 'class' => 'btn help', 'alt' => __d('baser', '\u30d8\u30eb\u30d7')]) ?>\n\t\t\t\t\t<div id=\"helptextName\" class=\"helptext\">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li><?php echo __d('baser', '\u30d5\u30a9\u30eb\u30c0\u540d\u306f\u534a\u89d2\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002')?></li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<?php echo $this->BcForm->error('ThemeFolder.name') ?>\n\t\t\t\t<?php else: ?>\n\t\t\t\t\t<?php echo $this->BcForm->input('ThemeFolder.name', ['type' => 'text', 'size' => 40, 'readonly' => 'readonly']) ?>\n\t\t\t\t<?php endif ?>\n\t\t\t</td>\n\t\t</tr>\n\t\t<?php echo $this->BcForm->dispatchAfterForm() ?>\n\t</table>\n</div>\n\n<?php echo $this->BcFormTable->dispatchAfter() ?>\n\n<div class=\"submit\">\n\t<?php if ($this->request->action == 'admin_add_folder'): ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], $parentPrams), ['class' => 'btn-gray button']); ?>\n\t\t<?php echo $this->BcForm->submit(__d('baser', '\u4fdd\u5b58'), ['div' => false, 'class' => 'button', 'id' => 'BtnSave']) ?>\n\t<?php elseif ($this->request->action == 'admin_edit_folder'): ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], $parentPrams), ['class' => 'btn-gray button']); ?>\n\t\t<?php if($isWritable): ?>\n\t\t\t<?php echo $this->BcForm->submit(__d('baser', '\u4fdd\u5b58'), ['div' => false, 'class' => 'button', 'id' => 'BtnSave']) ?>\n\t\t\t<?php $this->BcBaser->link(__d('baser', '\u524a\u9664'), array_merge(['action' => 'del', $theme, $type], $params), ['class' => 'submit-token button'], sprintf(__d('baser', '%s \u3092\u672c\u5f53\u306b\u524a\u9664\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u304b\uff1f'), $this->BcForm->value('ThemeFolder.name')), false\t) ?>\n\t\t<?php endif ?>\t\n\t<?php else: ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], $parentPrams), ['class' => 'btn-gray button']); ?>\n\t\t<?php if (!$safeModeOn): ?>\n\t\t\t<?php if ($theme == 'core'): ?>\n\t\t\t\t<?php $this->BcBaser->link(__d('baser', '\u73fe\u5728\u306e\u30c6\u30fc\u30de\u306b\u30b3\u30d4\u30fc'), array_merge(['action' => 'copy_folder_to_theme', $theme, $plugin, $type], $params), ['class' => 'submit-token btn-red button'], sprintf(__d('baser', \"\u672c\u5f53\u306b\u73fe\u5728\u306e\u30c6\u30fc\u30de\u300c %s \u300d\u306b\u30b3\u30d4\u30fc\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u304b\uff1f\\n\u65e2\u306b\u5b58\u5728\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f\u4e0a\u66f8\u304d\u3055\u308c\u307e\u3059\u3002\"), Inflector::camelize($siteConfig['theme']))); ?>\n\t\t\t<?php endif ?>\n\t\t<?php else: ?>\n            <?php echo __d('baser', '\u6a5f\u80fd\u5236\u9650\u306e\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u73fe\u5728\u306e\u30c6\u30fc\u30de\u3078\u306e\u30b3\u30d4\u30fc\u306f\u3067\u304d\u307e\u305b\u3093\u3002')?>\n\t\t<?php endif ?>\n\t<?php endif ?>\n</div>\n\n<?php echo $this->BcForm->end() ?>\n", "<?php\n/**\n * baserCMS :  Based Website Development Project <http://basercms.net>\n * Copyright (c) baserCMS Users Community <http://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttp://basercms.net baserCMS Project\n * @package\t\t\tBaser.View\n * @since\t\t\tbaserCMS v 0.1.0\n * @license\t\t\thttp://basercms.net/license/index.html\n */\n\n/**\n * [ADMIN] \u30c6\u30fc\u30de\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\n */\n$writable = true;\nif ((is_dir($fullpath) && !is_writable($fullpath)) || $theme == 'core') {\n\t$writable = false;\n}\n$this->BcBaser->js([\n\t'admin/libs/jquery.baser_ajax_data_list',\n\t'admin/libs/jquery.baser_ajax_batch',\n\t'admin/libs/baser_ajax_data_list_config',\n\t'admin/libs/baser_ajax_batch_config'\n]);\n$params = explode('/', $path);\n?>\n\n\n<script type=\"text/javascript\">\n$(function(){\n\t$(\"#ThemeFileFile\").change(function(){\n\t\t$(\"#Waiting\").show();\n\t\t$(\"#ThemeFileUpload\").submit();\n\t});\n\t$.baserAjaxDataList.init();\n\t$.baserAjaxBatch.init({ url: $(\"#AjaxBatchUrl\").html()});\n});\n</script>\n\n\n<div id=\"AjaxBatchUrl\" style=\"display:none\"><?php $this->BcBaser->url(array_merge(['controller' => 'theme_files', 'action' => 'ajax_batch', $theme, $type], $params)) ?></div>\n<div id=\"AlertMessage\" class=\"message\" style=\"display:none\"></div>\n<div id=\"MessageBox\" style=\"display:none\"><div id=\"flashMessage\" class=\"notice-message\"></div></div>\n\n<!-- current -->\n<div class=\"em-box align-left\"><?php echo __d('baser', '\u73fe\u5728\u306e\u4f4d\u7f6e')?>\uff1a<?php echo $currentPath ?>\n\t<?php if (!$writable): ?>\n\t\t\u3000<span style=\"color:#FF3300\">[<?php echo __d('baser', '\u66f8\u8fbc\u4e0d\u53ef')?>]</span>\n\t<?php endif ?>\n</div>\n\n<div id=\"DataList\"><?php $this->BcBaser->element('theme_files/index_list') ?></div>\n\n<div class=\"submit\">\n\t<?php if ($writable): ?>\n\t\t<?php echo $this->BcForm->create('ThemeFile', ['id' => 'ThemeFileUpload', 'url' => array_merge(['action' => 'upload', $theme, $plugin, $type], $params), 'enctype' => 'multipart/form-data']) ?>\n\t\t<?php echo $this->BcForm->input('ThemeFile.file', ['type' => 'file']) ?>\n\t\t<?php echo $this->BcForm->end() ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u30d5\u30a9\u30eb\u30c0\u65b0\u898f\u4f5c\u6210'), array_merge(['action' => 'add_folder', $theme, $type], $params), ['class' => 'btn-orange button']) ?>\n\t<?php endif ?>\n\t<?php if (($path || $type != 'etc') && $type != 'img' && $writable): ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u30d5\u30a1\u30a4\u30eb\u65b0\u898f\u4f5c\u6210'), array_merge(['action' => 'add', $theme, $type], $params), ['class' => 'btn-red button']) ?>\n\t<?php endif ?>\n</div>\n"], "fixing_code": ["<?php\n/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) baserCMS Users Community <https://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttps://basercms.net baserCMS Project\n * @package\t\t\tBaser.View\n * @since\t\t\tbaserCMS v 0.1.0\n * @license\t\t\thttps://basercms.net/license/index.html\n */\n\n/**\n * [ADMIN] \u30c6\u30fc\u30de\u30d5\u30a9\u30eb\u30c0\u767b\u9332\u30fb\u7de8\u96c6\n *\n * @var BcAppView $this\n */\n$this->BcBaser->js('admin/theme_files/form_folder');\n$parentPrams = $params = explode('/', $path);\nif ($this->request->action !== 'admin_add_folder') {\n\tunset($parentPrams[count($parentPrams)-1]);\n}\n?>\n\n\n<!-- current -->\n<div class=\"em-box bca-current-box\">\n\t<?php echo __d('baser', '\u73fe\u5728\u306e\u4f4d\u7f6e')?>\uff1a<?php echo h($currentPath) ?>\n</div>\n\n<?php if ($this->request->action == 'admin_add_folder'): ?>\n\t<?php echo $this->BcForm->create('ThemeFolder', ['id' => 'TemplateForm', 'url' => array_merge(['controller' => 'theme_files', 'action' => 'add_folder', $theme, $type], $params)]) ?>\n<?php else: ?>\n\t<?php echo $this->BcForm->create('ThemeFolder', ['id' => 'TemplateForm', 'url' => array_merge(['controller' => 'theme_files', 'action' => 'edit_folder', $theme, $type], $params)]) ?>\n<?php endif ?>\n\n<?php echo $this->BcFormTable->dispatchBefore() ?>\n\n<?php if($theme\t!= 'core' && !$isWritable): ?>\n\t<div id=\"AlertMessage\">\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u306e\u3067\u7de8\u96c6\u3067\u304d\u307e\u305b\u3093\u3002</div>\n<?php endif ?>\n\n<?php echo $this->BcForm->input('ThemeFolder.parent', ['type' => 'hidden']) ?>\n<?php echo $this->BcForm->input('ThemeFolder.pastname', ['type' => 'hidden']) ?>\n\n<!-- form -->\n<div class=\"section\">\n\t<table cellpadding=\"0\" cellspacing=\"0\" id=\"FormTable\" class=\"form-table bca-form-table\">\n\t\t<tr>\n\t\t\t<th class=\"col-head bca-form-table__label\"><?php echo $this->BcForm->label('ThemeFolder.name', __d('baser', '\u30d5\u30a9\u30eb\u30c0\u540d')) ?>&nbsp;<span class=\"bca-label\" data-bca-label-type=\"required\"><?php echo __d('baser', '\u5fc5\u9808') ?></span></th>\n\t\t\t<td class=\"col-input bca-form-table__input\">\n\t\t\t\t<?php if ($this->request->action != 'admin_view_folder'): ?>\n\t\t\t\t\t<?php echo $this->BcForm->input('ThemeFolder.name', ['type' => 'text', 'size' => 40, 'maxlength' => 255, 'autofocus' => true]) ?>\n\t\t\t\t\t<i class=\"bca-icon--question-circle btn help bca-help\"></i>\n\t\t\t\t\t<div id=\"helptextName\" class=\"helptext\">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li><?php echo __d('baser', '\u30d5\u30a9\u30eb\u30c0\u540d\u306f\u534a\u89d2\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002')?></li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<?php echo $this->BcForm->error('ThemeFolder.name') ?>\n\t\t\t\t<?php else: ?>\n\t\t\t\t\t<?php echo $this->BcForm->input('ThemeFolder.name', ['type' => 'text', 'size' => 40, 'readonly' => 'readonly']) ?>\n\t\t\t\t<?php endif ?>\n\t\t\t</td>\n\t\t</tr>\n\t\t<?php echo $this->BcForm->dispatchAfterForm() ?>\n\t</table>\n</div>\n\n<?php echo $this->BcFormTable->dispatchAfter() ?>\n\n<div class=\"submit bca-actions\">\n\t<?php if ($this->request->action == 'admin_add_folder'): ?>\n\t\t<div class=\"bca-actions__main\">\n\t\t\t<?php echo $this->BcForm->button(__d('baser', '\u4fdd\u5b58'), ['div' => false, 'class' => 'button bca-btn bca-actions__item', 'data-bca-btn-type' => 'save', 'data-bca-btn-size' => 'lg', 'data-bca-btn-width' => 'lg','id' => 'BtnSave']) ?>\n\t\t</div>\n\t<?php elseif ($this->request->action == 'admin_edit_folder'): ?>\n\t\t<?php if($isWritable): ?>\n\t\t\t<div class=\"bca-actions__main\">\n\t\t\t\t<?php echo $this->BcForm->button(__d('baser', '\u4fdd\u5b58'), ['div' => false, 'class' => 'button bca-btn bca-actions__item', 'data-bca-btn-type' => 'save', 'data-bca-btn-size' => 'lg', 'data-bca-btn-width' => 'lg','id' => 'BtnSave']) ?>\n\t\t\t</div>\n\t\t\t<div class=\"bca-actions__sub\">\n\t\t\t\t<?php $this->BcBaser->link(__d('baser', '\u524a\u9664'), array_merge(['action' => 'del', $theme, $type], $params), ['class' => 'submit-token button bca-btn bca-actions__item', 'data-bca-btn-type' => 'delete', 'data-bca-btn-size' => 'sm'], sprintf(__d('baser', '%s \u3092\u672c\u5f53\u306b\u524a\u9664\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u304b\uff1f'), $this->BcForm->value('ThemeFolder.name')), false\t) ?>\n\t\t\t</div>\n\t\t<?php endif ?>\t\n\t<?php else: ?>\n\t\t<?php if (!$safeModeOn): ?>\n\t\t\t<?php if ($theme == 'core'): ?>\n\t\t\t\t<?php $this->BcBaser->link(__d('baser', '\u73fe\u5728\u306e\u30c6\u30fc\u30de\u306b\u30b3\u30d4\u30fc'), array_merge(['action' => 'copy_folder_to_theme', $theme, $plugin, $type], $params), ['class' => 'submit-token btn-red button bca-btn'], sprintf(__d('baser', '\u672c\u5f53\u306b\u73fe\u5728\u306e\u30c6\u30fc\u30de\u300c%s\u300d\u306b\u30b3\u30d4\u30fc\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u304b\uff1f\\n\u65e2\u306b\u5b58\u5728\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f\u4e0a\u66f8\u304d\u3055\u308c\u307e\u3059\u3002'), Inflector::camelize($siteConfig['theme']))); ?>\n\t\t\t<?php endif ?>\n\t\t<?php else: ?>\n\t\t\t<?php echo __d('baser', '\u6a5f\u80fd\u5236\u9650\u306e\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u73fe\u5728\u306e\u30c6\u30fc\u30de\u3078\u306e\u30b3\u30d4\u30fc\u306f\u3067\u304d\u307e\u305b\u3093\u3002') ?>\n\t\t<?php endif ?>\n\t<?php endif ?>\n</div>\n\n<?php if ($this->request->action == 'admin_add_folder' || $this->request->action == 'admin_edit_folder'): ?>\n\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], explode('/', $path)), ['class' => 'btn-gray button bca-btn', 'data-bca-btn-type' => 'back-to-list']); ?>\n<?php else: ?>\n\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], explode('/', dirname($path))), ['class' => 'btn-gray button bca-btn', 'data-bca-btn-type' => 'back-to-list']); ?>\n<?php endif ?>", "<?php\n/**\n * baserCMS :  Based Website Development Project <https://basercms.net>\n * Copyright (c) baserCMS Users Community <https://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttps://basercms.net baserCMS Project\n * @package\t\t\tBaser.View\n * @since\t\t\tbaserCMS v 0.1.0\n * @license\t\t\thttps://basercms.net/license/index.html\n */\n\n/**\n * [ADMIN] \u30c6\u30fc\u30de\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\n */\n$writable = true;\nif ((is_dir($fullpath) && !is_writable($fullpath)) || $theme == 'core') {\n\t$writable = false;\n}\n$this->BcBaser->js([\n\t'admin/libs/jquery.baser_ajax_data_list',\n\t'admin/libs/jquery.baser_ajax_batch',\n\t'admin/libs/baser_ajax_data_list_config',\n\t'admin/libs/baser_ajax_batch_config'\n]);\n$params = explode('/', $path);\n?>\n\n\n<script type=\"text/javascript\">\n$(function(){\n\t$(\"#ThemeFileFile\").change(function(){\n\t\t$(\"#Waiting\").show();\n\t\t$(\"#ThemeFileUpload\").submit();\n\t});\n\t$.baserAjaxDataList.init();\n\t$.baserAjaxBatch.init({ url: $(\"#AjaxBatchUrl\").html()});\n});\n</script>\n\n<?php $this->BcBaser->element('submenus/theme_files'); ?>\n\n<div id=\"AjaxBatchUrl\" style=\"display:none\"><?php $this->BcBaser->url(array_merge(['controller' => 'theme_files', 'action' => 'ajax_batch', $theme, $type], $params)) ?></div>\n<div id=\"AlertMessage\" class=\"message\" style=\"display:none\"></div>\n<div id=\"MessageBox\" style=\"display:none\"><div id=\"flashMessage\" class=\"notice-message\"></div></div>\n\n<!-- current -->\n<div class=\"em-box bca-current-box\"><?php echo __d('baser', '\u73fe\u5728\u306e\u4f4d\u7f6e') ?>\uff1a<?php echo h($currentPath) ?>\n\t<?php if (!$writable): ?>\n\t\t\u3000<span style=\"color:#FF3300\">[<?php echo __d('baser', '\u66f8\u8fbc\u4e0d\u53ef') ?>]</span>\n\t<?php endif ?>\n</div>\n\n<div id=\"DataList\" class=\"bca-data-list\"><?php $this->BcBaser->element('theme_files/index_list') ?></div>\n\n<div class=\"bca-actions\" data-bca-type=\"type2\">\n\t<?php if ($writable): ?>\n  <div class=\"bca-actions__form\">\n\t\t<?php echo $this->BcForm->create('ThemeFile', ['id' => 'ThemeFileUpload', 'url' => array_merge(['action' => 'upload', $theme, $plugin, $type], $params), 'enctype' => 'multipart/form-data']) ?>\n\t\t  <?php echo $this->BcForm->input('ThemeFile.file', ['type' => 'file']) ?>\n\t\t<?php echo $this->BcForm->end() ?>\n  </div>\n  <?php endif ?>\n  <div class=\"bca-actions__adds\">\n    <?php if ($writable): ?>\n\t\t<?php $this->BcBaser->link('<i class=\"bca-icon--folder\"></i> ' . __d('baser', '\u30d5\u30a9\u30eb\u30c0\u65b0\u898f\u4f5c\u6210'), array_merge(['action' => 'add_folder', $theme, $type], $params),\n      [\n        'class' => 'bca-btn',\n        'data-bca-btn-type' => 'add'\n      ]\n    ) ?>\n\t  <?php endif ?>\n    <?php if (($path || $type != 'etc') && $type != 'img' && $writable): ?>\n      <?php $this->BcBaser->link('<i class=\"bca-icon--file\"></i> ' . __d('baser', '\u30d5\u30a1\u30a4\u30eb\u65b0\u898f\u4f5c\u6210'), array_merge(['action' => 'add', $theme, $type], $params),\n        [\n          'class' => 'bca-btn',\n          'data-bca-btn-type' => 'add'\n        ]\n      ) ?>\n    <?php endif ?>\n  </div>\n</div>\n", "<?php\n/**\n * baserCMS :  Based Website Development Project <http://basercms.net>\n * Copyright (c) baserCMS Users Community <http://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttp://basercms.net baserCMS Project\n * @package\t\t\tUploader.Config\n * @since\t\t\tbaserCMS v 3.0.10\n * @license\t\t\thttp://basercms.net/license/index.html\n */\n\n/**\n * \u30b7\u30b9\u30c6\u30e0\u30ca\u30d3\n */\n$config['BcApp.adminNavigation'] = [\n\t'Plugins' => [\n\t\t'menus' => [\n\t\t\t'UploaderConfigs' => ['title' => '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u57fa\u672c\u8a2d\u5b9a', 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_configs', 'action' => 'index']],\n\t\t]\n\t],\n\t'Contents' => [\n\t\t'Uploader' => [\n\t\t\t'title' => __d('baser', '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7ba1\u7406'),\n\t\t\t'type' => 'uploader',\n\t\t\t'icon' => 'bca-icon--uploader',\n\t\t\t'menus' => [\n\t\t\t\t'UplaoderFiles' => ['title' => __d('baser', '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb'), 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_files', 'action' => 'index']],\n\t\t\t\t'UploaderCategories' => [\n\t\t\t\t\t'title' => __d('baser', '\u30ab\u30c6\u30b4\u30ea'), \n\t\t\t\t\t'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_categories', 'action' => 'index'],\n\t\t\t\t\t'currentRegex' => '/\\/uploader\\/uploader_categories\\/[^\\/]+?/s'\n\t\t\t\t],\n\t\t\t]\n\t\t],\n\t],\n];\n// @deprecated 5.0.0 since 4.2.0 BcApp.adminNavigation \u306e\u5f62\u5f0f\u306b\u5909\u66f4\n$config['BcApp.adminNavi.uploader'] = [\n\t\t'name'\t\t=> __d('baser', '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u30d7\u30e9\u30b0\u30a4\u30f3'),\n\t\t'contents'\t=> [\n\t\t\t['name' => __d('baser', '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7'),\t'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_files', 'action' => 'index']],\n\t\t\t['name' => __d('baser', '\u30ab\u30c6\u30b4\u30ea\u4e00\u89a7'), 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_categories', 'action' => 'index']],\n\t\t\t['name' => __d('baser', '\u30ab\u30c6\u30b4\u30ea\u65b0\u898f\u767b\u9332'), 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_categories', 'action' => 'add']],\n\t\t\t['name' => __d('baser', '\u57fa\u672c\u8a2d\u5b9a'), 'url' => ['admin' => true, 'plugin' => 'uploader', 'controller' => 'uploader_configs', 'action' => 'index']],\n\t]\n];\n$config['Uploader'] = [\n\t\t// \u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u306b\u3088\u308b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u3044\u304b\u306a\u308b\u62e1\u5f35\u5b50\u3082\u8a31\u53ef\u3059\u308b\n\t\t'allowedAdmin' => false,\n\t\t// \u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u30b0\u30eb\u30fc\u30d7\u4ee5\u5916\u306e\u30e6\u30fc\u30b6\u30fc\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u306a\u30d5\u30a1\u30a4\u30eb\uff08\u62e1\u5f35\u5b50\u3092\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u6307\u5b9a\u3059\u308b\uff09\n\t\t'allowedExt' => 'gif,jpg,jpeg,png,ico,pdf,zip,doc,docx,xls,xlsx,ppt,pptx,txt',\n\t\t// 'allowedExt' => 'mp4,mp3,mpg,mpeg,avi,wmv' // \u30e1\u30c7\u30a3\u30a2\u4f8b\n\t\t// 'allowedExt' => 'fon,ttf,ttc' // \u30d5\u30a9\u30f3\u30c8\u4f8b\n];\n", "<?php\n/**\n * baserCMS :  Based Website Development Project <http://basercms.net>\n * Copyright (c) baserCMS Users Community <http://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttp://basercms.net baserCMS Project\n * @package\t\t\tUploader.Model\n * @since\t\t\tbaserCMS v 3.0.10\n * @license\t\t\thttp://basercms.net/license/index.html\n */\n\n/**\n * \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u30e2\u30c7\u30eb\n *\n * @package\t\tUploader.Model\n */\nclass UploaderFile extends AppModel {\n\n/**\n * \u30d7\u30e9\u30b0\u30a4\u30f3\u540d\n *\n * @var string\n */\n\tpublic $plugin = 'Uploader';\n\n/**\n * behaviors\n *\n * @var array\n */\n\tpublic $actsAs = [\n\t\t'BcUpload' => [\n\t\t\t'saveDir' => 'uploads',\n\t\t\t'existsCheckDirs' => ['uploads/limited'],\n\t\t\t'fields' => [\n\t\t\t\t'name' => ['type'\t=> 'all']\n\t]]];\n\n/**\n * \u516c\u958b\u671f\u9593\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\n *\n * @return bool\n */\n\tpublic function checkPeriod() {\n\t\tif(!empty($this->data['UploaderFile']['publish_begin']) && !empty($this->data['UploaderFile']['publish_end'])) {\n\t\t\tif(strtotime($this->data['UploaderFile']['publish_begin']) > strtotime($this->data['UploaderFile']['publish_end'])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n/**\n * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\n *\n * @param\tint\t\t$id\n * @param\tstring\t$table\n * @param\tstring\t$ds\n */\n\tpublic function __construct($id = false, $table = null, $ds = null) {\n\t\t$this->validate = [\n\t\t\t'publish_begin' => [\n\t\t\t\t'checkPeriod' => [\n\t\t\t\t\t'rule' => 'checkPeriod',\n\t\t\t\t\t'message' => __d('baser', '\u516c\u958b\u671f\u9593\u304c\u4e0d\u6b63\u3067\u3059\u3002')\n\t\t\t\t]\n\t\t\t],\n\t\t\t'publish_end' => [\n\t\t\t\t'checkPeriod' => [\n\t\t\t\t\t'rule' => 'checkPeriod',\n\t\t\t\t\t'message' => __d('baser', '\u516c\u958b\u671f\u9593\u304c\u4e0d\u6b63\u3067\u3059\u3002')\n\t\t\t\t]\n\t\t\t]\n\t\t];\n\t\tif(!BcUtil::isAdminUser() || !Configure::read('Uploader.allowedAdmin')) {\n\t\t\t$this->validate['name'] = [\n\t\t\t\t'fileExt' => [\n\t\t\t\t\t'rule' => ['fileExt', Configure::read('Uploader.allowedExt')],\n\t\t\t\t\t'message' => __d('baser', '\u8a31\u53ef\u3055\u308c\u3066\u3044\u306a\u3044\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3067\u3059\u3002')\n\t\t\t\t]\n\t\t\t];\n\t\t}\n\t\tparent::__construct($id, $table, $ds);\n\t\t$sizes = array('large', 'midium', 'small', 'mobile_large', 'mobile_small');\n\t\t$UploaderConfig = ClassRegistry::init('Uploader.UploaderConfig');\n\t\t$uploaderConfigs = $UploaderConfig->findExpanded();\n\t\t$imagecopy = array();\n\t\t\n\t\tforeach($sizes as $size) {\n\t\t\tif(!isset($uploaderConfigs[$size.'_width']) || !isset($uploaderConfigs[$size.'_height'])) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$imagecopy[$size] = array('suffix'\t=> '__'.$size);\n\t\t\t$imagecopy[$size]['width'] = $uploaderConfigs[$size.'_width'];\n\t\t\t$imagecopy[$size]['height'] = $uploaderConfigs[$size.'_height'];\n\t\t\tif(isset($uploaderConfigs[$size.'_thumb'])) {\n\t\t\t\t$imagecopy[$size]['thumb'] = $uploaderConfigs[$size.'_thumb'];\n\t\t\t}\n\t\t}\n\t\t\n\t\t$settings = $this->actsAs['BcUpload'];\n\t\t$settings['fields']['name']['imagecopy'] = $imagecopy;\n\t\t$this->Behaviors->attach('BcUpload', $settings);\n\n\t\t// BcUploadBehavior \u3088\u308a\u512a\u5148\u9806\u4f4d\u3092\u3042\u3052\u308b\u70ba\u767b\u9332\u3001\u30a4\u30d9\u30f3\u30c8\u3092\u767b\u9332\u3057\u306a\u304a\u3059\n\t\t$this->getEventManager()->detach([$this, 'beforeDelete'], 'Model.beforeDelete');\n\t\t$this->getEventManager()->attach([$this, 'beforeDelete'], 'Model.beforeDelete', ['priority' => 5]);\n\n\t}\n\n/**\n * Before Save\n *\n * @param array $options\n * @return bool\n */\n\tpublic function beforeSave($options = array()) {\n\t\tparent::beforeSave($options);\n\t\t\n\t\tif(!empty($this->data['UploaderFile']['id'])) {\n\t\t\t\n\t\t\t$savePath = WWW_ROOT . 'files' . DS . $this->actsAs['BcUpload']['saveDir'] . DS;\n\t\t\t$sizes = array('large', 'midium', 'small', 'mobile_large', 'mobile_small');\n\t\t\t$pathinfo = pathinfo($this->data['UploaderFile']['name']);\n\t\t\t\n\t\t\tif(!empty($this->data['UploaderFile']['publish_begin']) || !empty($this->data['UploaderFile']['publish_end'])) {\n\t\t\t\tif(file_exists($savePath . $this->data['UploaderFile']['name'])) {\n\t\t\t\t\trename($savePath . $this->data['UploaderFile']['name'], $savePath . 'limited' . DS . $this->data['UploaderFile']['name']);\n\t\t\t\t}\n\t\t\t\tforeach($sizes as $size) {\n\t\t\t\t\t$file = $pathinfo['filename'] . '__' . $size . '.' . $pathinfo['extension'];\n\t\t\t\t\tif(file_exists($savePath . $file)) {\n\t\t\t\t\t\trename($savePath . $file, $savePath . 'limited' . DS . $file);\n\t\t\t\t\t}\n\t\t\t\t}\t\n\t\t\t} else {\n\t\t\t\tif(file_exists($savePath . 'limited' . DS . $this->data['UploaderFile']['name'])) {\n\t\t\t\t\trename($savePath . 'limited' . DS . $this->data['UploaderFile']['name'], $savePath . $this->data['UploaderFile']['name']);\n\t\t\t\t}\n\t\t\t\tforeach($sizes as $size) {\n\t\t\t\t\t$file = $pathinfo['filename'] . '__' . $size . '.' . $pathinfo['extension'];\n\t\t\t\t\tif(file_exists($savePath . 'limited' . DS . $file)) {\n\t\t\t\t\t\trename($savePath . 'limited' . DS . $file, $savePath . $file);\n\t\t\t\t\t}\n\t\t\t\t}\t\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn true;\n\t}\n\n/**\n * \u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\n *\n * @param\tstring\t$fileName\n * @return\tbool\n */\n\tpublic function fileExists($fileName, $limited = false) {\n\t\t\n\t\tif($limited) {\n\t\t\t$savePath = WWW_ROOT . 'files' . DS . $this->actsAs['BcUpload']['saveDir'] . DS . 'limited' . DS . $fileName;\n\t\t} else {\n\t\t\t$savePath = WWW_ROOT . 'files' . DS . $this->actsAs['BcUpload']['saveDir'] . DS . $fileName;\n\t\t}\n\t\treturn file_exists($savePath);\n\n\t}\n\n/**\n * \u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\n * \n * @param\tstring\t$fileName\n * @return\tarray\n */\n\tpublic function filesExists($fileName, $limited = null) {\n\t\tif(is_null($limited)) {\n\t\t\t$data = $this->find('first', array('conditions' => array('UploaderFile.name' => $fileName), 'recursive' => -1));\n\t\t\t$limited = false;\n\t\t\tif(!empty($data['UploaderFile']['publish_begin']) || !empty($data['UploaderFile']['publish_end'])) {\n\t\t\t\t$limited = true;\n\t\t\t}\n\t\t}\n\t\t$pathinfo = pathinfo($fileName);\n\t\t$ext = $pathinfo['extension'];\n\t\t$basename = mb_basename($fileName,'.'.$ext);\n\t\t$files['small'] = $this->fileExists($basename.'__small'.'.'.$ext, $limited);\n\t\t$files['midium'] = $this->fileExists($basename.'__midium'.'.'.$ext, $limited);\n\t\t$files['large'] = $this->fileExists($basename.'__large'.'.'.$ext, $limited);\n\t\treturn $files;\n\t}\n\n/**\n * \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\u3059\u308b\n *\n * @param\tstring\t$field\t\t\t\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\n * @param\tarray\t$options\n * @return\tmixed\t$controlSource\t\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30bd\u30fc\u30b9\n */\n\tpublic function getControlSource($field = null, $options = array()) {\n\t\tswitch ($field) {\n\t\t\tcase 'user_id':\n\t\t\t\t$User = ClassRegistry::getObject('User');\n\t\t\t\treturn $User->getUserList($options);\n\t\t\tcase 'uploader_category_id':\n\t\t\t\t$UploaderCategory = ClassRegistry::init('Uploader.UploaderCategory');\n\t\t\t\treturn $UploaderCategory->find('list', array('order' => 'UploaderCategory.id'));\n\t\t}\n\t\treturn false;\n\t}\n\n/**\n * \u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u79f0\u3092\u53d6\u5f97\u3059\u308b\n * @param $fileName\n * @return mixed\n */\n\tpublic function getSourceFileName($fileName) {\n\t\t$sizes = array('large', 'midium', 'small', 'mobile_large', 'mobile_small');\n\t\treturn preg_replace('/__(' . implode('|', $sizes) . ')\\./', '.', $fileName);\n\t}\n\n/**\n * Before Delete\n *\n * @param bool $cascade\n * @return bool\n */\n\tpublic function beforeDelete($cascade = true) {\n\t\t$data = $this->read(null, $this->id);\n\t\tif(!empty($data['UploaderFile']['publish_begin']) || !empty($data['UploaderFile']['publish_end'])) {\n\t\t\t$this->Behaviors->BcUpload->savePath['UploaderFile'] .= 'limited' . DS;\n\t\t} else {\n\t\t\t$this->Behaviors->BcUpload->savePath['UploaderFile'] = preg_replace('/' . preg_quote('limited' . DS, '/') . '$/', '', $this->Behaviors->BcUpload->savePath['UploaderFile']);\n\t\t}\n\t\treturn parent::beforeDelete($cascade);\n\t}\n\t\n}\n\n", "<?php\n/**\n * baserCMS :  Based Website Development Project <http://basercms.net>\n * Copyright (c) baserCMS Users Community <http://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttp://basercms.net baserCMS Project\n * @package\t\t\tBaser.View\n * @since\t\t\tbaserCMS v 0.1.0\n * @license\t\t\thttp://basercms.net/license/index.html\n */\n\n/**\n * [ADMIN] \u30c6\u30fc\u30de\u30d5\u30a9\u30eb\u30c0\u767b\u9332\u30fb\u7de8\u96c6\n *\n * @var BcAppView $this\n */\n$this->BcBaser->js('admin/theme_files/form_folder');\n$parentPrams = $params = explode('/', $path);\nif ($this->request->action !== 'admin_add_folder') {\n\tunset($parentPrams[count($parentPrams)-1]);\n}\n?>\n\n\n<div class=\"em-box align-left\">\n<?php echo __d('baser', '\u73fe\u5728\u306e\u4f4d\u7f6e')?>\uff1a<?php echo h($currentPath) ?>\n</div>\n\n<?php if ($this->request->action == 'admin_add_folder'): ?>\n\t<?php echo $this->BcForm->create('ThemeFolder', ['id' => 'TemplateForm', 'url' => array_merge(['controller' => 'theme_files', 'action' => 'add_folder', $theme, $type], $params)]) ?>\n<?php else: ?>\n\t<?php echo $this->BcForm->create('ThemeFolder', ['id' => 'TemplateForm', 'url' => array_merge(['controller' => 'theme_files', 'action' => 'edit_folder', $theme, $type], $params)]) ?>\n<?php endif ?>\n\n<?php echo $this->BcFormTable->dispatchBefore() ?>\n\n<?php if($theme\t!= 'core' && !$isWritable): ?>\n\t<div id=\"AlertMessage\"><?php echo __d('baser', '\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u306e\u3067\u7de8\u96c6\u3067\u304d\u307e\u305b\u3093\u3002')?></div>\n<?php endif ?>\n\n<?php echo $this->BcForm->input('ThemeFolder.parent', ['type' => 'hidden']) ?>\n<?php echo $this->BcForm->input('ThemeFolder.pastname', ['type' => 'hidden']) ?>\n\n<!-- form -->\n<div class=\"section\">\n\t<table cellpadding=\"0\" cellspacing=\"0\" id=\"FormTable\" class=\"form-table\">\n\t\t<tr>\n\t\t\t<th class=\"col-head\"><?php echo $this->BcForm->label('ThemeFolder.name', __d('baser', '\u30d5\u30a9\u30eb\u30c0\u540d')) ?>&nbsp;<span class=\"required\">*</span></th>\n\t\t\t<td class=\"col-input\">\n\t\t\t\t<?php if ($this->request->action != 'admin_view_folder'): ?>\n\t\t\t\t\t<?php echo $this->BcForm->input('ThemeFolder.name', ['type' => 'text', 'size' => 40, 'maxlength' => 255, 'autofocus' => true]) ?>\n\t\t\t\t\t<?php echo $this->Html->image('admin/icn_help.png', ['id' => 'helpName', 'class' => 'btn help', 'alt' => __d('baser', '\u30d8\u30eb\u30d7')]) ?>\n\t\t\t\t\t<div id=\"helptextName\" class=\"helptext\">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t<li><?php echo __d('baser', '\u30d5\u30a9\u30eb\u30c0\u540d\u306f\u534a\u89d2\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002')?></li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<?php echo $this->BcForm->error('ThemeFolder.name') ?>\n\t\t\t\t<?php else: ?>\n\t\t\t\t\t<?php echo $this->BcForm->input('ThemeFolder.name', ['type' => 'text', 'size' => 40, 'readonly' => 'readonly']) ?>\n\t\t\t\t<?php endif ?>\n\t\t\t</td>\n\t\t</tr>\n\t\t<?php echo $this->BcForm->dispatchAfterForm() ?>\n\t</table>\n</div>\n\n<?php echo $this->BcFormTable->dispatchAfter() ?>\n\n<div class=\"submit\">\n\t<?php if ($this->request->action == 'admin_add_folder'): ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], $parentPrams), ['class' => 'btn-gray button']); ?>\n\t\t<?php echo $this->BcForm->submit(__d('baser', '\u4fdd\u5b58'), ['div' => false, 'class' => 'button', 'id' => 'BtnSave']) ?>\n\t<?php elseif ($this->request->action == 'admin_edit_folder'): ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], $parentPrams), ['class' => 'btn-gray button']); ?>\n\t\t<?php if($isWritable): ?>\n\t\t\t<?php echo $this->BcForm->submit(__d('baser', '\u4fdd\u5b58'), ['div' => false, 'class' => 'button', 'id' => 'BtnSave']) ?>\n\t\t\t<?php $this->BcBaser->link(__d('baser', '\u524a\u9664'), array_merge(['action' => 'del', $theme, $type], $params), ['class' => 'submit-token button'], sprintf(__d('baser', '%s \u3092\u672c\u5f53\u306b\u524a\u9664\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u304b\uff1f'), $this->BcForm->value('ThemeFolder.name')), false\t) ?>\n\t\t<?php endif ?>\t\n\t<?php else: ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u4e00\u89a7\u306b\u623b\u308b'), array_merge(['action' => 'index', $theme, $plugin, $type], $parentPrams), ['class' => 'btn-gray button']); ?>\n\t\t<?php if (!$safeModeOn): ?>\n\t\t\t<?php if ($theme == 'core'): ?>\n\t\t\t\t<?php $this->BcBaser->link(__d('baser', '\u73fe\u5728\u306e\u30c6\u30fc\u30de\u306b\u30b3\u30d4\u30fc'), array_merge(['action' => 'copy_folder_to_theme', $theme, $plugin, $type], $params), ['class' => 'submit-token btn-red button'], sprintf(__d('baser', \"\u672c\u5f53\u306b\u73fe\u5728\u306e\u30c6\u30fc\u30de\u300c %s \u300d\u306b\u30b3\u30d4\u30fc\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u304b\uff1f\\n\u65e2\u306b\u5b58\u5728\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f\u4e0a\u66f8\u304d\u3055\u308c\u307e\u3059\u3002\"), Inflector::camelize($siteConfig['theme']))); ?>\n\t\t\t<?php endif ?>\n\t\t<?php else: ?>\n            <?php echo __d('baser', '\u6a5f\u80fd\u5236\u9650\u306e\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u73fe\u5728\u306e\u30c6\u30fc\u30de\u3078\u306e\u30b3\u30d4\u30fc\u306f\u3067\u304d\u307e\u305b\u3093\u3002')?>\n\t\t<?php endif ?>\n\t<?php endif ?>\n</div>\n\n<?php echo $this->BcForm->end() ?>\n", "<?php\n/**\n * baserCMS :  Based Website Development Project <http://basercms.net>\n * Copyright (c) baserCMS Users Community <http://basercms.net/community/>\n *\n * @copyright\t\tCopyright (c) baserCMS Users Community\n * @link\t\t\thttp://basercms.net baserCMS Project\n * @package\t\t\tBaser.View\n * @since\t\t\tbaserCMS v 0.1.0\n * @license\t\t\thttp://basercms.net/license/index.html\n */\n\n/**\n * [ADMIN] \u30c6\u30fc\u30de\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\n */\n$writable = true;\nif ((is_dir($fullpath) && !is_writable($fullpath)) || $theme == 'core') {\n\t$writable = false;\n}\n$this->BcBaser->js([\n\t'admin/libs/jquery.baser_ajax_data_list',\n\t'admin/libs/jquery.baser_ajax_batch',\n\t'admin/libs/baser_ajax_data_list_config',\n\t'admin/libs/baser_ajax_batch_config'\n]);\n$params = explode('/', $path);\n?>\n\n\n<script type=\"text/javascript\">\n$(function(){\n\t$(\"#ThemeFileFile\").change(function(){\n\t\t$(\"#Waiting\").show();\n\t\t$(\"#ThemeFileUpload\").submit();\n\t});\n\t$.baserAjaxDataList.init();\n\t$.baserAjaxBatch.init({ url: $(\"#AjaxBatchUrl\").html()});\n});\n</script>\n\n\n<div id=\"AjaxBatchUrl\" style=\"display:none\"><?php $this->BcBaser->url(array_merge(['controller' => 'theme_files', 'action' => 'ajax_batch', $theme, $type], $params)) ?></div>\n<div id=\"AlertMessage\" class=\"message\" style=\"display:none\"></div>\n<div id=\"MessageBox\" style=\"display:none\"><div id=\"flashMessage\" class=\"notice-message\"></div></div>\n\n<!-- current -->\n<div class=\"em-box align-left\"><?php echo __d('baser', '\u73fe\u5728\u306e\u4f4d\u7f6e')?>\uff1a<?php echo h($currentPath) ?>\n\t<?php if (!$writable): ?>\n\t\t\u3000<span style=\"color:#FF3300\">[<?php echo __d('baser', '\u66f8\u8fbc\u4e0d\u53ef')?>]</span>\n\t<?php endif ?>\n</div>\n\n<div id=\"DataList\"><?php $this->BcBaser->element('theme_files/index_list') ?></div>\n\n<div class=\"submit\">\n\t<?php if ($writable): ?>\n\t\t<?php echo $this->BcForm->create('ThemeFile', ['id' => 'ThemeFileUpload', 'url' => array_merge(['action' => 'upload', $theme, $plugin, $type], $params), 'enctype' => 'multipart/form-data']) ?>\n\t\t<?php echo $this->BcForm->input('ThemeFile.file', ['type' => 'file']) ?>\n\t\t<?php echo $this->BcForm->end() ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u30d5\u30a9\u30eb\u30c0\u65b0\u898f\u4f5c\u6210'), array_merge(['action' => 'add_folder', $theme, $type], $params), ['class' => 'btn-orange button']) ?>\n\t<?php endif ?>\n\t<?php if (($path || $type != 'etc') && $type != 'img' && $writable): ?>\n\t\t<?php $this->BcBaser->link(__d('baser', '\u30d5\u30a1\u30a4\u30eb\u65b0\u898f\u4f5c\u6210'), array_merge(['action' => 'add', $theme, $type], $params), ['class' => 'btn-red button']) ?>\n\t<?php endif ?>\n</div>\n"], "filenames": ["app/webroot/theme/admin-third/ThemeFiles/admin/form_folder.php", "app/webroot/theme/admin-third/ThemeFiles/admin/index.php", "lib/Baser/Plugin/Uploader/Config/setting.php", "lib/Baser/Plugin/Uploader/Model/UploaderFile.php", "lib/Baser/View/ThemeFiles/admin/form_folder.php", "lib/Baser/View/ThemeFiles/admin/index.php"], "buggy_code_start_loc": [28, 48, 48, 76, 27, 47], "buggy_code_end_loc": [29, 49, 51, 77, 28, 48], "fixing_code_start_loc": [28, 48, 49, 76, 27, 47], "fixing_code_end_loc": [29, 49, 55, 77, 28, 48], "type": "CWE-79", "message": "baserCMS 4.3.6 and earlier is affected by Cross Site Scripting (XSS) and Remote Code Execution (RCE). This may be executed by logging in as a system administrator and uploading an executable script file such as a PHP file.The affected components are ThemeFilesController.php and UploaderFilesController.php. This is fixed in version 4.3.7.", "other": {"cve": {"id": "CVE-2020-15159", "sourceIdentifier": "security-advisories@github.com", "published": "2020-08-28T22:15:10.657", "lastModified": "2020-09-03T14:20:46.927", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "baserCMS 4.3.6 and earlier is affected by Cross Site Scripting (XSS) and Remote Code Execution (RCE). This may be executed by logging in as a system administrator and uploading an executable script file such as a PHP file.The affected components are ThemeFilesController.php and UploaderFilesController.php. This is fixed in version 4.3.7."}, {"lang": "es", "value": "baserCMS versiones 4.3.6 y anteriores, esta afectado por una vulnerabilidad de tipo Cross Site Scripting (XSS) y Remote Code Execution (RCE). Esta puede ser ejecutada al iniciar sesi\u00f3n como administrador del sistema y cargando un archivo de script ejecutable tal y como un archivo PHP. Los componentes afectados son los archivos ThemeFilesController.php y UploaderFilesController.php. Esto es corregido en la versi\u00f3n 4.3.7"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.6, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.0, "impactScore": 6.0}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 7.6, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.0, "impactScore": 6.0}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:H/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "HIGH", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 4.6}, "baseSeverity": "MEDIUM", "exploitabilityScore": 3.9, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:basercms:basercms:*:*:*:*:*:*:*:*", "versionEndIncluding": "4.3.6", "matchCriteriaId": "3D8C0605-796C-4AA8-ACD8-1444D95A121B"}]}]}], "references": [{"url": "https://basercms.net/security/20200827", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}, {"url": "https://github.com/baserproject/basercms/commit/16a7b3cd09a0ca355474119c76897eac2034a66d", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/baserproject/basercms/security/advisories/GHSA-673x-f5wx-fxpw", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/baserproject/basercms/commit/16a7b3cd09a0ca355474119c76897eac2034a66d"}}