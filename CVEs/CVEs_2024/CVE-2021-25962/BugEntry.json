{"buggy_code": ["# Changelog\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n## Unreleased\n\nList all changes after the last release here (newer on top). Each change on a separate bullet point line\n\n### Fixed\n\n- General: fix critical vulnerability on views that were returning not escaped content making it open to XSS attacks\n\n### Changed\n\n- Reports: prevent formulas from being exported in excel writer\n- Tests: log errors into a log file\n- Admin: hide email template button based on permission\n- Reports: improve log when an importer fails\n\n### Added\n\n- Reports: add CSV report writer\n\n## [2.10.8] - 2021-06-30\n\n### Changed\n\n- Pull translations from Transifex\n\n## [2.10.7] - 2021-06-29\n\n\n### Changed\n\n- Core: only consider lines from the same supplier as the behavior component\n\n\n## [2.10.6] - 2021-06-25\n\n### Fixed\n\n- Utils: fix MultiLanguageModelForm so language dependent filed will only be required if the language is required\n\n## [2.10.5] - 2021-06-21\n\n### Fixed\n\n- Xtheme: removed orderable boolean from async highlights plugin from being rendered\n\n## [2.10.4] - 2021-06-21\n\n### Changed\n\n- Admin: show taxless order total column in order list\n\n## [2.10.3] - 2021-06-15\n\n### Fixed\n\n- Importer: fix so the correct context is displayed on first request when selecting importer\n\n## [2.10.2] - 2021-06-11\n\n### Added\n\n- Xtheme: Add so snippets can have start of head content\n\n### Fixed\n\n- Core: fix so task don't require a identifier\n\n## [2.10.1] - 2021-06-07\n\n### Fixed\n\n- SimpleSupplier: always return products as managed by using a different queryset\n\n## [2.10.0] - 2021-06-07\n\n### Removed\n\n- Admin: remove the provides to allow adding extra fields to the Attribute form\n\n### Add\n\n- Core: Allow a supplier to have multiple modules\n- Core: add option to store tasks in the database to collect results\n\n### Changed\n\n- General: pull translation strings from Transifex\n- Admin: filter products in list and edit views according to product kind listing name\n- Core: suppliers don't have default supplier modules anymore\n- Importers: enable importers to run asynchronously\n- Importers: change the admin views to show the list of import processes\n\n### Fixed\n\n- Admin: fix picotable overflow issue\n- Notify: always overrride the current notification data with the new one\n\n## [2.9.2] - 2021-05-26\n\n### Fixed\n\n- General: replace hash() with sha1() as Python's hash() function doesn't have a stable result across processes\n- Core: use SHA-1 to hash cache keys as Python's hash() function doesn't have a stable result across processes\n\n### Changed\n\n- Cache product orderability and prices using a list of user groups instead of per contact\n- Pull translation strings from Transifex\n\n## [2.9.1] - 2021-05-24\n\n### Fixed\n\n- Admin: add ordering to attribute filter, because of frontend related error\n\n## [2.9.0] - 2021-05-19\n\n### Added\n\n- Admin: add a method in AdminModule that allows returning help texts for permissions\n\n### Fixed\n\n- Notify: add notify styles to the script editor iframe to fix email editor size\n- Importer: use more bites in order to detect csv dialect in importer\n- Admin: save the current user menu using the current language\n\n### Changed\n\n- Pull DE translations from Transifex\n- Xtheme: allow async plugin to have orderable only flag set\n- Xtheme: use the current language as part of the plugins cache key\n\n## [2.8.3] - 2021-05-17\n\n### Fixed\n\n- Xtheme: use the context while generating the cache key\n- Xtheme: do not crash the whole site when a plugin fails to render\n- Admin: Force to parse reason as string before encoding the url\n\n## [2.8.2] - 2021-05-14\n\n### Fixed\n\n- Admin: force escape help texts which can contain `\"` characters\n- Admin: show translation fields from all polymorphic models available\n- Xtheme: hash the cache key to prevent strings larger then 250 chars\n\n## [2.8.1] - 2021-05-11\n\n### Fixed\n\n- Xtheme: encode cache key into base64 to prevent issues with memcache\n\n## [2.8.0] - 2021-05-11\n\n### Changed\n\n- General: make some plugins cacheable\n- Xtheme: add attribute on every plugin to indicate whether it can be cached or not\n\n### Removed\n\n- Xtheme: removed the SHUUP_XTHEME_USE_PLACEHOLDER_CACHE setting and do not cache the entire placeholder content\n\n### Fixed\n\n- Core: implement choice attribute getter and setter correctly\n- Admin: collect translation strings from Shepard Tour\n\n## [2.7.3] - 2021-05-11\n\n### Fixed\n\n- Admin: use correct translated label syntax for form fields\n- Front: Remove untranslated Error! prefix in alert messages\n- Campaigns: fix the translation string format\n\n### Changed\n\n- General: use gettext_lazy to make sure translations work\n- Front: unify the Customer Information title across the dashboard\n- Front: bump bootstrap-select and use translated strings while initializing it\n\n## [2.7.2] - 2021-05-05\n\n### Fixed\n\n- Admin: Fix the Select2 translations strings\n- General: Collect translation strings correctly\n\n### Changed\n\n- General: Pull translation strings\n\n## [2.7.1] - 2021-05-04\n\n### Fixed\n\n- Core: do not use message tags as part of the message as it doesn't contain translated string\n- Core: fix the python string format syntax to format after resolving the translation string\n\n### Changed\n\n- Settings: add Portuguese (Portugal) as a language option\n\n## [2.7.0] - 2021-04-29\n\n### Added\n\n- Admin: New type of attribute: CHOICES\n- Admin: Selection of multiple choices from attribute for product\n- Front: Product filter by attribute choices\n\n### Changed\n\n- Pull strings from Transifex\n\n### Fixed\n\n- Reports: convert string into translated string\n- Update requirements to support Python3.6+\n- Fix mass editing validation for ManyToManyField fields.\n\n## [2.6.5] - 2021-04-22\n\n### Changed\n\n- Front: consider the supplier from context or kwargs while reversing the product url\n\n### Fixed\n\n- Front: Fix the order detail template\n- Admin: Pass languages to the TaxClassFormPart to show multilanguage forms\n\n## [2.6.4] - 2021-04-19\n\n### Changed\n\n- Additional German translation strings\n\n## [2.6.3] - 2021-04-13\n\n### Changed\n\n- Update German translation strings\n\n## [2.6.2] - 2021-04-13\n\n### Fixed\n\n- Front: pin LESS version to prevent build breaks\n\n## [2.6.1] - 2021-04-13\n\n### Changed\n\n- Front: add extra head block to base template\n- Core: allow refunds creation when the order is complete\n- Admin: show the product picture in order item list\n- Admin: change so TaxClassEditView is a FormPartView\n- Admin: Picotable to scroll in container on overflow rather, than entire screen scroll\n\n### Fixed\n\n- Front: Fix error that occurred while trying to register as a company\n- Front: fix non existent macro import\n- Core: Fix error that occurred when creating an order with a product which SKU was longer than 48 characters.\n- Admin: Multiple duplicate images being saved when image is uploaded before product is saved\n\n## [2.6.0] - 2021-03-29\n\n### Changed\n\n- Admin: Improve the copy product functionality\n\n### Added\n\n- Admin: add number of received orders in orders menu\n- Admin: add contact CSV exporter\n- CORE: Add .jsx support for shuup_makemessages command\n\n### Fixed\n\n- Admin: prevent exporting products that are not accessible by the current user\n- Fix 'Customize Your Admin Menu' redirecting to the supplier specific edit page on saving.\n- Admin: Fix picotable mobile styling to default to full-width\n- Front: Fail cleanly when visiting a product page without supplier\n- Fix Docker build issues with the development compose file.\n\n## [2.5.0] - 2021-03-22\n\n### Changed\n\n- Front: Add so `basket.get_final_lines(with_taxes=True)` gets called after selecting shipping- and payment method.\n  Reason for this is so all the taxes gets calculated before end customers fills in their payment details\n- Core: undeprecate signals for ShopProduct model\n\n### Added\n\n- Core: add attribute in Carrier model to control whether to manage shipments using default behavior\n- Admin: add shipment list view to list all shipments\n\n### Fixed\n\n- Notify: Fix so there is no 500 error when accessing EmailTemplate settings page\n- Taxes: fallback location to billing address when shipping address is not available\n- Importer: Ignore rows without any data\n\n## [2.4.0] - 2021-03-02\n\n### Added\n\n- Admin: add option to hide font selection and always paste plain text in summernote editors\n\n### Changed\n\n- Core: move refund order line logic to tax module\n  - Since each refund line you need to take care of the taxes it is\n  more logical if the tax module handles the whole thing. With some\n  3rd party taxation tool you need an option to handle refund taxes\n  in different way.\n\n### Fixed\n\n- Added missing labels to product category and supplier fields\n\n## [2.3.18] - 2021-03-01\n\n### Added\n\n- Front: create shipment sent notify event\n- Core: add shipment tracking url to shipment model\n- Admin: add shipment action to mark a shipment as sent\n\n### Changed\n\n- Admin: fix product module not to fail on object does not exists\n- Front: update media upload URL from \"media-upload/\" to \"upload-media/\"\n- Core: bump attribute name to 256 characters\n\n## [2.3.17] - 2021-02-23\n\n### Fixed\n\n- Core: Adding normal products with only deleted children to basket\n\n### Removed\n\n- Front: remove templatecache around basket partial as not stable with custom baskets\n\n## [2.3.16] - 2021-02-18\n\n### Fixed\n\n- Xtheme: fix wrong queryset that was fetching different products from the selection\n\n## [2.3.15] - 2021-02-17\n\n### Changed\n\n- Admin: Disable scrolling on jquery datetime pickers\n- Core: Turn variation parent mode back to normal if it has no non-deleted children\n- Core: add cached property groups_ids for Contact\n- Core: add lru_cache to display unit\n- Core: make some Contact properties cached\n- Front: optimize queries for orderable variations fetch\n- Core: set shop and product for shop instance to prevent query\n- Front: prefetch sales units for category view\n- Lock cryptography version for test builds\n- Use shop instead theme settings shop when initializing theme\n- Xtheme: save current theme to request for later usage\n- GDPR: add lru_cache for shop_setting getter\n\n### Fixed\n\n- Admin: fix bug in user permission view\n- Do not rely on STATIC_URL and MEDIA_URL while formatting static and media urls\n\n## [2.3.14] - 2021-02-04\n\n- Front: add template cache to basket partial\n- Core: avoid unnecessary touching to basket customer \u2026\n- Core: cache basket attributes while get and add cache key attribute \u2026\n- Front: skip front middleware for static and media\n- Core: add makemessages support for do and cache templatetags\n- Update license header for 2021\n\n## [2.3.13] - 2021-01-28\n\n### Added\n\n- Admin: Add an open/close all groups button to 'Granular Permission Groups' list.\n\n### Fixed\n\n- Admin: Update styling for media browser\n- Admin: Ensure media browser images are squares without cropping\n- Xtheme: fix sortable import for static resources\n- Admin: Gracefully handle the error when trying to delete a PROTECTED MediaFolder.\n\n## [2.3.12] - 2021-01-26\n\n### Added\n\n- Setup: add .html to MANIFEST.in\n- Admin: Add text truncate CSS to user dropdown if the user's username\n  gets too long and display only a user icon on mobile screens\n- Admin: always display the dashboard link in the main navigation as the first item\n- Save basket just before starting the order creation.\n  This ensures we have latest basket there on store\n- Save basket after shipping or payment method is saved.\n- Save basket after shipping or billing address is saved. For\n  saving the addresses to basket data\n- Add option to add log entries linked to stored baskets\n- Add detail page for carts\n\n### Changed\n\n- Admin: Change visit shop link from an icon to a button with text\n- Hide \"finished\" carts by default\n- Modify carts list to show latest cart first\n\n### Removed\n\n- Admin: Remove dashboard and home icon links from top menu\n- Remove the delay filter as useless. No need to hide carts\n\n## [2.3.11] - 2021-01-25\n\n### Added\n\n- Core: add verbose_name to shop product so we can translate it\n- Core: add middleware provides to the basket command handler\n- Core: add provides to retrieve properties from order or order source\n- Front: render subscription options in basket template\n- Core: add provider to retrieve subscription options for a given product\n\n### Changed\n\n- Front: render basket and order line properties using the `front_line_properties_descriptor` provides\n- Admin: change the product files form part icon to a file icon\n- Core: cache language utils methods using LRU\n\n## [2.3.10] - 2021-01-22\n\n- Notify: make email template form use code editor with preview\n- Notify: make email action body use code editor with preview\n- Admin: add code editor with preview widget\n- Notify: Remove breadcrumbs from editor and add save button on top\n- Notify: make editor close button to Close instead Done\n- Add related name to package links to enable better queryset performance\n- Ensure migrations are fine for longer log entry fields\n\n## [2.3.9] - 2021-01-19\n\n### Changed\n\n- Admin: add UX improvements through small style updates\n\n### Fixed\n\n- Admin: add apply filters button and display active filters counter badge\n  - Do not save and refresh Picotable lists on filter change, but wait\n  that the user selects the \"Apply filter\" option. Also show badge for\n  active filters to indicate that some content is filtered out.\n  Consider \"_all\" as not filter.\n- Xtheme: fix summernote icons by using the original summernote css file\n\n## [2.3.8] - 2021-01-13\n\n- Front: fix with the product images on price update\n  - patches previous v2.3.7 release\n\n## [2.3.7] - 2021-01-12\n\n- Front: improve async product carousel breakpoints\n  - Also add option to easily override breakpoints by\n    re-defining the breakpoint variable.\n- Front: optimize child product orderability checks a bit\n- Front: add option to replace product detail context\n- Front: optimize rendering images for variation products\n- Core: optimize price range calculations\n\n## [2.3.6] - 2021-01-08\n\n### Added\n\n- Admin: add mass action to send password reset emails to selected users\n- Notify: send notification when user request to reset password\n- Core: remove the dependency of shuup.notify while resetting user's password\n- Core: add signal that is triggered when user request a password reset email\n\n## [2.3.5] - 2021-01-07\n\n- Core: unify tax number max length at models\n  - Also good practice would be not to validate tax number\n  on model level but instead at the form since tax number\n  format varies per country/region.\n\n## [2.3.4] - 2021-01-06\n\n### Changed\n\n- Xtheme: use the shop provider instead of falling back to first shop\n- Admin: cache the user permissions in the user object\n- Admin: make shop provider cache the shop in the request\n- Xtheme: add option to disable placeholder cache\n  - Use setting SHUUP_XTHEME_USE_PLACEHOLDER_CACHE = True for this\n\n### Removed\n\n- Core: remove GB from countries in European Union\n\n\n## [2.3.3] - 2021-01-05\n\n- Patches v2.3.2 a bit around the xtheme editing\n\n- Xtheme: add Jinja markup in custom snippet type\n\n\n## [2.3.2] - 2021-01-04\n\n### Changed\n\n- GDPR: hide consent immediately on accept\n- Notify: Make HTML default format for emails\n- Improve the way the cache is bumped when order is created and changed\n\n### Fixed\n\n- Admin: fix missing `tr` closing tags\n\n### Removed\n\n- Notify: Remove HTML editor from notifications since summernote does not\nfunction Jinja syntax very well and for example for-loops and ifs\ncause easily broken notifications.\n\n\n## [2.3.1] - 2020-12-28\n\n### Changed\n\n- Admin: MultiselectAjaxView returns ordered by name choices\n\n### Fixed\n\n- Fix `0068_help_text_improvements` migration file to have the correct field char size: 128\n- Fix _vertical_phases.jinja incorrectly targets all forms\n- Fix initial value of Choose to register form\n\n## [2.3.0] - 2020-12-16\n\n### Added\n\n- Dashboard: Sorting of dashboard items by ordering number\n- Xtheme: add option to set a custom cell width in placeholders\n\n### Changed\n\n- Admin: set product default price value initial value to zero\n\n### Fixed\n\n- Admin: Fix multiple translations returned when using values_list on translated field\n- Front: Fix so mass and measurements unit is displayed in same unit as in the backend\n\n### Removed\n\n- Product variation management. [Use this instead](https://pypi.org/project/shuup-product-variations/).\n\n## [2.2.11] - 2020-12-08\n\n### Fixed\n\n- SimpleCMS: Show all CMS pages for authenticated users\n  when there is no group filter attached to the page\n\n## [2.2.10] - 2020-12-04\n\n### Fixed\n\n- GDPR: do not create consent for anonymous user in checkout\n\n\n## [2.2.9] - 2020-11-23\n\n### Changed\n\n- Core: Increase field lengths in *LogEntry models\n  - Add an index to the indentifier for faster querying.\n  - Use the same error prevention measures for message than is done for\n    identifier in _add_log_entry() for consistency.\n\n### Fixed\n\n- Core: Fix `ProtectedError` when deleting a `Manufacturer` which was still\n  connected to product(s).\n\n\n## [2.2.8] - 2020-11-23\n\n### Added\n\n- Add font size 16 to summernote text editor\n\n### Fixed\n\n- GDPR: make sure to return a blank list in the `get_active_consent_pages`\n  method when there is no page to consent\n\n\n## [2.2.7] - 2020-11-20\n\n### Fixed\n\n- Admin: do not add/remove shop staff member while saving a staff user\n\n\n## [2.2.6] - 2020-11-17\n\n### Added\n\n- Include products belonging to child categories of filtered category\n\n### Changed\n\nAdmin: do not allow non-superusers manage superusers\n  - Do not show is_superuser field for non-superusers no matter\n    who they are editing\n  - Do not show superuser column in list since the superusers are\n    already filtered out from non-superusers who are main people\n    using the admin panel.\n\n\n## [2.2.5] - 2020-11-12\n\n### Fixed\n\n- Front: force recalculate lines after setting the payment and shipping methods to the basket in checkout phase\n\n### Changed\n\n- Don't display taxless price when it's equal to taxful in checkout\n\n### Added\n\n- SimpleCMS: Add field to limit a page availability by permission group\n\n## [2.2.4] - 2020-11-09\n\n### Fixed\n\n- Core: Fix basket implementation that was using the same memory\nobject for all baskets instances in the same process\n\n## [2.2.3] - 2020-11-05\n\n### Fixed\n\n- Add missing id field to the media forms\n\n\n## [2.2.2] - 2020-11-03\n\n### Fixed\n\n- Prevent duplicate images in product media form\n- Do not render duplicate hidden media form field\n\n\n## [2.2.1] - 2020-11-02\n\n### Changed\n\n- Update French, Finnish and Swedish translations\n- Change the Supplier.objects.enabled() filter to only return approved suppliers\n\n### Changed\n\n- Admin: Show a loader in place of picotable when a request is pending.\n\n## [2.2.0] - 2020-10-23\n\n### Possible breaking change\n\n- When updating to this double check your project filters around supplier are working\n  after this Supplire shop->shops change.\n\n### Changed\n\n- Admin: change the supplier views to update the approved flag for the current shop only\n- Core: change the Supplier object manager to consider the approved flag for the given shop\n\n### Added\n\n- Core: add new module SupplierShop to store thre M2M relationship between the supplier\nand the shop with additional attributes\n\n## [2.1.12] - 2020-10-21\n\n### Fixed\n\n- Importer: fix the product importer to prevent parent sku being the current product or other variation child\n\n## [2.1.11] - 2020-10-15\n\n### Added\n\n- Add Spanish and French (CA) translations from Transifex\n- Notify: Add a new `attributes` attribute to `shuup.notify.base.Variable` for showing examples\n  of which attributes can be accessed in the script templates.\n- Notfiy: Show some `Order` related attributes in the notify templates.\n\n### Fixed\n\n- Core: include arbitrary refunds for max refundable amount\n- Admin: select product variation in popup window\n- Importer: ignore None columns while importing files\n- Admin: Show more descriptive error messages in the media uploader in some situations.\n\n### Changed\n\n- Update Finnish and Swedish translations from Transifex\n- Importer: add option to import product variations\n  - Add option to import product variations\n  - Improve handle stock to get supplier by supplier name and\n    set the supplier stock managed and update the module identifier.\n  - Improve handle stock to set the logical count to desired quantity\n    instead adding new stock for the amount. This should help sellers\n    to keep their product stock value correct.\n- Preserve newlines in vendor and product descriptions even when\n `SHUUP_ADMIN_ALLOW_HTML_IN_PRODUCT_DESCRIPTION` and `SHUUP_ADMIN_ALLOW_HTML_IN_VENDOR_DESCRIPTION` are `False`.\n- Importer: log errors in the importer and use specific exception classes instead of using Exception\n- Notify: make the default script language be the fallback from Parler\n- Admin: Hide the 'Root' folder from users that do not have the `\"media.view-all\"` permission.\n\n\n## [2.1.10] - 2020-09-29\n\n### Fixed\n\n- Front: fix typo in pagination\n\n### Translations\n\n- Update Finnish and Swedish translations\n\n\n## [2.1.9] - 2020-09-23\n\n### Fixed\n\n- Fix button that removes coupon from the basket by using the correct JS event property\n\n## [2.1.8] - 2020-09-15\n\n- Update translations strings\n- Importer: fix product CSV importer to better match the headers\n\n\n## [2.1.7] - 2020-09-11\n\n- Admin: improve product variation management. This release purely\n  amends release 2.1.6.\n\n\n## [2.1.6] - 2020-09-11\n\nAdmin: add supplier check to product list and edit views\nAdmin: improve product variation management\n\n  Remove activate template form field as confusing.\n\n  1. Now when add new template:\n    - New empty template is created\n\n  2. When you have template selected:\n    - Product variations are saved based on the form\n    - Variation options are updated to the selected template\n\n  3. When template is not selected:\n    - Product variations are saved based on the form\n\n\n## [2.1.5] - 2020-09-08\n\n### Fixed\n\n- Requirements: require Markdown>=3,<4 instead <3\n- Xtheme: Fix social media plugin form initial data population.\n\n\n## [2.1.4] - 2020-09-08\n\n### Fixed\n\n- Xtheme: fix social media plugin form populate\n- GDPR: Fix anonymization error when an order of a contact had no shipping or billing address.\n\n\n## [2.1.3] - 2020-08-28\n\n### Fixed\n\n- Xtheme: fix model choice widget for plugins (django 2)\n\n\n## [2.1.2] - 2020-08-26\n\n### Fixed\n\n- Xtheme: fix editor template issue\n- Simple CMS: make sure to pass optional parameters through kwargs in form\n\n\n## [2.1.1] - 2020-08-26\n\n### Added\n\n- Admin: add option to delete attributes\n\n### Fixed\n\n- Xtheme: fix editor template issue and make sure to pass optional parameters through kwargs in form\n- Notify: unescape email subject and body to prevent sending broken characters in emails\n\n\n## [2.1.0] - 2020-08-24\n\n### Added\n\n- shuup.notify: add notification_email_before_send signal to SendMail\n- shuup.notify: add event identifier to Context\n\n\n## [2.0.8] - 2020-08-24\n\n### Fixed\n\n- Prevent crashing when trying to cache an unpicklable value.\n\n\n## [2.0.7] - 2020-08-21\n\n### Fixed\n\n- Fix passing a `reverse_lazy()` URL as the `upload_url` argument for `FileDnDUploaderWidget`.\n\n\n## [2.0.6] - 2020-08-18\n\n### Changed\n\n- Admin: Make the order editor keep the suppliers of non-product order lines intact.\n\n### Fixed:\n\n- Admin: Fix the edit button on the order editor.\n\n\n## [2.0.5] - 2020-08-16\n\n### Added\n\n- Admin: user and permission based access to media folders\n\n  This means that all vendors can have their own root folder and do what every they want in that folder.\n  But it also allows the admin to give viewing access to one folder for all suppliers.\n\n\n## [2.0.4] - 2020-08-07\n\n- Testing: add missing migrations\n\n\n## [2.0.3] - 2020-08-07\n\n- CMS: add missing migrations\n\n\n## [2.0.2] - 2020-08-07\n\n### Changed\n\n- Removed Django 1.11 compatible code from the code base\n\n### Fixed\n\n- Admin: fix logout view that was loading the template from Django instead of custom template\n- Admin: return `None` when the order source was not correctly initialized in JsonOrderCreator\n- Core: add parameter in shuup_static to load the version of a given package\n\n\n## [2.0.1] - 2020-08-04\n\n- Add initial support for Django 2.2\n\n\n## [1.11.10] - 2020-08-04\n\n- Fix issue on arranging menu after reset which sets the configuration None\n  which in the other hand is hard to update as it is not dict.\n\n\n## [1.11.9] - 2020-08-04\n\n- Admin: add option to arrange menu for superuses, staff and suppliers\n\n  For now it was only possible to arrange menu per user which is not\n  sufficient while the menu needs to be arranged for the whole group\n  of people like shop staff or vendors.\n\n  Allow to create menu custom menu for superusers, staff or suppliers,\n  but remain the possibility to still arrange the menu per user.\n\n  Add option to translate each menu arranged for these groups since\n  not all vendors/suppliers necessary speak same language.\n\n\n## [1.11.8] - 2020-07-31\n\n### Fixed\n\n- Fix admin order edit tool to use correct id for supplier query\n- Admin: limit the Manufacturer delete queryset per shop\n\n### Added\n\n- Notify: added email template object to store reusable email templates for SendEmail actions\n  This contains a migration step to move all old body template field to use email templates.\n\n### Changed\n\n- Xtheme: move CodeMirror JS lib dependence to Admin\n- Sanitize product description on save if `SHUUP_ADMIN_ALLOW_HTML_IN_PRODUCT_DESCRIPTION` is set to `False`\n\n## [1.11.7] - 2020-07-23\n\n### Added\n\n- Core: Add dynamic measurement unit system\n  - New settings for specifying units:\n    - `SHUUP_MASS_UNIT`\n    - `SHUUP_LENGTH_UNIT`\n  - New function for getting the volume unit: `shuup.core.utils.units.get_shuup_volume_unit`\n\n### Changed\n\n- **BREAKING**: Change `Shipment` default weight unit from `kg` to `g`\n- **BREAKING**: Change `Shipment` default volume unit from `m3` to `mm3`\n- **BREAKING**: Change `ShipmentProduct` default volume unit from `m3` to `mm3`\n\n### Removed\n\n- Remove 'known unit' validation from `MeasurementField`, it can contain any units now\n\n## [1.11.6] - 2020-07-22\n\n### Changed\n\n- Front: Add priority attribute to base order form to enable using precedence\n\n## [1.11.5] - 2020-07-07\n\n### Added\n\n- Add signal when an email is sent by a notification\n\n## [1.11.4] - 2020-07-06\n\n- Fix issue with browser tests\n\n## [1.11.3] - 2020-07-04\n\n### Added\n\n- Add `Dockerfile-dev` for development\n- Add Docker instructions to docs\n\n### Changed\n\n- Add theme for the shop in `shuup_init`\n- Make the shop not be in maintenance mode in `shuup_init`\n- Make `Dockerfile` use `shuup` from PyPi for faster build time\n\n## [1.11.2] - 2020-07-03\n\n- Move workbench sqlite database location for upcoming Docker setup\n\n## [1.11.1] - 2020-07-03\n\n### Added\n\n- Admin: Add settings for controlling allowing HTML in product and vendor descriptions\n\n\n## [1.11.0] - 2020-07-02\n\n### Changed\n\n- Importer: add context object while initializing a importer class\n- Core: use UUID in basket IDs to prevent possible duplicates\n- Core: save basket shipping and billing address as dictionary when id is not available\n- Front: remove the custom _load() implementation from the basket as it is the same as the core\n- Core: ignore lines that are not from the given source while calculating taxes\n- Campaigns: do not apply campaigns in baskets configured to a supplier\n- Admin: change service admin to list only providers that the current user can access\n- Use UUID4 while generating order line ids by default\n- Admin: Improve message banners, by:\n    - Resetting the timeout for hiding the messages when a new message is added.\n    - Immediately clearing the already hidden messages a when new one is added.\n    - Not hiding messages when clicking just random background elements.\n    - Allowing dismissing all of the messages by clicking any one of them anywhere.\n\n### Added\n\n- Admin: add improved product copy\n- Core: add task runner to support running tasks using 3rd party services like Celery\n- Core: add shops and supplier to ServiceProvider and Service models\n- Front: add feature for checkout phases to spawn extra phases\n- Add custom get_ip method and use it everywhere\n- Importer: add permissions for all the diffrent types of importers\n- Importer: add context class to data importer\n\n### Removed\n\n- Travis jobs for Django 1.8 and 1.9\n\n### Fixed\n\n- Removed the kind prefix from feedback messages using Django messages to prevent duplicate strings.\n- Fixed the way the permissions identifier are split in admin\n- Fixed issue that was importing User model directly\n- Core: changed `del` basket command handler to not try to parse the basket line into an integer\n\n\n## [1.10.16] - 2020-06-03\n\n- Simple CMS: Fix a bug with the page links plugin\n\n## [1.10.15] - 2020-06-02\n\n### Changed\n\n- Front: Ensure company name and tax number is set to both billing and shipping address same way\nas when filled through company form when customer is not logged in. Company name and tax number\nat order addresses seems to help with some taxation logic as well as makes things more consistent.\n\n### Fixed\n\n- Admin: Make sure related custom columns are added accrodingly. Fix issue with filtering through columns\nthat are by default hidden\n\n## [1.10.14] - 2020-05-27\n\n### Fixed\n\n- Front: only show carousel title when there is one\n\n### Changed\n\n- Notify: Add AccountActivation event. AccountActivation event is\n  triggered only when the user is activated for the first time.\n- Front: improve next parameter with registration. Check GET\n  parameter first and then fallback to POST data.\n\n## [1.10.13] - 2020-05-20\n\n- Admin: fix width issue with picotable images\n- Admin: fix bugs in order edit and improve it one step closer to\n  multivendor world. Now supports situation when vendors does not\n  share products.\n     - Add option to make shipping and payment method optional\n     - Add supplier to pricing context\n     - Show supplier name on product column\n     - Make auto add for product select false by default\n     - Fix product select2 missing URL and data handler since\n       the whole ajax method was passed as attrs.\n     - Add option to open/close collapsed content sections in mobile\n- Core: add option to enable order edit for multiple vendors\n- Front: do not stack history on product list when filters are changed.\n  Instead replace state so back-buttons works nicely.\n- Front: prevent image Lightbox touching history so you do not need\n  to click back 6 times after you have viewed all images.\n\n## [1.10.12] - 2020-05-05\n\n### Added\n\n- Admin: add error message when upload fails. At media queue complete do not\n  resave product media if the file-count has not changed. This for example\n  prevents media save when the upload itself fails.\n- Admin: add option to override dropzone upload path by using data attribute\n- Admin: add upload path to browser URLs and use it to fallback on media\n  uploads when the actual media path is not available.\n- Admin: Ability to delete manufacturer\n- Admin: Ability to login as the selected contact if it's a user\n\n### Fixed\n\n- Admin: Now when activating/deactivating user it's contact will also change\n- Admin: New notification for when a account get's reactivated\n\n## [1.10.11] - 2020-04-23\n\n### Fixed\n\n- Discounts: create different admin module for archived discounts to fix breadcrumbs\n- Fix product pagination by not overriding the state with undefined values\n\n### Fixed\n\n- Middleware: fix so it trys to take the users timezone first, then the suppliers, last the projects TIME_ZONE\n\n### Changed\n\n- Front: customize sort options through settings\n\n## [1.10.10] - 2020-03-24\n\n### Fixed\n\n- Admin: Notification name when deleteing it\n- Admin: Update contact list so that it only shows customers by default\n- Front: Fix typo\n\n### Changed\n\n- Front: Add supplier choice to best selling product context function\n- Admin: allow sorting categories by name\n- Admin: show product orderability errors as list\n\n\n## [1.10.9] - 2020-03-24\n\n### Fixed\n\n- Admin: remove pinned /sa/ URL from scripts to support dynamic admin URLs\n- Admin: Fix graphical (incorrect indent) bug in Product / Stock Management\n\n## [1.10.8] - 2020-03-20\n\n### Changed\n\n- Admin: add spinner and progressbar options components through Bootstrap 4.\n\n### Fixed\n\n- Issue running category filter browser test with Travis\n\n\n## [1.10.7] - 2020-03-09\n\n### Fixed\n\n- Admin: remove pinned /sa/ URL from scripts to support dynamic admin URLs\n- Front: keep the current query string parameters as the initial state\n  when refreshing product filters.\n\n### Changed\n\n- Admin: fix page jumps after reaload\n- Admin: make browser urls support urls with parameters\n\n## [1.10.6] - 2020-02-28\n\n### Changed\n\n- Core: supplier name max length to 128 from 64\n\n## [1.10.5] - 2020-02-27\n\n### Added\n\n- Add option to send notification event at password recovery\n\n### Changed\n\n- Improve the admin modals to use flexbox and work better on small devices\n\n### Fixed\n\n- Admin: fix password recovery success URL\n- Picotable: render the filters button on small devices,\n  even when there is no data, to allow resetting filters\n\n## [1.10.4] - 2020-02-22\n\n### Changed\n\n- Make Admin messages dismissible\n\n### Fixed\n\n- Admin: Fix search results overflowing the canvas\n\n## [1.10.3] - 2020-02-21\n\n### Fixed\n\n- Admin: fix bug when uploading product media\n\n## [1.10.2] - 2020-02-19\n\n### Added\n\n- Admin: add option to impersonate staff users\n- Notify: add option to delete notify scripts\n- Admin: Allow shop staff to impersonate regular users\n- Notify: Add BCC and CC fields to SendEmail notification action.\n- Add the CHANGELOG.md to the root of the code base.\n\n### Changed\n\n- Xtheme: Improve template injection by checking not wasting time invoking regex for nothing\n- Add `MiddlewareMixin` to all middlewares to prepare for Django 2.x\n- Notify: Changed the Email topology type to support comma-separated list of emails when using constants.\n- Front: skip product filter refresh if filters not defined\n- GDPR: change \"i agree\" button to \"i understand\"\n\n### Fixed\n\n- Front: fix notification template default content\n- Admin: improve primary image fallback for product\n- Fixed the placeholder of Select2 component in Admin\n- FileDnDUploader: Add check for the `data-kind` attribute of the drop zone. If the data-kind is\n  `images`, add an attribute to the hidden input that only allows images to be uploaded.\n- Front: fix bug with imagelightbox\n- CMS: Free page URL on delete\n\n## Older versions\n\nFind older release notes [here](./doc/changelog.rst).\n", "# -*- coding: utf-8 -*-\n# This file is part of Shuup.\n#\n# Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n#\n# This source code is licensed under the OSL-3.0 license found in the\n# LICENSE file in the root directory of this source tree.\nimport csv\nimport six\nfrom babel.dates import format_datetime\nfrom datetime import datetime\nfrom decimal import Decimal\nfrom django.core.serializers.json import DjangoJSONEncoder\nfrom django.db import models\nfrom django.http import HttpResponse\nfrom django.template.defaultfilters import floatformat\nfrom django.template.loader import render_to_string\nfrom django.utils.encoding import smart_text\nfrom django.utils.functional import Promise\nfrom django.utils.html import conditional_escape, escape\nfrom django.utils.safestring import mark_safe\nfrom django.utils.timezone import now\nfrom io import StringIO\nfrom pprint import pformat\nfrom six import BytesIO\n\nfrom shuup.apps.provides import get_provide_objects\nfrom shuup.utils.django_compat import force_text\nfrom shuup.utils.i18n import format_money, get_current_babel_locale, get_locally_formatted_datetime\nfrom shuup.utils.money import Money\nfrom shuup.utils.pdf import render_html_to_pdf\n\ntry:\n    import openpyxl\nexcept ImportError:\n    openpyxl = None\n\n\nREPORT_WRITERS_MAP = {}\n\n\nclass ReportWriter(object):\n    content_type = None\n    extension = None\n    inline = False  # Implementation-dependent\n    writer_type = \"base\"\n\n    def __init__(self):\n        self.title = \"\"\n\n    def __unicode__(self):\n        return self.writer_type\n\n    def __str__(self):\n        return self.writer_type\n\n    def write_heading(self, text):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `write_heading()`.\")\n\n    def write_text(self, text):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `write_text()`.\")\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `write_data_table()`.\")\n\n    def write_template(self, template_name, env):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `write_template()`.\")\n\n    def next_page(self):\n        pass\n\n    def get_rendered_output(self):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `get_rendered_output()`.\")\n\n    def _render_report(self, report):\n        if not report.rendered:\n            report_data = report.get_data()\n            self.write_heading(\n                \"{title} {start} - {end}\".format(\n                    title=report.title,\n                    start=format_datetime(report_data[\"start\"], format=\"short\", locale=get_current_babel_locale()),\n                    end=format_datetime(report_data[\"end\"], format=\"short\", locale=get_current_babel_locale()),\n                )\n            )\n            report.ensure_texts()\n            self.write_data_table(report, report_data[\"data\"], has_totals=report_data[\"has_totals\"])\n\n        return self.get_rendered_output()\n\n    def render_report(self, report, inline=False):\n        \"\"\"\n        Renders given report\n\n        :param report:\n        :type report:\n        :return:\n        :rtype:\n        \"\"\"\n        self.inline = inline\n        rendered_output = self._render_report(report)\n        if self.writer_type == \"html\":\n            output = mark_safe(rendered_output)\n        else:\n            output = mark_safe(\"<pre>%s</pre>\" % escape(rendered_output))\n        return output\n\n    def get_response(self, report):\n        \"\"\"\n        Returns downloadable file response\n\n        :param report:\n        :type report:\n        :return:\n        :rtype:\n        \"\"\"\n        response = HttpResponse(self._render_report(report), content_type=self.content_type)\n        if report.filename_template:\n            response[\"Content-Disposition\"] = \"attachment; filename=%s\" % self.get_filename(report)\n        return response\n\n    def get_filename(self, report):\n        fmt_data = dict(report.options, time=now().isoformat())\n        return \"%s%s\" % ((report.filename_template % fmt_data).replace(\":\", \"_\"), self.extension)\n\n\ndef format_data(data, format_iso_dates=False, format_money_values=False):\n    if data is None:\n        return \"\"\n\n    elif isinstance(data, Money):\n        if format_money_values:\n            return format_money(data)\n        return float(data.as_rounded().value)\n\n    elif isinstance(data, Decimal):\n        exponent = abs(data.normalize().as_tuple().exponent)\n        # Limit the amount of decimals to 10\n        return floatformat(data, min(exponent, 10))\n\n    elif callable(data):\n        return force_text(data())\n\n    elif isinstance(data, Promise):\n        return force_text(data)\n\n    elif isinstance(data, models.Model):\n        return force_text(data)\n\n    elif isinstance(data, datetime):\n        if format_iso_dates:\n            return data.isoformat()\n        return get_locally_formatted_datetime(data)\n\n    return data\n\n\nclass CSVReportWriter(ReportWriter):\n    content_type = \"text/csv\"\n    extension = \".csv\"\n    writer_type = \"csv\"\n\n    def __init__(self):\n        super(CSVReportWriter, self).__init__()\n        self.data = []\n\n    def write_heading(self, text):\n        self.data.append([text])\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        self.data.append([c[\"title\"] for c in report.schema])\n        for datum in report_data:\n            datum = report.read_datum(datum)\n            self.data.append([format_data(data, format_iso_dates=True) for data in datum])\n\n        if has_totals:\n            for datum in report.get_totals(report_data):\n                datum = report.read_datum(datum)\n                self.data.append([format_data(data) for data in datum])\n\n    def get_rendered_output(self):\n        f = StringIO()\n        csv.writer(f).writerows(self.data)\n        return f.getvalue().encode()\n\n\nclass ExcelReportWriter(ReportWriter):\n    content_type = \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"\n    extension = \".xlsx\"\n    writer_type = \"excel\"\n\n    def __init__(self):\n        super(ExcelReportWriter, self).__init__()\n        self.workbook = openpyxl.Workbook()\n        self.worksheet = self.workbook.active\n\n    def next_page(self):\n        self.worksheet = self.workbook.create_sheet()\n\n    def _convert_row_to_string(self):\n        # change the format of the last row to string if that is a formula\n        for cell in self.worksheet[self.worksheet.max_row]:\n            if cell.data_type == \"f\":\n                cell.data_type = \"s\"\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        self.worksheet.append([c[\"title\"] for c in report.schema])\n        for datum in report_data:\n            datum = report.read_datum(datum)\n            self.worksheet.append([format_data(data) for data in datum])\n            self._convert_row_to_string()\n\n        if has_totals:\n            for datum in report.get_totals(report_data):\n                datum = report.read_datum(datum)\n                self.worksheet.append([format_data(data) for data in datum])\n                self._convert_row_to_string()\n\n    def write_page_heading(self, text):\n        self.worksheet.append([text])\n        self.worksheet.append([\"\"])\n\n    def write_heading(self, text):\n        self.worksheet.append([text])\n\n    def write_text(self, text):\n        self.worksheet.append(text)\n\n    def get_rendered_output(self):\n        bio = BytesIO()\n        self.workbook.save(bio)\n        return bio.getvalue()\n\n\nclass HTMLReportWriter(ReportWriter):\n    content_type = \"text/html; charset=UTF-8\"\n    extension = \".html\"\n    writer_type = \"html\"\n\n    INLINE_TEMPLATE = \"\"\"\n    <style type=\"text/css\">%(style)s</style>\n    %(body)s\n    \"\"\".strip()\n\n    TEMPLATE = (\n        \"\"\"\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>%(title)s</title>\n%(extrahead)s\n</head>\"\"\".strip()\n        + INLINE_TEMPLATE\n        + \"\"\"</html>\"\"\"\n    )\n\n    styles = \"\"\"@page { prince-shrink-to-fit: auto }\"\"\".strip()\n    extra_header = \"\"\n\n    def __init__(self):\n        super(HTMLReportWriter, self).__init__()\n        self.output = []\n\n    def _w_raw(self, content):\n        self.output.append(mark_safe(content))\n\n    def _w(self, content):\n        self.output.append(format_data(content, format_money_values=True))\n\n    def _w_tag(self, tag, content):\n        self._w_raw(\"<%s>\" % tag)\n        self._w(content)\n        self._w_raw(\"</%s>\" % tag)\n\n    def next_page(self):\n        self._w_raw(\"<hr>\")\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        self._w_raw('<table class=\"table table-striped table-bordered\">')\n        self._w_raw(\"<thead><tr>\")\n        for c in report.schema:\n            self._w_tag(\"th\", c[\"title\"])\n        self._w_raw(\"</tr></thead>\")\n        self._w_raw(\"<tbody>\")\n\n        for datum in report_data:\n            datum = report.read_datum(datum)\n            self._w_raw(\"<tr>\")\n            for d in datum:\n                self._w_tag(\"td\", d)\n            self._w_raw(\"</tr>\")\n\n        if has_totals:\n            self._w_raw(\"<tr>\")\n            for d in report.read_datum(report.get_totals(report_data)):\n                self._w_tag(\"td\", d)\n            self._w_raw(\"</tr>\")\n\n        self._w_raw(\"</tbody></table>\")\n\n    def write_page_heading(self, text):\n        self._w_tag(\"h1\", text)\n\n    def write_heading(self, text):\n        self._w_tag(\"h2\", text)\n\n    def write_text(self, text):\n        self._w(text)\n\n    def write_tag(self, tag, text):\n        self._w_tag(tag, text)\n\n    def get_rendered_output(self):\n        body = \"\".join(conditional_escape(smart_text(piece)) for piece in self.output)\n        styles = self.styles\n        extrahead = self.extra_header or \"\"\n\n        if self.inline:\n            template = self.INLINE_TEMPLATE\n        else:\n            template = self.TEMPLATE\n\n        html = template % {\"title\": self.title, \"body\": body, \"style\": styles, \"extrahead\": extrahead}\n        if not self.inline:\n            html = html.encode(\"UTF-8\")\n        return html\n\n    def set_extra(self, extrastring):\n        self.extra_header = extrastring\n\n    def set_style(self, stylestring):\n        self.styles = stylestring\n\n    def write_template(self, template_name, env):\n        data = render_to_string(template_name, env)\n        if isinstance(data, str):\n            data = data.decode(\"UTF-8\")\n        self._w_raw(data)\n\n\nclass PDFReportWriter(HTMLReportWriter):\n    content_type = \"application/pdf\"\n    extension = \".pdf\"\n    writer_type = \"pdf\"\n\n    def get_rendered_output(self):\n        html = HTMLReportWriter.get_rendered_output(self)\n        pdf_response = render_html_to_pdf(html)\n        return pdf_response.content\n\n\nclass JSONReportWriter(ReportWriter):\n    content_type = \"application/json\"\n    extension = \".json\"\n    writer_type = \"json\"\n\n    def __init__(self):\n        super(JSONReportWriter, self).__init__()\n        self.data = {}\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        table = {\n            \"columns\": report.schema,\n            \"data\": [\n                dict(\n                    (c[\"key\"], format_data(val, format_iso_dates=True))\n                    for (c, val) in zip(report.schema, report.read_datum(datum))\n                )\n                for datum in report_data\n            ],\n        }\n\n        if has_totals:\n            table[\"totals\"] = report.get_totals(report_data)\n\n        self.data.setdefault(\"tables\", []).append(table)\n\n    def write_heading(self, text):\n        self.data[\"heading\"] = text\n\n    def write_text(self, text):\n        pass\n\n    def get_rendered_output(self):\n        return DjangoJSONEncoder(indent=4).encode(self.data)\n\n\nclass PprintReportWriter(JSONReportWriter):\n    content_type = \"text/plain\"\n    extension = \".txt\"\n    writer_type = \"pprint\"\n\n    def get_rendered_output(self):\n        return pformat(self.data)\n\n\nclass ReportWriterPopulator(object):\n    \"\"\"\n    A class which populates the report writers map.\n    \"\"\"\n\n    report_writers_map = {}\n\n    def populate(self):\n        \"\"\"\n        Iterate over all report_writer_populator provides to fill/update the report writer map\n        \"\"\"\n        for report_writer_populator_func in get_provide_objects(\"report_writer_populator\"):\n            report_writer_populator_func(self)\n\n    def register(self, writer_name, writer_class):\n        \"\"\"\n        Register a report writer for use.\n\n        If a writer with same name already exists, it will be overwriten.\n\n        :type writer_name: str\n        :param writer_name: the unique name of the writer\n        :type writer_class: ReportWriter\n        :param writer_class: the report writer class\n        \"\"\"\n        self.report_writers_map[writer_name] = writer_class\n\n    @property\n    def populated_map(self):\n        \"\"\" Returns the populated map. \"\"\"\n        return self.report_writers_map\n\n\ndef get_writer_names():\n    \"\"\" Get the registered writer names. \"\"\"\n    return set([k for k, v in six.iteritems(REPORT_WRITERS_MAP) if v])\n\n\ndef get_writer_instance(writer_name):\n    \"\"\"\n    Get a report writer instance by name.\n\n    :type writer_name: str\n    :param writer_name: the name of the report writer\n    :rtype: ReportWriter\n    \"\"\"\n    writer = REPORT_WRITERS_MAP[writer_name]()\n    assert isinstance(writer, ReportWriter)\n    return writer\n\n\ndef populate_default_writers(writer_populator):\n    \"\"\"\n    Populate the default report writers.\n\n    :type writer_populator: ReportWriterPopulator\n    \"\"\"\n    writer_populator.register(\"html\", HTMLReportWriter)\n    writer_populator.register(\"pdf\", PDFReportWriter)\n    writer_populator.register(\"json\", JSONReportWriter)\n    writer_populator.register(\"pprint\", PprintReportWriter)\n    writer_populator.register(\"csv\", CSVReportWriter)\n\n    if openpyxl:\n        writer_populator.register(\"excel\", ExcelReportWriter)\n\n\n# populate them\npopulator = ReportWriterPopulator()\npopulator.populate()\nREPORT_WRITERS_MAP.update(populator.populated_map)\n"], "fixing_code": ["# Changelog\nAll notable changes to this project will be documented in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),\nand this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n## Unreleased\n\nList all changes after the last release here (newer on top). Each change on a separate bullet point line\n\n### Fixed\n\n- General: fix critical vulnerability on views that were returning not escaped content making it open to XSS attacks\n\n### Changed\n\n- Reports: clean malicius content from the HTML and CSV exporters\n- Reports: prevent formulas from being exported in excel writer\n- Tests: log errors into a log file\n- Admin: hide email template button based on permission\n- Reports: improve log when an importer fails\n\n### Added\n\n- Reports: add CSV report writer\n\n## [2.10.8] - 2021-06-30\n\n### Changed\n\n- Pull translations from Transifex\n\n## [2.10.7] - 2021-06-29\n\n\n### Changed\n\n- Core: only consider lines from the same supplier as the behavior component\n\n\n## [2.10.6] - 2021-06-25\n\n### Fixed\n\n- Utils: fix MultiLanguageModelForm so language dependent filed will only be required if the language is required\n\n## [2.10.5] - 2021-06-21\n\n### Fixed\n\n- Xtheme: removed orderable boolean from async highlights plugin from being rendered\n\n## [2.10.4] - 2021-06-21\n\n### Changed\n\n- Admin: show taxless order total column in order list\n\n## [2.10.3] - 2021-06-15\n\n### Fixed\n\n- Importer: fix so the correct context is displayed on first request when selecting importer\n\n## [2.10.2] - 2021-06-11\n\n### Added\n\n- Xtheme: Add so snippets can have start of head content\n\n### Fixed\n\n- Core: fix so task don't require a identifier\n\n## [2.10.1] - 2021-06-07\n\n### Fixed\n\n- SimpleSupplier: always return products as managed by using a different queryset\n\n## [2.10.0] - 2021-06-07\n\n### Removed\n\n- Admin: remove the provides to allow adding extra fields to the Attribute form\n\n### Add\n\n- Core: Allow a supplier to have multiple modules\n- Core: add option to store tasks in the database to collect results\n\n### Changed\n\n- General: pull translation strings from Transifex\n- Admin: filter products in list and edit views according to product kind listing name\n- Core: suppliers don't have default supplier modules anymore\n- Importers: enable importers to run asynchronously\n- Importers: change the admin views to show the list of import processes\n\n### Fixed\n\n- Admin: fix picotable overflow issue\n- Notify: always overrride the current notification data with the new one\n\n## [2.9.2] - 2021-05-26\n\n### Fixed\n\n- General: replace hash() with sha1() as Python's hash() function doesn't have a stable result across processes\n- Core: use SHA-1 to hash cache keys as Python's hash() function doesn't have a stable result across processes\n\n### Changed\n\n- Cache product orderability and prices using a list of user groups instead of per contact\n- Pull translation strings from Transifex\n\n## [2.9.1] - 2021-05-24\n\n### Fixed\n\n- Admin: add ordering to attribute filter, because of frontend related error\n\n## [2.9.0] - 2021-05-19\n\n### Added\n\n- Admin: add a method in AdminModule that allows returning help texts for permissions\n\n### Fixed\n\n- Notify: add notify styles to the script editor iframe to fix email editor size\n- Importer: use more bites in order to detect csv dialect in importer\n- Admin: save the current user menu using the current language\n\n### Changed\n\n- Pull DE translations from Transifex\n- Xtheme: allow async plugin to have orderable only flag set\n- Xtheme: use the current language as part of the plugins cache key\n\n## [2.8.3] - 2021-05-17\n\n### Fixed\n\n- Xtheme: use the context while generating the cache key\n- Xtheme: do not crash the whole site when a plugin fails to render\n- Admin: Force to parse reason as string before encoding the url\n\n## [2.8.2] - 2021-05-14\n\n### Fixed\n\n- Admin: force escape help texts which can contain `\"` characters\n- Admin: show translation fields from all polymorphic models available\n- Xtheme: hash the cache key to prevent strings larger then 250 chars\n\n## [2.8.1] - 2021-05-11\n\n### Fixed\n\n- Xtheme: encode cache key into base64 to prevent issues with memcache\n\n## [2.8.0] - 2021-05-11\n\n### Changed\n\n- General: make some plugins cacheable\n- Xtheme: add attribute on every plugin to indicate whether it can be cached or not\n\n### Removed\n\n- Xtheme: removed the SHUUP_XTHEME_USE_PLACEHOLDER_CACHE setting and do not cache the entire placeholder content\n\n### Fixed\n\n- Core: implement choice attribute getter and setter correctly\n- Admin: collect translation strings from Shepard Tour\n\n## [2.7.3] - 2021-05-11\n\n### Fixed\n\n- Admin: use correct translated label syntax for form fields\n- Front: Remove untranslated Error! prefix in alert messages\n- Campaigns: fix the translation string format\n\n### Changed\n\n- General: use gettext_lazy to make sure translations work\n- Front: unify the Customer Information title across the dashboard\n- Front: bump bootstrap-select and use translated strings while initializing it\n\n## [2.7.2] - 2021-05-05\n\n### Fixed\n\n- Admin: Fix the Select2 translations strings\n- General: Collect translation strings correctly\n\n### Changed\n\n- General: Pull translation strings\n\n## [2.7.1] - 2021-05-04\n\n### Fixed\n\n- Core: do not use message tags as part of the message as it doesn't contain translated string\n- Core: fix the python string format syntax to format after resolving the translation string\n\n### Changed\n\n- Settings: add Portuguese (Portugal) as a language option\n\n## [2.7.0] - 2021-04-29\n\n### Added\n\n- Admin: New type of attribute: CHOICES\n- Admin: Selection of multiple choices from attribute for product\n- Front: Product filter by attribute choices\n\n### Changed\n\n- Pull strings from Transifex\n\n### Fixed\n\n- Reports: convert string into translated string\n- Update requirements to support Python3.6+\n- Fix mass editing validation for ManyToManyField fields.\n\n## [2.6.5] - 2021-04-22\n\n### Changed\n\n- Front: consider the supplier from context or kwargs while reversing the product url\n\n### Fixed\n\n- Front: Fix the order detail template\n- Admin: Pass languages to the TaxClassFormPart to show multilanguage forms\n\n## [2.6.4] - 2021-04-19\n\n### Changed\n\n- Additional German translation strings\n\n## [2.6.3] - 2021-04-13\n\n### Changed\n\n- Update German translation strings\n\n## [2.6.2] - 2021-04-13\n\n### Fixed\n\n- Front: pin LESS version to prevent build breaks\n\n## [2.6.1] - 2021-04-13\n\n### Changed\n\n- Front: add extra head block to base template\n- Core: allow refunds creation when the order is complete\n- Admin: show the product picture in order item list\n- Admin: change so TaxClassEditView is a FormPartView\n- Admin: Picotable to scroll in container on overflow rather, than entire screen scroll\n\n### Fixed\n\n- Front: Fix error that occurred while trying to register as a company\n- Front: fix non existent macro import\n- Core: Fix error that occurred when creating an order with a product which SKU was longer than 48 characters.\n- Admin: Multiple duplicate images being saved when image is uploaded before product is saved\n\n## [2.6.0] - 2021-03-29\n\n### Changed\n\n- Admin: Improve the copy product functionality\n\n### Added\n\n- Admin: add number of received orders in orders menu\n- Admin: add contact CSV exporter\n- CORE: Add .jsx support for shuup_makemessages command\n\n### Fixed\n\n- Admin: prevent exporting products that are not accessible by the current user\n- Fix 'Customize Your Admin Menu' redirecting to the supplier specific edit page on saving.\n- Admin: Fix picotable mobile styling to default to full-width\n- Front: Fail cleanly when visiting a product page without supplier\n- Fix Docker build issues with the development compose file.\n\n## [2.5.0] - 2021-03-22\n\n### Changed\n\n- Front: Add so `basket.get_final_lines(with_taxes=True)` gets called after selecting shipping- and payment method.\n  Reason for this is so all the taxes gets calculated before end customers fills in their payment details\n- Core: undeprecate signals for ShopProduct model\n\n### Added\n\n- Core: add attribute in Carrier model to control whether to manage shipments using default behavior\n- Admin: add shipment list view to list all shipments\n\n### Fixed\n\n- Notify: Fix so there is no 500 error when accessing EmailTemplate settings page\n- Taxes: fallback location to billing address when shipping address is not available\n- Importer: Ignore rows without any data\n\n## [2.4.0] - 2021-03-02\n\n### Added\n\n- Admin: add option to hide font selection and always paste plain text in summernote editors\n\n### Changed\n\n- Core: move refund order line logic to tax module\n  - Since each refund line you need to take care of the taxes it is\n  more logical if the tax module handles the whole thing. With some\n  3rd party taxation tool you need an option to handle refund taxes\n  in different way.\n\n### Fixed\n\n- Added missing labels to product category and supplier fields\n\n## [2.3.18] - 2021-03-01\n\n### Added\n\n- Front: create shipment sent notify event\n- Core: add shipment tracking url to shipment model\n- Admin: add shipment action to mark a shipment as sent\n\n### Changed\n\n- Admin: fix product module not to fail on object does not exists\n- Front: update media upload URL from \"media-upload/\" to \"upload-media/\"\n- Core: bump attribute name to 256 characters\n\n## [2.3.17] - 2021-02-23\n\n### Fixed\n\n- Core: Adding normal products with only deleted children to basket\n\n### Removed\n\n- Front: remove templatecache around basket partial as not stable with custom baskets\n\n## [2.3.16] - 2021-02-18\n\n### Fixed\n\n- Xtheme: fix wrong queryset that was fetching different products from the selection\n\n## [2.3.15] - 2021-02-17\n\n### Changed\n\n- Admin: Disable scrolling on jquery datetime pickers\n- Core: Turn variation parent mode back to normal if it has no non-deleted children\n- Core: add cached property groups_ids for Contact\n- Core: add lru_cache to display unit\n- Core: make some Contact properties cached\n- Front: optimize queries for orderable variations fetch\n- Core: set shop and product for shop instance to prevent query\n- Front: prefetch sales units for category view\n- Lock cryptography version for test builds\n- Use shop instead theme settings shop when initializing theme\n- Xtheme: save current theme to request for later usage\n- GDPR: add lru_cache for shop_setting getter\n\n### Fixed\n\n- Admin: fix bug in user permission view\n- Do not rely on STATIC_URL and MEDIA_URL while formatting static and media urls\n\n## [2.3.14] - 2021-02-04\n\n- Front: add template cache to basket partial\n- Core: avoid unnecessary touching to basket customer \u2026\n- Core: cache basket attributes while get and add cache key attribute \u2026\n- Front: skip front middleware for static and media\n- Core: add makemessages support for do and cache templatetags\n- Update license header for 2021\n\n## [2.3.13] - 2021-01-28\n\n### Added\n\n- Admin: Add an open/close all groups button to 'Granular Permission Groups' list.\n\n### Fixed\n\n- Admin: Update styling for media browser\n- Admin: Ensure media browser images are squares without cropping\n- Xtheme: fix sortable import for static resources\n- Admin: Gracefully handle the error when trying to delete a PROTECTED MediaFolder.\n\n## [2.3.12] - 2021-01-26\n\n### Added\n\n- Setup: add .html to MANIFEST.in\n- Admin: Add text truncate CSS to user dropdown if the user's username\n  gets too long and display only a user icon on mobile screens\n- Admin: always display the dashboard link in the main navigation as the first item\n- Save basket just before starting the order creation.\n  This ensures we have latest basket there on store\n- Save basket after shipping or payment method is saved.\n- Save basket after shipping or billing address is saved. For\n  saving the addresses to basket data\n- Add option to add log entries linked to stored baskets\n- Add detail page for carts\n\n### Changed\n\n- Admin: Change visit shop link from an icon to a button with text\n- Hide \"finished\" carts by default\n- Modify carts list to show latest cart first\n\n### Removed\n\n- Admin: Remove dashboard and home icon links from top menu\n- Remove the delay filter as useless. No need to hide carts\n\n## [2.3.11] - 2021-01-25\n\n### Added\n\n- Core: add verbose_name to shop product so we can translate it\n- Core: add middleware provides to the basket command handler\n- Core: add provides to retrieve properties from order or order source\n- Front: render subscription options in basket template\n- Core: add provider to retrieve subscription options for a given product\n\n### Changed\n\n- Front: render basket and order line properties using the `front_line_properties_descriptor` provides\n- Admin: change the product files form part icon to a file icon\n- Core: cache language utils methods using LRU\n\n## [2.3.10] - 2021-01-22\n\n- Notify: make email template form use code editor with preview\n- Notify: make email action body use code editor with preview\n- Admin: add code editor with preview widget\n- Notify: Remove breadcrumbs from editor and add save button on top\n- Notify: make editor close button to Close instead Done\n- Add related name to package links to enable better queryset performance\n- Ensure migrations are fine for longer log entry fields\n\n## [2.3.9] - 2021-01-19\n\n### Changed\n\n- Admin: add UX improvements through small style updates\n\n### Fixed\n\n- Admin: add apply filters button and display active filters counter badge\n  - Do not save and refresh Picotable lists on filter change, but wait\n  that the user selects the \"Apply filter\" option. Also show badge for\n  active filters to indicate that some content is filtered out.\n  Consider \"_all\" as not filter.\n- Xtheme: fix summernote icons by using the original summernote css file\n\n## [2.3.8] - 2021-01-13\n\n- Front: fix with the product images on price update\n  - patches previous v2.3.7 release\n\n## [2.3.7] - 2021-01-12\n\n- Front: improve async product carousel breakpoints\n  - Also add option to easily override breakpoints by\n    re-defining the breakpoint variable.\n- Front: optimize child product orderability checks a bit\n- Front: add option to replace product detail context\n- Front: optimize rendering images for variation products\n- Core: optimize price range calculations\n\n## [2.3.6] - 2021-01-08\n\n### Added\n\n- Admin: add mass action to send password reset emails to selected users\n- Notify: send notification when user request to reset password\n- Core: remove the dependency of shuup.notify while resetting user's password\n- Core: add signal that is triggered when user request a password reset email\n\n## [2.3.5] - 2021-01-07\n\n- Core: unify tax number max length at models\n  - Also good practice would be not to validate tax number\n  on model level but instead at the form since tax number\n  format varies per country/region.\n\n## [2.3.4] - 2021-01-06\n\n### Changed\n\n- Xtheme: use the shop provider instead of falling back to first shop\n- Admin: cache the user permissions in the user object\n- Admin: make shop provider cache the shop in the request\n- Xtheme: add option to disable placeholder cache\n  - Use setting SHUUP_XTHEME_USE_PLACEHOLDER_CACHE = True for this\n\n### Removed\n\n- Core: remove GB from countries in European Union\n\n\n## [2.3.3] - 2021-01-05\n\n- Patches v2.3.2 a bit around the xtheme editing\n\n- Xtheme: add Jinja markup in custom snippet type\n\n\n## [2.3.2] - 2021-01-04\n\n### Changed\n\n- GDPR: hide consent immediately on accept\n- Notify: Make HTML default format for emails\n- Improve the way the cache is bumped when order is created and changed\n\n### Fixed\n\n- Admin: fix missing `tr` closing tags\n\n### Removed\n\n- Notify: Remove HTML editor from notifications since summernote does not\nfunction Jinja syntax very well and for example for-loops and ifs\ncause easily broken notifications.\n\n\n## [2.3.1] - 2020-12-28\n\n### Changed\n\n- Admin: MultiselectAjaxView returns ordered by name choices\n\n### Fixed\n\n- Fix `0068_help_text_improvements` migration file to have the correct field char size: 128\n- Fix _vertical_phases.jinja incorrectly targets all forms\n- Fix initial value of Choose to register form\n\n## [2.3.0] - 2020-12-16\n\n### Added\n\n- Dashboard: Sorting of dashboard items by ordering number\n- Xtheme: add option to set a custom cell width in placeholders\n\n### Changed\n\n- Admin: set product default price value initial value to zero\n\n### Fixed\n\n- Admin: Fix multiple translations returned when using values_list on translated field\n- Front: Fix so mass and measurements unit is displayed in same unit as in the backend\n\n### Removed\n\n- Product variation management. [Use this instead](https://pypi.org/project/shuup-product-variations/).\n\n## [2.2.11] - 2020-12-08\n\n### Fixed\n\n- SimpleCMS: Show all CMS pages for authenticated users\n  when there is no group filter attached to the page\n\n## [2.2.10] - 2020-12-04\n\n### Fixed\n\n- GDPR: do not create consent for anonymous user in checkout\n\n\n## [2.2.9] - 2020-11-23\n\n### Changed\n\n- Core: Increase field lengths in *LogEntry models\n  - Add an index to the indentifier for faster querying.\n  - Use the same error prevention measures for message than is done for\n    identifier in _add_log_entry() for consistency.\n\n### Fixed\n\n- Core: Fix `ProtectedError` when deleting a `Manufacturer` which was still\n  connected to product(s).\n\n\n## [2.2.8] - 2020-11-23\n\n### Added\n\n- Add font size 16 to summernote text editor\n\n### Fixed\n\n- GDPR: make sure to return a blank list in the `get_active_consent_pages`\n  method when there is no page to consent\n\n\n## [2.2.7] - 2020-11-20\n\n### Fixed\n\n- Admin: do not add/remove shop staff member while saving a staff user\n\n\n## [2.2.6] - 2020-11-17\n\n### Added\n\n- Include products belonging to child categories of filtered category\n\n### Changed\n\nAdmin: do not allow non-superusers manage superusers\n  - Do not show is_superuser field for non-superusers no matter\n    who they are editing\n  - Do not show superuser column in list since the superusers are\n    already filtered out from non-superusers who are main people\n    using the admin panel.\n\n\n## [2.2.5] - 2020-11-12\n\n### Fixed\n\n- Front: force recalculate lines after setting the payment and shipping methods to the basket in checkout phase\n\n### Changed\n\n- Don't display taxless price when it's equal to taxful in checkout\n\n### Added\n\n- SimpleCMS: Add field to limit a page availability by permission group\n\n## [2.2.4] - 2020-11-09\n\n### Fixed\n\n- Core: Fix basket implementation that was using the same memory\nobject for all baskets instances in the same process\n\n## [2.2.3] - 2020-11-05\n\n### Fixed\n\n- Add missing id field to the media forms\n\n\n## [2.2.2] - 2020-11-03\n\n### Fixed\n\n- Prevent duplicate images in product media form\n- Do not render duplicate hidden media form field\n\n\n## [2.2.1] - 2020-11-02\n\n### Changed\n\n- Update French, Finnish and Swedish translations\n- Change the Supplier.objects.enabled() filter to only return approved suppliers\n\n### Changed\n\n- Admin: Show a loader in place of picotable when a request is pending.\n\n## [2.2.0] - 2020-10-23\n\n### Possible breaking change\n\n- When updating to this double check your project filters around supplier are working\n  after this Supplire shop->shops change.\n\n### Changed\n\n- Admin: change the supplier views to update the approved flag for the current shop only\n- Core: change the Supplier object manager to consider the approved flag for the given shop\n\n### Added\n\n- Core: add new module SupplierShop to store thre M2M relationship between the supplier\nand the shop with additional attributes\n\n## [2.1.12] - 2020-10-21\n\n### Fixed\n\n- Importer: fix the product importer to prevent parent sku being the current product or other variation child\n\n## [2.1.11] - 2020-10-15\n\n### Added\n\n- Add Spanish and French (CA) translations from Transifex\n- Notify: Add a new `attributes` attribute to `shuup.notify.base.Variable` for showing examples\n  of which attributes can be accessed in the script templates.\n- Notfiy: Show some `Order` related attributes in the notify templates.\n\n### Fixed\n\n- Core: include arbitrary refunds for max refundable amount\n- Admin: select product variation in popup window\n- Importer: ignore None columns while importing files\n- Admin: Show more descriptive error messages in the media uploader in some situations.\n\n### Changed\n\n- Update Finnish and Swedish translations from Transifex\n- Importer: add option to import product variations\n  - Add option to import product variations\n  - Improve handle stock to get supplier by supplier name and\n    set the supplier stock managed and update the module identifier.\n  - Improve handle stock to set the logical count to desired quantity\n    instead adding new stock for the amount. This should help sellers\n    to keep their product stock value correct.\n- Preserve newlines in vendor and product descriptions even when\n `SHUUP_ADMIN_ALLOW_HTML_IN_PRODUCT_DESCRIPTION` and `SHUUP_ADMIN_ALLOW_HTML_IN_VENDOR_DESCRIPTION` are `False`.\n- Importer: log errors in the importer and use specific exception classes instead of using Exception\n- Notify: make the default script language be the fallback from Parler\n- Admin: Hide the 'Root' folder from users that do not have the `\"media.view-all\"` permission.\n\n\n## [2.1.10] - 2020-09-29\n\n### Fixed\n\n- Front: fix typo in pagination\n\n### Translations\n\n- Update Finnish and Swedish translations\n\n\n## [2.1.9] - 2020-09-23\n\n### Fixed\n\n- Fix button that removes coupon from the basket by using the correct JS event property\n\n## [2.1.8] - 2020-09-15\n\n- Update translations strings\n- Importer: fix product CSV importer to better match the headers\n\n\n## [2.1.7] - 2020-09-11\n\n- Admin: improve product variation management. This release purely\n  amends release 2.1.6.\n\n\n## [2.1.6] - 2020-09-11\n\nAdmin: add supplier check to product list and edit views\nAdmin: improve product variation management\n\n  Remove activate template form field as confusing.\n\n  1. Now when add new template:\n    - New empty template is created\n\n  2. When you have template selected:\n    - Product variations are saved based on the form\n    - Variation options are updated to the selected template\n\n  3. When template is not selected:\n    - Product variations are saved based on the form\n\n\n## [2.1.5] - 2020-09-08\n\n### Fixed\n\n- Requirements: require Markdown>=3,<4 instead <3\n- Xtheme: Fix social media plugin form initial data population.\n\n\n## [2.1.4] - 2020-09-08\n\n### Fixed\n\n- Xtheme: fix social media plugin form populate\n- GDPR: Fix anonymization error when an order of a contact had no shipping or billing address.\n\n\n## [2.1.3] - 2020-08-28\n\n### Fixed\n\n- Xtheme: fix model choice widget for plugins (django 2)\n\n\n## [2.1.2] - 2020-08-26\n\n### Fixed\n\n- Xtheme: fix editor template issue\n- Simple CMS: make sure to pass optional parameters through kwargs in form\n\n\n## [2.1.1] - 2020-08-26\n\n### Added\n\n- Admin: add option to delete attributes\n\n### Fixed\n\n- Xtheme: fix editor template issue and make sure to pass optional parameters through kwargs in form\n- Notify: unescape email subject and body to prevent sending broken characters in emails\n\n\n## [2.1.0] - 2020-08-24\n\n### Added\n\n- shuup.notify: add notification_email_before_send signal to SendMail\n- shuup.notify: add event identifier to Context\n\n\n## [2.0.8] - 2020-08-24\n\n### Fixed\n\n- Prevent crashing when trying to cache an unpicklable value.\n\n\n## [2.0.7] - 2020-08-21\n\n### Fixed\n\n- Fix passing a `reverse_lazy()` URL as the `upload_url` argument for `FileDnDUploaderWidget`.\n\n\n## [2.0.6] - 2020-08-18\n\n### Changed\n\n- Admin: Make the order editor keep the suppliers of non-product order lines intact.\n\n### Fixed:\n\n- Admin: Fix the edit button on the order editor.\n\n\n## [2.0.5] - 2020-08-16\n\n### Added\n\n- Admin: user and permission based access to media folders\n\n  This means that all vendors can have their own root folder and do what every they want in that folder.\n  But it also allows the admin to give viewing access to one folder for all suppliers.\n\n\n## [2.0.4] - 2020-08-07\n\n- Testing: add missing migrations\n\n\n## [2.0.3] - 2020-08-07\n\n- CMS: add missing migrations\n\n\n## [2.0.2] - 2020-08-07\n\n### Changed\n\n- Removed Django 1.11 compatible code from the code base\n\n### Fixed\n\n- Admin: fix logout view that was loading the template from Django instead of custom template\n- Admin: return `None` when the order source was not correctly initialized in JsonOrderCreator\n- Core: add parameter in shuup_static to load the version of a given package\n\n\n## [2.0.1] - 2020-08-04\n\n- Add initial support for Django 2.2\n\n\n## [1.11.10] - 2020-08-04\n\n- Fix issue on arranging menu after reset which sets the configuration None\n  which in the other hand is hard to update as it is not dict.\n\n\n## [1.11.9] - 2020-08-04\n\n- Admin: add option to arrange menu for superuses, staff and suppliers\n\n  For now it was only possible to arrange menu per user which is not\n  sufficient while the menu needs to be arranged for the whole group\n  of people like shop staff or vendors.\n\n  Allow to create menu custom menu for superusers, staff or suppliers,\n  but remain the possibility to still arrange the menu per user.\n\n  Add option to translate each menu arranged for these groups since\n  not all vendors/suppliers necessary speak same language.\n\n\n## [1.11.8] - 2020-07-31\n\n### Fixed\n\n- Fix admin order edit tool to use correct id for supplier query\n- Admin: limit the Manufacturer delete queryset per shop\n\n### Added\n\n- Notify: added email template object to store reusable email templates for SendEmail actions\n  This contains a migration step to move all old body template field to use email templates.\n\n### Changed\n\n- Xtheme: move CodeMirror JS lib dependence to Admin\n- Sanitize product description on save if `SHUUP_ADMIN_ALLOW_HTML_IN_PRODUCT_DESCRIPTION` is set to `False`\n\n## [1.11.7] - 2020-07-23\n\n### Added\n\n- Core: Add dynamic measurement unit system\n  - New settings for specifying units:\n    - `SHUUP_MASS_UNIT`\n    - `SHUUP_LENGTH_UNIT`\n  - New function for getting the volume unit: `shuup.core.utils.units.get_shuup_volume_unit`\n\n### Changed\n\n- **BREAKING**: Change `Shipment` default weight unit from `kg` to `g`\n- **BREAKING**: Change `Shipment` default volume unit from `m3` to `mm3`\n- **BREAKING**: Change `ShipmentProduct` default volume unit from `m3` to `mm3`\n\n### Removed\n\n- Remove 'known unit' validation from `MeasurementField`, it can contain any units now\n\n## [1.11.6] - 2020-07-22\n\n### Changed\n\n- Front: Add priority attribute to base order form to enable using precedence\n\n## [1.11.5] - 2020-07-07\n\n### Added\n\n- Add signal when an email is sent by a notification\n\n## [1.11.4] - 2020-07-06\n\n- Fix issue with browser tests\n\n## [1.11.3] - 2020-07-04\n\n### Added\n\n- Add `Dockerfile-dev` for development\n- Add Docker instructions to docs\n\n### Changed\n\n- Add theme for the shop in `shuup_init`\n- Make the shop not be in maintenance mode in `shuup_init`\n- Make `Dockerfile` use `shuup` from PyPi for faster build time\n\n## [1.11.2] - 2020-07-03\n\n- Move workbench sqlite database location for upcoming Docker setup\n\n## [1.11.1] - 2020-07-03\n\n### Added\n\n- Admin: Add settings for controlling allowing HTML in product and vendor descriptions\n\n\n## [1.11.0] - 2020-07-02\n\n### Changed\n\n- Importer: add context object while initializing a importer class\n- Core: use UUID in basket IDs to prevent possible duplicates\n- Core: save basket shipping and billing address as dictionary when id is not available\n- Front: remove the custom _load() implementation from the basket as it is the same as the core\n- Core: ignore lines that are not from the given source while calculating taxes\n- Campaigns: do not apply campaigns in baskets configured to a supplier\n- Admin: change service admin to list only providers that the current user can access\n- Use UUID4 while generating order line ids by default\n- Admin: Improve message banners, by:\n    - Resetting the timeout for hiding the messages when a new message is added.\n    - Immediately clearing the already hidden messages a when new one is added.\n    - Not hiding messages when clicking just random background elements.\n    - Allowing dismissing all of the messages by clicking any one of them anywhere.\n\n### Added\n\n- Admin: add improved product copy\n- Core: add task runner to support running tasks using 3rd party services like Celery\n- Core: add shops and supplier to ServiceProvider and Service models\n- Front: add feature for checkout phases to spawn extra phases\n- Add custom get_ip method and use it everywhere\n- Importer: add permissions for all the diffrent types of importers\n- Importer: add context class to data importer\n\n### Removed\n\n- Travis jobs for Django 1.8 and 1.9\n\n### Fixed\n\n- Removed the kind prefix from feedback messages using Django messages to prevent duplicate strings.\n- Fixed the way the permissions identifier are split in admin\n- Fixed issue that was importing User model directly\n- Core: changed `del` basket command handler to not try to parse the basket line into an integer\n\n\n## [1.10.16] - 2020-06-03\n\n- Simple CMS: Fix a bug with the page links plugin\n\n## [1.10.15] - 2020-06-02\n\n### Changed\n\n- Front: Ensure company name and tax number is set to both billing and shipping address same way\nas when filled through company form when customer is not logged in. Company name and tax number\nat order addresses seems to help with some taxation logic as well as makes things more consistent.\n\n### Fixed\n\n- Admin: Make sure related custom columns are added accrodingly. Fix issue with filtering through columns\nthat are by default hidden\n\n## [1.10.14] - 2020-05-27\n\n### Fixed\n\n- Front: only show carousel title when there is one\n\n### Changed\n\n- Notify: Add AccountActivation event. AccountActivation event is\n  triggered only when the user is activated for the first time.\n- Front: improve next parameter with registration. Check GET\n  parameter first and then fallback to POST data.\n\n## [1.10.13] - 2020-05-20\n\n- Admin: fix width issue with picotable images\n- Admin: fix bugs in order edit and improve it one step closer to\n  multivendor world. Now supports situation when vendors does not\n  share products.\n     - Add option to make shipping and payment method optional\n     - Add supplier to pricing context\n     - Show supplier name on product column\n     - Make auto add for product select false by default\n     - Fix product select2 missing URL and data handler since\n       the whole ajax method was passed as attrs.\n     - Add option to open/close collapsed content sections in mobile\n- Core: add option to enable order edit for multiple vendors\n- Front: do not stack history on product list when filters are changed.\n  Instead replace state so back-buttons works nicely.\n- Front: prevent image Lightbox touching history so you do not need\n  to click back 6 times after you have viewed all images.\n\n## [1.10.12] - 2020-05-05\n\n### Added\n\n- Admin: add error message when upload fails. At media queue complete do not\n  resave product media if the file-count has not changed. This for example\n  prevents media save when the upload itself fails.\n- Admin: add option to override dropzone upload path by using data attribute\n- Admin: add upload path to browser URLs and use it to fallback on media\n  uploads when the actual media path is not available.\n- Admin: Ability to delete manufacturer\n- Admin: Ability to login as the selected contact if it's a user\n\n### Fixed\n\n- Admin: Now when activating/deactivating user it's contact will also change\n- Admin: New notification for when a account get's reactivated\n\n## [1.10.11] - 2020-04-23\n\n### Fixed\n\n- Discounts: create different admin module for archived discounts to fix breadcrumbs\n- Fix product pagination by not overriding the state with undefined values\n\n### Fixed\n\n- Middleware: fix so it trys to take the users timezone first, then the suppliers, last the projects TIME_ZONE\n\n### Changed\n\n- Front: customize sort options through settings\n\n## [1.10.10] - 2020-03-24\n\n### Fixed\n\n- Admin: Notification name when deleteing it\n- Admin: Update contact list so that it only shows customers by default\n- Front: Fix typo\n\n### Changed\n\n- Front: Add supplier choice to best selling product context function\n- Admin: allow sorting categories by name\n- Admin: show product orderability errors as list\n\n\n## [1.10.9] - 2020-03-24\n\n### Fixed\n\n- Admin: remove pinned /sa/ URL from scripts to support dynamic admin URLs\n- Admin: Fix graphical (incorrect indent) bug in Product / Stock Management\n\n## [1.10.8] - 2020-03-20\n\n### Changed\n\n- Admin: add spinner and progressbar options components through Bootstrap 4.\n\n### Fixed\n\n- Issue running category filter browser test with Travis\n\n\n## [1.10.7] - 2020-03-09\n\n### Fixed\n\n- Admin: remove pinned /sa/ URL from scripts to support dynamic admin URLs\n- Front: keep the current query string parameters as the initial state\n  when refreshing product filters.\n\n### Changed\n\n- Admin: fix page jumps after reaload\n- Admin: make browser urls support urls with parameters\n\n## [1.10.6] - 2020-02-28\n\n### Changed\n\n- Core: supplier name max length to 128 from 64\n\n## [1.10.5] - 2020-02-27\n\n### Added\n\n- Add option to send notification event at password recovery\n\n### Changed\n\n- Improve the admin modals to use flexbox and work better on small devices\n\n### Fixed\n\n- Admin: fix password recovery success URL\n- Picotable: render the filters button on small devices,\n  even when there is no data, to allow resetting filters\n\n## [1.10.4] - 2020-02-22\n\n### Changed\n\n- Make Admin messages dismissible\n\n### Fixed\n\n- Admin: Fix search results overflowing the canvas\n\n## [1.10.3] - 2020-02-21\n\n### Fixed\n\n- Admin: fix bug when uploading product media\n\n## [1.10.2] - 2020-02-19\n\n### Added\n\n- Admin: add option to impersonate staff users\n- Notify: add option to delete notify scripts\n- Admin: Allow shop staff to impersonate regular users\n- Notify: Add BCC and CC fields to SendEmail notification action.\n- Add the CHANGELOG.md to the root of the code base.\n\n### Changed\n\n- Xtheme: Improve template injection by checking not wasting time invoking regex for nothing\n- Add `MiddlewareMixin` to all middlewares to prepare for Django 2.x\n- Notify: Changed the Email topology type to support comma-separated list of emails when using constants.\n- Front: skip product filter refresh if filters not defined\n- GDPR: change \"i agree\" button to \"i understand\"\n\n### Fixed\n\n- Front: fix notification template default content\n- Admin: improve primary image fallback for product\n- Fixed the placeholder of Select2 component in Admin\n- FileDnDUploader: Add check for the `data-kind` attribute of the drop zone. If the data-kind is\n  `images`, add an attribute to the hidden input that only allows images to be uploaded.\n- Front: fix bug with imagelightbox\n- CMS: Free page URL on delete\n\n## Older versions\n\nFind older release notes [here](./doc/changelog.rst).\n", "# -*- coding: utf-8 -*-\n# This file is part of Shuup.\n#\n# Copyright (c) 2012-2021, Shuup Commerce Inc. All rights reserved.\n#\n# This source code is licensed under the OSL-3.0 license found in the\n# LICENSE file in the root directory of this source tree.\nimport bleach\nimport csv\nimport six\nfrom babel.dates import format_datetime\nfrom datetime import datetime\nfrom decimal import Decimal\nfrom django.core.serializers.json import DjangoJSONEncoder\nfrom django.db import models\nfrom django.http import HttpResponse\nfrom django.template.defaultfilters import floatformat\nfrom django.template.loader import render_to_string\nfrom django.utils.encoding import smart_text\nfrom django.utils.functional import Promise\nfrom django.utils.html import conditional_escape, escape\nfrom django.utils.safestring import mark_safe\nfrom django.utils.timezone import now\nfrom io import StringIO\nfrom pprint import pformat\nfrom six import BytesIO\n\nfrom shuup.apps.provides import get_provide_objects\nfrom shuup.utils.django_compat import force_text\nfrom shuup.utils.i18n import format_money, get_current_babel_locale, get_locally_formatted_datetime\nfrom shuup.utils.money import Money\nfrom shuup.utils.pdf import render_html_to_pdf\n\ntry:\n    import openpyxl\nexcept ImportError:\n    openpyxl = None\n\n\nREPORT_WRITERS_MAP = {}\n\n\nclass ReportWriter(object):\n    content_type = None\n    extension = None\n    inline = False  # Implementation-dependent\n    writer_type = \"base\"\n\n    def __init__(self):\n        self.title = \"\"\n\n    def __unicode__(self):\n        return self.writer_type\n\n    def __str__(self):\n        return self.writer_type\n\n    def write_heading(self, text):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `write_heading()`.\")\n\n    def write_text(self, text):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `write_text()`.\")\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `write_data_table()`.\")\n\n    def write_template(self, template_name, env):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `write_template()`.\")\n\n    def next_page(self):\n        pass\n\n    def get_rendered_output(self):\n        raise NotImplementedError(\"Error! Not implemented: `ReportWriter` -> `get_rendered_output()`.\")\n\n    def _render_report(self, report):\n        if not report.rendered:\n            report_data = report.get_data()\n            self.write_heading(\n                \"{title} {start} - {end}\".format(\n                    title=report.title,\n                    start=format_datetime(report_data[\"start\"], format=\"short\", locale=get_current_babel_locale()),\n                    end=format_datetime(report_data[\"end\"], format=\"short\", locale=get_current_babel_locale()),\n                )\n            )\n            report.ensure_texts()\n            self.write_data_table(report, report_data[\"data\"], has_totals=report_data[\"has_totals\"])\n\n        return self.get_rendered_output()\n\n    def render_report(self, report, inline=False):\n        \"\"\"\n        Renders given report\n\n        :param report:\n        :type report:\n        :return:\n        :rtype:\n        \"\"\"\n        self.inline = inline\n        rendered_output = self._render_report(report)\n        if self.writer_type == \"html\":\n            output = mark_safe(rendered_output)\n        else:\n            output = mark_safe(\"<pre>%s</pre>\" % escape(rendered_output))\n        return output\n\n    def get_response(self, report):\n        \"\"\"\n        Returns downloadable file response\n\n        :param report:\n        :type report:\n        :return:\n        :rtype:\n        \"\"\"\n        response = HttpResponse(self._render_report(report), content_type=self.content_type)\n        if report.filename_template:\n            response[\"Content-Disposition\"] = \"attachment; filename=%s\" % self.get_filename(report)\n        return response\n\n    def get_filename(self, report):\n        fmt_data = dict(report.options, time=now().isoformat())\n        return \"%s%s\" % ((report.filename_template % fmt_data).replace(\":\", \"_\"), self.extension)\n\n\ndef format_data(data, format_iso_dates=False, format_money_values=False):\n    if data is None:\n        return \"\"\n\n    elif isinstance(data, Money):\n        if format_money_values:\n            return format_money(data)\n        return float(data.as_rounded().value)\n\n    elif isinstance(data, Decimal):\n        exponent = abs(data.normalize().as_tuple().exponent)\n        # Limit the amount of decimals to 10\n        return floatformat(data, min(exponent, 10))\n\n    elif callable(data):\n        return force_text(data())\n\n    elif isinstance(data, Promise):\n        return force_text(data)\n\n    elif isinstance(data, models.Model):\n        return force_text(data)\n\n    elif isinstance(data, datetime):\n        if format_iso_dates:\n            return data.isoformat()\n        return get_locally_formatted_datetime(data)\n\n    return data\n\n\ndef remove_unsafe_chars(data):\n    if isinstance(data, str):\n        return \"\".join([char for char in data if char not in (\"=\", \"+\", \"-\")])\n\n    return data\n\n\nclass CSVReportWriter(ReportWriter):\n    content_type = \"text/csv\"\n    extension = \".csv\"\n    writer_type = \"csv\"\n\n    def __init__(self):\n        super(CSVReportWriter, self).__init__()\n        self.data = []\n\n    def write_heading(self, text):\n        self.data.append([text])\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        self.data.append([c[\"title\"] for c in report.schema])\n        for datum in report_data:\n            datum = report.read_datum(datum)\n            self.data.append([format_data(remove_unsafe_chars(data), format_iso_dates=True) for data in datum])\n\n        if has_totals:\n            for datum in report.get_totals(report_data):\n                datum = report.read_datum(datum)\n                self.data.append([format_data(remove_unsafe_chars(data)) for data in datum])\n\n    def get_rendered_output(self):\n        f = StringIO()\n        csv.writer(f).writerows(self.data)\n        return f.getvalue().encode()\n\n\nclass ExcelReportWriter(ReportWriter):\n    content_type = \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"\n    extension = \".xlsx\"\n    writer_type = \"excel\"\n\n    def __init__(self):\n        super(ExcelReportWriter, self).__init__()\n        self.workbook = openpyxl.Workbook()\n        self.worksheet = self.workbook.active\n\n    def next_page(self):\n        self.worksheet = self.workbook.create_sheet()\n\n    def _convert_row_to_string(self):\n        # change the format of the last row to string if that is a formula\n        for cell in self.worksheet[self.worksheet.max_row]:\n            if cell.data_type == \"f\":\n                cell.data_type = \"s\"\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        self.worksheet.append([c[\"title\"] for c in report.schema])\n        for datum in report_data:\n            datum = report.read_datum(datum)\n            self.worksheet.append([format_data(remove_unsafe_chars(data)) for data in datum])\n            self._convert_row_to_string()\n\n        if has_totals:\n            for datum in report.get_totals(report_data):\n                datum = report.read_datum(datum)\n                self.worksheet.append([format_data(remove_unsafe_chars(data)) for data in datum])\n                self._convert_row_to_string()\n\n    def write_page_heading(self, text):\n        self.worksheet.append([text])\n        self.worksheet.append([\"\"])\n\n    def write_heading(self, text):\n        self.worksheet.append([text])\n\n    def write_text(self, text):\n        self.worksheet.append(text)\n\n    def get_rendered_output(self):\n        bio = BytesIO()\n        self.workbook.save(bio)\n        return bio.getvalue()\n\n\nclass HTMLReportWriter(ReportWriter):\n    content_type = \"text/html; charset=UTF-8\"\n    extension = \".html\"\n    writer_type = \"html\"\n\n    INLINE_TEMPLATE = \"\"\"\n    <style type=\"text/css\">%(style)s</style>\n    %(body)s\n    \"\"\".strip()\n\n    TEMPLATE = (\n        \"\"\"\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>%(title)s</title>\n%(extrahead)s\n</head>\"\"\".strip()\n        + INLINE_TEMPLATE\n        + \"\"\"</html>\"\"\"\n    )\n\n    styles = \"\"\"@page { prince-shrink-to-fit: auto }\"\"\".strip()\n    extra_header = \"\"\n\n    def __init__(self):\n        super(HTMLReportWriter, self).__init__()\n        self.output = []\n\n    def _w_raw(self, content):\n        self.output.append(mark_safe(content))\n\n    def _w(self, content):\n        self.output.append(bleach.clean(str(format_data(content, format_money_values=True)), strip=True))\n\n    def _w_tag(self, tag, content):\n        self._w_raw(\"<%s>\" % tag)\n        self._w(content)\n        self._w_raw(\"</%s>\" % tag)\n\n    def next_page(self):\n        self._w_raw(\"<hr>\")\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        self._w_raw('<table class=\"table table-striped table-bordered\">')\n        self._w_raw(\"<thead><tr>\")\n        for c in report.schema:\n            self._w_tag(\"th\", c[\"title\"])\n        self._w_raw(\"</tr></thead>\")\n        self._w_raw(\"<tbody>\")\n\n        for datum in report_data:\n            datum = report.read_datum(datum)\n            self._w_raw(\"<tr>\")\n            for d in datum:\n                self._w_tag(\"td\", d)\n            self._w_raw(\"</tr>\")\n\n        if has_totals:\n            self._w_raw(\"<tr>\")\n            for d in report.read_datum(report.get_totals(report_data)):\n                self._w_tag(\"td\", d)\n            self._w_raw(\"</tr>\")\n\n        self._w_raw(\"</tbody></table>\")\n\n    def write_page_heading(self, text):\n        self._w_tag(\"h1\", text)\n\n    def write_heading(self, text):\n        self._w_tag(\"h2\", text)\n\n    def write_text(self, text):\n        self._w(text)\n\n    def write_tag(self, tag, text):\n        self._w_tag(tag, text)\n\n    def get_rendered_output(self):\n        body = \"\".join(conditional_escape(smart_text(piece)) for piece in self.output)\n        styles = self.styles\n        extrahead = self.extra_header or \"\"\n\n        if self.inline:\n            template = self.INLINE_TEMPLATE\n        else:\n            template = self.TEMPLATE\n\n        html = template % {\"title\": self.title, \"body\": body, \"style\": styles, \"extrahead\": extrahead}\n        if not self.inline:\n            html = html.encode(\"UTF-8\")\n        return html\n\n    def set_extra(self, extrastring):\n        self.extra_header = extrastring\n\n    def set_style(self, stylestring):\n        self.styles = stylestring\n\n    def write_template(self, template_name, env):\n        data = render_to_string(template_name, env)\n        if isinstance(data, str):\n            data = data.decode(\"UTF-8\")\n        self._w_raw(data)\n\n\nclass PDFReportWriter(HTMLReportWriter):\n    content_type = \"application/pdf\"\n    extension = \".pdf\"\n    writer_type = \"pdf\"\n\n    def get_rendered_output(self):\n        html = HTMLReportWriter.get_rendered_output(self)\n        pdf_response = render_html_to_pdf(html)\n        return pdf_response.content\n\n\nclass JSONReportWriter(ReportWriter):\n    content_type = \"application/json\"\n    extension = \".json\"\n    writer_type = \"json\"\n\n    def __init__(self):\n        super(JSONReportWriter, self).__init__()\n        self.data = {}\n\n    def write_data_table(self, report, report_data, has_totals=True):\n        table = {\n            \"columns\": report.schema,\n            \"data\": [\n                dict(\n                    (c[\"key\"], format_data(val, format_iso_dates=True))\n                    for (c, val) in zip(report.schema, report.read_datum(datum))\n                )\n                for datum in report_data\n            ],\n        }\n\n        if has_totals:\n            table[\"totals\"] = report.get_totals(report_data)\n\n        self.data.setdefault(\"tables\", []).append(table)\n\n    def write_heading(self, text):\n        self.data[\"heading\"] = text\n\n    def write_text(self, text):\n        pass\n\n    def get_rendered_output(self):\n        return DjangoJSONEncoder(indent=4).encode(self.data)\n\n\nclass PprintReportWriter(JSONReportWriter):\n    content_type = \"text/plain\"\n    extension = \".txt\"\n    writer_type = \"pprint\"\n\n    def get_rendered_output(self):\n        return pformat(self.data)\n\n\nclass ReportWriterPopulator(object):\n    \"\"\"\n    A class which populates the report writers map.\n    \"\"\"\n\n    report_writers_map = {}\n\n    def populate(self):\n        \"\"\"\n        Iterate over all report_writer_populator provides to fill/update the report writer map\n        \"\"\"\n        for report_writer_populator_func in get_provide_objects(\"report_writer_populator\"):\n            report_writer_populator_func(self)\n\n    def register(self, writer_name, writer_class):\n        \"\"\"\n        Register a report writer for use.\n\n        If a writer with same name already exists, it will be overwriten.\n\n        :type writer_name: str\n        :param writer_name: the unique name of the writer\n        :type writer_class: ReportWriter\n        :param writer_class: the report writer class\n        \"\"\"\n        self.report_writers_map[writer_name] = writer_class\n\n    @property\n    def populated_map(self):\n        \"\"\" Returns the populated map. \"\"\"\n        return self.report_writers_map\n\n\ndef get_writer_names():\n    \"\"\" Get the registered writer names. \"\"\"\n    return set([k for k, v in six.iteritems(REPORT_WRITERS_MAP) if v])\n\n\ndef get_writer_instance(writer_name):\n    \"\"\"\n    Get a report writer instance by name.\n\n    :type writer_name: str\n    :param writer_name: the name of the report writer\n    :rtype: ReportWriter\n    \"\"\"\n    writer = REPORT_WRITERS_MAP[writer_name]()\n    assert isinstance(writer, ReportWriter)\n    return writer\n\n\ndef populate_default_writers(writer_populator):\n    \"\"\"\n    Populate the default report writers.\n\n    :type writer_populator: ReportWriterPopulator\n    \"\"\"\n    writer_populator.register(\"html\", HTMLReportWriter)\n    writer_populator.register(\"pdf\", PDFReportWriter)\n    writer_populator.register(\"json\", JSONReportWriter)\n    writer_populator.register(\"pprint\", PprintReportWriter)\n    writer_populator.register(\"csv\", CSVReportWriter)\n\n    if openpyxl:\n        writer_populator.register(\"excel\", ExcelReportWriter)\n\n\n# populate them\npopulator = ReportWriterPopulator()\npopulator.populate()\nREPORT_WRITERS_MAP.update(populator.populated_map)\n"], "filenames": ["CHANGELOG.md", "shuup/reports/writer.py"], "buggy_code_start_loc": [16, 7], "buggy_code_end_loc": [16, 268], "fixing_code_start_loc": [17, 8], "fixing_code_end_loc": [18, 276], "type": "CWE-1236", "message": "\u201cShuup\u201d application in versions 0.4.2 to 2.10.8 is affected by the \u201cFormula Injection\u201d vulnerability. A customer can inject payloads in the name input field in the billing address while buying a product. When a store administrator accesses the reports page to export the data as an Excel file and opens it, the payload gets executed.", "other": {"cve": {"id": "CVE-2021-25962", "sourceIdentifier": "vulnerabilitylab@mend.io", "published": "2021-09-29T14:15:08.070", "lastModified": "2021-10-06T20:30:01.977", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "\u201cShuup\u201d application in versions 0.4.2 to 2.10.8 is affected by the \u201cFormula Injection\u201d vulnerability. A customer can inject payloads in the name input field in the billing address while buying a product. When a store administrator accesses the reports page to export the data as an Excel file and opens it, the payload gets executed."}, {"lang": "es", "value": "La aplicaci\u00f3n \"Shuup\" en versiones 0.4.2 a 2.10.8, est\u00e1 afectada por una vulnerabilidad \"Formula Injection\". Un cliente puede inyectar cargas \u00fatiles en el campo name input en la direcci\u00f3n de facturaci\u00f3n mientras compra un producto. Cuando un administrador de la tienda accede a la p\u00e1gina de informes para exportar los datos como un archivo de Excel y lo abre, la carga \u00fatil es ejecutada\n"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "vulnerabilitylab@mend.io", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.0, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.1, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.8}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-1236"}]}, {"source": "vulnerabilitylab@mend.io", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-1236"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:shuup:shuup:*:*:*:*:*:*:*:*", "versionStartIncluding": "0.4.2", "versionEndExcluding": "2.11.0", "matchCriteriaId": "A567FB15-5A66-4FD9-A3FE-1C25B31CAA55"}]}]}], "references": [{"url": "https://github.com/shuup/shuup/commit/0a2db392e8518410c282412561461cd8797eea51", "source": "vulnerabilitylab@mend.io", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2021-25962", "source": "vulnerabilitylab@mend.io", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/shuup/shuup/commit/0a2db392e8518410c282412561461cd8797eea51"}}