{"buggy_code": ["\n<?php\nrequire(\"../../tasks/passw.php\");\nrequire(\"../../tasks/validate.php\");\nsession_start();\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:../adminlogin.html\");\n   exit();\n}\n\nif($_SERVER['REQUEST_METHOD'] == 'POST')\n{\n  $uemail=htmlspecialchars($_POST[\"email\"], ENT_QUOTES, 'UTF-8');\n  $upass=$_POST[\"password\"];\n\n     //validate\n     if(!(validateEmail($uemail) && validatePass($upass)))\n     {\n         exit(\"Invalid input detected!\");\n     }\n  \n     //check token \n     if(isset($_SESSION[\"c-token\"]) && isset($_POST[\"csrf-token\"]))\n     {\n       $tok=$_POST[\"csrf-token\"];\n       if($_SESSION[\"c-token\"]!=$tok)\n       {\n         exit(\"action denied!\");\n       }\n     } else {\n         exit(\"action denied!\");\n     }\n    \n  //if empty password or username!\n  //alt isempty\n  if($uemail==\"\" || $upass==\"\")\n  {\n    header(\"location:add.php\");\n    exit();\n  }\n  require(\"../../tasks/condb.php\");\n\n  //prepare \n  $salt=generateSalt();\n  $upass=hashPass($upass,$salt);\n  // Create a prepared statement to prevent SQL injection\n  $query = \"INSERT INTO admin (email, password) VALUES (?, ?)\";\n  $stmt = mysqli_prepare($dbcon, $query);\n  mysqli_stmt_bind_param($stmt, \"ss\", $uemail, $upass);\n  $result = mysqli_stmt_execute($stmt);\n  mysqli_stmt_close($stmt);\n  if($result)\n  {\n    //GET Id \n    $query=\"select admin_id from admin where email=?\";\n    $stmt = mysqli_prepare($dbcon, $query);\n    mysqli_stmt_bind_param($stmt, \"s\", $uemail);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    if($result->num_rows!=0)\n    {\n      $row=$result->fetch_assoc();\n      $id=$row[\"admin_id\"];\n      $query=\"INSERT INTO adminsalt (aid,salt) VALUES (?,?)\";\n      $stmt = mysqli_prepare($dbcon, $query);\n      mysqli_stmt_bind_param($stmt, \"ss\", $id,$salt);\n      if(mysqli_stmt_execute($stmt))\n      {\n\n        echo(\"<p style='color:green;position:absolute;left:250px;top:70px'> successfully added $uemail</p>\");\n        $dbcon->close();\n      } else {\n        echo(\"<p style='color:green;position:absolute;left:250px;top:70px'> error occured</p>\");\n      }\n\n    \n    } else {\n      echo(\"<p style='color:green;position:absolute;left:250px;top:70px'>error occured while registering admin  </p>\");\n    }\n\n   \n  }  else {\n  echo(\"some thing want wrong please try again!\");\n  $dbcon->close();\n  }\n}\n\n//gen ctoken\n$tok=$_SESSION[\"c-token\"]=generateSalt();\n\n?>\n\n\n\n\n\n<html lang=\"en-us\">\n\n    <head>\n        <title> admin homepage </title>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n        <meta name=\"keywords\"\n            content=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n        <meta name=\"description\" content=\"light weight secured student's social media!!!\">\n        <meta name=\"author\" content=\"black eagle team\">\n        <link rel=\"stylesheet\" href=\"../home.css\">\n    </head>\n    <!-- body goes here -->\n    \n    <body>\n        <!--header-->\n        <header>\n            <!-- -navigation links-->\n            <nav>\n    \n                <ul>\n                    <li><a href=\"../home.php\">pipa analytics</a></li>\n                    <li><a href=\"../mg.php\" >manage user </a></li>\n                    <li><a href=\"#\" style=\"background-color: black;\"> add admin </a></li>\n                    <li><a href=\"setting.php\">setting</a></li>\n                    <li><a href=\"logout.php\">logout</a></li>\n                </ul>\n    \n            </nav>\n    \n        </header>\n        <!-- content-->\n        <main>\n      <div class=\"addbox\">\n    <form class=\"adform\" action=\"add.php\" method=\"POST\">\n    <label>email</label><br>\n    <input type=\"email\" name=\"email\" required><br>\n    <label>password</label><br>\n    <input type=\"password\" name=\"password\" required pattern=\".{8,}\" title=\"Minimum 8 digit\">\n    <input type=\"text\" name=\"csrf-token\" value=\"<?php echo $tok; ?>\" hidden>\n    <input class=\"addbutton\" type=\"submit\" value=\"add\">\n    </form>\n    \n      </div>\n        </main>\n        <!--footer content-->\n        <footer>\n    \n    \n        </footer>\n    </body>\n    \n    </html>", "<!-- drop in and out of the PHP context -->\n<?php  \nsession_start();\nrequire(\"../../tasks/passw.php\");\nrequire(\"../../tasks/validate.php\");\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:../adminlogin.html\");\n   exit();\n}\n//connect to the database first!!!!\nrequire('../../tasks/condb.php');\nif($_SERVER['REQUEST_METHOD'] == 'POST')\n{\n\n\t// if the form has been submitted!\n\t$echanged=false;\n\t$pchanged=false;\n\t$gotold=false;\n\t$putold=false;\n\n\t//is email changed \n\tif(isset($_POST['email']) && $_POST['email']!=\"\")\n\t{\n\t$echanged=true;\n\t$newemail=htmlspecialchars($_POST['email'], ENT_QUOTES, 'UTF-8');\n\t$valide=validateEmail($newemail);\n\t} \n\t//is pass ^^\n\tif(isset($_POST['password']) && $_POST['password']!=\"\")\n\t{\n\t$pchanged=true;\n\t$newpass=$_POST['password'];\n\t$strongpass=validatePass($newpass);\n\t$newpass=hashPass($newpass,$_SESSION[\"salt\"]);\n\t} \n\tif(isset($_POST['oldpass']) && $_POST['oldpass']!=\"\")\n\t{\n\t\t$putold=true;\n\t\t$oldpass=$_POST['oldpass'];\n\t\t$oldpass=hashPass($oldpass,$_SESSION[\"salt\"]);\n\t}\n/*************************************************** */\n$id=$_SESSION[\"aid\"];\n$rpass = $_SESSION[\"password\"];  //actual pass\n\nif ($pchanged && $oldpass == $rpass && $oldpass!=$newpass && $strongpass) {\n    // change the password \n    $q = \"UPDATE admin SET password=? WHERE admin_id=?\";\n    $stmt = mysqli_prepare($dbcon, $q);\n    mysqli_stmt_bind_param($stmt, \"si\", $newpass, $id);\n    mysqli_stmt_execute($stmt);\n\t$_SESSION[\"password\"]=$newpass;\n    echo \"changed the password <br>\";\n} \n\nif (($pchanged && $oldpass != $rpass) || ($echanged && $oldpass != $rpass)) {\n    echo \"incorrect attempt! <br>\";\n}  \n\nif(isset($strongpass) && !$strongpass)\n{\n\techo \"weak password!\";\n} else if (isset($valide) && !$valide) {\n  echo \"Invalid input detected, please try again!\";\n}\n\nif ($echanged && $oldpass == $rpass && $valide) {\n    $q = \"UPDATE admin SET email=? WHERE admin_id=?\";\n    $stmt = mysqli_prepare($dbcon, $q);\n    mysqli_stmt_bind_param($stmt, \"si\", $newemail, $id);\n    mysqli_stmt_execute($stmt);\n    echo \"changed the email <br>\";\n}\n/***************************************************** */\n}\n$dbcon->close();\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> admin homepage </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"setting.css\">\n</head>\n<!-- body goes here -->\n\n<body>\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"../home.php\">pipa analytics</a></li>\n\t\t\t\t<li><a href=\"../mg.php\">manage user </a></li>\n\t\t\t\t<li><a href=\"add.php\"> add admin </a></li>\n\t\t\t\t<li><a href=\"#\"  style=\"background-color: black;\">setting</a></li>\n\t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n\t\t\t</ul>\n\n\t\t</nav>\n\n\t</header>\n\t<!-- content-->\n\t<main>\n    <div class=\"adminsetting\">\n    <div class=\"adminsetting1\">\n\t\t<form action=\"\" method=\"post\">\n\t\t<label >email</label><br>\n    <input type=\"email\" name=\"email\"  placeholder=\"unchanged\"><br>\n\t<label >new password</label><br>\n\t<input type=\"password\" name=\"password\" placeholder=\"unchanged\" pattern=\".{8,}\" title=\"minimum of 8 digits\"><br>\n\t<label >old password</label><br>\n\t<input type=\"password\" name=\"oldpass\" required title=\"old password required to save changes\" ><br>\n\t<input type=\"submit\" id=\"submitb\" value=\"save changes\">\n</form>\n\t</div>\n\t</div>\n    \n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>\n", "<!-- drop in and out of the PHP context -->\n<?php  \ninclude(\"atask/getinfo.php\");\nsession_start();\n if(!isset($_SESSION[\"aid\"]))\n {\n\t header(\"location:adminlogin.html\");\n\t\n }\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> admin homepage </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"home.css\">\n</head>\n<!-- body goes here -->\n\n<body>\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"#\" style=\"background-color: black;\">pipa analytics</a></li>\n\t\t\t\t<li><a href=\"mg.php\">manage user </a></li>\n\t\t\t\t<li><a href=\"atask/add.php\"> add admin </a></li>\n\t\t\t\t<li><a href=\"atask/setting.php\">setting</a></li>\n\t\t\t\t<li><a href=\"atask/logout.php\">logout</a></li>\n\t\t\t</ul>\n\n\t\t</nav>\n\n\t</header>\n\t<!-- content-->\n\t<main>\n<p class=\"infos\"><?php echo \"total users=====>> \".$total_users?></p>\n<p class=\"infos\"><?php echo \"today's active users=====>> \".$active_today?></p>\n<p class=\"infos\"><?php echo \"users active with in last hour=====>> \".$active_lh?></p>\n<p class=\"infos\"><?php echo \"users active with in last minutes=====>> \".$active_lm?></p>\n<p class=\"infos\"><?php echo \"today's total posts=====>> \".$todaysp?></p>\n<p class=\"infos\"><?php echo \"today's total message transferred over pipa=====>> \".$todaysm?></p>\n<p class=\"isum\"> <?php echo \"website usability=====>> \".(($active_today/$total_users)*100).'%'?> </p>\t\n<!-- insert the animations-->\n<div class=\"pipaAnim\"><img src=\"../image/pipa_anime.png\">\n<img src=\"../image/connect.png\" class=\"pipacon\">\n<div class=\"pedscreen\"><p>friendly<br> pipa go</p></div>\n</div>\n\n\n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>", "<?php\ninclude(\"../tasks/condb.php\");\ninclude(\"../tasks/passw.php\");\nif(!isset($_POST[\"email\"]))\n{\n  header(\"location:adminlogin.html\");\n  exit();\n}\n//handle the form \n$uemail=$_POST[\"email\"];\n$upass=$_POST[\"password\"];\n\n// Create a prepared statement to prevent SQL injection\n$stmt = mysqli_prepare($dbcon, \"SELECT * FROM admin left join adminsalt on admin.admin_id=adminsalt.aid WHERE email=?\");\nmysqli_stmt_bind_param($stmt, \"s\", $uemail);\nmysqli_stmt_execute($stmt);\n$result = mysqli_stmt_get_result($stmt);\n\n//check if there is a match \nif($result->num_rows>0)\n{\n  $rows=$result->fetch_assoc();\n  $id=$rows[\"admin_id\"];\n  $pass=$rows[\"password\"];\n  $salt=$rows[\"salt\"];\n  $upass=hashPass($upass,$salt);\n  //checking \n  if($upass==$pass)\n  {\n    session_start();\n    $_SESSION[\"aid\"]=$id;\n    $_SESSION[\"password\"]=$pass;\n    $_SESSION[\"salt\"]=$salt;\n   header(\"location:home.php\");\n  } else {\n    echo \"<p style='color:red;text-align:center;font-size:20px;'> incorrect password   </p>\";\n   require('adminlogin.html');\n  }\n \n}  else {\n    echo \"<p style='color:red;text-align:center;font-size:20px;'> incorrect email  </p>\";\n   require('adminlogin.html');\n}\n$dbcon->close();\n\n?>\n\n\n", "<?php\nsession_start();\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:adminlogin.html\");\n   exit();\n}\n?>\n<html lang=\"en-us\">\n\n<head>\n    <title> admin homepage </title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n    <meta name=\"keywords\"\n        content=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n    <meta name=\"description\" content=\"light weight secured student's social media!!!\">\n    <meta name=\"author\" content=\"black eagle team\">\n    <link rel=\"stylesheet\" href=\"home.css\">\n</head>\n<!-- body goes here -->\n\n<body>\n    <!--header-->\n    <header>\n        <!-- -navigation links-->\n        <nav>\n\n            <ul>\n                <li><a href=\"home.php\">pipa analytics</a></li>\n                <li><a href=\"#\" style=\"background-color: black;\">manage user </a></li>\n                <li><a href=\"atask/add.php\"> add admin </a></li>\n                <li><a href=\"atask/setting.php\">setting</a></li>\n                <li><a href=\"atask/logout.php\">logout</a></li>\n            </ul>\n\n        </nav>\n\n    </header>\n    <!-- content-->\n    <main>\n\n\n    </main>\n    <!--footer content-->\n    <footer>\n\n\n    </footer>\n</body>\n\n</html>", "<?php\nsession_start();\nif(isset($_SESSION[\"id\"]))\n{\n\theader(\"location:user/home.php\");\n  exit();\n}\n\nrequire(\"tasks/condb.php\");\nrequire(\"tasks/passw.php\");\n//handle the form \n$uemail=$_POST[\"email\"];\n$upass=$_POST[\"password\"];\n\n//prevent sql injection \n$uemail=mysqli_real_escape_string($dbcon,$uemail);\n\n//query on database.\n$query=\"select * from users left join usersalt on users.id=usersalt.uid where email='$uemail'\";\n$result=mysqli_query($dbcon,$query);\n//check if there is a match \nif($result->num_rows>0)\n{\n  //fetch  some data\n  $row=$result->fetch_assoc();\n  $id=$row[\"id\"];\n  $lname=$row['lname'];\n  $fname=$row[\"fname\"];\n  $bd=$row[\"bday\"];\n  $city=$row[\"city\"];\n  $gender=$row[\"gender\"];\n  $email=$row[\"email\"];\n  $pas=$row[\"password\"];\n  $edu=$row[\"edu\"];\n  $joined=$row[\"joined\"];\n  $salt=$row[\"salt\"];\n\n  //checking \n  $upass=hashPass($upass,$salt);\n  if($upass==$pas)\n  {\n      //session start\n  $_SESSION['email']=$email;\n  $_SESSION[\"id\"]=$id;\n  $_SESSION[\"fname\"]=$fname;\n  $_SESSION[\"lname\"]=$lname;\n  $_SESSION[\"bday\"]=$bd;\n  $_SESSION[\"city\"]=$city;\n  $_SESSION[\"gender\"]=$gender;\n  $_SESSION[\"password\"]=$pas;\n  $_SESSION[\"edu\"]=$edu;\n  $_SESSION[\"joined\"]=$joined;\n  $_SESSION[\"salt\"]=$salt;\n  ////////////////////////////\n  //update last seen\n  ////////////////////////////\n  $sessionID =   session_id();\n  session_write_close();\n  $chandler=curl_init();\n  $url=$_SERVER['SERVER_NAME'].\"/social-media-skeleton/tasks/updatels.php?email=$uemail\";\n  curl_setopt($chandler,CURLOPT_URL,$url);\n  curl_setopt($chandler, CURLOPT_HTTPHEADER, array(\"Cookie:\".'PHPSESSID=' . $sessionID));\n  curl_setopt($chandler,CURLOPT_RETURNTRANSFER,false);\n  curl_exec($chandler);\n  curl_close($chandler);\n  header(\"location:user/home.php\");\n  } else {\n    echo \"<p style='color:red;text-align:center;font-size:20px;'> Incorrect Attempt! </p>\";\n    require('login.html');\n  }\n  \n}  else {\n    echo \"<p style='color:red;text-align:center;font-size:20px;'> Email doesn't exist </p>\";\n   require('login.html');\n}\n$dbcon->close();\n?>\n\n\n", "<?php\n\n//generate salt \nfunction generateSalt()\n{\n  $randb=random_bytes(16);\n  return bin2hex($randb);\n}\n\n//hash password \nfunction hashPass($plain,$salt)\n{\n    $password=$plain.$salt;\n    return hash(\"sha256\",$password);\n}\n\n?>", "<!-- drop in and out of the PHP context -->\n<?php  \nsession_start();\nif(!isset($_SESSION[\"id\"]))\n{\n\theader(\"location:../login.html\");\n\texit();\n}\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> home page </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"home.css\">\n    <script src=\"home.js\"></script>\n</head>\n<!-- body goes here -->\n\n<body id=\"body\">\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"#\" style=\"background-color: black;\">home</a></li>\n\t\t\t\t<li><a href=\"profile.php\">profile </a></li>\n\t\t\t\t<li><a href=\"#\">search </a></li>\n\t\t\t\t<li><a href=\"#\"> message </a></li>\n\t\t\t\t<li><a href=\"#\">notification </a></li>\n\t\t\t\t<li><a href=\"setting.php\">setting</a></li>\n\t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n\t\t\t\t<div class=\"pref\"> \n\t\t\t\t<li><a href=\"#\">preference </a></li>\n\t\t\t\t<div class=\"premenu\" id=\"premenu\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"night mode\" onclick=\"gonight()\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"cyan\" onclick=\"cyan_theme()\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"reset\" onclick=\"reset_theme()\">\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ul>\n\n\t\t</nav>\n\n<main>\n\n<?php   \n\necho \"<h1 class='dashboard_header'>\".$_SESSION['fname'].\" \".$_SESSION['lname'].\" </h1>\";\n?>\n\n</main>\n\n\n\t</header>\n\t<!-- content-->\n\t<main>\n\n\n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>", "<!-- drop in and out of the PHP context -->\n<?php  \nsession_start();\nif(!isset($_SESSION[\"id\"]))\n{\n\theader(\"location:../login.html\");\n\tdie();\n}\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> profile </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"home.css\">\n    <script src=\"home.js\"></script>\n</head>\n<!-- body goes here -->\n\n<body id=\"body\">\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"home.php\" >home</a></li>\n\t\t\t\t<li><a href=\"#\" style=\"background-color: black;\">profile </a></li>\n\t\t\t\t<li><a href=\"#\">search </a></li>\n\t\t\t\t<li><a href=\"#\"> message </a></li>\n\t\t\t\t<li><a href=\"#\">notification </a></li>\n\t\t\t\t<li><a href=\"setting.php\">setting</a></li>\n\t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n\t\t\t\t<div class=\"pref\"> \n\t\t\t\t<li><a href=\"#\">preference </a></li>\n\t\t\t\t<div class=\"premenu\" id=\"premenu\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"night mode\" onclick=\"gonight()\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"cyan\" onclick=\"cyan_theme()\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"reset\" onclick=\"reset_theme()\">\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ul>\n\n\t\t</nav>\n\n<main>\n\n<?php   \n\nif($_SESSION[\"gender\"]==\"male\")\necho \"<img src='../image/male.png' class='avatar'>\";\nelse \necho \"<img src='../image/female.png' class='avatar'>\";\necho \"<h1 class='dashboard_header'>\".$_SESSION['fname'].\" \".$_SESSION['lname'].\" <br></h1>\";\necho \"<p class='profile_text'>birthday : \".$_SESSION['bday'].\" <br></p>\";\necho \"<p class='profile_text'>city : \".$_SESSION['city'].\" <br></p>\";\necho \"<p class='profile_text'>gender : \".$_SESSION['gender'].\" <br></p>\";\necho \"<p class='profile_text'>email : \".$_SESSION['email'].\" <br></p>\";\n?>\n\n</main>\n\n\n\t</header>\n\t<!-- content-->\n\t<main>\n\n\n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>", "<?php\nrequire(\"../tasks/condb.php\");\nrequire(\"../tasks/passw.php\");\nrequire(\"../tasks/validate.php\");\nsession_start();\nif (!isset($_SESSION[\"id\"])) {\n  header(\"location:../login.html\");\n  exit();\n}\n\n\n\nif (isset($_POST[\"ch-info\"])) {\n  $fname = htmlspecialchars($_POST[\"fname\"], ENT_QUOTES, \"UTF-8\");\n  $lname = htmlspecialchars($_POST[\"lname\"], ENT_QUOTES, \"UTF-8\");\n  $email = htmlspecialchars($_POST[\"email\"], ENT_QUOTES, \"UTF-8\");\n  $city = htmlspecialchars($_POST[\"city\"], ENT_QUOTES, \"UTF-8\");\n  $id = $_SESSION[\"id\"];\n\n  //validate\n  if (!validateUserInfo($email, $fname, $lname, $city)) {\n    echo \"Invalid input detected please fill the form correctly\";\n    require(\"setting.html\");\n    $fn = $_SESSION[\"fname\"];\n    $ln = $_SESSION[\"lname\"];\n    $email = $_SESSION[\"email\"];\n    $city = $_SESSION[\"city\"];\n    echo \"<script> fill('$fn','$ln','$email','$city')</script>\";\n    $tok = $_SESSION[\"c-token\"] = generateSalt();\n    echo \"<script>setToken('$tok')</script>\";\n    exit();\n  }\n\n  //check token \n  if (isset($_SESSION[\"c-token\"]) && isset($_POST[\"csrf-token\"])) {\n    $tok = $_POST[\"csrf-token\"];\n    if ($_SESSION[\"c-token\"] != $tok) {\n      exit(\"action denied!\");\n    }\n  } else {\n    exit(\"action denied!\");\n  }\n\n\n  $query = \"update users set fname=?,lname=?,email=?,city=? where id=?\";\n  $st = $dbcon->prepare($query);\n  $st->bind_param(\"sssss\", $fname, $lname, $email, $city, $id);\n  $st->execute();\n  $_SESSION[\"fname\"] = $fname;\n  $_SESSION[\"lname\"] = $lname;\n  $_SESSION[\"email\"] = $email;\n  $_SESSION[\"city \"] = $city;\n  echo \"your info changed!\";\n}\n\n\n\nif (isset($_POST[\"ch-pass\"])) {\n  $strong_pass=validatePass($_POST[\"newpass\"]);\n  $cpass = hashPass($_POST[\"cpass\"], $_SESSION[\"salt\"]);\n  $newpass = hashPass($_POST[\"newpass\"], $_SESSION[\"salt\"]);\n  $oldpass = hashPass($_POST[\"oldpass\"], $_SESSION[\"salt\"]);\n  if ($oldpass == $_SESSION[\"password\"] && $newpass == $cpass && $oldpass != $newpass && $strong_pass) {\n    //hange \n    $id = $_SESSION[\"id\"];\n    $query = \"update users set password=? where id=$id\";\n    $st = $dbcon->prepare($query);\n    $st->bind_param(\"s\", $newpass);\n    $st->execute();\n    $_SESSION[\"password\"] = $newpass;\n    echo \"password changed successfully!\";\n  } else {\n    echo \"something want wrong. please don't forget to insert minimum 8 character!\";\n  }\n}\n\nrequire(\"setting.html\");\n$fn = $_SESSION[\"fname\"];\n$ln = $_SESSION[\"lname\"];\n$email = $_SESSION[\"email\"];\n$city = $_SESSION[\"city\"];\necho \"<script> fill('$fn','$ln','$email','$city')</script>\";\n$tok = $_SESSION[\"c-token\"] = generateSalt();\necho \"<script>setToken('$tok')</script>\";\n$dbcon->close();\n\n?>"], "fixing_code": ["\n<?php\nrequire(\"../../tasks/passw.php\");\nrequire(\"../../tasks/validate.php\");\nsession_start();\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:../adminlogin.html\");\n   exit();\n}\n\n //is expired \n if(sexpired())\n {\n    header(\"location:logout.php\");\n    exit();\n }\n\nif($_SERVER['REQUEST_METHOD'] == 'POST')\n{\n  $uemail=htmlspecialchars($_POST[\"email\"], ENT_QUOTES, 'UTF-8');\n  $upass=$_POST[\"password\"];\n\n     //validate\n     if(!(validateEmail($uemail) && validatePass($upass)))\n     {\n         exit(\"Invalid input detected!\");\n     }\n  \n     //check token \n     if(isset($_SESSION[\"c-token\"]) && isset($_POST[\"csrf-token\"]))\n     {\n       $tok=$_POST[\"csrf-token\"];\n       if($_SESSION[\"c-token\"]!=$tok)\n       {\n         exit(\"action denied!\");\n       }\n     } else {\n         exit(\"action denied!\");\n     }\n    \n  //if empty password or username!\n  //alt isempty\n  if($uemail==\"\" || $upass==\"\")\n  {\n    header(\"location:add.php\");\n    exit();\n  }\n  require(\"../../tasks/condb.php\");\n\n  //prepare \n  $salt=generateSalt();\n  $upass=hashPass($upass,$salt);\n  // Create a prepared statement to prevent SQL injection\n  $query = \"INSERT INTO admin (email, password) VALUES (?, ?)\";\n  $stmt = mysqli_prepare($dbcon, $query);\n  mysqli_stmt_bind_param($stmt, \"ss\", $uemail, $upass);\n  $result = mysqli_stmt_execute($stmt);\n  mysqli_stmt_close($stmt);\n  if($result)\n  {\n    //GET Id \n    $query=\"select admin_id from admin where email=?\";\n    $stmt = mysqli_prepare($dbcon, $query);\n    mysqli_stmt_bind_param($stmt, \"s\", $uemail);\n    mysqli_stmt_execute($stmt);\n    $result = mysqli_stmt_get_result($stmt);\n    if($result->num_rows!=0)\n    {\n      $row=$result->fetch_assoc();\n      $id=$row[\"admin_id\"];\n      $query=\"INSERT INTO adminsalt (aid,salt) VALUES (?,?)\";\n      $stmt = mysqli_prepare($dbcon, $query);\n      mysqli_stmt_bind_param($stmt, \"ss\", $id,$salt);\n      if(mysqli_stmt_execute($stmt))\n      {\n\n        echo(\"<p style='color:green;position:absolute;left:250px;top:70px'> successfully added $uemail</p>\");\n        $dbcon->close();\n      } else {\n        echo(\"<p style='color:green;position:absolute;left:250px;top:70px'> error occured</p>\");\n      }\n\n    \n    } else {\n      echo(\"<p style='color:green;position:absolute;left:250px;top:70px'>error occured while registering admin  </p>\");\n    }\n\n   \n  }  else {\n  echo(\"some thing want wrong please try again!\");\n  $dbcon->close();\n  }\n}\n\n//gen ctoken\n$tok=$_SESSION[\"c-token\"]=generateSalt();\n\n?>\n\n\n\n\n\n<html lang=\"en-us\">\n\n    <head>\n        <title> admin homepage </title>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n        <meta name=\"keywords\"\n            content=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n        <meta name=\"description\" content=\"light weight secured student's social media!!!\">\n        <meta name=\"author\" content=\"black eagle team\">\n        <link rel=\"stylesheet\" href=\"../home.css\">\n    </head>\n    <!-- body goes here -->\n    \n    <body>\n        <!--header-->\n        <header>\n            <!-- -navigation links-->\n            <nav>\n    \n                <ul>\n                    <li><a href=\"../home.php\">pipa analytics</a></li>\n                    <li><a href=\"../mg.php\" >manage user </a></li>\n                    <li><a href=\"#\" style=\"background-color: black;\"> add admin </a></li>\n                    <li><a href=\"setting.php\">setting</a></li>\n                    <li><a href=\"logout.php\">logout</a></li>\n                </ul>\n    \n            </nav>\n    \n        </header>\n        <!-- content-->\n        <main>\n      <div class=\"addbox\">\n    <form class=\"adform\" action=\"add.php\" method=\"POST\">\n    <label>email</label><br>\n    <input type=\"email\" name=\"email\" required><br>\n    <label>password</label><br>\n    <input type=\"password\" name=\"password\" required pattern=\".{8,}\" title=\"Minimum 8 digit\">\n    <input type=\"text\" name=\"csrf-token\" value=\"<?php echo $tok; ?>\" hidden>\n    <input class=\"addbutton\" type=\"submit\" value=\"add\">\n    </form>\n    \n      </div>\n        </main>\n        <!--footer content-->\n        <footer>\n    \n    \n        </footer>\n    </body>\n    \n    </html>", "<!-- drop in and out of the PHP context -->\n<?php  \nsession_start();\nrequire(\"../../tasks/passw.php\");\nrequire(\"../../tasks/validate.php\");\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:../adminlogin.html\");\n   exit();\n}\n\n //is expired \n if(sexpired())\n {\n    header(\"location:logout.php\");\n    exit();\n }\n \n//connect to the database first!!!!\nrequire('../../tasks/condb.php');\nif($_SERVER['REQUEST_METHOD'] == 'POST')\n{\n\n\t// if the form has been submitted!\n\t$echanged=false;\n\t$pchanged=false;\n\t$gotold=false;\n\t$putold=false;\n\n\t//is email changed \n\tif(isset($_POST['email']) && $_POST['email']!=\"\")\n\t{\n\t$echanged=true;\n\t$newemail=htmlspecialchars($_POST['email'], ENT_QUOTES, 'UTF-8');\n\t$valide=validateEmail($newemail);\n\t} \n\t//is pass ^^\n\tif(isset($_POST['password']) && $_POST['password']!=\"\")\n\t{\n\t$pchanged=true;\n\t$newpass=$_POST['password'];\n\t$strongpass=validatePass($newpass);\n\t$newpass=hashPass($newpass,$_SESSION[\"salt\"]);\n\t} \n\tif(isset($_POST['oldpass']) && $_POST['oldpass']!=\"\")\n\t{\n\t\t$putold=true;\n\t\t$oldpass=$_POST['oldpass'];\n\t\t$oldpass=hashPass($oldpass,$_SESSION[\"salt\"]);\n\t}\n/*************************************************** */\n$id=$_SESSION[\"aid\"];\n$rpass = $_SESSION[\"password\"];  //actual pass\n\nif ($pchanged && $oldpass == $rpass && $oldpass!=$newpass && $strongpass) {\n    // change the password \n    $q = \"UPDATE admin SET password=? WHERE admin_id=?\";\n    $stmt = mysqli_prepare($dbcon, $q);\n    mysqli_stmt_bind_param($stmt, \"si\", $newpass, $id);\n    mysqli_stmt_execute($stmt);\n\t$_SESSION[\"password\"]=$newpass;\n    echo \"changed the password <br>\";\n} \n\nif (($pchanged && $oldpass != $rpass) || ($echanged && $oldpass != $rpass)) {\n    echo \"incorrect attempt! <br>\";\n}  \n\nif(isset($strongpass) && !$strongpass)\n{\n\techo \"weak password!\";\n} else if (isset($valide) && !$valide) {\n  echo \"Invalid input detected, please try again!\";\n}\n\nif ($echanged && $oldpass == $rpass && $valide) {\n    $q = \"UPDATE admin SET email=? WHERE admin_id=?\";\n    $stmt = mysqli_prepare($dbcon, $q);\n    mysqli_stmt_bind_param($stmt, \"si\", $newemail, $id);\n    mysqli_stmt_execute($stmt);\n    echo \"changed the email <br>\";\n}\n/***************************************************** */\n}\n$dbcon->close();\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> admin homepage </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"setting.css\">\n</head>\n<!-- body goes here -->\n\n<body>\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"../home.php\">pipa analytics</a></li>\n\t\t\t\t<li><a href=\"../mg.php\">manage user </a></li>\n\t\t\t\t<li><a href=\"add.php\"> add admin </a></li>\n\t\t\t\t<li><a href=\"#\"  style=\"background-color: black;\">setting</a></li>\n\t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n\t\t\t</ul>\n\n\t\t</nav>\n\n\t</header>\n\t<!-- content-->\n\t<main>\n    <div class=\"adminsetting\">\n    <div class=\"adminsetting1\">\n\t\t<form action=\"\" method=\"post\">\n\t\t<label >email</label><br>\n    <input type=\"email\" name=\"email\"  placeholder=\"unchanged\"><br>\n\t<label >new password</label><br>\n\t<input type=\"password\" name=\"password\" placeholder=\"unchanged\" pattern=\".{8,}\" title=\"minimum of 8 digits\"><br>\n\t<label >old password</label><br>\n\t<input type=\"password\" name=\"oldpass\" required title=\"old password required to save changes\" ><br>\n\t<input type=\"submit\" id=\"submitb\" value=\"save changes\">\n</form>\n\t</div>\n\t</div>\n    \n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>\n", "<!-- drop in and out of the PHP context -->\n<?php  \ninclude(\"atask/getinfo.php\");\ninclude(\"../tasks/passw.php\");\nsession_start();\n if(!isset($_SESSION[\"aid\"]))\n {\n\t header(\"location:adminlogin.html\");\n\t\n }\n\n //is expired \nif(sexpired())\n{\n   header(\"location:atask/logout.php\");\n   exit();\n}\n\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> admin homepage </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"home.css\">\n</head>\n<!-- body goes here -->\n\n<body>\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"#\" style=\"background-color: black;\">pipa analytics</a></li>\n\t\t\t\t<li><a href=\"mg.php\">manage user </a></li>\n\t\t\t\t<li><a href=\"atask/add.php\"> add admin </a></li>\n\t\t\t\t<li><a href=\"atask/setting.php\">setting</a></li>\n\t\t\t\t<li><a href=\"atask/logout.php\">logout</a></li>\n\t\t\t</ul>\n\n\t\t</nav>\n\n\t</header>\n\t<!-- content-->\n\t<main>\n<p class=\"infos\"><?php echo \"total users=====>> \".$total_users?></p>\n<p class=\"infos\"><?php echo \"today's active users=====>> \".$active_today?></p>\n<p class=\"infos\"><?php echo \"users active with in last hour=====>> \".$active_lh?></p>\n<p class=\"infos\"><?php echo \"users active with in last minutes=====>> \".$active_lm?></p>\n<p class=\"infos\"><?php echo \"today's total posts=====>> \".$todaysp?></p>\n<p class=\"infos\"><?php echo \"today's total message transferred over pipa=====>> \".$todaysm?></p>\n<p class=\"isum\"> <?php echo \"website usability=====>> \".(($active_today/$total_users)*100).'%'?> </p>\t\n<!-- insert the animations-->\n<div class=\"pipaAnim\"><img src=\"../image/pipa_anime.png\">\n<img src=\"../image/connect.png\" class=\"pipacon\">\n<div class=\"pedscreen\"><p>friendly<br> pipa go</p></div>\n</div>\n\n\n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>", "<?php\ninclude(\"../tasks/condb.php\");\ninclude(\"../tasks/passw.php\");\nif(!isset($_POST[\"email\"]))\n{\n  header(\"location:adminlogin.html\");\n  exit();\n}\n//handle the form \n$uemail=$_POST[\"email\"];\n$upass=$_POST[\"password\"];\n\n// Create a prepared statement to prevent SQL injection\n$stmt = mysqli_prepare($dbcon, \"SELECT * FROM admin left join adminsalt on admin.admin_id=adminsalt.aid WHERE email=?\");\nmysqli_stmt_bind_param($stmt, \"s\", $uemail);\nmysqli_stmt_execute($stmt);\n$result = mysqli_stmt_get_result($stmt);\n\n//check if there is a match \nif($result->num_rows>0)\n{\n  $rows=$result->fetch_assoc();\n  $id=$rows[\"admin_id\"];\n  $pass=$rows[\"password\"];\n  $salt=$rows[\"salt\"];\n  $upass=hashPass($upass,$salt);\n  //checking \n  if($upass==$pass)\n  {\n    session_start();\n    $_SESSION[\"aid\"]=$id;\n    $_SESSION[\"password\"]=$pass;\n    $_SESSION[\"salt\"]=$salt;\n    $_SESSION[\"exp_time\"]=time()+(10);\n   header(\"location:home.php\");\n  } else {\n    echo \"<p style='color:red;text-align:center;font-size:20px;'> incorrect password   </p>\";\n   require('adminlogin.html');\n  }\n \n}  else {\n    echo \"<p style='color:red;text-align:center;font-size:20px;'> incorrect email  </p>\";\n   require('adminlogin.html');\n}\n$dbcon->close();\n\n?>\n\n\n", "<?php\nsession_start();\ninclude(\"../tasks/passw.php\");\nif(!isset($_SESSION[\"aid\"]))\n{\n\theader(\"location:adminlogin.html\");\n   exit();\n}\n\n //is expired \n if(sexpired())\n {\n    header(\"location:atask/logout.php\");\n    exit();\n }\n\n?>\n<html lang=\"en-us\">\n\n<head>\n    <title> admin homepage </title>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n    <meta name=\"keywords\"\n        content=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n    <meta name=\"description\" content=\"light weight secured student's social media!!!\">\n    <meta name=\"author\" content=\"black eagle team\">\n    <link rel=\"stylesheet\" href=\"home.css\">\n</head>\n<!-- body goes here -->\n\n<body>\n    <!--header-->\n    <header>\n        <!-- -navigation links-->\n        <nav>\n\n            <ul>\n                <li><a href=\"home.php\">pipa analytics</a></li>\n                <li><a href=\"#\" style=\"background-color: black;\">manage user </a></li>\n                <li><a href=\"atask/add.php\"> add admin </a></li>\n                <li><a href=\"atask/setting.php\">setting</a></li>\n                <li><a href=\"atask/logout.php\">logout</a></li>\n            </ul>\n\n        </nav>\n\n    </header>\n    <!-- content-->\n    <main>\n\n\n    </main>\n    <!--footer content-->\n    <footer>\n\n\n    </footer>\n</body>\n\n</html>", "<?php   \nsession_start();\nif(isset($_SESSION[\"id\"]))\n{\n\theader(\"location:user/home.php\");\n  exit();\n}\n\nrequire(\"tasks/condb.php\");\nrequire(\"tasks/passw.php\");\n//handle the form \n$uemail=$_POST[\"email\"];\n$upass=$_POST[\"password\"];\n\n//prevent sql injection \n$uemail=mysqli_real_escape_string($dbcon,$uemail);\n\n//query on database.\n$query=\"select * from users left join usersalt on users.id=usersalt.uid where email='$uemail'\";\n$result=mysqli_query($dbcon,$query);\n//check if there is a match \nif($result->num_rows>0)\n{\n  //fetch  some data\n  $row=$result->fetch_assoc();\n  $id=$row[\"id\"];\n  $lname=$row['lname'];\n  $fname=$row[\"fname\"];\n  $bd=$row[\"bday\"];\n  $city=$row[\"city\"];\n  $gender=$row[\"gender\"];\n  $email=$row[\"email\"];\n  $pas=$row[\"password\"];\n  $edu=$row[\"edu\"];\n  $joined=$row[\"joined\"];\n  $salt=$row[\"salt\"];\n\n  //checking \n  $upass=hashPass($upass,$salt);\n  if($upass==$pas)\n  {\n      //session start \n  $_SESSION['email']=$email;\n  $_SESSION[\"id\"]=$id;\n  $_SESSION[\"fname\"]=$fname;\n  $_SESSION[\"lname\"]=$lname;\n  $_SESSION[\"bday\"]=$bd;\n  $_SESSION[\"city\"]=$city;\n  $_SESSION[\"gender\"]=$gender;\n  $_SESSION[\"password\"]=$pas;\n  $_SESSION[\"edu\"]=$edu;\n  $_SESSION[\"joined\"]=$joined;\n  $_SESSION[\"salt\"]=$salt;\n  $_SESSION[\"exp_time\"]=time()+(10);\n  ////////////////////////////\n  //update last seen\n  ////////////////////////////\n  $sessionID =   session_id();\n  session_write_close();\n  $chandler=curl_init();\n  $url=$_SERVER['SERVER_NAME'].\"/social-media-skeleton/tasks/updatels.php?email=$uemail\";\n  curl_setopt($chandler,CURLOPT_URL,$url);\n  curl_setopt($chandler, CURLOPT_HTTPHEADER, array(\"Cookie:\".'PHPSESSID=' . $sessionID));\n  curl_setopt($chandler,CURLOPT_RETURNTRANSFER,false);\n  curl_exec($chandler);\n  curl_close($chandler);\n  header(\"location:user/home.php\");\n  } else {\n    echo \"<p style='color:red;text-align:center;font-size:20px;'> Incorrect Attempt! </p>\";\n    require('login.html');\n  }\n  \n}  else {\n    echo \"<p style='color:red;text-align:center;font-size:20px;'> Email doesn't exist </p>\";\n   require('login.html');\n}\n$dbcon->close();\n?>\n\n\n", "<?php\n\n//generate salt \nfunction generateSalt()\n{\n  $randb=random_bytes(16);\n  return bin2hex($randb);\n}\n\n//hash password \nfunction hashPass($plain,$salt)\n{\n    $password=$plain.$salt;\n    return hash(\"sha256\",$password);\n}\n\n//check se exp \nfunction sexpired()\n{\n  if(isset($_SESSION[\"exp_time\"]) && $_SESSION[\"exp_time\"]<time())\n   return true; \n   else \n   return false;\n}\n\n?>", "<!-- drop in and out of the PHP context -->\n<?php  \nsession_start();\nrequire(\"../tasks/passw.php\");\nif(!isset($_SESSION[\"id\"]))\n{\n\theader(\"location:../login.html\");\n\texit();\n}\n\n//is expired \nif(sexpired())\n{\n   header(\"location:logout.php\");\n   exit();\n}\n\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> home page </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"home.css\">\n    <script src=\"home.js\"></script>\n</head>\n<!-- body goes here -->\n\n<body id=\"body\">\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"#\" style=\"background-color: black;\">home</a></li>\n\t\t\t\t<li><a href=\"profile.php\">profile </a></li>\n\t\t\t\t<li><a href=\"#\">search </a></li>\n\t\t\t\t<li><a href=\"#\"> message </a></li>\n\t\t\t\t<li><a href=\"#\">notification </a></li>\n\t\t\t\t<li><a href=\"setting.php\">setting</a></li>\n\t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n\t\t\t\t<div class=\"pref\"> \n\t\t\t\t<li><a href=\"#\">preference </a></li>\n\t\t\t\t<div class=\"premenu\" id=\"premenu\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"night mode\" onclick=\"gonight()\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"cyan\" onclick=\"cyan_theme()\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"reset\" onclick=\"reset_theme()\">\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ul>\n\n\t\t</nav>\n\n<main>\n\n<?php   \n\necho \"<h1 class='dashboard_header'>\".$_SESSION['fname'].\" \".$_SESSION['lname'].\" </h1>\";\n?>\n\n</main>\n\n\n\t</header>\n\t<!-- content-->\n\t<main>\n\n\n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>", "<!-- drop in and out of the PHP context -->\n<?php  \nsession_start();\nrequire(\"../tasks/passw.php\");\nif(!isset($_SESSION[\"id\"]))\n{\n\theader(\"location:../login.html\");\n\tdie();\n}\n\n//is expired \nif(sexpired())\n{\n   header(\"location:logout.php\");\n   exit();\n}\n\n?> \n\n<html lang=\"en-us\">\n\n<head>\n\t<title> profile </title>\n\t<meta charset=\"utf-8\">\n\t<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n\t<meta name=\"keywords\"\n\t\tcontent=\"social media,the best social media platform,chat with your friend ,easy social media,pipago\">\n\t<meta name=\"description\" content=\"light weight secured student's social media!!!\">\n\t<meta name=\"author\" content=\"black eagle team\">\n\t<link rel=\"stylesheet\" href=\"home.css\">\n    <script src=\"home.js\"></script>\n</head>\n<!-- body goes here -->\n\n<body id=\"body\">\n\t<!--header-->\n\t<header>\n\t\t<!-- -navigation links-->\n\t\t<nav>\n\n\t\t\t<ul>\n\t\t\t\t<li><a href=\"home.php\" >home</a></li>\n\t\t\t\t<li><a href=\"#\" style=\"background-color: black;\">profile </a></li>\n\t\t\t\t<li><a href=\"#\">search </a></li>\n\t\t\t\t<li><a href=\"#\"> message </a></li>\n\t\t\t\t<li><a href=\"#\">notification </a></li>\n\t\t\t\t<li><a href=\"setting.php\">setting</a></li>\n\t\t\t\t<li><a href=\"logout.php\">logout</a></li>\n\t\t\t\t<div class=\"pref\"> \n\t\t\t\t<li><a href=\"#\">preference </a></li>\n\t\t\t\t<div class=\"premenu\" id=\"premenu\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"night mode\" onclick=\"gonight()\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"cyan\" onclick=\"cyan_theme()\">\n\t\t\t\t<input class=\"tbot\" type=\"button\" value=\"reset\" onclick=\"reset_theme()\">\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ul>\n\n\t\t</nav>\n\n<main>\n\n<?php   \n\nif($_SESSION[\"gender\"]==\"male\")\necho \"<img src='../image/male.png' class='avatar'>\";\nelse \necho \"<img src='../image/female.png' class='avatar'>\";\necho \"<h1 class='dashboard_header'>\".$_SESSION['fname'].\" \".$_SESSION['lname'].\" <br></h1>\";\necho \"<p class='profile_text'>birthday : \".$_SESSION['bday'].\" <br></p>\";\necho \"<p class='profile_text'>city : \".$_SESSION['city'].\" <br></p>\";\necho \"<p class='profile_text'>gender : \".$_SESSION['gender'].\" <br></p>\";\necho \"<p class='profile_text'>email : \".$_SESSION['email'].\" <br></p>\";\n?>\n\n</main>\n\n\n\t</header>\n\t<!-- content-->\n\t<main>\n\n\n\t</main>\n\t<!--footer content-->\n\t<footer>\n\n\n\t</footer>\n</body>\n\n</html>", "<?php\nrequire(\"../tasks/condb.php\");\nrequire(\"../tasks/passw.php\");\nrequire(\"../tasks/validate.php\");\nsession_start();\nif (!isset($_SESSION[\"id\"])) {\n  header(\"location:../login.html\");\n  exit();\n}\n\n//is expired \nif(sexpired())\n{\n   header(\"location:logout.php\");\n   exit();\n}\n\n\nif (isset($_POST[\"ch-info\"])) {\n  $fname = htmlspecialchars($_POST[\"fname\"], ENT_QUOTES, \"UTF-8\");\n  $lname = htmlspecialchars($_POST[\"lname\"], ENT_QUOTES, \"UTF-8\");\n  $email = htmlspecialchars($_POST[\"email\"], ENT_QUOTES, \"UTF-8\");\n  $city = htmlspecialchars($_POST[\"city\"], ENT_QUOTES, \"UTF-8\");\n  $id = $_SESSION[\"id\"];\n\n  //validate\n  if (!validateUserInfo($email, $fname, $lname, $city)) {\n    echo \"Invalid input detected please fill the form correctly\";\n    require(\"setting.html\");\n    $fn = $_SESSION[\"fname\"];\n    $ln = $_SESSION[\"lname\"];\n    $email = $_SESSION[\"email\"];\n    $city = $_SESSION[\"city\"];\n    echo \"<script> fill('$fn','$ln','$email','$city')</script>\";\n    $tok = $_SESSION[\"c-token\"] = generateSalt();\n    echo \"<script>setToken('$tok')</script>\";\n    exit();\n  }\n\n  //check token \n  if (isset($_SESSION[\"c-token\"]) && isset($_POST[\"csrf-token\"])) {\n    $tok = $_POST[\"csrf-token\"];\n    if ($_SESSION[\"c-token\"] != $tok) {\n      exit(\"action denied!\");\n    }\n  } else {\n    exit(\"action denied!\");\n  }\n\n\n  $query = \"update users set fname=?,lname=?,email=?,city=? where id=?\";\n  $st = $dbcon->prepare($query);\n  $st->bind_param(\"sssss\", $fname, $lname, $email, $city, $id);\n  $st->execute();\n  $_SESSION[\"fname\"] = $fname;\n  $_SESSION[\"lname\"] = $lname;\n  $_SESSION[\"email\"] = $email;\n  $_SESSION[\"city \"] = $city;\n  echo \"your info changed!\";\n}\n\n\n\nif (isset($_POST[\"ch-pass\"])) {\n  $strong_pass=validatePass($_POST[\"newpass\"]);\n  $cpass = hashPass($_POST[\"cpass\"], $_SESSION[\"salt\"]);\n  $newpass = hashPass($_POST[\"newpass\"], $_SESSION[\"salt\"]);\n  $oldpass = hashPass($_POST[\"oldpass\"], $_SESSION[\"salt\"]);\n  if ($oldpass == $_SESSION[\"password\"] && $newpass == $cpass && $oldpass != $newpass && $strong_pass) {\n    //hange \n    $id = $_SESSION[\"id\"];\n    $query = \"update users set password=? where id=$id\";\n    $st = $dbcon->prepare($query);\n    $st->bind_param(\"s\", $newpass);\n    $st->execute();\n    $_SESSION[\"password\"] = $newpass;\n    echo \"password changed successfully!\";\n  } else {\n    echo \"something want wrong. please don't forget to insert minimum 8 character!\";\n  }\n}\n\nrequire(\"setting.html\");\n$fn = $_SESSION[\"fname\"];\n$ln = $_SESSION[\"lname\"];\n$email = $_SESSION[\"email\"];\n$city = $_SESSION[\"city\"];\necho \"<script> fill('$fn','$ln','$email','$city')</script>\";\n$tok = $_SESSION[\"c-token\"] = generateSalt();\necho \"<script>setToken('$tok')</script>\";\n$dbcon->close();\n\n?>"], "filenames": ["admin/atask/add.php", "admin/atask/setting.php", "admin/home.php", "admin/login.php", "admin/mg.php", "login.php", "tasks/passw.php", "user/home.php", "user/profile.php", "user/setting.php"], "buggy_code_start_loc": [10, 10, 3, 33, 2, 1, 16, 3, 3, 10], "buggy_code_end_loc": [10, 10, 9, 33, 7, 53, 16, 8, 8, 10], "fixing_code_start_loc": [11, 11, 4, 34, 3, 1, 17, 4, 4, 11], "fixing_code_end_loc": [18, 19, 19, 35, 17, 55, 26, 18, 18, 17], "type": "CWE-613", "message": "Social media skeleton is an uncompleted/framework social media project implemented using a php, css ,javascript and html. Insufficient session expiration is a web application security vulnerability that occurs when a web application does not properly manage the lifecycle of a user's session. Social media skeleton releases prior to 1.0.5 did not properly limit manage user session lifecycles. This issue has been addressed in version 1.0.5 and users are advised to upgrade. There are no known workarounds for this vulnerability.\n\n", "other": {"cve": {"id": "CVE-2023-40174", "sourceIdentifier": "security-advisories@github.com", "published": "2023-08-18T22:15:11.423", "lastModified": "2023-08-23T20:11:46.780", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Social media skeleton is an uncompleted/framework social media project implemented using a php, css ,javascript and html. Insufficient session expiration is a web application security vulnerability that occurs when a web application does not properly manage the lifecycle of a user's session. Social media skeleton releases prior to 1.0.5 did not properly limit manage user session lifecycles. This issue has been addressed in version 1.0.5 and users are advised to upgrade. There are no known workarounds for this vulnerability.\n\n"}, {"lang": "es", "value": "Social media skeleton es un proyecto/framework de social media sin completar implementado usando php, css, javascript y html. La expiraci\u00f3n de sesi\u00f3n insuficiente es una vulnerabilidad de seguridad de aplicaciones web que ocurre cuando una aplicaci\u00f3n web no gestiona adecuadamente el ciclo de vida de la sesi\u00f3n de un usuario. Las versiones de social media skeleton anteriores a la 1.0.5 no limitaban adecuadamente la gesti\u00f3n de los ciclos de vida de las sesiones de usuario. Este problema se ha solucionado en la versi\u00f3n 1.0.5 y se recomienda a los usuarios que actualicen. No se conocen soluciones para esta vulnerabilidad. "}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 6.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.6, "impactScore": 5.2}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-613"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:fobybus:social-media-skeleton:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.0.5", "matchCriteriaId": "C6B65799-63F2-4F3B-B6F8-BF9DD02EAB93"}]}]}], "references": [{"url": "https://github.com/fobybus/social-media-skeleton/commit/99738b2cc5efb6a5739161c931daa43f99431e5a", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/fobybus/social-media-skeleton/security/advisories/GHSA-cr5c-ggwq-g4hq", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/fobybus/social-media-skeleton/commit/99738b2cc5efb6a5739161c931daa43f99431e5a"}}