{"buggy_code": ["<?php\n\n/**\n * ---------------------------------------------------------------------\n *\n * GLPI - Gestionnaire Libre de Parc Informatique\n *\n * http://glpi-project.org\n *\n * @copyright 2015-2023 Teclib' and contributors.\n * @copyright 2003-2014 by the INDEPNET Development Team.\n * @licence   https://www.gnu.org/licenses/gpl-3.0.html\n *\n * ---------------------------------------------------------------------\n *\n * LICENSE\n *\n * This file is part of GLPI.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * ---------------------------------------------------------------------\n */\n\ninclude('../inc/includes.php');\n\nheader('Content-Type: application/json; charset=UTF-8');\nHtml::header_nocache();\n\nSession::checkLoginUser();\n\n$all_pinned = importArrayFromDB($_SESSION['glpisavedsearches_pinned']);\n$already_pinned = $all_pinned[$_POST['itemtype']] ?? 0;\n$all_pinned[$_POST['itemtype']] = $already_pinned ? 0 : 1;\n$_SESSION['glpisavedsearches_pinned'] = exportArrayToDB($all_pinned);\n\n$user = new User();\n$success = $user->update(\n    [\n        'id'                   => Session::getLoginUserID(),\n        'savedsearches_pinned' => $_SESSION['glpisavedsearches_pinned'],\n    ]\n);\n\necho json_encode(['success' => $success]);\n"], "fixing_code": ["<?php\n\n/**\n * ---------------------------------------------------------------------\n *\n * GLPI - Gestionnaire Libre de Parc Informatique\n *\n * http://glpi-project.org\n *\n * @copyright 2015-2023 Teclib' and contributors.\n * @copyright 2003-2014 by the INDEPNET Development Team.\n * @licence   https://www.gnu.org/licenses/gpl-3.0.html\n *\n * ---------------------------------------------------------------------\n *\n * LICENSE\n *\n * This file is part of GLPI.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n *\n * ---------------------------------------------------------------------\n */\n\ninclude('../inc/includes.php');\n\nheader('Content-Type: application/json; charset=UTF-8');\nHtml::header_nocache();\n\nSession::checkLoginUser();\n\nif (!is_string($_POST['itemtype']) || getItemForItemtype($_POST['itemtype']) === false) {\n    echo json_encode(['success' => false]);\n    exit();\n}\n\n$all_pinned = importArrayFromDB($_SESSION['glpisavedsearches_pinned']);\n$already_pinned = $all_pinned[$_POST['itemtype']] ?? 0;\n$all_pinned[$_POST['itemtype']] = $already_pinned ? 0 : 1;\n$_SESSION['glpisavedsearches_pinned'] = exportArrayToDB($all_pinned);\n\n$user = new User();\n$success = $user->update(\n    [\n        'id'                   => Session::getLoginUserID(),\n        'savedsearches_pinned' => $_SESSION['glpisavedsearches_pinned'],\n    ]\n);\n\necho json_encode(['success' => $success]);\n"], "filenames": ["ajax/pin_savedsearches.php"], "buggy_code_start_loc": [42], "buggy_code_end_loc": [42], "fixing_code_start_loc": [43], "fixing_code_end_loc": [48], "type": "CWE-89", "message": "GLPI is a free asset and IT management software package. Starting in version 10.0.0 and prior to version 10.0.11, the saved search feature can be used to perform a SQL injection. Version 10.0.11 contains a patch for the issue.", "other": {"cve": {"id": "CVE-2023-43813", "sourceIdentifier": "security-advisories@github.com", "published": "2023-12-13T19:15:07.587", "lastModified": "2023-12-18T18:59:53.300", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "GLPI is a free asset and IT management software package. Starting in version 10.0.0 and prior to version 10.0.11, the saved search feature can be used to perform a SQL injection. Version 10.0.11 contains a patch for the issue."}, {"lang": "es", "value": "GLPI es un paquete de software gratuito de gesti\u00f3n de activos y TI. A partir de la versi\u00f3n 10.0.0 y anteriores a la versi\u00f3n 10.0.11, la funci\u00f3n de b\u00fasqueda guardada se puede utilizar para realizar una inyecci\u00f3n SQL. La versi\u00f3n 10.0.11 contiene un parche para el problema."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 6.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.6}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:glpi-project:glpi:*:*:*:*:*:*:*:*", "versionStartIncluding": "10.0.0", "versionEndExcluding": "10.0.11", "matchCriteriaId": "26DF2F46-6455-4440-BB5D-75FEB6798705"}]}]}], "references": [{"url": "https://github.com/glpi-project/glpi/commit/4bd7f02d940953b9cbc9d285f7544bb0e490e75e", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/glpi-project/glpi/releases/tag/10.0.11", "source": "security-advisories@github.com", "tags": ["Release Notes"]}, {"url": "https://github.com/glpi-project/glpi/security/advisories/GHSA-94c3-fw5r-3362", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/glpi-project/glpi/commit/4bd7f02d940953b9cbc9d285f7544bb0e490e75e"}}