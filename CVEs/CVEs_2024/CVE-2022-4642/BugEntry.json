{"buggy_code": ["<?php\necho $this->Html->tag(\"p\", \"You have received a private message from <strong>$sender</strong>.\");\n\necho $this->Html->div(null,\n    \"<strong>Title:</strong> $title\",\n    array('style' => 'background:#666666;color:#ffffff;padding:10px;')\n);\n\necho $this->Html->div(null,\n    $this->Messages->formatContent($message),\n    array('style' => 'background:#f1f1f1;padding:10px;')\n);\n\n$replyLink = $this->Html->link(\n    \"Reply\",\n    \"https://tatoeba.org/private_messages/show/$messageId\"\n);\necho $this->Html->tag(\"p\", $replyLink);\n?>", "<?php\n/**\n * Tatoeba Project, free collaborative creation of multilingual corpuses project\n * Copyright (C) 2009 DEPARIS \u00c9tienne <etienne.deparis@umaneti.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n * PHP version 5\n *\n * @category PHP\n * @package  Tatoeba\n * @author   DEPARIS \u00c9tienne <etienne.deparis@umaneti.net>\n * @license  Affero General Public License\n * @link     https://tatoeba.org\n */\n\n$folderName = '';\nif ($folder == 'Inbox') {\n    if ($status == 'unread') {\n        /* @translators: folder name in private messages (noun) */\n        $folderName = __('Unread');\n    } else {\n        /* @translators: folder name in private messages (noun) */\n        $folderName = __('Inbox');\n    }\n} elseif ($folder == 'Sent') {\n    /* @translators: folder name in private messages (noun) */\n    $folderName = __('Sent');\n} elseif ($folder == 'Trash') {\n    /* @translators: folder name in private messages (noun) */\n    $folderName = __('Trash');\n} elseif ($folder == 'Drafts') {\n    /* @translators: folder name in private messages (noun) */\n    $folderName = __('Drafts');\n}\n\n$this->set('title_for_layout', $this->Pages->formatTitle(\n    /* @translators: this is used as a title. The folderName can be\n       whatever you translated \"Inbox\", \"Sent\" or \"Trash\" as. */\n    format(__('Private messages - {folderName}'), compact('folderName'))\n));\n?>\n<md-toolbar class=\"md-hue-2\">\n    <div class=\"md-toolbar-tools\">\n        <h2 flex><?= __('Private messages') ?></h2>\n    </div>\n</md-toolbar>\n\n<section layout=\"row\" flex ng-cloak>\n    <?= $this->element('pmmenu'); ?>\n\n    <md-content class=\"md-whiteframe-1dp\" flex>\n        <md-toolbar class=\"md-hue-1\">\n            <div class=\"md-toolbar-tools\">\n                <h2 flex>\n                    <?php\n                    $n = $this->Paginator->param('count');\n                    echo format(__n('{folderName} ({n}&nbsp;message)',\n                                    '{folderName} ({n}&nbsp;messages)',\n                                    $n, true),\n                                ['folderName'=> $folderName, 'n'=> $this->Number->format($n)]\n                                );\n                    ?>\n                </h2>\n\n                <?php if ($folder == 'Trash') {\n                    $url = $this->Url->build(['empty_folder', 'Trash']);\n                    $msg = __('Are you sure?');\n                    ?>\n                    <md-button href=\"<?= $url ?>\" onclick=\"return confirm('<?= $msg ?>')\">\n                        <md-icon>delete_forever</md-icon>\n                        <?= __('Empty trash') ?>\n                    </md-button>\n                <?php } ?>\n            </div>\n        </md-toolbar>\n\n        <?php\n        $this->Pagination->display();\n        ?>\n        <md-list id=\"pm-list\" ng-cloak>\n            <?php\n            foreach ($content as $msg) {\n                list($user, $label) = $this->PrivateMessages->getUserAndLabel($msg, $folder);\n\n                $unread = $msg->isnonread == 1 ? 'unread' : '';\n\n                if ($msg->title == '') {\n                    $messageTitle = __('[no subject]');\n                } else {\n                    $messageTitle = $msg->title;\n                }\n\n                if ($folder == 'Drafts') {\n                    $url = $this->Url->build([\n                        'action' => 'write',\n                        'none',\n                        $msg->id\n                    ]);\n                } else {\n                    $url = $this->Url->build([\n                        'action' => 'show',\n                        $msg->id\n                    ]);\n                }\n\n                if ($folder == 'Trash') {\n                    $restoreUrl = $this->Url->build([\n                        'action' => 'restore',\n                        $msg->id\n                    ]);\n                    $deleteConfirmation = 'onclick=\"return confirm(\\''.__('Are you sure?').'\\');\"';\n                    $deleteLabel = __('Permanently delete');\n                    $deleteIcon = 'delete_forever';\n                } else {\n                    $deleteConfirmation = '';\n                    /* @translators: delete button on private message (verb) */\n                    $deleteLabel = __('Delete');\n                    $deleteIcon = 'delete';\n                }\n\n                $deleteUrl = $this->Url->build([\n                    'action' => 'delete',\n                    $msg->id\n                ]);\n                ?>\n                <md-list-item class=\"md-2-line <?= $unread ?>\" href=\"<?= $url ?>\">\n                    <?= $this->Members->image($user, array('class' => 'md-avatar')); ?>\n                    <div class=\"md-list-item-text\" layout=\"column\">\n                        <h3><?= $this->safeForAngular($messageTitle) ?></h3>\n                        <p>\n                        <?php\n                        echo $label;\n                        echo ', ';\n                        echo $this->Date->ago($msg->date);\n                        echo '</span>';\n                        ?>\n                        </p>\n                    </div>\n\n                    <?php if ($folder == 'Trash') { ?>\n                    <md-button class=\"md-icon-button\" href=\"<?= $restoreUrl ?>\">\n                        <md-icon>restore</md-icon>\n                        <?php /* @translators: button to restore a private message that has been put to trash (verb) */ ?>\n                        <md-tooltip><?= __('Restore') ?></md-tooltip>\n                    </md-button>\n                    <?php } ?>\n\n                    <md-button class=\"md-icon-button\" href=\"<?= $deleteUrl ?>\" <?= $deleteConfirmation ?>>\n                        <md-icon><?= $deleteIcon ?></md-icon>\n                        <md-tooltip><?= $deleteLabel ?></md-tooltip>\n                    </md-button>\n                </md-list-item>\n                <?php\n            }\n            ?>\n        </md-list>\n        <?php\n        $this->Pagination->display();\n        ?>\n    </div>\n</section>\n", "<?php\n/**\n * Tatoeba Project, free collaborative creation of multilingual corpuses project\n * Copyright (C) 2009 Etienne Deparis <etienne.deparis@umaneti.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n * PHP version 5\n *\n * @category PHP\n * @package  Tatoeba\n * @author   HO Ngoc Phuong Trang <tranglich@gmail.com>\n * @license  Affero General Public License\n * @link     https://tatoeba.org\n */\n\nif (empty($message->title)) {\n    $messageTitle = __('[no subject]');\n} else {\n    $messageTitle = $message->title;\n}\n$this->set('title_for_layout', $this->Pages->formatTitle(\n    $messageTitle\n    .' - ' \n    .__('Private messages') \n));\n\n?>\n<md-toolbar class=\"md-hue-2\">\n    <div class=\"md-toolbar-tools\">\n        <h2 flex><?= __('Private messages') ?></h2>\n        \n        <?php\n        $this->Pagination->display();\n        ?>\n    </div>\n</md-toolbar>\n\n<section layout=\"row\" flex ng-cloak>\n    <?= $this->element('pmmenu'); ?>\n\n    <md-content class=\"md-whiteframe-1dp\" flex>\n        <md-toolbar class=\"md-hue-1\">\n            <div class=\"md-toolbar-tools\">\n                <h2 flex>\n                    <?= $this->safeForAngular($message->title) ?>\n                </h2>\n            </div>\n        </md-toolbar>\n        <?php\n        $author = $message->author;\n        echo $this->element('private_messages/message', [\n            'message' => $message,\n            'user' => $author\n        ]);\n        ?>\n        \n        <a name=\"reply\"></a>\n        <?php\n        if ($message->folder == 'Inbox' && $message->type == 'human') {\n            echo $this->element('private_messages/form', [\n                'pm' => $message,\n                'recipients' => $author->username,\n                'isReply' => true\n            ]);\n        }\n        ?>\n    </md-content>\n</section>\n"], "fixing_code": ["<?php\necho $this->Html->tag(\"p\", \"You have received a private message from <strong>$sender</strong>.\");\n\necho $this->Html->div(null,\n    \"<strong>Title:</strong> \".h($title),\n    array('style' => 'background:#666666;color:#ffffff;padding:10px;')\n);\n\necho $this->Html->div(null,\n    $this->Messages->formatContent($message),\n    array('style' => 'background:#f1f1f1;padding:10px;')\n);\n\n$replyLink = $this->Html->link(\n    \"Reply\",\n    \"https://tatoeba.org/private_messages/show/$messageId\"\n);\necho $this->Html->tag(\"p\", $replyLink);\n?>", "<?php\n/**\n * Tatoeba Project, free collaborative creation of multilingual corpuses project\n * Copyright (C) 2009 DEPARIS \u00c9tienne <etienne.deparis@umaneti.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n * PHP version 5\n *\n * @category PHP\n * @package  Tatoeba\n * @author   DEPARIS \u00c9tienne <etienne.deparis@umaneti.net>\n * @license  Affero General Public License\n * @link     https://tatoeba.org\n */\n\n$folderName = '';\nif ($folder == 'Inbox') {\n    if ($status == 'unread') {\n        /* @translators: folder name in private messages (noun) */\n        $folderName = __('Unread');\n    } else {\n        /* @translators: folder name in private messages (noun) */\n        $folderName = __('Inbox');\n    }\n} elseif ($folder == 'Sent') {\n    /* @translators: folder name in private messages (noun) */\n    $folderName = __('Sent');\n} elseif ($folder == 'Trash') {\n    /* @translators: folder name in private messages (noun) */\n    $folderName = __('Trash');\n} elseif ($folder == 'Drafts') {\n    /* @translators: folder name in private messages (noun) */\n    $folderName = __('Drafts');\n}\n\n$this->set('title_for_layout', $this->Pages->formatTitle(\n    /* @translators: this is used as a title. The folderName can be\n       whatever you translated \"Inbox\", \"Sent\" or \"Trash\" as. */\n    format(__('Private messages - {folderName}'), compact('folderName'))\n));\n?>\n<md-toolbar class=\"md-hue-2\">\n    <div class=\"md-toolbar-tools\">\n        <h2 flex><?= __('Private messages') ?></h2>\n    </div>\n</md-toolbar>\n\n<section layout=\"row\" flex ng-cloak>\n    <?= $this->element('pmmenu'); ?>\n\n    <md-content class=\"md-whiteframe-1dp\" flex>\n        <md-toolbar class=\"md-hue-1\">\n            <div class=\"md-toolbar-tools\">\n                <h2 flex>\n                    <?php\n                    $n = $this->Paginator->param('count');\n                    echo format(__n('{folderName} ({n}&nbsp;message)',\n                                    '{folderName} ({n}&nbsp;messages)',\n                                    $n, true),\n                                ['folderName'=> $folderName, 'n'=> $this->Number->format($n)]\n                                );\n                    ?>\n                </h2>\n\n                <?php if ($folder == 'Trash') {\n                    $url = $this->Url->build(['empty_folder', 'Trash']);\n                    $msg = __('Are you sure?');\n                    ?>\n                    <md-button href=\"<?= $url ?>\" onclick=\"return confirm('<?= $msg ?>')\">\n                        <md-icon>delete_forever</md-icon>\n                        <?= __('Empty trash') ?>\n                    </md-button>\n                <?php } ?>\n            </div>\n        </md-toolbar>\n\n        <?php\n        $this->Pagination->display();\n        ?>\n        <md-list id=\"pm-list\" ng-cloak>\n            <?php\n            foreach ($content as $msg) {\n                list($user, $label) = $this->PrivateMessages->getUserAndLabel($msg, $folder);\n\n                $unread = $msg->isnonread == 1 ? 'unread' : '';\n\n                if ($msg->title == '') {\n                    $messageTitle = __('[no subject]');\n                } else {\n                    $messageTitle = $msg->title;\n                }\n\n                if ($folder == 'Drafts') {\n                    $url = $this->Url->build([\n                        'action' => 'write',\n                        'none',\n                        $msg->id\n                    ]);\n                } else {\n                    $url = $this->Url->build([\n                        'action' => 'show',\n                        $msg->id\n                    ]);\n                }\n\n                if ($folder == 'Trash') {\n                    $restoreUrl = $this->Url->build([\n                        'action' => 'restore',\n                        $msg->id\n                    ]);\n                    $deleteConfirmation = 'onclick=\"return confirm(\\''.__('Are you sure?').'\\');\"';\n                    $deleteLabel = __('Permanently delete');\n                    $deleteIcon = 'delete_forever';\n                } else {\n                    $deleteConfirmation = '';\n                    /* @translators: delete button on private message (verb) */\n                    $deleteLabel = __('Delete');\n                    $deleteIcon = 'delete';\n                }\n\n                $deleteUrl = $this->Url->build([\n                    'action' => 'delete',\n                    $msg->id\n                ]);\n                ?>\n                <md-list-item class=\"md-2-line <?= $unread ?>\" href=\"<?= $url ?>\">\n                    <?= $this->Members->image($user, array('class' => 'md-avatar')); ?>\n                    <div class=\"md-list-item-text\" layout=\"column\">\n                        <h3><?= h($this->safeForAngular($messageTitle)) ?></h3>\n                        <p>\n                        <?php\n                        echo $label;\n                        echo ', ';\n                        echo $this->Date->ago($msg->date);\n                        echo '</span>';\n                        ?>\n                        </p>\n                    </div>\n\n                    <?php if ($folder == 'Trash') { ?>\n                    <md-button class=\"md-icon-button\" href=\"<?= $restoreUrl ?>\">\n                        <md-icon>restore</md-icon>\n                        <?php /* @translators: button to restore a private message that has been put to trash (verb) */ ?>\n                        <md-tooltip><?= __('Restore') ?></md-tooltip>\n                    </md-button>\n                    <?php } ?>\n\n                    <md-button class=\"md-icon-button\" href=\"<?= $deleteUrl ?>\" <?= $deleteConfirmation ?>>\n                        <md-icon><?= $deleteIcon ?></md-icon>\n                        <md-tooltip><?= $deleteLabel ?></md-tooltip>\n                    </md-button>\n                </md-list-item>\n                <?php\n            }\n            ?>\n        </md-list>\n        <?php\n        $this->Pagination->display();\n        ?>\n    </div>\n</section>\n", "<?php\n/**\n * Tatoeba Project, free collaborative creation of multilingual corpuses project\n * Copyright (C) 2009 Etienne Deparis <etienne.deparis@umaneti.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n * PHP version 5\n *\n * @category PHP\n * @package  Tatoeba\n * @author   HO Ngoc Phuong Trang <tranglich@gmail.com>\n * @license  Affero General Public License\n * @link     https://tatoeba.org\n */\n\nif (empty($message->title)) {\n    $messageTitle = __('[no subject]');\n} else {\n    $messageTitle = $message->title;\n}\n$this->set('title_for_layout', $this->Pages->formatTitle(\n    $messageTitle\n    .' - ' \n    .__('Private messages') \n));\n\n?>\n<md-toolbar class=\"md-hue-2\">\n    <div class=\"md-toolbar-tools\">\n        <h2 flex><?= __('Private messages') ?></h2>\n        \n        <?php\n        $this->Pagination->display();\n        ?>\n    </div>\n</md-toolbar>\n\n<section layout=\"row\" flex ng-cloak>\n    <?= $this->element('pmmenu'); ?>\n\n    <md-content class=\"md-whiteframe-1dp\" flex>\n        <md-toolbar class=\"md-hue-1\">\n            <div class=\"md-toolbar-tools\">\n                <h2 flex>\n                    <?= h($this->safeForAngular($message->title)) ?>\n                </h2>\n            </div>\n        </md-toolbar>\n        <?php\n        $author = $message->author;\n        echo $this->element('private_messages/message', [\n            'message' => $message,\n            'user' => $author\n        ]);\n        ?>\n        \n        <a name=\"reply\"></a>\n        <?php\n        if ($message->folder == 'Inbox' && $message->type == 'human') {\n            echo $this->element('private_messages/form', [\n                'pm' => $message,\n                'recipients' => $author->username,\n                'isReply' => true\n            ]);\n        }\n        ?>\n    </md-content>\n</section>\n"], "filenames": ["src/Template/Email/html/new_private_message.ctp", "src/Template/PrivateMessages/folder.ctp", "src/Template/PrivateMessages/show.ctp"], "buggy_code_start_loc": [5, 141, 57], "buggy_code_end_loc": [6, 142, 58], "fixing_code_start_loc": [5, 141, 57], "fixing_code_end_loc": [6, 142, 58], "type": "CWE-79", "message": "A vulnerability was found in tatoeba2. It has been classified as problematic. This affects an unknown part of the component Profile Name Handler. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. The exploit has been disclosed to the public and may be used. Upgrading to version prod_2022-10-30 is able to address this issue. The name of the patch is 91110777fc8ddf1b4a2cf4e66e67db69b9700361. It is recommended to upgrade the affected component. The identifier VDB-216501 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2022-4642", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-21T22:15:08.907", "lastModified": "2022-12-29T15:09:01.077", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in tatoeba2. It has been classified as problematic. This affects an unknown part of the component Profile Name Handler. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. The exploit has been disclosed to the public and may be used. Upgrading to version prod_2022-10-30 is able to address this issue. The name of the patch is 91110777fc8ddf1b4a2cf4e66e67db69b9700361. It is recommended to upgrade the affected component. The identifier VDB-216501 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "cna@vuldb.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:tatoeba:tatoeba2:*:*:*:*:*:*:*:*", "versionEndExcluding": "2022-10-30", "matchCriteriaId": "B52C5FF1-449E-4FD6-B509-8264B0FB5C1C"}]}]}], "references": [{"url": "https://github.com/Tatoeba/tatoeba2/commit/91110777fc8ddf1b4a2cf4e66e67db69b9700361", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/Tatoeba/tatoeba2/issues/3002", "source": "cna@vuldb.com", "tags": ["Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://github.com/Tatoeba/tatoeba2/releases/tag/prod_2022-10-30", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216501", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Tatoeba/tatoeba2/commit/91110777fc8ddf1b4a2cf4e66e67db69b9700361"}}