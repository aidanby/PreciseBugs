{"buggy_code": ["<?php\n\n/*\n * Klasa odpowiedzialna za ca\u0142o\u015b\u0107 aplikacji - wszystkie jej aspekty (front-end i back-end)\n */\n\nclass Application\n{\n\tprotected $db;\n\tprotected $settings;\n\tprotected $user;\n\tprotected $acl;\n\tprotected $page;\n\tprotected $menu;\n\n\tprotected $controller_object;\n\tprotected $model_object;\n\tprotected $view_object;\n\n\tpublic function __construct()\n\t{\n\t\tinclude ABSTR_DIR . 'controller.php';\n\t\tinclude ABSTR_DIR . 'model.php';\n\t\tinclude ABSTR_DIR . 'view.php';\n\n\t\t// filtrowanie wed\u0142ug frazy:\n\t\tif (isset($_POST['ListSearchButton']))\n\t\t{\n\t\t\t$_SESSION['list_filter'] = htmlspecialchars(substr(trim($_POST['ListSearchText']), 0, 32));\n\t\t}\n\n\t\t// usuwanie filtrowania:\n\t\tif (isset($_POST['ListSearchClose']))\n\t\t{\n\t\t\t$_SESSION['list_filter'] = NULL;\n\t\t}\n\t}\n\n\tpublic function start()\n\t{\n\t\tif (file_exists(INSTALL_SCRIPT))\n\t\t{\n\t\t\t$_SESSION['install_mode'] = TRUE;\n\t\t}\n\n\t\tif (isset($_GET['route']) && isset($_SESSION['last_route']))\n\t\t{\n\t\t\tif ($_GET['route'] == $_SESSION['last_route']) $_SESSION['keep_paginator'] = TRUE;\n\t\t\telse unset($_SESSION['keep_paginator']);\n\t\t}\n\n\t\tinclude LIB_DIR . 'database.php';\n\t\t\n\t\t$this->db = new Database();\n\t\t$this->db->init(DB_HOST, DB_NAME, DB_USER, DB_PASS);\n\t\t$this->db->connect();\n\n\t\t// tworzy obiekty strony:\n\n\t\t$this->set_settings($this);\n\t\t$this->set_page($this);\n\t\t$this->set_user($this);\n\t\t$this->set_menu($this);\n\t}\n\n\tpublic function stop()\n\t{\n\t\tinclude LIB_DIR . 'visitors.php';\n\n\t\t$visitor = new Visitors($this);\n\t\t$visitor->Store();\n\n\t\t$_SESSION['last_route'] = isset($_GET['route']) ? $_GET['route'] : NULL;\n\t}\n\n\tpublic function get_dbc()\n\t{\n\t\treturn $this->db->get_connection();\n\t}\n\n\tpublic function set_controller($controller, $action)\n\t{\n\t\tinclude CLASS_DIR . 'module.php';\n\n\t\t$module = new Module($controller);\n\n\t\tdefine ('MODULE_NAME', $module->get_name());\n\n\t\t$class_file = APP_DIR . 'controller/' . MODULE_NAME . '.php';\n\t\t$class_name = ucfirst(MODULE_NAME) . '_Controller';\n\t\t$class_method = ucfirst($action) . '_Action';\n\n\t\t// tworzy obiekt kontrolera:\n\n\t\tif (file_exists($class_file))\n\t\t{\n\t\t\tinclude $class_file;\n\n\t\t\tif (class_exists($class_name))\n\t\t\t{\n\t\t\t\t$this->controller_object = new $class_name($this);\n\n\t\t\t\t$this->set_acl($this);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdie ('Class: <h3>'.$class_name.'</h3> not found.');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdie ('File: <h3>'.$class_file.'</h3> not found.');\n\t\t}\n\n\t\t// tworzy obiekt modelu:\n\n\t\t$this->set_model_object(MODULE_NAME);\n\n\t\t// tworzy obiekt widoku:\n\n\t\t$this->set_view_object(MODULE_NAME);\n\n\t\t// wywo\u0142uje akcj\u0119 (metod\u0119) kontrolera:\n\n\t\tif (method_exists($class_name, $class_method))\n\t\t{\n\t\t\t$this->controller_object->{$class_method}();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdie ('Method: <h3>'.$class_method.'</h3> in class: <h3>'.$class_name.'</h3> not found.');\n\t\t}\n\t}\n\n\tpublic function get_controller()\n\t{\n\t\treturn $this->controller_object;\n\t}\n\n\tpublic function set_model_object($module_name)\n\t{\n\t\t$class_file = APP_DIR . 'model' . '/' . $module_name . '.php';\n\n\t\tif (file_exists($class_file))\n\t\t{\n\t\t\tinclude $class_file;\n\n\t\t\t$class_name = ucfirst($module_name) . '_Model';\n\n\t\t\tif (class_exists($class_name))\n\t\t\t{\n\t\t\t\t$this->model_object = new $class_name($this->get_dbc());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdie ('Class: <h3>'.$class_name.'</h3> not found.');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdie ('File: <h3>'.$class_file.'</h3> not found.');\n\t\t}\n\t}\n\n\tpublic function get_model_object()\n\t{\n\t\treturn $this->model_object;\n\t}\n\n\tpublic function set_view_object($module_name)\n\t{\n\t\t$class_file = APP_DIR . 'view' . '/' . $module_name . '.php';\n\n\t\tif (file_exists($class_file))\n\t\t{\n\t\t\tinclude $class_file;\n\n\t\t\t$class_name = ucfirst($module_name) . '_View';\n\n\t\t\tif (class_exists($class_name))\n\t\t\t{\n\t\t\t\t$this->view_object = new $class_name($this->get_page());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdie ('Class: <h3>'.$class_name.'</h3> not found.');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdie ('File: <h3>'.$class_file.'</h3> not found.');\n\t\t}\n\t}\n\n\tpublic function get_view_object()\n\t{\n\t\treturn $this->view_object;\n\t}\n\n\tpublic function set_page($obj)\n\t{\n\t\tinclude CLASS_DIR . 'page.php';\n\n\t\t$this->page = new Page($obj);\n\t}\n\n\tpublic function get_page()\n\t{\n\t\treturn $this->page;\n\t}\n\n\tpublic function set_settings($obj)\n\t{\n\t\tinclude LIB_DIR . 'settings.php';\n\n\t\t$this->settings = new Settings($obj);\n\t}\n\n\tpublic function get_settings()\n\t{\n\t\treturn $this->settings;\n\t}\n\n\tpublic function set_user($obj)\n\t{\n\t\tinclude CLASS_DIR . 'status.php';\n\n\t\t$this->user = new Status($obj);\n\t}\n\n\tpublic function get_user()\n\t{\n\t\treturn $this->user;\n\t}\n\n\tpublic function set_acl($obj)\n\t{\n\t\tinclude CLASS_DIR . 'acl.php';\n\n\t\t$this->acl = new AccessControlList($obj);\n\t}\n\n\tpublic function get_acl()\n\t{\n\t\treturn $this->acl;\n\t}\n\n\tpublic function set_menu($obj)\n\t{\n\t\tinclude CLASS_DIR . 'menu.php';\n\n\t\t$this->menu = new Menu($obj);\n\t}\n\n\tpublic function get_menu()\n\t{\n\t\treturn $this->menu;\n\t}\n}\n\n?>\n", "<?php\n\nclass Roles_View extends View\n{\n\tpublic function __construct($page)\n\t{\n\t\tparent::__construct($page);\n\t}\n\n\tpublic function ShowList($columns, $data)\n\t{\n\t\t$title = 'Role u\u017cytkownik\u00f3w';\n\t\t$image = 'img/32x32/lock_go.png';\n\n\t\t$attribs = array(\n\t\t\tarray('width' => '5%',  'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'center', 'visible' => '1', 'image' => '1'),\n\t\t\tarray('width' => '15%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '50%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'center', 'visible' => '1'),\n\t\t);\n\t\t\n\t\t$actions = array(\n\t\t\tarray('action' => 'view',   'icon' => 'info.png',  'title' => 'Podgl\u0105d'),\n\t\t\tarray('action' => 'edit',   'icon' => 'edit.png',  'title' => 'Edytuj'),\n\t\t\tarray('action' => 'delete', 'icon' => 'trash.png', 'title' => 'Usu\u0144'),\n\t\t);\n\t\n\t\tforeach ($data as $k => $v)\n\t\t{\n\t\t\tforeach ($v as $key => $value)\n\t\t\t{\n\t\t\t\tif ($key == 'user_login')\n\t\t\t\t{\n\t\t\t\t\tif ($value == $_SESSION['user_login'])\n\t\t\t\t\t{\n\t\t\t\t\t\t$data[$k]['user_login'] = '<b style=\"color: blue;\">' . $data[$k]['user_login'] . '</b>';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinclude GENER_DIR . 'list.php';\n\n\t\t$list_object = new ListBuilder();\n\n\t\t$list_object->init($title, $image, $columns, $data, $this->get_list_params(), $attribs, $actions);\n\n\t\t$result = $list_object->build_list();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowForm($id, $data)\n\t{\n\t\t$users = array();\n\t\t$functions = array();\n\n\t\tforeach ($data as $k => $v) \n\t\t{\n\t\t\tif ($k == 'users')\n\t\t\t{\n\t\t\t\tforeach ($v as $i => $j)\n\t\t\t\t{\n\t\t\t\t\tforeach ($j as $key => $value)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($key == 'id') $user_id = $value;\n\t\t\t\t\t\tif ($key == 'user_login') $user_login = $value;\n\t\t\t\t\t\tif ($key == 'user_name') $user_name = $value;\n\t\t\t\t\t\tif ($key == 'user_surname') $user_surname = $value;\n\t\t\t\t\t}\n\t\t\t\t\tif ($id) // edycja roli\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($user_id == $id)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$users[] = array(\n\t\t\t\t\t\t\t\t'value' => $user_id, 'caption' => $user_name . ' ' . $user_surname . ' (' . $user_login . ')',\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse // nowa rola\n\t\t\t\t\t{\n\t\t\t\t\t\t$users[] = array(\n\t\t\t\t\t\t\t'value' => $user_id, 'caption' => $user_name . ' ' . $user_surname . ' (' . $user_login . ')',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ($k == 'functions')\n\t\t\t{\n\t\t\t\tforeach ($v as $i => $j)\n\t\t\t\t{\n\t\t\t\t\tforeach ($j as $key => $value)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($key == 'function_id') $function_id = $value;\n\t\t\t\t\t\tif ($key == 'function') $function = $value;\n\t\t\t\t\t\tif ($key == 'meaning') $meaning = $value;\n\t\t\t\t\t\tif ($key == 'module') $module = $value;\n\t\t\t\t\t\tif ($key == 'access') $access = $value;\n\t\t\t\t\t}\n\t\t\t\t\t$chk = $access ? 'checked' : NULL;\n\t\t\t\t\t$functions[] = array(\n\t\t\t\t\t\t'caption' => NULL, \n\t\t\t\t\t\t'data' => array(\n\t\t\t\t\t\t\t'type' => 'checkbox', 'id' => 'function_'.$function_id, 'name' => 'function_'.$function_id, 'label' => $meaning . ' (' . $module . ')', $chk => $chk, 'value' => NULL,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinclude GENER_DIR . 'form.php';\n\n\t\t$form_object = new FormBuilder();\n\n\t\t$form_title = $data ? 'Edycja roli u\u017cytkownika' : 'Nowa rola u\u017cytkownika';\n\t\t$form_image = 'img/32x32/list_edit.png';\n\t\t$form_width = '50%';\n\t\t\n\t\t$form_object->init($form_title, $form_image, $form_width);\n\n\t\t$action = $id ? 'edit&id=' . $id : 'add';\n\n\t\t$form_action = 'index.php?route=' . MODULE_NAME . '&action=' . $action;\n\n\t\t$form_object->set_action($form_action);\n\n\t\t$form_inputs = array(\n\t\t\tarray(\n\t\t\t\t'caption' => 'U\u017cytkownik', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'select', 'id' => 'user_id', 'name' => 'user_id', \n\t\t\t\t\t'option' => $users, \n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Funkcje', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'label', 'value' => NULL,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\tforeach ($functions as $function)\n\t\t{\n\t\t\t$form_inputs[] = $function;\n\t\t}\n\n\t\t$form_object->set_inputs($form_inputs);\n\t\t\n\t\t$form_hiddens = array();\n\t\t\t\n\t\t$form_object->set_hiddens($form_hiddens);\n\n\t\t$form_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'save', 'id' => 'save_button', 'name' => 'save_button', 'value' => 'Zapisz',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'close', 'id' => 'update_button', 'name' => 'update_button', 'value' => 'Zamknij',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Anuluj',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$form_object->set_buttons($form_buttons);\n\n\t\t$result = $form_object->build_form();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowDetails($data)\n\t{\n\t\tinclude GENER_DIR . 'view.php';\n\n\t\t$view_object = new ViewBuilder();\n\n\t\t$view_title = 'Szczeg\u00f3\u0142y roli u\u017cytkownika';\n\t\t$view_image = 'img/32x32/list_information.png';\n\t\t$view_width = '50%';\n\t\t\n\t\t$view_object->init($view_title, $view_image, $view_width);\n\n\t\t$view_action = 'index.php?route=' . MODULE_NAME;\n\n\t\t$view_object->set_action($view_action);\n\n\t\t$view_inputs = array();\n\n\t\tif (is_array($data))\n\t\t{\n\t\t\tforeach ($data as $key => $value) \n\t\t\t{\n\t\t\t\t$view_inputs[] = array('caption' => $key, 'value' => $value);\n\t\t\t}\n\t\t}\n\n\t\t$view_object->set_inputs($view_inputs);\n\t\t\n\t\t$view_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Zamknij',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$view_object->set_buttons($view_buttons);\n\n\t\t$result = $view_object->build_view();\n\n\t\treturn $result;\n\t}\n}\n\n?>\n", "<?php\n\nclass Users_View extends View\n{\n\tpublic function __construct($page)\n\t{\n\t\tparent::__construct($page);\n\t}\n\n\tpublic function ShowList($columns, $data)\n\t{\n\t\t$title = 'U\u017cytkownicy serwisu';\n\t\t$image = 'img/32x32/users_group.png';\n\n\t\t$attribs = array(\n\t\t\tarray('width' => '5%',  'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '8%', 'align' => 'left',   'visible' => '1', 'image' => '1'),\n\t\t\tarray('width' => '5%',  'align' => 'left',   'visible' => '0'),\n\t\t\tarray('width' => '8%', 'align' => 'left',   'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'left',   'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'left', 'visible' => '1'),\n\t\t\tarray('width' => '5%',  'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '5%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '5%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '5%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '5%',  'align' => 'center', 'visible' => '0'),\n\t\t\tarray('width' => '15%', 'align' => 'center', 'visible' => '1'),\n\t\t);\n\t\t\n\t\t$actions = array(\n\t\t\tarray('action' => 'view',    'icon' => 'info.png',   'title' => 'Podgl\u0105d'),\n\t\t\tarray('action' => 'edit',    'icon' => 'edit.png',   'title' => 'Edytuj'),\n\t\t\tarray('action' => 'setpass', 'icon' => 'access.png', 'title' => 'Has\u0142o'),\n\t\t\tarray('action' => 'delete',  'icon' => 'trash.png',  'title' => 'Usu\u0144'),\n\t\t);\n\t\n\t\t$group_names = array('Guest', 'Adm', 'Opr', 'Usr');\n\n\t\tforeach ($data as $k => $v)\n\t\t{\n\t\t\tforeach ($v as $key => $value)\n\t\t\t{\n\t\t\t\tif ($key == 'id')\n\t\t\t\t{\n\t\t\t\t\tif ($value == $_SESSION['user_id'])\n\t\t\t\t\t{\n\t\t\t\t\t\t$data[$k]['user_login'] = '<b style=\"color: blue;\">' . $data[$k]['user_login'] . '</b>';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ($key == 'status')\n\t\t\t\t{\n\t\t\t\t\t$data[$k][$key] = $group_names[$value];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinclude GENER_DIR . 'list.php';\n\n\t\t$list_object = new ListBuilder();\n\n\t\t$list_object->init($title, $image, $columns, $data, $this->get_list_params(), $attribs, $actions);\n\n\t\t$result = $list_object->build_list();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowForm($data, $user)\n\t{\n\t\tif ($data) // edycja\n\t\t{\n\t\t\tforeach ($data as $key => $value) \n\t\t\t{\n\t\t\t\tif ($key == 'id') $main_id = $value;\n\t\t\t\tif ($key == 'user_login') $main_user_login = $value;\n\t\t\t\tif ($key == 'user_password') $main_user_password = $value;\n\t\t\t\tif ($key == 'user_name') $main_user_name = $value;\n\t\t\t\tif ($key == 'user_surname') $main_user_surname = $value;\n\t\t\t\tif ($key == 'email') $main_email = $value;\n\t\t\t\tif ($key == 'status') $main_status = $value;\n\t\t\t\tif ($key == 'registered') $main_registered = $value;\n\t\t\t\tif ($key == 'logged_in') $main_logged_in = $value;\n\t\t\t\tif ($key == 'modified') $main_modified = $value;\n\t\t\t\tif ($key == 'logged_out') $main_logged_out = $value;\n\t\t\t\tif ($key == 'active') $main_active = $value;\n\t\t\t}\n\t\t}\n\t\telse // nowa pozycja\n\t\t{\n\t\t\t$main_id = NULL;\n\t\t\t$main_user_login = NULL;\n\t\t\t$main_user_password = NULL;\n\t\t\t$main_user_name = NULL;\n\t\t\t$main_user_surname = NULL;\n\t\t\t$main_email = NULL;\n\t\t\t$main_registered = NULL;\n\t\t\t$main_logged_in = NULL;\n\t\t\t$main_modified = NULL;\n\t\t\t$main_logged_out = NULL;\n\t\t\t$main_status = USER;\n\t\t\t$main_active = 1;\n\t\t}\n\n\t\t$sel = range(0, 4);\n\t\t$sel[$main_status] = 'selected';\n\n\t\t$chk = array(NULL, NULL);\n\t\t$chk[$main_active] = 'checked';\n\n\t\tinclude GENER_DIR . 'form.php';\n\n\t\t$form_object = new FormBuilder();\n\n\t\t$form_title = $data ? 'Edycja u\u017cytkownika' : 'Nowy u\u017cytkownik';\n\t\t$form_image = 'img/32x32/list_edit.png';\n\t\t$form_width = '50%';\n\t\t\n\t\t$form_object->init($form_title, $form_image, $form_width);\n\n\t\t$action = $data ? 'edit&id=' . $main_id : 'add';\n\n\t\t$form_action = 'index.php?route=' . MODULE_NAME . '&action=' . $action;\n\n\t\t$form_object->set_action($form_action);\n\n\t\t$form_inputs = array(\n\t\t\tarray(\n\t\t\t\t'caption' => 'Imi\u0119', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'text', 'id' => 'user_name', 'name' => 'user_name', 'value' => $main_user_name, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Nazwisko', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'text', 'id' => 'user_surname', 'name' => 'user_surname', 'value' => $main_user_surname, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Login', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'text', 'id' => 'user_login', 'name' => 'user_login', 'value' => $main_user_login, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'E-mail', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'email', 'id' => 'email', 'name' => 'email', 'value' => $main_email, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Has\u0142o', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'password', 'id' => 'user_password', 'name' => 'user_password', 'value' => $main_user_password, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Grupa u\u017cytkownik\u00f3w', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'select', 'id' => 'status', 'name' => 'status', \n\t\t\t\t\t'option' => array(\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'value' => '1', 'caption' => 'Administratorzy', $sel[1] => $sel[1],\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'value' => '2', 'caption' => 'Operatorzy', $sel[2] => $sel[2],\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'value' => '3', 'caption' => 'Zarejestrowani', $sel[3] => $sel[3],\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t), \n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => NULL, \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'radio', 'name' => 'active', \n\t\t\t\t\t'items' => array(\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'id' => 'active_yes', 'label' => 'Aktywny', $chk[1] => $chk[1], 'value' => 1,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'id' => 'active_no', 'label' => 'Zablokowany', $chk[0] => $chk[0], 'value' => 0,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\n\t\tif ($data) unset($form_inputs[4]); // wyklucza z listy input\u00f3w pole has\u0142o\n\n\t\tif ($user->get_value('user_status') != ADMIN) unset($form_inputs[5]); // wyklucza z listy input\u00f3w pole profil\n\n\t\t$form_object->set_inputs($form_inputs);\n\t\t\n\t\t$form_hiddens = $user->get_value('user_status') == ADMIN ? array() : array(\n\t\t\t\tarray(\n\t\t\t\t\t'type' => 'hidden', 'id' => 'status', 'name' => 'status', 'value' => $main_status,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\n\t\t$form_object->set_hiddens($form_hiddens);\n\n\t\t$form_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'save', 'id' => 'save_button', 'name' => 'save_button', 'value' => 'Zapisz',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'close', 'id' => 'update_button', 'name' => 'update_button', 'value' => 'Zamknij',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Anuluj',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$form_object->set_buttons($form_buttons);\n\n\t\t$result = $form_object->build_form();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowDetails($data)\n\t{\n\t\tinclude GENER_DIR . 'view.php';\n\n\t\t$view_object = new ViewBuilder();\n\n\t\t$view_title = 'Szczeg\u00f3\u0142y u\u017cytkownika';\n\t\t$view_image = 'img/32x32/list_information.png';\n\t\t$view_width = '50%';\n\t\t\n\t\t$view_object->init($view_title, $view_image, $view_width);\n\n\t\t$view_action = 'index.php?route=' . MODULE_NAME;\n\n\t\t$view_object->set_action($view_action);\n\n\t\t$view_inputs = array();\n\n\t\tif (is_array($data))\n\t\t{\n\t\t\tforeach ($data as $key => $value) \n\t\t\t{\n\t\t\t\tif (in_array($key, array('user_password', 'status', 'active'))) continue;\n\t\t\t\t$view_inputs[] = array('caption' => $key, 'value' => $value);\n\t\t\t}\n\t\t}\n\n\t\t$view_object->set_inputs($view_inputs);\n\t\t\n\t\t$view_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Zamknij',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$view_object->set_buttons($view_buttons);\n\n\t\t$result = $view_object->build_view();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowPassword($id)\n\t{\n\t\tinclude GENER_DIR . 'form.php';\n\n\t\t$form_object = new FormBuilder();\n\n\t\t$form_title = 'Nowe has\u0142o';\n\t\t$form_image = 'img/32x32/server_key.png';\n\t\t$form_width = '300px';\n\t\t\n\t\t$form_object->init($form_title, $form_image, $form_width);\n\n\t\t$form_action = 'index.php?route=' . MODULE_NAME . '&action=setpass&id=' . $id;\n\n\t\t$form_object->set_action($form_action);\n\n\t\t$form_inputs = array(\n\t\t\tarray(\n\t\t\t\t'caption' => 'Has\u0142o', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'password', 'id' => 'user_password', 'name' => 'user_password', 'value' => NULL, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Powt\u00f3rz', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'password', 'id' => 'user_password_repeat', 'name' => 'user_password_repeat', 'value' => NULL, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\n\t\t$form_object->set_inputs($form_inputs);\n\t\t\n\t\t$form_hiddens = array();\n\t\t\t\n\t\t$form_object->set_hiddens($form_hiddens);\n\n\t\t$form_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'submit', 'id' => 'save_button', 'name' => 'save_button', 'value' => 'Zapisz',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Anuluj',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$form_object->set_buttons($form_buttons);\n\n\t\t$result = $form_object->build_form();\n\n\t\treturn $result;\n\t}\n}\n\n?>"], "fixing_code": ["<?php\n\n/*\n * Klasa odpowiedzialna za ca\u0142o\u015b\u0107 aplikacji - wszystkie jej aspekty (front-end i back-end)\n */\n\nclass Application\n{\n\tprotected $db;\n\tprotected $settings;\n\tprotected $user;\n\tprotected $acl;\n\tprotected $page;\n\tprotected $menu;\n\n\tprotected $controller_object;\n\tprotected $model_object;\n\tprotected $view_object;\n\n\tpublic function __construct()\n\t{\n\t\tinclude ABSTR_DIR . 'controller.php';\n\t\tinclude ABSTR_DIR . 'model.php';\n\t\tinclude ABSTR_DIR . 'view.php';\n\n\t\t// filtrowanie wed\u0142ug frazy:\n\t\tif (isset($_POST['ListSearchButton']))\n\t\t{\n\t\t\t$_SESSION['list_filter'] = htmlspecialchars(substr(trim($_POST['ListSearchText']), 0, 32));\n\t\t}\n\n\t\t// usuwanie filtrowania:\n\t\tif (isset($_POST['ListSearchClose']))\n\t\t{\n\t\t\t$_SESSION['list_filter'] = NULL;\n\t\t}\n\t}\n\n\tpublic function start()\n\t{\n\t\tif (file_exists(INSTALL_SCRIPT))\n\t\t{\n\t\t\t$_SESSION['install_mode'] = TRUE;\n\t\t}\n\n\t\tif (isset($_GET['route']) && isset($_SESSION['last_route']))\n\t\t{\n\t\t\tif ($_GET['route'] == $_SESSION['last_route']) $_SESSION['keep_paginator'] = TRUE;\n\t\t\telse unset($_SESSION['keep_paginator']);\n\t\t}\n\n\t\tinclude LIB_DIR . 'database.php';\n\t\t\n\t\t$this->db = new Database();\n\t\t$this->db->init(DB_HOST, DB_NAME, DB_USER, DB_PASS);\n\t\t$this->db->connect();\n\n\t\t// tworzy obiekty strony:\n\n\t\t$this->set_settings($this);\n\t\t$this->set_page($this);\n\t\t$this->set_user($this);\n\t\t$this->set_menu($this);\n\t}\n\n\tpublic function stop()\n\t{\n\t\tinclude LIB_DIR . 'visitors.php';\n\n\t\t$visitor = new Visitors($this);\n\t\t$visitor->Store();\n\n\t\t$_SESSION['last_route'] = isset($_GET['route']) ? $_GET['route'] : NULL;\n\t}\n\n\tpublic function get_dbc()\n\t{\n\t\treturn $this->db->get_connection();\n\t}\n\n\tpublic function set_controller($controller, $action)\n\t{\n\t\tinclude CLASS_DIR . 'module.php';\n\n\t\t$module = new Module($controller);\n\n\t\tdefine ('MODULE_NAME', $module->get_name());\n\n\t\t$class_file = APP_DIR . 'controller/' . MODULE_NAME . '.php';\n\t\t$class_name = ucfirst(MODULE_NAME) . '_Controller';\n\t\t$class_method = ucfirst(strip_tags($action)) . '_Action';\n\n\t\t// tworzy obiekt kontrolera:\n\n\t\tif (file_exists($class_file))\n\t\t{\n\t\t\tinclude $class_file;\n\n\t\t\tif (class_exists($class_name))\n\t\t\t{\n\t\t\t\t$this->controller_object = new $class_name($this);\n\n\t\t\t\t$this->set_acl($this);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdie ('Class: <h3>'.$class_name.'</h3> not found.');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdie ('File: <h3>'.$class_file.'</h3> not found.');\n\t\t}\n\n\t\t// tworzy obiekt modelu:\n\n\t\t$this->set_model_object(MODULE_NAME);\n\n\t\t// tworzy obiekt widoku:\n\n\t\t$this->set_view_object(MODULE_NAME);\n\n\t\t// wywo\u0142uje akcj\u0119 (metod\u0119) kontrolera:\n\n\t\tif (method_exists($class_name, $class_method))\n\t\t{\n\t\t\t$this->controller_object->{$class_method}();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdie ('Method: <h3>'.$class_method.'</h3> in class: <h3>'.$class_name.'</h3> not found.');\n\t\t}\n\t}\n\n\tpublic function get_controller()\n\t{\n\t\treturn $this->controller_object;\n\t}\n\n\tpublic function set_model_object($module_name)\n\t{\n\t\t$class_file = APP_DIR . 'model' . '/' . $module_name . '.php';\n\n\t\tif (file_exists($class_file))\n\t\t{\n\t\t\tinclude $class_file;\n\n\t\t\t$class_name = ucfirst($module_name) . '_Model';\n\n\t\t\tif (class_exists($class_name))\n\t\t\t{\n\t\t\t\t$this->model_object = new $class_name($this->get_dbc());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdie ('Class: <h3>'.$class_name.'</h3> not found.');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdie ('File: <h3>'.$class_file.'</h3> not found.');\n\t\t}\n\t}\n\n\tpublic function get_model_object()\n\t{\n\t\treturn $this->model_object;\n\t}\n\n\tpublic function set_view_object($module_name)\n\t{\n\t\t$class_file = APP_DIR . 'view' . '/' . $module_name . '.php';\n\n\t\tif (file_exists($class_file))\n\t\t{\n\t\t\tinclude $class_file;\n\n\t\t\t$class_name = ucfirst($module_name) . '_View';\n\n\t\t\tif (class_exists($class_name))\n\t\t\t{\n\t\t\t\t$this->view_object = new $class_name($this->get_page());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdie ('Class: <h3>'.$class_name.'</h3> not found.');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdie ('File: <h3>'.$class_file.'</h3> not found.');\n\t\t}\n\t}\n\n\tpublic function get_view_object()\n\t{\n\t\treturn $this->view_object;\n\t}\n\n\tpublic function set_page($obj)\n\t{\n\t\tinclude CLASS_DIR . 'page.php';\n\n\t\t$this->page = new Page($obj);\n\t}\n\n\tpublic function get_page()\n\t{\n\t\treturn $this->page;\n\t}\n\n\tpublic function set_settings($obj)\n\t{\n\t\tinclude LIB_DIR . 'settings.php';\n\n\t\t$this->settings = new Settings($obj);\n\t}\n\n\tpublic function get_settings()\n\t{\n\t\treturn $this->settings;\n\t}\n\n\tpublic function set_user($obj)\n\t{\n\t\tinclude CLASS_DIR . 'status.php';\n\n\t\t$this->user = new Status($obj);\n\t}\n\n\tpublic function get_user()\n\t{\n\t\treturn $this->user;\n\t}\n\n\tpublic function set_acl($obj)\n\t{\n\t\tinclude CLASS_DIR . 'acl.php';\n\n\t\t$this->acl = new AccessControlList($obj);\n\t}\n\n\tpublic function get_acl()\n\t{\n\t\treturn $this->acl;\n\t}\n\n\tpublic function set_menu($obj)\n\t{\n\t\tinclude CLASS_DIR . 'menu.php';\n\n\t\t$this->menu = new Menu($obj);\n\t}\n\n\tpublic function get_menu()\n\t{\n\t\treturn $this->menu;\n\t}\n}\n\n?>\n", "<?php\n\nclass Roles_View extends View\n{\n\tpublic function __construct($page)\n\t{\n\t\tparent::__construct($page);\n\t}\n\n\tpublic function ShowList($columns, $data)\n\t{\n\t\t$title = 'Role u\u017cytkownik\u00f3w';\n\t\t$image = 'img/32x32/lock_go.png';\n\n\t\t$attribs = array(\n\t\t\tarray('width' => '10%',  'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '15%', 'align' => 'left', 'visible' => '1', 'image' => '1'),\n\t\t\tarray('width' => '20%', 'align' => 'left', 'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'left', 'visible' => '1'),\n\t\t\tarray('width' => '30%', 'align' => 'left', 'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'center', 'visible' => '1'),\n\t\t);\n\t\t\n\t\t$actions = array(\n\t\t\tarray('action' => 'view',   'icon' => 'info.png',  'title' => 'Podgl\u0105d'),\n\t\t\tarray('action' => 'edit',   'icon' => 'edit.png',  'title' => 'Edytuj'),\n\t\t\tarray('action' => 'delete', 'icon' => 'trash.png', 'title' => 'Usu\u0144'),\n\t\t);\n\t\n\t\tforeach ($data as $k => $v)\n\t\t{\n\t\t\tforeach ($v as $key => $value)\n\t\t\t{\n\t\t\t\tif ($key == 'user_login')\n\t\t\t\t{\n\t\t\t\t\tif ($value == $_SESSION['user_login'])\n\t\t\t\t\t{\n\t\t\t\t\t\t$data[$k]['user_login'] = '<b style=\"color: blue;\">' . $data[$k]['user_login'] . '</b>';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinclude GENER_DIR . 'list.php';\n\n\t\t$list_object = new ListBuilder();\n\n\t\t$list_object->init($title, $image, $columns, $data, $this->get_list_params(), $attribs, $actions);\n\n\t\t$result = $list_object->build_list();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowForm($id, $data)\n\t{\n\t\t$users = array();\n\t\t$functions = array();\n\n\t\tforeach ($data as $k => $v) \n\t\t{\n\t\t\tif ($k == 'users')\n\t\t\t{\n\t\t\t\tforeach ($v as $i => $j)\n\t\t\t\t{\n\t\t\t\t\tforeach ($j as $key => $value)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($key == 'id') $user_id = $value;\n\t\t\t\t\t\tif ($key == 'user_login') $user_login = $value;\n\t\t\t\t\t\tif ($key == 'user_name') $user_name = $value;\n\t\t\t\t\t\tif ($key == 'user_surname') $user_surname = $value;\n\t\t\t\t\t}\n\t\t\t\t\tif ($id) // edycja roli\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($user_id == $id)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$users[] = array(\n\t\t\t\t\t\t\t\t'value' => $user_id, 'caption' => $user_name . ' ' . $user_surname . ' (' . $user_login . ')',\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse // nowa rola\n\t\t\t\t\t{\n\t\t\t\t\t\t$users[] = array(\n\t\t\t\t\t\t\t'value' => $user_id, 'caption' => $user_name . ' ' . $user_surname . ' (' . $user_login . ')',\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ($k == 'functions')\n\t\t\t{\n\t\t\t\tforeach ($v as $i => $j)\n\t\t\t\t{\n\t\t\t\t\tforeach ($j as $key => $value)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($key == 'function_id') $function_id = $value;\n\t\t\t\t\t\tif ($key == 'function') $function = $value;\n\t\t\t\t\t\tif ($key == 'meaning') $meaning = $value;\n\t\t\t\t\t\tif ($key == 'module') $module = $value;\n\t\t\t\t\t\tif ($key == 'access') $access = $value;\n\t\t\t\t\t}\n\t\t\t\t\t$chk = $access ? 'checked' : NULL;\n\t\t\t\t\t$functions[] = array(\n\t\t\t\t\t\t'caption' => NULL, \n\t\t\t\t\t\t'data' => array(\n\t\t\t\t\t\t\t'type' => 'checkbox', 'id' => 'function_'.$function_id, 'name' => 'function_'.$function_id, 'label' => $meaning . ' (' . $module . ')', $chk => $chk, 'value' => NULL,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinclude GENER_DIR . 'form.php';\n\n\t\t$form_object = new FormBuilder();\n\n\t\t$form_title = $data ? 'Edycja roli u\u017cytkownika' : 'Nowa rola u\u017cytkownika';\n\t\t$form_image = 'img/32x32/list_edit.png';\n\t\t$form_width = '50%';\n\t\t\n\t\t$form_object->init($form_title, $form_image, $form_width);\n\n\t\t$action = $id ? 'edit&id=' . $id : 'add';\n\n\t\t$form_action = 'index.php?route=' . MODULE_NAME . '&action=' . $action;\n\n\t\t$form_object->set_action($form_action);\n\n\t\t$form_inputs = array(\n\t\t\tarray(\n\t\t\t\t'caption' => 'U\u017cytkownik', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'select', 'id' => 'user_id', 'name' => 'user_id', \n\t\t\t\t\t'option' => $users, \n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Funkcje', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'label', 'value' => NULL,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\tforeach ($functions as $function)\n\t\t{\n\t\t\t$form_inputs[] = $function;\n\t\t}\n\n\t\t$form_object->set_inputs($form_inputs);\n\t\t\n\t\t$form_hiddens = array();\n\t\t\t\n\t\t$form_object->set_hiddens($form_hiddens);\n\n\t\t$form_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'save', 'id' => 'save_button', 'name' => 'save_button', 'value' => 'Zapisz',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'close', 'id' => 'update_button', 'name' => 'update_button', 'value' => 'Zamknij',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Anuluj',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$form_object->set_buttons($form_buttons);\n\n\t\t$result = $form_object->build_form();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowDetails($data)\n\t{\n\t\tinclude GENER_DIR . 'view.php';\n\n\t\t$view_object = new ViewBuilder();\n\n\t\t$view_title = 'Szczeg\u00f3\u0142y roli u\u017cytkownika';\n\t\t$view_image = 'img/32x32/list_information.png';\n\t\t$view_width = '50%';\n\t\t\n\t\t$view_object->init($view_title, $view_image, $view_width);\n\n\t\t$view_action = 'index.php?route=' . MODULE_NAME;\n\n\t\t$view_object->set_action($view_action);\n\n\t\t$view_inputs = array();\n\n\t\tif (is_array($data))\n\t\t{\n\t\t\tforeach ($data as $key => $value) \n\t\t\t{\n\t\t\t\t$view_inputs[] = array('caption' => $key, 'value' => $value);\n\t\t\t}\n\t\t}\n\n\t\t$view_object->set_inputs($view_inputs);\n\t\t\n\t\t$view_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Zamknij',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$view_object->set_buttons($view_buttons);\n\n\t\t$result = $view_object->build_view();\n\n\t\treturn $result;\n\t}\n}\n\n?>\n", "<?php\n\nclass Users_View extends View\n{\n\tpublic function __construct($page)\n\t{\n\t\tparent::__construct($page);\n\t}\n\n\tpublic function ShowList($columns, $data)\n\t{\n\t\t$title = 'U\u017cytkownicy serwisu';\n\t\t$image = 'img/32x32/users_group.png';\n\n\t\t$attribs = array(\n\t\t\tarray('width' => '5%',  'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'left',   'visible' => '1', 'image' => '1'),\n\t\t\tarray('width' => '10%',  'align' => 'left',   'visible' => '0'),\n\t\t\tarray('width' => '10%', 'align' => 'left',   'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'left',   'visible' => '1'),\n\t\t\tarray('width' => '25%', 'align' => 'left', 'visible' => '1'),\n\t\t\tarray('width' => '5%',  'align' => 'left', 'visible' => '1'),\n\t\t\tarray('width' => '10%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '5%', 'align' => 'center', 'visible' => '1'),\n\t\t\tarray('width' => '5%', 'align' => 'center', 'visible' => '0'),\n\t\t\tarray('width' => '5%', 'align' => 'center', 'visible' => '0'),\n\t\t\tarray('width' => '5%',  'align' => 'center', 'visible' => '0'),\n\t\t\tarray('width' => '15%', 'align' => 'center', 'visible' => '1'),\n\t\t);\n\t\t\n\t\t$actions = array(\n\t\t\tarray('action' => 'view',    'icon' => 'info.png',   'title' => 'Podgl\u0105d'),\n\t\t\tarray('action' => 'edit',    'icon' => 'edit.png',   'title' => 'Edytuj'),\n\t\t\tarray('action' => 'setpass', 'icon' => 'access.png', 'title' => 'Has\u0142o'),\n\t\t\tarray('action' => 'delete',  'icon' => 'trash.png',  'title' => 'Usu\u0144'),\n\t\t);\n\t\n\t\t$group_names = array('Guest', 'Adm', 'Opr', 'Usr');\n\n\t\tforeach ($data as $k => $v)\n\t\t{\n\t\t\tforeach ($v as $key => $value)\n\t\t\t{\n\t\t\t\tif ($key == 'id')\n\t\t\t\t{\n\t\t\t\t\tif ($value == $_SESSION['user_id'])\n\t\t\t\t\t{\n\t\t\t\t\t\t$data[$k]['user_login'] = '<b style=\"color: blue;\">' . $data[$k]['user_login'] . '</b>';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ($key == 'status')\n\t\t\t\t{\n\t\t\t\t\t$data[$k][$key] = $group_names[$value];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tinclude GENER_DIR . 'list.php';\n\n\t\t$list_object = new ListBuilder();\n\n\t\t$list_object->init($title, $image, $columns, $data, $this->get_list_params(), $attribs, $actions);\n\n\t\t$result = $list_object->build_list();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowForm($data, $user)\n\t{\n\t\tif ($data) // edycja\n\t\t{\n\t\t\tforeach ($data as $key => $value) \n\t\t\t{\n\t\t\t\tif ($key == 'id') $main_id = $value;\n\t\t\t\tif ($key == 'user_login') $main_user_login = $value;\n\t\t\t\tif ($key == 'user_password') $main_user_password = $value;\n\t\t\t\tif ($key == 'user_name') $main_user_name = $value;\n\t\t\t\tif ($key == 'user_surname') $main_user_surname = $value;\n\t\t\t\tif ($key == 'email') $main_email = $value;\n\t\t\t\tif ($key == 'status') $main_status = $value;\n\t\t\t\tif ($key == 'registered') $main_registered = $value;\n\t\t\t\tif ($key == 'logged_in') $main_logged_in = $value;\n\t\t\t\tif ($key == 'modified') $main_modified = $value;\n\t\t\t\tif ($key == 'logged_out') $main_logged_out = $value;\n\t\t\t\tif ($key == 'active') $main_active = $value;\n\t\t\t}\n\t\t}\n\t\telse // nowa pozycja\n\t\t{\n\t\t\t$main_id = NULL;\n\t\t\t$main_user_login = NULL;\n\t\t\t$main_user_password = NULL;\n\t\t\t$main_user_name = NULL;\n\t\t\t$main_user_surname = NULL;\n\t\t\t$main_email = NULL;\n\t\t\t$main_registered = NULL;\n\t\t\t$main_logged_in = NULL;\n\t\t\t$main_modified = NULL;\n\t\t\t$main_logged_out = NULL;\n\t\t\t$main_status = USER;\n\t\t\t$main_active = 1;\n\t\t}\n\n\t\t$sel = range(0, 4);\n\t\t$sel[$main_status] = 'selected';\n\n\t\t$chk = array(NULL, NULL);\n\t\t$chk[$main_active] = 'checked';\n\n\t\tinclude GENER_DIR . 'form.php';\n\n\t\t$form_object = new FormBuilder();\n\n\t\t$form_title = $data ? 'Edycja u\u017cytkownika' : 'Nowy u\u017cytkownik';\n\t\t$form_image = 'img/32x32/list_edit.png';\n\t\t$form_width = '50%';\n\t\t\n\t\t$form_object->init($form_title, $form_image, $form_width);\n\n\t\t$action = $data ? 'edit&id=' . $main_id : 'add';\n\n\t\t$form_action = 'index.php?route=' . MODULE_NAME . '&action=' . $action;\n\n\t\t$form_object->set_action($form_action);\n\n\t\t$form_inputs = array(\n\t\t\tarray(\n\t\t\t\t'caption' => 'Imi\u0119', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'text', 'id' => 'user_name', 'name' => 'user_name', 'value' => $main_user_name, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Nazwisko', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'text', 'id' => 'user_surname', 'name' => 'user_surname', 'value' => $main_user_surname, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Login', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'text', 'id' => 'user_login', 'name' => 'user_login', 'value' => $main_user_login, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'E-mail', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'email', 'id' => 'email', 'name' => 'email', 'value' => $main_email, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Has\u0142o', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'password', 'id' => 'user_password', 'name' => 'user_password', 'value' => $main_user_password, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Grupa u\u017cytkownik\u00f3w', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'select', 'id' => 'status', 'name' => 'status', \n\t\t\t\t\t'option' => array(\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'value' => '1', 'caption' => 'Administratorzy', $sel[1] => $sel[1],\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'value' => '2', 'caption' => 'Operatorzy', $sel[2] => $sel[2],\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'value' => '3', 'caption' => 'Zarejestrowani', $sel[3] => $sel[3],\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t), \n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => NULL, \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'radio', 'name' => 'active', \n\t\t\t\t\t'items' => array(\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'id' => 'active_yes', 'label' => 'Aktywny', $chk[1] => $chk[1], 'value' => 1,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\tarray(\n\t\t\t\t\t\t\t'id' => 'active_no', 'label' => 'Zablokowany', $chk[0] => $chk[0], 'value' => 0,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\n\t\tif ($data) unset($form_inputs[4]); // wyklucza z listy input\u00f3w pole has\u0142o\n\n\t\tif ($user->get_value('user_status') != ADMIN) unset($form_inputs[5]); // wyklucza z listy input\u00f3w pole profil\n\n\t\t$form_object->set_inputs($form_inputs);\n\t\t\n\t\t$form_hiddens = $user->get_value('user_status') == ADMIN ? array() : array(\n\t\t\t\tarray(\n\t\t\t\t\t'type' => 'hidden', 'id' => 'status', 'name' => 'status', 'value' => $main_status,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\n\t\t$form_object->set_hiddens($form_hiddens);\n\n\t\t$form_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'save', 'id' => 'save_button', 'name' => 'save_button', 'value' => 'Zapisz',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'close', 'id' => 'update_button', 'name' => 'update_button', 'value' => 'Zamknij',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Anuluj',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$form_object->set_buttons($form_buttons);\n\n\t\t$result = $form_object->build_form();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowDetails($data)\n\t{\n\t\tinclude GENER_DIR . 'view.php';\n\n\t\t$view_object = new ViewBuilder();\n\n\t\t$view_title = 'Szczeg\u00f3\u0142y u\u017cytkownika';\n\t\t$view_image = 'img/32x32/list_information.png';\n\t\t$view_width = '50%';\n\t\t\n\t\t$view_object->init($view_title, $view_image, $view_width);\n\n\t\t$view_action = 'index.php?route=' . MODULE_NAME;\n\n\t\t$view_object->set_action($view_action);\n\n\t\t$view_inputs = array();\n\n\t\tif (is_array($data))\n\t\t{\n\t\t\tforeach ($data as $key => $value) \n\t\t\t{\n\t\t\t\tif (in_array($key, array('user_password', 'status', 'active'))) continue;\n\t\t\t\t$view_inputs[] = array('caption' => $key, 'value' => $value);\n\t\t\t}\n\t\t}\n\n\t\t$view_object->set_inputs($view_inputs);\n\t\t\n\t\t$view_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Zamknij',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$view_object->set_buttons($view_buttons);\n\n\t\t$result = $view_object->build_view();\n\n\t\treturn $result;\n\t}\n\n\tpublic function ShowPassword($id)\n\t{\n\t\tinclude GENER_DIR . 'form.php';\n\n\t\t$form_object = new FormBuilder();\n\n\t\t$form_title = 'Nowe has\u0142o';\n\t\t$form_image = 'img/32x32/server_key.png';\n\t\t$form_width = '300px';\n\t\t\n\t\t$form_object->init($form_title, $form_image, $form_width);\n\n\t\t$form_action = 'index.php?route=' . MODULE_NAME . '&action=setpass&id=' . $id;\n\n\t\t$form_object->set_action($form_action);\n\n\t\t$form_inputs = array(\n\t\t\tarray(\n\t\t\t\t'caption' => 'Has\u0142o', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'password', 'id' => 'user_password', 'name' => 'user_password', 'value' => NULL, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'caption' => 'Powt\u00f3rz', \n\t\t\t\t'data' => array(\n\t\t\t\t\t'type' => 'password', 'id' => 'user_password_repeat', 'name' => 'user_password_repeat', 'value' => NULL, 'required' => 'required',\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\n\t\t$form_object->set_inputs($form_inputs);\n\t\t\n\t\t$form_hiddens = array();\n\t\t\t\n\t\t$form_object->set_hiddens($form_hiddens);\n\n\t\t$form_buttons = array(\n\t\t\tarray(\n\t\t\t\t'type' => 'submit', 'id' => 'save_button', 'name' => 'save_button', 'value' => 'Zapisz',\n\t\t\t\t),\n\t\t\tarray(\n\t\t\t\t'type' => 'cancel', 'id' => 'cancel_button', 'name' => 'cancel_button', 'value' => 'Anuluj',\n\t\t\t\t),\n\t\t\t);\n\t\t\n\t\t$form_object->set_buttons($form_buttons);\n\n\t\t$result = $form_object->build_form();\n\n\t\treturn $result;\n\t}\n}\n\n?>"], "filenames": ["application/classes/application.php", "application/core/view/roles.php", "application/core/view/users.php"], "buggy_code_start_loc": [91, 16, 17], "buggy_code_end_loc": [92, 21, 27], "fixing_code_start_loc": [91, 16, 17], "fixing_code_end_loc": [92, 21, 27], "type": "CWE-79", "message": "andrzuk/FineCMS before 2017-03-06 is vulnerable to a reflected XSS in index.php because of missing validation of the action parameter in application/classes/application.php.", "other": {"cve": {"id": "CVE-2017-6511", "sourceIdentifier": "cve@mitre.org", "published": "2017-03-07T19:59:00.143", "lastModified": "2017-03-09T19:00:02.220", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "andrzuk/FineCMS before 2017-03-06 is vulnerable to a reflected XSS in index.php because of missing validation of the action parameter in application/classes/application.php."}, {"lang": "es", "value": "andrzuk/FineCMS en versiones anteriores a 06-03-2017 es vulnerable a un XSS reflejado en index.php debido a una falta de validaci\u00f3n el par\u00e1metro action en application/classes/application.php."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:finecms_project:finecms:*:*:*:*:*:*:*:*", "versionEndIncluding": "2017-02-10", "matchCriteriaId": "8FE716BB-045B-4633-B4FF-D772590A16C3"}]}]}], "references": [{"url": "https://github.com/andrzuk/FineCMS/commit/2c80de96d403d4a2e81ac4c48f358bdffbe85ea0", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/andrzuk/FineCMS/issues/2", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/andrzuk/FineCMS/commit/2c80de96d403d4a2e81ac4c48f358bdffbe85ea0"}}