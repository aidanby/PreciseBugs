{"buggy_code": ["<?php\r\nif(!defined('ABSPATH')){\r\n    exit;//Exit if accessed directly\r\n}\r\n\r\nclass AIOWPSecurity_Blacklist_Menu extends AIOWPSecurity_Admin_Menu\r\n{\r\n    var $menu_page_slug = AIOWPSEC_BLACKLIST_MENU_SLUG;\r\n    \r\n    /* Specify all the tabs of this menu in the following array */\r\n    var $menu_tabs;\r\n\r\n    var $menu_tabs_handler = array(\r\n        'tab1' => 'render_tab1',\r\n        );\r\n    \r\n    function __construct() \r\n    {\r\n        $this->render_menu_page();\r\n    }\r\n    \r\n    function set_menu_tabs() \r\n    {\r\n        $this->menu_tabs = array(\r\n        'tab1' => __('Ban Users', 'all-in-one-wp-security-and-firewall'),\r\n        );\r\n    }\r\n    \r\n    function get_current_tab() \r\n    {\r\n        $tab_keys = array_keys($this->menu_tabs);\r\n        $tab = isset( $_GET['tab'] ) ? sanitize_text_field($_GET['tab']) : $tab_keys[0];\r\n        return $tab;\r\n    }\r\n\r\n    /*\r\n     * Renders our tabs of this menu as nav items\r\n     */\r\n    function render_menu_tabs() \r\n    {\r\n        $current_tab = $this->get_current_tab();\r\n\r\n        echo '<h2 class=\"nav-tab-wrapper\">';\r\n        foreach ( $this->menu_tabs as $tab_key => $tab_caption ) \r\n        {\r\n            $active = $current_tab == $tab_key ? 'nav-tab-active' : '';\r\n            echo '<a class=\"nav-tab ' . $active . '\" href=\"?page=' . $this->menu_page_slug . '&tab=' . $tab_key . '\">' . $tab_caption . '</a>';\t\r\n        }\r\n        echo '</h2>';\r\n    }\r\n    \r\n    /*\r\n     * The menu rendering goes here\r\n     */\r\n    function render_menu_page() \r\n    {\r\n        echo '<div class=\"wrap\">';\r\n        echo '<h2>'.__('Blacklist Manager','all-in-one-wp-security-and-firewall').'</h2>';//Interface title\r\n        $this->set_menu_tabs();\r\n        $tab = $this->get_current_tab();\r\n        $this->render_menu_tabs();\r\n        ?>        \r\n        <div id=\"poststuff\"><div id=\"post-body\">\r\n        <?php \r\n        //$tab_keys = array_keys($this->menu_tabs);\r\n        call_user_func(array(&$this, $this->menu_tabs_handler[$tab]));\r\n        ?>\r\n        </div></div>\r\n        </div><!-- end of wrap -->\r\n        <?php\r\n    }\r\n    \r\n    function render_tab1() \r\n    {\r\n        global $aio_wp_security;\r\n        global $aiowps_feature_mgr;\r\n        $result = 1;\r\n        if (isset($_POST['aiowps_save_blacklist_settings']))\r\n        {\r\n            $nonce=$_REQUEST['_wpnonce'];\r\n            if (!wp_verify_nonce($nonce, 'aiowpsec-blacklist-settings-nonce'))\r\n            {\r\n                $aio_wp_security->debug_logger->log_debug(\"Nonce check failed for save blacklist settings!\",4);\r\n                die(__('Nonce check failed for save blacklist settings!','all-in-one-wp-security-and-firewall'));\r\n            }\r\n            \r\n            if (isset($_POST[\"aiowps_enable_blacklisting\"]) && empty($_POST['aiowps_banned_ip_addresses']) && empty($_POST['aiowps_banned_user_agents']))\r\n            {\r\n                $this->show_msg_error('You must submit at least one IP address or one User Agent value or both!','all-in-one-wp-security-and-firewall');\r\n            }\r\n            else\r\n            {\r\n                if (!empty($_POST['aiowps_banned_ip_addresses']))\r\n                {\r\n                    $ip_addresses = $_POST['aiowps_banned_ip_addresses'];\r\n                    $ip_list_array = AIOWPSecurity_Utility_IP::create_ip_list_array_from_string_with_newline($ip_addresses);\r\n                    $payload = AIOWPSecurity_Utility_IP::validate_ip_list($ip_list_array, 'blacklist');\r\n                    if($payload[0] == 1){\r\n                        //success case\r\n                        $result = 1;\r\n                        $list = $payload[1];\r\n                        $banned_ip_data = implode(PHP_EOL, $list);\r\n                        $aio_wp_security->configs->set_value('aiowps_banned_ip_addresses',$banned_ip_data);\r\n                        $_POST['aiowps_banned_ip_addresses'] = ''; //Clear the post variable for the banned address list\r\n                    }\r\n                    else{\r\n                        $result = -1;\r\n                        $error_msg = $payload[1][0];\r\n                        $this->show_msg_error($error_msg);\r\n                    }\r\n                    \r\n                }\r\n                else\r\n                {\r\n                    $aio_wp_security->configs->set_value('aiowps_banned_ip_addresses',''); //Clear the IP address config value\r\n                }\r\n\r\n                if (!empty($_POST['aiowps_banned_user_agents']))\r\n                {\r\n                    $result = $result * $this->validate_user_agent_list();\r\n                }else{\r\n                    //clear the user agent list\r\n                    $aio_wp_security->configs->set_value('aiowps_banned_user_agents','');\r\n                }\r\n                \r\n                if ($result == 1)\r\n                {\r\n                    $aio_wp_security->configs->set_value('aiowps_enable_blacklisting',isset($_POST[\"aiowps_enable_blacklisting\"])?'1':'');\r\n                    $aio_wp_security->configs->save_config(); //Save the configuration\r\n                    \r\n                    //Recalculate points after the feature status/options have been altered\r\n                    $aiowps_feature_mgr->check_feature_status_and_recalculate_points();\r\n                    \r\n                    $this->show_msg_settings_updated();\r\n\r\n                    $write_result = AIOWPSecurity_Utility_Htaccess::write_to_htaccess(); //now let's write to the .htaccess file\r\n                    if ( !$write_result )\r\n                    {\r\n                        $this->show_msg_error(__('The plugin was unable to write to the .htaccess file. Please edit file manually.','all-in-one-wp-security-and-firewall'));\r\n                        $aio_wp_security->debug_logger->log_debug(\"AIOWPSecurity_Blacklist_Menu - The plugin was unable to write to the .htaccess file.\");\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        ?>\r\n        <h2><?php _e('Ban IPs or User Agents', 'all-in-one-wp-security-and-firewall')?></h2>\r\n        <div class=\"aio_blue_box\">\r\n            <?php\r\n            echo '<p>'.__('The All In One WP Security Blacklist feature gives you the option of banning certain host IP addresses or ranges and also user agents.', 'all-in-one-wp-security-and-firewall').'\r\n            <br />'.__('This feature will deny total site access for users which have IP addresses or user agents matching those which you have configured in the settings below.', 'all-in-one-wp-security-and-firewall').'\r\n            <br />'.__('The plugin achieves this by making appropriate modifications to your .htaccess file.', 'all-in-one-wp-security-and-firewall').'\r\n            <br />'.__('By blocking people via the .htaccess file your are using the most secure first line of defence which denies all access to blacklisted visitors as soon as they hit your hosting server.', 'all-in-one-wp-security-and-firewall').'\r\n            </p>';\r\n            ?>\r\n        </div>\r\n        <div class=\"aio_grey_box\">\r\n            <?php\r\n            $addon_link = '<strong><a href=\"http://www.site-scanners.com/country-blocking-addon/\" target=\"_blank\">'.__('Country Blocking Addon', 'all-in-one-wp-security-and-firewall').'</a></strong>';\r\n            $info_msg = sprintf( __('You may also be interested in our %s.', 'all-in-one-wp-security-and-firewall'), $addon_link);\r\n            $info_msg2 = __('This addon allows you to automatically block IP addresses based on their country of origin.', 'all-in-one-wp-security-and-firewall');\r\n\r\n            echo '<p>'.$info_msg.\r\n                '<br />'.$info_msg2.'</p>';\r\n            ?>\r\n        </div>\r\n\r\n        <div class=\"postbox\">\r\n        <h3 class=\"hndle\"><label for=\"title\"><?php _e('IP Hosts and User Agent Blacklist Settings', 'all-in-one-wp-security-and-firewall'); ?></label></h3>\r\n        <div class=\"inside\">\r\n        <?php\r\n        //Display security info badge\r\n        global $aiowps_feature_mgr;\r\n        $aiowps_feature_mgr->output_feature_details_badge(\"blacklist-manager-ip-user-agent-blacklisting\");\r\n        ?>    \r\n        <form action=\"\" method=\"POST\">\r\n        <?php wp_nonce_field('aiowpsec-blacklist-settings-nonce'); ?>\r\n        <div class=\"aio_orange_box\">\r\n            <p>\r\n            <?php\r\n            $read_link = '<a href=\"https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin#advanced_features_note\" target=\"_blank\">'.__('must read this message', 'all-in-one-wp-security-and-firewall').'</a>';\r\n            echo sprintf(__('This feature can lock you out of admin if it doesn\\'t work correctly on your site. You %s before activating this feature.', 'all-in-one-wp-security-and-firewall'), $read_link);\r\n            ?>\r\n            </p>\r\n        </div>            \r\n        <table class=\"form-table\">\r\n            <tr valign=\"top\">\r\n                <th scope=\"row\"><?php _e('Enable IP or User Agent Blacklisting', 'all-in-one-wp-security-and-firewall')?>:</th>\r\n                <td>\r\n                <input name=\"aiowps_enable_blacklisting\" type=\"checkbox\"<?php if($aio_wp_security->configs->get_value('aiowps_enable_blacklisting')=='1') echo ' checked=\"checked\"'; ?> value=\"1\"/>\r\n                <span class=\"description\"><?php _e('Check this if you want to enable the banning (or blacklisting) of selected IP addresses and/or user agents specified in the settings below', 'all-in-one-wp-security-and-firewall'); ?></span>\r\n                </td>\r\n            </tr>            \r\n            <tr valign=\"top\">\r\n                <th scope=\"row\"><?php _e('Enter IP Addresses:', 'all-in-one-wp-security-and-firewall')?></th>\r\n                <td>\r\n                    <textarea name=\"aiowps_banned_ip_addresses\" rows=\"5\" cols=\"50\"><?php echo ($result == -1)?htmlspecialchars($_POST['aiowps_banned_ip_addresses']):htmlspecialchars($aio_wp_security->configs->get_value('aiowps_banned_ip_addresses')); ?></textarea>\r\n                    <br />\r\n                    <span class=\"description\"><?php _e('Enter one or more IP addresses or IP ranges.','all-in-one-wp-security-and-firewall');?></span>\r\n                    <span class=\"aiowps_more_info_anchor\"><span class=\"aiowps_more_info_toggle_char\">+</span><span class=\"aiowps_more_info_toggle_text\"><?php _e('More Info', 'all-in-one-wp-security-and-firewall'); ?></span></span>\r\n                    <div class=\"aiowps_more_info_body\">\r\n                            <?php \r\n                            echo '<p class=\"description\">'.__('Each IP address must be on a new line.', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('To specify an IP range use a wildcard \"*\" character. Acceptable ways to use wildcards is shown in the examples below:', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('Example 1: 195.47.89.*', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('Example 2: 195.47.*.*', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('Example 3: 195.*.*.*', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            ?>\r\n                    </div>\r\n\r\n                </td>\r\n            </tr>\r\n            <tr valign=\"top\">\r\n                <th scope=\"row\"><?php _e('Enter User Agents:', 'all-in-one-wp-security-and-firewall')?></th>\r\n                <td>\r\n                    <textarea name=\"aiowps_banned_user_agents\" rows=\"5\" cols=\"50\"><?php echo ($result == -1)?$_POST['aiowps_banned_user_agents']:$aio_wp_security->configs->get_value('aiowps_banned_user_agents'); ?></textarea>\r\n                    <br />\r\n                    <span class=\"description\">\r\n                        <?php _e('Enter one or more user agent strings.','all-in-one-wp-security-and-firewall');?></span>\r\n                    <span class=\"aiowps_more_info_anchor\"><span class=\"aiowps_more_info_toggle_char\">+</span><span class=\"aiowps_more_info_toggle_text\"><?php _e('More Info', 'all-in-one-wp-security-and-firewall'); ?></span></span>\r\n                    <div class=\"aiowps_more_info_body\">\r\n                            <?php \r\n                            echo '<p class=\"description\">'.__('Each user agent string must be on a new line.', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('Example 1 - A single user agent string to block:', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">SquigglebotBot</p>';\r\n                            echo '<p class=\"description\">'.__('Example 2 - A list of more than 1 user agent strings to block', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">baiduspider<br />SquigglebotBot<br />SurveyBot<br />VoidEYE<br />webcrawl.net<br />YottaShopping_Bot</p>';\r\n                            ?>\r\n                    </div>\r\n\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <input type=\"submit\" name=\"aiowps_save_blacklist_settings\" value=\"<?php _e('Save Settings', 'all-in-one-wp-security-and-firewall')?>\" class=\"button-primary\" />\r\n        </form>\r\n        </div></div>\r\n        <?php\r\n    }\r\n    \r\n    function validate_user_agent_list()\r\n    {\r\n        global $aio_wp_security;\r\n        @ini_set('auto_detect_line_endings', true);\r\n        //$errors = '';\r\n\r\n        $submitted_agents = explode(PHP_EOL, $_POST['aiowps_banned_user_agents']);\r\n\t$agents = array();\r\n\tif (!empty($submitted_agents)) \r\n        {\r\n            foreach ($submitted_agents as $agent)\r\n            {\r\n                $text = sanitize_text_field($agent);\r\n                $agents[] = $text;\r\n            }\r\n        }\r\n        \r\n        if (sizeof($agents) > 1)\r\n        {\r\n            sort( $agents );\r\n            $agents = array_unique($agents, SORT_STRING);\r\n        }\r\n        \r\n        $banned_user_agent_data = implode(PHP_EOL, $agents);\r\n        $aio_wp_security->configs->set_value('aiowps_banned_user_agents',$banned_user_agent_data);\r\n        $_POST['aiowps_banned_user_agents'] = ''; //Clear the post variable for the banned address list\r\n        return 1;\r\n    }\r\n} //end class", "=== All In One WP Security & Firewall ===\r\nContributors: Tips and Tricks HQ, wpsolutions, Peter Petreski, Ruhul Amin, mbrsolution\r\nDonate link: https://www.tipsandtricks-hq.com\r\nTags: security, secure, Anti Virus, antivirus, ban, ban hacker, virus, firewall, firewall security, login, lockdown, htaccess, hack, malware, vulnerability, protect, protection, phishing, database, backup, plugin, sql injection, ssl, restrict, login captcha, bot, hotlink, 404 detection, admin, rename, all in one, scan, scanner, iframe,\r\nRequires at least: 5.0\r\nTested up to: 5.6\r\nStable tag: 4.4.5\r\nLicense: GPLv3\r\n\r\nA comprehensive, user-friendly, all in one WordPress security and firewall plugin for your site.\r\n\r\n== Privacy Policy ==\r\nThis plugin may collect IP addresses for security reasons such as mitigating brute force login threats and malicious activity.\r\nThe collected information is stored on your server. No information is transmitted to third parties or remote server locations.\r\n\r\n== Description ==\r\n= A COMPREHENSIVE, EASY TO USE, STABLE AND WELL SUPPORTED WORDPRESS SECURITY PLUGIN =\r\n\r\nWordPress itself is a very secure platform. However, it helps to add some extra security and firewall to your site by using a security plugin that enforces a lot of good security practices.\r\n\r\nThe All In One WordPress Security plugin will take your website security to a whole new level.\r\n\r\nThis plugin is designed and written by experts and is easy to use and understand.\r\n\r\nIt reduces security risk by checking for vulnerabilities, and by implementing and enforcing the latest recommended WordPress security practices and techniques.\r\n\r\nhttps://www.youtube.com/watch?v=CJvCTlVtazA\r\n\r\nAll In One WP Security also uses an unprecedented security points grading system to measure how well you are protecting your site based on the security features you have activated.\r\n\r\nOur security and firewall rules are categorized into \"basic\", \"intermediate\" and \"advanced\". This way you can apply the firewall rules progressively without breaking your site's functionality.\r\n\r\nThe All In One WordPress Security plugin doesn't slow down your site and it is 100% free.\r\n\r\nVisit the [WordPress Security Plugin](https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin) page for more details.\r\n\r\nBelow is a list of the security and firewall features offered in this plugin:\r\n\r\n= User Accounts Security =\r\n* Detect if there is a user account which has the default \"admin\" username and easily change the username to a value of your choice.\r\n* The plugin will also detect if you have any WordPress user accounts which have identical login and display names. Having account's where display name is identical to login name is bad security practice because \r\nyou are making it 50% easier for hackers because they already know the login name.\r\n* Password strength tool to allow you to create very strong passwords.\r\n* Stop user enumeration. So users/bots cannot discover user info via author permalink.\r\n\r\n= User Login Security =\r\n* Protect against \"Brute Force Login Attack\" with the Login Lockdown feature. Users with a certain IP address or range will be locked out of the system for a predetermined amount of time based on the configuration settings and you can also choose to be notified \r\nvia email whenever somebody gets locked out due to too many login attempts.\r\n\r\n* As the administrator you can view a list of all locked out users which are displayed in an easily readable and navigable table which also allows you to unlock individual or bulk IP addresses at the click of a button.\r\n* Force logout of all users after a configurable time period\r\n* Monitor/View failed login attempts which show the user's IP address, User ID/Username and Date/Time of the failed login attempt\r\n\r\n* Monitor/View the account activity of all user accounts on your system by keeping track of the username, IP address, login date/time, and logout date/time.\r\n* Ability to automatically lockout IP address ranges which attempt to login with an invalid username.\r\n* Ability to see a list of all the users who are currently logged into your site.\r\n* Allows you to specify one or more IP addresses in a special whitelist. The whitelisted IP addresses will have access to your WP login page.\r\n* Add Google reCaptcha or plain maths captcha to WordPress Login form.\r\n* Add Google reCaptcha or plain maths captcha to the forgot password form of your WP Login system.\r\n\r\n= User Registration Security =\r\n* Enable manual approval of WordPress user accounts. If your site allows people to create their own accounts via the WordPress registration form, then you can minimize SPAM or bogus registrations by manually approving each registration.\r\n* Ability to add Google reCaptcha or plain maths captcha to the WordPress's user registration page to protect you from spam user registration.\r\n* Ability to add Honeypot to the WordPress's user registration form to reduce registration attempts by robots.\r\n\r\n= Database Security =\r\n* Easily set the default WP prefix to a value of your choice with the click of a button.\r\n* Schedule automatic backups and email notifications or make an instant DB backup whenever you want with one click.\r\n\r\n= File System Security =\r\n* Identify files or folders which have permission settings which are not secure and set the permissions to the recommend secure values with click of a button.\r\n* Protect your PHP code by disabling file editing from the WordPress administration area.\r\n* Easily view and monitor all host system logs from a single menu page and stay informed of any issues or problems occurring on your server so you can address them quickly.\r\n* Prevent people from accessing the readme.html, license.txt and wp-config-sample.php files of your WordPress site.\r\n\r\n= htaccess and wp-config.php File Backup and Restore =\r\n* Easily backup your original .htaccess and wp-config.php files in case you will need to use them to restore broken functionality.\r\n* Modify the contents of the currently active .htaccess or wp-config.php files from the admin dashboard with only a few clicks\r\n\r\n= Blacklist Functionality =\r\n* Ban users by specifying IP addresses or use a wild card to specify IP ranges.\r\n* Ban users by specifying user agents.\r\n\r\n= Firewall Functionality =\r\n\r\nThis plugin allows you to easily add a lot of firewall protection to your site via htaccess file. An htaccess file is processed by your web server before any other code on your site. \r\nSo these firewall rules will stop malicious script(s) before it gets a chance to reach the WordPress code on your site.\r\n\r\n* Access control facility.\r\n* Instantly activate a selection of firewall settings ranging from basic, intermediate and advanced.\r\n* Enable the famous \"6G Blacklist\" Firewall rules courtesy of [Perishable Press](http://perishablepress.com/)\r\n* Forbid proxy comment posting.\r\n* Block access to debug log file.\r\n* Disable trace and track.\r\n* Deny bad or malicious query strings.\r\n* Protect against Cross Site Scripting (XSS) by activating the comprehensive advanced character string filter.\r\nor malicious bots who do not have a special cookie in their browser. You (the site admin) will know how to set this special cookie and be able to log into your site.\r\n* WordPress PingBack Vulnerability Protection feature. This firewall feature allows the user to prohibit access to the xmlrpc.php file in order to protect against certain vulnerabilities in the pingback functionality. This is also helpful to block bots from constantly accessing the xmlrpc.php file and wasting your server resource.\r\n* Ability to block fake Googlebots from crawling your site.\r\n* Ability to prevent image hotlinking. Use this to prevent others from hotlinking your images.\r\n* Ability to log all 404 events on your site. You can also choose to automatically block IP addresses that are hitting too many 404s.\r\n* Ability to add custom rules to block access to various resources of your site.\r\n\r\n= Brute force login attack prevention =\r\n* Instantly block Brute Force Login Attacks via our special Cookie-Based Brute Force Login Prevention feature. This firewall functionality will block all login attempts from people and bots.\r\n* Ability to add a simple math captcha to the WordPress login form to fight against brute force login attacks.\r\n* Ability to hide admin login page. Rename your WordPress login page URL so that bots and hackers cannot access your real WordPress login URL. This feature allows you to change the default login page (wp-login.php) to something you configure.\r\n* Ability to use Login Honeypot which will helps reduce brute force login attempts by robots.\r\n\r\n= Security Scanner =\r\n* The file change detection scanner can alert you if any files have changed in your WordPress system. You can then investigate and see if that was a legitimate change or some bad code was injected.\r\n\r\n= Comment SPAM Security =\r\n* Monitor the most active IP addresses which persistently produce the most SPAM comments and instantly block them with the click of a button.\r\n* Prevent comments from being submitted if it doesn't originate from your domain (this should reduce some SPAM bot comment posting on your site).\r\n* Add a captcha to your wordpress comment form to add security against comment spam.\r\n* Automatically and permanently block IP addresses which have exceeded a certain number of comments labeled as SPAM.\r\n\r\n= Front-end Text Copy Protection =\r\n* Ability to disable the right click, text selection and copy option for your front-end.\r\n\r\n= Regular updates and additions of new security features =\r\n* WordPress Security is something that evolves over time. We will be updating the All In One WP Security plugin with new security features (and fixes if required) on a regular basis so you can rest assured that your site will be on the cutting edge of security protection techniques.\r\n\r\n= Works with Most Popular WordPress Plugins =\r\n* It should work smoothly with most popular WordPress plugins.\r\n\r\n= Additional Features =\r\n* Ability to remove the WordPress Generator Meta information from the HTML source of your site.\r\n* Ability to remove the WordPress Version information from the JS and CSS file includes of your site.\r\n* Ability to prevent people from accessing the readme.html, license.txt and wp-config-sample.php files\r\n* Ability to temporarily lock down the front end of your site from general visitors while you do various backend tasks (investigate security attacks, perform site upgrades, do maintenance work etc.)\r\n* Ability to export/import the security settings.\r\n* Prevent other sites from displaying your content via a frame or iframe.\r\n\r\n= Plugin Support =\r\n* If you have a question or problem with the All In One Security plugin, post it on the support forum and we will help you.\r\n\r\n= Developers =\r\n* If you are a developer and you need some extra hooks or filters for this plugin then let us know.\r\n* Github repository - https://github.com/Arsenal21/all-in-one-wordpress-security\r\n\r\n= Translations =\r\n* All In One WP Security plugin can be translated to any language. \r\n\r\nCurrently available translations:\r\n\r\n- English\r\n- German\r\n- Spanish\r\n- French\r\n- Hungarian\r\n- Italian\r\n- Swedish\r\n- Russian\r\n- Chinese\r\n- Portuguese (Brazil)\r\n- Persian\r\n\r\nVisit the [WordPress Security Plugin](https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin) page for more details.\r\n\r\n== Installation ==\r\n\r\nTo begin making your WordPress site more secure:\r\n\r\n1. Upload the 'all-in-one-wp-security.zip' file from the Plugins->Add New page in the WordPress administration panel.\r\n2. Activate the plugin through the 'Plugins' menu in WordPress\r\n3. Go to Settings menu under 'WP Security' and start activating the security features of the plugin.\r\n\r\n== Usage ==\r\n\r\nGo to the settings menu after you activate the plugin and follow the instructions.\r\n\r\n== Screenshots ==\r\nCheck the following page for screenshots:\r\nhttps://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin\r\n\r\n== Frequently Asked Questions ==\r\nCheck the following page for F.A.Q (see the faq section):\r\nhttps://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin\r\n\r\n== Upgrade Notice ==\r\nNone\r\n\r\n== Changelog ==\r\n\r\n= 4.4.5 =\r\n- Fixed default DateTime to prevent DB error.\r\n- Added Korean language translation files. Thanks to Jonghyun Cho.\r\n- Reworked the code for the \"Generate New DB Table Prefix\" feature to make it more robust. Thanks to @baddiedev.\r\n- Added translation ability to some strings.  \r\n\r\n= 4.4.4 =\r\n- Fixed bugs and improved functionality related to \"logged in users\" functionality.\r\n- Google recaptha checks for WooCommerce product reviews\r\n- Replaced use of deprecated hook \"wpmu_new_blog\" with \"wp_insert_site\"\r\n- Fixed a potential XSS issue in the settings menu of the plugin for IE11 or older browsers.\r\n\r\n= 4.4.3 =\r\n- Improved file change detection feature to address DB backups failing silently in some cases due to very large serialized data stored in a single row.\r\n- Added new action hook (aiowps_rename_login_load) just before renamed login page is loaded.\r\n- Added a check to ensure that woocommerce captcha settings are displayed only if woocommerce plugin is installed/active.\r\n- Fixed recaptcha bugs.\r\n- Added configurable item for max file upload size in basic firewall rules.\r\n\r\n= 4.4.2 =\r\n- Fixed vulnerability related to open redirect and exposure of hidden login page for specific case. (Thanks to Erwan (wpscanteam) for letting us know)\r\n\r\n= 4.4.1 =\r\n- Fixed bug where Apache directives were not being re-added into the .htaccess file after plugin re-activation.\r\n- Fixed bug related to account activity logout date not being set.\r\n\r\n= 4.4.0 =\r\n- Added robustness to login lockdown feature by replacing the strtotime function with DateTime/DateInterval. \r\nThis should prevent 32-bit systems from being constrained to the max date of 19 Jan 2038.\r\n- Fixed bugs related to captcha features.\r\n- Fixed and improved \"Logged In Users\" functionality for multisite.\r\n- Always set valid dates, to avoid errors when strict mode is enabled on mysql. Thanks to Davide.\r\n\r\n= 4.3.9.4 =\r\n- Removed whois feature because it adds relatively little value and the third-party library used is not being maintained regularly.\r\n- Fixed \"headers already sent\" error when bulk action performed using aiowps list table.\r\n\r\n= 4.3.9.3 =\r\n- Fixed another captcha bug related to comment form.\r\n\r\n= 4.3.9.2 =\r\n- Fixed various captcha bugs: woocommerce lost password page, custom login form page, etc\r\n\r\n= 4.3.9.1 =\r\n- Fixed rename login page feature bug introduced after WP core change in version 5.2.\r\n\r\n= 4.3.9 =\r\n- Fixed captcha bug.\r\n- Fixed PHP_EOL issue where some IPv6 and v4 addresses saved in settings were incorrectly deemed invalid.\r\n- Tightened file permission for wp-config.php to \"640\"\r\n- Fixed DB prefix change bug for cases where DB had tables of type \"view\".\r\n- Fixed some translation string issues.\r\n- Minor style fix for wp list table pagination nav buttons.\r\n\r\n= 4.3.8.3 =\r\n- Trying again - Fixed login captcha authentication bug.\r\n\r\n= 4.3.8.2 =\r\n- Fixed login captcha authentication bug.\r\n\r\n= 4.3.8.1 =\r\n- Minor bug fix - added missing check to enqueue recaptcha script only if that feature is enabled.\r\n\r\n= 4.3.8 =\r\n- Added ability to hide secret rename login page link when sending emails to people asking for personal data export.\r\n- Fixed Google reCaptcha not showing on comment page.\r\n- Fixed activation handler and creation of DB tables to handle multi-site activations more robustly.\r\n- Improved reCaptcha code to prevent the occasional occurrence of \"Uncaught Error: reCAPTCHA placeholder element must be an element or id\" error.\r\n- Added extra check for PHP_OS value to prevent Apple \"DARWIN\" being interpreted as windows server.\r\n- Corrected some minor translation issues on rename login page.\r\n- Increased priority of authenticate hook for captcha check.\r\n- Updated the Dutch Language file.\r\n\r\n= 4.3.7.2 =\r\n- More \"get_home_path\" fatal error preventions.\r\n\r\n= 4.3.7.1 =\r\n- Fixed fatal error regarding \"get_home_path\" function.\r\n\r\n\r\n= 4.3.7 =\r\n- Added Google reCaptcha feature for login forms.\r\n- Improved code which checks if site is main for multi-site installations.\r\n- Removed the text domain string from the translation functions in the wp-security-rename-login-feature.php file.\r\n- Changed .htaccess path location to use get_home_path().\r\n- Fixed minor woocommerce captcha bug\r\n\r\n= 4.3.6 =\r\n- Added new tab called \"WP REST API\" in the Miscellaneous menu and created separate feature which disables unauthorized REST access for non-logged in users independent of the users enumeration feature.\r\n- Improved dashboard page widget area display.\r\n- Small translation string fix in the rename login page feature.\r\n\r\n= 4.3.5 =\r\n- Fix - Error: Call to undefined function the_privacy_policy_link() in older versions of WordPress.\r\n- Added a check to disable file change detection feature and prevent fatal errors when FilesystemIterator is not available due to old versions of PHP.\r\n- Improved get_login_fail_count method in the AIOWPSecurity_User_Login class which will fix cases where login lockdown \r\nwas not working on some servers due to timestamp difference between PHP current_time( 'mysql' ) and mysql now().\r\n\r\n= 4.3.4 =\r\n- Modified rename login page to handle GDPR Export/Erase Personal Data request.\r\n- Fixed woocommerce registration page captcha bug.\r\n- Improved users enumeration so that authenticated requests to the REST API are allowed but others are blocked.\r\n- Improved logic in Renamed Login Page settings such that unnecessary call of AIOWPSecurity_Utility_Htaccess::write_to_htaccess() function is avoided.\r\n\r\n= 4.3.3.1 =\r\n- Fixed a typo with the newly added action hook - aiowps_before_wp_die_renamed_login\r\n\r\n= 4.3.3 =\r\n- Fixed bug - aiowps will now allow access to admin-post.php from front-end when rename login feature is active.\r\n- Modified login lockdown feature so that the exact IP address is locked down and not the IP range.\r\n- Added new filter (aiowps_ip_blocked_output_page) which allows user to filter the complete output when someone's IP has been locked out.\r\n- Added new action hook (aiopws_before_wp_die_renamed_login) for the renamed login feature which fires just before the wp_die event which produces the \"Not available\" behaviour.\r\n- Removed unused code.\r\n- Modified get_user_ip_address to get the first IP address in cases where there are multiple comma separated addresses provided - example X-Forwarded-For.\r\n\r\n= 4.3.2 =\r\n- Added new IP address settings page which user the ability to configure which $_SERVER global the IP address will be retrieved from. (New setting found in WP Security >> Settings >> Advanced Settings)\r\n- Fixed bug in .htaccess rules caused when 6G and IP blacklist firewall rules were simultaneously enabled.\r\n- Fixed bug where captcha answer was being ignored on woocommerce login page.\r\n- Added support for unlock requests made from woocomerce account login page when rename login feature is active.\r\n- Added useful debug code for troubleshooting in the fake googlebot function.\r\n- Some general code cleanup and improvement.\r\n- Added code to prevent direct access data leaks.\r\n- Added captcha settings for BBPress new topic form.\r\n- Fixed minor bug in dashboard page when checking if htaccess rules applied.\r\n- Added a check for Windows server installation in File Permissions feature - this feature is not applicable for Windows servers.\r\n- Added check to display comment captcha only when user not logged in.\r\n\r\n= 4.3.1 =\r\n- Improved white list directives to cater for Apache 2.4 and earlier versions.\r\n- Added 3 filters for the manual account registration approval email: aiowps_register_approval_email_subject, aiowps_register_approval_email_msg, aiowps_register_approval_email_from_name\r\n- Added configuration option to allow custom firewall rules to be applied at beginning of all rules applied by aiowps.\r\n- Changed record insertions to DB table aiowps_failed_logins to store the full IP address instead of IP range.\r\n\r\n= 4.3.0 =\r\n- Updated wp-security-rename-login-feature.php to include latest WordPress core changes.\r\n- Added captcha for woocommerce login and registration forms.\r\n- Fixed \"mixed line endings\" warnings for whois library.\r\n- Moved DB cleanup task cron job from daily to hourly.\r\n- Updated the reapply htaccess function so it doesn't create the header already sent error.\r\n\r\n= 4.2.9 =\r\n- Changed the parameter in current_user_can function to use an administrator capability instead of the \"administrator\" role name.\r\n- Added some new hooks to the AIOWPSecurity_WP_Loaded_Tasks called aiowps_wp_loaded_tasks_start and aiowps_wp_loaded_tasks_end.\r\n- Improved get_locked_ips() function and added $wpdb->prepare statement.\r\n- Added more missing translation domain parameters for translatable strings in the rename login page.\r\n- Deleted local copy of the Persian and Italian language files. These translations are available on translate.wordpress.org.\r\n- Domain path and text domain added to plugin header.\r\n- Changed the get_user_ip_address functions so that $_SERVER['REMOTE_ADDR'] is the primary method used to obtain IP address.\r\n- Added enumeration block via REST API (wp >= 4.7)\r\n\r\n= 4.2.8 =\r\n- Improved \"User Registration\" feature to bypass the pending approval status for new users created in admin side.\r\n- Fixed bug in whois library.\r\n- Added translation domain parameter for translatable strings in the rename login page.\r\n- Updated the chinese language file.\r\n\r\n= 4.2.7 =\r\n- The PHPWhois library updated to their latest version to include a security patch.\r\n\r\n= 4.2.6 =\r\n- Added new Login Lockdown whitelist feature which allows immunity for IP address or ranges from being locked by the lockdown feature.\r\n- Fixed bug - Replaced date_i18n with current_time to prevent cases where some localizations produce foreign characters in date stamp output.\r\n- Added a new feature to add Honeypot to the WordPress's user registration form (this can help reduce registration attempts by robots).\r\n- Added \"Export to CSV\" buttons for 404 Event Logs, Account Activity Logs and Failed Login Records.\r\n- Minor update to 6G rules.\r\n- Minor spelling and wording fixes and changes.\r\n\r\n= 4.2.5 =\r\n- Fixed bug - added code which caters for mysql view definitions when DB prefix is changed.\r\n- Fixed a typo in the user login security menu.\r\n- Fixed storage of time stamp in lockdown table to match the local Wordpress server time and be consistent with the timestamp stored in the failed logins table.\r\n- Prevent direct access to wp-security-core.php\r\n- Updated the POT file.\r\n\r\n= 4.2.4 =\r\n- Fix error on block_ip_if_locked(), doesn't exit with a wp_user. This is needed for other plugins that create the $user (aka ldap auth plugins).\r\n- Fix login error message for users with pending account approval.\r\n- Wordpress 4.7 compatibility.\r\n\r\n= 4.2.3 =\r\n- Fixed bug when math captcha was displayed on Woocommerce registration page.\r\n- Fixed login page bug for cases where email address and captcha are used to submit login form (thanks to @chesio for fix).\r\n- Logs directory now contains a .htaccess file with proper deny directives.\r\n- Small UX improvement: add for attribute to captcha label.\r\n- Added check for IIS server in get_server_type function.\r\n\r\n= 4.2.2 =\r\n- Debug logger class improvements.\r\n- Added a message in the debug settings area to state that the log files are reset on every plugin update.\r\n- Always return an array from scan_dir_sort_date() to prevent PHP notices.\r\n- Improvements for Automated DB backups filling up space - old backup file will be deleted first.\r\n- Thanks to RIPS Analyzer for sending us the vulnerability report. \r\n\r\n= 4.2.1 = \r\n- Improve output of .htaccess to include <IfModule mod_rewrite.c> checks and RewriteEngine On directives.\r\n- Fall back to default DB backup interval in case of invalid value.\r\n- The aiowps_delete_backup_files() function will produce a debug log message on every call (to help with troubleshooting when needed).\r\n\r\n= 4.2.0 =\r\n- WPML plugin compatibility fix for the renamed admin login page feature.\r\n- Fixed a few potential XSS vulnerabilities.\r\n\r\n= 4.1.9 =\r\n- Small improvement to the new \"immediate blocking of specific usernames\" feature.\r\n\r\n= 4.1.8 =\r\n- New feature to allow immediate blocking of specific usernames.\r\n- Only activate copy (right-click) protection for non-admin users.\r\n- Fixed bug where logout link in admin bar does not get updated on after the $_POST submit to reflect the new rename login setting.\r\n- Fixed small bug in return_regularized_url function.\r\n- Improvement/bug fix: When currently logged in user attempts to access renamed login page, redirect them to dashboard.\r\n- Removed Spanish language files so they can be automatically pulled from WordPress.org.\r\n- Drop unnecessary WHERE clause in some backend listings.\r\n- Improvement: do not schedule a cronjob, if it is already scheduled.\r\n\r\n= 4.1.7 =\r\n- Added sanitisation for log file data in textarea.\r\n- Disabled autocomplete for Captcha field.\r\n\r\n= 4.1.6 =\r\n- Added cleanup code for captcha string info transients.\r\n- Minor change to the username label in the renamed login page to keep it inline with the standard WordPress login page.\r\n- Fixed a potential vulnerability when viewing AIOWPS log files in the Dashboard menu. Thanks to Manuel LLOP for pointing this out.\r\n\r\n= 4.1.5 =\r\n- Fixed bug where username is an email and captcha was being ignored.\r\n- Reduce memory footprint of database backup.\r\n- Improvements: Make hard-coded strings localizable.\r\n- Partial Apache 2.3 compatibility.\r\n- Improved: Hide WP version number by replacing it with a hash. This way, WordPress version number is not exposed, but browser caching is not obscured by missing version numbers.\r\n\r\n= 4.1.4 =\r\n- Improved and tweaked the login captcha feature to avoid some issues people had with the last modification.\r\n- Deleted reference to ini_get('safe_mode') to avoid fatal errors for newer versions of PHP where that setting has been totally removed.\r\n\r\n= 4.1.3 =\r\n- Added new checkbox for XMLRPC to disable only pingback methods but leave other XMLRPC functionality accessible. This will be useful for people who use Jetpack or Wordpress iOS or other apps.\r\n- Updated the French language file.\r\n- Fix: decbin doesn't add leading zero. Comparing empty strings return bad results.\r\n- Fix: bugfix in the login captcha. Thanks to Sipke Mellema for pointing it out.\r\n\r\n= 4.1.2 =\r\n- Fixed bug introduced by last file change scanner code changes.\r\n- Fixed bug in SPAM comment blocking functionality.\r\n- Fixed fatal error case when Divi theme and front end lockout is enabled.\r\n\r\n= 4.1.1 =\r\n- Fixed Fatal error conflict between Rename Login feature and Yoast SEO and some themes when attempting to access wp-admin page directly.\r\n- Added \"Pending Approval\" message when manual registration approval feature is enabled and a user registers.\r\n- Fix (minor): No need to use strcmp to compare integer values.\r\n- Updated and simplified wp-security-stop-users-enumeration.php for bug (thanks to @davidegiunchidiennea)\r\n- Minor code cleanup (Thanks to @chesio for the following changes).\r\n- File scanner codebase cleanup.\r\n- Fix: properly report invalid email addresses in file scanner configuration.\r\n- Code clean-up in AIOWPSecurity_Scan::do_file_change_scan() method.\r\n- Tweak: Compare file scan data faster.\r\n\r\n= 4.1.0 =\r\n- Fixed bug in Maintenance menu page when trying to attach a media file to the message text box.\r\n- Added a new filter (called \"aiowps_ip_blocked_error_msg\") which allows the modification of the error message displayed on the login page when an IP address has been blocked by the login lockdown feature.\r\n- Updated French language translation. Thanks to Claude Ribaux for providing the translation files.\r\n- Thanks to @chesio for making the following two changes.\r\n- Replaced deprecated call to get_currentuserinfo() function.\r\n- Minor code fixes in the backup class file.\r\n- Fix: display correct (error) message when write_to_htaccess() fails.\r\n- Tweak: database backup filename is more human-readable. \r\n  Before: 24x7eg8l6i-database-backup-1463042767.zip\r\n  After: database-backup-20160512-104607-24x7eg8l6i.zip\r\n\r\n= 4.0.9 =\r\n- Made file change scanner code more robust for cases when open_basedir restriction is in effect. (Thanks to Manuel Jeanne for pointing this out).\r\n- Added code which will remove WordPress version info during CSS and JS script loading if you have the \"Remove WP Generator Meta Info\" option checked. (Thanks to aldemarcalazans for pointing this out).\r\n- Fixed some potential SQL injection vulnerabilities. (Thanks to Julio Potier for pointing these out).\r\n- Changed the feature category of blacklist manger from \"Intermediate\" to \"Advanced\".\r\n- Tweak: Remove \"@\" from list of characters blocked by advanced character string filter. (Because it is often used in retina-ready images).\r\n- Fix: Use home URL instead of site URL in lock notification email subject. Thanks to @chesio for fixing this.\r\n\r\n= 4.0.8 =\r\n- Added ability to identify IP addresses during user registration and option to block selected IPs.\r\n- Added login form captcha functionality for sub-sites in a multi-site installation. (see the Brute Force menu)\r\n- Fixed multi-site bug related to manual user-chosen DB prefix change.\r\n- Added extra XSS protection inside admin menu pages for the \"tab\" query parameter.\r\n- Added a note to the features that has the potential to lock you out if it doesn't work correctly on your site.\r\n- Updated Brazil-Portuguese language file.\r\n- Fixed issue with firewall custom rules being corrupted by magic quotes. Thanks to @chesio for fixing this.\r\n\r\n= 4.0.7 =\r\n- Added a new action hook \"aiopws_before_set_404\" which triggers just before the AIOWPS sets a 404. (handy for cases when rename login page is used which affects some themes when accessing \"wp-admin\" directly)\r\n- Fixed some potential SQL injection vulnerabilities.\r\n- Thanks to @chesio for submitting the following changes and applying the fixes.\r\n- Sub-directory install fixes.\r\n- Improve behavior of WP File Access tab. \r\n- Fix invalid nesting of HTML elements.\r\n- Do not block HTTP requests that contain \"tag=\" in query string.\r\n- Option to enable the 6G firewall.\r\n\r\n= 4.0.6 =\r\n- Removed the viewing of contents of wp-config.php and .htaccess files in order to protect sensitive info.\r\n- Fixed more potential XSS vulnerabilities in some other settings pages. (Once again many thanks to Erin Germ for pointing these out)\r\n\r\n= 4.0.5 =\r\n- Fixed some potential XSS vulnerability in the blacklist, file system and file change detection settings pages. (Many thanks to Erin Germ for pointing these out)\r\n\r\n= 4.0.4 =\r\n- Added new feature: Auto Block Spammer IPs. This feature will automatically and permanently block IP addresses which are linked to comment SPAM. (see SPAM Prevention -> Comment SPAM IP Monitoring tab)\r\n- Added compatibility fix for the qTranslate-X plugin in the rename login page feature.\r\n- Added ability to send to more than one email address for file change detection feature notification.\r\n- Fixed bug in whois library when searching ARIN registry.\r\n- Fixed the handling of display of longer IPV6 strings in dashboard summary table.\r\n- Added hook for WooCommerce login form to display unlock button.\r\n- Added Dutch language translation. Thanks to Jeroen van der Linde for providing the translation files.\r\n- Typo fix in the \"stop users enumeration\" feature.\r\n\r\n= 4.0.3 =\r\n- Added urlencode to query strings in URLs to prevent unexpected behaviour. Thanks to @chesio for spotting the issue.\r\n- Added new feature to stop users enumeration. Thanks to Davide Giunchi @davidegiunchidiennea for adding this.\r\n- Added a more robust code for check_user_exists function. Thanks to Christian Carey.\r\n- Added cron cleanup of the global meta table.\r\n- Added a title in each of the admin interface menu.\r\n\r\n= 4.0.2 =\r\n- Added ability to enable/disable debug from the settings menu.\r\n- Fixed bug related to using IP ranges in the whitelist settings.\r\n- Added IPv6 support for the whitelist feature.\r\n- Added check in file permissions feature for cases where wp-config.php may be located outside of root.\r\n- Added wp cron DB cleanup events for various tables which may grow large over time.\r\n- Changed firewall rule for proxy comment prevention to reflect suggestion made by Thomas O. in forum (https://wordpress.org/support/topic/high-server-cpu-with-proxy-login)\r\n- Fixed CSS styling issue in admin pages for WordPrss 4.4\r\n\r\n= 4.0.1 =\r\n- Renamed the language files to match the new textdomain slug to fix the language translation bug.\r\n- Fixed bug related to the rename login feature and force logout or logout expiry events.\r\n- Applied fix for log being generated by events table DB insert.\r\n- Corrected a function call to static version of display error msg.\r\n\r\n= 4.0.0 =\r\n- Updated text domain to match expected value for translate.wordpress.org translation system.\r\n- Fixed bug related to multi-site user_roles not being updated for child sites.\r\n- Fixed minor bug in rename login feature.\r\n- Updated the Italian language file. \r\n\r\n= 3.9.9 =\r\n- Fixed an issue with the rename login page feature for WordPress 4.3\r\n- Added esc_attr() sanitization to some of the relevant parameters\r\n- Added the necessary changes to allow activation via wp-cli\r\n\r\n= 3.9.8 =\r\n- Added guard against possible XSS in the unlock request feature.\r\n\r\n= 3.9.7 =\r\n- Added new feature which allows custom .htaccess rules. (See \"Custom Rules\" tab in Firewall menu). You can now use this to add custom rules to block access to various resources on your site.\r\n- Added a new feature to block access to the wp-content/debug.log file (WordPress creates this file if you enabled debug loggin option in the config file).\r\n- Removed the \"v\" from version number of the plugin.\r\n- Completed testing with WordPress 4.3.\r\n\r\n= 3.9.6 =\r\n- Added Rename Login page feature from the \"Brute Force\" menu to multisite sub-sites.\r\n- Removed invalid \"length\" attribute from input element in captcha code.\r\n- Fixed reset password feature whereby the URL which is sent out in the email for cases when rename login feature is enabled was not decoded properly.\r\n- Corrected the check for boolean false if returned from wpdb query result.\r\n- Added media button for wp editor in maintenance settings page.\r\n\r\n= 3.9.5 =\r\n- Fixed minor bug - IP addresses blocked due to '404' were not being listed in the display table.\r\n- Updated the Russian language translation file.\r\n- The automatic database table prefix generation value will use a-z characters only.\r\n- Added esc_url sanitization to the add_query_arg/remove_query_arg function instances to prevent possible XSS.\r\n\r\n= 3.9.4 =\r\n- The sort order and orderby parameters now use a whitelisting approach for sanitization.\r\n\r\n= 3.9.3 =\r\n- Fixed the sort order not working in the 404 error logging and account activity page.\r\n\r\n= 3.9.2 =\r\n- Added a check for registration captcha feature to prevent errors when using another captcha plugin. \r\n- Improved a few SQL statements.\r\n\r\n= 3.9.1 =\r\n- Added new \"Force Logout\" feature which will instantly force a certain user to be logged out of their session. (See the \"Logged In Users\" tab in User Login menu)\r\n- Added more security protection for aiowps log files by creating .htaccess file and rules. AIOWPS log files can now only be viewed via dashboard menu, in new tab called \"AIOWPS Logs\". (NOTE:This security currently applies only for apache or similar servers)\r\n- Added backticks to SQL statement for DB prefix change to help prevent errors.\r\n- Added protection against possible SQL injection attacks.\r\n\r\n= 3.9.0 =\r\n- Added some robustness to the file-scan code.\r\n- Added extra security to all relevant list table instances to prevent unlikely malicious deletion commands.\r\n- Fixed the user agent part of the blacklist settings code to allow user-agents to be cleared upon saving.\r\n\r\n= 3.8.9 =\r\n- Fixed bug in the new feature which allows permanent blocking of IP addresses that create 404 events.\r\n- Fixed minor bug for all instances where wpdb \"prepare\" was being used with order/orderby parameters.\r\n- Fixed a possible open redirect vulnerability. Thanks to Sucuri for pointing it out.\r\n\r\n= 3.8.8 =\r\n- Added extra robustness and security for wp list table db commands by using wpdb \"prepare\" command.\r\n- Fixed minor bug with undeclared variable in rename login feature page.\r\n\r\n= 3.8.7 =\r\n- Added an improvement for login lockdown feature - locked IP addresses will no longer be allowed to register.\r\n- Added a \"view\" link for each account in the pending registration approval table list.\r\n- Fixed 404 logging/lockout bug.\r\n- Added ability to permanently block IP addresses from the 404 event list for both bulk and single cases.\r\n- Added ability to do bulk temp blocking for IP addresses in 404 list.\r\n- Fixed a minor bug with validate_ip_list function.\r\n\r\n= 3.8.6 =\r\n- DB cleanup cron event bug fixed.\r\n- Added Swedish language translation. The translation was submitted by Tor-Bj\u00f6rn Fjellner.\r\n- Updated the Russian language translation file. Update submitted by Tor-Bj\u00f6rn Fjellner.\r\n- The events table will automatically be cleaned up so it only keeps the last 5000 entries. You can override it using a filter (if you wanted to).\r\n\r\n= 3.8.5 =\r\n- Added functionality to prevent the aiowps_events table from getting too large.\r\n- Added file change scan summary inside the alert email.\r\n- Fixed the unlock feature so that it works correctly when the Rename Login Page feature is active.\r\n- Added a check in the list logged in users file to prevent error when get_transient returns false.\r\n\r\n= 3.8.4 = \r\n- Updated POT language file.\r\n- Tweaked the function which retrieves the IP address to handle cases where traffic is coming from cloudflare\r\n- The MySQL database will not be forced anymore at the time of creating the table. It also reads the characters set value from the system first.\r\n- Applied fixes to prevent remotely exploitable vulnerabilities.\r\n\r\n= 3.8.3 = \r\n- Modified \"Pingback Protection\" .htaccess rules to prevent xmlrpc login attacks and to be compatible with more servers.\r\n- Made improvements to ensure that the rename login and white list features can be used together.\r\n- Added a check to force user to enter alphanumeric string for renamed login slug.\r\n- Improved the turn_off_all_firewall_rules() and turn_off_all_security_features() functions so that they also handle the updating of the htaccess file.\r\n- Added an alternative way to import settings via a text box (Thanks to Dave McHale). This is for people who might have issues using the config settings file uploader. \r\n- Added fix to properly update options tables when changing DB prefix in multisite system.\r\n- Greatly improved the Renamed Login Page feature by removing various potential vulnerabilities.\r\n- Added an if statement check to fix bug with rename login page feature - special case where user had non permalink structure was not working correctly in some rare scenarios.\r\n- Updated the Italian language file.\r\n- Fixed bug regarding wp_mail malformed header when \"From\" string was empty due to \"site title\" not being set.\r\n- Fixed bug in IP list validation function for blacklist feature.\r\n- Removed strict filtering of IP addresses so as to allow internal IP address ranges.\r\n- Added stripping of orderby and order query parameters in the plugin.\r\n- Added search capability by IP address, URL or referer for the 404 events list table. \r\n\r\n= 3.8.2 = \r\n- Fixed a CSS issue with the honeypot feature.\r\n- Fixed a call to the login action handler static function.\r\n\r\n= 3.8.1 =\r\n- Minor bug fix for the honeypot feature - loading of css style sheet was not occurring when main login page rendered.\r\n\r\n= 3.8.0 =\r\n- Improved deactivation and re-activation tasks - AIOWPS will now gracefully clean up the .htaccess rules when the plugin is deactivated.\r\n- Tweaked code so that all login pages including custom ones will correctly load the CSS style sheet file needed for honeypot feature.\r\n- Updated the Portugese language translation.\r\n- Fixed the copy protection feature so it doesn't interfere with iframes and shortcodes.\r\n- The plugin will now work fine even if your wp-config.php file is outside the wordpress root folder.\r\n\r\n= 3.7.9.2 =\r\n- copy protection feature JS code improvement \r\n\r\n= 3.7.9.1 =\r\n- Added captcha functionality for custom login form which is produced by the WP function: wp_login_form()\r\n- Fixed a minor bug with the copy protection feature's JavaScript code.\r\n- Tweaked file change scan algorithm to help prevent getMTime fatal runtime errors.\r\n- Added a link to the github repository in the readme.txt file for developers.\r\n\r\n= 3.7.9 =\r\n- Fixed a small bug related to the cookie test in the Cookie Based Brute Force feature.\r\n\r\n= 3.7.8 =\r\n- Added new feature called Login Honeypot which will help reduce brute force login attempts by robots. (This can be found in the Brute Force menu)\r\n- Added new feature to prevent other sites from displaying your content via a frame or iframe. (This can be found in the Miscellaneous menu)\r\n- Added captcha feature for BuddyPress registration form.\r\n- Added a new filter for the site lockout message so it can be customized.\r\n- Added a new filter for template include of the site lockout feature.\r\n- Temporarily deactivated the \"DB Scan\" feature.\r\n\r\n= 3.7.7 =\r\n- Improved DB prefix change code to make it more robust.\r\n- Fixed a minor bug for the Rename Login page feature.\r\n- Added check when processing rename login page to see if maintenance (lockout) mode enabled. Plugin will now display lockout message instead of 404 page if site lockout enabled.\r\n- Made the Cookie Based Brute Force Prevention feature more secure by introducing a 10 digit random suffix to the test cookie name.\r\n\r\n= 3.7.6 =\r\n- Added ability to insert captcha in WordPress Multi Site registration form.\r\n- Added a condition around the management permission constant. This will allow users to define a custom capability for this plugin's admin side via the wp-config file. This was submitted by Samuel Aguilera.\r\n- Fixed a bug with the hidden login page feature.\r\n- Fixed a small settings bug with the \"block fake google bot\" feature.\r\n\r\n= 3.7.5 =\r\n- Added a new DB scan feature. Go to the \"Scanner\" menu to use this new feature.\r\n- Added new settings import/export feature.\r\n- Modified user accounts feature to alert administrator if one or both \"admin\" or \"Admin\" usernames are being used.\r\n- Added Persian language translation. The translation was submitted by Amir Mousavi Pour (me@ameer.ir).\r\n- Small change to get_mysql_tables function to prevent fatal error when mysqli query is unsuccessful.\r\n- Added Italian language translation. The translation was submitted by Marco Guglielmetti.\r\n\r\n= 3.7.4 =\r\n- Added a new feature to add copy protection for your front-end. You can find this feature under the \"Miscellaneous\" menu.\r\n- Fixed comment captcha bug for multi-site. Now this feature can be activated/deactivated for subsites of a multisite installation.\r\n- Added Hungarian language translation. The translation was submitted by Daniel Kocsis.\r\n- Moved the custom login page feature's handling code to wp-loaded hook so other plugins that modify the login page can do their task before our one is triggered. This change was suggested by Mark Hudnall.\r\n- Added German language translation. The translation was submitted by Manuel Fritsch.\r\n- Updated the Brazilian language translation file.\r\n\r\n\r\n= 3.7.3 =\r\n- Added Brazilian language translation. The translation was submitted by Sergio Siqueira.\r\n- Added two new action hooks for plugin activation and deactivation time.\r\n- Improved the get_user_ip_address() function so it handles cases when multiple addresses are returned due to proxy.\r\n- Fixed the mis-alignment of login page which was broken by WP3.9 when rename login feature is used.\r\n- WordPress 3.9 compatibility\r\n\r\n= 3.7.2 =\r\n- Added a PHP Info section in the system info interface to show some important PHP details of the server.\r\n- Added a filter to allow the user to have a custom translation in a place (which will be loaded instead of the default one from the plugin). This change was submitted by Samuel Aguilera.\r\n- Replaced myslqi fetch_all method with fetch_assoc to cover cases where some servers do not have the correct mysql drivers.\r\n- Added a new filter to allow manipulation of the htaccess rules from your custom code. The name of the filter is 'aiowps_htaccess_rules_before_writing'.\r\n- Added a \"Delete All 404 Event Logs\" button to purge all 404 logs from DB\r\n- Added code to automatically send an email to the registrant when an account has been manually \"Approved\" from the User Registration menu.\r\n\r\n= 3.7.1 =\r\n- Fixed a minor bug: dashboard link was pointing to the wrong tab for the \"Logged In Users\" tab.\r\n- Fix a bug with the login page captcha. The captcha wansn't shown if the rename login page feature was enabled at the same time.\r\n\r\n= 3.7 =\r\n- Added new feature - 404 detection. This allows you to log 404 events and block selected IPs. This feature can be found in the Firewall menu.\r\n- Added new dashboard info box to display number of blocked IP addresses in the lockout table.\r\n- Fixed bug where user could not access login page when maintenance mode and rename login page features were both active.\r\n- Tweaked the hotlinking .htaccess directives to cover both http and https.\r\n- Fixed code to prevent mysql errors due to some variables not having default value in failed login and lockdown tables\r\n- Replaced deprecated PHP function mysql_query with mysqli.\r\n- Added language file for Spanish language. The Spanish translation was done by Samuel Montoya.\r\n- Added code to hide the \"DB Prefix\" menu for the non-main sites in multi-site installation\r\n\r\n= 3.6 =\r\n- Added a new feature to prevent image hot-linking. (See the \"Prevent Hotlinks\" tab in the firewall menu)\r\n- Added a check in the Rename Login Page feature to prevent people from setting the slug to \"wp-admin\"\r\n- Fixed a small bug with Login Lockdown feature.\r\n\r\n= 3.5.1 =\r\n- Fixed a bug where the cookie-based brute force directives were not being deleted from the .htaccess file when the Rename Login Page feature was being activated.\r\n\r\n= 3.5 =\r\n- Added new feature which will Block Fake Googlebots from crawling your site. Check the Firewall menu for this new feature.\r\n- Added code to prevent users from having both the Rename Login Page and Cookie-Based Brute Force features active at the same time.\r\n- Added some useful info boxes in the dashboard: 1) to inform the user if the cookie based brute force or rename login page features are active, 2) last 5 logins to your site.\r\n- Fixed minor bug with .htaccess backup feature.\r\n- Updated the from email address value used for sending backups and file change notification. Thanks to @TheAssurer for the tip.\r\n- Updated the warning message for the disable index view feature.\r\n\r\n\r\n= 3.4 =\r\n- Consolidated \"Brute Force\" features by moving all such features to the \"Brute Force\" menu.\r\n- Improved the file change detection scan feature: Introduced a button allowing admin to view the file change results from the last scan and fixed small bug whereby the change detected flag was not being cleared for applicable cases.\r\n- Fixed a small bug with \"rename login page\" (hide admin login) feature.\r\n- Made wp-config.php and .htaccess file backups more secure. Thanks to @TheAssurer for the tip.\r\n- Made the login code more robust by catering for cases where the \"wp_login\" action was not passing 2 parameters.\r\n\r\n= 3.3 =\r\n- Added a brand new brute force prevention feature - Rename Login Page. This feature can be found in the new menu item called \"Brute Force\".\r\n- Modified the new unlock request feature so that the locked out user will only have to enter email address when they submit an unlock request.\r\n- Replaced the deprecated PHP function \"mysql_list_tables\" with alternative code.\r\n- Added warning message regarding WordPress iOS app when pingback protection feature in the firewall settings is active.\r\n- Added Malware scan tab and information.\r\n- Some minor html form and CSS corrections.\r\n\r\n= 3.2 =\r\n- Added new feature which allows users to generate an automated unlock request link via email when they get locked out because of the login lockdown feature.\r\n- Added a check to ensure that user cannot enter 0 minutes in the Force Logout feature.\r\n- Fixed translations so that various previously omitted strings can now be translated.\r\n- Added a new filter before locking down a user's IP address - aiowps_before_lockdown.\r\n- Generated a new translation (POT) file.\r\n\r\n= 3.1 =\r\n- Added a new feature that will allow you to add a captcha to the lost password form (useful if you are allowing user registration on your site).\r\n- Added ability to specify a system log file in the \"Host System Logs\" tab of the \"File System Security\" menu\r\n- Fixed a tab link bug. One link was going to the wrong menu tab.\r\n- Updated the POT file of the plugin.\r\n\r\n= 3.0 =\r\n- Added a new feature which allows you to add captcha to the Wordpress user registration page.\r\n- Added some more helpful comments and link to video tutorial in the brute force and white list features settings pages.\r\n\r\n= 2.9 =\r\n- Added new feature which automatically sets the status of newly registered wordpress user accounts to \"pending\" and allows manual approval by an administrator.\r\n- Improved robustness of file change detection iteration code.\r\n- WordPress 3.7 compatibility\r\n\r\n= 2.8.1 =\r\n- Improved the login captcha implementation\r\n- Changed the management permission to manage_options\r\n\r\n= 2.8 =\r\n- Added a feature to insert a simple math captcha to the WordPress comment form (to reduce comment spam). Check the spam prevention menu for this new feature.\r\n- Fixed a minor bug with bulk unlock/delete in user login menu\r\n- Fixed a minor bug with math captcha logic.\r\n\r\n= 2.7 =\r\n- Added a simple math captcha functionality for the WP login page. This is another easy yet effective way to combat Brute Force Login Attacks. You can enable this new feature from the user login security menu.\r\n\r\n= 2.6 =\r\n- Added a new Login Whitelist feature. This feature enables you to specify one or more IP addresses in a special whitelist which will have access to your WP login page.\r\nAll other IP addresses trying to access your WP login page which are not in the whitelist will be automatically blocked.\r\n- The IP address will also be included in the email that gets sent to the admin for the ip address lockout notification.\r\n- Language file loading fix for Chinese language.\r\n- Tweaked the code which creates a .htaccess file in the backup directory to ensure it gets run even if the directory already existed.\r\n- Made DB backups more secure.\r\n- Added more useful debug logs for .htaccess file manipulation failure scenarios.\r\n\r\n= 2.5 =\r\n- Added a new feature which will list the currently logged in users who have been active within the last 15 minutes.\r\n- Added a new feature in settings menu which will disable all firewall rules and clear all applicable directives in the .htaccess file.\r\n- Improved the way the wp-config.php file is handled when it contains an ending PHP tag \"?>\" (older sites that were using PHP4 earlier).\r\n\r\n= 2.4 =\r\n- Added new feature/checkbox which will instantly lockout IP address ranges which attempt to login with an invalid username.\r\n- Fixed a bug in the Comment SPAM IP Monitoring page where trying to block one or more IPs was failing.\r\n- Removed the word \"config\" from the list of bad query strings check (to add compatibility with a few more plugins)\r\n- Added a notice in the dashboard menu to show you if there are any recent file changes that the plugin detected.\r\n- Fixed bug with php File Editing feature. Code now also handles older style wp-config.php files which have the php end tag \"?>\"\r\n- Fixed bug with \"Disable All Security Features\" button functionality. When clicked, this will now also make the appropriate changes to the .htacces and wp-config.php files if necessary.\r\n- Changed the storage of backup files from the plugin's directory to the uploads directory. Also added a .htaccess file for security.\r\n- Fixed the way user-agent strings were written to the .htacess file from the Blacklist feature. The code now will correctly identify and represent spaces and escaped chars.\r\n- Fixed a bug related to sending backup to correct email address.\r\n\r\n= 2.3 =\r\n- Added new menu called Scanner with a new feature called File Change Detection. This feature will alert you if any files have changed, added or removed from your system.\r\n- Fixed \"Deny Bad Query Strings\" rules to not break the ability to drag components in the WordPress \"Appearance->Menus\" page\r\n- Fixed an activation time warning (on sites with WP_DEBUG option enabled)\r\n- Re-implemented the wp-config.php file content backup feature. It now directly downloads the contents of the file to your computer.\r\n- Multi-site enhancements: Suppressed access to configuration settings for features which are not allowed to be configured from subsites of multi-site installations.\r\n- Fixed a bug with login lockdown feature.\r\n\r\n= 2.2 =\r\n- Added a new feature which will block some spambots from submitting comments.\r\n- Moved Comment SPAM IP monitoring interface to the new \"SPAM Prevention\" menu.\r\n- Fixed a bug with login lockdown feature for both multi and single site.\r\n- Improved firewall feature for multi-site by making the \"Firewall\" menu available only for the main site and not the sub-sites.\r\n- Added random prefix to backup file names.\r\n- Fixed a bug for WP multi-site install where DB tables do not get created when new blog are created in the network.\r\n\r\n= 2.1.1 =\r\n- Fixed a version tagging issue.\r\n\r\n= 2.1 =\r\n- Fixed an issue with install time error on some sites for WordPress 3.6\r\n- Fixed some WP Debug related errors for WordPress 3.6\r\n- Replaced the deprecated $wpdb->escape() function calls with esc_sql() calls\r\n\r\n= 2.0 =\r\n- Fixed a bug for general DB backup functionality.\r\n- Fixed multi-site DB backup - the plugin will now backup only the tables relevant for the sub-site in question.\r\n- Added blank index.html files in various folders inside the plugin.\r\n- Disabled the wp-config.php file backup feature until we find a more secure method of doing the backup.\r\n\r\n= 1.9 =\r\n- Added new WordPress PingBack Vulnerability Protection feature. This allows the user to prohibit access to the xmlrpc.php file in order to protect against certain vulnerabilities in the pingback functionality.\r\n- Added a configuration item in the brute force login prevention feature to allow ajax functionality to work properly when this feature is enabled.\r\n- Added a POT file for language translations.\r\n- Made the DB Prefix feature more robust by adding a check to ensure that plugin can write to the wp-config.php file. This will prevent user from losing access to their site in cases where the system changed the prefix but not the entry in the wp-config.php file.\r\n- Tightened the data validation for the cookie based brute force login feature to ensure that the user must enter a secret word which consists of alphanumeric characters.\r\n- Added edit links to the user account list in the \"User Acounts\" menu.\r\n\r\n= 1.8 =\r\n- Moved the front end site lockout feature to a new menu called \"Maintenance\".\r\n- Added a feature in the front-end lockout feature to allow people to specify their own message which will be displayed on the front-end to visitors who try to access the site when it is in lock out state.\r\n- Fixed a bug in the front-end lockout feature by adding some checks which ensure that the admin will not get locked if the feature is still active and their login session expires or they log out.\r\n- Added a widget in the dashboard menu to show the status of the \"maintenance mode\" feature.\r\n\r\n= 1.7 =\r\n- Added a new feature which is a password strength tool which calculates how easy it is for your chosen password to be cracked using a desktop PC and the appropriate SW. This tool should help you create strong passwords.\r\n- Added a front-end general visitor lockout feature. This feature allows you to temporarily lock down the front end of your site while you do security investigation, site upgrades, tweaks etc.\r\n\r\n= 1.6 =\r\n- Added a new option in the cookie-based Brute Force Login Attack prevention feature to allow users to use this feature together with the WordPress's post/page password protection feature.\r\n- Fixed a bug in the 5G firewall rules to so that the printed rules include the correct number of '\\' characters.\r\n- Fixed a minor bug in the \"restore from backed up htaccess file\" feature.\r\n- Enhanced the \"Save current wp-config.php file\" feature so it will continue to work with all of the firewall rules active on the site.\r\n- Added extra checks to account for some error scenarios caused on some servers when recursive file search is done.\r\n\r\n= 1.5 =\r\n- Added new feature - Cookie-based Brute Force Login Attack Prevention. Check under the \"Firewall\" menu for this new feature.\r\n  This feature will stop hackers in their tracks when they try to access your wp-admin or login pages. This feature will secure your WordPress backend by enforcing the requirement that anybody trying to access these pages will require a special cookie.\r\n\r\n- Fixed bug related to setting of default configuration for first-time plugin activation.\r\n\r\n= 1.4 =\r\n- Tweaked the \"Deny Bad Query Strings\" firewall rules so that plugin deletion and update operations from the WordPress plugins menu are not affected.\r\n- Fixed a minor bug related to scheduled database backups.\r\n- Added some extra default settings to be applied to the plugin's configuration pages upon activation for the first time.\r\n- Plugin will now display a recommendation message if user sets scheduled backup frequency to less than 24 hours.\r\n\r\n= 1.3 =\r\n- Added a new feature to remove the WordPress Generator Meta information from the HTML source of your site.\r\n- Tweaked the \"Advanced Character String Filter\" to fix issue which was affecting plugins such as \"Admin Management Xtended\" and also pages with keywords such as \"password\" in the URL.\r\n- Updated one rule in the \"Advanced Character String Filter\" feature to make it compatible with W3 Total Cache Plugin's minify feature.\r\n- Added a \"Delete All Failed Login Records\" option in the \"Failed Login Records\" tab. This will delete all entries in the failed logins table and will make it less tedious for users who get a lot of brute force attacks on their site.\r\n\r\n= 1.2 =\r\n- Moved the rules which disable index views from the \"basic firewall\" rules to the \"additional rules\" section. This will prevent any site breakage for \r\nthose who want to enable the basic firewall but do not have \"AllowOverride\" option enabled in their httpd.conf\r\n\r\n= 1.1 =\r\n- Added the following new feature:\r\n- Prevent people from accessing the readme.html, license.txt and wp-config-sample.php files.\r\n\r\n= 1.0 =\r\n- First commit to the WP repository.\r\n", "<?php\r\n\r\nif ( !defined('ABSPATH') ) {\r\n    exit; // Exit if accessed directly\r\n}\r\n\r\nif (!class_exists('AIO_WP_Security')){\r\n\r\nclass AIO_WP_Security{\r\n    var $version = '4.4.5';\r\n    var $db_version = '1.9';\r\n    var $plugin_url;\r\n    var $plugin_path;\r\n    var $configs;\r\n    var $admin_init;\r\n    var $debug_logger;\r\n    var $cron_handler;\r\n    var $user_login_obj;\r\n    var $user_registration_obj;\r\n    var $backup_obj;\r\n    var $scan_obj;\r\n    var $captcha_obj;\r\n\r\n    function __construct()\r\n    {\r\n        $this->load_configs();\r\n        $this->define_constants();\r\n        $this->includes();\r\n        $this->loader_operations();\r\n\r\n        add_action('init', array(&$this, 'wp_security_plugin_init'), 0);\r\n        add_action('wp_loaded',array(&$this, 'aiowps_wp_loaded_handler'));\r\n        do_action('aiowpsecurity_loaded');\r\n    }\r\n\r\n    function plugin_url()\r\n    {\r\n        if ($this->plugin_url) return $this->plugin_url;\r\n        return $this->plugin_url = plugins_url( basename( plugin_dir_path(__FILE__) ), basename( __FILE__ ) );\r\n    }\r\n\r\n    function plugin_path()\r\n    {\r\n        if ($this->plugin_path) return $this->plugin_path;\r\n        return $this->plugin_path = untrailingslashit( plugin_dir_path( __FILE__ ) );\r\n    }\r\n\r\n    function load_configs()\r\n    {\r\n        include_once('classes/wp-security-config.php');\r\n        $this->configs = AIOWPSecurity_Config::get_instance();\r\n    }\r\n\r\n    function define_constants()\r\n    {\r\n        define('AIO_WP_SECURITY_VERSION', $this->version);\r\n        define('AIO_WP_SECURITY_DB_VERSION', $this->db_version);\r\n        define('AIOWPSEC_WP_HOME_URL', home_url());\r\n        define('AIOWPSEC_WP_SITE_URL', site_url());\r\n        define('AIOWPSEC_WP_URL', AIOWPSEC_WP_SITE_URL); // for backwards compatibility\r\n        define('AIO_WP_SECURITY_URL', $this->plugin_url());\r\n        define('AIO_WP_SECURITY_PATH', $this->plugin_path());\r\n        define('AIO_WP_SECURITY_BACKUPS_DIR_NAME', 'aiowps_backups');\r\n        define('AIO_WP_SECURITY_BACKUPS_PATH', AIO_WP_SECURITY_PATH.'/backups');\r\n        define('AIO_WP_SECURITY_LIB_PATH', AIO_WP_SECURITY_PATH.'/lib');\r\n        if (!defined('AIOWPSEC_MANAGEMENT_PERMISSION')){//This will allow the user to define custom capability for this constant in wp-config file\r\n            define('AIOWPSEC_MANAGEMENT_PERMISSION', 'manage_options');\r\n        }\r\n        define('AIOWPSEC_MENU_SLUG_PREFIX', 'aiowpsec');\r\n        define('AIOWPSEC_MAIN_MENU_SLUG', 'aiowpsec');\r\n        define('AIOWPSEC_SETTINGS_MENU_SLUG', 'aiowpsec_settings');\r\n        define('AIOWPSEC_USER_ACCOUNTS_MENU_SLUG', 'aiowpsec_useracc');\r\n        define('AIOWPSEC_USER_LOGIN_MENU_SLUG', 'aiowpsec_userlogin');\r\n        define('AIOWPSEC_USER_REGISTRATION_MENU_SLUG', 'aiowpsec_user_registration');\r\n        define('AIOWPSEC_DB_SEC_MENU_SLUG', 'aiowpsec_database');\r\n        define('AIOWPSEC_FILESYSTEM_MENU_SLUG', 'aiowpsec_filesystem');\r\n        define('AIOWPSEC_BLACKLIST_MENU_SLUG', 'aiowpsec_blacklist');\r\n        define('AIOWPSEC_FIREWALL_MENU_SLUG', 'aiowpsec_firewall');\r\n        define('AIOWPSEC_MAINTENANCE_MENU_SLUG', 'aiowpsec_maintenance');\r\n        define('AIOWPSEC_SPAM_MENU_SLUG', 'aiowpsec_spam');\r\n        define('AIOWPSEC_FILESCAN_MENU_SLUG', 'aiowpsec_filescan');\r\n        define('AIOWPSEC_BRUTE_FORCE_MENU_SLUG', 'aiowpsec_brute_force');\r\n        define('AIOWPSEC_MISC_MENU_SLUG', 'aiowpsec_misc');\r\n\r\n        global $wpdb;\r\n        define('AIOWPSEC_TBL_LOGIN_LOCKDOWN', $wpdb->prefix . 'aiowps_login_lockdown');\r\n        define('AIOWPSEC_TBL_FAILED_LOGINS', $wpdb->prefix . 'aiowps_failed_logins');\r\n        define('AIOWPSEC_TBL_USER_LOGIN_ACTIVITY', $wpdb->prefix . 'aiowps_login_activity');\r\n        define('AIOWPSEC_TBL_GLOBAL_META_DATA', $wpdb->prefix . 'aiowps_global_meta');\r\n        define('AIOWPSEC_TBL_EVENTS', $wpdb->prefix . 'aiowps_events');\r\n        define('AIOWPSEC_TBL_PERM_BLOCK', $wpdb->prefix . 'aiowps_permanent_block');\r\n\r\n    }\r\n\r\n    function includes()\r\n    {\r\n        //Load common files for everywhere\r\n        include_once('classes/wp-security-debug-logger.php');\r\n        include_once('classes/wp-security-utility.php');\r\n        include_once('classes/wp-security-utility-htaccess.php');\r\n        include_once('classes/wp-security-utility-ip-address.php');\r\n        include_once('classes/wp-security-utility-file.php');\r\n        include_once('classes/wp-security-general-init-tasks.php');\r\n        include_once('classes/wp-security-wp-loaded-tasks.php');\r\n\r\n        include_once('classes/wp-security-user-login.php');\r\n        include_once('classes/wp-security-user-registration.php');\r\n        include_once('classes/wp-security-captcha.php');\r\n        include_once('classes/wp-security-backup.php');\r\n        include_once('classes/wp-security-file-scan.php');\r\n        include_once('classes/wp-security-cronjob-handler.php');\r\n        include_once('classes/grade-system/wp-security-feature-item.php');\r\n        include_once('classes/grade-system/wp-security-feature-item-manager.php');\r\n        include_once('classes/wp-security-wp-footer-content.php');\r\n        include_once('classes/wp-security-blocking.php');\r\n\r\n        if (is_admin()){ //Load admin side only files\r\n            include_once('classes/wp-security-configure-settings.php');\r\n            include_once('admin/wp-security-admin-init.php');\r\n            include_once('admin/general/wp-security-list-table.php');\r\n\r\n        }\r\n        else{ //Load front end side only files\r\n        }\r\n    }\r\n\r\n    function loader_operations()\r\n    {\r\n        add_action('plugins_loaded',array(&$this, 'plugins_loaded_handler'));//plugins loaded hook\r\n\r\n        $debug_config = $this->configs->get_value('aiowps_enable_debug');\r\n        $debug_enabled = empty($debug_config) ? false : true;\r\n        $this->debug_logger = new AIOWPSecurity_Logger($debug_enabled);\r\n\r\n        if(is_admin()){\r\n            $this->admin_init = new AIOWPSecurity_Admin_Init();\r\n        }\r\n    }\r\n\r\n    static function activate_handler($networkwide)\r\n    {\r\n        global $wpdb;\r\n        //Only runs when the plugin activates\r\n        include_once ('classes/wp-security-installer.php');\r\n        AIOWPSecurity_Installer::run_installer($networkwide);\r\n        AIOWPSecurity_Installer::set_cron_tasks_upon_activation($networkwide);\r\n    }\r\n\r\n    static function deactivate_handler($networkwide)\r\n    {\r\n        //Only runs with the pluign is deactivated\r\n        include_once ('classes/wp-security-deactivation-tasks.php');\r\n        AIOWPSecurity_Deactivation::run_deactivation_tasks($networkwide);\r\n        do_action('aiowps_deactivation_complete');\r\n    }\r\n\r\n    function db_upgrade_handler()\r\n    {\r\n        if(is_admin()){//Check if DB needs to be upgraded\r\n            if (get_option('aiowpsec_db_version') != AIO_WP_SECURITY_DB_VERSION) {\r\n                include_once ('classes/wp-security-installer.php');\r\n                AIOWPSecurity_Installer::run_installer();\r\n            }\r\n        }\r\n    }\r\n\r\n    function plugins_loaded_handler()\r\n    {\r\n        //Runs when plugins_loaded action gets fired\r\n        if(is_admin()){\r\n            //Do plugins_loaded operations for admin side\r\n            $this->db_upgrade_handler();\r\n        }\r\n        $this->do_additional_plugins_loaded_tasks();\r\n    }\r\n\r\n    function wp_security_plugin_init()\r\n    {\r\n        //Set up localisation. First loaded overrides strings present in later loaded file\r\n        $locale = apply_filters( 'plugin_locale', get_locale(), 'all-in-one-wp-security-and-firewall' );\r\n        load_textdomain( 'all-in-one-wp-security-and-firewall', WP_LANG_DIR . \"/all-in-one-wp-security-and-firewall-$locale.mo\" );\r\n\tload_plugin_textdomain('all-in-one-wp-security-and-firewall', false, dirname(plugin_basename(__FILE__ )) . '/languages/');\r\n\r\n        //Actions, filters, shortcodes goes here\r\n        $this->user_login_obj = new AIOWPSecurity_User_Login();//Do the user login operation tasks\r\n        $this->user_registration_obj = new AIOWPSecurity_User_Registration();//Do the user login operation tasks\r\n        $this->captcha_obj = new AIOWPSecurity_Captcha();//Do the captcha tasks\r\n        $this->backup_obj = new AIOWPSecurity_Backup();//Object to handle backup tasks\r\n        $this->scan_obj = new AIOWPSecurity_Scan();//Object to handle scan tasks\r\n        $this->cron_handler = new AIOWPSecurity_Cronjob_Handler();\r\n\r\n        add_action('login_enqueue_scripts',array(&$this, 'aiowps_login_enqueue'));\r\n        add_action('wp_footer',array(&$this, 'aiowps_footer_content'));\r\n\r\n        add_action('wp_login', array('AIOWPSecurity_User_Login', 'wp_login_action_handler'), 10, 2);\r\n        do_action('aiowps_force_logout_check');\r\n        new AIOWPSecurity_General_Init_Tasks();\r\n    }\r\n\r\n    function aiowps_wp_loaded_handler()\r\n    {\r\n        new AIOWPSecurity_WP_Loaded_Tasks();\r\n    }\r\n\r\n    /**\r\n     * Enqueues the Google recaptcha v2 api URL for the standard WP login page\r\n     * @global type $aio_wp_security\r\n     */\r\n    function aiowps_login_enqueue()\r\n    {\r\n        global $aio_wp_security;\r\n        if($aio_wp_security->configs->get_value('aiowps_default_recaptcha')) {\r\n            if($aio_wp_security->configs->get_value('aiowps_enable_login_captcha') == '1' || $aio_wp_security->configs->get_value('aiowps_enable_registration_page_captcha') == '1') {\r\n                wp_enqueue_script( 'google-recaptcha', 'https://www.google.com/recaptcha/api.js', false );\r\n                // below is needed to provide some space for the google reCaptcha form (otherwise it appears partially hidden on RHS)\r\n                wp_add_inline_script( 'google-recaptcha', 'document.addEventListener(\"DOMContentLoaded\", ()=>{document.getElementById(\"login\").style.width = \"340px\";});' );\r\n            }\r\n        }\r\n    }\r\n\r\n    function aiowps_footer_content()\r\n    {\r\n        new AIOWPSecurity_WP_Footer_Content();\r\n    }\r\n\r\n    function do_additional_plugins_loaded_tasks()\r\n    {\r\n        global $aio_wp_security;\r\n        if(isset($_GET['aiowpsec_do_log_out']))\r\n        {\r\n            $nonce = isset($_GET['_wpnonce'])?$_GET['_wpnonce']:'';\r\n            if ( !wp_verify_nonce( $nonce, 'aio_logout' ) ) {\r\n                return;\r\n            }\r\n            wp_logout();\r\n            if(isset($_GET['after_logout']))//Redirect to the after logout url directly\r\n            {\r\n                $after_logout_url = esc_url($_GET['after_logout']);\r\n                AIOWPSecurity_Utility::redirect_to_url($after_logout_url);\r\n            }\r\n            $additional_data = strip_tags($_GET['al_additional_data']);\r\n            if(isset($additional_data))\r\n            {\r\n                $login_url = '';\r\n                //Check if rename login feature enabled\r\n                if($aio_wp_security->configs->get_value('aiowps_enable_rename_login_page')=='1'){\r\n                    if (get_option('permalink_structure')){\r\n                        $home_url = trailingslashit(home_url());\r\n                    }else{\r\n                        $home_url = trailingslashit(home_url()) . '?';\r\n                    }\r\n                    $login_url = $home_url.$aio_wp_security->configs->get_value('aiowps_login_page_slug');\r\n                }else{\r\n                    $login_url = wp_login_url();\r\n                }\r\n\r\n                //Inspect the payload and do redirect to login page with a msg and redirect url\r\n                $logout_payload = (AIOWPSecurity_Utility::is_multisite_install() ? get_site_transient('aiowps_logout_payload') : get_transient('aiowps_logout_payload'));\r\n                if(!empty($logout_payload['redirect_to'])){\r\n                    $login_url = AIOWPSecurity_Utility::add_query_data_to_url($login_url,'redirect_to',$logout_payload['redirect_to']);\r\n                }\r\n                if(!empty($logout_payload['msg'])){\r\n                    $login_url .= '&'.$logout_payload['msg'];\r\n                }\r\n                if(!empty($login_url)){\r\n                    AIOWPSecurity_Utility::redirect_to_url($login_url);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n}//End of class\r\n\r\n}//End of class not exists check\r\n\r\n$GLOBALS['aio_wp_security'] = new AIO_WP_Security();\r\n", "<?php\r\n/*\r\nPlugin Name: All In One WP Security\r\nVersion: 4.4.5\r\nPlugin URI: https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin\r\nAuthor: Tips and Tricks HQ, Peter Petreski, Ruhul, Ivy\r\nAuthor URI: https://www.tipsandtricks-hq.com/\r\nDescription: All round best WordPress security plugin!\r\nText Domain: all-in-one-wp-security-and-firewall\r\nDomain Path: /languages\r\nLicense: GPL3\r\n*/\r\n\r\nif(!defined('ABSPATH')){\r\n    exit;//Exit if accessed directly\r\n}\r\n\r\ninclude_once('wp-security-core.php');\r\nregister_activation_hook(__FILE__,array('AIO_WP_Security','activate_handler'));//activation hook\r\nregister_deactivation_hook(__FILE__,array('AIO_WP_Security','deactivate_handler'));//deactivation hook\r\n\r\nfunction aiowps_show_plugin_settings_link($links, $file)\r\n{\r\n    if ($file == plugin_basename(__FILE__)){\r\n            $settings_link = '<a href=\"admin.php?page=aiowpsec_settings\">Settings</a>';\r\n            array_unshift($links, $settings_link);\r\n    }\r\n    return $links;\r\n}\r\nadd_filter('plugin_action_links', 'aiowps_show_plugin_settings_link', 10, 2 );\r\n\r\nfunction aiowps_ms_handle_new_site($new_site){\r\n    global $wpdb;\r\n    $plugin_basename = plugin_basename( __FILE__ );\r\n    if (is_plugin_active_for_network($plugin_basename))\r\n    {\r\n        if(!class_exists('AIOWPSecurity_Installer')){\r\n            include_once('classes/wp-security-installer.php');\r\n        }\r\n        $old_blog = $wpdb->blogid;\r\n        switch_to_blog($new_site->blog_id);\r\n        AIOWPSecurity_Installer::create_db_tables();\r\n        switch_to_blog($old_blog);\r\n    }\r\n\r\n\r\n}\r\nadd_action('wp_insert_site', 'aiowps_ms_handle_new_site', 10, 1);\r\n"], "fixing_code": ["<?php\r\nif(!defined('ABSPATH')){\r\n    exit;//Exit if accessed directly\r\n}\r\n\r\nclass AIOWPSecurity_Blacklist_Menu extends AIOWPSecurity_Admin_Menu\r\n{\r\n    var $menu_page_slug = AIOWPSEC_BLACKLIST_MENU_SLUG;\r\n\r\n    /* Specify all the tabs of this menu in the following array */\r\n    var $menu_tabs;\r\n\r\n    var $menu_tabs_handler = array(\r\n        'tab1' => 'render_tab1',\r\n        );\r\n\r\n    function __construct()\r\n    {\r\n        $this->render_menu_page();\r\n    }\r\n\r\n    function set_menu_tabs()\r\n    {\r\n        $this->menu_tabs = array(\r\n        'tab1' => __('Ban Users', 'all-in-one-wp-security-and-firewall'),\r\n        );\r\n    }\r\n\r\n    function get_current_tab()\r\n    {\r\n        $tab_keys = array_keys($this->menu_tabs);\r\n        $tab = isset( $_GET['tab'] ) ? sanitize_text_field($_GET['tab']) : $tab_keys[0];\r\n        return $tab;\r\n    }\r\n\r\n    /*\r\n     * Renders our tabs of this menu as nav items\r\n     */\r\n    function render_menu_tabs()\r\n    {\r\n        $current_tab = $this->get_current_tab();\r\n\r\n        echo '<h2 class=\"nav-tab-wrapper\">';\r\n        foreach ( $this->menu_tabs as $tab_key => $tab_caption )\r\n        {\r\n            $active = $current_tab == $tab_key ? 'nav-tab-active' : '';\r\n            echo '<a class=\"nav-tab ' . $active . '\" href=\"?page=' . $this->menu_page_slug . '&tab=' . $tab_key . '\">' . $tab_caption . '</a>';\r\n        }\r\n        echo '</h2>';\r\n    }\r\n\r\n    /*\r\n     * The menu rendering goes here\r\n     */\r\n    function render_menu_page()\r\n    {\r\n        echo '<div class=\"wrap\">';\r\n        echo '<h2>'.__('Blacklist Manager','all-in-one-wp-security-and-firewall').'</h2>';//Interface title\r\n        $this->set_menu_tabs();\r\n        $tab = $this->get_current_tab();\r\n        $this->render_menu_tabs();\r\n        ?>\r\n        <div id=\"poststuff\"><div id=\"post-body\">\r\n        <?php\r\n        //$tab_keys = array_keys($this->menu_tabs);\r\n        call_user_func(array(&$this, $this->menu_tabs_handler[$tab]));\r\n        ?>\r\n        </div></div>\r\n        </div><!-- end of wrap -->\r\n        <?php\r\n    }\r\n\r\n    function render_tab1()\r\n    {\r\n        global $aio_wp_security;\r\n        global $aiowps_feature_mgr;\r\n        $result = 1;\r\n        if (isset($_POST['aiowps_save_blacklist_settings']))\r\n        {\r\n            $nonce=$_REQUEST['_wpnonce'];\r\n            if (!wp_verify_nonce($nonce, 'aiowpsec-blacklist-settings-nonce'))\r\n            {\r\n                $aio_wp_security->debug_logger->log_debug(\"Nonce check failed for save blacklist settings!\",4);\r\n                die(__('Nonce check failed for save blacklist settings!','all-in-one-wp-security-and-firewall'));\r\n            }\r\n\r\n            if (isset($_POST[\"aiowps_enable_blacklisting\"]) && empty($_POST['aiowps_banned_ip_addresses']) && empty($_POST['aiowps_banned_user_agents']))\r\n            {\r\n                $this->show_msg_error('You must submit at least one IP address or one User Agent value or both!','all-in-one-wp-security-and-firewall');\r\n            }\r\n            else\r\n            {\r\n                if (!empty($_POST['aiowps_banned_ip_addresses']))\r\n                {\r\n                    $ip_addresses = $_POST['aiowps_banned_ip_addresses'];\r\n                    $ip_list_array = AIOWPSecurity_Utility_IP::create_ip_list_array_from_string_with_newline($ip_addresses);\r\n                    $payload = AIOWPSecurity_Utility_IP::validate_ip_list($ip_list_array, 'blacklist');\r\n                    if($payload[0] == 1){\r\n                        //success case\r\n                        $result = 1;\r\n                        $list = $payload[1];\r\n                        $banned_ip_data = implode(PHP_EOL, $list);\r\n                        $aio_wp_security->configs->set_value('aiowps_banned_ip_addresses',$banned_ip_data);\r\n                        $_POST['aiowps_banned_ip_addresses'] = ''; //Clear the post variable for the banned address list\r\n                    }\r\n                    else{\r\n                        $result = -1;\r\n                        $error_msg = $payload[1][0];\r\n                        $this->show_msg_error($error_msg);\r\n                    }\r\n\r\n                }\r\n                else\r\n                {\r\n                    $aio_wp_security->configs->set_value('aiowps_banned_ip_addresses',''); //Clear the IP address config value\r\n                }\r\n\r\n                if (!empty($_POST['aiowps_banned_user_agents']))\r\n                {\r\n                    $result = $result * $this->validate_user_agent_list();\r\n                }else{\r\n                    //clear the user agent list\r\n                    $aio_wp_security->configs->set_value('aiowps_banned_user_agents','');\r\n                }\r\n\r\n                if ($result == 1)\r\n                {\r\n                    $aio_wp_security->configs->set_value('aiowps_enable_blacklisting',isset($_POST[\"aiowps_enable_blacklisting\"])?'1':'');\r\n                    $aio_wp_security->configs->save_config(); //Save the configuration\r\n\r\n                    //Recalculate points after the feature status/options have been altered\r\n                    $aiowps_feature_mgr->check_feature_status_and_recalculate_points();\r\n\r\n                    $this->show_msg_settings_updated();\r\n\r\n                    $write_result = AIOWPSecurity_Utility_Htaccess::write_to_htaccess(); //now let's write to the .htaccess file\r\n                    if ( !$write_result )\r\n                    {\r\n                        $this->show_msg_error(__('The plugin was unable to write to the .htaccess file. Please edit file manually.','all-in-one-wp-security-and-firewall'));\r\n                        $aio_wp_security->debug_logger->log_debug(\"AIOWPSecurity_Blacklist_Menu - The plugin was unable to write to the .htaccess file.\");\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        ?>\r\n        <h2><?php _e('Ban IPs or User Agents', 'all-in-one-wp-security-and-firewall')?></h2>\r\n        <div class=\"aio_blue_box\">\r\n            <?php\r\n            echo '<p>'.__('The All In One WP Security Blacklist feature gives you the option of banning certain host IP addresses or ranges and also user agents.', 'all-in-one-wp-security-and-firewall').'\r\n            <br />'.__('This feature will deny total site access for users which have IP addresses or user agents matching those which you have configured in the settings below.', 'all-in-one-wp-security-and-firewall').'\r\n            <br />'.__('The plugin achieves this by making appropriate modifications to your .htaccess file.', 'all-in-one-wp-security-and-firewall').'\r\n            <br />'.__('By blocking people via the .htaccess file your are using the most secure first line of defence which denies all access to blacklisted visitors as soon as they hit your hosting server.', 'all-in-one-wp-security-and-firewall').'\r\n            </p>';\r\n            ?>\r\n        </div>\r\n        <div class=\"aio_grey_box\">\r\n            <?php\r\n            $addon_link = '<strong><a href=\"http://www.site-scanners.com/country-blocking-addon/\" target=\"_blank\">'.__('Country Blocking Addon', 'all-in-one-wp-security-and-firewall').'</a></strong>';\r\n            $info_msg = sprintf( __('You may also be interested in our %s.', 'all-in-one-wp-security-and-firewall'), $addon_link);\r\n            $info_msg2 = __('This addon allows you to automatically block IP addresses based on their country of origin.', 'all-in-one-wp-security-and-firewall');\r\n\r\n            echo '<p>'.$info_msg.\r\n                '<br />'.$info_msg2.'</p>';\r\n            ?>\r\n        </div>\r\n\r\n        <div class=\"postbox\">\r\n        <h3 class=\"hndle\"><label for=\"title\"><?php _e('IP Hosts and User Agent Blacklist Settings', 'all-in-one-wp-security-and-firewall'); ?></label></h3>\r\n        <div class=\"inside\">\r\n        <?php\r\n        //Display security info badge\r\n        global $aiowps_feature_mgr;\r\n        $aiowps_feature_mgr->output_feature_details_badge(\"blacklist-manager-ip-user-agent-blacklisting\");\r\n        ?>\r\n        <form action=\"\" method=\"POST\">\r\n        <?php wp_nonce_field('aiowpsec-blacklist-settings-nonce'); ?>\r\n        <div class=\"aio_orange_box\">\r\n            <p>\r\n            <?php\r\n            $read_link = '<a href=\"https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin#advanced_features_note\" target=\"_blank\">'.__('must read this message', 'all-in-one-wp-security-and-firewall').'</a>';\r\n            echo sprintf(__('This feature can lock you out of admin if it doesn\\'t work correctly on your site. You %s before activating this feature.', 'all-in-one-wp-security-and-firewall'), $read_link);\r\n            ?>\r\n            </p>\r\n        </div>\r\n        <table class=\"form-table\">\r\n            <tr valign=\"top\">\r\n                <th scope=\"row\"><?php _e('Enable IP or User Agent Blacklisting', 'all-in-one-wp-security-and-firewall')?>:</th>\r\n                <td>\r\n                <input name=\"aiowps_enable_blacklisting\" type=\"checkbox\"<?php if($aio_wp_security->configs->get_value('aiowps_enable_blacklisting')=='1') echo ' checked=\"checked\"'; ?> value=\"1\"/>\r\n                <span class=\"description\"><?php _e('Check this if you want to enable the banning (or blacklisting) of selected IP addresses and/or user agents specified in the settings below', 'all-in-one-wp-security-and-firewall'); ?></span>\r\n                </td>\r\n            </tr>\r\n            <tr valign=\"top\">\r\n                <th scope=\"row\"><?php _e('Enter IP Addresses:', 'all-in-one-wp-security-and-firewall')?></th>\r\n                <td>\r\n                    <textarea name=\"aiowps_banned_ip_addresses\" rows=\"5\" cols=\"50\"><?php echo ($result == -1)?htmlspecialchars($_POST['aiowps_banned_ip_addresses']):htmlspecialchars($aio_wp_security->configs->get_value('aiowps_banned_ip_addresses')); ?></textarea>\r\n                    <br />\r\n                    <span class=\"description\"><?php _e('Enter one or more IP addresses or IP ranges.','all-in-one-wp-security-and-firewall');?></span>\r\n                    <span class=\"aiowps_more_info_anchor\"><span class=\"aiowps_more_info_toggle_char\">+</span><span class=\"aiowps_more_info_toggle_text\"><?php _e('More Info', 'all-in-one-wp-security-and-firewall'); ?></span></span>\r\n                    <div class=\"aiowps_more_info_body\">\r\n                            <?php\r\n                            echo '<p class=\"description\">'.__('Each IP address must be on a new line.', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('To specify an IP range use a wildcard \"*\" character. Acceptable ways to use wildcards is shown in the examples below:', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('Example 1: 195.47.89.*', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('Example 2: 195.47.*.*', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('Example 3: 195.*.*.*', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            ?>\r\n                    </div>\r\n\r\n                </td>\r\n            </tr>\r\n            <tr valign=\"top\">\r\n                <th scope=\"row\"><?php _e('Enter User Agents:', 'all-in-one-wp-security-and-firewall')?></th>\r\n                <td>\r\n                    <textarea name=\"aiowps_banned_user_agents\" rows=\"5\" cols=\"50\"><?php echo ($result == -1)?htmlspecialchars($_POST['aiowps_banned_user_agents']):htmlspecialchars($aio_wp_security->configs->get_value('aiowps_banned_user_agents')); ?></textarea>\r\n                    <br />\r\n                    <span class=\"description\">\r\n                        <?php _e('Enter one or more user agent strings.','all-in-one-wp-security-and-firewall');?></span>\r\n                    <span class=\"aiowps_more_info_anchor\"><span class=\"aiowps_more_info_toggle_char\">+</span><span class=\"aiowps_more_info_toggle_text\"><?php _e('More Info', 'all-in-one-wp-security-and-firewall'); ?></span></span>\r\n                    <div class=\"aiowps_more_info_body\">\r\n                            <?php\r\n                            echo '<p class=\"description\">'.__('Each user agent string must be on a new line.', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">'.__('Example 1 - A single user agent string to block:', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">SquigglebotBot</p>';\r\n                            echo '<p class=\"description\">'.__('Example 2 - A list of more than 1 user agent strings to block', 'all-in-one-wp-security-and-firewall').'</p>';\r\n                            echo '<p class=\"description\">baiduspider<br />SquigglebotBot<br />SurveyBot<br />VoidEYE<br />webcrawl.net<br />YottaShopping_Bot</p>';\r\n                            ?>\r\n                    </div>\r\n\r\n                </td>\r\n            </tr>\r\n        </table>\r\n        <input type=\"submit\" name=\"aiowps_save_blacklist_settings\" value=\"<?php _e('Save Settings', 'all-in-one-wp-security-and-firewall')?>\" class=\"button-primary\" />\r\n        </form>\r\n        </div></div>\r\n        <?php\r\n    }\r\n\r\n    function validate_user_agent_list()\r\n    {\r\n        global $aio_wp_security;\r\n        @ini_set('auto_detect_line_endings', true);\r\n        //$errors = '';\r\n\r\n        $submitted_agents = explode(PHP_EOL, $_POST['aiowps_banned_user_agents']);\r\n\t$agents = array();\r\n\tif (!empty($submitted_agents))\r\n        {\r\n            foreach ($submitted_agents as $agent)\r\n            {\r\n                $text = sanitize_text_field($agent);\r\n                $agents[] = $text;\r\n            }\r\n        }\r\n\r\n        if (sizeof($agents) > 1)\r\n        {\r\n            sort( $agents );\r\n            $agents = array_unique($agents, SORT_STRING);\r\n        }\r\n\r\n        $banned_user_agent_data = implode(PHP_EOL, $agents);\r\n        $aio_wp_security->configs->set_value('aiowps_banned_user_agents',$banned_user_agent_data);\r\n        $_POST['aiowps_banned_user_agents'] = ''; //Clear the post variable for the banned address list\r\n        return 1;\r\n    }\r\n} //end class", "=== All In One WP Security & Firewall ===\r\nContributors: Tips and Tricks HQ, wpsolutions, Peter Petreski, Ruhul Amin, mbrsolution\r\nDonate link: https://www.tipsandtricks-hq.com\r\nTags: security, secure, Anti Virus, antivirus, ban, ban hacker, virus, firewall, firewall security, login, lockdown, htaccess, hack, malware, vulnerability, protect, protection, phishing, database, backup, plugin, sql injection, ssl, restrict, login captcha, bot, hotlink, 404 detection, admin, rename, all in one, scan, scanner, iframe,\r\nRequires at least: 5.0\r\nTested up to: 5.6\r\nStable tag: 4.4.6\r\nLicense: GPLv3\r\n\r\nA comprehensive, user-friendly, all in one WordPress security and firewall plugin for your site.\r\n\r\n== Privacy Policy ==\r\nThis plugin may collect IP addresses for security reasons such as mitigating brute force login threats and malicious activity.\r\nThe collected information is stored on your server. No information is transmitted to third parties or remote server locations.\r\n\r\n== Description ==\r\n= A COMPREHENSIVE, EASY TO USE, STABLE AND WELL SUPPORTED WORDPRESS SECURITY PLUGIN =\r\n\r\nWordPress itself is a very secure platform. However, it helps to add some extra security and firewall to your site by using a security plugin that enforces a lot of good security practices.\r\n\r\nThe All In One WordPress Security plugin will take your website security to a whole new level.\r\n\r\nThis plugin is designed and written by experts and is easy to use and understand.\r\n\r\nIt reduces security risk by checking for vulnerabilities, and by implementing and enforcing the latest recommended WordPress security practices and techniques.\r\n\r\nhttps://www.youtube.com/watch?v=CJvCTlVtazA\r\n\r\nAll In One WP Security also uses an unprecedented security points grading system to measure how well you are protecting your site based on the security features you have activated.\r\n\r\nOur security and firewall rules are categorized into \"basic\", \"intermediate\" and \"advanced\". This way you can apply the firewall rules progressively without breaking your site's functionality.\r\n\r\nThe All In One WordPress Security plugin doesn't slow down your site and it is 100% free.\r\n\r\nVisit the [WordPress Security Plugin](https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin) page for more details.\r\n\r\nBelow is a list of the security and firewall features offered in this plugin:\r\n\r\n= User Accounts Security =\r\n* Detect if there is a user account which has the default \"admin\" username and easily change the username to a value of your choice.\r\n* The plugin will also detect if you have any WordPress user accounts which have identical login and display names. Having account's where display name is identical to login name is bad security practice because \r\nyou are making it 50% easier for hackers because they already know the login name.\r\n* Password strength tool to allow you to create very strong passwords.\r\n* Stop user enumeration. So users/bots cannot discover user info via author permalink.\r\n\r\n= User Login Security =\r\n* Protect against \"Brute Force Login Attack\" with the Login Lockdown feature. Users with a certain IP address or range will be locked out of the system for a predetermined amount of time based on the configuration settings and you can also choose to be notified \r\nvia email whenever somebody gets locked out due to too many login attempts.\r\n\r\n* As the administrator you can view a list of all locked out users which are displayed in an easily readable and navigable table which also allows you to unlock individual or bulk IP addresses at the click of a button.\r\n* Force logout of all users after a configurable time period\r\n* Monitor/View failed login attempts which show the user's IP address, User ID/Username and Date/Time of the failed login attempt\r\n\r\n* Monitor/View the account activity of all user accounts on your system by keeping track of the username, IP address, login date/time, and logout date/time.\r\n* Ability to automatically lockout IP address ranges which attempt to login with an invalid username.\r\n* Ability to see a list of all the users who are currently logged into your site.\r\n* Allows you to specify one or more IP addresses in a special whitelist. The whitelisted IP addresses will have access to your WP login page.\r\n* Add Google reCaptcha or plain maths captcha to WordPress Login form.\r\n* Add Google reCaptcha or plain maths captcha to the forgot password form of your WP Login system.\r\n\r\n= User Registration Security =\r\n* Enable manual approval of WordPress user accounts. If your site allows people to create their own accounts via the WordPress registration form, then you can minimize SPAM or bogus registrations by manually approving each registration.\r\n* Ability to add Google reCaptcha or plain maths captcha to the WordPress's user registration page to protect you from spam user registration.\r\n* Ability to add Honeypot to the WordPress's user registration form to reduce registration attempts by robots.\r\n\r\n= Database Security =\r\n* Easily set the default WP prefix to a value of your choice with the click of a button.\r\n* Schedule automatic backups and email notifications or make an instant DB backup whenever you want with one click.\r\n\r\n= File System Security =\r\n* Identify files or folders which have permission settings which are not secure and set the permissions to the recommend secure values with click of a button.\r\n* Protect your PHP code by disabling file editing from the WordPress administration area.\r\n* Easily view and monitor all host system logs from a single menu page and stay informed of any issues or problems occurring on your server so you can address them quickly.\r\n* Prevent people from accessing the readme.html, license.txt and wp-config-sample.php files of your WordPress site.\r\n\r\n= htaccess and wp-config.php File Backup and Restore =\r\n* Easily backup your original .htaccess and wp-config.php files in case you will need to use them to restore broken functionality.\r\n* Modify the contents of the currently active .htaccess or wp-config.php files from the admin dashboard with only a few clicks\r\n\r\n= Blacklist Functionality =\r\n* Ban users by specifying IP addresses or use a wild card to specify IP ranges.\r\n* Ban users by specifying user agents.\r\n\r\n= Firewall Functionality =\r\n\r\nThis plugin allows you to easily add a lot of firewall protection to your site via htaccess file. An htaccess file is processed by your web server before any other code on your site. \r\nSo these firewall rules will stop malicious script(s) before it gets a chance to reach the WordPress code on your site.\r\n\r\n* Access control facility.\r\n* Instantly activate a selection of firewall settings ranging from basic, intermediate and advanced.\r\n* Enable the famous \"6G Blacklist\" Firewall rules courtesy of [Perishable Press](http://perishablepress.com/)\r\n* Forbid proxy comment posting.\r\n* Block access to debug log file.\r\n* Disable trace and track.\r\n* Deny bad or malicious query strings.\r\n* Protect against Cross Site Scripting (XSS) by activating the comprehensive advanced character string filter.\r\nor malicious bots who do not have a special cookie in their browser. You (the site admin) will know how to set this special cookie and be able to log into your site.\r\n* WordPress PingBack Vulnerability Protection feature. This firewall feature allows the user to prohibit access to the xmlrpc.php file in order to protect against certain vulnerabilities in the pingback functionality. This is also helpful to block bots from constantly accessing the xmlrpc.php file and wasting your server resource.\r\n* Ability to block fake Googlebots from crawling your site.\r\n* Ability to prevent image hotlinking. Use this to prevent others from hotlinking your images.\r\n* Ability to log all 404 events on your site. You can also choose to automatically block IP addresses that are hitting too many 404s.\r\n* Ability to add custom rules to block access to various resources of your site.\r\n\r\n= Brute force login attack prevention =\r\n* Instantly block Brute Force Login Attacks via our special Cookie-Based Brute Force Login Prevention feature. This firewall functionality will block all login attempts from people and bots.\r\n* Ability to add a simple math captcha to the WordPress login form to fight against brute force login attacks.\r\n* Ability to hide admin login page. Rename your WordPress login page URL so that bots and hackers cannot access your real WordPress login URL. This feature allows you to change the default login page (wp-login.php) to something you configure.\r\n* Ability to use Login Honeypot which will helps reduce brute force login attempts by robots.\r\n\r\n= Security Scanner =\r\n* The file change detection scanner can alert you if any files have changed in your WordPress system. You can then investigate and see if that was a legitimate change or some bad code was injected.\r\n\r\n= Comment SPAM Security =\r\n* Monitor the most active IP addresses which persistently produce the most SPAM comments and instantly block them with the click of a button.\r\n* Prevent comments from being submitted if it doesn't originate from your domain (this should reduce some SPAM bot comment posting on your site).\r\n* Add a captcha to your wordpress comment form to add security against comment spam.\r\n* Automatically and permanently block IP addresses which have exceeded a certain number of comments labeled as SPAM.\r\n\r\n= Front-end Text Copy Protection =\r\n* Ability to disable the right click, text selection and copy option for your front-end.\r\n\r\n= Regular updates and additions of new security features =\r\n* WordPress Security is something that evolves over time. We will be updating the All In One WP Security plugin with new security features (and fixes if required) on a regular basis so you can rest assured that your site will be on the cutting edge of security protection techniques.\r\n\r\n= Works with Most Popular WordPress Plugins =\r\n* It should work smoothly with most popular WordPress plugins.\r\n\r\n= Additional Features =\r\n* Ability to remove the WordPress Generator Meta information from the HTML source of your site.\r\n* Ability to remove the WordPress Version information from the JS and CSS file includes of your site.\r\n* Ability to prevent people from accessing the readme.html, license.txt and wp-config-sample.php files\r\n* Ability to temporarily lock down the front end of your site from general visitors while you do various backend tasks (investigate security attacks, perform site upgrades, do maintenance work etc.)\r\n* Ability to export/import the security settings.\r\n* Prevent other sites from displaying your content via a frame or iframe.\r\n\r\n= Plugin Support =\r\n* If you have a question or problem with the All In One Security plugin, post it on the support forum and we will help you.\r\n\r\n= Developers =\r\n* If you are a developer and you need some extra hooks or filters for this plugin then let us know.\r\n* Github repository - https://github.com/Arsenal21/all-in-one-wordpress-security\r\n\r\n= Translations =\r\n* All In One WP Security plugin can be translated to any language. \r\n\r\nCurrently available translations:\r\n\r\n- English\r\n- German\r\n- Spanish\r\n- French\r\n- Hungarian\r\n- Italian\r\n- Swedish\r\n- Russian\r\n- Chinese\r\n- Portuguese (Brazil)\r\n- Persian\r\n\r\nVisit the [WordPress Security Plugin](https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin) page for more details.\r\n\r\n== Installation ==\r\n\r\nTo begin making your WordPress site more secure:\r\n\r\n1. Upload the 'all-in-one-wp-security.zip' file from the Plugins->Add New page in the WordPress administration panel.\r\n2. Activate the plugin through the 'Plugins' menu in WordPress\r\n3. Go to Settings menu under 'WP Security' and start activating the security features of the plugin.\r\n\r\n== Usage ==\r\n\r\nGo to the settings menu after you activate the plugin and follow the instructions.\r\n\r\n== Screenshots ==\r\nCheck the following page for screenshots:\r\nhttps://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin\r\n\r\n== Frequently Asked Questions ==\r\nCheck the following page for F.A.Q (see the faq section):\r\nhttps://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin\r\n\r\n== Upgrade Notice ==\r\nNone\r\n\r\n== Changelog ==\r\n\r\n= 4.4.6 =\r\n- Fixed potential vulnerability with the Banned User Agents feature (in the blacklist menu).\r\n\r\n= 4.4.5 =\r\n- Fixed default DateTime to prevent DB error.\r\n- Added Korean language translation files. Thanks to Jonghyun Cho.\r\n- Reworked the code for the \"Generate New DB Table Prefix\" feature to make it more robust. Thanks to @baddiedev.\r\n- Added translation ability to some strings.  \r\n\r\n= 4.4.4 =\r\n- Fixed bugs and improved functionality related to \"logged in users\" functionality.\r\n- Google recaptha checks for WooCommerce product reviews\r\n- Replaced use of deprecated hook \"wpmu_new_blog\" with \"wp_insert_site\"\r\n- Fixed a potential XSS issue in the settings menu of the plugin for IE11 or older browsers.\r\n\r\n= 4.4.3 =\r\n- Improved file change detection feature to address DB backups failing silently in some cases due to very large serialized data stored in a single row.\r\n- Added new action hook (aiowps_rename_login_load) just before renamed login page is loaded.\r\n- Added a check to ensure that woocommerce captcha settings are displayed only if woocommerce plugin is installed/active.\r\n- Fixed recaptcha bugs.\r\n- Added configurable item for max file upload size in basic firewall rules.\r\n\r\n= 4.4.2 =\r\n- Fixed vulnerability related to open redirect and exposure of hidden login page for specific case. (Thanks to Erwan (wpscanteam) for letting us know)\r\n\r\n= 4.4.1 =\r\n- Fixed bug where Apache directives were not being re-added into the .htaccess file after plugin re-activation.\r\n- Fixed bug related to account activity logout date not being set.\r\n\r\n= 4.4.0 =\r\n- Added robustness to login lockdown feature by replacing the strtotime function with DateTime/DateInterval. \r\nThis should prevent 32-bit systems from being constrained to the max date of 19 Jan 2038.\r\n- Fixed bugs related to captcha features.\r\n- Fixed and improved \"Logged In Users\" functionality for multisite.\r\n- Always set valid dates, to avoid errors when strict mode is enabled on mysql. Thanks to Davide.\r\n\r\n= 4.3.9.4 =\r\n- Removed whois feature because it adds relatively little value and the third-party library used is not being maintained regularly.\r\n- Fixed \"headers already sent\" error when bulk action performed using aiowps list table.\r\n\r\n= 4.3.9.3 =\r\n- Fixed another captcha bug related to comment form.\r\n\r\n= 4.3.9.2 =\r\n- Fixed various captcha bugs: woocommerce lost password page, custom login form page, etc\r\n\r\n= 4.3.9.1 =\r\n- Fixed rename login page feature bug introduced after WP core change in version 5.2.\r\n\r\n= 4.3.9 =\r\n- Fixed captcha bug.\r\n- Fixed PHP_EOL issue where some IPv6 and v4 addresses saved in settings were incorrectly deemed invalid.\r\n- Tightened file permission for wp-config.php to \"640\"\r\n- Fixed DB prefix change bug for cases where DB had tables of type \"view\".\r\n- Fixed some translation string issues.\r\n- Minor style fix for wp list table pagination nav buttons.\r\n\r\n= 4.3.8.3 =\r\n- Trying again - Fixed login captcha authentication bug.\r\n\r\n= 4.3.8.2 =\r\n- Fixed login captcha authentication bug.\r\n\r\n= 4.3.8.1 =\r\n- Minor bug fix - added missing check to enqueue recaptcha script only if that feature is enabled.\r\n\r\n= 4.3.8 =\r\n- Added ability to hide secret rename login page link when sending emails to people asking for personal data export.\r\n- Fixed Google reCaptcha not showing on comment page.\r\n- Fixed activation handler and creation of DB tables to handle multi-site activations more robustly.\r\n- Improved reCaptcha code to prevent the occasional occurrence of \"Uncaught Error: reCAPTCHA placeholder element must be an element or id\" error.\r\n- Added extra check for PHP_OS value to prevent Apple \"DARWIN\" being interpreted as windows server.\r\n- Corrected some minor translation issues on rename login page.\r\n- Increased priority of authenticate hook for captcha check.\r\n- Updated the Dutch Language file.\r\n\r\n= 4.3.7.2 =\r\n- More \"get_home_path\" fatal error preventions.\r\n\r\n= 4.3.7.1 =\r\n- Fixed fatal error regarding \"get_home_path\" function.\r\n\r\n\r\n= 4.3.7 =\r\n- Added Google reCaptcha feature for login forms.\r\n- Improved code which checks if site is main for multi-site installations.\r\n- Removed the text domain string from the translation functions in the wp-security-rename-login-feature.php file.\r\n- Changed .htaccess path location to use get_home_path().\r\n- Fixed minor woocommerce captcha bug\r\n\r\n= 4.3.6 =\r\n- Added new tab called \"WP REST API\" in the Miscellaneous menu and created separate feature which disables unauthorized REST access for non-logged in users independent of the users enumeration feature.\r\n- Improved dashboard page widget area display.\r\n- Small translation string fix in the rename login page feature.\r\n\r\n= 4.3.5 =\r\n- Fix - Error: Call to undefined function the_privacy_policy_link() in older versions of WordPress.\r\n- Added a check to disable file change detection feature and prevent fatal errors when FilesystemIterator is not available due to old versions of PHP.\r\n- Improved get_login_fail_count method in the AIOWPSecurity_User_Login class which will fix cases where login lockdown \r\nwas not working on some servers due to timestamp difference between PHP current_time( 'mysql' ) and mysql now().\r\n\r\n= 4.3.4 =\r\n- Modified rename login page to handle GDPR Export/Erase Personal Data request.\r\n- Fixed woocommerce registration page captcha bug.\r\n- Improved users enumeration so that authenticated requests to the REST API are allowed but others are blocked.\r\n- Improved logic in Renamed Login Page settings such that unnecessary call of AIOWPSecurity_Utility_Htaccess::write_to_htaccess() function is avoided.\r\n\r\n= 4.3.3.1 =\r\n- Fixed a typo with the newly added action hook - aiowps_before_wp_die_renamed_login\r\n\r\n= 4.3.3 =\r\n- Fixed bug - aiowps will now allow access to admin-post.php from front-end when rename login feature is active.\r\n- Modified login lockdown feature so that the exact IP address is locked down and not the IP range.\r\n- Added new filter (aiowps_ip_blocked_output_page) which allows user to filter the complete output when someone's IP has been locked out.\r\n- Added new action hook (aiopws_before_wp_die_renamed_login) for the renamed login feature which fires just before the wp_die event which produces the \"Not available\" behaviour.\r\n- Removed unused code.\r\n- Modified get_user_ip_address to get the first IP address in cases where there are multiple comma separated addresses provided - example X-Forwarded-For.\r\n\r\n= 4.3.2 =\r\n- Added new IP address settings page which user the ability to configure which $_SERVER global the IP address will be retrieved from. (New setting found in WP Security >> Settings >> Advanced Settings)\r\n- Fixed bug in .htaccess rules caused when 6G and IP blacklist firewall rules were simultaneously enabled.\r\n- Fixed bug where captcha answer was being ignored on woocommerce login page.\r\n- Added support for unlock requests made from woocomerce account login page when rename login feature is active.\r\n- Added useful debug code for troubleshooting in the fake googlebot function.\r\n- Some general code cleanup and improvement.\r\n- Added code to prevent direct access data leaks.\r\n- Added captcha settings for BBPress new topic form.\r\n- Fixed minor bug in dashboard page when checking if htaccess rules applied.\r\n- Added a check for Windows server installation in File Permissions feature - this feature is not applicable for Windows servers.\r\n- Added check to display comment captcha only when user not logged in.\r\n\r\n= 4.3.1 =\r\n- Improved white list directives to cater for Apache 2.4 and earlier versions.\r\n- Added 3 filters for the manual account registration approval email: aiowps_register_approval_email_subject, aiowps_register_approval_email_msg, aiowps_register_approval_email_from_name\r\n- Added configuration option to allow custom firewall rules to be applied at beginning of all rules applied by aiowps.\r\n- Changed record insertions to DB table aiowps_failed_logins to store the full IP address instead of IP range.\r\n\r\n= 4.3.0 =\r\n- Updated wp-security-rename-login-feature.php to include latest WordPress core changes.\r\n- Added captcha for woocommerce login and registration forms.\r\n- Fixed \"mixed line endings\" warnings for whois library.\r\n- Moved DB cleanup task cron job from daily to hourly.\r\n- Updated the reapply htaccess function so it doesn't create the header already sent error.\r\n\r\n= 4.2.9 =\r\n- Changed the parameter in current_user_can function to use an administrator capability instead of the \"administrator\" role name.\r\n- Added some new hooks to the AIOWPSecurity_WP_Loaded_Tasks called aiowps_wp_loaded_tasks_start and aiowps_wp_loaded_tasks_end.\r\n- Improved get_locked_ips() function and added $wpdb->prepare statement.\r\n- Added more missing translation domain parameters for translatable strings in the rename login page.\r\n- Deleted local copy of the Persian and Italian language files. These translations are available on translate.wordpress.org.\r\n- Domain path and text domain added to plugin header.\r\n- Changed the get_user_ip_address functions so that $_SERVER['REMOTE_ADDR'] is the primary method used to obtain IP address.\r\n- Added enumeration block via REST API (wp >= 4.7)\r\n\r\n= 4.2.8 =\r\n- Improved \"User Registration\" feature to bypass the pending approval status for new users created in admin side.\r\n- Fixed bug in whois library.\r\n- Added translation domain parameter for translatable strings in the rename login page.\r\n- Updated the chinese language file.\r\n\r\n= 4.2.7 =\r\n- The PHPWhois library updated to their latest version to include a security patch.\r\n\r\n= 4.2.6 =\r\n- Added new Login Lockdown whitelist feature which allows immunity for IP address or ranges from being locked by the lockdown feature.\r\n- Fixed bug - Replaced date_i18n with current_time to prevent cases where some localizations produce foreign characters in date stamp output.\r\n- Added a new feature to add Honeypot to the WordPress's user registration form (this can help reduce registration attempts by robots).\r\n- Added \"Export to CSV\" buttons for 404 Event Logs, Account Activity Logs and Failed Login Records.\r\n- Minor update to 6G rules.\r\n- Minor spelling and wording fixes and changes.\r\n\r\n= 4.2.5 =\r\n- Fixed bug - added code which caters for mysql view definitions when DB prefix is changed.\r\n- Fixed a typo in the user login security menu.\r\n- Fixed storage of time stamp in lockdown table to match the local Wordpress server time and be consistent with the timestamp stored in the failed logins table.\r\n- Prevent direct access to wp-security-core.php\r\n- Updated the POT file.\r\n\r\n= 4.2.4 =\r\n- Fix error on block_ip_if_locked(), doesn't exit with a wp_user. This is needed for other plugins that create the $user (aka ldap auth plugins).\r\n- Fix login error message for users with pending account approval.\r\n- Wordpress 4.7 compatibility.\r\n\r\n= 4.2.3 =\r\n- Fixed bug when math captcha was displayed on Woocommerce registration page.\r\n- Fixed login page bug for cases where email address and captcha are used to submit login form (thanks to @chesio for fix).\r\n- Logs directory now contains a .htaccess file with proper deny directives.\r\n- Small UX improvement: add for attribute to captcha label.\r\n- Added check for IIS server in get_server_type function.\r\n\r\n= 4.2.2 =\r\n- Debug logger class improvements.\r\n- Added a message in the debug settings area to state that the log files are reset on every plugin update.\r\n- Always return an array from scan_dir_sort_date() to prevent PHP notices.\r\n- Improvements for Automated DB backups filling up space - old backup file will be deleted first.\r\n- Thanks to RIPS Analyzer for sending us the vulnerability report. \r\n\r\n= 4.2.1 = \r\n- Improve output of .htaccess to include <IfModule mod_rewrite.c> checks and RewriteEngine On directives.\r\n- Fall back to default DB backup interval in case of invalid value.\r\n- The aiowps_delete_backup_files() function will produce a debug log message on every call (to help with troubleshooting when needed).\r\n\r\n= 4.2.0 =\r\n- WPML plugin compatibility fix for the renamed admin login page feature.\r\n- Fixed a few potential XSS vulnerabilities.\r\n\r\n= 4.1.9 =\r\n- Small improvement to the new \"immediate blocking of specific usernames\" feature.\r\n\r\n= 4.1.8 =\r\n- New feature to allow immediate blocking of specific usernames.\r\n- Only activate copy (right-click) protection for non-admin users.\r\n- Fixed bug where logout link in admin bar does not get updated on after the $_POST submit to reflect the new rename login setting.\r\n- Fixed small bug in return_regularized_url function.\r\n- Improvement/bug fix: When currently logged in user attempts to access renamed login page, redirect them to dashboard.\r\n- Removed Spanish language files so they can be automatically pulled from WordPress.org.\r\n- Drop unnecessary WHERE clause in some backend listings.\r\n- Improvement: do not schedule a cronjob, if it is already scheduled.\r\n\r\n= 4.1.7 =\r\n- Added sanitisation for log file data in textarea.\r\n- Disabled autocomplete for Captcha field.\r\n\r\n= 4.1.6 =\r\n- Added cleanup code for captcha string info transients.\r\n- Minor change to the username label in the renamed login page to keep it inline with the standard WordPress login page.\r\n- Fixed a potential vulnerability when viewing AIOWPS log files in the Dashboard menu. Thanks to Manuel LLOP for pointing this out.\r\n\r\n= 4.1.5 =\r\n- Fixed bug where username is an email and captcha was being ignored.\r\n- Reduce memory footprint of database backup.\r\n- Improvements: Make hard-coded strings localizable.\r\n- Partial Apache 2.3 compatibility.\r\n- Improved: Hide WP version number by replacing it with a hash. This way, WordPress version number is not exposed, but browser caching is not obscured by missing version numbers.\r\n\r\n= 4.1.4 =\r\n- Improved and tweaked the login captcha feature to avoid some issues people had with the last modification.\r\n- Deleted reference to ini_get('safe_mode') to avoid fatal errors for newer versions of PHP where that setting has been totally removed.\r\n\r\n= 4.1.3 =\r\n- Added new checkbox for XMLRPC to disable only pingback methods but leave other XMLRPC functionality accessible. This will be useful for people who use Jetpack or Wordpress iOS or other apps.\r\n- Updated the French language file.\r\n- Fix: decbin doesn't add leading zero. Comparing empty strings return bad results.\r\n- Fix: bugfix in the login captcha. Thanks to Sipke Mellema for pointing it out.\r\n\r\n= 4.1.2 =\r\n- Fixed bug introduced by last file change scanner code changes.\r\n- Fixed bug in SPAM comment blocking functionality.\r\n- Fixed fatal error case when Divi theme and front end lockout is enabled.\r\n\r\n= 4.1.1 =\r\n- Fixed Fatal error conflict between Rename Login feature and Yoast SEO and some themes when attempting to access wp-admin page directly.\r\n- Added \"Pending Approval\" message when manual registration approval feature is enabled and a user registers.\r\n- Fix (minor): No need to use strcmp to compare integer values.\r\n- Updated and simplified wp-security-stop-users-enumeration.php for bug (thanks to @davidegiunchidiennea)\r\n- Minor code cleanup (Thanks to @chesio for the following changes).\r\n- File scanner codebase cleanup.\r\n- Fix: properly report invalid email addresses in file scanner configuration.\r\n- Code clean-up in AIOWPSecurity_Scan::do_file_change_scan() method.\r\n- Tweak: Compare file scan data faster.\r\n\r\n= 4.1.0 =\r\n- Fixed bug in Maintenance menu page when trying to attach a media file to the message text box.\r\n- Added a new filter (called \"aiowps_ip_blocked_error_msg\") which allows the modification of the error message displayed on the login page when an IP address has been blocked by the login lockdown feature.\r\n- Updated French language translation. Thanks to Claude Ribaux for providing the translation files.\r\n- Thanks to @chesio for making the following two changes.\r\n- Replaced deprecated call to get_currentuserinfo() function.\r\n- Minor code fixes in the backup class file.\r\n- Fix: display correct (error) message when write_to_htaccess() fails.\r\n- Tweak: database backup filename is more human-readable. \r\n  Before: 24x7eg8l6i-database-backup-1463042767.zip\r\n  After: database-backup-20160512-104607-24x7eg8l6i.zip\r\n\r\n= 4.0.9 =\r\n- Made file change scanner code more robust for cases when open_basedir restriction is in effect. (Thanks to Manuel Jeanne for pointing this out).\r\n- Added code which will remove WordPress version info during CSS and JS script loading if you have the \"Remove WP Generator Meta Info\" option checked. (Thanks to aldemarcalazans for pointing this out).\r\n- Fixed some potential SQL injection vulnerabilities. (Thanks to Julio Potier for pointing these out).\r\n- Changed the feature category of blacklist manger from \"Intermediate\" to \"Advanced\".\r\n- Tweak: Remove \"@\" from list of characters blocked by advanced character string filter. (Because it is often used in retina-ready images).\r\n- Fix: Use home URL instead of site URL in lock notification email subject. Thanks to @chesio for fixing this.\r\n\r\n= 4.0.8 =\r\n- Added ability to identify IP addresses during user registration and option to block selected IPs.\r\n- Added login form captcha functionality for sub-sites in a multi-site installation. (see the Brute Force menu)\r\n- Fixed multi-site bug related to manual user-chosen DB prefix change.\r\n- Added extra XSS protection inside admin menu pages for the \"tab\" query parameter.\r\n- Added a note to the features that has the potential to lock you out if it doesn't work correctly on your site.\r\n- Updated Brazil-Portuguese language file.\r\n- Fixed issue with firewall custom rules being corrupted by magic quotes. Thanks to @chesio for fixing this.\r\n\r\n= 4.0.7 =\r\n- Added a new action hook \"aiopws_before_set_404\" which triggers just before the AIOWPS sets a 404. (handy for cases when rename login page is used which affects some themes when accessing \"wp-admin\" directly)\r\n- Fixed some potential SQL injection vulnerabilities.\r\n- Thanks to @chesio for submitting the following changes and applying the fixes.\r\n- Sub-directory install fixes.\r\n- Improve behavior of WP File Access tab. \r\n- Fix invalid nesting of HTML elements.\r\n- Do not block HTTP requests that contain \"tag=\" in query string.\r\n- Option to enable the 6G firewall.\r\n\r\n= 4.0.6 =\r\n- Removed the viewing of contents of wp-config.php and .htaccess files in order to protect sensitive info.\r\n- Fixed more potential XSS vulnerabilities in some other settings pages. (Once again many thanks to Erin Germ for pointing these out)\r\n\r\n= 4.0.5 =\r\n- Fixed some potential XSS vulnerability in the blacklist, file system and file change detection settings pages. (Many thanks to Erin Germ for pointing these out)\r\n\r\n= 4.0.4 =\r\n- Added new feature: Auto Block Spammer IPs. This feature will automatically and permanently block IP addresses which are linked to comment SPAM. (see SPAM Prevention -> Comment SPAM IP Monitoring tab)\r\n- Added compatibility fix for the qTranslate-X plugin in the rename login page feature.\r\n- Added ability to send to more than one email address for file change detection feature notification.\r\n- Fixed bug in whois library when searching ARIN registry.\r\n- Fixed the handling of display of longer IPV6 strings in dashboard summary table.\r\n- Added hook for WooCommerce login form to display unlock button.\r\n- Added Dutch language translation. Thanks to Jeroen van der Linde for providing the translation files.\r\n- Typo fix in the \"stop users enumeration\" feature.\r\n\r\n= 4.0.3 =\r\n- Added urlencode to query strings in URLs to prevent unexpected behaviour. Thanks to @chesio for spotting the issue.\r\n- Added new feature to stop users enumeration. Thanks to Davide Giunchi @davidegiunchidiennea for adding this.\r\n- Added a more robust code for check_user_exists function. Thanks to Christian Carey.\r\n- Added cron cleanup of the global meta table.\r\n- Added a title in each of the admin interface menu.\r\n\r\n= 4.0.2 =\r\n- Added ability to enable/disable debug from the settings menu.\r\n- Fixed bug related to using IP ranges in the whitelist settings.\r\n- Added IPv6 support for the whitelist feature.\r\n- Added check in file permissions feature for cases where wp-config.php may be located outside of root.\r\n- Added wp cron DB cleanup events for various tables which may grow large over time.\r\n- Changed firewall rule for proxy comment prevention to reflect suggestion made by Thomas O. in forum (https://wordpress.org/support/topic/high-server-cpu-with-proxy-login)\r\n- Fixed CSS styling issue in admin pages for WordPrss 4.4\r\n\r\n= 4.0.1 =\r\n- Renamed the language files to match the new textdomain slug to fix the language translation bug.\r\n- Fixed bug related to the rename login feature and force logout or logout expiry events.\r\n- Applied fix for log being generated by events table DB insert.\r\n- Corrected a function call to static version of display error msg.\r\n\r\n= 4.0.0 =\r\n- Updated text domain to match expected value for translate.wordpress.org translation system.\r\n- Fixed bug related to multi-site user_roles not being updated for child sites.\r\n- Fixed minor bug in rename login feature.\r\n- Updated the Italian language file. \r\n\r\n= 3.9.9 =\r\n- Fixed an issue with the rename login page feature for WordPress 4.3\r\n- Added esc_attr() sanitization to some of the relevant parameters\r\n- Added the necessary changes to allow activation via wp-cli\r\n\r\n= 3.9.8 =\r\n- Added guard against possible XSS in the unlock request feature.\r\n\r\n= 3.9.7 =\r\n- Added new feature which allows custom .htaccess rules. (See \"Custom Rules\" tab in Firewall menu). You can now use this to add custom rules to block access to various resources on your site.\r\n- Added a new feature to block access to the wp-content/debug.log file (WordPress creates this file if you enabled debug loggin option in the config file).\r\n- Removed the \"v\" from version number of the plugin.\r\n- Completed testing with WordPress 4.3.\r\n\r\n= 3.9.6 =\r\n- Added Rename Login page feature from the \"Brute Force\" menu to multisite sub-sites.\r\n- Removed invalid \"length\" attribute from input element in captcha code.\r\n- Fixed reset password feature whereby the URL which is sent out in the email for cases when rename login feature is enabled was not decoded properly.\r\n- Corrected the check for boolean false if returned from wpdb query result.\r\n- Added media button for wp editor in maintenance settings page.\r\n\r\n= 3.9.5 =\r\n- Fixed minor bug - IP addresses blocked due to '404' were not being listed in the display table.\r\n- Updated the Russian language translation file.\r\n- The automatic database table prefix generation value will use a-z characters only.\r\n- Added esc_url sanitization to the add_query_arg/remove_query_arg function instances to prevent possible XSS.\r\n\r\n= 3.9.4 =\r\n- The sort order and orderby parameters now use a whitelisting approach for sanitization.\r\n\r\n= 3.9.3 =\r\n- Fixed the sort order not working in the 404 error logging and account activity page.\r\n\r\n= 3.9.2 =\r\n- Added a check for registration captcha feature to prevent errors when using another captcha plugin. \r\n- Improved a few SQL statements.\r\n\r\n= 3.9.1 =\r\n- Added new \"Force Logout\" feature which will instantly force a certain user to be logged out of their session. (See the \"Logged In Users\" tab in User Login menu)\r\n- Added more security protection for aiowps log files by creating .htaccess file and rules. AIOWPS log files can now only be viewed via dashboard menu, in new tab called \"AIOWPS Logs\". (NOTE:This security currently applies only for apache or similar servers)\r\n- Added backticks to SQL statement for DB prefix change to help prevent errors.\r\n- Added protection against possible SQL injection attacks.\r\n\r\n= 3.9.0 =\r\n- Added some robustness to the file-scan code.\r\n- Added extra security to all relevant list table instances to prevent unlikely malicious deletion commands.\r\n- Fixed the user agent part of the blacklist settings code to allow user-agents to be cleared upon saving.\r\n\r\n= 3.8.9 =\r\n- Fixed bug in the new feature which allows permanent blocking of IP addresses that create 404 events.\r\n- Fixed minor bug for all instances where wpdb \"prepare\" was being used with order/orderby parameters.\r\n- Fixed a possible open redirect vulnerability. Thanks to Sucuri for pointing it out.\r\n\r\n= 3.8.8 =\r\n- Added extra robustness and security for wp list table db commands by using wpdb \"prepare\" command.\r\n- Fixed minor bug with undeclared variable in rename login feature page.\r\n\r\n= 3.8.7 =\r\n- Added an improvement for login lockdown feature - locked IP addresses will no longer be allowed to register.\r\n- Added a \"view\" link for each account in the pending registration approval table list.\r\n- Fixed 404 logging/lockout bug.\r\n- Added ability to permanently block IP addresses from the 404 event list for both bulk and single cases.\r\n- Added ability to do bulk temp blocking for IP addresses in 404 list.\r\n- Fixed a minor bug with validate_ip_list function.\r\n\r\n= 3.8.6 =\r\n- DB cleanup cron event bug fixed.\r\n- Added Swedish language translation. The translation was submitted by Tor-Bj\u00f6rn Fjellner.\r\n- Updated the Russian language translation file. Update submitted by Tor-Bj\u00f6rn Fjellner.\r\n- The events table will automatically be cleaned up so it only keeps the last 5000 entries. You can override it using a filter (if you wanted to).\r\n\r\n= 3.8.5 =\r\n- Added functionality to prevent the aiowps_events table from getting too large.\r\n- Added file change scan summary inside the alert email.\r\n- Fixed the unlock feature so that it works correctly when the Rename Login Page feature is active.\r\n- Added a check in the list logged in users file to prevent error when get_transient returns false.\r\n\r\n= 3.8.4 = \r\n- Updated POT language file.\r\n- Tweaked the function which retrieves the IP address to handle cases where traffic is coming from cloudflare\r\n- The MySQL database will not be forced anymore at the time of creating the table. It also reads the characters set value from the system first.\r\n- Applied fixes to prevent remotely exploitable vulnerabilities.\r\n\r\n= 3.8.3 = \r\n- Modified \"Pingback Protection\" .htaccess rules to prevent xmlrpc login attacks and to be compatible with more servers.\r\n- Made improvements to ensure that the rename login and white list features can be used together.\r\n- Added a check to force user to enter alphanumeric string for renamed login slug.\r\n- Improved the turn_off_all_firewall_rules() and turn_off_all_security_features() functions so that they also handle the updating of the htaccess file.\r\n- Added an alternative way to import settings via a text box (Thanks to Dave McHale). This is for people who might have issues using the config settings file uploader. \r\n- Added fix to properly update options tables when changing DB prefix in multisite system.\r\n- Greatly improved the Renamed Login Page feature by removing various potential vulnerabilities.\r\n- Added an if statement check to fix bug with rename login page feature - special case where user had non permalink structure was not working correctly in some rare scenarios.\r\n- Updated the Italian language file.\r\n- Fixed bug regarding wp_mail malformed header when \"From\" string was empty due to \"site title\" not being set.\r\n- Fixed bug in IP list validation function for blacklist feature.\r\n- Removed strict filtering of IP addresses so as to allow internal IP address ranges.\r\n- Added stripping of orderby and order query parameters in the plugin.\r\n- Added search capability by IP address, URL or referer for the 404 events list table. \r\n\r\n= 3.8.2 = \r\n- Fixed a CSS issue with the honeypot feature.\r\n- Fixed a call to the login action handler static function.\r\n\r\n= 3.8.1 =\r\n- Minor bug fix for the honeypot feature - loading of css style sheet was not occurring when main login page rendered.\r\n\r\n= 3.8.0 =\r\n- Improved deactivation and re-activation tasks - AIOWPS will now gracefully clean up the .htaccess rules when the plugin is deactivated.\r\n- Tweaked code so that all login pages including custom ones will correctly load the CSS style sheet file needed for honeypot feature.\r\n- Updated the Portugese language translation.\r\n- Fixed the copy protection feature so it doesn't interfere with iframes and shortcodes.\r\n- The plugin will now work fine even if your wp-config.php file is outside the wordpress root folder.\r\n\r\n= 3.7.9.2 =\r\n- copy protection feature JS code improvement \r\n\r\n= 3.7.9.1 =\r\n- Added captcha functionality for custom login form which is produced by the WP function: wp_login_form()\r\n- Fixed a minor bug with the copy protection feature's JavaScript code.\r\n- Tweaked file change scan algorithm to help prevent getMTime fatal runtime errors.\r\n- Added a link to the github repository in the readme.txt file for developers.\r\n\r\n= 3.7.9 =\r\n- Fixed a small bug related to the cookie test in the Cookie Based Brute Force feature.\r\n\r\n= 3.7.8 =\r\n- Added new feature called Login Honeypot which will help reduce brute force login attempts by robots. (This can be found in the Brute Force menu)\r\n- Added new feature to prevent other sites from displaying your content via a frame or iframe. (This can be found in the Miscellaneous menu)\r\n- Added captcha feature for BuddyPress registration form.\r\n- Added a new filter for the site lockout message so it can be customized.\r\n- Added a new filter for template include of the site lockout feature.\r\n- Temporarily deactivated the \"DB Scan\" feature.\r\n\r\n= 3.7.7 =\r\n- Improved DB prefix change code to make it more robust.\r\n- Fixed a minor bug for the Rename Login page feature.\r\n- Added check when processing rename login page to see if maintenance (lockout) mode enabled. Plugin will now display lockout message instead of 404 page if site lockout enabled.\r\n- Made the Cookie Based Brute Force Prevention feature more secure by introducing a 10 digit random suffix to the test cookie name.\r\n\r\n= 3.7.6 =\r\n- Added ability to insert captcha in WordPress Multi Site registration form.\r\n- Added a condition around the management permission constant. This will allow users to define a custom capability for this plugin's admin side via the wp-config file. This was submitted by Samuel Aguilera.\r\n- Fixed a bug with the hidden login page feature.\r\n- Fixed a small settings bug with the \"block fake google bot\" feature.\r\n\r\n= 3.7.5 =\r\n- Added a new DB scan feature. Go to the \"Scanner\" menu to use this new feature.\r\n- Added new settings import/export feature.\r\n- Modified user accounts feature to alert administrator if one or both \"admin\" or \"Admin\" usernames are being used.\r\n- Added Persian language translation. The translation was submitted by Amir Mousavi Pour (me@ameer.ir).\r\n- Small change to get_mysql_tables function to prevent fatal error when mysqli query is unsuccessful.\r\n- Added Italian language translation. The translation was submitted by Marco Guglielmetti.\r\n\r\n= 3.7.4 =\r\n- Added a new feature to add copy protection for your front-end. You can find this feature under the \"Miscellaneous\" menu.\r\n- Fixed comment captcha bug for multi-site. Now this feature can be activated/deactivated for subsites of a multisite installation.\r\n- Added Hungarian language translation. The translation was submitted by Daniel Kocsis.\r\n- Moved the custom login page feature's handling code to wp-loaded hook so other plugins that modify the login page can do their task before our one is triggered. This change was suggested by Mark Hudnall.\r\n- Added German language translation. The translation was submitted by Manuel Fritsch.\r\n- Updated the Brazilian language translation file.\r\n\r\n\r\n= 3.7.3 =\r\n- Added Brazilian language translation. The translation was submitted by Sergio Siqueira.\r\n- Added two new action hooks for plugin activation and deactivation time.\r\n- Improved the get_user_ip_address() function so it handles cases when multiple addresses are returned due to proxy.\r\n- Fixed the mis-alignment of login page which was broken by WP3.9 when rename login feature is used.\r\n- WordPress 3.9 compatibility\r\n\r\n= 3.7.2 =\r\n- Added a PHP Info section in the system info interface to show some important PHP details of the server.\r\n- Added a filter to allow the user to have a custom translation in a place (which will be loaded instead of the default one from the plugin). This change was submitted by Samuel Aguilera.\r\n- Replaced myslqi fetch_all method with fetch_assoc to cover cases where some servers do not have the correct mysql drivers.\r\n- Added a new filter to allow manipulation of the htaccess rules from your custom code. The name of the filter is 'aiowps_htaccess_rules_before_writing'.\r\n- Added a \"Delete All 404 Event Logs\" button to purge all 404 logs from DB\r\n- Added code to automatically send an email to the registrant when an account has been manually \"Approved\" from the User Registration menu.\r\n\r\n= 3.7.1 =\r\n- Fixed a minor bug: dashboard link was pointing to the wrong tab for the \"Logged In Users\" tab.\r\n- Fix a bug with the login page captcha. The captcha wansn't shown if the rename login page feature was enabled at the same time.\r\n\r\n= 3.7 =\r\n- Added new feature - 404 detection. This allows you to log 404 events and block selected IPs. This feature can be found in the Firewall menu.\r\n- Added new dashboard info box to display number of blocked IP addresses in the lockout table.\r\n- Fixed bug where user could not access login page when maintenance mode and rename login page features were both active.\r\n- Tweaked the hotlinking .htaccess directives to cover both http and https.\r\n- Fixed code to prevent mysql errors due to some variables not having default value in failed login and lockdown tables\r\n- Replaced deprecated PHP function mysql_query with mysqli.\r\n- Added language file for Spanish language. The Spanish translation was done by Samuel Montoya.\r\n- Added code to hide the \"DB Prefix\" menu for the non-main sites in multi-site installation\r\n\r\n= 3.6 =\r\n- Added a new feature to prevent image hot-linking. (See the \"Prevent Hotlinks\" tab in the firewall menu)\r\n- Added a check in the Rename Login Page feature to prevent people from setting the slug to \"wp-admin\"\r\n- Fixed a small bug with Login Lockdown feature.\r\n\r\n= 3.5.1 =\r\n- Fixed a bug where the cookie-based brute force directives were not being deleted from the .htaccess file when the Rename Login Page feature was being activated.\r\n\r\n= 3.5 =\r\n- Added new feature which will Block Fake Googlebots from crawling your site. Check the Firewall menu for this new feature.\r\n- Added code to prevent users from having both the Rename Login Page and Cookie-Based Brute Force features active at the same time.\r\n- Added some useful info boxes in the dashboard: 1) to inform the user if the cookie based brute force or rename login page features are active, 2) last 5 logins to your site.\r\n- Fixed minor bug with .htaccess backup feature.\r\n- Updated the from email address value used for sending backups and file change notification. Thanks to @TheAssurer for the tip.\r\n- Updated the warning message for the disable index view feature.\r\n\r\n\r\n= 3.4 =\r\n- Consolidated \"Brute Force\" features by moving all such features to the \"Brute Force\" menu.\r\n- Improved the file change detection scan feature: Introduced a button allowing admin to view the file change results from the last scan and fixed small bug whereby the change detected flag was not being cleared for applicable cases.\r\n- Fixed a small bug with \"rename login page\" (hide admin login) feature.\r\n- Made wp-config.php and .htaccess file backups more secure. Thanks to @TheAssurer for the tip.\r\n- Made the login code more robust by catering for cases where the \"wp_login\" action was not passing 2 parameters.\r\n\r\n= 3.3 =\r\n- Added a brand new brute force prevention feature - Rename Login Page. This feature can be found in the new menu item called \"Brute Force\".\r\n- Modified the new unlock request feature so that the locked out user will only have to enter email address when they submit an unlock request.\r\n- Replaced the deprecated PHP function \"mysql_list_tables\" with alternative code.\r\n- Added warning message regarding WordPress iOS app when pingback protection feature in the firewall settings is active.\r\n- Added Malware scan tab and information.\r\n- Some minor html form and CSS corrections.\r\n\r\n= 3.2 =\r\n- Added new feature which allows users to generate an automated unlock request link via email when they get locked out because of the login lockdown feature.\r\n- Added a check to ensure that user cannot enter 0 minutes in the Force Logout feature.\r\n- Fixed translations so that various previously omitted strings can now be translated.\r\n- Added a new filter before locking down a user's IP address - aiowps_before_lockdown.\r\n- Generated a new translation (POT) file.\r\n\r\n= 3.1 =\r\n- Added a new feature that will allow you to add a captcha to the lost password form (useful if you are allowing user registration on your site).\r\n- Added ability to specify a system log file in the \"Host System Logs\" tab of the \"File System Security\" menu\r\n- Fixed a tab link bug. One link was going to the wrong menu tab.\r\n- Updated the POT file of the plugin.\r\n\r\n= 3.0 =\r\n- Added a new feature which allows you to add captcha to the Wordpress user registration page.\r\n- Added some more helpful comments and link to video tutorial in the brute force and white list features settings pages.\r\n\r\n= 2.9 =\r\n- Added new feature which automatically sets the status of newly registered wordpress user accounts to \"pending\" and allows manual approval by an administrator.\r\n- Improved robustness of file change detection iteration code.\r\n- WordPress 3.7 compatibility\r\n\r\n= 2.8.1 =\r\n- Improved the login captcha implementation\r\n- Changed the management permission to manage_options\r\n\r\n= 2.8 =\r\n- Added a feature to insert a simple math captcha to the WordPress comment form (to reduce comment spam). Check the spam prevention menu for this new feature.\r\n- Fixed a minor bug with bulk unlock/delete in user login menu\r\n- Fixed a minor bug with math captcha logic.\r\n\r\n= 2.7 =\r\n- Added a simple math captcha functionality for the WP login page. This is another easy yet effective way to combat Brute Force Login Attacks. You can enable this new feature from the user login security menu.\r\n\r\n= 2.6 =\r\n- Added a new Login Whitelist feature. This feature enables you to specify one or more IP addresses in a special whitelist which will have access to your WP login page.\r\nAll other IP addresses trying to access your WP login page which are not in the whitelist will be automatically blocked.\r\n- The IP address will also be included in the email that gets sent to the admin for the ip address lockout notification.\r\n- Language file loading fix for Chinese language.\r\n- Tweaked the code which creates a .htaccess file in the backup directory to ensure it gets run even if the directory already existed.\r\n- Made DB backups more secure.\r\n- Added more useful debug logs for .htaccess file manipulation failure scenarios.\r\n\r\n= 2.5 =\r\n- Added a new feature which will list the currently logged in users who have been active within the last 15 minutes.\r\n- Added a new feature in settings menu which will disable all firewall rules and clear all applicable directives in the .htaccess file.\r\n- Improved the way the wp-config.php file is handled when it contains an ending PHP tag \"?>\" (older sites that were using PHP4 earlier).\r\n\r\n= 2.4 =\r\n- Added new feature/checkbox which will instantly lockout IP address ranges which attempt to login with an invalid username.\r\n- Fixed a bug in the Comment SPAM IP Monitoring page where trying to block one or more IPs was failing.\r\n- Removed the word \"config\" from the list of bad query strings check (to add compatibility with a few more plugins)\r\n- Added a notice in the dashboard menu to show you if there are any recent file changes that the plugin detected.\r\n- Fixed bug with php File Editing feature. Code now also handles older style wp-config.php files which have the php end tag \"?>\"\r\n- Fixed bug with \"Disable All Security Features\" button functionality. When clicked, this will now also make the appropriate changes to the .htacces and wp-config.php files if necessary.\r\n- Changed the storage of backup files from the plugin's directory to the uploads directory. Also added a .htaccess file for security.\r\n- Fixed the way user-agent strings were written to the .htacess file from the Blacklist feature. The code now will correctly identify and represent spaces and escaped chars.\r\n- Fixed a bug related to sending backup to correct email address.\r\n\r\n= 2.3 =\r\n- Added new menu called Scanner with a new feature called File Change Detection. This feature will alert you if any files have changed, added or removed from your system.\r\n- Fixed \"Deny Bad Query Strings\" rules to not break the ability to drag components in the WordPress \"Appearance->Menus\" page\r\n- Fixed an activation time warning (on sites with WP_DEBUG option enabled)\r\n- Re-implemented the wp-config.php file content backup feature. It now directly downloads the contents of the file to your computer.\r\n- Multi-site enhancements: Suppressed access to configuration settings for features which are not allowed to be configured from subsites of multi-site installations.\r\n- Fixed a bug with login lockdown feature.\r\n\r\n= 2.2 =\r\n- Added a new feature which will block some spambots from submitting comments.\r\n- Moved Comment SPAM IP monitoring interface to the new \"SPAM Prevention\" menu.\r\n- Fixed a bug with login lockdown feature for both multi and single site.\r\n- Improved firewall feature for multi-site by making the \"Firewall\" menu available only for the main site and not the sub-sites.\r\n- Added random prefix to backup file names.\r\n- Fixed a bug for WP multi-site install where DB tables do not get created when new blog are created in the network.\r\n\r\n= 2.1.1 =\r\n- Fixed a version tagging issue.\r\n\r\n= 2.1 =\r\n- Fixed an issue with install time error on some sites for WordPress 3.6\r\n- Fixed some WP Debug related errors for WordPress 3.6\r\n- Replaced the deprecated $wpdb->escape() function calls with esc_sql() calls\r\n\r\n= 2.0 =\r\n- Fixed a bug for general DB backup functionality.\r\n- Fixed multi-site DB backup - the plugin will now backup only the tables relevant for the sub-site in question.\r\n- Added blank index.html files in various folders inside the plugin.\r\n- Disabled the wp-config.php file backup feature until we find a more secure method of doing the backup.\r\n\r\n= 1.9 =\r\n- Added new WordPress PingBack Vulnerability Protection feature. This allows the user to prohibit access to the xmlrpc.php file in order to protect against certain vulnerabilities in the pingback functionality.\r\n- Added a configuration item in the brute force login prevention feature to allow ajax functionality to work properly when this feature is enabled.\r\n- Added a POT file for language translations.\r\n- Made the DB Prefix feature more robust by adding a check to ensure that plugin can write to the wp-config.php file. This will prevent user from losing access to their site in cases where the system changed the prefix but not the entry in the wp-config.php file.\r\n- Tightened the data validation for the cookie based brute force login feature to ensure that the user must enter a secret word which consists of alphanumeric characters.\r\n- Added edit links to the user account list in the \"User Acounts\" menu.\r\n\r\n= 1.8 =\r\n- Moved the front end site lockout feature to a new menu called \"Maintenance\".\r\n- Added a feature in the front-end lockout feature to allow people to specify their own message which will be displayed on the front-end to visitors who try to access the site when it is in lock out state.\r\n- Fixed a bug in the front-end lockout feature by adding some checks which ensure that the admin will not get locked if the feature is still active and their login session expires or they log out.\r\n- Added a widget in the dashboard menu to show the status of the \"maintenance mode\" feature.\r\n\r\n= 1.7 =\r\n- Added a new feature which is a password strength tool which calculates how easy it is for your chosen password to be cracked using a desktop PC and the appropriate SW. This tool should help you create strong passwords.\r\n- Added a front-end general visitor lockout feature. This feature allows you to temporarily lock down the front end of your site while you do security investigation, site upgrades, tweaks etc.\r\n\r\n= 1.6 =\r\n- Added a new option in the cookie-based Brute Force Login Attack prevention feature to allow users to use this feature together with the WordPress's post/page password protection feature.\r\n- Fixed a bug in the 5G firewall rules to so that the printed rules include the correct number of '\\' characters.\r\n- Fixed a minor bug in the \"restore from backed up htaccess file\" feature.\r\n- Enhanced the \"Save current wp-config.php file\" feature so it will continue to work with all of the firewall rules active on the site.\r\n- Added extra checks to account for some error scenarios caused on some servers when recursive file search is done.\r\n\r\n= 1.5 =\r\n- Added new feature - Cookie-based Brute Force Login Attack Prevention. Check under the \"Firewall\" menu for this new feature.\r\n  This feature will stop hackers in their tracks when they try to access your wp-admin or login pages. This feature will secure your WordPress backend by enforcing the requirement that anybody trying to access these pages will require a special cookie.\r\n\r\n- Fixed bug related to setting of default configuration for first-time plugin activation.\r\n\r\n= 1.4 =\r\n- Tweaked the \"Deny Bad Query Strings\" firewall rules so that plugin deletion and update operations from the WordPress plugins menu are not affected.\r\n- Fixed a minor bug related to scheduled database backups.\r\n- Added some extra default settings to be applied to the plugin's configuration pages upon activation for the first time.\r\n- Plugin will now display a recommendation message if user sets scheduled backup frequency to less than 24 hours.\r\n\r\n= 1.3 =\r\n- Added a new feature to remove the WordPress Generator Meta information from the HTML source of your site.\r\n- Tweaked the \"Advanced Character String Filter\" to fix issue which was affecting plugins such as \"Admin Management Xtended\" and also pages with keywords such as \"password\" in the URL.\r\n- Updated one rule in the \"Advanced Character String Filter\" feature to make it compatible with W3 Total Cache Plugin's minify feature.\r\n- Added a \"Delete All Failed Login Records\" option in the \"Failed Login Records\" tab. This will delete all entries in the failed logins table and will make it less tedious for users who get a lot of brute force attacks on their site.\r\n\r\n= 1.2 =\r\n- Moved the rules which disable index views from the \"basic firewall\" rules to the \"additional rules\" section. This will prevent any site breakage for \r\nthose who want to enable the basic firewall but do not have \"AllowOverride\" option enabled in their httpd.conf\r\n\r\n= 1.1 =\r\n- Added the following new feature:\r\n- Prevent people from accessing the readme.html, license.txt and wp-config-sample.php files.\r\n\r\n= 1.0 =\r\n- First commit to the WP repository.\r\n", "<?php\r\n\r\nif ( !defined('ABSPATH') ) {\r\n    exit; // Exit if accessed directly\r\n}\r\n\r\nif (!class_exists('AIO_WP_Security')){\r\n\r\nclass AIO_WP_Security{\r\n    var $version = '4.4.6';\r\n    var $db_version = '1.9';\r\n    var $plugin_url;\r\n    var $plugin_path;\r\n    var $configs;\r\n    var $admin_init;\r\n    var $debug_logger;\r\n    var $cron_handler;\r\n    var $user_login_obj;\r\n    var $user_registration_obj;\r\n    var $backup_obj;\r\n    var $scan_obj;\r\n    var $captcha_obj;\r\n\r\n    function __construct()\r\n    {\r\n        $this->load_configs();\r\n        $this->define_constants();\r\n        $this->includes();\r\n        $this->loader_operations();\r\n\r\n        add_action('init', array(&$this, 'wp_security_plugin_init'), 0);\r\n        add_action('wp_loaded',array(&$this, 'aiowps_wp_loaded_handler'));\r\n        do_action('aiowpsecurity_loaded');\r\n    }\r\n\r\n    function plugin_url()\r\n    {\r\n        if ($this->plugin_url) return $this->plugin_url;\r\n        return $this->plugin_url = plugins_url( basename( plugin_dir_path(__FILE__) ), basename( __FILE__ ) );\r\n    }\r\n\r\n    function plugin_path()\r\n    {\r\n        if ($this->plugin_path) return $this->plugin_path;\r\n        return $this->plugin_path = untrailingslashit( plugin_dir_path( __FILE__ ) );\r\n    }\r\n\r\n    function load_configs()\r\n    {\r\n        include_once('classes/wp-security-config.php');\r\n        $this->configs = AIOWPSecurity_Config::get_instance();\r\n    }\r\n\r\n    function define_constants()\r\n    {\r\n        define('AIO_WP_SECURITY_VERSION', $this->version);\r\n        define('AIO_WP_SECURITY_DB_VERSION', $this->db_version);\r\n        define('AIOWPSEC_WP_HOME_URL', home_url());\r\n        define('AIOWPSEC_WP_SITE_URL', site_url());\r\n        define('AIOWPSEC_WP_URL', AIOWPSEC_WP_SITE_URL); // for backwards compatibility\r\n        define('AIO_WP_SECURITY_URL', $this->plugin_url());\r\n        define('AIO_WP_SECURITY_PATH', $this->plugin_path());\r\n        define('AIO_WP_SECURITY_BACKUPS_DIR_NAME', 'aiowps_backups');\r\n        define('AIO_WP_SECURITY_BACKUPS_PATH', AIO_WP_SECURITY_PATH.'/backups');\r\n        define('AIO_WP_SECURITY_LIB_PATH', AIO_WP_SECURITY_PATH.'/lib');\r\n        if (!defined('AIOWPSEC_MANAGEMENT_PERMISSION')){//This will allow the user to define custom capability for this constant in wp-config file\r\n            define('AIOWPSEC_MANAGEMENT_PERMISSION', 'manage_options');\r\n        }\r\n        define('AIOWPSEC_MENU_SLUG_PREFIX', 'aiowpsec');\r\n        define('AIOWPSEC_MAIN_MENU_SLUG', 'aiowpsec');\r\n        define('AIOWPSEC_SETTINGS_MENU_SLUG', 'aiowpsec_settings');\r\n        define('AIOWPSEC_USER_ACCOUNTS_MENU_SLUG', 'aiowpsec_useracc');\r\n        define('AIOWPSEC_USER_LOGIN_MENU_SLUG', 'aiowpsec_userlogin');\r\n        define('AIOWPSEC_USER_REGISTRATION_MENU_SLUG', 'aiowpsec_user_registration');\r\n        define('AIOWPSEC_DB_SEC_MENU_SLUG', 'aiowpsec_database');\r\n        define('AIOWPSEC_FILESYSTEM_MENU_SLUG', 'aiowpsec_filesystem');\r\n        define('AIOWPSEC_BLACKLIST_MENU_SLUG', 'aiowpsec_blacklist');\r\n        define('AIOWPSEC_FIREWALL_MENU_SLUG', 'aiowpsec_firewall');\r\n        define('AIOWPSEC_MAINTENANCE_MENU_SLUG', 'aiowpsec_maintenance');\r\n        define('AIOWPSEC_SPAM_MENU_SLUG', 'aiowpsec_spam');\r\n        define('AIOWPSEC_FILESCAN_MENU_SLUG', 'aiowpsec_filescan');\r\n        define('AIOWPSEC_BRUTE_FORCE_MENU_SLUG', 'aiowpsec_brute_force');\r\n        define('AIOWPSEC_MISC_MENU_SLUG', 'aiowpsec_misc');\r\n\r\n        global $wpdb;\r\n        define('AIOWPSEC_TBL_LOGIN_LOCKDOWN', $wpdb->prefix . 'aiowps_login_lockdown');\r\n        define('AIOWPSEC_TBL_FAILED_LOGINS', $wpdb->prefix . 'aiowps_failed_logins');\r\n        define('AIOWPSEC_TBL_USER_LOGIN_ACTIVITY', $wpdb->prefix . 'aiowps_login_activity');\r\n        define('AIOWPSEC_TBL_GLOBAL_META_DATA', $wpdb->prefix . 'aiowps_global_meta');\r\n        define('AIOWPSEC_TBL_EVENTS', $wpdb->prefix . 'aiowps_events');\r\n        define('AIOWPSEC_TBL_PERM_BLOCK', $wpdb->prefix . 'aiowps_permanent_block');\r\n\r\n    }\r\n\r\n    function includes()\r\n    {\r\n        //Load common files for everywhere\r\n        include_once('classes/wp-security-debug-logger.php');\r\n        include_once('classes/wp-security-utility.php');\r\n        include_once('classes/wp-security-utility-htaccess.php');\r\n        include_once('classes/wp-security-utility-ip-address.php');\r\n        include_once('classes/wp-security-utility-file.php');\r\n        include_once('classes/wp-security-general-init-tasks.php');\r\n        include_once('classes/wp-security-wp-loaded-tasks.php');\r\n\r\n        include_once('classes/wp-security-user-login.php');\r\n        include_once('classes/wp-security-user-registration.php');\r\n        include_once('classes/wp-security-captcha.php');\r\n        include_once('classes/wp-security-backup.php');\r\n        include_once('classes/wp-security-file-scan.php');\r\n        include_once('classes/wp-security-cronjob-handler.php');\r\n        include_once('classes/grade-system/wp-security-feature-item.php');\r\n        include_once('classes/grade-system/wp-security-feature-item-manager.php');\r\n        include_once('classes/wp-security-wp-footer-content.php');\r\n        include_once('classes/wp-security-blocking.php');\r\n\r\n        if (is_admin()){ //Load admin side only files\r\n            include_once('classes/wp-security-configure-settings.php');\r\n            include_once('admin/wp-security-admin-init.php');\r\n            include_once('admin/general/wp-security-list-table.php');\r\n\r\n        }\r\n        else{ //Load front end side only files\r\n        }\r\n    }\r\n\r\n    function loader_operations()\r\n    {\r\n        add_action('plugins_loaded',array(&$this, 'plugins_loaded_handler'));//plugins loaded hook\r\n\r\n        $debug_config = $this->configs->get_value('aiowps_enable_debug');\r\n        $debug_enabled = empty($debug_config) ? false : true;\r\n        $this->debug_logger = new AIOWPSecurity_Logger($debug_enabled);\r\n\r\n        if(is_admin()){\r\n            $this->admin_init = new AIOWPSecurity_Admin_Init();\r\n        }\r\n    }\r\n\r\n    static function activate_handler($networkwide)\r\n    {\r\n        global $wpdb;\r\n        //Only runs when the plugin activates\r\n        include_once ('classes/wp-security-installer.php');\r\n        AIOWPSecurity_Installer::run_installer($networkwide);\r\n        AIOWPSecurity_Installer::set_cron_tasks_upon_activation($networkwide);\r\n    }\r\n\r\n    static function deactivate_handler($networkwide)\r\n    {\r\n        //Only runs with the pluign is deactivated\r\n        include_once ('classes/wp-security-deactivation-tasks.php');\r\n        AIOWPSecurity_Deactivation::run_deactivation_tasks($networkwide);\r\n        do_action('aiowps_deactivation_complete');\r\n    }\r\n\r\n    function db_upgrade_handler()\r\n    {\r\n        if(is_admin()){//Check if DB needs to be upgraded\r\n            if (get_option('aiowpsec_db_version') != AIO_WP_SECURITY_DB_VERSION) {\r\n                include_once ('classes/wp-security-installer.php');\r\n                AIOWPSecurity_Installer::run_installer();\r\n            }\r\n        }\r\n    }\r\n\r\n    function plugins_loaded_handler()\r\n    {\r\n        //Runs when plugins_loaded action gets fired\r\n        if(is_admin()){\r\n            //Do plugins_loaded operations for admin side\r\n            $this->db_upgrade_handler();\r\n        }\r\n        $this->do_additional_plugins_loaded_tasks();\r\n    }\r\n\r\n    function wp_security_plugin_init()\r\n    {\r\n        //Set up localisation. First loaded overrides strings present in later loaded file\r\n        $locale = apply_filters( 'plugin_locale', get_locale(), 'all-in-one-wp-security-and-firewall' );\r\n        load_textdomain( 'all-in-one-wp-security-and-firewall', WP_LANG_DIR . \"/all-in-one-wp-security-and-firewall-$locale.mo\" );\r\n\tload_plugin_textdomain('all-in-one-wp-security-and-firewall', false, dirname(plugin_basename(__FILE__ )) . '/languages/');\r\n\r\n        //Actions, filters, shortcodes goes here\r\n        $this->user_login_obj = new AIOWPSecurity_User_Login();//Do the user login operation tasks\r\n        $this->user_registration_obj = new AIOWPSecurity_User_Registration();//Do the user login operation tasks\r\n        $this->captcha_obj = new AIOWPSecurity_Captcha();//Do the captcha tasks\r\n        $this->backup_obj = new AIOWPSecurity_Backup();//Object to handle backup tasks\r\n        $this->scan_obj = new AIOWPSecurity_Scan();//Object to handle scan tasks\r\n        $this->cron_handler = new AIOWPSecurity_Cronjob_Handler();\r\n\r\n        add_action('login_enqueue_scripts',array(&$this, 'aiowps_login_enqueue'));\r\n        add_action('wp_footer',array(&$this, 'aiowps_footer_content'));\r\n\r\n        add_action('wp_login', array('AIOWPSecurity_User_Login', 'wp_login_action_handler'), 10, 2);\r\n        do_action('aiowps_force_logout_check');\r\n        new AIOWPSecurity_General_Init_Tasks();\r\n    }\r\n\r\n    function aiowps_wp_loaded_handler()\r\n    {\r\n        new AIOWPSecurity_WP_Loaded_Tasks();\r\n    }\r\n\r\n    /**\r\n     * Enqueues the Google recaptcha v2 api URL for the standard WP login page\r\n     * @global type $aio_wp_security\r\n     */\r\n    function aiowps_login_enqueue()\r\n    {\r\n        global $aio_wp_security;\r\n        if($aio_wp_security->configs->get_value('aiowps_default_recaptcha')) {\r\n            if($aio_wp_security->configs->get_value('aiowps_enable_login_captcha') == '1' || $aio_wp_security->configs->get_value('aiowps_enable_registration_page_captcha') == '1') {\r\n                wp_enqueue_script( 'google-recaptcha', 'https://www.google.com/recaptcha/api.js', false );\r\n                // below is needed to provide some space for the google reCaptcha form (otherwise it appears partially hidden on RHS)\r\n                wp_add_inline_script( 'google-recaptcha', 'document.addEventListener(\"DOMContentLoaded\", ()=>{document.getElementById(\"login\").style.width = \"340px\";});' );\r\n            }\r\n        }\r\n    }\r\n\r\n    function aiowps_footer_content()\r\n    {\r\n        new AIOWPSecurity_WP_Footer_Content();\r\n    }\r\n\r\n    function do_additional_plugins_loaded_tasks()\r\n    {\r\n        global $aio_wp_security;\r\n        if(isset($_GET['aiowpsec_do_log_out']))\r\n        {\r\n            $nonce = isset($_GET['_wpnonce'])?$_GET['_wpnonce']:'';\r\n            if ( !wp_verify_nonce( $nonce, 'aio_logout' ) ) {\r\n                return;\r\n            }\r\n            wp_logout();\r\n            if(isset($_GET['after_logout']))//Redirect to the after logout url directly\r\n            {\r\n                $after_logout_url = esc_url($_GET['after_logout']);\r\n                AIOWPSecurity_Utility::redirect_to_url($after_logout_url);\r\n            }\r\n            $additional_data = strip_tags($_GET['al_additional_data']);\r\n            if(isset($additional_data))\r\n            {\r\n                $login_url = '';\r\n                //Check if rename login feature enabled\r\n                if($aio_wp_security->configs->get_value('aiowps_enable_rename_login_page')=='1'){\r\n                    if (get_option('permalink_structure')){\r\n                        $home_url = trailingslashit(home_url());\r\n                    }else{\r\n                        $home_url = trailingslashit(home_url()) . '?';\r\n                    }\r\n                    $login_url = $home_url.$aio_wp_security->configs->get_value('aiowps_login_page_slug');\r\n                }else{\r\n                    $login_url = wp_login_url();\r\n                }\r\n\r\n                //Inspect the payload and do redirect to login page with a msg and redirect url\r\n                $logout_payload = (AIOWPSecurity_Utility::is_multisite_install() ? get_site_transient('aiowps_logout_payload') : get_transient('aiowps_logout_payload'));\r\n                if(!empty($logout_payload['redirect_to'])){\r\n                    $login_url = AIOWPSecurity_Utility::add_query_data_to_url($login_url,'redirect_to',$logout_payload['redirect_to']);\r\n                }\r\n                if(!empty($logout_payload['msg'])){\r\n                    $login_url .= '&'.$logout_payload['msg'];\r\n                }\r\n                if(!empty($login_url)){\r\n                    AIOWPSecurity_Utility::redirect_to_url($login_url);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n}//End of class\r\n\r\n}//End of class not exists check\r\n\r\n$GLOBALS['aio_wp_security'] = new AIO_WP_Security();\r\n", "<?php\r\n/*\r\nPlugin Name: All In One WP Security\r\nVersion: 4.4.6\r\nPlugin URI: https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin\r\nAuthor: Tips and Tricks HQ, Peter Petreski, Ruhul, Ivy\r\nAuthor URI: https://www.tipsandtricks-hq.com/\r\nDescription: All round best WordPress security plugin!\r\nText Domain: all-in-one-wp-security-and-firewall\r\nDomain Path: /languages\r\nLicense: GPL3\r\n*/\r\n\r\nif(!defined('ABSPATH')){\r\n    exit;//Exit if accessed directly\r\n}\r\n\r\ninclude_once('wp-security-core.php');\r\nregister_activation_hook(__FILE__,array('AIO_WP_Security','activate_handler'));//activation hook\r\nregister_deactivation_hook(__FILE__,array('AIO_WP_Security','deactivate_handler'));//deactivation hook\r\n\r\nfunction aiowps_show_plugin_settings_link($links, $file)\r\n{\r\n    if ($file == plugin_basename(__FILE__)){\r\n            $settings_link = '<a href=\"admin.php?page=aiowpsec_settings\">Settings</a>';\r\n            array_unshift($links, $settings_link);\r\n    }\r\n    return $links;\r\n}\r\nadd_filter('plugin_action_links', 'aiowps_show_plugin_settings_link', 10, 2 );\r\n\r\nfunction aiowps_ms_handle_new_site($new_site){\r\n    global $wpdb;\r\n    $plugin_basename = plugin_basename( __FILE__ );\r\n    if (is_plugin_active_for_network($plugin_basename))\r\n    {\r\n        if(!class_exists('AIOWPSecurity_Installer')){\r\n            include_once('classes/wp-security-installer.php');\r\n        }\r\n        $old_blog = $wpdb->blogid;\r\n        switch_to_blog($new_site->blog_id);\r\n        AIOWPSecurity_Installer::create_db_tables();\r\n        switch_to_blog($old_blog);\r\n    }\r\n\r\n\r\n}\r\nadd_action('wp_insert_site', 'aiowps_ms_handle_new_site', 10, 1);\r\n"], "filenames": ["all-in-one-wp-security/admin/wp-security-blacklist-menu.php", "all-in-one-wp-security/readme.txt", "all-in-one-wp-security/wp-security-core.php", "all-in-one-wp-security/wp-security.php"], "buggy_code_start_loc": [9, 7, 10, 4], "buggy_code_end_loc": [262, 185, 11, 5], "fixing_code_start_loc": [9, 7, 10, 4], "fixing_code_end_loc": [262, 189, 11, 5], "type": "CWE-79", "message": "Cross-site scripting (XSS) vulnerability in admin/wp-security-blacklist-menu.php in the Tips and Tricks HQ All In One WP Security & Firewall (all-in-one-wp-security-and-firewall) plugin before 4.4.6 for WordPress.", "other": {"cve": {"id": "CVE-2020-29171", "sourceIdentifier": "cve@mitre.org", "published": "2021-02-10T15:15:13.243", "lastModified": "2021-02-11T22:54:22.060", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site scripting (XSS) vulnerability in admin/wp-security-blacklist-menu.php in the Tips and Tricks HQ All In One WP Security & Firewall (all-in-one-wp-security-and-firewall) plugin before 4.4.6 for WordPress."}, {"lang": "es", "value": "Una vulnerabilidad de tipo cross-site scripting (XSS) en el archivo admin/wp-security-blacklist-menu.php en el plugin Tips and Tricks HQ All In One WP Security &amp; Firewall (all-in-one-wp-security-and-firewall) versiones anteriores a 4.4.6 para WordPress"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:tipsandtricks-hq:wp_security_\\&_firewall:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "4.4.6", "matchCriteriaId": "21576873-A19A-4F75-8220-E5F5D25D315D"}]}]}], "references": [{"url": "https://github.com/Arsenal21/all-in-one-wordpress-security/commit/4130906bc049b195467b4fc6980d6d304fbe28d5", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://wordpress.org/plugins/all-in-one-wp-security-and-firewall/#developers", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}, {"url": "https://www.tipsandtricks-hq.com/wordpress-security-and-firewall-plugin", "source": "cve@mitre.org", "tags": ["Product", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Arsenal21/all-in-one-wordpress-security/commit/4130906bc049b195467b4fc6980d6d304fbe28d5"}}