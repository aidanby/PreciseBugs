{"buggy_code": ["<?\n\t$admin->requireLevel(1);\n\t$id = $admin->createUser($_POST);\t\n\t\n\tif (!$id) {\n\t\t$_SESSION[\"bigtree_admin\"][\"create_user\"] = $_POST;\n\t\t$admin->growl(\"Users\",\"Creation Failed\",\"error\");\n\t\tBigTree::redirect(ADMIN_ROOT.\"users/add/\");\n\t}\n\n\t$admin->growl(\"Users\",\"Added User\");\n\tBigTree::redirect(ADMIN_ROOT.\"users/edit/$id/\");\n?>", "<?\n\t$perms = json_decode($_POST[\"permissions\"],true);\n\t$_POST[\"permissions\"] = array(\"page\" => $perms[\"Page\"],\"module\" => $perms[\"Module\"],\"resources\" => $perms[\"Resource\"],\"module_gbp\" => $perms[\"ModuleGBP\"]);\n\t$_POST[\"alerts\"] = json_decode($_POST[\"alerts\"],true);\n\t$success = $admin->updateUser($_POST[\"id\"],$_POST);\n\t\n\tif (!$success) {\n\t\t$_SESSION[\"bigtree_admin\"][\"update_user\"] = $_POST;\n\t\t$admin->growl(\"Users\",\"Update Failed\",\"error\");\n\t\tBigTree::redirect(ADMIN_ROOT.\"users/edit/\".end($bigtree[\"path\"]).\"/\");\n\t}\n\t\n\t$admin->growl(\"Users\",\"Updated User\");\n\t\n\tBigTree::redirect(ADMIN_ROOT.\"users/\");\n?>"], "fixing_code": ["<?\n\tif ($_SERVER[\"HTTP_REFERER\"] != ADMIN_ROOT.\"users/add/\") {\n?>\n<div class=\"container\">\n\t<section>\n\t\t<p>To create a user, please access the <a href=\"<?=ADMIN_ROOT?>users/add/\">Add User</a> page.</p>\n\t</section>\n</div>\n<?\n\t} else {\n\t\t$admin->requireLevel(1);\n\t\t$id = $admin->createUser($_POST);\t\n\t\t\n\t\tif (!$id) {\n\t\t\t$_SESSION[\"bigtree_admin\"][\"create_user\"] = $_POST;\n\t\t\t$admin->growl(\"Users\",\"Creation Failed\",\"error\");\n\t\t\tBigTree::redirect(ADMIN_ROOT.\"users/add/\");\n\t\t}\n\t\n\t\t$admin->growl(\"Users\",\"Added User\");\n\t\tBigTree::redirect(ADMIN_ROOT.\"users/edit/$id/\");\n\t}\n?>", "<?\n\tif ($_SERVER[\"HTTP_REFERER\"] != ADMIN_ROOT.\"users/edit/\".$_POST[\"id\"].\"/\") {\n?>\n<div class=\"container\">\n\t<section>\n\t\t<p>To update a user, please access the <a href=\"<?=ADMIN_ROOT?>users/edit/<?=$_POST[\"id\"]?>/\">Edit User</a> page.</p>\n\t</section>\n</div>\n<?\n\t} else {\n\t\t$perms = json_decode($_POST[\"permissions\"],true);\n\t\t$_POST[\"permissions\"] = array(\"page\" => $perms[\"Page\"],\"module\" => $perms[\"Module\"],\"resources\" => $perms[\"Resource\"],\"module_gbp\" => $perms[\"ModuleGBP\"]);\n\t\t$_POST[\"alerts\"] = json_decode($_POST[\"alerts\"],true);\n\t\t$success = $admin->updateUser($_POST[\"id\"],$_POST);\n\t\t\n\t\tif (!$success) {\n\t\t\t$_SESSION[\"bigtree_admin\"][\"update_user\"] = $_POST;\n\t\t\t$admin->growl(\"Users\",\"Update Failed\",\"error\");\n\t\t\tBigTree::redirect(ADMIN_ROOT.\"users/edit/\".end($bigtree[\"path\"]).\"/\");\n\t\t}\n\t\t\n\t\t$admin->growl(\"Users\",\"Updated User\");\n\t\t\n\t\tBigTree::redirect(ADMIN_ROOT.\"users/\");\n\t}\n?>"], "filenames": ["core/admin/modules/users/create.php", "core/admin/modules/users/update.php"], "buggy_code_start_loc": [2, 2], "buggy_code_end_loc": [13, 16], "fixing_code_start_loc": [2, 2], "fixing_code_end_loc": [22, 25], "type": "CWE-352", "message": "Cross-site request forgery (CSRF) vulnerability in core/admin/modules/users/update.php in BigTree CMS 4.0 RC2 and earlier allows remote attackers to hijack the authentication of administrators for requests that modify arbitrary user accounts via an edit user action.", "other": {"cve": {"id": "CVE-2013-5313", "sourceIdentifier": "cve@mitre.org", "published": "2013-08-19T21:10:49.093", "lastModified": "2013-08-20T13:30:21.483", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site request forgery (CSRF) vulnerability in core/admin/modules/users/update.php in BigTree CMS 4.0 RC2 and earlier allows remote attackers to hijack the authentication of administrators for requests that modify arbitrary user accounts via an edit user action."}, {"lang": "es", "value": "Vulnerabilidad CSRF en core/admin/modules/users/update.php en BigTree CMS 4.0 RC2  y anteriores, permite a atacantes remotos secuestrar la autenticaci\u00f3n para administradores para peticiones que modifican las cuentas de usuarios a trav\u00e9s de una acci\u00f3n \"edit\"."}], "metrics": {"cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.8}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-352"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:*:rc2:*:*:*:*:*:*", "versionEndIncluding": "4.0", "matchCriteriaId": "C6BFF3D3-DE9A-4D38-AA46-81C80C291C6C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:4.0:b1:*:*:*:*:*:*", "matchCriteriaId": "C2FE7AD4-680F-46AB-B781-19F7E4B95593"}, {"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:4.0:b2:*:*:*:*:*:*", "matchCriteriaId": "5EB20F45-4FD0-4BDF-926B-83A7178A16E7"}, {"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:4.0:b3:*:*:*:*:*:*", "matchCriteriaId": "5A8E73F4-6BB4-4BA7-B7DF-DC2C3DB96D3C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:4.0:b4:*:*:*:*:*:*", "matchCriteriaId": "EB85F2AE-F5C8-4975-A668-3F19A16611EE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:4.0:b5:*:*:*:*:*:*", "matchCriteriaId": "67AB2377-6B06-4962-BD58-9C33225F17BB"}, {"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:4.0:b6:*:*:*:*:*:*", "matchCriteriaId": "94F5DCD4-1538-47E2-9D74-89FCB120FB84"}, {"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:4.0:b7:*:*:*:*:*:*", "matchCriteriaId": "FC4B947C-3C45-424E-BEE8-F56CCBEBF384"}, {"vulnerable": true, "criteria": "cpe:2.3:a:bigtreecms:bigtree_cms:4.0:rc1:*:*:*:*:*:*", "matchCriteriaId": "EBA1EB0F-5860-4642-8CD6-5A871ADBDAA9"}]}]}], "references": [{"url": "https://github.com/bigtreecms/BigTree-CMS/commit/4b0faa90fa8b9e1776c86db716894dcd7e6b4834", "source": "cve@mitre.org", "tags": ["Exploit", "Patch"]}]}, "github_commit_url": "https://github.com/bigtreecms/BigTree-CMS/commit/4b0faa90fa8b9e1776c86db716894dcd7e6b4834"}}