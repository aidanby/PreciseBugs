{"buggy_code": ["<?php\n/**\n * Bug tracker\n *\n * @package   MyAAC\n * @author    Gesior <jerzyskalski@wp.pl>\n * @author    Slawkens <slawkens@gmail.com>\n * @copyright 2019 MyAAC\n * @link      https://my-aac.org\n */\ndefined('MYAAC') or die('Direct access not allowed!');\n$title = 'Bug tracker';\n\nif(!$logged)\n{\n\techo  'You are not logged in. <a href=\"?subtopic=accountmanagement&redirect=' . BASE_URL . urlencode('?subtopic=bugtracker') . '\">Log in</a> to post on the bug tracker.<br /><br />';\n\treturn;\n}\n\n$showed = $post = $reply = false;\n    // type (1 = question; 2 = answer)\n    // status (1 = open; 2 = new message; 3 = closed;)\n\n    $dark = $config['darkborder'];\n    $light = $config['lightborder'];\n\n    $tags = array(1 => \"[MAP]\", \"[WEBSITE]\", \"[CLIENT]\", \"[MONSTER]\", \"[NPC]\", \"[OTHER]\");\n\n    if(admin() and isset($_REQUEST['control']) && $_REQUEST['control'] == \"true\")\n    {\n        if(empty($_REQUEST['id']) and empty($_REQUEST['acc']) or !is_numeric($_REQUEST['acc']) or !is_numeric($_REQUEST['id']) )\n            $bug[1] = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `type` = 1 order by `uid` desc');\n\n        if(!empty($_REQUEST['id']) and is_numeric($_REQUEST['id']) and !empty($_REQUEST['acc']) and is_numeric($_REQUEST['acc']))\n            $bug[2] = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].' and `type` = 1')->fetch();\n\n        if(!empty($_REQUEST['id']) and is_numeric($_REQUEST['id']) and !empty($_REQUEST['acc']) and is_numeric($_REQUEST['acc']))\n        {\n            if(!empty($_REQUEST['reply']))\n                $reply=true;\n\n            $account = new OTS_Account();\n            $account->load($_REQUEST['acc']);\n            $account->isLoaded();\n            $players = $account->getPlayersList();\n\n            if(!$reply)\n            {\n                if($bug[2]['status'] == 2)\n                    $value = '<span style=\"color: green\">[OPEN]</span>';\n                elseif($bug[2]['status'] == 3)\n                    $value = '<span style=\"color: red\">[CLOSED]</span>';\n                elseif($bug[2]['status'] == 1)\n                    $value = '<span style=\"color: blue\">[NEW ANSWER]</span>';\n\n                echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD COLSPAN=2 CLASS=white><B>Bug Tracker</B></TD></TR>';\n                echo '<TR BGCOLOR=\"'.$dark.'\"><td width=40%><i><b>Subject</b></i></td><td>'.$tags[$bug[2]['tag']].' '.$bug[2]['subject'].' '.$value.'</td></tr>';\n                echo '<TR BGCOLOR=\"'.$light.'\"><td><i><b>Posted by</b></i></td><td>';\n\n                foreach($players as $player)\n                {\n                    echo ''.$player->getName().'<br>';\n                }\n\n                echo '</td></tr>';\n                echo '<TR BGCOLOR=\"'.$dark.'\"><td colspan=2><i><b>Description</b></i></td></tr>';\n                echo '<TR BGCOLOR=\"'.$light.'\"><td colspan=2>'.nl2br($bug[2]['text']).'</td></tr>';\n                echo '</TABLE>';\n\n                $answers = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].' and `type` = 2 order by `reply`');\n                foreach($answers as $answer)\n                {\n                    if($answer['who'] == 1)\n                        $who = '<span style=\"color: red\">[ADMIN]</span>';\n                    else\n                        $who = '<span style=\"color: green\">[PLAYER]</span>';\n\n                    echo '<br><TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD COLSPAN=2 CLASS=white><B>Answer #'.$answer['reply'].'</B></TD></TR>';\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td width=70%><i><b>Posted by</b></i></td><td>'.$who.'</td></tr>';\n                    echo '<TR BGCOLOR=\"'.$light.'\"><td colspan=2><i><b>Description</b></i></td></tr>';\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td colspan=2>'.nl2br($answer['text']).'</td></tr>';\n                    echo '</TABLE>';\n                }\n                if($bug[2]['status'] != 3)\n                    echo '<br><a href=\"?subtopic=bugtracker&control=true&id='.$_REQUEST['id'].'&acc='.$_REQUEST['acc'].'&reply=true\"><b>[REPLY]</b></a>';\n            }\n            else\n            {\n                if($bug[2]['status'] != 3)\n                {\n                    $reply = $db->query('SELECT MAX(reply) FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].' and `type` = 2')->fetch();\n                    $reply = $reply[0] + 1;\n                    $iswho = $db->query('SELECT * FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].' and `type` = 2 order by `reply` desc limit 1')->fetch();\n\n                    if(isset($_POST['finish']))\n                    {\n                        if(empty($_POST['text']))\n                            $error[] = '<span style=\"color: black\"><b>Description cannot be empty.</b></span>';\n                        if($iswho['who'] == 1)\n                            $error[] = '<span style=\"color: black\"><b>You must wait for User answer.</b></span>';\n                        if(empty($_POST['status']))\n                            $error[] = '<span style=\"color: black\"><b>Status cannot be empty.</b></span>';\n\n                        if(!empty($error))\n                        {\n                            foreach($error as $errors)\n                                echo ''.$errors.'<br>';\n                        }\n                        else\n                        {\n                            $type = 2;\n                            $INSERT = $db->query('INSERT INTO `' . TABLE_PREFIX . 'bugtracker` (`account`,`id`,`text`,`reply`,`type`, `who`) VALUES ('.$db->quote($_REQUEST['acc']).','.$db->quote($_REQUEST['id']).','.$db->quote($_POST['text']).','.$db->quote($reply).','.$db->quote($type).','.$db->quote(1).')');\n                            $UPDATE = $db->query('UPDATE `' . TABLE_PREFIX . 'bugtracker` SET `status` = '.$_POST['status'].' where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].'');\n                            header('Location: ?subtopic=bugtracker&control=true&id='.$_REQUEST['id'].'&acc='.$_REQUEST['acc'].'');\n                        }\n                    }\n                    echo '<br><form method=\"post\" action=\"\"><table><tr><td><i>Description</i></td><td><textarea name=\"text\" rows=\"15\" cols=\"35\"></textarea></td></tr><tr><td>Status[OPEN]</td><td><input type=radio name=status value=2></td></tr><tr><td>Status[CLOSED]</td><td><input type=radio name=status value=3></td></tr></table><br><input type=\"submit\" name=\"finish\" value=\"Submit\" class=\"input2\"/></form>';\n                }\n                else\n                {\n                    echo '<br><span style=\"color: black\"><b>You can\\'t add answer to closed bug thread.</b></span>';\n                }\n            }\n\n            $post=true;\n        }\n        if(!$post)\n        {\n            echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD colspan=2 CLASS=white><B>Bug Tracker Admin</B></TD></TR>';\n            $i=1;\n            foreach($bug[1] as $report)\n            {\n                if($report['status'] == 2)\n                    $value = '<span style=\"color: green\">[OPEN]</span>';\n                elseif($report['status'] == 3)\n                    $value = '<span style=\"color: red\">[CLOSED]</span>';\n                elseif($report['status'] == 1)\n                    $value = '<span style=\"color: blue\">[NEW ANSWER]</span>';\n\n                echo '<TR BGCOLOR=\"' . getStyle($i) . '\"><td width=75%><a href=\"?subtopic=bugtracker&control=true&id='.$report['id'].'&acc='.$report['account'].'\">'.$tags[$report['tag']].' '.$report['subject'].'</a></td><td>'.$value.'</td></tr>';\n\n                $showed=true;\n                $i++;\n            }\n            echo '</TABLE>';\n        }\n    }\n    else\n    {\n        $acc = $account_logged->getId();\n        $account_players = $account_logged->getPlayersList();\n\n        foreach($account_players as $player)\n        {\n            $allow=true;\n        }\n\n        if(!empty($_REQUEST['id']))\n            $id = addslashes(htmlspecialchars(trim($_REQUEST['id'])));\n\n        if(empty($_REQUEST['id']))\n            $bug[1] = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `account` = '.$account_logged->getId().' and `type` = 1 order by `id` desc');\n\n        if(!empty($_REQUEST['id']) and is_numeric($_REQUEST['id']))\n            $bug[2] = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `account` = '.$account_logged->getId().' and `id` = '.$id.' and `type` = 1')->fetch();\n        else\n            $bug[2] = NULL;\n\n        if(!empty($_REQUEST['id']) and $bug[2] != NULL)\n        {\n            if(!empty($_REQUEST['reply']))\n                $reply=true;\n\n            if(!$reply)\n            {\n                if($bug[2]['status'] == 1)\n                    $value = '<span style=\"color: green\">[OPEN]</span>';\n                elseif($bug[2]['status'] == 2)\n                    $value = '<span style=\"color: blue\">[NEW ANSWER]</span>';\n                elseif($bug[2]['status'] == 3)\n                    $value = '<span style=\"color: red\">[CLOSED]</span>';\n\n                echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD COLSPAN=2 CLASS=white><B>Bug Tracker</B></TD></TR>';\n                echo '<TR BGCOLOR=\"'.$dark.'\"><td width=40%><i><b>Subject</b></i></td><td>'.$tags[$bug[2]['tag']].' '.$bug[2]['subject'].' '.$value.'</td></tr>';\n                echo '<TR BGCOLOR=\"'.$light.'\"><td colspan=2><i><b>Description</b></i></td></tr>';\n                echo '<TR BGCOLOR=\"'.$dark.'\"><td colspan=2>'.nl2br($bug[2]['text']).'</td></tr>';\n                echo '</TABLE>';\n\n                $answers = $db->query('SELECT * FROM '.$db->tableName('myaac_bugtracker').' where `account` = '.$account_logged->getId().' and `id` = '.$id.' and `type` = 2 order by `reply`');\n                foreach($answers as $answer)\n                {\n                    if($answer['who'] == 1)\n                        $who = '<span style=\"color: red\">[ADMIN]</span>';\n                    else\n                        $who = '<span style=\"color: green\">[YOU]</span>';\n\n                    echo '<br><TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD COLSPAN=2 CLASS=white><B>Answer #'.$answer['reply'].'</B></TD></TR>';\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td width=70%><i><b>Posted by</b></i></td><td>'.$who.'</td></tr>';\n                    echo '<TR BGCOLOR=\"'.$light.'\"><td colspan=2><i><b>Description</b></i></td></tr>';\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td colspan=2>'.nl2br($answer['text']).'</td></tr>';\n                    echo '</TABLE>';\n                }\n                if($bug[2]['status'] != 3)\n                    echo '<br><a href=\"?subtopic=bugtracker&id='.$id.'&reply=true\"><b>[REPLY]</b></a>';\n            }\n            else\n            {\n                if($bug[2]['status'] != 3)\n                {\n                    $reply = $db->query('SELECT MAX(reply) FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$acc.' and `id` = '.$id.' and `type` = 2')->fetch();\n                    $reply = $reply[0] + 1;\n                    $iswho = $db->query('SELECT * FROM `myaac_bugtracker` where `account` = '.$acc.' and `id` = '.$id.' and `type` = 2 order by `reply` desc limit 1')->fetch();\n\n                    if(isset($_POST['finish']))\n                    {\n                        if(empty($_POST['text']))\n                            $error[] = '<span style=\"color: black\"><b>Description cannot be empty.</b></span>';\n                        if($iswho['who'] == 0)\n                            $error[] = '<span style=\"color: black\"><b>You must wait for Administrator answer.</b></span>';\n                        if(!$allow)\n                            $error[] = '<span style=\"color: black\"><b>You haven\\'t any characters on account.</b></span>';\n\n                        if(!empty($error))\n                        {\n                            foreach($error as $errors)\n                                echo ''.$errors.'<br>';\n                        }\n                        else\n                        {\n                            $type = 2;\n                            $INSERT = $db->query('INSERT INTO `myaac_bugtracker` (`account`,`id`,`text`,`reply`,`type`) VALUES ('.$db->quote($acc).','.$db->quote($id).','.$db->quote($_POST['text']).','.$db->quote($reply).','.$db->quote($type).')');\n                            $UPDATE = $db->query('UPDATE `myaac_bugtracker` SET `status` = 1 where `account` = '.$acc.' and `id` = '.$id.'');\n                            header('Location: ?subtopic=bugtracker&id='.$id.'');\n                        }\n                    }\n                    echo '<br><form method=\"post\" action=\"\"><table><tr><td><i>Description</i></td><td><textarea name=\"text\" rows=\"15\" cols=\"35\"></textarea></td></tr></table><br><input type=\"submit\" name=\"finish\" value=\"Submit\" class=\"input2\"/></form>';\n                }\n                else\n                {\n                    echo '<br><span style=\"color: black\"><b>You can\\'t add answer to closed bug thread.</b></span>';\n                }\n            }\n\n            $post=true;\n        }\n        elseif(!empty($_REQUEST['id']) and $bug[2] == NULL)\n        {\n            echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD CLASS=white><B>Bug Tracker</B></TD></TR>';\n            echo '<TR BGCOLOR=\"'.$dark.'\"><td><i>Bug doesn\\'t exist.</i></td></tr>';\n            echo '</TABLE>';\n            $post=true;\n        }\n\n        if(!$post)\n        {\n            if(!isset($_REQUEST['add']) || $_REQUEST['add'] != TRUE)\n            {\n                echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD colspan=2 CLASS=white><B>Bug Tracker</B></TD></TR>';\n                foreach($bug[1] as $report)\n                {\n                    if($report['status'] == 1)\n                        $value = '<span style=\"color: green\">[OPEN]</span>';\n                    elseif($report['status'] == 2)\n                        $value = '<span style=\"color: blue\">[NEW ANSWER]</span>';\n                    elseif($report['status'] == 3)\n                        $value = '<span style=\"color: red\">[CLOSED]</span>';\n\n                    if(is_int($report['id'] / 2))\n                    {\n                        $bgcolor = $dark;\n                    }\n                    else\n                    {\n                        $bgcolor = $light;\n                    }\n\n                    echo '<TR BGCOLOR=\"'.$bgcolor.'\"><td width=75%><a href=\"?subtopic=bugtracker&id='.$report['id'].'\">'.$tags[$report['tag']].' '.$report['subject'].'</a></td><td>'.$value.'</td></tr>';\n\n                    $showed=true;\n                }\n\n                if(!$showed)\n                {\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td><i>You don\\'t have reported any bugs.</i></td></tr>';\n                }\n                echo '</TABLE>';\n\n                echo '<br><a href=\"?subtopic=bugtracker&add=true\"><b>[ADD REPORT]</b></a>';\n            }\n            elseif(isset($_REQUEST['add']) && $_REQUEST['add'] == TRUE)\n            {\n                $thread = $db->query('SELECT * FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$acc.' and `type` = 1 order by `id` desc')->fetch();\n                $id_next = $db->query('SELECT MAX(id) FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$acc.' and `type` = 1')->fetch();\n                $id_next = $id_next[0] + 1;\n\n                if(empty($thread))\n                    $thread['status'] = 3;\n\n                if(isset($_POST['submit']))\n                {\n                    if($thread['status'] != 3)\n                        $error[] = '<span style=\"color: black\"><b>Can be only 1 open bug thread.</b></span>';\n                    if(empty($_POST['subject']))\n                        $error[] = '<span style=\"color: black\"><b>Subject cannot be empty.</b></span>';\n                    if(empty($_POST['text']))\n                        $error[] = '<span style=\"color: black\"><b>Description cannot be empty.</b></span>';\n                    if(!$allow)\n                        $error[] = '<span style=\"color: black\"><b>You haven\\'t any characters on account.</b></span>';\n                    if(empty($_POST['tags']))\n                        $error[] = '<span style=\"color: black\"><b>Tag cannot be empty.</b></span>';\n\n                    if(!empty($error))\n                    {\n                        foreach($error as $errors)\n                            echo ''.$errors.'<br>';\n                    }\n                    else\n                    {\n                        $type = 1;\n                        $status = 1;\n                        $INSERT = $db->query('INSERT INTO `' . TABLE_PREFIX . 'bugtracker` (`account`,`id`,`text`,`type`,`subject`, `reply`,`status`,`tag`) VALUES ('.$db->quote($acc).','.$db->quote($id_next).','.$db->quote($_POST['text']).','.$db->quote($type).','.$db->quote($_POST['subject']).', 0,'.$db->quote($status).','.$db->quote($_POST['tags']).')');\n                        header('Location: ?subtopic=bugtracker&id='.$id_next.'');\n                    }\n\n                }\n                echo '<br><form method=\"post\" action=\"\"><table><tr><td><i>Subject</i></td><td><input type=text name=\"subject\"/></td></tr><tr><td><i>Description</i></td><td><textarea name=\"text\" rows=\"15\" cols=\"35\"></textarea></td></tr><tr><td>TAG</td><td><select name=\"tags\"><option value=\"\">SELECT</option>';\n\n                for($i = 1; $i <= count($tags); $i++)\n                {\n                    echo '<option value=\"' . $i . '\">' . $tags[$i] . '</option>';\n                }\n\n                echo '</select></tr></tr></table><br><input type=\"submit\" name=\"submit\" value=\"Submit\" class=\"input2\"/></form>';\n            }\n        }\n    }\n\n    if(admin() and empty($_REQUEST['control']))\n    {\n        echo '<br><br><a href=\"?subtopic=bugtracker&control=true\">[ADMIN PANEL]</a>';\n    }\n"], "fixing_code": ["<?php\n/**\n * Bug tracker\n *\n * @package   MyAAC\n * @author    Gesior <jerzyskalski@wp.pl>\n * @author    Slawkens <slawkens@gmail.com>\n * @copyright 2019 MyAAC\n * @link      https://my-aac.org\n */\ndefined('MYAAC') or die('Direct access not allowed!');\n$title = 'Bug tracker';\n\nif(!$logged)\n{\n\techo  'You are not logged in. <a href=\"?subtopic=accountmanagement&redirect=' . BASE_URL . urlencode('?subtopic=bugtracker') . '\">Log in</a> to post on the bug tracker.<br /><br />';\n\treturn;\n}\n\n$showed = $post = $reply = false;\n    // type (1 = question; 2 = answer)\n    // status (1 = open; 2 = new message; 3 = closed;)\n\n    $dark = $config['darkborder'];\n    $light = $config['lightborder'];\n\n    $tags = array(1 => \"[MAP]\", \"[WEBSITE]\", \"[CLIENT]\", \"[MONSTER]\", \"[NPC]\", \"[OTHER]\");\n\n    if(admin() and isset($_REQUEST['control']) && $_REQUEST['control'] == \"true\")\n    {\n        if(empty($_REQUEST['id']) and empty($_REQUEST['acc']) or !is_numeric($_REQUEST['acc']) or !is_numeric($_REQUEST['id']) )\n            $bug[1] = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `type` = 1 order by `uid` desc');\n\n        if(!empty($_REQUEST['id']) and is_numeric($_REQUEST['id']) and !empty($_REQUEST['acc']) and is_numeric($_REQUEST['acc']))\n            $bug[2] = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].' and `type` = 1')->fetch();\n\n        if(!empty($_REQUEST['id']) and is_numeric($_REQUEST['id']) and !empty($_REQUEST['acc']) and is_numeric($_REQUEST['acc']))\n        {\n            if(!empty($_REQUEST['reply']))\n                $reply=true;\n\n            $account = new OTS_Account();\n            $account->load($_REQUEST['acc']);\n            $account->isLoaded();\n            $players = $account->getPlayersList();\n\n            if(!$reply)\n            {\n                if($bug[2]['status'] == 2)\n                    $value = '<span style=\"color: green\">[OPEN]</span>';\n                elseif($bug[2]['status'] == 3)\n                    $value = '<span style=\"color: red\">[CLOSED]</span>';\n                elseif($bug[2]['status'] == 1)\n                    $value = '<span style=\"color: blue\">[NEW ANSWER]</span>';\n\n                echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD COLSPAN=2 CLASS=white><B>Bug Tracker</B></TD></TR>';\n                echo '<TR BGCOLOR=\"'.$dark.'\"><td width=40%><i><b>Subject</b></i></td><td>'.$tags[$bug[2]['tag']].' '.$bug[2]['subject'].' '.$value.'</td></tr>';\n                echo '<TR BGCOLOR=\"'.$light.'\"><td><i><b>Posted by</b></i></td><td>';\n\n                foreach($players as $player)\n                {\n                    echo ''.$player->getName().'<br>';\n                }\n\n                echo '</td></tr>';\n                echo '<TR BGCOLOR=\"'.$dark.'\"><td colspan=2><i><b>Description</b></i></td></tr>';\n                echo '<TR BGCOLOR=\"'.$light.'\"><td colspan=2>'.nl2br($bug[2]['text']).'</td></tr>';\n                echo '</TABLE>';\n\n                $answers = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].' and `type` = 2 order by `reply`');\n                foreach($answers as $answer)\n                {\n                    if($answer['who'] == 1)\n                        $who = '<span style=\"color: red\">[ADMIN]</span>';\n                    else\n                        $who = '<span style=\"color: green\">[PLAYER]</span>';\n\n                    echo '<br><TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD COLSPAN=2 CLASS=white><B>Answer #'.$answer['reply'].'</B></TD></TR>';\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td width=70%><i><b>Posted by</b></i></td><td>'.$who.'</td></tr>';\n                    echo '<TR BGCOLOR=\"'.$light.'\"><td colspan=2><i><b>Description</b></i></td></tr>';\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td colspan=2>'.nl2br($answer['text']).'</td></tr>';\n                    echo '</TABLE>';\n                }\n                if($bug[2]['status'] != 3)\n                    echo '<br><a href=\"?subtopic=bugtracker&control=true&id='.$_REQUEST['id'].'&acc='.$_REQUEST['acc'].'&reply=true\"><b>[REPLY]</b></a>';\n            }\n            else\n            {\n                if($bug[2]['status'] != 3)\n                {\n                    $reply = $db->query('SELECT MAX(reply) FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].' and `type` = 2')->fetch();\n                    $reply = $reply[0] + 1;\n                    $iswho = $db->query('SELECT * FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].' and `type` = 2 order by `reply` desc limit 1')->fetch();\n\n                    if(isset($_POST['finish']))\n                    {\n                        if(empty($_POST['text']))\n                            $error[] = '<span style=\"color: black\"><b>Description cannot be empty.</b></span>';\n                        if($iswho['who'] == 1)\n                            $error[] = '<span style=\"color: black\"><b>You must wait for User answer.</b></span>';\n                        if(empty($_POST['status']))\n                            $error[] = '<span style=\"color: black\"><b>Status cannot be empty.</b></span>';\n\n                        if(!empty($error))\n                        {\n                            foreach($error as $errors)\n                                echo ''.$errors.'<br>';\n                        }\n                        else\n                        {\n                            $type = 2;\n                            $INSERT = $db->query('INSERT INTO `' . TABLE_PREFIX . 'bugtracker` (`account`,`id`,`text`,`reply`,`type`, `who`) VALUES ('.$db->quote($_REQUEST['acc']).','.$db->quote($_REQUEST['id']).','.$db->quote($_POST['text']).','.$db->quote($reply).','.$db->quote($type).','.$db->quote(1).')');\n                            $UPDATE = $db->query('UPDATE `' . TABLE_PREFIX . 'bugtracker` SET `status` = '.$_POST['status'].' where `account` = '.$_REQUEST['acc'].' and `id` = '.$_REQUEST['id'].'');\n                            header('Location: ?subtopic=bugtracker&control=true&id='.$_REQUEST['id'].'&acc='.$_REQUEST['acc'].'');\n                        }\n                    }\n                    echo '<br><form method=\"post\" action=\"\"><table><tr><td><i>Description</i></td><td><textarea name=\"text\" rows=\"15\" cols=\"35\"></textarea></td></tr><tr><td>Status[OPEN]</td><td><input type=radio name=status value=2></td></tr><tr><td>Status[CLOSED]</td><td><input type=radio name=status value=3></td></tr></table><br><input type=\"submit\" name=\"finish\" value=\"Submit\" class=\"input2\"/></form>';\n                }\n                else\n                {\n                    echo '<br><span style=\"color: black\"><b>You can\\'t add answer to closed bug thread.</b></span>';\n                }\n            }\n\n            $post=true;\n        }\n        if(!$post)\n        {\n            echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD colspan=2 CLASS=white><B>Bug Tracker Admin</B></TD></TR>';\n            $i=1;\n            foreach($bug[1] as $report)\n            {\n                if($report['status'] == 2)\n                    $value = '<span style=\"color: green\">[OPEN]</span>';\n                elseif($report['status'] == 3)\n                    $value = '<span style=\"color: red\">[CLOSED]</span>';\n                elseif($report['status'] == 1)\n                    $value = '<span style=\"color: blue\">[NEW ANSWER]</span>';\n\n                echo '<TR BGCOLOR=\"' . getStyle($i) . '\"><td width=75%><a href=\"?subtopic=bugtracker&control=true&id='.$report['id'].'&acc='.$report['account'].'\">'.$tags[$report['tag']].' '.$report['subject'].'</a></td><td>'.$value.'</td></tr>';\n\n                $showed=true;\n                $i++;\n            }\n            echo '</TABLE>';\n        }\n    }\n    else\n    {\n        $acc = $account_logged->getId();\n        $account_players = $account_logged->getPlayersList();\n\n        foreach($account_players as $player)\n        {\n            $allow=true;\n        }\n\n        if(!empty($_REQUEST['id']))\n            $id = addslashes(htmlspecialchars(trim($_REQUEST['id'])));\n\n        if(empty($_REQUEST['id']))\n            $bug[1] = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `account` = '.$account_logged->getId().' and `type` = 1 order by `id` desc');\n\n        if(!empty($_REQUEST['id']) and is_numeric($_REQUEST['id']))\n            $bug[2] = $db->query('SELECT * FROM '.$db->tableName(TABLE_PREFIX . 'bugtracker').' where `account` = '.$account_logged->getId().' and `id` = '.$id.' and `type` = 1')->fetch();\n        else\n            $bug[2] = NULL;\n\n        if(!empty($_REQUEST['id']) and $bug[2] != NULL)\n        {\n            if(!empty($_REQUEST['reply']))\n                $reply=true;\n\n            if(!$reply)\n            {\n                if($bug[2]['status'] == 1)\n                    $value = '<span style=\"color: green\">[OPEN]</span>';\n                elseif($bug[2]['status'] == 2)\n                    $value = '<span style=\"color: blue\">[NEW ANSWER]</span>';\n                elseif($bug[2]['status'] == 3)\n                    $value = '<span style=\"color: red\">[CLOSED]</span>';\n\n                echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD COLSPAN=2 CLASS=white><B>Bug Tracker</B></TD></TR>';\n                echo '<TR BGCOLOR=\"'.$dark.'\"><td width=40%><i><b>Subject</b></i></td><td>'.$tags[$bug[2]['tag']].' '.escapeHtml($bug[2]['subject']).' '.$value.'</td></tr>';\n                echo '<TR BGCOLOR=\"'.$light.'\"><td colspan=2><i><b>Description</b></i></td></tr>';\n                echo '<TR BGCOLOR=\"'.$dark.'\"><td colspan=2>'.nl2br(escapeHtml($bug[2]['text'])).'</td></tr>';\n                echo '</TABLE>';\n\n                $answers = $db->query('SELECT * FROM '.$db->tableName('myaac_bugtracker').' where `account` = '.$account_logged->getId().' and `id` = '.$id.' and `type` = 2 order by `reply`');\n                foreach($answers as $answer)\n                {\n                    if($answer['who'] == 1)\n                        $who = '<span style=\"color: red\">[ADMIN]</span>';\n                    else\n                        $who = '<span style=\"color: green\">[YOU]</span>';\n\n                    echo '<br><TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD COLSPAN=2 CLASS=white><B>Answer #'.$answer['reply'].'</B></TD></TR>';\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td width=70%><i><b>Posted by</b></i></td><td>'.$who.'</td></tr>';\n                    echo '<TR BGCOLOR=\"'.$light.'\"><td colspan=2><i><b>Description</b></i></td></tr>';\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td colspan=2>'.nl2br($answer['text']).'</td></tr>';\n                    echo '</TABLE>';\n                }\n                if($bug[2]['status'] != 3)\n                    echo '<br><a href=\"?subtopic=bugtracker&id='.$id.'&reply=true\"><b>[REPLY]</b></a>';\n            }\n            else\n            {\n                if($bug[2]['status'] != 3)\n                {\n                    $reply = $db->query('SELECT MAX(reply) FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$acc.' and `id` = '.$id.' and `type` = 2')->fetch();\n                    $reply = $reply[0] + 1;\n                    $iswho = $db->query('SELECT * FROM `myaac_bugtracker` where `account` = '.$acc.' and `id` = '.$id.' and `type` = 2 order by `reply` desc limit 1')->fetch();\n\n                    if(isset($_POST['finish']))\n                    {\n                        if(empty($_POST['text']))\n                            $error[] = '<span style=\"color: black\"><b>Description cannot be empty.</b></span>';\n                        if($iswho['who'] == 0)\n                            $error[] = '<span style=\"color: black\"><b>You must wait for Administrator answer.</b></span>';\n                        if(!$allow)\n                            $error[] = '<span style=\"color: black\"><b>You haven\\'t any characters on account.</b></span>';\n\n                        if(!empty($error))\n                        {\n                            foreach($error as $errors)\n                                echo ''.$errors.'<br>';\n                        }\n                        else\n                        {\n                            $type = 2;\n                            $INSERT = $db->query('INSERT INTO `myaac_bugtracker` (`account`,`id`,`text`,`reply`,`type`) VALUES ('.$db->quote($acc).','.$db->quote($id).','.$db->quote($_POST['text']).','.$db->quote($reply).','.$db->quote($type).')');\n                            $UPDATE = $db->query('UPDATE `myaac_bugtracker` SET `status` = 1 where `account` = '.$acc.' and `id` = '.$id.'');\n                            header('Location: ?subtopic=bugtracker&id='.$id.'');\n                        }\n                    }\n                    echo '<br><form method=\"post\" action=\"\"><table><tr><td><i>Description</i></td><td><textarea name=\"text\" rows=\"15\" cols=\"35\"></textarea></td></tr></table><br><input type=\"submit\" name=\"finish\" value=\"Submit\" class=\"input2\"/></form>';\n                }\n                else\n                {\n                    echo '<br><span style=\"color: black\"><b>You can\\'t add answer to closed bug thread.</b></span>';\n                }\n            }\n\n            $post=true;\n        }\n        elseif(!empty($_REQUEST['id']) and $bug[2] == NULL)\n        {\n            echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD CLASS=white><B>Bug Tracker</B></TD></TR>';\n            echo '<TR BGCOLOR=\"'.$dark.'\"><td><i>Bug doesn\\'t exist.</i></td></tr>';\n            echo '</TABLE>';\n            $post=true;\n        }\n\n        if(!$post)\n        {\n            if(!isset($_REQUEST['add']) || $_REQUEST['add'] != TRUE)\n            {\n                echo '<TABLE BORDER=0 CELLSPACING=1 CELLPADDING=4 WIDTH=100%><TR BGCOLOR='.$config['vdarkborder'].'><TD colspan=2 CLASS=white><B>Bug Tracker</B></TD></TR>';\n                foreach($bug[1] as $report)\n                {\n                    if($report['status'] == 1)\n                        $value = '<span style=\"color: green\">[OPEN]</span>';\n                    elseif($report['status'] == 2)\n                        $value = '<span style=\"color: blue\">[NEW ANSWER]</span>';\n                    elseif($report['status'] == 3)\n                        $value = '<span style=\"color: red\">[CLOSED]</span>';\n\n                    if(is_int($report['id'] / 2))\n                    {\n                        $bgcolor = $dark;\n                    }\n                    else\n                    {\n                        $bgcolor = $light;\n                    }\n\n                    echo '<TR BGCOLOR=\"'.$bgcolor.'\"><td width=75%><a href=\"?subtopic=bugtracker&id='.$report['id'].'\">'.$tags[$report['tag']].' '.escapeHtml($report['subject']).'</a></td><td>'.$value.'</td></tr>';\n\n                    $showed=true;\n                }\n\n                if(!$showed)\n                {\n                    echo '<TR BGCOLOR=\"'.$dark.'\"><td><i>You don\\'t have reported any bugs.</i></td></tr>';\n                }\n                echo '</TABLE>';\n\n                echo '<br><a href=\"?subtopic=bugtracker&add=true\"><b>[ADD REPORT]</b></a>';\n            }\n            elseif(isset($_REQUEST['add']) && $_REQUEST['add'] == TRUE)\n            {\n                $thread = $db->query('SELECT * FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$acc.' and `type` = 1 order by `id` desc')->fetch();\n                $id_next = $db->query('SELECT MAX(id) FROM `' . TABLE_PREFIX . 'bugtracker` where `account` = '.$acc.' and `type` = 1')->fetch();\n                $id_next = $id_next[0] + 1;\n\n                if(empty($thread))\n                    $thread['status'] = 3;\n\n                if(isset($_POST['submit']))\n                {\n                    if($thread['status'] != 3)\n                        $error[] = '<span style=\"color: black\"><b>Can be only 1 open bug thread.</b></span>';\n                    if(empty($_POST['subject']))\n                        $error[] = '<span style=\"color: black\"><b>Subject cannot be empty.</b></span>';\n                    if(empty($_POST['text']))\n                        $error[] = '<span style=\"color: black\"><b>Description cannot be empty.</b></span>';\n                    if(!$allow)\n                        $error[] = '<span style=\"color: black\"><b>You haven\\'t any characters on account.</b></span>';\n                    if(empty($_POST['tags']))\n                        $error[] = '<span style=\"color: black\"><b>Tag cannot be empty.</b></span>';\n\n                    if(!empty($error))\n                    {\n                        foreach($error as $errors)\n                            echo ''.$errors.'<br>';\n                    }\n                    else\n                    {\n                        $type = 1;\n                        $status = 1;\n                        $INSERT = $db->query('INSERT INTO `' . TABLE_PREFIX . 'bugtracker` (`account`,`id`,`text`,`type`,`subject`, `reply`,`status`,`tag`) VALUES ('.$db->quote($acc).','.$db->quote($id_next).','.$db->quote($_POST['text']).','.$db->quote($type).','.$db->quote($_POST['subject']).', 0,'.$db->quote($status).','.$db->quote($_POST['tags']).')');\n                        header('Location: ?subtopic=bugtracker&id='.$id_next.'');\n                    }\n\n                }\n                echo '<br><form method=\"post\" action=\"\"><table><tr><td><i>Subject</i></td><td><input type=text name=\"subject\"/></td></tr><tr><td><i>Description</i></td><td><textarea name=\"text\" rows=\"15\" cols=\"35\"></textarea></td></tr><tr><td>TAG</td><td><select name=\"tags\"><option value=\"\">SELECT</option>';\n\n                for($i = 1; $i <= count($tags); $i++)\n                {\n                    echo '<option value=\"' . $i . '\">' . $tags[$i] . '</option>';\n                }\n\n                echo '</select></tr></tr></table><br><input type=\"submit\" name=\"submit\" value=\"Submit\" class=\"input2\"/></form>';\n            }\n        }\n    }\n\n    if(admin() and empty($_REQUEST['control']))\n    {\n        echo '<br><br><a href=\"?subtopic=bugtracker&control=true\">[ADMIN PANEL]</a>';\n    }\n"], "filenames": ["system/pages/bugtracker.php"], "buggy_code_start_loc": [184], "buggy_code_end_loc": [278], "fixing_code_start_loc": [184], "fixing_code_end_loc": [278], "type": "CWE-79", "message": "A vulnerability was found in slawkens MyAAC up to 0.8.13. It has been declared as problematic. This vulnerability affects unknown code of the file system/pages/bugtracker.php. The manipulation of the argument bug[2]['subject']/bug[2]['text']/report['subject'] leads to cross site scripting. The attack can be initiated remotely. Upgrading to version 0.8.14 is able to address this issue. The name of the patch is 83a91ec540072d319dd338abff45f8d5ebf48190. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-248848.", "other": {"cve": {"id": "CVE-2023-7076", "sourceIdentifier": "cna@vuldb.com", "published": "2023-12-22T14:15:07.093", "lastModified": "2024-02-29T01:42:52.140", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "A vulnerability was found in slawkens MyAAC up to 0.8.13. It has been declared as problematic. This vulnerability affects unknown code of the file system/pages/bugtracker.php. The manipulation of the argument bug[2]['subject']/bug[2]['text']/report['subject'] leads to cross site scripting. The attack can be initiated remotely. Upgrading to version 0.8.14 is able to address this issue. The name of the patch is 83a91ec540072d319dd338abff45f8d5ebf48190. It is recommended to upgrade the affected component. The identifier of this vulnerability is VDB-248848."}, {"lang": "es", "value": "Se encontr\u00f3 una vulnerabilidad en slawkens MyAAC hasta 0.8.13. Ha sido declarada problem\u00e1tica. Esta vulnerabilidad afecta a c\u00f3digo desconocido del sistema de archivos/pages/bugtracker.php. La manipulaci\u00f3n del argumento bug[2]['subject']/bug[2]['text']/report['subject'] conduce a cross site scripting. El ataque se puede iniciar de forma remota. La actualizaci\u00f3n a la versi\u00f3n 0.8.14 puede solucionar este problema. El nombre del parche es 83a91ec540072d319dd338abff45f8d5ebf48190. Se recomienda actualizar el componente afectado. El identificador de esta vulnerabilidad es VDB-248848."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:my-aac:myaac:*:*:*:*:*:*:*:*", "versionEndIncluding": "0.8.13", "matchCriteriaId": "27A79F32-8A18-47B4-9D70-50C91B6B6CFC"}]}]}], "references": [{"url": "https://github.com/otsoft/myaac/commit/83a91ec540072d319dd338abff45f8d5ebf48190", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/slawkens/myaac/releases/tag/v0.8.14", "source": "cna@vuldb.com", "tags": ["Release Notes"]}, {"url": "https://vuldb.com/?ctiid.248848", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.248848", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/otsoft/myaac/commit/83a91ec540072d319dd338abff45f8d5ebf48190"}}