{"buggy_code": ["<?php\n\nclass Debug_Bar_Queries extends Debug_Bar_Panel {\n\tfunction init() {\n\t\t$this->title( __('Queries', 'debug-bar') );\n\t}\n\n\tfunction prerender() {\n\t\t$this->set_visible( defined('SAVEQUERIES') && SAVEQUERIES || ! empty($GLOBALS['EZSQL_ERROR']) );\n\t}\n\n\tfunction debug_bar_classes( $classes ) {\n\t\tif ( ! empty($GLOBALS['EZSQL_ERROR']) )\n\t\t\t$classes[] = 'debug-bar-php-warning-summary';\n\t\treturn $classes;\n\t}\n\n\tfunction render() {\n\t\tglobal $wpdb, $EZSQL_ERROR;\n\n\t\t$out = '';\n\t\t$total_time = 0;\n\n\t\tif ( !empty($wpdb->queries) ) {\n\t\t\t$show_many = isset($_GET['debug_queries']);\n\n\t\t\tif ( $wpdb->num_queries > 500 && !$show_many )\n\t\t\t\t$out .= \"<p>\" . sprintf( __('There are too many queries to show easily! <a href=\"%s\">Show them anyway</a>', 'debug-bar'), add_query_arg( 'debug_queries', 'true' ) ) . \"</p>\";\n\n\t\t\t$out .= '<ol class=\"wpd-queries\">';\n\t\t\t$counter = 0;\n\n\t\t\tforeach ( $wpdb->queries as $q ) {\n\t\t\t\tlist($query, $elapsed, $debug) = $q;\n\n\t\t\t\t$total_time += $elapsed;\n\n\t\t\t\tif ( ++$counter > 500 && ! $show_many )\n\t\t\t\t\tcontinue;\n\n\t\t\t\t$debug = explode( ', ', $debug );\n\t\t\t\t$debug = array_diff( $debug, array( 'require_once', 'require', 'include_once', 'include' ) );\n\t\t\t\t$debug = implode( ', ', $debug );\n\t\t\t\t$debug = str_replace( array( 'do_action, call_user_func_array' ), array( 'do_action' ), $debug );\n\t\t\t\t$query = nl2br(esc_html($query));\n\n\t\t\t\t$out .= \"<li>$query<br/><div class='qdebug'>$debug <span>#{$counter} (\" . number_format(sprintf('%0.1f', $elapsed * 1000), 1, '.', ',') . \"ms)</span></div></li>\\n\";\n\t\t\t}\n\t\t\t$out .= '</ol>';\n\t\t} else {\n\t\t\tif ( $wpdb->num_queries == 0 )\n\t\t\t\t$out .= \"<p><strong>\" . __('There are no queries on this page.', 'debug-bar') . \"</strong></p>\";\n\t\t\telse\n\t\t\t\t$out .= \"<p><strong>\" . __('SAVEQUERIES must be defined to show the query log.', 'debug-bar') . \"</strong></p>\";\n\t\t}\n\n\t\tif ( ! empty($EZSQL_ERROR) ) {\n\t\t\t$out .= '<h3>' . __( 'Database Errors', 'debug-bar' ) . '</h3>';\n\t\t\t$out .= '<ol class=\"wpd-queries\">';\n\n\t\t\tforeach ( $EZSQL_ERROR as $e ) {\n\t\t\t\t$query = nl2br(esc_html($e['query']));\n\t\t\t\t$out .= \"<li>$query<br/><div class='qdebug'>{$e['error_str']}</div></li>\\n\";\n\t\t\t}\n\t\t\t$out .= '</ol>';\n\t\t}\n\n\t\t$heading = '';\n\t\tif ( $wpdb->num_queries )\n\t\t\t$heading .= '<h2><span>Total Queries:</span>' . number_format( $wpdb->num_queries ) . \"</h2>\\n\";\n\t\tif ( $total_time )\n\t\t\t$heading .= '<h2><span>Total query time:</span>' . number_format(sprintf('%0.1f', $total_time * 1000), 1) . \" ms</h2>\\n\";\n\t\tif ( ! empty($EZSQL_ERROR) )\n\t\t\t$heading .= '<h2><span>Total DB Errors:</span>' . number_format( count($EZSQL_ERROR) ) . \"</h2>\\n\";\n\n\t\t$out = $heading . $out;\n\n\t\techo $out;\n\t}\n}\n"], "fixing_code": ["<?php\n\nclass Debug_Bar_Queries extends Debug_Bar_Panel {\n\tfunction init() {\n\t\t$this->title( __('Queries', 'debug-bar') );\n\t}\n\n\tfunction prerender() {\n\t\t$this->set_visible( defined('SAVEQUERIES') && SAVEQUERIES || ! empty($GLOBALS['EZSQL_ERROR']) );\n\t}\n\n\tfunction debug_bar_classes( $classes ) {\n\t\tif ( ! empty($GLOBALS['EZSQL_ERROR']) )\n\t\t\t$classes[] = 'debug-bar-php-warning-summary';\n\t\treturn $classes;\n\t}\n\n\tfunction render() {\n\t\tglobal $wpdb, $EZSQL_ERROR;\n\n\t\t$out = '';\n\t\t$total_time = 0;\n\n\t\tif ( !empty($wpdb->queries) ) {\n\t\t\t$show_many = isset($_GET['debug_queries']);\n\n\t\t\tif ( $wpdb->num_queries > 500 && !$show_many )\n\t\t\t\t$out .= \"<p>\" . sprintf( __('There are too many queries to show easily! <a href=\"%s\">Show them anyway</a>', 'debug-bar'), esc_url( add_query_arg( 'debug_queries', 'true' ) ) ) . \"</p>\";\n\n\t\t\t$out .= '<ol class=\"wpd-queries\">';\n\t\t\t$counter = 0;\n\n\t\t\tforeach ( $wpdb->queries as $q ) {\n\t\t\t\tlist($query, $elapsed, $debug) = $q;\n\n\t\t\t\t$total_time += $elapsed;\n\n\t\t\t\tif ( ++$counter > 500 && ! $show_many )\n\t\t\t\t\tcontinue;\n\n\t\t\t\t$debug = explode( ', ', $debug );\n\t\t\t\t$debug = array_diff( $debug, array( 'require_once', 'require', 'include_once', 'include' ) );\n\t\t\t\t$debug = implode( ', ', $debug );\n\t\t\t\t$debug = str_replace( array( 'do_action, call_user_func_array' ), array( 'do_action' ), $debug );\n\t\t\t\t$query = nl2br(esc_html($query));\n\n\t\t\t\t$out .= \"<li>$query<br/><div class='qdebug'>$debug <span>#{$counter} (\" . number_format(sprintf('%0.1f', $elapsed * 1000), 1, '.', ',') . \"ms)</span></div></li>\\n\";\n\t\t\t}\n\t\t\t$out .= '</ol>';\n\t\t} else {\n\t\t\tif ( $wpdb->num_queries == 0 )\n\t\t\t\t$out .= \"<p><strong>\" . __('There are no queries on this page.', 'debug-bar') . \"</strong></p>\";\n\t\t\telse\n\t\t\t\t$out .= \"<p><strong>\" . __('SAVEQUERIES must be defined to show the query log.', 'debug-bar') . \"</strong></p>\";\n\t\t}\n\n\t\tif ( ! empty($EZSQL_ERROR) ) {\n\t\t\t$out .= '<h3>' . __( 'Database Errors', 'debug-bar' ) . '</h3>';\n\t\t\t$out .= '<ol class=\"wpd-queries\">';\n\n\t\t\tforeach ( $EZSQL_ERROR as $e ) {\n\t\t\t\t$query = nl2br(esc_html($e['query']));\n\t\t\t\t$out .= \"<li>$query<br/><div class='qdebug'>{$e['error_str']}</div></li>\\n\";\n\t\t\t}\n\t\t\t$out .= '</ol>';\n\t\t}\n\n\t\t$heading = '';\n\t\tif ( $wpdb->num_queries )\n\t\t\t$heading .= '<h2><span>Total Queries:</span>' . number_format( $wpdb->num_queries ) . \"</h2>\\n\";\n\t\tif ( $total_time )\n\t\t\t$heading .= '<h2><span>Total query time:</span>' . number_format(sprintf('%0.1f', $total_time * 1000), 1) . \" ms</h2>\\n\";\n\t\tif ( ! empty($EZSQL_ERROR) )\n\t\t\t$heading .= '<h2><span>Total DB Errors:</span>' . number_format( count($EZSQL_ERROR) ) . \"</h2>\\n\";\n\n\t\t$out = $heading . $out;\n\n\t\techo $out;\n\t}\n}\n"], "filenames": ["panels/class-debug-bar-queries.php"], "buggy_code_start_loc": [28], "buggy_code_end_loc": [29], "fixing_code_start_loc": [28], "fixing_code_end_loc": [29], "type": "CWE-79", "message": "A vulnerability was found in dd32 Debug Bar Plugin up to 0.8. It has been declared as problematic. Affected by this vulnerability is the function render of the file panels/class-debug-bar-queries.php. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 0.8.1 is able to address this issue. The name of the patch is 0842af8f8a556bc3e39b9ef758173b0a8a9ccbfc. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-222739.", "other": {"cve": {"id": "CVE-2013-10021", "sourceIdentifier": "cna@vuldb.com", "published": "2023-03-11T21:15:09.247", "lastModified": "2023-03-15T21:01:53.657", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in dd32 Debug Bar Plugin up to 0.8. It has been declared as problematic. Affected by this vulnerability is the function render of the file panels/class-debug-bar-queries.php. The manipulation leads to cross site scripting. The attack can be launched remotely. Upgrading to version 0.8.1 is able to address this issue. The name of the patch is 0842af8f8a556bc3e39b9ef758173b0a8a9ccbfc. It is recommended to upgrade the affected component. The associated identifier of this vulnerability is VDB-222739."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:wordpress:debug_bar:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "0.8.1", "matchCriteriaId": "FE7E7589-0033-40DD-9E0B-05745A39835F"}]}]}], "references": [{"url": "https://github.com/dd32/debug-bar/commit/0842af8f8a556bc3e39b9ef758173b0a8a9ccbfc", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/dd32/debug-bar/releases/tag/0.8.1", "source": "cna@vuldb.com", "tags": ["Release Notes"]}, {"url": "https://vuldb.com/?ctiid.222739", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.222739", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/dd32/debug-bar/commit/0842af8f8a556bc3e39b9ef758173b0a8a9ccbfc"}}