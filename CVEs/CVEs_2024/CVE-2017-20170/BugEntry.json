{"buggy_code": ["<!--Kotisivut Riikka/Hevoset, draft 1; /index.php-->\r\n<?\r\n\r\n\r\n$rel = \"./\";\r\n\r\ninclude $rel.\"db.php\";\r\n\r\n\r\n$haku_fp = mysqli_query($yht, \"SELECT * FROM `sivut` LIMIT 1\");\r\n$fprow = mysqli_fetch_assoc($haku_fp);\r\n\r\n\r\n//Go to first page in order (front page) if ?s argument is not set\r\nif(!isset($_GET[\"s\"]))\t{$_GET['s'] = $fprow['uid'];}\r\n\r\n\r\n$haku_s = mysqli_query($yht, \"SELECT * FROM `sivut` WHERE uid = '\".$_GET['s'].\"' LIMIT 1\");\r\n\r\n\r\n$pagerow = mysqli_fetch_assoc($haku_s);\r\n\r\n$usePhotoSwipe = false;\r\n\r\nfunction image_gallery($images = array()) {\r\n\tif(count($images)) {\r\n\t\t$toReturn = \"\r\n\t\t\t<div class='img-gallery img' itemscope itemtype='http://schema.org/ImageGallery'>\";\r\n\t\tforeach ($images as $picture) {\r\n\t\t\t$toReturn .= \"<figure itemprop='associatedMedia' itemscope itemtype='http://schema.org/ImageObject'>\r\n\t\t\t\t<a href='\".$picture['img-large'].\"' itemprop='contentUrl' data-size='\".$picture['img-size'].\"'>\r\n\t\t\t\t\t<img src='\".$picture['img-thumb'].\"' itemprop='thumbnail' alt='\".$picture['text'].\"' />\r\n\t\t\t\t</a>\r\n\t\t\t\t<figcaption itemprop='caption description'>\".$picture['text'];\r\n\t\t\t\tif($picture['author'] != \"\") $toReturn .= \"<br/><small>Kuva: \".$picture['author'].\"</small>\";\r\n\t\t\t\t$toReturn .= \"</figcaption>\r\n\t\t\t\t\";\r\n\t\t\tif($picture['break-row']) $toReturn .= \"<br/>\";\r\n\t\t\t$toReturn .= \"</figure>\";\r\n\t\t}\r\n\t\t$toReturn .= \"</div>\";\r\n\t\treturn $toReturn;\r\n\t}\r\n}\r\n\r\nfunction image_exists($id, $yht) {\r\n\treturn mysqli_fetch_array(mysqli_query($yht, \"SELECT `imgur-uid` FROM images WHERE `imgur-uid` = '$id' LIMIT 1\")) !== false;\r\n}\r\nfunction get_image_by_id($id, $yht) {\r\n\treturn mysqli_fetch_assoc(mysqli_query($yht, \"SELECT * FROM images WHERE `imgur-uid` = '$id' LIMIT 1\"));\r\n}\r\n\r\nfunction generate_gallery($text, $yht) {\r\n\t$idArray = explode('*', $text);\r\n\t$images = array();\r\n\tforeach ($idArray as $rid) {\r\n\t\t$attributes = explode('&', $rid);\r\n\t\t$id = $attributes[0];\r\n\t\tif (image_exists($id, $yht)) {\r\n\t\t\t$images[$id] = get_image_by_id($id, $yht);\r\n\t\t\t$images[$id]['break-row'] = $attributes[1] == \"br\";\r\n\t\t}\r\n\t}\r\n\treturn image_gallery($images);\r\n}\r\n\r\n$kuva = $pagerow[\"kuva\"];\r\n$rawtext = $pagerow[\"teksti\"];\r\n$teksti = preg_replace_callback(\r\n\t\"/\\\\<!-+gallery (.+?) gallery-+\\\\>/\",\r\n\tfunction ($matches) use (&$usePhotoSwipe, $yht) {\r\n\t\t$usePhotoSwipe = true;\r\n\t\treturn generate_gallery($matches[1], $yht);\r\n\t},\r\n\t$rawtext\r\n);\r\n$nimi = $pagerow[\"nimi\"];\r\n$html = $pagerow[\"html\"];\r\n$selitys = $pagerow[\"selitys\"];\r\n$uid = $pagerow[\"uid\"];\r\n\r\n?>\r\n<html>\r\n<head>\r\n\r\n<?php include $rel.\"skeleton/metas.php\" ?>\r\n\r\n\r\n<?\r\necho(\"\r\n\t<meta name='description' content='$selitys'>\r\n\t<meta name='og:site_name' content='Parontalli.fi'>\r\n\t<meta name='og:title' content='$nimi'>\r\n\t<meta name='og:description' content='$selitys'>\r\n\");\r\n\r\n?>\r\n<title>\r\n\t<? echo $nimi; ?>\r\n</title>\r\n\r\n<?php include $rel.\"skeleton/styles.php\" ?>\r\n\r\n</head>\r\n\r\n<script>\r\nfunction execRnav()\r\n{\r\n\tif (typeof rnavPosByHeader == 'function') {rnavPosByHeader();}\r\n}\r\nfunction runHandles()\r\n{\r\n\tif (typeof addHandles() == 'function') {addHandles();}\r\n}\r\n</script>\r\n\r\n<body onresize=\"execRnav();\" onscroll=\"execRnav();\" onload=\"runHandles();\">\r\n\r\n<?php if ($usePhotoSwipe) include \"{$rel}skeleton/photoswipe.php\" ?>\r\n<?php include $rel.\"skeleton/header.php\" ?>\r\n\r\n<div class=\"nav\">\r\n\t<?\r\n\t$haku = mysqli_query($yht, \"SELECT * FROM sivut ORDER BY id\");\r\n\twhile ($row = mysqli_fetch_array($haku)){\r\n\t\t$thispage = \"\";\r\n\t\tif ($row['uid'] == $uid){\r\n\t\t\t$thispage = \"thispage\";\r\n\t\t}\r\n\t\tcreateLink($row['color'], \"?s=\".$row['uid'], $thispage, $row['nimi']);\r\n\t}\r\n\t?>\r\n\r\n\t<hr class=\"header\" id=\"\">\r\n</div>\r\n<?\r\nif (!$kuva == \"\"){\r\n\techo '\r\n\t<img src=\"'. $kuva .'\" class=\"header\">\r\n\t';\r\n}\r\n\r\necho $html;\r\n\r\n?>\r\n<div class=\"content\"><br>\r\n\t<?\r\n\techo $teksti;\r\n\t?>\r\n</div>\r\n<?php include $rel.\"skeleton/footer.php\" ?>\r\n</body>\r\n<html>\r\n"], "fixing_code": ["<!--Kotisivut Riikka/Hevoset, draft 1; /index.php-->\r\n<?\r\n\r\n\r\n$rel = \"./\";\r\n\r\ninclude $rel.\"db.php\";\r\n\r\n\r\n$haku_fp = mysqli_query($yht, \"SELECT * FROM `sivut` LIMIT 1\");\r\n$fprow = mysqli_fetch_assoc($haku_fp);\r\n\r\n\r\n//Go to first page in order (front page) if ?s argument is not set\r\nif(!isset($_GET[\"s\"])) {$_GET['s'] = $fprow['uid'];}\r\nelse {\r\n  $_GET['s'] = mysqli_real_escape_string($yht, $_GET['s']);\r\n}\r\n\r\n\r\n$haku_s = mysqli_query($yht, \"SELECT * FROM `sivut` WHERE uid = '\".$_GET['s'].\"' LIMIT 1\");\r\n\r\n\r\n$pagerow = mysqli_fetch_assoc($haku_s);\r\n\r\n$usePhotoSwipe = false;\r\n\r\nfunction image_gallery($images = array()) {\r\n\tif(count($images)) {\r\n\t\t$toReturn = \"\r\n\t\t\t<div class='img-gallery img' itemscope itemtype='http://schema.org/ImageGallery'>\";\r\n\t\tforeach ($images as $picture) {\r\n\t\t\t$toReturn .= \"<figure itemprop='associatedMedia' itemscope itemtype='http://schema.org/ImageObject'>\r\n\t\t\t\t<a href='\".$picture['img-large'].\"' itemprop='contentUrl' data-size='\".$picture['img-size'].\"'>\r\n\t\t\t\t\t<img src='\".$picture['img-thumb'].\"' itemprop='thumbnail' alt='\".$picture['text'].\"' />\r\n\t\t\t\t</a>\r\n\t\t\t\t<figcaption itemprop='caption description'>\".$picture['text'];\r\n\t\t\t\tif($picture['author'] != \"\") $toReturn .= \"<br/><small>Kuva: \".$picture['author'].\"</small>\";\r\n\t\t\t\t$toReturn .= \"</figcaption>\r\n\t\t\t\t\";\r\n\t\t\tif($picture['break-row']) $toReturn .= \"<br/>\";\r\n\t\t\t$toReturn .= \"</figure>\";\r\n\t\t}\r\n\t\t$toReturn .= \"</div>\";\r\n\t\treturn $toReturn;\r\n\t}\r\n}\r\n\r\nfunction image_exists($id, $yht) {\r\n\treturn mysqli_fetch_array(mysqli_query($yht, \"SELECT `imgur-uid` FROM images WHERE `imgur-uid` = '$id' LIMIT 1\")) !== false;\r\n}\r\nfunction get_image_by_id($id, $yht) {\r\n\treturn mysqli_fetch_assoc(mysqli_query($yht, \"SELECT * FROM images WHERE `imgur-uid` = '$id' LIMIT 1\"));\r\n}\r\n\r\nfunction generate_gallery($text, $yht) {\r\n\t$idArray = explode('*', $text);\r\n\t$images = array();\r\n\tforeach ($idArray as $rid) {\r\n\t\t$attributes = explode('&', $rid);\r\n\t\t$id = $attributes[0];\r\n\t\tif (image_exists($id, $yht)) {\r\n\t\t\t$images[$id] = get_image_by_id($id, $yht);\r\n\t\t\t$images[$id]['break-row'] = $attributes[1] == \"br\";\r\n\t\t}\r\n\t}\r\n\treturn image_gallery($images);\r\n}\r\n\r\n$kuva = $pagerow[\"kuva\"];\r\n$rawtext = $pagerow[\"teksti\"];\r\n$teksti = preg_replace_callback(\r\n\t\"/\\\\<!-+gallery (.+?) gallery-+\\\\>/\",\r\n\tfunction ($matches) use (&$usePhotoSwipe, $yht) {\r\n\t\t$usePhotoSwipe = true;\r\n\t\treturn generate_gallery($matches[1], $yht);\r\n\t},\r\n\t$rawtext\r\n);\r\n$nimi = $pagerow[\"nimi\"];\r\n$html = $pagerow[\"html\"];\r\n$selitys = $pagerow[\"selitys\"];\r\n$uid = $pagerow[\"uid\"];\r\n\r\n?>\r\n<html>\r\n<head>\r\n\r\n<?php include $rel.\"skeleton/metas.php\" ?>\r\n\r\n\r\n<?\r\necho(\"\r\n\t<meta name='description' content='$selitys'>\r\n\t<meta name='og:site_name' content='Parontalli.fi'>\r\n\t<meta name='og:title' content='$nimi'>\r\n\t<meta name='og:description' content='$selitys'>\r\n\");\r\n\r\n?>\r\n<title>\r\n\t<? echo $nimi; ?>\r\n</title>\r\n\r\n<?php include $rel.\"skeleton/styles.php\" ?>\r\n\r\n</head>\r\n\r\n<script>\r\nfunction execRnav()\r\n{\r\n\tif (typeof rnavPosByHeader == 'function') {rnavPosByHeader();}\r\n}\r\nfunction runHandles()\r\n{\r\n\tif (typeof addHandles() == 'function') {addHandles();}\r\n}\r\n</script>\r\n\r\n<body onresize=\"execRnav();\" onscroll=\"execRnav();\" onload=\"runHandles();\">\r\n\r\n<?php if ($usePhotoSwipe) include \"{$rel}skeleton/photoswipe.php\" ?>\r\n<?php include $rel.\"skeleton/header.php\" ?>\r\n\r\n<div class=\"nav\">\r\n\t<?\r\n\t$haku = mysqli_query($yht, \"SELECT * FROM sivut ORDER BY id\");\r\n\twhile ($row = mysqli_fetch_array($haku)){\r\n\t\t$thispage = \"\";\r\n\t\tif ($row['uid'] == $uid){\r\n\t\t\t$thispage = \"thispage\";\r\n\t\t}\r\n\t\tcreateLink($row['color'], \"?s=\".$row['uid'], $thispage, $row['nimi']);\r\n\t}\r\n\t?>\r\n\r\n\t<hr class=\"header\" id=\"\">\r\n</div>\r\n<?\r\nif (!$kuva == \"\"){\r\n\techo '\r\n\t<img src=\"'. $kuva .'\" class=\"header\">\r\n\t';\r\n}\r\n\r\necho $html;\r\n\r\n?>\r\n<div class=\"content\"><br>\r\n\t<?\r\n\techo $teksti;\r\n\t?>\r\n</div>\r\n<?php include $rel.\"skeleton/footer.php\" ?>\r\n</body>\r\n<html>\r\n"], "filenames": ["httpdocs/index.php"], "buggy_code_start_loc": [15], "buggy_code_end_loc": [16], "fixing_code_start_loc": [15], "fixing_code_end_loc": [19], "type": "CWE-89", "message": "A vulnerability was found in ollpu parontalli. It has been classified as critical. Affected is an unknown function of the file httpdocs/index.php. The manipulation of the argument s leads to sql injection. The name of the patch is 6891bb2dec57dca6daabc15a6d2808c8896620e5. It is recommended to apply a patch to fix this issue. VDB-218418 is the identifier assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2017-20170", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-17T14:15:10.613", "lastModified": "2023-01-24T19:09:45.227", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in ollpu parontalli. It has been classified as critical. Affected is an unknown function of the file httpdocs/index.php. The manipulation of the argument s leads to sql injection. The name of the patch is 6891bb2dec57dca6daabc15a6d2808c8896620e5. It is recommended to apply a patch to fix this issue. VDB-218418 is the identifier assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:parontalli_project:parontalli:*:*:*:*:*:*:*:*", "versionEndExcluding": "2017-01-21", "matchCriteriaId": "42B6C9EB-B246-4D92-AB05-7D0E8C46B699"}]}]}], "references": [{"url": "https://github.com/ollpu/parontalli/commit/6891bb2dec57dca6daabc15a6d2808c8896620e5", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.218418", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory", "VDB Entry"]}, {"url": "https://vuldb.com/?id.218418", "source": "cna@vuldb.com", "tags": ["Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/ollpu/parontalli/commit/6891bb2dec57dca6daabc15a6d2808c8896620e5"}}