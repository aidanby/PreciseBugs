{"buggy_code": ["<?php\n\n/* Copyright (c) 1998-2009 ILIAS open source, Extended GPL, see docs/LICENSE */\n\n/**\n* Wraps $item arrays from magpie\n*\n* @author Alex Killing <alex.killing@gmx.de>\n* @version $Id$\n* @ingroup ServicesFeeds\n*/\nclass ilExternalFeedItem\n{\n\tfunction __construct()\n\t{\n\t}\n\t\n\t/**\n\t* Set Magpie Item and read it into internal variables\n\t*/\n\tfunction setMagpieItem($a_item)\n\t{\n\t\t$this->magpie_item = $a_item;\n\n\t\t//var_dump($a_item);\n\t\t\n\t\t// title\n\t\t$this->setTitle(\n\t\t\t$this->secureString($a_item[\"title\"]));\n\t\t\n\t\t// link\n\t\tif (isset($a_item[\"link_\"]))\n\t\t{\n\t\t\t$this->setLink(\n\t\t\t\tilUtil::secureLink($this->secureString($a_item[\"link_\"])));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (isset($a_item[\"link\"]))\n\t\t\t{\n\t\t\t\t$this->setLink(\n\t\t\t\t\tilUtil::secureLink($this->secureString($a_item[\"link\"])));\n\t\t\t}\n\t\t}\n\t\t\n\t\t// summary\n\t\tif (isset($a_item[\"atom_content\"]))\n\t\t{\n\t\t\t$this->setSummary(\n\t\t\t\t$this->secureString($a_item[\"atom_content\"]));\n\t\t}\n\t\telse if (isset($a_item[\"summary\"]))\n\t\t{\n\t\t\t$this->setSummary(\n\t\t\t\t$this->secureString($a_item[\"summary\"]));\n\t\t}\n\t\telse if (isset($a_item[\"description\"]))\n\t\t{\n\t\t\t$this->setSummary(\n\t\t\t\t$this->secureString($a_item[\"description\"]));\n\t\t}\n\t\t\n\t\t// date\n\t\tif (isset($a_item[\"pubdate\"]))\n\t\t{\n\t\t\t$this->setDate(\n\t\t\t\t$this->secureString($a_item[\"pubdate\"]));\n\t\t}\n\t\telse if (isset($a_item[\"updated\"]))\n\t\t{\n\t\t\t$this->setDate(\n\t\t\t\t$this->secureString($a_item[\"updated\"]));\n\t\t}\n\n\t\t// Author\n\t\tif (isset($a_item[\"dc\"][\"creator\"]))\n\t\t{\n\t\t\t$this->setAuthor(\n\t\t\t\t$this->secureString($a_item[\"dc\"][\"creator\"]));\n\t\t}\n\n\t\t// id\n\t\t$this->setId(md5($this->getTitle().$this->getSummary()));\n\n\t}\n\t\n\tfunction secureString($a_str)\n\t{\n\t\t$a_str = ilUtil::secureString($a_str, true, \"<b><i><em><strong><br><ol><li><ul><a><img>\");\n\t\t$old_str = \"\";\n\t\t\n\t\t// set target to blank for all links\n\t\twhile($old_str != $a_str)\n\t\t{\n\t\t\t$old_str = $a_str;\n\t\t\t$a_str = preg_replace(\"/<a href=\\\"([^\\\"]*)\\\">/i\",\n\t\t\t\t\"/<a href=\\\"\\\\1\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">/\", $a_str);\n\t\t}\n\t\treturn $a_str;\n\t}\n\t\n\t/**\n\t* Get Magpie Item\n\t*\n\t* @return\tobject\tMagpie Item\n\t*/\n\tfunction getMagpieItem()\n\t{\n\t\treturn $this->magpie_item;\n\t}\n\n\t/**\n\t* Set Title.\n\t*\n\t* @param\tstring\t$a_title\tTitle\n\t*/\n\tfunction setTitle($a_title)\n\t{\n\t\t$this->title = $a_title;\n\t}\n\n\t/**\n\t* Get Title.\n\t*\n\t* @return\tstring\tTitle\n\t*/\n\tfunction getTitle()\n\t{\n\t\treturn $this->title;\n\t}\n\n\t/**\n\t* Set Link.\n\t*\n\t* @param\tstring\t$a_link\tLink\n\t*/\n\tfunction setLink($a_link)\n\t{\n\t\t$this->link = $a_link;\n\t}\n\n\t/**\n\t* Get Link.\n\t*\n\t* @return\tstring\tLink\n\t*/\n\tfunction getLink()\n\t{\n\t\treturn $this->link;\n\t}\n\n\t/**\n\t* Set Summary.\n\t*\n\t* @param\tstring\t$a_summary\tSummary\n\t*/\n\tfunction setSummary($a_summary)\n\t{\n\t\t$this->summary = $a_summary;\n\t}\n\n\t/**\n\t* Get Summary.\n\t*\n\t* @return\tstring\tSummary\n\t*/\n\tfunction getSummary()\n\t{\n\t\treturn $this->summary;\n\t}\n\n\t/**\n\t* Set Date.\n\t*\n\t* @param\tstring\t$a_date\tDate\n\t*/\n\tfunction setDate($a_date)\n\t{\n\t\t$this->date = $a_date;\n\t}\n\n\t/**\n\t* Get Date.\n\t*\n\t* @return\tstring\tDate\n\t*/\n\tfunction getDate()\n\t{\n\t\treturn $this->date;\n\t}\n\n\t/**\n\t* Set Id.\n\t*\n\t* @param\tstring\t$a_id\tId\n\t*/\n\tfunction setId($a_id)\n\t{\n\t\t$this->id = $a_id;\n\t}\n\n\t/**\n\t* Get Id.\n\t*\n\t* @return\tstring\tId\n\t*/\n\tfunction getId()\n\t{\n\t\treturn $this->id;\n\t}\n\n\t/**\n\t* Set Author.\n\t*\n\t* @param\tstring\t$a_author\tAuthor\n\t*/\n\tfunction setAuthor($a_author)\n\t{\n\t\t$this->author = $a_author;\n\t}\n\n\t/**\n\t* Get Author.\n\t*\n\t* @return\tstring\tAuthor\n\t*/\n\tfunction getAuthor()\n\t{\n\t\treturn $this->author;\n\t}\n}\n"], "fixing_code": ["<?php\n\n/* Copyright (c) 1998-2009 ILIAS open source, Extended GPL, see docs/LICENSE */\n\n/**\n* Wraps $item arrays from magpie\n*\n* @author Alex Killing <alex.killing@gmx.de>\n* @version $Id$\n* @ingroup ServicesFeeds\n*/\nclass ilExternalFeedItem\n{\n\tfunction __construct()\n\t{\n\t}\n\t\n\t/**\n\t* Set Magpie Item and read it into internal variables\n\t*/\n\tfunction setMagpieItem($a_item)\n\t{\n\t\t$this->magpie_item = $a_item;\n\n\t\t//var_dump($a_item);\n\t\t\n\t\t// title\n\t\t$this->setTitle(\n\t\t\t$this->secureString($a_item[\"title\"]));\n\t\t\n\t\t// link\n\t\tif (isset($a_item[\"link_\"]))\n\t\t{\n\t\t\t$this->setLink(\n\t\t\t\tilUtil::secureUrl(ilUtil::secureLink($this->secureString($a_item[\"link_\"]))));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (isset($a_item[\"link\"]))\n\t\t\t{\n\t\t\t\t$this->setLink(\n\t\t\t\t\tilUtil::secureUrl(ilUtil::secureLink($this->secureString($a_item[\"link\"]))));\n\t\t\t}\n\t\t}\n\t\t// summary\n\t\tif (isset($a_item[\"atom_content\"]))\n\t\t{\n\t\t\t$this->setSummary(\n\t\t\t\t$this->secureString($a_item[\"atom_content\"]));\n\t\t}\n\t\telse if (isset($a_item[\"summary\"]))\n\t\t{\n\t\t\t$this->setSummary(\n\t\t\t\t$this->secureString($a_item[\"summary\"]));\n\t\t}\n\t\telse if (isset($a_item[\"description\"]))\n\t\t{\n\t\t\t$this->setSummary(\n\t\t\t\t$this->secureString($a_item[\"description\"]));\n\t\t}\n\t\t\n\t\t// date\n\t\tif (isset($a_item[\"pubdate\"]))\n\t\t{\n\t\t\t$this->setDate(\n\t\t\t\t$this->secureString($a_item[\"pubdate\"]));\n\t\t}\n\t\telse if (isset($a_item[\"updated\"]))\n\t\t{\n\t\t\t$this->setDate(\n\t\t\t\t$this->secureString($a_item[\"updated\"]));\n\t\t}\n\n\t\t// Author\n\t\tif (isset($a_item[\"dc\"][\"creator\"]))\n\t\t{\n\t\t\t$this->setAuthor(\n\t\t\t\t$this->secureString($a_item[\"dc\"][\"creator\"]));\n\t\t}\n\n\t\t// id\n\t\t$this->setId(md5($this->getTitle().$this->getSummary()));\n\n\t}\n\t\n\tfunction secureString($a_str)\n\t{\n\t\t$a_str = ilUtil::secureString($a_str, true, \"<b><i><em><strong><br><ol><li><ul><a><img>\");\n\t\t$old_str = \"\";\n\t\t\n\t\t// set target to blank for all links\n\t\twhile($old_str != $a_str)\n\t\t{\n\t\t\t$old_str = $a_str;\n\t\t\t$a_str = preg_replace(\"/<a href=\\\"([^\\\"]*)\\\">/i\",\n\t\t\t\t\"/<a href=\\\"\\\\1\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">/\", $a_str);\n\t\t}\n\t\treturn $a_str;\n\t}\n\t\n\t/**\n\t* Get Magpie Item\n\t*\n\t* @return\tobject\tMagpie Item\n\t*/\n\tfunction getMagpieItem()\n\t{\n\t\treturn $this->magpie_item;\n\t}\n\n\t/**\n\t* Set Title.\n\t*\n\t* @param\tstring\t$a_title\tTitle\n\t*/\n\tfunction setTitle($a_title)\n\t{\n\t\t$this->title = $a_title;\n\t}\n\n\t/**\n\t* Get Title.\n\t*\n\t* @return\tstring\tTitle\n\t*/\n\tfunction getTitle()\n\t{\n\t\treturn $this->title;\n\t}\n\n\t/**\n\t* Set Link.\n\t*\n\t* @param\tstring\t$a_link\tLink\n\t*/\n\tfunction setLink($a_link)\n\t{\n\t\t$this->link = $a_link;\n\t}\n\n\t/**\n\t* Get Link.\n\t*\n\t* @return\tstring\tLink\n\t*/\n\tfunction getLink()\n\t{\n\t\treturn $this->link;\n\t}\n\n\t/**\n\t* Set Summary.\n\t*\n\t* @param\tstring\t$a_summary\tSummary\n\t*/\n\tfunction setSummary($a_summary)\n\t{\n\t\t$this->summary = $a_summary;\n\t}\n\n\t/**\n\t* Get Summary.\n\t*\n\t* @return\tstring\tSummary\n\t*/\n\tfunction getSummary()\n\t{\n\t\treturn $this->summary;\n\t}\n\n\t/**\n\t* Set Date.\n\t*\n\t* @param\tstring\t$a_date\tDate\n\t*/\n\tfunction setDate($a_date)\n\t{\n\t\t$this->date = $a_date;\n\t}\n\n\t/**\n\t* Get Date.\n\t*\n\t* @return\tstring\tDate\n\t*/\n\tfunction getDate()\n\t{\n\t\treturn $this->date;\n\t}\n\n\t/**\n\t* Set Id.\n\t*\n\t* @param\tstring\t$a_id\tId\n\t*/\n\tfunction setId($a_id)\n\t{\n\t\t$this->id = $a_id;\n\t}\n\n\t/**\n\t* Get Id.\n\t*\n\t* @return\tstring\tId\n\t*/\n\tfunction getId()\n\t{\n\t\treturn $this->id;\n\t}\n\n\t/**\n\t* Set Author.\n\t*\n\t* @param\tstring\t$a_author\tAuthor\n\t*/\n\tfunction setAuthor($a_author)\n\t{\n\t\t$this->author = $a_author;\n\t}\n\n\t/**\n\t* Get Author.\n\t*\n\t* @return\tstring\tAuthor\n\t*/\n\tfunction getAuthor()\n\t{\n\t\treturn $this->author;\n\t}\n}\n"], "filenames": ["Services/Feeds/classes/class.ilExternalFeedItem.php"], "buggy_code_start_loc": [35], "buggy_code_end_loc": [46], "fixing_code_start_loc": [35], "fixing_code_end_loc": [44], "type": "CWE-79", "message": "Services/Feeds/classes/class.ilExternalFeedItem.php in ILIAS 5.1.x, 5.2.x, and 5.3.x before 5.3.5 has XSS via a link attribute.", "other": {"cve": {"id": "CVE-2018-11117", "sourceIdentifier": "cve@mitre.org", "published": "2018-05-17T13:29:00.303", "lastModified": "2018-06-15T19:37:42.600", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Services/Feeds/classes/class.ilExternalFeedItem.php in ILIAS 5.1.x, 5.2.x, and 5.3.x before 5.3.5 has XSS via a link attribute."}, {"lang": "es", "value": "Services/Feeds/classes/class.ilExternalFeedItem.php en ILIAS 5.1.x, 5.2.x y 5.3.x en versiones anteriores a la 5.3.5 tiene Cross-Site Scripting (XSS) mediante un atributo link."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:ilias:ilias:*:*:*:*:*:*:*:*", "versionStartIncluding": "5.1.0", "versionEndIncluding": "5.1.26", "matchCriteriaId": "0F3792D7-FE39-4C56-B7D9-B67B0B0C94E8"}, {"vulnerable": true, "criteria": "cpe:2.3:a:ilias:ilias:*:*:*:*:*:*:*:*", "versionStartIncluding": "5.2.0", "versionEndIncluding": "5.2.15", "matchCriteriaId": "5D26A1D2-92C7-4540-BE93-2FCFE7EAC5D3"}, {"vulnerable": true, "criteria": "cpe:2.3:a:ilias:ilias:*:*:*:*:*:*:*:*", "versionStartIncluding": "5.3.0", "versionEndIncluding": "5.3.4", "matchCriteriaId": "AE2188AF-D708-4548-80E4-72AB685C4DAF"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:ilias:ilias:5.1.0:beta1:*:*:*:*:*:*", "matchCriteriaId": "98C8D659-2BE5-484E-B97E-BF821B106D47"}, {"vulnerable": true, "criteria": "cpe:2.3:a:ilias:ilias:5.2.0:beta1:*:*:*:*:*:*", "matchCriteriaId": "A89A7A96-92A8-4222-8959-FA9A27601FE1"}, {"vulnerable": true, "criteria": "cpe:2.3:a:ilias:ilias:5.2.0:beta2:*:*:*:*:*:*", "matchCriteriaId": "F373F01C-F090-44A9-ACB6-030F8CB85402"}, {"vulnerable": true, "criteria": "cpe:2.3:a:ilias:ilias:5.2.0:beta3:*:*:*:*:*:*", "matchCriteriaId": "992F70E2-77FA-4E92-A373-592960C9DF57"}]}]}], "references": [{"url": "https://github.com/ILIAS-eLearning/ILIAS/commit/ff9bf29858f2dbffe828711a6f8bf37038c00d77", "source": "cve@mitre.org", "tags": ["Patch"]}, {"url": "https://www.ilias.de/docu/goto.php?target=st_229", "source": "cve@mitre.org", "tags": ["Release Notes", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/ILIAS-eLearning/ILIAS/commit/ff9bf29858f2dbffe828711a6f8bf37038c00d77"}}