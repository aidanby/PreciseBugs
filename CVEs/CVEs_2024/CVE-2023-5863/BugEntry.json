{"buggy_code": ["<?php\n\n/**\n * The login form.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at https://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author    Alexander M. Turek <me@derrabus.de>\n * @copyright 2013-2023 phpMyFAQ Team\n * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2013-02-05\n */\n\nuse phpMyFAQ\\Component\\Alert;\nuse phpMyFAQ\\Translation;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\nif (isset($error) && 0 < strlen((string) $error)) {\n    $message = sprintf(\n        '<div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">%s' .\n        '  <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\"></button>' .\n        '</div>',\n        $error\n    );\n} else {\n    $message = sprintf('<p>%s</p>', Translation::get('ad_auth_insert'));\n}\n\n$request = Request::createFromGlobals();\n\nif ($request->query->get('action') === 'logout') {\n    $message = Alert::success('ad_logout');\n}\n\nif ($request->isSecure() || !$faqConfig->get('security.useSslForLogins')) {\n    ?>\n\n    <div id=\"pmf-admin-login\">\n        <div id=\"pmf-admin-login-content\">\n            <main>\n                <div class=\"container\">\n                    <div class=\"row justify-content-center\">\n                        <div class=\"col-lg-5\">\n                            <div class=\"card shadow-lg border-0 rounded-lg mt-5\">\n                                <div class=\"card-header\">\n                                    <h3 class=\"text-center font-weight-light my-4\">phpMyFAQ Login</h3>\n                                    <?= $message ?>\n                                </div>\n                                <div class=\"card-body\">\n                                    <form action=\"<?= $faqSystem->getSystemUri($faqConfig) ?>admin/index.php\"\n                                          method=\"post\" accept-charset=\"utf-8\" role=\"form\">\n                                        <input type=\"hidden\" name=\"redirect-action\"\n                                               value=\"<?= $request->query->get('action') ?>\">\n                                        <div class=\"form-floating mb-3\">\n                                            <input class=\"form-control\" id=\"faqusername\" name=\"faqusername\" type=\"text\"\n                                                   placeholder=\"<?= Translation::get('ad_auth_user') ?>\" />\n                                            <label for=\"faqusername\"><?= Translation::get('ad_auth_user') ?></label>\n                                        </div>\n                                        <div class=\"input-group mb-3\">\n                                            <div class=\"form-floating\">\n                                                <input class=\"form-control\" id=\"faqpassword\" name=\"faqpassword\"\n                                                       type=\"password\" autocomplete=\"off\"\n                                                       placeholder=\"<?= Translation::get('ad_auth_passwd') ?>\" />\n                                                <label for=\"faqpassword\">\n                                                    <?= Translation::get('ad_auth_passwd') ?>\n                                                </label>\n                                            </div>\n                                            <span class=\"input-group-text\">\n                                                <i class=\"fa\" id=\"togglePassword\"></i>\n                                            </span>\n                                        </div>\n                                        <div class=\"form-check mb-3\">\n                                            <input class=\"form-check-input\" id=\"faqrememberme\" name=\"faqrememberme\" type=\"checkbox\"\n                                                   value=\"rememberMe\" />\n                                            <label class=\"form-check-label\"\n                                                   for=\"faqrememberme\"><?= Translation::get('rememberMe') ?></label>\n                                        </div>\n                                        <div class=\"d-flex align-items-center justify-content-between mt-4 mb-0\">\n                                            <a class=\"small\"\n                                               href=\"../?action=password\"><?= Translation::get('lostPassword') ?></a>\n                                            <button type=\"submit\" class=\"btn btn-primary\">\n                                                <?= Translation::get('msgLoginUser') ?>\n                                            </button>\n                                        </div>\n                                    </form>\n                                </div>\n                                <?php\n                                if ($faqConfig->get('security.enableRegistration')) { ?>\n                                    <div class=\"card-footer text-center py-3\">\n                                        <a class=\"w-100 py-2 mb-2 btn btn-outline-primary rounded-3\"\n                                           href=\"../?action=register\">\n                                            <?= Translation::get('msgRegistration') ?>\n                                        </a>\n                                        <?php if ($faqConfig->isSignInWithMicrosoftActive()) { ?>\n                                        <a class=\"w-100 py-2 mb-2 btn btn-outline-secondary rounded-3\"\n                                           href=\"../services/azure\">\n                                            <i class=\"fa fa-windows\" aria-hidden=\"true\"></i>\n                                            <?= Translation::get('msgSignInWithMicrosoft') ?>\n                                        </a>\n                                        <?php } ?>\n                                    </div>\n                                    <?php\n                                } ?>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </main>\n        </div>\n    </div>\n\n    <?php\n} else {\n    printf(\n        '<p><a href=\"https://%s%s\">%s</a></p>',\n        $request->getHost(),\n        $request->getRequestUri(),\n        Translation::get('msgSecureSwitch')\n    );\n}\n"], "fixing_code": ["<?php\n\n/**\n * The login form.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at https://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author    Alexander M. Turek <me@derrabus.de>\n * @copyright 2013-2023 phpMyFAQ Team\n * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2013-02-05\n */\n\nuse phpMyFAQ\\Component\\Alert;\nuse phpMyFAQ\\Strings;\nuse phpMyFAQ\\Translation;\nuse Symfony\\Component\\HttpFoundation\\Request;\n\nif (isset($error) && 0 < strlen((string) $error)) {\n    $message = sprintf(\n        '<div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">%s' .\n        '  <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\" aria-label=\"Close\"></button>' .\n        '</div>',\n        $error\n    );\n} else {\n    $message = sprintf('<p>%s</p>', Translation::get('ad_auth_insert'));\n}\n\n$request = Request::createFromGlobals();\n\nif ($request->query->get('action') === 'logout') {\n    $message = Alert::success('ad_logout');\n}\n\nif ($request->isSecure() || !$faqConfig->get('security.useSslForLogins')) {\n    ?>\n\n    <div id=\"pmf-admin-login\">\n        <div id=\"pmf-admin-login-content\">\n            <main>\n                <div class=\"container\">\n                    <div class=\"row justify-content-center\">\n                        <div class=\"col-lg-5\">\n                            <div class=\"card shadow-lg border-0 rounded-lg mt-5\">\n                                <div class=\"card-header\">\n                                    <h3 class=\"text-center font-weight-light my-4\">phpMyFAQ Login</h3>\n                                    <?= $message ?>\n                                </div>\n                                <div class=\"card-body\">\n                                    <form action=\"<?= $faqSystem->getSystemUri($faqConfig) ?>admin/index.php\"\n                                          method=\"post\" accept-charset=\"utf-8\" role=\"form\">\n                                        <input type=\"hidden\" name=\"redirect-action\"\n                                               value=\"<?= Strings::htmlentities($request->query->get('action')) ?>\">\n                                        <div class=\"form-floating mb-3\">\n                                            <input class=\"form-control\" id=\"faqusername\" name=\"faqusername\" type=\"text\"\n                                                   placeholder=\"<?= Translation::get('ad_auth_user') ?>\" />\n                                            <label for=\"faqusername\"><?= Translation::get('ad_auth_user') ?></label>\n                                        </div>\n                                        <div class=\"input-group mb-3\">\n                                            <div class=\"form-floating\">\n                                                <input class=\"form-control\" id=\"faqpassword\" name=\"faqpassword\"\n                                                       type=\"password\" autocomplete=\"off\"\n                                                       placeholder=\"<?= Translation::get('ad_auth_passwd') ?>\" />\n                                                <label for=\"faqpassword\">\n                                                    <?= Translation::get('ad_auth_passwd') ?>\n                                                </label>\n                                            </div>\n                                            <span class=\"input-group-text\">\n                                                <i class=\"fa\" id=\"togglePassword\"></i>\n                                            </span>\n                                        </div>\n                                        <div class=\"form-check mb-3\">\n                                            <input class=\"form-check-input\" id=\"faqrememberme\" name=\"faqrememberme\" type=\"checkbox\"\n                                                   value=\"rememberMe\" />\n                                            <label class=\"form-check-label\"\n                                                   for=\"faqrememberme\"><?= Translation::get('rememberMe') ?></label>\n                                        </div>\n                                        <div class=\"d-flex align-items-center justify-content-between mt-4 mb-0\">\n                                            <a class=\"small\"\n                                               href=\"../?action=password\"><?= Translation::get('lostPassword') ?></a>\n                                            <button type=\"submit\" class=\"btn btn-primary\">\n                                                <?= Translation::get('msgLoginUser') ?>\n                                            </button>\n                                        </div>\n                                    </form>\n                                </div>\n                                <?php\n                                if ($faqConfig->get('security.enableRegistration')) { ?>\n                                    <div class=\"card-footer text-center py-3\">\n                                        <a class=\"w-100 py-2 mb-2 btn btn-outline-primary rounded-3\"\n                                           href=\"../?action=register\">\n                                            <?= Translation::get('msgRegistration') ?>\n                                        </a>\n                                        <?php if ($faqConfig->isSignInWithMicrosoftActive()) { ?>\n                                        <a class=\"w-100 py-2 mb-2 btn btn-outline-secondary rounded-3\"\n                                           href=\"../services/azure\">\n                                            <i class=\"fa fa-windows\" aria-hidden=\"true\"></i>\n                                            <?= Translation::get('msgSignInWithMicrosoft') ?>\n                                        </a>\n                                        <?php } ?>\n                                    </div>\n                                    <?php\n                                } ?>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </main>\n        </div>\n    </div>\n\n    <?php\n} else {\n    printf(\n        '<p><a href=\"https://%s%s\">%s</a></p>',\n        $request->getHost(),\n        $request->getRequestUri(),\n        Translation::get('msgSecureSwitch')\n    );\n}\n"], "filenames": ["phpmyfaq/admin/login.php"], "buggy_code_start_loc": [19], "buggy_code_end_loc": [59], "fixing_code_start_loc": [20], "fixing_code_end_loc": [60], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Reflected in GitHub repository thorsten/phpmyfaq prior to 3.2.2.", "other": {"cve": {"id": "CVE-2023-5863", "sourceIdentifier": "security@huntr.dev", "published": "2023-10-31T01:15:07.757", "lastModified": "2023-11-08T02:12:17.687", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Reflected in GitHub repository thorsten/phpmyfaq prior to 3.2.2."}, {"lang": "es", "value": "Cross-site Scripting (XSS): reflejado en el repositorio de GitHub thorsten/phpmyfaq antes de 3.2.2."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 7.4, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.1, "impactScore": 3.7}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyfaq:phpmyfaq:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.2.2", "matchCriteriaId": "ABD3B984-C15B-43BF-ADE8-2AF970E88C8C"}]}]}], "references": [{"url": "https://github.com/thorsten/phpmyfaq/commit/97e813dcd2022bd10a8770569a8b02591716365f", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.com/bounties/fbfd4e84-61fb-4063-8f11-15877b8c1f6f", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/thorsten/phpmyfaq/commit/97e813dcd2022bd10a8770569a8b02591716365f"}}