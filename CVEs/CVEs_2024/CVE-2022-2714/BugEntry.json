{"buggy_code": ["# CHANGES\n## RosarioSIS Student Information System\n\nChanges in 10.0\n---------------\n- SQL convert table names to lowercase, program wide\n- Fix delete file attached in StudentFees.php\n- Use DBEscapeIdentifier() for reserved 'column' keyword in plugins/Moodle/\n- Avoid regression due to lowercase table names: Maintain compatibility with add-ons using rollover_after action hook & `$_REQUEST['tables']` in Rollover.php\n- Use db_trans_*() functions in DeleteTransaction.fnc.php & DeleteTransactionItem.fnc.php\n- Close popup if no UserSchool in session, happens on login redirect in Warehouse.php\n- SQL order Grade Levels in StudentBreakdown.php\n- Remove semicolon before \"With\" & \"On\" values in PrintRequests.php & unfilledRequests.inc.php\n- HTML Link is selected: bold in ScheduleReport.php\n- Display Period title if no short name set in IncompleteSchedules.php\n- Fix Widget search & add Search Terms header in IncompleteSchedules.php\n- Add Schedule link & photo tooltip to Student name in Scheduling/AddDrop.php\n- HTML add a11y-hidden label to select in GPARankList.php & Attendance/TeacherCompletion.php\n- Fix unset requested dates in MassCreateAssignments.php & Assignments.php\n- Add User / Student photo tooltip in Grades/TeacherCompletion.php, GPARankList.php & EnterEligibility.php\n- SQL order by Period title in TeacherCompletion.php\n- Use Period's Short Name when > 10 columns in the list in TeacherCompletion.php\n- Add note on save in EntryTimes.php\n- Fix PHP8.1 Deprecated passing null to parameter in EmailReferral.fnc.php, CategoryBreakdown.php & StudentGrades.php\n- Add Total sum of balances in StaffBalances.php\n- Fix French translation for \"Waiver\" & \"Refund\" in rosariosis.po\n- Force title & action to lowercase in Prompts.php\n- HTML use .dashboard-module-title CSS class for module titles in Profiles.php & Exceptions.php\n- CSS set input label max-width on Search form in stylesheet.css\n- JS new default popup size: 1200x450 in warehouse.js\n- Use URLEscape() for add button link when appropriate in ListOutput.fnc.php\n- JS set Calendar date to current fields date in warehouse.js & calendar-setup.js\n- HTML add label to select in ActivityReport.php\n- Use Currency() function instead of number_format() in TransactionsReport.php\n- HTML remove line-break in Warning/Minimum columns in Reminders.php\n- HTML CSS make Daily Menus calendar coherent with School Calendar in DailyMenus.php\n- Shorten Referral email subject in EmailReferral.fnc.php\n- Use plural wise ngettext() for \"No %s were found.\" in FinalGrades.php, GradeBreakdown.php, ReportCardComments.php, ReportCards.php & Transcripts.php\n- Force result text to lowercase for \"No %s were found.\" in ListOutput.fnc.php, FinalGrades.php, GradeBreakdown.php, ReportCardComments.php, ReportCards.php & Transcripts.php\n- Prevent admin from removing own access to User Profiles program in Profiles.php\n- SQL change modname column type from text to varchar(150) to match with MySQL key index limitation in rosariosis.sql\n- SQL change program column type from text to varchar(100) NOT NULL to match with MySQL index limitation in rosariosis.sql\n- SQL change schools column type from text to varchar(150) to match with MySQL index limitation in rosariosis.sql\n- Rename YEAR_MONTH column alias to YEAR_MONTH_DATE: reserved keyword in MySQL in Dashboard.inc.php\n- SQL use DAYOFWEEK() for MySQL or cast(extract(DOW)+1 AS int) for PostrgeSQL, program wide\n- SQL cast(AS UNSIGNED) for MySQL or cast(AS INT) for PostgreSQL, program wide\n- SQL cast custom_fields ID as VARCHAR(10) instead of TEXT for MySQL compatibility in GetStaffList.fnc.php, GetStuList.fnc.php & Search.fnc.php\n- SQL rename $field COLUMN (reserved keyword) to COLUMN_NAME for MySQL compatibility in CustomFields.fnc.php, GetStaffList.fnc.php, GetStuList.fnc.php & Search.fnc.php\n- SQL remove use of nextval in rosariosis_fr.sql\n- Rename $pg_dumpPath configuration variable to $DatabaseDumpPath in config.inc.sample.php, diagnostic.php & DatabaseBackup.php\n- Build command for executing mysqldump in DatabaseBackup.php\n- SQL to extract Unix timestamp or epoch from date in Eligibility/Student.php, StudentList.php & TeacherCompletion.php\n- Install module/plugin: execute the install_mysql.sql script for MySQL in Modules.inc.php, Plugins.inc.php & modules/README.md & plugins/README.md\n- Fix typo \"inexistant\" to \"nonexistent\" & update translations in Modules.inc.php, Plugins.inc.php & rosariosis.po\n- HTML fix duplicated #menu-top div on update in Side.php\n- JS fix #body height calculation: include bottom margin in jquery-fixedmenu.js & plugins.min.js\n- Add MySQLRemoveDelimiter() remove DELIMITER $$ declarations before procedures or functions in database.inc.php, Modules.inc.php & Plugins.inc.php\n- SQL ORDER BY SORT_ORDER IS NULL,SORT_ORDER (nulls last) for consistency between PostgreSQL & MySQL, program wide\n- Rollback Fix PostgreSQL error invalid ORDER BY, only result column names can be used, program wide\n- HTML use number input for Gradebook config options in Configuration.php\n- HTML use number input for Grade points & average in ReportCardGrades.php\n- SQL limit results to current school year in AddDrop.php\n- SQL always use INTERVAL to add/subtract days to date for MySQL compatibility in Reminders.php, Transactions.php, ServeMenus.php, Assignments.php, StudentGrades.php, Rollover.php & Portal.php\n- SQL change amount columns type from numeric to numeric(14,2) NOT NULL in rosariosis.sql & StudentFees.php\n- SQL change minutes,minutes_present,points,default_points,length,count_weighted_factors,count_unweighted_factors columns type from numeric to integer in rosariosis.sql, UpdateAttendanceDaily.fnc.php, Assignments.php, MassCreateAssignments.php & Periods.php\n- SQL change gp & gpa columns type from numeric to numeric(7,2) in rosariosis.sql\n- SQL change sum/cum factors & credit_attempted/earned columns type from numeric to double precision in rosariosis.sql\n- Add Can use modname to HACKING ATTEMPT error email in ErrorMessage.fnc.php\n- Fix HACKING ATTEMPT when Grades module inactive in Portal.php & Calendar.php\n- Use GetTemplate() instead of unescaping `$_REQUEST` in CreateParents.php & NotifyParents.php\n- Use `$_POST` to get password instead of unescaping `$_REQUEST` in PasswordReset.php, Student.php & User.php\n- Use DBGetOne() instead of unescaping `$_REQUEST` in Config.fnc.php\n- Add MySQL support in database.inc.php, diagnostic.php, InstallDatabase.php & Warehouse.php\n- Add $DatabaseType configuration variable in database.inc.php, diagnostic.php, InstallDatabase.php, Warehouse.php & config.inc.php\n- Add $show_error parameter to db_start() in database.inc.php\n- Add DBUnescapeString() function in database.inc.php, GetStuList.fnc.php, ListOutput.fnc.php, PreparePHP_SELF.fnc.php & Search.fnc.php\n- PostgreSQL Date format: move query from Date.php to Warehouse.php\n- Compatibility with add-ons version < 10.0, gather CONFIG (uppercase table name) values too in Configuration.php\n- Fix MySQL error Table is specified twice, both as a target for 'INSERT' and as a separate source for data in CopySchool.php & Rollover.php\n- Fix MySQL syntax error: no table alias in DELETE in Rollover.php\n- Fix MySQL syntax error: no FROM allowed inside UPDATE, use subquery or multi-table syntax in Rollover.php\n- Fix MySQL syntax error: replace CAST (NULL AS CHAR(1)) AS CHECKBOX with NULL AS CHECKBOX in AddAbsences.php, AddActivity.php, MassDrops.php, MassRequests.php, MassSchedule.php, AddUsers.php, AssignOtherInfo.php & AddStudents.php\n- Add Installation tutorial for Mac in WHATS_NEW.md & INSTALL.md, INSTALL_fr.md & INSTALL_es.md\n- Update tested on Ubuntu 18.04 to 20.04 in INSTALL.md, INSTALL_fr.md & INSTALL_es.md\n- Fix SQL error when column already dropped in Fields.fnc.php\n- SQL fix CREATE INDEX on right table in rosariosis.sql\n- SQL remove unused indices for various tables in rosariosis.sql\n- SQL match index with FOREIGN KEY for various tables in rosariosis.sql\n- SQL ORDER BY fix issue when Transferring to another school & new start date is <= old start date in Enrollment.inc.php\n- Check if student already enrolled on that date when inserting START_DATE in SaveEnrollment.fnc.php\n- Add `_getAddonsSQL()` & `_configTableCheck()` functions in InstallDatabase.php\n- $DatabasePort configuration variable is now optional in config.inc.sample.php, INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- SQL start staff_fields ID sequence at 200000000 for coherence with custom_fields in rosariosis.sql & Fields.fnc.php\n- MySQL use LONGTEXT type for textarea field in Fields.fnc.php & DisciplineForm.php\n- SQL Check requested assignment belongs to teacher in Assignments.php\n- CSS fix responsive when really long string with no space in stylesheet.css\n\nChanges in 9.3.1\n----------------\n- Fix regression since 2.9 Schedule multiple courses in plugins/Moodle/Scheduling/MassSchedule.php\n- Fix SQL to select Periods where exists CP in TeacherCompletion.php & Administration.php\n- Fix dummy day (year month date) set to 28 for February in Dashboard.inc.php\n- Fix AllowEdit for Teacher in Users/includes/General_Info.inc.php\n- Security: sanitize filename with no_accents() in Student.php, User.php & Schools.php\n- Fix \"Exclude PDF generated using the \"Print\" button\" option for the PDF Header Footer plugin in Bottom.php\n\nChanges in 9.3\n--------------\n- Handle case where Course Period Parent ID is null in Courses.php\n- SQL order by Period title in Periods.php, DailySummary.php & StudentSummary.php\n- SQL get Period title if no short name set in AddAbsences.php\n- Use DBLastInsertID() instead of DBSeqNextID() in Moodle/includes/ImportUsers.fnc.php\n- Still use DBSeqNextID() for student ID, adapt for MySQL in Student.php & Moodle/includes/ImportUsers.fnc.php\n- SQL use CONCAT() instead of pipes || for MySQL compatibility, program wide\n- Fix first item in the list not displayed in Accounting/includes/DailyTransactions.php\n- SQL time interval for MySQL compatibility in PasswordReset.php & index.php\n- SQL use CAST(X AS varchar(X)) instead of to_char() for MySQL compatibility in Dashboard.inc.php & Reminders.php\n- SQL result as comma separated list for MySQL compatibility in Grades/includes/Dashboard.inc.php & MasterScheduleReport.php\n- Use DBEscapeIdentifier() for MySQL reserved 'TIMESTAMP' keyword in ServeMenus.php & Transactions.php\n- SQL add `_SQLUnixTimestamp()` to extract Unix timestamp or epoch from date in Grades.php & Schedule.php\n- Add case for MySQL: get next MP ID & set AUTO_INCREMENT+1 in EditHistoryMarkingPeriods.php\n- Display Name: SQL use CONCAT() instead of pipes || for MySQL compatibility in Configuration.php & GetStuList.fnc.php\n- config table: update DISPLAY_NAME to use CONCAT() instead of pipes || in Update.fnc.php\n\nChanges in 9.2.2\n----------------\n- Fix SQL error lastval is not yet defined when editing field in SchoolFields.php, AddressFields.php, PeopleFields.php, StudentFields.php, UserFields.php & Assignments.php\n\nChanges in 9.2.1\n----------------\n- Remove use of db_seq_nextval(), use auto increment, program wide\n- SQL set default nextval (auto increment) for RosarioSIS version < 5.0 on install & old add-ons in Update.fnc.php\n- SQL no more cast MARKING_PERIOD_ID column as text/varchar in rosariosis.sql & InputFinalGrades.php\n- PLpgSQL compact & consistent function declaration in rosariosis.sql\n- Use DB transaction statements compatible with MySQL in database.inc.php\n- Add DBLastInsertID() & deprecate DBSeqNextID() + db_seq_nextval() in database.inc.php\n- SQL rename character varying & character data types to varchar & char in rosariosis.sql\n- SQL replace use of STRPOS() with LIKE, compatible with MySQL in PortalPollNotes.fnc.php & Courses.php\n- SQL fix French & Spanish translation for Create Parent Users & Notifiy Parents email templates in rosariosis_fr.sql & rosariosis_es.sql\n- Use DBLastInsertID() instead of DBSeqNextID(), program wide\n- SQL TRIM() both compatible with PostgreSQL and MySQL in AttendanceSummary.php & CopySchool.php\n- SQL use extract() or SUBSTRING() or REPLACE() instead of to_char() for MySQL compatibility, program wide\n- Fix No Address contact not properly saved for student / parent in RegistrationSave.fnc.php\n- AddDBField() Change $sequence param to $field_id, adapted for use with DBLastInsertID() in Fields.fnc.php, SchoolFields.php, AddressFields.php, PeopleFields.php, StudentFields.php & UserFields.php\n- Raise Frame file size limit to 5MB in HonorRoll.fnc.php\n- Fix Marking Period not found in user School Year (multiple browser tabs case) in MassSchedule.php & MassDrops.php\n- Fix Course not found in user School Year (multiple browser tabs case) in MassRequests.php\n- HTML add label to inputs in Requests.php\n- Remove help sentence. The Scheduler is not run by the Student Requests program in Help_en.php\n\nChanges in 9.2\n--------------\n- Fix SQL error invalid input syntax for integer in Administration.php\n- SQL student_report_card_grades table: convert MARKING_PERIOD_ID column to integer in Update.fnc.php, rosariosis.sql, EditReportCardGrades.php, FinalGrades.php & ReportCards.fnc.php\n\nChanges in 9.1.1\n----------------\n- Fix PHP8.1 fatal error unsupported operand types: string / int in Assignments.php & MassCreateAssignments.php\n- Fix selected Subject lost on Comment Category delete in ReportCardComments.php\n- Fix Color Input was hidden in ReportCardComments.php\n- Fix use Course ID in session in MassRequests.php\n- Fix SQL error primary key exists on table food_service_staff_accounts in Rollover.php\n- Fix SQL error foreign key exists on tables gradebook_assignments,gradebook_assignment_types,schedule_requests in Rollover.php\n- Fix save State input value in Registration.fnc.php\n- Fix SchoolInfo() on user School Year update in School.php\n\nChanges in 9.1\n--------------\n- Fix stored XSS security issue: decode HTML entities from URL in PreparePHP_SELF.fnc.php, thanks to @domiee13\n- Capitalize month when date is only month and year in Dashboard.inc.php\n- Add decimal & thousands separator configuration in Help_en.php, Currency.fnc.php, Configuration.php, rosariosis.sql & rosariosis_fr.sql\n- Use Currency() for Food Service Balance value in Widget.php & StaffWidget.php\n- Add Class average in InputFinalGrades.php & Grades.fnc.php\n- Update French & Spanish translation in rosariosis.po & help.po\n- Update Default School Year to 2022 in config.inc.sample.php & rosariosis.sql\n\nChanges in 9.0\n--------------\n- CSS add length to previous meals select in DailyMenus.php\n- CSS FlatSIS fix calendar menu text wrapping in stylesheet.css\n- Add Export list button in TransactionsReport.php\n- Add Food Service icon to list in ServeMenus.php\n- Add User / Student photo tooltip in ServeMenus.php, Transactions.php & TeacherCompletion.php\n- HTML add horizontal ruler before each category in MakeReferral.php\n- Fix SQL error when generating Schedule table with PHP8.1 in GetMP.php\n- Reorder PDF list columns to match Schedule columns in PrintSchedules.php\n- SQL order Schedule list by Course Title & Course Period Short Name in Schedule.php, PrintSchedules.php & Schedule.inc.php\n- Fix SQL error more than one row returned by a subquery in Rollover.php\n- Fix update Course Period title when Short Name contains single quote in Courses.php\n- Fix PHP8.1 deprecated function parameter is null, program wide\n- Fix PHP8.1 deprecated automatic conversion of false to array in StudentsUsersInfo.fnc.php\n- Fix PHP8.1 deprecated automatic conversion of float to int in ImageResizeGD.php\n- Add Student Photo Tip Message in AddDrop.php & StudentList.php\n- Format Enrollment Start & End Date in Export.php\n- Add Student name if no Contacts at address in MailingLabel.fnc.php\n- Do not Export Delete column in Periods.php & GradeLevels.php\n- HTML group inputs inside fieldset (tab title or program name) in Configuration.php\n- Hide Comment Codes tip message if Comments unchecked for Marking Period in InputFinalGrades.php\n- Add Get Student Labels Form JS (Disable unchecked fieldset) in StudentLabels.fnc.php & StudentLabels.php\n- Fix PHP8.1 deprecated use PostgreSQL $db_connection global variable in database.inc.php & Grades/includes/Dashboard.inc.php\n- Don't Delete Gender & Birthday Student Fields in Fields.fnc.php\n- CSS set cursor for .tipmsg-label in stylesheet.css\n- Add Username to Password Reset email in PasswordReset.php\n- `intl` PHP extension is now required in diagnostic.php & INSTALL.md\n- Fix PHP8.1 deprecated strftime() use strftime_compat() instead in Side.php, Date.php, PHPCompatibility.php, strftime_compat.php, Dashboard.inc.php & Preferences.php\n- Add $course_period_id param to limit check to a single Course Period in Courses.fnc.php & Courses.php\n- Add title to Contact & Address button images in Address.inc.php & GetStuList.fnc.php\n- CSS select max-width 440px in stylesheet.css & zresponsive.css\n- HTML add label to Points inputs to correct alignment in Grades.php\n- HTML add a11y-hidden label to select in CategoryBreakdown.php, CategoryBreakdownTime.php & StudentFieldBreakdown.php\n- Place Go button right after Timeframe in DailyTransactions.php, DailyTotals.php, CategoryBreakdown.php, CategoryBreakdownTime.php, StudentFieldBreakdown.php & Percent.php\n- Fix French translation for \"Not due\" in rosariosis.po\n- Move Transcript Include form checkboxes up in Transcripts.fnc.php\n- Add Delete button for Submission File in StudentAssignments.fnc.php\n- Fix SQL error null value in column \"title\" violates not-null constraint in MassCreateAssignments.php\n- Reorder & rename Course Periods columns to match Schedule program in MassCreateAssignments.php\n- Fix get History Grades Grade Level short name only if no Grade Level available in Transcripts.fnc.php\n- Fix get Student Photo from previous year in Transcripts.fnc.php\n- Fix SQL error invalid input syntax in PrintSchedules.php & TeacherCompletion.php, thanks to @scgajge12\n- Filter IP, HTTP_* headers can be forged in index.php, PasswordReset.php & ErrorMessage.fnc.php\n- Fix SQL error invalid input syntax for integer, program wide\n- Fix PHP8.1 fatal error checkdate argument must be of type int in Calendar.php\n- Fix SQL error invalid input syntax for type date in Calendar.php\n- Fix SQL error duplicate key value violates unique constraint \"attendance_calendar_pkey\" in Calendar.php\n- Fix PHP fatal error Unsupported operand types in ListOutput.php\n- Add AttrEscape() function in Inputs.php\n- Use AttrEscape() instead of htmlspecialchars(), program wide\n- Add use of AttrEscape(), program wide\n- Maintain Advanced search when editing Timeframe in Percent.php\n- Fix SQL injection escape DB identifier in RegistrationSave.fnc.php, Calendar.php, MarkingPeriods.php, Courses.php, SchoolFields.php, AddressFields.php, PeopleFields.php, StudentFields.php, UserFields.php & Referrals.php\n- JS update marked to v4.0.14 in assets/js/marked/ & warehouse_wkhtmltopdf.js\n- JS add DOMPurify 2.3.6 in assets/js/DOMPurify/ & Gruntfile.js\n- JS fix stored XSS issue related to MarkDown in warehouse.js & plugins.min.js, thanks to @intrapus\n- JS remove logged in check on history back in warehouse.js & plugins.min.js\n- Add CSRF token to protect unauthenticated requests in Warehouse.php & login.php\n- Add CSRF token to logout URL in login.php, Warehouse.php, PasswordReset.php, Bottom.php, Student.php & User.php, thanks to @khanhchauminh\n- Logout after 10 Hacking attempts within 1 minute in HackingLog.fnc.php\n- Destroy session now: some clients do not follow redirection in HackingLog.fnc.php\n- Add use of URLEscape(), program wide\n- Use URLEscape() for img src attribute, program wide\n- Sanitize / escape URL as THEME is often included for button img src attribute in User.fnc.php\n- Better format for \"Add another marking period\" form in EditReportCardGrades.php\n- Fix Improper Access Control security issue: add random string to photo file name in TipMessage.fnc.php, Transcripts.fnc.php, PrintClassPictures.php, Student.php, User.php & General_Info.inc.php, thanks to @dungtuanha\n- Fix stored XSS security issue: decode HTML entities from URL in PreparePHP_SELF.fnc.php, thanks to @khanhchauminh\n- Fix stored XSS security issue: remove inline JS from URL in PreparePHP_SELF.fnc.php, thanks to @intrapus & @domiee13\n- Fix stored XSS security issue: add semicolon to HTML entity so it can be decoded in PreparePHP_SELF.fnc.php, thanks to @intrapus\n- Accessibility: add hidden input label using .a11y-hidden class in ReportCardComments.php, StudentFields.php & Grades/TeacherCompletion.php\n- Accessibility: add select label in Eligibility/TeacherCompletion.php, Student.php, StudentList.php, MassDrops.php & MassSchedule.php\n- Two Lists on same page: export only first, no search in Eligibility/Student.php\n- Remove photos on delete in Student.php & User.php, thank to @jo125ker\n- Remove Student Assignment Submission files on delete in Assignments.php, thank to @khanhchauminh\n- Add microseconds to filename format to make it harder to predict in Assignments.php & StudentAssignments.fnc.php, thanks to @khanhchauminh\n- Restrict Sort Order input number range, program wide\n- Restrict Price / Amount / Balance input number range, program wide, thanks to @nhienit2010\n- Restrict input number step in Courses.fnc.php\n- Restrict diagnostic access to logged in admin in diagnostic.php, thanks to @intrapus\n- Fix SQL error value too long for type character varying(50) in Schools.php\n- Add Secure RosarioSIS link in INSTALL.md\n- Add Calendar days legend in Calendar.php\n- CSS add .legend-square class in stylesheet.css & colors.css\n- Create / Edit / Delete calendar: use button() in Calendar.php\n- Update Calendars help text in Help_en.php & help.po\n- Add translations for Calendar days legend in rosariosis.po\n- Use json_encode() for AjaxLink() URL, program wide\n- SQL skip \"No Address\" contacts to avoid lines with empty Address fields in Export.php\n- French translation: remove capitalization & use articles in rosariosis.po, help.po & rosariosis_fr.sql\n- JS Sanitize string for legal variable name in Export.php & Inputs.php\n- Remove deprecated `_makeTeacher()` function in ReportCards.fnc.php\n- Use multiple select input for grades list to gain space in Widget.php\n- Fix regression since 5.0, allow Administration of \"Lunch\" attendance categories in Administration.php, AttendanceCodes.fnc.php & colors.css\n- SQL set default FAILED_LOGIN_LIMIT to 30 in rosariosis.sql, thanks to @domiee13\n- JS Hide Options textarea if Field not of select type in Fields.fnc.php\n- Add Balance widget in StudentBalances.php\n- Add Total sum of balances in StudentBalances.php\n- Fix SQL error check requested UserSyear & UserSchool exists in DB in Side.php, Search.fnc.php & SaveEnrollment.fnc.php\n- HTML use number input for Class Rank widget in Widget.php\n- Check default if school has no default calendar in Calendar.php\n- CSS do not capitalize date in stylesheet.css\n\nChanges in 8.9.6\n----------------\n- Fix Stored XSS security issue: escape textarea HTML in Inputs.php, thanks to @jo125ker\n\nChanges in 8.9.5\n----------------\n- Fix stored XSS security issue: do not allow unsanitized XML & HTML in FileUpload.fnc.php, thanks to @nhienit2010\n- Fix stored XSS security issue: escape HTML attribute in StudentAssignments.fnc.php, thanks to @dungtuanha\n- Use big random number for parent password generation in NotifyParents.php & createParents.php, thanks to @intrapus\n- Add microseconds to filename format to make it harder to predict in StudentAssignments.fnc.php, thanks to @dungtuanha\n\nChanges in 8.9.4\n----------------\n- Fix SQL injection sanitize all `$_REQUEST` keys in Warehouse.php, thanks to @nhienit2010\n- Fix reflected XSS via mime-type in FileUpload.fnc.php, thanks to @nhienit2010\n\nChanges in 8.9.3\n----------------\n- Fix stored XSS security issue: do not allow unsanitized SVG in FileUpload.fnc.php, thanks to @scgajge12 & @crowdoverflow\n\nChanges in 8.9.2\n----------------\n- Fix invalidate User School in session on login in index.php\n\nChanges in 8.9.1\n----------------\n- Fix regression since 8.6 Mailing Labels widget HTML in Widgets.php\n\nChanges in 8.9\n--------------\n- Fix GetTeacher() when newly inserted teacher in GetTeacher.fnc.php\n- Remove Half Day option in AddAbsences.php, Administration.php, TakeAttendance.php, Courses.php, Courses.fnc.php & Rollover.php\n- JS Hide \"+ New Period\" link onclick in Courses.php\n- CSS FlatSIS fix bottom button line height in stylesheet.css\n- Add help texts & translations for the Scheduling > Courses program in Help_en.php & help.po\n- Correct typos in Spanish help texts in help.po\n- Fix Locked column value on list export in Schedule.php\n- Student / User Photo input: only accept .jpg,.jpeg,.png,.gif in General_Info.inc.php\n- Increase Food Service icon width to 48px in FS_Icons.inc.php & MenuItems.php\n- HTML add Add-on upload input title in Modules.inc.php & Plugins.inc.php\n- Fix do not resubmit form on List Export in Incomes.php & Expenses.php\n- Fix List Export columns: hide Delete & show File Attached in Expenses.php, Incomes.php, Salaries.php, StaffPayments.php, StudentFees.php & StudentPayments.php\n- Check AllowEdit() on Event deletion in Calendar.php\n- Food Service icon upload in MenuItems.php\n- Add French & Spanish translation for \"Icon successfully uploaded.\" in rosariosis.po\n\nChanges in 8.8\n--------------\n- Fix proc_open() PHP function not allowed in PDF.php\n- Fix PHP Warning A non-numeric value encountered in ReportCards.fnc.php\n- Fix PHP Fatal error Unsupported operand types in Teacher Programs: do not search Students List, unset in CustomFields.fnc.php\n- Add 'staff_' prefix to first & last inputs on Find a User form in GetStaffList.fnc.php & Search.fnc.php\n- Remove icons from Ungraded column, use only number in StudentGrades.php\n- Exclude 0 points assignments from Ungraded count in StudentGrades.php\n- Date select increase years options from +5 to +20 in Date.php\n- JS Raise height by 1 submenu item so we stay above browser URL in warehouse.js\n- Add Min. and Max. GPA to Last row in Grades.fnc.php & ReportCards.fnc.php\n- Add Class Rank to Last row in Grades.fnc.php & ReportCards.fnc.php\n\nChanges in 8.7\n--------------\n- Rector fix bad code in functions/, classes/core/, ProgramFunctions/\n- Update tested on: not compatible with Internet Explorer in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- Add ProgramFunctions/SendEmail.fnc.php|send_error action hook in SendEmail.fnc.php\n- EasyCodingStandard use short array notation in functions/, classes/core/, ProgramFunctions/, modules/ & plugins/\n- Fix month + year format, remove day (regression since 7.1) in Dashboard.inc.php\n- ProgramUserConfig() always return array, not null in Config.fnc.php & \\_makeLetterGrade.fnc.php\n- Allow redirect to Take Attendance, no fatal error if no current MP in Portal.php\n- CSS fix checkbox & radio input vertical align on Firefox in stylesheet.css\n- CSS fix menu hover right arrow position when module name on 2 lines in stylesheet.css\n- CSS fix font-size auto-adjust on iPhone in stylesheet.css\n- Fix typo in English string, update translations in Rollover.php & rosariosis.mo\n- JS fix menu & scroll issue on smartphone landscape > 735px in warehouse.js & jquery-fixed.menu.js\n- FlatSIS theme: use Grunt to minify in Gruntfile.js\n- FlatSIS theme: do not import WPadmin theme stylesheet anymore in stylesheet.css, stylesheet_wkhtmltopdf.css\n- Fix SQL transcript_grades view, grades were duplicated for each school year in rosariosis.sql & Update.fnc.php\n\nChanges in 8.6.1\n----------------\n- Add .webp image to FileExtensionWhiteList() in FileUpload.fnc.php\n- Fix SQL error table name \"sam\" specified more than once in Widget.php\n\nChanges in 8.6\n--------------\n- Add (Student) Widgets class in classes/core/Widgets.php\n- Add (Student) Widget interface and individual Widget classes in classes/core/Widget.php\n- Use RosarioSIS\\Widgets in Widgets.fnc.php\n- Add StaffWidgets class in classes/core/StaffWidgets.php\n- Add StaffWidget interface and individual StaffWidget classes in classes/core/StaffWidget.php\n- Use RosarioSIS\\StaffWidgets in StaffWidgets.fnc.php\n- Admin Student Payments Delete restriction: also exclude Refund in StudentPayments.php & Student_Billing/functions.inc.php\n- Fix PHP Fatal error unsupported operand types when (Staff)Widgets() & $extra used for Parent / Student in Widgets.fnc.php & StaffWidgets.fnc.php\n- Fix PHP Fatal error canBuild() must be compatible with Widget::canBuild(array $modules) in Widget.php & StaffWidget.php\n- Fix SQL error more than one row returned by a subquery in Search.fnc.php\n\nChanges in 8.5.2\n----------------\n- Fix PHP Fatal error cannot redeclare `_rosarioLoginURL()` (regression since 8.3) in MarkDownHTML.fnc.php\n\nChanges in 8.5.1\n----------------\n- Fix SQL syntax error in ORDER BY (regression since 8.3.1) in Substitutions.php\n\nChanges in 8.5\n--------------\n- Fix SQL error duplicate key value violates unique constraint \"food_service_menus_title\" in Menus.php\n- SQL add PRIMARY KEY to staff_exceptions table in rosariosis.sql\n- SQL profile_exceptions & staff_exceptions tables: Add Admin Student Payments Delete restriction in Update.fnc.php & rosariosis.sql\n- Add Admin Student Payments Delete restriction in Profiles.php & Exceptions.php\n- Add Admin Student Payments Delete restriction in StudentPayments.php & Student_Billing/functions.inc.php\n- Fix SQL error numeric field overflow when entering percent > 100 in MassCreateAssignments.php\n- HTML Sort Order input type number in MarkingPeriods.php\n\nChanges in 8.4\n--------------\n- SQL gradebook_grades table: Change comment column type to text in Update.fnc.php & rosariosis.sql\n- Increase Grades Comment input maxlength to 500 chars in Grades.php\n- Fix use more coherent number_format() precision & no thousand separator in Percent.php, Assignments.php, StudentGrades.php, Grades.fnc.php & EditReportCardGrades.php\n- SQL order fields list by Category & SORT_ORDER in AssignOtherInfo.php\n- Fix SQL error numeric field overflow when entering percent > 100 in Assignments.php\n- Comments length > 60 chars, responsive table ColorBox in EditReportCardGrades.php, FinalGrades.php, Grades.php, InputFinalGrades.php & StudentGrades.php\n- Add File Attached to Incomes in Incomes.php & Accounting/functions.inc.php\n- Add File Attached to Expenses in Expenses.php\n- SQL accounting_incomes table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Fix SQL error when no user in session in Template.fnc.php\n- Correct help text note for User deletion in Help_en.php & help.po\n\nChanges in 8.3.1\n----------------\n- Fix SQL exclude fields of 'files' type in Substitutions.php\n- SQL order fields list by Category & SORT_ORDER in Substitutions.php\n- Fix force numeric separator \".\" when no en_US locale, use C locale in Warehouse.php\n- Fix Advanced Search > General Info text fields when adding Username in Search.fnc.php\n\nChanges in 8.3\n--------------\n- Fix PHP Warning non-numeric value encountered, use rounded percent grade in StudentGrades.php\n- Security Fix reflected XSS: encode HTML special chars for search_term in Courses.php\n- Add File Attached to Staff Payments in StaffPayments.php & Accounting/functions.inc.php\n- Add File Attached to Payments in StudentPayments.php & Student_Billing/functions.inc.php\n- SQL accounting_payments table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- SQL billing_payments table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add help note for student deletion & translate in Help_en.php & help.po\n- Add RosarioSIS URL to image path in MarkDownHTML.fnc.php\n- Fix SQL error invalid byte sequence for encoding \"UTF8\": 0xde 0x20 in Security.php\n\nChanges in 8.2.1\n----------------\n- Fix SQL for Warning when only 0 points assignments in Assigments.php\n\nChanges in 8.2\n--------------\n- Fix replace regex: remove slash & allow space in FileUpload.fnc.php\n- Always Use Last Year's Picture if Missing in PrintClassLists.php\n- Fix #329 SQL error division by zero in t_update_mp_stats(): set min Credits to 1 in Courses.fnc.php\n- Fix SQL error when Teacher name has single quote in Courses.php\n- CSS FlatSIS remove useless line-height for tabs in stylesheet.css\n\nChanges in 8.1.1\n----------------\n- Fix security issue #328 unauthenticated access to Side.php in Warehouse.php, thanks to @ijdpuzon\n- Fix security issue #328 sanitize `$_POST` school, syear, mp & period parameters in Side.php\n\nChanges in 8.1\n--------------\n- Remove @ error control operator on pg_exec: allow PHP Warning in database.inc.php\n- Fix Address Field sequence name in AddressFields.php\n- Remove deprecated DBSeqConvertSerialName() function in database.inc.php\n- Fix Conflict Warning displayed twice in Courses.php\n- Fix PHP Notice Undefined index in miscExport.fnc.php\n- Fix SQL error when Student / Staff ID is hacked / not an integer in URL in Current.php\n- SQL accounting_salaries table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add File Attached to Salaries in Salaries.php & Accounting/functions.inc.php\n- SQL billing_fees table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add File Attached to Fees in StudentFees.php & Student_Billing/functions.inc.php\n- Fix Student Widgets for Advanced Search exports in GetStaffList.fnc.php, GetStuList.fnc.php & Search.inc.php\n- Add Export fields list (form) & Export fields list + extra SQL (student list) action hooks in Export.php & Actions.php\n- Do not remove Full Day and Half Day school periods from the Schedule table in PrintSchedules.php\n- Fix 403 Forbidden error due to pipe \"|\" in URL when using Apache 5G rules in Widgets.fnc.php\n\nChanges in 8.0.4\n----------------\n- Fix default Student/Parent program in Attendance/Menu.php\n\nChanges in 8.0.3\n----------------\n- Fix #324 Show Student Photo in Transcripts.fnc.php\n\nChanges in 8.0.2\n----------------\n- Fix User Widgets Search Terms in Users/Search.inc.php\n\nChanges in 8.0.1\n----------------\n- Fix #322 PHP syntax error, unexpected ')' in DailySummary.php\n\nChanges in 8.0\n--------------\n- Add Total from Payments & Total from Fees fields to Advanced Report in Export.php\n- Upgrade grunt, grunt-contrib-cssmin, grunt-contrib-uglify & grunt-contrib-watch & remove grunt-phpdoc in package.json & Gruntfile.js\n- CSS minification optimizations in stylesheet.css & stylesheet_wkhtmltopdf.css\n- JS uglify optimizations in plugins.min.js & plugins.min.js.map\n- Upgrade Chart.js from 2.9.3 to 3.4.1 & save 40KB in chart.min.js & Charts.fnc.php\n- Fix \"The gradebook configuration has been modified.\" note appearing twice in Grades/Configuration.php\n- Add warning in case all Assignments in Type have 0 Points (Extra Credit) in Assignments.php\n- Update French & Spanish translations in rosariosis.po\n- CSS FlatSIS shorten menu width & submenu links height + better contrast in stylesheet.css\n- CSS FlatSIS list square bullets in stylesheet.css\n- Default theme is now FlatSIS in rosariosis.sql\n- CSS remove .radio-attendance-code class in stylesheet.css, rtl.css & TakeAttendance.php\n- CSS remove Open Sans SVG fonts, format is deprecated in font.css & WPadmin/fonts/open\n- Upgrade marked.js 0.8.2 to version 1.2.9 in assets/js/marked/\n- Fix SQL error when $staff_id is 0 (no user in session) in Config.fnc.php\n- Remove Waived Fees from list in Student_Billing/functions.inc.php\n- New ROSARIO_DISABLE_ADDON_DELETE optional config constant in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- Add-on disable delete in Modules.inc.php & Plugins.inc.php\n- Merge Daily Transactions & Daily Totals programs in DailyTransactions.php & DailyTotals.php\n- Remove Daily Totals program from Student Billing & Accounting menus in Menu.php & rosariosis.sql\n- Fix Totals calculation in Accounting/includes/DailyTotals.php\n- Multibyte strings: check if not UTF-8 first to avoid cost of setting in Warehouse.php\n- Fix false positive Hacking Attempt on Print button click when no user in session in Warehouse.php\n- Merge Attendance Chart & Absence Summary programs in DailySummary.php & StudentSummary.php & Help_en.php\n- Remove Absence Summary program from Attendance menu in Menu.php, Help_en.php & rosariosis.sql\n\nChanges in 7.9.3\n----------------\n- Fix #318 PHP warning non-numeric value encountered for $LO_dir in ListOutput.fnc.php, thanks to @AhmadKakarr\n\nChanges in 7.9.2\n----------------\n- Fix SQL error when single quote in Course Title in InputFinalGrades.php\n- Fix include Semester course periods in the Schedule table in Schedule.inc.php\n- Fix #316 CSRF security issue set cookie samesite to strict, thanks to @huntrdev\n\nChanges in 7.9.1\n----------------\n- Fix remove file when has single quote in its name and actually delete file in Student.php, User.php & Schools.php\n- Fix download backup filename when contains spaces: use double quotes in DatabaseBackup.php\n\nChanges in 7.9\n--------------\n- Update default School Year to 2021 in rosariosis.sql & config.inc.sample.php\n\nChanges in 7.8.4\n----------------\n- Fix User Marking Period title in GradeBreakdown.php\n- SQL ORDER BY Teacher name in GradeBreakdown.php\n\nChanges in 7.8.3\n----------------\n- Fix trim 0 (float) when percent > 1,000: do not use comma for thousand separator in Grades.php & ProgressReports.php\n\nChanges in 7.8.2\n----------------\n- Fix try searching plural forms adding an 's' to singular form and with number set to 1 in Translator.php\n\nChanges in 7.8.1\n----------------\n- CSS Edge browser fix: Do not merge focus-within styles with hover styles in stylesheet.css, stylesheet_wkhtmltopdf.css & rtl.css\n\nChanges in 7.8\n--------------\n- Handle `multiple` files attribute in warehouse.js & Inputs.php\n- Add FileUploadMultiple(). Handle `multiple` files attribute for FileUpload() in FileUpload.fnc.php\n- Remove Reset button from Find a Student / User forms in Students/Search.inc.php & Users/Search.inc.php\n- CSS & JS open submenu on focus & focus-within in warehouse.js, stylesheet.css & rtl.css\n- CSS menu link & button color on focus in stylesheet.css & colors.css\n- Fix check students Course Status in PrintClassLists.php, PrintClassPictures.php, ClassSearchWidget.fnc.php, Referrals.php, EmailReferral.fnc.php & Widgets.fnc.php\n- Add Include Inactive Students checkbox in MasterScheduleReport.php & RequestsReport.php\n- Fix unset current student (check Course Status) when MP updated in Side.php\n- SQL fix Discipline Referrals using WHERE EXISTS in Widgets.fnc.php\n- Numeric Discipline field: invert values so BETWEEN works in Widgets.fnc.php\n- Numeric Discipline field: input type number in Widgets.fnc.php\n- Fix SQL error missing FROM address table in GetStuList.fnc.php\n\nChanges in 7.7\n--------------\n- Move Dashboard() call outside in Dashboard.fnc.php & Portal.php\n- Add .xlsm,.key,.midi,.aif,.mpeg,.h264,.mkv,.log,.email,.eml,.emlx,.msg,.vcf extensions to white list in FileUpload.fnc.php\n- Add \"Last Name Middle Name First Name\" option to Display Name in GetStuList.fnc.php & Configuration.php\n- Fix SQL error escape course title in StudentGrades.php\n- SQL Remove Salaries having a Payment (same Amount & Comments (Title), after or on Assigned Date) in Accounting/functions.inc.php\n- SQL match Payment Comments LIKE Fee Title in Student_Billing/functions.inc.php\n- CSS fix list line-height in FlatSIS/stylesheet_wkhtmltopdf.css\n\nChanges in 7.6.1\n----------------\n- Fix #307 XSS update CodeIgniter Security class in classes/Security.php, thanks to @DustinBorn\n- Move Portal Poll vote code to modfunc in PortalPollNotes.php & Portal.php\n- Fix #308 Unauthenticated SQL injection. Use sanitized `$_REQUEST` in Portal.php, thanks to @DustinBorn\n- Fix #308 sanitize key. Pass array keys through function in Warehouse.php, thanks to @DustinBorn\n- Fix #309 unset `$_SESSION` so user cannot maintain dummy session in PasswordReset.php, thanks to @DustinBorn\n- Remove use of `$_SESSION['STAFF_ID'] === '-1'` in User.fnc.php & PasswordReset.php\n\nChanges in 7.6\n--------------\n- Fix login password with single quote, use POST in index.php & Preferences.php\n- HTML Use #! instead of JS return false to not go back to top in Buttons.php & Profiles.php\n- JS remove warehouse.min.js & include warehouse.js inside plugins.min.js in Gruntfile.js, assets/js/ & Warehouse.php\n- Fix PHP8 compatibility issues (warnings & fatal errors), system wide\n- Fix save new Grade with \"0\" as Title in ReportCardGrades.php\n- PHP8 no xmlrpc ext: load xmlrpc compat functions in plugins/Moodle/client.php, xmlrpc.php, XML_RPC.php, XmlrpcDecoder.php & XmlrpcEncoder.php\n- Fix xmlrpc nested arrays, use param & value elements instead in XmlrpcEncoder.php\n- Fix SQL Total points only select assignments for CP teacher (teacher may have changed) in Grades.php, InputFinalGrades.php, StudentGrades.php & GradebookBreakdown.php\n- Fix SQL Grades sort order in GradebookBreakdown.php\n- Add Login form link action hook in index.php & Actions.php\n- SQL fix Report Card Grades insert in rosariosis_fr.sql\n- SQL fix ORDER Report Cards by Student name & Course list by Title in ReportCards.fnc.php\n- SQL fix error invalid input syntax for integer in DailySummary.php\n- Replace tested on Ubuntu 16.04 with 18.04 (Buster) in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n\nChanges in 7.5\n--------------\n- HTML fix Student Assignment Submission display in StudentAssignments.fnc.php\n- Percent rounding to 2 decimal places is new School default in \\_makeLetterGrade.fnc.php\n- CSS Fix widefat table border color when rendered in PDF inside Chrome in colors.css\n- Add phpwkhtmltopdf class & remove Wkhtmltopdf class in classes/\n- Use phpwkhtmltopdf class instead of Wkhtmltopdf (more reliable & faster) in PDF.php\n- Add Report Cards PDF footer action hook in ReportCards.fnc.php & Actions.php\n- Transcripts PDF header action hook: echo your custom text before or append it to $header_html to display it after in Transcripts.fnc.php\n- Transcripts PDF footer action hook: echo your custom text before or append it to $footer_html to display it after in Transcripts.fnc.php\n- Add .transcript-certificate-block1 & .transcript-certificate-block2 CSS classes in Transcripts.fnc.php\n- Add .report-card-free-text CSS class in ReportCards.fnc.php\n- Delete any attendance for this day & student prior to update in FixDailyAttendance.php\n- Use \\_makeLetterGrade() for Percent grade so it reflects Teacher's Score rounding configuration in Grades.php & ProgressReports.php\n- Fix Add Credits only for Report Cards in ReportCards.fnc.php\n- Fix SQL error invalid input syntax for integer (Class Rank input) in Widgets.fnc.php\n- HTML Grades GPA Widget: use number input & check Weighted by default in Widgets.fnc.php\n\nChanges in 7.4\n--------------\n- List sort comment: trim & fix position in ListOutput.fnc.php\n- Fix #303 Raw value in comment so we can sort Percent column the right way in Grades.php, thanks to @dd02\n- Add Database Backup link to header in Rollover.php\n- Add Course Widget configuration option: Popup window or Pull-Down in Configuration.php & Help_en.php\n- Add Course Widget: select / Pull-Down in Widgets.fnc.php\n- Update French & Spanish translations in rosariosis.po, help.po\n- Add Total Credits in ReportCards.fnc.php\n- Do not display \"General Comments\" title if no comments in ReportCards.fnc.php\n- HTML display rows of 3 School Period checkboxes in AddAbsences.php\n- Comment input maxlength increased to 500 in InputFinalGrades.php\n- Comment Code input field is required in ReportCardCommentCodes.php\n- Add php-zip extension to list in INSTALL.md\n- Check for zip extension in diagnostic.php\n- Fix SQL error integer out of range in Food_Service/Students/Accounts.php\n- French translation: replace \"Effacer\" with \"Supprimer\" in rosariosis.po & help.po\n- Fix Teacher Programs Progress Report PDF, do not echo form in TeacherPrograms.php\n\nChanges in 7.3.1\n----------------\n- Fix admin override: no input div when values are not saved yet in Grades/Configuration.php\n- Fix #304 Do not include Excused (`*` or -1) grades in GradebookBreakdown.php, thanks to @dd02\n- Fix #304 regression since 5.0 Count students in GradebookBreakdown.php, thanks to @dd02\n- Fix #304 Totals count exclude Extra Credit assignments when Total Points is 0 for the Type, thanks to @dd02\n\nChanges in 7.3\n--------------\n- SQL Replace AND p.ATTENDANCE='Y' with AND cp.DOES_ATTENDANCE IS NOT NULL in Letters.php, StudentLabels.fnc.php, HonorRoll.fnc.php & Reminders.php\n- SQL remove unused SELECT ROOM in HonorRoll.fnc.php\n- Translate database on add-on install: run 'install_fr.sql' file in Modules.inc.php, Plugins.inc.php, modules/README.md & plugins/README.md\n- CSS remove wildcard rules in stylesheet.css & wkhtmltopdf.css\n- CSS remove browser input outline on focus in colors.css\n- Fix Format Phone Number for US in GetStuList.fnc.php, thanks to @dzungdo\n- Attendance dashboard limit Absences to past days in Dashboard.inc.php\n- Fix #299 Remove trailing slash \"/\" or dash \"-\" or dot \".\" from date in DailySummary.php\n- Fix #300 Include Full Day and Half Day school periods in the schedule table in PrintSchedules.php, thanks to @dzungdo\n- Update translations complete % in locale/REFERENCE.md\n- Add tested on CentOS & Google Chrome in INSTALL.md & INSTALL.pdf, thanks to @dd02\n- Add Before First Login form action hook in index.php & Actions.php\n- Fix regression since 7.0 not rolled items are checked in Rollover.php\n\nChanges in 7.2.4\n----------------\n- Take in Account Calendar Day Minutes in UpdateAttendanceDaily.fnc.php\n- Fix regression since 5.3 Return false if School Periods Length sum is 0 in UpdateAttendanceDaily.fnc.php, thanks to @dzungdo\n\nChanges in 7.2.3\n----------------\n- Fix regression since 5.9 search text User Field in Search.fnc.php, thanks to @dzungdo\n\nChanges in 7.2.2\n----------------\n- Fix SQL error foreign keys: Roll Schools before rolling Student Enrollment in Rollover.php\n- Fix SQL error table address specified more than once in GetStuList.fnc.php\n\nChanges in 7.2.1\n----------------\n- Fix ParseMLField for Username field category in Preferences.php\n- Fix PHP Warning check requested locale exists in Warehouse.php\n- Add Attendance Codes help for (Lunch) Categories in Help_en.php & help.po\n- Fix SQL error multiple rows returned by a subquery in CreateParents.php\n\nChanges in 7.2\n--------------\n- Add Grade Level breakdown in StudentFieldBreakdown.php\n- Add link to Student Info in AddDrop.php\n- Limit students to User schools in AddDrop.php\n- Order Day, Month & Year inputs depending on User date preference in Date.php\n- SQL fix only display enrolled students in AddStudents.php\n- Link to Student Info redirects to right school in AddStudents.php\n- Reset password variable for each Contact in CreateParents.php\n\nChanges in 7.1.4\n----------------\n- Fix infinite loop when username already exists in CreateParents.php\n\nChanges in 7.1.3\n----------------\n- Fix #297 regression since 6.9 & SQL error in StudentSummary.php\n\nChanges in 7.1.2\n----------------\n- Fix SQL error Include Inactive Students for admin in PrintClassLists.php\n\nChanges in 7.1.1\n----------------\n- Fix #296 Include Inactive Students for admin in PrintClassLists.php\n\nChanges in 7.1\n--------------\n- Final Grading Percentages: add \"No quarters found\" error in Configuration.php\n- Add Start Date input in Scheduler.php\n- Export (Excel) date to YYYY-MM-DD format (ISO) in Date.php & Preferences.php\n- Select Date Format: Add Preferences( 'DATE' ) in User.fnc.php, Preferences.php, Date.php & Side.php\n- Fix SQL error TITLE column limit to 50 characters in GradeLevels.php\n- HTML remove radio buttons (File Attached or Embed Link) in PortalNotes.php & PortalPollsNotes.fnc.php\n- Add Grade Level breakdown in StudentBreakdown.php\n- Include Credits in ReportCards.fnc.php\n\nChanges in 7.0.4\n----------------\n- Fix #295 regression since 7.0 cannot save N/A date in Date.php\n\nChanges in 7.0.3\n----------------\n- Fix Multiple School Periods: Course Period School Period does not match, skip in Scheduler.php\n\nChanges in 7.0.2\n----------------\n- JS Fix search form onsubmit in Export.php\n\nChanges in 7.0.1\n----------------\n- Fix #292 System error \"blocked access to local file\" with wkhtmltopdf 0.12.6 in Wkhtmltopdf.php\n\nChanges in 7.0\n--------------\n- Update Markdownify from v2.1.11 to v2.3.1 in classes/Markdownify/*\n- Update Parsedown from v1.6.0 to v1.7.4 in classes/Parsedown.php\n- Update MoTranslator from v3.4 to v4.0 in Warehouse.php, Help.fnc.php & classes/MoTranslator/*\n- Fix 'School' translation when using MoTranslator in Schedule.inc.php & rosariosis.po\n- Fix '%s Handbook' translation when using MoTranslator in Help.php\n- CSS fix align \"+\" New Event icon to bottom in Calendar.php, CalendarDay.inc.php, stylesheet.css & zreponsive.css\n- Fix Day Number when multiple calendars and school years in CalendarDay.inc.php, DayToNumber.inc.php\n- Fix Numbered days display in SchoolPeriodsSelectInput.fnc.php & Courses.fnc.php\n- SQL improve Numbered days in AddAbsences.php, Administration.php, DailySummary.php, TakeAttendance.php, TeacherCompletion.php, UpdateAttendanceDaily.fnc.php & Portal.php\n- Place Rollover under Utilities separator in Menu.php\n- Merge Schedule Report & Master Schedule Report in Menu.php, MasterScheduleReport.php, ScheduleReport.php & rosariosis.sql\n- Add Students column to report in RequestsReport.php\n- Merge Requests Report & Unfilled Requests in Menu.php, RequestsReport.php, UnfilledRequests.php, Scheduler.php, Help_en.php & rosariosis.sql\n- Merge Average Daily Attendance & Average Attendance by Day in Menu.php, Percent.php, Help_en.php, help.po & rosariosis.sql\n- Remove \"Happy []...\" text in Portal.php\n- HTML remove \"Demographics\" header to gain space on PDF in AttendanceSummary.php\n- SQL Update ATTENDANCE_CODE (admin) when is NULL in TakeAttendance.php\n- CSS Add .widefat.files class in StudentsUsersInfo.fnc.php & stylesheet.css\n- CSS WPadmin more padding for list rows, menu links & footer help in stylesheet.css\n- CSS FlatSIS less padding for list row, header & popTable in stylesheet.css\n- CSS FlatSIS reduce body line-height & fix Dashboard tipmsg border in stylesheet.css\n- Format \"Show Available Seats\" & \"Print Schedule\" headers in Schedule.php\n- Remove $fy_id global variable in Schedule.php\n- HTML Add tooltips & notes in Rollover.php\n- Fix current CP Marking Period check on update in Courses.php\n- Fix limit list results to 1000, do not remove 1st result in ListOutput.fnc.php\n- Add $RosarioErrorsAddress config variable in config.inc.sample.php\n- Fix $RosarioNotifyAddress config variable description in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- SQL no access to Custom \"My Report\" program for admin by default in rosariosis.sql\n- JS MarkdownToHTML No MarkDown in text, return raw text in warehouse.js\n- Fix Delete from other Student/User Info tabs in Student.php & User.php\n- Remove deprecated since 4.5 rollover_* action hooks in Rollover.php & Actions.php\n- Fix Error: There is no column for The value for 0. This value was not saved in SaveData.fnc.php\n- Fix Do not Save / Export Medical tab lists in Medical.inc.php\n\n\n### Old versions CHANGES\n- [CHANGES for versions 5 and 6](CHANGES_V5_6.md).\n- [CHANGES for versions 3 and 4](CHANGES_V3_4.md).\n- [CHANGES for versions 1 and 2](CHANGES_V1_2.md).\n", "<?php\n/**\n * Warehouse\n *\n * Get configuration\n * Load functions\n * Date format & Time zone\n * Start Session\n * Sanitize $_REQUEST array\n * Internationalization\n * Modules & Plugins\n * Update RosarioSIS\n * Warehouse() function (Output HTML header (including Bottom & Side menus), or footer)\n * isPopup() function (Popup window detection)\n * isAJAX() function (AJAX request detection)\n * ETagCache() function (ETag cache system)\n *\n * @package RosarioSIS\n */\n\ndefine( 'ROSARIO_VERSION', '9.3.1' );\n\n/**\n * Include config.inc.php file.\n *\n * Do NOT change for require_once, include_once allows the error message to be displayed.\n */\n\nif ( ! include_once 'config.inc.php' )\n{\n\tdie( 'config.inc.php file not found. Please read the installation directions.' );\n}\n\nif ( empty( $DatabaseType ) )\n{\n\t// @since 10.0 Add $DatabaseType configuration variable\n\t$DatabaseType = 'postgresql';\n}\n\nrequire_once 'database.inc.php';\n\n/**\n * Optional configuration\n * You can override the following definitions in the config.inc.php file\n */\n\nif ( ! defined( 'ROSARIO_DEBUG' ) )\n{\n\t// Debug mode (for developers): enables notices.\n\tdefine( 'ROSARIO_DEBUG', false );\n}\n\nerror_reporting( ROSARIO_DEBUG ? E_ALL : E_ALL ^ E_NOTICE );\n\n// Server Paths.\n\nif ( ! isset( $RosarioPath ) )\n{\n\t$RosarioPath = __DIR__ . '/';\n}\n\nif ( ! isset( $StudentPicturesPath ) )\n{\n\t$StudentPicturesPath = 'assets/StudentPhotos/';\n}\n\nif ( ! isset( $UserPicturesPath ) )\n{\n\t$UserPicturesPath = 'assets/UserPhotos/';\n}\n\nif ( ! isset( $FileUploadsPath ) )\n{\n\t$FileUploadsPath = 'assets/FileUploads/';\n}\n\nif ( ! isset( $LocalePath ) )\n{\n\t// Path were the language packs are stored. You need to restart Apache at each change in this directory.\n\t$LocalePath = 'locale';\n}\n\nif ( ! isset( $ETagCache ) )\n{\n\t// ETag cache system.\n\t$ETagCache = true;\n}\n\n/**\n * Load functions\n */\n$functions = glob( 'functions/*.php' );\n\nforeach ( $functions as $function )\n{\n\trequire_once $function;\n}\n\nif ( $DatabaseType === 'mysql' )\n{\n\t/**\n\t * Set MySQL charset to utf8mb4 and collation to utf8mb4_unicode_520_ci\n\t *\n\t * @since 10.0\n\t *\n\t * Fix SQL error \"Illegal mix of collations (utf8mb4_unicode_520_ci,IMPLICIT)\n\t * \tand (utf8mb4_general_ci,IMPLICIT) for operation '='\"\n\t * @link https://www.php.net/manual/en/mysqli.set-charset.php#121647\n\t */\n\tDBQuery( \"SET NAMES utf8mb4 COLLATE utf8mb4_unicode_520_ci\" );\n\n\t/**\n\t * Set MySQL mode to accept pipes || as concatenation operator.\n\t * For backward-compatibility purpose only, try to always use CONCAT() instead of ||\n\t *\n\t * @since 10.0\n\t * @link https://stackoverflow.com/questions/5975958/string-concatenation-in-mysql#5975980\n\t */\n\tif ( ! ROSARIO_DEBUG )\n\t{\n\t\tDBQuery( \"SET @@sql_mode=CONCAT(@@sql_mode,',PIPES_AS_CONCAT')\" );\n\t}\n}\n\n/**\n * Date format & Time zone\n */\nif ( $DatabaseType === 'postgresql' )\n{\n\t/**\n\t * Set PostgreSQL Session Date Format / Datestyle to ISO.\n\t *\n\t * @since 2.9\n\t * @since 10.0 Move query from Date.php to Warehouse.php\n\t */\n\tDBQuery( \"SET DATESTYLE='ISO'\" );\n}\n\nif ( isset( $Timezone ) )\n{\n\t// Time zone.\n\t// Sets the default time zone used by all date/time functions.\n\tif ( date_default_timezone_set( $Timezone ) )\n\t{\n\t\tif ( $DatabaseType === 'mysql' )\n\t\t{\n\t\t\t/**\n\t\t\t * Get offset from time zone.\n\t\t\t *\n\t\t\t * @link https://stackoverflow.com/questions/25086456/php-convert-string-timezone-format-to-offset-integer#25086526\n\t\t\t */\n\t\t\t$date_time_zone = new DateTimeZone( $Timezone );\n\t\t\t$date = new DateTime( null, $date_time_zone );\n\t\t\t$offset = $date_time_zone->getOffset( $date );\n\t\t\t$offset = ( $offset < 0 ? '-' : '+' ) . gmdate( 'H:i', abs( $offset ) );\n\n\t\t\tDBQuery( \"SET time_zone='\" . $offset . \"'\" );\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// If valid PHP timezone_identifier, should be OK for PostgreSQL.\n\t\t\tDBQuery( \"SET TIMEZONE TO '\" . $Timezone . \"'\" );\n\t\t}\n\t}\n}\n\n// Send email on PHP fatal error.\nregister_shutdown_function( 'ErrorSendEmail' );\n\n/**\n * Start Session\n */\nsession_name( 'RosarioSIS' );\n\n// @link http://php.net/manual/en/session.security.php\n$cookie_path = dirname( $_SERVER['SCRIPT_NAME'] ) === DIRECTORY_SEPARATOR ?\n\t'/' : dirname( $_SERVER['SCRIPT_NAME'] ) . '/';\n\n// Fix #316 CSRF security issue set cookie samesite to strict.\n// @link https://www.php.net/manual/en/function.session-set-cookie-params.php#125072\n$cookie_samesite = 'Strict';\n\n// Cookie secure flag for https.\n$cookie_https_only = ( ! empty( $_SERVER['HTTPS'] ) && $_SERVER['HTTPS'] !== 'off' ) ||\n\t( isset( $_SERVER['SERVER_PORT'] ) && $_SERVER['SERVER_PORT'] == 443 );\n\nif ( PHP_VERSION_ID < 70300 )\n{\n\t// PHP version < 7.3.\n\tsession_set_cookie_params(\n\t\t0,\n\t\t$cookie_path . '; samesite=' . $cookie_samesite,\n\t\t'',\n\t\t$cookie_https_only,\n\t\ttrue\n\t);\n}\nelse\n{\n\tsession_set_cookie_params( [\n\t\t'lifetime' => 0,\n\t\t'path' => $cookie_path,\n\t\t'domain' => '',\n\t\t'secure' => $cookie_https_only,\n\t\t'httponly' => true,\n\t\t'samesite' => $cookie_samesite,\n\t] );\n}\n\nsession_cache_limiter( 'nocache' );\n\nsession_start();\n\nif ( empty( $_SESSION['token'] ) )\n{\n\t/**\n\t * Add CSRF token to protect unauthenticated requests\n\t *\n\t * @since 9.0\n\t * @link https://stackoverflow.com/questions/5207160/what-is-a-csrf-token-what-is-its-importance-and-how-does-it-work\n\t */\n\t$_SESSION['token'] = bin2hex( openssl_random_pseudo_bytes( 16 ) );\n}\n\nif ( empty( $_SESSION['STAFF_ID'] )\n\t&& empty( $_SESSION['STUDENT_ID'] )\n\t&& ( basename( $_SERVER['SCRIPT_NAME'] ) === 'Modules.php'\n\t\t|| basename( $_SERVER['SCRIPT_NAME'] ) === 'Bottom.php'\n\t\t|| basename( $_SERVER['SCRIPT_NAME'] ) === 'Side.php' ) )\n{\n\t// Logout if no Staff or Student session ID.\n\t/**\n\t * Redirect to Modules.php URL after login.\n\t *\n\t * @since 3.8\n\t */\n\t$redirect_to = basename( $_SERVER['SCRIPT_NAME'] ) === 'Modules.php' ?\n\t\t'&redirect_to=' . urlencode( $_SERVER['QUERY_STRING'] ) : '';\n\n\t// Redirection is done in Javascript in case current request is AJAX.\n\t?>\n\t<script>window.location.href = \"index.php?modfunc=logout\" +\n\t\t<?php echo json_encode( $redirect_to ); ?> +\n\t\t\"&token=\" + <?php echo json_encode( $_SESSION['token'] ); ?>;</script>\n\t<?php\n\texit;\n}\n\n/**\n * Array recursive walk (values AND keys!)\n *\n * @since 7.6 Fix #308 sanitize key. Pass array keys through function.\n *\n * @param  array  $array    Array by reference.\n * @param  string $function Function name.\n * @return array  &$array Array passed through $function function\n */\nfunction array_rwalk( &$array, $function )\n{\n\t$key = array_keys( $array );\n\n\t$size = count( $key );\n\n\tfor ( $i = 0; $i < $size; $i++ )\n\t{\n\t\tif ( is_array( $array[$key[$i]] ) )\n\t\t{\n\t\t\tarray_rwalk( $array[$key[$i]], $function );\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$array[$key[$i]] = $function( $array[$key[$i]] );\n\t\t}\n\n\t\t// Key is also passed through $function function.\n\t\t$fkey = $function( $key[$i] );\n\n\t\tif ( $fkey != $key[$i] ) // Weak comparison so we do not change integer value type.\n\t\t{\n\t\t\t// New key, order in array is lost (added last), sorry.\n\t\t\t$array[$fkey] = $array[$key[$i]];\n\n\t\t\t// Key passed through function differs, unset original key.\n\t\t\tunset( $array[$key[$i]] );\n\t\t}\n\t}\n}\n\n/**\n * Sanitize $_REQUEST array\n * ($_POST + $_GET)\n */\n// Escape strings for DB queries.\narray_rwalk( $_REQUEST, 'DBEscapeString' );\n\n// Remove HTML tags.\narray_rwalk( $_REQUEST, 'strip_tags' );\n\n/**\n * Internationalization\n */\n\nif ( ! empty( $_REQUEST['locale'] )\n\t&& in_array( $_REQUEST['locale'], $RosarioLocales ) )\n{\n\t$_SESSION['locale'] = $_REQUEST['locale'];\n}\nelseif ( empty( $_SESSION['locale'] ) )\n{\n\t$_SESSION['locale'] = $RosarioLocales[0]; // English?\n}\n\n$locale = $_SESSION['locale'];\n\nputenv( 'LC_ALL=' . $locale );\n\nfunction_exists( '_setlocale' ) ?\n\t// PHP Compatibility: MoTranslator.\n\t_setlocale( LC_ALL, $locale ) :\n\tsetlocale( LC_ALL, $locale );\n\n// Numeric separator \".\".\nsetlocale( LC_NUMERIC, 'C', 'english', 'en_US', 'en_US.utf8', 'en_US.UTF-8' );\n\nif ( $locale === 'tr_TR.utf8' )\n{\n\t// Bugfix for Turkish characters conversion.\n\tsetlocale( LC_CTYPE, 'C', 'english', 'en_US', 'en_US.utf8', 'en_US.UTF-8' );\n}\n\n// Binds the messages domain to the locale folder.\nbindtextdomain( 'rosariosis', $LocalePath );\n\n// Ensures text returned is utf-8, quite often this is iso-8859-1 by default.\nbind_textdomain_codeset( 'rosariosis', 'UTF-8' );\n\n// Sets the domain name, this means gettext will be looking for a file called rosariosis.mo.\ntextdomain( 'rosariosis' );\n\nif ( mb_internal_encoding() !== 'UTF-8' )\n{\n\t// Multibyte strings: check if not UTF-8 first to avoid cost of setting.\n\tmb_internal_encoding( 'UTF-8' );\n}\n\nif ( ROSARIO_DEBUG )\n{\n\trequire_once 'ProgramFunctions/Debug.fnc.php';\n\n\t// @since 5.0 Load Kint.\n\tKint();\n}\nelse\n{\n\tfunction d()\n\t{\n\t\t// Prevent PHP Fatal error if Kint debug d() function not loaded.\n\t}\n}\n\n/**\n * Update RosarioSIS\n * Automatically runs after manual files update\n * To apply eventual incremental DB updates\n *\n * @see ProgramFunctions/Update.fnc.php\n * @since 2.9\n */\n// Check if version in DB < ROSARIO_VERSION.\n\nif ( version_compare( Config( 'VERSION' ), ROSARIO_VERSION, '<' ) )\n{\n\trequire_once 'ProgramFunctions/Update.fnc.php';\n\n\t// Run Update() to apply updates if any.\n\tUpdate();\n}\n\n/**\n * Modules\n *\n * Core modules (packaged with RosarioSIS): cannot be deleted.\n */\n$RosarioCoreModules = [\n\t'School_Setup',\n\t'Students',\n\t'Users',\n\t'Scheduling',\n\t'Grades',\n\t'Attendance',\n\t'Eligibility',\n\t'Discipline',\n\t'Accounting',\n\t'Student_Billing',\n\t'Food_Service',\n\t'Resources',\n\t'Custom',\n];\n\n$RosarioModules = unserialize( Config( 'MODULES' ) );\n\n$non_core_modules = array_diff_key( $RosarioModules, array_flip( $RosarioCoreModules ) );\n\n_LoadAddons( $non_core_modules, 'modules/' );\n\n/**\n * Plugins\n *\n * Core plugins (packaged with RosarioSIS): cannot be deleted.\n */\n$RosarioCorePlugins = [\n\t'Moodle',\n];\n\n$RosarioPlugins = unserialize( Config( 'PLUGINS' ) );\n\n_LoadAddons( $RosarioPlugins, 'plugins/' );\n\n/**\n * Load not core modules & plugins\n * (functions & locale)\n * Deactivate if does not exist\n *\n * Local function\n *\n * @param  array  $addons Non core addons (Plugins or Modules).\n * @param  string $folder Plugin or Module folder.\n * @return void\n */\nfunction _LoadAddons( $addons, $folder )\n{\n\tglobal $RosarioModules,\n\t\t$RosarioPlugins;\n\n\t/**\n\t * Check if non core activated modules exist.\n\t * Load locale.\n\t * Load functions (optional).\n\t */\n\n\tforeach ( (array) $addons as $addon => $activated )\n\t{\n\t\tif ( ! $activated )\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tif ( $folder === 'modules/'\n\t\t\t&& ! file_exists( $folder . $addon . '/Menu.php' ) )\n\t\t{\n\t\t\t// If module does not exist, deactivate it.\n\t\t\t$RosarioModules[$addon] = false;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\t$addon_functions = $folder . $addon . '/functions.php';\n\n\t\tif ( file_exists( $addon_functions ) )\n\t\t{\n\t\t\trequire_once $addon_functions;\n\t\t}\n\t\telseif ( $folder === 'plugins/' )\n\t\t{\n\t\t\t// If plugin does not exist, deactivate it.\n\t\t\t$RosarioPlugins[$addon] = false;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Load addon locale.\n\t\t$locale_path = $folder . $addon . '/locale';\n\n\t\tif ( ! is_dir( $locale_path ) )\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Binds the messages domain to the locale folder.\n\t\tbindtextdomain( $addon, $locale_path );\n\n\t\t// Ensures text returned is utf-8, quite often this is iso-8859-1 by default.\n\t\tbind_textdomain_codeset( $addon, 'UTF-8' );\n\t}\n}\n\n/**\n * Output HTML header (including Bottom & Side menus), or footer\n *\n * @example  Warehouse( 'header' );\n *\n * @since 3.8 Warehouse header head hook\n * @since 3.8 Warehouse footer hook\n * @since 4.4 Warehouse header hook\n * @since 6.0 Warehouse Header Javascripts\n *\n * @global $_ROSARIO  Uses $_ROSARIO['ProgramLoaded'] & $_ROSARIO['page']\n *\n * @uses isPopup()\n * @uses isAJAX()\n * @uses ETagCache()\n *\n * @param string $mode 'header' or 'footer'.\n */\nfunction Warehouse( $mode )\n{\n\tglobal $_ROSARIO;\n\n\tif ( isset( $_REQUEST['_ROSARIO_PDF'] ) )\n\t{\n\t\tif ( $mode === 'header' )\n\t\t{\n\t\t\t// Start buffer.\n\t\t\tob_start();\n\t\t}\n\n\t\t// Printing PDF, skip, see PDF.fnc.php.\n\n\t\treturn;\n\t}\n\n\tswitch ( $mode )\n\t{\n\t\t// Header HTML.\n\t\tcase 'header':\n\t\t\tETagCache( 'start' );\n\n\t\t\tif ( isAJAX() )\n\t\t\t{\n\t\t\t\t// If jQuery not available, log out.\n\n\t\t\t\tif ( $_ROSARIO['page'] === 'modules' ): ?>\n<script>if (!window.$) window.location.href = 'index.php?modfunc=logout&token=' + <?php echo json_encode( $_SESSION['token'] ); ?>;</script>\n\t\t\t\t<?php endif;\n\n\t\t\t\t// AJAX: we only need to generate #body content.\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t$lang_2_chars = mb_substr( $_SESSION['locale'], 0, 2 );\n\n\t\t\t// Right to left direction.\n\t\t\t$RTL_languages = [ 'ar', 'he', 'dv', 'fa', 'ur' ];\n\n\t\t\t$dir_RTL = in_array( $lang_2_chars, $RTL_languages ) ? ' dir=\"RTL\"' : '';\n\t\t\t?>\n<!doctype html>\n<html lang=\"<?php echo $lang_2_chars; ?>\"<?php echo $dir_RTL; ?>>\n<head>\n\t<meta charset=\"UTF-8\" />\n\t<meta name=\"viewport\" content=\"width=device-width\" />\n\t<title><?php echo ParseMLField( Config( 'TITLE' ) ); ?></title>\n\t<link rel=\"icon\" href=\"favicon.ico\" sizes=\"32x32\" />\n\t<link rel=\"icon\" href=\"apple-touch-icon.png\" sizes=\"128x128\" />\n\t<meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\n\t<meta name=\"mobile-web-app-capable\" content=\"yes\" />\n\t<link rel=\"stylesheet\" href=\"assets/themes/<?php echo Preferences( 'THEME' ); ?>/stylesheet.css?v=<?php echo ROSARIO_VERSION; ?>\" />\n\t<style>.highlight,.highlight-hover:hover{background-color:<?php echo Preferences( 'HIGHLIGHT' ); ?> !important;}</style>\n\t<?php\n\n\t\t\tif ( $_ROSARIO['page'] === 'modules'\n\t\t\t\t|| $_ROSARIO['page'] === 'first-login'\n\t\t\t\t|| $_ROSARIO['page'] === 'create-account'\n\t\t\t\t|| $_ROSARIO['page'] === 'password-reset' )\n\t\t\t{\n\t\t\t\t// @since 6.0 Warehouse Header Javascripts.\n\t\t\t\tWarehouseHeaderJS();\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Hook.\n\t\t\t *\n\t\t\t * Add your extra module/plugin JS and/or CSS (dependencies) to HTML head here.\n\t\t\t *\n\t\t\t * @since 3.8\n\t\t\t *\n\t\t\t * @since 4.5.1 Move Header head action hook outisde page condition.\n\t\t\t */\n\t\t\tdo_action( 'Warehouse.php|header_head' );\n\t\t?>\n\t<noscript>\n\t\t<meta http-equiv=\"REFRESH\" content=\"0;url=<?php echo URLEscape( 'index.php?modfunc=logout&amp;reason=javascript&amp;token=' . $_SESSION['token'] ); ?>\" />\n\t</noscript>\n</head>\n<body class=\"<?php echo AttrEscape( $_ROSARIO['page'] ); ?>\">\n<?php\n\t\t\tif ( $_ROSARIO['page'] === 'modules' ):\n\t\t\t\t// If popup window, verify it is an actual popup.\n\t\t\t\tif ( isPopup() ):\n\t\t\t\t?>\n\t\t\t\t<script>if(window == top  && (!window.opener)) window.location.href = \"Modules.php?modname=misc/Portal.php\";</script>\n\t\t\t\t\t<?php // @since 10.0 Close popup if no UserSchool in session, happens on login redirect.\n\t\t\t\t\tif ( ! UserSchool() ) : ?>\n\t\t\t\t\t<script>window.close();</script>\n\t\t\t\t\t<?php endif;\n\t\t\t\telse: ?>\n<div id=\"wrap\">\n\t<footer id=\"footer\" class=\"mod\">\n\t\t<?php require_once 'Bottom.php'; // Include Bottom menu. ?>\n\t</footer>\n\t<aside id=\"menu\" class=\"mod\">\n\t\t<?php require_once 'Side.php'; // Include Side menu. ?>\n\t</aside>\n\n<?php\n\t\t\t\tendif;\n\t\t\tendif;\n\n\t\t\t?>\n\t<div id=\"body\" tabindex=\"0\" role=\"main\" class=\"mod\">\n<?php\n\t\t\t/**\n\t\t\t * Hook.\n\t\t\t *\n\t\t\t * Add your extra module/plugin HTML to body here.\n\t\t\t *\n\t\t\t * @since 4.4\n\t\t\t */\n\t\t\tdo_action( 'Warehouse.php|header' );\n\n\t\tbreak;\n\n\t\t// Footer HTML.\n\t\tcase 'footer':\n\t\t\t?>\n<br />\n<?php\n\n\t\t\tif ( isset( $_ROSARIO['page'] )\n\t\t\t\t&& $_ROSARIO['page'] === 'modules' ): ?>\n<script>\n\tvar modname = \"<?php echo issetVal( $_ROSARIO['ProgramLoaded'], '' ); ?>\";\n\tif (typeof menuStudentID !== 'undefined'\n\t\t&& (menuStudentID != \"<?php echo UserStudentID(); ?>\"\n\t\t\t|| menuStaffID != \"<?php echo UserStaffID(); ?>\"\n\t\t\t|| menuSchool != \"<?php echo UserSchool(); ?>\"\n\t\t\t|| menuMP != \"<?php echo UserMP(); ?>\"\n\t\t\t|| menuCoursePeriod != \"<?php echo UserCoursePeriod(); ?>\")) {\n\t\tajaxLink( 'Side.php?sidefunc=update' );\n\t}\n</script>\n<?php\n\t\t\t/**\n\t\t\t * Hook.\n\t\t\t *\n\t\t\t * Add your extra module/plugin JS (dependencies) to HTML footer here.\n\t\t\t *\n\t\t\t * @since 3.8\n\t\t\t * @since 4.4 Hook always runs (no conditions).\n\t\t\t */\n\t\t\tdo_action( 'Warehouse.php|footer' );\n\n\t\t\t// If not AJAX request.\n\t\t\tif ( ! isAJAX() ):\n\t\t\t?>\n\t</div><!-- #body -->\n\t<div class=\"ajax-error\"></div>\n<?php\n\n\t\t\t\tif ( ! isPopup() ):\n\t\t\t\t?>\n\t</div><!-- #wrap -->\n\t\t\t\t<?php endif;\n\n\t\t\t?>\n</body></html>\n\t\t\t<?php endif;\n\n\t\t\tif ( ! isPopup() ):\n\n\t\t\t\t// require_once 'ProgramFunctions/Help.fnc.php';\n\n\t\t\t\t// Check if module has help (not default).\n\t\t\t\t//$has_help_text = GetHelpTextRaw( $_REQUEST['modname'] );\n\n\t\t\t\t/*if ( $has_help_text )\n\t\t\t\t{\n\t\t\t\t\tvar_dump($_REQUEST['modname']);\n\t\t\t\t\techo 'Has Help!!!';\n\t\t\t\t}*/\n\n\t\t\tendif;\n\n\t\t\telseif ( ! isAJAX() ): // Other pages (not modules).\n\n\t\t\t\t?>\n\t\t</div><!-- #body -->\n\t</body></html>\n\t\t\t<?php endif;\n\n\t\t\tETagCache( 'stop' );\n\n\t\t\tbreak;\n\t}\n\n\t// End switch.\n}\n\n/**\n * Warehouse Header Javascripts\n * Loads jQuery, plugins, warehouse & calendar lang JS.\n * Loads theme's scripts.js file if any found.\n *\n * @since 6.0\n * @since 7.6 JS remove warehouse.min.js & include warehouse.js inside plugins.min.js\n */\nfunction WarehouseHeaderJS()\n{\n\t$lang_2_chars = mb_substr( $_SESSION['locale'], 0, 2 );\n\n\t?>\n\t<script src=\"assets/js/jquery.js?v=2.2.4\"></script>\n\t<script src=\"assets/js/plugins.min.js?v=<?php echo ROSARIO_VERSION; ?>\"></script>\n\t<script src=\"assets/js/jscalendar/lang/calendar-<?php echo file_exists( 'assets/js/jscalendar/lang/calendar-' . $lang_2_chars . '.js' ) ? $lang_2_chars : 'en'; ?>.js\"></script>\n\t<?php\n\t// Add scripts.js file from theme if any found.\n\tif ( file_exists( 'assets/themes/' . Preferences( 'THEME' ) . '/scripts.js' ) ): ?>\n\t\t<script src=\"assets/themes/<?php echo Preferences( 'THEME' ); ?>/scripts.js\"></script>\n\t<?php endif;\n}\n\n/**\n * Popup window detection\n *\n * @todo deprecate & Remove popup, use soft popup with featherlight or https://victordiego.com/lightbox/.\n *\n * Set it once in Modules.php:\n * @example isPopup( $modname, $_REQUEST['modfunc'] );\n * Later call it:\n * @example if ( isPopup() )\n * @link http://www.securiteam.com/securitynews/6S02U1P6BI.html\n *\n * @param  string  $modname Mod name. Optional, defaults to ''.\n * @param  string  $modfunc Mod function. Optional, defaults to ''.\n * @return boolean True if popup, else false\n */\nfunction isPopup( $modname = '', $modfunc = '' )\n{\n\tstatic $is_popup = null;\n\n\tif ( ! is_null( $is_popup ) )\n\t{\n\t\treturn $is_popup;\n\t}\n\n\t$is_popup = false;\n\n\tif ( ! $modname )\n\t{\n\t\treturn $is_popup;\n\t}\n\n\t/**\n\t * Popup window detection.\n\t *\n\t * FJ security fix, cf http://www.securiteam.com/securitynews/6S02U1P6BI.html\n\t */\n\n\tif ( in_array(\n\t\t$modname,\n\t\t[\n\t\t\t'misc/ChooseRequest.php',\n\t\t\t'misc/ChooseCourse.php',\n\t\t\t'misc/ViewContact.php',\n\t\t]\n\t)\n\t\t|| ( $modname === 'School_Setup/Calendar.php'\n\t\t\t&& $modfunc === 'detail' )\n\t\t|| ( in_array(\n\t\t\t$modname,\n\t\t\t[\n\t\t\t\t'Scheduling/MassDrops.php',\n\t\t\t\t'Scheduling/Schedule.php',\n\t\t\t\t'Scheduling/MassSchedule.php',\n\t\t\t\t'Scheduling/MassRequests.php',\n\t\t\t\t'Scheduling/Courses.php',\n\t\t\t]\n\t\t)\n\t\t\t&& $modfunc === 'choose_course' ) )\n\t{\n\t\t$is_popup = true;\n\t}\n\n\treturn $is_popup;\n}\n\n/**\n * AJAX request detection\n *\n * @example if ( isAJAX() )\n * @since 3.0.1\n *\n * @return boolean True if is AJAX, else false\n */\nfunction isAJAX()\n{\n\tstatic $is_ajax = null;\n\n\tif ( ! is_null( $is_ajax ) )\n\t{\n\t\treturn $is_ajax;\n\t}\n\n\t$is_ajax = isset( $_SERVER['HTTP_X_REQUESTED_WITH'] )\n\t\t&& $_SERVER['HTTP_X_REQUESTED_WITH'] === 'XMLHttpRequest';\n\n\treturn $is_ajax;\n}\n\n/**\n * ETag cache system.\n * Start buffer, or stop buffer\n * and calculate ETag:\n * If ETag === If-None-Match, then send 403\n * Else send content (buffer) + ETag.\n * If no mode is set, will only check if $ETagCache activated.\n *\n * @global $ETagCache ETag cache system.\n * @since  3.1\n *\n * @param  string  $mode Mode: start|stop. Optional, defaults to ''.\n * @return boolean True if ETagCache activated, else false.\n */\nfunction ETagCache( $mode = '' )\n{\n\tglobal $ETagCache;\n\n\tstatic $ob_started = false;\n\n\tif ( ! $ETagCache )\n\t{\n\t\treturn false;\n\t}\n\n\tif ( $mode === 'start'\n\t\t&& ! $ob_started )\n\t{\n\t\t// Start buffer (to generate ETag).\n\t\t$ob_started = ob_start();\n\t}\n\telseif ( $mode === 'stop'\n\t\t&& $ob_started )\n\t{\n\t\t// Stop & get buffer buffer (to generate ETag).\n\t\t$etag_buffer = ob_get_clean();\n\n\t\t/**\n\t\t * Generate ETag\n\t\t * Weak ETag (\"W/\").\n\t\t *\n\t\t * @link https://en.wikipedia.org/wiki/HTTP_ETag\n\t\t */\n\t\t$etag = 'W/' . md5( $etag_buffer );\n\n\t\t// If-None-Match header sent by client.\n\n\t\tif ( isset( $_SERVER['HTTP_IF_NONE_MATCH'] )\n\t\t\t&& $_SERVER['HTTP_IF_NONE_MATCH'] === $etag )\n\t\t{\n\t\t\theader( \"Cache-Control: private, must-revalidate\" );\n\n\t\t\t// Page cached: send 304 + empty content.\n\t\t\theader( $_SERVER['SERVER_PROTOCOL'] . ' 304 Not Modified' );\n\n\t\t\texit;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// FJ fix headers already sent error when program outputs buffer.\n\n\t\t\tif ( ! headers_sent() )\n\t\t\t{\n\t\t\t\theader( \"Cache-Control: private, must-revalidate\" );\n\n\t\t\t\t// Send ETag + content (buffer).\n\t\t\t\theader( 'ETag: ' . $etag );\n\t\t\t}\n\n\t\t\techo $etag_buffer;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n\n/**\n * Null coalesce.\n * Useful to prevent PHP undefined index / variable notices.\n * Equivalent to:\n * `isset( $var ) ? $var : null`\n *\n * @example $extra['SELECT'] = issetVal( $extra['SELECT'], '' );\n *\n * @since 5.0\n *\n * @todo Migrate to PHP7 ?? operator.\n * @link https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.null-coalesce-op\n *\n * @param  mixed &$var    Variable.\n * @param  mixed $default Default value if undefined. Defaults to null.\n * @return mixed Variable or default.\n */\nfunction issetVal( &$var, $default = null )\n{\n\treturn ( isset( $var ) ) ? $var : $default;\n}\n"], "fixing_code": ["# CHANGES\n## RosarioSIS Student Information System\n\nChanges in 10.0\n---------------\n- SQL convert table names to lowercase, program wide\n- Fix delete file attached in StudentFees.php\n- Use DBEscapeIdentifier() for reserved 'column' keyword in plugins/Moodle/\n- Avoid regression due to lowercase table names: Maintain compatibility with add-ons using rollover_after action hook & `$_REQUEST['tables']` in Rollover.php\n- Use db_trans_*() functions in DeleteTransaction.fnc.php & DeleteTransactionItem.fnc.php\n- Close popup if no UserSchool in session, happens on login redirect in Warehouse.php\n- SQL order Grade Levels in StudentBreakdown.php\n- Remove semicolon before \"With\" & \"On\" values in PrintRequests.php & unfilledRequests.inc.php\n- HTML Link is selected: bold in ScheduleReport.php\n- Display Period title if no short name set in IncompleteSchedules.php\n- Fix Widget search & add Search Terms header in IncompleteSchedules.php\n- Add Schedule link & photo tooltip to Student name in Scheduling/AddDrop.php\n- HTML add a11y-hidden label to select in GPARankList.php & Attendance/TeacherCompletion.php\n- Fix unset requested dates in MassCreateAssignments.php & Assignments.php\n- Add User / Student photo tooltip in Grades/TeacherCompletion.php, GPARankList.php & EnterEligibility.php\n- SQL order by Period title in TeacherCompletion.php\n- Use Period's Short Name when > 10 columns in the list in TeacherCompletion.php\n- Add note on save in EntryTimes.php\n- Fix PHP8.1 Deprecated passing null to parameter in EmailReferral.fnc.php, CategoryBreakdown.php & StudentGrades.php\n- Add Total sum of balances in StaffBalances.php\n- Fix French translation for \"Waiver\" & \"Refund\" in rosariosis.po\n- Force title & action to lowercase in Prompts.php\n- HTML use .dashboard-module-title CSS class for module titles in Profiles.php & Exceptions.php\n- CSS set input label max-width on Search form in stylesheet.css\n- JS new default popup size: 1200x450 in warehouse.js\n- Use URLEscape() for add button link when appropriate in ListOutput.fnc.php\n- JS set Calendar date to current fields date in warehouse.js & calendar-setup.js\n- HTML add label to select in ActivityReport.php\n- Use Currency() function instead of number_format() in TransactionsReport.php\n- HTML remove line-break in Warning/Minimum columns in Reminders.php\n- HTML CSS make Daily Menus calendar coherent with School Calendar in DailyMenus.php\n- Shorten Referral email subject in EmailReferral.fnc.php\n- Use plural wise ngettext() for \"No %s were found.\" in FinalGrades.php, GradeBreakdown.php, ReportCardComments.php, ReportCards.php & Transcripts.php\n- Force result text to lowercase for \"No %s were found.\" in ListOutput.fnc.php, FinalGrades.php, GradeBreakdown.php, ReportCardComments.php, ReportCards.php & Transcripts.php\n- Prevent admin from removing own access to User Profiles program in Profiles.php\n- SQL change modname column type from text to varchar(150) to match with MySQL key index limitation in rosariosis.sql\n- SQL change program column type from text to varchar(100) NOT NULL to match with MySQL index limitation in rosariosis.sql\n- SQL change schools column type from text to varchar(150) to match with MySQL index limitation in rosariosis.sql\n- Rename YEAR_MONTH column alias to YEAR_MONTH_DATE: reserved keyword in MySQL in Dashboard.inc.php\n- SQL use DAYOFWEEK() for MySQL or cast(extract(DOW)+1 AS int) for PostrgeSQL, program wide\n- SQL cast(AS UNSIGNED) for MySQL or cast(AS INT) for PostgreSQL, program wide\n- SQL cast custom_fields ID as VARCHAR(10) instead of TEXT for MySQL compatibility in GetStaffList.fnc.php, GetStuList.fnc.php & Search.fnc.php\n- SQL rename $field COLUMN (reserved keyword) to COLUMN_NAME for MySQL compatibility in CustomFields.fnc.php, GetStaffList.fnc.php, GetStuList.fnc.php & Search.fnc.php\n- SQL remove use of nextval in rosariosis_fr.sql\n- Rename $pg_dumpPath configuration variable to $DatabaseDumpPath in config.inc.sample.php, diagnostic.php & DatabaseBackup.php\n- Build command for executing mysqldump in DatabaseBackup.php\n- SQL to extract Unix timestamp or epoch from date in Eligibility/Student.php, StudentList.php & TeacherCompletion.php\n- Install module/plugin: execute the install_mysql.sql script for MySQL in Modules.inc.php, Plugins.inc.php & modules/README.md & plugins/README.md\n- Fix typo \"inexistant\" to \"nonexistent\" & update translations in Modules.inc.php, Plugins.inc.php & rosariosis.po\n- HTML fix duplicated #menu-top div on update in Side.php\n- JS fix #body height calculation: include bottom margin in jquery-fixedmenu.js & plugins.min.js\n- Add MySQLRemoveDelimiter() remove DELIMITER $$ declarations before procedures or functions in database.inc.php, Modules.inc.php & Plugins.inc.php\n- SQL ORDER BY SORT_ORDER IS NULL,SORT_ORDER (nulls last) for consistency between PostgreSQL & MySQL, program wide\n- Rollback Fix PostgreSQL error invalid ORDER BY, only result column names can be used, program wide\n- HTML use number input for Gradebook config options in Configuration.php\n- HTML use number input for Grade points & average in ReportCardGrades.php\n- SQL limit results to current school year in AddDrop.php\n- SQL always use INTERVAL to add/subtract days to date for MySQL compatibility in Reminders.php, Transactions.php, ServeMenus.php, Assignments.php, StudentGrades.php, Rollover.php & Portal.php\n- SQL change amount columns type from numeric to numeric(14,2) NOT NULL in rosariosis.sql & StudentFees.php\n- SQL change minutes,minutes_present,points,default_points,length,count_weighted_factors,count_unweighted_factors columns type from numeric to integer in rosariosis.sql, UpdateAttendanceDaily.fnc.php, Assignments.php, MassCreateAssignments.php & Periods.php\n- SQL change gp & gpa columns type from numeric to numeric(7,2) in rosariosis.sql\n- SQL change sum/cum factors & credit_attempted/earned columns type from numeric to double precision in rosariosis.sql\n- Add Can use modname to HACKING ATTEMPT error email in ErrorMessage.fnc.php\n- Fix HACKING ATTEMPT when Grades module inactive in Portal.php & Calendar.php\n- Use GetTemplate() instead of unescaping `$_REQUEST` in CreateParents.php & NotifyParents.php\n- Use `$_POST` to get password instead of unescaping `$_REQUEST` in PasswordReset.php, Student.php & User.php\n- Use DBGetOne() instead of unescaping `$_REQUEST` in Config.fnc.php\n- Add MySQL support in database.inc.php, diagnostic.php, InstallDatabase.php & Warehouse.php\n- Add $DatabaseType configuration variable in database.inc.php, diagnostic.php, InstallDatabase.php, Warehouse.php & config.inc.php\n- Add $show_error parameter to db_start() in database.inc.php\n- Add DBUnescapeString() function in database.inc.php, GetStuList.fnc.php, ListOutput.fnc.php, PreparePHP_SELF.fnc.php & Search.fnc.php\n- PostgreSQL Date format: move query from Date.php to Warehouse.php\n- Compatibility with add-ons version < 10.0, gather CONFIG (uppercase table name) values too in Configuration.php\n- Fix MySQL error Table is specified twice, both as a target for 'INSERT' and as a separate source for data in CopySchool.php & Rollover.php\n- Fix MySQL syntax error: no table alias in DELETE in Rollover.php\n- Fix MySQL syntax error: no FROM allowed inside UPDATE, use subquery or multi-table syntax in Rollover.php\n- Fix MySQL syntax error: replace CAST (NULL AS CHAR(1)) AS CHECKBOX with NULL AS CHECKBOX in AddAbsences.php, AddActivity.php, MassDrops.php, MassRequests.php, MassSchedule.php, AddUsers.php, AssignOtherInfo.php & AddStudents.php\n- Add Installation tutorial for Mac in WHATS_NEW.md & INSTALL.md, INSTALL_fr.md & INSTALL_es.md\n- Update tested on Ubuntu 18.04 to 20.04 in INSTALL.md, INSTALL_fr.md & INSTALL_es.md\n- Fix SQL error when column already dropped in Fields.fnc.php\n- SQL fix CREATE INDEX on right table in rosariosis.sql\n- SQL remove unused indices for various tables in rosariosis.sql\n- SQL match index with FOREIGN KEY for various tables in rosariosis.sql\n- SQL ORDER BY fix issue when Transferring to another school & new start date is <= old start date in Enrollment.inc.php\n- Check if student already enrolled on that date when inserting START_DATE in SaveEnrollment.fnc.php\n- Add `_getAddonsSQL()` & `_configTableCheck()` functions in InstallDatabase.php\n- $DatabasePort configuration variable is now optional in config.inc.sample.php, INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- SQL start staff_fields ID sequence at 200000000 for coherence with custom_fields in rosariosis.sql & Fields.fnc.php\n- MySQL use LONGTEXT type for textarea field in Fields.fnc.php & DisciplineForm.php\n- SQL Check requested assignment belongs to teacher in Assignments.php\n- CSS fix responsive when really long string with no space in stylesheet.css\n- Limit `$_POST` array size to a maximum of 16MB in Warehouse.php\n\nChanges in 9.3.1\n----------------\n- Fix regression since 2.9 Schedule multiple courses in plugins/Moodle/Scheduling/MassSchedule.php\n- Fix SQL to select Periods where exists CP in TeacherCompletion.php & Administration.php\n- Fix dummy day (year month date) set to 28 for February in Dashboard.inc.php\n- Fix AllowEdit for Teacher in Users/includes/General_Info.inc.php\n- Security: sanitize filename with no_accents() in Student.php, User.php & Schools.php\n- Fix \"Exclude PDF generated using the \"Print\" button\" option for the PDF Header Footer plugin in Bottom.php\n\nChanges in 9.3\n--------------\n- Handle case where Course Period Parent ID is null in Courses.php\n- SQL order by Period title in Periods.php, DailySummary.php & StudentSummary.php\n- SQL get Period title if no short name set in AddAbsences.php\n- Use DBLastInsertID() instead of DBSeqNextID() in Moodle/includes/ImportUsers.fnc.php\n- Still use DBSeqNextID() for student ID, adapt for MySQL in Student.php & Moodle/includes/ImportUsers.fnc.php\n- SQL use CONCAT() instead of pipes || for MySQL compatibility, program wide\n- Fix first item in the list not displayed in Accounting/includes/DailyTransactions.php\n- SQL time interval for MySQL compatibility in PasswordReset.php & index.php\n- SQL use CAST(X AS varchar(X)) instead of to_char() for MySQL compatibility in Dashboard.inc.php & Reminders.php\n- SQL result as comma separated list for MySQL compatibility in Grades/includes/Dashboard.inc.php & MasterScheduleReport.php\n- Use DBEscapeIdentifier() for MySQL reserved 'TIMESTAMP' keyword in ServeMenus.php & Transactions.php\n- SQL add `_SQLUnixTimestamp()` to extract Unix timestamp or epoch from date in Grades.php & Schedule.php\n- Add case for MySQL: get next MP ID & set AUTO_INCREMENT+1 in EditHistoryMarkingPeriods.php\n- Display Name: SQL use CONCAT() instead of pipes || for MySQL compatibility in Configuration.php & GetStuList.fnc.php\n- config table: update DISPLAY_NAME to use CONCAT() instead of pipes || in Update.fnc.php\n\nChanges in 9.2.2\n----------------\n- Fix SQL error lastval is not yet defined when editing field in SchoolFields.php, AddressFields.php, PeopleFields.php, StudentFields.php, UserFields.php & Assignments.php\n\nChanges in 9.2.1\n----------------\n- Remove use of db_seq_nextval(), use auto increment, program wide\n- SQL set default nextval (auto increment) for RosarioSIS version < 5.0 on install & old add-ons in Update.fnc.php\n- SQL no more cast MARKING_PERIOD_ID column as text/varchar in rosariosis.sql & InputFinalGrades.php\n- PLpgSQL compact & consistent function declaration in rosariosis.sql\n- Use DB transaction statements compatible with MySQL in database.inc.php\n- Add DBLastInsertID() & deprecate DBSeqNextID() + db_seq_nextval() in database.inc.php\n- SQL rename character varying & character data types to varchar & char in rosariosis.sql\n- SQL replace use of STRPOS() with LIKE, compatible with MySQL in PortalPollNotes.fnc.php & Courses.php\n- SQL fix French & Spanish translation for Create Parent Users & Notifiy Parents email templates in rosariosis_fr.sql & rosariosis_es.sql\n- Use DBLastInsertID() instead of DBSeqNextID(), program wide\n- SQL TRIM() both compatible with PostgreSQL and MySQL in AttendanceSummary.php & CopySchool.php\n- SQL use extract() or SUBSTRING() or REPLACE() instead of to_char() for MySQL compatibility, program wide\n- Fix No Address contact not properly saved for student / parent in RegistrationSave.fnc.php\n- AddDBField() Change $sequence param to $field_id, adapted for use with DBLastInsertID() in Fields.fnc.php, SchoolFields.php, AddressFields.php, PeopleFields.php, StudentFields.php & UserFields.php\n- Raise Frame file size limit to 5MB in HonorRoll.fnc.php\n- Fix Marking Period not found in user School Year (multiple browser tabs case) in MassSchedule.php & MassDrops.php\n- Fix Course not found in user School Year (multiple browser tabs case) in MassRequests.php\n- HTML add label to inputs in Requests.php\n- Remove help sentence. The Scheduler is not run by the Student Requests program in Help_en.php\n\nChanges in 9.2\n--------------\n- Fix SQL error invalid input syntax for integer in Administration.php\n- SQL student_report_card_grades table: convert MARKING_PERIOD_ID column to integer in Update.fnc.php, rosariosis.sql, EditReportCardGrades.php, FinalGrades.php & ReportCards.fnc.php\n\nChanges in 9.1.1\n----------------\n- Fix PHP8.1 fatal error unsupported operand types: string / int in Assignments.php & MassCreateAssignments.php\n- Fix selected Subject lost on Comment Category delete in ReportCardComments.php\n- Fix Color Input was hidden in ReportCardComments.php\n- Fix use Course ID in session in MassRequests.php\n- Fix SQL error primary key exists on table food_service_staff_accounts in Rollover.php\n- Fix SQL error foreign key exists on tables gradebook_assignments,gradebook_assignment_types,schedule_requests in Rollover.php\n- Fix save State input value in Registration.fnc.php\n- Fix SchoolInfo() on user School Year update in School.php\n\nChanges in 9.1\n--------------\n- Fix stored XSS security issue: decode HTML entities from URL in PreparePHP_SELF.fnc.php, thanks to @domiee13\n- Capitalize month when date is only month and year in Dashboard.inc.php\n- Add decimal & thousands separator configuration in Help_en.php, Currency.fnc.php, Configuration.php, rosariosis.sql & rosariosis_fr.sql\n- Use Currency() for Food Service Balance value in Widget.php & StaffWidget.php\n- Add Class average in InputFinalGrades.php & Grades.fnc.php\n- Update French & Spanish translation in rosariosis.po & help.po\n- Update Default School Year to 2022 in config.inc.sample.php & rosariosis.sql\n\nChanges in 9.0\n--------------\n- CSS add length to previous meals select in DailyMenus.php\n- CSS FlatSIS fix calendar menu text wrapping in stylesheet.css\n- Add Export list button in TransactionsReport.php\n- Add Food Service icon to list in ServeMenus.php\n- Add User / Student photo tooltip in ServeMenus.php, Transactions.php & TeacherCompletion.php\n- HTML add horizontal ruler before each category in MakeReferral.php\n- Fix SQL error when generating Schedule table with PHP8.1 in GetMP.php\n- Reorder PDF list columns to match Schedule columns in PrintSchedules.php\n- SQL order Schedule list by Course Title & Course Period Short Name in Schedule.php, PrintSchedules.php & Schedule.inc.php\n- Fix SQL error more than one row returned by a subquery in Rollover.php\n- Fix update Course Period title when Short Name contains single quote in Courses.php\n- Fix PHP8.1 deprecated function parameter is null, program wide\n- Fix PHP8.1 deprecated automatic conversion of false to array in StudentsUsersInfo.fnc.php\n- Fix PHP8.1 deprecated automatic conversion of float to int in ImageResizeGD.php\n- Add Student Photo Tip Message in AddDrop.php & StudentList.php\n- Format Enrollment Start & End Date in Export.php\n- Add Student name if no Contacts at address in MailingLabel.fnc.php\n- Do not Export Delete column in Periods.php & GradeLevels.php\n- HTML group inputs inside fieldset (tab title or program name) in Configuration.php\n- Hide Comment Codes tip message if Comments unchecked for Marking Period in InputFinalGrades.php\n- Add Get Student Labels Form JS (Disable unchecked fieldset) in StudentLabels.fnc.php & StudentLabels.php\n- Fix PHP8.1 deprecated use PostgreSQL $db_connection global variable in database.inc.php & Grades/includes/Dashboard.inc.php\n- Don't Delete Gender & Birthday Student Fields in Fields.fnc.php\n- CSS set cursor for .tipmsg-label in stylesheet.css\n- Add Username to Password Reset email in PasswordReset.php\n- `intl` PHP extension is now required in diagnostic.php & INSTALL.md\n- Fix PHP8.1 deprecated strftime() use strftime_compat() instead in Side.php, Date.php, PHPCompatibility.php, strftime_compat.php, Dashboard.inc.php & Preferences.php\n- Add $course_period_id param to limit check to a single Course Period in Courses.fnc.php & Courses.php\n- Add title to Contact & Address button images in Address.inc.php & GetStuList.fnc.php\n- CSS select max-width 440px in stylesheet.css & zresponsive.css\n- HTML add label to Points inputs to correct alignment in Grades.php\n- HTML add a11y-hidden label to select in CategoryBreakdown.php, CategoryBreakdownTime.php & StudentFieldBreakdown.php\n- Place Go button right after Timeframe in DailyTransactions.php, DailyTotals.php, CategoryBreakdown.php, CategoryBreakdownTime.php, StudentFieldBreakdown.php & Percent.php\n- Fix French translation for \"Not due\" in rosariosis.po\n- Move Transcript Include form checkboxes up in Transcripts.fnc.php\n- Add Delete button for Submission File in StudentAssignments.fnc.php\n- Fix SQL error null value in column \"title\" violates not-null constraint in MassCreateAssignments.php\n- Reorder & rename Course Periods columns to match Schedule program in MassCreateAssignments.php\n- Fix get History Grades Grade Level short name only if no Grade Level available in Transcripts.fnc.php\n- Fix get Student Photo from previous year in Transcripts.fnc.php\n- Fix SQL error invalid input syntax in PrintSchedules.php & TeacherCompletion.php, thanks to @scgajge12\n- Filter IP, HTTP_* headers can be forged in index.php, PasswordReset.php & ErrorMessage.fnc.php\n- Fix SQL error invalid input syntax for integer, program wide\n- Fix PHP8.1 fatal error checkdate argument must be of type int in Calendar.php\n- Fix SQL error invalid input syntax for type date in Calendar.php\n- Fix SQL error duplicate key value violates unique constraint \"attendance_calendar_pkey\" in Calendar.php\n- Fix PHP fatal error Unsupported operand types in ListOutput.php\n- Add AttrEscape() function in Inputs.php\n- Use AttrEscape() instead of htmlspecialchars(), program wide\n- Add use of AttrEscape(), program wide\n- Maintain Advanced search when editing Timeframe in Percent.php\n- Fix SQL injection escape DB identifier in RegistrationSave.fnc.php, Calendar.php, MarkingPeriods.php, Courses.php, SchoolFields.php, AddressFields.php, PeopleFields.php, StudentFields.php, UserFields.php & Referrals.php\n- JS update marked to v4.0.14 in assets/js/marked/ & warehouse_wkhtmltopdf.js\n- JS add DOMPurify 2.3.6 in assets/js/DOMPurify/ & Gruntfile.js\n- JS fix stored XSS issue related to MarkDown in warehouse.js & plugins.min.js, thanks to @intrapus\n- JS remove logged in check on history back in warehouse.js & plugins.min.js\n- Add CSRF token to protect unauthenticated requests in Warehouse.php & login.php\n- Add CSRF token to logout URL in login.php, Warehouse.php, PasswordReset.php, Bottom.php, Student.php & User.php, thanks to @khanhchauminh\n- Logout after 10 Hacking attempts within 1 minute in HackingLog.fnc.php\n- Destroy session now: some clients do not follow redirection in HackingLog.fnc.php\n- Add use of URLEscape(), program wide\n- Use URLEscape() for img src attribute, program wide\n- Sanitize / escape URL as THEME is often included for button img src attribute in User.fnc.php\n- Better format for \"Add another marking period\" form in EditReportCardGrades.php\n- Fix Improper Access Control security issue: add random string to photo file name in TipMessage.fnc.php, Transcripts.fnc.php, PrintClassPictures.php, Student.php, User.php & General_Info.inc.php, thanks to @dungtuanha\n- Fix stored XSS security issue: decode HTML entities from URL in PreparePHP_SELF.fnc.php, thanks to @khanhchauminh\n- Fix stored XSS security issue: remove inline JS from URL in PreparePHP_SELF.fnc.php, thanks to @intrapus & @domiee13\n- Fix stored XSS security issue: add semicolon to HTML entity so it can be decoded in PreparePHP_SELF.fnc.php, thanks to @intrapus\n- Accessibility: add hidden input label using .a11y-hidden class in ReportCardComments.php, StudentFields.php & Grades/TeacherCompletion.php\n- Accessibility: add select label in Eligibility/TeacherCompletion.php, Student.php, StudentList.php, MassDrops.php & MassSchedule.php\n- Two Lists on same page: export only first, no search in Eligibility/Student.php\n- Remove photos on delete in Student.php & User.php, thank to @jo125ker\n- Remove Student Assignment Submission files on delete in Assignments.php, thank to @khanhchauminh\n- Add microseconds to filename format to make it harder to predict in Assignments.php & StudentAssignments.fnc.php, thanks to @khanhchauminh\n- Restrict Sort Order input number range, program wide\n- Restrict Price / Amount / Balance input number range, program wide, thanks to @nhienit2010\n- Restrict input number step in Courses.fnc.php\n- Restrict diagnostic access to logged in admin in diagnostic.php, thanks to @intrapus\n- Fix SQL error value too long for type character varying(50) in Schools.php\n- Add Secure RosarioSIS link in INSTALL.md\n- Add Calendar days legend in Calendar.php\n- CSS add .legend-square class in stylesheet.css & colors.css\n- Create / Edit / Delete calendar: use button() in Calendar.php\n- Update Calendars help text in Help_en.php & help.po\n- Add translations for Calendar days legend in rosariosis.po\n- Use json_encode() for AjaxLink() URL, program wide\n- SQL skip \"No Address\" contacts to avoid lines with empty Address fields in Export.php\n- French translation: remove capitalization & use articles in rosariosis.po, help.po & rosariosis_fr.sql\n- JS Sanitize string for legal variable name in Export.php & Inputs.php\n- Remove deprecated `_makeTeacher()` function in ReportCards.fnc.php\n- Use multiple select input for grades list to gain space in Widget.php\n- Fix regression since 5.0, allow Administration of \"Lunch\" attendance categories in Administration.php, AttendanceCodes.fnc.php & colors.css\n- SQL set default FAILED_LOGIN_LIMIT to 30 in rosariosis.sql, thanks to @domiee13\n- JS Hide Options textarea if Field not of select type in Fields.fnc.php\n- Add Balance widget in StudentBalances.php\n- Add Total sum of balances in StudentBalances.php\n- Fix SQL error check requested UserSyear & UserSchool exists in DB in Side.php, Search.fnc.php & SaveEnrollment.fnc.php\n- HTML use number input for Class Rank widget in Widget.php\n- Check default if school has no default calendar in Calendar.php\n- CSS do not capitalize date in stylesheet.css\n\nChanges in 8.9.6\n----------------\n- Fix Stored XSS security issue: escape textarea HTML in Inputs.php, thanks to @jo125ker\n\nChanges in 8.9.5\n----------------\n- Fix stored XSS security issue: do not allow unsanitized XML & HTML in FileUpload.fnc.php, thanks to @nhienit2010\n- Fix stored XSS security issue: escape HTML attribute in StudentAssignments.fnc.php, thanks to @dungtuanha\n- Use big random number for parent password generation in NotifyParents.php & createParents.php, thanks to @intrapus\n- Add microseconds to filename format to make it harder to predict in StudentAssignments.fnc.php, thanks to @dungtuanha\n\nChanges in 8.9.4\n----------------\n- Fix SQL injection sanitize all `$_REQUEST` keys in Warehouse.php, thanks to @nhienit2010\n- Fix reflected XSS via mime-type in FileUpload.fnc.php, thanks to @nhienit2010\n\nChanges in 8.9.3\n----------------\n- Fix stored XSS security issue: do not allow unsanitized SVG in FileUpload.fnc.php, thanks to @scgajge12 & @crowdoverflow\n\nChanges in 8.9.2\n----------------\n- Fix invalidate User School in session on login in index.php\n\nChanges in 8.9.1\n----------------\n- Fix regression since 8.6 Mailing Labels widget HTML in Widgets.php\n\nChanges in 8.9\n--------------\n- Fix GetTeacher() when newly inserted teacher in GetTeacher.fnc.php\n- Remove Half Day option in AddAbsences.php, Administration.php, TakeAttendance.php, Courses.php, Courses.fnc.php & Rollover.php\n- JS Hide \"+ New Period\" link onclick in Courses.php\n- CSS FlatSIS fix bottom button line height in stylesheet.css\n- Add help texts & translations for the Scheduling > Courses program in Help_en.php & help.po\n- Correct typos in Spanish help texts in help.po\n- Fix Locked column value on list export in Schedule.php\n- Student / User Photo input: only accept .jpg,.jpeg,.png,.gif in General_Info.inc.php\n- Increase Food Service icon width to 48px in FS_Icons.inc.php & MenuItems.php\n- HTML add Add-on upload input title in Modules.inc.php & Plugins.inc.php\n- Fix do not resubmit form on List Export in Incomes.php & Expenses.php\n- Fix List Export columns: hide Delete & show File Attached in Expenses.php, Incomes.php, Salaries.php, StaffPayments.php, StudentFees.php & StudentPayments.php\n- Check AllowEdit() on Event deletion in Calendar.php\n- Food Service icon upload in MenuItems.php\n- Add French & Spanish translation for \"Icon successfully uploaded.\" in rosariosis.po\n\nChanges in 8.8\n--------------\n- Fix proc_open() PHP function not allowed in PDF.php\n- Fix PHP Warning A non-numeric value encountered in ReportCards.fnc.php\n- Fix PHP Fatal error Unsupported operand types in Teacher Programs: do not search Students List, unset in CustomFields.fnc.php\n- Add 'staff_' prefix to first & last inputs on Find a User form in GetStaffList.fnc.php & Search.fnc.php\n- Remove icons from Ungraded column, use only number in StudentGrades.php\n- Exclude 0 points assignments from Ungraded count in StudentGrades.php\n- Date select increase years options from +5 to +20 in Date.php\n- JS Raise height by 1 submenu item so we stay above browser URL in warehouse.js\n- Add Min. and Max. GPA to Last row in Grades.fnc.php & ReportCards.fnc.php\n- Add Class Rank to Last row in Grades.fnc.php & ReportCards.fnc.php\n\nChanges in 8.7\n--------------\n- Rector fix bad code in functions/, classes/core/, ProgramFunctions/\n- Update tested on: not compatible with Internet Explorer in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- Add ProgramFunctions/SendEmail.fnc.php|send_error action hook in SendEmail.fnc.php\n- EasyCodingStandard use short array notation in functions/, classes/core/, ProgramFunctions/, modules/ & plugins/\n- Fix month + year format, remove day (regression since 7.1) in Dashboard.inc.php\n- ProgramUserConfig() always return array, not null in Config.fnc.php & \\_makeLetterGrade.fnc.php\n- Allow redirect to Take Attendance, no fatal error if no current MP in Portal.php\n- CSS fix checkbox & radio input vertical align on Firefox in stylesheet.css\n- CSS fix menu hover right arrow position when module name on 2 lines in stylesheet.css\n- CSS fix font-size auto-adjust on iPhone in stylesheet.css\n- Fix typo in English string, update translations in Rollover.php & rosariosis.mo\n- JS fix menu & scroll issue on smartphone landscape > 735px in warehouse.js & jquery-fixed.menu.js\n- FlatSIS theme: use Grunt to minify in Gruntfile.js\n- FlatSIS theme: do not import WPadmin theme stylesheet anymore in stylesheet.css, stylesheet_wkhtmltopdf.css\n- Fix SQL transcript_grades view, grades were duplicated for each school year in rosariosis.sql & Update.fnc.php\n\nChanges in 8.6.1\n----------------\n- Add .webp image to FileExtensionWhiteList() in FileUpload.fnc.php\n- Fix SQL error table name \"sam\" specified more than once in Widget.php\n\nChanges in 8.6\n--------------\n- Add (Student) Widgets class in classes/core/Widgets.php\n- Add (Student) Widget interface and individual Widget classes in classes/core/Widget.php\n- Use RosarioSIS\\Widgets in Widgets.fnc.php\n- Add StaffWidgets class in classes/core/StaffWidgets.php\n- Add StaffWidget interface and individual StaffWidget classes in classes/core/StaffWidget.php\n- Use RosarioSIS\\StaffWidgets in StaffWidgets.fnc.php\n- Admin Student Payments Delete restriction: also exclude Refund in StudentPayments.php & Student_Billing/functions.inc.php\n- Fix PHP Fatal error unsupported operand types when (Staff)Widgets() & $extra used for Parent / Student in Widgets.fnc.php & StaffWidgets.fnc.php\n- Fix PHP Fatal error canBuild() must be compatible with Widget::canBuild(array $modules) in Widget.php & StaffWidget.php\n- Fix SQL error more than one row returned by a subquery in Search.fnc.php\n\nChanges in 8.5.2\n----------------\n- Fix PHP Fatal error cannot redeclare `_rosarioLoginURL()` (regression since 8.3) in MarkDownHTML.fnc.php\n\nChanges in 8.5.1\n----------------\n- Fix SQL syntax error in ORDER BY (regression since 8.3.1) in Substitutions.php\n\nChanges in 8.5\n--------------\n- Fix SQL error duplicate key value violates unique constraint \"food_service_menus_title\" in Menus.php\n- SQL add PRIMARY KEY to staff_exceptions table in rosariosis.sql\n- SQL profile_exceptions & staff_exceptions tables: Add Admin Student Payments Delete restriction in Update.fnc.php & rosariosis.sql\n- Add Admin Student Payments Delete restriction in Profiles.php & Exceptions.php\n- Add Admin Student Payments Delete restriction in StudentPayments.php & Student_Billing/functions.inc.php\n- Fix SQL error numeric field overflow when entering percent > 100 in MassCreateAssignments.php\n- HTML Sort Order input type number in MarkingPeriods.php\n\nChanges in 8.4\n--------------\n- SQL gradebook_grades table: Change comment column type to text in Update.fnc.php & rosariosis.sql\n- Increase Grades Comment input maxlength to 500 chars in Grades.php\n- Fix use more coherent number_format() precision & no thousand separator in Percent.php, Assignments.php, StudentGrades.php, Grades.fnc.php & EditReportCardGrades.php\n- SQL order fields list by Category & SORT_ORDER in AssignOtherInfo.php\n- Fix SQL error numeric field overflow when entering percent > 100 in Assignments.php\n- Comments length > 60 chars, responsive table ColorBox in EditReportCardGrades.php, FinalGrades.php, Grades.php, InputFinalGrades.php & StudentGrades.php\n- Add File Attached to Incomes in Incomes.php & Accounting/functions.inc.php\n- Add File Attached to Expenses in Expenses.php\n- SQL accounting_incomes table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Fix SQL error when no user in session in Template.fnc.php\n- Correct help text note for User deletion in Help_en.php & help.po\n\nChanges in 8.3.1\n----------------\n- Fix SQL exclude fields of 'files' type in Substitutions.php\n- SQL order fields list by Category & SORT_ORDER in Substitutions.php\n- Fix force numeric separator \".\" when no en_US locale, use C locale in Warehouse.php\n- Fix Advanced Search > General Info text fields when adding Username in Search.fnc.php\n\nChanges in 8.3\n--------------\n- Fix PHP Warning non-numeric value encountered, use rounded percent grade in StudentGrades.php\n- Security Fix reflected XSS: encode HTML special chars for search_term in Courses.php\n- Add File Attached to Staff Payments in StaffPayments.php & Accounting/functions.inc.php\n- Add File Attached to Payments in StudentPayments.php & Student_Billing/functions.inc.php\n- SQL accounting_payments table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- SQL billing_payments table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add help note for student deletion & translate in Help_en.php & help.po\n- Add RosarioSIS URL to image path in MarkDownHTML.fnc.php\n- Fix SQL error invalid byte sequence for encoding \"UTF8\": 0xde 0x20 in Security.php\n\nChanges in 8.2.1\n----------------\n- Fix SQL for Warning when only 0 points assignments in Assigments.php\n\nChanges in 8.2\n--------------\n- Fix replace regex: remove slash & allow space in FileUpload.fnc.php\n- Always Use Last Year's Picture if Missing in PrintClassLists.php\n- Fix #329 SQL error division by zero in t_update_mp_stats(): set min Credits to 1 in Courses.fnc.php\n- Fix SQL error when Teacher name has single quote in Courses.php\n- CSS FlatSIS remove useless line-height for tabs in stylesheet.css\n\nChanges in 8.1.1\n----------------\n- Fix security issue #328 unauthenticated access to Side.php in Warehouse.php, thanks to @ijdpuzon\n- Fix security issue #328 sanitize `$_POST` school, syear, mp & period parameters in Side.php\n\nChanges in 8.1\n--------------\n- Remove @ error control operator on pg_exec: allow PHP Warning in database.inc.php\n- Fix Address Field sequence name in AddressFields.php\n- Remove deprecated DBSeqConvertSerialName() function in database.inc.php\n- Fix Conflict Warning displayed twice in Courses.php\n- Fix PHP Notice Undefined index in miscExport.fnc.php\n- Fix SQL error when Student / Staff ID is hacked / not an integer in URL in Current.php\n- SQL accounting_salaries table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add File Attached to Salaries in Salaries.php & Accounting/functions.inc.php\n- SQL billing_fees table: Add FILE_ATTACHED column in Update.fnc.php & rosariosis.sql\n- Add File Attached to Fees in StudentFees.php & Student_Billing/functions.inc.php\n- Fix Student Widgets for Advanced Search exports in GetStaffList.fnc.php, GetStuList.fnc.php & Search.inc.php\n- Add Export fields list (form) & Export fields list + extra SQL (student list) action hooks in Export.php & Actions.php\n- Do not remove Full Day and Half Day school periods from the Schedule table in PrintSchedules.php\n- Fix 403 Forbidden error due to pipe \"|\" in URL when using Apache 5G rules in Widgets.fnc.php\n\nChanges in 8.0.4\n----------------\n- Fix default Student/Parent program in Attendance/Menu.php\n\nChanges in 8.0.3\n----------------\n- Fix #324 Show Student Photo in Transcripts.fnc.php\n\nChanges in 8.0.2\n----------------\n- Fix User Widgets Search Terms in Users/Search.inc.php\n\nChanges in 8.0.1\n----------------\n- Fix #322 PHP syntax error, unexpected ')' in DailySummary.php\n\nChanges in 8.0\n--------------\n- Add Total from Payments & Total from Fees fields to Advanced Report in Export.php\n- Upgrade grunt, grunt-contrib-cssmin, grunt-contrib-uglify & grunt-contrib-watch & remove grunt-phpdoc in package.json & Gruntfile.js\n- CSS minification optimizations in stylesheet.css & stylesheet_wkhtmltopdf.css\n- JS uglify optimizations in plugins.min.js & plugins.min.js.map\n- Upgrade Chart.js from 2.9.3 to 3.4.1 & save 40KB in chart.min.js & Charts.fnc.php\n- Fix \"The gradebook configuration has been modified.\" note appearing twice in Grades/Configuration.php\n- Add warning in case all Assignments in Type have 0 Points (Extra Credit) in Assignments.php\n- Update French & Spanish translations in rosariosis.po\n- CSS FlatSIS shorten menu width & submenu links height + better contrast in stylesheet.css\n- CSS FlatSIS list square bullets in stylesheet.css\n- Default theme is now FlatSIS in rosariosis.sql\n- CSS remove .radio-attendance-code class in stylesheet.css, rtl.css & TakeAttendance.php\n- CSS remove Open Sans SVG fonts, format is deprecated in font.css & WPadmin/fonts/open\n- Upgrade marked.js 0.8.2 to version 1.2.9 in assets/js/marked/\n- Fix SQL error when $staff_id is 0 (no user in session) in Config.fnc.php\n- Remove Waived Fees from list in Student_Billing/functions.inc.php\n- New ROSARIO_DISABLE_ADDON_DELETE optional config constant in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- Add-on disable delete in Modules.inc.php & Plugins.inc.php\n- Merge Daily Transactions & Daily Totals programs in DailyTransactions.php & DailyTotals.php\n- Remove Daily Totals program from Student Billing & Accounting menus in Menu.php & rosariosis.sql\n- Fix Totals calculation in Accounting/includes/DailyTotals.php\n- Multibyte strings: check if not UTF-8 first to avoid cost of setting in Warehouse.php\n- Fix false positive Hacking Attempt on Print button click when no user in session in Warehouse.php\n- Merge Attendance Chart & Absence Summary programs in DailySummary.php & StudentSummary.php & Help_en.php\n- Remove Absence Summary program from Attendance menu in Menu.php, Help_en.php & rosariosis.sql\n\nChanges in 7.9.3\n----------------\n- Fix #318 PHP warning non-numeric value encountered for $LO_dir in ListOutput.fnc.php, thanks to @AhmadKakarr\n\nChanges in 7.9.2\n----------------\n- Fix SQL error when single quote in Course Title in InputFinalGrades.php\n- Fix include Semester course periods in the Schedule table in Schedule.inc.php\n- Fix #316 CSRF security issue set cookie samesite to strict, thanks to @huntrdev\n\nChanges in 7.9.1\n----------------\n- Fix remove file when has single quote in its name and actually delete file in Student.php, User.php & Schools.php\n- Fix download backup filename when contains spaces: use double quotes in DatabaseBackup.php\n\nChanges in 7.9\n--------------\n- Update default School Year to 2021 in rosariosis.sql & config.inc.sample.php\n\nChanges in 7.8.4\n----------------\n- Fix User Marking Period title in GradeBreakdown.php\n- SQL ORDER BY Teacher name in GradeBreakdown.php\n\nChanges in 7.8.3\n----------------\n- Fix trim 0 (float) when percent > 1,000: do not use comma for thousand separator in Grades.php & ProgressReports.php\n\nChanges in 7.8.2\n----------------\n- Fix try searching plural forms adding an 's' to singular form and with number set to 1 in Translator.php\n\nChanges in 7.8.1\n----------------\n- CSS Edge browser fix: Do not merge focus-within styles with hover styles in stylesheet.css, stylesheet_wkhtmltopdf.css & rtl.css\n\nChanges in 7.8\n--------------\n- Handle `multiple` files attribute in warehouse.js & Inputs.php\n- Add FileUploadMultiple(). Handle `multiple` files attribute for FileUpload() in FileUpload.fnc.php\n- Remove Reset button from Find a Student / User forms in Students/Search.inc.php & Users/Search.inc.php\n- CSS & JS open submenu on focus & focus-within in warehouse.js, stylesheet.css & rtl.css\n- CSS menu link & button color on focus in stylesheet.css & colors.css\n- Fix check students Course Status in PrintClassLists.php, PrintClassPictures.php, ClassSearchWidget.fnc.php, Referrals.php, EmailReferral.fnc.php & Widgets.fnc.php\n- Add Include Inactive Students checkbox in MasterScheduleReport.php & RequestsReport.php\n- Fix unset current student (check Course Status) when MP updated in Side.php\n- SQL fix Discipline Referrals using WHERE EXISTS in Widgets.fnc.php\n- Numeric Discipline field: invert values so BETWEEN works in Widgets.fnc.php\n- Numeric Discipline field: input type number in Widgets.fnc.php\n- Fix SQL error missing FROM address table in GetStuList.fnc.php\n\nChanges in 7.7\n--------------\n- Move Dashboard() call outside in Dashboard.fnc.php & Portal.php\n- Add .xlsm,.key,.midi,.aif,.mpeg,.h264,.mkv,.log,.email,.eml,.emlx,.msg,.vcf extensions to white list in FileUpload.fnc.php\n- Add \"Last Name Middle Name First Name\" option to Display Name in GetStuList.fnc.php & Configuration.php\n- Fix SQL error escape course title in StudentGrades.php\n- SQL Remove Salaries having a Payment (same Amount & Comments (Title), after or on Assigned Date) in Accounting/functions.inc.php\n- SQL match Payment Comments LIKE Fee Title in Student_Billing/functions.inc.php\n- CSS fix list line-height in FlatSIS/stylesheet_wkhtmltopdf.css\n\nChanges in 7.6.1\n----------------\n- Fix #307 XSS update CodeIgniter Security class in classes/Security.php, thanks to @DustinBorn\n- Move Portal Poll vote code to modfunc in PortalPollNotes.php & Portal.php\n- Fix #308 Unauthenticated SQL injection. Use sanitized `$_REQUEST` in Portal.php, thanks to @DustinBorn\n- Fix #308 sanitize key. Pass array keys through function in Warehouse.php, thanks to @DustinBorn\n- Fix #309 unset `$_SESSION` so user cannot maintain dummy session in PasswordReset.php, thanks to @DustinBorn\n- Remove use of `$_SESSION['STAFF_ID'] === '-1'` in User.fnc.php & PasswordReset.php\n\nChanges in 7.6\n--------------\n- Fix login password with single quote, use POST in index.php & Preferences.php\n- HTML Use #! instead of JS return false to not go back to top in Buttons.php & Profiles.php\n- JS remove warehouse.min.js & include warehouse.js inside plugins.min.js in Gruntfile.js, assets/js/ & Warehouse.php\n- Fix PHP8 compatibility issues (warnings & fatal errors), system wide\n- Fix save new Grade with \"0\" as Title in ReportCardGrades.php\n- PHP8 no xmlrpc ext: load xmlrpc compat functions in plugins/Moodle/client.php, xmlrpc.php, XML_RPC.php, XmlrpcDecoder.php & XmlrpcEncoder.php\n- Fix xmlrpc nested arrays, use param & value elements instead in XmlrpcEncoder.php\n- Fix SQL Total points only select assignments for CP teacher (teacher may have changed) in Grades.php, InputFinalGrades.php, StudentGrades.php & GradebookBreakdown.php\n- Fix SQL Grades sort order in GradebookBreakdown.php\n- Add Login form link action hook in index.php & Actions.php\n- SQL fix Report Card Grades insert in rosariosis_fr.sql\n- SQL fix ORDER Report Cards by Student name & Course list by Title in ReportCards.fnc.php\n- SQL fix error invalid input syntax for integer in DailySummary.php\n- Replace tested on Ubuntu 16.04 with 18.04 (Buster) in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n\nChanges in 7.5\n--------------\n- HTML fix Student Assignment Submission display in StudentAssignments.fnc.php\n- Percent rounding to 2 decimal places is new School default in \\_makeLetterGrade.fnc.php\n- CSS Fix widefat table border color when rendered in PDF inside Chrome in colors.css\n- Add phpwkhtmltopdf class & remove Wkhtmltopdf class in classes/\n- Use phpwkhtmltopdf class instead of Wkhtmltopdf (more reliable & faster) in PDF.php\n- Add Report Cards PDF footer action hook in ReportCards.fnc.php & Actions.php\n- Transcripts PDF header action hook: echo your custom text before or append it to $header_html to display it after in Transcripts.fnc.php\n- Transcripts PDF footer action hook: echo your custom text before or append it to $footer_html to display it after in Transcripts.fnc.php\n- Add .transcript-certificate-block1 & .transcript-certificate-block2 CSS classes in Transcripts.fnc.php\n- Add .report-card-free-text CSS class in ReportCards.fnc.php\n- Delete any attendance for this day & student prior to update in FixDailyAttendance.php\n- Use \\_makeLetterGrade() for Percent grade so it reflects Teacher's Score rounding configuration in Grades.php & ProgressReports.php\n- Fix Add Credits only for Report Cards in ReportCards.fnc.php\n- Fix SQL error invalid input syntax for integer (Class Rank input) in Widgets.fnc.php\n- HTML Grades GPA Widget: use number input & check Weighted by default in Widgets.fnc.php\n\nChanges in 7.4\n--------------\n- List sort comment: trim & fix position in ListOutput.fnc.php\n- Fix #303 Raw value in comment so we can sort Percent column the right way in Grades.php, thanks to @dd02\n- Add Database Backup link to header in Rollover.php\n- Add Course Widget configuration option: Popup window or Pull-Down in Configuration.php & Help_en.php\n- Add Course Widget: select / Pull-Down in Widgets.fnc.php\n- Update French & Spanish translations in rosariosis.po, help.po\n- Add Total Credits in ReportCards.fnc.php\n- Do not display \"General Comments\" title if no comments in ReportCards.fnc.php\n- HTML display rows of 3 School Period checkboxes in AddAbsences.php\n- Comment input maxlength increased to 500 in InputFinalGrades.php\n- Comment Code input field is required in ReportCardCommentCodes.php\n- Add php-zip extension to list in INSTALL.md\n- Check for zip extension in diagnostic.php\n- Fix SQL error integer out of range in Food_Service/Students/Accounts.php\n- French translation: replace \"Effacer\" with \"Supprimer\" in rosariosis.po & help.po\n- Fix Teacher Programs Progress Report PDF, do not echo form in TeacherPrograms.php\n\nChanges in 7.3.1\n----------------\n- Fix admin override: no input div when values are not saved yet in Grades/Configuration.php\n- Fix #304 Do not include Excused (`*` or -1) grades in GradebookBreakdown.php, thanks to @dd02\n- Fix #304 regression since 5.0 Count students in GradebookBreakdown.php, thanks to @dd02\n- Fix #304 Totals count exclude Extra Credit assignments when Total Points is 0 for the Type, thanks to @dd02\n\nChanges in 7.3\n--------------\n- SQL Replace AND p.ATTENDANCE='Y' with AND cp.DOES_ATTENDANCE IS NOT NULL in Letters.php, StudentLabels.fnc.php, HonorRoll.fnc.php & Reminders.php\n- SQL remove unused SELECT ROOM in HonorRoll.fnc.php\n- Translate database on add-on install: run 'install_fr.sql' file in Modules.inc.php, Plugins.inc.php, modules/README.md & plugins/README.md\n- CSS remove wildcard rules in stylesheet.css & wkhtmltopdf.css\n- CSS remove browser input outline on focus in colors.css\n- Fix Format Phone Number for US in GetStuList.fnc.php, thanks to @dzungdo\n- Attendance dashboard limit Absences to past days in Dashboard.inc.php\n- Fix #299 Remove trailing slash \"/\" or dash \"-\" or dot \".\" from date in DailySummary.php\n- Fix #300 Include Full Day and Half Day school periods in the schedule table in PrintSchedules.php, thanks to @dzungdo\n- Update translations complete % in locale/REFERENCE.md\n- Add tested on CentOS & Google Chrome in INSTALL.md & INSTALL.pdf, thanks to @dd02\n- Add Before First Login form action hook in index.php & Actions.php\n- Fix regression since 7.0 not rolled items are checked in Rollover.php\n\nChanges in 7.2.4\n----------------\n- Take in Account Calendar Day Minutes in UpdateAttendanceDaily.fnc.php\n- Fix regression since 5.3 Return false if School Periods Length sum is 0 in UpdateAttendanceDaily.fnc.php, thanks to @dzungdo\n\nChanges in 7.2.3\n----------------\n- Fix regression since 5.9 search text User Field in Search.fnc.php, thanks to @dzungdo\n\nChanges in 7.2.2\n----------------\n- Fix SQL error foreign keys: Roll Schools before rolling Student Enrollment in Rollover.php\n- Fix SQL error table address specified more than once in GetStuList.fnc.php\n\nChanges in 7.2.1\n----------------\n- Fix ParseMLField for Username field category in Preferences.php\n- Fix PHP Warning check requested locale exists in Warehouse.php\n- Add Attendance Codes help for (Lunch) Categories in Help_en.php & help.po\n- Fix SQL error multiple rows returned by a subquery in CreateParents.php\n\nChanges in 7.2\n--------------\n- Add Grade Level breakdown in StudentFieldBreakdown.php\n- Add link to Student Info in AddDrop.php\n- Limit students to User schools in AddDrop.php\n- Order Day, Month & Year inputs depending on User date preference in Date.php\n- SQL fix only display enrolled students in AddStudents.php\n- Link to Student Info redirects to right school in AddStudents.php\n- Reset password variable for each Contact in CreateParents.php\n\nChanges in 7.1.4\n----------------\n- Fix infinite loop when username already exists in CreateParents.php\n\nChanges in 7.1.3\n----------------\n- Fix #297 regression since 6.9 & SQL error in StudentSummary.php\n\nChanges in 7.1.2\n----------------\n- Fix SQL error Include Inactive Students for admin in PrintClassLists.php\n\nChanges in 7.1.1\n----------------\n- Fix #296 Include Inactive Students for admin in PrintClassLists.php\n\nChanges in 7.1\n--------------\n- Final Grading Percentages: add \"No quarters found\" error in Configuration.php\n- Add Start Date input in Scheduler.php\n- Export (Excel) date to YYYY-MM-DD format (ISO) in Date.php & Preferences.php\n- Select Date Format: Add Preferences( 'DATE' ) in User.fnc.php, Preferences.php, Date.php & Side.php\n- Fix SQL error TITLE column limit to 50 characters in GradeLevels.php\n- HTML remove radio buttons (File Attached or Embed Link) in PortalNotes.php & PortalPollsNotes.fnc.php\n- Add Grade Level breakdown in StudentBreakdown.php\n- Include Credits in ReportCards.fnc.php\n\nChanges in 7.0.4\n----------------\n- Fix #295 regression since 7.0 cannot save N/A date in Date.php\n\nChanges in 7.0.3\n----------------\n- Fix Multiple School Periods: Course Period School Period does not match, skip in Scheduler.php\n\nChanges in 7.0.2\n----------------\n- JS Fix search form onsubmit in Export.php\n\nChanges in 7.0.1\n----------------\n- Fix #292 System error \"blocked access to local file\" with wkhtmltopdf 0.12.6 in Wkhtmltopdf.php\n\nChanges in 7.0\n--------------\n- Update Markdownify from v2.1.11 to v2.3.1 in classes/Markdownify/*\n- Update Parsedown from v1.6.0 to v1.7.4 in classes/Parsedown.php\n- Update MoTranslator from v3.4 to v4.0 in Warehouse.php, Help.fnc.php & classes/MoTranslator/*\n- Fix 'School' translation when using MoTranslator in Schedule.inc.php & rosariosis.po\n- Fix '%s Handbook' translation when using MoTranslator in Help.php\n- CSS fix align \"+\" New Event icon to bottom in Calendar.php, CalendarDay.inc.php, stylesheet.css & zreponsive.css\n- Fix Day Number when multiple calendars and school years in CalendarDay.inc.php, DayToNumber.inc.php\n- Fix Numbered days display in SchoolPeriodsSelectInput.fnc.php & Courses.fnc.php\n- SQL improve Numbered days in AddAbsences.php, Administration.php, DailySummary.php, TakeAttendance.php, TeacherCompletion.php, UpdateAttendanceDaily.fnc.php & Portal.php\n- Place Rollover under Utilities separator in Menu.php\n- Merge Schedule Report & Master Schedule Report in Menu.php, MasterScheduleReport.php, ScheduleReport.php & rosariosis.sql\n- Add Students column to report in RequestsReport.php\n- Merge Requests Report & Unfilled Requests in Menu.php, RequestsReport.php, UnfilledRequests.php, Scheduler.php, Help_en.php & rosariosis.sql\n- Merge Average Daily Attendance & Average Attendance by Day in Menu.php, Percent.php, Help_en.php, help.po & rosariosis.sql\n- Remove \"Happy []...\" text in Portal.php\n- HTML remove \"Demographics\" header to gain space on PDF in AttendanceSummary.php\n- SQL Update ATTENDANCE_CODE (admin) when is NULL in TakeAttendance.php\n- CSS Add .widefat.files class in StudentsUsersInfo.fnc.php & stylesheet.css\n- CSS WPadmin more padding for list rows, menu links & footer help in stylesheet.css\n- CSS FlatSIS less padding for list row, header & popTable in stylesheet.css\n- CSS FlatSIS reduce body line-height & fix Dashboard tipmsg border in stylesheet.css\n- Format \"Show Available Seats\" & \"Print Schedule\" headers in Schedule.php\n- Remove $fy_id global variable in Schedule.php\n- HTML Add tooltips & notes in Rollover.php\n- Fix current CP Marking Period check on update in Courses.php\n- Fix limit list results to 1000, do not remove 1st result in ListOutput.fnc.php\n- Add $RosarioErrorsAddress config variable in config.inc.sample.php\n- Fix $RosarioNotifyAddress config variable description in INSTALL.md, INSTALL_es.md & INSTALL_fr.md\n- SQL no access to Custom \"My Report\" program for admin by default in rosariosis.sql\n- JS MarkdownToHTML No MarkDown in text, return raw text in warehouse.js\n- Fix Delete from other Student/User Info tabs in Student.php & User.php\n- Remove deprecated since 4.5 rollover_* action hooks in Rollover.php & Actions.php\n- Fix Error: There is no column for The value for 0. This value was not saved in SaveData.fnc.php\n- Fix Do not Save / Export Medical tab lists in Medical.inc.php\n\n\n### Old versions CHANGES\n- [CHANGES for versions 5 and 6](CHANGES_V5_6.md).\n- [CHANGES for versions 3 and 4](CHANGES_V3_4.md).\n- [CHANGES for versions 1 and 2](CHANGES_V1_2.md).\n", "<?php\n/**\n * Warehouse\n *\n * Get configuration\n * Load functions\n * Date format & Time zone\n * Start Session\n * Sanitize $_REQUEST array\n * Internationalization\n * Modules & Plugins\n * Update RosarioSIS\n * Warehouse() function (Output HTML header (including Bottom & Side menus), or footer)\n * isPopup() function (Popup window detection)\n * isAJAX() function (AJAX request detection)\n * ETagCache() function (ETag cache system)\n *\n * @package RosarioSIS\n */\n\ndefine( 'ROSARIO_VERSION', '9.3.1' );\n\n/**\n * Include config.inc.php file.\n *\n * Do NOT change for require_once, include_once allows the error message to be displayed.\n */\n\nif ( ! include_once 'config.inc.php' )\n{\n\tdie( 'config.inc.php file not found. Please read the installation directions.' );\n}\n\nif ( empty( $DatabaseType ) )\n{\n\t// @since 10.0 Add $DatabaseType configuration variable\n\t$DatabaseType = 'postgresql';\n}\n\nrequire_once 'database.inc.php';\n\n/**\n * Optional configuration\n * You can override the following definitions in the config.inc.php file\n */\n\nif ( ! defined( 'ROSARIO_DEBUG' ) )\n{\n\t// Debug mode (for developers): enables notices.\n\tdefine( 'ROSARIO_DEBUG', false );\n}\n\nerror_reporting( ROSARIO_DEBUG ? E_ALL : E_ALL ^ E_NOTICE );\n\n// Server Paths.\n\nif ( ! isset( $RosarioPath ) )\n{\n\t$RosarioPath = __DIR__ . '/';\n}\n\nif ( ! isset( $StudentPicturesPath ) )\n{\n\t$StudentPicturesPath = 'assets/StudentPhotos/';\n}\n\nif ( ! isset( $UserPicturesPath ) )\n{\n\t$UserPicturesPath = 'assets/UserPhotos/';\n}\n\nif ( ! isset( $FileUploadsPath ) )\n{\n\t$FileUploadsPath = 'assets/FileUploads/';\n}\n\nif ( ! isset( $LocalePath ) )\n{\n\t// Path were the language packs are stored. You need to restart Apache at each change in this directory.\n\t$LocalePath = 'locale';\n}\n\nif ( ! isset( $ETagCache ) )\n{\n\t// ETag cache system.\n\t$ETagCache = true;\n}\n\n/**\n * Load functions\n */\n$functions = glob( 'functions/*.php' );\n\nforeach ( $functions as $function )\n{\n\trequire_once $function;\n}\n\nif ( $DatabaseType === 'mysql' )\n{\n\t/**\n\t * Set MySQL charset to utf8mb4 and collation to utf8mb4_unicode_520_ci\n\t *\n\t * @since 10.0\n\t *\n\t * Fix SQL error \"Illegal mix of collations (utf8mb4_unicode_520_ci,IMPLICIT)\n\t * \tand (utf8mb4_general_ci,IMPLICIT) for operation '='\"\n\t * @link https://www.php.net/manual/en/mysqli.set-charset.php#121647\n\t */\n\tDBQuery( \"SET NAMES utf8mb4 COLLATE utf8mb4_unicode_520_ci\" );\n\n\t/**\n\t * Set MySQL mode to accept pipes || as concatenation operator.\n\t * For backward-compatibility purpose only, try to always use CONCAT() instead of ||\n\t *\n\t * @since 10.0\n\t * @link https://stackoverflow.com/questions/5975958/string-concatenation-in-mysql#5975980\n\t */\n\tif ( ! ROSARIO_DEBUG )\n\t{\n\t\tDBQuery( \"SET @@sql_mode=CONCAT(@@sql_mode,',PIPES_AS_CONCAT')\" );\n\t}\n}\n\n/**\n * Date format & Time zone\n */\nif ( $DatabaseType === 'postgresql' )\n{\n\t/**\n\t * Set PostgreSQL Session Date Format / Datestyle to ISO.\n\t *\n\t * @since 2.9\n\t * @since 10.0 Move query from Date.php to Warehouse.php\n\t */\n\tDBQuery( \"SET DATESTYLE='ISO'\" );\n}\n\nif ( isset( $Timezone ) )\n{\n\t// Time zone.\n\t// Sets the default time zone used by all date/time functions.\n\tif ( date_default_timezone_set( $Timezone ) )\n\t{\n\t\tif ( $DatabaseType === 'mysql' )\n\t\t{\n\t\t\t/**\n\t\t\t * Get offset from time zone.\n\t\t\t *\n\t\t\t * @link https://stackoverflow.com/questions/25086456/php-convert-string-timezone-format-to-offset-integer#25086526\n\t\t\t */\n\t\t\t$date_time_zone = new DateTimeZone( $Timezone );\n\t\t\t$date = new DateTime( null, $date_time_zone );\n\t\t\t$offset = $date_time_zone->getOffset( $date );\n\t\t\t$offset = ( $offset < 0 ? '-' : '+' ) . gmdate( 'H:i', abs( $offset ) );\n\n\t\t\tDBQuery( \"SET time_zone='\" . $offset . \"'\" );\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// If valid PHP timezone_identifier, should be OK for PostgreSQL.\n\t\t\tDBQuery( \"SET TIMEZONE TO '\" . $Timezone . \"'\" );\n\t\t}\n\t}\n}\n\n// Send email on PHP fatal error.\nregister_shutdown_function( 'ErrorSendEmail' );\n\n/**\n * Start Session\n */\nsession_name( 'RosarioSIS' );\n\n// @link http://php.net/manual/en/session.security.php\n$cookie_path = dirname( $_SERVER['SCRIPT_NAME'] ) === DIRECTORY_SEPARATOR ?\n\t'/' : dirname( $_SERVER['SCRIPT_NAME'] ) . '/';\n\n// Fix #316 CSRF security issue set cookie samesite to strict.\n// @link https://www.php.net/manual/en/function.session-set-cookie-params.php#125072\n$cookie_samesite = 'Strict';\n\n// Cookie secure flag for https.\n$cookie_https_only = ( ! empty( $_SERVER['HTTPS'] ) && $_SERVER['HTTPS'] !== 'off' ) ||\n\t( isset( $_SERVER['SERVER_PORT'] ) && $_SERVER['SERVER_PORT'] == 443 );\n\nif ( PHP_VERSION_ID < 70300 )\n{\n\t// PHP version < 7.3.\n\tsession_set_cookie_params(\n\t\t0,\n\t\t$cookie_path . '; samesite=' . $cookie_samesite,\n\t\t'',\n\t\t$cookie_https_only,\n\t\ttrue\n\t);\n}\nelse\n{\n\tsession_set_cookie_params( [\n\t\t'lifetime' => 0,\n\t\t'path' => $cookie_path,\n\t\t'domain' => '',\n\t\t'secure' => $cookie_https_only,\n\t\t'httponly' => true,\n\t\t'samesite' => $cookie_samesite,\n\t] );\n}\n\nsession_cache_limiter( 'nocache' );\n\nsession_start();\n\nif ( empty( $_SESSION['token'] ) )\n{\n\t/**\n\t * Add CSRF token to protect unauthenticated requests\n\t *\n\t * @since 9.0\n\t * @link https://stackoverflow.com/questions/5207160/what-is-a-csrf-token-what-is-its-importance-and-how-does-it-work\n\t */\n\t$_SESSION['token'] = bin2hex( openssl_random_pseudo_bytes( 16 ) );\n}\n\nif ( empty( $_SESSION['STAFF_ID'] )\n\t&& empty( $_SESSION['STUDENT_ID'] )\n\t&& ( basename( $_SERVER['SCRIPT_NAME'] ) === 'Modules.php'\n\t\t|| basename( $_SERVER['SCRIPT_NAME'] ) === 'Bottom.php'\n\t\t|| basename( $_SERVER['SCRIPT_NAME'] ) === 'Side.php' ) )\n{\n\t// Logout if no Staff or Student session ID.\n\t/**\n\t * Redirect to Modules.php URL after login.\n\t *\n\t * @since 3.8\n\t */\n\t$redirect_to = basename( $_SERVER['SCRIPT_NAME'] ) === 'Modules.php' ?\n\t\t'&redirect_to=' . urlencode( $_SERVER['QUERY_STRING'] ) : '';\n\n\t// Redirection is done in Javascript in case current request is AJAX.\n\t?>\n\t<script>window.location.href = \"index.php?modfunc=logout\" +\n\t\t<?php echo json_encode( $redirect_to ); ?> +\n\t\t\"&token=\" + <?php echo json_encode( $_SESSION['token'] ); ?>;</script>\n\t<?php\n\texit;\n}\n\n/**\n * Array recursive walk (values AND keys!)\n *\n * @since 7.6 Fix #308 sanitize key. Pass array keys through function.\n *\n * @param  array  $array    Array by reference.\n * @param  string $function Function name.\n * @return array  &$array Array passed through $function function\n */\nfunction array_rwalk( &$array, $function )\n{\n\t$key = array_keys( $array );\n\n\t$size = count( $key );\n\n\tfor ( $i = 0; $i < $size; $i++ )\n\t{\n\t\tif ( is_array( $array[$key[$i]] ) )\n\t\t{\n\t\t\tarray_rwalk( $array[$key[$i]], $function );\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$array[$key[$i]] = $function( $array[$key[$i]] );\n\t\t}\n\n\t\t// Key is also passed through $function function.\n\t\t$fkey = $function( $key[$i] );\n\n\t\tif ( $fkey != $key[$i] ) // Weak comparison so we do not change integer value type.\n\t\t{\n\t\t\t// New key, order in array is lost (added last), sorry.\n\t\t\t$array[$fkey] = $array[$key[$i]];\n\n\t\t\t// Key passed through function differs, unset original key.\n\t\t\tunset( $array[$key[$i]] );\n\t\t}\n\t}\n}\n\n/**\n * Limit $_POST array size to a maximum of 16MB\n *\n * $_POST array size is limited by PHP post_max_size configuration option\n * But this includes $_FILES as well & post_max_size must be greater than upload_max_filesize\n * One may want to be able to upload a 100MB file, but may not want the $_POST var,\n * with for example the text or HTML of a textarea to be 100MB and later stored in database.\n */\nif ( ! defined( 'ROSARIO_POST_MAX_SIZE_LIMIT' ) )\n{\n\t/**\n\t * Fix a limit of 16MB based on MySQL max_allowed_packet default limit\n\t * Limit size can be overriden in the config.inc.php file\n\t */\n\tdefine( 'ROSARIO_POST_MAX_SIZE_LIMIT', 16 * 1024 * 1024 ); // 16MB in bytes.\n}\n\nif ( $_POST\n\t&& strlen( serialize( $_POST ) ) > ROSARIO_POST_MAX_SIZE_LIMIT )\n{\n\t$post_max_size_limit = function( $value ) {\n\t\tif ( strlen( $value ) > ( ROSARIO_POST_MAX_SIZE_LIMIT / 4 ) )\n\t\t{\n\t\t\t// Reset value > limit / 4, or else we would send it in the HackingLog email!\n\t\t\treturn 'ROSARIO_POST_MAX_SIZE_LIMIT / 4 reached.';\n\t\t}\n\n\t\treturn $value;\n\t};\n\n\tarray_rwalk( $_POST, $post_max_size_limit );\n\n\tarray_rwalk( $_REQUEST, $post_max_size_limit );\n\n\trequire_once 'ProgramFunctions/HackingLog.fnc.php';\n\n\t// Do not translate.\n\t$error[] = 'You are submitting too much data: over the ' .\n\t\t( ROSARIO_POST_MAX_SIZE_LIMIT / 1024 / 1024 ) .\n\t\t'M limit. Try reducing the data you are submitting.';\n\n\tHackingLog();\n}\n\n/**\n * Sanitize $_REQUEST array\n * ($_POST + $_GET)\n */\n// Escape strings for DB queries.\narray_rwalk( $_REQUEST, 'DBEscapeString' );\n\n// Remove HTML tags.\narray_rwalk( $_REQUEST, 'strip_tags' );\n\n/**\n * Internationalization\n */\n\nif ( ! empty( $_REQUEST['locale'] )\n\t&& in_array( $_REQUEST['locale'], $RosarioLocales ) )\n{\n\t$_SESSION['locale'] = $_REQUEST['locale'];\n}\nelseif ( empty( $_SESSION['locale'] ) )\n{\n\t$_SESSION['locale'] = $RosarioLocales[0]; // English?\n}\n\n$locale = $_SESSION['locale'];\n\nputenv( 'LC_ALL=' . $locale );\n\nfunction_exists( '_setlocale' ) ?\n\t// PHP Compatibility: MoTranslator.\n\t_setlocale( LC_ALL, $locale ) :\n\tsetlocale( LC_ALL, $locale );\n\n// Numeric separator \".\".\nsetlocale( LC_NUMERIC, 'C', 'english', 'en_US', 'en_US.utf8', 'en_US.UTF-8' );\n\nif ( $locale === 'tr_TR.utf8' )\n{\n\t// Bugfix for Turkish characters conversion.\n\tsetlocale( LC_CTYPE, 'C', 'english', 'en_US', 'en_US.utf8', 'en_US.UTF-8' );\n}\n\n// Binds the messages domain to the locale folder.\nbindtextdomain( 'rosariosis', $LocalePath );\n\n// Ensures text returned is utf-8, quite often this is iso-8859-1 by default.\nbind_textdomain_codeset( 'rosariosis', 'UTF-8' );\n\n// Sets the domain name, this means gettext will be looking for a file called rosariosis.mo.\ntextdomain( 'rosariosis' );\n\nif ( mb_internal_encoding() !== 'UTF-8' )\n{\n\t// Multibyte strings: check if not UTF-8 first to avoid cost of setting.\n\tmb_internal_encoding( 'UTF-8' );\n}\n\nif ( ROSARIO_DEBUG )\n{\n\trequire_once 'ProgramFunctions/Debug.fnc.php';\n\n\t// @since 5.0 Load Kint.\n\tKint();\n}\nelse\n{\n\tfunction d()\n\t{\n\t\t// Prevent PHP Fatal error if Kint debug d() function not loaded.\n\t}\n}\n\n/**\n * Update RosarioSIS\n * Automatically runs after manual files update\n * To apply eventual incremental DB updates\n *\n * @see ProgramFunctions/Update.fnc.php\n * @since 2.9\n */\n// Check if version in DB < ROSARIO_VERSION.\n\nif ( version_compare( Config( 'VERSION' ), ROSARIO_VERSION, '<' ) )\n{\n\trequire_once 'ProgramFunctions/Update.fnc.php';\n\n\t// Run Update() to apply updates if any.\n\tUpdate();\n}\n\n/**\n * Modules\n *\n * Core modules (packaged with RosarioSIS): cannot be deleted.\n */\n$RosarioCoreModules = [\n\t'School_Setup',\n\t'Students',\n\t'Users',\n\t'Scheduling',\n\t'Grades',\n\t'Attendance',\n\t'Eligibility',\n\t'Discipline',\n\t'Accounting',\n\t'Student_Billing',\n\t'Food_Service',\n\t'Resources',\n\t'Custom',\n];\n\n$RosarioModules = unserialize( Config( 'MODULES' ) );\n\n$non_core_modules = array_diff_key( $RosarioModules, array_flip( $RosarioCoreModules ) );\n\n_LoadAddons( $non_core_modules, 'modules/' );\n\n/**\n * Plugins\n *\n * Core plugins (packaged with RosarioSIS): cannot be deleted.\n */\n$RosarioCorePlugins = [\n\t'Moodle',\n];\n\n$RosarioPlugins = unserialize( Config( 'PLUGINS' ) );\n\n_LoadAddons( $RosarioPlugins, 'plugins/' );\n\n/**\n * Load not core modules & plugins\n * (functions & locale)\n * Deactivate if does not exist\n *\n * Local function\n *\n * @param  array  $addons Non core addons (Plugins or Modules).\n * @param  string $folder Plugin or Module folder.\n * @return void\n */\nfunction _LoadAddons( $addons, $folder )\n{\n\tglobal $RosarioModules,\n\t\t$RosarioPlugins;\n\n\t/**\n\t * Check if non core activated modules exist.\n\t * Load locale.\n\t * Load functions (optional).\n\t */\n\n\tforeach ( (array) $addons as $addon => $activated )\n\t{\n\t\tif ( ! $activated )\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tif ( $folder === 'modules/'\n\t\t\t&& ! file_exists( $folder . $addon . '/Menu.php' ) )\n\t\t{\n\t\t\t// If module does not exist, deactivate it.\n\t\t\t$RosarioModules[$addon] = false;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\t$addon_functions = $folder . $addon . '/functions.php';\n\n\t\tif ( file_exists( $addon_functions ) )\n\t\t{\n\t\t\trequire_once $addon_functions;\n\t\t}\n\t\telseif ( $folder === 'plugins/' )\n\t\t{\n\t\t\t// If plugin does not exist, deactivate it.\n\t\t\t$RosarioPlugins[$addon] = false;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Load addon locale.\n\t\t$locale_path = $folder . $addon . '/locale';\n\n\t\tif ( ! is_dir( $locale_path ) )\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Binds the messages domain to the locale folder.\n\t\tbindtextdomain( $addon, $locale_path );\n\n\t\t// Ensures text returned is utf-8, quite often this is iso-8859-1 by default.\n\t\tbind_textdomain_codeset( $addon, 'UTF-8' );\n\t}\n}\n\n/**\n * Output HTML header (including Bottom & Side menus), or footer\n *\n * @example  Warehouse( 'header' );\n *\n * @since 3.8 Warehouse header head hook\n * @since 3.8 Warehouse footer hook\n * @since 4.4 Warehouse header hook\n * @since 6.0 Warehouse Header Javascripts\n *\n * @global $_ROSARIO  Uses $_ROSARIO['ProgramLoaded'] & $_ROSARIO['page']\n *\n * @uses isPopup()\n * @uses isAJAX()\n * @uses ETagCache()\n *\n * @param string $mode 'header' or 'footer'.\n */\nfunction Warehouse( $mode )\n{\n\tglobal $_ROSARIO;\n\n\tif ( isset( $_REQUEST['_ROSARIO_PDF'] ) )\n\t{\n\t\tif ( $mode === 'header' )\n\t\t{\n\t\t\t// Start buffer.\n\t\t\tob_start();\n\t\t}\n\n\t\t// Printing PDF, skip, see PDF.fnc.php.\n\n\t\treturn;\n\t}\n\n\tswitch ( $mode )\n\t{\n\t\t// Header HTML.\n\t\tcase 'header':\n\t\t\tETagCache( 'start' );\n\n\t\t\tif ( isAJAX() )\n\t\t\t{\n\t\t\t\t// If jQuery not available, log out.\n\n\t\t\t\tif ( $_ROSARIO['page'] === 'modules' ): ?>\n<script>if (!window.$) window.location.href = 'index.php?modfunc=logout&token=' + <?php echo json_encode( $_SESSION['token'] ); ?>;</script>\n\t\t\t\t<?php endif;\n\n\t\t\t\t// AJAX: we only need to generate #body content.\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t$lang_2_chars = mb_substr( $_SESSION['locale'], 0, 2 );\n\n\t\t\t// Right to left direction.\n\t\t\t$RTL_languages = [ 'ar', 'he', 'dv', 'fa', 'ur' ];\n\n\t\t\t$dir_RTL = in_array( $lang_2_chars, $RTL_languages ) ? ' dir=\"RTL\"' : '';\n\t\t\t?>\n<!doctype html>\n<html lang=\"<?php echo $lang_2_chars; ?>\"<?php echo $dir_RTL; ?>>\n<head>\n\t<meta charset=\"UTF-8\" />\n\t<meta name=\"viewport\" content=\"width=device-width\" />\n\t<title><?php echo ParseMLField( Config( 'TITLE' ) ); ?></title>\n\t<link rel=\"icon\" href=\"favicon.ico\" sizes=\"32x32\" />\n\t<link rel=\"icon\" href=\"apple-touch-icon.png\" sizes=\"128x128\" />\n\t<meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\n\t<meta name=\"mobile-web-app-capable\" content=\"yes\" />\n\t<link rel=\"stylesheet\" href=\"assets/themes/<?php echo Preferences( 'THEME' ); ?>/stylesheet.css?v=<?php echo ROSARIO_VERSION; ?>\" />\n\t<style>.highlight,.highlight-hover:hover{background-color:<?php echo Preferences( 'HIGHLIGHT' ); ?> !important;}</style>\n\t<?php\n\n\t\t\tif ( $_ROSARIO['page'] === 'modules'\n\t\t\t\t|| $_ROSARIO['page'] === 'first-login'\n\t\t\t\t|| $_ROSARIO['page'] === 'create-account'\n\t\t\t\t|| $_ROSARIO['page'] === 'password-reset' )\n\t\t\t{\n\t\t\t\t// @since 6.0 Warehouse Header Javascripts.\n\t\t\t\tWarehouseHeaderJS();\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Hook.\n\t\t\t *\n\t\t\t * Add your extra module/plugin JS and/or CSS (dependencies) to HTML head here.\n\t\t\t *\n\t\t\t * @since 3.8\n\t\t\t *\n\t\t\t * @since 4.5.1 Move Header head action hook outisde page condition.\n\t\t\t */\n\t\t\tdo_action( 'Warehouse.php|header_head' );\n\t\t?>\n\t<noscript>\n\t\t<meta http-equiv=\"REFRESH\" content=\"0;url=<?php echo URLEscape( 'index.php?modfunc=logout&amp;reason=javascript&amp;token=' . $_SESSION['token'] ); ?>\" />\n\t</noscript>\n</head>\n<body class=\"<?php echo AttrEscape( $_ROSARIO['page'] ); ?>\">\n<?php\n\t\t\tif ( $_ROSARIO['page'] === 'modules' ):\n\t\t\t\t// If popup window, verify it is an actual popup.\n\t\t\t\tif ( isPopup() ):\n\t\t\t\t?>\n\t\t\t\t<script>if(window == top  && (!window.opener)) window.location.href = \"Modules.php?modname=misc/Portal.php\";</script>\n\t\t\t\t\t<?php // @since 10.0 Close popup if no UserSchool in session, happens on login redirect.\n\t\t\t\t\tif ( ! UserSchool() ) : ?>\n\t\t\t\t\t<script>window.close();</script>\n\t\t\t\t\t<?php endif;\n\t\t\t\telse: ?>\n<div id=\"wrap\">\n\t<footer id=\"footer\" class=\"mod\">\n\t\t<?php require_once 'Bottom.php'; // Include Bottom menu. ?>\n\t</footer>\n\t<aside id=\"menu\" class=\"mod\">\n\t\t<?php require_once 'Side.php'; // Include Side menu. ?>\n\t</aside>\n\n<?php\n\t\t\t\tendif;\n\t\t\tendif;\n\n\t\t\t?>\n\t<div id=\"body\" tabindex=\"0\" role=\"main\" class=\"mod\">\n<?php\n\t\t\t/**\n\t\t\t * Hook.\n\t\t\t *\n\t\t\t * Add your extra module/plugin HTML to body here.\n\t\t\t *\n\t\t\t * @since 4.4\n\t\t\t */\n\t\t\tdo_action( 'Warehouse.php|header' );\n\n\t\tbreak;\n\n\t\t// Footer HTML.\n\t\tcase 'footer':\n\t\t\t?>\n<br />\n<?php\n\n\t\t\tif ( isset( $_ROSARIO['page'] )\n\t\t\t\t&& $_ROSARIO['page'] === 'modules' ): ?>\n<script>\n\tvar modname = \"<?php echo issetVal( $_ROSARIO['ProgramLoaded'], '' ); ?>\";\n\tif (typeof menuStudentID !== 'undefined'\n\t\t&& (menuStudentID != \"<?php echo UserStudentID(); ?>\"\n\t\t\t|| menuStaffID != \"<?php echo UserStaffID(); ?>\"\n\t\t\t|| menuSchool != \"<?php echo UserSchool(); ?>\"\n\t\t\t|| menuMP != \"<?php echo UserMP(); ?>\"\n\t\t\t|| menuCoursePeriod != \"<?php echo UserCoursePeriod(); ?>\")) {\n\t\tajaxLink( 'Side.php?sidefunc=update' );\n\t}\n</script>\n<?php\n\t\t\t/**\n\t\t\t * Hook.\n\t\t\t *\n\t\t\t * Add your extra module/plugin JS (dependencies) to HTML footer here.\n\t\t\t *\n\t\t\t * @since 3.8\n\t\t\t * @since 4.4 Hook always runs (no conditions).\n\t\t\t */\n\t\t\tdo_action( 'Warehouse.php|footer' );\n\n\t\t\t// If not AJAX request.\n\t\t\tif ( ! isAJAX() ):\n\t\t\t?>\n\t</div><!-- #body -->\n\t<div class=\"ajax-error\"></div>\n<?php\n\n\t\t\t\tif ( ! isPopup() ):\n\t\t\t\t?>\n\t</div><!-- #wrap -->\n\t\t\t\t<?php endif;\n\n\t\t\t?>\n</body></html>\n\t\t\t<?php endif;\n\n\t\t\tif ( ! isPopup() ):\n\n\t\t\t\t// require_once 'ProgramFunctions/Help.fnc.php';\n\n\t\t\t\t// Check if module has help (not default).\n\t\t\t\t//$has_help_text = GetHelpTextRaw( $_REQUEST['modname'] );\n\n\t\t\t\t/*if ( $has_help_text )\n\t\t\t\t{\n\t\t\t\t\tvar_dump($_REQUEST['modname']);\n\t\t\t\t\techo 'Has Help!!!';\n\t\t\t\t}*/\n\n\t\t\tendif;\n\n\t\t\telseif ( ! isAJAX() ): // Other pages (not modules).\n\n\t\t\t\t?>\n\t\t</div><!-- #body -->\n\t</body></html>\n\t\t\t<?php endif;\n\n\t\t\tETagCache( 'stop' );\n\n\t\t\tbreak;\n\t}\n\n\t// End switch.\n}\n\n/**\n * Warehouse Header Javascripts\n * Loads jQuery, plugins, warehouse & calendar lang JS.\n * Loads theme's scripts.js file if any found.\n *\n * @since 6.0\n * @since 7.6 JS remove warehouse.min.js & include warehouse.js inside plugins.min.js\n */\nfunction WarehouseHeaderJS()\n{\n\t$lang_2_chars = mb_substr( $_SESSION['locale'], 0, 2 );\n\n\t?>\n\t<script src=\"assets/js/jquery.js?v=2.2.4\"></script>\n\t<script src=\"assets/js/plugins.min.js?v=<?php echo ROSARIO_VERSION; ?>\"></script>\n\t<script src=\"assets/js/jscalendar/lang/calendar-<?php echo file_exists( 'assets/js/jscalendar/lang/calendar-' . $lang_2_chars . '.js' ) ? $lang_2_chars : 'en'; ?>.js\"></script>\n\t<?php\n\t// Add scripts.js file from theme if any found.\n\tif ( file_exists( 'assets/themes/' . Preferences( 'THEME' ) . '/scripts.js' ) ): ?>\n\t\t<script src=\"assets/themes/<?php echo Preferences( 'THEME' ); ?>/scripts.js\"></script>\n\t<?php endif;\n}\n\n/**\n * Popup window detection\n *\n * @todo deprecate & Remove popup, use soft popup with featherlight or https://victordiego.com/lightbox/.\n *\n * Set it once in Modules.php:\n * @example isPopup( $modname, $_REQUEST['modfunc'] );\n * Later call it:\n * @example if ( isPopup() )\n * @link http://www.securiteam.com/securitynews/6S02U1P6BI.html\n *\n * @param  string  $modname Mod name. Optional, defaults to ''.\n * @param  string  $modfunc Mod function. Optional, defaults to ''.\n * @return boolean True if popup, else false\n */\nfunction isPopup( $modname = '', $modfunc = '' )\n{\n\tstatic $is_popup = null;\n\n\tif ( ! is_null( $is_popup ) )\n\t{\n\t\treturn $is_popup;\n\t}\n\n\t$is_popup = false;\n\n\tif ( ! $modname )\n\t{\n\t\treturn $is_popup;\n\t}\n\n\t/**\n\t * Popup window detection.\n\t *\n\t * FJ security fix, cf http://www.securiteam.com/securitynews/6S02U1P6BI.html\n\t */\n\n\tif ( in_array(\n\t\t$modname,\n\t\t[\n\t\t\t'misc/ChooseRequest.php',\n\t\t\t'misc/ChooseCourse.php',\n\t\t\t'misc/ViewContact.php',\n\t\t]\n\t)\n\t\t|| ( $modname === 'School_Setup/Calendar.php'\n\t\t\t&& $modfunc === 'detail' )\n\t\t|| ( in_array(\n\t\t\t$modname,\n\t\t\t[\n\t\t\t\t'Scheduling/MassDrops.php',\n\t\t\t\t'Scheduling/Schedule.php',\n\t\t\t\t'Scheduling/MassSchedule.php',\n\t\t\t\t'Scheduling/MassRequests.php',\n\t\t\t\t'Scheduling/Courses.php',\n\t\t\t]\n\t\t)\n\t\t\t&& $modfunc === 'choose_course' ) )\n\t{\n\t\t$is_popup = true;\n\t}\n\n\treturn $is_popup;\n}\n\n/**\n * AJAX request detection\n *\n * @example if ( isAJAX() )\n * @since 3.0.1\n *\n * @return boolean True if is AJAX, else false\n */\nfunction isAJAX()\n{\n\tstatic $is_ajax = null;\n\n\tif ( ! is_null( $is_ajax ) )\n\t{\n\t\treturn $is_ajax;\n\t}\n\n\t$is_ajax = isset( $_SERVER['HTTP_X_REQUESTED_WITH'] )\n\t\t&& $_SERVER['HTTP_X_REQUESTED_WITH'] === 'XMLHttpRequest';\n\n\treturn $is_ajax;\n}\n\n/**\n * ETag cache system.\n * Start buffer, or stop buffer\n * and calculate ETag:\n * If ETag === If-None-Match, then send 403\n * Else send content (buffer) + ETag.\n * If no mode is set, will only check if $ETagCache activated.\n *\n * @global $ETagCache ETag cache system.\n * @since  3.1\n *\n * @param  string  $mode Mode: start|stop. Optional, defaults to ''.\n * @return boolean True if ETagCache activated, else false.\n */\nfunction ETagCache( $mode = '' )\n{\n\tglobal $ETagCache;\n\n\tstatic $ob_started = false;\n\n\tif ( ! $ETagCache )\n\t{\n\t\treturn false;\n\t}\n\n\tif ( $mode === 'start'\n\t\t&& ! $ob_started )\n\t{\n\t\t// Start buffer (to generate ETag).\n\t\t$ob_started = ob_start();\n\t}\n\telseif ( $mode === 'stop'\n\t\t&& $ob_started )\n\t{\n\t\t// Stop & get buffer buffer (to generate ETag).\n\t\t$etag_buffer = ob_get_clean();\n\n\t\t/**\n\t\t * Generate ETag\n\t\t * Weak ETag (\"W/\").\n\t\t *\n\t\t * @link https://en.wikipedia.org/wiki/HTTP_ETag\n\t\t */\n\t\t$etag = 'W/' . md5( $etag_buffer );\n\n\t\t// If-None-Match header sent by client.\n\n\t\tif ( isset( $_SERVER['HTTP_IF_NONE_MATCH'] )\n\t\t\t&& $_SERVER['HTTP_IF_NONE_MATCH'] === $etag )\n\t\t{\n\t\t\theader( \"Cache-Control: private, must-revalidate\" );\n\n\t\t\t// Page cached: send 304 + empty content.\n\t\t\theader( $_SERVER['SERVER_PROTOCOL'] . ' 304 Not Modified' );\n\n\t\t\texit;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// FJ fix headers already sent error when program outputs buffer.\n\n\t\t\tif ( ! headers_sent() )\n\t\t\t{\n\t\t\t\theader( \"Cache-Control: private, must-revalidate\" );\n\n\t\t\t\t// Send ETag + content (buffer).\n\t\t\t\theader( 'ETag: ' . $etag );\n\t\t\t}\n\n\t\t\techo $etag_buffer;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n\n/**\n * Null coalesce.\n * Useful to prevent PHP undefined index / variable notices.\n * Equivalent to:\n * `isset( $var ) ? $var : null`\n *\n * @example $extra['SELECT'] = issetVal( $extra['SELECT'], '' );\n *\n * @since 5.0\n *\n * @todo Migrate to PHP7 ?? operator.\n * @link https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.null-coalesce-op\n *\n * @param  mixed &$var    Variable.\n * @param  mixed $default Default value if undefined. Defaults to null.\n * @return mixed Variable or default.\n */\nfunction issetVal( &$var, $default = null )\n{\n\treturn ( isset( $var ) ) ? $var : $default;\n}\n"], "filenames": ["CHANGES.md", "Warehouse.php"], "buggy_code_start_loc": [96, 286], "buggy_code_end_loc": [96, 286], "fixing_code_start_loc": [97, 287], "fixing_code_end_loc": [98, 331], "type": "CWE-130", "message": "Improper Handling of Length Parameter Inconsistency in GitHub repository francoisjacquet/rosariosis prior to 10.0.", "other": {"cve": {"id": "CVE-2022-2714", "sourceIdentifier": "security@huntr.dev", "published": "2022-09-06T11:15:08.100", "lastModified": "2022-09-13T14:06:09.687", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Improper Handling of Length Parameter Inconsistency in GitHub repository francoisjacquet/rosariosis prior to 10.0."}, {"lang": "es", "value": "Un Manejo Inapropiado de la Inconsistencia de los Par\u00e1metros de Longitud en el repositorio de GitHub francoisjacquet/rosariosis versiones anteriores a 10.0.\n"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.1, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.2}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-130"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:rosariosis:rosariosis:*:*:*:*:*:*:*:*", "versionEndExcluding": "10.1", "matchCriteriaId": "84404F6F-C3AE-4EA9-A0A9-31032FB3722A"}]}]}], "references": [{"url": "https://github.com/francoisjacquet/rosariosis/commit/4022954c3f41462bf6225c302a28b0429f6f4df3", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/430aedac-c7d9-4acb-9bab-bcc0595d9e95", "source": "security@huntr.dev", "tags": ["Permissions Required"]}]}, "github_commit_url": "https://github.com/francoisjacquet/rosariosis/commit/4022954c3f41462bf6225c302a28b0429f6f4df3"}}