{"buggy_code": ["*******************************************************************************\nVersion 1.12.2\n*******************************************************************************\n\n*******************************************************************************\nVersion 1.12.1\n*******************************************************************************\n\n2020-04-03 Rene Nielsen <rene.nielsen(at)microchip.com>\n\n\tsetsockopt(IP_MULTICAST_IF) fails on 64-bit CPUs\n\n2020-04-03 Rosen Penev <rosenp(at)gmail.com>\n\n\tGitHub PR #164\n\n\tDo not use usleep when using newer POSIX C source.\n    \n    \tusleep is deprecated and is optionally unavailable with uClibc-ng.\n\n2020-03-29 pamapa <pamapa(at)github>\n\n\tGitHub PR #162\n\n\tAdd Os/UserAgent information to UpnpActionRequest and UpnpFileInfo\n\n2020-03-28 pamapa <pamapa(at)github>\n\n\tGitHub PR #161\n\n\tAdd CtrlPtIPAddr to UpnpFileInfo class\n\n2020-01-27 Ian Whyman <v00d00(at)github>\n\n\tGitHub PR #160\n\n\tList: Add extern C for C++ users\n\n*******************************************************************************\nVersion 1.12.0\n*******************************************************************************\n\n2020-01-22 Stephen Bash <scbash(at)github>\n\n    Reduce spurious HTTP 416 errors due to ill-defined bytes header\n    \n    I (re)discovered this behavior trying to use the Gerbera media server\n    with Chromecast (built in to my Vizio P55-F1 TV).  Chromecast specifies\n    \"bytes:0-\" with no end range, which caused pupnp to return\n    RANGE_NOT_SATISFIABLE.  Jin, the author of MediaTomb, of which Gerbera\n    is a continuation, fixed this in 2007 in MediaTomb's fork of pupnp, see\n    gerbera@ccd7994d45 \"made sure that range requests specified as\n    \"bytes=0-\" do not trigger...\", but never passed the fix upstream.  When\n    restarted as Gerbera, pupnp was removed from the local tree in favor of\n    using the upstream version, and the patch was lost which lead to me\n    rediscovering it recently.\n    \n    This is Jin's original patch applied to pupnp 1.8.  This teaches punp to\n    ignore the bytes header if it matches \"0-\" and return HTTP_OK.\n\n2020-01-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tGitHub issue #157\n\n\tWhen building v1.8.6 (on GNU/Linux) with --disable-device, pupnp doesn't build:\n\t/bin/bash ../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I. -I.. -I../upnp/inc  -I./inc -I../ixml/inc  -DNDEBUG -I./src/inc -I./src/threadutil -I/foo/contrib/x86_64-linux-gnu/include -fPIC  -pthread  -I/foo/contrib/x86_64-linux-gnu/include -DNDEBUG=1 -O3  -DUPNP_STATIC_LIB -Os -Wall -c -o src/genlib/util/libupnp_la-util.lo `test -f 'src/genlib/util/util.c' || echo './'`src/genlib/util/util.c\n\tIn file included from src/genlib/miniserver/miniserver.c:58:0:\n\t./src/inc/upnpapi.h:208:2: error: unknown type name 'service_info'\n  \tservice_info **serv_info\n  \t^~~~~~~~~~~~\n\n\tThis patch fixes compilation for the --disable-device case.\n\t\n\n2019-11-20 ePirat Marvin Scholz <epirat07(at)gmail.com>\n\n        GitHub PRs:\n        #150: Remove unused files\n        #149: UpnpEnableWebserver: Error correctly when web server compiled-out\n        #148: CI: Remove .travis.yml\n        #147: Remove TRUE/FALSE defines and BOOL typedef\n        #146: CI: Add address sanitizer and leak sanitizer enabled test run\n        #145: Add list test\n        #144: Add -Wextra and -Wpedantic to get more warnings\n        #143: More warning fixes\n        #142: Doxygen changes\n        #141: Remove unused headers\n        #140: Remove IN, OUT and INOUT defines\n        #139: Remove unused defines in uri.h\n        #138: Use stdbool.h instead of BOOL typedef and defines\n        #137: Various compiler warning fixes\n        #136: configure.ac: Fix Windows detection\n        #135: configure.ac: Enable silent rules\n        #134: LinkedList: Simplify _WIN32 check\n        #133: Remove checks of __OSX__ define\n        #132: Add Github Actions based CI\n\n2019-12-03 Jean-Francois Dockes <jf(at)dockes.org>\n\n        Github PR #130: Add forgotten Windows dll export qualifiers\n\n2019-12-01 Jean-Francois Dockes <jf(at)dockes.org>\n\n        Github PR #129: Remove and replace the list.h file\n\n2019-11-20 ePirat Marvin Scholz <epirat07(at)gmail.com>\n\n\tGithub PRs:\n\n\t#128: Overhaul list.h to fix various issues\n\t#127: Use rand_s in get_random_info on Windows\n\t#126: Do not redeclare timezone struct if already defined in Mingw\n\t#125: Fix interface filtering for Windows\n\t- The mentioned fix is not only needed for MSVC, but when\n\tcross-compiling for Windows with mingw-w64 too.\n\t#124: config.h: Remove DEBUG_TARGET\n\t- The DEBUG_TARGET is no longer used, it was previously used in\n\tupnpdebug.c to disable logging to a file, which now is done\n\tby just not calling UpnpSetLogFileNames.\n\t#123: Check for -lpthread too\n\t- Updates pthread m4 check from upstream\n\n*******************************************************************************\nVersion 1.10.1\n*******************************************************************************\n\n2019-11-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tForward port of Karlchen's github #122\n\tFix format string for ExtraHeaders\n\n*******************************************************************************\nVersion 1.10.0\n*******************************************************************************\n\n2019-07-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix sed command for upnppatch in configure.ac\n\n2019-04-03 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tProper allocation for an array of structs and a check for an unlikely\n\toverflow when calling the SIOCGIFCONF ioctl().\n\n\tIt still bugs me the stack requirements of getlocalhostname() and\n\tUpnpGetIfInfo().\n\n*******************************************************************************\nVersion 1.8.6\n*******************************************************************************\n\n2019-11-20 KarlStraussberger (Karlchen@github)\n\n\tFix format string for ExtraHeaders #122\n\n*******************************************************************************\nVersion 1.8.5\n*******************************************************************************\n\n2019-07-18 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFixed a wrong ifdef in ssdp_device.c that was causing problems with\n\tipv6. Thanks to BraneDev @ Github\n\n*******************************************************************************\nVersion 1.8.4\n*******************************************************************************\n\n2017-11-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tGitHub #57 - 1.8.3 broke ABI without changing SONAME\n\tOpened by jcowgill\n\n\tThis change in 1.8.3 broke the ABI and therefore the SONAME should have\n\tbeen changed (ie: age reset to 0):\n\n\tEXPORT_SPEC int UpnpAddVirtualDir(\n\t        /*! [in] The name of the new directory mapping to add. */\n\t-       const char *dirName);\n\t+       const char *dirName,\n\t+       /*! [in] The cookie to associated with this virtual directory */\n\t+       const void *cookie,\n\t+       /*! [out] The cookie previously associated, if mapping is already present */\n\t+       const void **oldcookie);\n\n\tIf only the cookie argument was added, you could probably get away with\n\tthis because all that would happen is that a garbage value is passed\n\taround without being used. With the addition of oldcookie, any old\n\tprograms will not initialise this value and will probably segfault when\n\tlibupnp tries to write to it.\n\n*******************************************************************************\nVersion 1.8.3\n*******************************************************************************\n\n2017-09-07 Dave Overton <david(at)insomniavisions.com>\n\n\tAdd userdata/cookie to virtualDir callbacks\n\n\tAs with the main Device APIs (UpnpRegisterRootDevice etc), it is useful\n\tto have a userdata/cookie pointer returned with each callback.\n\n\tThis patch allows one cookie per registered path which enables a variety\n\tof functionality in client apps.\n\n2017-09-03 Uwe Kleine-K\u00f6nig <uwe@kleine-koenig.org>\n\n\tFix large file system support\n\n\tlibupnp uses large file support (if available). If a program linking to\n\tlibupnp does not however it creates mismatches in callframes. See\n\tIssue #51 for the results.\n\n\tThis simplifies LFS support by using AC_SYS_LARGEFILE_SENSITIVE instead of\n\tmanually defining _LARGE_FILE_SOURCE and _FILE_OFFSET_BITS (which is\n\tuseless on architectures where the size of off_t is fixed).\n\n\tFurthermore additional logic is introduced to catch a library user without\n\t64 bit wide off_t on such a platform.\n\n\tupnp.h also makes use of off_t, but as this file includes FileInfo.h, the\n\tlatter is the single right place for this check.\n\n\tThis fixes #52 which is a generalized variant of #51.\n\n2017-08-19 Uwe Kleine-K\u00f6nig <uwe@kleine-koenig.org>\n\n\tconfigure.ac: Drop copying of include files\n\n\tThe comment suggests this is for windows compilation. It should be easily\n\tpossible to add the source directory as an include path to the windows\n\tcompiler, too, so drop this. (Otherwise this should better be done using\n\tAC_CONFIG_COMMANDS.)\n\n2017-09-03 Uwe Kleine-K\u00f6nig <uwe@kleine-koenig.org>\n\n\tLet source code use autoconfig.h not the public upnpconfig.h\n\n\tThe former is the one supposed to be used for internal code. upnpconfig.h is only\n\tfor public stuff.\n\n2017-08-19 Uwe Kleine-K\u00f6nig <uwe@kleine-koenig.org>\n\n\tconfigure.ac: Fix typo s/optionnal/optional/\n\n2017-08-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix broken samples when configured with --disable-ipv6.\n\n*******************************************************************************\nVersion 1.8.2\n*******************************************************************************\n\n2017-07-24 Michael Osipov\n\n\tInitialize in_addr and in6_addr to avoid garbage output if never written\n\n\tIf any of the address families isn't available in UpnpGetIfInfo(),\n\tespecially IPv6, always init both structs with zero to avoid garbage\n\toutput with inet_ntop() to gIF_IPV4 and gIF_IPV6.\n\n\tSee v00d00/gerbera#112 (https://github.com/v00d00/gerbera/issues/112)\n\tfor consequences: bind for IPv6 will fail.\n\n2013-10-28 Vladimir Fedoseev <va-dos(at)users.sourceforge.net>\n\n\tAttached patch allows to register multiple clients from single app.\n\n2014-11-14 Philippe <philippe44ca(at)users.sourceforge.net>\n\n\tHi - I recently compiled libupnp on C++ Builder XE7 and had to do a few\n\tchanges to make it work. In thase this helps, I've generated a small\n\tpatch file.\n\n2015-04-30 Hugo Beauz\u00e9e-Luyssen <chouquette(at)users.sourceforge.net>\n\n\tWhen building using a strict mode (-std=c++11 instead of -std=gnu++11,\n\tfor instance), the WIN32 macro isn't defined. The attached patch fixes\n\tit by using _WIN32 instead.\n\n2015-02-06 Jean-Francois Dockes <jf@dockes.org>\n\n\tQueue events on their subscription object instead of adding them to the\n\tthread pool immediately. \n\n\tEvents destined for a non-responding control point would flood the\n\tthread pool and prevent correct dispatching to other clients, sometimes\n\tto the point of disabling the device. Events are now queued without\n\tallocating thread resources and properly discarded when a client is not\n\taccepting them.\n\n2015-02-03 Jean-Francois Dockes <jf@dockes.org>\n\n\tgenaInitNotify()/genaInitNotifyExt() and\n\tgenaNotifyAll()/genaNotifyAllExt() are relatively complicated methods\n\twhich only differ by the format of an input parameter. This update\n\textracts the common code for easier maintenance, esp. relating to the\n\tqueueing modifications to follow.\n\n\n*******************************************************************************\nVersion 1.8.1\n*******************************************************************************\n\n2017-04-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix some compiler warning messages on md5.c\n\n2017-03-07 Fabrice Fontaine <fontaine.fabrice(at)gmail.com>\n\n\tEnable IPv6 by default\n\n2017-03-07 Fabrice Fontaine <fontaine.fabrice(at)gmail.com>\n\n\tMove threadutil source code to libupnp\n\n\tWith this patch, threadutil library is removed as the only public\n\theader that has been kept in 1.8.x is ithread.h which is mainly a\n\twrapper to pthread with inline functions.\n\tthreadutil source code will now be a part of libupnp library.\n\n*******************************************************************************\nVersion 1.8.0\n*******************************************************************************\n\n2014-01-15 Peng <howtofly(at)gmail.com>\n\n\tFix memory leaks.\n\n2013-04-27 Thijs Schreijer <thijs(at)thijsschreijer.nl>\n\n\tRenamed SCRIPTSUPPORT to IXML_HAVE_SCRIPTSUPPORT for consistency. Also\n\tupdated autoconfig and automake files, so it also works on non-windows.\n\tOption is enabled by default, because it adds an element to the node\n\tstructure. Not using an available field is better than accidentally\n\tusing an unavailable field.\n\n2012-07-11 Thijs Schreijer <thijs(at)thijsschreijer.nl>\n\n\tChanged param to const UpnpAcceptSubscriptionExt() for consistency\n\n2012-06-07 Thijs Schreijer <thijs(at)thijsschreijer.nl>\n\n\tupdated ixmlDocument_createAttributeEx() and ixmlDocument_createAttribute()\n\tto use parameter DOMString instead of char * (same but now consistent)\n\n2012-05-06 Thijs Schreijer <thijs(at)thijsschreijer.nl>\n\n\tAdded script support (directive SCRIPTSUPPORT) for better support of\n\tgarbage collected script languages. The node element gets a custom tag\n\tthrough ixmlNode_setCTag() and ixmlNode_getCTag(). And a callback upon\n\treleasing the node resources can be set using ixmlSetBeforeFree()\n\tSee updated readme for usage.\n\n2012-03-24 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3510595 - UpnpDownloadXmlDoc : can't get the file\n\n\tSubmitted: Marco Virgulti ( mvirg83 ) - 2012-03-23 10:08:08 PDT\n\n\tThere is a problem, perhaps, during downloading a document by\n\tUpnpDownloadXmlDoc. During debugging i've found that in an not exported\n\tapi (unfortunately i forgot the code line...) where it is setted a\n\tlocal variable \"int timeout\" to -1 then passed directly to another\n\tfunction for sending data through tcp socket. I patched this setting it\n\tto 0 (there is an IF section that exits if timeout < 0). It is normal\n\tbehavior or it is a bug?\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tCheck for NULL pointer in TemplateSource.h\n\n\tcalloc can return NULL so check for NULL pointer in CLASS##_new and\n\tCLASS##_dup.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tReplace strcpy with strncpy in get_hoststr\n\n\tReplace strcpy with strncpy to avoid buffer overflow.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tMemory leak fix in handle_query_variable\n\n\tvariable was never freed.\n\n2011-02-07 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tAdd HTTPS support using OpenSSL. HTTPS support is optional and can\n\tbe enabled by passing the --enable-open-ssl argument to the\n\tconfigure script.\n\n\tThe following methods are introduced to the public API:\n\tUpnpInitOpenSslContext\n\n\tWhen enabled, HTTPS can be used by using \"https://\" instead of\n\t\"http://\" when passing URLs to the HTTP Client API.\n\n2011-02-07 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tRefactor HTTP Client API to be more generic.\n\n\tThe following features are added:\n\n\t- Support for persistent HTTP connections (reusing HTTP\n\t  connections). Tthis is still a work in progress and relies on\n\t  applications to interpret the 'Connection' header\n\t  appropriately.\n\n\t- Support for specifying request headers when making\n\t  requests. Useful for interacting with web services that require\n\t  custom headers.\n\n\t- Support for retrieving response headers (this is a API only\n\t  change, some more work needs to be done to implement the actual\n\t  functionality. Specifically copy_msg_headers in httpreadwrite.c\n\t  needs to be implemented)\n\n\t- Common API for all HTTP methods.\n\n\t- Support for PUT, and DELETE methods.\n\n\tThe following methods are introduced to the public HTTP Client API\n\n\tUpnpOpenHttpConnection, UpnpCloseHttpConnection, UpnpMakeHttpRequest,\n\tUpnpWriteHttpRequest, UpnpEndHttpRequest, UpnpGetHttpResponse,\n\tUpnpReadHttpResponse.\n\n\tRemoved a lot of duplicate code in httpreadwrite.c\n\n2011-01-17 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tInclude upnpconfig.h in FileInfo.h to automatically include large\n\tfile macros\n\n2011-01-17 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tFix for warnings Apple systems related to macros defined in list.h.\n\n\tIn list.h, in apple systems, undefine the macros prior to defining them.\n\n2011-01-16 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for UpnpFileInfo_get_LastModified() in http_MakeMessage().\n\n\tUpnpFileInfo_get_LastModified() returns time_t, and http_MakeMessage()\n\ttakes a \"time_t *\". Thanks to Chandra Penke for pointing the bug.\n\n2010-11-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tTemplate object for ssdp_ResultData.\n\n2010-11-10 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tSupport for \"polling\" select in sock_read_write.\n\n\tCurrently, in sock_read_write function, if the timeout is 0, pupnp\n\trealizes a \"blocking\" select (with an infinite timeout). With this\n\tpatch, if timeout is set to 0, pupnp will realize a \"polling\" select\n\tand returns immediately if it can not read or write on the socket. This\n\tis very useful for GENA notifications when pupnp is trying to send\n\tevents to a disconnected Control Point. \"Blocking\" select can now be\n\tdone by putting a negative timeout value.\n\n2010-09-18 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tThis is a minor build fix. The new Template*.h files added in the latest\n\tcode need to be exported. Patch against the latest sources is attached.\n\n2010-08-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* upnp/src/api/Discovery.c: Fix a serious bug and memory leak in\n\tUpnpDiscovery_strcpy_DeviceType(). Thanks to David Blanchet for the\n\tpatch.\n\n2010-04-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSeparation of the ClientSubscription object.\n\n2010-04-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tProtect the object destructors agains null pointers on deletion, which\n\tshould be something valid.\n\n2010-03-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSF Patch Tracker [ 2987390 ] upnp_debug vs. ixml_debug\n\tThanks for the load of updates, I'm still assimilating them ! Could I make\n\ta suggestion though? The addition of printNodes(IXML_Node) to upnpdebug a\n\tdds a new dependency on ixml.h for anything using upnpdebug.h. I'm making\n\tquite a bit of use of upnpdebug in porting things to version 1.8.0, and I'd\n\tprefer it if printNodes could be added to ixmldebug.h instead. I'm attach\n\ting a patch, what do you think ?\n\n\tNick\n\n2010-03-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Forward port of svn revision 505:\n\tSF Patch Tracker [ 2836704 ] Patch for Solaris10 compilation and usage.\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\n2010-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2969188 ] 1.8.0: patch for FreeBSD compilation\n\tSubmitted By: Nick Leverton (leveret)\n\tFix the order of header inclusion for FreeBSD.\n\n2010-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Forward port of svn revision 502:\n\tSF Patch Tracker [ 2836704 ] Search for nested serviceList (not\n\tstopping at the first lis\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\t\n\tInternet Gateway Device description contains nested serviceList (rootdevice\n\t-> servicelist, subdevice\n\tand subdevice has the lower-level serviceList, etc..)\n\n\tUnfrotunately, the sample code sample_util.c used by tv_device sample,\n\tetc.\n\thas a code that looks for only the first top-level serviceList.\n\tThis results in the failure to read all the services of an IGD xml\n\tdescription.\n\n\tAttached patch modifies this behavior and looks for the service by\n\tvisiting all the serviceList in xml document in turn.\n\n\tWith the modified patch (ad additional modification), I could\n\tsimulate an IGD device and created a modified control program for that.\n\n\tPatch against 1.6.6\n\n\tTIA.\n\n2010-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2973319 ] Problem in commit 499\n\tSubmitted By: Nick Leverton (leveret)\n\tAfraid that this doesn't compile, it seems retval should be retVal in two\n\tplaces.\n\n2010-03-16 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for the ithread_mutex_unlock() logic in UpnpInit().\n\tThanks for Nicholas Kraft.\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2962606 ] Autorenewal errors: invalid SID,\n\ttoo-short renewal interval\n\tSubmitted By: Nick Leverton (leveret)\n\t\n\tAuto-renewals send an invalid SID due to a missing UpnpString_get_String\n\tcall. They also send a renewal interval of 0 instead of copying it from\n\tthe original subscription.\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2964685 ] patch for avoiding inet_ntoa (1.8.0)\n\tSubmitted By: Nick Leverton (leveret)\n\t\n\tSeems like SF's tracker won't let me add a patch to someone else's issue ?!\n\tThis refers to https://sourceforge.net/support/tracker.php?aid=2724578\n\t\n\tThe calls to inet_ntoa are in getlocalhostname(), which is called from\n\tUpnpInit when it is returning the bound IP address. \n\tUpnpInit/getlocalhostname hasn't been updated to IPv6, I presume this is\n\tdeliberate so that it doesn't start returning IPv6 addresses and\n\toverwriting the caller's IPv4-sized allocation.\n\t\n\tThe attached patch just updates getlocalhostname to use inet_ntop instead\n\tof inet_ntoa, and also documents the fact that UpnpInit is IPv4 only whilst\n\tUpnpInnit2 is both IPv4 and IPv6.\n\t\n\tA fuller solution might be to change UpnpInit to use some variant on\n\tUpnpGetIfInfo. UpnpInit could still be left as IPv4 only if desired -\n\tperhaps UpnpGetIfInfo could take an option for the desired address family.\n\tgetlocalhostname and its own copy of the interface scanning code would then\n\tbe redundant. I don't have IPv6 capability here though so I'm reluctant to\n\tchange the IPv6 code, as I have no way to test it.\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2724578 ] patch for avoiding memory leaks when\n\tadd devices\n\t\n\teach time a device been added, UpnpInit() is called, on exit, UpnpFinish()\n\tis called, but the memories allocated by ThreadPoolInit() may lost because\n\tthere's no code to call ThreadPoolShutdown() to release the memories. And\n\tinet_ntoa() is not thread safe, so in my patch, I substitute inet_ntoa()\n\twith inet_ntop().\n\n2010-03-14 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2964687 ] Add new string based accessors to upnp\n\tobject API\n\n\tAs per email to pupnp-devel, this is the patch to add the _strget_\n\taccessors for string-like objects in the interface.\n\t\n\tWill add a further patch shortly to udpate the sample programs.\n\n2008-06-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Nicholas Kraft's patch to fix some IPv6 copy/paste issues. He\n\treported to be getting infinite loops with the svn code.\n\n2008-06-13 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1984541 ]\n\tixmlDocumenttoString does not render the namespace tag.\n\tSubmitted By: Beliveau - belivo\n\n\tUndoing the patch that fixed this problem. In fact, there was no\n\tproblem and the patch was wrong.\n\n2008-06-11 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Ingo Hofmann's patch for \"Content-Type in Subscription responses\".\n\tAdds charset=\"utf-8\" attribute to the CONTENT-TYPE header line.\n\n\tHi,\n\n\tI have found an inconsistency regarding the text/xml content-type\n\treturned by libupnp. It looks like only subscription responses send\n\t\"text/xml\" where all other messages contain \"text/xml; charset=\"utf-8\"\".\n\tSince I'm working on an DLNA device the latter behaviour is mandatory.\n\tI changed the according lines in gena_device.c (see attached patch).\n\tI'm not sure if it would be ok for other device to have the charset\n\tfield but it would help me a lot :)\n\n\tBest regards,\n\tIngo\n\n2008-06-04 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1984541 ]\n\tixmlDocumenttoString does not render the namespace tag.\n\tSubmitted By: Beliveau - belivo\n\n\tThe problem occurs when converting a xml document using\n\tixmlDocumenttoString containing a namespace tag created with\n\tixmlDocument_createElementNS. The namespace tag doesn't get rendered.\n\n\texample: The following code fragment prints:\n\n\t<?xml version=\"1.0\"?>\n\t<root></root>\n\n\tinstead of:\n\t<?xml version=\"1.0\"?>\n\t<root xmlns=\"urn:schemas-upnp-org:device-1-0\"></root>\n\t\n\tCode:\n\n\t#include <stdlib.h>\n\t#include <upnp/ixml.h>\n\n\tint main()\n\t{\n\t\tIXML_Document* wDoc = ixmlDocument_createDocument();\n\t\tIXML_Element* wRoot = ixmlDocument_createElementNS(wDoc,\n\t\t\t\"urn:schemas-upnp-org:device-1-0\", \"root\");\n\t\tixmlNode_appendChild((IXML_Node *)wDoc,(IXML_Node *)wRoot);\n\t\tDOMString wString = ixmlDocumenttoString(wDoc);\n\t\tprintf(wString);\n\t\tfree(wString);\n\t\tixmlDocument_free(wDoc);\n\t\t\n\t\treturn 0;\n\t}\n\n\tThe problem was in the printing routine, not in the library data\n\tstructure.\n\n2008-05-31 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Charles Nepveu's suggestion of not allocating a thread for\n\tMiniServer when it is not compiled.\n\n2008-05-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Ported Peter Hartley's patch to compile with mingw.\n\n2008-05-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added some debug capability to ixml.\n\n2008-05-02 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Merged Charles Nepveu's IPv6 work. libupnp now is IPv6 enabled.\n\n2008-02-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Breaking API so that we now hide internal data structures.\n\n2008-02-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Rewrote Peter Hartley's patch to include a new extra header field in\n\tFileInfo.\n\n*******************************************************************************\nVersion 1.6.22\n*******************************************************************************\n\n2017-07-07 James Cowgill <james410(at)cowgill.org.uk>\n\n\tReplace MD5 impmplementation with public-domain version\n\n\tCurrently the RSA MD5 implementation is used. Unfortunately the license\n\thas some potential issues:\n\t* The license does not explicitly allow distributing derivative works.\n\tThis was the original argument used in\n\t[Debian #459516](https://bugs.debian.org/459516).\n\t* The license contains an advertising clause similar to the BSD 4-clause\n\tlicense. This is incompatible with the GPL and if it were enforced,\n\twould require RSA to be mentioned by pretty much everyone who uses pupnp.\n\n\tThe simple solution is to replace it with a public domain\n\timplementation. I've taken OpenBSDs implementation and tweaked it\n\tslightly for use by pupnp by:\n\t- Adjusting the includes.\n\t- Removing the __bounded__ attributes which are specific to OpenBSD.\n\t- Using the standard integer types from stdint.h.\n\t- Using memset instead of explicit_bzero.\n\n2016-12-16 Peter Pramberger <peterpramb(at)users.sf.net>\n\n\tixml/test/test_document.c is missing the string.h include, therefore\n\tthe compiler complains about an implicit declaration.\n\n*******************************************************************************\nVersion 1.6.21\n*******************************************************************************\n\n2016-12-16 Gabriel Burca <gburca(at)github>\n\n\tIf the error or info log files can not be created, use stderr and\n\tstdout instead.\n\n2016-12-08 Uwe Kleine-K\u00f6nig <uwe(at)kleine-koenig.org>\n\n\tFix out-of-bound access in create_url_list() (CVE-2016-8863)\n\n\tIf there is an invalid URL in URLS->buf after a valid one, uri_parse is\n\tcalled with out pointing after the allocated memory. As uri_parse writes\n\tto *out before returning an error the loop in create_url_list must be\n\tstopped early to prevent an out-of-bound access\n\n\tBug: https://sourceforge.net/p/pupnp/bugs/133/\n\tBug-CVE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-8863\n\tBug-Debian: https://bugs.debian.org/842093\n\tBug-Redhat: https://bugzilla.redhat.com/show_bug.cgi?id=1388771\n\n2016-11-30 Uwe Kleine-K\u00f6nig <uwe(at)kleine-koenig.org>\n\n\tminiserver: fix binding to ipv6 link-local addresses\n\n\tLinux requires to have sin6_scope_id hold the interface id when binding to\n\tlink-local addresses. This is already in use in other parts of upnp, so\n\tportability shouldn't be in the way here. Without this bind(2) fails with\n\terrno=EINVAL (although ipv6(7) from manpages 4.08 specifies ENODEV in this\n\tcase).\n\n\tFixes: https://bugs.debian.org/813249\n\n2016-09-15 Mathew Garret <(at)mjg59 (twitter)>\n\n\tSF Bug Tracker #132 CVE-2016-6255: write files via POST\n\n\tSubmitted by: Balint Reczey in 2016-08-02\n\n\tFrom Debian's BTS https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=831857 :\n\tFrom: Salvatore Bonaccorso carnil@debian.org\n\tTo: Debian Bug Tracking System submit@bugs.debian.org\n\tSubject: libupnp: write files via POST\n\tDate: Wed, 20 Jul 2016 11:03:34 +0200\n\tSource: libupnp\n\tVersion: 1:1.6.17-1\n\tSeverity: grave\n\tTags: security upstream\n\tJustification: user security hole\n\tHi\n\tSee http://www.openwall.com/lists/oss-security/2016/07/18/13 and\n\thttps://twitter.com/mjg59/status/755062278513319936 .\n\tProposed fix:\n\thttps://github.com/mjg59/pupnp-code/commit/be0a01bdb83395d9f3a5ea09c1308a4f1a972cbd\n\tRegards,\n\tSalvatore\n\n\tFrom Mathew Garret's commit: Don't allow unhandled POSTs to write to the filesystem by default\n\n*******************************************************************************\nVersion 1.6.20\n*******************************************************************************\n\n2016-02-22 Jean-Francois Dockes <medoc(at)users.sf.net>\n\n\tSF Bugs #131, Creator: Jean-Francois Dockes\n\n\tI know it sounds crazy that nobody ever saw this, but the CONTENT-LENGTH\n\tvalue in GENA NOTIFY messages is too small by one.\n\n\tIt appears that most current control points don't notice the extra\n\tcharacter (an LF, which is validly there but not included in\n\tContent-Length), probably because their protocol handler is reasonably\n\tlenient, and because the missing body LF does not prevent parsing the\n\tXML. But there is a least one anal CP (Linn Kazoo) which barfs, because\n\tit reads all data until connection close and the size mismatch triggers\n\ta bug.\n\n\t\"Proof\":\n\tIn gena_device.c:217 (notify_send_and_recv())\n\n\tret_code = http_SendMessage(&info, &timeout,\n\t    \"bbb\",\n\t    start_msg.buf, start_msg.length,\n\t    propertySet, strlen(propertySet),\n\t    CRLF, strlen(CRLF));\n\n\tstart_msg has all the headers, including the empty line.\n\tContent-length should be strlen(propertySet) + strlen(CRLF) (2)\n\tIn gena_device.c:433 (AllocGenaHeaders())\n\n\trc = snprintf(headers, headers_size, \"%s%s%\"PRIzu\"%s%s%s\",\n\t    HEADER_LINE_1,\n\t    HEADER_LINE_2A,\n\t    strlen(propertySet) + 1,\n\t    HEADER_LINE_2B,\n\t    HEADER_LINE_3,\n\t    HEADER_LINE_4);\n\n\tHEADER_LINE_2A is \"CONTENT-LENGTH: \". \n\tThe following value should be strlen(propertySet) + 2\n\n2016-01-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for a reported integer overflow\n\n2016-01-07 Jean-Francois Dockes <medoc(at)users.sf.net>\n2016-01-07 Nick Leverton <nick(at)leverton.org>\n\tSF Patches #60, Creator: Jean-Francois Dockes\n\n\tWhen libupnp is configured with --enable-ipv6 but ipv6 is not available\n\ton the system (for example because the ipv6 code is not loaded in a Linux\n\tkernel as is the case by default on Raspbian), the ipv6 socket creation\n\tcall will fail in miniserver.c and the library init will fail, even if\n\tthe ipv4 initialisation would have succeeded.\n\n\tLet a library configured with --enable-ipv6 initialize in ipv4-only\n\tmode if ipv6 is not available instead of failing. This can happen\n\tif no ipv6 code is configured or loaded in the kernel.\n\n\tDon't fail if IPv6 is unavailable.\n\tWe might be an IPv6 enabled distro build running on an IPv4-only custom kernel.\n\n2016-01-07 Nick Leverton <nick(at)leverton.org>\n\n\tSF Bug Tracker #128, Creator: Nick Leverton\n\tredefining strndup causes \"error: expected identifier or '(' before '__extension__'\"\n\n\tFix redefinition of strnlen and strndup\n\tThese are available when HAVE_STRNDUP and HAVE_STRNLEN are defined, but\n\tlibupnp provides an extern prototype anyway.  Recent versions of glibc\n\tdefine this prototype differently, causing the following compile error:\n\n\tsrc/api/UpnpString.c:47:15: error: expected identifier or '(' before  '__extension__'\n\t\textern char *strndup(__const char *__string, size_t __n);\n\n2016-01-07 Nick Leverton <nick(at)leverton.org>\n\n\tSF Bug Tracker #129, Creator: Nick Leverton\n\tshutdown() on UDP sockets logs ENOTCONN message.\n\thttps://sourceforge.net/p/pupnp/bugs/129/\n\n\tFix ENOTCONN \"Error in shutdown: Transport endpoint is not connected\"\n\n\tWhen logging is enabled, ssdpserver logs bursts of\n\t\"Error in shutdown: Transport endpoint is not connected\"\n\tThis is because shutdown() is not supported for UDP sockets and under\n\trecent UNIX specifications it returns ENOTCONN if used.\n\t\n2016-01-07 Nick Leverton <nick(at)leverton.org>\n\n\tSF Bug Tracker #127, Creator: Klaus Fischer\n\tMiniserver uses INADDR_ANY instead of HostIP\n\thttps://sourceforge.net/p/pupnp/bugs/127/\n\n\tThe internal miniserver.c uses INADDR_ANY instead of the HostIP/IfName\n\tprovided when initializing libupnp. But, this HostIP/IfName gets used\n\tfor the UDP socket when multicasting SSDP messages.  Because of this,\n\tminiserver may end up sending from different IP address than ssdpserver.\n\tThis patch causes miniserver to use the already known interface address.\n\n2016-01-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker #130, Creator: Shaddy Baddah\n\tinfinite loop in UpnpGetIfInfo() under WIN32\n\n\tOriginal code makes no sense. This patch should fix it.\n\n2015-02-04 Shaun Marko <semarko@users.sf.net>\n\n\tBug tracker #124 Build fails with --enable-debug\n\n\tBuild environment\n\tFedora 21\n\tX86-64\n\t* gcc 4.9.2\n\n\tHow to repeat\n\t$ ./configure --enable debug\n\t$ make\n\tlibtool: compile: gcc -DHAVE_CONFIG_H -I. -I.. -I../upnp/inc -I./inc -I../threadutil/inc\n\t-I../ixml/inc -I./src/inc -pthread -g -O2 -Wall -MT src/api/libupnp_la-UpnpString.lo\n\t-MD -MP -MF src/api/.deps/libupnp_la-UpnpString.Tpo -c src/api/UpnpString.c\n\t-fPIC -DPIC -o src/api .libs/libupnp_la-UpnpString.o src/api/UpnpString.c:47:16:\n\terror: expected identifier or '(' before 'extension'\n\textern char *strndup(const char *string, size_t __n);\n\t^\n\tMakefile:1016: recipe for target 'src/api/libupnp_la-UpnpString.lo' failed\n\n\tReason for failure\n\tBuild enables -O2 optimization flags which causes the inclusion of a\n\tmacro implementation of strndup from include/bits/string2.h.\n\n\tWorkarounds\n\tDisable optimization when configuring or making:\n\t$ configure CFLAGS='-g -pthread -O0' --enable-debug\n\t$ make\n\tor\n\t$ configure --enable-debug\n\t$ make CFLAGS='-g -pthread -O0' Define NO_STRING_INLINES\n\t$ export CFLAGS=\"-DNO_STRING_INLINES -O2\"\n\t$ ./configure --enagble-debug\n\t$ make\n\n\tFix\n\t* Don't declare strndup in src/api/UpnpString.c if it exists\n\n2015-02-01 Jean-Francois Dockes <medoc@users.sf.net>\n\n\tOut-of-tree builds seem to be currently broken, because ixml and\n\tthreadutil files need an include path to include UpnpGlobal.h, and\n\tconfigure tries to copy files into a directory which it does not create.\n\tThe patch fixes both issues.\n\n2014-01-03 Peng <howtofly(at)gmail.com>\n\n\trewrite soap_device.c\n\n\t1) separate HTTP handling from SOAP handling\n\t2) remove repeated validity check, each check is performed exactly once\n\t3) fix HTTP status code per UPnP spec, SOAP spec and RFC 2774\n\n*******************************************************************************\nVersion 1.6.19\n*******************************************************************************\n\n2013-11-14 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker #119, Creator: Klaus Fischer\n\tAccess violation due to changed usage of pthreads-win32\n\n\tDear libupnp developers,\n\n\tI have experienced a crash (access violation) when using libupnp on\n\tWindows. The crash is actually located in pthreads-win32 and happens\n\twhen repeatedly de-/initializing libupnp on Win32 in the same process\n\tand both libupnp and pthreads-win32 are compiled as static libraries.\n\n\tSo I'm doing this:\n\t- UpnpInit()\n\t- UpnpFinish()\n\t- UpnpInit() <- Crash\n\n\tI am already in touch with Ross Johnson on the pthreads-win32 mailing\n\tlist regarding this issue:\n\n\thttp://sourceware.org/ml/pthreads-win32/2013/msg00020.html\n\n\tHe told me the problem is that the functions\n\tpthread_win32_process_attach/detach_np() should no longer be called\n\tdirectly, but are invoked automatically now since version 2.9.0 of\n\tpthreads-win32, which has been released approx. 1.5 years ago. Please\n\trefer to above link for in-depth information.\n\n\tSo for proper using of latest pthreads-win32 library, those function\n\tcalls should vanish inside libupnp. Could you consider adapting libupnp\n\tin that way? I would really like to use both libraries out-of-the-box\n\twithout local modifications, and this issue prevents that.\n\n\tBest regards,\n\tKlaus\n\n2013-11-08 Peng <howtofly(at)gmail.com>\n\n\tFix several minor bugs in soap_device.c\n\n\t1) remove redundant free\n\t2) avoid user-provided ErrStr being overwritten by the default one\n\t3) eliminated memory leak possiblity in handle_query_variable\n\n2013-11-08 Peng <howtofly(at)gmail.com>\n\n\tFix return value check of parse_uri.\n\n2012-06-19 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker #118, Creator: T.Iwamoto\n\ttv_ctrlpt crashes after detecting a later version of tvcontrol service\n\n\tFrom:  gon3456@users.sf.net\n\tSteps to reproduce:\n\t1. Extracts and build libupnp-1.6.18\n\t$ tar -xjf /path/to/archive/libupnp-1.6.18.tar.bz2\n\t$ cd libupnp-1.6.18\n\t$ ./configure\n\t$ make\n\t2. Applies the attached patch and remake.\n\t$ patch -p1 < /path/to/patch/libupnp-1.6.18.patch\n\t$ make\n\t3. Run tv_device.\n\t$ cd upnp/sample\n\t$ ./tv_device\n\t4. Run tv_ctrlpt; the tv_ctrlpt crashes soon.\n\t$ ./tv_ctrlpt\n\tSegmentation fault (core dumped)\n\tThis is an issue report about the sample program of control point.\n\tThe tv_ctrlpt crashes after detecting a tvdevice that contains tvcontrol:2 or higher version of tvcontrol service.\n\ttv_ctrlpt should detect correctly such devices due to forward compatibility of control points with device.\n\tFor more information about the compatibility, please refer the following document:\n\tDLNA Architectures and Protocols Part 1 2011 December - 7.3.2.1.3 (GUN:GZJXU)\n\tThe attached patch changes the sample programs as below:\n\t- device: changes version of tvcontrol service from 1 to 2. This change may occur in the future.\n\t- cp: nothing changed: cp knows version 1 of tvcontrol service only.\n\tI know many vendors implements their control points based on the tv_ctrlpt, so I hope to fix this issue ASAP.\n\n\t==\n\n\tFrom: Yoichi NAKAYAMA\n\tSEGV is caused by strcpy with NULL argument.\n\tAttached patch will avoid SEGV in strcpy, but there may be other inconsistencies.\n\n\t> I know many vendors implements their control points based on the tv_ctrlpt,\n\n\tI don't think so. I think tv_ctrlpt is just a sample to be used with tv_device.\n\n2013-10-28 Pino Toscano <pinotree(at)users.sourceforge.net>\n\n\tFix compilation on GNU/Hurd\n\n2013-10-28 Peng <howtofly(at)gmail.com>\n\n\tFix return value of http_RecvPostMessage and update httpparser.c's comments\n\n2013-10-17 Peng <howtofly(at)gmail.com>\n\n\tFix return value of process_request and related subroutines\n\t1) Only HTTP_XXX should be return\n\t2) Make default return value work for process_request\n\n2013-10-15 Peng <howtofly(at)gmail.com>\n\n\tFix Content-Range generation bug\n\n2013-09-10 zexian chen <chenzexian88(at)gmail.com>\n\n\tHi,\n\n\tI had found some bugs about memory leak on libupnp-1.6.18. \n\n\tIt may lead to memory leak  when calling ThreadPoolAdd() or\n\tThreadPoolAddPersistent() which does not return 0. \n\n\tSee the attachment for patch.\n\n2013-09-03 Peng <howtofly(at)gmail.com>\n\n\tFix return value of config_description_doc.\n\n\tUPNP_E_XXX should not be used instead of IXML_XXX\n\n2013-09-03 Peng <howtofly(at)gmail.com>\n\n\tRemove faulty free in GetDescDocumentAndURL.\n\n\ttemp_str, which points to part of description, should not be freed.\n\n2013-09-02 Peng <howtofly(at)gmail.com>\n\n\tSuppose the UPnP device is listening on 192.168.1.102:49152. Use the following to send\n\tgarbage bytes to the device:\n\twhile true; do echo \"\\\"\"; done | netcat 192.168.1.102 49152\n\n\tThe device just keeps receiving these bytes and its memory usage keeps growing.\n\tMalicious client may exploit it to exhaust the device's memory.\n\n\tThe attached patch eliminates this possibility.\n\n2013-09-02 Peng <howtofly(at)gmail.com>\n\n\t1) restore the scanner's original cursor position in case of\n\t   insufficient input;\n\t2) free the memories allocated for a new header in case of a failure.\n\n2013-08-13 Peng <howtofly(at)gmail.com>\n\n\tPatch to fix behaviou when char is signed\n\n\tit seems to me that there is still something wrong:\n\n\t1)  the new is_qdtext_char() is incorrect.\n\tThere is a trap if char is implemented as signed char.\n\tSuppose that c is '\\xFF', it will be -1 when converted to an int.\n\tBy definition, c should be qdtext:\n\tqdtext = <any TEXT except <\">>\n\tTEXT = <any OCTET except CTLs, but including LWS>\n\tOCTET = <any 8-bit sequence of data>\n\n\t2) the character after '\\\\' could be either part of a quoted-pair\n\t(together with '\\\\'), or a normal qdtext, since '\\\\' itself can\n\tbe treated as a qdtext. This is equivalent to saying that the\n\tcharacter after '\\\\' in a quoted string could be ANY octet.\n\n\tA patch based on the above two observations is attached.\n\n\tPeng\n\n2013-08-13 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tEnforce RFC 2616 and accept \"0\" after a backslash for quoted-strings.\n\n\tReported by Peng <howtofly(at)gmail.com>\n\n2013-08-13 Peng <howtofly(at)gmail.com>\n\n\tPatch to make scanner_get_token more robust (avoid over-reading).\n\n2013-07-30 Zheng Peng <darkelf2010(at)users.sf.net>\n\n\tSF ticket #116 UpnpRemoveVirtualDir wrong linked list operation\n\n\tWhat if pVirtualDirList has two nodes and what we want to delete is the\n\tfirst one. Patch attached.\n\n2013-07-30 Sebastian Brandt <s.brandt(at)aixtrusion.de>\n\n\tDear libupnp-devels,\n\twhen POST'ing to the simple web server in libupnp, the application crashes.\n\tThis is caused by a missing \"...\" argument in webserver.c:1533.\n\tSeems it has been there for a long time ... 1.6.9 and 1.6.18 have it.\n\n\twebserver.c:1533 calls http_MakeMessage\n\t/* Send response. */\n\thttp_MakeMessage(&headers, 1, 1,\n\t\t \"RTLSXcCc\",\n\t\t ret, \"text/html\", X_USER_AGENT);\n\tThe format parameter RTLSXcCc needs four arguments -\n\tR - response code - ret,\n\tT- content type - text/html,\n\tL - struct SendInstruction * - NOT PRESENT\n\tX - user agent - X_USER_AGENT\n\n\tThis results in a crash.\n\n\tChanging to\n\thttp_MakeMessage(&headers, 1, 1,\n\t\t \"RTLSXcCc\",\n\t\t ret, \"text/html\", &RespInstr, X_USER_AGENT);\n\tsolves the situation.\n\n\tYours,\n\tSebastian Brandt\n\n*******************************************************************************\nVersion 1.6.18\n*******************************************************************************\n\n2012-12-06 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSecurity fix for CERT issue VU#922681\n\n\tThis patch addresses three possible buffer overflows in function\n\tunique_service_name(). The three issues have the folowing CVE numbers:\n\n\tCVE-2012-5958 Issue #2: Stack buffer overflow of Tempbuf\n\tCVE-2012-5959 Issue #4: Stack buffer overflow of Event->UDN\n\tCVE-2012-5960 Issue #8: Stack buffer overflow of Event->UDN\n\n\tNotice that the following issues have already been dealt by previous\n\twork:\n\n\tCVE-2012-5961 Issue #1: Stack buffer overflow of Evt->UDN\n\tCVE-2012-5962 Issue #3: Stack buffer overflow of Evt->DeviceType\n\tCVE-2012-5963 Issue #5: Stack buffer overflow of Event->UDN\n\tCVE-2012-5964 Issue #6: Stack buffer overflow of Event->DeviceType\n\tCVE-2012-5965 Issue #7: Stack buffer overflow of Event->DeviceType\n\n2012-06-19 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix memory leak and access violation in UpnpSendAction(Ex)Async.\n\n\tFree buffers after malloc or ixmlPrintNode failure.\n\tFree Param->Header before destructing Param.\n\n2012-05-25 Anoop Mohan <anoop.anoop(at)gmail.com>\n\n\tThis patch fixes a bug in non blocking connect call where the sock\n\toption length for SO_ERROR was passed as 0 instead of sizeof(int).\n\n2012-04-24 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tDisable SetGenaCallback call if device is disabled.\n\n\tIf device is disabled, SetGenaCallback definition is disabled,\n\tbut its call remains. A link error will occur in Win32.\n\n2012-04-21 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix condition for allocation failure in get_content_type().\n\n\tAt the end of get_content_type() in webserver.c, it should check\n\treturn value of ixmlCloneDOMString().\n\n2012-04-21 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix problems detected as dead assignment warning by clang scan-build.\n\n\tWrong assignment by shutdown result hides the real error code\n\tof NewRequestHandler() in ssdp_device.c.\n\tFix return code description of NewRequestHandler().\n\tHandle return code from ithread_create in sample applications.\n\tRemove unused assignments.\n\n2012-04-20 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid dereference of null pointer in ixmlNode_setNodeProperties.\n\n\tThe problem can occur if one of the arguments is NULL.\n\tTest argument and fix assertion.\n\n2012-04-17 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tCreate intermediate directory per project on vc9.\n\n\tSample applications share sample_util.c and collisions of\n\tobject file can occur in parallel build. Modify project files to\n\tsplit intermediate directories against it.\n\tApply similar changes also to library projects, like vc10 projects.\n\n2012-04-11 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid access violation after parser_parse_chunky_headers call.\n\n\tIn parser_parse_chunky_headers, parser->msg.msg.buf can be changed\n\tby membuffer_delete call. Therefore if we save the pointer to\n\tparser->msg.entity.buf before calling membuffer_delete, it will\n\tinduce access to released memory.\n\n2012-04-06 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tRemove possibility of access violation.\n\n\t1. Test Instr before dereference it in http_RecvPostMessage.\n\t(Though it never becomes NULL because NULL is not passed to\n\tthe static method)\n\t2. Avoid strdup(NULL) in ixmlElement_setAttributeNS.\n\tThose are detected by llvm scan-build.\n\n2012-04-05 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3507819 - Use of thread-unsafe gmtime() in httpreadwrite.c\n\n\tSubmitted: zephyrus ( zephyrus00jp ) - 2012-03-18 06:31:00 PDT\n\n\tDefine http_gmtime_r and web_server_asctime_r and use it.\n\tThose prefix are added since pthread for Win32 already\n\thas macro gmtime_r and asctime_r.\n\n2012-04-05 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix type of local variable stopSock in RunMiniServer()\n\n\tThe variable is declared as SOCKET, but it is used to\n\tstore return value of int receive_from_stopSock(...).\n\tThe type was changed in the commit\n\t4b47e6a51d9c7049a862695b68de75699e023551 by mistake.\n\n2012-04-03 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tCompilation optimisation\n\n\tDo not compile the code related to the webserver in http_SendMessage\n\twhen --disable-webserver is set\n\n*******************************************************************************\nVersion 1.6.17\n*******************************************************************************\n\n2012-04-02 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3514145 - Memory leak fix in threadutil\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-04-02 06:49:20 PDT\n\n\tPut thread in a detached state when calling ithread_create otherwise in\n\tsome circumstances, thread can end before the call to ithread_detach.\n\n2012-03-30 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdd --enable-unspecified_server\n\n\tAdd --enable-unspecified_server configure option to set to \"Unspecified\"\n\tthe OS name, OS version, product name and product version normally\n\tcontained in the SERVER header as this could be used by an attacker.\n\n2012-03-29 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemoving implicit casts in miniserver.c\n\n\tRemoving implicit integer or enum casts in miniserver.c.\n\n2012-03-29 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3512833 - Miniserver is wrongly disabled\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-29 07:36:34 PDT\n\n\tMiniserver is disabled if ECXLUDE_GENA, EXCLUDE_SOAP and\n\tEXCLUDE_WEBSERVER are set.\n\tHowever, SSDP needs the Miniserver to answer to M-SEARCH requests.\n\tSo, MiniServer should not be disabled if EXCLUDE_SSDP is not also set.\n\n2012-03-26 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3510693 - build fail with --disable-device\n\n\tUse INCLUDE_DEVICE_APIS instead of UPNP_HAVE_DEVICE as in other sources.\n\tDon't use soap_device_callback if INCLUDE_DEVICE_APIS is not set,\n\totherwise link error occur on Windows.\n\n2012-03-26 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3511149 - --disable-ssdp has no effect\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-03-25 18:14:34 PDT\n\n\tThere are typos in upnp/src/inc/config.h \"EXCLUDE_SSSDP\" (shold be\n\tEXCLUDE_SSDP), therefore EXCLUDE_SSDP is always 0, and --disable-ssdp\n\thas no effect.\n\n2012-03-24 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove implicit casts\n\n\tCast parameters of htonl in uint32_t in IN6_IS_ADDR_GLOBAL and\n\tIN6_IS_ADDR_ULA definitions.\n\tRemove comparison with 0 in while statement of vfmatch,\n\thttp_SendMessage and http_MakeMessage.\n\n2012-03-24 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3510693 - build fail with --disable-device\n\n\tGetDeviceHandleInfo just fail without using undefined member DeviceAf\n\tif UPNP_HAVE_DEVICE is not defined.\n\tMove ContentTypeHeader definition to soap_common.c, since it is\n\talso used in soap_ctrlpt.c.\n\n*******************************************************************************\nVersion 1.6.16\n*******************************************************************************\n\n2012-03-18 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tReplace sprintf by snprintf in http_WriteHttpPost\n\n\tReplace sprintf by snprintf in http_WriteHttpPost to avoid buffer\n\toverflow.\n\n2012-03-18 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdd infoSize parameter to get_sdk_info\n\n\tAdd infoSize parameter to get_sdk_info function to replace sprintf call\n\tby a snprintf call.\n\n2012-03-16 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tCheck return code in ixml\n\n\tCheck return code of ixmlDocument_CreateElementEx in\n\tixmlDocument_CreateElement.\n\tCheck return code of ixmlNode_setNodeName and ixmlNode_setNodeValue in\n\tixmlNode_cloneCDATASect and ixmlNode_cloneTextNode.\n\n2012-03-16 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdd more explicit casts and remove dead code\n\n\tComment unused SERVER from DeviceShutdown.\n\tComment unused max from parse_hostport.\n\tComment unused nodeptr from ixmlNode_cloneDoc.\n\tComment unused newNode from Parser_hasDefaultNamespace.\n\tComment unused Parser_parseReference function\n\tCheck return code of shutdown and display an error if needed.\n\n2012-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tFix previous commit\n\n\tReplace HAVE_UPNP_OPTSSDP by UPNP_HAVE_OPTSSDP in upnpapi.c.\n\n2012-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdd --disable-optssdp option\n\n\tModify configure.ac to add --disable-optssdp option. This option will\n\tremove OPT, 01-NLS and X_USER_AGENT headers from SSDP messages as those\n\theaders are optional. If --disable-gena and disable-optssdp are both\n\tused, uuid part will not be compiled anymore.\n\n2012-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix in ixmlNode_allowChildren\n\n\tCommit d48d73720bd325062c4d3b9ce85f3944be4f562d added a bug in\n\tixmlNode_allowChildren, this function was returning FALSE instead of\n\tTRUE when newChild->nodeName was eELEMENT_NODE.\n\n2012-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tImprove upnp/genlib/net\n\n\tChange ret_code from int to parse_status_t in match.\n\tSet back return code of ReadResponseLineAndHeaders from parse_status_t\n\tto int as this function can return UPNP_E_BAD_HTTPMSG. As a result, do\n\tnot cast the result of this function into parse_status_t in\n\thttp_OpenHttpGetProxy and http_OpenHttpGetEx.\n\tUse switch with PARSE_OK in parsetools.c.\n\tAdd missing explicit casts of integer constants in uri.c and\n\thttpreadwrite.c.\n\tUse switch, int and sa_family_t with AF_INET in uri.c.\n\tPrint an error in http_Download if realloc failed.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tUse switch instead of if with enums in upnpapi.c\n\n\tReplace if statements with switch when using HND_DEVICE and HND_CLIENT\n\tenum constants.\n\tCorrect also UpnpUnRegisterRootDeviceLowPower and UpnpUnRegisterClient\n\tas those functions were wrongly awaiting an UPNP_E_INVALID_HANDLE\n\tinstead of HND_INVALID from GetHandleInfo.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tImprove ssdp part\n\n\tDo not compile CreateClientRequestPacketUlaGua if IPv6 is disable.\n\tCast DestAddr->sa_family from sa_family_t into int when calling\n\tCreateServicePacket as this function has been set back to accept int in\n\ta692e591defe6ed9a617b9b4a083964a01f7bbab.\n\tUse switch instead of if with AF_INET and AF_INET6.\n\tAdd missing casts from AF_INET and AF_INET6 into sa_family_t when using\n\tthem to set sin_family and sin6_family.\n\tAdd missing explicit casts into size_t or lu when using\tinteger\n\tconstants with strlen or unsigned long indexes.\n\tSet SSDP_PAUSE to be unsigned as it is used with usleep.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tUse switch insted of if with enums in ixml\n\n\tReplace if statements with switch when using enums in ixml.\n\tRemove uneeded initialization in ixmlAttr_init, Parser_init and\n\tixmlNode_init which was added by wrongly added in commit\n\t06660b6383c438e4e2c9ca9854077cecc4da9e5d.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tUse switch insted of if with enums in threadutil\n\n\tReplace if statements with switch when using enums in threadutil.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tFix missing break in http_RecvMessage\n\n\tThere was a missing break in PARSE_INCOMPLETE_ENTITY due to commit\n\t2eb3e069badd5c8676738c3ead37f9551fd8448e.\n\n2012-03-14 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix parse failure observed with tvdevice sample.\n\n\tCommit c40d2bc0c9b60c43b641ac4669c7b8bbcd6134c5 has a problem\n\tat removing the parentheses in parser_parse_responseline.\n\tDifference of pointers was used with intention, don't cast\n\tthem separately.\n\n2012-03-14 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix compile error on Windows.\n\n\tInclude UpnpStdInt.h for ssize_t.\n\tDefine sa_family_t in UpnpInet.h.\n\n2012-03-14 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid ambiguous change of SsdpEvent in unique_service_name.\n\n\tHandle overflow before changing SsdpEvent.\n\tBecause the behavior of \"snprintf\" is platform dependent in such case.\n\n2012-03-14 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3502958 - The commit 5944960e prevents a pupnp client (amule) from receiving replies from an IGD device.\n\n\tPrevious change broke the feature. The error of unique_service_name\n\tin ssdp_request_type should be ignored.\n\tThis reverts commit 5944960e172a797a9fcc196291f4046cafa7f6ec.\n\n2012-03-13 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tAddress family is an int\n\n\tReference: \"man 2 socket\".\n\n2012-03-11 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove more implicit casts in upnp part\n\n\tRemove more \"implicit integer or enum conversions\" errors as well as\n\tdead code. \n\n2012-03-11 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove more implicit casts in upnp part\n\n\tRemove more \"implicit integer or enum conversions\" as well as memset\n\tbefore snprintf.\n\n2012-03-11 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid out of range access in CheckOtherHTTPHeaders.\n\n\tThere was a problem in HDR_ACCEPT_LANGUAGE case.\n\tIt may read from TmpBuf larger amount than allocated,\n\tsince condition was always true.\n\tTerminate RespInstr->AcceptLanguageHeader correctly.\n\tSkip allocation if there is already sufficient buffer.\n\n2012-03-10 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove some of the implicit cast in upnp part\n\n\tRemove some of the \"implicit integer or enum conversions\" as well as\n\tsome access to NULL reference in upnp part.\n\n2012-03-10 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove lock in ThreadPoolInit\n\n\tIf ThreadPoolInit returned EAGAIN, tp->lock was not freed. \n\n2012-03-10 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tImprove ixml\n\n\tRemove \"implicit integer conversions\" and\n\t\"dereference NULL return value\" errors in ixml part.\n\n2012-03-10 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tExclude IPv6 stuff in SearchByTarget when UPNP_ENABLE_IPV6 is not defined.\n\n2012-03-10 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFurther measures against buffer overflows.\n\n\t* Pass output buffer size to CreateClientRequestPacket(UlaGua)\n\t  from SearchByTarget and detect overflow.\n\t* Handle SearchByTarget error in UpnpSearchAsync.\n\t* Pass output buffer size to addrToString and detect overflow.\n\t* Handle addrToString error in configure_urlbase. \n\t* Handle overflow in http_SendMessage.\n\t* Respect unique_service_name error in ssdp_request_type\n\t  so as not to touch non-terminated buffer under Evt.\n\t* Treat large argument as error in UpnpAddVirtualDir.\n\t* Use strncpy with the standard way in readFromSSDPSocket.\n\t* Do not clear buffer before snprintf.\n\t* Clarify the last argument of GetDescDocumentAndURL has size LINE_SIZE.\n\t* For inet_ntop, use buffer with size INET6_ADDRSTRLEN or INET_ADDRSTRLEN.\n\n2012-03-10 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tHandle allocation error in strndup to avoid access violation.\n\n\tReturn NULL before calling strncpy.\n\tPlatforms with HAVE_STRNDUP are not affected.\n\n2012-03-10 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSynchronize autoconfig.h with upnpconfig.h.\n\n\tIt fixes WIN32 build where configure is not invoked. \n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tMore compilaton optimisation\n\n\tDo not compile most of service_table.c and client_table.c if\n\t--disable-gena is used.\n\tDo not compile urlconfig.c if --disable-webserver is used.\n\tAdding new UPNP_HAVE_xxx variables in upnpconfig.h and upnpconfig.h.in.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tOptimisation of --disable-webserver\n\n\tDo not compile webserver.c if --disable-webserver is used.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tImprove threadutil\n\n\tRemove \"dereference NULL return\" errors and implicit conversions to\n\tdouble or enum types.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tOptimisation of --disable-webserver\n\n\tDo not compile miniserver.c if --disable-webserver is used.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdding configure options\n\n\tAdding --disable-ssdp, --disable-soap, --disable-gena options to\n\tconfigure script.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix of last commit\n\n\t_snprintf was wrongly defined in ssdp_server.c\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3499781 - msvc doesn't have snprintf\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-03-08 10:18:39 PST\n\n\t97a17ff5add73c97844e2fa74456bab4df0800f1 commit breaks build on\n\twindows/msvc since there is no snprintf.\n\n\tNote:\n\t* Some existing sources use _snprintf when WIN32 is defined, but its\n\tbehavior is a bit different from C99 snprintf.\n\t* snprintf does terminate the buffer, so the commit (use buffer size\n\tminus 1 as argument) changes the behavior at the boundary.\n\t* Truncation might be better than crash in some cases. But it may\n\tresult in not good.\n\n2012-03-08 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3499878 - UpnpUnSubscribeAsync(): \u2018retVal\u2019 may be used uninitialized\n\n\tSubmitted: Marcelo Roberto Jimenez ( mroberto ) - 2012-03-08 12:38:57 PST\n\n\tsrc/api/upnpapi.c: In function \u2018UpnpUnSubscribeAsync\u2019:\n\tsrc/api/upnpapi.c:2060:6: warning: \u2018retVal\u2019 may be used uninitialized in this function\n\n2012-03-08 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3175217 - Crash bug in Parser_addNamespace()\n\n\tSubmitted: Terry Farnham ( tfarnham ) - 2011-02-07 09:25:25 PST\n\n\tDetails: The strcmp(pNode->prefix,pCur->prefix) crashes on pCur->prefix\n\tbeing NULL. This occurs on invalidly formatted xml where a node uses an\n\tundefined namespace. I would expect to receive IXML_FAILED in this\n\tsituation.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemoving access to NULL pointers in node.c and element.c\n\n\tCheck that newNode is not NULL ixmlNode_cloneNodeTree and pass newAttr\n\tas the return node in the ixmlElement_setAttributeNodeNS call of\n\tixmlElement_setAttributeNS.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tMemory leaks correction in upnpapi.c\n\n\tFix memory leaks in UpnpUnSubscribe, SendActionExAsync and\n\tRenewSubscription.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496993 - Write after free in ixmlNode_insertBefore\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 04:54:40 PST\n\n\tIf ixmlNode_isParent(nodeptr, newChild) returns TRUE,\n\tixmlNode_removeChild(nodeptr, newChild, NULL) will free newChild before\n\tthe modifications of newChild->nextSibling and newChild->prevSibling.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove most of strcpy, sprintf and strcat\n\n\tReplace strcpy, sprintf and strcat by strncpy, snprintf and strncat to\n\tavoid buffer overflows.\n\n2012-03-07 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3497714 - Buffer overflows\n\n\tFix compile error on WIN32.\n\n\tLocal variables must be declared first.\n\tRemove outdated comment.\n\n2012-03-07 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid access violation in assertion.\n\n\txmlParser->pCurElement was dereferenced before null check.\n\tAffects debug build only.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove SIZEOF_MISTACH error in notify_send_and_recv\n\n\tReplace sizeof(CRLF) by strlen(CRLF) as CRLF is a const char*.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3498442 - Memory leak in get_file_info\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-07 02:44:30 PST\n\n\tinfo->contentType is not freed before being set to NULL.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3498439 - Memory leak in removeServiceTable\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-07 02:35:46 PST\n\n\tUDN is not freed.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3498436 - Memory leak in Parser_processAttributeName\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-07 02:30:57 PST\n\n\tattr is not freed if ixmlNode_setNodeProperties or\n\tixmlNode_setAttributeNode return an error in\n\tParser_processAttributeName.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tFixing an error in d6db7c555d0f11856ce5e3e479b16a4cf4689107 commit\n\n\tEvt.Sid should not be cast into char* when calling sizeof otherwise\n\tsize will be 4.\n\n2012-03-06 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemoving two unused variables in ssdp_server.c\n\n\tRemoving first TempPtr allocation in unique_service_name as well as one\n\tof the dbgStr allocation in AdvertizeAndReply as those values were not\n\tused.\n\n2012-03-06 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497714 - Buffer overflows\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-06 07:36:08 PST\n\n\tCall to strcpy should be replaced by call to memset and strncpy to\n\tavoid getting buffer overflows.\n\n2012-03-05 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 2989399 - UpnpSetVirtualDirCallbacks API removal in 1.6.x\n\n\tSubmitted: Nick Leverton ( leveret ) - 2010-04-19 07:44:10 PDT\n\n\tDetails: The recent codebase merge has removed a significant API call\n\twhich is used by several pupnp devices such as mediatomb and gmediaserver.\n\tUpnpSetVirtualDirCallbacks() has been replaced by individual routines to\n\tset each callback. Essentially this means that 1.6.7 will in fact be a majo\n\tbump and 1.6.6 devices can no longer link against it. Could we have the call\n\treinstated please, perhaps as a wrapper around the individual calls ? As\n\tit is, all distros will have to patch their 1.6.x apps, rebuild and re-link them.\n\n\tThe other removed API calls and external variables don't seem to be used\n\tby any of the apps I have copies of, but UpnpSetVirtualDirCallbacks is\n\timportant for maintaining compatibility within 1.6.x.\n\n2012-03-05 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3325246 - Memory Leak in XML Parser\n\n\tSubmitted: Terry Farnham ( tfarnham ) - 2011-06-23 09:45:54 PDT\n\n\tDetails: The following bit of xml results in a memory leak from the xml\n\tparser:\n\n\tconst char *xmlbuffer=\"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\n\t<root xmlns=\\\"urn:schemas-upnp-org:device-1-0\\\" xmlns:dlna=\\\"urn:schemas-dlna-org:device-1-0\\\">\n\t<dlna:X_DLNADOC xmlns:dlna=\\\"urn:schemas-dlna-org:device-1-0\\\">DMS-1.50</dlna:X_DLNADOC></root>\";\n\n\tWhen I execute the following code:\n\n\tIXML_Document *doc = ixmlParseBuffer(xmlbuffer);\n\tixmlDocument_free(doc);\n\n\tIt results in a memory leak in ixmlparser.c line 2107 where it calls\n\tsafe_strdup( newElement->namespaceURI ); It's difficult to figure out why.\n\n2012-03-05 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3417134 - Crash seen in UpnpFinish\n\n\tSubmitted: Sunil ( sunilangadi ) - 2011-10-02 08:28:47 PDT\n\n\tDetails: I observed crash in the below mentioned log statement in\n\tfunction upnpfinish(file: upnpapi.c).\n\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__, \"Exiting UpnpFinish:\n\t\tUpnpSdkInit is :%d:\\n\", UpnpSdkInit);\n\n\tIn particular it was crashing in ithread_self in\n\tUpnpDisplayFileAndLine(file upnpdebug.c) on WIN32.\n\n\tMoving the call ithread_cleanup_library() below the upnp printf call\n\tmentioned above in function upnpfinish fixed the crash but I couldn't get\n\tto the root of the problem.\n\n\tThe problem was observed on WIN32.\n\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497159 - Bug fix in Parser_readFileOrBuffer\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 14:20:58 PST\n\n\tfileSize = ftell( xmlFilePtr ); can return a negative value, in this\n\t case the function should exit (at the moment, the function exits only\n\tif ftell returns 0).\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497140 - Bug fix in http_get_code_text\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 13:07:03 PST\n\n\tReplace if( statusCode < 100 && statusCode >= 600 ) which can't be true\n\tby if( statusCode < 100 || statusCode >= 600 ).\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497126 - Resource leak in http_RecvPostMessage\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 12:33:59 PST\n\n\tFp is not closed when an error is raised on membuffer_append or\n\tsock_read.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497034 - Buffer not null terminated in UpnpGetIfInfo\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 06:43:52 PST\n\n\tgIF_NAME might be not null terminated.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497033 - Buffer not null terminated in UpnpInit\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 06:42:18 PST\n\n\tgIF_IPV4, gIF_IPV6 and gIF_IPV6_ULA_GUA might be not null terminated.\n\tMoreover, gIF_IPV4 should be 16 characters (INET_ADDRSTRLEN) and not 22\n\tand gIF_IPV6 should be 46 characters (INET6_ADDRSTRLEN) and not 65.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix of lastest commit (parse_hostport)\n\n\tMissing parenthesis in memset.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497027 - Buffer not null terminated in parse_hostport\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 06:28:38 PST\n\n\tworkbuf might be not null terminated.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497009 - Resource leak in http_SendMessage\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 05:51:44 PST\n\n\tFp is not closed if fseeko(Fp, Instr->RangeOffset, SEEK_CUR) does not return 0.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tHInfo->ServiceTable initialization in UpnpRegisterRootDevice2 and UpnpRegisterRootDevice4\n\n\tInitialize also HInfo->ServiceTable in UpnpRegisterRootDevice2 and\n\tUpnpRegisterRootDevice4 functions\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496703 - Handle_Info::ServiceList may have undefined value\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-03-03 20:49:25 PST\n\n\tIn UpnpRegisterRootDevice(), HInfo->ServiceTable is not initialized and\n\tgetServiceTable() may leave it intact. It will cause crash on\n\tfreeServiceTable() called from UpnpUnRegisterRootDevice().\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496702 - TvDeviceStop is called even if Start failed\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-03-03 20:35:08 PST\n\n\tIn sample tvdevice, error of device_main() is not handled, and\n\tTvDeviceStop() cause crash.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496942 - Memory leak in config_description_doc\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 01:55:54 PST\n\n\telement was not freed if membuffer_append_str(&url_str, \"http://\") does\n\tnot return 0. Moreover addNew was not used.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496938 - Missing structures initialisation in some functions\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 01:31:16 PST\n\n\tMemsetting to 0 some of the structures: finfo in process_request,\n\tjob in readFromSSDPSocket, request in http_OpenHttpGetEx, job in\n\tgenaNotifyThread, job in genaNotifyAllExt, job in genaNotifyAll,\n\tjob in genaInitNotifyExt, job in genaInitNotify, LocalAddr in\n\tgetlocalhostname.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496934 - Memory leaks in getlocalhostname and UpnpGetIfInfo\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 01:25:42 PST\n\n\tLocalSock is not closed if ioctl(LocalSock, SIOCGIFCONF, &ifConf);\n\treturns an error.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496933 - Out-of-bounds access in CheckOtherHTTPHeaders\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 01:15:34 PST\n\n\tAn out-of-bands access is raised because size of\n\tRespInst->AcceptLanguageHeader is 200 and TmpBuf size is 180.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove unused currentDevice variable in removeServiceTable\n\n\tcurrentDevice is not used in this function.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496581 - Memory leak in getServiceList\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-03 08:43:23 PST\n\n\tserviceNodeList is not freed if\n\tcurrent->next = malloc(sizeof(service_info)); returns NULL.\n\n2012-02-29 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3495616 - Memory leak in ixmlElement_setAttributeNS\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-02-29 02:09:43 PST\n\n\tnewAttrNode is not freed if newAttr->n.nodeValue = strdup(value); returns\n\tNULL or if ixmlElement_setAttributeNodeNS(element, newAttr, NULL) does\n\tnot return IXML_SUCCESS.\n\n2012-02-28 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3495286 - Double free in get_action_node\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-02-28 04:27:54 PST\n\n\tixmlFreeDOMString(ActNodeName); is called twice if\n\tixmlParseBufferEx(ActNodeName, RespNode); does not return IXML_SUCCESS.\n\n2012-02-28 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3495280 - Memory leak in ixmlDocument_createElementEx\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-02-28 04:01:02 PST\n\n\tThere is a memory leak in ixmlDocument_createElementEx:\n\tnewElement->tagName is not freed if\n\tnewElement->n.nodeName = strdup(tagName); returns NULL.\n\n2012-02-27 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3494865 - Use of non-initialized variable in parser_parse_requestline\n\n\tSubmitted: Marcelo Roberto Jimenez ( mroberto ) - 2012-02-26 16:50:23 PST\n\n\tsrc/genlib/net/http/httpparser.c: In function \u2018parser_parse_requestline\u2019:\n\tsrc/genlib/net/http/httpparser.c:1319:28: warning: \u2018index\u2019 may be used uninitialized in this function\n\n2012-02-24 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3489999 - UpnpString leaks in genaSubscribe()\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-02-21 07:06:35 PST\n\n\tIn genaSubscribe() (defined in upnp/src/gena/gena_ctrlpt.c),\n\tActualSID and EventURL will not be freed if ScheduleGenaAutoRenew\n\treturns UPNP_E_SUCCESS.\n\n\tThis fixes the an issue introduced by the previous fix.\n\n2012-02-23 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3489990 - some files are missing in tarball\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-02-21 06:52:57 PST\n\n\tReleased tarball (e.g. libupnp-1.6.15.tar.bz2) does not contain\n\tsome files under upnp/{inc,src} used by the project files for\n\twindows (build/vc8/libupnp. vcproj and build/vc9/libupnp.vcproj).\n\n\tThis breaks build on Windows from tarball released after following changes\n\thttp://pupnp.git.sourceforge.net/git/gitweb.cgi?p=pupnp/pupnp;a=commitdiff;h=0eba550da039be01211b56fea0d02d03f0a12343\n\thttp://pupnp.git.sourceforge.net/git/gitweb.cgi?p=pupnp/pupnp;a=commitdiff;h=7a796b264ec7d5de5876fd6a2001c2d329709e02\n\n2012-02-23 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3489999 - UpnpString leaks in genaSubscribe()\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-02-21 07:06:35 PST\n\n\tIn genaSubscribe() (defined in upnp/src/gena/gena_ctrlpt.c),\n\tActualSID and EventURL will not be freed if ScheduleGenaAutoRenew\n\treturns UPNP_E_SUCCESS.\n\n\tThis fixes the original issue.\n\n2012-02-23 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker: UpnpString leaks in genaSubscribe()\n\n\tIn genaSubscribe() (defined in upnp/src/gena/gena_ctrlpt.c),\n\tActualSID and EventURL will not be freed if ScheduleGenaAutoRenew\n\treturns UPNP_E_SUCCESS.\n\n2012-02-23 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tRevert cb89781a55466703763c1b0ee67094eb401ddfe9 as suggested by\n\tFabrice Fontaine.\n\n2012-02-07 Edwin Stearns <edwin(at)vtilt.com>\n\n\tAttached is a patch that resolved an issue I found with a server that\n\tgave its device description URI without a trailing slash (e.g.\n\t`http://127.0.0.1:5555`).\n\n2012-01-04 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix for IPv4-mapped IPv6 addresses.\n\n\tSetting IPv6 sockets with IPV6_V6ONLY flag to avoid getting IP packets\n\twith IPv4-mapped IPv6 addresses on IPv6 sockets.\n\n\n*******************************************************************************\nVersion 1.6.15\n*******************************************************************************\n\n2012-01-11 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix on M-SEARCH for IPv6 CPs.\n\n\tSmall bug fix on IPv6 Control Point: now CP will also send M-SEARCH on\n\tsite-scope address (FF05::C) instead of only sending M-SEARCH on\n\tlink-scope (FF02::C).\n\n2012-01-11 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRetrieve IPv6 addresses in Upnp_Discovery.\n\n\tChanging sockaddr_in into sockaddr_storage in Upnp_Discovery to be able\n\tto retrieve IPv6 addresses of devices in Control Points using pupnp.\n\n2012-01-09 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug tracker, ID: 3469344\n\tSubmitted: dimmman ( dimmman ) - 2012-01-04 01:44:29 PST\n\tDetails: Looking at the code (v1.6.14, upnptools.c) for UpnpResolveURL\n\tand UpnpResolveURL2 it shows that the ExitFunction: always returns\n\tUPNP_E_SUCCESS.\n\n\tI'm farily sure it's a simple mistake that should have been \"return ret;\"\n\tin both cases.\n\n\tBr,\n\tJonny\n\n*******************************************************************************\nVersion 1.6.14\n*******************************************************************************\n\n2011-10-31 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tUPnP Low Power Support.\n\n\tAdding two new functions (UpnpSendAdvertisementLowPower and\n\tUpnpUnRegisterRootDeviceLowPower) which can be used to specify values\n\tfor the three SSDP headers defined by UPnP Low Power. Those headers are\n\tPowerstate, SleepPeriod and RegistrationState.\n\n2011-10-24 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix in IN6_IS_ADDR_GLOBAL.\n\n\tChanging IN6_IS_ADDR_GLOBAL to accept all IPv6 addresses which have a\n\t2000::/3 prefix.\n\n2011-07-20 Marc Essayan <marc.essayan(at)orange-ftgroup.com>\n\n\tBug Fix on M-SEARCH.\n\n\tDo not answer to M-SEARCH using HTTP version 1.0 as specified by the\n\tUPnP Device Architecture.\n\n2011-03-18 Iain Denniston <iain.denniston(at)gmail.com>\n\n\tFixes for compilation under Windows (specifically MSVC). Also added\n\tMSVC supported \"_inline\", and fixed some WIN32 specific warnings.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\n\tSeveral fixes to correctly use SOCKET (and related) types instead of\n\tnon-portable variations.\n\n*******************************************************************************\nVersion 1.6.13\n*******************************************************************************\n\n2011-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tPutting ssdpReqSocks under compilation flag.\n\n\tPutting all access to ssdpReqSock4 and ssdpReqSock6 under\n\tINCLUDE_CLIENT_APIS compilation flag to be able to compile when\n\tclient part of library is disable.\n\n2011-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tNew UpnpRegisterRootDevice4 for legacy CPs.\n\n\tAdd a new UpnpRegisterRootDevice4 which allow user to specify a\n\tdescription URL to be returned for legacy CPs (for example, CPs\n\tsearching for a v1 when the device is v2). Most of those CPs does not\n\twork if they found a v2 in the XML description, so this new function is\n\tonly used to solve interoperability issues.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\tFix for memory leak.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\tFix and Update of MSVC9 solution and project files - now compile in all\n\tmodes. Added x64 and static library targets.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\tPartial fix for UpnpGetIfInfo with MSVC - convert wchar string to\n\tchar string (full fix requires a lot of work - potentially impacting\n\tall supported platforms)\n\n2011-03-11 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tCreated the macros PRIzd and PRIzx to deal with MSVC lack of C99.\n\tThanks to Iain Denniston for pointing it out.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\n\tFixes for headers when compiled under C++\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\n\tFix for uuid_unpack incorrect shift precedence.\n\n*******************************************************************************\nVersion 1.6.12\n*******************************************************************************\n\n2011-02-08 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tUndo the \"incorrectly exported include files\".\n\t\n\tLegacy applications like linux-igd and igd2-for-linux are using those\n\tAPI to create a thread pool for managing their GENA events.\n\n\tLeave it to be reworked in 1.8.x.\n\n*******************************************************************************\nVersion 1.6.11\n*******************************************************************************\n\n2011-02-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tRemove PrintThreadPoolStats() from the public API. This function uses\n\ta ThreadPool object as an argument, which is not supposed to be\n\texported.\n\n2011-02-07 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tMajor bug fix in IPv6 code.\n\n\tMajor bug fix in miniserver.c for IPv6, bug was introduced when\n\tchanging implementation of get_port in November 20th 2010 (\"gena:fix\n\tseveral compiler warnings\" commit).\n\n2011-02-06 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for incorrectly exported include files.\n\n\tThe files FreeList.h, LinkedList.h, ThreadPool.h and TimerThread.h\n\tfrom the threautil library were being installed in the include\n\tdirectory of the library, incorrectly exposing internal data structure\n\tof the library.\n\n2011-01-30 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tFix for compilation warnings of unused variables in upnpdebug.c in\n\trelease builds.\n\n2011-01-20 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tFix for Race condition can hang miniserver thread.\n\n\tAdd 'requiredThreads' field to the ThreadPool structure, to avoid\n\ta race condition when waiting for a new thread to be created. The\n\trace condition occurs when a thread is destroyed while the master\n\tthread is waiting for a new thread to be created.\n\n\tThanks to Chuck Thomason for pointing the problem.\n\n\tSummary: Race condition can hang miniserver thread - ID: 3158591\n\n\tDetails:\n\tHello,\n\n\tI have found a race condition in the thread pool handling of\n\tlibupnp-1.6.6 that periodically results in the miniserver thread\n\tgetting blocked infinitely.\n\n\tIn my setup, I have the miniserver thread pool configured with 1\n\tjob per thread, 2 threads minimum, and 50 threads maximum.\n\n\tJust before the lockup occurs, the miniserver thread pool contains\n\t2 threads: one worker thread hanging around from a previous HTTP\n\trequest job (let's call that thread \"old_worker\") and the\n\tminiserver thread itself.\n\n\tA new HTTP request comes in. Accordingly, the miniserver enters\n\tschedule_request_job() and then ThreadPoolAdd(). In\n\tThreadPoolAdd(), the job gets added to the medium-priority queue,\n\tand AddWorker() is called. In AddWorker(), jobs = 1 and threads =\n\t1, so CreateWorker gets called.\n\n\tWhen we enter CreateWorker(), tp->totalThreads is 2, so\n\tcurrentThreads is 3. The function creates a new thread and then\n\tblocks on tp->start_and_shutdown. The miniserver thread expects\n\tthe newly created thread to increment tp->totalThreads and then\n\tsignal the condition variable to wake up the miniserver thread and\n\tlet it proceed.\n\n\tThe newly created thread starts in the WorkerThread() function. It\n\tincrements tp->totalThreads to 3, does a broadcast on the\n\tstart_and_shutdown condition, and starts running its job. However,\n\tbefore the miniserver thread wakes up, \"old_worker\" times out. It\n\tsees that there are no jobs in any queue and that the total number\n\tof threads (3) is more than the minimum (2). As a result, it\n\treduces tp->totalThreads to 2 and dies.\n\n\tNow the miniserver thread finally wakes up. It checks\n\ttp->totalThreads and sees that its value is 2, so it blocks on\n\ttp->start_and_shutdown again. It has now \"missed\" seeing\n\ttp->totalThreads get incremented to 3 and will never be unblocked\n\tagain.\n\n\tWhen this issue does occur for a server device, the miniserver\n\tport remains open, but becomes unresponsive since the miniserver\n\tthread is stuck. SSDP alive messages keep getting sent out, as\n\tthey are handled by a separate thread. Reproducing the issue is\n\tdifficult due to the timing coincidence involved, but in my\n\tenvironment I am presently seeing it at least once a day. I\n\tfigured out the sequence described above through addition of my\n\town debug logs.\n\n\tThe relevant code involved in this bug has not changed\n\tsubstantially in libupnp-1.6.10, though I am planning to test\n\tagainst 1.6.10 as well in the near future.\n\n\tDo you have any input for an elegant fix for this issue?\n\n\tThanks,\n\n\tChuck Thomason\n\n2011-01-16 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tDefine _FILE_OFFSET_BITS, _LARGEFILE_SOURCE and _LARGE_FILE_SOURCE in\n\tupnpconfig.h.\n\n\tMake these definitions available to programs using the library.\n\tThanks to Chandra Penke for pointing the problem.\n\n\tSummary: Problem with large file support in pupnp build - ID: 3158969\n\tSubmitted: Chandra ( inactiveneurons ) - 2011-01-15 16:17:02 BRST\n\tDetails:\n\tFirst off, I apologize in advance for the length of this comment, it's\n\tthe only way I could describe the problem accurately.\n\n\tSecondly, a brief thanks (again). The company I'm working for has been\n\tusing pupnp for a massively cross-platform project which involves iphone,\n\tosx, windows, linux x86, arm, and mips hosts. It's amazing how well it\n\tworks, so kudos to the maintainers!\n\n\tWe came across a problem when compiling with the following tool-chain:\n\thttp://www.codesourcery.com/sgpp/lite/mips/portal/release824. The\n\tproblem is the following:\n\n\tIn configure.ac the following lines exist to enable large file support:\n\n\tAC_DEFINE([_LARGE_FILE_SOURCE], [], [Large files support])\n\tAC_DEFINE([_FILE_OFFSET_BITS], [64], [File Offset size])\n\n\tWhich in turn result in the following #defines in autoconfig.h:\n\n\t#define _LARGE_FILE_SOURCE /**/\n\t#define _FILE_OFFSET_BITS 64\n\n\tHowever, this file is not exported as part of the upnp build. Therefore,\n\twhile the entire library gets built with large file support, it's\n\tpossible that dependent libraries which only rely on the include files\n\tmay not use large file support.\n\n\tIn the particular case of the above tool-chain, the 'off_t' type is 8\n\tbytes when large file support is enabled, but only 4 bytes when it's\n\tnot. As a result part our stack built on top of pupnp, which did not\n\thave large file support (because it did not use the above autoconf\n\tdirectives), was relying on 'a off_t' that was 4 bytes.\n\n\tThis caused, among many things, for the UpnpFileInfo struct to break.\n\tSince the struct is completely invisible outside of pupnp (because of\n\tsome template macro magic), pupnp thought that 'FileLength' field was\n\t8 bytes, but the header setter/getter methods being used by dependent\n\tlibraries thought that it was 4, which caused some erratic behavior\n\twhen going through pupnp's webserver and HTTP client API.\n\n\tWe put in a temporary work around by adding the following preprocessor\n\tflags: -D_LARGE_FILE_SOURCE, -D_FILE_OFFSET_BITS=64 as part of our\n\tbuild process. However, it's a hack, and I was wondering if I'm missing\n\tsomething and there's a better way to approach this.\n\n\tThanks,\n\tChandra\n\n2011-01-16 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tUse config.h to test for the availability of strndup() and strnlen().\n\n2011-01-14 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\t- Null termination of strndup() implementation on systems missing it.\n\t- Implementation of strnlen() on systems missing it.\n\n2011-01-14 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tFixes transfer encoding in the HTTP client API, which is currently\n\tbroken. The break was due to a regression caused by another\n\tfix (tracker 3056713), which fixed an out of memory crash when\n\tdownloading large files. The previous fix changed the\n\thttp_ReadHttpGet() implementation so that data already read by the\n\tuser was discarded. However, it only worked for transfers where\n\tthe content length was specified. This fix extends the previous\n\timplementation to cover chunked transfer encoding.\n\n2011-01-14 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tMinor change in membuffer.c to include \"membuffer.h\" without looking\n\tin the standard header path. This allows pupnp to build in xcode.\n\n2010-12-18 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Tracker: Patches\n\tFedora mingw32 compilation - ID: 3138849\n\tDetails:\n\tHello. I trying compile libupnp-1.6.10 on the Fedora 14 MinGW\n\tEnvironment and get many errors. I create patch to fix it. With this\n\tpatch i can get static library. This patch is very raw.\n\n\tSubmitted: Ivan Romanov (ivanromanov) - 2010-12-16 23:29:19 UTC\n\n*******************************************************************************\nVersion 1.6.10\n*******************************************************************************\n\n2010-11-23 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tMajor bug fix in http_SendMessage.\n\n\tCurrently, http_SendMessage was not able to write to write a buffer\n\tdue to a bad use of file_buf instead of buf. This bug was introduced by\n\tthe 0197-Doxygen-reformating-compiler-warnings patch.\n\n2010-11-23 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tReturning the Sid in Upnp_Event_Subscribe.\n\n\tCurrently, Upnp_Event_Subscribe always contains an empty chain in the\n\tSid parameter. This patch now saves the client Subscription ID in this\n\tparameter so Control Points can see and use the same SID in the\n\tUpnp_Event_Subscribe and in the Upnp_Event structures.\n\n2010-11-22 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tTwo fixes from Juergen Lock <nox(at)jelal.kn-bremen.de>:\n\n1. varargs:  pass size of CRLF as size_t not as int:\n\n--- upnp/src/gena/gena_device.c.orig\n+++ upnp/src/gena/gena_device.c\n@@ -225,7 +225,7 @@ static UPNP_INLINE int notify_send_and_r\n\t\t\"bbb\",\n\t\tstart_msg.buf, start_msg.length,\n\t\tpropertySet, strlen(propertySet),\n-\t\t\"\\r\\n\", 2);\n+\t\t\"\\r\\n\", sizeof \"\\r\\n\" - 1);\n\tif (ret_code) {\n\t\tmembuffer_destroy(&start_msg);\n\t\tsock_destroy(&info, SD_BOTH);\n\n2. Remove \"b\" arg here, there is no buffer passed:  (this caused a pointer\nto be interpreted as a buffer size to be alloc'd/copied, hence the 32 GB.)\n\n--- upnp/src/genlib/net/http/webserver.c.orig\n+++ upnp/src/genlib/net/http/webserver.c\n@@ -1262,7 +1262,7 @@ static int process_request(\n\t\t\t// Content-Range: bytes 222-3333/4000  HTTP_PARTIAL_CONTENT\n\t\t\t// Transfer-Encoding: chunked\n\t\t\tif (http_MakeMessage(headers, resp_major, resp_minor,\n-\t\t\t\t\"R\" \"TLD\" \"s\" \"tcS\" \"b\" \"Xc\" \"sCc\",\n+\t\t\t\t\"R\" \"TLD\" \"s\" \"tcS\" \"Xc\" \"sCc\",\n\t\t\t\tHTTP_OK,    // status code\n\t\t\t\tfinfo.content_type, // content type\n\t\t\t\tRespInstr,  // language info\n\n2010-11-15 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tAdded the convenience function UpnpResolveURL2() to upnptools.c.\n\n\tThis function avoids some unecessary memory allocation.\n\tThe memory alloc'd by this function must be freed later by the caller.\n\n2010-11-10 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAdd GENA_NOTIFICATION_xxx_TIMEOUT variable.\n\n\tCurrently, in notify_send_and_recv function, pupnp waits for\n\tHTTP_DEFAULT_TIMEOUT seconds when trying to send a GENA notification.\n\tWhen there is a lot of notifications with CPs which was disconnected\n\twithout unsusbcribing, all the pupnp threads are blocked on this\n\ttimeout. To correct, this issue, this patch adds a new variable,\n\tGENA_NOTIFICATION_SENDING_TIMEOUT, which can be used to lower the\n\ttimeout so GENA threads return quickly when writing is impossible. By\n\tthe same mean, pupnp waits the CP's answer to the NOTIFY for\n\tHTTP_DEFAULT_TIMEOUT seconds, so this patch adds a new variable,\n\tGENA_NOTIFICATION_ANSWERING_TIMEOUT, to customize this value.\n\n2010-11-10 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAdd --disable-blocking-tcp-connections flag.\n\n\tCurrently, pupnp is using a blocking connect to sends GENA\n\tnotifications. As a result, when there is a lot of notifications with\n\tCPs which were disconnected without unsusbcribing, all the pupnp\n\tthreads are blocked for 20s (timeout). To correct this issue, this\n\tpatch replace the call to connect with a call to private_connect and add\n\ta compilation flag to disable blocking TCP connections, so if we are not\n\table to connect to the CP, the notification is lost.\n\n2010-11-07 Stefan Sommerfeld <zerocom(at)cs.tu-berlin.de>\n\n\tSeveral patches for windows compatibility and fixing warnings.\n\n2010-11-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tPTHREAD_MUTEX_RECURSIVE on DragonFly is an enum.\n\n\tSF Bug Tracker - ID: 3104527\n\tSubmitted: OBATA Akio ( obache ) - 2010-11-07 07:10:28 BRST\n\n\tIn threadutil/inc/ithread.h, it is expected that\n\tPTHREAD_MUTEX_RECURSIVE is defined as macro. But on DragonFly BSD,\n\tit is defined as enum, so not works as expected.\n\n\tAttachment patch treat that DragonFly BSD always\n\thave PTHREAD_MUTEX_RECURSIVE.\n\n2010-11-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tftime(3) in -lcompat should not be checked.\n\n\tSF Bug Tracker - ID: 3104521\n\tSubmitted: OBATA Akio ( obache ) - 2010-11-07 07:03:44 BRST\n\n\tIn configure.ac\n\tAC_CHECK_FUNCS(ftime,, [AC_CHECK_LIB(compat, ftime)])\n\n\tBut since version 1.6.3, ftime(3) is not used, so it should be\n\tremoved, or introduce unwanted linkage with -lcompat.\n\n*******************************************************************************\nVersion 1.6.9\n*******************************************************************************\n\n2010-11-06 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for bug introduced in samples code in svn revision 502, commit\n\tgit:25c908c558c8e60eb386c155a6b93add447ffec0\n\n\tSample device and combo were aborting with the message:\n\t\"***** SampleUtil_Initialize was called multiple times!\"\n\n2010-11-06 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tMake multiple SSDP advertisements faster.\n\n\tPut the loop to send multiple copies of each SSDP advertisements in\n\tssdp_server.c instead of ssdp_device.c so we have only one call to\n\timillisleep ( SSDP_PAUSE ) to speed up advertisements.\n\n2010-11-05 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tRemoving unused NUM_COPY variable.\n\n\tPreviously, NUM_COPY was used in ssdp_device.c to send multiple copies \n\tof each advertisements but also multiple replies to each M-SEARCH\n\trequest. As sending multiple replies is not compliant with HTTPU/MU\n\tspec, NUM_COPY has been set to 1 in an older patch. However, as this\n\tvariable is not needed and has been replaced with SSDP_COPY, it has\n\tbeen removed.\n\n2010-11-05 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tUse SSDP_COPY to send multiple SSDP advertisements.\n\n\tCurrently, SSDP_COPY is used only to send multiple M-SEARCH requests (in\n\tssdp_ctrlpt.c). With this patch, SSDP_COPY is also used to send multiple\n\tcopies of each advertisements packets (in ssdp_device.c).\n\n2010-11-01 Carl Benson <carl.benson(at)windriver.com>\n\n\tFix for Android build.\n\n\tI had to do some modifications myself though, because the Android\n\tbuild system insists on having a file named \"util.h\" taking precedence\n\tin its include path, libupnp gets confused because of the same filename\n\tin upnp/src/inc/util.h\n\n*******************************************************************************\nVersion 1.6.8\n*******************************************************************************\n\n2010-10-20 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix a long date memory leak in webserver.c:StrStr().\n\n2010-10-19 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tBug fix in select of miniserver.c\n\t\n\tFix a bug in miniserver.c, in which maxMiniSock was wrongly declared as\n\tunsigned int and as a result it was beeng set to ((unsigned int)(-1)).\n\tAs a result, after beeing incremented, it became zero, and this value\n\twas beeing used in the select() call.\n\n\tThanks to Fabrice Fontaine for helping and testing with this issue.\n\n2010-10-15 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for 100% CPU issue in select() in miniserv.c. I have also removed\n\tthe sleep() call, it was just a workaround.\n\n\tSF Bug Tracker [ 3086852 ] 99% CPU loop in miniserver.c on a non ipv6\n\tsystem.\n\n\tSubmitted by: Jin ( jin_eld ) - 2010-10-13 19:29:13 UTC\n\n\tI cross compiled libupnp 1.6.7 for ARM9 using the --disable-ipv6\n\toption, my system is an ipv4 only setup.\n\n\tI do not know why this problem only appears when running the app in the\n\tbackground (for instance using nohup &), but then it starts using 99%\n\tCPU.\n\n\tI traced the problem down to the select() call in miniserver.c in the\n\tRunMiniServer() function. Select returns code 1, but errno is set to\n\t\"Socket operation on non-socket\", I also see this when running my app\n\tunder strace.\n\n\tI set all ...Sock6 variables to INVALID_SOCKET to make sure that they\n\tdo not get added to the FD_SET and the problem is gone.\n\n*******************************************************************************\nVersion 1.6.7\n*******************************************************************************\n\n2010-10-01 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAdding --disable-notification-reordering option\n\n\tAdding a configure flag to disable GENA notification reordering as even\n\twith an imillisleep(1), this mechanism consumes too much CPU on embedded\n\tdevices when there is a burst of notifications.\n\n2010-09-30 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tBug fix when there is no service in embedded devices\n\n\tWhen a device with embedded devices (like IGD) when created and one of\n\tthe embedded devices did not have any service, there was a Segmentation\n\tFault (see SF Tracker [ 2688125 ]).\n\n\tOriginal SF Tracker issue follows:\n\n\tSF Tracker [ 2688125 ] v1.6.6 crashes on subdevices without services\n\tSubmitted by: Arno Willig ( akw ) - 2009-03-15 22:45:23 BRT\n\n\tI discovered a bug, which will make libupnp (1.6.6) segfault, when you\n\tcreate a upnp description document with multiple devices which have\n\tsubdevices, but no own services.\n\n\tThe crash occurs in genlib/service_table.c in line 977:\n\tend->next =\n\t\tgetServiceList( currentDevice, &next_end, URLBase );\n\n\tIn this case \"end\" seems not to be defined, so end->next crashes.\n\n\tCan anyone confirm this, please?\n\n2010-09-28 Marc Essayan <marc.essayan(at)orange-ftgroup.com>\n\n\tBug fix on burst of GENA notification\n\n\tWhen a lot of notifications were generated by a device in a short\n\tperiod of time then 100% of the CPU was used to reorder those\n\tnotifications by pushing back the thread in the job queue. This\n\tmechanism has been modified so now thread sleep 1 ms before being\n\tpushed back into the job queue.\n\n\tRemoving DEFAULT_SCHED_PARAM parameter and use\n\tsched_get_priority_min(DEFAULT_POLICY) instead.\n\n2010-09-22 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tBug fix on M-SEARCH response\n\n\tDevices must respond to M-SEARCH requests for any supported version and the\n\tresponse should specify the same version as was contained in the search target.\n\tPreviously, the device did not answer if the M-SEARCH request did not\n\tcontain the same version number than the version number of the device.\n\n2010-09-21 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAdd Content-Language iff Accept-Language\n\n\tAdd Content-Language header in the response if and only if there is an\n\tAccept-Language header in the request.\n\n2010-09-21 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAddition of WEB_SERVER_CONTENT_LANGUAGE parameter\n\n\tThis patch adds the WEB_SERVER_CONTENT_LANGUAGE parameter so the user can specify\n\tthe language used by the device during Description and Presentation steps of UPnP\n\tthrough the HTTP CONTENT-LANGUAGE header.\n\tBy default, the WEB_SERVER_CONTENT_LANGUAGE is an empty string so no\n\tCONTENT-LANGUAGE is added.\n\n2010-09-18 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tCustomize the stack size of the threads used by pupnp through the new\n\tTHREAD_STACK_SIZE variable.\n\n\tThis patch allows a user to customize the stack size of the threads used by\n\tpupnp through the new THREAD_STACK_SIZE variable. This is especially useful\n\ton embedded systems with limited memory where the user can set THREAD_STACK_SIZE\n\tto ITHREAD_STACK_MIN.\n\n\tHowever, as this modification can have side effects, I set 0 as the default\n\tvalue, so threads will continue to use the default stack size of the system\n\t(which varies greatly as stated in\n\thttps://computing.llnl.gov/tutorials/pthreads/).\n\n2010-09-16 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tBroken IPv6.\n\tIPv6 is currently broken in latest release of branch-1.6.x, so find a\n\tpatch attached that correct the issue (small fixes on define, undef and\n\tretVal).\n\n2010-09-10 Warwick Harvey <warwick.harvey(at)tieto.com>\n\tPatch to take notice of UPNP_USE_RWLOCK flag\n\n\tThe configure.ac file included with UPnP checks for the presence of the\n\tpthread_rwlock_t type, and then sets the value of the UPNP_USE_RWLOCK\n\tflag appropriately.  However, this flag is not referenced at all in the\n\tsource code, and thus the code does not compile on systems that don't\n\thave the pthread_rwlock_t type (such as Android).\n\t\n\tPlease find attached a patch (against the current 1.6.x head) that checks\n\tthe value of this flag and falls back on using mutexes if read-write\n\tlocks are not available.\n\n2010-09-10 Jean Sigwald <jean.sigwald(at)orange-ftgroup.com>\n\tI discovered a reliable denial-of-service issue on the last stable\n\trelease of libupnp (1.6.6) remotely triggerable by any\n\tunauthenticated user. The issue is related with a bad parsing of\n\tmalformed XML.\n\n2010-09-10 Chandra Penke <chandrapenke(at)mcntech.com>\n\t* SF Patch Tracker [ 2854711 ] Patch for Solaris10 compilation and usage\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\t\n\tPatch for Solaris10 compilation and usage.\n\n2010-09-10 Chandra Penke <chandrapenke(at)mcntech.com>\n\tAdd support for conditionally enabling ipv6.\n\n2010-09-10 Chandra Penke <chandrapenke(at)mcntech.com>\n\tFix for compilation in debug builds.\n\n\tEnsure internal methods are declared as static since debug builds don't inline.\n\n2010-09-09 Chandra Penke <chandrapenke(at)mcntech.com>\n\tFix for regression in SSDP code to send/receive messages over UDP\n\n\tSending messages over UDP is broken in some Apple OSes\n\tsuch as OS X and iOS. This might be broken in other OSes to but didn't\n\tverify.\n\n\tThe fix is to modify the socket lenght argument of sendto to use the correct\n\tsockaddr lenght dependng on whether the socket is IPV4 or IPV6.\n\n\tAlso added some error checks and debugging related to the issue\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tUsing UpnpReadHttpGet to download large files causes the application to\n\tcrash. This happens when the file being downloaded exceeds the device\n\tmemory - entirely possible when transferring video files.\n\tThe programmatic cause is that the logic implemented in the function\n\thttp_ReadHttpGet (which UpnpReadHttpGet calls) reads the entire file\n\tinto memory. The fix modifies the existing logic to discard data after\n\tit's been read; there's no reason to keep it around since the caller\n\tof UpnpReadHttpGet already has a copy of it.\n\t\n\tThis issue exists in 1.6.6 as well as the latest sources.\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tIn the latest sources, http_RequestAndResponse and other methods that\n\tuse connect() are broken. More specifically, connect() in these methods\n\tis returning with an EINVAL. The programatic cause is that the address_len\n\targument passed to connect() is different in IPV4 vs IPV6 (as described in:\n\thttp://www.opengroup.org/onlinepubs/009695399/functions/connect.html).\n\tThe current code always uses the IPV6 size. The fix modifies each use of\n\tconnect() to use the correct size based on the address family being used.\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tFix compilation error in upnp/src/gena/gena_ctrlpt.c (this is most\n\tlikely an error on all platforms).\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tFix compilation error in upnp/src/inc/ssdplib.h when compiling in OS X\n\t(the netinet/* headers are not available).\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tFix compilation error in ixml/inc/ixml.h when compiling with an\n\tObjective-C compiler (when cross-compiling for iPhone devices).\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Issue regarding the GENA notifications. A string termination indicator\n\twas added at the end of the notification (\"\\r\\n\") in\n\tnotify_send_and_recv() in upnp/src/gena/gena_device.c.\n\tPatch by Fabrice Fontaine.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* The last part of Ronan Menard's patch.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* upnp/src/ssdp/ssdp_device.c: Fix for IPV6 ULA/GUA issues.\n\t* upnp/src/ssdp/ssdp_ctrlpt.c: Fix for IPV6 ULA/GUA issues.\n\t* upnp/src/ssdp/ssdp_server.c: Fix for IPV6 ULA/GUA issues.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* upnp/src/genlib/miniserver/miniserver.c: Fix for IPV6 ULA/GUA issues.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* gena_subscribe(): Fix for IPV6 ULA/GUA issues.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SOCKET ssdpSock6UlaGua: created variable for later use.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SSDP_IPV6_SITELOCAL: new macro.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* The scope of the macro NUM_HANDLE is now restricted to upnpapi.c.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* InitHandleList() has never been implemented, I guess no one has ever\n\tcalled it, so remove it.\n\t* GetFreeHandle() and FreeHandle() are now static as they should.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* New internal buffer added to store global/ula IPV6 address.\n\t* Macros to test whether an IPV6 address is global or ula.\n\t* UpnpGetServerUlaGuaIp6Address(): added interface.\n\t* IN6_IS_ADDR_GLOBAL, IN6_IS_ADDR_ULA: new macros.\n\t* gIF_IPV6_ULA_GUA: new buffer.\n\t* UpnpRegisterRootDevice3(): Change to the test of already registered\n\tdevices for IPV6.\n\t* UpnpGetIfInfo(): gua/ula issues.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* libUPnP does support IPV6 now.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* HTTP version equal to 1.0 should fail as required by the UPnP\n\tcertification tool. Patch submitted by Ronan Menard.\n\n2010-06-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSF Bug Tracker [ 3022490 ] String declaration fix for patch applied in 3007407\n\tHello,\n\n\tWhen my patch for tracker ID 3007407 was accepted, the definition of the\n\tserviceList string was changed from\n\n\t#define SERVICELIST_STR \"serviceList\"\n\n\tto\n\n\tstatic const char *SERVICELIST_STR = \"serviceList\";\n\n\tDuring internal code review of the final patch, it was pointed out that \n\tsizeof(SERVICELIST_STR) == 4 since SERVICELIST_STR is now declared as\n\ta pointer instead of an array.\n\n\tIf you wish to use a variable instead of a define, I suggest the\n\tfollowing instead:\n\n\tstatic const char SERVICELIST_STR[] = \"serviceList\";\n\n\tThanks,\n\tChuck Thomason\n\n2010-06-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSF Bug Tracker [ 3007407 ] Service traversal issue in AdvertiseAndReply()\n\tSubmitted: Chuck Thomason ( cyt4 ) - 2010-05-26 15:07:39 UTC\n\n\tWhen the UPnP server is started, one alive message is broadcast for each\n\tservice in each device. It appears that libupnp's implementation of the\n\talive message generation does not correctly navigate the XML description\n\tdocument when locating the services. This can result in the wrong UDN\n\tbeing used in the alive message sent for a service.\n\n\tIn my specific case (see attached XML), the root EchoSTB device contains\n\tno services, but its embedded MediaServer device contains 2 services.\n\tWhen the existing libupnp code traverses the EchoSTB device in the XML,\n\tit searches the global list of serviceLists within the document instead\n\tof searching for a serviceList that is its direct child node. The\n\tContentDirectory and ConnectionManager services are then announced with\n\tthe UDN of EchoSTB1 (the root device) instead of with the UDN of\n\tMediaServer, which is actually their parent device.\n\n\tI discovered this behavior using libupnp-1.6.6. I have generated a patch\n\tagainst branch-1.6.x that corrects the XML navigation such that all\n\tservices are traversed from their parent device, which results in the\n\tcorrect UDN being sent in the alive message for each service. I built\n\tfrom branch-1.6.x without this patch, tested, and confirmed that the\n\tissue still exists as I observed it in libupnp-1.6.6. I then built\n\tfrom branch-1.6.x with this patch, tested, and confirmed that the\n\tissue was resolved.\n\n\tThanks,\n\tChuck Thomason\n\n2010-05-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSF Bug Tracker [ 2995758 ] libupnp 1.6.6, wrong bind when reuseaddr is\n\t1.\n\tSubmitted: viallard anthony ( homer242 )\n\tWhen trying to use reuseaddr option in miniserver/miniserver.c, there\n\tisn't a affectation of the port chosen (serverAddr.sin_port isn't\n\treceive listen_port variable value).\n\n2010-04-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tDefine PROTOTYPES to be one by default in global.h. This affects the\n\tRSA MD5 code.\n\n2010-03-27 Nick Leverton <nick@leverton.org>\n\tSubscription auto-renewals copy the renewal time from old subscription.\n\n2010-03-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added API to ithread, created the following functions:\n\t- int ithread_initialize_library(void);\n\t- int ithread_cleanup_library(void);\n\t- int ithread_initialize_thread(void);\n\t- int ithread_cleanup_thread(void);\n\t* SF Bug Tracker [ 2876374 ] Access Violation when compiling with Visual Studio 2008\n\tSubmitted: Stulle ( stulleamgym ) - 2009-10-10 19:05\n\n\tHi,\n\n\tI am one of the devs of the MorphXT project and I use this lib in some\n\tother of my projects, too. When I tried to upgrade the lib earlier for one\n\tof my projects I had to realise that something did not work at first and\n\twhile most of the things were reasonably ease to be fixed. Now, the last\n\tthing I encountered was not so easy to fix and I am uncertain if my fix is\n\tany good so I'll just post it here and wait for some comments.\n\n\tThe problem was that I got an Access Violation when calling \"UpnpInit\". It\n\twould call \"ithread_rwlock_init(&GlobalHndRWLock, NULL)\" which eventually\n\tled to calling \"pthread_cond_init\" and I got the error notice at\n\t\"EnterCriticalSection (&ptw32_cond_list_lock);\". It appeared that\n\t\"ptw32_cond_list_lock\" was NULL. Now, I found two ways to fix this. Firstly\n\tmoving the whole block after at least one of the \"ThreadPoolInit\" calls\n\twill fix the issue. Secondly, you could add:\n\t#ifdef WIN32\n\t#ifdef PTW32_STATIC_LIB\n\t// to get the following working we need this... is it a good patch or\n\tnot... I do not know!\n\tpthread_win32_process_attach_np();\n\t#endif\n\t#endif\n\tright before \"ithread_rwlock_init(&GlobalHndRWLock, NULL)\".\n\n\tJust so you know, I am using libupnp 1.6.6 and libpthreads 2.8.0 and both\n\tare linked static into the binaries. I am currently using Visual Studio\n\t2008 for development with Windows being the target OS. Any comment at your\n\tend?\n\n\tRegards, Stulle\n\n2010-03-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2836704 ] Patch for Solaris10 compilation and usage.\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\tThis second part covers the issue on linking with -lsocket -lnsl -lrt.\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 2392166 ] ithread_detach not called for finished worker thread\n\tSubmitted: Ulrik ( ulsv_enea ) - 2008-12-05 08:24\n\n\tValgrind reports a memory leak due to that the function ithread_detach is\n\tnot called for finished worker threads in ThreadPool.c.\n\n\t==21137== 2,176 bytes in 8 blocks are possibly lost in loss record 5 of 5\n\t==21137== at 0x4C20F3F: calloc (vg_replace_malloc.c:279)\n\t==21137== by 0x4010F58: _dl_allocate_tls (in /lib/ld-2.6.1.so)\n\t==21137== by 0x544BA92: pthread_create@@GLIBC_2.2.5 (in\n\t/lib/libpthread-2.6.1.so)\n\t==21137== by 0x5F94592: CreateWorker (ThreadPool.c:639)\n\t==21137== by 0x5F95079: ThreadPoolInit (ThreadPool.c:784)\n\n\tI'm using libupnp 1.6.6\n\n\tFor more info on pthread_detach, see:\n\thttp://gelorakan.wordpress.com/2007/11/26/pthead_create-valgrind-memory-lea\n\tk-solved/\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 2392304 ] Memory leak in SSDP AdvertiseAndReply\n\tSubmitted: Ulrik ( ulsv_enea ) - 2008-12-05 08:24\n\n\tValgrind reports a memory leak function in AdvertiseAndReply\n\t(ssdp/ssdp_server.c) in libupnp 1.6.6\n\n\tThere are continue statements in many places in AdvertiseAndReply. In some\n\tof those error handling cases the variable nodelist is not free'ed before\n\tcontinuing to the next iteration. The next iteration will take care of\n\tfree'ing the nodelist from the previous iteration in most cases, but not\n\twhen breaking out of the for loop after the last element.\n\n\tI belive this memory leak can be solved by makeing sure that the rows\n\n\tixmlNodeList_free( nodeList );\n\tnodeList = NULL;\n\n\tare always executed, also in the beginning of the last iteration when we\n\tfound out that there are not more elements.\n\n\t==29110== at 0x4C21C16: malloc (vg_replace_malloc.c:149)\n\t==29110== by 0x5D8DE0E: ixmlNodeList_addToNodeList (nodeList.c:106)\n\t==29110== by 0x5D8B7E2: ixmlNode_getElementsByTagNameRecursive\n\t(node.c:1438)\n\t==29110== by 0x5D8E587: ixmlElement_getElementsByTagName\n\t(element.c:491)\n\t==29110== by 0x5B6C0F1: AdvertiseAndReply (ssdp_server.c:201)\n\t==29110== by 0x5B7AB74: UpnpSendAdvertisement (upnpapi.c:1495)\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* libupnp and multi-flows scenario patch\n\tSubmited by Carlo Parata from STMicroelectronics.\n\n\tHi Roberto and Nektarios,\n\tafter an analysis of the problem of libupnp with a multi-flows scenario, I\n\tnoticed that the only cause of the freezed system is the ThreadPool\n\tmanagement. There are not mutex problems. In practise, if all threads in the\n\tthread pool are busy executing jobs, a new worker thread should be created if\n\ta job is scheduled (I inspired to tombupnp library). So I solved the problem\n\twith a little patch in threadutil library that you can find attached in this\n\te-mail. I hope to have helped you.\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2964973 ] install: will not overwrite just-created\n\t...blah... with...\n\tSubmitted: Nick Leverton ( leveret ) - 2010-03-07 05:18\n\n\tFull error:\n\t/usr/bin/install: will not overwrite just-created\n\t`/tmp/buildd/libupnp-1.6.6/debian/tmp/usr/share/doc/libupnp3-dev/examples/s\n\tample_util.c' with `common/sample_util.c'\n\n\tThis seems to be from Automake 1.11 which doesn't like having duplicate\n\tfiles in a Makefile.am. Patch attached, kindly provided by Stefan Potyra\n\tfor Debian (http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=543068)\n\n\tThis fix will be needed for both 1.6.x and 1.8.x branches.\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Backport of svn revision 504:\n\tSF Patch Tracker [ 2969188 ] 1.8.0: patch for FreeBSD compilation\n\tSubmitted By: Nick Leverton (leveret)\n\tFix the order of header inclusion for FreeBSD.\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2836704 ] Patch for Solaris10 compilation and usage.\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\tObs by Marcelo: The issue with linking with -lsocket -lnsl -lrt is not\n\tcovered in this changeset beacuse I don't have solaris to test. I will\n\tneed some help from zephyrus in this regard. The issue will be addressed\n\tin a future changeset.\n\n\tCompilation for solaris\n\n\tI have used gcc3.x and gcc4.x under solaris 10 for x86 / 64 bits.\n\n\tA couple of Source file fixes were necessary for successful compilation\n\tand runtime behavior.\n\n\tthreadutil/src/ThreadPool.c\n\n\tPOSIX\n\tsched_setschduler() returns non-negative value for success.\n\n\tWithout the fix, UpnpInit() fails immediately.\n\n\tupnpp/src/api/upnpai.c\n\n\tThere is a typo of a macro name \"__sun\" in one of the\n\tCPP conditional.\n\tWithout the fix, the compilation aborts due to unknown constant\n\tin socket ioctl call.\n\n\tA few structs and an array is not properly initialized.\n\tWell, I think it may be safe as is, but when I checked it\n\tusing purify evaluation version, it was reported that\n\tuninitizlied iszBuffer may cause read of uninitialized memory.\n\tSo play it safe.\n\n\tConfigure issue.\n\tThis has to be more of a configure magic.\n\tTo link a program successfully using network, we need\n\t-lsocket and -lnsl library specifications on the link line.\n\tWe also need -lrt for programs that use thread scheduling features.\n\n\tThe sample program under upnp/sample requires\n\t-lsocket -lnsl -lrt\n\tfor successful linking.\n\tI added -lsocket -lnsl -lrt to Makefile.in.\n\tconfigure probably needs to take care of these.\n\n\tI don't know much about configure, automake, etc., so\n\tI am just raising a flag here.\n\n\tTIA\n\t\n2010-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2836704 ] Search for nested serviceList (not\n\tstopping at the first lis\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\t\n\tInternet Gateway Device description contains nested serviceList (rootdevice\n\t-> servicelist, subdevice\n\tand subdevice has the lower-level serviceList, etc..)\n\n\tUnfrotunately, the sample code sample_util.c used by tv_device sample,\n\tetc.\n\thas a code that looks for only the first top-level serviceList.\n\tThis results in the failure to read all the services of an IGD xml\n\tdescription.\n\n\tAttached patch modifies this behavior and looks for the service by\n\tvisiting all the serviceList in xml document in turn.\n\n\tWith the modified patch (ad additional modification), I could\n\tsimulate an IGD device and created a modified control program for that.\n\n\tPatch against 1.6.6\n\n\tTIA.\n\t\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2203721 ] timeb.h check obsolete\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2970872 ] Update ErrorMessages for latest return\n\tcode list\n\tSubmitted By: Nick Leverton ( leveret )\n\t\n\tErrorMessage[] in upnptools.c has got a bit out of sync, the attached\n\tpatch (generated from grep 'define UPNP_E_') should bring it up to date.\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2857611 ] Declare a few functions to have proper\n\t(void) argument list.\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\t\n\tIn a publicly installed headers, a few functions are declared without any\n\targuments at all, a la \"()\".\n\tWhen I used gcc's -Wimplict and -Wstrict-prototypes to check for the\n\tmismatch of\n\tfunction prototype declarations and their usage in my own program,\n\tsome headers from libupnp-1.6.6 produced warnings.\n\n\tThey are not strictly bugs, but pretty much annoying. This is 2009, and\n\talmost all the important compilers\n\tunderstand ISO-C.\n\n\tSo the offending functions are declared as \"(void\") to show that they have\n\tno arguments at all.\n\n2010-03-14 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2546532 ] Missing carriage return between\n\tSOAPACTION and User-Agent headers.\n\n\tThere is something going wrong in soap_ctrlpt.c at line 931 (based on\n\tversion 1.6.6 release).\n\t\n\tThe http_Makemessage call looks as follows:\n\t\n\tif (http_MakeMessage(\n\t&request, 1, 1,\n\t\"Q\" \"sbc\" \"N\" \"s\" \"s\" \"Ucc\" \"sss\",\n\tSOAPMETHOD_POST, path.buf, path.length,\n\t\"HOST: \", host.buf, host.length,\n\tcontent_length,\n\tContentTypeHeader,\n\t\"SOAPACTION:\n\t\\\"urn:schemas-upnp-org:control-1-0#QueryStateVariable\\\"\",\n\txml_start, var_name, xml_end ) != 0 ) {\n\treturn UPNP_E_OUTOF_MEMORY;\n\t}\n\t\n\tThis will result in the SOAPACTION header to be immediately followed by the\n\tUser-Agent header, while a cr-lf should separate the two. I propose to fix\n\tthis by changing the second \"s\" to \"sc\" to force the addition of a cr-lf\n\tafter the SOAPACTION. This looks consistent to the other Makemessage calls.\n\n2009-03-06 Oxygenic <oxygenic(at)users.sourceforge.net>\n\t* parameter problem fixed in soap_request_and_response(), 2nd call to\n\thttp_RequestAndResponse() was wrong (thanks to Kim Kyungsan)\n\n2008-07-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added upnp/m4/libupnp.m4 to the distribution tarball.\n\n2008-07-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a missing HandleUnlock() in upnp/src/gena/gena_device.c.\n\n2008-07-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 2026431 ] pupnp does not build on GNU/KfreeBSD.\n\tSubmitted By: Nick Leverton - leveret\n\tGnu/KFreeBSD is one of the Debian architectures, it includes a FreeBSD\n\tkernel with GNU userspace (glibc etc). The Gnu/KfreeBSD developers\n\tprovided the attached patch to test the appropriate #define and allow pupnp\n\tto build in their environment, and asked me to forward it to you.\n\n\tSince the test is a simple check for defined(__GLIBC__), this would\n\tpresumably also help with other ports of GNU libc to non-Linux kernels.\n\n2008-07-16 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Andre Sodermans (wienerschnitzel) patch for building libupnp under\n\twindows systems with VC9. This one fixes a missing include.\n\n2008-06-30 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added an m4 macro to deal with finding libupnp in the users'\n\tconfigure script.\n\n2008-06-11 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a buffer overflow due to a bug in the calculation of the\n\tCONTENT-TYPE header line size, the length was beeing calculated with\n\tthe wrong string, there was a missing colon.\n\n2008-06-02 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1942285 ]\n\tUpnpCreatePropertySet can leak memory.\n\tSubmitted By: Bob Ciora - bobciora\n\n\tIn file upnp/src/api/upnptools.c, function UpnpCreatePropertySet can leak\n\tmemory if no additional arguments are passed. This is because of the\n\t'return' statement at (or near) line 554.\n\n\tThe prior call to ixmlParseBufferEx may succeed. This causes a basic ixml\n\ttree to be created. The return statement at line 554 leaves this tree in\n\tmemory without cleaning it up.\n\n\tThere are two options: either add code prior to the return at 554 to clean\n\tup the tree, or simply allow a NumArg parameter of 0 to be passed.\n\n\tI prefer the second method -- there doesn't seem to be any need to pass\n\t*any* arguments to this function.\n\n\tIn my local copy of upnptools.c, I have simply replaced the \"return NULL\"\n\tin line 554 to \"return PropSet\".\n\n\tI've attached the source file.\n\n2008-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1903069 ]\n\tSubs (not services) not marked 'active'\n\tSubmitted By: Bob Ciora - bobciora\n\n\tIf the UpnpAcceptSubscription is not called, the subscription is not marked\n\tas \"active\", so no state variables will ever be sent.\n\n\tI have a \"lazy\" architecture where a service may not be ready to publish\n\tany state data at the time of a subscription. Subscriptions are still\n\taccepted, there's just nothing to send, so UpnpAcceptSubscription is never\n\tcalled. As a result, the subscription is never marked as \"active\" via the\n\tgenaInitNotify functions.\n\n\tA best course of action would be to modify UpnpAcceptSubscription<...>\n\tfunctions so that they can accept *no* initial state information, but can\n\tstill result in the subscription being marked as active. Technically,\n\tthen, the \"active\" flag should be set here, not in the genaInitNotify<...>\n\tfunctions.\n\n\tBut the UpnpAccept functions don't muck with the subscription table, and\n\tit's more work than it's worth to move that code from the gena fucntions to\n\tthe upnpapi functions.\n\n\tSo--- what I've done to correct this problem is to modify both\n\tUpnpAcceptSubscription<...> functions (in upnppapi.c) to accept an empty\n\tstate list and still call the gena layer functions. The gena layer\n\tgenaInitNotify<...> functions (gena_device.c) then mark the subscription as\n\t\"active\" *before* checking for an empty state set.\n\n\tIn genaInitNotify, a check for \"var_count <= 0\" is added immediately after\n\tthe \"subs->active = 1;\" line. If this occurs, then all cleanup is\n\tperformed and the function returns GENA_SUCCESS (since now, an empty state\n\tlist is not an error). The same check is made for \"PropSet == 0\" in\n\tgenaInitNotifyExt (just after the \"subs->active = 1;\" line).\n\n\tI've modifified my proxy layer to call UpnpAcceptSubscriptionExt even when\n\tthere is no state data to send. With the suggested changes to\n\tgena_device.c, later state changes are sent correctly.\n\n\tThis has solved my problem.\n\n2008-04-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix in function SetSeed() in threadutil/src/ThreadPool.c for CYGWIN\n\tcompilation. Thanks to Gary Chan.\n\n*******************************************************************************\nVersion 1.6.6\n*******************************************************************************\n\n2008-04-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added thread id's to the UpnpPrintf debug messages. Thanks to\n\tCharles Nepveu for the idea.\n\n2008-04-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t*  SF Bug Tracker [ 1948586 ]\n\tUppercase U in in \"xmlns:U\" in Invoke Action causes seg. f.\n\tSubmitted By: Thomas Norheim - kjakan_no\n\tDevice no longer segfaults with the following malformed xml action:\n\t<u:SetColor xmlns:U=\"urn:schemas-upnp-org:service:tvpicture:1\">\n\t\t<Color>2</Color>\n\t</u:SetColor>\n\n2008-04-23 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Use -O0 in debug builds so that variables do not get optimized out.\n\n2008-04-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Apostolos Syropoulos changes for OpenSolaris x86.\n\n2008-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Andre Sodermans (wienerschnitzel) patch for building libupnp under\n\twindows systems with VC9.\n\n2008-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Andre Sodermans (wienerschnitzel) patch for building libupnp under\n\twindows systems with VC8.\n\n2008-03-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a printf format problem on the upnp_tv_device.c from both\n\tupnp/sample/tvdevie and upnp/sample/tvcombo directories. The variable\n\tport was a short int instead of an unsigned short and it was beeing\n\tprint as a negative value.\n\n2008-03-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1902668 ] Cannot compile on MSVC\n\tSubmitted By Luke Kim - nereusuj\n\tVersion 1.6.5 cannot be compiled because of some changes in 1.6.3.\n\tMSVC does not support stdint.h, gettimeofday(), sys/param.h, const int\n\tvariables in array size and Windows does not define _WINDOWS_ but define\n\t_WINDOWS.\n\t* MSVC does not understand \"const int\"'s as declarators of array\n\tdimensions, we must use #define'd constants.\n\t* Use WIN32 instead of _WINDOWS_ or _WINDOWS.\n\n2008-02-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* No longer ignore \"upnp:rootdevice\" advertisement. Thanks to Bob Ciora.\n\n2008-02-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Changed \"sys_errlist[errno]\", which is deprecated, by\n\t\"strerror_r()\", which is thread safe.\n\n2008-02-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Slightly improved error report by showing the sys_errlist string\n\tcorresponding to errno.\n\n2008-02-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Got rid of two useless constants: UPNP_SOCKETERROR and\n\tUPNP_INVALID_SOCKET. They both mean the same, that a network API\n\tfunction has failed. -1 is the value to check, not an invented constant.\n\n*******************************************************************************\nVersion 1.6.5\n*******************************************************************************\n\n2008-02-02 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Peter Hartley's fix for wrong sized variable beeing passed to\n\thttp_MakeMessage() on 64 bit architectures.\n\n\n*******************************************************************************\nVersion 1.6.4\n*******************************************************************************\n\n2008-01-23 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Workaround for a problem with the new automake AM_CONDITIONAL macro\n\tfrom autotools-1.10. Thanks to Ingo Hofmann for helping with debugging\n\tthis one.\n\n2008-01-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added quoting to macros AC_CONFIG_AUX_DIR, AC_CONFIG_MACRO_DIR and\n\tAC_CONFIG_SRCDIR in configure.ac. Also changed the name of the\n\tauxiliary directory in AC_CONFIG_AUX_DIR to build-aux.\n\n2008-01-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for setsockopt() in Threadpool.c to allow more than one process\n\tto join the multicast-group on OSX. Thanks to Ingo Hofmann.\n\n2008-01-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Using defined(__OSX__) || defined(__APPLE__) instead of just\n\tdefined(__OSX__) in the code. Thanks to Ingo Hofmann and Chris\n\tPickel.\n\n2008-01-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for isFileInVirtualDir. Thanks to Peter Hartley for the patch.\n\n2008-01-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Putting back a \"defined(__OSX__)\" that has been removed in the\n\tprevious *BSD patch. Thanks to Chris Pickel for pointing it out.\n\n2008-01-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patches Tracker [ 1865812 ] typo in docs comment\n\tSubmitted By: Hartmut Holzgraefe - hholzgra\n\ttypo in docs comment ACCAPTED instead of ACCEPTED in\n\t@name UPNP_E_UNSUBSCRIBE_UNACCAPTED [-302]\n\tAlso, the documentation file name was mispelled and was corrected in\n\tthe Makefile.am.\n\n*******************************************************************************\nVersion 1.6.3\n*******************************************************************************\n\n2007-12-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Using pthread flags for the whole project, not just at the places\n\tindividually indicated by several Makefile.am files spread all over\n\tthe directories. That was too much error prone.\n\n2007-12-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added a configure test to check if pthread_rwlock_t is available.\n\tDefine _GNU_SOURCE if needed. The fallback behaviou will only be\n\timplemented if _GNU_SOURCE prooves to be insufficient on some\n\tplatforms. Thanks to Jonathan Casiot (no_dice) and Robert Gingher\n\t(robsbox).\n\n2007-12-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removed unused iasnprintf.{c,h} files.\n\n2007-12-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removed STATSONLY() macro from ThreadPool.{c,h}.\n\t* Removed time() usage from ThreadPool.c.\n\t* Fixed STATS = 0 compilation.\n\n2007-12-16 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Library was not compiling on FreeBSD 7. Code now no longer uses\n\tftime(), using gettimeofday() instead. Thanks to Josh Carroll.\n\n\n*******************************************************************************\nVersion 1.6.2\n*******************************************************************************\n\n2007-12-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a compilation error due to a missing #ifdef in\n\tupnp/src/genlib/miniserver/miniserver.c. Thanks to Eugene Christensen.\n\n2007-11-12 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* \"make check\" was failing because ixml/test/test_document.sh did not\n\thave the executable flag set. Thanks to Steve Bresson.\n\n2007-11-12 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a memory leak in upnpapi.c to delete gMiniServerThreadPool in\n\tthe call to UpnpFinish(). Thanks to Fabrice Fontaine.\n\n2007-11-09 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added a isleep() call to the error handler of select() in\n\tRunMiniServer(), so that it does not take 100% cpu in case select()\n\tfails repeatedly.\n\n*******************************************************************************\nVersion 1.6.1\n*******************************************************************************\n\n2007-11-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1825278 ] AdvertiseAndReply sleeps with handle lock out\n\tApplied patch from Alex (afaucher) to change some write locks to read\n\tlocks.\n\n2007-11-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Adjusting libtool library numbers to reflect the last changes.\n\n2007-11-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1825278 ] AdvertiseAndReply sleeps with handle lock out\n\tGlobalHndMutex, which was a mutex is now GlobalHndRWLock, which is a\n\trwlock. HandleLock() is mapped to HandleWriteLock() while all other\n\tinstances have not been checked. One instance in AdvertiseAndReply()\n\thas been changed to HandleReadLock(). Thanks to Alex (afaucher) for the \n\tbug report and suggestions.\n\n2007-11-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added support for rwlocks.\n\n2007-11-05 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1825929 ] woker thread still alive after UpnpFinish()\n\tSubmitted By: Luke Kim - nereusuj\n\tWorker thread still alive after calling UpnpFinish() because\n\tThreadPoolShutdown() is in the #ifdef DEBUG block.\n\t421\n\t422 #ifdef DEBUG\n\t423 ThreadPoolShutdown( &gSendThreadPool );\n\t424 ThreadPoolShutdown( &gRecvThreadPool );\n\n2007-08-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Changed the calls to virtualDirCallback.open(filename, UPNP_WRITE)\n\tto (virtualDirCallback.open)(filename, UPNP_WRITE) (notice the\n\tparenthesis) due to a change in glibc that produces compilation\n\terrors.\n\n2007-08-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Initialization of the \"randomness\" struct so that valgrind does not\n\tcomplain.\n\n2007-08-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Merge of patch submitted By Keith Brindley - brindlk\n\tSF Bug Tracker [ 1762758 ] Seek not working for large files\n\tProblem:\n\tRequests from the uPnP client to seek to a position beyond 2GB in a large\n\tfile are handled as a request to see from the 2GB point.\n\n\tImpact:\n\tVaries depending on client. The Xbox 360 kills the connection when it\n\trealises.\n\n\tSolution:\n\tGetNextRange function (webserver.c) is updated to handle large file sizes.\n\tFix should also recognise when built on a 32bit platform rather than 64 and\n\thandle accordingly.\n\n2007-08-05 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Merge of Mac OS X patch from St\u00e9phane Corth\u00e9sy (davelopper),\n\tSF Bug Tracker [ 1686420 ] Modifications for MacOSX.\n\tSome of the proposed changes were already done by Rene Hexel's patch.\n\n*******************************************************************************\nVersion 1.6.0\n*******************************************************************************\n\n2007-06-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* More fixes to Mac OS X and NetBSD from Rene Hexel:\n\t[pupnp-devel] NetBSD & Mac OS X packages and patches\n\n\t  Okay, I found a couple more things.  I have attached a patch file\n\tagainst the trunk (version 206) that make the repository code compile\n\tand run on both Mac OS X and NetBSD.\n\n\tThis fixes the following issues:\n\n\t   upnp/src/api/upnpapi.c: SIOCGIFCONF didn't work properly, use\n\tgetifaddrs() instead (on BSD systems).\n\n\t  threadutil/src/ThreadPool.c: priorities only work if\n\t_POSIX_PRIORITY_SCHEDULING is defined (and greater than 0).\n\n\t  threadutil/src/LinkedList.c and threadutil/src/iasnprintf.c: use\n\tstdlib.h instead of malloc.h on all BSD systems (not just FreeBSD).\n\tThis is important, because malloc.h does not exist on Darwin/Mac OS X.\n\n\t  Cheers\n\t      ,\n\t   Rene\n\n2007-06-09 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* [pupnp-devel] NetBSD & Mac OS X packages and patches.\n\tRene Hexel's <rh@netbsd.org> patch to compile in NetBSD and Mac OS X.\n\n2007-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Updated the macro files acx_pthread.m4, ax_cflags_gcc_option.m4,\n\tax_cflags_warn_all.m4, m4/ax_cflags_warn_all_ansi.m4,\n\tm4/type_socklen_t.m4.\n\n2007-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed an issue with the instalation of the file upnpdebug.h. Since\n\tthe last modifications that removed the macro DEBUV_ONLY, this file\n\tmust be installed even on a non-debug build.\n\n2007-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1711325 ] Bad DestAddr in Upnp_Discovery structure\n\tSubmitted By: Bob Ciora\n\tThe field DestAddr of the structure Upnp_Discovery is now a full\n\tSOCKADDRIN instead of a pointer to SOCKADDRIN. Commented code sugests\n\tthat in a previous moment, the function ssdp_handle_ctrlpt_msg() did\n\tnot use a postponed thread to call ctrlpt_callback(). Now the code\n\tuses a thread, and most probably the original data would get lost and\n\tthe pointer would point to an invalid memory region. This fix caused\n\tan interface change in the library and the minor library version was\n\tbumped. Also, the libtool library numbers were changed accordingly.\n\n*******************************************************************************\nVersion 1.4.7\n*******************************************************************************\n\n2007-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added support for the Basic Device\n\t(http://www.upnp.org/standardizeddcps/basic.asp) as suggested by\n\tTitus Winters.\n\n2007-05-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed the file libupnp.pc.in to generate a correct path for the\n\tinclude files.\n\n2007-05-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removing the Dbg_Level, InitLog, SetLogFileNames and CloseLog\n\tdefines. These were just aliases, no reason to keep them.\n\n2007-05-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Changed the comments of the include files that expose the UPnP API\n\tto use only C89 comments and no C99 comments.\n\n2007-05-24 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* Added tvcombo sample that demonstrates coexistence of a device and a\n\tcontrol point in the same application.\n\n2007-05-24 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* SF Tracker FR [ 1570020 ].\n\t* Enable both device and control point in the same application. Resolve\n\tdeadlock in the SSDP processing threads.\n\t* Fix Threadpool expansion condition.\n\tThanks to Siva Chandran P. for the original patch.\n\n2007-05-24 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* Modified tvdevice (control and picture) service descriptions to make\n\tcompatible with WinXP/IE control point. 'in' arguments must appear before\n\t'out' arguments in argument list.\n\tThanks to Martin Tremblay for pointing out the solution originally provided\n\tby MORIOKA Yasuhiro.\n\n2007-05-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* More MSVC fixes, using XINLINE instead of inline, MSVC has troubles\n\twith inline. Thanks to David Maass for reporting.\n\t* Changed XINLINE to UPNP_INLINE.\n\n2007-05-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added the file build/inc/msvc/inttypes.h. This file is for use with\n\tMSVC only, because it does not provide C99 compatibility.\n\n2007-05-18 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removed all uses of the DEVICEONLY(x) macro.\n\n2007-05-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removed all uses of the DBGONLY(x) macro. A static inline empty\n\tfunction now is used and the compiler takes care of optimizing it out.\n\n2007-05-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a bug in UpnpPrintf, function could call va_start() and return\n\tbefor calling va_end().\n\n2007-05-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* EXPORT_SPEC missing on some declarations in ixml/inc/ixml.h.\n\tThanks to David Maass.\n\n2007-05-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* sizeof is unsigned, so %zu is more adequate than %zd.\n\n2007-05-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Using an invented printf directive PRIzu that on MSVC\n\texpands to \"lu\", and on normal C99 compilers expands to \"zu\".\n\n2007-05-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Rewrote raw_find_str. Now it no longer uses strcasestr(), but it\n\ttransforms the first input buffer into lowercase.\n\n2007-05-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for debug printf format strings. size_t are not expected\n\tin a string format like \"%.*s\".\n\n2007-05-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added inttypes.h as a header requirement in configure.ac.\n\n2007-05-11 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Moved upnp_tv_ctrlpt and upnp_tv_device executables from folder\n\tupnp to folder upnp/sample. Moved folder upnp/sample/tvdevice/web\n\tto folder upnp/sample/web. This way, if someone compiles the\n\ttarball and executes upnp_tv_device from its creation directory,\n\tthere will be no error -108 for not finding directory web.\n\n*******************************************************************************\nVersion 1.4.6\n*******************************************************************************\n\n2007-04-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for freebsd host_os in configure.ac.\n\n*******************************************************************************\nVersion 1.4.5\n*******************************************************************************\n\n2007-04-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Case insensitive comparison in raw_find_str() (httpparser.c) as\n\tsuggested by Craig Nelson in SF Tracker [ 1689382 ] DLINK DIR-625\n\tpatch.\n\n2007-04-07 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* Fix for a bug in makeAction where va_arg was beeing called one\n\textra time.\n\n2007-04-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Tracker [ 1703533 ] Patch to make it compile under FreeBSD\n\tSubmitted By: Timothy Redaelli - drittz\n\tI made some patches to make it compile under FreeBSD using\n\tgethostbyaddr_r when supported.\n\n2007-04-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* [pupnp-devel] Type mixup on x86_64 causes UPNP_E_OUTOF_MEMORY\n\tSubmitted By: Glen Masgai\n\tafter an UpnpSendActionAsync() for example, i get UPNP_E_OUTOF_MEMORY\n\tin the callback using 1.4.4 on a x86_64 system. This happens in\n\thttp_MakeMessage(), which in some cases get called with wrong types\n\t(int instead of size_t) in combination with format \"b\" and \"Q\".\n\tThe attached patch should fix this.\n\n*******************************************************************************\nVersion 1.4.4\n*******************************************************************************\n\n2007-04-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Tracker [ 1695399 ] Typo in util.h\n\tSubmitted By: Luke Kim - nereusuj\n\tUnix sleep is in seconds but WIN32 Sleep is in milliseconds.\n\n2007-04-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Tracker [ 1652827 ] UpnpRegisterRootDevice returned -104\n\tSubmitted By: Michael Andersen - miwer\n\t\n\tIssue was found to be related to sizeof (size_t) != sizeof (int)\n\ton AMD64 systems. Emil Ljungdahl's AMD64 patch has been applied along\n\twith some other fixes. Original user report follows:\n\n\tWhen I run upnpd I get the above mentioned error (UPNP_E_OUTOF_MEMORY).\n\tI've tried with 1.4.1 and 1.4.2-RC3, it's the same. I don't understand why,\n\tbecause I have plenty of RAM, and I even tried closing some applications,\n\tbut it didn't help.\n\n\t$ upnpd eth1 br0\n\n\tThe following is logged in the /var/log/messages:\n\tFeb 6 01:33:47 server upnpd[6933]: Error registering the root device with\n\tdescDocUrl: http://192.168.0.1:49152/gatedesc.xml\n\tFeb 6 01:33:47 server upnpd[6933]: UpnpRegisterRootDevice returned -104\n\n\n\tI tried enabling debugging and it looks like it cannot allocate memory\n\tthrough the membuffer_append function. It's wierd because it's only a few\n\tbytes.\n\n\tPlease note, that I enabled some extra debugging lines that were commented,\n\tin order to get more information. See attached files.\n\n*******************************************************************************\nVersion 1.4.3\n*******************************************************************************\n\n2007-03-13 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Tracker [ 1663004 ] Compile on Cygwin\n\tSubmitted By: Jon Foster - jongfoster\n\tThis patch gives basic support for building under Cygwin - it compiles,\n\tlinks, and a simple UPnP device application can initialise. I'm not sure\n\tif it actually works yet, but this is definitely a step in the right\n\tdirection.\n\t\n\tPatch is against the 1.4.1 release. Changes are:\n\t\n\t* threadutil/inc/ithread.h: Fix the ithread mutex support to use\n\tdocumented, portable APIs (if present) rather than the Non-Portable (_NP)\n\tones it uses now. This is required because Cygwin implements only the\n\tportable API.\n\t\n\t* threadutil/src/ThreadPool.c: Fake SetPolicyType() to do nothing on Cygwin\n\tbecause otherwise it fails. Should probably investigate why it fails and\n\tadd a proper implementation later.\n\t\n\t* upnp/src/api/upnpapi.c: On Cygwin, zero out the GlobalHndMutex structure\n\tbefore initialising it. Without this, the initialisation fails. This\n\tappears to be a bug in Cygwin.\n\t\n\t* upnp/src/genlib/net/uri/uri.c: Use gethostbyname() on Cygwin.\n\t\n2007-03-05 Oxy <oxygenic(at)users.sourceforge.net>\n\t* Code adapted and typedefs added to compile cleanly under Windows\n\twith Borland C++ Builder and MS Visual C++\n\n2007-03-03 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t\n\t* Fixed nasty segmentation fault bug on membuffer.c.\n\t\n*******************************************************************************\nVersion 1.4.2\n*******************************************************************************\n\n2007-02-09 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* 32/64 bits portability issues on *printf.\n\tUse %zd for size_t, and cast to (long long) for off_t.\n\n2007-02-02 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Bumped the program version to 1.4.2 in config.ac.\n\n\t* Now requires autoconf 2.60.\n\n\t* Fixed docdir use.\n\n\t* Does not install the documentation by default.\n\n\t* Use dist-bzip2 to create a .bz2 distribution file.\n\n2007-01-23 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* SF Tracker [ 1634922 ] Support for large files (>= 2 GiB), part 2\n\tSubmitted By: Jonathan Casiot - no_dice\n\tSummary: This patch hopefully fixes the remaining types and related\n\tcode to enable files >= 2 GiB to be streamed. Jonathan claims to have\n\ttested this with a patched version of ushare-0.9.8 and a D-Link DSM-520.\n\n2007-01-09 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* SF Tracker [ 1628629 ] Multicast interface patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\tThis patch fixes two problems:\n\t1) Specify the IP address for the interface when we do\n\tsetsockopt IP_ADD_MEMBERSHIP. This makes it possible to run\n\twhen no default router has been configured.\n\t2) Explicitly set the multicast interface through setsockopt\n\tIP_MULTICAST_IF. Avoids socket error -207 in some cases.\n\t\n\t* SF Tracker [ 1628590 ] XML parsing segfault patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\tThis patch fixes a segmentation fault problem that occurrs\n\twhen parsing XML code than some routers produce.\n\n2007-01-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* SF Tracker [ 1628552 ] XML white space patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\t\n\t* SF Tracker [ 1628562 ] Maximum total jobs patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\tAlso, I incremented the libray versions and included some\n\tcomments in the file configure.ac so that we do not bump\n\tthe library version excessively, only the necessary numbers\n\ton the next release.\n\t\n\t* SF Tracker [ 1628575 ] Linksys WRT54G patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\t\n\t* SF Tracker [ 1628636 ] SSDP packet copy patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\tChanged NUM_COPY to 1 since, according to section 9.2 of the\n\tHTTPU/MU spec, we should never send more than one copy of a\n\treply to an SSDP request. Ref. section 9.2 of\n\thttp://www.upnp.org/download/draft-goland-http-udp-04.txt\n\n2006-12-23 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Thorough revision of every call of http_MakeMessage() due to a\n\tbug introduced in rev.79 \"largefile patch added\".\n\thttp_MakeMessage() has a worst than brain damaged \"printf\" like\n\tinterface. In rev.79, the \"N\" format parameter must be an off_t.\n\tEvery call of this function with an \"N\" format parameter and an\n\tint passed on the stack would fail terribly.\n\t\n\t* SF Bug tracker [ 1590469 ]\n\tTypo in ixmlparser.c\n\tSubmitted By: Erik Johansson - erijo\n\t\n\t* SF Bug Tracker [ 1590466 ] Invalid xml output\n\tSubmitted By: Erik Johansson - erijo\n\t\n\t* SF Patch tracker [ 1581161 ] VStudio2005 patch\n\tSubmitted By: David Maass - darkservant\n\t\n\t* SF Patch tracker [ 1587272 ] const-ified ixml\n\tSubmitted By: Erik Johansson\n\t\n\t* Finished const-ifications as suggested by Erik Johansson in\n\tSF Patch tracker [ 1587272 ].\n\n2006-07-05 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* [bug-id] 1580440\n\t[submitted-by] Erik Johansson - erijo\n\t[patched-by] Erik Johansson - erijo\n\tThe SOAP HTTP message that's generated on upnp errors\n\tis missing a \\r\\n\\ between header and body.\n\n2006-07-07 Oxy <virtual_worlds(at)gmx.de>\n\n\t* support for large files (>2 GBytes) added\n\n\n*******************************************************************************\nVersion 1.4.1\n*******************************************************************************\n\n2006-07-07 Oxy <virtual_worlds(at)gmx.de>\n\n\t* full support for Windows added, static library and DLL are fully\n\tworking, code compiles with Borland Builder C++ and MS Visual\n\tC/C++\n\n2006-07-05 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\n\t* Include prebuilt documentation (html,pdf), dropping doc++ \n\tdependancy.\n\n2006-07-03 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Patch for FreeBSD, thanks to Markus Strobl.\n\n2006-06-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Fix for missing \"else\" in httpreadwrite.c. Thanks to npapadop\n\tfor the patch.\n\n2006-06-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Fix for va_list initialization in x86_64 architectures.\n\n2006-06-08 Oxy <virtual_worlds(at)gmx.de>\n\n\t* Patch to fix memory leaks and reasons for crashes added (thanks\n\tto loigu)\n\n*******************************************************************************\nVersion 1.4.0\n*******************************************************************************\n\n2006-05-26 Oxy <virtual_worlds(at)gmx.de>\n\n\t* defines in iasnprintf.h changed to work with GCC-version < 3\n\n2006-05-22 Oxy <virtual_worlds(at)gmx.de>\n\n\t* BSD-patch added (not tested yet on an BSD system)\n\n2006-05-19 Oxy <virtual_worlds(at)gmx.de>\n\n\t* Patch added for bug: ixml parser colapsed on empty args (arg=\"\")\n\n2006-05-18 Oxy <virtual_worlds(at)gmx.de>\n\n\t* DSM-320 patch added (fetched from project MediaTomb)\n\t\n\t* httpGet additons atch added, Added proxy support by introducing\n\t  UpnpOpenHttpGetProxy. UpnpOpenHttpGet now just calls\n\t  UpnpOpenHttpGetProxy with the proxy url set to NULL.\n\t  \n\t* Bugfix for typo (\"\\0\" / \"0\") in ixmlparser.c\n\t\n\t* Bugfix for M-Search packet\n\n*******************************************************************************\nFORK FROM DEAD libupnp\n*******************************************************************************\n\n2006-04-29  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* THANKS: new file with list of contributors\n\n\t* upnp/src/gena/gena_device.c (respond_ok): add 'Content-Length: 0'\n\t  in subscription response. Patch by Chaos (Bug # 1455367).\n\n2006-04-08  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/doc/UPnP_Programming_Guide.pdf: replace this document with \n\t  the one in libupnp-doc-1.2.1 because current CVS version \n\t  was corrupted.\n\n2006-04-06\n\n\t* changes applied to several files to work under Sparc Solaris, temporarily\n\t  requiring a define SPARC_SOLARIS\n\n2006-04-03  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/Makefile.am: install upnp samples in $(docdir)/examples\n\n2006-03-28  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* configure.ac: add --with-docdir option to choose where documentation\n\t  is installed (or -without-docdir to not install the documentation)\n\n2006-03-27  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/test: add simple test suite for xml parser\n\n2006-03-26  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/src/ixmlparser.c (Parser_processCDSect): fix bug which prevents\n\t  CDATA sections which contain a 0 (zero) to be parsed (instead the\n\t  parsing of the whole document is aborted). Patch by Arno Willig \n\t  (Patch # 1432124).\n\n\t* configure.ac, upnp/Makefile.am: add \"--disable-samples\" configure\n\t  option, and move samples compilation from check_PROGRAMS to\n\t  noinst_PROGRAMS\n\n2006-03-25  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/genlib/miniserver/miniserver.c (get_miniserver_sockets): \n\t  fix bug if new socket created has fd 0 (can only occur when stdin\n\t  has been closed). Patch by Oskar Liljeblad 2004-07-02 :\n\t  http://sourceforge.net/mailarchive/message.php?msg_id=8870528\n\t\n2006-03-21  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/test/test_init.c: add some version checks and exit if failure\n\n2006-03-05  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* libupnp version 1.3.1\n\n\t* upnp/inc/upnpconfig.h.in: add new define UPNP_VERSION_PATCH\n\n\t* upnp/test/test_init.c: add simple test to run during checks\n\n\t* upnp/inc/upnp.h: include \"upnpdebug.h\" only if debug enabled\n\t  in the library (else header file is not installed)\n\n\t* upnp/Makefile.am (libupnp_la_LDFLAGS): add inter-library libtool\n\t  dependencies between upnp and ixml / threadutil, so that programs \n\t  linking against upnp only still work.\n\n2006-03-04  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* libupnp version 1.3.0\n\n2006-03-03  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/genlib/net/http/httpreadwrite.c (get_sdk_info): use\n\t  package version string from configure to set sdk info\n\n\t* upnp/Makefile.am: add sample/tvdevice/web/ files in EXTRA_DIST\n\t  + do not distribute generated upnpconfig.h file.\n\n2006-02-28  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/inc/config.h, configure.ac: use only new defines\n\t  UPNP_HAVE_xx instead of INCLUDE_yyy_APIS and INTERNAL_WEB_SERVER\n\n\t* upnp/Makefile.am, ixml/Makefile.am: add -export-symbols-regex to\n\t  the librarie LDFLAGS in order to export only the symbols defined \n\t  in the API\n\n2006-02-27  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* configure.ac: add libtool versions for the 3 libraries\n\n\t* ixml/src/ixml.c (copy_with_escape): add missing 'static' to function\n\n\t* threadutil/src/ThreadPool.c (SetSeed): add missing 'static' \n\n2006-02-26  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* threadutil/inc/iasnprintf.h: add gcc __printf__ format attribute\n\t  to \"iasnprintf\"\n\n\t* upnp/src/api/upnpapi.c: fix invalid UpnpPrintf formats\n\n\t* upnp/src/gena/gena_device.c: fix invalid UpnpPrintf formats\n\n\t* upnp/src/inc/config.h: move upnp/inc/config.h to internal\n\t  sources (this file is no longer installed with the libraries)\n\n\t* upnp/inc/upnpdebug.h: new file created from debug definitions\n\t  previously in upnp/inc/config.h\n\n\t* upnp/src/api/config.c: rename to upnp/src/api/upnpdebug.c\n\n\t* upnp/inc/upnpconfig.h.in: new file to contain information on    \n\t  the configuration of the installed libraries (generates installed\n\t  file <upnp/upnpconfig.h>)\n\n2006-02-22  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/ : add missing include of config.h in some .c files\n\n2006-02-21  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/inc/upnp.h: move some definitions which should not be\n\t  exported into \"upnp/src/inc/util.h\"\n\n\t* import all modifications below from libupnp in djmount 0.51\n\t  into official libupnp\n\t\n2006-01-17  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* threadutil/Makefile.am (libthreadutil_la_SOURCES): remove extraneous\n\t  file\n\n2006-01-15  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* configure.ac: add checks for large-file support\n\n\t* upnp/inc/config.h: rename to \"upnpconfig.h\". The new \"config.h\" file\n\t  is the one generated by autoconf.\n\n\t* m4/type_socklen_t.m4: added new check for socklen_t (fallback to\n\t  int if not defined)\n\n\t* upnp/src/genlib/miniserver/miniserver.c, \n\t  upnp/src/ssdp/ssdp_server.c: use socklen_t where appropriate \n\t  (instead of int)\n\n\t* upnp/src/genlib/net/http/httpreadwrite.c (get_sdk_info): remove\n\t  XINLINE declaration (unused and too late)\n\n\t* ixml/src/node.c (ixmlNode_getNodeType): fix compilation warning\n\t  on const return type\n\n2006-01-12  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/inc/readwrite.h : suppress unused C++ header file\n\n2006-01-11  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/inc/config.h, upnp/src/inc/upnpapi.h, \n\t  upnp/src/inc/httpreadwrite.h: remove internal configuration variable \n\t  MINIMUM_DELAY (no clear purpose)\n\n2005-12-05  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/inc/upnp.h: re-declare obsolete method UpnpSetContentLength,\n\t  for binary compatibility with previous libupnp version.\n\n\t* upnp/src/api/upnpapi.c: correct type of g_maxContentLength to size_t\n\n2005-11-01  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* autoconfiscate library : replace all makefiles by Makefile.am\n\t  for automake support, + preliminary autoconf support\n\t  (generated config.h not yet used in source files)\n\n2005-10-18  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/makefile: fix location of DEBUG STATIC libupnp library\n\t\n\t* upnp/sample/tvctrlpt/linux/Makefile, \n\t  upnp/sample/tvdevice/linux/Makefile: fix STATIC library support\n\n2005-10-16  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* threadutil/src/Makefile (clean): remove built library\n\n2005-08-28  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/src/ixml.h, ixml/src/ixml.c (ixmlRelaxParser) : new function\n\n\t* ixml/src/ixmlparser.h, ixml/src/ixmlparser.c (Parser_setErrorChar) :\n\t  new function\n\n2005-08-02  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/src/Makefile: correct bug for static library being incorrectly \n\t  stripped when building non-debug\n\n2005-06-09  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/src/element.c (ixmlElement_removeAttributeNode): \n\t  remove some compilation warning\n\n\t* ixml/inc/ixml.h, ixml/src/document.c : \n\t  add some missing const's in public API \n\n\t* upnp/inc/upnptools.h, upnp/src/api/upnptools.c : \n\t  add missing const's in public API\n\n2005-05-28  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/inc/config.h: suppress HTTP_READ_BYTES (unused)\n\t  and replace by DEFAULT_SOAP_CONTENT_LENGTH (previously in upnpapi.h)\n\t\n\t* upnp/inc/upnp.h, upnp/src/api/upnpapi.c : replace \n\t  UpnpSetContentLength (which was not using its Handle argument) \n\t  by global function UpnpSetMaxContentLength. \n\t  Remove \"hard\" limitation to 32K (not suitable for using in UPnP AV).\n\t\n\t* upnp/src/inc/upnpapi.h : removed DEFAULT_SOAP_CONTENT_LENGTH\n\t  (moved to config.h) and MAX_SOAP_CONTENT_LENGTH (now unused)\n\n\t* upnp/src/api/upnptools.c : add more error message strings\n\n\t* upnp/src/genlib/net/http/httpreadwrite.c : return OUTOF_BOUNDS\n\t  instead of BAD_HTTPMSG when allowed Content Length is exceeded.\n\n\t* upnp/src/genlib/net/http/httpreadwrite.c : corrected an incorrect\n\t  sprintf format\n\t\n2005-05-27  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/makefile, upnp/src/makefile, \n\t  ixml/Makefile, ixml/src/Makefile, \n\t  threadutil/Makefile, threadutil/src/Makefile : \n\t  implement STATIC library support (from patch at \n\t  http://sourceforge.net/tracker/?group_id=7189&atid=307189 )\n\n2005-05-26  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/api/upnpapi.c, upnp/src/soap/soap_device.c,\n\t  upnp/src/soap/makefile : \n\t  corrections for compilation with CLIENT=1 only\n\t\n\t* importing \"libupnp-1.2.1a\" as baseline\n\t\n", "/*******************************************************************************\n *\n * Copyright (c) 2000-2003 Intel Corporation\n * All rights reserved.\n * Copyright (c) 2012 France Telecom All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * - Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n * - Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n * - Neither name of Intel Corporation nor the names of its contributors\n * may be used to endorse or promote products derived from this software\n * without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n ******************************************************************************/\n\n/************************************************************************\n * Purpose: This file defines the functions for services. It defines\n * functions for adding and removing services to and from the service table,\n * adding and accessing subscription and other attributes pertaining to the\n * service\n ************************************************************************/\n\n#include \"service_table.h\"\n#include \"config.h\"\n\n#ifdef INCLUDE_DEVICE_APIS\n\n\t#if EXCLUDE_GENA == 0\n/************************************************************************\n *\tFunction :\tcopy_subscription\n *\n *\tParameters :\n *\t\tsubscription *in ;\tSource subscription\n *\t\tsubscription *out ;\tDestination subscription\n *\n *\tDescription :\tMakes a copy of the subscription\n *\n *\tReturn : int ;\n *\t\tHTTP_SUCCESS - On success\n *\n *\tNote :\n ************************************************************************/\nint copy_subscription(subscription *in, subscription *out)\n{\n\tint return_code = HTTP_SUCCESS;\n\n\tmemcpy(out->sid, in->sid, SID_SIZE);\n\tout->sid[SID_SIZE] = 0;\n\tout->ToSendEventKey = in->ToSendEventKey;\n\tout->expireTime = in->expireTime;\n\tout->active = in->active;\n\treturn_code = copy_URL_list(&in->DeliveryURLs, &out->DeliveryURLs);\n\tif (return_code != HTTP_SUCCESS) {\n\t\treturn return_code;\n\t}\n\tListInit(&out->outgoing, 0, 0);\n\tout->next = NULL;\n\treturn HTTP_SUCCESS;\n}\n\n/************************************************************************\n *\tFunction :\tRemoveSubscriptionSID\n *\n *\tParameters :\n *\t\tUpnp_SID sid ;\tsubscription ID\n *\t\tservice_info * service ;\tservice object providing the\n *list of subscriptions\n *\n *\tDescription :\tRemove the subscription represented by the\n *\t\tconst Upnp_SID sid parameter from the service table and update\n *\t\tthe service table.\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid RemoveSubscriptionSID(Upnp_SID sid, service_info *service)\n{\n\tsubscription *finger = service->subscriptionList;\n\tsubscription *previous = NULL;\n\n\twhile (finger) {\n\t\tif (!strcmp(sid, finger->sid)) {\n\t\t\tif (previous) {\n\t\t\t\tprevious->next = finger->next;\n\t\t\t} else {\n\t\t\t\tservice->subscriptionList = finger->next;\n\t\t\t}\n\t\t\tfinger->next = NULL;\n\t\t\tfreeSubscriptionList(finger);\n\t\t\tfinger = NULL;\n\t\t\tservice->TotalSubscriptions--;\n\t\t} else {\n\t\t\tprevious = finger;\n\t\t\tfinger = finger->next;\n\t\t}\n\t}\n}\n\nsubscription *GetSubscriptionSID(const Upnp_SID sid, service_info *service)\n{\n\tsubscription *next = service->subscriptionList;\n\tsubscription *previous = NULL;\n\tsubscription *found = NULL;\n\ttime_t current_time;\n\n\twhile (next && !found) {\n\t\tif (!strcmp(next->sid, sid))\n\t\t\tfound = next;\n\t\telse {\n\t\t\tprevious = next;\n\t\t\tnext = next->next;\n\t\t}\n\t}\n\tif (found) {\n\t\t/* get the current_time */\n\t\ttime(&current_time);\n\t\tif (found->expireTime && found->expireTime < current_time) {\n\t\t\tif (previous) {\n\t\t\t\tprevious->next = found->next;\n\t\t\t} else {\n\t\t\t\tservice->subscriptionList = found->next;\n\t\t\t}\n\t\t\tfound->next = NULL;\n\t\t\tfreeSubscriptionList(found);\n\t\t\tfound = NULL;\n\t\t\tservice->TotalSubscriptions--;\n\t\t}\n\t}\n\treturn found;\n}\n\nsubscription *GetNextSubscription(service_info *service, subscription *current)\n{\n\ttime_t current_time;\n\tsubscription *next = NULL;\n\tsubscription *previous = NULL;\n\tint notDone = 1;\n\n\t/* get the current_time */\n\ttime(&current_time);\n\twhile (notDone && current) {\n\t\tprevious = current;\n\t\tcurrent = current->next;\n\n\t\tif (!current) {\n\t\t\tnotDone = 0;\n\t\t\tnext = current;\n\t\t} else if (current->expireTime &&\n\t\t\t   current->expireTime < current_time) {\n\t\t\tprevious->next = current->next;\n\t\t\tcurrent->next = NULL;\n\t\t\tfreeSubscriptionList(current);\n\t\t\tcurrent = previous;\n\t\t\tservice->TotalSubscriptions--;\n\t\t} else if (current->active) {\n\t\t\tnotDone = 0;\n\t\t\tnext = current;\n\t\t}\n\t}\n\treturn next;\n}\n\nsubscription *GetFirstSubscription(service_info *service)\n{\n\tsubscription temp;\n\tsubscription *next = NULL;\n\n\ttemp.next = service->subscriptionList;\n\tnext = GetNextSubscription(service, &temp);\n\tservice->subscriptionList = temp.next;\n\t/* service->subscriptionList = next; */\n\n\treturn next;\n}\n\nvoid freeSubscription(subscription *sub)\n{\n\tif (sub) {\n\t\tfree_URL_list(&sub->DeliveryURLs);\n\t\tfreeSubscriptionQueuedEvents(sub);\n\t}\n}\n\n/************************************************************************\n *\tFunction :\tfreeSubscriptionList\n *\n *\tParameters :\n *\t\tsubscription * head ;\thead of the subscription list\n *\n *\tDescription :\tFree's memory allocated for all the subscriptions\n *\t\tin the service table.\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid freeSubscriptionList(subscription *head)\n{\n\tsubscription *next = NULL;\n\n\twhile (head) {\n\t\tnext = head->next;\n\t\tfreeSubscription(head);\n\t\tfree(head);\n\t\thead = next;\n\t}\n}\n\n/*******************************************************************************\n * Function :\tFindServiceId\n *\n * Parameters :\n *    service_table *table;  service table\n *    const char *serviceId; string representing the service id to be found\n *                           among those in the\n *    table const char *UDN; string representing the UDN to be found among those\n *                           in the table\n *\n * Description: Traverses through the service table and returns a pointer to the\n *    service node that matches a known service id and a known UDN.\n *\n * Return:\n *     service_info *: pointer to the matching service_info node.\n ******************************************************************************/\nservice_info *FindServiceId(\n\tservice_table *table, const char *serviceId, const char *UDN)\n{\n\tservice_info *finger = NULL;\n\n\tif (table) {\n\t\tfinger = table->serviceList;\n\t\twhile (finger) {\n\t\t\tif (!strcmp(serviceId, finger->serviceId) &&\n\t\t\t\t!strcmp(UDN, finger->UDN)) {\n\t\t\t\treturn finger;\n\t\t\t}\n\t\t\tfinger = finger->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}\n\n/************************************************************************\n *\tFunction :\tFindServiceEventURLPath\n *\n *\tParameters :\n *\t\tservice_table *table ;\tservice table\n *\t\tchar * eventURLPath ;\tevent URL path used to find a service\n *\t\t\t\t\t\t\t\tfrom the table\n *\n *\tDescription :\tTraverses the service table and finds the node whose\n *\t\tevent URL Path matches a know value\n *\n *\tReturn : service_info * - pointer to the service list node from the\n *\t\tservice table whose event URL matches a known event URL;\n *\n *\tNote :\n ************************************************************************/\nservice_info *FindServiceEventURLPath(\n\tservice_table *table, const char *eventURLPath)\n{\n\tservice_info *finger = NULL;\n\turi_type parsed_url;\n\turi_type parsed_url_in;\n\n\tif (table &&\n\t\tparse_uri(eventURLPath, strlen(eventURLPath), &parsed_url_in) ==\n\t\t\tHTTP_SUCCESS) {\n\t\tfinger = table->serviceList;\n\t\twhile (finger) {\n\t\t\tif (finger->eventURL) {\n\t\t\t\tif (parse_uri(finger->eventURL,\n\t\t\t\t\t    strlen(finger->eventURL),\n\t\t\t\t\t    &parsed_url) == HTTP_SUCCESS) {\n\t\t\t\t\tif (!token_cmp(&parsed_url.pathquery,\n\t\t\t\t\t\t    &parsed_url_in.pathquery)) {\n\t\t\t\t\t\treturn finger;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinger = finger->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}\n\t#endif /* EXCLUDE_GENA */\n\n\t/***********************************************************************\n\t * Function: FindServiceControlURLPath\n\t *\n\t * Parameters:\n\t *    service_table *table; service table\n\t *    char *controlURLPath; control URL path used to find a service from\n\t *                          the table\n\t *\n\t * Description: Traverses the service table and finds the node whose\n\t *    control URL Path matches a know value\n\t *\n\t * Return: service_info *:  pointer to the service list node from the\n\t *    service table whose control URL Path matches a known value.\n\t **********************************************************************/\n\t#if EXCLUDE_SOAP == 0\nservice_info *FindServiceControlURLPath(\n\tservice_table *table, const char *controlURLPath)\n{\n\tservice_info *finger = NULL;\n\turi_type parsed_url;\n\turi_type parsed_url_in;\n\n\tif (table && parse_uri(controlURLPath,\n\t\t\t     strlen(controlURLPath),\n\t\t\t     &parsed_url_in) == HTTP_SUCCESS) {\n\t\tfinger = table->serviceList;\n\t\twhile (finger) {\n\t\t\tif (finger->controlURL) {\n\t\t\t\tif (parse_uri(finger->controlURL,\n\t\t\t\t\t    strlen(finger->controlURL),\n\t\t\t\t\t    &parsed_url) == HTTP_SUCCESS) {\n\t\t\t\t\tif (!token_cmp(&parsed_url.pathquery,\n\t\t\t\t\t\t    &parsed_url_in.pathquery)) {\n\t\t\t\t\t\treturn finger;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinger = finger->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}\n\t#endif /* EXCLUDE_SOAP */\n\n\t/***********************************************************************\n\t * Function: printService\n\t *\n\t * Parameters:\n\t *    service_info *service; Service whose information is to be printed\n\t *    Upnp_LogLevel level;  Debug level specified to the print function\n\t *    Dbg_Module module;    Debug module specified to the print function\n\t *\n\t * Description: For debugging purposes prints information from the\n\t *    service passed into the function.\n\t *\n\t * Return: void\n\t **********************************************************************/\n\t#ifdef DEBUG\nvoid printService(service_info *service, Upnp_LogLevel level, Dbg_Module module)\n{\n\tif (service) {\n\t\tif (service->serviceType) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"serviceType: %s\\n\",\n\t\t\t\tservice->serviceType);\n\t\t}\n\t\tif (service->serviceId) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"serviceId: %s\\n\",\n\t\t\t\tservice->serviceId);\n\t\t}\n\t\tif (service->SCPDURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"SCPDURL: %s\\n\",\n\t\t\t\tservice->SCPDURL);\n\t\t}\n\t\tif (service->controlURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"controlURL: %s\\n\",\n\t\t\t\tservice->controlURL);\n\t\t}\n\t\tif (service->eventURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"eventURL: %s\\n\",\n\t\t\t\tservice->eventURL);\n\t\t}\n\t\tif (service->UDN) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"UDN: %s\\n\\n\",\n\t\t\t\tservice->UDN);\n\t\t}\n\t\tif (service->active) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"Service is active\\n\");\n\t\t} else {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"Service is inactive\\n\");\n\t\t}\n\t}\n}\n\t#endif\n\n\t/************************************************************************\n\t * Function: printServiceList\n\t *\n\t * Parameters:\n\t *    service_info *service; Service whose information is to be printed\n\t *    Upnp_LogLevel level;   Debug level specified to the print function\n\t *    Dbg_Module module;    Debug module specified to the print function\n\t *\n\t * Description: For debugging purposes prints information of each\n\t *    service from the service table passed into the function.\n\t *\n\t * Return: void\n\t ************************************************************************/\n\t#ifdef DEBUG\nvoid printServiceList(\n\tservice_info *service, Upnp_LogLevel level, Dbg_Module module)\n{\n\twhile (service) {\n\t\tif (service->serviceType) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"serviceType: %s\\n\",\n\t\t\t\tservice->serviceType);\n\t\t}\n\t\tif (service->serviceId) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"serviceId: %s\\n\",\n\t\t\t\tservice->serviceId);\n\t\t}\n\t\tif (service->SCPDURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"SCPDURL: %s\\n\",\n\t\t\t\tservice->SCPDURL);\n\t\t}\n\t\tif (service->controlURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"controlURL: %s\\n\",\n\t\t\t\tservice->controlURL);\n\t\t}\n\t\tif (service->eventURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"eventURL: %s\\n\",\n\t\t\t\tservice->eventURL);\n\t\t}\n\t\tif (service->UDN) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"UDN: %s\\n\\n\",\n\t\t\t\tservice->UDN);\n\t\t}\n\t\tif (service->active) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"Service is active\\n\");\n\t\t} else {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"Service is inactive\\n\");\n\t\t}\n\t\tservice = service->next;\n\t}\n}\n\t#endif\n\n\t/************************************************************************\n\t * Function: printServiceTable\n\t *\n\t * Parameters:\n\t *    service_table *table; Service table to be printed\n\t *    Upnp_LogLevel level;  Debug level specified to the print function\n\t *    Dbg_Module module;    Debug module specified to the print function\n\t *\n\t * Description: For debugging purposes prints the URL base of the table\n\t *    and information of each service from the service table passed into\n\t *    the function.\n\t *\n\t * Return: void\n\t ************************************************************************/\n\t#ifdef DEBUG\nvoid printServiceTable(\n\tservice_table *table, Upnp_LogLevel level, Dbg_Module module)\n{\n\tUpnpPrintf(level,\n\t\tmodule,\n\t\t__FILE__,\n\t\t__LINE__,\n\t\t\"URL_BASE: %s\\n\",\n\t\ttable->URLBase);\n\tUpnpPrintf(level, module, __FILE__, __LINE__, \"Services: \\n\");\n\tprintServiceList(table->serviceList, level, module);\n}\n\t#endif\n\n\t#if EXCLUDE_GENA == 0\n/************************************************************************\n *\tFunction :\tfreeService\n *\n *\tParameters :\n *\t\tservice_info *in ;\tservice information that is to be freed\n *\n *\tDescription :\tFree's memory allocated for the various components\n *\t\tof the service entry in the service table.\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid freeService(service_info *in)\n{\n\tif (in) {\n\t\tif (in->serviceType)\n\t\t\tixmlFreeDOMString(in->serviceType);\n\n\t\tif (in->serviceId)\n\t\t\tixmlFreeDOMString(in->serviceId);\n\n\t\tif (in->SCPDURL)\n\t\t\tfree(in->SCPDURL);\n\n\t\tif (in->controlURL)\n\t\t\tfree(in->controlURL);\n\n\t\tif (in->eventURL)\n\t\t\tfree(in->eventURL);\n\n\t\tif (in->UDN)\n\t\t\tixmlFreeDOMString(in->UDN);\n\n\t\tif (in->subscriptionList)\n\t\t\tfreeSubscriptionList(in->subscriptionList);\n\n\t\tin->TotalSubscriptions = 0;\n\t\tfree(in);\n\t}\n}\n\n/************************************************************************\n *\tFunction :\tfreeServiceList\n *\n *\tParameters :\n *\t\tservice_info * head ;\tHead of the service list to be freed\n *\n *\tDescription :\tFree's memory allocated for the various components\n *\t\tof each service entry in the service table.\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid freeServiceList(service_info *head)\n{\n\tservice_info *next = NULL;\n\n\twhile (head) {\n\t\tif (head->serviceType)\n\t\t\tixmlFreeDOMString(head->serviceType);\n\t\tif (head->serviceId)\n\t\t\tixmlFreeDOMString(head->serviceId);\n\t\tif (head->SCPDURL)\n\t\t\tfree(head->SCPDURL);\n\t\tif (head->controlURL)\n\t\t\tfree(head->controlURL);\n\t\tif (head->eventURL)\n\t\t\tfree(head->eventURL);\n\t\tif (head->UDN)\n\t\t\tixmlFreeDOMString(head->UDN);\n\t\tif (head->subscriptionList)\n\t\t\tfreeSubscriptionList(head->subscriptionList);\n\n\t\thead->TotalSubscriptions = 0;\n\t\tnext = head->next;\n\t\tfree(head);\n\t\thead = next;\n\t}\n}\n\n/************************************************************************\n *\tFunction :\tfreeServiceTable\n *\n *\tParameters :\n *\t\tservice_table * table ;\tService table whose memory needs to be\n *\t\t\t\t\t\t\t\tfreed\n *\n *\tDescription : Free's dynamic memory in table.\n *\t\t(does not free table, only memory within the structure)\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid freeServiceTable(service_table *table)\n{\n\tixmlFreeDOMString(table->URLBase);\n\tfreeServiceList(table->serviceList);\n\ttable->serviceList = NULL;\n\ttable->endServiceList = NULL;\n}\n\n/*******************************************************************************\n * Function: getElementValue\n *\n * Parameters:\n *    IXML_Node *node; Input node which provides the list of child nodes\n *\n * Description: Returns the clone of the element value\n *\n * Return: DOMString\n *\n * Note: value must be freed with DOMString_free\n ******************************************************************************/\nDOMString getElementValue(IXML_Node *node)\n{\n\tIXML_Node *child = (IXML_Node *)ixmlNode_getFirstChild(node);\n\tconst DOMString temp = NULL;\n\n\tif (child && ixmlNode_getNodeType(child) == eTEXT_NODE) {\n\t\ttemp = ixmlNode_getNodeValue(child);\n\n\t\treturn ixmlCloneDOMString(temp);\n\t} else {\n\t\treturn NULL;\n\t}\n}\n\n/*******************************************************************************\n * Function: getSubElement\n *\n * Parameters:\n *    const char *element_name; sub element name to be searched for\n *    IXML_Node *node;         Input node which provides the list of child nodes\n *    IXML_Node **out;         Ouput node to which the matched child node is\n *                             returned.\n *\n * Description: Traverses through a list of XML nodes to find the node with the\n *              known element name.\n *\n * Return: int\n *    1 - On Success\n *    0 - On Failure\n ******************************************************************************/\nint getSubElement(const char *element_name, IXML_Node *node, IXML_Node **out)\n{\n\tconst DOMString NodeName = NULL;\n\tint found = 0;\n\tIXML_Node *child = (IXML_Node *)ixmlNode_getFirstChild(node);\n\n\t(*out) = NULL;\n\twhile (child && !found) {\n\t\tswitch (ixmlNode_getNodeType(child)) {\n\t\tcase eELEMENT_NODE:\n\t\t\tNodeName = ixmlNode_getNodeName(child);\n\t\t\tif (!strcmp(NodeName, element_name)) {\n\t\t\t\t(*out) = child;\n\t\t\t\tfound = 1;\n\t\t\t\treturn found;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\tchild = (IXML_Node *)ixmlNode_getNextSibling(child);\n\t}\n\n\treturn found;\n}\n\n/*******************************************************************************\n * Function: getServiceList\n *\n * Parameters:\n *    IXML_Node *node;\t  XML node information\n *    service_info **end; service added is returned to the output parameter\n *    char *URLBase;      provides Base URL to resolve relative URL\n *\n * Description: Returns pointer to service info after getting the sub-elements\n *    of the service info.\n *\n * Return: service_info *: pointer to the service info node\n ******************************************************************************/\nservice_info *getServiceList(IXML_Node *node, service_info **end, char *URLBase)\n{\n\tIXML_Node *serviceList = NULL;\n\tIXML_Node *current_service = NULL;\n\tIXML_Node *UDN = NULL;\n\n\tIXML_Node *serviceType = NULL;\n\tIXML_Node *serviceId = NULL;\n\tIXML_Node *SCPDURL = NULL;\n\tIXML_Node *controlURL = NULL;\n\tIXML_Node *eventURL = NULL;\n\tDOMString tempDOMString = NULL;\n\tservice_info *head = NULL;\n\tservice_info *current = NULL;\n\tservice_info *previous = NULL;\n\tIXML_NodeList *serviceNodeList = NULL;\n\tlong unsigned int NumOfServices = 0lu;\n\tlong unsigned int i = 0lu;\n\tint fail = 0;\n\n\tif (getSubElement(\"UDN\", node, &UDN) &&\n\t\tgetSubElement(\"serviceList\", node, &serviceList)) {\n\t\tserviceNodeList = ixmlElement_getElementsByTagName(\n\t\t\t(IXML_Element *)serviceList, \"service\");\n\t\tif (serviceNodeList) {\n\t\t\tNumOfServices = ixmlNodeList_length(serviceNodeList);\n\t\t\tfor (i = 0lu; i < NumOfServices; i++) {\n\t\t\t\tcurrent_service =\n\t\t\t\t\tixmlNodeList_item(serviceNodeList, i);\n\t\t\t\tfail = 0;\n\t\t\t\tif (current) {\n\t\t\t\t\tcurrent->next =\n\t\t\t\t\t\tmalloc(sizeof(service_info));\n\t\t\t\t\tprevious = current;\n\t\t\t\t\tcurrent = current->next;\n\t\t\t\t} else {\n\t\t\t\t\thead = malloc(sizeof(service_info));\n\t\t\t\t\tcurrent = head;\n\t\t\t\t}\n\t\t\t\tif (!current) {\n\t\t\t\t\tfreeServiceList(head);\n\t\t\t\t\tixmlNodeList_free(serviceNodeList);\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t\tcurrent->next = NULL;\n\t\t\t\tcurrent->controlURL = NULL;\n\t\t\t\tcurrent->eventURL = NULL;\n\t\t\t\tcurrent->serviceType = NULL;\n\t\t\t\tcurrent->serviceId = NULL;\n\t\t\t\tcurrent->SCPDURL = NULL;\n\t\t\t\tcurrent->active = 1;\n\t\t\t\tcurrent->subscriptionList = NULL;\n\t\t\t\tcurrent->TotalSubscriptions = 0;\n\t\t\t\tif (!(current->UDN = getElementValue(UDN)))\n\t\t\t\t\tfail = 1;\n\t\t\t\tif (!getSubElement(\"serviceType\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &serviceType) ||\n\t\t\t\t\t!(current->serviceType =\n\t\t\t\t\t\t\tgetElementValue(\n\t\t\t\t\t\t\t\tserviceType)))\n\t\t\t\t\tfail = 1;\n\t\t\t\tif (!getSubElement(\"serviceId\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &serviceId) ||\n\t\t\t\t\t!(current->serviceId = getElementValue(\n\t\t\t\t\t\t  serviceId)))\n\t\t\t\t\tfail = 1;\n\t\t\t\tif (!getSubElement(\"SCPDURL\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &SCPDURL) ||\n\t\t\t\t\t!(tempDOMString = getElementValue(\n\t\t\t\t\t\t  SCPDURL)) ||\n\t\t\t\t\t!(current->SCPDURL = resolve_rel_url(\n\t\t\t\t\t\t  URLBase, tempDOMString)))\n\t\t\t\t\tfail = 1;\n\t\t\t\tixmlFreeDOMString(tempDOMString);\n\t\t\t\ttempDOMString = NULL;\n\t\t\t\tif (!(getSubElement(\"controlURL\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &controlURL)) ||\n\t\t\t\t\t!(tempDOMString = getElementValue(\n\t\t\t\t\t\t  controlURL)) ||\n\t\t\t\t\t!(current->controlURL = resolve_rel_url(\n\t\t\t\t\t\t  URLBase, tempDOMString))) {\n\t\t\t\t\tUpnpPrintf(UPNP_INFO,\n\t\t\t\t\t\tGENA,\n\t\t\t\t\t\t__FILE__,\n\t\t\t\t\t\t__LINE__,\n\t\t\t\t\t\t\"BAD OR MISSING CONTROL URL\");\n\t\t\t\t\tUpnpPrintf(UPNP_INFO,\n\t\t\t\t\t\tGENA,\n\t\t\t\t\t\t__FILE__,\n\t\t\t\t\t\t__LINE__,\n\t\t\t\t\t\t\"CONTROL URL SET TO NULL IN \"\n\t\t\t\t\t\t\"SERVICE INFO\");\n\t\t\t\t\tcurrent->controlURL = NULL;\n\t\t\t\t\tfail = 0;\n\t\t\t\t}\n\t\t\t\tixmlFreeDOMString(tempDOMString);\n\t\t\t\ttempDOMString = NULL;\n\t\t\t\tif (!getSubElement(\"eventSubURL\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &eventURL) ||\n\t\t\t\t\t!(tempDOMString = getElementValue(\n\t\t\t\t\t\t  eventURL)) ||\n\t\t\t\t\t!(current->eventURL = resolve_rel_url(\n\t\t\t\t\t\t  URLBase, tempDOMString))) {\n\t\t\t\t\tUpnpPrintf(UPNP_INFO,\n\t\t\t\t\t\tGENA,\n\t\t\t\t\t\t__FILE__,\n\t\t\t\t\t\t__LINE__,\n\t\t\t\t\t\t\"BAD OR MISSING EVENT URL\");\n\t\t\t\t\tUpnpPrintf(UPNP_INFO,\n\t\t\t\t\t\tGENA,\n\t\t\t\t\t\t__FILE__,\n\t\t\t\t\t\t__LINE__,\n\t\t\t\t\t\t\"EVENT URL SET TO NULL IN \"\n\t\t\t\t\t\t\"SERVICE INFO\");\n\t\t\t\t\tcurrent->eventURL = NULL;\n\t\t\t\t\tfail = 0;\n\t\t\t\t}\n\t\t\t\tixmlFreeDOMString(tempDOMString);\n\t\t\t\ttempDOMString = NULL;\n\t\t\t\tif (fail) {\n\t\t\t\t\tfreeServiceList(current);\n\t\t\t\t\tif (previous)\n\t\t\t\t\t\tprevious->next = NULL;\n\t\t\t\t\telse\n\t\t\t\t\t\thead = NULL;\n\t\t\t\t\tcurrent = previous;\n\t\t\t\t}\n\t\t\t}\n\t\t\tixmlNodeList_free(serviceNodeList);\n\t\t}\n\t\t(*end) = current;\n\t\treturn head;\n\t} else {\n\t\t(*end) = NULL;\n\t\treturn NULL;\n\t}\n}\n\n/*******************************************************************************\n * Function: getAllServiceList\n *\n * Parameters:\n *    IXML_Node *node;        XML node information\n *    char *URLBase;          provides Base URL to resolve relative URL\n *    service_info **out_end; service added is returned to the output parameter\n *\n * Description: Returns pointer to service info after getting the sub-elements\n *    of the service info.\n *\n * Return: service_info *\n ******************************************************************************/\nservice_info *getAllServiceList(\n\tIXML_Node *node, char *URLBase, service_info **out_end)\n{\n\tservice_info *head = NULL;\n\tservice_info *end = NULL;\n\tservice_info *next_end = NULL;\n\tIXML_NodeList *deviceList = NULL;\n\tIXML_Node *currentDevice = NULL;\n\n\tlong unsigned int NumOfDevices = 0lu;\n\tlong unsigned int i = 0lu;\n\n\t(*out_end) = NULL;\n\tdeviceList = ixmlElement_getElementsByTagName(\n\t\t(IXML_Element *)node, \"device\");\n\tif (deviceList) {\n\t\tNumOfDevices = ixmlNodeList_length(deviceList);\n\t\tfor (i = 0lu; i < NumOfDevices; i++) {\n\t\t\tcurrentDevice = ixmlNodeList_item(deviceList, i);\n\t\t\tif (head) {\n\t\t\t\tend->next = getServiceList(\n\t\t\t\t\tcurrentDevice, &next_end, URLBase);\n\t\t\t\tif (next_end)\n\t\t\t\t\tend = next_end;\n\t\t\t} else {\n\t\t\t\thead = getServiceList(\n\t\t\t\t\tcurrentDevice, &end, URLBase);\n\t\t\t}\n\t\t}\n\t\tixmlNodeList_free(deviceList);\n\t}\n\n\t(*out_end) = end;\n\treturn head;\n}\n\n/*******************************************************************************\n * Function: removeServiceTable\n *\n * Parameters:\n *    IXML_Node *node ;  XML node information\n *    service_table *in; service table from which services will be removed\n *\n * Description: This function assumes that services for a particular root device\n *    are placed linearly in the service table, and in the order in which they\n *    are found in the description document all services for this root device\n *    are removed from the list\n *\n * Return: int\n ******************************************************************************/\nint removeServiceTable(IXML_Node *node, service_table *in)\n{\n\tIXML_Node *root = NULL;\n\tIXML_Node *currentUDN = NULL;\n\tDOMString UDN = NULL;\n\tIXML_NodeList *deviceList = NULL;\n\tservice_info *current_service = NULL;\n\tservice_info *start_search = NULL;\n\tservice_info *prev_service = NULL;\n\tlong unsigned int NumOfDevices = 0lu;\n\tlong unsigned int i = 0lu;\n\n\tif (getSubElement(\"root\", node, &root)) {\n\t\tstart_search = in->serviceList;\n\t\tdeviceList = ixmlElement_getElementsByTagName(\n\t\t\t(IXML_Element *)root, \"device\");\n\t\tif (deviceList) {\n\t\t\tNumOfDevices = ixmlNodeList_length(deviceList);\n\t\t\tfor (i = 0lu; i < NumOfDevices; i++) {\n\t\t\t\tif ((start_search) &&\n\t\t\t\t\t((getSubElement(\n\t\t\t\t\t\t \"UDN\", node, &currentUDN)) &&\n\t\t\t\t\t\t(UDN = getElementValue(\n\t\t\t\t\t\t\t currentUDN)))) {\n\t\t\t\t\tcurrent_service = start_search;\n\t\t\t\t\t/* Services are put in the service table\n\t\t\t\t\t * in the order in which they appear in\n\t\t\t\t\t * the description document, therefore\n\t\t\t\t\t * we go through the list only once to\n\t\t\t\t\t * remove a particular root device */\n\t\t\t\t\twhile ((current_service) &&\n\t\t\t\t\t\t(strcmp(current_service->UDN,\n\t\t\t\t\t\t\tUDN))) {\n\t\t\t\t\t\tcurrent_service =\n\t\t\t\t\t\t\tcurrent_service->next;\n\t\t\t\t\t\tif (current_service != NULL)\n\t\t\t\t\t\t\tprev_service =\n\t\t\t\t\t\t\t\tcurrent_service\n\t\t\t\t\t\t\t\t\t->next;\n\t\t\t\t\t}\n\t\t\t\t\twhile ((current_service) &&\n\t\t\t\t\t\t(!strcmp(current_service->UDN,\n\t\t\t\t\t\t\tUDN))) {\n\t\t\t\t\t\tif (prev_service) {\n\t\t\t\t\t\t\tprev_service->next =\n\t\t\t\t\t\t\t\tcurrent_service\n\t\t\t\t\t\t\t\t\t->next;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tin->serviceList =\n\t\t\t\t\t\t\t\tcurrent_service\n\t\t\t\t\t\t\t\t\t->next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (current_service ==\n\t\t\t\t\t\t\tin->endServiceList)\n\t\t\t\t\t\t\tin->endServiceList =\n\t\t\t\t\t\t\t\tprev_service;\n\t\t\t\t\t\tstart_search =\n\t\t\t\t\t\t\tcurrent_service->next;\n\t\t\t\t\t\tfreeService(current_service);\n\t\t\t\t\t\tcurrent_service = start_search;\n\t\t\t\t\t}\n\t\t\t\t\tixmlFreeDOMString(UDN);\n\t\t\t\t\tUDN = NULL;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tixmlNodeList_free(deviceList);\n\t\t}\n\t}\n\treturn 1;\n}\n\n/*******************************************************************************\n * Function: addServiceTable\n *\n * Parameters :\n *    IXML_Node *node;            XML node information\n *    service_table *in;          service table that will be initialized with\n *                                services\n *    const char *DefaultURLBase; Default base URL on which the URL will be\n *                                returned to the service list.\n *\n * Description: Add Service to the table.\n *\n * Return: int\n ******************************************************************************/\nint addServiceTable(\n\tIXML_Node *node, service_table *in, const char *DefaultURLBase)\n{\n\tIXML_Node *root = NULL;\n\tIXML_Node *URLBase = NULL;\n\tservice_info *tempEnd = NULL;\n\n\tif (in->URLBase) {\n\t\tfree(in->URLBase);\n\t\tin->URLBase = NULL;\n\t}\n\tif (getSubElement(\"root\", node, &root)) {\n\t\tif (getSubElement(\"URLBase\", root, &URLBase)) {\n\t\t\tin->URLBase = getElementValue(URLBase);\n\t\t} else {\n\t\t\tif (DefaultURLBase) {\n\t\t\t\tin->URLBase =\n\t\t\t\t\tixmlCloneDOMString(DefaultURLBase);\n\t\t\t} else {\n\t\t\t\tin->URLBase = ixmlCloneDOMString(\"\");\n\t\t\t}\n\t\t}\n\t\tif ((in->endServiceList->next = getAllServiceList(\n\t\t\t     root, in->URLBase, &tempEnd))) {\n\t\t\tin->endServiceList = tempEnd;\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\n/************************************************************************\n * Function : getServiceTable\n *\n * Parameters :\n * \tIXML_Node *node ;\tXML node information\n *\tservice_table *out ;\toutput parameter which will contain the\n *\t\t\t\tservice list and URL\n *\tconst char *DefaultURLBase ; Default base URL on which the URL\n *\t\t\t\twill be returned.\n *\n * Description : Retrieve service from the table\n *\n * Return : int ;\n *\n * Note :\n ************************************************************************/\nint getServiceTable(\n\tIXML_Node *node, service_table *out, const char *DefaultURLBase)\n{\n\tIXML_Node *root = NULL;\n\tIXML_Node *URLBase = NULL;\n\n\tif (getSubElement(\"root\", node, &root)) {\n\t\tif (getSubElement(\"URLBase\", root, &URLBase)) {\n\t\t\tout->URLBase = getElementValue(URLBase);\n\t\t} else {\n\t\t\tif (DefaultURLBase) {\n\t\t\t\tout->URLBase =\n\t\t\t\t\tixmlCloneDOMString(DefaultURLBase);\n\t\t\t} else {\n\t\t\t\tout->URLBase = ixmlCloneDOMString(\"\");\n\t\t\t}\n\t\t}\n\t\tout->serviceList = getAllServiceList(\n\t\t\troot, out->URLBase, &out->endServiceList);\n\t\tif (out->serviceList) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\t#endif /* EXCLUDE_GENA */\n\n#endif /* INCLUDE_DEVICE_APIS */\n"], "fixing_code": ["*******************************************************************************\nVersion 1.12.2\n*******************************************************************************\n\n2020-06-04 Patrik Lantz pjlantz(at)github\n\n        Fixes #177\n\n        NULL pointer dereference in FindServiceControlURLPath\n\n*******************************************************************************\nVersion 1.12.1\n*******************************************************************************\n\n2020-04-03 Rene Nielsen <rene.nielsen(at)microchip.com>\n\n\tsetsockopt(IP_MULTICAST_IF) fails on 64-bit CPUs\n\n2020-04-03 Rosen Penev <rosenp(at)gmail.com>\n\n\tGitHub PR #164\n\n\tDo not use usleep when using newer POSIX C source.\n    \n    \tusleep is deprecated and is optionally unavailable with uClibc-ng.\n\n2020-03-29 pamapa <pamapa(at)github>\n\n\tGitHub PR #162\n\n\tAdd Os/UserAgent information to UpnpActionRequest and UpnpFileInfo\n\n2020-03-28 pamapa <pamapa(at)github>\n\n\tGitHub PR #161\n\n\tAdd CtrlPtIPAddr to UpnpFileInfo class\n\n2020-01-27 Ian Whyman <v00d00(at)github>\n\n\tGitHub PR #160\n\n\tList: Add extern C for C++ users\n\n*******************************************************************************\nVersion 1.12.0\n*******************************************************************************\n\n2020-01-22 Stephen Bash <scbash(at)github>\n\n    Reduce spurious HTTP 416 errors due to ill-defined bytes header\n    \n    I (re)discovered this behavior trying to use the Gerbera media server\n    with Chromecast (built in to my Vizio P55-F1 TV).  Chromecast specifies\n    \"bytes:0-\" with no end range, which caused pupnp to return\n    RANGE_NOT_SATISFIABLE.  Jin, the author of MediaTomb, of which Gerbera\n    is a continuation, fixed this in 2007 in MediaTomb's fork of pupnp, see\n    gerbera@ccd7994d45 \"made sure that range requests specified as\n    \"bytes=0-\" do not trigger...\", but never passed the fix upstream.  When\n    restarted as Gerbera, pupnp was removed from the local tree in favor of\n    using the upstream version, and the patch was lost which lead to me\n    rediscovering it recently.\n    \n    This is Jin's original patch applied to pupnp 1.8.  This teaches punp to\n    ignore the bytes header if it matches \"0-\" and return HTTP_OK.\n\n2020-01-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tGitHub issue #157\n\n\tWhen building v1.8.6 (on GNU/Linux) with --disable-device, pupnp doesn't build:\n\t/bin/bash ../libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I. -I.. -I../upnp/inc  -I./inc -I../ixml/inc  -DNDEBUG -I./src/inc -I./src/threadutil -I/foo/contrib/x86_64-linux-gnu/include -fPIC  -pthread  -I/foo/contrib/x86_64-linux-gnu/include -DNDEBUG=1 -O3  -DUPNP_STATIC_LIB -Os -Wall -c -o src/genlib/util/libupnp_la-util.lo `test -f 'src/genlib/util/util.c' || echo './'`src/genlib/util/util.c\n\tIn file included from src/genlib/miniserver/miniserver.c:58:0:\n\t./src/inc/upnpapi.h:208:2: error: unknown type name 'service_info'\n  \tservice_info **serv_info\n  \t^~~~~~~~~~~~\n\n\tThis patch fixes compilation for the --disable-device case.\n\t\n\n2019-11-20 ePirat Marvin Scholz <epirat07(at)gmail.com>\n\n        GitHub PRs:\n        #150: Remove unused files\n        #149: UpnpEnableWebserver: Error correctly when web server compiled-out\n        #148: CI: Remove .travis.yml\n        #147: Remove TRUE/FALSE defines and BOOL typedef\n        #146: CI: Add address sanitizer and leak sanitizer enabled test run\n        #145: Add list test\n        #144: Add -Wextra and -Wpedantic to get more warnings\n        #143: More warning fixes\n        #142: Doxygen changes\n        #141: Remove unused headers\n        #140: Remove IN, OUT and INOUT defines\n        #139: Remove unused defines in uri.h\n        #138: Use stdbool.h instead of BOOL typedef and defines\n        #137: Various compiler warning fixes\n        #136: configure.ac: Fix Windows detection\n        #135: configure.ac: Enable silent rules\n        #134: LinkedList: Simplify _WIN32 check\n        #133: Remove checks of __OSX__ define\n        #132: Add Github Actions based CI\n\n2019-12-03 Jean-Francois Dockes <jf(at)dockes.org>\n\n        Github PR #130: Add forgotten Windows dll export qualifiers\n\n2019-12-01 Jean-Francois Dockes <jf(at)dockes.org>\n\n        Github PR #129: Remove and replace the list.h file\n\n2019-11-20 ePirat Marvin Scholz <epirat07(at)gmail.com>\n\n\tGithub PRs:\n\n\t#128: Overhaul list.h to fix various issues\n\t#127: Use rand_s in get_random_info on Windows\n\t#126: Do not redeclare timezone struct if already defined in Mingw\n\t#125: Fix interface filtering for Windows\n\t- The mentioned fix is not only needed for MSVC, but when\n\tcross-compiling for Windows with mingw-w64 too.\n\t#124: config.h: Remove DEBUG_TARGET\n\t- The DEBUG_TARGET is no longer used, it was previously used in\n\tupnpdebug.c to disable logging to a file, which now is done\n\tby just not calling UpnpSetLogFileNames.\n\t#123: Check for -lpthread too\n\t- Updates pthread m4 check from upstream\n\n*******************************************************************************\nVersion 1.10.1\n*******************************************************************************\n\n2019-11-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tForward port of Karlchen's github #122\n\tFix format string for ExtraHeaders\n\n*******************************************************************************\nVersion 1.10.0\n*******************************************************************************\n\n2019-07-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix sed command for upnppatch in configure.ac\n\n2019-04-03 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tProper allocation for an array of structs and a check for an unlikely\n\toverflow when calling the SIOCGIFCONF ioctl().\n\n\tIt still bugs me the stack requirements of getlocalhostname() and\n\tUpnpGetIfInfo().\n\n*******************************************************************************\nVersion 1.8.6\n*******************************************************************************\n\n2019-11-20 KarlStraussberger (Karlchen@github)\n\n\tFix format string for ExtraHeaders #122\n\n*******************************************************************************\nVersion 1.8.5\n*******************************************************************************\n\n2019-07-18 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFixed a wrong ifdef in ssdp_device.c that was causing problems with\n\tipv6. Thanks to BraneDev @ Github\n\n*******************************************************************************\nVersion 1.8.4\n*******************************************************************************\n\n2017-11-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tGitHub #57 - 1.8.3 broke ABI without changing SONAME\n\tOpened by jcowgill\n\n\tThis change in 1.8.3 broke the ABI and therefore the SONAME should have\n\tbeen changed (ie: age reset to 0):\n\n\tEXPORT_SPEC int UpnpAddVirtualDir(\n\t        /*! [in] The name of the new directory mapping to add. */\n\t-       const char *dirName);\n\t+       const char *dirName,\n\t+       /*! [in] The cookie to associated with this virtual directory */\n\t+       const void *cookie,\n\t+       /*! [out] The cookie previously associated, if mapping is already present */\n\t+       const void **oldcookie);\n\n\tIf only the cookie argument was added, you could probably get away with\n\tthis because all that would happen is that a garbage value is passed\n\taround without being used. With the addition of oldcookie, any old\n\tprograms will not initialise this value and will probably segfault when\n\tlibupnp tries to write to it.\n\n*******************************************************************************\nVersion 1.8.3\n*******************************************************************************\n\n2017-09-07 Dave Overton <david(at)insomniavisions.com>\n\n\tAdd userdata/cookie to virtualDir callbacks\n\n\tAs with the main Device APIs (UpnpRegisterRootDevice etc), it is useful\n\tto have a userdata/cookie pointer returned with each callback.\n\n\tThis patch allows one cookie per registered path which enables a variety\n\tof functionality in client apps.\n\n2017-09-03 Uwe Kleine-K\u00f6nig <uwe@kleine-koenig.org>\n\n\tFix large file system support\n\n\tlibupnp uses large file support (if available). If a program linking to\n\tlibupnp does not however it creates mismatches in callframes. See\n\tIssue #51 for the results.\n\n\tThis simplifies LFS support by using AC_SYS_LARGEFILE_SENSITIVE instead of\n\tmanually defining _LARGE_FILE_SOURCE and _FILE_OFFSET_BITS (which is\n\tuseless on architectures where the size of off_t is fixed).\n\n\tFurthermore additional logic is introduced to catch a library user without\n\t64 bit wide off_t on such a platform.\n\n\tupnp.h also makes use of off_t, but as this file includes FileInfo.h, the\n\tlatter is the single right place for this check.\n\n\tThis fixes #52 which is a generalized variant of #51.\n\n2017-08-19 Uwe Kleine-K\u00f6nig <uwe@kleine-koenig.org>\n\n\tconfigure.ac: Drop copying of include files\n\n\tThe comment suggests this is for windows compilation. It should be easily\n\tpossible to add the source directory as an include path to the windows\n\tcompiler, too, so drop this. (Otherwise this should better be done using\n\tAC_CONFIG_COMMANDS.)\n\n2017-09-03 Uwe Kleine-K\u00f6nig <uwe@kleine-koenig.org>\n\n\tLet source code use autoconfig.h not the public upnpconfig.h\n\n\tThe former is the one supposed to be used for internal code. upnpconfig.h is only\n\tfor public stuff.\n\n2017-08-19 Uwe Kleine-K\u00f6nig <uwe@kleine-koenig.org>\n\n\tconfigure.ac: Fix typo s/optionnal/optional/\n\n2017-08-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix broken samples when configured with --disable-ipv6.\n\n*******************************************************************************\nVersion 1.8.2\n*******************************************************************************\n\n2017-07-24 Michael Osipov\n\n\tInitialize in_addr and in6_addr to avoid garbage output if never written\n\n\tIf any of the address families isn't available in UpnpGetIfInfo(),\n\tespecially IPv6, always init both structs with zero to avoid garbage\n\toutput with inet_ntop() to gIF_IPV4 and gIF_IPV6.\n\n\tSee v00d00/gerbera#112 (https://github.com/v00d00/gerbera/issues/112)\n\tfor consequences: bind for IPv6 will fail.\n\n2013-10-28 Vladimir Fedoseev <va-dos(at)users.sourceforge.net>\n\n\tAttached patch allows to register multiple clients from single app.\n\n2014-11-14 Philippe <philippe44ca(at)users.sourceforge.net>\n\n\tHi - I recently compiled libupnp on C++ Builder XE7 and had to do a few\n\tchanges to make it work. In thase this helps, I've generated a small\n\tpatch file.\n\n2015-04-30 Hugo Beauz\u00e9e-Luyssen <chouquette(at)users.sourceforge.net>\n\n\tWhen building using a strict mode (-std=c++11 instead of -std=gnu++11,\n\tfor instance), the WIN32 macro isn't defined. The attached patch fixes\n\tit by using _WIN32 instead.\n\n2015-02-06 Jean-Francois Dockes <jf@dockes.org>\n\n\tQueue events on their subscription object instead of adding them to the\n\tthread pool immediately. \n\n\tEvents destined for a non-responding control point would flood the\n\tthread pool and prevent correct dispatching to other clients, sometimes\n\tto the point of disabling the device. Events are now queued without\n\tallocating thread resources and properly discarded when a client is not\n\taccepting them.\n\n2015-02-03 Jean-Francois Dockes <jf@dockes.org>\n\n\tgenaInitNotify()/genaInitNotifyExt() and\n\tgenaNotifyAll()/genaNotifyAllExt() are relatively complicated methods\n\twhich only differ by the format of an input parameter. This update\n\textracts the common code for easier maintenance, esp. relating to the\n\tqueueing modifications to follow.\n\n\n*******************************************************************************\nVersion 1.8.1\n*******************************************************************************\n\n2017-04-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix some compiler warning messages on md5.c\n\n2017-03-07 Fabrice Fontaine <fontaine.fabrice(at)gmail.com>\n\n\tEnable IPv6 by default\n\n2017-03-07 Fabrice Fontaine <fontaine.fabrice(at)gmail.com>\n\n\tMove threadutil source code to libupnp\n\n\tWith this patch, threadutil library is removed as the only public\n\theader that has been kept in 1.8.x is ithread.h which is mainly a\n\twrapper to pthread with inline functions.\n\tthreadutil source code will now be a part of libupnp library.\n\n*******************************************************************************\nVersion 1.8.0\n*******************************************************************************\n\n2014-01-15 Peng <howtofly(at)gmail.com>\n\n\tFix memory leaks.\n\n2013-04-27 Thijs Schreijer <thijs(at)thijsschreijer.nl>\n\n\tRenamed SCRIPTSUPPORT to IXML_HAVE_SCRIPTSUPPORT for consistency. Also\n\tupdated autoconfig and automake files, so it also works on non-windows.\n\tOption is enabled by default, because it adds an element to the node\n\tstructure. Not using an available field is better than accidentally\n\tusing an unavailable field.\n\n2012-07-11 Thijs Schreijer <thijs(at)thijsschreijer.nl>\n\n\tChanged param to const UpnpAcceptSubscriptionExt() for consistency\n\n2012-06-07 Thijs Schreijer <thijs(at)thijsschreijer.nl>\n\n\tupdated ixmlDocument_createAttributeEx() and ixmlDocument_createAttribute()\n\tto use parameter DOMString instead of char * (same but now consistent)\n\n2012-05-06 Thijs Schreijer <thijs(at)thijsschreijer.nl>\n\n\tAdded script support (directive SCRIPTSUPPORT) for better support of\n\tgarbage collected script languages. The node element gets a custom tag\n\tthrough ixmlNode_setCTag() and ixmlNode_getCTag(). And a callback upon\n\treleasing the node resources can be set using ixmlSetBeforeFree()\n\tSee updated readme for usage.\n\n2012-03-24 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3510595 - UpnpDownloadXmlDoc : can't get the file\n\n\tSubmitted: Marco Virgulti ( mvirg83 ) - 2012-03-23 10:08:08 PDT\n\n\tThere is a problem, perhaps, during downloading a document by\n\tUpnpDownloadXmlDoc. During debugging i've found that in an not exported\n\tapi (unfortunately i forgot the code line...) where it is setted a\n\tlocal variable \"int timeout\" to -1 then passed directly to another\n\tfunction for sending data through tcp socket. I patched this setting it\n\tto 0 (there is an IF section that exits if timeout < 0). It is normal\n\tbehavior or it is a bug?\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tCheck for NULL pointer in TemplateSource.h\n\n\tcalloc can return NULL so check for NULL pointer in CLASS##_new and\n\tCLASS##_dup.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tReplace strcpy with strncpy in get_hoststr\n\n\tReplace strcpy with strncpy to avoid buffer overflow.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tMemory leak fix in handle_query_variable\n\n\tvariable was never freed.\n\n2011-02-07 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tAdd HTTPS support using OpenSSL. HTTPS support is optional and can\n\tbe enabled by passing the --enable-open-ssl argument to the\n\tconfigure script.\n\n\tThe following methods are introduced to the public API:\n\tUpnpInitOpenSslContext\n\n\tWhen enabled, HTTPS can be used by using \"https://\" instead of\n\t\"http://\" when passing URLs to the HTTP Client API.\n\n2011-02-07 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tRefactor HTTP Client API to be more generic.\n\n\tThe following features are added:\n\n\t- Support for persistent HTTP connections (reusing HTTP\n\t  connections). Tthis is still a work in progress and relies on\n\t  applications to interpret the 'Connection' header\n\t  appropriately.\n\n\t- Support for specifying request headers when making\n\t  requests. Useful for interacting with web services that require\n\t  custom headers.\n\n\t- Support for retrieving response headers (this is a API only\n\t  change, some more work needs to be done to implement the actual\n\t  functionality. Specifically copy_msg_headers in httpreadwrite.c\n\t  needs to be implemented)\n\n\t- Common API for all HTTP methods.\n\n\t- Support for PUT, and DELETE methods.\n\n\tThe following methods are introduced to the public HTTP Client API\n\n\tUpnpOpenHttpConnection, UpnpCloseHttpConnection, UpnpMakeHttpRequest,\n\tUpnpWriteHttpRequest, UpnpEndHttpRequest, UpnpGetHttpResponse,\n\tUpnpReadHttpResponse.\n\n\tRemoved a lot of duplicate code in httpreadwrite.c\n\n2011-01-17 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tInclude upnpconfig.h in FileInfo.h to automatically include large\n\tfile macros\n\n2011-01-17 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tFix for warnings Apple systems related to macros defined in list.h.\n\n\tIn list.h, in apple systems, undefine the macros prior to defining them.\n\n2011-01-16 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for UpnpFileInfo_get_LastModified() in http_MakeMessage().\n\n\tUpnpFileInfo_get_LastModified() returns time_t, and http_MakeMessage()\n\ttakes a \"time_t *\". Thanks to Chandra Penke for pointing the bug.\n\n2010-11-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\tTemplate object for ssdp_ResultData.\n\n2010-11-10 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tSupport for \"polling\" select in sock_read_write.\n\n\tCurrently, in sock_read_write function, if the timeout is 0, pupnp\n\trealizes a \"blocking\" select (with an infinite timeout). With this\n\tpatch, if timeout is set to 0, pupnp will realize a \"polling\" select\n\tand returns immediately if it can not read or write on the socket. This\n\tis very useful for GENA notifications when pupnp is trying to send\n\tevents to a disconnected Control Point. \"Blocking\" select can now be\n\tdone by putting a negative timeout value.\n\n2010-09-18 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tThis is a minor build fix. The new Template*.h files added in the latest\n\tcode need to be exported. Patch against the latest sources is attached.\n\n2010-08-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* upnp/src/api/Discovery.c: Fix a serious bug and memory leak in\n\tUpnpDiscovery_strcpy_DeviceType(). Thanks to David Blanchet for the\n\tpatch.\n\n2010-04-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSeparation of the ClientSubscription object.\n\n2010-04-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tProtect the object destructors agains null pointers on deletion, which\n\tshould be something valid.\n\n2010-03-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSF Patch Tracker [ 2987390 ] upnp_debug vs. ixml_debug\n\tThanks for the load of updates, I'm still assimilating them ! Could I make\n\ta suggestion though? The addition of printNodes(IXML_Node) to upnpdebug a\n\tdds a new dependency on ixml.h for anything using upnpdebug.h. I'm making\n\tquite a bit of use of upnpdebug in porting things to version 1.8.0, and I'd\n\tprefer it if printNodes could be added to ixmldebug.h instead. I'm attach\n\ting a patch, what do you think ?\n\n\tNick\n\n2010-03-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Forward port of svn revision 505:\n\tSF Patch Tracker [ 2836704 ] Patch for Solaris10 compilation and usage.\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\n2010-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2969188 ] 1.8.0: patch for FreeBSD compilation\n\tSubmitted By: Nick Leverton (leveret)\n\tFix the order of header inclusion for FreeBSD.\n\n2010-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Forward port of svn revision 502:\n\tSF Patch Tracker [ 2836704 ] Search for nested serviceList (not\n\tstopping at the first lis\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\t\n\tInternet Gateway Device description contains nested serviceList (rootdevice\n\t-> servicelist, subdevice\n\tand subdevice has the lower-level serviceList, etc..)\n\n\tUnfrotunately, the sample code sample_util.c used by tv_device sample,\n\tetc.\n\thas a code that looks for only the first top-level serviceList.\n\tThis results in the failure to read all the services of an IGD xml\n\tdescription.\n\n\tAttached patch modifies this behavior and looks for the service by\n\tvisiting all the serviceList in xml document in turn.\n\n\tWith the modified patch (ad additional modification), I could\n\tsimulate an IGD device and created a modified control program for that.\n\n\tPatch against 1.6.6\n\n\tTIA.\n\n2010-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2973319 ] Problem in commit 499\n\tSubmitted By: Nick Leverton (leveret)\n\tAfraid that this doesn't compile, it seems retval should be retVal in two\n\tplaces.\n\n2010-03-16 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for the ithread_mutex_unlock() logic in UpnpInit().\n\tThanks for Nicholas Kraft.\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2962606 ] Autorenewal errors: invalid SID,\n\ttoo-short renewal interval\n\tSubmitted By: Nick Leverton (leveret)\n\t\n\tAuto-renewals send an invalid SID due to a missing UpnpString_get_String\n\tcall. They also send a renewal interval of 0 instead of copying it from\n\tthe original subscription.\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2964685 ] patch for avoiding inet_ntoa (1.8.0)\n\tSubmitted By: Nick Leverton (leveret)\n\t\n\tSeems like SF's tracker won't let me add a patch to someone else's issue ?!\n\tThis refers to https://sourceforge.net/support/tracker.php?aid=2724578\n\t\n\tThe calls to inet_ntoa are in getlocalhostname(), which is called from\n\tUpnpInit when it is returning the bound IP address. \n\tUpnpInit/getlocalhostname hasn't been updated to IPv6, I presume this is\n\tdeliberate so that it doesn't start returning IPv6 addresses and\n\toverwriting the caller's IPv4-sized allocation.\n\t\n\tThe attached patch just updates getlocalhostname to use inet_ntop instead\n\tof inet_ntoa, and also documents the fact that UpnpInit is IPv4 only whilst\n\tUpnpInnit2 is both IPv4 and IPv6.\n\t\n\tA fuller solution might be to change UpnpInit to use some variant on\n\tUpnpGetIfInfo. UpnpInit could still be left as IPv4 only if desired -\n\tperhaps UpnpGetIfInfo could take an option for the desired address family.\n\tgetlocalhostname and its own copy of the interface scanning code would then\n\tbe redundant. I don't have IPv6 capability here though so I'm reluctant to\n\tchange the IPv6 code, as I have no way to test it.\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2724578 ] patch for avoiding memory leaks when\n\tadd devices\n\t\n\teach time a device been added, UpnpInit() is called, on exit, UpnpFinish()\n\tis called, but the memories allocated by ThreadPoolInit() may lost because\n\tthere's no code to call ThreadPoolShutdown() to release the memories. And\n\tinet_ntoa() is not thread safe, so in my patch, I substitute inet_ntoa()\n\twith inet_ntop().\n\n2010-03-14 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2964687 ] Add new string based accessors to upnp\n\tobject API\n\n\tAs per email to pupnp-devel, this is the patch to add the _strget_\n\taccessors for string-like objects in the interface.\n\t\n\tWill add a further patch shortly to udpate the sample programs.\n\n2008-06-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Nicholas Kraft's patch to fix some IPv6 copy/paste issues. He\n\treported to be getting infinite loops with the svn code.\n\n2008-06-13 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1984541 ]\n\tixmlDocumenttoString does not render the namespace tag.\n\tSubmitted By: Beliveau - belivo\n\n\tUndoing the patch that fixed this problem. In fact, there was no\n\tproblem and the patch was wrong.\n\n2008-06-11 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Ingo Hofmann's patch for \"Content-Type in Subscription responses\".\n\tAdds charset=\"utf-8\" attribute to the CONTENT-TYPE header line.\n\n\tHi,\n\n\tI have found an inconsistency regarding the text/xml content-type\n\treturned by libupnp. It looks like only subscription responses send\n\t\"text/xml\" where all other messages contain \"text/xml; charset=\"utf-8\"\".\n\tSince I'm working on an DLNA device the latter behaviour is mandatory.\n\tI changed the according lines in gena_device.c (see attached patch).\n\tI'm not sure if it would be ok for other device to have the charset\n\tfield but it would help me a lot :)\n\n\tBest regards,\n\tIngo\n\n2008-06-04 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1984541 ]\n\tixmlDocumenttoString does not render the namespace tag.\n\tSubmitted By: Beliveau - belivo\n\n\tThe problem occurs when converting a xml document using\n\tixmlDocumenttoString containing a namespace tag created with\n\tixmlDocument_createElementNS. The namespace tag doesn't get rendered.\n\n\texample: The following code fragment prints:\n\n\t<?xml version=\"1.0\"?>\n\t<root></root>\n\n\tinstead of:\n\t<?xml version=\"1.0\"?>\n\t<root xmlns=\"urn:schemas-upnp-org:device-1-0\"></root>\n\t\n\tCode:\n\n\t#include <stdlib.h>\n\t#include <upnp/ixml.h>\n\n\tint main()\n\t{\n\t\tIXML_Document* wDoc = ixmlDocument_createDocument();\n\t\tIXML_Element* wRoot = ixmlDocument_createElementNS(wDoc,\n\t\t\t\"urn:schemas-upnp-org:device-1-0\", \"root\");\n\t\tixmlNode_appendChild((IXML_Node *)wDoc,(IXML_Node *)wRoot);\n\t\tDOMString wString = ixmlDocumenttoString(wDoc);\n\t\tprintf(wString);\n\t\tfree(wString);\n\t\tixmlDocument_free(wDoc);\n\t\t\n\t\treturn 0;\n\t}\n\n\tThe problem was in the printing routine, not in the library data\n\tstructure.\n\n2008-05-31 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Charles Nepveu's suggestion of not allocating a thread for\n\tMiniServer when it is not compiled.\n\n2008-05-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Ported Peter Hartley's patch to compile with mingw.\n\n2008-05-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added some debug capability to ixml.\n\n2008-05-02 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Merged Charles Nepveu's IPv6 work. libupnp now is IPv6 enabled.\n\n2008-02-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Breaking API so that we now hide internal data structures.\n\n2008-02-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Rewrote Peter Hartley's patch to include a new extra header field in\n\tFileInfo.\n\n*******************************************************************************\nVersion 1.6.22\n*******************************************************************************\n\n2017-07-07 James Cowgill <james410(at)cowgill.org.uk>\n\n\tReplace MD5 impmplementation with public-domain version\n\n\tCurrently the RSA MD5 implementation is used. Unfortunately the license\n\thas some potential issues:\n\t* The license does not explicitly allow distributing derivative works.\n\tThis was the original argument used in\n\t[Debian #459516](https://bugs.debian.org/459516).\n\t* The license contains an advertising clause similar to the BSD 4-clause\n\tlicense. This is incompatible with the GPL and if it were enforced,\n\twould require RSA to be mentioned by pretty much everyone who uses pupnp.\n\n\tThe simple solution is to replace it with a public domain\n\timplementation. I've taken OpenBSDs implementation and tweaked it\n\tslightly for use by pupnp by:\n\t- Adjusting the includes.\n\t- Removing the __bounded__ attributes which are specific to OpenBSD.\n\t- Using the standard integer types from stdint.h.\n\t- Using memset instead of explicit_bzero.\n\n2016-12-16 Peter Pramberger <peterpramb(at)users.sf.net>\n\n\tixml/test/test_document.c is missing the string.h include, therefore\n\tthe compiler complains about an implicit declaration.\n\n*******************************************************************************\nVersion 1.6.21\n*******************************************************************************\n\n2016-12-16 Gabriel Burca <gburca(at)github>\n\n\tIf the error or info log files can not be created, use stderr and\n\tstdout instead.\n\n2016-12-08 Uwe Kleine-K\u00f6nig <uwe(at)kleine-koenig.org>\n\n\tFix out-of-bound access in create_url_list() (CVE-2016-8863)\n\n\tIf there is an invalid URL in URLS->buf after a valid one, uri_parse is\n\tcalled with out pointing after the allocated memory. As uri_parse writes\n\tto *out before returning an error the loop in create_url_list must be\n\tstopped early to prevent an out-of-bound access\n\n\tBug: https://sourceforge.net/p/pupnp/bugs/133/\n\tBug-CVE: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-8863\n\tBug-Debian: https://bugs.debian.org/842093\n\tBug-Redhat: https://bugzilla.redhat.com/show_bug.cgi?id=1388771\n\n2016-11-30 Uwe Kleine-K\u00f6nig <uwe(at)kleine-koenig.org>\n\n\tminiserver: fix binding to ipv6 link-local addresses\n\n\tLinux requires to have sin6_scope_id hold the interface id when binding to\n\tlink-local addresses. This is already in use in other parts of upnp, so\n\tportability shouldn't be in the way here. Without this bind(2) fails with\n\terrno=EINVAL (although ipv6(7) from manpages 4.08 specifies ENODEV in this\n\tcase).\n\n\tFixes: https://bugs.debian.org/813249\n\n2016-09-15 Mathew Garret <(at)mjg59 (twitter)>\n\n\tSF Bug Tracker #132 CVE-2016-6255: write files via POST\n\n\tSubmitted by: Balint Reczey in 2016-08-02\n\n\tFrom Debian's BTS https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=831857 :\n\tFrom: Salvatore Bonaccorso carnil@debian.org\n\tTo: Debian Bug Tracking System submit@bugs.debian.org\n\tSubject: libupnp: write files via POST\n\tDate: Wed, 20 Jul 2016 11:03:34 +0200\n\tSource: libupnp\n\tVersion: 1:1.6.17-1\n\tSeverity: grave\n\tTags: security upstream\n\tJustification: user security hole\n\tHi\n\tSee http://www.openwall.com/lists/oss-security/2016/07/18/13 and\n\thttps://twitter.com/mjg59/status/755062278513319936 .\n\tProposed fix:\n\thttps://github.com/mjg59/pupnp-code/commit/be0a01bdb83395d9f3a5ea09c1308a4f1a972cbd\n\tRegards,\n\tSalvatore\n\n\tFrom Mathew Garret's commit: Don't allow unhandled POSTs to write to the filesystem by default\n\n*******************************************************************************\nVersion 1.6.20\n*******************************************************************************\n\n2016-02-22 Jean-Francois Dockes <medoc(at)users.sf.net>\n\n\tSF Bugs #131, Creator: Jean-Francois Dockes\n\n\tI know it sounds crazy that nobody ever saw this, but the CONTENT-LENGTH\n\tvalue in GENA NOTIFY messages is too small by one.\n\n\tIt appears that most current control points don't notice the extra\n\tcharacter (an LF, which is validly there but not included in\n\tContent-Length), probably because their protocol handler is reasonably\n\tlenient, and because the missing body LF does not prevent parsing the\n\tXML. But there is a least one anal CP (Linn Kazoo) which barfs, because\n\tit reads all data until connection close and the size mismatch triggers\n\ta bug.\n\n\t\"Proof\":\n\tIn gena_device.c:217 (notify_send_and_recv())\n\n\tret_code = http_SendMessage(&info, &timeout,\n\t    \"bbb\",\n\t    start_msg.buf, start_msg.length,\n\t    propertySet, strlen(propertySet),\n\t    CRLF, strlen(CRLF));\n\n\tstart_msg has all the headers, including the empty line.\n\tContent-length should be strlen(propertySet) + strlen(CRLF) (2)\n\tIn gena_device.c:433 (AllocGenaHeaders())\n\n\trc = snprintf(headers, headers_size, \"%s%s%\"PRIzu\"%s%s%s\",\n\t    HEADER_LINE_1,\n\t    HEADER_LINE_2A,\n\t    strlen(propertySet) + 1,\n\t    HEADER_LINE_2B,\n\t    HEADER_LINE_3,\n\t    HEADER_LINE_4);\n\n\tHEADER_LINE_2A is \"CONTENT-LENGTH: \". \n\tThe following value should be strlen(propertySet) + 2\n\n2016-01-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for a reported integer overflow\n\n2016-01-07 Jean-Francois Dockes <medoc(at)users.sf.net>\n2016-01-07 Nick Leverton <nick(at)leverton.org>\n\tSF Patches #60, Creator: Jean-Francois Dockes\n\n\tWhen libupnp is configured with --enable-ipv6 but ipv6 is not available\n\ton the system (for example because the ipv6 code is not loaded in a Linux\n\tkernel as is the case by default on Raspbian), the ipv6 socket creation\n\tcall will fail in miniserver.c and the library init will fail, even if\n\tthe ipv4 initialisation would have succeeded.\n\n\tLet a library configured with --enable-ipv6 initialize in ipv4-only\n\tmode if ipv6 is not available instead of failing. This can happen\n\tif no ipv6 code is configured or loaded in the kernel.\n\n\tDon't fail if IPv6 is unavailable.\n\tWe might be an IPv6 enabled distro build running on an IPv4-only custom kernel.\n\n2016-01-07 Nick Leverton <nick(at)leverton.org>\n\n\tSF Bug Tracker #128, Creator: Nick Leverton\n\tredefining strndup causes \"error: expected identifier or '(' before '__extension__'\"\n\n\tFix redefinition of strnlen and strndup\n\tThese are available when HAVE_STRNDUP and HAVE_STRNLEN are defined, but\n\tlibupnp provides an extern prototype anyway.  Recent versions of glibc\n\tdefine this prototype differently, causing the following compile error:\n\n\tsrc/api/UpnpString.c:47:15: error: expected identifier or '(' before  '__extension__'\n\t\textern char *strndup(__const char *__string, size_t __n);\n\n2016-01-07 Nick Leverton <nick(at)leverton.org>\n\n\tSF Bug Tracker #129, Creator: Nick Leverton\n\tshutdown() on UDP sockets logs ENOTCONN message.\n\thttps://sourceforge.net/p/pupnp/bugs/129/\n\n\tFix ENOTCONN \"Error in shutdown: Transport endpoint is not connected\"\n\n\tWhen logging is enabled, ssdpserver logs bursts of\n\t\"Error in shutdown: Transport endpoint is not connected\"\n\tThis is because shutdown() is not supported for UDP sockets and under\n\trecent UNIX specifications it returns ENOTCONN if used.\n\t\n2016-01-07 Nick Leverton <nick(at)leverton.org>\n\n\tSF Bug Tracker #127, Creator: Klaus Fischer\n\tMiniserver uses INADDR_ANY instead of HostIP\n\thttps://sourceforge.net/p/pupnp/bugs/127/\n\n\tThe internal miniserver.c uses INADDR_ANY instead of the HostIP/IfName\n\tprovided when initializing libupnp. But, this HostIP/IfName gets used\n\tfor the UDP socket when multicasting SSDP messages.  Because of this,\n\tminiserver may end up sending from different IP address than ssdpserver.\n\tThis patch causes miniserver to use the already known interface address.\n\n2016-01-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker #130, Creator: Shaddy Baddah\n\tinfinite loop in UpnpGetIfInfo() under WIN32\n\n\tOriginal code makes no sense. This patch should fix it.\n\n2015-02-04 Shaun Marko <semarko@users.sf.net>\n\n\tBug tracker #124 Build fails with --enable-debug\n\n\tBuild environment\n\tFedora 21\n\tX86-64\n\t* gcc 4.9.2\n\n\tHow to repeat\n\t$ ./configure --enable debug\n\t$ make\n\tlibtool: compile: gcc -DHAVE_CONFIG_H -I. -I.. -I../upnp/inc -I./inc -I../threadutil/inc\n\t-I../ixml/inc -I./src/inc -pthread -g -O2 -Wall -MT src/api/libupnp_la-UpnpString.lo\n\t-MD -MP -MF src/api/.deps/libupnp_la-UpnpString.Tpo -c src/api/UpnpString.c\n\t-fPIC -DPIC -o src/api .libs/libupnp_la-UpnpString.o src/api/UpnpString.c:47:16:\n\terror: expected identifier or '(' before 'extension'\n\textern char *strndup(const char *string, size_t __n);\n\t^\n\tMakefile:1016: recipe for target 'src/api/libupnp_la-UpnpString.lo' failed\n\n\tReason for failure\n\tBuild enables -O2 optimization flags which causes the inclusion of a\n\tmacro implementation of strndup from include/bits/string2.h.\n\n\tWorkarounds\n\tDisable optimization when configuring or making:\n\t$ configure CFLAGS='-g -pthread -O0' --enable-debug\n\t$ make\n\tor\n\t$ configure --enable-debug\n\t$ make CFLAGS='-g -pthread -O0' Define NO_STRING_INLINES\n\t$ export CFLAGS=\"-DNO_STRING_INLINES -O2\"\n\t$ ./configure --enagble-debug\n\t$ make\n\n\tFix\n\t* Don't declare strndup in src/api/UpnpString.c if it exists\n\n2015-02-01 Jean-Francois Dockes <medoc@users.sf.net>\n\n\tOut-of-tree builds seem to be currently broken, because ixml and\n\tthreadutil files need an include path to include UpnpGlobal.h, and\n\tconfigure tries to copy files into a directory which it does not create.\n\tThe patch fixes both issues.\n\n2014-01-03 Peng <howtofly(at)gmail.com>\n\n\trewrite soap_device.c\n\n\t1) separate HTTP handling from SOAP handling\n\t2) remove repeated validity check, each check is performed exactly once\n\t3) fix HTTP status code per UPnP spec, SOAP spec and RFC 2774\n\n*******************************************************************************\nVersion 1.6.19\n*******************************************************************************\n\n2013-11-14 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker #119, Creator: Klaus Fischer\n\tAccess violation due to changed usage of pthreads-win32\n\n\tDear libupnp developers,\n\n\tI have experienced a crash (access violation) when using libupnp on\n\tWindows. The crash is actually located in pthreads-win32 and happens\n\twhen repeatedly de-/initializing libupnp on Win32 in the same process\n\tand both libupnp and pthreads-win32 are compiled as static libraries.\n\n\tSo I'm doing this:\n\t- UpnpInit()\n\t- UpnpFinish()\n\t- UpnpInit() <- Crash\n\n\tI am already in touch with Ross Johnson on the pthreads-win32 mailing\n\tlist regarding this issue:\n\n\thttp://sourceware.org/ml/pthreads-win32/2013/msg00020.html\n\n\tHe told me the problem is that the functions\n\tpthread_win32_process_attach/detach_np() should no longer be called\n\tdirectly, but are invoked automatically now since version 2.9.0 of\n\tpthreads-win32, which has been released approx. 1.5 years ago. Please\n\trefer to above link for in-depth information.\n\n\tSo for proper using of latest pthreads-win32 library, those function\n\tcalls should vanish inside libupnp. Could you consider adapting libupnp\n\tin that way? I would really like to use both libraries out-of-the-box\n\twithout local modifications, and this issue prevents that.\n\n\tBest regards,\n\tKlaus\n\n2013-11-08 Peng <howtofly(at)gmail.com>\n\n\tFix several minor bugs in soap_device.c\n\n\t1) remove redundant free\n\t2) avoid user-provided ErrStr being overwritten by the default one\n\t3) eliminated memory leak possiblity in handle_query_variable\n\n2013-11-08 Peng <howtofly(at)gmail.com>\n\n\tFix return value check of parse_uri.\n\n2012-06-19 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker #118, Creator: T.Iwamoto\n\ttv_ctrlpt crashes after detecting a later version of tvcontrol service\n\n\tFrom:  gon3456@users.sf.net\n\tSteps to reproduce:\n\t1. Extracts and build libupnp-1.6.18\n\t$ tar -xjf /path/to/archive/libupnp-1.6.18.tar.bz2\n\t$ cd libupnp-1.6.18\n\t$ ./configure\n\t$ make\n\t2. Applies the attached patch and remake.\n\t$ patch -p1 < /path/to/patch/libupnp-1.6.18.patch\n\t$ make\n\t3. Run tv_device.\n\t$ cd upnp/sample\n\t$ ./tv_device\n\t4. Run tv_ctrlpt; the tv_ctrlpt crashes soon.\n\t$ ./tv_ctrlpt\n\tSegmentation fault (core dumped)\n\tThis is an issue report about the sample program of control point.\n\tThe tv_ctrlpt crashes after detecting a tvdevice that contains tvcontrol:2 or higher version of tvcontrol service.\n\ttv_ctrlpt should detect correctly such devices due to forward compatibility of control points with device.\n\tFor more information about the compatibility, please refer the following document:\n\tDLNA Architectures and Protocols Part 1 2011 December - 7.3.2.1.3 (GUN:GZJXU)\n\tThe attached patch changes the sample programs as below:\n\t- device: changes version of tvcontrol service from 1 to 2. This change may occur in the future.\n\t- cp: nothing changed: cp knows version 1 of tvcontrol service only.\n\tI know many vendors implements their control points based on the tv_ctrlpt, so I hope to fix this issue ASAP.\n\n\t==\n\n\tFrom: Yoichi NAKAYAMA\n\tSEGV is caused by strcpy with NULL argument.\n\tAttached patch will avoid SEGV in strcpy, but there may be other inconsistencies.\n\n\t> I know many vendors implements their control points based on the tv_ctrlpt,\n\n\tI don't think so. I think tv_ctrlpt is just a sample to be used with tv_device.\n\n2013-10-28 Pino Toscano <pinotree(at)users.sourceforge.net>\n\n\tFix compilation on GNU/Hurd\n\n2013-10-28 Peng <howtofly(at)gmail.com>\n\n\tFix return value of http_RecvPostMessage and update httpparser.c's comments\n\n2013-10-17 Peng <howtofly(at)gmail.com>\n\n\tFix return value of process_request and related subroutines\n\t1) Only HTTP_XXX should be return\n\t2) Make default return value work for process_request\n\n2013-10-15 Peng <howtofly(at)gmail.com>\n\n\tFix Content-Range generation bug\n\n2013-09-10 zexian chen <chenzexian88(at)gmail.com>\n\n\tHi,\n\n\tI had found some bugs about memory leak on libupnp-1.6.18. \n\n\tIt may lead to memory leak  when calling ThreadPoolAdd() or\n\tThreadPoolAddPersistent() which does not return 0. \n\n\tSee the attachment for patch.\n\n2013-09-03 Peng <howtofly(at)gmail.com>\n\n\tFix return value of config_description_doc.\n\n\tUPNP_E_XXX should not be used instead of IXML_XXX\n\n2013-09-03 Peng <howtofly(at)gmail.com>\n\n\tRemove faulty free in GetDescDocumentAndURL.\n\n\ttemp_str, which points to part of description, should not be freed.\n\n2013-09-02 Peng <howtofly(at)gmail.com>\n\n\tSuppose the UPnP device is listening on 192.168.1.102:49152. Use the following to send\n\tgarbage bytes to the device:\n\twhile true; do echo \"\\\"\"; done | netcat 192.168.1.102 49152\n\n\tThe device just keeps receiving these bytes and its memory usage keeps growing.\n\tMalicious client may exploit it to exhaust the device's memory.\n\n\tThe attached patch eliminates this possibility.\n\n2013-09-02 Peng <howtofly(at)gmail.com>\n\n\t1) restore the scanner's original cursor position in case of\n\t   insufficient input;\n\t2) free the memories allocated for a new header in case of a failure.\n\n2013-08-13 Peng <howtofly(at)gmail.com>\n\n\tPatch to fix behaviou when char is signed\n\n\tit seems to me that there is still something wrong:\n\n\t1)  the new is_qdtext_char() is incorrect.\n\tThere is a trap if char is implemented as signed char.\n\tSuppose that c is '\\xFF', it will be -1 when converted to an int.\n\tBy definition, c should be qdtext:\n\tqdtext = <any TEXT except <\">>\n\tTEXT = <any OCTET except CTLs, but including LWS>\n\tOCTET = <any 8-bit sequence of data>\n\n\t2) the character after '\\\\' could be either part of a quoted-pair\n\t(together with '\\\\'), or a normal qdtext, since '\\\\' itself can\n\tbe treated as a qdtext. This is equivalent to saying that the\n\tcharacter after '\\\\' in a quoted string could be ANY octet.\n\n\tA patch based on the above two observations is attached.\n\n\tPeng\n\n2013-08-13 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tEnforce RFC 2616 and accept \"0\" after a backslash for quoted-strings.\n\n\tReported by Peng <howtofly(at)gmail.com>\n\n2013-08-13 Peng <howtofly(at)gmail.com>\n\n\tPatch to make scanner_get_token more robust (avoid over-reading).\n\n2013-07-30 Zheng Peng <darkelf2010(at)users.sf.net>\n\n\tSF ticket #116 UpnpRemoveVirtualDir wrong linked list operation\n\n\tWhat if pVirtualDirList has two nodes and what we want to delete is the\n\tfirst one. Patch attached.\n\n2013-07-30 Sebastian Brandt <s.brandt(at)aixtrusion.de>\n\n\tDear libupnp-devels,\n\twhen POST'ing to the simple web server in libupnp, the application crashes.\n\tThis is caused by a missing \"...\" argument in webserver.c:1533.\n\tSeems it has been there for a long time ... 1.6.9 and 1.6.18 have it.\n\n\twebserver.c:1533 calls http_MakeMessage\n\t/* Send response. */\n\thttp_MakeMessage(&headers, 1, 1,\n\t\t \"RTLSXcCc\",\n\t\t ret, \"text/html\", X_USER_AGENT);\n\tThe format parameter RTLSXcCc needs four arguments -\n\tR - response code - ret,\n\tT- content type - text/html,\n\tL - struct SendInstruction * - NOT PRESENT\n\tX - user agent - X_USER_AGENT\n\n\tThis results in a crash.\n\n\tChanging to\n\thttp_MakeMessage(&headers, 1, 1,\n\t\t \"RTLSXcCc\",\n\t\t ret, \"text/html\", &RespInstr, X_USER_AGENT);\n\tsolves the situation.\n\n\tYours,\n\tSebastian Brandt\n\n*******************************************************************************\nVersion 1.6.18\n*******************************************************************************\n\n2012-12-06 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSecurity fix for CERT issue VU#922681\n\n\tThis patch addresses three possible buffer overflows in function\n\tunique_service_name(). The three issues have the folowing CVE numbers:\n\n\tCVE-2012-5958 Issue #2: Stack buffer overflow of Tempbuf\n\tCVE-2012-5959 Issue #4: Stack buffer overflow of Event->UDN\n\tCVE-2012-5960 Issue #8: Stack buffer overflow of Event->UDN\n\n\tNotice that the following issues have already been dealt by previous\n\twork:\n\n\tCVE-2012-5961 Issue #1: Stack buffer overflow of Evt->UDN\n\tCVE-2012-5962 Issue #3: Stack buffer overflow of Evt->DeviceType\n\tCVE-2012-5963 Issue #5: Stack buffer overflow of Event->UDN\n\tCVE-2012-5964 Issue #6: Stack buffer overflow of Event->DeviceType\n\tCVE-2012-5965 Issue #7: Stack buffer overflow of Event->DeviceType\n\n2012-06-19 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix memory leak and access violation in UpnpSendAction(Ex)Async.\n\n\tFree buffers after malloc or ixmlPrintNode failure.\n\tFree Param->Header before destructing Param.\n\n2012-05-25 Anoop Mohan <anoop.anoop(at)gmail.com>\n\n\tThis patch fixes a bug in non blocking connect call where the sock\n\toption length for SO_ERROR was passed as 0 instead of sizeof(int).\n\n2012-04-24 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tDisable SetGenaCallback call if device is disabled.\n\n\tIf device is disabled, SetGenaCallback definition is disabled,\n\tbut its call remains. A link error will occur in Win32.\n\n2012-04-21 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix condition for allocation failure in get_content_type().\n\n\tAt the end of get_content_type() in webserver.c, it should check\n\treturn value of ixmlCloneDOMString().\n\n2012-04-21 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix problems detected as dead assignment warning by clang scan-build.\n\n\tWrong assignment by shutdown result hides the real error code\n\tof NewRequestHandler() in ssdp_device.c.\n\tFix return code description of NewRequestHandler().\n\tHandle return code from ithread_create in sample applications.\n\tRemove unused assignments.\n\n2012-04-20 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid dereference of null pointer in ixmlNode_setNodeProperties.\n\n\tThe problem can occur if one of the arguments is NULL.\n\tTest argument and fix assertion.\n\n2012-04-17 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tCreate intermediate directory per project on vc9.\n\n\tSample applications share sample_util.c and collisions of\n\tobject file can occur in parallel build. Modify project files to\n\tsplit intermediate directories against it.\n\tApply similar changes also to library projects, like vc10 projects.\n\n2012-04-11 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid access violation after parser_parse_chunky_headers call.\n\n\tIn parser_parse_chunky_headers, parser->msg.msg.buf can be changed\n\tby membuffer_delete call. Therefore if we save the pointer to\n\tparser->msg.entity.buf before calling membuffer_delete, it will\n\tinduce access to released memory.\n\n2012-04-06 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tRemove possibility of access violation.\n\n\t1. Test Instr before dereference it in http_RecvPostMessage.\n\t(Though it never becomes NULL because NULL is not passed to\n\tthe static method)\n\t2. Avoid strdup(NULL) in ixmlElement_setAttributeNS.\n\tThose are detected by llvm scan-build.\n\n2012-04-05 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3507819 - Use of thread-unsafe gmtime() in httpreadwrite.c\n\n\tSubmitted: zephyrus ( zephyrus00jp ) - 2012-03-18 06:31:00 PDT\n\n\tDefine http_gmtime_r and web_server_asctime_r and use it.\n\tThose prefix are added since pthread for Win32 already\n\thas macro gmtime_r and asctime_r.\n\n2012-04-05 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix type of local variable stopSock in RunMiniServer()\n\n\tThe variable is declared as SOCKET, but it is used to\n\tstore return value of int receive_from_stopSock(...).\n\tThe type was changed in the commit\n\t4b47e6a51d9c7049a862695b68de75699e023551 by mistake.\n\n2012-04-03 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tCompilation optimisation\n\n\tDo not compile the code related to the webserver in http_SendMessage\n\twhen --disable-webserver is set\n\n*******************************************************************************\nVersion 1.6.17\n*******************************************************************************\n\n2012-04-02 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3514145 - Memory leak fix in threadutil\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-04-02 06:49:20 PDT\n\n\tPut thread in a detached state when calling ithread_create otherwise in\n\tsome circumstances, thread can end before the call to ithread_detach.\n\n2012-03-30 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdd --enable-unspecified_server\n\n\tAdd --enable-unspecified_server configure option to set to \"Unspecified\"\n\tthe OS name, OS version, product name and product version normally\n\tcontained in the SERVER header as this could be used by an attacker.\n\n2012-03-29 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemoving implicit casts in miniserver.c\n\n\tRemoving implicit integer or enum casts in miniserver.c.\n\n2012-03-29 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3512833 - Miniserver is wrongly disabled\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-29 07:36:34 PDT\n\n\tMiniserver is disabled if ECXLUDE_GENA, EXCLUDE_SOAP and\n\tEXCLUDE_WEBSERVER are set.\n\tHowever, SSDP needs the Miniserver to answer to M-SEARCH requests.\n\tSo, MiniServer should not be disabled if EXCLUDE_SSDP is not also set.\n\n2012-03-26 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3510693 - build fail with --disable-device\n\n\tUse INCLUDE_DEVICE_APIS instead of UPNP_HAVE_DEVICE as in other sources.\n\tDon't use soap_device_callback if INCLUDE_DEVICE_APIS is not set,\n\totherwise link error occur on Windows.\n\n2012-03-26 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3511149 - --disable-ssdp has no effect\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-03-25 18:14:34 PDT\n\n\tThere are typos in upnp/src/inc/config.h \"EXCLUDE_SSSDP\" (shold be\n\tEXCLUDE_SSDP), therefore EXCLUDE_SSDP is always 0, and --disable-ssdp\n\thas no effect.\n\n2012-03-24 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove implicit casts\n\n\tCast parameters of htonl in uint32_t in IN6_IS_ADDR_GLOBAL and\n\tIN6_IS_ADDR_ULA definitions.\n\tRemove comparison with 0 in while statement of vfmatch,\n\thttp_SendMessage and http_MakeMessage.\n\n2012-03-24 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3510693 - build fail with --disable-device\n\n\tGetDeviceHandleInfo just fail without using undefined member DeviceAf\n\tif UPNP_HAVE_DEVICE is not defined.\n\tMove ContentTypeHeader definition to soap_common.c, since it is\n\talso used in soap_ctrlpt.c.\n\n*******************************************************************************\nVersion 1.6.16\n*******************************************************************************\n\n2012-03-18 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tReplace sprintf by snprintf in http_WriteHttpPost\n\n\tReplace sprintf by snprintf in http_WriteHttpPost to avoid buffer\n\toverflow.\n\n2012-03-18 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdd infoSize parameter to get_sdk_info\n\n\tAdd infoSize parameter to get_sdk_info function to replace sprintf call\n\tby a snprintf call.\n\n2012-03-16 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tCheck return code in ixml\n\n\tCheck return code of ixmlDocument_CreateElementEx in\n\tixmlDocument_CreateElement.\n\tCheck return code of ixmlNode_setNodeName and ixmlNode_setNodeValue in\n\tixmlNode_cloneCDATASect and ixmlNode_cloneTextNode.\n\n2012-03-16 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdd more explicit casts and remove dead code\n\n\tComment unused SERVER from DeviceShutdown.\n\tComment unused max from parse_hostport.\n\tComment unused nodeptr from ixmlNode_cloneDoc.\n\tComment unused newNode from Parser_hasDefaultNamespace.\n\tComment unused Parser_parseReference function\n\tCheck return code of shutdown and display an error if needed.\n\n2012-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tFix previous commit\n\n\tReplace HAVE_UPNP_OPTSSDP by UPNP_HAVE_OPTSSDP in upnpapi.c.\n\n2012-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdd --disable-optssdp option\n\n\tModify configure.ac to add --disable-optssdp option. This option will\n\tremove OPT, 01-NLS and X_USER_AGENT headers from SSDP messages as those\n\theaders are optional. If --disable-gena and disable-optssdp are both\n\tused, uuid part will not be compiled anymore.\n\n2012-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix in ixmlNode_allowChildren\n\n\tCommit d48d73720bd325062c4d3b9ce85f3944be4f562d added a bug in\n\tixmlNode_allowChildren, this function was returning FALSE instead of\n\tTRUE when newChild->nodeName was eELEMENT_NODE.\n\n2012-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tImprove upnp/genlib/net\n\n\tChange ret_code from int to parse_status_t in match.\n\tSet back return code of ReadResponseLineAndHeaders from parse_status_t\n\tto int as this function can return UPNP_E_BAD_HTTPMSG. As a result, do\n\tnot cast the result of this function into parse_status_t in\n\thttp_OpenHttpGetProxy and http_OpenHttpGetEx.\n\tUse switch with PARSE_OK in parsetools.c.\n\tAdd missing explicit casts of integer constants in uri.c and\n\thttpreadwrite.c.\n\tUse switch, int and sa_family_t with AF_INET in uri.c.\n\tPrint an error in http_Download if realloc failed.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tUse switch instead of if with enums in upnpapi.c\n\n\tReplace if statements with switch when using HND_DEVICE and HND_CLIENT\n\tenum constants.\n\tCorrect also UpnpUnRegisterRootDeviceLowPower and UpnpUnRegisterClient\n\tas those functions were wrongly awaiting an UPNP_E_INVALID_HANDLE\n\tinstead of HND_INVALID from GetHandleInfo.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tImprove ssdp part\n\n\tDo not compile CreateClientRequestPacketUlaGua if IPv6 is disable.\n\tCast DestAddr->sa_family from sa_family_t into int when calling\n\tCreateServicePacket as this function has been set back to accept int in\n\ta692e591defe6ed9a617b9b4a083964a01f7bbab.\n\tUse switch instead of if with AF_INET and AF_INET6.\n\tAdd missing casts from AF_INET and AF_INET6 into sa_family_t when using\n\tthem to set sin_family and sin6_family.\n\tAdd missing explicit casts into size_t or lu when using\tinteger\n\tconstants with strlen or unsigned long indexes.\n\tSet SSDP_PAUSE to be unsigned as it is used with usleep.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tUse switch insted of if with enums in ixml\n\n\tReplace if statements with switch when using enums in ixml.\n\tRemove uneeded initialization in ixmlAttr_init, Parser_init and\n\tixmlNode_init which was added by wrongly added in commit\n\t06660b6383c438e4e2c9ca9854077cecc4da9e5d.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tUse switch insted of if with enums in threadutil\n\n\tReplace if statements with switch when using enums in threadutil.\n\n2012-03-14 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tFix missing break in http_RecvMessage\n\n\tThere was a missing break in PARSE_INCOMPLETE_ENTITY due to commit\n\t2eb3e069badd5c8676738c3ead37f9551fd8448e.\n\n2012-03-14 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix parse failure observed with tvdevice sample.\n\n\tCommit c40d2bc0c9b60c43b641ac4669c7b8bbcd6134c5 has a problem\n\tat removing the parentheses in parser_parse_responseline.\n\tDifference of pointers was used with intention, don't cast\n\tthem separately.\n\n2012-03-14 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFix compile error on Windows.\n\n\tInclude UpnpStdInt.h for ssize_t.\n\tDefine sa_family_t in UpnpInet.h.\n\n2012-03-14 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid ambiguous change of SsdpEvent in unique_service_name.\n\n\tHandle overflow before changing SsdpEvent.\n\tBecause the behavior of \"snprintf\" is platform dependent in such case.\n\n2012-03-14 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3502958 - The commit 5944960e prevents a pupnp client (amule) from receiving replies from an IGD device.\n\n\tPrevious change broke the feature. The error of unique_service_name\n\tin ssdp_request_type should be ignored.\n\tThis reverts commit 5944960e172a797a9fcc196291f4046cafa7f6ec.\n\n2012-03-13 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tAddress family is an int\n\n\tReference: \"man 2 socket\".\n\n2012-03-11 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove more implicit casts in upnp part\n\n\tRemove more \"implicit integer or enum conversions\" errors as well as\n\tdead code. \n\n2012-03-11 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove more implicit casts in upnp part\n\n\tRemove more \"implicit integer or enum conversions\" as well as memset\n\tbefore snprintf.\n\n2012-03-11 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid out of range access in CheckOtherHTTPHeaders.\n\n\tThere was a problem in HDR_ACCEPT_LANGUAGE case.\n\tIt may read from TmpBuf larger amount than allocated,\n\tsince condition was always true.\n\tTerminate RespInstr->AcceptLanguageHeader correctly.\n\tSkip allocation if there is already sufficient buffer.\n\n2012-03-10 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove some of the implicit cast in upnp part\n\n\tRemove some of the \"implicit integer or enum conversions\" as well as\n\tsome access to NULL reference in upnp part.\n\n2012-03-10 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove lock in ThreadPoolInit\n\n\tIf ThreadPoolInit returned EAGAIN, tp->lock was not freed. \n\n2012-03-10 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tImprove ixml\n\n\tRemove \"implicit integer conversions\" and\n\t\"dereference NULL return value\" errors in ixml part.\n\n2012-03-10 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tExclude IPv6 stuff in SearchByTarget when UPNP_ENABLE_IPV6 is not defined.\n\n2012-03-10 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tFurther measures against buffer overflows.\n\n\t* Pass output buffer size to CreateClientRequestPacket(UlaGua)\n\t  from SearchByTarget and detect overflow.\n\t* Handle SearchByTarget error in UpnpSearchAsync.\n\t* Pass output buffer size to addrToString and detect overflow.\n\t* Handle addrToString error in configure_urlbase. \n\t* Handle overflow in http_SendMessage.\n\t* Respect unique_service_name error in ssdp_request_type\n\t  so as not to touch non-terminated buffer under Evt.\n\t* Treat large argument as error in UpnpAddVirtualDir.\n\t* Use strncpy with the standard way in readFromSSDPSocket.\n\t* Do not clear buffer before snprintf.\n\t* Clarify the last argument of GetDescDocumentAndURL has size LINE_SIZE.\n\t* For inet_ntop, use buffer with size INET6_ADDRSTRLEN or INET_ADDRSTRLEN.\n\n2012-03-10 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tHandle allocation error in strndup to avoid access violation.\n\n\tReturn NULL before calling strncpy.\n\tPlatforms with HAVE_STRNDUP are not affected.\n\n2012-03-10 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSynchronize autoconfig.h with upnpconfig.h.\n\n\tIt fixes WIN32 build where configure is not invoked. \n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tMore compilaton optimisation\n\n\tDo not compile most of service_table.c and client_table.c if\n\t--disable-gena is used.\n\tDo not compile urlconfig.c if --disable-webserver is used.\n\tAdding new UPNP_HAVE_xxx variables in upnpconfig.h and upnpconfig.h.in.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tOptimisation of --disable-webserver\n\n\tDo not compile webserver.c if --disable-webserver is used.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tImprove threadutil\n\n\tRemove \"dereference NULL return\" errors and implicit conversions to\n\tdouble or enum types.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tOptimisation of --disable-webserver\n\n\tDo not compile miniserver.c if --disable-webserver is used.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tAdding configure options\n\n\tAdding --disable-ssdp, --disable-soap, --disable-gena options to\n\tconfigure script.\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix of last commit\n\n\t_snprintf was wrongly defined in ssdp_server.c\n\n2012-03-09 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3499781 - msvc doesn't have snprintf\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-03-08 10:18:39 PST\n\n\t97a17ff5add73c97844e2fa74456bab4df0800f1 commit breaks build on\n\twindows/msvc since there is no snprintf.\n\n\tNote:\n\t* Some existing sources use _snprintf when WIN32 is defined, but its\n\tbehavior is a bit different from C99 snprintf.\n\t* snprintf does terminate the buffer, so the commit (use buffer size\n\tminus 1 as argument) changes the behavior at the boundary.\n\t* Truncation might be better than crash in some cases. But it may\n\tresult in not good.\n\n2012-03-08 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3499878 - UpnpUnSubscribeAsync(): \u2018retVal\u2019 may be used uninitialized\n\n\tSubmitted: Marcelo Roberto Jimenez ( mroberto ) - 2012-03-08 12:38:57 PST\n\n\tsrc/api/upnpapi.c: In function \u2018UpnpUnSubscribeAsync\u2019:\n\tsrc/api/upnpapi.c:2060:6: warning: \u2018retVal\u2019 may be used uninitialized in this function\n\n2012-03-08 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3175217 - Crash bug in Parser_addNamespace()\n\n\tSubmitted: Terry Farnham ( tfarnham ) - 2011-02-07 09:25:25 PST\n\n\tDetails: The strcmp(pNode->prefix,pCur->prefix) crashes on pCur->prefix\n\tbeing NULL. This occurs on invalidly formatted xml where a node uses an\n\tundefined namespace. I would expect to receive IXML_FAILED in this\n\tsituation.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemoving access to NULL pointers in node.c and element.c\n\n\tCheck that newNode is not NULL ixmlNode_cloneNodeTree and pass newAttr\n\tas the return node in the ixmlElement_setAttributeNodeNS call of\n\tixmlElement_setAttributeNS.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tMemory leaks correction in upnpapi.c\n\n\tFix memory leaks in UpnpUnSubscribe, SendActionExAsync and\n\tRenewSubscription.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496993 - Write after free in ixmlNode_insertBefore\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 04:54:40 PST\n\n\tIf ixmlNode_isParent(nodeptr, newChild) returns TRUE,\n\tixmlNode_removeChild(nodeptr, newChild, NULL) will free newChild before\n\tthe modifications of newChild->nextSibling and newChild->prevSibling.\n\n2012-03-08 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove most of strcpy, sprintf and strcat\n\n\tReplace strcpy, sprintf and strcat by strncpy, snprintf and strncat to\n\tavoid buffer overflows.\n\n2012-03-07 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tSF Bug Tracker id 3497714 - Buffer overflows\n\n\tFix compile error on WIN32.\n\n\tLocal variables must be declared first.\n\tRemove outdated comment.\n\n2012-03-07 Yoichi NAKAYAMA <yoichi.nakayama(at)gmail.com>\n\n\tAvoid access violation in assertion.\n\n\txmlParser->pCurElement was dereferenced before null check.\n\tAffects debug build only.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove SIZEOF_MISTACH error in notify_send_and_recv\n\n\tReplace sizeof(CRLF) by strlen(CRLF) as CRLF is a const char*.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3498442 - Memory leak in get_file_info\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-07 02:44:30 PST\n\n\tinfo->contentType is not freed before being set to NULL.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3498439 - Memory leak in removeServiceTable\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-07 02:35:46 PST\n\n\tUDN is not freed.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3498436 - Memory leak in Parser_processAttributeName\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-07 02:30:57 PST\n\n\tattr is not freed if ixmlNode_setNodeProperties or\n\tixmlNode_setAttributeNode return an error in\n\tParser_processAttributeName.\n\n2012-03-07 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tFixing an error in d6db7c555d0f11856ce5e3e479b16a4cf4689107 commit\n\n\tEvt.Sid should not be cast into char* when calling sizeof otherwise\n\tsize will be 4.\n\n2012-03-06 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemoving two unused variables in ssdp_server.c\n\n\tRemoving first TempPtr allocation in unique_service_name as well as one\n\tof the dbgStr allocation in AdvertizeAndReply as those values were not\n\tused.\n\n2012-03-06 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497714 - Buffer overflows\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-06 07:36:08 PST\n\n\tCall to strcpy should be replaced by call to memset and strncpy to\n\tavoid getting buffer overflows.\n\n2012-03-05 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 2989399 - UpnpSetVirtualDirCallbacks API removal in 1.6.x\n\n\tSubmitted: Nick Leverton ( leveret ) - 2010-04-19 07:44:10 PDT\n\n\tDetails: The recent codebase merge has removed a significant API call\n\twhich is used by several pupnp devices such as mediatomb and gmediaserver.\n\tUpnpSetVirtualDirCallbacks() has been replaced by individual routines to\n\tset each callback. Essentially this means that 1.6.7 will in fact be a majo\n\tbump and 1.6.6 devices can no longer link against it. Could we have the call\n\treinstated please, perhaps as a wrapper around the individual calls ? As\n\tit is, all distros will have to patch their 1.6.x apps, rebuild and re-link them.\n\n\tThe other removed API calls and external variables don't seem to be used\n\tby any of the apps I have copies of, but UpnpSetVirtualDirCallbacks is\n\timportant for maintaining compatibility within 1.6.x.\n\n2012-03-05 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3325246 - Memory Leak in XML Parser\n\n\tSubmitted: Terry Farnham ( tfarnham ) - 2011-06-23 09:45:54 PDT\n\n\tDetails: The following bit of xml results in a memory leak from the xml\n\tparser:\n\n\tconst char *xmlbuffer=\"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\n\t<root xmlns=\\\"urn:schemas-upnp-org:device-1-0\\\" xmlns:dlna=\\\"urn:schemas-dlna-org:device-1-0\\\">\n\t<dlna:X_DLNADOC xmlns:dlna=\\\"urn:schemas-dlna-org:device-1-0\\\">DMS-1.50</dlna:X_DLNADOC></root>\";\n\n\tWhen I execute the following code:\n\n\tIXML_Document *doc = ixmlParseBuffer(xmlbuffer);\n\tixmlDocument_free(doc);\n\n\tIt results in a memory leak in ixmlparser.c line 2107 where it calls\n\tsafe_strdup( newElement->namespaceURI ); It's difficult to figure out why.\n\n2012-03-05 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3417134 - Crash seen in UpnpFinish\n\n\tSubmitted: Sunil ( sunilangadi ) - 2011-10-02 08:28:47 PDT\n\n\tDetails: I observed crash in the below mentioned log statement in\n\tfunction upnpfinish(file: upnpapi.c).\n\tUpnpPrintf(UPNP_INFO, API, __FILE__, __LINE__, \"Exiting UpnpFinish:\n\t\tUpnpSdkInit is :%d:\\n\", UpnpSdkInit);\n\n\tIn particular it was crashing in ithread_self in\n\tUpnpDisplayFileAndLine(file upnpdebug.c) on WIN32.\n\n\tMoving the call ithread_cleanup_library() below the upnp printf call\n\tmentioned above in function upnpfinish fixed the crash but I couldn't get\n\tto the root of the problem.\n\n\tThe problem was observed on WIN32.\n\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497159 - Bug fix in Parser_readFileOrBuffer\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 14:20:58 PST\n\n\tfileSize = ftell( xmlFilePtr ); can return a negative value, in this\n\t case the function should exit (at the moment, the function exits only\n\tif ftell returns 0).\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497140 - Bug fix in http_get_code_text\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 13:07:03 PST\n\n\tReplace if( statusCode < 100 && statusCode >= 600 ) which can't be true\n\tby if( statusCode < 100 || statusCode >= 600 ).\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497126 - Resource leak in http_RecvPostMessage\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 12:33:59 PST\n\n\tFp is not closed when an error is raised on membuffer_append or\n\tsock_read.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497034 - Buffer not null terminated in UpnpGetIfInfo\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 06:43:52 PST\n\n\tgIF_NAME might be not null terminated.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497033 - Buffer not null terminated in UpnpInit\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 06:42:18 PST\n\n\tgIF_IPV4, gIF_IPV6 and gIF_IPV6_ULA_GUA might be not null terminated.\n\tMoreover, gIF_IPV4 should be 16 characters (INET_ADDRSTRLEN) and not 22\n\tand gIF_IPV6 should be 46 characters (INET6_ADDRSTRLEN) and not 65.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix of lastest commit (parse_hostport)\n\n\tMissing parenthesis in memset.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497027 - Buffer not null terminated in parse_hostport\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 06:28:38 PST\n\n\tworkbuf might be not null terminated.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3497009 - Resource leak in http_SendMessage\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 05:51:44 PST\n\n\tFp is not closed if fseeko(Fp, Instr->RangeOffset, SEEK_CUR) does not return 0.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tHInfo->ServiceTable initialization in UpnpRegisterRootDevice2 and UpnpRegisterRootDevice4\n\n\tInitialize also HInfo->ServiceTable in UpnpRegisterRootDevice2 and\n\tUpnpRegisterRootDevice4 functions\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496703 - Handle_Info::ServiceList may have undefined value\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-03-03 20:49:25 PST\n\n\tIn UpnpRegisterRootDevice(), HInfo->ServiceTable is not initialized and\n\tgetServiceTable() may leave it intact. It will cause crash on\n\tfreeServiceTable() called from UpnpUnRegisterRootDevice().\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496702 - TvDeviceStop is called even if Start failed\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-03-03 20:35:08 PST\n\n\tIn sample tvdevice, error of device_main() is not handled, and\n\tTvDeviceStop() cause crash.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496942 - Memory leak in config_description_doc\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 01:55:54 PST\n\n\telement was not freed if membuffer_append_str(&url_str, \"http://\") does\n\tnot return 0. Moreover addNew was not used.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496938 - Missing structures initialisation in some functions\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 01:31:16 PST\n\n\tMemsetting to 0 some of the structures: finfo in process_request,\n\tjob in readFromSSDPSocket, request in http_OpenHttpGetEx, job in\n\tgenaNotifyThread, job in genaNotifyAllExt, job in genaNotifyAll,\n\tjob in genaInitNotifyExt, job in genaInitNotify, LocalAddr in\n\tgetlocalhostname.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496934 - Memory leaks in getlocalhostname and UpnpGetIfInfo\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 01:25:42 PST\n\n\tLocalSock is not closed if ioctl(LocalSock, SIOCGIFCONF, &ifConf);\n\treturns an error.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496933 - Out-of-bounds access in CheckOtherHTTPHeaders\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-05 01:15:34 PST\n\n\tAn out-of-bands access is raised because size of\n\tRespInst->AcceptLanguageHeader is 200 and TmpBuf size is 180.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRemove unused currentDevice variable in removeServiceTable\n\n\tcurrentDevice is not used in this function.\n\n2012-03-05 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3496581 - Memory leak in getServiceList\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-03-03 08:43:23 PST\n\n\tserviceNodeList is not freed if\n\tcurrent->next = malloc(sizeof(service_info)); returns NULL.\n\n2012-02-29 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3495616 - Memory leak in ixmlElement_setAttributeNS\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-02-29 02:09:43 PST\n\n\tnewAttrNode is not freed if newAttr->n.nodeValue = strdup(value); returns\n\tNULL or if ixmlElement_setAttributeNodeNS(element, newAttr, NULL) does\n\tnot return IXML_SUCCESS.\n\n2012-02-28 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3495286 - Double free in get_action_node\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-02-28 04:27:54 PST\n\n\tixmlFreeDOMString(ActNodeName); is called twice if\n\tixmlParseBufferEx(ActNodeName, RespNode); does not return IXML_SUCCESS.\n\n2012-02-28 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3495280 - Memory leak in ixmlDocument_createElementEx\n\n\tSubmitted: Fabrice Fontaine ( ffontaine ) - 2012-02-28 04:01:02 PST\n\n\tThere is a memory leak in ixmlDocument_createElementEx:\n\tnewElement->tagName is not freed if\n\tnewElement->n.nodeName = strdup(tagName); returns NULL.\n\n2012-02-27 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tSF Bug Tracker id 3494865 - Use of non-initialized variable in parser_parse_requestline\n\n\tSubmitted: Marcelo Roberto Jimenez ( mroberto ) - 2012-02-26 16:50:23 PST\n\n\tsrc/genlib/net/http/httpparser.c: In function \u2018parser_parse_requestline\u2019:\n\tsrc/genlib/net/http/httpparser.c:1319:28: warning: \u2018index\u2019 may be used uninitialized in this function\n\n2012-02-24 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3489999 - UpnpString leaks in genaSubscribe()\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-02-21 07:06:35 PST\n\n\tIn genaSubscribe() (defined in upnp/src/gena/gena_ctrlpt.c),\n\tActualSID and EventURL will not be freed if ScheduleGenaAutoRenew\n\treturns UPNP_E_SUCCESS.\n\n\tThis fixes the an issue introduced by the previous fix.\n\n2012-02-23 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3489990 - some files are missing in tarball\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-02-21 06:52:57 PST\n\n\tReleased tarball (e.g. libupnp-1.6.15.tar.bz2) does not contain\n\tsome files under upnp/{inc,src} used by the project files for\n\twindows (build/vc8/libupnp. vcproj and build/vc9/libupnp.vcproj).\n\n\tThis breaks build on Windows from tarball released after following changes\n\thttp://pupnp.git.sourceforge.net/git/gitweb.cgi?p=pupnp/pupnp;a=commitdiff;h=0eba550da039be01211b56fea0d02d03f0a12343\n\thttp://pupnp.git.sourceforge.net/git/gitweb.cgi?p=pupnp/pupnp;a=commitdiff;h=7a796b264ec7d5de5876fd6a2001c2d329709e02\n\n2012-02-23 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker id 3489999 - UpnpString leaks in genaSubscribe()\n\n\tSubmitted: Yoichi NAKAYAMA ( yoichi ) - 2012-02-21 07:06:35 PST\n\n\tIn genaSubscribe() (defined in upnp/src/gena/gena_ctrlpt.c),\n\tActualSID and EventURL will not be freed if ScheduleGenaAutoRenew\n\treturns UPNP_E_SUCCESS.\n\n\tThis fixes the original issue.\n\n2012-02-23 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug Tracker: UpnpString leaks in genaSubscribe()\n\n\tIn genaSubscribe() (defined in upnp/src/gena/gena_ctrlpt.c),\n\tActualSID and EventURL will not be freed if ScheduleGenaAutoRenew\n\treturns UPNP_E_SUCCESS.\n\n2012-02-23 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tRevert cb89781a55466703763c1b0ee67094eb401ddfe9 as suggested by\n\tFabrice Fontaine.\n\n2012-02-07 Edwin Stearns <edwin(at)vtilt.com>\n\n\tAttached is a patch that resolved an issue I found with a server that\n\tgave its device description URI without a trailing slash (e.g.\n\t`http://127.0.0.1:5555`).\n\n2012-01-04 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix for IPv4-mapped IPv6 addresses.\n\n\tSetting IPv6 sockets with IPV6_V6ONLY flag to avoid getting IP packets\n\twith IPv4-mapped IPv6 addresses on IPv6 sockets.\n\n\n*******************************************************************************\nVersion 1.6.15\n*******************************************************************************\n\n2012-01-11 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix on M-SEARCH for IPv6 CPs.\n\n\tSmall bug fix on IPv6 Control Point: now CP will also send M-SEARCH on\n\tsite-scope address (FF05::C) instead of only sending M-SEARCH on\n\tlink-scope (FF02::C).\n\n2012-01-11 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tRetrieve IPv6 addresses in Upnp_Discovery.\n\n\tChanging sockaddr_in into sockaddr_storage in Upnp_Discovery to be able\n\tto retrieve IPv6 addresses of devices in Control Points using pupnp.\n\n2012-01-09 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Bug tracker, ID: 3469344\n\tSubmitted: dimmman ( dimmman ) - 2012-01-04 01:44:29 PST\n\tDetails: Looking at the code (v1.6.14, upnptools.c) for UpnpResolveURL\n\tand UpnpResolveURL2 it shows that the ExitFunction: always returns\n\tUPNP_E_SUCCESS.\n\n\tI'm farily sure it's a simple mistake that should have been \"return ret;\"\n\tin both cases.\n\n\tBr,\n\tJonny\n\n*******************************************************************************\nVersion 1.6.14\n*******************************************************************************\n\n2011-10-31 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tUPnP Low Power Support.\n\n\tAdding two new functions (UpnpSendAdvertisementLowPower and\n\tUpnpUnRegisterRootDeviceLowPower) which can be used to specify values\n\tfor the three SSDP headers defined by UPnP Low Power. Those headers are\n\tPowerstate, SleepPeriod and RegistrationState.\n\n2011-10-24 Fabrice Fontaine <fabrice.fontaine(at)orange.com>\n\n\tBug fix in IN6_IS_ADDR_GLOBAL.\n\n\tChanging IN6_IS_ADDR_GLOBAL to accept all IPv6 addresses which have a\n\t2000::/3 prefix.\n\n2011-07-20 Marc Essayan <marc.essayan(at)orange-ftgroup.com>\n\n\tBug Fix on M-SEARCH.\n\n\tDo not answer to M-SEARCH using HTTP version 1.0 as specified by the\n\tUPnP Device Architecture.\n\n2011-03-18 Iain Denniston <iain.denniston(at)gmail.com>\n\n\tFixes for compilation under Windows (specifically MSVC). Also added\n\tMSVC supported \"_inline\", and fixed some WIN32 specific warnings.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\n\tSeveral fixes to correctly use SOCKET (and related) types instead of\n\tnon-portable variations.\n\n*******************************************************************************\nVersion 1.6.13\n*******************************************************************************\n\n2011-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tPutting ssdpReqSocks under compilation flag.\n\n\tPutting all access to ssdpReqSock4 and ssdpReqSock6 under\n\tINCLUDE_CLIENT_APIS compilation flag to be able to compile when\n\tclient part of library is disable.\n\n2011-03-15 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tNew UpnpRegisterRootDevice4 for legacy CPs.\n\n\tAdd a new UpnpRegisterRootDevice4 which allow user to specify a\n\tdescription URL to be returned for legacy CPs (for example, CPs\n\tsearching for a v1 when the device is v2). Most of those CPs does not\n\twork if they found a v2 in the XML description, so this new function is\n\tonly used to solve interoperability issues.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\tFix for memory leak.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\tFix and Update of MSVC9 solution and project files - now compile in all\n\tmodes. Added x64 and static library targets.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\tPartial fix for UpnpGetIfInfo with MSVC - convert wchar string to\n\tchar string (full fix requires a lot of work - potentially impacting\n\tall supported platforms)\n\n2011-03-11 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tCreated the macros PRIzd and PRIzx to deal with MSVC lack of C99.\n\tThanks to Iain Denniston for pointing it out.\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\n\tFixes for headers when compiled under C++\n\n2011-03-08 Iain Denniston <iain.denniston(at)gmail.com>\n\n\tFix for uuid_unpack incorrect shift precedence.\n\n*******************************************************************************\nVersion 1.6.12\n*******************************************************************************\n\n2011-02-08 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tUndo the \"incorrectly exported include files\".\n\t\n\tLegacy applications like linux-igd and igd2-for-linux are using those\n\tAPI to create a thread pool for managing their GENA events.\n\n\tLeave it to be reworked in 1.8.x.\n\n*******************************************************************************\nVersion 1.6.11\n*******************************************************************************\n\n2011-02-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tRemove PrintThreadPoolStats() from the public API. This function uses\n\ta ThreadPool object as an argument, which is not supposed to be\n\texported.\n\n2011-02-07 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tMajor bug fix in IPv6 code.\n\n\tMajor bug fix in miniserver.c for IPv6, bug was introduced when\n\tchanging implementation of get_port in November 20th 2010 (\"gena:fix\n\tseveral compiler warnings\" commit).\n\n2011-02-06 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for incorrectly exported include files.\n\n\tThe files FreeList.h, LinkedList.h, ThreadPool.h and TimerThread.h\n\tfrom the threautil library were being installed in the include\n\tdirectory of the library, incorrectly exposing internal data structure\n\tof the library.\n\n2011-01-30 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tFix for compilation warnings of unused variables in upnpdebug.c in\n\trelease builds.\n\n2011-01-20 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tFix for Race condition can hang miniserver thread.\n\n\tAdd 'requiredThreads' field to the ThreadPool structure, to avoid\n\ta race condition when waiting for a new thread to be created. The\n\trace condition occurs when a thread is destroyed while the master\n\tthread is waiting for a new thread to be created.\n\n\tThanks to Chuck Thomason for pointing the problem.\n\n\tSummary: Race condition can hang miniserver thread - ID: 3158591\n\n\tDetails:\n\tHello,\n\n\tI have found a race condition in the thread pool handling of\n\tlibupnp-1.6.6 that periodically results in the miniserver thread\n\tgetting blocked infinitely.\n\n\tIn my setup, I have the miniserver thread pool configured with 1\n\tjob per thread, 2 threads minimum, and 50 threads maximum.\n\n\tJust before the lockup occurs, the miniserver thread pool contains\n\t2 threads: one worker thread hanging around from a previous HTTP\n\trequest job (let's call that thread \"old_worker\") and the\n\tminiserver thread itself.\n\n\tA new HTTP request comes in. Accordingly, the miniserver enters\n\tschedule_request_job() and then ThreadPoolAdd(). In\n\tThreadPoolAdd(), the job gets added to the medium-priority queue,\n\tand AddWorker() is called. In AddWorker(), jobs = 1 and threads =\n\t1, so CreateWorker gets called.\n\n\tWhen we enter CreateWorker(), tp->totalThreads is 2, so\n\tcurrentThreads is 3. The function creates a new thread and then\n\tblocks on tp->start_and_shutdown. The miniserver thread expects\n\tthe newly created thread to increment tp->totalThreads and then\n\tsignal the condition variable to wake up the miniserver thread and\n\tlet it proceed.\n\n\tThe newly created thread starts in the WorkerThread() function. It\n\tincrements tp->totalThreads to 3, does a broadcast on the\n\tstart_and_shutdown condition, and starts running its job. However,\n\tbefore the miniserver thread wakes up, \"old_worker\" times out. It\n\tsees that there are no jobs in any queue and that the total number\n\tof threads (3) is more than the minimum (2). As a result, it\n\treduces tp->totalThreads to 2 and dies.\n\n\tNow the miniserver thread finally wakes up. It checks\n\ttp->totalThreads and sees that its value is 2, so it blocks on\n\ttp->start_and_shutdown again. It has now \"missed\" seeing\n\ttp->totalThreads get incremented to 3 and will never be unblocked\n\tagain.\n\n\tWhen this issue does occur for a server device, the miniserver\n\tport remains open, but becomes unresponsive since the miniserver\n\tthread is stuck. SSDP alive messages keep getting sent out, as\n\tthey are handled by a separate thread. Reproducing the issue is\n\tdifficult due to the timing coincidence involved, but in my\n\tenvironment I am presently seeing it at least once a day. I\n\tfigured out the sequence described above through addition of my\n\town debug logs.\n\n\tThe relevant code involved in this bug has not changed\n\tsubstantially in libupnp-1.6.10, though I am planning to test\n\tagainst 1.6.10 as well in the near future.\n\n\tDo you have any input for an elegant fix for this issue?\n\n\tThanks,\n\n\tChuck Thomason\n\n2011-01-16 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tDefine _FILE_OFFSET_BITS, _LARGEFILE_SOURCE and _LARGE_FILE_SOURCE in\n\tupnpconfig.h.\n\n\tMake these definitions available to programs using the library.\n\tThanks to Chandra Penke for pointing the problem.\n\n\tSummary: Problem with large file support in pupnp build - ID: 3158969\n\tSubmitted: Chandra ( inactiveneurons ) - 2011-01-15 16:17:02 BRST\n\tDetails:\n\tFirst off, I apologize in advance for the length of this comment, it's\n\tthe only way I could describe the problem accurately.\n\n\tSecondly, a brief thanks (again). The company I'm working for has been\n\tusing pupnp for a massively cross-platform project which involves iphone,\n\tosx, windows, linux x86, arm, and mips hosts. It's amazing how well it\n\tworks, so kudos to the maintainers!\n\n\tWe came across a problem when compiling with the following tool-chain:\n\thttp://www.codesourcery.com/sgpp/lite/mips/portal/release824. The\n\tproblem is the following:\n\n\tIn configure.ac the following lines exist to enable large file support:\n\n\tAC_DEFINE([_LARGE_FILE_SOURCE], [], [Large files support])\n\tAC_DEFINE([_FILE_OFFSET_BITS], [64], [File Offset size])\n\n\tWhich in turn result in the following #defines in autoconfig.h:\n\n\t#define _LARGE_FILE_SOURCE /**/\n\t#define _FILE_OFFSET_BITS 64\n\n\tHowever, this file is not exported as part of the upnp build. Therefore,\n\twhile the entire library gets built with large file support, it's\n\tpossible that dependent libraries which only rely on the include files\n\tmay not use large file support.\n\n\tIn the particular case of the above tool-chain, the 'off_t' type is 8\n\tbytes when large file support is enabled, but only 4 bytes when it's\n\tnot. As a result part our stack built on top of pupnp, which did not\n\thave large file support (because it did not use the above autoconf\n\tdirectives), was relying on 'a off_t' that was 4 bytes.\n\n\tThis caused, among many things, for the UpnpFileInfo struct to break.\n\tSince the struct is completely invisible outside of pupnp (because of\n\tsome template macro magic), pupnp thought that 'FileLength' field was\n\t8 bytes, but the header setter/getter methods being used by dependent\n\tlibraries thought that it was 4, which caused some erratic behavior\n\twhen going through pupnp's webserver and HTTP client API.\n\n\tWe put in a temporary work around by adding the following preprocessor\n\tflags: -D_LARGE_FILE_SOURCE, -D_FILE_OFFSET_BITS=64 as part of our\n\tbuild process. However, it's a hack, and I was wondering if I'm missing\n\tsomething and there's a better way to approach this.\n\n\tThanks,\n\tChandra\n\n2011-01-16 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tUse config.h to test for the availability of strndup() and strnlen().\n\n2011-01-14 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\t- Null termination of strndup() implementation on systems missing it.\n\t- Implementation of strnlen() on systems missing it.\n\n2011-01-14 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tFixes transfer encoding in the HTTP client API, which is currently\n\tbroken. The break was due to a regression caused by another\n\tfix (tracker 3056713), which fixed an out of memory crash when\n\tdownloading large files. The previous fix changed the\n\thttp_ReadHttpGet() implementation so that data already read by the\n\tuser was discarded. However, it only worked for transfers where\n\tthe content length was specified. This fix extends the previous\n\timplementation to cover chunked transfer encoding.\n\n2011-01-14 Chandra Penke <chandrapenke(at)mcntech.com>\n\n\tMinor change in membuffer.c to include \"membuffer.h\" without looking\n\tin the standard header path. This allows pupnp to build in xcode.\n\n2010-12-18 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tSF Tracker: Patches\n\tFedora mingw32 compilation - ID: 3138849\n\tDetails:\n\tHello. I trying compile libupnp-1.6.10 on the Fedora 14 MinGW\n\tEnvironment and get many errors. I create patch to fix it. With this\n\tpatch i can get static library. This patch is very raw.\n\n\tSubmitted: Ivan Romanov (ivanromanov) - 2010-12-16 23:29:19 UTC\n\n*******************************************************************************\nVersion 1.6.10\n*******************************************************************************\n\n2010-11-23 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tMajor bug fix in http_SendMessage.\n\n\tCurrently, http_SendMessage was not able to write to write a buffer\n\tdue to a bad use of file_buf instead of buf. This bug was introduced by\n\tthe 0197-Doxygen-reformating-compiler-warnings patch.\n\n2010-11-23 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tReturning the Sid in Upnp_Event_Subscribe.\n\n\tCurrently, Upnp_Event_Subscribe always contains an empty chain in the\n\tSid parameter. This patch now saves the client Subscription ID in this\n\tparameter so Control Points can see and use the same SID in the\n\tUpnp_Event_Subscribe and in the Upnp_Event structures.\n\n2010-11-22 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tTwo fixes from Juergen Lock <nox(at)jelal.kn-bremen.de>:\n\n1. varargs:  pass size of CRLF as size_t not as int:\n\n--- upnp/src/gena/gena_device.c.orig\n+++ upnp/src/gena/gena_device.c\n@@ -225,7 +225,7 @@ static UPNP_INLINE int notify_send_and_r\n\t\t\"bbb\",\n\t\tstart_msg.buf, start_msg.length,\n\t\tpropertySet, strlen(propertySet),\n-\t\t\"\\r\\n\", 2);\n+\t\t\"\\r\\n\", sizeof \"\\r\\n\" - 1);\n\tif (ret_code) {\n\t\tmembuffer_destroy(&start_msg);\n\t\tsock_destroy(&info, SD_BOTH);\n\n2. Remove \"b\" arg here, there is no buffer passed:  (this caused a pointer\nto be interpreted as a buffer size to be alloc'd/copied, hence the 32 GB.)\n\n--- upnp/src/genlib/net/http/webserver.c.orig\n+++ upnp/src/genlib/net/http/webserver.c\n@@ -1262,7 +1262,7 @@ static int process_request(\n\t\t\t// Content-Range: bytes 222-3333/4000  HTTP_PARTIAL_CONTENT\n\t\t\t// Transfer-Encoding: chunked\n\t\t\tif (http_MakeMessage(headers, resp_major, resp_minor,\n-\t\t\t\t\"R\" \"TLD\" \"s\" \"tcS\" \"b\" \"Xc\" \"sCc\",\n+\t\t\t\t\"R\" \"TLD\" \"s\" \"tcS\" \"Xc\" \"sCc\",\n\t\t\t\tHTTP_OK,    // status code\n\t\t\t\tfinfo.content_type, // content type\n\t\t\t\tRespInstr,  // language info\n\n2010-11-15 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tAdded the convenience function UpnpResolveURL2() to upnptools.c.\n\n\tThis function avoids some unecessary memory allocation.\n\tThe memory alloc'd by this function must be freed later by the caller.\n\n2010-11-10 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAdd GENA_NOTIFICATION_xxx_TIMEOUT variable.\n\n\tCurrently, in notify_send_and_recv function, pupnp waits for\n\tHTTP_DEFAULT_TIMEOUT seconds when trying to send a GENA notification.\n\tWhen there is a lot of notifications with CPs which was disconnected\n\twithout unsusbcribing, all the pupnp threads are blocked on this\n\ttimeout. To correct, this issue, this patch adds a new variable,\n\tGENA_NOTIFICATION_SENDING_TIMEOUT, which can be used to lower the\n\ttimeout so GENA threads return quickly when writing is impossible. By\n\tthe same mean, pupnp waits the CP's answer to the NOTIFY for\n\tHTTP_DEFAULT_TIMEOUT seconds, so this patch adds a new variable,\n\tGENA_NOTIFICATION_ANSWERING_TIMEOUT, to customize this value.\n\n2010-11-10 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAdd --disable-blocking-tcp-connections flag.\n\n\tCurrently, pupnp is using a blocking connect to sends GENA\n\tnotifications. As a result, when there is a lot of notifications with\n\tCPs which were disconnected without unsusbcribing, all the pupnp\n\tthreads are blocked for 20s (timeout). To correct this issue, this\n\tpatch replace the call to connect with a call to private_connect and add\n\ta compilation flag to disable blocking TCP connections, so if we are not\n\table to connect to the CP, the notification is lost.\n\n2010-11-07 Stefan Sommerfeld <zerocom(at)cs.tu-berlin.de>\n\n\tSeveral patches for windows compatibility and fixing warnings.\n\n2010-11-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tPTHREAD_MUTEX_RECURSIVE on DragonFly is an enum.\n\n\tSF Bug Tracker - ID: 3104527\n\tSubmitted: OBATA Akio ( obache ) - 2010-11-07 07:10:28 BRST\n\n\tIn threadutil/inc/ithread.h, it is expected that\n\tPTHREAD_MUTEX_RECURSIVE is defined as macro. But on DragonFly BSD,\n\tit is defined as enum, so not works as expected.\n\n\tAttachment patch treat that DragonFly BSD always\n\thave PTHREAD_MUTEX_RECURSIVE.\n\n2010-11-07 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tftime(3) in -lcompat should not be checked.\n\n\tSF Bug Tracker - ID: 3104521\n\tSubmitted: OBATA Akio ( obache ) - 2010-11-07 07:03:44 BRST\n\n\tIn configure.ac\n\tAC_CHECK_FUNCS(ftime,, [AC_CHECK_LIB(compat, ftime)])\n\n\tBut since version 1.6.3, ftime(3) is not used, so it should be\n\tremoved, or introduce unwanted linkage with -lcompat.\n\n*******************************************************************************\nVersion 1.6.9\n*******************************************************************************\n\n2010-11-06 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for bug introduced in samples code in svn revision 502, commit\n\tgit:25c908c558c8e60eb386c155a6b93add447ffec0\n\n\tSample device and combo were aborting with the message:\n\t\"***** SampleUtil_Initialize was called multiple times!\"\n\n2010-11-06 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tMake multiple SSDP advertisements faster.\n\n\tPut the loop to send multiple copies of each SSDP advertisements in\n\tssdp_server.c instead of ssdp_device.c so we have only one call to\n\timillisleep ( SSDP_PAUSE ) to speed up advertisements.\n\n2010-11-05 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tRemoving unused NUM_COPY variable.\n\n\tPreviously, NUM_COPY was used in ssdp_device.c to send multiple copies \n\tof each advertisements but also multiple replies to each M-SEARCH\n\trequest. As sending multiple replies is not compliant with HTTPU/MU\n\tspec, NUM_COPY has been set to 1 in an older patch. However, as this\n\tvariable is not needed and has been replaced with SSDP_COPY, it has\n\tbeen removed.\n\n2010-11-05 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tUse SSDP_COPY to send multiple SSDP advertisements.\n\n\tCurrently, SSDP_COPY is used only to send multiple M-SEARCH requests (in\n\tssdp_ctrlpt.c). With this patch, SSDP_COPY is also used to send multiple\n\tcopies of each advertisements packets (in ssdp_device.c).\n\n2010-11-01 Carl Benson <carl.benson(at)windriver.com>\n\n\tFix for Android build.\n\n\tI had to do some modifications myself though, because the Android\n\tbuild system insists on having a file named \"util.h\" taking precedence\n\tin its include path, libupnp gets confused because of the same filename\n\tin upnp/src/inc/util.h\n\n*******************************************************************************\nVersion 1.6.8\n*******************************************************************************\n\n2010-10-20 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix a long date memory leak in webserver.c:StrStr().\n\n2010-10-19 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tBug fix in select of miniserver.c\n\t\n\tFix a bug in miniserver.c, in which maxMiniSock was wrongly declared as\n\tunsigned int and as a result it was beeng set to ((unsigned int)(-1)).\n\tAs a result, after beeing incremented, it became zero, and this value\n\twas beeing used in the select() call.\n\n\tThanks to Fabrice Fontaine for helping and testing with this issue.\n\n2010-10-15 Marcelo Roberto Jimenez <mroberto(at)users.sourceforge.net>\n\n\tFix for 100% CPU issue in select() in miniserv.c. I have also removed\n\tthe sleep() call, it was just a workaround.\n\n\tSF Bug Tracker [ 3086852 ] 99% CPU loop in miniserver.c on a non ipv6\n\tsystem.\n\n\tSubmitted by: Jin ( jin_eld ) - 2010-10-13 19:29:13 UTC\n\n\tI cross compiled libupnp 1.6.7 for ARM9 using the --disable-ipv6\n\toption, my system is an ipv4 only setup.\n\n\tI do not know why this problem only appears when running the app in the\n\tbackground (for instance using nohup &), but then it starts using 99%\n\tCPU.\n\n\tI traced the problem down to the select() call in miniserver.c in the\n\tRunMiniServer() function. Select returns code 1, but errno is set to\n\t\"Socket operation on non-socket\", I also see this when running my app\n\tunder strace.\n\n\tI set all ...Sock6 variables to INVALID_SOCKET to make sure that they\n\tdo not get added to the FD_SET and the problem is gone.\n\n*******************************************************************************\nVersion 1.6.7\n*******************************************************************************\n\n2010-10-01 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAdding --disable-notification-reordering option\n\n\tAdding a configure flag to disable GENA notification reordering as even\n\twith an imillisleep(1), this mechanism consumes too much CPU on embedded\n\tdevices when there is a burst of notifications.\n\n2010-09-30 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tBug fix when there is no service in embedded devices\n\n\tWhen a device with embedded devices (like IGD) when created and one of\n\tthe embedded devices did not have any service, there was a Segmentation\n\tFault (see SF Tracker [ 2688125 ]).\n\n\tOriginal SF Tracker issue follows:\n\n\tSF Tracker [ 2688125 ] v1.6.6 crashes on subdevices without services\n\tSubmitted by: Arno Willig ( akw ) - 2009-03-15 22:45:23 BRT\n\n\tI discovered a bug, which will make libupnp (1.6.6) segfault, when you\n\tcreate a upnp description document with multiple devices which have\n\tsubdevices, but no own services.\n\n\tThe crash occurs in genlib/service_table.c in line 977:\n\tend->next =\n\t\tgetServiceList( currentDevice, &next_end, URLBase );\n\n\tIn this case \"end\" seems not to be defined, so end->next crashes.\n\n\tCan anyone confirm this, please?\n\n2010-09-28 Marc Essayan <marc.essayan(at)orange-ftgroup.com>\n\n\tBug fix on burst of GENA notification\n\n\tWhen a lot of notifications were generated by a device in a short\n\tperiod of time then 100% of the CPU was used to reorder those\n\tnotifications by pushing back the thread in the job queue. This\n\tmechanism has been modified so now thread sleep 1 ms before being\n\tpushed back into the job queue.\n\n\tRemoving DEFAULT_SCHED_PARAM parameter and use\n\tsched_get_priority_min(DEFAULT_POLICY) instead.\n\n2010-09-22 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tBug fix on M-SEARCH response\n\n\tDevices must respond to M-SEARCH requests for any supported version and the\n\tresponse should specify the same version as was contained in the search target.\n\tPreviously, the device did not answer if the M-SEARCH request did not\n\tcontain the same version number than the version number of the device.\n\n2010-09-21 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAdd Content-Language iff Accept-Language\n\n\tAdd Content-Language header in the response if and only if there is an\n\tAccept-Language header in the request.\n\n2010-09-21 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tAddition of WEB_SERVER_CONTENT_LANGUAGE parameter\n\n\tThis patch adds the WEB_SERVER_CONTENT_LANGUAGE parameter so the user can specify\n\tthe language used by the device during Description and Presentation steps of UPnP\n\tthrough the HTTP CONTENT-LANGUAGE header.\n\tBy default, the WEB_SERVER_CONTENT_LANGUAGE is an empty string so no\n\tCONTENT-LANGUAGE is added.\n\n2010-09-18 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tCustomize the stack size of the threads used by pupnp through the new\n\tTHREAD_STACK_SIZE variable.\n\n\tThis patch allows a user to customize the stack size of the threads used by\n\tpupnp through the new THREAD_STACK_SIZE variable. This is especially useful\n\ton embedded systems with limited memory where the user can set THREAD_STACK_SIZE\n\tto ITHREAD_STACK_MIN.\n\n\tHowever, as this modification can have side effects, I set 0 as the default\n\tvalue, so threads will continue to use the default stack size of the system\n\t(which varies greatly as stated in\n\thttps://computing.llnl.gov/tutorials/pthreads/).\n\n2010-09-16 Fabrice Fontaine <fabrice.fontaine(at)orange-ftgroup.com>\n\n\tBroken IPv6.\n\tIPv6 is currently broken in latest release of branch-1.6.x, so find a\n\tpatch attached that correct the issue (small fixes on define, undef and\n\tretVal).\n\n2010-09-10 Warwick Harvey <warwick.harvey(at)tieto.com>\n\tPatch to take notice of UPNP_USE_RWLOCK flag\n\n\tThe configure.ac file included with UPnP checks for the presence of the\n\tpthread_rwlock_t type, and then sets the value of the UPNP_USE_RWLOCK\n\tflag appropriately.  However, this flag is not referenced at all in the\n\tsource code, and thus the code does not compile on systems that don't\n\thave the pthread_rwlock_t type (such as Android).\n\t\n\tPlease find attached a patch (against the current 1.6.x head) that checks\n\tthe value of this flag and falls back on using mutexes if read-write\n\tlocks are not available.\n\n2010-09-10 Jean Sigwald <jean.sigwald(at)orange-ftgroup.com>\n\tI discovered a reliable denial-of-service issue on the last stable\n\trelease of libupnp (1.6.6) remotely triggerable by any\n\tunauthenticated user. The issue is related with a bad parsing of\n\tmalformed XML.\n\n2010-09-10 Chandra Penke <chandrapenke(at)mcntech.com>\n\t* SF Patch Tracker [ 2854711 ] Patch for Solaris10 compilation and usage\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\t\n\tPatch for Solaris10 compilation and usage.\n\n2010-09-10 Chandra Penke <chandrapenke(at)mcntech.com>\n\tAdd support for conditionally enabling ipv6.\n\n2010-09-10 Chandra Penke <chandrapenke(at)mcntech.com>\n\tFix for compilation in debug builds.\n\n\tEnsure internal methods are declared as static since debug builds don't inline.\n\n2010-09-09 Chandra Penke <chandrapenke(at)mcntech.com>\n\tFix for regression in SSDP code to send/receive messages over UDP\n\n\tSending messages over UDP is broken in some Apple OSes\n\tsuch as OS X and iOS. This might be broken in other OSes to but didn't\n\tverify.\n\n\tThe fix is to modify the socket lenght argument of sendto to use the correct\n\tsockaddr lenght dependng on whether the socket is IPV4 or IPV6.\n\n\tAlso added some error checks and debugging related to the issue\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tUsing UpnpReadHttpGet to download large files causes the application to\n\tcrash. This happens when the file being downloaded exceeds the device\n\tmemory - entirely possible when transferring video files.\n\tThe programmatic cause is that the logic implemented in the function\n\thttp_ReadHttpGet (which UpnpReadHttpGet calls) reads the entire file\n\tinto memory. The fix modifies the existing logic to discard data after\n\tit's been read; there's no reason to keep it around since the caller\n\tof UpnpReadHttpGet already has a copy of it.\n\t\n\tThis issue exists in 1.6.6 as well as the latest sources.\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tIn the latest sources, http_RequestAndResponse and other methods that\n\tuse connect() are broken. More specifically, connect() in these methods\n\tis returning with an EINVAL. The programatic cause is that the address_len\n\targument passed to connect() is different in IPV4 vs IPV6 (as described in:\n\thttp://www.opengroup.org/onlinepubs/009695399/functions/connect.html).\n\tThe current code always uses the IPV6 size. The fix modifies each use of\n\tconnect() to use the correct size based on the address family being used.\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tFix compilation error in upnp/src/gena/gena_ctrlpt.c (this is most\n\tlikely an error on all platforms).\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tFix compilation error in upnp/src/inc/ssdplib.h when compiling in OS X\n\t(the netinet/* headers are not available).\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-09-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tFix compilation error in ixml/inc/ixml.h when compiling with an\n\tObjective-C compiler (when cross-compiling for iPhone devices).\n\n\tPatch submitted by Chandra (inactiveneurons).\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Issue regarding the GENA notifications. A string termination indicator\n\twas added at the end of the notification (\"\\r\\n\") in\n\tnotify_send_and_recv() in upnp/src/gena/gena_device.c.\n\tPatch by Fabrice Fontaine.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* The last part of Ronan Menard's patch.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* upnp/src/ssdp/ssdp_device.c: Fix for IPV6 ULA/GUA issues.\n\t* upnp/src/ssdp/ssdp_ctrlpt.c: Fix for IPV6 ULA/GUA issues.\n\t* upnp/src/ssdp/ssdp_server.c: Fix for IPV6 ULA/GUA issues.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* upnp/src/genlib/miniserver/miniserver.c: Fix for IPV6 ULA/GUA issues.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* gena_subscribe(): Fix for IPV6 ULA/GUA issues.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SOCKET ssdpSock6UlaGua: created variable for later use.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SSDP_IPV6_SITELOCAL: new macro.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* The scope of the macro NUM_HANDLE is now restricted to upnpapi.c.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* InitHandleList() has never been implemented, I guess no one has ever\n\tcalled it, so remove it.\n\t* GetFreeHandle() and FreeHandle() are now static as they should.\n\n2010-08-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* New internal buffer added to store global/ula IPV6 address.\n\t* Macros to test whether an IPV6 address is global or ula.\n\t* UpnpGetServerUlaGuaIp6Address(): added interface.\n\t* IN6_IS_ADDR_GLOBAL, IN6_IS_ADDR_ULA: new macros.\n\t* gIF_IPV6_ULA_GUA: new buffer.\n\t* UpnpRegisterRootDevice3(): Change to the test of already registered\n\tdevices for IPV6.\n\t* UpnpGetIfInfo(): gua/ula issues.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* libUPnP does support IPV6 now.\n\t\n\tPatch submitted by Ronan Menard.\n\n2010-08-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* HTTP version equal to 1.0 should fail as required by the UPnP\n\tcertification tool. Patch submitted by Ronan Menard.\n\n2010-06-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSF Bug Tracker [ 3022490 ] String declaration fix for patch applied in 3007407\n\tHello,\n\n\tWhen my patch for tracker ID 3007407 was accepted, the definition of the\n\tserviceList string was changed from\n\n\t#define SERVICELIST_STR \"serviceList\"\n\n\tto\n\n\tstatic const char *SERVICELIST_STR = \"serviceList\";\n\n\tDuring internal code review of the final patch, it was pointed out that \n\tsizeof(SERVICELIST_STR) == 4 since SERVICELIST_STR is now declared as\n\ta pointer instead of an array.\n\n\tIf you wish to use a variable instead of a define, I suggest the\n\tfollowing instead:\n\n\tstatic const char SERVICELIST_STR[] = \"serviceList\";\n\n\tThanks,\n\tChuck Thomason\n\n2010-06-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSF Bug Tracker [ 3007407 ] Service traversal issue in AdvertiseAndReply()\n\tSubmitted: Chuck Thomason ( cyt4 ) - 2010-05-26 15:07:39 UTC\n\n\tWhen the UPnP server is started, one alive message is broadcast for each\n\tservice in each device. It appears that libupnp's implementation of the\n\talive message generation does not correctly navigate the XML description\n\tdocument when locating the services. This can result in the wrong UDN\n\tbeing used in the alive message sent for a service.\n\n\tIn my specific case (see attached XML), the root EchoSTB device contains\n\tno services, but its embedded MediaServer device contains 2 services.\n\tWhen the existing libupnp code traverses the EchoSTB device in the XML,\n\tit searches the global list of serviceLists within the document instead\n\tof searching for a serviceList that is its direct child node. The\n\tContentDirectory and ConnectionManager services are then announced with\n\tthe UDN of EchoSTB1 (the root device) instead of with the UDN of\n\tMediaServer, which is actually their parent device.\n\n\tI discovered this behavior using libupnp-1.6.6. I have generated a patch\n\tagainst branch-1.6.x that corrects the XML navigation such that all\n\tservices are traversed from their parent device, which results in the\n\tcorrect UDN being sent in the alive message for each service. I built\n\tfrom branch-1.6.x without this patch, tested, and confirmed that the\n\tissue still exists as I observed it in libupnp-1.6.6. I then built\n\tfrom branch-1.6.x with this patch, tested, and confirmed that the\n\tissue was resolved.\n\n\tThanks,\n\tChuck Thomason\n\n2010-05-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tSF Bug Tracker [ 2995758 ] libupnp 1.6.6, wrong bind when reuseaddr is\n\t1.\n\tSubmitted: viallard anthony ( homer242 )\n\tWhen trying to use reuseaddr option in miniserver/miniserver.c, there\n\tisn't a affectation of the port chosen (serverAddr.sin_port isn't\n\treceive listen_port variable value).\n\n2010-04-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\tDefine PROTOTYPES to be one by default in global.h. This affects the\n\tRSA MD5 code.\n\n2010-03-27 Nick Leverton <nick@leverton.org>\n\tSubscription auto-renewals copy the renewal time from old subscription.\n\n2010-03-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added API to ithread, created the following functions:\n\t- int ithread_initialize_library(void);\n\t- int ithread_cleanup_library(void);\n\t- int ithread_initialize_thread(void);\n\t- int ithread_cleanup_thread(void);\n\t* SF Bug Tracker [ 2876374 ] Access Violation when compiling with Visual Studio 2008\n\tSubmitted: Stulle ( stulleamgym ) - 2009-10-10 19:05\n\n\tHi,\n\n\tI am one of the devs of the MorphXT project and I use this lib in some\n\tother of my projects, too. When I tried to upgrade the lib earlier for one\n\tof my projects I had to realise that something did not work at first and\n\twhile most of the things were reasonably ease to be fixed. Now, the last\n\tthing I encountered was not so easy to fix and I am uncertain if my fix is\n\tany good so I'll just post it here and wait for some comments.\n\n\tThe problem was that I got an Access Violation when calling \"UpnpInit\". It\n\twould call \"ithread_rwlock_init(&GlobalHndRWLock, NULL)\" which eventually\n\tled to calling \"pthread_cond_init\" and I got the error notice at\n\t\"EnterCriticalSection (&ptw32_cond_list_lock);\". It appeared that\n\t\"ptw32_cond_list_lock\" was NULL. Now, I found two ways to fix this. Firstly\n\tmoving the whole block after at least one of the \"ThreadPoolInit\" calls\n\twill fix the issue. Secondly, you could add:\n\t#ifdef WIN32\n\t#ifdef PTW32_STATIC_LIB\n\t// to get the following working we need this... is it a good patch or\n\tnot... I do not know!\n\tpthread_win32_process_attach_np();\n\t#endif\n\t#endif\n\tright before \"ithread_rwlock_init(&GlobalHndRWLock, NULL)\".\n\n\tJust so you know, I am using libupnp 1.6.6 and libpthreads 2.8.0 and both\n\tare linked static into the binaries. I am currently using Visual Studio\n\t2008 for development with Windows being the target OS. Any comment at your\n\tend?\n\n\tRegards, Stulle\n\n2010-03-27 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2836704 ] Patch for Solaris10 compilation and usage.\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\tThis second part covers the issue on linking with -lsocket -lnsl -lrt.\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 2392166 ] ithread_detach not called for finished worker thread\n\tSubmitted: Ulrik ( ulsv_enea ) - 2008-12-05 08:24\n\n\tValgrind reports a memory leak due to that the function ithread_detach is\n\tnot called for finished worker threads in ThreadPool.c.\n\n\t==21137== 2,176 bytes in 8 blocks are possibly lost in loss record 5 of 5\n\t==21137== at 0x4C20F3F: calloc (vg_replace_malloc.c:279)\n\t==21137== by 0x4010F58: _dl_allocate_tls (in /lib/ld-2.6.1.so)\n\t==21137== by 0x544BA92: pthread_create@@GLIBC_2.2.5 (in\n\t/lib/libpthread-2.6.1.so)\n\t==21137== by 0x5F94592: CreateWorker (ThreadPool.c:639)\n\t==21137== by 0x5F95079: ThreadPoolInit (ThreadPool.c:784)\n\n\tI'm using libupnp 1.6.6\n\n\tFor more info on pthread_detach, see:\n\thttp://gelorakan.wordpress.com/2007/11/26/pthead_create-valgrind-memory-lea\n\tk-solved/\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 2392304 ] Memory leak in SSDP AdvertiseAndReply\n\tSubmitted: Ulrik ( ulsv_enea ) - 2008-12-05 08:24\n\n\tValgrind reports a memory leak function in AdvertiseAndReply\n\t(ssdp/ssdp_server.c) in libupnp 1.6.6\n\n\tThere are continue statements in many places in AdvertiseAndReply. In some\n\tof those error handling cases the variable nodelist is not free'ed before\n\tcontinuing to the next iteration. The next iteration will take care of\n\tfree'ing the nodelist from the previous iteration in most cases, but not\n\twhen breaking out of the for loop after the last element.\n\n\tI belive this memory leak can be solved by makeing sure that the rows\n\n\tixmlNodeList_free( nodeList );\n\tnodeList = NULL;\n\n\tare always executed, also in the beginning of the last iteration when we\n\tfound out that there are not more elements.\n\n\t==29110== at 0x4C21C16: malloc (vg_replace_malloc.c:149)\n\t==29110== by 0x5D8DE0E: ixmlNodeList_addToNodeList (nodeList.c:106)\n\t==29110== by 0x5D8B7E2: ixmlNode_getElementsByTagNameRecursive\n\t(node.c:1438)\n\t==29110== by 0x5D8E587: ixmlElement_getElementsByTagName\n\t(element.c:491)\n\t==29110== by 0x5B6C0F1: AdvertiseAndReply (ssdp_server.c:201)\n\t==29110== by 0x5B7AB74: UpnpSendAdvertisement (upnpapi.c:1495)\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* libupnp and multi-flows scenario patch\n\tSubmited by Carlo Parata from STMicroelectronics.\n\n\tHi Roberto and Nektarios,\n\tafter an analysis of the problem of libupnp with a multi-flows scenario, I\n\tnoticed that the only cause of the freezed system is the ThreadPool\n\tmanagement. There are not mutex problems. In practise, if all threads in the\n\tthread pool are busy executing jobs, a new worker thread should be created if\n\ta job is scheduled (I inspired to tombupnp library). So I solved the problem\n\twith a little patch in threadutil library that you can find attached in this\n\te-mail. I hope to have helped you.\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2964973 ] install: will not overwrite just-created\n\t...blah... with...\n\tSubmitted: Nick Leverton ( leveret ) - 2010-03-07 05:18\n\n\tFull error:\n\t/usr/bin/install: will not overwrite just-created\n\t`/tmp/buildd/libupnp-1.6.6/debian/tmp/usr/share/doc/libupnp3-dev/examples/s\n\tample_util.c' with `common/sample_util.c'\n\n\tThis seems to be from Automake 1.11 which doesn't like having duplicate\n\tfiles in a Makefile.am. Patch attached, kindly provided by Stefan Potyra\n\tfor Debian (http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=543068)\n\n\tThis fix will be needed for both 1.6.x and 1.8.x branches.\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Backport of svn revision 504:\n\tSF Patch Tracker [ 2969188 ] 1.8.0: patch for FreeBSD compilation\n\tSubmitted By: Nick Leverton (leveret)\n\tFix the order of header inclusion for FreeBSD.\n\n2010-03-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2836704 ] Patch for Solaris10 compilation and usage.\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\tObs by Marcelo: The issue with linking with -lsocket -lnsl -lrt is not\n\tcovered in this changeset beacuse I don't have solaris to test. I will\n\tneed some help from zephyrus in this regard. The issue will be addressed\n\tin a future changeset.\n\n\tCompilation for solaris\n\n\tI have used gcc3.x and gcc4.x under solaris 10 for x86 / 64 bits.\n\n\tA couple of Source file fixes were necessary for successful compilation\n\tand runtime behavior.\n\n\tthreadutil/src/ThreadPool.c\n\n\tPOSIX\n\tsched_setschduler() returns non-negative value for success.\n\n\tWithout the fix, UpnpInit() fails immediately.\n\n\tupnpp/src/api/upnpai.c\n\n\tThere is a typo of a macro name \"__sun\" in one of the\n\tCPP conditional.\n\tWithout the fix, the compilation aborts due to unknown constant\n\tin socket ioctl call.\n\n\tA few structs and an array is not properly initialized.\n\tWell, I think it may be safe as is, but when I checked it\n\tusing purify evaluation version, it was reported that\n\tuninitizlied iszBuffer may cause read of uninitialized memory.\n\tSo play it safe.\n\n\tConfigure issue.\n\tThis has to be more of a configure magic.\n\tTo link a program successfully using network, we need\n\t-lsocket and -lnsl library specifications on the link line.\n\tWe also need -lrt for programs that use thread scheduling features.\n\n\tThe sample program under upnp/sample requires\n\t-lsocket -lnsl -lrt\n\tfor successful linking.\n\tI added -lsocket -lnsl -lrt to Makefile.in.\n\tconfigure probably needs to take care of these.\n\n\tI don't know much about configure, automake, etc., so\n\tI am just raising a flag here.\n\n\tTIA\n\t\n2010-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2836704 ] Search for nested serviceList (not\n\tstopping at the first lis\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\t\n\tInternet Gateway Device description contains nested serviceList (rootdevice\n\t-> servicelist, subdevice\n\tand subdevice has the lower-level serviceList, etc..)\n\n\tUnfrotunately, the sample code sample_util.c used by tv_device sample,\n\tetc.\n\thas a code that looks for only the first top-level serviceList.\n\tThis results in the failure to read all the services of an IGD xml\n\tdescription.\n\n\tAttached patch modifies this behavior and looks for the service by\n\tvisiting all the serviceList in xml document in turn.\n\n\tWith the modified patch (ad additional modification), I could\n\tsimulate an IGD device and created a modified control program for that.\n\n\tPatch against 1.6.6\n\n\tTIA.\n\t\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2203721 ] timeb.h check obsolete\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2970872 ] Update ErrorMessages for latest return\n\tcode list\n\tSubmitted By: Nick Leverton ( leveret )\n\t\n\tErrorMessage[] in upnptools.c has got a bit out of sync, the attached\n\tpatch (generated from grep 'define UPNP_E_') should bring it up to date.\n\n2010-03-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2857611 ] Declare a few functions to have proper\n\t(void) argument list.\n\tSubmitted By: zephyrus ( zephyrus00jp )\n\t\n\tIn a publicly installed headers, a few functions are declared without any\n\targuments at all, a la \"()\".\n\tWhen I used gcc's -Wimplict and -Wstrict-prototypes to check for the\n\tmismatch of\n\tfunction prototype declarations and their usage in my own program,\n\tsome headers from libupnp-1.6.6 produced warnings.\n\n\tThey are not strictly bugs, but pretty much annoying. This is 2009, and\n\talmost all the important compilers\n\tunderstand ISO-C.\n\n\tSo the offending functions are declared as \"(void\") to show that they have\n\tno arguments at all.\n\n2010-03-14 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patch Tracker [ 2546532 ] Missing carriage return between\n\tSOAPACTION and User-Agent headers.\n\n\tThere is something going wrong in soap_ctrlpt.c at line 931 (based on\n\tversion 1.6.6 release).\n\t\n\tThe http_Makemessage call looks as follows:\n\t\n\tif (http_MakeMessage(\n\t&request, 1, 1,\n\t\"Q\" \"sbc\" \"N\" \"s\" \"s\" \"Ucc\" \"sss\",\n\tSOAPMETHOD_POST, path.buf, path.length,\n\t\"HOST: \", host.buf, host.length,\n\tcontent_length,\n\tContentTypeHeader,\n\t\"SOAPACTION:\n\t\\\"urn:schemas-upnp-org:control-1-0#QueryStateVariable\\\"\",\n\txml_start, var_name, xml_end ) != 0 ) {\n\treturn UPNP_E_OUTOF_MEMORY;\n\t}\n\t\n\tThis will result in the SOAPACTION header to be immediately followed by the\n\tUser-Agent header, while a cr-lf should separate the two. I propose to fix\n\tthis by changing the second \"s\" to \"sc\" to force the addition of a cr-lf\n\tafter the SOAPACTION. This looks consistent to the other Makemessage calls.\n\n2009-03-06 Oxygenic <oxygenic(at)users.sourceforge.net>\n\t* parameter problem fixed in soap_request_and_response(), 2nd call to\n\thttp_RequestAndResponse() was wrong (thanks to Kim Kyungsan)\n\n2008-07-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added upnp/m4/libupnp.m4 to the distribution tarball.\n\n2008-07-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a missing HandleUnlock() in upnp/src/gena/gena_device.c.\n\n2008-07-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 2026431 ] pupnp does not build on GNU/KfreeBSD.\n\tSubmitted By: Nick Leverton - leveret\n\tGnu/KFreeBSD is one of the Debian architectures, it includes a FreeBSD\n\tkernel with GNU userspace (glibc etc). The Gnu/KfreeBSD developers\n\tprovided the attached patch to test the appropriate #define and allow pupnp\n\tto build in their environment, and asked me to forward it to you.\n\n\tSince the test is a simple check for defined(__GLIBC__), this would\n\tpresumably also help with other ports of GNU libc to non-Linux kernels.\n\n2008-07-16 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Andre Sodermans (wienerschnitzel) patch for building libupnp under\n\twindows systems with VC9. This one fixes a missing include.\n\n2008-06-30 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added an m4 macro to deal with finding libupnp in the users'\n\tconfigure script.\n\n2008-06-11 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a buffer overflow due to a bug in the calculation of the\n\tCONTENT-TYPE header line size, the length was beeing calculated with\n\tthe wrong string, there was a missing colon.\n\n2008-06-02 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1942285 ]\n\tUpnpCreatePropertySet can leak memory.\n\tSubmitted By: Bob Ciora - bobciora\n\n\tIn file upnp/src/api/upnptools.c, function UpnpCreatePropertySet can leak\n\tmemory if no additional arguments are passed. This is because of the\n\t'return' statement at (or near) line 554.\n\n\tThe prior call to ixmlParseBufferEx may succeed. This causes a basic ixml\n\ttree to be created. The return statement at line 554 leaves this tree in\n\tmemory without cleaning it up.\n\n\tThere are two options: either add code prior to the return at 554 to clean\n\tup the tree, or simply allow a NumArg parameter of 0 to be passed.\n\n\tI prefer the second method -- there doesn't seem to be any need to pass\n\t*any* arguments to this function.\n\n\tIn my local copy of upnptools.c, I have simply replaced the \"return NULL\"\n\tin line 554 to \"return PropSet\".\n\n\tI've attached the source file.\n\n2008-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1903069 ]\n\tSubs (not services) not marked 'active'\n\tSubmitted By: Bob Ciora - bobciora\n\n\tIf the UpnpAcceptSubscription is not called, the subscription is not marked\n\tas \"active\", so no state variables will ever be sent.\n\n\tI have a \"lazy\" architecture where a service may not be ready to publish\n\tany state data at the time of a subscription. Subscriptions are still\n\taccepted, there's just nothing to send, so UpnpAcceptSubscription is never\n\tcalled. As a result, the subscription is never marked as \"active\" via the\n\tgenaInitNotify functions.\n\n\tA best course of action would be to modify UpnpAcceptSubscription<...>\n\tfunctions so that they can accept *no* initial state information, but can\n\tstill result in the subscription being marked as active. Technically,\n\tthen, the \"active\" flag should be set here, not in the genaInitNotify<...>\n\tfunctions.\n\n\tBut the UpnpAccept functions don't muck with the subscription table, and\n\tit's more work than it's worth to move that code from the gena fucntions to\n\tthe upnpapi functions.\n\n\tSo--- what I've done to correct this problem is to modify both\n\tUpnpAcceptSubscription<...> functions (in upnppapi.c) to accept an empty\n\tstate list and still call the gena layer functions. The gena layer\n\tgenaInitNotify<...> functions (gena_device.c) then mark the subscription as\n\t\"active\" *before* checking for an empty state set.\n\n\tIn genaInitNotify, a check for \"var_count <= 0\" is added immediately after\n\tthe \"subs->active = 1;\" line. If this occurs, then all cleanup is\n\tperformed and the function returns GENA_SUCCESS (since now, an empty state\n\tlist is not an error). The same check is made for \"PropSet == 0\" in\n\tgenaInitNotifyExt (just after the \"subs->active = 1;\" line).\n\n\tI've modifified my proxy layer to call UpnpAcceptSubscriptionExt even when\n\tthere is no state data to send. With the suggested changes to\n\tgena_device.c, later state changes are sent correctly.\n\n\tThis has solved my problem.\n\n2008-04-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix in function SetSeed() in threadutil/src/ThreadPool.c for CYGWIN\n\tcompilation. Thanks to Gary Chan.\n\n*******************************************************************************\nVersion 1.6.6\n*******************************************************************************\n\n2008-04-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added thread id's to the UpnpPrintf debug messages. Thanks to\n\tCharles Nepveu for the idea.\n\n2008-04-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t*  SF Bug Tracker [ 1948586 ]\n\tUppercase U in in \"xmlns:U\" in Invoke Action causes seg. f.\n\tSubmitted By: Thomas Norheim - kjakan_no\n\tDevice no longer segfaults with the following malformed xml action:\n\t<u:SetColor xmlns:U=\"urn:schemas-upnp-org:service:tvpicture:1\">\n\t\t<Color>2</Color>\n\t</u:SetColor>\n\n2008-04-23 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Use -O0 in debug builds so that variables do not get optimized out.\n\n2008-04-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Apostolos Syropoulos changes for OpenSolaris x86.\n\n2008-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Andre Sodermans (wienerschnitzel) patch for building libupnp under\n\twindows systems with VC9.\n\n2008-03-20 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Andre Sodermans (wienerschnitzel) patch for building libupnp under\n\twindows systems with VC8.\n\n2008-03-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a printf format problem on the upnp_tv_device.c from both\n\tupnp/sample/tvdevie and upnp/sample/tvcombo directories. The variable\n\tport was a short int instead of an unsigned short and it was beeing\n\tprint as a negative value.\n\n2008-03-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1902668 ] Cannot compile on MSVC\n\tSubmitted By Luke Kim - nereusuj\n\tVersion 1.6.5 cannot be compiled because of some changes in 1.6.3.\n\tMSVC does not support stdint.h, gettimeofday(), sys/param.h, const int\n\tvariables in array size and Windows does not define _WINDOWS_ but define\n\t_WINDOWS.\n\t* MSVC does not understand \"const int\"'s as declarators of array\n\tdimensions, we must use #define'd constants.\n\t* Use WIN32 instead of _WINDOWS_ or _WINDOWS.\n\n2008-02-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* No longer ignore \"upnp:rootdevice\" advertisement. Thanks to Bob Ciora.\n\n2008-02-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Changed \"sys_errlist[errno]\", which is deprecated, by\n\t\"strerror_r()\", which is thread safe.\n\n2008-02-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Slightly improved error report by showing the sys_errlist string\n\tcorresponding to errno.\n\n2008-02-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Got rid of two useless constants: UPNP_SOCKETERROR and\n\tUPNP_INVALID_SOCKET. They both mean the same, that a network API\n\tfunction has failed. -1 is the value to check, not an invented constant.\n\n*******************************************************************************\nVersion 1.6.5\n*******************************************************************************\n\n2008-02-02 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Peter Hartley's fix for wrong sized variable beeing passed to\n\thttp_MakeMessage() on 64 bit architectures.\n\n\n*******************************************************************************\nVersion 1.6.4\n*******************************************************************************\n\n2008-01-23 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Workaround for a problem with the new automake AM_CONDITIONAL macro\n\tfrom autotools-1.10. Thanks to Ingo Hofmann for helping with debugging\n\tthis one.\n\n2008-01-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added quoting to macros AC_CONFIG_AUX_DIR, AC_CONFIG_MACRO_DIR and\n\tAC_CONFIG_SRCDIR in configure.ac. Also changed the name of the\n\tauxiliary directory in AC_CONFIG_AUX_DIR to build-aux.\n\n2008-01-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for setsockopt() in Threadpool.c to allow more than one process\n\tto join the multicast-group on OSX. Thanks to Ingo Hofmann.\n\n2008-01-22 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Using defined(__OSX__) || defined(__APPLE__) instead of just\n\tdefined(__OSX__) in the code. Thanks to Ingo Hofmann and Chris\n\tPickel.\n\n2008-01-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for isFileInVirtualDir. Thanks to Peter Hartley for the patch.\n\n2008-01-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Putting back a \"defined(__OSX__)\" that has been removed in the\n\tprevious *BSD patch. Thanks to Chris Pickel for pointing it out.\n\n2008-01-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Patches Tracker [ 1865812 ] typo in docs comment\n\tSubmitted By: Hartmut Holzgraefe - hholzgra\n\ttypo in docs comment ACCAPTED instead of ACCEPTED in\n\t@name UPNP_E_UNSUBSCRIBE_UNACCAPTED [-302]\n\tAlso, the documentation file name was mispelled and was corrected in\n\tthe Makefile.am.\n\n*******************************************************************************\nVersion 1.6.3\n*******************************************************************************\n\n2007-12-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Using pthread flags for the whole project, not just at the places\n\tindividually indicated by several Makefile.am files spread all over\n\tthe directories. That was too much error prone.\n\n2007-12-24 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added a configure test to check if pthread_rwlock_t is available.\n\tDefine _GNU_SOURCE if needed. The fallback behaviou will only be\n\timplemented if _GNU_SOURCE prooves to be insufficient on some\n\tplatforms. Thanks to Jonathan Casiot (no_dice) and Robert Gingher\n\t(robsbox).\n\n2007-12-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removed unused iasnprintf.{c,h} files.\n\n2007-12-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removed STATSONLY() macro from ThreadPool.{c,h}.\n\t* Removed time() usage from ThreadPool.c.\n\t* Fixed STATS = 0 compilation.\n\n2007-12-16 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Library was not compiling on FreeBSD 7. Code now no longer uses\n\tftime(), using gettimeofday() instead. Thanks to Josh Carroll.\n\n\n*******************************************************************************\nVersion 1.6.2\n*******************************************************************************\n\n2007-12-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a compilation error due to a missing #ifdef in\n\tupnp/src/genlib/miniserver/miniserver.c. Thanks to Eugene Christensen.\n\n2007-11-12 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* \"make check\" was failing because ixml/test/test_document.sh did not\n\thave the executable flag set. Thanks to Steve Bresson.\n\n2007-11-12 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a memory leak in upnpapi.c to delete gMiniServerThreadPool in\n\tthe call to UpnpFinish(). Thanks to Fabrice Fontaine.\n\n2007-11-09 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added a isleep() call to the error handler of select() in\n\tRunMiniServer(), so that it does not take 100% cpu in case select()\n\tfails repeatedly.\n\n*******************************************************************************\nVersion 1.6.1\n*******************************************************************************\n\n2007-11-07 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1825278 ] AdvertiseAndReply sleeps with handle lock out\n\tApplied patch from Alex (afaucher) to change some write locks to read\n\tlocks.\n\n2007-11-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Adjusting libtool library numbers to reflect the last changes.\n\n2007-11-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1825278 ] AdvertiseAndReply sleeps with handle lock out\n\tGlobalHndMutex, which was a mutex is now GlobalHndRWLock, which is a\n\trwlock. HandleLock() is mapped to HandleWriteLock() while all other\n\tinstances have not been checked. One instance in AdvertiseAndReply()\n\thas been changed to HandleReadLock(). Thanks to Alex (afaucher) for the \n\tbug report and suggestions.\n\n2007-11-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added support for rwlocks.\n\n2007-11-05 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1825929 ] woker thread still alive after UpnpFinish()\n\tSubmitted By: Luke Kim - nereusuj\n\tWorker thread still alive after calling UpnpFinish() because\n\tThreadPoolShutdown() is in the #ifdef DEBUG block.\n\t421\n\t422 #ifdef DEBUG\n\t423 ThreadPoolShutdown( &gSendThreadPool );\n\t424 ThreadPoolShutdown( &gRecvThreadPool );\n\n2007-08-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Changed the calls to virtualDirCallback.open(filename, UPNP_WRITE)\n\tto (virtualDirCallback.open)(filename, UPNP_WRITE) (notice the\n\tparenthesis) due to a change in glibc that produces compilation\n\terrors.\n\n2007-08-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Initialization of the \"randomness\" struct so that valgrind does not\n\tcomplain.\n\n2007-08-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Merge of patch submitted By Keith Brindley - brindlk\n\tSF Bug Tracker [ 1762758 ] Seek not working for large files\n\tProblem:\n\tRequests from the uPnP client to seek to a position beyond 2GB in a large\n\tfile are handled as a request to see from the 2GB point.\n\n\tImpact:\n\tVaries depending on client. The Xbox 360 kills the connection when it\n\trealises.\n\n\tSolution:\n\tGetNextRange function (webserver.c) is updated to handle large file sizes.\n\tFix should also recognise when built on a 32bit platform rather than 64 and\n\thandle accordingly.\n\n2007-08-05 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Merge of Mac OS X patch from St\u00e9phane Corth\u00e9sy (davelopper),\n\tSF Bug Tracker [ 1686420 ] Modifications for MacOSX.\n\tSome of the proposed changes were already done by Rene Hexel's patch.\n\n*******************************************************************************\nVersion 1.6.0\n*******************************************************************************\n\n2007-06-10 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* More fixes to Mac OS X and NetBSD from Rene Hexel:\n\t[pupnp-devel] NetBSD & Mac OS X packages and patches\n\n\t  Okay, I found a couple more things.  I have attached a patch file\n\tagainst the trunk (version 206) that make the repository code compile\n\tand run on both Mac OS X and NetBSD.\n\n\tThis fixes the following issues:\n\n\t   upnp/src/api/upnpapi.c: SIOCGIFCONF didn't work properly, use\n\tgetifaddrs() instead (on BSD systems).\n\n\t  threadutil/src/ThreadPool.c: priorities only work if\n\t_POSIX_PRIORITY_SCHEDULING is defined (and greater than 0).\n\n\t  threadutil/src/LinkedList.c and threadutil/src/iasnprintf.c: use\n\tstdlib.h instead of malloc.h on all BSD systems (not just FreeBSD).\n\tThis is important, because malloc.h does not exist on Darwin/Mac OS X.\n\n\t  Cheers\n\t      ,\n\t   Rene\n\n2007-06-09 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* [pupnp-devel] NetBSD & Mac OS X packages and patches.\n\tRene Hexel's <rh@netbsd.org> patch to compile in NetBSD and Mac OS X.\n\n2007-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Updated the macro files acx_pthread.m4, ax_cflags_gcc_option.m4,\n\tax_cflags_warn_all.m4, m4/ax_cflags_warn_all_ansi.m4,\n\tm4/type_socklen_t.m4.\n\n2007-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed an issue with the instalation of the file upnpdebug.h. Since\n\tthe last modifications that removed the macro DEBUV_ONLY, this file\n\tmust be installed even on a non-debug build.\n\n2007-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Bug Tracker [ 1711325 ] Bad DestAddr in Upnp_Discovery structure\n\tSubmitted By: Bob Ciora\n\tThe field DestAddr of the structure Upnp_Discovery is now a full\n\tSOCKADDRIN instead of a pointer to SOCKADDRIN. Commented code sugests\n\tthat in a previous moment, the function ssdp_handle_ctrlpt_msg() did\n\tnot use a postponed thread to call ctrlpt_callback(). Now the code\n\tuses a thread, and most probably the original data would get lost and\n\tthe pointer would point to an invalid memory region. This fix caused\n\tan interface change in the library and the minor library version was\n\tbumped. Also, the libtool library numbers were changed accordingly.\n\n*******************************************************************************\nVersion 1.4.7\n*******************************************************************************\n\n2007-05-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added support for the Basic Device\n\t(http://www.upnp.org/standardizeddcps/basic.asp) as suggested by\n\tTitus Winters.\n\n2007-05-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed the file libupnp.pc.in to generate a correct path for the\n\tinclude files.\n\n2007-05-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removing the Dbg_Level, InitLog, SetLogFileNames and CloseLog\n\tdefines. These were just aliases, no reason to keep them.\n\n2007-05-25 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Changed the comments of the include files that expose the UPnP API\n\tto use only C89 comments and no C99 comments.\n\n2007-05-24 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* Added tvcombo sample that demonstrates coexistence of a device and a\n\tcontrol point in the same application.\n\n2007-05-24 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* SF Tracker FR [ 1570020 ].\n\t* Enable both device and control point in the same application. Resolve\n\tdeadlock in the SSDP processing threads.\n\t* Fix Threadpool expansion condition.\n\tThanks to Siva Chandran P. for the original patch.\n\n2007-05-24 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* Modified tvdevice (control and picture) service descriptions to make\n\tcompatible with WinXP/IE control point. 'in' arguments must appear before\n\t'out' arguments in argument list.\n\tThanks to Martin Tremblay for pointing out the solution originally provided\n\tby MORIOKA Yasuhiro.\n\n2007-05-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* More MSVC fixes, using XINLINE instead of inline, MSVC has troubles\n\twith inline. Thanks to David Maass for reporting.\n\t* Changed XINLINE to UPNP_INLINE.\n\n2007-05-21 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added the file build/inc/msvc/inttypes.h. This file is for use with\n\tMSVC only, because it does not provide C99 compatibility.\n\n2007-05-18 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removed all uses of the DEVICEONLY(x) macro.\n\n2007-05-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Removed all uses of the DBGONLY(x) macro. A static inline empty\n\tfunction now is used and the compiler takes care of optimizing it out.\n\n2007-05-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fixed a bug in UpnpPrintf, function could call va_start() and return\n\tbefor calling va_end().\n\n2007-05-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* EXPORT_SPEC missing on some declarations in ixml/inc/ixml.h.\n\tThanks to David Maass.\n\n2007-05-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* sizeof is unsigned, so %zu is more adequate than %zd.\n\n2007-05-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Using an invented printf directive PRIzu that on MSVC\n\texpands to \"lu\", and on normal C99 compilers expands to \"zu\".\n\n2007-05-15 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Rewrote raw_find_str. Now it no longer uses strcasestr(), but it\n\ttransforms the first input buffer into lowercase.\n\n2007-05-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for debug printf format strings. size_t are not expected\n\tin a string format like \"%.*s\".\n\n2007-05-08 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Added inttypes.h as a header requirement in configure.ac.\n\n2007-05-11 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Moved upnp_tv_ctrlpt and upnp_tv_device executables from folder\n\tupnp to folder upnp/sample. Moved folder upnp/sample/tvdevice/web\n\tto folder upnp/sample/web. This way, if someone compiles the\n\ttarball and executes upnp_tv_device from its creation directory,\n\tthere will be no error -108 for not finding directory web.\n\n*******************************************************************************\nVersion 1.4.6\n*******************************************************************************\n\n2007-04-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Fix for freebsd host_os in configure.ac.\n\n*******************************************************************************\nVersion 1.4.5\n*******************************************************************************\n\n2007-04-19 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* Case insensitive comparison in raw_find_str() (httpparser.c) as\n\tsuggested by Craig Nelson in SF Tracker [ 1689382 ] DLINK DIR-625\n\tpatch.\n\n2007-04-07 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* Fix for a bug in makeAction where va_arg was beeing called one\n\textra time.\n\n2007-04-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Tracker [ 1703533 ] Patch to make it compile under FreeBSD\n\tSubmitted By: Timothy Redaelli - drittz\n\tI made some patches to make it compile under FreeBSD using\n\tgethostbyaddr_r when supported.\n\n2007-04-28 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* [pupnp-devel] Type mixup on x86_64 causes UPNP_E_OUTOF_MEMORY\n\tSubmitted By: Glen Masgai\n\tafter an UpnpSendActionAsync() for example, i get UPNP_E_OUTOF_MEMORY\n\tin the callback using 1.4.4 on a x86_64 system. This happens in\n\thttp_MakeMessage(), which in some cases get called with wrong types\n\t(int instead of size_t) in combination with format \"b\" and \"Q\".\n\tThe attached patch should fix this.\n\n*******************************************************************************\nVersion 1.4.4\n*******************************************************************************\n\n2007-04-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Tracker [ 1695399 ] Typo in util.h\n\tSubmitted By: Luke Kim - nereusuj\n\tUnix sleep is in seconds but WIN32 Sleep is in milliseconds.\n\n2007-04-17 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Tracker [ 1652827 ] UpnpRegisterRootDevice returned -104\n\tSubmitted By: Michael Andersen - miwer\n\t\n\tIssue was found to be related to sizeof (size_t) != sizeof (int)\n\ton AMD64 systems. Emil Ljungdahl's AMD64 patch has been applied along\n\twith some other fixes. Original user report follows:\n\n\tWhen I run upnpd I get the above mentioned error (UPNP_E_OUTOF_MEMORY).\n\tI've tried with 1.4.1 and 1.4.2-RC3, it's the same. I don't understand why,\n\tbecause I have plenty of RAM, and I even tried closing some applications,\n\tbut it didn't help.\n\n\t$ upnpd eth1 br0\n\n\tThe following is logged in the /var/log/messages:\n\tFeb 6 01:33:47 server upnpd[6933]: Error registering the root device with\n\tdescDocUrl: http://192.168.0.1:49152/gatedesc.xml\n\tFeb 6 01:33:47 server upnpd[6933]: UpnpRegisterRootDevice returned -104\n\n\n\tI tried enabling debugging and it looks like it cannot allocate memory\n\tthrough the membuffer_append function. It's wierd because it's only a few\n\tbytes.\n\n\tPlease note, that I enabled some extra debugging lines that were commented,\n\tin order to get more information. See attached files.\n\n*******************************************************************************\nVersion 1.4.3\n*******************************************************************************\n\n2007-03-13 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t* SF Tracker [ 1663004 ] Compile on Cygwin\n\tSubmitted By: Jon Foster - jongfoster\n\tThis patch gives basic support for building under Cygwin - it compiles,\n\tlinks, and a simple UPnP device application can initialise. I'm not sure\n\tif it actually works yet, but this is definitely a step in the right\n\tdirection.\n\t\n\tPatch is against the 1.4.1 release. Changes are:\n\t\n\t* threadutil/inc/ithread.h: Fix the ithread mutex support to use\n\tdocumented, portable APIs (if present) rather than the Non-Portable (_NP)\n\tones it uses now. This is required because Cygwin implements only the\n\tportable API.\n\t\n\t* threadutil/src/ThreadPool.c: Fake SetPolicyType() to do nothing on Cygwin\n\tbecause otherwise it fails. Should probably investigate why it fails and\n\tadd a proper implementation later.\n\t\n\t* upnp/src/api/upnpapi.c: On Cygwin, zero out the GlobalHndMutex structure\n\tbefore initialising it. Without this, the initialisation fails. This\n\tappears to be a bug in Cygwin.\n\t\n\t* upnp/src/genlib/net/uri/uri.c: Use gethostbyname() on Cygwin.\n\t\n2007-03-05 Oxy <oxygenic(at)users.sourceforge.net>\n\t* Code adapted and typedefs added to compile cleanly under Windows\n\twith Borland C++ Builder and MS Visual C++\n\n2007-03-03 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\t\n\t* Fixed nasty segmentation fault bug on membuffer.c.\n\t\n*******************************************************************************\nVersion 1.4.2\n*******************************************************************************\n\n2007-02-09 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* 32/64 bits portability issues on *printf.\n\tUse %zd for size_t, and cast to (long long) for off_t.\n\n2007-02-02 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Bumped the program version to 1.4.2 in config.ac.\n\n\t* Now requires autoconf 2.60.\n\n\t* Fixed docdir use.\n\n\t* Does not install the documentation by default.\n\n\t* Use dist-bzip2 to create a .bz2 distribution file.\n\n2007-01-23 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* SF Tracker [ 1634922 ] Support for large files (>= 2 GiB), part 2\n\tSubmitted By: Jonathan Casiot - no_dice\n\tSummary: This patch hopefully fixes the remaining types and related\n\tcode to enable files >= 2 GiB to be streamed. Jonathan claims to have\n\ttested this with a patched version of ushare-0.9.8 and a D-Link DSM-520.\n\n2007-01-09 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* SF Tracker [ 1628629 ] Multicast interface patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\tThis patch fixes two problems:\n\t1) Specify the IP address for the interface when we do\n\tsetsockopt IP_ADD_MEMBERSHIP. This makes it possible to run\n\twhen no default router has been configured.\n\t2) Explicitly set the multicast interface through setsockopt\n\tIP_MULTICAST_IF. Avoids socket error -207 in some cases.\n\t\n\t* SF Tracker [ 1628590 ] XML parsing segfault patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\tThis patch fixes a segmentation fault problem that occurrs\n\twhen parsing XML code than some routers produce.\n\n2007-01-06 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* SF Tracker [ 1628552 ] XML white space patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\t\n\t* SF Tracker [ 1628562 ] Maximum total jobs patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\tAlso, I incremented the libray versions and included some\n\tcomments in the file configure.ac so that we do not bump\n\tthe library version excessively, only the necessary numbers\n\ton the next release.\n\t\n\t* SF Tracker [ 1628575 ] Linksys WRT54G patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\t\n\t* SF Tracker [ 1628636 ] SSDP packet copy patch\n\tSubmitted By: Fredrik Svensson - svefredrik\n\tChanged NUM_COPY to 1 since, according to section 9.2 of the\n\tHTTPU/MU spec, we should never send more than one copy of a\n\treply to an SSDP request. Ref. section 9.2 of\n\thttp://www.upnp.org/download/draft-goland-http-udp-04.txt\n\n2006-12-23 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Thorough revision of every call of http_MakeMessage() due to a\n\tbug introduced in rev.79 \"largefile patch added\".\n\thttp_MakeMessage() has a worst than brain damaged \"printf\" like\n\tinterface. In rev.79, the \"N\" format parameter must be an off_t.\n\tEvery call of this function with an \"N\" format parameter and an\n\tint passed on the stack would fail terribly.\n\t\n\t* SF Bug tracker [ 1590469 ]\n\tTypo in ixmlparser.c\n\tSubmitted By: Erik Johansson - erijo\n\t\n\t* SF Bug Tracker [ 1590466 ] Invalid xml output\n\tSubmitted By: Erik Johansson - erijo\n\t\n\t* SF Patch tracker [ 1581161 ] VStudio2005 patch\n\tSubmitted By: David Maass - darkservant\n\t\n\t* SF Patch tracker [ 1587272 ] const-ified ixml\n\tSubmitted By: Erik Johansson\n\t\n\t* Finished const-ifications as suggested by Erik Johansson in\n\tSF Patch tracker [ 1587272 ].\n\n2006-07-05 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\t* [bug-id] 1580440\n\t[submitted-by] Erik Johansson - erijo\n\t[patched-by] Erik Johansson - erijo\n\tThe SOAP HTTP message that's generated on upnp errors\n\tis missing a \\r\\n\\ between header and body.\n\n2006-07-07 Oxy <virtual_worlds(at)gmx.de>\n\n\t* support for large files (>2 GBytes) added\n\n\n*******************************************************************************\nVersion 1.4.1\n*******************************************************************************\n\n2006-07-07 Oxy <virtual_worlds(at)gmx.de>\n\n\t* full support for Windows added, static library and DLL are fully\n\tworking, code compiles with Borland Builder C++ and MS Visual\n\tC/C++\n\n2006-07-05 Nektarios K. Papadopoulos <npapadop(at)inaccessnetworks.com>\n\n\t* Include prebuilt documentation (html,pdf), dropping doc++ \n\tdependancy.\n\n2006-07-03 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Patch for FreeBSD, thanks to Markus Strobl.\n\n2006-06-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Fix for missing \"else\" in httpreadwrite.c. Thanks to npapadop\n\tfor the patch.\n\n2006-06-26 Marcelo Jimenez <mroberto(at)users.sourceforge.net>\n\n\t* Fix for va_list initialization in x86_64 architectures.\n\n2006-06-08 Oxy <virtual_worlds(at)gmx.de>\n\n\t* Patch to fix memory leaks and reasons for crashes added (thanks\n\tto loigu)\n\n*******************************************************************************\nVersion 1.4.0\n*******************************************************************************\n\n2006-05-26 Oxy <virtual_worlds(at)gmx.de>\n\n\t* defines in iasnprintf.h changed to work with GCC-version < 3\n\n2006-05-22 Oxy <virtual_worlds(at)gmx.de>\n\n\t* BSD-patch added (not tested yet on an BSD system)\n\n2006-05-19 Oxy <virtual_worlds(at)gmx.de>\n\n\t* Patch added for bug: ixml parser colapsed on empty args (arg=\"\")\n\n2006-05-18 Oxy <virtual_worlds(at)gmx.de>\n\n\t* DSM-320 patch added (fetched from project MediaTomb)\n\t\n\t* httpGet additons atch added, Added proxy support by introducing\n\t  UpnpOpenHttpGetProxy. UpnpOpenHttpGet now just calls\n\t  UpnpOpenHttpGetProxy with the proxy url set to NULL.\n\t  \n\t* Bugfix for typo (\"\\0\" / \"0\") in ixmlparser.c\n\t\n\t* Bugfix for M-Search packet\n\n*******************************************************************************\nFORK FROM DEAD libupnp\n*******************************************************************************\n\n2006-04-29  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* THANKS: new file with list of contributors\n\n\t* upnp/src/gena/gena_device.c (respond_ok): add 'Content-Length: 0'\n\t  in subscription response. Patch by Chaos (Bug # 1455367).\n\n2006-04-08  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/doc/UPnP_Programming_Guide.pdf: replace this document with \n\t  the one in libupnp-doc-1.2.1 because current CVS version \n\t  was corrupted.\n\n2006-04-06\n\n\t* changes applied to several files to work under Sparc Solaris, temporarily\n\t  requiring a define SPARC_SOLARIS\n\n2006-04-03  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/Makefile.am: install upnp samples in $(docdir)/examples\n\n2006-03-28  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* configure.ac: add --with-docdir option to choose where documentation\n\t  is installed (or -without-docdir to not install the documentation)\n\n2006-03-27  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/test: add simple test suite for xml parser\n\n2006-03-26  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/src/ixmlparser.c (Parser_processCDSect): fix bug which prevents\n\t  CDATA sections which contain a 0 (zero) to be parsed (instead the\n\t  parsing of the whole document is aborted). Patch by Arno Willig \n\t  (Patch # 1432124).\n\n\t* configure.ac, upnp/Makefile.am: add \"--disable-samples\" configure\n\t  option, and move samples compilation from check_PROGRAMS to\n\t  noinst_PROGRAMS\n\n2006-03-25  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/genlib/miniserver/miniserver.c (get_miniserver_sockets): \n\t  fix bug if new socket created has fd 0 (can only occur when stdin\n\t  has been closed). Patch by Oskar Liljeblad 2004-07-02 :\n\t  http://sourceforge.net/mailarchive/message.php?msg_id=8870528\n\t\n2006-03-21  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/test/test_init.c: add some version checks and exit if failure\n\n2006-03-05  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* libupnp version 1.3.1\n\n\t* upnp/inc/upnpconfig.h.in: add new define UPNP_VERSION_PATCH\n\n\t* upnp/test/test_init.c: add simple test to run during checks\n\n\t* upnp/inc/upnp.h: include \"upnpdebug.h\" only if debug enabled\n\t  in the library (else header file is not installed)\n\n\t* upnp/Makefile.am (libupnp_la_LDFLAGS): add inter-library libtool\n\t  dependencies between upnp and ixml / threadutil, so that programs \n\t  linking against upnp only still work.\n\n2006-03-04  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* libupnp version 1.3.0\n\n2006-03-03  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/genlib/net/http/httpreadwrite.c (get_sdk_info): use\n\t  package version string from configure to set sdk info\n\n\t* upnp/Makefile.am: add sample/tvdevice/web/ files in EXTRA_DIST\n\t  + do not distribute generated upnpconfig.h file.\n\n2006-02-28  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/inc/config.h, configure.ac: use only new defines\n\t  UPNP_HAVE_xx instead of INCLUDE_yyy_APIS and INTERNAL_WEB_SERVER\n\n\t* upnp/Makefile.am, ixml/Makefile.am: add -export-symbols-regex to\n\t  the librarie LDFLAGS in order to export only the symbols defined \n\t  in the API\n\n2006-02-27  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* configure.ac: add libtool versions for the 3 libraries\n\n\t* ixml/src/ixml.c (copy_with_escape): add missing 'static' to function\n\n\t* threadutil/src/ThreadPool.c (SetSeed): add missing 'static' \n\n2006-02-26  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* threadutil/inc/iasnprintf.h: add gcc __printf__ format attribute\n\t  to \"iasnprintf\"\n\n\t* upnp/src/api/upnpapi.c: fix invalid UpnpPrintf formats\n\n\t* upnp/src/gena/gena_device.c: fix invalid UpnpPrintf formats\n\n\t* upnp/src/inc/config.h: move upnp/inc/config.h to internal\n\t  sources (this file is no longer installed with the libraries)\n\n\t* upnp/inc/upnpdebug.h: new file created from debug definitions\n\t  previously in upnp/inc/config.h\n\n\t* upnp/src/api/config.c: rename to upnp/src/api/upnpdebug.c\n\n\t* upnp/inc/upnpconfig.h.in: new file to contain information on    \n\t  the configuration of the installed libraries (generates installed\n\t  file <upnp/upnpconfig.h>)\n\n2006-02-22  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/ : add missing include of config.h in some .c files\n\n2006-02-21  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/inc/upnp.h: move some definitions which should not be\n\t  exported into \"upnp/src/inc/util.h\"\n\n\t* import all modifications below from libupnp in djmount 0.51\n\t  into official libupnp\n\t\n2006-01-17  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* threadutil/Makefile.am (libthreadutil_la_SOURCES): remove extraneous\n\t  file\n\n2006-01-15  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* configure.ac: add checks for large-file support\n\n\t* upnp/inc/config.h: rename to \"upnpconfig.h\". The new \"config.h\" file\n\t  is the one generated by autoconf.\n\n\t* m4/type_socklen_t.m4: added new check for socklen_t (fallback to\n\t  int if not defined)\n\n\t* upnp/src/genlib/miniserver/miniserver.c, \n\t  upnp/src/ssdp/ssdp_server.c: use socklen_t where appropriate \n\t  (instead of int)\n\n\t* upnp/src/genlib/net/http/httpreadwrite.c (get_sdk_info): remove\n\t  XINLINE declaration (unused and too late)\n\n\t* ixml/src/node.c (ixmlNode_getNodeType): fix compilation warning\n\t  on const return type\n\n2006-01-12  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/inc/readwrite.h : suppress unused C++ header file\n\n2006-01-11  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/inc/config.h, upnp/src/inc/upnpapi.h, \n\t  upnp/src/inc/httpreadwrite.h: remove internal configuration variable \n\t  MINIMUM_DELAY (no clear purpose)\n\n2005-12-05  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/inc/upnp.h: re-declare obsolete method UpnpSetContentLength,\n\t  for binary compatibility with previous libupnp version.\n\n\t* upnp/src/api/upnpapi.c: correct type of g_maxContentLength to size_t\n\n2005-11-01  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* autoconfiscate library : replace all makefiles by Makefile.am\n\t  for automake support, + preliminary autoconf support\n\t  (generated config.h not yet used in source files)\n\n2005-10-18  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/makefile: fix location of DEBUG STATIC libupnp library\n\t\n\t* upnp/sample/tvctrlpt/linux/Makefile, \n\t  upnp/sample/tvdevice/linux/Makefile: fix STATIC library support\n\n2005-10-16  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* threadutil/src/Makefile (clean): remove built library\n\n2005-08-28  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/src/ixml.h, ixml/src/ixml.c (ixmlRelaxParser) : new function\n\n\t* ixml/src/ixmlparser.h, ixml/src/ixmlparser.c (Parser_setErrorChar) :\n\t  new function\n\n2005-08-02  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/src/Makefile: correct bug for static library being incorrectly \n\t  stripped when building non-debug\n\n2005-06-09  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* ixml/src/element.c (ixmlElement_removeAttributeNode): \n\t  remove some compilation warning\n\n\t* ixml/inc/ixml.h, ixml/src/document.c : \n\t  add some missing const's in public API \n\n\t* upnp/inc/upnptools.h, upnp/src/api/upnptools.c : \n\t  add missing const's in public API\n\n2005-05-28  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/inc/config.h: suppress HTTP_READ_BYTES (unused)\n\t  and replace by DEFAULT_SOAP_CONTENT_LENGTH (previously in upnpapi.h)\n\t\n\t* upnp/inc/upnp.h, upnp/src/api/upnpapi.c : replace \n\t  UpnpSetContentLength (which was not using its Handle argument) \n\t  by global function UpnpSetMaxContentLength. \n\t  Remove \"hard\" limitation to 32K (not suitable for using in UPnP AV).\n\t\n\t* upnp/src/inc/upnpapi.h : removed DEFAULT_SOAP_CONTENT_LENGTH\n\t  (moved to config.h) and MAX_SOAP_CONTENT_LENGTH (now unused)\n\n\t* upnp/src/api/upnptools.c : add more error message strings\n\n\t* upnp/src/genlib/net/http/httpreadwrite.c : return OUTOF_BOUNDS\n\t  instead of BAD_HTTPMSG when allowed Content Length is exceeded.\n\n\t* upnp/src/genlib/net/http/httpreadwrite.c : corrected an incorrect\n\t  sprintf format\n\t\n2005-05-27  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/makefile, upnp/src/makefile, \n\t  ixml/Makefile, ixml/src/Makefile, \n\t  threadutil/Makefile, threadutil/src/Makefile : \n\t  implement STATIC library support (from patch at \n\t  http://sourceforge.net/tracker/?group_id=7189&atid=307189 )\n\n2005-05-26  R\u00e9mi Turboult  <r3mi(at)users.sourceforge.net>\n\n\t* upnp/src/api/upnpapi.c, upnp/src/soap/soap_device.c,\n\t  upnp/src/soap/makefile : \n\t  corrections for compilation with CLIENT=1 only\n\t\n\t* importing \"libupnp-1.2.1a\" as baseline\n\t\n", "/*******************************************************************************\n *\n * Copyright (c) 2000-2003 Intel Corporation\n * All rights reserved.\n * Copyright (c) 2012 France Telecom All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * - Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n * - Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n * - Neither name of Intel Corporation nor the names of its contributors\n * may be used to endorse or promote products derived from this software\n * without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL INTEL OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n ******************************************************************************/\n\n/************************************************************************\n * Purpose: This file defines the functions for services. It defines\n * functions for adding and removing services to and from the service table,\n * adding and accessing subscription and other attributes pertaining to the\n * service\n ************************************************************************/\n\n#include \"service_table.h\"\n#include \"config.h\"\n\n#ifdef INCLUDE_DEVICE_APIS\n\n\t#if EXCLUDE_GENA == 0\n/************************************************************************\n *\tFunction :\tcopy_subscription\n *\n *\tParameters :\n *\t\tsubscription *in ;\tSource subscription\n *\t\tsubscription *out ;\tDestination subscription\n *\n *\tDescription :\tMakes a copy of the subscription\n *\n *\tReturn : int ;\n *\t\tHTTP_SUCCESS - On success\n *\n *\tNote :\n ************************************************************************/\nint copy_subscription(subscription *in, subscription *out)\n{\n\tint return_code = HTTP_SUCCESS;\n\n\tmemcpy(out->sid, in->sid, SID_SIZE);\n\tout->sid[SID_SIZE] = 0;\n\tout->ToSendEventKey = in->ToSendEventKey;\n\tout->expireTime = in->expireTime;\n\tout->active = in->active;\n\treturn_code = copy_URL_list(&in->DeliveryURLs, &out->DeliveryURLs);\n\tif (return_code != HTTP_SUCCESS) {\n\t\treturn return_code;\n\t}\n\tListInit(&out->outgoing, 0, 0);\n\tout->next = NULL;\n\treturn HTTP_SUCCESS;\n}\n\n/************************************************************************\n *\tFunction :\tRemoveSubscriptionSID\n *\n *\tParameters :\n *\t\tUpnp_SID sid ;\tsubscription ID\n *\t\tservice_info * service ;\tservice object providing the\n *list of subscriptions\n *\n *\tDescription :\tRemove the subscription represented by the\n *\t\tconst Upnp_SID sid parameter from the service table and update\n *\t\tthe service table.\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid RemoveSubscriptionSID(Upnp_SID sid, service_info *service)\n{\n\tsubscription *finger = service->subscriptionList;\n\tsubscription *previous = NULL;\n\n\twhile (finger) {\n\t\tif (!strcmp(sid, finger->sid)) {\n\t\t\tif (previous) {\n\t\t\t\tprevious->next = finger->next;\n\t\t\t} else {\n\t\t\t\tservice->subscriptionList = finger->next;\n\t\t\t}\n\t\t\tfinger->next = NULL;\n\t\t\tfreeSubscriptionList(finger);\n\t\t\tfinger = NULL;\n\t\t\tservice->TotalSubscriptions--;\n\t\t} else {\n\t\t\tprevious = finger;\n\t\t\tfinger = finger->next;\n\t\t}\n\t}\n}\n\nsubscription *GetSubscriptionSID(const Upnp_SID sid, service_info *service)\n{\n\tsubscription *next = service->subscriptionList;\n\tsubscription *previous = NULL;\n\tsubscription *found = NULL;\n\ttime_t current_time;\n\n\twhile (next && !found) {\n\t\tif (!strcmp(next->sid, sid))\n\t\t\tfound = next;\n\t\telse {\n\t\t\tprevious = next;\n\t\t\tnext = next->next;\n\t\t}\n\t}\n\tif (found) {\n\t\t/* get the current_time */\n\t\ttime(&current_time);\n\t\tif (found->expireTime && found->expireTime < current_time) {\n\t\t\tif (previous) {\n\t\t\t\tprevious->next = found->next;\n\t\t\t} else {\n\t\t\t\tservice->subscriptionList = found->next;\n\t\t\t}\n\t\t\tfound->next = NULL;\n\t\t\tfreeSubscriptionList(found);\n\t\t\tfound = NULL;\n\t\t\tservice->TotalSubscriptions--;\n\t\t}\n\t}\n\treturn found;\n}\n\nsubscription *GetNextSubscription(service_info *service, subscription *current)\n{\n\ttime_t current_time;\n\tsubscription *next = NULL;\n\tsubscription *previous = NULL;\n\tint notDone = 1;\n\n\t/* get the current_time */\n\ttime(&current_time);\n\twhile (notDone && current) {\n\t\tprevious = current;\n\t\tcurrent = current->next;\n\n\t\tif (!current) {\n\t\t\tnotDone = 0;\n\t\t\tnext = current;\n\t\t} else if (current->expireTime &&\n\t\t\t   current->expireTime < current_time) {\n\t\t\tprevious->next = current->next;\n\t\t\tcurrent->next = NULL;\n\t\t\tfreeSubscriptionList(current);\n\t\t\tcurrent = previous;\n\t\t\tservice->TotalSubscriptions--;\n\t\t} else if (current->active) {\n\t\t\tnotDone = 0;\n\t\t\tnext = current;\n\t\t}\n\t}\n\treturn next;\n}\n\nsubscription *GetFirstSubscription(service_info *service)\n{\n\tsubscription temp;\n\tsubscription *next = NULL;\n\n\ttemp.next = service->subscriptionList;\n\tnext = GetNextSubscription(service, &temp);\n\tservice->subscriptionList = temp.next;\n\t/* service->subscriptionList = next; */\n\n\treturn next;\n}\n\nvoid freeSubscription(subscription *sub)\n{\n\tif (sub) {\n\t\tfree_URL_list(&sub->DeliveryURLs);\n\t\tfreeSubscriptionQueuedEvents(sub);\n\t}\n}\n\n/************************************************************************\n *\tFunction :\tfreeSubscriptionList\n *\n *\tParameters :\n *\t\tsubscription * head ;\thead of the subscription list\n *\n *\tDescription :\tFree's memory allocated for all the subscriptions\n *\t\tin the service table.\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid freeSubscriptionList(subscription *head)\n{\n\tsubscription *next = NULL;\n\n\twhile (head) {\n\t\tnext = head->next;\n\t\tfreeSubscription(head);\n\t\tfree(head);\n\t\thead = next;\n\t}\n}\n\n/*******************************************************************************\n * Function :\tFindServiceId\n *\n * Parameters :\n *    service_table *table;  service table\n *    const char *serviceId; string representing the service id to be found\n *                           among those in the\n *    table const char *UDN; string representing the UDN to be found among those\n *                           in the table\n *\n * Description: Traverses through the service table and returns a pointer to the\n *    service node that matches a known service id and a known UDN.\n *\n * Return:\n *     service_info *: pointer to the matching service_info node.\n ******************************************************************************/\nservice_info *FindServiceId(\n\tservice_table *table, const char *serviceId, const char *UDN)\n{\n\tservice_info *finger = NULL;\n\n\tif (table) {\n\t\tfinger = table->serviceList;\n\t\twhile (finger) {\n\t\t\tif (!strcmp(serviceId, finger->serviceId) &&\n\t\t\t\t!strcmp(UDN, finger->UDN)) {\n\t\t\t\treturn finger;\n\t\t\t}\n\t\t\tfinger = finger->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}\n\n/************************************************************************\n *\tFunction :\tFindServiceEventURLPath\n *\n *\tParameters :\n *\t\tservice_table *table ;\tservice table\n *\t\tchar * eventURLPath ;\tevent URL path used to find a service\n *\t\t\t\t\t\t\t\tfrom the table\n *\n *\tDescription :\tTraverses the service table and finds the node whose\n *\t\tevent URL Path matches a know value\n *\n *\tReturn : service_info * - pointer to the service list node from the\n *\t\tservice table whose event URL matches a known event URL;\n *\n *\tNote :\n ************************************************************************/\nservice_info *FindServiceEventURLPath(\n\tservice_table *table, const char *eventURLPath)\n{\n\tservice_info *finger = NULL;\n\turi_type parsed_url;\n\turi_type parsed_url_in;\n\n\tif (!table || !eventURLPath) {\n\t\treturn NULL;\n\t}\n\tif (parse_uri(eventURLPath, strlen(eventURLPath), &parsed_url_in) ==\n\t\tHTTP_SUCCESS) {\n\t\tfinger = table->serviceList;\n\t\twhile (finger) {\n\t\t\tif (finger->eventURL) {\n\t\t\t\tif (parse_uri(finger->eventURL,\n\t\t\t\t\t    strlen(finger->eventURL),\n\t\t\t\t\t    &parsed_url) == HTTP_SUCCESS) {\n\t\t\t\t\tif (!token_cmp(&parsed_url.pathquery,\n\t\t\t\t\t\t    &parsed_url_in.pathquery)) {\n\t\t\t\t\t\treturn finger;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinger = finger->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}\n\t#endif /* EXCLUDE_GENA */\n\n\t/***********************************************************************\n\t * Function: FindServiceControlURLPath\n\t *\n\t * Parameters:\n\t *    service_table *table; service table\n\t *    char *controlURLPath; control URL path used to find a service from\n\t *                          the table\n\t *\n\t * Description: Traverses the service table and finds the node whose\n\t *    control URL Path matches a know value\n\t *\n\t * Return: service_info *:  pointer to the service list node from the\n\t *    service table whose control URL Path matches a known value.\n\t **********************************************************************/\n\t#if EXCLUDE_SOAP == 0\nservice_info *FindServiceControlURLPath(\n\tservice_table *table, const char *controlURLPath)\n{\n\tservice_info *finger = NULL;\n\turi_type parsed_url;\n\turi_type parsed_url_in;\n\n\tif (!table || !controlURLPath) {\n\t\treturn NULL;\n\t}\n\tif (parse_uri(controlURLPath, strlen(controlURLPath), &parsed_url_in) ==\n\t\tHTTP_SUCCESS) {\n\t\tfinger = table->serviceList;\n\t\twhile (finger) {\n\t\t\tif (finger->controlURL) {\n\t\t\t\tif (parse_uri(finger->controlURL,\n\t\t\t\t\t    strlen(finger->controlURL),\n\t\t\t\t\t    &parsed_url) == HTTP_SUCCESS) {\n\t\t\t\t\tif (!token_cmp(&parsed_url.pathquery,\n\t\t\t\t\t\t    &parsed_url_in.pathquery)) {\n\t\t\t\t\t\treturn finger;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinger = finger->next;\n\t\t}\n\t}\n\n\treturn NULL;\n}\n\t#endif /* EXCLUDE_SOAP */\n\n\t/***********************************************************************\n\t * Function: printService\n\t *\n\t * Parameters:\n\t *    service_info *service; Service whose information is to be printed\n\t *    Upnp_LogLevel level;  Debug level specified to the print function\n\t *    Dbg_Module module;    Debug module specified to the print function\n\t *\n\t * Description: For debugging purposes prints information from the\n\t *    service passed into the function.\n\t *\n\t * Return: void\n\t **********************************************************************/\n\t#ifdef DEBUG\nvoid printService(service_info *service, Upnp_LogLevel level, Dbg_Module module)\n{\n\tif (service) {\n\t\tif (service->serviceType) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"serviceType: %s\\n\",\n\t\t\t\tservice->serviceType);\n\t\t}\n\t\tif (service->serviceId) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"serviceId: %s\\n\",\n\t\t\t\tservice->serviceId);\n\t\t}\n\t\tif (service->SCPDURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"SCPDURL: %s\\n\",\n\t\t\t\tservice->SCPDURL);\n\t\t}\n\t\tif (service->controlURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"controlURL: %s\\n\",\n\t\t\t\tservice->controlURL);\n\t\t}\n\t\tif (service->eventURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"eventURL: %s\\n\",\n\t\t\t\tservice->eventURL);\n\t\t}\n\t\tif (service->UDN) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"UDN: %s\\n\\n\",\n\t\t\t\tservice->UDN);\n\t\t}\n\t\tif (service->active) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"Service is active\\n\");\n\t\t} else {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"Service is inactive\\n\");\n\t\t}\n\t}\n}\n\t#endif\n\n\t/************************************************************************\n\t * Function: printServiceList\n\t *\n\t * Parameters:\n\t *    service_info *service; Service whose information is to be printed\n\t *    Upnp_LogLevel level;   Debug level specified to the print function\n\t *    Dbg_Module module;    Debug module specified to the print function\n\t *\n\t * Description: For debugging purposes prints information of each\n\t *    service from the service table passed into the function.\n\t *\n\t * Return: void\n\t ************************************************************************/\n\t#ifdef DEBUG\nvoid printServiceList(\n\tservice_info *service, Upnp_LogLevel level, Dbg_Module module)\n{\n\twhile (service) {\n\t\tif (service->serviceType) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"serviceType: %s\\n\",\n\t\t\t\tservice->serviceType);\n\t\t}\n\t\tif (service->serviceId) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"serviceId: %s\\n\",\n\t\t\t\tservice->serviceId);\n\t\t}\n\t\tif (service->SCPDURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"SCPDURL: %s\\n\",\n\t\t\t\tservice->SCPDURL);\n\t\t}\n\t\tif (service->controlURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"controlURL: %s\\n\",\n\t\t\t\tservice->controlURL);\n\t\t}\n\t\tif (service->eventURL) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"eventURL: %s\\n\",\n\t\t\t\tservice->eventURL);\n\t\t}\n\t\tif (service->UDN) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"UDN: %s\\n\\n\",\n\t\t\t\tservice->UDN);\n\t\t}\n\t\tif (service->active) {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"Service is active\\n\");\n\t\t} else {\n\t\t\tUpnpPrintf(level,\n\t\t\t\tmodule,\n\t\t\t\t__FILE__,\n\t\t\t\t__LINE__,\n\t\t\t\t\"Service is inactive\\n\");\n\t\t}\n\t\tservice = service->next;\n\t}\n}\n\t#endif\n\n\t/************************************************************************\n\t * Function: printServiceTable\n\t *\n\t * Parameters:\n\t *    service_table *table; Service table to be printed\n\t *    Upnp_LogLevel level;  Debug level specified to the print function\n\t *    Dbg_Module module;    Debug module specified to the print function\n\t *\n\t * Description: For debugging purposes prints the URL base of the table\n\t *    and information of each service from the service table passed into\n\t *    the function.\n\t *\n\t * Return: void\n\t ************************************************************************/\n\t#ifdef DEBUG\nvoid printServiceTable(\n\tservice_table *table, Upnp_LogLevel level, Dbg_Module module)\n{\n\tUpnpPrintf(level,\n\t\tmodule,\n\t\t__FILE__,\n\t\t__LINE__,\n\t\t\"URL_BASE: %s\\n\",\n\t\ttable->URLBase);\n\tUpnpPrintf(level, module, __FILE__, __LINE__, \"Services: \\n\");\n\tprintServiceList(table->serviceList, level, module);\n}\n\t#endif\n\n\t#if EXCLUDE_GENA == 0\n/************************************************************************\n *\tFunction :\tfreeService\n *\n *\tParameters :\n *\t\tservice_info *in ;\tservice information that is to be freed\n *\n *\tDescription :\tFree's memory allocated for the various components\n *\t\tof the service entry in the service table.\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid freeService(service_info *in)\n{\n\tif (in) {\n\t\tif (in->serviceType)\n\t\t\tixmlFreeDOMString(in->serviceType);\n\n\t\tif (in->serviceId)\n\t\t\tixmlFreeDOMString(in->serviceId);\n\n\t\tif (in->SCPDURL)\n\t\t\tfree(in->SCPDURL);\n\n\t\tif (in->controlURL)\n\t\t\tfree(in->controlURL);\n\n\t\tif (in->eventURL)\n\t\t\tfree(in->eventURL);\n\n\t\tif (in->UDN)\n\t\t\tixmlFreeDOMString(in->UDN);\n\n\t\tif (in->subscriptionList)\n\t\t\tfreeSubscriptionList(in->subscriptionList);\n\n\t\tin->TotalSubscriptions = 0;\n\t\tfree(in);\n\t}\n}\n\n/************************************************************************\n *\tFunction :\tfreeServiceList\n *\n *\tParameters :\n *\t\tservice_info * head ;\tHead of the service list to be freed\n *\n *\tDescription :\tFree's memory allocated for the various components\n *\t\tof each service entry in the service table.\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid freeServiceList(service_info *head)\n{\n\tservice_info *next = NULL;\n\n\twhile (head) {\n\t\tif (head->serviceType)\n\t\t\tixmlFreeDOMString(head->serviceType);\n\t\tif (head->serviceId)\n\t\t\tixmlFreeDOMString(head->serviceId);\n\t\tif (head->SCPDURL)\n\t\t\tfree(head->SCPDURL);\n\t\tif (head->controlURL)\n\t\t\tfree(head->controlURL);\n\t\tif (head->eventURL)\n\t\t\tfree(head->eventURL);\n\t\tif (head->UDN)\n\t\t\tixmlFreeDOMString(head->UDN);\n\t\tif (head->subscriptionList)\n\t\t\tfreeSubscriptionList(head->subscriptionList);\n\n\t\thead->TotalSubscriptions = 0;\n\t\tnext = head->next;\n\t\tfree(head);\n\t\thead = next;\n\t}\n}\n\n/************************************************************************\n *\tFunction :\tfreeServiceTable\n *\n *\tParameters :\n *\t\tservice_table * table ;\tService table whose memory needs to be\n *\t\t\t\t\t\t\t\tfreed\n *\n *\tDescription : Free's dynamic memory in table.\n *\t\t(does not free table, only memory within the structure)\n *\n *\tReturn : void ;\n *\n *\tNote :\n ************************************************************************/\nvoid freeServiceTable(service_table *table)\n{\n\tixmlFreeDOMString(table->URLBase);\n\tfreeServiceList(table->serviceList);\n\ttable->serviceList = NULL;\n\ttable->endServiceList = NULL;\n}\n\n/*******************************************************************************\n * Function: getElementValue\n *\n * Parameters:\n *    IXML_Node *node; Input node which provides the list of child nodes\n *\n * Description: Returns the clone of the element value\n *\n * Return: DOMString\n *\n * Note: value must be freed with DOMString_free\n ******************************************************************************/\nDOMString getElementValue(IXML_Node *node)\n{\n\tIXML_Node *child = (IXML_Node *)ixmlNode_getFirstChild(node);\n\tconst DOMString temp = NULL;\n\n\tif (child && ixmlNode_getNodeType(child) == eTEXT_NODE) {\n\t\ttemp = ixmlNode_getNodeValue(child);\n\n\t\treturn ixmlCloneDOMString(temp);\n\t} else {\n\t\treturn NULL;\n\t}\n}\n\n/*******************************************************************************\n * Function: getSubElement\n *\n * Parameters:\n *    const char *element_name; sub element name to be searched for\n *    IXML_Node *node;         Input node which provides the list of child nodes\n *    IXML_Node **out;         Ouput node to which the matched child node is\n *                             returned.\n *\n * Description: Traverses through a list of XML nodes to find the node with the\n *              known element name.\n *\n * Return: int\n *    1 - On Success\n *    0 - On Failure\n ******************************************************************************/\nint getSubElement(const char *element_name, IXML_Node *node, IXML_Node **out)\n{\n\tconst DOMString NodeName = NULL;\n\tint found = 0;\n\tIXML_Node *child = (IXML_Node *)ixmlNode_getFirstChild(node);\n\n\t(*out) = NULL;\n\twhile (child && !found) {\n\t\tswitch (ixmlNode_getNodeType(child)) {\n\t\tcase eELEMENT_NODE:\n\t\t\tNodeName = ixmlNode_getNodeName(child);\n\t\t\tif (!strcmp(NodeName, element_name)) {\n\t\t\t\t(*out) = child;\n\t\t\t\tfound = 1;\n\t\t\t\treturn found;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\tchild = (IXML_Node *)ixmlNode_getNextSibling(child);\n\t}\n\n\treturn found;\n}\n\n/*******************************************************************************\n * Function: getServiceList\n *\n * Parameters:\n *    IXML_Node *node;\t  XML node information\n *    service_info **end; service added is returned to the output parameter\n *    char *URLBase;      provides Base URL to resolve relative URL\n *\n * Description: Returns pointer to service info after getting the sub-elements\n *    of the service info.\n *\n * Return: service_info *: pointer to the service info node\n ******************************************************************************/\nservice_info *getServiceList(IXML_Node *node, service_info **end, char *URLBase)\n{\n\tIXML_Node *serviceList = NULL;\n\tIXML_Node *current_service = NULL;\n\tIXML_Node *UDN = NULL;\n\n\tIXML_Node *serviceType = NULL;\n\tIXML_Node *serviceId = NULL;\n\tIXML_Node *SCPDURL = NULL;\n\tIXML_Node *controlURL = NULL;\n\tIXML_Node *eventURL = NULL;\n\tDOMString tempDOMString = NULL;\n\tservice_info *head = NULL;\n\tservice_info *current = NULL;\n\tservice_info *previous = NULL;\n\tIXML_NodeList *serviceNodeList = NULL;\n\tlong unsigned int NumOfServices = 0lu;\n\tlong unsigned int i = 0lu;\n\tint fail = 0;\n\n\tif (getSubElement(\"UDN\", node, &UDN) &&\n\t\tgetSubElement(\"serviceList\", node, &serviceList)) {\n\t\tserviceNodeList = ixmlElement_getElementsByTagName(\n\t\t\t(IXML_Element *)serviceList, \"service\");\n\t\tif (serviceNodeList) {\n\t\t\tNumOfServices = ixmlNodeList_length(serviceNodeList);\n\t\t\tfor (i = 0lu; i < NumOfServices; i++) {\n\t\t\t\tcurrent_service =\n\t\t\t\t\tixmlNodeList_item(serviceNodeList, i);\n\t\t\t\tfail = 0;\n\t\t\t\tif (current) {\n\t\t\t\t\tcurrent->next =\n\t\t\t\t\t\tmalloc(sizeof(service_info));\n\t\t\t\t\tprevious = current;\n\t\t\t\t\tcurrent = current->next;\n\t\t\t\t} else {\n\t\t\t\t\thead = malloc(sizeof(service_info));\n\t\t\t\t\tcurrent = head;\n\t\t\t\t}\n\t\t\t\tif (!current) {\n\t\t\t\t\tfreeServiceList(head);\n\t\t\t\t\tixmlNodeList_free(serviceNodeList);\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t\tcurrent->next = NULL;\n\t\t\t\tcurrent->controlURL = NULL;\n\t\t\t\tcurrent->eventURL = NULL;\n\t\t\t\tcurrent->serviceType = NULL;\n\t\t\t\tcurrent->serviceId = NULL;\n\t\t\t\tcurrent->SCPDURL = NULL;\n\t\t\t\tcurrent->active = 1;\n\t\t\t\tcurrent->subscriptionList = NULL;\n\t\t\t\tcurrent->TotalSubscriptions = 0;\n\t\t\t\tif (!(current->UDN = getElementValue(UDN)))\n\t\t\t\t\tfail = 1;\n\t\t\t\tif (!getSubElement(\"serviceType\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &serviceType) ||\n\t\t\t\t\t!(current->serviceType =\n\t\t\t\t\t\t\tgetElementValue(\n\t\t\t\t\t\t\t\tserviceType)))\n\t\t\t\t\tfail = 1;\n\t\t\t\tif (!getSubElement(\"serviceId\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &serviceId) ||\n\t\t\t\t\t!(current->serviceId = getElementValue(\n\t\t\t\t\t\t  serviceId)))\n\t\t\t\t\tfail = 1;\n\t\t\t\tif (!getSubElement(\"SCPDURL\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &SCPDURL) ||\n\t\t\t\t\t!(tempDOMString = getElementValue(\n\t\t\t\t\t\t  SCPDURL)) ||\n\t\t\t\t\t!(current->SCPDURL = resolve_rel_url(\n\t\t\t\t\t\t  URLBase, tempDOMString)))\n\t\t\t\t\tfail = 1;\n\t\t\t\tixmlFreeDOMString(tempDOMString);\n\t\t\t\ttempDOMString = NULL;\n\t\t\t\tif (!(getSubElement(\"controlURL\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &controlURL)) ||\n\t\t\t\t\t!(tempDOMString = getElementValue(\n\t\t\t\t\t\t  controlURL)) ||\n\t\t\t\t\t!(current->controlURL = resolve_rel_url(\n\t\t\t\t\t\t  URLBase, tempDOMString))) {\n\t\t\t\t\tUpnpPrintf(UPNP_INFO,\n\t\t\t\t\t\tGENA,\n\t\t\t\t\t\t__FILE__,\n\t\t\t\t\t\t__LINE__,\n\t\t\t\t\t\t\"BAD OR MISSING CONTROL URL\");\n\t\t\t\t\tUpnpPrintf(UPNP_INFO,\n\t\t\t\t\t\tGENA,\n\t\t\t\t\t\t__FILE__,\n\t\t\t\t\t\t__LINE__,\n\t\t\t\t\t\t\"CONTROL URL SET TO NULL IN \"\n\t\t\t\t\t\t\"SERVICE INFO\");\n\t\t\t\t\tcurrent->controlURL = NULL;\n\t\t\t\t\tfail = 0;\n\t\t\t\t}\n\t\t\t\tixmlFreeDOMString(tempDOMString);\n\t\t\t\ttempDOMString = NULL;\n\t\t\t\tif (!getSubElement(\"eventSubURL\",\n\t\t\t\t\t    current_service,\n\t\t\t\t\t    &eventURL) ||\n\t\t\t\t\t!(tempDOMString = getElementValue(\n\t\t\t\t\t\t  eventURL)) ||\n\t\t\t\t\t!(current->eventURL = resolve_rel_url(\n\t\t\t\t\t\t  URLBase, tempDOMString))) {\n\t\t\t\t\tUpnpPrintf(UPNP_INFO,\n\t\t\t\t\t\tGENA,\n\t\t\t\t\t\t__FILE__,\n\t\t\t\t\t\t__LINE__,\n\t\t\t\t\t\t\"BAD OR MISSING EVENT URL\");\n\t\t\t\t\tUpnpPrintf(UPNP_INFO,\n\t\t\t\t\t\tGENA,\n\t\t\t\t\t\t__FILE__,\n\t\t\t\t\t\t__LINE__,\n\t\t\t\t\t\t\"EVENT URL SET TO NULL IN \"\n\t\t\t\t\t\t\"SERVICE INFO\");\n\t\t\t\t\tcurrent->eventURL = NULL;\n\t\t\t\t\tfail = 0;\n\t\t\t\t}\n\t\t\t\tixmlFreeDOMString(tempDOMString);\n\t\t\t\ttempDOMString = NULL;\n\t\t\t\tif (fail) {\n\t\t\t\t\tfreeServiceList(current);\n\t\t\t\t\tif (previous)\n\t\t\t\t\t\tprevious->next = NULL;\n\t\t\t\t\telse\n\t\t\t\t\t\thead = NULL;\n\t\t\t\t\tcurrent = previous;\n\t\t\t\t}\n\t\t\t}\n\t\t\tixmlNodeList_free(serviceNodeList);\n\t\t}\n\t\t(*end) = current;\n\t\treturn head;\n\t} else {\n\t\t(*end) = NULL;\n\t\treturn NULL;\n\t}\n}\n\n/*******************************************************************************\n * Function: getAllServiceList\n *\n * Parameters:\n *    IXML_Node *node;        XML node information\n *    char *URLBase;          provides Base URL to resolve relative URL\n *    service_info **out_end; service added is returned to the output parameter\n *\n * Description: Returns pointer to service info after getting the sub-elements\n *    of the service info.\n *\n * Return: service_info *\n ******************************************************************************/\nservice_info *getAllServiceList(\n\tIXML_Node *node, char *URLBase, service_info **out_end)\n{\n\tservice_info *head = NULL;\n\tservice_info *end = NULL;\n\tservice_info *next_end = NULL;\n\tIXML_NodeList *deviceList = NULL;\n\tIXML_Node *currentDevice = NULL;\n\n\tlong unsigned int NumOfDevices = 0lu;\n\tlong unsigned int i = 0lu;\n\n\t(*out_end) = NULL;\n\tdeviceList = ixmlElement_getElementsByTagName(\n\t\t(IXML_Element *)node, \"device\");\n\tif (deviceList) {\n\t\tNumOfDevices = ixmlNodeList_length(deviceList);\n\t\tfor (i = 0lu; i < NumOfDevices; i++) {\n\t\t\tcurrentDevice = ixmlNodeList_item(deviceList, i);\n\t\t\tif (head) {\n\t\t\t\tend->next = getServiceList(\n\t\t\t\t\tcurrentDevice, &next_end, URLBase);\n\t\t\t\tif (next_end)\n\t\t\t\t\tend = next_end;\n\t\t\t} else {\n\t\t\t\thead = getServiceList(\n\t\t\t\t\tcurrentDevice, &end, URLBase);\n\t\t\t}\n\t\t}\n\t\tixmlNodeList_free(deviceList);\n\t}\n\n\t(*out_end) = end;\n\treturn head;\n}\n\n/*******************************************************************************\n * Function: removeServiceTable\n *\n * Parameters:\n *    IXML_Node *node ;  XML node information\n *    service_table *in; service table from which services will be removed\n *\n * Description: This function assumes that services for a particular root device\n *    are placed linearly in the service table, and in the order in which they\n *    are found in the description document all services for this root device\n *    are removed from the list\n *\n * Return: int\n ******************************************************************************/\nint removeServiceTable(IXML_Node *node, service_table *in)\n{\n\tIXML_Node *root = NULL;\n\tIXML_Node *currentUDN = NULL;\n\tDOMString UDN = NULL;\n\tIXML_NodeList *deviceList = NULL;\n\tservice_info *current_service = NULL;\n\tservice_info *start_search = NULL;\n\tservice_info *prev_service = NULL;\n\tlong unsigned int NumOfDevices = 0lu;\n\tlong unsigned int i = 0lu;\n\n\tif (getSubElement(\"root\", node, &root)) {\n\t\tstart_search = in->serviceList;\n\t\tdeviceList = ixmlElement_getElementsByTagName(\n\t\t\t(IXML_Element *)root, \"device\");\n\t\tif (deviceList) {\n\t\t\tNumOfDevices = ixmlNodeList_length(deviceList);\n\t\t\tfor (i = 0lu; i < NumOfDevices; i++) {\n\t\t\t\tif ((start_search) &&\n\t\t\t\t\t((getSubElement(\n\t\t\t\t\t\t \"UDN\", node, &currentUDN)) &&\n\t\t\t\t\t\t(UDN = getElementValue(\n\t\t\t\t\t\t\t currentUDN)))) {\n\t\t\t\t\tcurrent_service = start_search;\n\t\t\t\t\t/* Services are put in the service table\n\t\t\t\t\t * in the order in which they appear in\n\t\t\t\t\t * the description document, therefore\n\t\t\t\t\t * we go through the list only once to\n\t\t\t\t\t * remove a particular root device */\n\t\t\t\t\twhile ((current_service) &&\n\t\t\t\t\t\t(strcmp(current_service->UDN,\n\t\t\t\t\t\t\tUDN))) {\n\t\t\t\t\t\tcurrent_service =\n\t\t\t\t\t\t\tcurrent_service->next;\n\t\t\t\t\t\tif (current_service != NULL)\n\t\t\t\t\t\t\tprev_service =\n\t\t\t\t\t\t\t\tcurrent_service\n\t\t\t\t\t\t\t\t\t->next;\n\t\t\t\t\t}\n\t\t\t\t\twhile ((current_service) &&\n\t\t\t\t\t\t(!strcmp(current_service->UDN,\n\t\t\t\t\t\t\tUDN))) {\n\t\t\t\t\t\tif (prev_service) {\n\t\t\t\t\t\t\tprev_service->next =\n\t\t\t\t\t\t\t\tcurrent_service\n\t\t\t\t\t\t\t\t\t->next;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tin->serviceList =\n\t\t\t\t\t\t\t\tcurrent_service\n\t\t\t\t\t\t\t\t\t->next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (current_service ==\n\t\t\t\t\t\t\tin->endServiceList)\n\t\t\t\t\t\t\tin->endServiceList =\n\t\t\t\t\t\t\t\tprev_service;\n\t\t\t\t\t\tstart_search =\n\t\t\t\t\t\t\tcurrent_service->next;\n\t\t\t\t\t\tfreeService(current_service);\n\t\t\t\t\t\tcurrent_service = start_search;\n\t\t\t\t\t}\n\t\t\t\t\tixmlFreeDOMString(UDN);\n\t\t\t\t\tUDN = NULL;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tixmlNodeList_free(deviceList);\n\t\t}\n\t}\n\treturn 1;\n}\n\n/*******************************************************************************\n * Function: addServiceTable\n *\n * Parameters :\n *    IXML_Node *node;            XML node information\n *    service_table *in;          service table that will be initialized with\n *                                services\n *    const char *DefaultURLBase; Default base URL on which the URL will be\n *                                returned to the service list.\n *\n * Description: Add Service to the table.\n *\n * Return: int\n ******************************************************************************/\nint addServiceTable(\n\tIXML_Node *node, service_table *in, const char *DefaultURLBase)\n{\n\tIXML_Node *root = NULL;\n\tIXML_Node *URLBase = NULL;\n\tservice_info *tempEnd = NULL;\n\n\tif (in->URLBase) {\n\t\tfree(in->URLBase);\n\t\tin->URLBase = NULL;\n\t}\n\tif (getSubElement(\"root\", node, &root)) {\n\t\tif (getSubElement(\"URLBase\", root, &URLBase)) {\n\t\t\tin->URLBase = getElementValue(URLBase);\n\t\t} else {\n\t\t\tif (DefaultURLBase) {\n\t\t\t\tin->URLBase =\n\t\t\t\t\tixmlCloneDOMString(DefaultURLBase);\n\t\t\t} else {\n\t\t\t\tin->URLBase = ixmlCloneDOMString(\"\");\n\t\t\t}\n\t\t}\n\t\tif ((in->endServiceList->next = getAllServiceList(\n\t\t\t     root, in->URLBase, &tempEnd))) {\n\t\t\tin->endServiceList = tempEnd;\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\n/************************************************************************\n * Function : getServiceTable\n *\n * Parameters :\n * \tIXML_Node *node ;\tXML node information\n *\tservice_table *out ;\toutput parameter which will contain the\n *\t\t\t\tservice list and URL\n *\tconst char *DefaultURLBase ; Default base URL on which the URL\n *\t\t\t\twill be returned.\n *\n * Description : Retrieve service from the table\n *\n * Return : int ;\n *\n * Note :\n ************************************************************************/\nint getServiceTable(\n\tIXML_Node *node, service_table *out, const char *DefaultURLBase)\n{\n\tIXML_Node *root = NULL;\n\tIXML_Node *URLBase = NULL;\n\n\tif (getSubElement(\"root\", node, &root)) {\n\t\tif (getSubElement(\"URLBase\", root, &URLBase)) {\n\t\t\tout->URLBase = getElementValue(URLBase);\n\t\t} else {\n\t\t\tif (DefaultURLBase) {\n\t\t\t\tout->URLBase =\n\t\t\t\t\tixmlCloneDOMString(DefaultURLBase);\n\t\t\t} else {\n\t\t\t\tout->URLBase = ixmlCloneDOMString(\"\");\n\t\t\t}\n\t\t}\n\t\tout->serviceList = getAllServiceList(\n\t\t\troot, out->URLBase, &out->endServiceList);\n\t\tif (out->serviceList) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\t#endif /* EXCLUDE_GENA */\n\n#endif /* INCLUDE_DEVICE_APIS */\n"], "filenames": ["ChangeLog", "upnp/src/genlib/service_table/service_table.c"], "buggy_code_start_loc": [3, 285], "buggy_code_end_loc": [3, 333], "fixing_code_start_loc": [4, 285], "fixing_code_end_loc": [10, 337], "type": "CWE-476", "message": "Portable UPnP SDK (aka libupnp) 1.12.1 and earlier allows remote attackers to cause a denial of service (crash) via a crafted SSDP message due to a NULL pointer dereference in the functions FindServiceControlURLPath and FindServiceEventURLPath in genlib/service_table/service_table.c.", "other": {"cve": {"id": "CVE-2020-13848", "sourceIdentifier": "cve@mitre.org", "published": "2020-06-04T20:15:12.050", "lastModified": "2021-03-08T01:15:12.977", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "Portable UPnP SDK (aka libupnp) 1.12.1 and earlier allows remote attackers to cause a denial of service (crash) via a crafted SSDP message due to a NULL pointer dereference in the functions FindServiceControlURLPath and FindServiceEventURLPath in genlib/service_table/service_table.c."}, {"lang": "es", "value": "Portable UPnP SDK (tambi\u00e9n se conoce como libupnp) versiones 1.12.1 y anteriores, permite a atacantes remotos causar una denegaci\u00f3n de servicio (bloqueo) por medio de un mensaje SSDP dise\u00f1ado debido a una desreferencia del puntero NULL en las funciones FindServiceControlURLPath y FindServiceEventURLPath en el archivo genlib/service_table/service_table.c"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "HIGH", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:N/I:N/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "PARTIAL", "baseScore": 5.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 10.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-476"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:libupnp_project:libupnp:*:*:*:*:*:*:*:*", "versionEndIncluding": "1.12.1", "matchCriteriaId": "92BB7079-C245-481E-A592-D88889DC1D95"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:debian:debian_linux:8.0:*:*:*:*:*:*:*", "matchCriteriaId": "C11E6FB0-C8C0-4527-9AA0-CB9B316F8F43"}]}]}], "references": [{"url": "http://lists.opensuse.org/opensuse-security-announce/2020-06/msg00030.html", "source": "cve@mitre.org"}, {"url": "http://lists.opensuse.org/opensuse-security-announce/2020-06/msg00033.html", "source": "cve@mitre.org"}, {"url": "https://github.com/pupnp/pupnp/commit/c805c1de1141cb22f74c0d94dd5664bda37398e0", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/pupnp/pupnp/issues/177", "source": "cve@mitre.org", "tags": ["Third Party Advisory"]}, {"url": "https://lists.debian.org/debian-lts-announce/2020/06/msg00006.html", "source": "cve@mitre.org", "tags": ["Mailing List", "Third Party Advisory"]}, {"url": "https://lists.debian.org/debian-lts-announce/2021/03/msg00007.html", "source": "cve@mitre.org"}]}, "github_commit_url": "https://github.com/pupnp/pupnp/commit/c805c1de1141cb22f74c0d94dd5664bda37398e0"}}