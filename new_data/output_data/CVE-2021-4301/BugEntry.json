{"buggy_code": ["<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\n// ----------------------------------------------------------------\n// obligate check for phpwcms constants\nif (!defined('PHPWCMS_ROOT')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n// ----------------------------------------------------------------\n\n// build the database table prepend part\ndefine ('DB_PREPEND', empty($GLOBALS['phpwcms'][\"db_prepend\"]) ? '' : $GLOBALS['phpwcms'][\"db_prepend\"].'_');\n\n// Log DB errors\ndefine ('DB_LOG_ERRORS', empty($GLOBALS['phpwcms'][\"db_errorlog\"]) ? false : true);\n\n// open the connection to MySQL database\nif(!empty($GLOBALS['phpwcms'][\"db_pers\"]) && substr($GLOBALS['phpwcms'][\"db_host\"], 0, 2) !== 'p:') {\n    $GLOBALS['phpwcms'][\"db_host\"] = 'p:'.$GLOBALS['phpwcms'][\"db_host\"];\n}\n$GLOBALS['db'] = mysqli_connect($GLOBALS['phpwcms'][\"db_host\"], $GLOBALS['phpwcms'][\"db_user\"], $GLOBALS['phpwcms'][\"db_pass\"], $GLOBALS['phpwcms'][\"db_table\"]);\n\n$is_mysql_error = mysqli_connect_error() ? basename($_SERVER[\"SCRIPT_FILENAME\"]) : false;\n$GLOBALS['phpwcms']['db_version'] = 'unknown';\n\nif($is_mysql_error === false) {\n\n    // set DB to compatible mode\n    // for compatibility issues try to check for MySQL version and charset\n    $GLOBALS['phpwcms']['db_version'] = _dbInitialize();\n    define('PHPWCMS_DB_VERSION', $GLOBALS['phpwcms']['db_version']);\n\n} elseif($is_mysql_error !== 'dbdown.php') {\n\n    headerRedirect(PHPWCMS_URL.'dbdown.php', 503, false); // keep session\n\n} else {\n\n    define('PHPWCMS_DB_VERSION', $GLOBALS['phpwcms']['db_version']);\n\n}\n\n// deprecated function for escaping db items\nfunction aporeplace($value='') {\n    return mysqli_real_escape_string($GLOBALS['db'], $value);\n}\n\nfunction _dbSelect($db_table='') {\n\n    if(empty($db_table)) {\n        $db_table = $GLOBALS['phpwcms'][\"db_table\"];\n    }\n\n    if(isset($GLOBALS['phpwcms'][\"db_table_selected\"]) && $GLOBALS['phpwcms'][\"db_table_selected\"] === $db_table) {\n        return true;\n    }\n\n    // Set current selected DB Table\n    $GLOBALS['phpwcms'][\"db_table_selected\"] = $db_table;\n\n    return mysqli_select_db($GLOBALS['db'], $db_table);\n\n}\n\nfunction _dbQuery($query='', $_queryMode='ASSOC') {\n\n    if(empty($query)) {\n        return false;\n    }\n\n    $queryResult = array();\n    $queryCount  = 0;\n\n    if($result = mysqli_query($GLOBALS['db'], $query)) {\n\n        switch($_queryMode) {\n\n            // INSERT, UPDATE, DELETE\n            case 'INSERT':\n                $queryResult['INSERT_ID'] = mysqli_insert_id($GLOBALS['db']);\n                // do not break here, go on\n            case 'DELETE':\n            case 'UPDATE':\n                $queryResult['AFFECTED_ROWS'] = mysqli_affected_rows($GLOBALS['db']);\n                return $queryResult;\n\n            // INSERT ... ON DUPLICATE KEY\n            case 'ON_DUPLICATE':\n                $queryResult['AFFECTED_ROWS'] = mysqli_affected_rows($GLOBALS['db']);\n                $queryResult['INSERT_ID'] = mysqli_insert_id($GLOBALS['db']);\n                if($queryResult['AFFECTED_ROWS'] == 2) {\n                    $queryResult['INSERT_ID'] = 0;\n                    $queryResult['AFFECTED_ROWS'] = 1;\n                }\n                return $queryResult;\n\n            // SELECT Queries\n            case 'ROW':\n                $_queryMode = 'mysqli_fetch_row';\n                break;\n\n            case 'ARRAY':\n                $_queryMode = 'mysqli_fetch_array';\n                break;\n\n            // COUNT\n            case 'COUNT':\n                // first check if SQL COUNT() is used\n                $query = substr(strtoupper($query), 0, 30);\n                if(strpos($query, 'SELECT COUNT(') !== false) {\n                    $row = mysqli_fetch_row($result);\n                    return $row ? (int) $row[0] : 0;\n                }\n                return mysqli_num_rows($result);\n\n            // SET, CREATE, ALTER, DROP, RENAME, TRUNCATE\n            case 'RENAME':\n            case 'DROP':\n            case 'ALTER':\n            case 'SET':\n            case 'TRUNCATE':\n            case 'CREATE':\n                return true;\n\n            // send SHOW query and count results\n            case 'COUNT_SHOW':\n                return mysqli_num_rows($result);\n\n            default:\n                $_queryMode = 'mysqli_fetch_assoc';\n        }\n\n        while($row = $_queryMode($result)) {\n            $queryResult[$queryCount] = $row;\n            $queryCount++;\n        }\n\n        if (!is_bool($result)) {\n            mysqli_free_result($result);\n        }\n\n        return $queryResult;\n\n    }\n\n    _dbLogError(_dbError('LOG', $query));\n    return false;\n}\n\nfunction _dbCount($query='') {\n    return _dbQuery($query, 'COUNT');\n}\n\n// function for simplified insert\nfunction _dbInsert($table='', $data=array(), $special='', $prefix=null) {\n\n    if(empty($table)) {\n        return false;\n    }\n\n    if(!is_array($data) || !count($data)) {\n        return false;\n    }\n\n    $table  = (is_string($prefix) ? $prefix : DB_PREPEND).$table;\n    $fields = array();\n    $values = array();\n    $x      = 0;\n\n    foreach($data as $key => $value) {\n        $fields[$x] = '`'.$key.'`';\n        $values[$x] = _dbEscape($value);\n        $x++;\n    }\n\n    if($special) {\n        $special = strtoupper(trim($special));\n        if($special != 'LOW_PRIORITY' || $special != 'DELAYED') {\n            $special = 'DELAYED';\n        }\n        $special .= ' ';\n    }\n\n    $query  = 'INSERT '.$special.'INTO ' . $table . ' (';\n    $query .= implode(',', $fields) . ') VALUES (' . implode(',', $values) . ')';\n\n    return _dbQuery($query, 'INSERT');\n\n}\n\nfunction _dbInsertOrUpdate($table='', $data=array(), $where='', $prefix=null) {\n\n    // INSERT ... ON DUPLICATE KEY UPDATE is available for MySQL >= 4.1.0\n    // $where is necessary OR if $where is empty first array $data element\n    // have to be the primary OR a unique key otherwise this will fail\n\n    if(empty($table)) {\n        return false;\n    }\n\n    if(!is_array($data) || !count($data)) {\n        return false;\n    }\n\n    $table  = (is_string($prefix) ? $prefix : DB_PREPEND).$table;\n    $fields = array();\n    $values = array();\n    $set    = array();\n    $x      = 0;\n\n    foreach($data as $key => $value) {\n        $fields[$x] = '`'.$key.'`';\n        $values[$x] = _dbEscape($value);\n        $set[$x]    = $fields[$x].'='.$values[$x];\n        $x++;\n    }\n\n    $insert  = 'INSERT INTO ' . $table . ' (' . implode(',', $fields) . ') VALUES (' . implode(',', $values) . ')';\n    $insert .= ' ON DUPLICATE KEY UPDATE ' . implode(',', $set);\n\n    return _dbQuery($insert, 'ON_DUPLICATE');\n\n}\n\n// simplified db select\nfunction _dbGet($table='', $select='*', $where='', $group_by='', $order_by='', $limit='', $prefix=null, $_queryMode='ASSOC') {\n\n    if(empty($table)) {\n        return false;\n    }\n\n    $table      = (is_string($prefix) ? $prefix : DB_PREPEND).$table;\n    $sets       = array();\n    $select     = trim($select);\n    $limit      = trim($limit);\n    $group_by   = trim($group_by);\n    $order_by   = trim($order_by);\n\n    if($select === '') {\n        $select = '*';\n    }\n    if($limit !== '') {\n        if(is_int($limit)) {\n            $limit = ' LIMIT ' . $limit;\n        } else {\n            $limit = explode(',', $limit);\n            $limit[0] = intval(trim($limit[0]));\n            $limit[1] = isset($limit[1]) ? intval(trim($limit[1])) : 0;\n            if($limit[0] && $limit[1]) {\n                $limit = ' LIMIT ' . $limit[0] . ',' . $limit[1];\n            } elseif($limit[0] === 0 && $limit[1]) {\n                $limit = ' LIMIT ' . $limit[1];\n            } elseif($limit[0]) {\n                $limit = ' LIMIT ' . $limit[0];\n            } else {\n                $limit = '';\n            }\n        }\n    }\n    if($group_by !== '') {\n        $group_by = ' GROUP BY '._dbEscape($group_by, false);\n    } else {\n        $group_by = '';\n    }\n\n    if($order_by !== '') {\n        $order_by = ' ORDER BY '._dbEscape($order_by, false);\n    } else {\n        $order_by = '';\n    }\n\n    if($where != '') {\n        $where = trim($where);\n        if( substr(strtoupper($where), 0, 5) !== 'WHERE' ) {\n            $where = 'WHERE '.$where;\n        }\n        $where = ' '.$where;\n    }\n\n    $query = trim( 'SELECT ' . $select . ' FROM ' . $table . $where . $group_by . $order_by . $limit);\n\n    return _dbQuery($query, $_queryMode);\n}\n\n// function for simplified update\nfunction _dbUpdate($table='', $data=array(), $where='', $special='', $prefix=null) {\n\n    if(empty($table)) {\n        return false;\n    }\n\n    if(!is_array($data) || !count($data)) {\n        return false;\n    }\n\n    $table  = (is_string($prefix) ? $prefix : DB_PREPEND).$table;\n    $sets   = array();\n\n    foreach($data as $key => $value) {\n        $sets[] = '`'.$key.'`=' . _dbEscape($value);\n    }\n\n    if($special) {\n        $special = strtoupper(trim($special));\n        if($special != 'LOW_PRIORITY') $special = 'LOW_PRIORITY';\n        $special .= ' ';\n    }\n\n    if($where != '') {\n        $where = trim($where);\n        if( substr(strtoupper($where), 0, 5) !== 'WHERE' ) {\n            $where = 'WHERE '.$where;\n        }\n    }\n\n    $query = trim( 'UPDATE ' . $special . $table . ' SET ' . implode(',', $sets) . ' ' . $where );\n\n    return _dbQuery($query, 'UPDATE');\n\n}\n\nfunction _dbGetCreateCharsetCollation() {\n\n    $value = '';\n    if($GLOBALS['phpwcms']['db_charset']) {\n        $value .= ' DEFAULT';\n        $value .= ' CHARACTER SET '.$GLOBALS['phpwcms']['db_charset'];\n        if(!empty($GLOBALS['phpwcms']['db_collation'])) {\n            $value .= ' COLLATE '.$GLOBALS['phpwcms']['db_collation'];\n        }\n    }\n\n    return $value;\n}\n\nfunction _dbError($error_type='DB', $query='') {\n\n    $error = mysqli_error($GLOBALS['db']);\n\n    if($query) {\n        $query  = str_replace(',', \",\\n\", $query);\n        switch($error_type) {\n            case 'LOG':\n                $error  .= ', QUERY: \"' . $query . '\"';\n                break;\n            default:\n                $error .= '<pre>' . $query .'</pre>';\n        }\n    }\n\n    return $error;\n}\n\nfunction _dbErrorNum() {\n\n    return mysqli_errno($GLOBALS['db']);\n\n}\n\nfunction _dbLogError($log_msg='') {\n\n    if(DB_LOG_ERRORS && $log_msg) {\n\n        if(@is_dir(PHPWCMS_LOGDIR)) {\n            $log_msg = '[' . date('Y-m-d H:i:s') . '] ' . $log_msg . LF;\n\n            @file_put_contents(PHPWCMS_LOGDIR . '/phpwcms_db_error.log', $log_msg, FILE_APPEND);\n        }\n\n    }\n\n}\n\nfunction _dbInitialize() {\n\n    $mysql_set = array();\n\n    if(isset($GLOBALS['phpwcms']['db_sql_mode']) && is_string($GLOBALS['phpwcms']['db_sql_mode'])) {\n        $mysql_set['mode'] = 'SESSION sql_mode = '._dbEscape($GLOBALS['phpwcms']['db_sql_mode']);\n    }\n\n    if(empty($GLOBALS['phpwcms']['db_charset'])) {\n        $mysql_charset_map = array(\n            'big5'         => 'big5',   'cp-866'       => 'cp866',  'euc-jp'       => 'ujis',\n            'euc-kr'       => 'euckr',  'gb2312'       => 'gb2312', 'gbk'          => 'gbk',\n            'iso-8859-1'   => 'latin1', 'iso-8859-2'   => 'latin2', 'iso-8859-7'   => 'greek',\n            'iso-8859-8'   => 'hebrew', 'iso-8859-8-i' => 'hebrew', 'iso-8859-9'   => 'latin5',\n            'iso-8859-13'  => 'latin7', 'iso-8859-15'  => 'latin1', 'koi8-r'       => 'koi8r',\n            'shift_jis'    => 'sjis',   'tis-620'      => 'tis620', 'utf-8'        => 'utf8',\n            'windows-1250' => 'cp1250', 'windows-1251' => 'cp1251', 'windows-1252' => 'latin1',\n            'windows-1256' => 'cp1256', 'windows-1257' => 'cp1257'\n        );\n        $GLOBALS['phpwcms']['db_charset'] = isset($mysql_charset_map[PHPWCMS_CHARSET]) ? $mysql_charset_map[PHPWCMS_CHARSET] : 'utf8';\n    }\n\n    mysqli_set_charset($GLOBALS['db'], $GLOBALS['phpwcms']['db_charset']);\n\n    if(!empty($GLOBALS['phpwcms']['db_collation'])) {\n        $mysql_set['COLLATION'] = 'collation_connection = ' . _dbEscape($GLOBALS['phpwcms']['db_collation']);\n    }\n\n    if(!empty($GLOBALS['phpwcms']['db_timezone'])) {\n        $mysql_set['time_zone'] = 'time_zone = '._dbEscape($GLOBALS['phpwcms']['db_timezone']);\n    }\n\n    if(count($mysql_set)) {\n        _dbQuery('SET '.implode(', ', $mysql_set), 'SET');\n    }\n\n    return mysqli_get_server_info($GLOBALS['db']);\n}\n\n// duplicate a DB record based on 1 unique column\nfunction _dbDuplicateRow($table='', $unique_field='', $id_value=0, $exception=array(), $prefix=null) {\n\n    // use exceptions to define duplicate values: 'field_name' => 'value' (INT/STRING)\n    // to avoid problems with UNIQUE/auto increment columns set 'field_name' => '--UNIQUE--'\n    // to overwrite a unique value use excpetions 'unique_field_name' => 'new_value'\n    // to use simple SQL functions for exceptions define it like 'field_name' => 'SQL:NOW()'\n    // for simple string operations use '--SELF--' like 'field_name' => 'Copy --SELF--'\n    // --SELF-- will be replaced by current value of the field\n\n    if(empty($table) || empty($unique_field) || empty($id_value)) {\n        return false;\n    }\n\n    if(!is_array($exception)) {\n        $exception = array();\n    }\n\n    $table = (is_string($prefix) ? $prefix : DB_PREPEND) . $table;\n\n    $where_value = is_string($id_value) ? _dbEscape($id_value) : $id_value;\n    $row = _dbQuery('SELECT * FROM '.$table.' WHERE '.$unique_field.'='.$where_value.' LIMIT 1');\n\n    // check against result\n    if(isset($row[0]) && is_array($row[0]) && count($row[0])) {\n        $row = $row[0];\n        unset($row[$unique_field]);\n    } else {\n        return false;\n    }\n\n    // check eceptions\n    foreach($exception as $key => $value) {\n        if(isset($row[$key])) {\n            if($value === '--UNIQUE--') {\n                unset($row[$key]);\n            } else {\n                if(is_string($value) && strpos($value, '--SELF--') !== false) {\n                    $value = str_replace('--SELF--', $row[$key], $value);\n                }\n                $row[$key] = $value;\n            }\n        }\n    }\n\n    $_VALUE = array();\n    $_SET   = array();\n    $c      = 0;\n\n    // build INSERT query\n    foreach($row as $key => $value) {\n        $_VALUE[$c] = $key;\n        if(is_string($value)) {\n            if(strpos($value, 'SQL:') === 0) {\n                $_SET[$c] = str_replace('SQL:', '', $value);\n            } else {\n                $_SET[$c] = _dbEscape($value);\n            }\n        } else {\n            $_SET[$c] = _dbEscape($value);\n        }\n        $c++;\n    }\n\n    $sql = 'INSERT INTO ' . $table . ' (' . implode(', ', $_VALUE) . ') VALUES (' . implode(', ', $_SET) . ')';\n\n    $new_id = _dbQuery($sql, 'INSERT');\n\n    if(!empty($new_id['INSERT_ID'])) {\n\n        // fine - auto increment returns new ID\n        return $new_id['INSERT_ID'];\n\n    } elseif(isset($new_id['INSERT_ID']) && $new_id['INSERT_ID'] === 0) {\n\n        // hm - maybe no auto increment - but insert was done\n        // so lets check against $unique_field and its possible new value\n        if(!empty($exception[$unique_field]) && $exception[$unique_field] != '__UNIQUE__') {\n            return $exception[$unique_field];\n        }\n\n    }\n\n    return false;\n}\n\n/*\n * Set Config - store given key/value in config database\n *\n * 2008/03/13 Thiemo M\u00e4ttig, fixed for MySQL 4.0, use _dbInsertOrUpdate()\n */\nfunction _setConfig($key, $value=null, $group='', $status=1) {\n\n    $time       = now();\n    $group      = trim($group);\n    $status     = intval($status);\n\n    if (! is_array($key)) {\n        $key = array($key => $value);\n    }\n\n    foreach($key as $k => $value) {\n\n        if( is_string($value) ) {\n            $vartype = 'string';\n        } elseif( is_int($value) ) {\n            $vartype = 'int';\n        } elseif( is_float($value) ) {\n            $vartype = 'float';\n        } elseif( is_bool($value) ) {\n            $vartype = 'bool';\n        } elseif( is_array($value) ) {\n            $vartype = 'array';\n            $value   = serialize($value);\n        } elseif( is_object($value) ) {\n            $vartype = 'object';\n            $value   = serialize($value);\n        } else {\n            $vartype = '';\n            $value   = '';\n        }\n\n        $data = array(\n            'sysvalue_key' => $k,\n            'sysvalue_group' => $group,\n            'sysvalue_lastchange' => $time,\n            'sysvalue_status' => $status,\n            'sysvalue_vartype' => $vartype,\n            'sysvalue_value' => $value\n        );\n\n        if ( ! _dbInsertOrUpdate('phpwcms_sysvalue', $data) ) {\n            $mysql_error = _dbError();\n            trigger_error(\"_setConfig failed\".(empty($mysql_error) ? '' : ' with MySQL error: '.$mysql_error), E_USER_WARNING);\n        }\n\n    }\n\n    return true;\n}\n\nfunction _dbEscape($value='', $quoted=true, $prefix='', $suffix='') {\n    if(!is_string($value) && !is_numeric($value)) {\n        if(is_array($value) || is_object($value)) {\n            $value = serialize($value);\n            $prefix = '';\n            $suffix = '';\n        } elseif(is_bool($value)) {\n            return $value ? 'true' : 'false';\n        } elseif(is_null($value)) {\n            return 'NULL';\n        } else {\n            $value = strval($value);\n        }\n    }\n    $value = $prefix . mysqli_real_escape_string($GLOBALS['db'], $value) . $suffix;\n\n    return $quoted === true ? \"'\" . $value . \"'\" : $value;\n}\n\n/*\n * Get Config - retrieve Config value from database\n *\n * If $key is string, single value will be returned.\n * If $key given as array - array containing values will be returned.\n * If $set_global is set config value will be registered in $GLOBALS[$set_global],\n * set $set_global = false and var will not be registered in $GLOBALS\n */\nfunction _getConfig($key, $set_global='phpwcms') {\n    $return = 'array';\n    $string = '';\n    if(is_string($key)) {\n        if($set_global && isset($GLOBALS[$set_global][$key])) {\n            return $GLOBALS[$set_global][$key];\n        }\n        $return = 'value';\n        $string = $key;\n        $key = array($key);\n    }\n    if(is_array($key) && count($key)) {\n        $result = array();\n        foreach($key as $value) {\n            if($set_global && isset($GLOBALS[$set_global][$value])) {\n                $result[ $value ] = $GLOBALS[$set_global][$value];\n                continue;\n            }\n            $sql = 'SELECT * FROM '.DB_PREPEND.\"phpwcms_sysvalue WHERE sysvalue_status=1 AND sysvalue_key='\".mysqli_real_escape_string($GLOBALS['db'], $value).\"'\";\n            $row = _dbQuery($sql);\n            if(isset($row[0]['sysvalue_vartype'])) {\n                switch($row[0]['sysvalue_vartype']) {\n                    case 'string':  $result[ $value ] = (string) $row[0]['sysvalue_value'];                 break;\n                    case 'int':     $result[ $value ] = (int) $row[0]['sysvalue_value'];                    break;\n                    case 'float':   $result[ $value ] = (float) $row[0]['sysvalue_value'];                  break;\n                    case 'bool':    $result[ $value ] = (bool) $row[0]['sysvalue_value'];                   break;\n                    case 'array':   $result[ $value ] = (array) @unserialize($row[0]['sysvalue_value']);    break;\n                    case 'object':  $result[ $value ] = (object) @unserialize($row[0]['sysvalue_value']);   break;\n                    default:        $result[ $value ] = $row[0]['sysvalue_value'];\n                }\n            }\n        }\n        if($set_global && count($result)) {\n            foreach($result as $key => $value) {\n                $GLOBALS[$set_global][$key] = $result[$key];\n            }\n        }\n        if($return === 'array') {\n            return $result;\n        } elseif(isset($result[$string])) {\n            return $result[$string];\n        }\n    }\n\n    return false;\n}\n\n/**\n * Set MySQL variable\n *\n * An often seen default value is just 1M for that MySQL variable\n * Serialized data or text can be much bigger than this and\n * MySQL connection can get lost. This fixes this and set it\n * to a global default value of 16M\n */\nfunction _dbSetVar($var='', $value=null, $compare=false) {\n\n    $var = trim($var);\n\n    // stop if this was set yet. can be defined as\n    // additional config value in conf.inc.php\n\n    if(!is_string($var) || !$var || $value === null) {\n\n        return false;\n\n    } elseif(isset($GLOBALS['phpwcms']['mysql_'.$var]) && $GLOBALS['phpwcms']['mysql_'.$var] == $value) {\n\n        return true;\n\n    }\n\n    // check if it is a valid MySQL var\n    $_var       = _dbEscape($var, false);\n    $result     = _dbQuery('SELECT @@'.$_var.' AS mysqlvar');\n    $default    = null;\n\n    if(isset($result[0]['mysqlvar'])) {\n\n        // check if the given MySQL var exists\n        $default = $result[0]['mysqlvar'];\n\n        if($default !== null) {\n\n            $GLOBALS['phpwcms']['mysql_'.$var] = $default;\n\n            switch($compare) {\n\n                case '>':\n                    $set = $default > $value;\n                    break;\n\n                case '<':\n                    $set = $default < $value;\n                    break;\n\n                case '!=':\n                    $set = $default != $value;\n                    break;\n\n                default:\n                    $set = false;\n\n            }\n\n            // change MySQL var setting\n            if($set) {\n\n                $value  = _dbEscape($value, is_numeric($default) ? false : true);\n\n                // try SET SESSION first\n                if(!_dbQuery('SET @@'.$_var.'='.$value, 'SET')) {\n\n                    if(!_dbQuery('SET @@session.'.$_var.'='.$value, 'SET')) {\n\n                        if(!_dbQuery('SET @@global.'.$_var.'='.$value, 'SET')) {\n\n                            return false;\n\n                        }\n\n                    }\n\n                }\n\n                $GLOBALS['phpwcms']['mysql_'.$var] = $value;\n                return true;\n\n            }\n\n        }\n\n    }\n\n    return false;\n}\n\nfunction _dbGetClientInfo() {\n\n    return mysqli_get_client_info();\n\n}", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\ndefine('PHPWCMS_VERSION', '1.9.27-dev');\ndefine('PHPWCMS_RELEASE_DATE', '2021/08/19');\ndefine('PHPWCMS_REVISION', '552');\n", "<?php\n\nif(!empty($step)) {\n\n    if ($step == 1 && $do) {\n\n        if(!empty($_POST['user_account'])) {\n\n            // fine continue with step 2\n            session_write_close();\n            if(!empty($_SERVER['HTTP_HOST']) && !empty($_SERVER['REQUEST_URI'])) {\n                header('Location: http'.(!empty($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) !== 'off' ? 's' : '').'://'.$_SERVER['HTTP_HOST'].dirname($_SERVER['REQUEST_URI']).'/setup.php?step=2');\n            } else {\n                header(\"Location: setup.php?step=2\");\n            }\n            exit();\n        }\n\n\n        //superuser settings\n        if(isset($_POST['admin_name'])) {\n\n            $phpwcms['admin_name']      = empty($_POST['admin_name']) ? $phpwcms['admin_name'] : slweg($_POST['admin_name']);\n            $phpwcms['admin_user']      = empty($_POST['admin_user']) ? $phpwcms['admin_user'] : slweg($_POST['admin_user']);\n\n            if($_POST[\"admin_pass\"] !== $_POST[\"admin_passrepeat\"] || empty($phpwcms[\"admin_pass\"])) {\n                $admin_err_pass         = 1;\n            } elseif(!empty($_POST[\"admin_pass\"])) {\n                $phpwcms[\"admin_pass\"]  = md5(slweg($_POST[\"admin_pass\"]));\n            }\n\n            $phpwcms[\"admin_email\"]     = clean_slweg($_POST[\"admin_email\"]);\n\n            if(empty($admin_err_pass) && empty($_SESSION['admin_save'])) {\n                write_conf_file($phpwcms);\n                $_SESSION['admin_save'] = 1;\n            }\n\n        }\n\n        // main settings\n\n        $phpwcms[\"db_host\"]    = slweg($_POST[\"db_host\"]);\n        $phpwcms[\"db_user\"]    = slweg($_POST[\"db_user\"]);\n        $phpwcms[\"db_pass\"]    = slweg($_POST[\"db_pass\"]);\n        $phpwcms[\"db_table\"]   = slweg($_POST[\"db_table\"]);\n        $phpwcms[\"db_prepend\"] = slweg($_POST[\"db_prepend\"]);\n        $phpwcms[\"db_pers\"]    = empty($_POST[\"db_pers\"]) ? 0 : 1;\n\n        $phpwcms[\"charset\"]         = 'utf-8'; // Fixed\n        $phpwcms['db_charset']      = 'utf8';\n        if (!empty($_POST[\"charset\"])) {\n            $phpwcms['default_lang'] = substr($_POST[\"charset\"], 0, 2);\n            $_collation_warning = false;\n        } elseif (empty($phpwcms['default_lang'])) {\n            $phpwcms['default_lang'] = 'en';\n        }\n        $phpwcms['db_collation']    = 'utf8_general_ci';\n        $db_sql = empty($_POST[\"db_sql\"]) ? 0 : 1;\n\n        write_conf_file($phpwcms);\n        $err = 0;\n\n        $prepend = $phpwcms[\"db_prepend\"];\n\n        if(isset($_POST[\"dbsavesubmit\"])) {\n\n            // make db connect\n            $db_host = $phpwcms[\"db_host\"];\n            if(!empty($phpwcms[\"db_pers\"]) && substr($db_host, 0, 2) !== 'p:') {\n                $db_host = 'p:'.$db_host;\n            }\n            $db = mysqli_connect($db_host, $phpwcms[\"db_user\"], $phpwcms[\"db_pass\"], $phpwcms[\"db_table\"]);\n\n            if($db) {\n\n                if($result = mysqli_query($db, \"SELECT VERSION()\")) {\n\n                    if($row = mysqli_fetch_row($result)) {\n\n                        $phpwcms[\"db_version\"] = $row[0];\n                        write_conf_file($phpwcms);\n\n                    }\n\n                    mysqli_free_result($result);\n\n                    if($result = mysqli_query($db, 'SELECT * FROM '. ($phpwcms[\"db_prepend\"] ? $phpwcms[\"db_prepend\"].'_' : '').'phpwcms_user')) {\n\n                        $_db_prepend_error = true;\n                        mysqli_free_result($result);\n\n                    }\n\n                } else {\n\n                    $err = 1;\n                    $_SESSION['admin_save'] = 0;\n\n                }\n\n\n            } else {\n\n                $err = 1;\n                $_SESSION['admin_save'] = 0;\n\n            }\n\n            // enable additional db settings like collation and charset\n            if(empty($err)) {\n\n                $db_additional = true;\n\n                if(isset($_collation_warning) && $_collation_warning === false) {\n\n                    $db_init = true;\n\n                    if(isset($_POST['db_sql_hidden'])) {\n\n                        if(empty($db_sql)) {\n\n\n                            $_SESSION['admin_set']  = true;\n                            $db_no_create           = true;\n\n                        } else {\n\n                            // now read and display sql queries\n\n                            $_db_prepend = ($phpwcms[\"db_prepend\"] ? $phpwcms[\"db_prepend\"].'_' : '');\n\n                            $sql_data = read_textfile($DOCROOT . '/setup/default_sql/phpwcms_init.sql');\n                            $sql_data = $sql_data . read_textfile($DOCROOT . '/setup/default_sql/phpwcms_inserts.sql');\n                            $sql_data = preg_replace(\"/(#|--).*.\\n/\", '', $sql_data );\n                            $sql_data = preg_replace('/ `phpwcms/', ' `'.$_db_prepend.'phpwcms', $sql_data );\n                            $sql_data = str_replace(\"\\r\", '', $sql_data);\n                            $sql_data = str_replace(\"\\n\\n\", \"\\n\", $sql_data);\n                            $sql_data = trim($sql_data);\n\n                            // if True create initial database\n                            if(isset($_POST['db_create'])) {\n\n                                $db_create_err = array();\n\n                                mysqli_query($db, 'SET storage_engine=MYISAM');\n                                mysqli_query($db, \"SET SQL_MODE=NO_ENGINE_SUBSTITUTION\");\n\n                                $value  = \"SET NAMES '\". mysqli_real_escape_string($db, $phpwcms['db_charset']).\"'\";\n                                $value .= empty($phpwcms['db_collation']) ? '' : \" COLLATE '\".mysqli_real_escape_string($db, $phpwcms['db_collation']).\"'\";\n                                mysqli_query($db, $value);\n\n                                $db_create_sql = explode(';', $sql_data);\n                                foreach($db_create_sql as $key => $value) {\n\n                                    $value = trim($value);\n\n                                    if(empty($value)) {\n                                        unset($db_create_sql[$key]);\n                                        continue;\n                                    }\n\n                                    if(strpos(strtoupper($value), 'INSERT') !== 0) {\n                                        $value .= ' DEFAULT';\n                                        $value .= ' CHARACTER SET '.$phpwcms['db_charset'];\n                                        $value .= ' COLLATE '.$phpwcms['db_collation'];\n                                    }\n\n                                    // send sql query\n                                    if(!mysqli_query($db, $value)) {\n                                        $db_create_err[] = $value;\n                                        unset($db_create_sql[$key]);\n                                    }\n                                }\n\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    if($step == 2 && $do) {\n\n        $phpwcms[\"site\"] = clean_slweg($_POST[\"site\"]);\n\n        $phpwcms['SMTP_FROM_EMAIL'] = clean_slweg($_POST[\"smtp_from_email\"]);\n        if(!$phpwcms['SMTP_FROM_EMAIL']) {\n            $phpwcms['SMTP_FROM_EMAIL'] = $phpwcms[\"admin_email\"];\n        }\n        $phpwcms['SMTP_FROM_NAME'] = clean_slweg($_POST[\"smtp_from_name\"]);\n        if(!$phpwcms['SMTP_FROM_NAME']) {\n            $phpwcms['SMTP_FROM_NAME'] = 'webmaster';\n        }\n        $phpwcms['SMTP_HOST'] = clean_slweg($_POST[\"smtp_host\"]);\n        if(!$phpwcms['SMTP_HOST']) {\n            $phpwcms['SMTP_HOST'] = 'localhost';\n        }\n        $phpwcms['SMTP_PORT'] = intval($_POST[\"smtp_port\"]);\n        if(!$phpwcms['SMTP_PORT']) {\n            $phpwcms['SMTP_PORT'] = 25;\n        }\n        $phpwcms['SMTP_MAILER'] = clean_slweg($_POST[\"smtp_mailer\"]);\n        if(!$phpwcms['SMTP_MAILER']) {\n            $phpwcms['SMTP_MAILER'] = 'mail';\n        }\n        $phpwcms['SMTP_AUTH'] = empty($_POST[\"smtp_auth\"]) ? 0 : 1;\n        $phpwcms['SMTP_USER'] = slweg($_POST[\"smtp_user\"]);\n        $phpwcms['SMTP_PASS'] = slweg($_POST[\"smtp_pass\"]);\n        $phpwcms['SMTP_SECURE'] = clean_slweg($_POST[\"smtp_secure\"]);\n\n        write_conf_file($phpwcms);\n\n        if(!empty($_POST[\"admin_create\"])) {\n            $db = mysqli_connect($phpwcms[\"db_host\"], $phpwcms[\"db_user\"], $phpwcms[\"db_pass\"], $phpwcms[\"db_table\"]);\n            if(mysqli_connect_error()) {\n                $err = 1;\n            } else {\n                mysqli_query($db, \"SET SQL_MODE=NO_AUTO_VALUE_ON_ZERO,NO_ENGINE_SUBSTITUTION\");\n                mysqli_query($db, \"SET NAMES '\".mysqli_real_escape_string($db, $phpwcms[\"charset\"]).\"'\");\n                $phpwcms[\"db_prepend\"] = ($phpwcms[\"db_prepend\"]) ? $phpwcms[\"db_prepend\"].\"_\" : \"\";\n                $sql =  \"INSERT INTO \".$phpwcms[\"db_prepend\"].\"phpwcms_user (usr_login, usr_pass, usr_email, \".\n                        \"usr_admin, usr_aktiv, usr_name, usr_fe, usr_wysiwyg ) VALUES ('\".\n                        mysqli_real_escape_string($db, $phpwcms[\"admin_user\"]).\"', '\".\n                        mysqli_real_escape_string($db, md5($phpwcms[\"admin_pass\"])).\"', '\".\n                        mysqli_real_escape_string($db, $phpwcms[\"admin_email\"]).\"', 1, 1, '\".\n                        mysqli_real_escape_string($db, $phpwcms['SMTP_FROM_NAME']).\"', 2, 2)\";\n\n                mysqli_query($db, $sql) or $err = 1;\n            }\n        }\n\n        if(!$err) {\n            header(\"Location: setup.php?step=3\");\n            exit();\n        }\n    }\n\n    if($step == 3 && $do) {\n\n        $phpwcms['DOC_ROOT']       = clean_slweg($_POST[\"doc_root\"]);\n        $phpwcms[\"root\"]           = clean_slweg($_POST[\"root\"]);\n        $phpwcms[\"file_path\"]      = clean_slweg($_POST[\"file_path\"]);\n        $phpwcms[\"templates\"]      = clean_slweg($_POST[\"templates\"]);\n        $phpwcms[\"ftp_path\"]       = clean_slweg($_POST[\"ftp_path\"]);\n\n        $phpwcms[\"file_path\"]      = ($phpwcms[\"file_path\"]) ? $phpwcms[\"file_path\"] : \"phpwcms_filestorage\";\n        $phpwcms[\"templates\"]      = ($phpwcms[\"templates\"]) ? $phpwcms[\"templates\"] : \"phpwcms_template\";\n        $phpwcms[\"content_path\"]   = ($phpwcms[\"content_path\"]) ? $phpwcms[\"content_path\"] : \"content\";\n        $phpwcms[\"cimage_path\"]    = ($phpwcms[\"cimage_path\"]) ? $phpwcms[\"cimage_path\"] : \"images\";\n        $phpwcms[\"ftp_path\"]       = ($phpwcms[\"ftp_path\"]) ? $phpwcms[\"ftp_path\"] : \"phpwcms_ftp\";\n\n        write_conf_file($phpwcms);\n        header(\"Location: setup.php?step=4\");\n        exit();\n    }\n\n    if($step == 4 && $do) {\n        $phpwcms[\"file_maxsize\"]     = intval($_POST[\"file_maxsize\"]);\n        $phpwcms[\"content_width\"]    = intval($_POST[\"content_width\"]);\n        $phpwcms[\"img_list_width\"]   = intval($_POST[\"img_list_width\"]);\n        $phpwcms[\"img_list_height\"]  = intval($_POST[\"img_list_height\"]);\n        $phpwcms[\"img_prev_width\"]   = intval($_POST[\"img_prev_width\"]);\n        $phpwcms[\"img_prev_height\"]  = intval($_POST[\"img_prev_height\"]);\n        $phpwcms[\"max_time\"]         = intval($_POST[\"max_time\"]);\n        $phpwcms[\"file_maxsize\"]     = ($phpwcms[\"file_maxsize\"]) ? $phpwcms[\"file_maxsize\"] : 2097152;\n        $phpwcms[\"content_width\"]    = ($phpwcms[\"content_width\"]) ? $phpwcms[\"content_width\"] : 538;\n        $phpwcms[\"img_list_width\"]   = ($phpwcms[\"img_list_width\"]) ? $phpwcms[\"img_list_width\"] : 100;\n        $phpwcms[\"img_list_height\"]  = ($phpwcms[\"img_list_height\"]) ? $phpwcms[\"img_list_height\"] : 75;\n        $phpwcms[\"img_prev_width\"]   = ($phpwcms[\"img_prev_width\"]) ? $phpwcms[\"img_prev_width\"] : 538;\n        $phpwcms[\"img_prev_height\"]  = ($phpwcms[\"img_prev_height\"]) ? $phpwcms[\"img_prev_height\"] : 400;\n        $phpwcms[\"max_time\"]         = ($phpwcms[\"max_time\"]) ? $phpwcms[\"max_time\"] : 1800;\n\n        write_conf_file($phpwcms);\n        header(\"Location: setup.php?step=5\");\n        exit();\n    }\n\n}\n", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\n$_SESSION['admin_set'] = false;\n$setup_recommend = true;\n\n?>\n    <h1><span class=\"number\">1.</span> Thanks! You have agreed to the GPL.</h1>\n    <p>Now that you know the <a href=\"http://www.gnu.org/licenses/licenses.html#GPL\"\n                                target=\"_blank\"><strong>licence</strong></a> under\n        which <strong>phpwcms</strong> is released you can continue to install or upgrade <strong>phpwcms</strong>.</p>\n\n    <h1><span class=\"number\">2.</span> Now lets check your server settings</h1>\n    <p>Please proof all information about your system (recommend PHP 7.1+, MySQL 5.5+).</p>\n    <ol>\n        <li>WWW server:\n            <strong><?php echo empty($_SERVER['SERVER_SOFTWARE']) ? 'unavailable' : html_specialchars($_SERVER['SERVER_SOFTWARE']) ?></strong>\n        </li>\n        <li>PHP version: <?php\n\n            echo '<strong>' . html_specialchars(phpversion()) . '</strong>';\n\n            switch (version_compare('5.6', phpversion())) {\n\n                case -1:    // current used PHP is > OK\n                    echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n                    break;\n\n                case  0:    // the same version - HM not recommend\n                    echo '<img src=\"../img/famfamfam/icon_alert.gif\" alt=\"OK\" class=\"icon1\" />';\n                    echo ' (your version of PHP is OK but update to 7.x is recommend)';\n                    $setup_recommend = false;\n                    break;\n\n                case  1:    // false it's older\n                    echo '<img src=\"../img/famfamfam/action_stop.gif\" alt=\"Stop\" class=\"icon1\" />';\n                    echo ' (your version of PHP is too old - it is not recommend to continue)';\n                    $setup_recommend = false;\n                    break;\n            }\n\n            ?></li>\n        <li>MySQLi extension: <?php\n            if (function_exists('mysqli_connect')) {\n                echo '<strong>installed</strong> <img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n            } else {\n                echo '<strong class=\"error\">not installed</strong> <img src=\"../img/famfamfam/action_stop.gif\" alt=\"Stop\" class=\"icon1\" />';\n                $setup_recommend = false;\n            }\n            ?></li>\n        <li>MySQLi client information: <?php\n\n            $mysqlnd = false;\n            $mysql_version = mysqli_get_client_info();\n\n            if (strpos($mysql_version, 'mysqlnd') !== false) {\n                $mysql_version = preg_replace('/^.*?\\s(\\d.+?)\\s.*?$/', '$1', $mysql_version) . ' (client lib)';\n                $mysqlnd = true;\n            }\n\n            echo '<strong>' . $mysql_version . '</strong>';\n\n            $mysql_version = explode('.', preg_replace('/[^0-9.]/', '', str_replace(array('mysqlnd ', ' (client lib)'), '', strtolower($mysql_version))));\n            $mysql_version[0] = (int)$mysql_version[0];\n            $mysql_version[1] = empty($mysql_version[1]) ? 0 : (int)$mysql_version[1];\n\n            if ($mysql_version[0] >= 5 && ($mysql_version[1] >= 1 || $mysqlnd)) {\n\n                // current MySQL isOK\n                echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n            } else {\n\n                // the same version or older\n                echo '<img src=\"../img/famfamfam/action_stop.gif\" alt=\"Stop\" class=\"icon1\" />';\n                echo ' (not supported any longer)';\n\n                $setup_recommend = false;\n            }\n\n            ?></li>\n        <li>PHP settings<a href=\"http://www.php.net/manual/en/security.php\" target=\"_blank\" title=\"PHP Security\"><img\n                    src=\"../img/famfamfam/icon_info.gif\" alt=\"Security risks\" class=\"icon1\" border=\"0\"/></a>\n            <ul>\n                <li><strong>register_globals </strong><?php\n\n                    if (ini_get('register_globals')) {\n                        echo '<strong>On</strong>';\n                        echo '<img src=\"../img/famfamfam/icon_alert.gif\" alt=\"OK\" class=\"icon1\" />';\n                        echo ' (should always be set Off';\n                        echo '<a href=\"http://phpsec.org/projects/guide/1.html#1.3\" target=\"_blank\">';\n                        echo '<img src=\"../img/famfamfam/icon_info.gif\" alt=\"Security risks\" class=\"icon1\" border=\"0\" />';\n                        echo '</a>)';\n                    } else {\n                        echo '<strong>Off</strong>';\n                        echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n                    }\n\n                    ?>\n                </li>\n                <?php if (version_compare(phpversion(), '5.6.0', '<')): ?>\n                    <li><strong>safe_mode </strong><?php\n\n                        if (ini_get('safe_mode')) {\n                            echo '<strong>On</strong>';\n                            echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n                            echo ' (limited permissions, but recommend)';\n                        } else {\n                            echo '<strong>Off</strong>';\n                            echo '<img src=\"../img/famfamfam/icon_alert.gif\" alt=\"Warning\" class=\"icon1\" />';\n                            echo ' (check information about security risks';\n                            echo '<a href=\"http://www.php.net/features.safe-mode\" target=\"_blank\">';\n                            echo '<img src=\"../img/famfamfam/icon_info.gif\" alt=\"Security risks\" class=\"icon1\" border=\"0\" />';\n                            echo '</a>)';\n                        }\n\n                        ?></li>\n                <?php endif; ?>\n\n                <li><?php\n\n                    $_phpinfo = parsePHPModules();\n                    if (isset($_phpinfo['gd']['GD Support']) && $_phpinfo['gd']['GD Support'] == 'enabled' && isset($_phpinfo['gd']['GD Version'])) {\n                        $_phpinfo['gd_version'] = html_specialchars($_phpinfo['gd']['GD Version']);\n                    } else {\n                        $_phpinfo['gd_version'] = 'n.a.';\n                    }\n\n                    echo '<strong>GD';\n\n                    if (function_exists('imagegd2')) {\n                        echo '2</strong> ' . $_phpinfo['gd_version'];\n                        echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"GD2\" class=\"icon1\" />';\n                        $is_gd = true;\n                    } elseif (function_exists('imagegd')) {\n                        echo '1</strong> ' . $_phpinfo['gd_version'];\n                        echo '<img src=\"../img/famfamfam/icon_alert.gif\" alt=\"GD1\" class=\"icon1\" />';\n                        echo ' (GD2 is recommend)';\n                        $is_gd = true;\n                    } else {\n                        echo ' not available</strong>';\n                        echo '<img src=\"../img/famfamfam/action_stop.gif\" alt=\"GD not present\" class=\"icon1\" />';\n                        $is_gd = false;\n                    }\n\n                    if ($is_gd) {\n\n                        $is_gd = array();\n\n                        if (imagetypes() & IMG_GIF) {\n                            $is_gd[] = 'GIF<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"GIF supported\" class=\"icon1\" />';\n                        } else {\n                            $is_gd[] = 'GIF<img src=\"../img/famfamfam/action_stop.gif\" alt=\"GIF not supported\" class=\"icon1\" />';\n                        }\n                        if (imagetypes() & IMG_PNG) {\n                            $is_gd[] = 'PNG<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"PNG supported\" class=\"icon1\" />';\n                        } else {\n                            $is_gd[] = 'PNG<img src=\"../img/famfamfam/action_stop.gif\" alt=\"PNG not supported\" class=\"icon1\" />';\n                        }\n                        if (imagetypes() & IMG_JPG) {\n                            $is_gd[] = 'JPG<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"JPG supported\" class=\"icon1\" />';\n                        } else {\n                            $is_gd[] = 'JPG<img src=\"../img/famfamfam/action_stop.gif\" alt=\"JPG not supported\" class=\"icon1\" />';\n                        }\n\n                        echo '<br />Image types supported: ' . implode('/ ', $is_gd);\n                    }\n\n                    ?></li>\n            </ul>\n        </li>\n    </ol>\n    <p><strong>phpwcms</strong> has\n        automatic image resizing capabilities. This works very well for standard graphics\n        file formats like JPEG, GIF and PNG as long as your PHP installation has built-in\n        support for <a href=\"http://en.wikipedia.org/wiki/GD_Graphics_Library\" target=\"_blank\">GD</a> &#8212; <strong>GD2</strong>\n        with freetype support is always recommend. <strong>Note:</strong> It\n        is not neccessary but recommend that you have installed <a href=\"http://www.imagemagick.org\" target=\"_blank\">ImageMagick</a>\n        and <a href=\"http://www.ghostscript.com/\" target=\"_blank\">GhostScript</a> on\n        your server system which enables image resizing for nearly every\n        graphics file format.</p>\n<?php\n\n// is the setup config file writable\nif (!is_writable($DOCROOT . '/setup/setup.conf.inc.php')) {\n\n    if (!@chmod($DOCROOT . '/setup/setup.conf.inc.php', 0666)) {\n\n        echo errorWarning('The file <i>setup.conf.inc.php</i> in which all values are stored is NOT writable.');\n\n        ?><p>Please correct this problem before you can continue (connect to your account by FTP and permissions to\n            chmod 777).</p>\n        <?php\n\n    }\n} else {\n\n    if (!$setup_recommend) {\n\n        echo '<p class=\"error\">\n\t\t    <img src=\"../img/famfamfam/icon_alert.gif\" alt=\"\" class=\"icon1\" />\n\t\t    <strong>It is not recommend to continue with setup. See the warnings!</strong>\n\t\t</p>';\n    }\n\n    ?>\n    <form action=\"setup.php?step=1\" method=\"post\">\n        <input name=\"Submit\" type=\"submit\" value=\"Start setup of phpwcms\"/>\n        &nbsp;&nbsp;\n        <input name=\"Submit\" type=\"submit\" value=\"Upgrade existing installation\"\n               onclick=\"window.location.href='upgrade.php';return false;\"/>\n    </form>\n    <?php\n}\n", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\n?>\n<h1><span class=\"number\">3.</span> MySQL database settings </h1>\n<?php\nif(isset($_POST[\"dbsavesubmit\"]) && $err) {\n    echo errorWarning('Please proof your database settings!');\n    $_SESSION['admin_set'] = false;\n}\n?>\n<form action=\"setup.php?step=1\" method=\"post\" autocomplete=\"off\">\n        <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n          <tr>\n            <td align=\"right\" class=\"v10\" width=\"120\">MySQL host:&nbsp;</td>\n            <td width=\"270\"><input name=\"db_host\" type=\"text\" class=\"v12\" id=\"db_host\" value=\"<?php echo html_specialchars($phpwcms[\"db_host\"]) ?>\" placeholder=\"localhost\" size=\"30\" style=\"width:300px\" /></td>\n            <td class=\"chatlist\"><em>default: localhost</em></td>\n          </tr>\n           <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n           </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">DB user:&nbsp;</td>\n            <td><input name=\"db_user\" type=\"text\" class=\"v12\" id=\"db_user\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"db_user\"]) ?>\" placeholder=\"database user\" size=\"30\" /></td>\n            <td class=\"chatlist\">&nbsp;</td>\n          </tr>\n           <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n           </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">DB password:&nbsp;</td>\n            <td><input name=\"db_pass\" type=\"text\" class=\"v12\" id=\"db_pass\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"db_pass\"]) ?>\" placeholder=\"database password\" size=\"30\" /></td>\n            <td class=\"chatlist\">&nbsp;</td>\n          </tr>\n           <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n           </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">DB database:&nbsp;</td>\n            <td><input name=\"db_table\" type=\"text\" class=\"v12\" id=\"db_table\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"db_table\"]) ?>\" placeholder=\"database name\" size=\"30\" maxlength=\"255\" /></td>\n            <td class=\"chatlist\"><em>you have to create it <strong>before</strong> setup!!!</em></td>\n          </tr>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n          </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">DB table prefix:&nbsp;</td>\n            <td><input name=\"db_prepend\" type=\"text\" class=\"v12\" id=\"db_prepend\" style=\"width:300px\" value=\"<?php echo html_specialchars($prepend) ?>\" size=\"30\" maxlength=\"10\" /></td>\n            <td class=\"chatlist\"><em>default: none (&quot;&quot;), if filled\n                in it will be <strong>prefix</strong>+<strong>_</strong></em></td>\n          </tr>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"6\" /></td>\n          </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n                <tr>\n                <td><input name=\"db_pers\" type=\"checkbox\" id=\"db_pers\" value=\"1\" <?php echo ($phpwcms[\"db_pers\"]) ? \"checked\" : \"\"; ?> /></td>\n                <td><label for=\"db_pers\" class=\"v12\">&nbsp;use&nbsp;persistent&nbsp;database&nbsp;connection&nbsp;</label></td>\n                </tr>\n            </table></td>\n            <td class=\"chatlist\"><em>it should be safe to enable it</em></td>\n          </tr>\n\n<?php\nif(!empty($db_additional)) {\n\n?>\n    <tr>\n        <td colspan=\"3\" style=\"padding: 10px 0 10px 0;\">\n            <h1>\n                <span class=\"number\">4.</span>\n                Charset &amp; MySQL <span class=\"v11\">(v<?php echo html_specialchars($row[0]) ?>)</span> settings\n                <a href=\"http://dev.mysql.com/doc/refman/4.1/en/charset.html\" target=\"_blank\" title=\"MySQL information\"><img src=\"../img/famfamfam/icon_info.gif\" alt=\"Info\" border=\"0\" class=\"icon\" /></a>\n            </h1>\n        </td>\n    </tr>\n    <tr>\n            <td align=\"right\" class=\"v10\"><a href=\"http://www.w3.org/International/O-HTTP-charset\" target=\"_blank\" title=\"HTTP charset\"><img src=\"../img/famfamfam/icon_info.gif\" alt=\"Info\" border=\"0\" class=\"icon1\" /></a>Charset:&nbsp;</td>\n            <td><select name=\"charset\">\n            <?php\n\n            foreach($available_languages as $key => $value) {\n\n                list(, $_lang_charset)  = explode('-', $value[1], 2);\n                list(, $_lang_en)       = explode('|', $value[0]);\n\n                echo '<option value=\"'.$key.'\"';\n\n                if($key === strtolower(str_replace('-', '', $phpwcms['default_lang']) .'-'. $phpwcms['charset'])) {\n                    echo ' selected=\"selected\"';\n                }\n\n                echo '>';\n                echo empty($value[3]) ? '' : $value[3].' - ';\n                echo ucfirst($_lang_en);\n                echo ' ['.$_lang_charset;\n                if(!empty($mysql_charset_map[$_lang_charset])) {\n                    echo ' / '.$mysql_charset_map[$_lang_charset];\n                }\n                echo ']';\n                echo \"</option>\";\n            }\n\n            ?>\n            </select><input type=\"hidden\" name=\"collation\" value=\"utf8_general_ci\" /></td>\n            <td class=\"chatlist\"></td>\n          </tr>\n\n<?php\n\n}\n\n// now show setting which enables creating database\nif(!empty($db_init)) {\n\n?>\n    <tr><td colspan=\"3\" style=\"padding: 10px 0 10px 0;\"><h1><span class=\"number\">5.</span> Default phpwcms database schema</h1></td></tr>\n<?php\n\n\n\n    if(empty($db_no_create) && !empty($_db_prepend_error) && isset($_POST['db_sql_hidden'])) {\n        echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n        echo errorWarning('phpwcms tables still exists in choosen database. Rename table prefix might help!');\n        echo \"</td></tr>\\n\";\n        $_SESSION['admin_set'] = false;\n    }\n    if(isset($db_create_err) && count($db_create_err)) {\n        echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n        echo errorWarning('Errors while creating initial phpwcms tables. Solve it manually:</b></p><pre class=\"errorBox\">'.html_specialchars(implode(\";\\n\\n\", $db_create_err).';').'</pre><p><b> ');\n        echo \"</td></tr>\\n\";\n\n        $_SESSION['admin_set']  = false;\n        $sql_data               = false;\n        $db_sql                 = false;\n\n    } elseif(isset($db_create_err) || !empty($db_no_create)) {\n\n        // OK fine - initial tables were created without error\n        $_db_prepend = ($phpwcms[\"db_prepend\"] ? $phpwcms[\"db_prepend\"].'_' : '');\n        $check = _dbQuery(\"SHOW TABLES LIKE '\".$_db_prepend.\"phpwcms_%'\");\n\n        if($check && count($check)) {\n\n            $sql_data               = false;\n            $db_sql                 = false;\n            $db_fine                = true;\n\n?>\n      <tr>\n        <td align=\"right\" class=\"v10\">&nbsp;</td>\n        <td colspan=\"2\"><img src=\"../img/famfamfam/icon_accept.gif\" alt=\"Juchu\" class=\"icon1\" /><strong>Fine!</strong> All initial phpwcms tables were created or still exists.<input type=\"hidden\" name=\"db_sql_hidden\" value=\"1\" /></td>\n      </tr>\n<?php\n\n        } else {\n\n            $_SESSION['admin_set']  = false;\n\n            $sql_data               = false;\n            $db_sql                 = false;\n\n            echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n            echo errorWarning('No phpwcms database table exists. Check before you continue!');\n            echo '<input type=\"hidden\" name=\"db_sql_hidden\" value=\"1\" />';\n            echo \"</td></tr>\\n\";\n\n        }\n\n    }\n\n\n    if(empty($db_fine)) {\n        // show info\n\n?>\n      <tr>\n        <td align=\"right\" class=\"v10\">&nbsp;</td>\n        <td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n            <tr>\n            <td><input name=\"db_sql\" type=\"checkbox\" id=\"db_sql\" value=\"1\"<?php if(!empty($db_sql)) echo ' checked=\"checked\"' ?> /></td>\n            <td><label for=\"db_sql\" class=\"v12\">&nbsp;create phpwcms db tables&nbsp;</label><input type=\"hidden\" name=\"db_sql_hidden\" value=\"1\" /></td>\n            </tr>\n        </table></td>\n        <td class=\"chatlist\">&nbsp;</td>\n      </tr>\n\n<?php\n\n    }\n\n    if(!empty($sql_data)) {\n\n        $sql_data = explode(';', $sql_data);\n        $c = 0;\n        foreach($sql_data as $key => $value) {\n\n            $value = trim(preg_replace('/--\\s/', '', trim($value)));\n\n            if(empty($value)) {\n                unset($sql_data[$key]);\n                continue;\n            }\n\n            $value = html_specialchars($value);\n            $value = str_replace(' ', '&nbsp;', $value);\n            $value = nl2br($value);\n\n            $sql_data[$key]  = '<div style=\"margin:0;padding:0 5px 0 5px;';\n            if($c % 2) {\n                $sql_data[$key] .= ';background-color:#F6F8FA;';\n            }\n            $sql_data[$key] .= '\"><p>'.$value;\n\n            if(strpos(strtoupper(trim($value)), 'INSERT') !== 0) {\n                $sql_data[$key] .= ' DEFAULT';\n                $sql_data[$key] .= ' CHARACTER SET '.$phpwcms['db_charset'];\n                $sql_data[$key] .= ' COLLATE '.$phpwcms['db_collation'];\n            }\n\n            $sql_data[$key] .= ';</p></div>';\n            $c++;\n        }\n\n        $sql_data = implode(\"\\n\", $sql_data);\n\n        echo '<tr><td>&nbsp;';\n        if(empty($_db_prepend_error) && isset($_POST['db_sql_hidden'])) {\n            echo '<input type=\"hidden\" name=\"db_create\" value=\"1\" />';\n        }\n        echo '</td><td colspan=\"2\">';\n        echo '<div id=\"license\" style=\"width:550px\">';\n        echo $sql_data;\n        echo \"</div></td></tr>\\n\";\n\n    }\n}\n\n\n//  OK now lets create superuser\nif(!empty($_SESSION['admin_set'])) {\n\n?>\n    <tr><td colspan=\"3\" style=\"padding: 10px 0 10px 0;\"><h1><span class=\"number\">6.</span> Superuser settings</h1></td></tr>\n<?php\n\n    // as long as admin info wasn't written\n    if(empty($_SESSION['admin_save'])) {\n\n?>\n    <tr>\n        <td align=\"right\" class=\"v10\">Name:&nbsp;</td>\n        <td><input name=\"admin_name\" type=\"text\" id=\"admin_name\" class=\"v12\" style=\"width:300px\" value=\"<?php echo empty($phpwcms[\"admin_name\"]) ? \"Webmaster\" : html_specialchars($phpwcms[\"admin_name\"]) ?>\" size=\"30\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;default: Webmaster</em></td>\n    </tr>\n\n    <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n    </tr>\n\n    <tr>\n        <td align=\"right\" class=\"v10\">Admin login:&nbsp;</td>\n        <td><input name=\"admin_user\" type=\"text\" id=\"admin_user\" class=\"v12\" style=\"width:300px\" value=\"<?php echo empty($phpwcms[\"admin_user\"]) ? \"webmaster\" : html_specialchars($phpwcms[\"admin_user\"]) ?>\" size=\"30\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;default: admin </em></td>\n    </tr>\n\n    <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td></tr>\n\n<?php\n    if(!empty($admin_err_pass)) {\n        echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n        echo errorWarning('Invalid password! Password is case senitive, empty password not allowed.');\n        echo \"</td></tr>\\n\";\n    }\n?>\n\n    <tr>\n        <td align=\"right\" class=\"v10\">Admin password:&nbsp;</td>\n        <td><input name=\"admin_pass\" type=\"password\" id=\"admin_pass\" class=\"v12\" style=\"width:300px\" size=\"30\" autocomplete=\"new-password\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;default: phpwcms </em></td>\n    </tr>\n\n    <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n    </tr>\n\n    <tr>\n        <td align=\"right\" class=\"v10\">Repeat password:&nbsp;</td>\n        <td><input name=\"admin_passrepeat\" type=\"password\" id=\"admin_passrepeat\" class=\"v12\" style=\"width:300px\" size=\"30\" autocomplete=\"new-password\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;</em></td>\n    </tr>\n\n    <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n    </tr>\n\n    <tr>\n        <td align=\"right\" class=\"v10\">Admin email:&nbsp;</td>\n        <td><input name=\"admin_email\" type=\"text\" id=\"admin_email\" class=\"v12\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"admin_email\"]) ?>\" size=\"30\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;is used site wide</em></td>\n    </tr>\n<?php\n\n    } else {\n\n        $_db_prepend = ($phpwcms[\"db_prepend\"] ? $phpwcms[\"db_prepend\"].'_' : '');\n\n        //show Info that admin info was saved\n        //and also if stored in database\n\n        $user_check = _dbQuery('SELECT * FROM '.$_db_prepend.\"phpwcms_user WHERE usr_login='\".mysqli_real_escape_string($db, $phpwcms['admin_user']).\"'\");\n\n        if($user_check !== false && count($user_check)) {\n\n            //hm user still exists - so try to update\n            $sql  = \"UPDATE \".$_db_prepend.\"phpwcms_user SET \";\n            $sql .= \"usr_login      = '\".mysqli_real_escape_string($db, $phpwcms['admin_user']).\"', \";\n            $sql .= \"usr_pass       = '\".mysqli_real_escape_string($db, $phpwcms[\"admin_pass\"]).\"', \";\n            $sql .= \"usr_email      = '\".mysqli_real_escape_string($db, $phpwcms[\"admin_email\"]).\"', \";\n            $sql .= \"usr_admin      = 1, \";\n            $sql .= \"usr_aktiv      = 1, \";\n            $sql .= \"usr_name       = '\".mysqli_real_escape_string($db, $phpwcms['admin_name']).\"', \";\n            $sql .= \"usr_lang       = '\".mysqli_real_escape_string($db, $phpwcms['default_lang']).\"', \";\n            $sql .= \"usr_wysiwyg    = 2, \";\n            $sql .= \"usr_fe         = 2 \";\n            $sql .= \"WHERE usr_login='\".mysqli_real_escape_string($db, $phpwcms['admin_user']).\"' LIMIT 1\";\n\n            $update_user = _dbQuery($sql, 'UPDATE');\n\n        } elseif($user_check !== false) {\n\n            //fine lets create new user\n            $sql  = \"INSERT INTO \".$_db_prepend.\"phpwcms_user (\";\n            $sql .= \"usr_login, usr_pass, usr_email, \";\n            $sql .= \"usr_admin, usr_aktiv, usr_name, \";\n            $sql .= \"usr_var_structure, usr_var_publicfile, usr_var_privatefile, \";\n            $sql .= \"usr_lang, usr_wysiwyg, usr_fe, usr_vars\";\n            $sql .= \") VALUES (\";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms['admin_user']).\"', \";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms[\"admin_pass\"]).\"', \";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms[\"admin_email\"]).\"', \";\n            $sql .= \"1, 1, \";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms['admin_name']).\"', \";\n            $sql .= \"'', \";\n            $sql .= \"'', \";\n            $sql .= \"'', \";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms['default_lang']).\"', \";\n            $sql .= \"2, 2, ''\";\n            $sql .= \")\";\n\n            $create_user = _dbQuery($sql, 'INSERT');\n\n        } else {\n\n            $user_check = false;\n\n        }\n\n        echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n\n        if(!empty($create_user)) {\n\n            // update\n            echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"Juchu\" class=\"icon1\" />';\n            echo '<strong>Done!</strong> Account for user <b>'.html_specialchars($phpwcms['admin_user']).'</b> was created.';\n            echo '<input type=\"hidden\" name=\"user_account\" value=\"1\" />';\n\n        }\n\n        if(!empty($update_user)) {\n\n            // update\n            echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"Juchu\" class=\"icon1\" />';\n            echo '<strong>Done!</strong> Account of user <b>'.html_specialchars($phpwcms['admin_user']).'</b> was updated.';\n            echo '<input type=\"hidden\" name=\"user_account\" value=\"1\" />';\n\n        }\n\n        if($user_check === false) {\n\n            // db error\n            echo errorWarning('There is a database problem!');\n            echo '<p>Account for user <b>'.html_specialchars($phpwcms['admin_user']).'</b> was not created or updated.<br />Click <b>continue</b> to try again.</p>';\n            $_SESSION['admin_save'] = false;\n\n        }\n\n        echo '</td></tr>';\n\n    }\n\n}\n\n?>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"15\" /></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\"><input name=\"dbsavesubmit\" type=\"submit\" value=\"Continue\" /></td>\n          </tr>\n</table><input name=\"do\" type=\"hidden\" value=\"1\" /></form>", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\nif ($err) {\n    echo '<p class=\"error\"><b>Check your admin user name and password!</b></p>';\n}\n\n?>\n<h1>7. Path settings </h1>\n<form action=\"setup.php?step=2\" method=\"post\">\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n        <tr>\n            <td align=\"right\" class=\"v10\">site basis:&nbsp;</td>\n            <td><input name=\"site\" type=\"text\" class=\"f11b\" id=\"site\"\n                       value=\"<?php echo html_specialchars($phpwcms[\"site\"]) ?>\" size=\"30\" style=\"width:275px\"\n                       placeholder=\"<?php echo get_url_origin(true); ?>\"></td>\n            <td class=\"chatlist\">\n                <em>&nbsp;current: <?php echo get_url_origin(true); ?></em>\n            </td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td class=\"chatlist\">&nbsp;</td>\n            <td class=\"chatlist\">\n                <em>&nbsp;do NOT add any subdir here like</em><br>\n                <em>&nbsp;<?php echo get_url_origin(true); ?>/wcms/</em>\n            </td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"6\"></td>\n        </tr>\n\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"25\"></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\">Settings for handling email sending in phpwcms</td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"15\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">from/reply-to&nbsp;email:&nbsp;</td>\n            <td><input name=\"smtp_from_email\" type=\"text\" class=\"f11b\" id=\"smtp_from_email\"\n                       value=\"<?php echo ($phpwcms['SMTP_FROM_EMAIL']) ? html_specialchars($phpwcms['SMTP_FROM_EMAIL']) : html_specialchars($phpwcms[\"admin_email\"]) ?>\"\n                       size=\"30\" style=\"width:275px\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: <?php echo html_specialchars($phpwcms[\"admin_email\"]) ?></em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">from/reply-to&nbsp;name:&nbsp;</td>\n            <td><input name=\"smtp_from_name\" type=\"text\" class=\"f11b\" id=\"smtp_from_name\" style=\"width:275px\"\n                       value=\"<?php echo ($phpwcms['SMTP_FROM_NAME']) ? html_specialchars($phpwcms['SMTP_FROM_NAME']) : 'webmaster' ?>\"\n                       size=\"30\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: webmaster</em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">SMTP&nbsp;server:&nbsp;</td>\n            <td><input name=\"smtp_host\" type=\"text\" class=\"f11b\" id=\"smtp_host\"\n                       value=\"<?php echo ($phpwcms['SMTP_HOST']) ? html_specialchars($phpwcms['SMTP_HOST']) : 'localhost' ?>\"\n                       size=\"30\" style=\"width:275px\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: localhost </em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">SMTP&nbsp;port :&nbsp;</td>\n            <td><input name=\"smtp_port\" type=\"text\" class=\"f11b\" id=\"smtp_port\" style=\"width:275px\"\n                       value=\"<?php echo ($phpwcms['SMTP_PORT']) ? intval($phpwcms['SMTP_PORT']) : '25'; ?>\" size=\"30\">\n            </td>\n            <td class=\"chatlist\"><em>&nbsp;default: 25</em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">mail&nbsp;method :&nbsp;</td>\n            <td><select name=\"smtp_mailer\" id=\"smtp_mailer\">\n                    <option value=\"mail\"<?php if (strtolower($phpwcms['SMTP_MAILER']) == 'mail') echo ' selected=\"selected\"'; ?>>\n                        PHP mail()\n                    </option>\n                    <option value=\"smtp\"<?php if (strtolower($phpwcms['SMTP_MAILER']) == 'smtp') echo ' selected=\"selected\"'; ?>>\n                        SMTP\n                    </option>\n                    <option value=\"sendmail\"<?php if (strtolower($phpwcms['SMTP_MAILER']) == 'sendmail') echo ' selected=\"selected\"'; ?>>\n                        UNIX sendmail\n                    </option>\n                </select></td>\n            <td class=\"chatlist\"><em>&nbsp;default: mail (smtp, sendmail) </em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">use&nbsp;SMTP_AUTH :&nbsp;</td>\n            <td><input name=\"smtp_auth\" type=\"checkbox\" id=\"smtp_auth\"\n                       value=\"1\"<?php if (intval($phpwcms['SMTP_AUTH']) == 1) echo ' checked=\"checked\"'; ?> /></td>\n            <td class=\"chatlist\"><em>&nbsp;default: ON </em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">SMTP login:&nbsp;</td>\n            <td><input name=\"smtp_user\" type=\"text\" class=\"f11b\" id=\"smtp_user\"\n                       value=\"<?php echo html_specialchars($phpwcms['SMTP_USER']) ?>\" size=\"30\" style=\"width:275px\">\n            </td>\n            <td class=\"chatlist\">&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">SMTP&nbsp;password:&nbsp;</td>\n            <td><input name=\"smtp_pass\" type=\"text\" class=\"f11b\" id=\"smtp_pass\" style=\"width:275px\"\n                       value=\"<?php echo html_specialchars($phpwcms['SMTP_PASS']) ?>\" size=\"30\"></td>\n            <td class=\"chatlist\">&nbsp;</td>\n        </tr>\n\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n\n        <tr>\n            <td align=\"right\" class=\"v10\">secure connection:&nbsp;</td>\n            <td><select name=\"smtp_secure\" id=\"smtp_secure\">\n                    <option value=\"\"<?php if (empty($phpwcms['SMTP_SECURE'])) echo ' selected=\"selected\"'; ?>>default\n                        (no secure connection)\n                    </option>\n                    <option value=\"ssl\"<?php if (strtolower($phpwcms['SMTP_SECURE']) == 'ssl') echo ' selected=\"selected\"'; ?>>\n                        SSL\n                    </option>\n                    <option value=\"tls\"<?php if (strtolower($phpwcms['SMTP_SECURE']) == 'tls') echo ' selected=\"selected\"'; ?>>\n                        TLS\n                    </option>\n                </select></td>\n            <td>&nbsp;</td>\n        </tr>\n\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"15\"></td>\n        </tr>\n\n        <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\"><input name=\"Submit\" type=\"submit\" class=\"button\" value=\"send site data\"></td>\n        </tr>\n\n    </table>\n    <input name=\"do\" type=\"hidden\" value=\"1\">\n</form>", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\n?>\n<p class=\"title\">phpwcms path settings </p>\n<p>Please check that any path value does NOT begin or end with a slash. I recommend\n  to use the default values. It's the best way for 1st time\n  usage.</p>\n<form action=\"setup.php?step=3\" method=\"post\"><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n  <tr>\n    <td align=\"right\" class=\"v10\">&nbsp;</td>\n    <td colspan=\"2\" class=\"chatlist\">document root of your web account; empty\n      for default value<br><?php echo  html_specialchars($_SERVER['DOCUMENT_ROOT']) ?></td>\n  </tr>\n  <tr>\n    <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n  </tr>\n  <tr>\n    <td align=\"right\" class=\"v10\">root path :&nbsp;</td>\n    <td><input name=\"doc_root\" type=\"text\" class=\"f11b\" id=\"doc_root\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"DOC_ROOT\"]) ?>\" size=\"30\" maxlength=\"100\"></td>\n    <td class=\"chatlist\"><em>&nbsp;default: $_SERVER['DOCUMENT_ROOT'] </em></td>\n  </tr>\n  <tr>\n    <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td>\n  </tr>\n  <tr>\n    <td align=\"right\" class=\"v10\">&nbsp;</td>\n    <td colspan=\"2\" class=\"chatlist\">if you install in another directory than\n      your base webserver root<br />\n      insert the directory name here - most times this is the part after<br>\n      your\n      base URL like http://mysite.com/<strong>phpwcms_root</strong></td>\n  </tr>\n  <tr>\n    <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n  </tr>\n  <tr>\n    <td align=\"right\" class=\"v10\">phpwcms root:&nbsp;</td>\n    <td><input name=\"root\" type=\"text\" class=\"f11b\" id=\"root\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"root\"]) ?>\" size=\"30\" maxlength=\"100\">\n    </td>\n    <td class=\"chatlist\"><em>&nbsp;default: (empty)</em></td>\n  </tr>\n  <tr>\n    <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td>\n  </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">it's recommend to\n              put this directory outside a folder<br />\n              available via web. you can use it like this ../filearchive</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">filestorage:&nbsp;</td>\n            <td><input name=\"file_path\" type=\"text\" class=\"f11b\" id=\"file_path\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"file_path\"]) ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: filearchive </em></td>\n          </tr><tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">here are the template directories located where all<br />template stuff is stored</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">templates:&nbsp;</td>\n            <td><input name=\"templates\" type=\"text\" class=\"f11b\" id=\"templates\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"templates\"]) ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: template</em></td>\n          </tr><tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">this is the directory in which you\n              can upload files for ftp takeover<br />\n              functionality - maybe this\n              can be extended for special user ftp directories.<br />\n              you can also use it like this: ../../myftpdir\n            </td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">ftp&nbsp;takeover:&nbsp;</td>\n            <td><input name=\"ftp_path\" type=\"text\" class=\"f11b\" id=\"ftp_path\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"ftp_path\"]) ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: upload </em></td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"15\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\"><input name=\"Submit\" type=\"submit\" class=\"button\" value=\"send path values\"></td>\n          </tr>\n</table>\n  <input name=\"do\" type=\"hidden\" value=\"1\"></form>", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\n?><p class=\"title\">phpwcms content values</p>\n<form action=\"setup.php?step=4\" method=\"post\"><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">this is the max size of files can\n              be uploaded</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">upload file size:&nbsp;</td>\n            <td><input name=\"file_maxsize\" type=\"text\" class=\"f11b\" id=\"file_maxsize\" style=\"width:125px\" value=\"<?php echo $phpwcms[\"file_maxsize\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: 2 x 1024 x 1024 = 2097152\n                Bytes </em></td>\n          </tr><tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">the width of the frontend main content\n              block<br />\n              base value of creating image lists</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">content width:&nbsp;</td>\n            <td><input name=\"content_width\" type=\"text\" class=\"f11b\" id=\"content_width\" style=\"width:125px\" value=\"<?php echo $phpwcms[\"content_width\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: 538</em></td>\n          </tr>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">width and height of list image thumbnails</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">list image:&nbsp;</td>\n            <td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n              <tr>\n                <td><input name=\"img_list_width\" type=\"text\" class=\"f11b\" id=\"img_list_width\" style=\"width:55px\" value=\"<?php echo $phpwcms[\"img_list_width\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n                <td class=\"v10\">&nbsp;x&nbsp;</td>\n                <td><input name=\"img_list_height\" type=\"text\" class=\"f11b\" id=\"img_list_height\" style=\"width:55px\" value=\"<?php echo $phpwcms[\"img_list_height\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n              </tr>\n            </table></td>\n            <td class=\"chatlist\"><em>&nbsp;default: width 100 x height 75</em></td>\n          </tr><tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">width and height of preview images<br />\n              recommend is to use the same width as main<br />\n              content block - for better quality use larger<br />\n              if the source image is smaller it will not be<br />\n              sized to this larger values</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">preview image:&nbsp;</td>\n            <td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n              <tr>\n                <td><input name=\"img_prev_width\" type=\"text\" class=\"f11b\" id=\"img_prev_width\" style=\"width:55px\" value=\"<?php echo $phpwcms[\"img_prev_width\"] ?>\" size=\"30\" maxlength=\"100\">                </td>\n                <td class=\"v10\">&nbsp;x&nbsp;</td>\n                <td><input name=\"img_prev_height\" type=\"text\" class=\"f11b\" id=\"img_prev_height\" style=\"width:55px\" value=\"<?php echo $phpwcms[\"img_prev_height\"] ?>\" size=\"30\" maxlength=\"100\">                </td>\n              </tr>\n            </table></td>\n            <td class=\"chatlist\"><em>&nbsp;default: width 538 x height 400</em></td>\n          </tr>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">if there is no activities within\n              the backend<br />\n              you will be automaticly logged out after<br />\n              that time (seconds)</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">logout time:&nbsp;</td>\n            <td><input name=\"max_time\" type=\"text\" class=\"f11b\" id=\"max_time\" style=\"width:125px\" value=\"<?php echo $phpwcms[\"max_time\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: 1800 seconds</em></td>\n          </tr>\n \t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"20\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\"><input name=\"Submit\" type=\"submit\" class=\"button\" value=\"send content values\"></td>\n          </tr>\n</table>\n<input name=\"do\" type=\"hidden\" value=\"1\"></form>", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\n\n$_SERVER['DOCUMENT_ROOT'] = $phpwcms['DOC_ROOT'];\n$phpwcms[\"root\"] = !empty($phpwcms[\"root\"]) ? \"/\".$phpwcms[\"root\"] : \"\";\n\n?>\n\n<p><span class=\"title\"><strong>Ready to start phpwcms?</strong> Some &quot;problems&quot;\n    maybe OK - you can check by testing phpwcms installation.</span></p>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n  <tr><?php\n\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"file_path\"]);\n  if($status != 2) {\n  \t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"file_path\"], 0777, $status);\n  }\n\n  ?>\n    <td align=\"right\" class=\"v10\">filestorage:&nbsp;</td>\n\t<td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"file_path\"]) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n    <tr><?php\n\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"file_path\"].'/can_be_deleted');\n  if($status != 2) {\n  \t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"file_path\"].'/can_be_deleted', 0777, $status);\n  }\n\n\n  ?>\n\t<td align=\"right\" class=\"v10\">deleted&nbsp;files:&nbsp;</td>\n\t<td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"file_path\"].'/can_be_deleted') ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"]);\n\n  ?>\n    <td align=\"right\" class=\"v10\">templates:&nbsp;</td>\n    <td<?php echo gib_bg_color($status) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"templates\"]) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status==1 ? 3 : $status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n\n  $template_lang_path = trim($phpwcms[\"templates\"], '/').'/template_lang';\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$template_lang_path);\n  if($status != 2) {\n  \t$status = set_chmod($phpwcms[\"root\"].\"/\".$template_lang_path, 0777, $status);\n  }\n\n  ?>\n    <td align=\"right\" class=\"v10\">template&nbsp;languages:&nbsp;</td>\n    <td<?php echo gib_bg_color($status) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($template_lang_path) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"ftp_path\"]);\n  if($status != 2) {\n  \t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"ftp_path\"], 0777, $status);\n  }\n\n  ?>\n    <td align=\"right\" class=\"v10\">ftp&nbsp;takeover:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"ftp_path\"]) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"8\"></td></tr>\n  <tr><?php\t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"]);\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;content:&nbsp;</td>\n    <td<?php echo gib_bg_color($status) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"]) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status==1 ? 3 : $status) ?></td>\n  </tr>\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/images\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/images\", 0777, $status);\n  \t}\n\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;images:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/images\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/form\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/form\", 0777, $status);\n  \t}\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;form:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/form\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/tmp\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/tmp\", 0777, $status);\n  \t}\n\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;tmp:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/tmp\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/rss\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/rss\", 0777, $status);\n  \t}\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;rss:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/rss\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/pages\");\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;pages:&nbsp;</td>\n    <td<?php echo gib_bg_color($status) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/pages\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status==1 ? 3 : $status) ?></td>\n  </tr>\n\n       <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"8\"></td></tr>\n  <tr><?php\n  \t$status = check_file_status($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/inc_default/startup.php\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/inc_default/startup.php\", 0666, $status, 1);\n  \t}\n\t?>\n    <td align=\"right\" class=\"v10\">startup text:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<span style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"templates\"].\"/inc_default/startup.php\") ?></span>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n         <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_file_status($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/inc_css/frontend.css\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/inc_css/frontend.css\", 0666, $status, 1);\n  \t}\n\n\t?>\n    <td align=\"right\" class=\"v10\">main CSS file:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<span style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"templates\"].\"/inc_css/frontend.css\") ?></span>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_file_status($phpwcms[\"root\"].\"/include/config/conf.indexpage.inc.php\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/include/config/conf.indexpage.inc.php\", 0666, $status, 1);\n  \t}\n\n\t?>\n    <td align=\"right\" class=\"v10\">index level settings:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<span style=\"color:#fff;\"><?php echo html_specialchars(\"include/config/conf.indexpage.inc.php\") ?></span>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr>\n    <td colspan=\"4\" class=\"v10\">&nbsp;</td>\n  </tr>\n  <tr>\n    <td align=\"right\" class=\"v10\">&nbsp;</td>\n    <td colspan=\"3\"><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n      <tr>\n        <td bgcolor=\"#99CC00\">&nbsp;&nbsp;&nbsp;</td>\n        <td class=\"v10\">&nbsp;OK&nbsp;&nbsp;</td>\n        <td bgcolor=\"#FF3300\">&nbsp;&nbsp;&nbsp;</td>\n        <td class=\"v10\">&nbsp;PROBLEM</td>\n      </tr>\n    </table></td>\n  </tr>\n</table>\n<?php\n\n$this_root = dirname(dirname(dirname(__FILE__)));\n$config_setup = read_textfile($this_root.'/setup/setup.conf.inc.php');\n$config_setup = str_replace('?>', \"\\$NO_ACCESS = true;\\n\\n\", $config_setup);\n$result = false;\nif(!is_file($this_root.'/include/config/conf.inc.php')) {\n\n\t// try to chmod\n\t//set_chmod($phpwcms[\"root\"].\"/include/config',\n\n\t// Try to write config file to the correct position\n\tif(!write_textfile($this_root.'/include/config/conf.inc.php', $config_setup)) {\n\n\t\t// Try to copy\n\t\tif(!@copy($this_root.'/setup/setup.conf.inc.php', $this_root.'/include/config/conf.inc.php')) {\n\n\t\t\t// Try to move\n\t\t\tif(@rename($this_root.'/setup/setup.conf.inc.php', $this_root.'/include/config/conf.inc.php')) {\n\t\t\t\t// moved successfully\n\t\t\t\t$result = true;\n\t\t\t}\n\n\t\t} else {\n\t\t\t// copied successfully\n\t\t\t$result = true;\n\t\t}\n\n\t} else {\n\t\t// written successfully\n\t\t$result = true;\n\t}\n}\n\n// Try to secure setup folder\n@write_textfile($this_root.'/setup/.htaccess', 'Deny from all');\n\nif($result): ?>\n<p style=\"font-weight:bold;color:#99CC00;\">\n\tThe conf.inc.php was created successfully and placed at the right position by the setup script.\n</p>\n<?php else: ?>\n<p style=\"font-weight:bold;color:#FF3300;\">\n\tThe conf.inc.php could not placed at the right position by the setup script.\n</p>\n<?php endif; ?>\n<?php\n// Create default .htaccess\nif(is_file($this_root.'/.htaccess')):\n?>\n<p style=\"font-weight:bold;color:#FF3300;\">\n    A <strong>.htaccess</strong> file exists. Compare against the <a href=\"../_.htaccess\" target=\"_blank\">default</a>.\n    If you want to use segmented URLs it is necessary to configure the Rewrite process.\n</p>\n<?php else:\n    $result = false;\n    // Try to copy\n    if(!@copy($this_root.'/_.htaccess', $this_root.'/.htaccess')) {\n        // Try to move\n        if(@rename($this_root.'/_.htaccess', $this_root.'/.htaccess')) {\n            // moved successfully\n            $result = true;\n        }\n    } else {\n        $result = true;\n    }\n    if($result): ?>\n        <p style=\"font-weight:bold;color:#99CC00;\">\n            A default <strong>.htaccess</strong> file was placed in the document root of your installation.\n            This file usually is hidden because of the leading <strong>.</strong> in the file name.\n            <?php\n            if($phpwcms[\"root\"] && $htaccess = @read_textfile($this_root.'/.htaccess')) {\n                $htaccess = str_replace('RewriteBase /', '#RewriteBase /', $htaccess);\n                $htaccess = str_replace('#RewriteBase /subfolder/', 'RewriteBase /' . trim($phpwcms[\"root\"], '/') . '/', $htaccess);\n                write_textfile($this_root.'/.htaccess', $htaccess);\n            }\n            ?>\n        </p>\n    <?php else: ?>\n        <p style=\"font-weight:bold;color:#FF3300;\">\n            Writing the <strong>.htaccess</strong> file to the document root of your installation failed.\n            If you want to use Rewrite please configure it manually. See the file\n            <a href=\"../_.htaccess\" target=\"_blank\">_.htaccess</a>.\n        </p>\n    <?php endif; ?>\n<?php endif; ?>\n<h4>The manual way to finish setup</h4>\n<p>\n\tDownload the config file <a href=\"get_conf_file.php\"><strong>here</strong></a> and copy it to ./include/config/<strong>conf.inc.php</strong>\n\t&#8212; you can also edit values manually. Maybe you have to rename the file if you download\n\tusing Internet Explorer (name is: <strong>conf.inc.php</strong>). Another possible way is to\n\tconnect to your account by ftp. Then place the file ./setup/<strong>setup.conf.inc.php</strong>  in ./include/config. There you have to delete or rename default conf.inc.php &#8212; then\n\trename setup.conf.inc.php to conf.inc.php. It's not possible to start the setup\n\tprocess again as long the setup folder still exists and if you have downloaded\n\tthe created config file once.<br>\n\t<br>\n\t<strong style=\"color:#FF0000;\">ATTENTION!!!<br>Delete\n\tthe &quot;setup&quot; folder\n\totherwise everybody might see your username, passwords and settings.</strong>\n</p>\n<p>\n\tTo makes changes again or proof your values:<br />\n\t&#8212; <a href=\"setup.php?step=1\">MySQL database infos</a><br />\n\t&#8212; <a href=\"setup.php?step=2\">site infos and admin account</a><br />\n\t&#8212; <a href=\"setup.php?step=3\">path values</a><br />\n\t&#8212; <a href=\"setup.php?step=4\">content values</a>\n</p>\n<p>\n\tPlease check infos about system and PHP version with the requirements. <strong>Very\n    important when you use ImageMagick:</strong> Please check that the system\n    can find the application (paths must be registered to the system - try this\n    by using &quot;convert -version&quot; inside your terminal or command line).\n    Check <a href=\"http://www.imagemagick.org/\" target=\"_blank\">http://www.imagemagick.org</a>\n    for additional information.\n</p>\n"], "fixing_code": ["<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\n// ----------------------------------------------------------------\n// obligate check for phpwcms constants\nif (!defined('PHPWCMS_ROOT')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n// ----------------------------------------------------------------\n\ndefine('DB_LOG_ERRORS', empty($GLOBALS['phpwcms'][\"db_errorlog\"]) ? false : true);\n\n// open the connection to MySQL database\nif(!empty($GLOBALS['phpwcms'][\"db_pers\"]) && substr($GLOBALS['phpwcms'][\"db_host\"], 0, 2) !== 'p:') {\n    $GLOBALS['phpwcms'][\"db_host\"] = 'p:'.$GLOBALS['phpwcms'][\"db_host\"];\n}\n$GLOBALS['db'] = mysqli_connect($GLOBALS['phpwcms'][\"db_host\"], $GLOBALS['phpwcms'][\"db_user\"], $GLOBALS['phpwcms'][\"db_pass\"], $GLOBALS['phpwcms'][\"db_table\"]);\n\n$is_mysql_error = mysqli_connect_error() ? basename($_SERVER[\"SCRIPT_FILENAME\"]) : false;\n$GLOBALS['phpwcms']['db_version'] = 'unknown';\n\nif($is_mysql_error === false) {\n\n    // set DB to compatible mode\n    // for compatibility issues try to check for MySQL version and charset\n    $GLOBALS['phpwcms']['db_version'] = _dbInitialize();\n    define('PHPWCMS_DB_VERSION', $GLOBALS['phpwcms']['db_version']);\n    define('DB_PREPEND', empty($GLOBALS['phpwcms'][\"db_prepend\"]) ? '' : mysqli_real_escape_string($GLOBALS['db'], $GLOBALS['phpwcms'][\"db_prepend\"]) . '_');\n\n} elseif($is_mysql_error !== 'dbdown.php') {\n\n    headerRedirect(PHPWCMS_URL.'dbdown.php', 503, false); // keep session\n\n} else {\n\n    define('PHPWCMS_DB_VERSION', $GLOBALS['phpwcms']['db_version']);\n    define('DB_PREPEND', empty($GLOBALS['phpwcms'][\"db_prepend\"]) ? '' : aporeplace($GLOBALS['phpwcms'][\"db_prepend\"]) . '_');\n\n}\n\n// deprecated function for escaping db items\nfunction aporeplace($value='') {\n    if (!$GLOBALS['db']) {\n        return str_replace(array(\"\\\\\", \"\\x00\", \"\\n\", \"\\r\", \"'\",  '\"', \"\\x1a\"), array(\"\\\\\\\\\", \"\\\\0\", \"\\\\n\", \"\\\\r\", \"\\'\", '\\\"', \"\\\\Z\"), $value);\n    }\n    return mysqli_real_escape_string($GLOBALS['db'], $value);\n}\n\nfunction _dbSelect($db_table='') {\n\n    if(empty($db_table)) {\n        $db_table = $GLOBALS['phpwcms'][\"db_table\"];\n    }\n\n    if(isset($GLOBALS['phpwcms'][\"db_table_selected\"]) && $GLOBALS['phpwcms'][\"db_table_selected\"] === $db_table) {\n        return true;\n    }\n\n    // Set current selected DB Table\n    $GLOBALS['phpwcms'][\"db_table_selected\"] = $db_table;\n\n    return mysqli_select_db($GLOBALS['db'], $db_table);\n\n}\n\nfunction _dbQuery($query='', $_queryMode='ASSOC') {\n\n    if(empty($query)) {\n        return false;\n    }\n\n    $queryResult = array();\n    $queryCount  = 0;\n\n    if($result = mysqli_query($GLOBALS['db'], $query)) {\n\n        switch($_queryMode) {\n\n            // INSERT, UPDATE, DELETE\n            case 'INSERT':\n                $queryResult['INSERT_ID'] = mysqli_insert_id($GLOBALS['db']);\n                // do not break here, go on\n            case 'DELETE':\n            case 'UPDATE':\n                $queryResult['AFFECTED_ROWS'] = mysqli_affected_rows($GLOBALS['db']);\n                return $queryResult;\n\n            // INSERT ... ON DUPLICATE KEY\n            case 'ON_DUPLICATE':\n                $queryResult['AFFECTED_ROWS'] = mysqli_affected_rows($GLOBALS['db']);\n                $queryResult['INSERT_ID'] = mysqli_insert_id($GLOBALS['db']);\n                if($queryResult['AFFECTED_ROWS'] == 2) {\n                    $queryResult['INSERT_ID'] = 0;\n                    $queryResult['AFFECTED_ROWS'] = 1;\n                }\n                return $queryResult;\n\n            // SELECT Queries\n            case 'ROW':\n                $_queryMode = 'mysqli_fetch_row';\n                break;\n\n            case 'ARRAY':\n                $_queryMode = 'mysqli_fetch_array';\n                break;\n\n            // COUNT\n            case 'COUNT':\n                // first check if SQL COUNT() is used\n                $query = substr(strtoupper($query), 0, 30);\n                if(strpos($query, 'SELECT COUNT(') !== false) {\n                    $row = mysqli_fetch_row($result);\n                    return $row ? (int) $row[0] : 0;\n                }\n                return mysqli_num_rows($result);\n\n            // SET, CREATE, ALTER, DROP, RENAME, TRUNCATE\n            case 'RENAME':\n            case 'DROP':\n            case 'ALTER':\n            case 'SET':\n            case 'TRUNCATE':\n            case 'CREATE':\n                return true;\n\n            // send SHOW query and count results\n            case 'COUNT_SHOW':\n                return mysqli_num_rows($result);\n\n            default:\n                $_queryMode = 'mysqli_fetch_assoc';\n        }\n\n        while($row = $_queryMode($result)) {\n            $queryResult[$queryCount] = $row;\n            $queryCount++;\n        }\n\n        if (!is_bool($result)) {\n            mysqli_free_result($result);\n        }\n\n        return $queryResult;\n\n    }\n\n    _dbLogError(_dbError('LOG', $query));\n    return false;\n}\n\nfunction _dbCount($query='') {\n    return _dbQuery($query, 'COUNT');\n}\n\n// function for simplified insert\nfunction _dbInsert($table='', $data=array(), $special='', $prefix=null) {\n\n    if(empty($table)) {\n        return false;\n    }\n\n    if(!is_array($data) || !count($data)) {\n        return false;\n    }\n\n    $table  = (is_string($prefix) ? $prefix : DB_PREPEND).$table;\n    $fields = array();\n    $values = array();\n    $x      = 0;\n\n    foreach($data as $key => $value) {\n        $fields[$x] = '`'.$key.'`';\n        $values[$x] = _dbEscape($value);\n        $x++;\n    }\n\n    if($special) {\n        $special = strtoupper(trim($special));\n        if($special != 'LOW_PRIORITY' || $special != 'DELAYED') {\n            $special = 'DELAYED';\n        }\n        $special .= ' ';\n    }\n\n    $query  = 'INSERT '.$special.'INTO ' . $table . ' (';\n    $query .= implode(',', $fields) . ') VALUES (' . implode(',', $values) . ')';\n\n    return _dbQuery($query, 'INSERT');\n\n}\n\nfunction _dbInsertOrUpdate($table='', $data=array(), $where='', $prefix=null) {\n\n    // INSERT ... ON DUPLICATE KEY UPDATE is available for MySQL >= 4.1.0\n    // $where is necessary OR if $where is empty first array $data element\n    // have to be the primary OR a unique key otherwise this will fail\n\n    if(empty($table)) {\n        return false;\n    }\n\n    if(!is_array($data) || !count($data)) {\n        return false;\n    }\n\n    $table  = (is_string($prefix) ? $prefix : DB_PREPEND).$table;\n    $fields = array();\n    $values = array();\n    $set    = array();\n    $x      = 0;\n\n    foreach($data as $key => $value) {\n        $fields[$x] = '`'.$key.'`';\n        $values[$x] = _dbEscape($value);\n        $set[$x]    = $fields[$x].'='.$values[$x];\n        $x++;\n    }\n\n    $insert  = 'INSERT INTO ' . $table . ' (' . implode(',', $fields) . ') VALUES (' . implode(',', $values) . ')';\n    $insert .= ' ON DUPLICATE KEY UPDATE ' . implode(',', $set);\n\n    return _dbQuery($insert, 'ON_DUPLICATE');\n\n}\n\n// simplified db select\nfunction _dbGet($table='', $select='*', $where='', $group_by='', $order_by='', $limit='', $prefix=null, $_queryMode='ASSOC') {\n\n    if(empty($table)) {\n        return false;\n    }\n\n    $table      = (is_string($prefix) ? $prefix : DB_PREPEND).$table;\n    $sets       = array();\n    $select     = trim($select);\n    $limit      = trim($limit);\n    $group_by   = trim($group_by);\n    $order_by   = trim($order_by);\n\n    if($select === '') {\n        $select = '*';\n    }\n    if($limit !== '') {\n        if(is_int($limit)) {\n            $limit = ' LIMIT ' . $limit;\n        } else {\n            $limit = explode(',', $limit);\n            $limit[0] = intval(trim($limit[0]));\n            $limit[1] = isset($limit[1]) ? intval(trim($limit[1])) : 0;\n            if($limit[0] && $limit[1]) {\n                $limit = ' LIMIT ' . $limit[0] . ',' . $limit[1];\n            } elseif($limit[0] === 0 && $limit[1]) {\n                $limit = ' LIMIT ' . $limit[1];\n            } elseif($limit[0]) {\n                $limit = ' LIMIT ' . $limit[0];\n            } else {\n                $limit = '';\n            }\n        }\n    }\n    if($group_by !== '') {\n        $group_by = ' GROUP BY '._dbEscape($group_by, false);\n    } else {\n        $group_by = '';\n    }\n\n    if($order_by !== '') {\n        $order_by = ' ORDER BY '._dbEscape($order_by, false);\n    } else {\n        $order_by = '';\n    }\n\n    if($where != '') {\n        $where = trim($where);\n        if( substr(strtoupper($where), 0, 5) !== 'WHERE' ) {\n            $where = 'WHERE '.$where;\n        }\n        $where = ' '.$where;\n    }\n\n    $query = trim( 'SELECT ' . $select . ' FROM ' . $table . $where . $group_by . $order_by . $limit);\n\n    return _dbQuery($query, $_queryMode);\n}\n\n// function for simplified update\nfunction _dbUpdate($table='', $data=array(), $where='', $special='', $prefix=null) {\n\n    if(empty($table)) {\n        return false;\n    }\n\n    if(!is_array($data) || !count($data)) {\n        return false;\n    }\n\n    $table  = (is_string($prefix) ? $prefix : DB_PREPEND).$table;\n    $sets   = array();\n\n    foreach($data as $key => $value) {\n        $sets[] = '`'.$key.'`=' . _dbEscape($value);\n    }\n\n    if($special) {\n        $special = strtoupper(trim($special));\n        if($special != 'LOW_PRIORITY') $special = 'LOW_PRIORITY';\n        $special .= ' ';\n    }\n\n    if($where != '') {\n        $where = trim($where);\n        if( substr(strtoupper($where), 0, 5) !== 'WHERE' ) {\n            $where = 'WHERE '.$where;\n        }\n    }\n\n    $query = trim( 'UPDATE ' . $special . $table . ' SET ' . implode(',', $sets) . ' ' . $where );\n\n    return _dbQuery($query, 'UPDATE');\n\n}\n\nfunction _dbGetCreateCharsetCollation() {\n\n    $value = '';\n    if($GLOBALS['phpwcms']['db_charset']) {\n        $value .= ' DEFAULT';\n        $value .= ' CHARACTER SET '.$GLOBALS['phpwcms']['db_charset'];\n        if(!empty($GLOBALS['phpwcms']['db_collation'])) {\n            $value .= ' COLLATE '.$GLOBALS['phpwcms']['db_collation'];\n        }\n    }\n\n    return $value;\n}\n\nfunction _dbError($error_type='DB', $query='') {\n\n    $error = mysqli_error($GLOBALS['db']);\n\n    if($query) {\n        $query  = str_replace(',', \",\\n\", $query);\n        switch($error_type) {\n            case 'LOG':\n                $error  .= ', QUERY: \"' . $query . '\"';\n                break;\n            default:\n                $error .= '<pre>' . $query .'</pre>';\n        }\n    }\n\n    return $error;\n}\n\nfunction _dbErrorNum() {\n\n    return mysqli_errno($GLOBALS['db']);\n\n}\n\nfunction _dbLogError($log_msg='') {\n\n    if(DB_LOG_ERRORS && $log_msg) {\n\n        if(@is_dir(PHPWCMS_LOGDIR)) {\n            $log_msg = '[' . date('Y-m-d H:i:s') . '] ' . $log_msg . LF;\n\n            @file_put_contents(PHPWCMS_LOGDIR . '/phpwcms_db_error.log', $log_msg, FILE_APPEND);\n        }\n\n    }\n\n}\n\nfunction _dbInitialize() {\n\n    $mysql_set = array();\n\n    if(isset($GLOBALS['phpwcms']['db_sql_mode']) && is_string($GLOBALS['phpwcms']['db_sql_mode'])) {\n        $mysql_set['mode'] = 'SESSION sql_mode = '._dbEscape($GLOBALS['phpwcms']['db_sql_mode']);\n    }\n\n    if(empty($GLOBALS['phpwcms']['db_charset'])) {\n        $mysql_charset_map = array(\n            'big5'         => 'big5',   'cp-866'       => 'cp866',  'euc-jp'       => 'ujis',\n            'euc-kr'       => 'euckr',  'gb2312'       => 'gb2312', 'gbk'          => 'gbk',\n            'iso-8859-1'   => 'latin1', 'iso-8859-2'   => 'latin2', 'iso-8859-7'   => 'greek',\n            'iso-8859-8'   => 'hebrew', 'iso-8859-8-i' => 'hebrew', 'iso-8859-9'   => 'latin5',\n            'iso-8859-13'  => 'latin7', 'iso-8859-15'  => 'latin1', 'koi8-r'       => 'koi8r',\n            'shift_jis'    => 'sjis',   'tis-620'      => 'tis620', 'utf-8'        => 'utf8',\n            'windows-1250' => 'cp1250', 'windows-1251' => 'cp1251', 'windows-1252' => 'latin1',\n            'windows-1256' => 'cp1256', 'windows-1257' => 'cp1257'\n        );\n        $GLOBALS['phpwcms']['db_charset'] = isset($mysql_charset_map[PHPWCMS_CHARSET]) ? $mysql_charset_map[PHPWCMS_CHARSET] : 'utf8';\n    }\n\n    mysqli_set_charset($GLOBALS['db'], $GLOBALS['phpwcms']['db_charset']);\n\n    if(!empty($GLOBALS['phpwcms']['db_collation'])) {\n        $mysql_set['COLLATION'] = 'collation_connection = ' . _dbEscape($GLOBALS['phpwcms']['db_collation']);\n    }\n\n    if(!empty($GLOBALS['phpwcms']['db_timezone'])) {\n        $mysql_set['time_zone'] = 'time_zone = '._dbEscape($GLOBALS['phpwcms']['db_timezone']);\n    }\n\n    if(count($mysql_set)) {\n        _dbQuery('SET '.implode(', ', $mysql_set), 'SET');\n    }\n\n    return mysqli_get_server_info($GLOBALS['db']);\n}\n\n// duplicate a DB record based on 1 unique column\nfunction _dbDuplicateRow($table='', $unique_field='', $id_value=0, $exception=array(), $prefix=null) {\n\n    // use exceptions to define duplicate values: 'field_name' => 'value' (INT/STRING)\n    // to avoid problems with UNIQUE/auto increment columns set 'field_name' => '--UNIQUE--'\n    // to overwrite a unique value use excpetions 'unique_field_name' => 'new_value'\n    // to use simple SQL functions for exceptions define it like 'field_name' => 'SQL:NOW()'\n    // for simple string operations use '--SELF--' like 'field_name' => 'Copy --SELF--'\n    // --SELF-- will be replaced by current value of the field\n\n    if(empty($table) || empty($unique_field) || empty($id_value)) {\n        return false;\n    }\n\n    if(!is_array($exception)) {\n        $exception = array();\n    }\n\n    $table = (is_string($prefix) ? $prefix : DB_PREPEND) . $table;\n\n    $where_value = is_string($id_value) ? _dbEscape($id_value) : $id_value;\n    $row = _dbQuery('SELECT * FROM '.$table.' WHERE '.$unique_field.'='.$where_value.' LIMIT 1');\n\n    // check against result\n    if(isset($row[0]) && is_array($row[0]) && count($row[0])) {\n        $row = $row[0];\n        unset($row[$unique_field]);\n    } else {\n        return false;\n    }\n\n    // check eceptions\n    foreach($exception as $key => $value) {\n        if(isset($row[$key])) {\n            if($value === '--UNIQUE--') {\n                unset($row[$key]);\n            } else {\n                if(is_string($value) && strpos($value, '--SELF--') !== false) {\n                    $value = str_replace('--SELF--', $row[$key], $value);\n                }\n                $row[$key] = $value;\n            }\n        }\n    }\n\n    $_VALUE = array();\n    $_SET   = array();\n    $c      = 0;\n\n    // build INSERT query\n    foreach($row as $key => $value) {\n        $_VALUE[$c] = $key;\n        if(is_string($value)) {\n            if(strpos($value, 'SQL:') === 0) {\n                $_SET[$c] = str_replace('SQL:', '', $value);\n            } else {\n                $_SET[$c] = _dbEscape($value);\n            }\n        } else {\n            $_SET[$c] = _dbEscape($value);\n        }\n        $c++;\n    }\n\n    $sql = 'INSERT INTO ' . $table . ' (' . implode(', ', $_VALUE) . ') VALUES (' . implode(', ', $_SET) . ')';\n\n    $new_id = _dbQuery($sql, 'INSERT');\n\n    if(!empty($new_id['INSERT_ID'])) {\n\n        // fine - auto increment returns new ID\n        return $new_id['INSERT_ID'];\n\n    } elseif(isset($new_id['INSERT_ID']) && $new_id['INSERT_ID'] === 0) {\n\n        // hm - maybe no auto increment - but insert was done\n        // so lets check against $unique_field and its possible new value\n        if(!empty($exception[$unique_field]) && $exception[$unique_field] != '__UNIQUE__') {\n            return $exception[$unique_field];\n        }\n\n    }\n\n    return false;\n}\n\n/*\n * Set Config - store given key/value in config database\n *\n * 2008/03/13 Thiemo M\u00e4ttig, fixed for MySQL 4.0, use _dbInsertOrUpdate()\n */\nfunction _setConfig($key, $value=null, $group='', $status=1) {\n\n    $time       = now();\n    $group      = trim($group);\n    $status     = intval($status);\n\n    if (! is_array($key)) {\n        $key = array($key => $value);\n    }\n\n    foreach($key as $k => $value) {\n\n        if( is_string($value) ) {\n            $vartype = 'string';\n        } elseif( is_int($value) ) {\n            $vartype = 'int';\n        } elseif( is_float($value) ) {\n            $vartype = 'float';\n        } elseif( is_bool($value) ) {\n            $vartype = 'bool';\n        } elseif( is_array($value) ) {\n            $vartype = 'array';\n            $value   = serialize($value);\n        } elseif( is_object($value) ) {\n            $vartype = 'object';\n            $value   = serialize($value);\n        } else {\n            $vartype = '';\n            $value   = '';\n        }\n\n        $data = array(\n            'sysvalue_key' => $k,\n            'sysvalue_group' => $group,\n            'sysvalue_lastchange' => $time,\n            'sysvalue_status' => $status,\n            'sysvalue_vartype' => $vartype,\n            'sysvalue_value' => $value\n        );\n\n        if ( ! _dbInsertOrUpdate('phpwcms_sysvalue', $data) ) {\n            $mysql_error = _dbError();\n            trigger_error(\"_setConfig failed\".(empty($mysql_error) ? '' : ' with MySQL error: '.$mysql_error), E_USER_WARNING);\n        }\n\n    }\n\n    return true;\n}\n\nfunction _dbEscape($value='', $quoted=true, $prefix='', $suffix='') {\n    if(!is_string($value) && !is_numeric($value)) {\n        if(is_array($value) || is_object($value)) {\n            $value = serialize($value);\n            $prefix = '';\n            $suffix = '';\n        } elseif(is_bool($value)) {\n            return $value ? 'true' : 'false';\n        } elseif(is_null($value)) {\n            return 'NULL';\n        } else {\n            $value = strval($value);\n        }\n    }\n    $value = $prefix . mysqli_real_escape_string($GLOBALS['db'], $value) . $suffix;\n\n    return $quoted === true ? \"'\" . $value . \"'\" : $value;\n}\n\n/*\n * Get Config - retrieve Config value from database\n *\n * If $key is string, single value will be returned.\n * If $key given as array - array containing values will be returned.\n * If $set_global is set config value will be registered in $GLOBALS[$set_global],\n * set $set_global = false and var will not be registered in $GLOBALS\n */\nfunction _getConfig($key, $set_global='phpwcms') {\n    $return = 'array';\n    $string = '';\n    if(is_string($key)) {\n        if($set_global && isset($GLOBALS[$set_global][$key])) {\n            return $GLOBALS[$set_global][$key];\n        }\n        $return = 'value';\n        $string = $key;\n        $key = array($key);\n    }\n    if(is_array($key) && count($key)) {\n        $result = array();\n        foreach($key as $value) {\n            if($set_global && isset($GLOBALS[$set_global][$value])) {\n                $result[ $value ] = $GLOBALS[$set_global][$value];\n                continue;\n            }\n            $sql = 'SELECT * FROM '.DB_PREPEND.\"phpwcms_sysvalue WHERE sysvalue_status=1 AND sysvalue_key='\".mysqli_real_escape_string($GLOBALS['db'], $value).\"'\";\n            $row = _dbQuery($sql);\n            if(isset($row[0]['sysvalue_vartype'])) {\n                switch($row[0]['sysvalue_vartype']) {\n                    case 'string':  $result[ $value ] = (string) $row[0]['sysvalue_value'];                 break;\n                    case 'int':     $result[ $value ] = (int) $row[0]['sysvalue_value'];                    break;\n                    case 'float':   $result[ $value ] = (float) $row[0]['sysvalue_value'];                  break;\n                    case 'bool':    $result[ $value ] = (bool) $row[0]['sysvalue_value'];                   break;\n                    case 'array':   $result[ $value ] = (array) @unserialize($row[0]['sysvalue_value']);    break;\n                    case 'object':  $result[ $value ] = (object) @unserialize($row[0]['sysvalue_value']);   break;\n                    default:        $result[ $value ] = $row[0]['sysvalue_value'];\n                }\n            }\n        }\n        if($set_global && count($result)) {\n            foreach($result as $key => $value) {\n                $GLOBALS[$set_global][$key] = $result[$key];\n            }\n        }\n        if($return === 'array') {\n            return $result;\n        } elseif(isset($result[$string])) {\n            return $result[$string];\n        }\n    }\n\n    return false;\n}\n\n/**\n * Set MySQL variable\n *\n * An often seen default value is just 1M for that MySQL variable\n * Serialized data or text can be much bigger than this and\n * MySQL connection can get lost. This fixes this and set it\n * to a global default value of 16M\n */\nfunction _dbSetVar($var='', $value=null, $compare=false) {\n\n    $var = trim($var);\n\n    // stop if this was set yet. can be defined as\n    // additional config value in conf.inc.php\n\n    if(!is_string($var) || !$var || $value === null) {\n\n        return false;\n\n    } elseif(isset($GLOBALS['phpwcms']['mysql_'.$var]) && $GLOBALS['phpwcms']['mysql_'.$var] == $value) {\n\n        return true;\n\n    }\n\n    // check if it is a valid MySQL var\n    $_var       = _dbEscape($var, false);\n    $result     = _dbQuery('SELECT @@'.$_var.' AS mysqlvar');\n    $default    = null;\n\n    if(isset($result[0]['mysqlvar'])) {\n\n        // check if the given MySQL var exists\n        $default = $result[0]['mysqlvar'];\n\n        if($default !== null) {\n\n            $GLOBALS['phpwcms']['mysql_'.$var] = $default;\n\n            switch($compare) {\n\n                case '>':\n                    $set = $default > $value;\n                    break;\n\n                case '<':\n                    $set = $default < $value;\n                    break;\n\n                case '!=':\n                    $set = $default != $value;\n                    break;\n\n                default:\n                    $set = false;\n\n            }\n\n            // change MySQL var setting\n            if($set) {\n\n                $value  = _dbEscape($value, is_numeric($default) ? false : true);\n\n                // try SET SESSION first\n                if(!_dbQuery('SET @@'.$_var.'='.$value, 'SET')) {\n\n                    if(!_dbQuery('SET @@session.'.$_var.'='.$value, 'SET')) {\n\n                        if(!_dbQuery('SET @@global.'.$_var.'='.$value, 'SET')) {\n\n                            return false;\n\n                        }\n\n                    }\n\n                }\n\n                $GLOBALS['phpwcms']['mysql_'.$var] = $value;\n                return true;\n\n            }\n\n        }\n\n    }\n\n    return false;\n}\n\nfunction _dbGetClientInfo() {\n\n    return mysqli_get_client_info();\n\n}", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\ndefine('PHPWCMS_VERSION', '1.9.27-dev');\ndefine('PHPWCMS_RELEASE_DATE', '2021/08/22');\ndefine('PHPWCMS_REVISION', '552');\n", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\nif (!defined('PHP8')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n\nif(!empty($step)) {\n\n    if ($step == 1 && $do) {\n\n        if(!empty($_POST['user_account'])) {\n\n            // fine continue with step 2\n            session_write_close();\n            if(!empty($_SERVER['HTTP_HOST']) && !empty($_SERVER['REQUEST_URI'])) {\n                header('Location: http'.(!empty($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) !== 'off' ? 's' : '').'://'.$_SERVER['HTTP_HOST'].dirname($_SERVER['REQUEST_URI']).'/setup.php?step=2');\n            } else {\n                header(\"Location: setup.php?step=2\");\n            }\n            exit();\n        }\n\n\n        //superuser settings\n        if(isset($_POST['admin_name'])) {\n\n            $phpwcms['admin_name']      = empty($_POST['admin_name']) ? $phpwcms['admin_name'] : slweg($_POST['admin_name']);\n            $phpwcms['admin_user']      = empty($_POST['admin_user']) ? $phpwcms['admin_user'] : slweg($_POST['admin_user']);\n\n            if($_POST[\"admin_pass\"] !== $_POST[\"admin_passrepeat\"] || empty($phpwcms[\"admin_pass\"])) {\n                $admin_err_pass         = 1;\n            } elseif(!empty($_POST[\"admin_pass\"])) {\n                $phpwcms[\"admin_pass\"]  = md5(slweg($_POST[\"admin_pass\"]));\n            }\n\n            $phpwcms[\"admin_email\"]     = clean_slweg($_POST[\"admin_email\"]);\n\n            if(empty($admin_err_pass) && empty($_SESSION['admin_save'])) {\n                write_conf_file($phpwcms);\n                $_SESSION['admin_save'] = 1;\n            }\n\n        }\n\n        // main settings\n\n        $phpwcms[\"db_host\"]    = slweg($_POST[\"db_host\"]);\n        $phpwcms[\"db_user\"]    = slweg($_POST[\"db_user\"]);\n        $phpwcms[\"db_pass\"]    = slweg($_POST[\"db_pass\"]);\n        $phpwcms[\"db_table\"]   = slweg($_POST[\"db_table\"]);\n        $phpwcms[\"db_prepend\"] = slweg($_POST[\"db_prepend\"]);\n        $phpwcms[\"db_pers\"]    = empty($_POST[\"db_pers\"]) ? 0 : 1;\n\n        $phpwcms[\"charset\"]         = 'utf-8'; // Fixed\n        $phpwcms['db_charset']      = 'utf8';\n        if (!empty($_POST[\"charset\"])) {\n            $phpwcms['default_lang'] = substr($_POST[\"charset\"], 0, 2);\n            $_collation_warning = false;\n        } elseif (empty($phpwcms['default_lang'])) {\n            $phpwcms['default_lang'] = 'en';\n        }\n        $phpwcms['db_collation']    = 'utf8_general_ci';\n        $db_sql = empty($_POST[\"db_sql\"]) ? 0 : 1;\n\n        write_conf_file($phpwcms);\n        $err = 0;\n\n        $prepend = $phpwcms[\"db_prepend\"];\n\n        if(isset($_POST[\"dbsavesubmit\"])) {\n\n            // make db connect\n            $db_host = $phpwcms[\"db_host\"];\n            if(!empty($phpwcms[\"db_pers\"]) && substr($db_host, 0, 2) !== 'p:') {\n                $db_host = 'p:'.$db_host;\n            }\n            $db = mysqli_connect($db_host, $phpwcms[\"db_user\"], $phpwcms[\"db_pass\"], $phpwcms[\"db_table\"]);\n\n            if($db) {\n\n                if($result = mysqli_query($db, \"SELECT VERSION()\")) {\n\n                    if($row = mysqli_fetch_row($result)) {\n\n                        $phpwcms[\"db_version\"] = $row[0];\n                        write_conf_file($phpwcms);\n\n                    }\n\n                    mysqli_free_result($result);\n\n                    if($result = mysqli_query($db, 'SELECT * FROM '. ($phpwcms[\"db_prepend\"] ? mysqli_real_escape_string($db, $phpwcms[\"db_prepend\"]) . '_' : '') . 'phpwcms_user')) {\n\n                        $_db_prepend_error = true;\n                        mysqli_free_result($result);\n\n                    }\n\n                } else {\n\n                    $err = 1;\n                    $_SESSION['admin_save'] = 0;\n\n                }\n\n\n            } else {\n\n                $err = 1;\n                $_SESSION['admin_save'] = 0;\n\n            }\n\n            // enable additional db settings like collation and charset\n            if(empty($err)) {\n\n                $db_additional = true;\n\n                if(isset($_collation_warning) && $_collation_warning === false) {\n\n                    $db_init = true;\n\n                    if(isset($_POST['db_sql_hidden'])) {\n\n                        if(empty($db_sql)) {\n\n\n                            $_SESSION['admin_set']  = true;\n                            $db_no_create           = true;\n\n                        } else {\n\n                            // now read and display sql queries\n\n                            $_db_prepend = $phpwcms[\"db_prepend\"] ? mysqli_real_escape_string($db, $phpwcms[\"db_prepend\"]) . '_' : '';\n\n                            $sql_data = read_textfile($DOCROOT . '/setup/default_sql/phpwcms_init.sql');\n                            $sql_data = $sql_data . read_textfile($DOCROOT . '/setup/default_sql/phpwcms_inserts.sql');\n                            $sql_data = preg_replace(\"/(#|--).*.\\n/\", '', $sql_data );\n                            $sql_data = preg_replace('/ `phpwcms/', ' `'.$_db_prepend.'phpwcms', $sql_data );\n                            $sql_data = str_replace(\"\\r\", '', $sql_data);\n                            $sql_data = str_replace(\"\\n\\n\", \"\\n\", $sql_data);\n                            $sql_data = trim($sql_data);\n\n                            // if True create initial database\n                            if(isset($_POST['db_create'])) {\n\n                                $db_create_err = array();\n\n                                mysqli_query($db, 'SET storage_engine=MYISAM');\n                                mysqli_query($db, \"SET SQL_MODE=NO_ENGINE_SUBSTITUTION\");\n\n                                $value  = \"SET NAMES '\". mysqli_real_escape_string($db, $phpwcms['db_charset']).\"'\";\n                                $value .= empty($phpwcms['db_collation']) ? '' : \" COLLATE '\".mysqli_real_escape_string($db, $phpwcms['db_collation']).\"'\";\n                                mysqli_query($db, $value);\n\n                                $db_create_sql = explode(';', $sql_data);\n                                foreach($db_create_sql as $key => $value) {\n\n                                    $value = trim($value);\n\n                                    if(empty($value)) {\n                                        unset($db_create_sql[$key]);\n                                        continue;\n                                    }\n\n                                    if(strpos(strtoupper($value), 'INSERT') !== 0) {\n                                        $value .= ' DEFAULT';\n                                        $value .= ' CHARACTER SET '.$phpwcms['db_charset'];\n                                        $value .= ' COLLATE '.$phpwcms['db_collation'];\n                                    }\n\n                                    // send sql query\n                                    if(!mysqli_query($db, $value)) {\n                                        $db_create_err[] = $value;\n                                        unset($db_create_sql[$key]);\n                                    }\n                                }\n\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    if($step == 2 && $do) {\n\n        $phpwcms[\"site\"] = clean_slweg($_POST[\"site\"]);\n\n        $phpwcms['SMTP_FROM_EMAIL'] = clean_slweg($_POST[\"smtp_from_email\"]);\n        if(!$phpwcms['SMTP_FROM_EMAIL']) {\n            $phpwcms['SMTP_FROM_EMAIL'] = $phpwcms[\"admin_email\"];\n        }\n        $phpwcms['SMTP_FROM_NAME'] = clean_slweg($_POST[\"smtp_from_name\"]);\n        if(!$phpwcms['SMTP_FROM_NAME']) {\n            $phpwcms['SMTP_FROM_NAME'] = 'webmaster';\n        }\n        $phpwcms['SMTP_HOST'] = clean_slweg($_POST[\"smtp_host\"]);\n        if(!$phpwcms['SMTP_HOST']) {\n            $phpwcms['SMTP_HOST'] = 'localhost';\n        }\n        $phpwcms['SMTP_PORT'] = intval($_POST[\"smtp_port\"]);\n        if(!$phpwcms['SMTP_PORT']) {\n            $phpwcms['SMTP_PORT'] = 25;\n        }\n        $phpwcms['SMTP_MAILER'] = clean_slweg($_POST[\"smtp_mailer\"]);\n        if(!$phpwcms['SMTP_MAILER']) {\n            $phpwcms['SMTP_MAILER'] = 'mail';\n        }\n        $phpwcms['SMTP_AUTH'] = empty($_POST[\"smtp_auth\"]) ? 0 : 1;\n        $phpwcms['SMTP_USER'] = slweg($_POST[\"smtp_user\"]);\n        $phpwcms['SMTP_PASS'] = slweg($_POST[\"smtp_pass\"]);\n        $phpwcms['SMTP_SECURE'] = clean_slweg($_POST[\"smtp_secure\"]);\n\n        write_conf_file($phpwcms);\n\n        if(!empty($_POST[\"admin_create\"])) {\n            $db = mysqli_connect($phpwcms[\"db_host\"], $phpwcms[\"db_user\"], $phpwcms[\"db_pass\"], $phpwcms[\"db_table\"]);\n            if(mysqli_connect_error()) {\n                $err = 1;\n            } else {\n                mysqli_query($db, \"SET SQL_MODE=NO_AUTO_VALUE_ON_ZERO,NO_ENGINE_SUBSTITUTION\");\n                mysqli_query($db, \"SET NAMES '\".mysqli_real_escape_string($db, $phpwcms[\"charset\"]).\"'\");\n                $_db_prepend = $phpwcms[\"db_prepend\"] ? mysqli_real_escape_string($db, $phpwcms[\"db_prepend\"]) . \"_\" : \"\";\n                $sql =  \"INSERT INTO \" . $_db_prepend . \"phpwcms_user (usr_login, usr_pass, usr_email, \".\n                        \"usr_admin, usr_aktiv, usr_name, usr_fe, usr_wysiwyg ) VALUES ('\".\n                        mysqli_real_escape_string($db, $phpwcms[\"admin_user\"]).\"', '\".\n                        mysqli_real_escape_string($db, md5($phpwcms[\"admin_pass\"])).\"', '\".\n                        mysqli_real_escape_string($db, $phpwcms[\"admin_email\"]).\"', 1, 1, '\".\n                        mysqli_real_escape_string($db, $phpwcms['SMTP_FROM_NAME']).\"', 2, 2)\";\n\n                mysqli_query($db, $sql) or $err = 1;\n            }\n        }\n\n        if(!$err) {\n            header(\"Location: setup.php?step=3\");\n            exit();\n        }\n    }\n\n    if($step == 3 && $do) {\n\n        $phpwcms['DOC_ROOT']       = clean_slweg($_POST[\"doc_root\"]);\n        $phpwcms[\"root\"]           = clean_slweg($_POST[\"root\"]);\n        $phpwcms[\"file_path\"]      = clean_slweg($_POST[\"file_path\"]);\n        $phpwcms[\"templates\"]      = clean_slweg($_POST[\"templates\"]);\n        $phpwcms[\"ftp_path\"]       = clean_slweg($_POST[\"ftp_path\"]);\n\n        $phpwcms[\"file_path\"]      = ($phpwcms[\"file_path\"]) ? $phpwcms[\"file_path\"] : \"phpwcms_filestorage\";\n        $phpwcms[\"templates\"]      = ($phpwcms[\"templates\"]) ? $phpwcms[\"templates\"] : \"phpwcms_template\";\n        $phpwcms[\"content_path\"]   = ($phpwcms[\"content_path\"]) ? $phpwcms[\"content_path\"] : \"content\";\n        $phpwcms[\"cimage_path\"]    = ($phpwcms[\"cimage_path\"]) ? $phpwcms[\"cimage_path\"] : \"images\";\n        $phpwcms[\"ftp_path\"]       = ($phpwcms[\"ftp_path\"]) ? $phpwcms[\"ftp_path\"] : \"phpwcms_ftp\";\n\n        write_conf_file($phpwcms);\n        header(\"Location: setup.php?step=4\");\n        exit();\n    }\n\n    if($step == 4 && $do) {\n        $phpwcms[\"file_maxsize\"]     = intval($_POST[\"file_maxsize\"]);\n        $phpwcms[\"content_width\"]    = intval($_POST[\"content_width\"]);\n        $phpwcms[\"img_list_width\"]   = intval($_POST[\"img_list_width\"]);\n        $phpwcms[\"img_list_height\"]  = intval($_POST[\"img_list_height\"]);\n        $phpwcms[\"img_prev_width\"]   = intval($_POST[\"img_prev_width\"]);\n        $phpwcms[\"img_prev_height\"]  = intval($_POST[\"img_prev_height\"]);\n        $phpwcms[\"max_time\"]         = intval($_POST[\"max_time\"]);\n        $phpwcms[\"file_maxsize\"]     = ($phpwcms[\"file_maxsize\"]) ? $phpwcms[\"file_maxsize\"] : 2097152;\n        $phpwcms[\"content_width\"]    = ($phpwcms[\"content_width\"]) ? $phpwcms[\"content_width\"] : 538;\n        $phpwcms[\"img_list_width\"]   = ($phpwcms[\"img_list_width\"]) ? $phpwcms[\"img_list_width\"] : 100;\n        $phpwcms[\"img_list_height\"]  = ($phpwcms[\"img_list_height\"]) ? $phpwcms[\"img_list_height\"] : 75;\n        $phpwcms[\"img_prev_width\"]   = ($phpwcms[\"img_prev_width\"]) ? $phpwcms[\"img_prev_width\"] : 538;\n        $phpwcms[\"img_prev_height\"]  = ($phpwcms[\"img_prev_height\"]) ? $phpwcms[\"img_prev_height\"] : 400;\n        $phpwcms[\"max_time\"]         = ($phpwcms[\"max_time\"]) ? $phpwcms[\"max_time\"] : 1800;\n\n        write_conf_file($phpwcms);\n        header(\"Location: setup.php?step=5\");\n        exit();\n    }\n\n}\n", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\nif (!defined('PHP8')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n\n$_SESSION['admin_set'] = false;\n$setup_recommend = true;\n\n?>\n    <h1><span class=\"number\">1.</span> Thanks! You have agreed to the GPL.</h1>\n    <p>Now that you know the <a href=\"http://www.gnu.org/licenses/licenses.html#GPL\"\n                                target=\"_blank\"><strong>licence</strong></a> under\n        which <strong>phpwcms</strong> is released you can continue to install or upgrade <strong>phpwcms</strong>.</p>\n\n    <h1><span class=\"number\">2.</span> Now lets check your server settings</h1>\n    <p>Please proof all information about your system (recommend PHP 7.1+, MySQL 5.5+).</p>\n    <ol>\n        <li>WWW server:\n            <strong><?php echo empty($_SERVER['SERVER_SOFTWARE']) ? 'unavailable' : html_specialchars($_SERVER['SERVER_SOFTWARE']) ?></strong>\n        </li>\n        <li>PHP version: <?php\n\n            echo '<strong>' . html_specialchars(phpversion()) . '</strong>';\n\n            switch (version_compare('5.6', phpversion())) {\n\n                case -1:    // current used PHP is > OK\n                    echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n                    break;\n\n                case  0:    // the same version - HM not recommend\n                    echo '<img src=\"../img/famfamfam/icon_alert.gif\" alt=\"OK\" class=\"icon1\" />';\n                    echo ' (your version of PHP is OK but update to 7.x is recommend)';\n                    $setup_recommend = false;\n                    break;\n\n                case  1:    // false it's older\n                    echo '<img src=\"../img/famfamfam/action_stop.gif\" alt=\"Stop\" class=\"icon1\" />';\n                    echo ' (your version of PHP is too old - it is not recommend to continue)';\n                    $setup_recommend = false;\n                    break;\n            }\n\n            ?></li>\n        <li>MySQLi extension: <?php\n            if (function_exists('mysqli_connect')) {\n                echo '<strong>installed</strong> <img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n            } else {\n                echo '<strong class=\"error\">not installed</strong> <img src=\"../img/famfamfam/action_stop.gif\" alt=\"Stop\" class=\"icon1\" />';\n                $setup_recommend = false;\n            }\n            ?></li>\n        <li>MySQLi client information: <?php\n\n            $mysqlnd = false;\n            $mysql_version = mysqli_get_client_info();\n\n            if (strpos($mysql_version, 'mysqlnd') !== false) {\n                $mysql_version = preg_replace('/^.*?\\s(\\d.+?)\\s.*?$/', '$1', $mysql_version) . ' (client lib)';\n                $mysqlnd = true;\n            }\n\n            echo '<strong>' . $mysql_version . '</strong>';\n\n            $mysql_version = explode('.', preg_replace('/[^0-9.]/', '', str_replace(array('mysqlnd ', ' (client lib)'), '', strtolower($mysql_version))));\n            $mysql_version[0] = (int)$mysql_version[0];\n            $mysql_version[1] = empty($mysql_version[1]) ? 0 : (int)$mysql_version[1];\n\n            if ($mysql_version[0] >= 5 && ($mysql_version[1] >= 1 || $mysqlnd)) {\n\n                // current MySQL isOK\n                echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n            } else {\n\n                // the same version or older\n                echo '<img src=\"../img/famfamfam/action_stop.gif\" alt=\"Stop\" class=\"icon1\" />';\n                echo ' (not supported any longer)';\n\n                $setup_recommend = false;\n            }\n\n            ?></li>\n        <li>PHP settings<a href=\"http://www.php.net/manual/en/security.php\" target=\"_blank\" title=\"PHP Security\"><img\n                    src=\"../img/famfamfam/icon_info.gif\" alt=\"Security risks\" class=\"icon1\" border=\"0\"/></a>\n            <ul>\n                <li><strong>register_globals </strong><?php\n\n                    if (ini_get('register_globals')) {\n                        echo '<strong>On</strong>';\n                        echo '<img src=\"../img/famfamfam/icon_alert.gif\" alt=\"OK\" class=\"icon1\" />';\n                        echo ' (should always be set Off';\n                        echo '<a href=\"http://phpsec.org/projects/guide/1.html#1.3\" target=\"_blank\">';\n                        echo '<img src=\"../img/famfamfam/icon_info.gif\" alt=\"Security risks\" class=\"icon1\" border=\"0\" />';\n                        echo '</a>)';\n                    } else {\n                        echo '<strong>Off</strong>';\n                        echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n                    }\n\n                    ?>\n                </li>\n                <?php if (version_compare(phpversion(), '5.6.0', '<')): ?>\n                    <li><strong>safe_mode </strong><?php\n\n                        if (ini_get('safe_mode')) {\n                            echo '<strong>On</strong>';\n                            echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"OK\" class=\"icon1\" />';\n                            echo ' (limited permissions, but recommend)';\n                        } else {\n                            echo '<strong>Off</strong>';\n                            echo '<img src=\"../img/famfamfam/icon_alert.gif\" alt=\"Warning\" class=\"icon1\" />';\n                            echo ' (check information about security risks';\n                            echo '<a href=\"http://www.php.net/features.safe-mode\" target=\"_blank\">';\n                            echo '<img src=\"../img/famfamfam/icon_info.gif\" alt=\"Security risks\" class=\"icon1\" border=\"0\" />';\n                            echo '</a>)';\n                        }\n\n                        ?></li>\n                <?php endif; ?>\n\n                <li><?php\n\n                    $_phpinfo = parsePHPModules();\n                    if (isset($_phpinfo['gd']['GD Support']) && $_phpinfo['gd']['GD Support'] == 'enabled' && isset($_phpinfo['gd']['GD Version'])) {\n                        $_phpinfo['gd_version'] = html_specialchars($_phpinfo['gd']['GD Version']);\n                    } else {\n                        $_phpinfo['gd_version'] = 'n.a.';\n                    }\n\n                    echo '<strong>GD';\n\n                    if (function_exists('imagegd2')) {\n                        echo '2</strong> ' . $_phpinfo['gd_version'];\n                        echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"GD2\" class=\"icon1\" />';\n                        $is_gd = true;\n                    } elseif (function_exists('imagegd')) {\n                        echo '1</strong> ' . $_phpinfo['gd_version'];\n                        echo '<img src=\"../img/famfamfam/icon_alert.gif\" alt=\"GD1\" class=\"icon1\" />';\n                        echo ' (GD2 is recommend)';\n                        $is_gd = true;\n                    } else {\n                        echo ' not available</strong>';\n                        echo '<img src=\"../img/famfamfam/action_stop.gif\" alt=\"GD not present\" class=\"icon1\" />';\n                        $is_gd = false;\n                    }\n\n                    if ($is_gd) {\n\n                        $is_gd = array();\n\n                        if (imagetypes() & IMG_GIF) {\n                            $is_gd[] = 'GIF<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"GIF supported\" class=\"icon1\" />';\n                        } else {\n                            $is_gd[] = 'GIF<img src=\"../img/famfamfam/action_stop.gif\" alt=\"GIF not supported\" class=\"icon1\" />';\n                        }\n                        if (imagetypes() & IMG_PNG) {\n                            $is_gd[] = 'PNG<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"PNG supported\" class=\"icon1\" />';\n                        } else {\n                            $is_gd[] = 'PNG<img src=\"../img/famfamfam/action_stop.gif\" alt=\"PNG not supported\" class=\"icon1\" />';\n                        }\n                        if (imagetypes() & IMG_JPG) {\n                            $is_gd[] = 'JPG<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"JPG supported\" class=\"icon1\" />';\n                        } else {\n                            $is_gd[] = 'JPG<img src=\"../img/famfamfam/action_stop.gif\" alt=\"JPG not supported\" class=\"icon1\" />';\n                        }\n\n                        echo '<br />Image types supported: ' . implode('/ ', $is_gd);\n                    }\n\n                    ?></li>\n            </ul>\n        </li>\n    </ol>\n    <p><strong>phpwcms</strong> has\n        automatic image resizing capabilities. This works very well for standard graphics\n        file formats like JPEG, GIF and PNG as long as your PHP installation has built-in\n        support for <a href=\"http://en.wikipedia.org/wiki/GD_Graphics_Library\" target=\"_blank\">GD</a> &#8212; <strong>GD2</strong>\n        with freetype support is always recommend. <strong>Note:</strong> It\n        is not neccessary but recommend that you have installed <a href=\"http://www.imagemagick.org\" target=\"_blank\">ImageMagick</a>\n        and <a href=\"http://www.ghostscript.com/\" target=\"_blank\">GhostScript</a> on\n        your server system which enables image resizing for nearly every\n        graphics file format.</p>\n<?php\n\n// is the setup config file writable\nif (!is_writable($DOCROOT . '/setup/setup.conf.inc.php')) {\n\n    if (!@chmod($DOCROOT . '/setup/setup.conf.inc.php', 0666)) {\n\n        echo errorWarning('The file <i>setup.conf.inc.php</i> in which all values are stored is NOT writable.');\n\n        ?><p>Please correct this problem before you can continue (connect to your account by FTP and permissions to\n            chmod 777).</p>\n        <?php\n\n    }\n} else {\n\n    if (!$setup_recommend) {\n\n        echo '<p class=\"error\">\n\t\t    <img src=\"../img/famfamfam/icon_alert.gif\" alt=\"\" class=\"icon1\" />\n\t\t    <strong>It is not recommend to continue with setup. See the warnings!</strong>\n\t\t</p>';\n    }\n\n    ?>\n    <form action=\"setup.php?step=1\" method=\"post\">\n        <input name=\"Submit\" type=\"submit\" value=\"Start setup of phpwcms\"/>\n        &nbsp;&nbsp;\n        <input name=\"Submit\" type=\"submit\" value=\"Upgrade existing installation\"\n               onclick=\"window.location.href='upgrade.php';return false;\"/>\n    </form>\n    <?php\n}\n", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\nif (!defined('PHP8')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n\n?>\n<h1><span class=\"number\">3.</span> MySQL database settings </h1>\n<?php\nif(isset($_POST[\"dbsavesubmit\"]) && $err) {\n    echo errorWarning('Please proof your database settings!');\n    $_SESSION['admin_set'] = false;\n}\n?>\n<form action=\"setup.php?step=1\" method=\"post\" autocomplete=\"off\">\n        <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n          <tr>\n            <td align=\"right\" class=\"v10\" width=\"120\">MySQL host:&nbsp;</td>\n            <td width=\"270\"><input name=\"db_host\" type=\"text\" class=\"v12\" id=\"db_host\" value=\"<?php echo html_specialchars($phpwcms[\"db_host\"]) ?>\" placeholder=\"localhost\" size=\"30\" style=\"width:300px\" /></td>\n            <td class=\"chatlist\"><em>default: localhost</em></td>\n          </tr>\n           <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n           </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">DB user:&nbsp;</td>\n            <td><input name=\"db_user\" type=\"text\" class=\"v12\" id=\"db_user\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"db_user\"]) ?>\" placeholder=\"database user\" size=\"30\" /></td>\n            <td class=\"chatlist\">&nbsp;</td>\n          </tr>\n           <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n           </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">DB password:&nbsp;</td>\n            <td><input name=\"db_pass\" type=\"text\" class=\"v12\" id=\"db_pass\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"db_pass\"]) ?>\" placeholder=\"database password\" size=\"30\" /></td>\n            <td class=\"chatlist\">&nbsp;</td>\n          </tr>\n           <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n           </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">DB database:&nbsp;</td>\n            <td><input name=\"db_table\" type=\"text\" class=\"v12\" id=\"db_table\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"db_table\"]) ?>\" placeholder=\"database name\" size=\"30\" maxlength=\"255\" /></td>\n            <td class=\"chatlist\"><em>you have to create it <strong>before</strong> setup!!!</em></td>\n          </tr>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n          </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">DB table prefix:&nbsp;</td>\n            <td><input name=\"db_prepend\" type=\"text\" class=\"v12\" id=\"db_prepend\" style=\"width:300px\" value=\"<?php echo html_specialchars($prepend) ?>\" size=\"30\" maxlength=\"10\" /></td>\n            <td class=\"chatlist\"><em>default: none (&quot;&quot;), if filled\n                in it will be <strong>prefix</strong>+<strong>_</strong></em></td>\n          </tr>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"6\" /></td>\n          </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n                <tr>\n                <td><input name=\"db_pers\" type=\"checkbox\" id=\"db_pers\" value=\"1\" <?php echo ($phpwcms[\"db_pers\"]) ? \"checked\" : \"\"; ?> /></td>\n                <td><label for=\"db_pers\" class=\"v12\">&nbsp;use&nbsp;persistent&nbsp;database&nbsp;connection&nbsp;</label></td>\n                </tr>\n            </table></td>\n            <td class=\"chatlist\"><em>it should be safe to enable it</em></td>\n          </tr>\n\n<?php\nif(!empty($db_additional)) {\n\n?>\n    <tr>\n        <td colspan=\"3\" style=\"padding: 10px 0 10px 0;\">\n            <h1>\n                <span class=\"number\">4.</span>\n                Charset &amp; MySQL <span class=\"v11\">(v<?php echo html_specialchars($row[0]) ?>)</span> settings\n                <a href=\"http://dev.mysql.com/doc/refman/4.1/en/charset.html\" target=\"_blank\" title=\"MySQL information\"><img src=\"../img/famfamfam/icon_info.gif\" alt=\"Info\" border=\"0\" class=\"icon\" /></a>\n            </h1>\n        </td>\n    </tr>\n    <tr>\n            <td align=\"right\" class=\"v10\"><a href=\"http://www.w3.org/International/O-HTTP-charset\" target=\"_blank\" title=\"HTTP charset\"><img src=\"../img/famfamfam/icon_info.gif\" alt=\"Info\" border=\"0\" class=\"icon1\" /></a>Charset:&nbsp;</td>\n            <td><select name=\"charset\">\n            <?php\n\n            foreach($available_languages as $key => $value) {\n\n                list(, $_lang_charset)  = explode('-', $value[1], 2);\n                list(, $_lang_en)       = explode('|', $value[0]);\n\n                echo '<option value=\"'.$key.'\"';\n\n                if($key === strtolower(str_replace('-', '', $phpwcms['default_lang']) .'-'. $phpwcms['charset'])) {\n                    echo ' selected=\"selected\"';\n                }\n\n                echo '>';\n                echo empty($value[3]) ? '' : $value[3].' - ';\n                echo ucfirst($_lang_en);\n                echo ' ['.$_lang_charset;\n                if(!empty($mysql_charset_map[$_lang_charset])) {\n                    echo ' / '.$mysql_charset_map[$_lang_charset];\n                }\n                echo ']';\n                echo \"</option>\";\n            }\n\n            ?>\n            </select><input type=\"hidden\" name=\"collation\" value=\"utf8_general_ci\" /></td>\n            <td class=\"chatlist\"></td>\n          </tr>\n\n<?php\n\n}\n\n// now show setting which enables creating database\nif(!empty($db_init)) {\n\n?>\n    <tr><td colspan=\"3\" style=\"padding: 10px 0 10px 0;\"><h1><span class=\"number\">5.</span> Default phpwcms database schema</h1></td></tr>\n<?php\n\n\n\n    if(empty($db_no_create) && !empty($_db_prepend_error) && isset($_POST['db_sql_hidden'])) {\n        echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n        echo errorWarning('phpwcms tables still exists in choosen database. Rename table prefix might help!');\n        echo \"</td></tr>\\n\";\n        $_SESSION['admin_set'] = false;\n    }\n    if(isset($db_create_err) && count($db_create_err)) {\n        echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n        echo errorWarning('Errors while creating initial phpwcms tables. Solve it manually:</b></p><pre class=\"errorBox\">'.html_specialchars(implode(\";\\n\\n\", $db_create_err).';').'</pre><p><b> ');\n        echo \"</td></tr>\\n\";\n\n        $_SESSION['admin_set']  = false;\n        $sql_data               = false;\n        $db_sql                 = false;\n\n    } elseif(isset($db_create_err) || !empty($db_no_create)) {\n\n        // OK fine - initial tables were created without error\n        $_db_prepend = $phpwcms[\"db_prepend\"] ? mysqli_real_escape_string($db, $phpwcms[\"db_prepend\"]) . '_' : '';\n        $check = _dbQuery(\"SHOW TABLES LIKE '\".$_db_prepend.\"phpwcms_%'\");\n\n        if($check && count($check)) {\n\n            $sql_data   = false;\n            $db_sql     = false;\n            $db_fine    = true;\n\n?>\n      <tr>\n        <td align=\"right\" class=\"v10\">&nbsp;</td>\n        <td colspan=\"2\"><img src=\"../img/famfamfam/icon_accept.gif\" alt=\"Juchu\" class=\"icon1\" /><strong>Fine!</strong> All initial phpwcms tables were created or still exists.<input type=\"hidden\" name=\"db_sql_hidden\" value=\"1\" /></td>\n      </tr>\n<?php\n\n        } else {\n\n            $_SESSION['admin_set']  = false;\n\n            $sql_data               = false;\n            $db_sql                 = false;\n\n            echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n            echo errorWarning('No phpwcms database table exists. Check before you continue!');\n            echo '<input type=\"hidden\" name=\"db_sql_hidden\" value=\"1\" />';\n            echo \"</td></tr>\\n\";\n\n        }\n\n    }\n\n\n    if(empty($db_fine)) {\n        // show info\n\n?>\n      <tr>\n        <td align=\"right\" class=\"v10\">&nbsp;</td>\n        <td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n            <tr>\n            <td><input name=\"db_sql\" type=\"checkbox\" id=\"db_sql\" value=\"1\"<?php if(!empty($db_sql)) echo ' checked=\"checked\"' ?> /></td>\n            <td><label for=\"db_sql\" class=\"v12\">&nbsp;create phpwcms db tables&nbsp;</label><input type=\"hidden\" name=\"db_sql_hidden\" value=\"1\" /></td>\n            </tr>\n        </table></td>\n        <td class=\"chatlist\">&nbsp;</td>\n      </tr>\n\n<?php\n\n    }\n\n    if(!empty($sql_data)) {\n\n        $sql_data = explode(';', $sql_data);\n        $c = 0;\n        foreach($sql_data as $key => $value) {\n\n            $value = trim(preg_replace('/--\\s/', '', trim($value)));\n\n            if(empty($value)) {\n                unset($sql_data[$key]);\n                continue;\n            }\n\n            $value = html_specialchars($value);\n            $value = str_replace(' ', '&nbsp;', $value);\n            $value = nl2br($value);\n\n            $sql_data[$key]  = '<div style=\"margin:0;padding:0 5px 0 5px;';\n            if($c % 2) {\n                $sql_data[$key] .= ';background-color:#F6F8FA;';\n            }\n            $sql_data[$key] .= '\"><p>'.$value;\n\n            if(strpos(strtoupper(trim($value)), 'INSERT') !== 0) {\n                $sql_data[$key] .= ' DEFAULT';\n                $sql_data[$key] .= ' CHARACTER SET '.$phpwcms['db_charset'];\n                $sql_data[$key] .= ' COLLATE '.$phpwcms['db_collation'];\n            }\n\n            $sql_data[$key] .= ';</p></div>';\n            $c++;\n        }\n\n        $sql_data = implode(\"\\n\", $sql_data);\n\n        echo '<tr><td>&nbsp;';\n        if(empty($_db_prepend_error) && isset($_POST['db_sql_hidden'])) {\n            echo '<input type=\"hidden\" name=\"db_create\" value=\"1\" />';\n        }\n        echo '</td><td colspan=\"2\">';\n        echo '<div id=\"license\" style=\"width:550px\">';\n        echo $sql_data;\n        echo \"</div></td></tr>\\n\";\n\n    }\n}\n\n\n//  OK now lets create superuser\nif(!empty($_SESSION['admin_set'])) {\n\n?>\n    <tr><td colspan=\"3\" style=\"padding: 10px 0 10px 0;\"><h1><span class=\"number\">6.</span> Superuser settings</h1></td></tr>\n<?php\n\n    // as long as admin info wasn't written\n    if(empty($_SESSION['admin_save'])) {\n\n?>\n    <tr>\n        <td align=\"right\" class=\"v10\">Name:&nbsp;</td>\n        <td><input name=\"admin_name\" type=\"text\" id=\"admin_name\" class=\"v12\" style=\"width:300px\" value=\"<?php echo empty($phpwcms[\"admin_name\"]) ? \"Webmaster\" : html_specialchars($phpwcms[\"admin_name\"]) ?>\" size=\"30\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;default: Webmaster</em></td>\n    </tr>\n\n    <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n    </tr>\n\n    <tr>\n        <td align=\"right\" class=\"v10\">Admin login:&nbsp;</td>\n        <td><input name=\"admin_user\" type=\"text\" id=\"admin_user\" class=\"v12\" style=\"width:300px\" value=\"<?php echo empty($phpwcms[\"admin_user\"]) ? \"webmaster\" : html_specialchars($phpwcms[\"admin_user\"]) ?>\" size=\"30\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;default: admin </em></td>\n    </tr>\n\n    <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td></tr>\n\n<?php\n    if(!empty($admin_err_pass)) {\n        echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n        echo errorWarning('Invalid password! Password is case senitive, empty password not allowed.');\n        echo \"</td></tr>\\n\";\n    }\n?>\n\n    <tr>\n        <td align=\"right\" class=\"v10\">Admin password:&nbsp;</td>\n        <td><input name=\"admin_pass\" type=\"password\" id=\"admin_pass\" class=\"v12\" style=\"width:300px\" size=\"30\" autocomplete=\"new-password\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;default: phpwcms </em></td>\n    </tr>\n\n    <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n    </tr>\n\n    <tr>\n        <td align=\"right\" class=\"v10\">Repeat password:&nbsp;</td>\n        <td><input name=\"admin_passrepeat\" type=\"password\" id=\"admin_passrepeat\" class=\"v12\" style=\"width:300px\" size=\"30\" autocomplete=\"new-password\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;</em></td>\n    </tr>\n\n    <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\" /></td>\n    </tr>\n\n    <tr>\n        <td align=\"right\" class=\"v10\">Admin email:&nbsp;</td>\n        <td><input name=\"admin_email\" type=\"text\" id=\"admin_email\" class=\"v12\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"admin_email\"]) ?>\" size=\"30\" /></td>\n        <td class=\"chatlist\"><em>&nbsp;is used site wide</em></td>\n    </tr>\n<?php\n\n    } else {\n\n        $_db_prepend = $phpwcms[\"db_prepend\"] ? mysqli_real_escape_string($db, $phpwcms[\"db_prepend\"]) . '_' : '';\n\n        //show Info that admin info was saved\n        //and also if stored in database\n\n        $user_check = _dbQuery('SELECT * FROM '.$_db_prepend.\"phpwcms_user WHERE usr_login='\".mysqli_real_escape_string($db, $phpwcms['admin_user']).\"'\");\n\n        if($user_check !== false && count($user_check)) {\n\n            //hm user still exists - so try to update\n            $sql  = \"UPDATE \".$_db_prepend.\"phpwcms_user SET \";\n            $sql .= \"usr_login      = '\".mysqli_real_escape_string($db, $phpwcms['admin_user']).\"', \";\n            $sql .= \"usr_pass       = '\".mysqli_real_escape_string($db, $phpwcms[\"admin_pass\"]).\"', \";\n            $sql .= \"usr_email      = '\".mysqli_real_escape_string($db, $phpwcms[\"admin_email\"]).\"', \";\n            $sql .= \"usr_admin      = 1, \";\n            $sql .= \"usr_aktiv      = 1, \";\n            $sql .= \"usr_name       = '\".mysqli_real_escape_string($db, $phpwcms['admin_name']).\"', \";\n            $sql .= \"usr_lang       = '\".mysqli_real_escape_string($db, $phpwcms['default_lang']).\"', \";\n            $sql .= \"usr_wysiwyg    = 2, \";\n            $sql .= \"usr_fe         = 2 \";\n            $sql .= \"WHERE usr_login='\".mysqli_real_escape_string($db, $phpwcms['admin_user']).\"' LIMIT 1\";\n\n            $update_user = _dbQuery($sql, 'UPDATE');\n\n        } elseif($user_check !== false) {\n\n            //fine lets create new user\n            $sql  = \"INSERT INTO \".$_db_prepend.\"phpwcms_user (\";\n            $sql .= \"usr_login, usr_pass, usr_email, \";\n            $sql .= \"usr_admin, usr_aktiv, usr_name, \";\n            $sql .= \"usr_var_structure, usr_var_publicfile, usr_var_privatefile, \";\n            $sql .= \"usr_lang, usr_wysiwyg, usr_fe, usr_vars\";\n            $sql .= \") VALUES (\";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms['admin_user']).\"', \";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms[\"admin_pass\"]).\"', \";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms[\"admin_email\"]).\"', \";\n            $sql .= \"1, 1, \";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms['admin_name']).\"', \";\n            $sql .= \"'', \";\n            $sql .= \"'', \";\n            $sql .= \"'', \";\n            $sql .= \"'\".mysqli_real_escape_string($db, $phpwcms['default_lang']).\"', \";\n            $sql .= \"2, 2, ''\";\n            $sql .= \")\";\n\n            $create_user = _dbQuery($sql, 'INSERT');\n\n        } else {\n\n            $user_check = false;\n\n        }\n\n        echo '<tr><td>&nbsp;</td><td colspan=\"2\">';\n\n        if(!empty($create_user)) {\n\n            // update\n            echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"Juchu\" class=\"icon1\" />';\n            echo '<strong>Done!</strong> Account for user <b>'.html_specialchars($phpwcms['admin_user']).'</b> was created.';\n            echo '<input type=\"hidden\" name=\"user_account\" value=\"1\" />';\n\n        }\n\n        if(!empty($update_user)) {\n\n            // update\n            echo '<img src=\"../img/famfamfam/icon_accept.gif\" alt=\"Juchu\" class=\"icon1\" />';\n            echo '<strong>Done!</strong> Account of user <b>'.html_specialchars($phpwcms['admin_user']).'</b> was updated.';\n            echo '<input type=\"hidden\" name=\"user_account\" value=\"1\" />';\n\n        }\n\n        if($user_check === false) {\n\n            // db error\n            echo errorWarning('There is a database problem!');\n            echo '<p>Account for user <b>'.html_specialchars($phpwcms['admin_user']).'</b> was not created or updated.<br />Click <b>continue</b> to try again.</p>';\n            $_SESSION['admin_save'] = false;\n\n        }\n\n        echo '</td></tr>';\n\n    }\n\n}\n\n?>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"15\" /></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\"><input name=\"dbsavesubmit\" type=\"submit\" value=\"Continue\" /></td>\n          </tr>\n</table><input name=\"do\" type=\"hidden\" value=\"1\" /></form>", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\nif (!defined('PHP8')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n\nif ($err) {\n    echo '<p class=\"error\"><b>Check your admin user name and password!</b></p>';\n}\n\n?>\n<h1>7. Path settings </h1>\n<form action=\"setup.php?step=2\" method=\"post\">\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n        <tr>\n            <td align=\"right\" class=\"v10\">site basis:&nbsp;</td>\n            <td><input name=\"site\" type=\"text\" class=\"f11b\" id=\"site\"\n                       value=\"<?php echo html_specialchars($phpwcms[\"site\"]) ?>\" size=\"30\" style=\"width:275px\"\n                       placeholder=\"<?php echo get_url_origin(true); ?>\"></td>\n            <td class=\"chatlist\">\n                <em>&nbsp;current: <?php echo get_url_origin(true); ?></em>\n            </td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td class=\"chatlist\">&nbsp;</td>\n            <td class=\"chatlist\">\n                <em>&nbsp;do NOT add any subdir here like</em><br>\n                <em>&nbsp;<?php echo get_url_origin(true); ?>/wcms/</em>\n            </td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"6\"></td>\n        </tr>\n\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"25\"></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\">Settings for handling email sending in phpwcms</td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"15\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">from/reply-to&nbsp;email:&nbsp;</td>\n            <td><input name=\"smtp_from_email\" type=\"text\" class=\"f11b\" id=\"smtp_from_email\"\n                       value=\"<?php echo ($phpwcms['SMTP_FROM_EMAIL']) ? html_specialchars($phpwcms['SMTP_FROM_EMAIL']) : html_specialchars($phpwcms[\"admin_email\"]) ?>\"\n                       size=\"30\" style=\"width:275px\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: <?php echo html_specialchars($phpwcms[\"admin_email\"]) ?></em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">from/reply-to&nbsp;name:&nbsp;</td>\n            <td><input name=\"smtp_from_name\" type=\"text\" class=\"f11b\" id=\"smtp_from_name\" style=\"width:275px\"\n                       value=\"<?php echo ($phpwcms['SMTP_FROM_NAME']) ? html_specialchars($phpwcms['SMTP_FROM_NAME']) : 'webmaster' ?>\"\n                       size=\"30\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: webmaster</em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">SMTP&nbsp;server:&nbsp;</td>\n            <td><input name=\"smtp_host\" type=\"text\" class=\"f11b\" id=\"smtp_host\"\n                       value=\"<?php echo ($phpwcms['SMTP_HOST']) ? html_specialchars($phpwcms['SMTP_HOST']) : 'localhost' ?>\"\n                       size=\"30\" style=\"width:275px\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: localhost </em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">SMTP&nbsp;port :&nbsp;</td>\n            <td><input name=\"smtp_port\" type=\"text\" class=\"f11b\" id=\"smtp_port\" style=\"width:275px\"\n                       value=\"<?php echo ($phpwcms['SMTP_PORT']) ? intval($phpwcms['SMTP_PORT']) : '25'; ?>\" size=\"30\">\n            </td>\n            <td class=\"chatlist\"><em>&nbsp;default: 25</em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">mail&nbsp;method :&nbsp;</td>\n            <td><select name=\"smtp_mailer\" id=\"smtp_mailer\">\n                    <option value=\"mail\"<?php if (strtolower($phpwcms['SMTP_MAILER']) == 'mail') echo ' selected=\"selected\"'; ?>>\n                        PHP mail()\n                    </option>\n                    <option value=\"smtp\"<?php if (strtolower($phpwcms['SMTP_MAILER']) == 'smtp') echo ' selected=\"selected\"'; ?>>\n                        SMTP\n                    </option>\n                    <option value=\"sendmail\"<?php if (strtolower($phpwcms['SMTP_MAILER']) == 'sendmail') echo ' selected=\"selected\"'; ?>>\n                        UNIX sendmail\n                    </option>\n                </select></td>\n            <td class=\"chatlist\"><em>&nbsp;default: mail (smtp, sendmail) </em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">use&nbsp;SMTP_AUTH :&nbsp;</td>\n            <td><input name=\"smtp_auth\" type=\"checkbox\" id=\"smtp_auth\"\n                       value=\"1\"<?php if (intval($phpwcms['SMTP_AUTH']) == 1) echo ' checked=\"checked\"'; ?> /></td>\n            <td class=\"chatlist\"><em>&nbsp;default: ON </em></td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">SMTP login:&nbsp;</td>\n            <td><input name=\"smtp_user\" type=\"text\" class=\"f11b\" id=\"smtp_user\"\n                       value=\"<?php echo html_specialchars($phpwcms['SMTP_USER']) ?>\" size=\"30\" style=\"width:275px\">\n            </td>\n            <td class=\"chatlist\">&nbsp;</td>\n        </tr>\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n        <tr>\n            <td align=\"right\" class=\"v10\">SMTP&nbsp;password:&nbsp;</td>\n            <td><input name=\"smtp_pass\" type=\"text\" class=\"f11b\" id=\"smtp_pass\" style=\"width:275px\"\n                       value=\"<?php echo html_specialchars($phpwcms['SMTP_PASS']) ?>\" size=\"30\"></td>\n            <td class=\"chatlist\">&nbsp;</td>\n        </tr>\n\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n        </tr>\n\n        <tr>\n            <td align=\"right\" class=\"v10\">secure connection:&nbsp;</td>\n            <td><select name=\"smtp_secure\" id=\"smtp_secure\">\n                    <option value=\"\"<?php if (empty($phpwcms['SMTP_SECURE'])) echo ' selected=\"selected\"'; ?>>default\n                        (no secure connection)\n                    </option>\n                    <option value=\"ssl\"<?php if (strtolower($phpwcms['SMTP_SECURE']) == 'ssl') echo ' selected=\"selected\"'; ?>>\n                        SSL\n                    </option>\n                    <option value=\"tls\"<?php if (strtolower($phpwcms['SMTP_SECURE']) == 'tls') echo ' selected=\"selected\"'; ?>>\n                        TLS\n                    </option>\n                </select></td>\n            <td>&nbsp;</td>\n        </tr>\n\n        <tr>\n            <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"15\"></td>\n        </tr>\n\n        <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\"><input name=\"Submit\" type=\"submit\" class=\"button\" value=\"send site data\"></td>\n        </tr>\n\n    </table>\n    <input name=\"do\" type=\"hidden\" value=\"1\">\n</form>", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\nif (!defined('PHP8')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n\n?>\n<p class=\"title\">phpwcms path settings </p>\n<p>Please check that any path value does NOT begin or end with a slash. I recommend\n  to use the default values. It's the best way for 1st time\n  usage.</p>\n<form action=\"setup.php?step=3\" method=\"post\"><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n  <tr>\n    <td align=\"right\" class=\"v10\">&nbsp;</td>\n    <td colspan=\"2\" class=\"chatlist\">document root of your web account; empty\n      for default value<br><?php echo  html_specialchars($_SERVER['DOCUMENT_ROOT']) ?></td>\n  </tr>\n  <tr>\n    <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n  </tr>\n  <tr>\n    <td align=\"right\" class=\"v10\">root path :&nbsp;</td>\n    <td><input name=\"doc_root\" type=\"text\" class=\"f11b\" id=\"doc_root\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"DOC_ROOT\"]) ?>\" size=\"30\" maxlength=\"100\"></td>\n    <td class=\"chatlist\"><em>&nbsp;default: $_SERVER['DOCUMENT_ROOT'] </em></td>\n  </tr>\n  <tr>\n    <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td>\n  </tr>\n  <tr>\n    <td align=\"right\" class=\"v10\">&nbsp;</td>\n    <td colspan=\"2\" class=\"chatlist\">if you install in another directory than\n      your base webserver root<br />\n      insert the directory name here - most times this is the part after<br>\n      your\n      base URL like http://mysite.com/<strong>phpwcms_root</strong></td>\n  </tr>\n  <tr>\n    <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td>\n  </tr>\n  <tr>\n    <td align=\"right\" class=\"v10\">phpwcms root:&nbsp;</td>\n    <td><input name=\"root\" type=\"text\" class=\"f11b\" id=\"root\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"root\"]) ?>\" size=\"30\" maxlength=\"100\">\n    </td>\n    <td class=\"chatlist\"><em>&nbsp;default: (empty)</em></td>\n  </tr>\n  <tr>\n    <td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td>\n  </tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">it's recommend to\n              put this directory outside a folder<br />\n              available via web. you can use it like this ../filearchive</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">filestorage:&nbsp;</td>\n            <td><input name=\"file_path\" type=\"text\" class=\"f11b\" id=\"file_path\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"file_path\"]) ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: filearchive </em></td>\n          </tr><tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">here are the template directories located where all<br />template stuff is stored</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">templates:&nbsp;</td>\n            <td><input name=\"templates\" type=\"text\" class=\"f11b\" id=\"templates\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"templates\"]) ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: template</em></td>\n          </tr><tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">this is the directory in which you\n              can upload files for ftp takeover<br />\n              functionality - maybe this\n              can be extended for special user ftp directories.<br />\n              you can also use it like this: ../../myftpdir\n            </td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">ftp&nbsp;takeover:&nbsp;</td>\n            <td><input name=\"ftp_path\" type=\"text\" class=\"f11b\" id=\"ftp_path\" style=\"width:300px\" value=\"<?php echo html_specialchars($phpwcms[\"ftp_path\"]) ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: upload </em></td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"15\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\"><input name=\"Submit\" type=\"submit\" class=\"button\" value=\"send path values\"></td>\n          </tr>\n</table>\n  <input name=\"do\" type=\"hidden\" value=\"1\"></form>", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\nif (!defined('PHP8')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n\n?><p class=\"title\">phpwcms content values</p>\n<form action=\"setup.php?step=4\" method=\"post\"><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">this is the max size of files can\n              be uploaded</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">upload file size:&nbsp;</td>\n            <td><input name=\"file_maxsize\" type=\"text\" class=\"f11b\" id=\"file_maxsize\" style=\"width:125px\" value=\"<?php echo $phpwcms[\"file_maxsize\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: 2 x 1024 x 1024 = 2097152\n                Bytes </em></td>\n          </tr><tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">the width of the frontend main content\n              block<br />\n              base value of creating image lists</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">content width:&nbsp;</td>\n            <td><input name=\"content_width\" type=\"text\" class=\"f11b\" id=\"content_width\" style=\"width:125px\" value=\"<?php echo $phpwcms[\"content_width\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: 538</em></td>\n          </tr>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">width and height of list image thumbnails</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">list image:&nbsp;</td>\n            <td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n              <tr>\n                <td><input name=\"img_list_width\" type=\"text\" class=\"f11b\" id=\"img_list_width\" style=\"width:55px\" value=\"<?php echo $phpwcms[\"img_list_width\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n                <td class=\"v10\">&nbsp;x&nbsp;</td>\n                <td><input name=\"img_list_height\" type=\"text\" class=\"f11b\" id=\"img_list_height\" style=\"width:55px\" value=\"<?php echo $phpwcms[\"img_list_height\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n              </tr>\n            </table></td>\n            <td class=\"chatlist\"><em>&nbsp;default: width 100 x height 75</em></td>\n          </tr><tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">width and height of preview images<br />\n              recommend is to use the same width as main<br />\n              content block - for better quality use larger<br />\n              if the source image is smaller it will not be<br />\n              sized to this larger values</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">preview image:&nbsp;</td>\n            <td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n              <tr>\n                <td><input name=\"img_prev_width\" type=\"text\" class=\"f11b\" id=\"img_prev_width\" style=\"width:55px\" value=\"<?php echo $phpwcms[\"img_prev_width\"] ?>\" size=\"30\" maxlength=\"100\">                </td>\n                <td class=\"v10\">&nbsp;x&nbsp;</td>\n                <td><input name=\"img_prev_height\" type=\"text\" class=\"f11b\" id=\"img_prev_height\" style=\"width:55px\" value=\"<?php echo $phpwcms[\"img_prev_height\"] ?>\" size=\"30\" maxlength=\"100\">                </td>\n              </tr>\n            </table></td>\n            <td class=\"chatlist\"><em>&nbsp;default: width 538 x height 400</em></td>\n          </tr>\n          <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"4\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\" class=\"chatlist\">if there is no activities within\n              the backend<br />\n              you will be automaticly logged out after<br />\n              that time (seconds)</td>\n          </tr>\n\t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">logout time:&nbsp;</td>\n            <td><input name=\"max_time\" type=\"text\" class=\"f11b\" id=\"max_time\" style=\"width:125px\" value=\"<?php echo $phpwcms[\"max_time\"] ?>\" size=\"30\" maxlength=\"100\"></td>\n            <td class=\"chatlist\"><em>&nbsp;default: 1800 seconds</em></td>\n          </tr>\n \t\t  <tr><td colspan=\"3\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"20\"></td></tr>\n          <tr>\n            <td align=\"right\" class=\"v10\">&nbsp;</td>\n            <td colspan=\"2\"><input name=\"Submit\" type=\"submit\" class=\"button\" value=\"send content values\"></td>\n          </tr>\n</table>\n<input name=\"do\" type=\"hidden\" value=\"1\"></form>", "<?php\n/**\n * phpwcms content management system\n *\n * @author Oliver Georgi <og@phpwcms.org>\n * @copyright Copyright (c) 2002-2021, Oliver Georgi\n * @license http://opensource.org/licenses/GPL-2.0 GNU GPL-2\n * @link http://www.phpwcms.org\n *\n **/\n\nif (!defined('PHP8')) {\n    die(\"You Cannot Access This Script Directly, Have a Nice Day.\");\n}\n\n$_SERVER['DOCUMENT_ROOT'] = $phpwcms['DOC_ROOT'];\n$phpwcms[\"root\"] = !empty($phpwcms[\"root\"]) ? \"/\".$phpwcms[\"root\"] : \"\";\n\n?>\n\n<p><span class=\"title\"><strong>Ready to start phpwcms?</strong> Some &quot;problems&quot;\n    maybe OK - you can check by testing phpwcms installation.</span></p>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n  <tr><?php\n\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"file_path\"]);\n  if($status != 2) {\n  \t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"file_path\"], 0777, $status);\n  }\n\n  ?>\n    <td align=\"right\" class=\"v10\">filestorage:&nbsp;</td>\n\t<td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"file_path\"]) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n    <tr><?php\n\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"file_path\"].'/can_be_deleted');\n  if($status != 2) {\n  \t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"file_path\"].'/can_be_deleted', 0777, $status);\n  }\n\n\n  ?>\n\t<td align=\"right\" class=\"v10\">deleted&nbsp;files:&nbsp;</td>\n\t<td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"file_path\"].'/can_be_deleted') ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"]);\n\n  ?>\n    <td align=\"right\" class=\"v10\">templates:&nbsp;</td>\n    <td<?php echo gib_bg_color($status) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"templates\"]) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status==1 ? 3 : $status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n\n  $template_lang_path = trim($phpwcms[\"templates\"], '/').'/template_lang';\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$template_lang_path);\n  if($status != 2) {\n  \t$status = set_chmod($phpwcms[\"root\"].\"/\".$template_lang_path, 0777, $status);\n  }\n\n  ?>\n    <td align=\"right\" class=\"v10\">template&nbsp;languages:&nbsp;</td>\n    <td<?php echo gib_bg_color($status) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($template_lang_path) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  $status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"ftp_path\"]);\n  if($status != 2) {\n  \t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"ftp_path\"], 0777, $status);\n  }\n\n  ?>\n    <td align=\"right\" class=\"v10\">ftp&nbsp;takeover:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"ftp_path\"]) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"8\"></td></tr>\n  <tr><?php\t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"]);\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;content:&nbsp;</td>\n    <td<?php echo gib_bg_color($status) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"]) ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status==1 ? 3 : $status) ?></td>\n  </tr>\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/images\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/images\", 0777, $status);\n  \t}\n\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;images:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/images\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/form\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/form\", 0777, $status);\n  \t}\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;form:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/form\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/tmp\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/tmp\", 0777, $status);\n  \t}\n\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;tmp:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/tmp\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/rss\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/rss\", 0777, $status);\n  \t}\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;rss:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/rss\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n    <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_path_status($phpwcms[\"root\"].\"/\".$phpwcms[\"content_path\"].\"/pages\");\n\t?>\n    <td align=\"right\" class=\"v10\">frontend&nbsp;pages:&nbsp;</td>\n    <td<?php echo gib_bg_color($status) ?>>&nbsp;<strong style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"content_path\"].\"/pages\") ?></strong>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status==1 ? 3 : $status) ?></td>\n  </tr>\n\n       <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"8\"></td></tr>\n  <tr><?php\n  \t$status = check_file_status($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/inc_default/startup.php\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/inc_default/startup.php\", 0666, $status, 1);\n  \t}\n\t?>\n    <td align=\"right\" class=\"v10\">startup text:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<span style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"templates\"].\"/inc_default/startup.php\") ?></span>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n         <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_file_status($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/inc_css/frontend.css\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/inc_css/frontend.css\", 0666, $status, 1);\n  \t}\n\n\t?>\n    <td align=\"right\" class=\"v10\">main CSS file:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<span style=\"color:#fff;\"><?php echo html_specialchars($phpwcms[\"templates\"].\"/inc_css/frontend.css\") ?></span>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr><td colspan=\"4\" class=\"v10\"><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"2\"></td></tr>\n  <tr><?php\n  \t$status = check_file_status($phpwcms[\"root\"].\"/include/config/conf.indexpage.inc.php\");\n\tif($status != 2) {\n  \t\t$status = set_chmod($phpwcms[\"root\"].\"/\".$phpwcms[\"templates\"].\"/include/config/conf.indexpage.inc.php\", 0666, $status, 1);\n  \t}\n\n\t?>\n    <td align=\"right\" class=\"v10\">index level settings:&nbsp;</td>\n    <td<?php echo gib_bg_color($status==2?2:0) ?>>&nbsp;<span style=\"color:#fff;\"><?php echo html_specialchars(\"include/config/conf.indexpage.inc.php\") ?></span>&nbsp;</td>\n    <td><img src=\"../img/leer.gif\" alt=\"\" width=\"1\" height=\"19\"></td>\n    <td><?php echo gib_status_text($status) ?></td>\n  </tr>\n\n  <tr>\n    <td colspan=\"4\" class=\"v10\">&nbsp;</td>\n  </tr>\n  <tr>\n    <td align=\"right\" class=\"v10\">&nbsp;</td>\n    <td colspan=\"3\"><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" summary=\"\">\n      <tr>\n        <td bgcolor=\"#99CC00\">&nbsp;&nbsp;&nbsp;</td>\n        <td class=\"v10\">&nbsp;OK&nbsp;&nbsp;</td>\n        <td bgcolor=\"#FF3300\">&nbsp;&nbsp;&nbsp;</td>\n        <td class=\"v10\">&nbsp;PROBLEM</td>\n      </tr>\n    </table></td>\n  </tr>\n</table>\n<?php\n\n$this_root = dirname(dirname(dirname(__FILE__)));\n$config_setup = read_textfile($this_root.'/setup/setup.conf.inc.php');\n$config_setup = str_replace('?>', \"\\$NO_ACCESS = true;\\n\\n\", $config_setup);\n$result = false;\nif(!is_file($this_root.'/include/config/conf.inc.php')) {\n\n\t// try to chmod\n\t//set_chmod($phpwcms[\"root\"].\"/include/config',\n\n\t// Try to write config file to the correct position\n\tif(!write_textfile($this_root.'/include/config/conf.inc.php', $config_setup)) {\n\n\t\t// Try to copy\n\t\tif(!@copy($this_root.'/setup/setup.conf.inc.php', $this_root.'/include/config/conf.inc.php')) {\n\n\t\t\t// Try to move\n\t\t\tif(@rename($this_root.'/setup/setup.conf.inc.php', $this_root.'/include/config/conf.inc.php')) {\n\t\t\t\t// moved successfully\n\t\t\t\t$result = true;\n\t\t\t}\n\n\t\t} else {\n\t\t\t// copied successfully\n\t\t\t$result = true;\n\t\t}\n\n\t} else {\n\t\t// written successfully\n\t\t$result = true;\n\t}\n}\n\n// Try to secure setup folder\n@write_textfile($this_root.'/setup/.htaccess', 'Deny from all');\n\nif($result): ?>\n<p style=\"font-weight:bold;color:#99CC00;\">\n\tThe conf.inc.php was created successfully and placed at the right position by the setup script.\n</p>\n<?php else: ?>\n<p style=\"font-weight:bold;color:#FF3300;\">\n\tThe conf.inc.php could not placed at the right position by the setup script.\n</p>\n<?php endif; ?>\n<?php\n// Create default .htaccess\nif(is_file($this_root.'/.htaccess')):\n?>\n<p style=\"font-weight:bold;color:#FF3300;\">\n    A <strong>.htaccess</strong> file exists. Compare against the <a href=\"../_.htaccess\" target=\"_blank\">default</a>.\n    If you want to use segmented URLs it is necessary to configure the Rewrite process.\n</p>\n<?php else:\n    $result = false;\n    // Try to copy\n    if(!@copy($this_root.'/_.htaccess', $this_root.'/.htaccess')) {\n        // Try to move\n        if(@rename($this_root.'/_.htaccess', $this_root.'/.htaccess')) {\n            // moved successfully\n            $result = true;\n        }\n    } else {\n        $result = true;\n    }\n    if($result): ?>\n        <p style=\"font-weight:bold;color:#99CC00;\">\n            A default <strong>.htaccess</strong> file was placed in the document root of your installation.\n            This file usually is hidden because of the leading <strong>.</strong> in the file name.\n            <?php\n            if($phpwcms[\"root\"] && $htaccess = @read_textfile($this_root.'/.htaccess')) {\n                $htaccess = str_replace('RewriteBase /', '#RewriteBase /', $htaccess);\n                $htaccess = str_replace('#RewriteBase /subfolder/', 'RewriteBase /' . trim($phpwcms[\"root\"], '/') . '/', $htaccess);\n                write_textfile($this_root.'/.htaccess', $htaccess);\n            }\n            ?>\n        </p>\n    <?php else: ?>\n        <p style=\"font-weight:bold;color:#FF3300;\">\n            Writing the <strong>.htaccess</strong> file to the document root of your installation failed.\n            If you want to use Rewrite please configure it manually. See the file\n            <a href=\"../_.htaccess\" target=\"_blank\">_.htaccess</a>.\n        </p>\n    <?php endif; ?>\n<?php endif; ?>\n<h4>The manual way to finish setup</h4>\n<p>\n\tDownload the config file <a href=\"get_conf_file.php\"><strong>here</strong></a> and copy it to ./include/config/<strong>conf.inc.php</strong>\n\t&#8212; you can also edit values manually. Maybe you have to rename the file if you download\n\tusing Internet Explorer (name is: <strong>conf.inc.php</strong>). Another possible way is to\n\tconnect to your account by ftp. Then place the file ./setup/<strong>setup.conf.inc.php</strong>  in ./include/config. There you have to delete or rename default conf.inc.php &#8212; then\n\trename setup.conf.inc.php to conf.inc.php. It's not possible to start the setup\n\tprocess again as long the setup folder still exists and if you have downloaded\n\tthe created config file once.<br>\n\t<br>\n\t<strong style=\"color:#FF0000;\">ATTENTION!!!<br>Delete\n\tthe &quot;setup&quot; folder\n\totherwise everybody might see your username, passwords and settings.</strong>\n</p>\n<p>\n\tTo makes changes again or proof your values:<br />\n\t&#8212; <a href=\"setup.php?step=1\">MySQL database infos</a><br />\n\t&#8212; <a href=\"setup.php?step=2\">site infos and admin account</a><br />\n\t&#8212; <a href=\"setup.php?step=3\">path values</a><br />\n\t&#8212; <a href=\"setup.php?step=4\">content values</a>\n</p>\n<p>\n\tPlease check infos about system and PHP version with the requirements. <strong>Very\n    important when you use ImageMagick:</strong> Please check that the system\n    can find the application (paths must be registered to the system - try this\n    by using &quot;convert -version&quot; inside your terminal or command line).\n    Check <a href=\"http://www.imagemagick.org/\" target=\"_blank\">http://www.imagemagick.org</a>\n    for additional information.\n</p>\n"], "filenames": ["include/inc_lib/dbcon.inc.php", "include/inc_lib/revision/revision.php", "setup/inc/setup.check.inc.php", "setup/inc/step0.inc.php", "setup/inc/step1.inc.php", "setup/inc/step2.inc.php", "setup/inc/step3.inc.php", "setup/inc/step4.inc.php", "setup/inc/step5.inc.php"], "buggy_code_start_loc": [19, 13, 1, 10, 10, 10, 10, 10, 11], "buggy_code_end_loc": [52, 14, 224, 10, 309, 10, 10, 10, 11], "fixing_code_start_loc": [19, 13, 2, 11, 11, 11, 11, 11, 12], "fixing_code_end_loc": [54, 14, 237, 15, 313, 15, 15, 15, 15], "type": "CWE-89", "message": "A vulnerability was found in slackero phpwcms up to 1.9.26 and classified as critical. Affected by this issue is some unknown functionality. The manipulation of the argument $phpwcms['db_prepend'] leads to sql injection. The attack may be launched remotely. Upgrading to version 1.9.27 is able to address this issue. The name of the patch is 77dafb6a8cc1015f0777daeb5792f43beef77a9d. It is recommended to upgrade the affected component. VDB-217418 is the identifier assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2021-4301", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-07T22:15:08.800", "lastModified": "2023-01-12T20:05:49.253", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in slackero phpwcms up to 1.9.26 and classified as critical. Affected by this issue is some unknown functionality. The manipulation of the argument $phpwcms['db_prepend'] leads to sql injection. The attack may be launched remotely. Upgrading to version 1.9.27 is able to address this issue. The name of the patch is 77dafb6a8cc1015f0777daeb5792f43beef77a9d. It is recommended to upgrade the affected component. VDB-217418 is the identifier assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 6.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpwcms:phpwcms:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.9.27", "matchCriteriaId": "C863174F-8801-4135-B74F-CEFF6D5140C3"}]}]}], "references": [{"url": "https://github.com/slackero/phpwcms/commit/77dafb6a8cc1015f0777daeb5792f43beef77a9d", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/slackero/phpwcms/releases/tag/v1.9.27", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217418", "source": "cna@vuldb.com", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "https://vuldb.com/?id.217418", "source": "cna@vuldb.com", "tags": ["Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/slackero/phpwcms/commit/77dafb6a8cc1015f0777daeb5792f43beef77a9d"}}