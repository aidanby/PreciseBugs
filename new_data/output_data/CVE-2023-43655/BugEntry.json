{"buggy_code": ["#!/usr/bin/env php\n<?php\n\nif (PHP_SAPI !== 'cli' && PHP_SAPI !== 'phpdbg') {\n    echo 'Warning: Composer should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;\n}\n\nsetlocale(LC_ALL, 'C');\nrequire __DIR__.'/../src/bootstrap.php';\n\nuse Composer\\Console\\Application;\nuse Composer\\XdebugHandler\\XdebugHandler;\nuse Composer\\Util\\ErrorHandler;\n\nerror_reporting(-1);\n\n// Restart without Xdebug\n$xdebug = new XdebugHandler('Composer', '--ansi');\n$xdebug->check();\nunset($xdebug);\n\nif (defined('HHVM_VERSION') && version_compare(HHVM_VERSION, '4.0', '>=')) {\n    echo 'HHVM 4.0 has dropped support for Composer, please use PHP instead. Aborting.'.PHP_EOL;\n    exit(1);\n}\n\nif (function_exists('ini_set')) {\n    @ini_set('display_errors', 1);\n\n    $memoryInBytes = function ($value) {\n        $unit = strtolower(substr($value, -1, 1));\n        $value = (int) $value;\n        switch($unit) {\n            case 'g':\n                $value *= 1024;\n                // no break (cumulative multiplier)\n            case 'm':\n                $value *= 1024;\n                // no break (cumulative multiplier)\n            case 'k':\n                $value *= 1024;\n        }\n\n        return $value;\n    };\n\n    $memoryLimit = trim(ini_get('memory_limit'));\n    // Increase memory_limit if it is lower than 1.5GB\n    if ($memoryLimit != -1 && $memoryInBytes($memoryLimit) < 1024 * 1024 * 1536) {\n        @ini_set('memory_limit', '1536M');\n    }\n    // Set user defined memory limit\n    if ($memoryLimit = getenv('COMPOSER_MEMORY_LIMIT')) {\n        @ini_set('memory_limit', $memoryLimit);\n    }\n    unset($memoryInBytes, $memoryLimit);\n}\n\nputenv('COMPOSER_BINARY='.realpath($_SERVER['argv'][0]));\n\nErrorHandler::register();\n\n// run the command application\n$application = new Application();\n$application->run();\n"], "fixing_code": ["#!/usr/bin/env php\n<?php\n\nif (PHP_SAPI !== 'cli' && PHP_SAPI !== 'phpdbg') {\n    if (0 === strpos(__FILE__, 'phar:') && ini_get('register_argc_argv')) {\n        echo 'Composer cannot be run safely on non-CLI SAPIs with register_argc_argv=On. Aborting.'.PHP_EOL;\n        exit(1);\n    }\n\n    echo 'Warning: Composer should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;\n}\n\nsetlocale(LC_ALL, 'C');\nrequire __DIR__.'/../src/bootstrap.php';\n\nuse Composer\\Console\\Application;\nuse Composer\\XdebugHandler\\XdebugHandler;\nuse Composer\\Util\\ErrorHandler;\n\nerror_reporting(-1);\n\n// Restart without Xdebug\n$xdebug = new XdebugHandler('Composer', '--ansi');\n$xdebug->check();\nunset($xdebug);\n\nif (defined('HHVM_VERSION') && version_compare(HHVM_VERSION, '4.0', '>=')) {\n    echo 'HHVM 4.0 has dropped support for Composer, please use PHP instead. Aborting.'.PHP_EOL;\n    exit(1);\n}\n\nif (function_exists('ini_set')) {\n    @ini_set('display_errors', 1);\n\n    $memoryInBytes = function ($value) {\n        $unit = strtolower(substr($value, -1, 1));\n        $value = (int) $value;\n        switch($unit) {\n            case 'g':\n                $value *= 1024;\n                // no break (cumulative multiplier)\n            case 'm':\n                $value *= 1024;\n                // no break (cumulative multiplier)\n            case 'k':\n                $value *= 1024;\n        }\n\n        return $value;\n    };\n\n    $memoryLimit = trim(ini_get('memory_limit'));\n    // Increase memory_limit if it is lower than 1.5GB\n    if ($memoryLimit != -1 && $memoryInBytes($memoryLimit) < 1024 * 1024 * 1536) {\n        @ini_set('memory_limit', '1536M');\n    }\n    // Set user defined memory limit\n    if ($memoryLimit = getenv('COMPOSER_MEMORY_LIMIT')) {\n        @ini_set('memory_limit', $memoryLimit);\n    }\n    unset($memoryInBytes, $memoryLimit);\n}\n\nputenv('COMPOSER_BINARY='.realpath($_SERVER['argv'][0]));\n\nErrorHandler::register();\n\n// run the command application\n$application = new Application();\n$application->run();\n"], "filenames": ["bin/composer"], "buggy_code_start_loc": [4], "buggy_code_end_loc": [4], "fixing_code_start_loc": [5], "fixing_code_end_loc": [10], "type": "CWE-74", "message": "Composer is a dependency manager for PHP. Users publishing a composer.phar to a public web-accessible server where the composer.phar can be executed as a php file may be subject to a remote code execution vulnerability if PHP also has `register_argc_argv` enabled in php.ini. Versions 2.6.4, 2.2.22 and 1.10.27 patch this vulnerability. Users are advised to upgrade. Users unable to upgrade should make sure `register_argc_argv` is disabled in php.ini, and avoid publishing composer.phar to the web as this is not best practice.\n", "other": {"cve": {"id": "CVE-2023-43655", "sourceIdentifier": "security-advisories@github.com", "published": "2023-09-29T20:15:09.987", "lastModified": "2023-11-03T21:15:16.420", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "Composer is a dependency manager for PHP. Users publishing a composer.phar to a public web-accessible server where the composer.phar can be executed as a php file may be subject to a remote code execution vulnerability if PHP also has `register_argc_argv` enabled in php.ini. Versions 2.6.4, 2.2.22 and 1.10.27 patch this vulnerability. Users are advised to upgrade. Users unable to upgrade should make sure `register_argc_argv` is disabled in php.ini, and avoid publishing composer.phar to the web as this is not best practice.\n"}, {"lang": "es", "value": "Composer es un administrador de dependencias para PHP. Los usuarios que publican un composer.phar en un servidor p\u00fablico accesible desde la web donde se puede ejecutar el composer.phar como un archivo php pueden estar sujetos a una vulnerabilidad de ejecuci\u00f3n remota de c\u00f3digo si PHP tambi\u00e9n tiene `register_argc_argv` habilitado en php.ini. Las versiones 2.6.4, 2.2.22 y 1.10.27 corrigen esta vulnerabilidad. Se recomienda a los usuarios que actualicen. Los usuarios que no puedan actualizar deben asegurarse de que `register_argc_argv` est\u00e9 deshabilitado en php.ini y evitar publicar composer.phar en la web, ya que esta no es la mejor pr\u00e1ctica."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 6.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 0.5, "impactScore": 5.9}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-74"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:getcomposer:composer:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.10.27", "matchCriteriaId": "66CB8B8A-9709-486A-BFA5-B92C4A11FA03"}, {"vulnerable": true, "criteria": "cpe:2.3:a:getcomposer:composer:*:*:*:*:*:*:*:*", "versionStartIncluding": "2.0.0", "versionEndExcluding": "2.2.21", "matchCriteriaId": "BFF216E8-6DB2-42E3-8AC8-A3F09E295E5C"}, {"vulnerable": true, "criteria": "cpe:2.3:a:getcomposer:composer:*:*:*:*:*:*:*:*", "versionStartIncluding": "2.3.0", "versionEndExcluding": "2.6.4", "matchCriteriaId": "23A42BAC-CC39-4A97-9A3B-60654E18A061"}]}]}, {"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:o:fedoraproject:fedora:37:*:*:*:*:*:*:*", "matchCriteriaId": "E30D0E6F-4AE8-4284-8716-991DFA48CC5D"}, {"vulnerable": true, "criteria": "cpe:2.3:o:fedoraproject:fedora:38:*:*:*:*:*:*:*", "matchCriteriaId": "CC559B26-5DFC-4B7A-A27C-B77DE755DFF9"}]}]}], "references": [{"url": "https://github.com/composer/composer/commit/4fce14795aba98e40b6c4f5047305aba17a6120d", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/composer/composer/commit/955a48e6319c8962e5cd421b07c00ab3c728968c", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/composer/composer/commit/95e091c921037b7b6564942845e7b738f6b95c9c", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/composer/composer/security/advisories/GHSA-jm6m-4632-36hf", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}, {"url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/66H2WKFUO255T3BZTL72TNYJYH2XM5FG/", "source": "security-advisories@github.com"}, {"url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/7AWYAUZNH565NWPIKGEIYBWHYNM5JGAE/", "source": "security-advisories@github.com", "tags": ["Mailing List", "Third Party Advisory"]}, {"url": "https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/KFOPGPW2KS37O3KJWBRGTUWHTXCQXBS2/", "source": "security-advisories@github.com", "tags": ["Mailing List", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/composer/composer/commit/4fce14795aba98e40b6c4f5047305aba17a6120d"}}