{"buggy_code": ["import javax.mail.Session;\nimport javax.servlet.RequestDispatcher;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\nimport java.io.IOException;\nimport java.sql.SQLException;\n\n/**\n * Created by chris on 09/12/14.\n */\n\n/**\n * Servlet for adding contacts\n */\n@WebServlet(\"/addcontact\")\npublic class AddContact extends HttpServlet {\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n        //Checks whether session has timed out\n        if (System.currentTimeMillis() > (request.getSession().getLastAccessedTime() + 300000)) {\n            RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\");    //New Request Dispatcher\n            request.setAttribute(\"error\", \"Login session timed out, please click retry to log back in\");\n            request.setAttribute(\"previous\", \"index.html\");\n            dispatcher.forward(request, response);    //Forwards to the page\n        } else {\n\n            HttpSession httpSession = request.getSession();     //Get Session details\n            Session session = (Session) httpSession.getAttribute(\"session\");\n            String user = session.getProperties().getProperty(\"mail.user\");\n\n            String forename = request.getParameter(\"firstname\");\n            String surname = request.getParameter(\"secondname\");\n            String email = request.getParameter(\"email\");\n\n            Model m = new Model(user);      //Initialize model\n\n            try {\n                m.addContact(forename, surname, email, user);\n                httpSession.setAttribute(\"success\", \"<p id=\\\"success\\\">Contact saved successfully</p>\");\n                request.getRequestDispatcher(\"addcontact.jsp\").forward(request, response);\n            } catch (SQLException e) {\n\n                RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n                request.setAttribute(\"error\", e.getMessage());\n                request.setAttribute(\"previous\", \"searchcontact\");\n                dispatcher.forward(request, response);\n            }\n        }\n    }\n\n}\n", "import javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.io.PrintWriter;\n\npublic class Error extends HttpServlet {\n\n    /**\n     * Calls doPost\n     */\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\n        doPost(request, response);\n\n    }\n\n    /**\n     * Gets the PrintWriter from the response and prints the HTML to show the error page\n     */\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\n        if (System.currentTimeMillis() > (request.getSession().getLastAccessedTime() + 300000)) {\n            request.setAttribute(\"error\", \"Login session timed out, please click retry to log back in\");\n            request.setAttribute(\"previous\", \"index.html\");\n        }\n        PrintWriter out = response.getWriter();    //Gets the PrintWriter\n        String back;\n        String previous = (String) request.getAttribute(\"previous\");\n        if (previous.equals(\"/LoginController\") || previous.equals(\"index.html\")) {\n            back = \"index.html\";\n        } else if (previous.equals(\"searchcontact\")) {\n            back = \"contact.jsp\";\n        } else {\n            back = \"email.html\";\n        }\n        out.println(\n                \"<!DOCTYPE html>\" +\n                        \"<html>\" +\n                        \"<head lang=\\\"en\\\">\" +\n                        \"<meta charset=\\\"UTF-8\\\">\" +\n                        \"<title>Error Occured</title>\" +\n                        \"</head>\" +\n                        \"<body>\" +\n                        \"<center>\" +\n                        \"<h1>Error Occurred!</h1>\" +\n                        \"<div>\" +\n                        \"<br>\" +\n                        \"Error: \" + request.getAttribute(\"error\") + \"<br>\" + \"<br>\" + \"<br>\" +//Gets the error message\n                        \"</div>\" +\n                        \"<div class='error-actions'>\" +\n                        \"<a href='\" + back + \"'>Retry</a>\" +\n                        \"</div>\" +\n                        \"</center>\" +\n                        \"</body>\" +\n                        \"</html>\"\n        );\n\n    }\n\n}\n", "import javax.mail.MessagingException;\nimport javax.mail.Session;\nimport javax.mail.Store;\nimport javax.servlet.RequestDispatcher;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.util.Properties;\n\n/**\n * Created by chris on 08/12/14.\n */\n\n@WebServlet(\"/login\")\npublic class Login extends HttpServlet {\n\n    public Login() {\n        super();\n    }\n\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\n\n        String username = request.getParameter(\"username\"); //Gets all the parameters\n        String password = request.getParameter(\"password\");\n        Properties prop = System.getProperties();\n\n        try {\n\n            prop.put(\"mail.user\", username);\n            prop.put(\"mail.password\", password);\n            prop.put(\"mail.smtp.auth\", \"true\");\n            prop.put(\"mail.smtp.starttls.enable\", \"true\");\n            prop.put(\"mail.smtp.host\", \"smtp.gmail.com\");\n            prop.put(\"mail.smtp.port\", \"587\");\n            prop.put(\"mail.store.protocol\", \"imaps\");\n\n            Session session = Session.getDefaultInstance(prop);\n            Store store = session.getStore(\"imaps\");\n            store.connect(\"imap.googlemail.com\", username, password);\n\n            request.getSession().setAttribute(\"session\", session);\n\n            RequestDispatcher dispatcher = request.getRequestDispatcher(\"email.html\");\n            dispatcher.forward(request, response);\n\n        } catch (MessagingException e) {\n            RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n            request.setAttribute(\"error\", e.getMessage());\n            request.setAttribute(\"previous\", request.getServletPath());\n            dispatcher.forward(request, response);\n        }\n    }\n}\n", "import java.sql.*;\n\n/**\n * Created by chris on 08/12/14.\n */\npublic class Model {\n\n    private String DBNAME = \"jdbc:postgresql://dbteach2.cs.bham.ac.uk/cxm373\";\n    private String USERNAME = \"cxm373\";\n    private String PASSWORD = \"computer2014\";\n    private String emailUser;\n    private Connection conn;\n\n    public Model(String username) {\n        emailUser = username;\n        conn = connect();\n    }\n\n    public Connection connect() {\n        try {\n            Class.forName(\"org.postgresql.Driver\");\n        } catch (ClassNotFoundException e) {\n            System.out.println(\"Driver not found\");\n            System.exit(0);\n        }\n\n        System.out.println(\"PostgreSQL driver registered.\");\n\n        Connection dbConn = null;\n\n        try {\n            dbConn = DriverManager.getConnection(DBNAME, USERNAME, PASSWORD);\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n\n        if (dbConn != null) {\n            System.out.println(\"Connected to database successfully.\");\n        } else {\n            System.out.println(\"Database connection failed.\");\n        }\n        return dbConn;\n\n    }\n\n    public String search(String forename, String surname, String contactemail) throws SQLException {\n\n        String query;\n        if (forename.isEmpty() && surname.isEmpty()) {\n            query = \"\";\n        } else if(forename.isEmpty()) {\n            query = \"familyname LIKE '%\" + surname + \"' and\";\n        } else if(surname.isEmpty()) {\n            query = \"forename LIKE '%\" + forename + \"' and \";\n        } else {\n            query = \"forename LIKE '%\" + forename + \"' and familyname LIKE '%\" + surname + \"' and\";\n        }\n\n    PreparedStatement ps = conn.prepareStatement(\"SELECT * FROM contactinfo WHERE \" + query + \" contactemailaddress = '\" + contactemail + \"'\");\n    ResultSet rs = ps.executeQuery();\n    StringBuilder result = new StringBuilder(\"<h3>Search results...</h3><table class=\\\"result-table\\\">\" +\n            \"<tr>\" +\n            \"<th>Forename</th> <th>Surname</th> <th>Email</th>\" +\n            \"</tr>\");\n    while(rs.next())\n\n    {\n        result.append(\"<tr><td>\");\n        result.append(rs.getString(2));\n        result.append(\"</td><td>\" + rs.getString(3));\n        result.append(\"</td><td>\" + rs.getString(4) + \"</td></tr>\");\n    }\n\n    result.append(\"</table\");\n    return result.toString();\n}\n\n    public void addContact(String firstname, String surname, String email, String user) throws SQLException {\n        PreparedStatement newStudent = conn.prepareStatement(\"INSERT INTO \" +\n                \"contactinfo (forename, familyname, emailaddress, contactemailaddress) VALUES ('\" + firstname + \"', '\" + surname + \"', '\" + email + \"', '\" + user + \"')\");\n        newStudent.execute();\n    }\n}\n", "import javax.mail.Session;\nimport javax.servlet.RequestDispatcher;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\nimport java.io.IOException;\nimport java.sql.SQLException;\n\n/**\n * Created by chris on 09/12/14.\n */\n\n/**\n * Servlet for searching for contacts\n */\n@WebServlet(\"/searchcontact\")\npublic class SearchContact extends HttpServlet {\n\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n        //Checks whether session has timed out\n        if (System.currentTimeMillis() > (request.getSession().getLastAccessedTime() + 300000)) {\n            RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\");    //New Request Dispatcher\n            request.setAttribute(\"error\", \"Login session timed out, please click retry to log back in\");\n            request.setAttribute(\"previous\", \"index.html\");\n            dispatcher.forward(request, response);    //Forwards to the page\n        } else {\n            HttpSession httpSession = request.getSession();\n            Session session = (Session) httpSession.getAttribute(\"session\");\n            String user = session.getProperties().getProperty(\"mail.user\");\n            String searchQueryForeName = request.getParameter(\"forename\");\n            String searchQuerySurName = request.getParameter(\"surname\");\n\n            Model m = new Model(user);\n\n            try {\n                String resultTable = m.search(searchQueryForeName, searchQuerySurName, user);\n                httpSession.setAttribute(\"results\", resultTable);\n                httpSession.setAttribute(\"success\", \"\");\n                request.getRequestDispatcher(\"contact.jsp\").forward(request, response);\n            } catch (SQLException e) {\n                RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n                request.setAttribute(\"error\", e.getMessage());\n                request.setAttribute(\"previous\", \"searchcontact\");\n                dispatcher.forward(request, response);\n            }\n        }\n    }\n\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\n    }\n\n}\n\n", "<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Search for/Add contact</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"styles.css\"/>\n    <script type=\"text/javascript\" src=\"http://code.jquery.com/jquery-latest.js\"></script>\n    <script type=\"text/javascript\">\n      $(document).ready( function() {\n        $('#success').delay(1000).fadeOut();\n      });\n    </script>\n</head>\n<body>\n<a id=\"back\" href=\"http://<%=request.getServerName()%>:<%=request.getServerPort()%>/email.html\">Back</a>\n<div class=\"logout-container\">\n    <form action=\"logout\" method=\"post\">\n        <input id=\"logout\" type=\"submit\" value=\"Log Out\"/>\n    </form>\n</div>\n<section class=\"main\">\n    <h1>Add a contact</h1>\n    <p>Enter a forename, surname and email and click add!</p>\n    <form action=\"addcontact\" method=\"post\">\n        <table class=\"form-table\">\n            <tr>\n                <td>\n                    <b>Forename: </b>\n                </td>\n                <td>\n                    <input id=\"name\" name=\"firstname\" type=\"text\" placeholder=\"...\">\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <b>Surname: </b>\n                </td>\n                <td>\n                    <input id=\"surname\" name=\"secondname\" type=\"text\" placeholder=\"...\">\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <b>Email Address: </b>\n                </td>\n                <td>\n                    <input id=\"email\" name=\"email\" type=\"email\" placeholder=\"...\">\n                </td>\n            </tr>\n            <tr>\n                <td></td>\n                <td>\n                    <input type=\"submit\" value=\"Submit\">\n                    <button type=\"reset\" value=\"Reset\">Reset</button>\n                </td>\n            </tr>\n        </table>\n    </form>\n    <%=request.getSession().getAttribute(\"success\")%>\n</section>\n</body>\n</html>\n", "<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Search for/Add contact</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"styles.css\"/>\n    <script type=\"text/javascript\" src=\"http://code.jquery.com/jquery-latest.js\"></script>\n    <script type=\"text/javascript\">\n    $( \".reset\" ).click(function() {\n    document.getElementByClassName(\"result-table\").remove();\n    </script>\n</head>\n<body>\n<a id=\"back\" href=\"http://<%=request.getServerName()%>:<%=request.getServerPort()%>/email.html\">Back</a>\n<div class=\"logout-container\">\n    <form action=\"logout\" method=\"post\">\n        <input id=\"logout\" type=\"submit\" value=\"Log Out\"/>\n    </form>\n</div>\n<section class=\"main\">\n    <h1>Search for a contact</h1>\n\n    <p>Enter a forename and/or surname and click search!</p>\n\n    <form action=\"searchcontact\" method=\"post\">\n        <table class=\"form-table\">\n            <tr>\n                <td>\n                    <b>Forename: </b>\n                </td>\n                <td>\n                    <input id=\"name\" name=\"forename\" type=\"text\" placeholder=\"...\">\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <b>Surname: </b>\n                </td>\n                <td>\n                    <input id=\"surname\" name=\"surname\" type=\"text\" placeholder=\"...\">\n                </td>\n            </tr>\n            <tr>\n                <td></td>\n                <td>\n                    <input type=\"submit\" value=\"Submit\">\n                    <button class=\"reset\" type=\"reset\" value=\"Reset\">Reset</button>\n                </td>\n            </tr>\n        </table>\n    </form>\n    <%=request.getSession().getAttribute(\"results\")%>\n</section>\n</body>\n</html>\n"], "fixing_code": ["import javax.mail.Session;\nimport javax.servlet.RequestDispatcher;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\nimport java.io.IOException;\nimport java.sql.SQLException;\n\n/**\n * Created by chris on 09/12/14.\n */\n\n/**\n * Servlet for adding contacts\n */\n@WebServlet(\"/addcontact\")\npublic class AddContact extends HttpServlet {\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n        //Checks whether session has timed out\n        if (System.currentTimeMillis() > (request.getSession().getLastAccessedTime() + 300000)) {\n            RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\");    //New Request Dispatcher\n            request.setAttribute(\"error\", \"Login session timed out, please click retry to log back in\");\n            request.setAttribute(\"previous\", \"index.html\");\n            dispatcher.forward(request, response);    //Forwards to the page\n        } else {\n\n            HttpSession httpSession = request.getSession();     //Get Session details\n            Session session = (Session) httpSession.getAttribute(\"session\");\n            String user = session.getProperties().getProperty(\"mail.user\");\n\n            String forename = request.getParameter(\"firstname\");\n            String surname = request.getParameter(\"secondname\");\n            String email = request.getParameter(\"email\");\n\n            Model m = new Model(user);      //Initialize model\n\n            try {\n                m.addContact(forename, surname, email, user);\n                httpSession.setAttribute(\"success\", \"<p id=\\\"success\\\">Contact saved successfully</p>\");\n                request.getRequestDispatcher(\"addcontact.jsp\").forward(request, response);\n            } catch (SQLException e) {\n\n                RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n                request.setAttribute(\"error\", e.getMessage());\n                request.setAttribute(\"previous\", \"addcontact.jsp\");\n                dispatcher.forward(request, response);\n            }\n        }\n    }\n\n}\n", "import javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.io.PrintWriter;\n\npublic class Error extends HttpServlet {\n\n    /**\n     * Calls doPost\n     */\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n        doPost(request, response);\n    }\n\n    /**\n     * Gets the PrintWriter from the response and prints the HTML to show the error page\n     */\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\n        PrintWriter out = response.getWriter();    //Gets the PrintWriter\n        String back = (String) request.getAttribute(\"previous\");\n        out.println(\n                \"<!DOCTYPE html>\" +\n                        \"<html>\" +\n                        \"<head lang=\\\"en\\\">\" +\n                        \"<meta charset=\\\"UTF-8\\\">\" +\n                        \"<title>Error Occured</title>\" +\n                        \"</head>\" +\n                        \"<body>\" +\n                        \"<center>\" +\n                        \"<h1>Error Occurred!</h1>\" +\n                        \"<div>\" +\n                        \"<br>\" +\n                        \"Error: \" + request.getAttribute(\"error\") + \"<br>\" + \"<br>\" + \"<br>\" +//Gets the error message\n                        \"</div>\" +\n                        \"<div class='error-actions'>\" +\n                        \"<a href='\" + back + \"'>Retry</a>\" +\n                        \"</div>\" +\n                        \"</center>\" +\n                        \"</body>\" +\n                        \"</html>\"\n        );\n    }\n}\n", "import javax.mail.MessagingException;\nimport javax.mail.Session;\nimport javax.mail.Store;\nimport javax.servlet.RequestDispatcher;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.util.Properties;\n\n/**\n * Created by chris on 08/12/14.\n */\n\n@WebServlet(\"/login\")\npublic class Login extends HttpServlet {\n\n    public Login() {\n        super();\n    }\n\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\n\n        String username = request.getParameter(\"username\"); //Gets all the parameters\n        String password = request.getParameter(\"password\");\n        Properties prop = System.getProperties();\n\n        try {\n\n            prop.put(\"mail.user\", username);\n            prop.put(\"mail.password\", password);\n            prop.put(\"mail.smtp.auth\", \"true\");\n            prop.put(\"mail.smtp.starttls.enable\", \"true\");\n            prop.put(\"mail.smtp.host\", \"smtp.gmail.com\");\n            prop.put(\"mail.smtp.port\", \"587\");\n            prop.put(\"mail.store.protocol\", \"imaps\");\n\n            Session session = Session.getDefaultInstance(prop);\n            Store store = session.getStore(\"imaps\");\n            store.connect(\"imap.googlemail.com\", username, password);\n\n            request.getSession().setAttribute(\"session\", session);\n\n            RequestDispatcher dispatcher = request.getRequestDispatcher(\"email.html\");\n            dispatcher.forward(request, response);\n\n        } catch (MessagingException e) {\n            RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n            request.setAttribute(\"error\", e.getMessage());\n            request.setAttribute(\"previous\", \"index.html\");\n            dispatcher.forward(request, response);\n        }\n    }\n}\n", "import java.sql.*;\n\n/**\n * Created by chris on 08/12/14.\n */\npublic class Model {\n\n    private String DBNAME = \"jdbc:postgresql://dbteach2.cs.bham.ac.uk/cxm373\";\n    private String USERNAME = \"cxm373\";\n    private String PASSWORD = \"computer2014\";\n    private String emailUser;\n    private Connection conn;\n\n    public Model(String username) {\n        emailUser = username;\n        conn = connect();\n    }\n\n    public Connection connect() {\n        try {\n            Class.forName(\"org.postgresql.Driver\");\n        } catch (ClassNotFoundException e) {\n            System.out.println(\"Driver not found\");\n            System.exit(0);\n        }\n\n        System.out.println(\"PostgreSQL driver registered.\");\n\n        Connection dbConn = null;\n\n        try {\n            dbConn = DriverManager.getConnection(DBNAME, USERNAME, PASSWORD);\n        } catch (SQLException e) {\n            e.printStackTrace();\n        }\n\n        if (dbConn != null) {\n            System.out.println(\"Connected to database successfully.\");\n        } else {\n            System.out.println(\"Database connection failed.\");\n        }\n        return dbConn;\n\n    }\n\n    public String search(String forename, String surname, String contactemail) throws SQLException {\n\n        String query;\n        if (forename.isEmpty() && surname.isEmpty()) {\n            query = \"\";\n        } else if (forename.isEmpty()) {\n            query = \"familyname LIKE '%\" + surname + \"' and\";\n        } else if (surname.isEmpty()) {\n            query = \"forename LIKE '%\" + forename + \"' and \";\n        } else {\n            query = \"forename LIKE '%\" + forename + \"' and familyname LIKE '%\" + surname + \"' and\";\n        }\n\n        PreparedStatement ps = conn.prepareStatement(\"SELECT * FROM contactinfo WHERE ? contactemailaddress = ?\");\n        ps.setString(1, query);\n        ps.setString(2, contactemail);\n        ResultSet rs = ps.executeQuery();\n        StringBuilder result = new StringBuilder(\"<h3>Search results...</h3><table class=\\\"result-table\\\">\" +\n                \"<tr>\" +\n                \"<th>Forename</th> <th>Surname</th> <th>Email</th>\" +\n                \"</tr>\");\n        while (rs.next())\n        {\n            result.append(\"<tr><td>\");\n            result.append(rs.getString(2));\n            result.append(\"</td><td>\" + rs.getString(3));\n            result.append(\"</td><td>\" + rs.getString(4) + \"</td></tr>\");\n        }\n\n        result.append(\"</table\");\n        conn.close();\n        return result.toString();\n    }\n\n    public void addContact(String firstname, String surname, String email, String user) throws SQLException {\n\n        PreparedStatement checkDuplicate = conn.prepareStatement(\"SELECT * FROM contactinfo WHERE emailaddress = ?\");\n        checkDuplicate.setString(1, email);\n        ResultSet rs = checkDuplicate.executeQuery();\n        if (rs.next()) {\n            throw new SQLException(\"Contact already exists\");\n        }\n        PreparedStatement newStudent = conn.prepareStatement(\"INSERT INTO \" +\n                \"contactinfo (forename, familyname, emailaddress, contactemailaddress) VALUES (?, ?, ?, ?)\");\n        newStudent.setString(1, firstname);\n        newStudent.setString(2, surname);\n        newStudent.setString(3, email);\n        newStudent.setString(4, user);\n        newStudent.execute();\n\n        conn.close();\n    }\n}\n\n\n//Todo sort out errors, when logging in unsuccessfully etc\n//Todo format message sent successfully page\n//Todo add some JS to allow user to click search results and send an email to that address\n", "import javax.mail.Session;\nimport javax.servlet.RequestDispatcher;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\nimport java.io.IOException;\nimport java.sql.SQLException;\n\n/**\n * Created by chris on 09/12/14.\n */\n\n/**\n * Servlet for searching for contacts\n */\n@WebServlet(\"/searchcontact\")\npublic class SearchContact extends HttpServlet {\n\n    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n        //Checks whether session has timed out\n        if (System.currentTimeMillis() > (request.getSession().getLastAccessedTime() + 300000)) {\n            RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\");    //New Request Dispatcher\n            request.setAttribute(\"error\", \"Login session timed out, please click retry to log back in\");\n            request.setAttribute(\"previous\", \"index.html\");\n            dispatcher.forward(request, response);    //Forwards to the page\n        } else {\n            HttpSession httpSession = request.getSession();\n            Session session = (Session) httpSession.getAttribute(\"session\");\n            String user = session.getProperties().getProperty(\"mail.user\");\n            String searchQueryForeName = request.getParameter(\"forename\");\n            String searchQuerySurName = request.getParameter(\"surname\");\n\n            Model m = new Model(user);\n\n            try {\n                String resultTable = m.search(searchQueryForeName, searchQuerySurName, user);\n                httpSession.setAttribute(\"results\", resultTable);\n                httpSession.setAttribute(\"success\", \"\");\n                request.getRequestDispatcher(\"contact.jsp\").forward(request, response);\n            } catch (SQLException e) {\n                RequestDispatcher dispatcher = request.getRequestDispatcher(\"Error\"); //New Request Dispatcher\n                request.setAttribute(\"error\", e.getMessage());\n                request.setAttribute(\"previous\", \"contact.jsp\");\n                dispatcher.forward(request, response);\n            }\n        }\n    }\n\n    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\n    }\n\n}\n\n", "<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Search for/Add contact</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"styles.css\"/>\n    <script type=\"text/javascript\" src=\"http://code.jquery.com/jquery-latest.js\"></script>\n    <script type=\"text/javascript\">\n      $(document).ready( function() {\n        $('#success').delay(1000).fadeOut();\n      });\n    </script>\n</head>\n<body>\n<a id=\"back\" href=\"email.html\">Back</a>\n<div class=\"logout-container\">\n    <form action=\"logout\" method=\"post\">\n        <input id=\"logout\" type=\"submit\" value=\"Log Out\"/>\n    </form>\n</div>\n<section class=\"main\">\n    <h1>Add a contact</h1>\n    <p>Enter a forename, surname and email and click add!</p>\n    <form action=\"addcontact\" method=\"post\">\n        <table class=\"form-table\">\n            <tr>\n                <td>\n                    <b>Forename: </b>\n                </td>\n                <td>\n                    <input id=\"name\" name=\"firstname\" type=\"text\" placeholder=\"...\" required>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <b>Surname: </b>\n                </td>\n                <td>\n                    <input id=\"surname\" name=\"secondname\" type=\"text\" placeholder=\"...\">\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <b>Email Address: </b>\n                </td>\n                <td>\n                    <input id=\"email\" name=\"email\" type=\"email\" placeholder=\"...\" required>\n                </td>\n            </tr>\n            <tr>\n                <td></td>\n                <td>\n                    <input type=\"submit\" value=\"Submit\">\n                    <button type=\"reset\" value=\"Reset\">Reset</button>\n                </td>\n            </tr>\n        </table>\n    </form>\n    <%=request.getSession().getAttribute(\"success\")%>\n</section>\n</body>\n</html>\n", "<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Search for/Add contact</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"styles.css\"/>\n    <script type=\"text/javascript\" src=\"http://code.jquery.com/jquery-latest.js\"></script>\n    <script type=\"text/javascript\">\n    $( \".reset\" ).click(function() {\n    document.getElementByClassName(\"result-table\").remove();\n    </script>\n</head>\n<body>\n<a id=\"back\" href=\"email.html\">Back</a>\n<div class=\"logout-container\">\n    <form action=\"logout\" method=\"post\">\n        <input id=\"logout\" type=\"submit\" value=\"Log Out\"/>\n    </form>\n</div>\n<section class=\"main\">\n    <h1>Search for a contact</h1>\n\n    <p>Enter a forename and/or surname and click search!</p>\n\n    <form action=\"searchcontact\" method=\"post\">\n        <table class=\"form-table\">\n            <tr>\n                <td>\n                    <b>Forename: </b>\n                </td>\n                <td>\n                    <input id=\"name\" name=\"forename\" type=\"text\" placeholder=\"...\">\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <b>Surname: </b>\n                </td>\n                <td>\n                    <input id=\"surname\" name=\"surname\" type=\"text\" placeholder=\"...\">\n                </td>\n            </tr>\n            <tr>\n                <td></td>\n                <td>\n                    <input type=\"submit\" value=\"Submit\">\n                    <button class=\"reset\" type=\"reset\" value=\"Reset\">Reset</button>\n                </td>\n            </tr>\n        </table>\n    </form>\n    <%=request.getSession().getAttribute(\"results\")%>\n</section>\n</body>\n</html>\n"], "filenames": ["src/AddContact.java", "src/Error.java", "src/Login.java", "src/Model.java", "src/SearchContact.java", "web/addcontact.jsp", "web/contact.jsp"], "buggy_code_start_loc": [48, 14, 53, 51, 46, 15, 14], "buggy_code_end_loc": [49, 62, 54, 84, 47, 48, 15], "fixing_code_start_loc": [48, 13, 53, 51, 46, 15, 14], "fixing_code_end_loc": [49, 45, 54, 104, 47, 48, 15], "type": "CWE-89", "message": "A vulnerability was found in gmail-servlet and classified as critical. This issue affects the function search of the file src/Model.java. The manipulation leads to sql injection. The name of the patch is 5d72753c2e95bb373aa86824939397dc25f679ea. It is recommended to apply a patch to fix this issue. The identifier VDB-218021 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2014-125075", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-11T19:15:09.013", "lastModified": "2023-01-18T19:16:11.000", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability was found in gmail-servlet and classified as critical. This issue affects the function search of the file src/Model.java. The manipulation leads to sql injection. The name of the patch is 5d72753c2e95bb373aa86824939397dc25f679ea. It is recommended to apply a patch to fix this issue. The identifier VDB-218021 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:gmail-servlet_project:gmail-servlet:-:*:*:*:*:*:*:*", "matchCriteriaId": "49DBD41A-697D-4BBF-825B-C7E79594CF3D"}]}]}], "references": [{"url": "https://github.com/ChrisMcMStone/gmail-servlet/commit/5d72753c2e95bb373aa86824939397dc25f679ea", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.218021", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.218021", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/ChrisMcMStone/gmail-servlet/commit/5d72753c2e95bb373aa86824939397dc25f679ea"}}