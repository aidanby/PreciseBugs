{"buggy_code": ["<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"SELECT galleria FROM tblprodotti WHERE codiceprodotto='%s'\", $_POST['codiceprodotto']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $percorsoThumbnails = '../img/thumb/' . $dati[0]['galleria'] . '/';\r\n\r\n    // La funzione glob cerca tutte le immagini presenti nel percorso specificato.\r\n\r\n    $thumbnails = glob($percorsoThumbnails . \"*\");\r\n\r\n    // Se nella galleria sono presenti immagini\r\n    if($thumbnails) {\r\n        print '<p class=\"informazione\">Seleziona le immagini da eliminare</p>';\r\n\r\n        print '<form id=\"formEliminazioneImmagini\" method=\"post\" action=\"../script/scriptEliminazioneImmagine.php\">';\r\n        print '<input type=\"hidden\" name=\"galleria\" value=\"' . $dati[0]['galleria'] . '\">';\r\n\r\n        // Successivamente le thumbnail relative a ciascuna immagine vengono visualizzate\r\n        // Con la checkbox si indicano quelle da eliminare\r\n\r\n        foreach ($thumbnails as $thumb) {\r\n            print '<div id=\"immagineEliminazione\">';\r\n            print '<div><img src=\"' . $thumb . '\"></div>';\r\n            print '<div><input type=\"checkbox\" name=\"immagine[]\" value=\"' . basename($thumb) . '\"/>';\r\n            print '<label>' . basename($thumb) . '</label></div>';\r\n            print '</div>';\r\n        }\r\n\r\n        print '<div id=\"pulsanteEliminazione\"><input type=\"submit\" value=\"Elimina\"/></div>';\r\n        print '</form>';\r\n\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('#formEliminazioneImmagini','../script/scriptEliminazioneImmagine.php','#coldx');\";\r\n        print '</script>';\r\n    } else {\r\n        print '<p class=\"informazione\">La galleria di questo prodotto &egrave; vuota</p>';\r\n    }\r\n    chiudiConnessione($connessione);\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT codiceprodotto, nomeprodotto FROM tblprodotti WHERE codiceprodotto='\" . $_POST['codiceprodotto'] . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if (!$dati) {\r\n        print '<p class=\"errore\">Il prodotto non \u00e8 stato individuato, controlla il nome inserito</p>';\r\n    } else {\r\n        print '<form method=\"post\" enctype=\"multipart/form-data\" action=\"../script/scriptInserimentoImmagine.php\">';\r\n        print '<fieldset><legend>Inserisci immagini nella galleria di ' . $dati[0]['nomeprodotto'] . '</legend>';\r\n        print '<div class=\"label\"><label>Seleziona le immagini</label></div>';\r\n        print '<input type=\"hidden\" name=\"codiceprodotto\" value=\"' . $dati[0]['codiceprodotto'] . '\"/>';\r\n        print '<input type=\"file\" class=\"obbligatorio\" name=\"immagini[]\" multiple=\"multiple\" accept=\"image/*\" />';\r\n        print '<input type=\"submit\" value=\"Inserisci\" class=\"invia\" />';\r\n        print '</fieldset>';\r\n        print '</form>';\r\n    }\r\n    chiudiConnessione($connessione);\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\nprint '<script type=\"text/javascript\" src=\"'.HOME_WEB.'js/funzioni.js\"></script>';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT * FROM tblcategorie WHERE nome='\" . $_POST['nome'] . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    print '<form id=\"formModificaCategoria\" method=\"post\" action=\"../script/scriptModificaCategoria.php\">';\r\n    print '<fieldset><legend>Informazioni categoria</legend>';\r\n    print '<div class=\"label\"><label >Nome</label></div>';\r\n    // Il seguente campo nascosto viene utilizzato per individuare il vecchio valore della chiave primaria nel database e quindi aggiornarlo\r\n    print '<input type=\"hidden\" name=\"nomeOld\" value=\"' . $dati[0]['nome'] . '\"></input>';\r\n    print '<input type=\"text\" name=\"nome\" value=\"' . $dati[0]['nome'] . '\" class=\"obbligatorio\"></input>';\r\n    print '<input type=\"submit\" value=\"Conferma\" class=\"invia\"></input>';\r\n    print '</fieldset>';\r\n    print \"</form>\";\r\n\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('#formModificaCategoria','../script/scriptModificaCategoria.php','#coldx');\";\r\n    print '</script>';\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\nprint '<script type=\"text/javascript\" src=\"'.HOME_WEB.'js/funzioni.js\"></script>';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT * FROM tblconsole WHERE nome='\" . $_POST['nome'] . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    print '<form id=\"formModificaConsole\" method=\"post\" action=\"../script/scriptModificaConsole.php\">';\r\n    print '<fieldset><legend>Informazioni console</legend>';\r\n    print '<div class=\"label\"><label >Nome</label></div>';\r\n    // Il seguente campo nascosto viene utilizzato per individuare il vecchio valore della chiave primaria nel database e quindi aggiornarlo\r\n    print '<input type=\"hidden\" name=\"nomeOld\" value=\"' . $dati[0]['nome'] . '\"></input>';\r\n    print '<input type=\"text\" name=\"nome\" value=\"' . $dati[0]['nome'] . '\" class=\"obbligatorio\"></input><br />';\r\n    print '<div class=\"label\"><label >Produttore</label></div>';\r\n    print '<input type=\"text\" name=\"produttore\" value=\"' . $dati[0]['produttore'] . '\"></input><br />';\r\n    print '<input type=\"submit\" value=\"Conferma\" class=\"invia\"></input>';\r\n    print '</fieldset>';\r\n    print \"</form>\";\r\n\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('#formModificaConsole','../script/scriptModificaConsole.php','#coldx');\";\r\n    print '</script>';\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\nprint '<script type=\"text/javascript\" src=\"'.HOME_WEB.'js/funzioni.js\"></script>';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"SELECT * FROM tblprodotti WHERE codiceprodotto='\" . $_POST['codiceprodotto'] . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n    print '<form enctype=\"multipart/form-data\" method=\"post\" action=\"../script/scriptModificaProdotto.php\">';\r\n    print '<fieldset><legend>Modifica Prodotto</legend>';\r\n    print '<input type=\"hidden\" name=\"codiceprodotto\" value=\"' . $dati[0]['codiceprodotto'] . '\"></input><br /> ';\r\n    print '<div class=\"label\"><label >Nome Prodotto</label></div>';\r\n    print '<input type=\"text\" name=\"nomeprodotto\" class=\"obbligatorio\" value=\"' . $dati[0]['nomeprodotto'] . '\"></input><br /> ';\r\n    print '<div class=\"label\"><label >Descrizione</label></div>';\r\n    print '<textarea rows=\"5\" cols=\"40\" name=\"descrizione\">' . $dati[0]['descrizione'] . '</textarea><br />';\r\n    print '<div class=\"label\"><label >Prezzo (&#128)</label></div>';\r\n    // La funzione number_format viene utilizzata per visualizzare correttamente il prezzo\r\n    print '<input type=\"text\" name=\"prezzo\" class=\"obbligatorio decimale\" value=\"' . number_format($dati[0]['prezzo'],2) . '\"/><br />';\r\n    print '<div class=\"label\"><label >Numero Pezzi</label></div>';\r\n    print '<input type=\"text\" name=\"numeropezzi\" class=\"obbligatorio intero\" value=\"' . $dati[0]['numeropezzi'] . '\"/><br />';\r\n    print '<div class=\"label\"><label >Immagine</label></div>';\r\n    print '<input type=\"file\" name=\"immagine\" class=\"obbligatorio\"/><br />';\r\n    print '<div class=\"label\"><label >Galleria Immagini</label></div>';\r\n    print '<input type=\"text\" name=\"galleria\" class=\"obbligatorio\" value=\"' . $dati[0]['galleria'] . '\"/><br />';\r\n    print '<div class=\"label\"><label >Categoria Prodotto</label></div>';\r\n    print '<select name=\"categoria\" class=\"obbligatorio\">';\r\n\r\n    $query = sprintf(\"SELECT nome FROM tblcategorie\");\r\n    $datiCategoria = eseguiQuery($connessione, $query);\r\n\r\n    foreach ($datiCategoria as $riga) {\r\n        print '<option value=\"' . $riga['nome'] . '\"' . ($riga['nome'] == $dati[0]['categoria'] ? 'selected=\"selected\"' : \"\") . '>' . $riga['nome'] . '</option>';\r\n    }\r\n    print '</select><br />';\r\n    print '<div class=\"label\"><label >Console</label></div>';\r\n    print '<select name=\"console\" class=\"obbligatorio\">';\r\n\r\n    $query = sprintf(\"SELECT nome FROM tblconsole\");\r\n    $datiConsole = eseguiQuery($connessione, $query);\r\n\r\n    foreach ($datiConsole as $riga) {\r\n        print '<option value=\"' . $riga['nome'] . '\"' . ($riga['nome'] == $_POST['console'] ? 'selected=\"selected\"' : \"\") . '>' . $riga['nome'] . '</option>';\r\n    }\r\n    print '</select>';\r\n    print '<br /><input type=\"submit\" class=\"invia\" value=\"Conferma\"></input>';\r\n    print '</fieldset>';\r\n    print \"</form>\";\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\ninclude '../settings/configurazione.inc';\ninclude HOME_ROOT . '/script/funzioni.php';\ninclude HOME_ROOT . '/html/testa.php';\n\nif (isset($_SESSION['collegato'])){\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\n    $query = sprintf(\"SELECT * FROM tblutenti WHERE user='\" . $_SESSION['username']. \"'\");\n    $dati = eseguiQuery($connessione, $query);\n\n    print '<p class=\"informazione\">Attenzione, dovrai eseguire di nuovo il login, una volta modificato il profilo</p>';\n    print '<form id=\"formProfiloUtente\" action=\"../script/scriptModificaUtente.php\" method=\"post\">';\n    print '<fieldset><legend>Informazioni profilo utente</legend>';\n    print '<input type=\"hidden\" name=\"oldcodicefiscale\" value=\"' . $dati[0]['codicefiscale'] . '\">';\n    print '<div class=\"label\"><label >Codice Fiscale</label></div>';\n    print '<input type=\"text\" maxlength=\"16\" name=\"codicefiscale\" class=\"obbligatorio\" value=\"' . $dati[0]['codicefiscale'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Nome</label></div>';\n    print '<input type=\"text\" name=\"nome\" class=\"obbligatorio\" value=\"' . $dati[0]['nome'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Cognome</label></div>';\n    print '<input type=\"text\" name=\"cognome\" class=\"obbligatorio\" value=\"' . $dati[0]['cognome'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Data Nascita</label></div>';\n    print '<input type=\"text\" name=\"datanascita\" value=\"'.$dati[0]['datanascita'].'\" class=\"obbligatorio\" id=\"calendario\"><br/>';\n    print '<div class=\"label\"><label >Citt&agrave;</label></div>';\n    print '<input type=\"text\" name=\"citta\" class=\"obbligatorio\" value=\"' . $dati[0]['citta'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Indirizzo</label></div>';\n    print '<input type=\"text\" name=\"indirizzo\" class=\"obbligatorio\" value=\"' . $dati[0]['indirizzo'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Email</label></div>';\n    print '<input type=\"text\" name=\"email\" class=\"obbligatorio\" value=\"' . $dati[0]['email'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Telefono</label></div>';\n    print '<input type=\"text\" name=\"telefono\" class=\"obbligatorio intero\" value=\"' . $dati[0]['telefono'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Username</label></div>';\n    print '<input type=\"text\" name=\"username\" class=\"obbligatorio\" value=\"' . $dati[0]['user'] . '\"><br /> ';\n    print '<div class=\"label\"><label>Password</label></div>';\n    print '<input type=\"password\" name=\"password\" class=\"obbligatorio\" value=\"\"><br /> ';\n    print '<input type=\"submit\" class=\"invia\" value=\"Conferma\">';\n    print '</fieldset>';\n    print '</form>';\n    print '<script type=\"text/javascript\">';\n    print \"gestisciForm('#formProfiloUtente','\" .'../script/scriptModificaUtente.php'. \"','#coldx');\";\n    print '</script>';\n} else {\n    print '<p class=\"errore\">Non sei autorizzato a visualizzare questa pagina, per favore, esegui il login.</p>';\n}\n\ninclude HOME_ROOT . '/html/coda.html';\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/html/testa.php';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif (isset($_SESSION['collegato'])) {\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT u.codicefiscale, c.codiceprodotto, c.quantita, p.nomeprodotto, p.prezzo,\r\n    p.immagine, p.categoria, pc.console FROM ((tblutenti AS u JOIN tblcarrelli AS c\r\n    ON u.codicefiscale = c.codiceutente) JOIN tblprodotti AS p on c.codiceprodotto = p.codiceprodotto)\r\n    JOIN tblprodotticonsole AS pc ON p.codiceprodotto = pc.codiceprodotto WHERE u.user='%s'\", $_SESSION['username']);\r\n\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if($dati) {\r\n    $numeroPagine = ceil(count($dati) / PRODOTTIPERPAGINA);\r\n\r\n    if (!isset($_GET[\"pagina\"])) {\r\n        $pagina = 1;\r\n    } else {\r\n        $pagina = $_GET[\"pagina\"];\r\n    }\r\n\r\n    // $i indica il primo prodotto di ogni pagina.\r\n    $i = ($pagina * PRODOTTIPERPAGINA) - (PRODOTTIPERPAGINA);\r\n\r\n    while ($i < PRODOTTIPERPAGINA * $pagina && $i < count($dati)) {\r\n        print '<div class=\"corpoCatalogo\">' .\r\n            '<div class=\"catcolsx\"><img src=\"' . HOME_WEB . 'img/thumb/' . $dati[$i]['immagine'] . '\" alt=\"Immagine del prodotto\" height=\"165\" width=\"120\">' . '</div>' .\r\n            '<div class=\"catcoldx\"> <p><b>Codice Prodotto: </b>' . $dati[$i]['codiceprodotto'] . '</p>' .\r\n            '<p><b>Nome Prodotto: </b>' . $dati[$i]['nomeprodotto'] . '</p>' .\r\n            '<p><b>Prezzo: </b>' . number_format($dati[$i]['prezzo'], 2) . ' &euro;</p>' .\r\n            '<p><b>Categoria: </b>' . $dati[$i]['categoria'] . '</p>' .\r\n            '<p><b>Console: </b>' . $dati[$i]['console'] . '</p>' .\r\n            '<p><b>Quantita Richiesta: </b>' . $dati[$i]['quantita'] . '</p>';\r\n        print '<form id=\"' . $dati[$i]['codiceprodotto'] . '\" method=\"post\" action=\"../script/scriptEliminazioneCarrello.php\">';\r\n        print '<input type=\"hidden\" name=\"codiceEliminazione\" value=\"' . $dati[$i]['codiceprodotto'] . '\"/>';\r\n        print '<p><b>Quantit&agrave;</b>';\r\n        print '<input type=\"text\" size=\"3\" name=\"quantitaEliminazione\" class=\"intero\" value=\"0\">';\r\n        print '<input type=\"submit\" class=\"invia\" value=\"Elimina\"></p>';\r\n        print '</form>';\r\n        print '</div>' . '</div>';\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('#\" . $dati[$i]['codiceprodotto'] . \"','\" . '../script/scriptEliminazioneCarrello.php' . \"','#coldx');\";\r\n        print '</script>';\r\n        $i++;\r\n    }\r\n        print '<form id=\"confermaAcquisto\" method=\"post\" action=\"moduloVisualizzazioneFattura.php\">';\r\n\r\n        // Questo campo nascosto verr\u00e0 utilizzato per la conferma dell'acquisto e la conseguente eliminazione del carrello dell'utente.\r\n\r\n        print '<input type=\"hidden\" name=\"codicefiscale\" value=\"' . $dati[0]['codicefiscale'] . '\"/>';\r\n        print '<input type=\"submit\" id=\"pulsanteAcquisto\" value=\"Conferma l\\'acquisto\">';\r\n        print '</form>';\r\n\r\n        visualizzaPaginazione($pagina, $numeroPagine, 'Carrello');\r\n\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('#confermaAcquisto','\" . 'moduloVisualizzazioneFattura.php' . \"','#coldx');\";\r\n        print '</script>';\r\n    } else {\r\n        print '<p class=\"informazione\">Il tuo carrello &egrave; vuoto.</p>';\r\n    }\r\n    chiudiConnessione($connessione);\r\n} else {\r\n    print '<p class=\"errore\">Non sei autorizzato a visualizzare questa pagina, per favore, esegui il login.</p>';\r\n}\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\ninclude HOME_ROOT . '/html/testa.php';\r\n\r\n$connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n$query = sprintf(\"SELECT * FROM tblprodotti AS p LEFT JOIN tblprodotticonsole AS pc ON p.codiceprodotto = pc.codiceprodotto\");\r\n$dati = eseguiQuery($connessione, $query);\r\n$cartellaImmaginePrincipale = 'img';\r\n\r\n$numeroPagine = ceil(count($dati) / PRODOTTIPERPAGINA);\r\n\r\nif (!isset($_GET[\"pagina\"])) {\r\n    $pagina = 1;\r\n} else {\r\n    $pagina = $_GET[\"pagina\"];\r\n}\r\n\r\n// $i indica il primo prodotto di ogni pagina.\r\n$i = ($pagina * PRODOTTIPERPAGINA) - (PRODOTTIPERPAGINA);\r\n\r\nwhile ($i < PRODOTTIPERPAGINA * $pagina && $i< count($dati)) {\r\n    print '<div class=\"corpoCatalogo\">' . '<div class=\"catcolsx\"><img alt=\"Immagine non trovata\"\r\n        src=\"' . HOME_WEB . '/' . $cartellaImmaginePrincipale . '/thumb/' . $dati[$i]['immagine'] . '\">' .\r\n        '</div>' . '<div class=\"catcoldx\"><p><b>Codice Prodotto: </b>' . $dati[$i]['codiceprodotto'] . '</p>' .\r\n        '<p><b>Nome Prodotto: </b>' . $dati[$i]['nomeprodotto'] . '</p>' .\r\n        '<p><b>Descrizione: </b>' . $dati[$i]['descrizione'] . '</p>' .\r\n        '<p><b>Prezzo: </b>' . number_format($dati[$i]['prezzo'],2) . ' &euro;</p>' .\r\n        '<p><b>Quantit&agrave; Disponibile: </b>' . $dati[$i]['numeropezzi'] . '</p>' .\r\n        '<p><b>Categoria: </b>' . $dati[$i]['categoria'] . '</p>' .\r\n        '<p><b>Console: </b>' . $dati[$i]['console'] . '</p>';\r\n    if (isset($_SESSION['collegato'])) {\r\n        print '<form id=\"' . $dati[$i]['codiceprodotto'] . '\" method=\"post\" action=\"../script/scriptInserimentoCarrello.php\">';\r\n        print '<input type=\"hidden\" name=\"codiceprodotto\" value=\"' . $dati[$i]['codiceprodotto'] . '\"/>';\r\n        print '<p><b>Quantit&agrave;</b>';\r\n        print '<input type=\"text\" size=\"3\" name=\"quantita\" class=\"intero\" value=\"0\">';\r\n        print '<input type=\"submit\" class=\"invia\" value=\"Aggiungi al carrello\"></p>';\r\n        print '</form>';\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('#\" . $dati[$i]['codiceprodotto'] . \"','\" . '../script/scriptInserimentoCarrello.php' . \"','#coldx');\";\r\n        print '</script>';\r\n    } else {\r\n        print '<p class=\"informazione\">Esegui il login per inserire il prodotto nel carrello</p>';\r\n    }\r\n    print '<div class=\"galleria\">';\r\n    print '<script type=\"text/javascript\">';\r\n    print 'gestisciImmaginiGalleria();';\r\n    print '</script>';\r\n    print '<ul id=\"carouse\" class=\"elastislide-list\">';\r\n    visualizzaGalleria($dati[$i]['galleria'], $dati[$i]['codiceprodotto']);\r\n    print '</ul>';\r\n    print '</div>';\r\n    print '</div></div>';\r\n    $i++;\r\n}\r\n\r\nvisualizzaPaginazione($pagina,$numeroPagine,'Catalogo');\r\n\r\nprint '<script type=\"text/javascript\">';\r\nprint 'gestisciThumbnailsGalleria();';\r\nprint '</script>';\r\n\r\nchiudiConnessione($connessione);\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>\r\n", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = sprintf(\"SELECT p.codiceprodotto, p.nomeprodotto, c.quantita, p.prezzo FROM tblcarrelli AS c JOIN tblprodotti AS p ON c.codiceprodotto = p.codiceprodotto WHERE c.codiceutente='%s'\",$_POST['codicefiscale']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $prezzoFinale = 0;\r\n\r\n    print '<form method=\"post\" id=\"formFattura\" action=\"../script/scriptConfermaAcquisto.php\">';\r\n    print '<fieldset><legend>Fattura</legend>';\r\n    print '<div id=\"tabella\"><table>';\r\n    print '<tr><td>Codice</td><td>Nome</td><td>Quantit&agrave</td><td>Prezzo unitario</td><td>Prezzo parziale</td></tr>';\r\n    foreach ($dati as $prodotto) {\r\n        print '<tr><td>'.$prodotto['codiceprodotto'].'</td><td>'.$prodotto['nomeprodotto'].'</td><td>'.$prodotto['quantita'].'</td><td>'.$prodotto['prezzo'].' &#128</td><td>'.($prodotto['prezzo']*$prodotto['quantita']).' &#128</td></tr>';\r\n        $prezzoFinale = $prezzoFinale + ($prodotto['prezzo']*$prodotto['quantita']);\r\n    }\r\n    print '<tr><td colspan=\"4\"></td><td>'.$prezzoFinale.' &#128</td><td>Prezzo finale</td></tr>';\r\n    print '</table></div>';\r\n    print '</fieldset>';\r\n\r\n    print '<p id=\"carteCredito\">';\r\n    print '<span>Modalit&agrave di pagamento:</span> ';\r\n    print '<img src=\"../img/style/amex1.png\"/>';\r\n    print '<img src=\"../img/style/visa1.png\"/>';\r\n    print '<img src=\"../img/style/mastercard1.png\"/>';\r\n    print '<img src=\"../img/style/cirrus1.png\"/>';\r\n    print '<br /><input type=\"submit\" value=\"Conferma pagamento\" class=\"invia\" />';\r\n    print '</p>';\r\n\r\n    print '</form>';\r\n\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('#formFattura','\" . '../script/scriptConfermaAcquisto.php' . \"','#coldx');\";\r\n    print '</script>';\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n\r\n?>\r\n", "<!DOCTYPE html>\r\n<head>\r\n    <title>Games Commerce</title>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/jquery.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/jquery-ui.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/pirobox-extended-min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/modernizr.custom.17475.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/jquery.elastislide.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/funzioni.js\"></script>\r\n    <style type=\"text/css\">\r\n        @import url(<?php print HOME_WEB;?>css/stile.css);\r\n        @import url(<?php print HOME_WEB;?>css/jquery-ui.min.css);\r\n        @import url(<?php print HOME_WEB;?>css/style.css);\r\n        @import url(<?php print HOME_WEB;?>css/elastislide.css);\r\n    </style>\r\n</head>\r\n<body>\r\n<div id=\"contenuto\">\r\n    <div id=\"testa\">\r\n        <p id=\"titolo\">Games Commerce</p>\r\n    </div>\r\n    <div id=\"logo\">\r\n    </div>\r\n    <nav id=\"menu\">\r\n        <ul>\r\n\r\n            <li><a href=\"<?php print HOME_WEB; ?>index.php\">Home</a></li>\r\n\r\n            <?php\r\n\r\n            if (!isset($_SESSION['collegato'])) {\r\n                print '<li><a href=\"' . HOME_WEB . 'html/moduloRegistrazione.php\">Registrazione Utente</a></li>';\r\n            }\r\n            if (isset($_SESSION['amministratore'])) {\r\n                if ($_SESSION['amministratore']) {\r\n                    print '<li><a href=\"#\">Prodotto</a>';\r\n                    print '<ul>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloInserimentoProdotto.php>Inserimento Prodotto</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloModificaProdotto.php>Modifica Prodotto</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloEliminazioneProdotto.php>Eliminazione Prodotto</a></li>';\r\n                    print '</ul></li>';\r\n                    print '<li><a href=\"#\">Galleria</a>';\r\n                    print '<ul>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloInserimentoImmagine.php>Inserimento Immagini</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloEliminazioneImmagine.php>Eliminazione Immagini</a></li>';\r\n                    print '</ul></li>';\r\n                    print '<li><a href=\"#\">Categoria</a>';\r\n                    print '<ul>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloInserimentoCategoria.php>Inserimento Categoria</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloModificaCategoria.php>Modifica Categoria</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloEliminazioneCategoria.php>Eliminazione Categoria</a></li>';\r\n                    print '</ul></li>';\r\n                    print '<li><a href=\"#\">Console</a>';\r\n                    print '<ul>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloInserimentoConsole.php>Inserimento Console</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloModificaConsole.php>Modifica Console</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloEliminazioneConsole.php>Eliminazione Console</a></li>';\r\n                    print '</ul></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloAmministrazione.php>Amministrazione</a></li>';\r\n                }\r\n            }\r\n            if (isset($_SESSION['collegato'])) {\r\n                print'<li><a href=' . HOME_WEB . 'html/moduloVisualizzazioneCarrello.php>Carrello</a></li>';\r\n            } else {\r\n                print'<li><a href=' . HOME_WEB . 'html/moduloLogin.php>Carrello</a></li>';\r\n            }\r\n            ?>\r\n            <li><a href=\"<?php print HOME_WEB ?>html/moduloVisualizzazioneCatalogo.php\">Catalogo</a></li>\r\n            <?php\r\n            if (isset($_SESSION['collegato'])) {\r\n                print '<li><a href=' . HOME_WEB . 'html/moduloModificaUtente.php>Profilo Utente</a></li>';\r\n            }\r\n            if (!isset($_SESSION['collegato'])) {\r\n                print '<li><a href=' . HOME_WEB . 'html/moduloLogin.php>Login</a></li>';\r\n            } else {\r\n                print '<li><a href=' . HOME_WEB . 'script/scriptLogout.php>Logout</a></li>';\r\n            }\r\n            print '</ul>';\r\n            print '</nav>';\r\n            ?>\r\n            <div id=\"corpo\">\r\n                <div id=\"colsx\">\r\n                </div>\r\n                <div id=\"coldx\"> <!-- Chiusura di coldx nel file coda.html -->", "<?php\r\n\r\nfunction creaConnessione($server,$utente,$password,$database) {\r\n    $connessione = mysqli_connect($server, $utente, $password);\r\n    mysqli_select_db($connessione,$database) or die(mostraErrore($connessione));\r\n    return $connessione;\r\n}\r\n\r\nfunction eseguiQuery($connessione,$query){\r\n    $risultatoQuery = mysqli_query($connessione,$query)or die(mostraErrore($connessione));\r\n    $dati = array();\r\n    /* Se non viene eseguita una query di insert, update o delete, che ritornano un booleano,\r\n    le tuple selezionate vengono messe in un vettore; viene cosi ottenuto un vettore di\r\n    vettori associativi*/\r\n    if(!is_bool($risultatoQuery)) {\r\n        while($riga = mysqli_fetch_assoc($risultatoQuery)){\r\n            $dati[] = $riga;\r\n        }\r\n    }\r\n    return $dati;\r\n}\r\n\r\nfunction chiudiConnessione($connessione){\r\n    mysqli_close($connessione);\r\n}\r\n\r\nfunction mostraErrore($connessione){\r\n    echo '<p class=\"errore\">'.\"I dati che hai inserito hanno generato questo errore: \".mysqli_error($connessione).\"</p>\";\r\n}\r\n\r\nfunction gestioneImmagine($indice, $galleria){\r\n    // Vengono analizzati i valori presenti nel vettore $_FILES per determinare l'esito del caricamento\r\n    if($indice == -1){\r\n        // Caso in cui viene gestita l'immagine principale del prodotto\r\n        $errore = $_FILES['immagine']['error'];\r\n        $nome = $_FILES['immagine']['name'];\r\n        $temp = $_FILES['immagine']['tmp_name'];\r\n    }else{\r\n        // Caso in cui viene gestita un'immagine proveniente dalla galleria\r\n        $errore = $_FILES['immagini']['error'][$indice];\r\n        $nome = $_FILES['immagini']['name'][$indice];\r\n        $temp = $_FILES['immagini']['tmp_name'][$indice];\r\n    }\r\n    // Se le campo 'error' viene trovato il seguente flag, si pu\u00f2 procedere con la copia dell'immagine\r\n    if ($errore == UPLOAD_ERR_OK) {\r\n        copy($temp, HOME_ROOT . '/' . 'img' . '/'.$galleria.'/' . $nome);\r\n        $messaggio = \"L'immagine &egrave; stata caricata senza problemi\";\r\n        print '<p class=\"successo\">' . $nome . ' - Esito : ' . $messaggio . \"</p>\";\r\n        return true;\r\n    } else {\r\n        // Se viene individuato qualsiasi altro flag, c'\u00e8 stato un problema\r\n        switch ($errore) {\r\n            case UPLOAD_ERR_INI_SIZE:\r\n                $messaggio = \"L'immagine caricata &egrave; troppo grande rispetto alla direttiva specificata in php.ini\";\r\n                break;\r\n            case UPLOAD_ERR_FORM_SIZE:\r\n                $messaggio = \"L'immagine caricata &egrave; troppo grande rispetto alla direttiva specificata nel form html\";\r\n                break;\r\n            case UPLOAD_ERR_PARTIAL:\r\n                $messaggio = \"L'immagine &egrave; stata caricata parzialmente\";\r\n                break;\r\n            case UPLOAD_ERR_NO_FILE:\r\n                $messaggio = \"L'immagine non &egrave; stata caricata\";\r\n                break;\r\n            case UPLOAD_ERR_NO_TMP_DIR:\r\n                $messaggio = \"Immagine temporanea mancante\";\r\n                break;\r\n            case UPLOAD_ERR_CANT_WRITE:\r\n                $messaggio = \"Impossibile scrivere l'immagine su disco\";\r\n                break;\r\n            case UPLOAD_ERR_EXTENSION:\r\n                $messaggio = \"Caricamento dell'immagine bloccato da un estensione\";\r\n                break;\r\n        }\r\n        // L'errore viene infine stampato a schermo\r\n        print '<p class=\"errore\">' . $nome . ' - Esito : ' . strtoupper($messaggio) . \"</p>\";\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction generaThumbnail($imSorgente, $percorso, $larghezza, $altezza, $indice){\r\n    if(!is_dir(HOME_ROOT .$percorso)){\r\n        mkdir(HOME_ROOT .$percorso);\r\n    }\r\n    // Assegna alle variabili specificate le dimensioni dell'immagine sorgente.\r\n    list($larghezzaOriginale, $altezzaOriginale) = getimagesize($imSorgente);\r\n    // Genera un' immagine nera con le dimensioni specificate\r\n    $thumb = imagecreatetruecolor($larghezza, $altezza);\r\n    // Caso in cui viene gestita l'immagine principale del prodotto\r\n    if($indice == -1){\r\n        $tipo = $_FILES['immagine']['type'];\r\n    }else{\r\n        // Caso in cui viene gestita un'immagine proveniente dalla galleria\r\n        $tipo = $_FILES['immagini']['type'][$indice];\r\n    }\r\n    // In base al tipo dell'immagine sorgente viene generata una nuova immagine\r\n    switch($tipo) {\r\n        case \"image/jpeg\":\r\n        $immagine = @imagecreatefromjpeg($imSorgente);\r\n        break;\r\n        case \"image/gif\":\r\n        $immagine = @imagecreatefromgif($imSorgente);\r\n        break;\r\n        case \"image/png\":\r\n        $immagine = @imagecreatefrompng($imSorgente);\r\n        break;\r\n    }\r\n    /* L'immagine generata dall' imaagine sorgente viene copiata interamente nell' immagine nera generata\r\n    precedentemente e viene ridimensionata secondo le dimensioni specificate*/\r\n    imagecopyresized($thumb, $immagine, 0, 0, 0, 0, $larghezza, $altezza, $larghezzaOriginale, $altezzaOriginale);\r\n    // L'immagine che costituir\u00e0 la thumbnail viene creata nel percorso specificato.\r\n    if($indice == -1){\r\n        imagejpeg($thumb,HOME_ROOT.$percorso.'/'. $_FILES['immagine']['name']);\r\n    } else {\r\n        imagejpeg($thumb,HOME_ROOT.$percorso.'/'. $_FILES['immagini']['name'][$indice]);\r\n    }\r\n    // Viene liberata la memoria\r\n    imagedestroy($thumb);\r\n    imagedestroy($immagine);\r\n}\r\n\r\nfunction visualizzaGalleria($galleria,$nomeClasse) {\r\n    $percorsoThumbnails = '../img/thumb/'.$galleria.'/';\r\n    $percorsoGalleria = '../img/'.$galleria.'/';\r\n    // La funzione glob cerca tutte le immagini presenti nel percorso specificato.\r\n    $thumbnails = glob($percorsoThumbnails . \"*\");\r\n    foreach ($thumbnails as $thumb) {\r\n        print '<li><a href=\"'.$percorsoGalleria.basename($thumb).'\" rel=\"gallery\" class=\"pirobox_gall'.$nomeClasse.'\">\r\n                <img width=\"100\" alt=\"Non trovata\" height=\"58\" src=\"'.$thumb.'\"></a></li>';\r\n    }\r\n}\r\n\r\nfunction ricercaProdotto($nomeCercato,$destinazione) {\r\n\r\n    // La funzione di ricerca viene utilizzata nelle fasi di modifica e cancellazione per individuare l'oggetto dell'operazione\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    print '<p class=\"informazione\">Sono stati individuati i seguenti risultati potenziali</p>';\r\n    $query = \"SELECT * FROM tblprodotti AS p LEFT JOIN tblprodotticonsole AS pc ON p.codiceprodotto = pc.codiceprodotto WHERE nomeprodotto LIKE '%\".$nomeCercato.\"%' ORDER BY nomeprodotto ASC\";\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $contantoreRisultati = 0;\r\n\r\n    foreach($dati as $riga ){\r\n        /* Ogni risultato parziale costituisce un form a se stante; per ognuno di essi, viene assegnato un id univoco e\r\n         e viene fatto il print della chiamata alla funzione jQuery che li invia in modo asincrono.\r\n        la chiave primaria della tupla viene  utilizzata come id, e i campi necessari sono passati come controlli input nascosti.*/\r\n        print '<form id=\"' . trim($riga['codiceprodotto']) . '\" method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n        print '<input type=\"hidden\" name=\"codiceprodotto\" value=\"'.$riga['codiceprodotto'].'\"/>';\r\n        print '<input type=\"hidden\" name=\"console\" value=\"'.$riga['console'].'\"/>';\r\n        print '<div class=\"label\"><label>'.$riga['nomeprodotto'].' - '.$riga['console'].'</label></div>';\r\n        print '<input type=\"submit\" value=\"Seleziona\"/>';\r\n        print '</form>';\r\n        print '<br />';\r\n        $contantoreRisultati++;\r\n        // Chiamata alla funzione\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('\" . \"#\" . trim($riga['codiceprodotto']) . \"','\" . trim($destinazione) . \"','#coldx');\";\r\n        print '</script>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    if($contantoreRisultati == 0){\r\n        print '<p class=\"errore\">La ricerca non ha prodotto alcun risultato.</p>';\r\n    }\r\n}\r\n\r\nfunction ricercaCategoria($nomeCercato, $destinazione){\r\n\r\n    // La funzione di ricerca viene utilizzata nelle fasi di modifica e cancellazione per individuare l'oggetto dell'operazione\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = \"SELECT * FROM tblcategorie WHERE nome LIKE '%\".$nomeCercato.\"%'\".\"ORDER BY nome ASC\";\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $contantoreRisultati = 0;\r\n    print '<p class=\"informazione\">Sono stati individuati i seguenti risultati potenziali</p>';\r\n\r\n    foreach($dati as $riga ){\r\n        /* La funzione \u00e8 analoga a quella impiegata nella ricerca del prodotto, con una variante;\r\n        poich\u00e8 la chiave primaria della tabella delle categoria \u00e8 il nome, pu\u00f2 contenere degli spazi,\r\n        perci\u00f2 viene usata un'espressione regolare per rimuovere gli spazi indesiderati e ottenere\r\n        un id adeguato per ciascun form */\r\n        $idCorretto = preg_replace('/\\s+/', 'A', $riga['nome']);\r\n        print '<form id=\"'.$idCorretto.'\" method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n        print '<div class=\"label\"><label>'.$riga['nome'].'</label></div>';\r\n        print '<input type=\"hidden\" name=\"nome\" value=\"'.$riga['nome'].'\">';\r\n        print '<input type=\"submit\" value=\"Seleziona\"/>';\r\n        print '</form>';\r\n        print '<br />';\r\n        $contantoreRisultati++;\r\n        // Chiamata alla funzione dove il primo parametro \u00e8 l'id corretto\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('\".\"#\".$idCorretto.\"','\".trim($destinazione) . \"','#coldx');\";\r\n        print '</script>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    if($contantoreRisultati == 0){\r\n        print '<p class=\"errore\">La ricerca non ha prodotto alcun risultato.</p>';\r\n    }\r\n}\r\n\r\nfunction ricercaConsole($nomeCercato, $destinazione){\r\n\r\n    // La funzione di ricerca viene utilizzata nelle fasi di modifica e cancellazione per individuare l'oggetto dell'operazione\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = \"SELECT * FROM tblconsole WHERE nome LIKE '%\".$nomeCercato.\"%'\".\"ORDER BY nome ASC\";\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $contantoreRisultati = 0;\r\n\r\n    print '<p class=\"informazione\">Sono stati individuati i seguenti risultati potenziali</p>';\r\n    foreach($dati as $riga ){\r\n        // Il funzionamento \u00e8 analogo a quello della ricerca della categoria\r\n        $idCorretto = preg_replace('/\\s+/', 'A', $riga['nome']);\r\n        print '<form id=\"' . $idCorretto . '\" method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n        print '<input type=\"hidden\" name=\"nome\" value=\"'.$riga['nome'].'\">';\r\n        print '<div class=\"label\"><label>'.$riga['nome'].'</label></div>';\r\n        print '<input type=\"submit\" value=\"Seleziona\"/>';\r\n        print '</form>';\r\n        print '<br />';\r\n        $contantoreRisultati++;\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('\" . \"#\" . $idCorretto . \"','\" . trim($destinazione) . \"','#coldx');\";\r\n        print '</script>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    if($contantoreRisultati == 0){\r\n        print '<p class=\"errore\">La ricerca non ha prodotto alcun risultato.</p>';\r\n    }\r\n}\r\n\r\nfunction ricercaUtente($utenteCercato, $destinazione){\r\n\r\n    // La funzione stampa direttamente tutti gli utenti registrati\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = \"SELECT user, dirittoAmministratore FROM tblutenti WHERE user != '\".$_SESSION['username'].\"' AND user LIKE '%\".$utenteCercato.\"%'\".\" ORDER BY user ASC\";\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $contantoreRisultati = 0;\r\n\r\n    // Il codice seguente stampa il controllo che da la possibilit\u00e0 di modificare i privilegi amministrativi degli utenti registrati\r\n    print '<p class=\"informazione\">Sono stati individuati i seguenti risultati potenziali</p><br />';\r\n    foreach($dati as $riga ){\r\n        $contantoreRisultati++;\r\n        print '<form method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n        print '<div class=\"label\"><label>'.$riga['user'].'</label></div>';\r\n        print '<input type=\"hidden\" name=\"user[]\" value=\"'.$riga['user'].'\">';\r\n        print '<select name=\"dirittoAmministratore[]\">';\r\n        if($riga['dirittoAmministratore'] == 'si'){\r\n            print '<option selected>si</option>';\r\n            print '<option>no</option>';\r\n        }else{\r\n            print '<option>si</option>';\r\n            print '<option selected>no</option>';\r\n        }\r\n        print '</select>';\r\n        print '<label> diritto da amministratore';\r\n        print '<br /><br />';\r\n    }\r\n    print '<input type=\"submit\" value=\"Conferma\"/>';\r\n    print '</form>';\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('\" . \"#\" . trim($riga['user']) . \"','\" . trim($destinazione) . \"','#coldx');\";\r\n    print '</script>';\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    if($contantoreRisultati == 0){\r\n        print '<p class=\"errore\">La ricerca non ha prodotto alcun risultato.</p>';\r\n    }\r\n}\r\n\r\nfunction stampaModuloRicerca($destinazione, $nome){\r\n    /* La funzione viene chiamata prima di ogni operazione di modifica o eliminazione per individuare l'oggetto\r\n    dell'operazione stessa */\r\n    print '<form id=\"formRicerca\" method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n    print '<fieldset><legend>Ricerca '.$nome.'</legend>';\r\n    print '<div class=\"label\"><label >Nome</label></div>';\r\n    print '<input type=\"text\" name=\"nome\" class=\"obbligatorio\">';\r\n    print '<input type=\"submit\" value=\"Cerca\" >';\r\n    print '</fieldset>';\r\n    print \"</form>\";\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('#formRicerca','\" . trim($destinazione) . \"','#coldx');\";\r\n    print '</script>';\r\n}\r\n\r\nfunction cancellaCartella($cartella) {\r\n    // La funzione viene chiamata quando viene eliminato un prodotto\r\n    if (is_dir($cartella)) {\r\n        // Vengono individuati tutti i file della cartella\r\n        $files = scandir($cartella);\r\n        /* Ogni file viene eliminato. Il ciclo parte da due poich\u00e8 le prime due posizioni del vettore sono occupate da\r\n        elementi di navigazione per entrare in eventuali sotto cartelle */\r\n        for ($i = 2; $i < count($files); $i++) {\r\n            unlink($cartella . '/' . $files[$i]);\r\n        }\r\n        // Una volta eliminati i file, viene eliminata la cartella\r\n        rmdir($cartella);\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction cancellaImmagine($immagine) {\r\n    if (file_exists($immagine)) {\r\n        unlink($immagine);\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction visualizzaPaginazione($pagina,$numeroPagine,$destinazione){\r\n    /* La funzione viene chiamata quando viene stampato un numero elevato di elementi e si rende quindi\r\n    necessaria la paginazione degli stessi. I successivi controlli servono a stampare i numeri di pagina nel\r\n    formato desiderato. Se la pagina corrente ha uno scarto maggiore di uno dall'inizio o dalla fine, vengono\r\n    aggiunti dei puntini, oltre al link alla pagina precedente e a quella successiva\r\n\r\n    Esempio: 1 ... 4 5 6 ... 9 */\r\n\r\n    if($numeroPagine > 1){\r\n        print '<p class=\"numeriPagine\">Pagine: ';\r\n        if($pagina == 1) {\r\n            if(($pagina + 1) != $numeroPagine){\r\n                print '<b>'.($pagina).' </b><a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=' . ($pagina + 1) . '\">'.($pagina+1).'</a>';\r\n            } else {\r\n                print '<b>'.($pagina).' </b>';\r\n            }\r\n            if($numeroPagine-$pagina>2){\r\n                print' ... '.'<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina='.$numeroPagine.'\">'.$numeroPagine.'</a>';\r\n            }else{\r\n                print'<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina='.$numeroPagine.'\"> '.$numeroPagine.'</a>';\r\n            }\r\n        } elseif ($pagina == $numeroPagine) {\r\n            if($numeroPagine-1>2){\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=1\">1</a> ... ';\r\n            }else{\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=1\">1 </a>';\r\n            }\r\n            if(($pagina - 1) != 1){\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=' . ($pagina - 1) . '\">'.($pagina-1).'</a>'.'<b> '.($pagina).'</b>';\r\n            }else{\r\n                print '<b> '.($pagina).'</b>';\r\n            }\r\n        } else {\r\n            print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=1\">1 </a>';\r\n            if($pagina-1>2){\r\n                print ' ... ';\r\n            }\r\n            if($pagina - 1 != 1){\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=' . ($pagina - 1) . '\">'.($pagina - 1).' </a>';\r\n            }\r\n            print '<b>'.$pagina.'</b>';\r\n            if($pagina + 1 != $numeroPagine){\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=' . ($pagina + 1) . '\"> '.($pagina + 1).'</a>';\r\n            }\r\n            if($numeroPagine-$pagina>2){\r\n                print' ...';\r\n            }\r\n            print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina='.$numeroPagine.'\"> '.$numeroPagine.'</a>';\r\n        }\r\n        print '</p>';\r\n    }\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/html/testa.php';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    for($i = 0; $i < count($_POST['user']); $i++) {\r\n        $query = sprintf(\"UPDATE tblutenti SET dirittoAmministratore='%s' WHERE user='%s'\", $_POST['dirittoAmministratore'][$i], $_POST['user'][$i]);\r\n        $dati = eseguiQuery($connessione, $query);\r\n    }\r\n\r\n    print '<p class=\"successo\">La modifica dei diritti da amministratore &grave; avvenuta correttamente</p>';\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n}\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n\r\n    /* Il codice fiscale viene salvato per poter recuperare le tuple presenti nella tabella molti a molti del carrello\r\n     in base all'utente collegato con un dato username in quell'istante */\r\n    $query = sprintf(\"SELECT codicefiscale FROM tblutenti WHERE user='\".$_SESSION['username'].\"'\");\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $codiceFiscale = $dati[0]['codicefiscale'];\r\n\r\n    // Recupero dei prodotti inseriti nel carrello dell'utente collegato\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = sprintf(\"SELECT p.codiceprodotto, p.nomeprodotto, c.quantita, p.prezzo FROM tblcarrelli AS c JOIN tblprodotti AS p ON c.codiceprodotto = p.codiceprodotto WHERE c.codiceutente='%s'\",$codiceFiscale);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    foreach ($dati as $prodotto) {\r\n        // Per ogni prodotto, viene recuperata la quantit\u00e0 in magazzino\r\n        $query = sprintf(\"SELECT numeropezzi FROM tblprodotti WHERE codiceprodotto='%s'\",$prodotto['codiceprodotto']);\r\n        $infoPezzi = eseguiQuery($connessione,$query);\r\n        // La quantit\u00e0 aggiornata \u00e8 data dalla quantit\u00e0 in magazzino meno la quantit\u00e0 richiesta\r\n        $quantit\u00e0Aggiornata = $infoPezzi[0]['numeropezzi'] - $prodotto['quantita'];\r\n        // L'informazione su dabatase viene aggiornata\r\n        $query = sprintf(\"UPDATE tblprodotti SET numeropezzi='%d' WHERE codiceprodotto='%s'\",$quantit\u00e0Aggiornata,$prodotto['codiceprodotto']);\r\n        $dati = eseguiQuery($connessione,$query);\r\n    }\r\n\r\n// Una volta compiute le operazioni d'aggiornamento, le tuple dell'utente nel carrello vengono cancellate\r\n    $query = sprintf(\"DELETE FROM tblcarrelli WHERE codiceutente='%s'\",$codiceFiscale);\r\n    eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">L\\'acquisto &egrave stato completato con successo</p>';\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>\r\n", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"SELECT user, psw, dirittoamministratore FROM tblutenti WHERE user=\" . \"'\" . $_POST['username'] . \"'\" . \" AND \" . \"psw=\" . \"'\" . sha1($_POST['password']) . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if ($dati == null) {\r\n        print '<p class=\"errore\">Alcuni dei tuoi dati sono errati, riprova</p>';\r\n    } else { // Se la query ritorna una tupla\r\n        // Le due variabili di sessione vengono impostate per mantenere lo stato dell'utente verificato\r\n        $_SESSION['username'] = $_POST['username'];\r\n        $_SESSION['password'] = $_POST['password'];\r\n        // Se il flag relativo ai privilegi amministrativi \u00e8 si, allora l'utente \u00e8 un amministratore\r\n        if ($dati[0][\"dirittoamministratore\"] == \"si\") {\r\n            /* La seguente variabile di sessione viene usata in diversi punti del codice per fare in modo che solamente\r\n            l'amministratore possa accedere a determinare aree del sito*/\r\n            $_SESSION['amministratore'] = true;\r\n        } else {\r\n            $_SESSION['amministratore'] = false;\r\n        }\r\n        /* La seguente variabile di sessione viene usata per controllare che qualcuno sia collegato, indipendentemente dal\r\n        fatto che sia amministratore o meno */\r\n        $_SESSION['collegato'] = true;\r\n        // Una volta terminate le operazioni, viene eseguito un ridirezionamento tramite jQuery\r\n        print '<script type=\"text/javascript\">';\r\n        print \"$(window.location).attr('href', '../index.php');\";\r\n        print '</script>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>\r\n", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $utente = $_SESSION['username'];\r\n    $quantitaEliminazione = $_POST['quantitaEliminazione'];\r\n    $codiceEliminazione = $_POST['codiceEliminazione'];\r\n\r\n// La query recupera la tupla del prodotto da eliminare dal carrello in base al codice del prodotto stesso e all'utente collegato\r\n    $query = sprintf(\"SELECT u.codicefiscale, c.codiceprodotto, c.quantita\r\n             FROM tblutenti AS u JOIN tblcarrelli AS c ON u.codicefiscale = c.codiceutente\r\n             WHERE u.user='%s' AND c.codiceprodotto='%s'\", $utente, $codiceEliminazione);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if ($quantitaEliminazione > $dati[0]['quantita']) {\r\n        print '<p class=\"errore\">Non puoi eliminare dal carrello una quantita maggiore di quella inserita precedentemente</p>';\r\n    } else {\r\n\r\n        // il codice fiscale dell'utente collegato viene recuperato\r\n        $query = sprintf(\"SELECT codicefiscale FROM tblutenti WHERE user='%s'\", $utente);\r\n        $infoUtente = eseguiQuery($connessione, $query);\r\n        $codiceFiscale = $infoUtente[0]['codicefiscale'];\r\n\r\n\r\n        // la quantit\u00e0 di prodotto presente nel carrello dell'utente viene aggiornata\r\n        $quantitaAggiornata = $dati[0]['quantita'] - $quantitaEliminazione;\r\n        $query = sprintf(\"UPDATE tblCarrelli SET quantita='%d' WHERE codiceprodotto='%s' AND codiceutente='%s'\", $quantitaAggiornata, $codiceEliminazione, $codiceFiscale);\r\n        $dati = eseguiQuery($connessione, $query);\r\n\r\n        $query = sprintf(\"SELECT quantita FROM tblcarrelli WHERE codiceprodotto='%s' AND codiceutente='%s'\", $codiceEliminazione, $codiceFiscale);\r\n        $dati = eseguiQuery($connessione, $query);\r\n\r\n        // Se la nuova quantit\u00e0 di prodotto presente nel carrello \u00e8 negativa o zero, l'intera tupla viene eliminata\r\n        if ($dati[0]['quantita'] <= 0) {\r\n            $query = sprintf(\"DELETE FROM tblcarrelli WHERE codiceutente='%s' AND codiceprodotto='%s'\", $codiceFiscale, $codiceEliminazione);\r\n            $dati = eseguiQuery($connessione, $query);\r\n        }\r\n        print '<p class=\"successo\">Aggiornamento del carrello eseguito correttamente</p>';\r\n    }\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>\r\n", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT COUNT(codiceprodotto) FROM tblprodotti WHERE categoria='%s'\", $_POST['nome']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if(intval($dati[0]['COUNT(codiceprodotto)'] > 0)){\r\n        print '<p class=\"informazione\">Elimina tutti i prodotti presenti in questa categoria prima di procedere</p>';\r\n    } else {\r\n        $query = sprintf(\"DELETE FROM tblcategorie WHERE nome='%s'\", $_POST['nome']);\r\n        $dati = eseguiQuery($connessione, $query);\r\n        print '<p class=\"successo\">La categoria &egrave; stata eliminata con successo</p>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT COUNT(console) FROM tblprodotticonsole WHERE console='%s'\", $_POST['nome']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if(intval($dati[0]['COUNT(console)'] > 0)){\r\n        print '<p class=\"informazione\">Elimina tutti i prodotti associati a questa console prima di procedere</p>';\r\n    } else {\r\n        $query = sprintf(\"DELETE FROM tblconsole WHERE nome='%s'\", $_POST['nome']);\r\n        $dati = eseguiQuery($connessione, $query);\r\n        print '<p class=\"successo\">La console &egrave; stata eliminata con successo</p>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"DELETE FROM tblcarrelli WHERE codiceprodotto='%s'\", $_POST['codiceprodotto']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"DELETE FROM tblprodotticonsole WHERE codiceprodotto='%s'\", $_POST['codiceprodotto']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"SELECT galleria, immagine FROM tblprodotti WHERE codiceprodotto='%s'\", $_POST['codiceprodotto']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"SELECT COUNT(galleria) FROM tblprodotti WHERE galleria ='%s'\", $dati[0]['galleria']);\r\n    $numeroVersioni = eseguiQuery($connessione, $query);\r\n\r\n    // $numeroVersioni indica quanti prodotti condividono la stessa galleria\r\n    if (intval($numeroVersioni[0]['COUNT(galleria)'] > 1)) {\r\n        print '<p class=\"informazione\">Poich\u00e8 ci sono pi\u00f9 versioni dello stesso gioco, la corrispondente galleria non &egrave; stata cancellata.</p>';\r\n    } else {\r\n        if (cancellaCartella('../img/' . $dati[0]['galleria'])) {\r\n            print '<p class=\"successo\">La cartella contenente le immagini &egrave; stata cancellata con successo</p>';\r\n        } else {\r\n            print '<p class=\"errore\">La cartella contenente le immagini non esiste</p>';\r\n        }\r\n\r\n        if (cancellaCartella('../img/thumb/' . $dati[0]['galleria'])) {\r\n            print '<p class=\"successo\">La cartella contenente le thumbnails &egrave; stata cancellata con successo</p>';\r\n        } else {\r\n            print '<p class=\"errore\">La cartella contenente le thumbnails non esiste</p>';\r\n        }\r\n    }\r\n\r\n    if (cancellaImmagine('../img/' . $dati[0]['immagine'])) {\r\n        print '<p class=\"successo\">L\\'immagine principale &egrave; stata cancellata con successo</p>';\r\n    } else {\r\n        print '<p class=\"errore\">L\\'immagine principale non esiste</p>';\r\n    }\r\n\r\n    if (cancellaImmagine('../img/thumb/' . $dati[0]['immagine'])) {\r\n        print '<p class=\"successo\">La thumbnail dell\\'immagine principale &egrave; stata cancellata con successo</p>';\r\n    } else {\r\n        print '<p class=\"errore\">La thumbnail dell\\'immagine principale non esiste</p>';\r\n    }\r\n\r\n    $query = sprintf(\"DELETE FROM tblprodotti WHERE codiceprodotto='%s'\", $_POST['codiceprodotto']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    print '<p class=\"successo\">Il prodotto &egrave; stato eliminato con successo</p>';\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $utente = $_SESSION['username'];\r\n\r\n    $quantitaInserimento = $_POST['quantita'];\r\n    $codiceInserimento = $_POST['codiceprodotto'];\r\n\r\n    $query = sprintf(\"SELECT numeropezzi FROM tblprodotti WHERE codiceprodotto='%s'\", $codiceInserimento);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if (($quantitaInserimento > $dati[0]['numeropezzi']) || ($quantitaInserimento <= 0)) {\r\n        print '<p class=\"errore\">Non puoi comprare un numero di prodotti negativo oppure maggiore della quantita disponibile. Riprova.</p>';\r\n    } else {\r\n\r\n        $query = sprintf(\"SELECT u.codicefiscale, c.codiceprodotto, c.quantita, p.numeropezzi\r\n             FROM (tblutenti AS u JOIN tblcarrelli AS c ON u.codicefiscale = c.codiceutente)\r\n             JOIN tblprodotti AS p on c.codiceprodotto = p.codiceprodotto\r\n             WHERE u.user='%s' AND c.codiceprodotto='%s'\", $utente, $codiceInserimento);\r\n\r\n        $dati = eseguiQuery($connessione, $query);\r\n        $codiceFiscale = $dati[0]['codicefiscale'];\r\n\r\n        // Se il prodotto selezionato non \u00e8 gi\u00e0 presente nel carrello, lo aggiunge.\r\n        if (!$dati) {\r\n            $query = sprintf(\"INSERT INTO tblcarrelli(codiceprodotto, codiceutente, quantita) VALUE ('%s','%s','%d')\", $codiceInserimento, $codiceFiscale, $quantitaInserimento);\r\n            $dati = eseguiQuery($connessione, $query);\r\n            print '<p class=\"successo\">Inserimento nel carrello avvenuto correttamente</p>';\r\n        } else {\r\n            // Se \u00e8 gi\u00e0 presente vengono fatti dei controlli e viene aggiorata la quantit\u00e0\r\n            $quantitaTotale = $dati[0]['quantita'] + $quantitaInserimento;\r\n            if ($quantitaTotale > $dati[0]['numeropezzi']) {\r\n                print '<p class=\"errore\">Attenzione, non puoi inserire una quantit&agrave; di prodotto maggiore di quella in magazzino!</p>';\r\n            } else {\r\n                $query = sprintf(\"UPDATE tblcarrelli SET quantita='%d' WHERE codiceprodotto='%s' AND codiceutente ='%s'\", $quantitaTotale, $codiceInserimento, $codiceFiscale);\r\n                $dati = eseguiQuery($connessione, $query);\r\n                print '<p class=\"successo\">Aggiornamento del carrello avvenuto correttamente</p>';\r\n            }\r\n        }\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"INSERT INTO tblcategorie(nome) VALUE ('%s')\", $_POST['nome']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">' . \"L'inserimento della categoria &egrave; avvenuto correttamente</p>\";\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    if (trim($_POST['produttore']) == '') {\r\n        $query = sprintf(\"INSERT INTO tblconsole(nome) VALUE ('%s')\", $_POST['nome']);\r\n    } else {\r\n        $query = sprintf(\"INSERT INTO tblconsole(nome,produttore) VALUE ('%s','%s')\", $_POST['nome'], $_POST['produttore']);\r\n    }\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">' . \"L'inserimento della console &egrave; avvenuto correttamente</p>\";\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\ninclude HOME_ROOT . '/html/testa.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"SELECT galleria FROM tblprodotti WHERE codiceprodotto='\" . $_POST['codiceprodotto'] . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $percorsoGalleria = 'img/' . $dati[0]['galleria'];\r\n\r\n    for ($i = 0; $i < count($_FILES['immagini']['name']); $i++) {\r\n        if(gestioneImmagine($i,$dati[0]['galleria'])){\r\n            generaThumbnail($_FILES['immagini']['tmp_name'][$i],'/img/thumb/'.$dati[0]['galleria'],370,220,$i);\r\n        }\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n}\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\ninclude HOME_ROOT . '/html/testa.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $percorsoCartella = '../img/' . trim($_POST['galleria']);\r\n\r\n    //Se l'indice \u00e8 -1 indica che viene caricata una singola immagine.\r\n    $indice = -1;\r\n\r\n    gestioneImmagine($indice,'');\r\n    generaThumbnail($_FILES['immagine']['tmp_name'],'/img/thumb',200,268,$indice);\r\n\r\n    $query = sprintf(\"INSERT INTO tblprodotti(codiceprodotto, nomeprodotto, descrizione, prezzo, numeropezzi, immagine, galleria, categoria) VALUE ('%s','%s','%s','%d','%d','%s','%s','%s')\", strtoupper(trim($_POST['codiceprodotto'])), $_POST['nomeprodotto'], $_POST['descrizione'], $_POST['prezzo'], $_POST['numeropezzi'], $_FILES['immagine']['name'], trim($_POST['galleria']), $_POST['categoria']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"INSERT INTO tblprodotticonsole(codiceprodotto, console) VALUE ('%s','%s')\", $_POST['codiceprodotto'], $_POST['console']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if(!file_exists($percorsoCartella)){\r\n        mkdir($percorsoCartella);\r\n        print '<p class=\"successo\">'.\"La creazione della cartella &egrave; avvenuta con successo</p>\";\r\n    } else {\r\n        print '<p class=\"informazione\">'.\"La cartella &egrave; gi&agrave; esistente</p>\";\r\n    }\r\n\r\n    print '<p class=\"successo\">'.\"L'inserimento del prodotto &egrave; avvenuto con successo</p>\";\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n}\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\ninclude '../settings/configurazione.inc';\ninclude HOME_ROOT . '/script/funzioni.php';\n\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\n\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\n    $query = sprintf(\"INSERT INTO tblUtenti(codicefiscale, nome, cognome, datanascita, citta, indirizzo, email, telefono, user, psw, dirittoamministratore) VALUE ('%s','%s','%s','%s','%s','%s','%s','%s','%s','%s','%s')\", strtoupper($_POST['codicefiscale']), $_POST['nome'], $_POST['cognome'], $_POST['datanascita'],$_POST['citta'], $_POST['indirizzo'], $_POST['email'], $_POST['telefono'], $_POST['username'], sha1($_POST['password']), \"no\");\n    $dati = eseguiQuery($connessione, $query);\n    chiudiConnessione($connessione);\n\n    print '<p class=\"successo\">' . \"L'inserimento dell'utente &egrave; avvenuto correttamente</p>\";\n\n} else {\n    include HOME_ROOT . '/html/testa.php';\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\n    include HOME_ROOT . '/html/coda.html';\n}\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"UPDATE tblcategorie SET nome='%s' WHERE nome='%s'\", $_POST['nome'], $_POST['nomeOld']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">La modifica della categoria &egrave; avvenuta correttamente</p>';\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    if (trim($_POST['produttore']) == '') {\r\n        $query = sprintf(\"UPDATE tblconsole SET nome='%s', produttore=NULL WHERE nome='%s'\", $_POST['nome'], $_POST['nomeOld']);\r\n    } else {\r\n        $query = sprintf(\"UPDATE tblconsole SET nome='%s', produttore='%s' WHERE nome='%s'\", $_POST['nome'], $_POST['produttore'], $_POST['nomeOld']);\r\n    }\r\n\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">La modifica della console &egrave; avvenuta correttamente</p>';\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/html/testa.php';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n//Se l'indice \u00e8 -1 indica che viene caricata una singola immagine.\r\n    $indice = -1;\r\n\r\n    if(gestioneImmagine($indice,'')){\r\n        generaThumbnail($_FILES['immagine']['tmp_name'],'/img/thumb',200,268,$indice);\r\n    }\r\n\r\n    $query = sprintf(\"SELECT galleria, immagine FROM tblprodotti WHERE codiceprodotto='%s'\", $_POST['codiceprodotto']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n// Utilizzato per la rinomina della galleria\r\n    $galleriaOld = $dati[0]['galleria'];\r\n\r\n// Se il nome della galleria viene cambiato\r\n    if (HOME_ROOT . '/' . 'img' . '/' . $dati[0]['galleria'] != HOME_ROOT . '/' . 'img' . '/' . $_POST['galleria']) {\r\n        // Se avviene la rinomina della galleria, viene controllato se esiste e in caso rinominata la relativa cartella contenete le thumbnails\r\n        if (rename(HOME_ROOT . '/' . 'img' . '/' . $dati[0]['galleria'], HOME_ROOT . '/' . 'img' . '/' . $_POST['galleria'])) {\r\n            if(is_dir(HOME_ROOT . '/' . 'img/thumb' . '/' . $dati[0]['galleria'])) {\r\n                rename(HOME_ROOT . '/' . 'img/thumb' . '/' . $dati[0]['galleria'], HOME_ROOT . '/' . 'img/thumb' . '/' . $_POST['galleria']);\r\n                print '<p class=\"successo\">' . \"La cartella della galleria contenente le thumbnail &egrave; stata rinominata con successo</p>\";\r\n            }\r\n            print '<p class=\"successo\">' . \"La cartella della galleria &egrave; stata rinominata con successo</p>\";\r\n        } else {\r\n            print '<p class=\"informazione\">' . \"La cartella della galleria non &egrave; stata rinominata</p>\";\r\n        }\r\n    }\r\n\r\n// Se l'immagine principale viene sostituita, la vecchia immagine e la relativa thumbnail vengono cancellate\r\n    if (HOME_ROOT . '/' . 'img' . '/' . $dati[0]['immagine'] != HOME_ROOT . '/' . 'img' . '/' . $_FILES['immagine']['name']) {\r\n        unlink(HOME_ROOT . '/' . 'img' . '/' . $dati[0]['immagine']);\r\n        unlink(HOME_ROOT . '/' . 'img' . '/thumb/' . $dati[0]['immagine']);\r\n        print '<p class=\"successo\">' . \"L'immagine principale &egrave; stata aggiornata con successo</p>\";\r\n    }\r\n\r\n    $query = sprintf(\"UPDATE tblprodotti SET nomeprodotto='%s', descrizione='%s', prezzo='%d', numeropezzi='%d', immagine='%s',galleria='%s',categoria='%s' WHERE codiceprodotto='%s'\", $_POST['nomeprodotto'], $_POST['descrizione'], $_POST['prezzo'], $_POST['numeropezzi'], $_FILES['immagine']['name'], $_POST['galleria'], $_POST['categoria'], $_POST['codiceprodotto']);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"UPDATE tblprodotti SET galleria='%s' WHERE galleria='%s'\", $_POST['galleria'], $galleriaOld);\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    print '<p class=\"successo\">La modifica del prodotto &egrave; avvenuta correttamente</p>';\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n}\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\ninclude '../settings/configurazione.inc';\ninclude HOME_ROOT . '/script/funzioni.php';\n\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\n\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\n    $query = sprintf(\"UPDATE tblutenti SET codicefiscale='%s', nome='%s', cognome='%s', datanascita='%s',citta='%s', indirizzo='%s', email='%s', telefono='%s', user='%s', psw='%s' WHERE codicefiscale='%s'\", strtoupper($_POST['codicefiscale']), $_POST['nome'], $_POST['cognome'], $_POST['datanascita'],$_POST['citta'], $_POST['indirizzo'], $_POST['email'], $_POST['telefono'], $_POST['username'], sha1($_POST['password']),$_POST['oldcodicefiscale']);\n    $dati = eseguiQuery($connessione, $query);\n\n    chiudiConnessione($connessione);\n\n// Aggiornata la tabella, la sessione verr\u00e0 distrutta e l'utente dovr\u00e0 ricollegarsi al sito\n    session_destroy();\n\n    print '<script type=\"text/javascript\">';\n    print \"$(window.location).attr('href', '../index.php');\";\n    print '</script>';\n\n} else {\n    include HOME_ROOT . '/html/testa.php';\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\n    include HOME_ROOT . '/html/coda.html';\n}\n?>\n", "<?php\r\n/* CONFIGURAZIONE NON NON NECESSARIA */\r\n\r\n/* HOME_ROOT indica il percorso assoluto della cartella del  file in cui viene inclusa; non necessita di ulteriore configurazione. Questa\r\ncostante \u00e8 necessaria per poter includere file in maniera assoluta da qualsiasi punto del sito*/\r\ndefine('HOME_ROOT',realpath(dirname(__FILE__).'/../'));\r\n// Inizializzazione della sessione\r\nsession_start();\r\n\r\n/* CONFIGURAZIONE OBBLIGATORIA */\r\n\r\n/* HOME_WEB indica il percorso della cartella in cui si trova il file index.php rispetto al filesystem del server.\r\nEsempio: il file index.php si trova nella cartella sito dentro alla cartella public_html\r\nHOME_WEB: /public_html/sito/\r\nLa costante viene utilizzata quando pu\u00f2 essere utilizzato un percorso di tipo relativo*/\r\ndefine('HOME_WEB','/Complementi/Progetto/');\r\n// Le costanti SERVER, UTENTE, PASSWORD, DATABASE sono necessarie per eseguire le query alla base di dati desiderata.\r\ndefine('SERVER','localhost');\r\ndefine('UTENTE','root');\r\ndefine('PASSWORD','');\r\ndefine('DATABASE','ecommerce');\r\n\r\n/* CONFIGURAZIONE FACOLTATIVA */\r\n\r\n// PRODOTTIPERPAGINA indica il numero di prodotti da mostrare in una singola pagina del carrello o del catalogo.\r\ndefine('PRODOTTIPERPAGINA',3);\r\n?>\r\n"], "fixing_code": ["<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"SELECT galleria FROM tblprodotti WHERE codiceprodotto='%s'\", rendiSicuro($_POST['codiceprodotto']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $percorsoThumbnails = '../img/thumb/' . $dati[0]['galleria'] . '/';\r\n\r\n    // La funzione glob cerca tutte le immagini presenti nel percorso specificato.\r\n\r\n    $thumbnails = glob($percorsoThumbnails . \"*\");\r\n\r\n    // Se nella galleria sono presenti immagini\r\n    if($thumbnails) {\r\n        print '<p class=\"informazione\">Seleziona le immagini da eliminare</p>';\r\n\r\n        print '<form id=\"formEliminazioneImmagini\" method=\"post\" action=\"../script/scriptEliminazioneImmagine.php\">';\r\n        print '<input type=\"hidden\" name=\"galleria\" value=\"' . $dati[0]['galleria'] . '\">';\r\n\r\n        // Successivamente le thumbnail relative a ciascuna immagine vengono visualizzate\r\n        // Con la checkbox si indicano quelle da eliminare\r\n\r\n        foreach ($thumbnails as $thumb) {\r\n            print '<div id=\"immagineEliminazione\">';\r\n            print '<div><img src=\"' . $thumb . '\"></div>';\r\n            print '<div><input type=\"checkbox\" name=\"immagine[]\" value=\"' . basename($thumb) . '\"/>';\r\n            print '<label>' . basename($thumb) . '</label></div>';\r\n            print '</div>';\r\n        }\r\n\r\n        print '<div id=\"pulsanteEliminazione\"><input type=\"submit\" value=\"Elimina\"/></div>';\r\n        print '</form>';\r\n\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('#formEliminazioneImmagini','../script/scriptEliminazioneImmagine.php','#coldx');\";\r\n        print '</script>';\r\n    } else {\r\n        print '<p class=\"informazione\">La galleria di questo prodotto &egrave; vuota</p>';\r\n    }\r\n    chiudiConnessione($connessione);\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT codiceprodotto, nomeprodotto FROM tblprodotti WHERE codiceprodotto='\" . rendiSicuro($_POST['codiceprodotto']) . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if (!$dati) {\r\n        print '<p class=\"errore\">Il prodotto non \u00e8 stato individuato, controlla il nome inserito</p>';\r\n    } else {\r\n        print '<form method=\"post\" enctype=\"multipart/form-data\" action=\"../script/scriptInserimentoImmagine.php\">';\r\n        print '<fieldset><legend>Inserisci immagini nella galleria di ' . $dati[0]['nomeprodotto'] . '</legend>';\r\n        print '<div class=\"label\"><label>Seleziona le immagini</label></div>';\r\n        print '<input type=\"hidden\" name=\"codiceprodotto\" value=\"' . $dati[0]['codiceprodotto'] . '\"/>';\r\n        print '<input type=\"file\" class=\"obbligatorio\" name=\"immagini[]\" multiple=\"multiple\" accept=\"image/*\" />';\r\n        print '<input type=\"submit\" value=\"Inserisci\" class=\"invia\" />';\r\n        print '</fieldset>';\r\n        print '</form>';\r\n    }\r\n    chiudiConnessione($connessione);\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\nprint '<script type=\"text/javascript\" src=\"'.HOME_WEB.'js/funzioni.js\"></script>';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT * FROM tblcategorie WHERE nome='\" . rendiSicuro($_POST['nome']) . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    print '<form id=\"formModificaCategoria\" method=\"post\" action=\"../script/scriptModificaCategoria.php\">';\r\n    print '<fieldset><legend>Informazioni categoria</legend>';\r\n    print '<div class=\"label\"><label >Nome</label></div>';\r\n    // Il seguente campo nascosto viene utilizzato per individuare il vecchio valore della chiave primaria nel database e quindi aggiornarlo\r\n    print '<input type=\"hidden\" name=\"nomeOld\" value=\"' . $dati[0]['nome'] . '\"></input>';\r\n    print '<input type=\"text\" name=\"nome\" value=\"' . $dati[0]['nome'] . '\" class=\"obbligatorio\"></input>';\r\n    print '<input type=\"submit\" value=\"Conferma\" class=\"invia\"></input>';\r\n    print '</fieldset>';\r\n    print \"</form>\";\r\n\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('#formModificaCategoria','../script/scriptModificaCategoria.php','#coldx');\";\r\n    print '</script>';\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\nprint '<script type=\"text/javascript\" src=\"'.HOME_WEB.'js/funzioni.js\"></script>';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT * FROM tblconsole WHERE nome='\" . rendiSicuro($_POST['nome']) . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    print '<form id=\"formModificaConsole\" method=\"post\" action=\"../script/scriptModificaConsole.php\">';\r\n    print '<fieldset><legend>Informazioni console</legend>';\r\n    print '<div class=\"label\"><label >Nome</label></div>';\r\n    // Il seguente campo nascosto viene utilizzato per individuare il vecchio valore della chiave primaria nel database e quindi aggiornarlo\r\n    print '<input type=\"hidden\" name=\"nomeOld\" value=\"' . $dati[0]['nome'] . '\"></input>';\r\n    print '<input type=\"text\" name=\"nome\" value=\"' . $dati[0]['nome'] . '\" class=\"obbligatorio\"></input><br />';\r\n    print '<div class=\"label\"><label >Produttore</label></div>';\r\n    print '<input type=\"text\" name=\"produttore\" value=\"' . $dati[0]['produttore'] . '\"></input><br />';\r\n    print '<input type=\"submit\" value=\"Conferma\" class=\"invia\"></input>';\r\n    print '</fieldset>';\r\n    print \"</form>\";\r\n\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('#formModificaConsole','../script/scriptModificaConsole.php','#coldx');\";\r\n    print '</script>';\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\nprint '<script type=\"text/javascript\" src=\"'.HOME_WEB.'js/funzioni.js\"></script>';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"SELECT * FROM tblprodotti WHERE codiceprodotto='\" . rendiSicuro($_POST['codiceprodotto']) . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n    print '<form enctype=\"multipart/form-data\" method=\"post\" action=\"../script/scriptModificaProdotto.php\">';\r\n    print '<fieldset><legend>Modifica Prodotto</legend>';\r\n    print '<input type=\"hidden\" name=\"codiceprodotto\" value=\"' . $dati[0]['codiceprodotto'] . '\"></input><br /> ';\r\n    print '<div class=\"label\"><label >Nome Prodotto</label></div>';\r\n    print '<input type=\"text\" name=\"nomeprodotto\" class=\"obbligatorio\" value=\"' . $dati[0]['nomeprodotto'] . '\"></input><br /> ';\r\n    print '<div class=\"label\"><label >Descrizione</label></div>';\r\n    print '<textarea rows=\"5\" cols=\"40\" name=\"descrizione\">' . $dati[0]['descrizione'] . '</textarea><br />';\r\n    print '<div class=\"label\"><label >Prezzo (&#128)</label></div>';\r\n    // La funzione number_format viene utilizzata per visualizzare correttamente il prezzo\r\n    print '<input type=\"text\" name=\"prezzo\" class=\"obbligatorio decimale\" value=\"' . number_format($dati[0]['prezzo'],2) . '\"/><br />';\r\n    print '<div class=\"label\"><label >Numero Pezzi</label></div>';\r\n    print '<input type=\"text\" name=\"numeropezzi\" class=\"obbligatorio intero\" value=\"' . $dati[0]['numeropezzi'] . '\"/><br />';\r\n    print '<div class=\"label\"><label >Immagine</label></div>';\r\n    print '<input type=\"file\" name=\"immagine\" class=\"obbligatorio\"/><br />';\r\n    print '<div class=\"label\"><label >Galleria Immagini</label></div>';\r\n    print '<input type=\"text\" name=\"galleria\" class=\"obbligatorio\" value=\"' . $dati[0]['galleria'] . '\"/><br />';\r\n    print '<div class=\"label\"><label >Categoria Prodotto</label></div>';\r\n    print '<select name=\"categoria\" class=\"obbligatorio\">';\r\n\r\n    $query = sprintf(\"SELECT nome FROM tblcategorie\");\r\n    $datiCategoria = eseguiQuery($connessione, $query);\r\n\r\n    foreach ($datiCategoria as $riga) {\r\n        print '<option value=\"' . $riga['nome'] . '\"' . ($riga['nome'] == $dati[0]['categoria'] ? 'selected=\"selected\"' : \"\") . '>' . $riga['nome'] . '</option>';\r\n    }\r\n    print '</select><br />';\r\n    print '<div class=\"label\"><label >Console</label></div>';\r\n    print '<select name=\"console\" class=\"obbligatorio\">';\r\n\r\n    $query = sprintf(\"SELECT nome FROM tblconsole\");\r\n    $datiConsole = eseguiQuery($connessione, $query);\r\n\r\n    foreach ($datiConsole as $riga) {\r\n        print '<option value=\"' . $riga['nome'] . '\"' . ($riga['nome'] == $_POST['console'] ? 'selected=\"selected\"' : \"\") . '>' . $riga['nome'] . '</option>';\r\n    }\r\n    print '</select>';\r\n    print '<br /><input type=\"submit\" class=\"invia\" value=\"Conferma\"></input>';\r\n    print '</fieldset>';\r\n    print \"</form>\";\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\ninclude '../settings/configurazione.inc';\ninclude HOME_ROOT . '/script/funzioni.php';\ninclude HOME_ROOT . '/html/testa.php';\n\nif (isset($_SESSION['collegato'])){\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\n    $query = sprintf(\"SELECT * FROM tblutenti WHERE user='\" . rendiSicuro($_SESSION['username']). \"'\");\n    $dati = eseguiQuery($connessione, $query);\n\n    print '<p class=\"informazione\">Attenzione, dovrai eseguire di nuovo il login, una volta modificato il profilo</p>';\n    print '<form id=\"formProfiloUtente\" action=\"../script/scriptModificaUtente.php\" method=\"post\">';\n    print '<fieldset><legend>Informazioni profilo utente</legend>';\n    print '<input type=\"hidden\" name=\"oldcodicefiscale\" value=\"' . $dati[0]['codicefiscale'] . '\">';\n    print '<div class=\"label\"><label >Codice Fiscale</label></div>';\n    print '<input type=\"text\" maxlength=\"16\" name=\"codicefiscale\" class=\"obbligatorio\" value=\"' . $dati[0]['codicefiscale'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Nome</label></div>';\n    print '<input type=\"text\" name=\"nome\" class=\"obbligatorio\" value=\"' . $dati[0]['nome'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Cognome</label></div>';\n    print '<input type=\"text\" name=\"cognome\" class=\"obbligatorio\" value=\"' . $dati[0]['cognome'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Data Nascita</label></div>';\n    print '<input type=\"text\" name=\"datanascita\" value=\"'.$dati[0]['datanascita'].'\" class=\"obbligatorio\" id=\"calendario\"><br/>';\n    print '<div class=\"label\"><label >Citt&agrave;</label></div>';\n    print '<input type=\"text\" name=\"citta\" class=\"obbligatorio\" value=\"' . $dati[0]['citta'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Indirizzo</label></div>';\n    print '<input type=\"text\" name=\"indirizzo\" class=\"obbligatorio\" value=\"' . $dati[0]['indirizzo'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Email</label></div>';\n    print '<input type=\"text\" name=\"email\" class=\"obbligatorio\" value=\"' . $dati[0]['email'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Telefono</label></div>';\n    print '<input type=\"text\" name=\"telefono\" class=\"obbligatorio intero\" value=\"' . $dati[0]['telefono'] . '\"><br /> ';\n    print '<div class=\"label\"><label >Username</label></div>';\n    print '<input type=\"text\" name=\"username\" class=\"obbligatorio\" value=\"' . $dati[0]['user'] . '\"><br /> ';\n    print '<div class=\"label\"><label>Password</label></div>';\n    print '<input type=\"password\" name=\"password\" class=\"obbligatorio\" value=\"\"><br /> ';\n    print '<input type=\"submit\" class=\"invia\" value=\"Conferma\">';\n    print '</fieldset>';\n    print '</form>';\n    print '<script type=\"text/javascript\">';\n    print \"gestisciForm('#formProfiloUtente','\" .'../script/scriptModificaUtente.php'. \"','#coldx');\";\n    print '</script>';\n} else {\n    print '<p class=\"errore\">Non sei autorizzato a visualizzare questa pagina, per favore, esegui il login.</p>';\n}\n\ninclude HOME_ROOT . '/html/coda.html';\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/html/testa.php';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif (isset($_SESSION['collegato'])) {\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT u.codicefiscale, c.codiceprodotto, c.quantita, p.nomeprodotto, p.prezzo,\r\n    p.immagine, p.categoria, pc.console FROM ((tblutenti AS u JOIN tblcarrelli AS c\r\n    ON u.codicefiscale = c.codiceutente) JOIN tblprodotti AS p on c.codiceprodotto = p.codiceprodotto)\r\n    JOIN tblprodotticonsole AS pc ON p.codiceprodotto = pc.codiceprodotto WHERE u.user='%s'\", rendiSicuro($_SESSION['username']));\r\n\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if($dati) {\r\n    $numeroPagine = ceil(count($dati) / PRODOTTIPERPAGINA);\r\n\r\n    if (!isset($_GET[\"pagina\"])) {\r\n        $pagina = 1;\r\n    } else {\r\n        $pagina = $_GET[\"pagina\"];\r\n    }\r\n\r\n    // $i indica il primo prodotto di ogni pagina.\r\n    $i = ($pagina * PRODOTTIPERPAGINA) - (PRODOTTIPERPAGINA);\r\n\r\n    while ($i < PRODOTTIPERPAGINA * $pagina && $i < count($dati)) {\r\n        print '<div class=\"corpoCatalogo\">' .\r\n            '<div class=\"catcolsx\"><img src=\"' . HOME_WEB . 'img/thumb/' . $dati[$i]['immagine'] . '\" alt=\"Immagine del prodotto\" height=\"165\" width=\"120\">' . '</div>' .\r\n            '<div class=\"catcoldx\"> <p><b>Codice Prodotto: </b>' . $dati[$i]['codiceprodotto'] . '</p>' .\r\n            '<p><b>Nome Prodotto: </b>' . $dati[$i]['nomeprodotto'] . '</p>' .\r\n            '<p><b>Prezzo: </b>' . number_format($dati[$i]['prezzo'], 2) . ' &euro;</p>' .\r\n            '<p><b>Categoria: </b>' . $dati[$i]['categoria'] . '</p>' .\r\n            '<p><b>Console: </b>' . $dati[$i]['console'] . '</p>' .\r\n            '<p><b>Quantita Richiesta: </b>' . $dati[$i]['quantita'] . '</p>';\r\n        print '<form id=\"' . $dati[$i]['codiceprodotto'] . '\" method=\"post\" action=\"../script/scriptEliminazioneCarrello.php\">';\r\n        print '<input type=\"hidden\" name=\"codiceEliminazione\" value=\"' . $dati[$i]['codiceprodotto'] . '\"/>';\r\n        print '<p><b>Quantit&agrave;</b>';\r\n        print '<input type=\"text\" size=\"3\" name=\"quantitaEliminazione\" class=\"intero\" value=\"0\">';\r\n        print '<input type=\"submit\" class=\"invia\" value=\"Elimina\"></p>';\r\n        print '</form>';\r\n        print '</div>' . '</div>';\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('#\" . $dati[$i]['codiceprodotto'] . \"','\" . '../script/scriptEliminazioneCarrello.php' . \"','#coldx');\";\r\n        print '</script>';\r\n        $i++;\r\n    }\r\n        print '<form id=\"confermaAcquisto\" method=\"post\" action=\"moduloVisualizzazioneFattura.php\">';\r\n\r\n        // Questo campo nascosto verr\u00e0 utilizzato per la conferma dell'acquisto e la conseguente eliminazione del carrello dell'utente.\r\n\r\n        print '<input type=\"hidden\" name=\"codicefiscale\" value=\"' . $dati[0]['codicefiscale'] . '\"/>';\r\n        print '<input type=\"submit\" id=\"pulsanteAcquisto\" value=\"Conferma l\\'acquisto\">';\r\n        print '</form>';\r\n\r\n        visualizzaPaginazione($pagina, $numeroPagine, 'Carrello');\r\n\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('#confermaAcquisto','\" . 'moduloVisualizzazioneFattura.php' . \"','#coldx');\";\r\n        print '</script>';\r\n    } else {\r\n        print '<p class=\"informazione\">Il tuo carrello &egrave; vuoto.</p>';\r\n    }\r\n    chiudiConnessione($connessione);\r\n} else {\r\n    print '<p class=\"errore\">Non sei autorizzato a visualizzare questa pagina, per favore, esegui il login.</p>';\r\n}\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\ninclude HOME_ROOT . '/html/testa.php';\r\n\r\n$connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n$query = sprintf(\"SELECT * FROM tblprodotti AS p LEFT JOIN tblprodotticonsole AS pc ON p.codiceprodotto = pc.codiceprodotto\");\r\n$dati = eseguiQuery($connessione, $query);\r\n$cartellaImmaginePrincipale = 'img';\r\n\r\n$numeroPagine = ceil(count($dati) / PRODOTTIPERPAGINA);\r\n\r\nif (!isset($_GET[\"pagina\"])) {\r\n    $pagina = 1;\r\n} else {\r\n    $pagina = $_GET[\"pagina\"];\r\n}\r\n\r\n// $i indica il primo prodotto di ogni pagina.\r\n$i = ($pagina * PRODOTTIPERPAGINA) - (PRODOTTIPERPAGINA);\r\n\r\nwhile ($i < PRODOTTIPERPAGINA * $pagina && $i< count($dati)) {\r\n    print '<div class=\"corpoCatalogo\">' . '<div class=\"catcolsx\"><img alt=\"Immagine non trovata\"\r\n        src=\"' . HOME_WEB . $cartellaImmaginePrincipale . '/thumb/' . $dati[$i]['immagine'] . '\">' .\r\n        '</div>' . '<div class=\"catcoldx\"><p><b>Codice Prodotto: </b>' . $dati[$i]['codiceprodotto'] . '</p>' .\r\n        '<p><b>Nome Prodotto: </b>' . $dati[$i]['nomeprodotto'] . '</p>' .\r\n        '<p><b>Descrizione: </b>' . $dati[$i]['descrizione'] . '</p>' .\r\n        '<p><b>Prezzo: </b>' . number_format($dati[$i]['prezzo'],2) . ' &euro;</p>' .\r\n        '<p><b>Quantit&agrave; Disponibile: </b>' . $dati[$i]['numeropezzi'] . '</p>' .\r\n        '<p><b>Categoria: </b>' . $dati[$i]['categoria'] . '</p>' .\r\n        '<p><b>Console: </b>' . $dati[$i]['console'] . '</p>';\r\n    if (isset($_SESSION['collegato'])) {\r\n        print '<form id=\"' . $dati[$i]['codiceprodotto'] . '\" method=\"post\" action=\"../script/scriptInserimentoCarrello.php\">';\r\n        print '<input type=\"hidden\" name=\"codiceprodotto\" value=\"' . $dati[$i]['codiceprodotto'] . '\"/>';\r\n        print '<p><b>Quantit&agrave;</b>';\r\n        print '<input type=\"text\" size=\"3\" name=\"quantita\" class=\"intero\" value=\"0\">';\r\n        print '<input type=\"submit\" class=\"invia\" value=\"Aggiungi al carrello\"></p>';\r\n        print '</form>';\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('#\" . $dati[$i]['codiceprodotto'] . \"','\" . '../script/scriptInserimentoCarrello.php' . \"','#coldx');\";\r\n        print '</script>';\r\n    } else {\r\n        print '<p class=\"informazione\">Esegui il login per inserire il prodotto nel carrello</p>';\r\n    }\r\n    print '<div class=\"galleria\">';\r\n    print '<script type=\"text/javascript\">';\r\n    print 'gestisciImmaginiGalleria();';\r\n    print '</script>';\r\n    print '<ul id=\"carouse\" class=\"elastislide-list\">';\r\n    visualizzaGalleria($dati[$i]['galleria'], $dati[$i]['codiceprodotto']);\r\n    print '</ul>';\r\n    print '</div>';\r\n    print '</div></div>';\r\n    $i++;\r\n}\r\n\r\nvisualizzaPaginazione($pagina,$numeroPagine,'Catalogo');\r\n\r\nprint '<script type=\"text/javascript\">';\r\nprint 'gestisciThumbnailsGalleria();';\r\nprint '</script>';\r\n\r\nchiudiConnessione($connessione);\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>\r\n", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = sprintf(\"SELECT p.codiceprodotto, p.nomeprodotto, c.quantita, p.prezzo FROM tblcarrelli AS c JOIN tblprodotti AS p ON c.codiceprodotto = p.codiceprodotto WHERE c.codiceutente='%s'\",rendiSicuro($_POST['codicefiscale']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $prezzoFinale = 0;\r\n\r\n    print '<form method=\"post\" id=\"formFattura\" action=\"../script/scriptConfermaAcquisto.php\">';\r\n    print '<fieldset><legend>Fattura</legend>';\r\n    print '<div id=\"tabella\"><table>';\r\n    print '<tr><td>Codice</td><td>Nome</td><td>Quantit&agrave</td><td>Prezzo unitario</td><td>Prezzo parziale</td></tr>';\r\n    foreach ($dati as $prodotto) {\r\n        print '<tr><td>'.$prodotto['codiceprodotto'].'</td><td>'.$prodotto['nomeprodotto'].'</td><td>'.$prodotto['quantita'].'</td><td>'.$prodotto['prezzo'].' &#128</td><td>'.($prodotto['prezzo']*$prodotto['quantita']).' &#128</td></tr>';\r\n        $prezzoFinale = $prezzoFinale + ($prodotto['prezzo']*$prodotto['quantita']);\r\n    }\r\n    print '<tr><td colspan=\"4\"></td><td>'.$prezzoFinale.' &#128</td><td>Prezzo finale</td></tr>';\r\n    print '</table></div>';\r\n    print '</fieldset>';\r\n\r\n    print '<p id=\"carteCredito\">';\r\n    print '<span>Modalit&agrave di pagamento:</span> ';\r\n    print '<img src=\"../img/style/amex1.png\"/>';\r\n    print '<img src=\"../img/style/visa1.png\"/>';\r\n    print '<img src=\"../img/style/mastercard1.png\"/>';\r\n    print '<img src=\"../img/style/cirrus1.png\"/>';\r\n    print '<br /><input type=\"submit\" value=\"Conferma pagamento\" class=\"invia\" />';\r\n    print '</p>';\r\n\r\n    print '</form>';\r\n\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('#formFattura','\" . '../script/scriptConfermaAcquisto.php' . \"','#coldx');\";\r\n    print '</script>';\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n\r\n?>\r\n", "<!DOCTYPE html>\r\n<head>\r\n    <title>Games Commerce</title>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/jquery.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/jquery-ui.min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/pirobox-extended-min.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/modernizr.custom.17475.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/jquery.elastislide.js\"></script>\r\n    <script type=\"text/javascript\" src=\"<?php print HOME_WEB; ?>js/funzioni.js\"></script>\r\n    <link rel=\"stylesheet\" href=\"<?php print HOME_WEB;?>css/stile.css\" type=\"text/css\">\r\n    <link rel=\"stylesheet\" href=\"<?php print HOME_WEB;?>css/jquery-ui.min.css\" type=\"text/css\">\r\n    <link rel=\"stylesheet\" href=\"<?php print HOME_WEB;?>css/style.css\" type=\"text/css\">\r\n    <link rel=\"stylesheet\" href=\"<?php print HOME_WEB;?>css/elastislide.css\" type=\"text/css\">\r\n</head>\r\n<body>\r\n<div id=\"contenuto\">\r\n    <div id=\"testa\">\r\n        <p id=\"titolo\">Games Commerce</p>\r\n    </div>\r\n    <div id=\"logo\">\r\n    </div>\r\n    <nav id=\"menu\">\r\n        <ul>\r\n\r\n            <li><a href=\"<?php print HOME_WEB; ?>index.php\">Home</a></li>\r\n\r\n            <?php\r\n\r\n            if (!isset($_SESSION['collegato'])) {\r\n                print '<li><a href=\"' . HOME_WEB . 'html/moduloRegistrazione.php\">Registrazione Utente</a></li>';\r\n            }\r\n            if (isset($_SESSION['amministratore'])) {\r\n                if ($_SESSION['amministratore']) {\r\n                    print '<li><a href=\"#\">Prodotto</a>';\r\n                    print '<ul>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloInserimentoProdotto.php>Inserimento Prodotto</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloModificaProdotto.php>Modifica Prodotto</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloEliminazioneProdotto.php>Eliminazione Prodotto</a></li>';\r\n                    print '</ul></li>';\r\n                    print '<li><a href=\"#\">Galleria</a>';\r\n                    print '<ul>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloInserimentoImmagine.php>Inserimento Immagini</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloEliminazioneImmagine.php>Eliminazione Immagini</a></li>';\r\n                    print '</ul></li>';\r\n                    print '<li><a href=\"#\">Categoria</a>';\r\n                    print '<ul>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloInserimentoCategoria.php>Inserimento Categoria</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloModificaCategoria.php>Modifica Categoria</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloEliminazioneCategoria.php>Eliminazione Categoria</a></li>';\r\n                    print '</ul></li>';\r\n                    print '<li><a href=\"#\">Console</a>';\r\n                    print '<ul>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloInserimentoConsole.php>Inserimento Console</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloModificaConsole.php>Modifica Console</a></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloEliminazioneConsole.php>Eliminazione Console</a></li>';\r\n                    print '</ul></li>';\r\n                    print'<li><a href=' . HOME_WEB . 'html/moduloAmministrazione.php>Amministrazione</a></li>';\r\n                }\r\n            }\r\n            if (isset($_SESSION['collegato'])) {\r\n                print'<li><a href=' . HOME_WEB . 'html/moduloVisualizzazioneCarrello.php>Carrello</a></li>';\r\n            } else {\r\n                print'<li><a href=' . HOME_WEB . 'html/moduloLogin.php>Carrello</a></li>';\r\n            }\r\n            ?>\r\n            <li><a href=\"<?php print HOME_WEB ?>html/moduloVisualizzazioneCatalogo.php\">Catalogo</a></li>\r\n            <?php\r\n            if (isset($_SESSION['collegato'])) {\r\n                print '<li><a href=' . HOME_WEB . 'html/moduloModificaUtente.php>Profilo Utente</a></li>';\r\n            }\r\n            if (!isset($_SESSION['collegato'])) {\r\n                print '<li><a href=' . HOME_WEB . 'html/moduloLogin.php>Login</a></li>';\r\n            } else {\r\n                print '<li><a href=' . HOME_WEB . 'script/scriptLogout.php>Logout</a></li>';\r\n            }\r\n            print '</ul>';\r\n            print '</nav>';\r\n            ?>\r\n            <div id=\"corpo\">\r\n                <div id=\"colsx\">\r\n                </div>\r\n                <div id=\"coldx\"> <!-- Chiusura di coldx nel file coda.html -->", "<?php\r\n\r\nfunction creaConnessione($server,$utente,$password,$database) {\r\n    $connessione = mysqli_connect($server, $utente, $password);\r\n    mysqli_select_db($connessione,$database) or die(mostraErrore($connessione));\r\n    return $connessione;\r\n}\r\n\r\nfunction eseguiQuery($connessione,$query){\r\n    $risultatoQuery = mysqli_query($connessione,$query)or die(mostraErrore($connessione));\r\n    $dati = array();\r\n    /* Se non viene eseguita una query di insert, update o delete, che ritornano un booleano,\r\n    le tuple selezionate vengono messe in un vettore; viene cosi ottenuto un vettore di\r\n    vettori associativi*/\r\n    if(!is_bool($risultatoQuery)) {\r\n        while($riga = mysqli_fetch_assoc($risultatoQuery)){\r\n            $dati[] = $riga;\r\n        }\r\n    }\r\n    return $dati;\r\n}\r\n\r\nfunction rendiSicuro($parametro){\r\n    // La funzione viene impiegata per evitare eventuali tentativi di sql injection nel database\r\n    if(get_magic_quotes_gpc()){\r\n        return $parametro;\r\n    }else{\r\n        return mysql_real_escape_string($parametro);\r\n    }\r\n}\r\n\r\nfunction chiudiConnessione($connessione){\r\n    mysqli_close($connessione);\r\n}\r\n\r\nfunction mostraErrore($connessione){\r\n    echo '<p class=\"errore\">'.\"I dati che hai inserito hanno generato questo errore: \".mysqli_error($connessione).\"</p>\";\r\n}\r\n\r\nfunction gestioneImmagine($indice, $galleria){\r\n    // Vengono analizzati i valori presenti nel vettore $_FILES per determinare l'esito del caricamento\r\n    if($indice == -1){\r\n        // Caso in cui viene gestita l'immagine principale del prodotto\r\n        $errore = $_FILES['immagine']['error'];\r\n        $nome = $_FILES['immagine']['name'];\r\n        $temp = $_FILES['immagine']['tmp_name'];\r\n    }else{\r\n        // Caso in cui viene gestita un'immagine proveniente dalla galleria\r\n        $errore = $_FILES['immagini']['error'][$indice];\r\n        $nome = $_FILES['immagini']['name'][$indice];\r\n        $temp = $_FILES['immagini']['tmp_name'][$indice];\r\n    }\r\n    // Se le campo 'error' viene trovato il seguente flag, si pu\u00f2 procedere con la copia dell'immagine\r\n    if ($errore == UPLOAD_ERR_OK) {\r\n        copy($temp, HOME_ROOT . '/' . 'img' . '/'.$galleria.'/' . $nome);\r\n        $messaggio = \"L'immagine &egrave; stata caricata senza problemi\";\r\n        print '<p class=\"successo\">' . $nome . ' - Esito : ' . $messaggio . \"</p>\";\r\n        return true;\r\n    } else {\r\n        // Se viene individuato qualsiasi altro flag, c'\u00e8 stato un problema\r\n        switch ($errore) {\r\n            case UPLOAD_ERR_INI_SIZE:\r\n                $messaggio = \"L'immagine caricata &egrave; troppo grande rispetto alla direttiva specificata in php.ini\";\r\n                break;\r\n            case UPLOAD_ERR_FORM_SIZE:\r\n                $messaggio = \"L'immagine caricata &egrave; troppo grande rispetto alla direttiva specificata nel form html\";\r\n                break;\r\n            case UPLOAD_ERR_PARTIAL:\r\n                $messaggio = \"L'immagine &egrave; stata caricata parzialmente\";\r\n                break;\r\n            case UPLOAD_ERR_NO_FILE:\r\n                $messaggio = \"L'immagine non &egrave; stata caricata\";\r\n                break;\r\n            case UPLOAD_ERR_NO_TMP_DIR:\r\n                $messaggio = \"Immagine temporanea mancante\";\r\n                break;\r\n            case UPLOAD_ERR_CANT_WRITE:\r\n                $messaggio = \"Impossibile scrivere l'immagine su disco\";\r\n                break;\r\n            case UPLOAD_ERR_EXTENSION:\r\n                $messaggio = \"Caricamento dell'immagine bloccato da un estensione\";\r\n                break;\r\n        }\r\n        // L'errore viene infine stampato a schermo\r\n        print '<p class=\"errore\">' . $nome . ' - Esito : ' . strtoupper($messaggio) . \"</p>\";\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction generaThumbnail($imSorgente, $percorso, $larghezza, $altezza, $indice){\r\n    if(!is_dir(HOME_ROOT .$percorso)){\r\n        mkdir(HOME_ROOT .$percorso);\r\n    }\r\n    // Assegna alle variabili specificate le dimensioni dell'immagine sorgente.\r\n    list($larghezzaOriginale, $altezzaOriginale) = getimagesize($imSorgente);\r\n    // Genera un' immagine nera con le dimensioni specificate\r\n    $thumb = imagecreatetruecolor($larghezza, $altezza);\r\n    // Caso in cui viene gestita l'immagine principale del prodotto\r\n    if($indice == -1){\r\n        $tipo = $_FILES['immagine']['type'];\r\n    }else{\r\n        // Caso in cui viene gestita un'immagine proveniente dalla galleria\r\n        $tipo = $_FILES['immagini']['type'][$indice];\r\n    }\r\n    // In base al tipo dell'immagine sorgente viene generata una nuova immagine\r\n    switch($tipo) {\r\n        case \"image/jpeg\":\r\n        $immagine = @imagecreatefromjpeg($imSorgente);\r\n        break;\r\n        case \"image/gif\":\r\n        $immagine = @imagecreatefromgif($imSorgente);\r\n        break;\r\n        case \"image/png\":\r\n        $immagine = @imagecreatefrompng($imSorgente);\r\n        break;\r\n    }\r\n    /* L'immagine generata dall' imaagine sorgente viene copiata interamente nell' immagine nera generata\r\n    precedentemente e viene ridimensionata secondo le dimensioni specificate*/\r\n    imagecopyresized($thumb, $immagine, 0, 0, 0, 0, $larghezza, $altezza, $larghezzaOriginale, $altezzaOriginale);\r\n    // L'immagine che costituir\u00e0 la thumbnail viene creata nel percorso specificato.\r\n    if($indice == -1){\r\n        imagejpeg($thumb,HOME_ROOT.$percorso.'/'. $_FILES['immagine']['name']);\r\n    } else {\r\n        imagejpeg($thumb,HOME_ROOT.$percorso.'/'. $_FILES['immagini']['name'][$indice]);\r\n    }\r\n    // Viene liberata la memoria\r\n    imagedestroy($thumb);\r\n    imagedestroy($immagine);\r\n}\r\n\r\nfunction visualizzaGalleria($galleria,$nomeClasse) {\r\n    $percorsoThumbnails = '../img/thumb/'.$galleria.'/';\r\n    $percorsoGalleria = '../img/'.$galleria.'/';\r\n    // La funzione glob cerca tutte le immagini presenti nel percorso specificato.\r\n    $thumbnails = glob($percorsoThumbnails . \"*\");\r\n    foreach ($thumbnails as $thumb) {\r\n        print '<li><a href=\"'.$percorsoGalleria.basename($thumb).'\" rel=\"gallery\" class=\"pirobox_gall'.$nomeClasse.'\">\r\n                <img width=\"100\" alt=\"Non trovata\" height=\"58\" src=\"'.$thumb.'\"></a></li>';\r\n    }\r\n}\r\n\r\nfunction ricercaProdotto($nomeCercato,$destinazione) {\r\n\r\n    // La funzione di ricerca viene utilizzata nelle fasi di modifica e cancellazione per individuare l'oggetto dell'operazione\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    print '<p class=\"informazione\">Sono stati individuati i seguenti risultati potenziali</p>';\r\n    $query = \"SELECT * FROM tblprodotti AS p LEFT JOIN tblprodotticonsole AS pc ON p.codiceprodotto = pc.codiceprodotto WHERE nomeprodotto LIKE '%\".rendiSicuro($nomeCercato).\"%' ORDER BY nomeprodotto ASC\";\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $contantoreRisultati = 0;\r\n\r\n    foreach($dati as $riga ){\r\n        /* Ogni risultato parziale costituisce un form a se stante; per ognuno di essi, viene assegnato un id univoco e\r\n         e viene fatto il print della chiamata alla funzione jQuery che li invia in modo asincrono.\r\n        la chiave primaria della tupla viene  utilizzata come id, e i campi necessari sono passati come controlli input nascosti.*/\r\n        print '<form id=\"' . trim($riga['codiceprodotto']) . '\" method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n        print '<input type=\"hidden\" name=\"codiceprodotto\" value=\"'.$riga['codiceprodotto'].'\"/>';\r\n        print '<input type=\"hidden\" name=\"console\" value=\"'.$riga['console'].'\"/>';\r\n        print '<div class=\"label\"><label>'.$riga['nomeprodotto'].' - '.$riga['console'].'</label></div>';\r\n        print '<input type=\"submit\" value=\"Seleziona\"/>';\r\n        print '</form>';\r\n        print '<br />';\r\n        $contantoreRisultati++;\r\n        // Chiamata alla funzione\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('\" . \"#\" . trim($riga['codiceprodotto']) . \"','\" . trim($destinazione) . \"','#coldx');\";\r\n        print '</script>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    if($contantoreRisultati == 0){\r\n        print '<p class=\"errore\">La ricerca non ha prodotto alcun risultato.</p>';\r\n    }\r\n}\r\n\r\nfunction ricercaCategoria($nomeCercato, $destinazione){\r\n\r\n    // La funzione di ricerca viene utilizzata nelle fasi di modifica e cancellazione per individuare l'oggetto dell'operazione\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = \"SELECT * FROM tblcategorie WHERE nome LIKE '%\".rendiSicuro($nomeCercato).\"%'\".\"ORDER BY nome ASC\";\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $contantoreRisultati = 0;\r\n    print '<p class=\"informazione\">Sono stati individuati i seguenti risultati potenziali</p>';\r\n\r\n    foreach($dati as $riga ){\r\n        /* La funzione \u00e8 analoga a quella impiegata nella ricerca del prodotto, con una variante;\r\n        poich\u00e8 la chiave primaria della tabella delle categoria \u00e8 il nome, pu\u00f2 contenere degli spazi,\r\n        perci\u00f2 viene usata un'espressione regolare per rimuovere gli spazi indesiderati e ottenere\r\n        un id adeguato per ciascun form */\r\n        $idCorretto = preg_replace('/\\s+/', 'A', $riga['nome']);\r\n        print '<form id=\"'.$idCorretto.'\" method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n        print '<div class=\"label\"><label>'.$riga['nome'].'</label></div>';\r\n        print '<input type=\"hidden\" name=\"nome\" value=\"'.$riga['nome'].'\">';\r\n        print '<input type=\"submit\" value=\"Seleziona\"/>';\r\n        print '</form>';\r\n        print '<br />';\r\n        $contantoreRisultati++;\r\n        // Chiamata alla funzione dove il primo parametro \u00e8 l'id corretto\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('\".\"#\".$idCorretto.\"','\".trim($destinazione) . \"','#coldx');\";\r\n        print '</script>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    if($contantoreRisultati == 0){\r\n        print '<p class=\"errore\">La ricerca non ha prodotto alcun risultato.</p>';\r\n    }\r\n}\r\n\r\nfunction ricercaConsole($nomeCercato, $destinazione){\r\n\r\n    // La funzione di ricerca viene utilizzata nelle fasi di modifica e cancellazione per individuare l'oggetto dell'operazione\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = \"SELECT * FROM tblconsole WHERE nome LIKE '%\".rendiSicuro($nomeCercato).\"%'\".\"ORDER BY nome ASC\";\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $contantoreRisultati = 0;\r\n\r\n    print '<p class=\"informazione\">Sono stati individuati i seguenti risultati potenziali</p>';\r\n    foreach($dati as $riga ){\r\n        // Il funzionamento \u00e8 analogo a quello della ricerca della categoria\r\n        $idCorretto = preg_replace('/\\s+/', 'A', $riga['nome']);\r\n        print '<form id=\"' . $idCorretto . '\" method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n        print '<input type=\"hidden\" name=\"nome\" value=\"'.$riga['nome'].'\">';\r\n        print '<div class=\"label\"><label>'.$riga['nome'].'</label></div>';\r\n        print '<input type=\"submit\" value=\"Seleziona\"/>';\r\n        print '</form>';\r\n        print '<br />';\r\n        $contantoreRisultati++;\r\n        print '<script type=\"text/javascript\">';\r\n        print \"gestisciForm('\" . \"#\" . $idCorretto . \"','\" . trim($destinazione) . \"','#coldx');\";\r\n        print '</script>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    if($contantoreRisultati == 0){\r\n        print '<p class=\"errore\">La ricerca non ha prodotto alcun risultato.</p>';\r\n    }\r\n}\r\n\r\nfunction ricercaUtente($utenteCercato, $destinazione){\r\n\r\n    // La funzione stampa direttamente tutti gli utenti registrati\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = \"SELECT user, dirittoAmministratore FROM tblutenti WHERE user != '\".rendiSicuro($_SESSION['username']).\"' AND user LIKE '%\".rendiSicuro($utenteCercato).\"%'\".\" ORDER BY user ASC\";\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $contantoreRisultati = 0;\r\n\r\n    // Il codice seguente stampa il controllo che da la possibilit\u00e0 di modificare i privilegi amministrativi degli utenti registrati\r\n    print '<p class=\"informazione\">Sono stati individuati i seguenti risultati potenziali</p><br />';\r\n    foreach($dati as $riga ){\r\n        $contantoreRisultati++;\r\n        print '<form method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n        print '<div class=\"label\"><label>'.$riga['user'].'</label></div>';\r\n        print '<input type=\"hidden\" name=\"user[]\" value=\"'.$riga['user'].'\">';\r\n        print '<select name=\"dirittoAmministratore[]\">';\r\n        if($riga['dirittoAmministratore'] == 'si'){\r\n            print '<option selected>si</option>';\r\n            print '<option>no</option>';\r\n        }else{\r\n            print '<option>si</option>';\r\n            print '<option selected>no</option>';\r\n        }\r\n        print '</select>';\r\n        print '<label> diritto da amministratore';\r\n        print '<br /><br />';\r\n    }\r\n    print '<input type=\"submit\" value=\"Conferma\"/>';\r\n    print '</form>';\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('\" . \"#\" . trim($riga['user']) . \"','\" . trim($destinazione) . \"','#coldx');\";\r\n    print '</script>';\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    if($contantoreRisultati == 0){\r\n        print '<p class=\"errore\">La ricerca non ha prodotto alcun risultato.</p>';\r\n    }\r\n}\r\n\r\nfunction stampaModuloRicerca($destinazione, $nome){\r\n    /* La funzione viene chiamata prima di ogni operazione di modifica o eliminazione per individuare l'oggetto\r\n    dell'operazione stessa */\r\n    print '<form id=\"formRicerca\" method=\"post\" action=\"' . trim($destinazione) . '\">';\r\n    print '<fieldset><legend>Ricerca '.$nome.'</legend>';\r\n    print '<div class=\"label\"><label >Nome</label></div>';\r\n    print '<input type=\"text\" name=\"nome\" class=\"obbligatorio\">';\r\n    print '<input type=\"submit\" value=\"Cerca\" >';\r\n    print '</fieldset>';\r\n    print \"</form>\";\r\n    print '<script type=\"text/javascript\">';\r\n    print \"gestisciForm('#formRicerca','\" . trim($destinazione) . \"','#coldx');\";\r\n    print '</script>';\r\n}\r\n\r\nfunction cancellaCartella($cartella) {\r\n    // La funzione viene chiamata quando viene eliminato un prodotto\r\n    if (is_dir($cartella)) {\r\n        // Vengono individuati tutti i file della cartella\r\n        $files = scandir($cartella);\r\n        /* Ogni file viene eliminato. Il ciclo parte da due poich\u00e8 le prime due posizioni del vettore sono occupate da\r\n        elementi di navigazione per entrare in eventuali sotto cartelle */\r\n        for ($i = 2; $i < count($files); $i++) {\r\n            unlink($cartella . '/' . $files[$i]);\r\n        }\r\n        // Una volta eliminati i file, viene eliminata la cartella\r\n        rmdir($cartella);\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction cancellaImmagine($immagine) {\r\n    if (file_exists($immagine)) {\r\n        unlink($immagine);\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction visualizzaPaginazione($pagina,$numeroPagine,$destinazione){\r\n    /* La funzione viene chiamata quando viene stampato un numero elevato di elementi e si rende quindi\r\n    necessaria la paginazione degli stessi. I successivi controlli servono a stampare i numeri di pagina nel\r\n    formato desiderato. Se la pagina corrente ha uno scarto maggiore di uno dall'inizio o dalla fine, vengono\r\n    aggiunti dei puntini, oltre al link alla pagina precedente e a quella successiva\r\n\r\n    Esempio: 1 ... 4 5 6 ... 9 */\r\n\r\n    if($numeroPagine > 1){\r\n        print '<p class=\"numeriPagine\">Pagine: ';\r\n        if($pagina == 1) {\r\n            if(($pagina + 1) != $numeroPagine){\r\n                print '<b>'.($pagina).' </b><a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=' . ($pagina + 1) . '\">'.($pagina+1).'</a>';\r\n            } else {\r\n                print '<b>'.($pagina).' </b>';\r\n            }\r\n            if($numeroPagine-$pagina>2){\r\n                print' ... '.'<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina='.$numeroPagine.'\">'.$numeroPagine.'</a>';\r\n            }else{\r\n                print'<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina='.$numeroPagine.'\"> '.$numeroPagine.'</a>';\r\n            }\r\n        } elseif ($pagina == $numeroPagine) {\r\n            if($numeroPagine-1>2){\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=1\">1</a> ... ';\r\n            }else{\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=1\">1 </a>';\r\n            }\r\n            if(($pagina - 1) != 1){\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=' . ($pagina - 1) . '\">'.($pagina-1).'</a>'.'<b> '.($pagina).'</b>';\r\n            }else{\r\n                print '<b> '.($pagina).'</b>';\r\n            }\r\n        } else {\r\n            print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=1\">1 </a>';\r\n            if($pagina-1>2){\r\n                print ' ... ';\r\n            }\r\n            if($pagina - 1 != 1){\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=' . ($pagina - 1) . '\">'.($pagina - 1).' </a>';\r\n            }\r\n            print '<b>'.$pagina.'</b>';\r\n            if($pagina + 1 != $numeroPagine){\r\n                print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina=' . ($pagina + 1) . '\"> '.($pagina + 1).'</a>';\r\n            }\r\n            if($numeroPagine-$pagina>2){\r\n                print' ...';\r\n            }\r\n            print '<a href=\"moduloVisualizzazione'.$destinazione.'.php?pagina='.$numeroPagine.'\"> '.$numeroPagine.'</a>';\r\n        }\r\n        print '</p>';\r\n    }\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/html/testa.php';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    for($i = 0; $i < count($_POST['user']); $i++) {\r\n        $query = sprintf(\"UPDATE tblutenti SET dirittoAmministratore='%s' WHERE user='%s'\", rendiSicuro($_POST['dirittoAmministratore'][$i]), rendiSicuro($_POST['user'][$i]));\r\n        $dati = eseguiQuery($connessione, $query);\r\n    }\r\n\r\n    print '<p class=\"successo\">La modifica dei diritti da amministratore &grave; avvenuta correttamente</p>';\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n}\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n\r\n    /* Il codice fiscale viene salvato per poter recuperare le tuple presenti nella tabella molti a molti del carrello\r\n     in base all'utente collegato con un dato username in quell'istante */\r\n    $query = sprintf(\"SELECT codicefiscale FROM tblutenti WHERE user='\".rendiSicuro($_SESSION['username']).\"'\");\r\n    $dati = eseguiQuery($connessione,$query);\r\n    $codiceFiscale = $dati[0]['codicefiscale'];\r\n\r\n    // Recupero dei prodotti inseriti nel carrello dell'utente collegato\r\n    $connessione = creaConnessione(SERVER,UTENTE,PASSWORD,DATABASE);\r\n    $query = sprintf(\"SELECT p.codiceprodotto, p.nomeprodotto, c.quantita, p.prezzo FROM tblcarrelli AS c JOIN tblprodotti AS p ON c.codiceprodotto = p.codiceprodotto WHERE c.codiceutente='%s'\",rendiSicuro($codiceFiscale));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    foreach ($dati as $prodotto) {\r\n        // Per ogni prodotto, viene recuperata la quantit\u00e0 in magazzino\r\n        $query = sprintf(\"SELECT numeropezzi FROM tblprodotti WHERE codiceprodotto='%s'\",rendiSicuro($prodotto['codiceprodotto']));\r\n        $infoPezzi = eseguiQuery($connessione,$query);\r\n        // La quantit\u00e0 aggiornata \u00e8 data dalla quantit\u00e0 in magazzino meno la quantit\u00e0 richiesta\r\n        $quantit\u00e0Aggiornata = $infoPezzi[0]['numeropezzi'] - $prodotto['quantita'];\r\n        // L'informazione su dabatase viene aggiornata\r\n        $query = sprintf(\"UPDATE tblprodotti SET numeropezzi='%d' WHERE codiceprodotto='%s'\",rendiSicuro($quantit\u00e0Aggiornata),rendiSicuro($prodotto['codiceprodotto']));\r\n        $dati = eseguiQuery($connessione,$query);\r\n    }\r\n\r\n// Una volta compiute le operazioni d'aggiornamento, le tuple dell'utente nel carrello vengono cancellate\r\n    $query = sprintf(\"DELETE FROM tblcarrelli WHERE codiceutente='%s'\",rendiSicuro($codiceFiscale));\r\n    eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">L\\'acquisto &egrave stato completato con successo</p>';\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>\r\n", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"SELECT user, psw, dirittoamministratore FROM tblutenti WHERE user=\" . \"'\" . rendiSicuro($_POST['username']) . \"'\" . \" AND \" . \"psw=\" . \"'\" . rendiSicuro(sha1($_POST['password'])) . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if ($dati == null) {\r\n        print '<p class=\"errore\">Alcuni dei tuoi dati sono errati, riprova</p>';\r\n    } else { // Se la query ritorna una tupla\r\n        // Le due variabili di sessione vengono impostate per mantenere lo stato dell'utente verificato\r\n        $_SESSION['username'] = $_POST['username'];\r\n        $_SESSION['password'] = $_POST['password'];\r\n        // Se il flag relativo ai privilegi amministrativi \u00e8 si, allora l'utente \u00e8 un amministratore\r\n        if ($dati[0][\"dirittoamministratore\"] == \"si\") {\r\n            /* La seguente variabile di sessione viene usata in diversi punti del codice per fare in modo che solamente\r\n            l'amministratore possa accedere a determinare aree del sito*/\r\n            $_SESSION['amministratore'] = true;\r\n        } else {\r\n            $_SESSION['amministratore'] = false;\r\n        }\r\n        /* La seguente variabile di sessione viene usata per controllare che qualcuno sia collegato, indipendentemente dal\r\n        fatto che sia amministratore o meno */\r\n        $_SESSION['collegato'] = true;\r\n        // Una volta terminate le operazioni, viene eseguito un ridirezionamento tramite jQuery\r\n        print '<script type=\"text/javascript\">';\r\n        print \"$(window.location).attr('href', '../index.php');\";\r\n        print '</script>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>\r\n", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $utente = $_SESSION['username'];\r\n    $quantitaEliminazione = $_POST['quantitaEliminazione'];\r\n    $codiceEliminazione = $_POST['codiceEliminazione'];\r\n\r\n// La query recupera la tupla del prodotto da eliminare dal carrello in base al codice del prodotto stesso e all'utente collegato\r\n    $query = sprintf(\"SELECT u.codicefiscale, c.codiceprodotto, c.quantita\r\n             FROM tblutenti AS u JOIN tblcarrelli AS c ON u.codicefiscale = c.codiceutente\r\n             WHERE u.user='%s' AND c.codiceprodotto='%s'\", rendiSicuro($utente), rendiSicuro($codiceEliminazione));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if ($quantitaEliminazione > $dati[0]['quantita']) {\r\n        print '<p class=\"errore\">Non puoi eliminare dal carrello una quantita maggiore di quella inserita precedentemente</p>';\r\n    } else {\r\n\r\n        // il codice fiscale dell'utente collegato viene recuperato\r\n        $query = sprintf(\"SELECT codicefiscale FROM tblutenti WHERE user='%s'\", rendiSicuro($utente));\r\n        $infoUtente = eseguiQuery($connessione, $query);\r\n        $codiceFiscale = $infoUtente[0]['codicefiscale'];\r\n\r\n\r\n        // la quantit\u00e0 di prodotto presente nel carrello dell'utente viene aggiornata\r\n        $quantitaAggiornata = $dati[0]['quantita'] - $quantitaEliminazione;\r\n        $query = sprintf(\"UPDATE tblCarrelli SET quantita='%d' WHERE codiceprodotto='%s' AND codiceutente='%s'\", rendiSicuro($quantitaAggiornata), rendiSicuro($codiceEliminazione), rendiSicuro($codiceFiscale));\r\n        $dati = eseguiQuery($connessione, $query);\r\n\r\n        $query = sprintf(\"SELECT quantita FROM tblcarrelli WHERE codiceprodotto='%s' AND codiceutente='%s'\", rendiSicuro($codiceEliminazione), rendiSicuro($codiceFiscale));\r\n        $dati = eseguiQuery($connessione, $query);\r\n\r\n        // Se la nuova quantit\u00e0 di prodotto presente nel carrello \u00e8 negativa o zero, l'intera tupla viene eliminata\r\n        if ($dati[0]['quantita'] <= 0) {\r\n            $query = sprintf(\"DELETE FROM tblcarrelli WHERE codiceutente='%s' AND codiceprodotto='%s'\", rendiSicuro($codiceFiscale), rendiSicuro($codiceEliminazione));\r\n            $dati = eseguiQuery($connessione, $query);\r\n        }\r\n        print '<p class=\"successo\">Aggiornamento del carrello eseguito correttamente</p>';\r\n    }\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>\r\n", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT COUNT(codiceprodotto) FROM tblprodotti WHERE categoria='%s'\", rendiSicuro($_POST['nome']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if(intval($dati[0]['COUNT(codiceprodotto)'] > 0)){\r\n        print '<p class=\"informazione\">Elimina tutti i prodotti presenti in questa categoria prima di procedere</p>';\r\n    } else {\r\n        $query = sprintf(\"DELETE FROM tblcategorie WHERE nome='%s'\", rendiSicuro($_POST['nome']));\r\n        $dati = eseguiQuery($connessione, $query);\r\n        print '<p class=\"successo\">La categoria &egrave; stata eliminata con successo</p>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"SELECT COUNT(console) FROM tblprodotticonsole WHERE console='%s'\", rendiSicuro($_POST['nome']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if(intval($dati[0]['COUNT(console)'] > 0)){\r\n        print '<p class=\"informazione\">Elimina tutti i prodotti associati a questa console prima di procedere</p>';\r\n    } else {\r\n        $query = sprintf(\"DELETE FROM tblconsole WHERE nome='%s'\", rendiSicuro($_POST['nome']));\r\n        $dati = eseguiQuery($connessione, $query);\r\n        print '<p class=\"successo\">La console &egrave; stata eliminata con successo</p>';\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $query = sprintf(\"DELETE FROM tblcarrelli WHERE codiceprodotto='%s'\", rendiSicuro($_POST['codiceprodotto']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"DELETE FROM tblprodotticonsole WHERE codiceprodotto='%s'\", rendiSicuro($_POST['codiceprodotto']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"SELECT galleria, immagine FROM tblprodotti WHERE codiceprodotto='%s'\", rendiSicuro($_POST['codiceprodotto']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"SELECT COUNT(galleria) FROM tblprodotti WHERE galleria ='%s'\", rendiSicuro($dati[0]['galleria']));\r\n    $numeroVersioni = eseguiQuery($connessione, $query);\r\n\r\n    // $numeroVersioni indica quanti prodotti condividono la stessa galleria\r\n    if (intval($numeroVersioni[0]['COUNT(galleria)'] > 1)) {\r\n        print '<p class=\"informazione\">Poich\u00e8 ci sono pi\u00f9 versioni dello stesso gioco, la corrispondente galleria non &egrave; stata cancellata.</p>';\r\n    } else {\r\n        if (cancellaCartella('../img/' . $dati[0]['galleria'])) {\r\n            print '<p class=\"successo\">La cartella contenente le immagini &egrave; stata cancellata con successo</p>';\r\n        } else {\r\n            print '<p class=\"errore\">La cartella contenente le immagini non esiste</p>';\r\n        }\r\n\r\n        if (cancellaCartella('../img/thumb/' . $dati[0]['galleria'])) {\r\n            print '<p class=\"successo\">La cartella contenente le thumbnails &egrave; stata cancellata con successo</p>';\r\n        } else {\r\n            print '<p class=\"errore\">La cartella contenente le thumbnails non esiste</p>';\r\n        }\r\n    }\r\n\r\n    if (cancellaImmagine('../img/' . $dati[0]['immagine'])) {\r\n        print '<p class=\"successo\">L\\'immagine principale &egrave; stata cancellata con successo</p>';\r\n    } else {\r\n        print '<p class=\"errore\">L\\'immagine principale non esiste</p>';\r\n    }\r\n\r\n    if (cancellaImmagine('../img/thumb/' . $dati[0]['immagine'])) {\r\n        print '<p class=\"successo\">La thumbnail dell\\'immagine principale &egrave; stata cancellata con successo</p>';\r\n    } else {\r\n        print '<p class=\"errore\">La thumbnail dell\\'immagine principale non esiste</p>';\r\n    }\r\n\r\n    $query = sprintf(\"DELETE FROM tblprodotti WHERE codiceprodotto='%s'\", rendiSicuro($_POST['codiceprodotto']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    print '<p class=\"successo\">Il prodotto &egrave; stato eliminato con successo</p>';\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    $utente = $_SESSION['username'];\r\n\r\n    $quantitaInserimento = $_POST['quantita'];\r\n    $codiceInserimento = $_POST['codiceprodotto'];\r\n\r\n    $query = sprintf(\"SELECT numeropezzi FROM tblprodotti WHERE codiceprodotto='%s'\", rendiSicuro($codiceInserimento));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if (($quantitaInserimento > $dati[0]['numeropezzi']) || ($quantitaInserimento <= 0)) {\r\n        print '<p class=\"errore\">Non puoi comprare un numero di prodotti negativo oppure maggiore della quantita disponibile. Riprova.</p>';\r\n    } else {\r\n\r\n        $query = sprintf(\"SELECT u.codicefiscale, c.codiceprodotto, c.quantita, p.numeropezzi\r\n             FROM (tblutenti AS u JOIN tblcarrelli AS c ON u.codicefiscale = c.codiceutente)\r\n             JOIN tblprodotti AS p on c.codiceprodotto = p.codiceprodotto\r\n             WHERE u.user='%s' AND c.codiceprodotto='%s'\", rendiSicuro($utente), rendiSicuro($codiceInserimento));\r\n\r\n        $dati = eseguiQuery($connessione, $query);\r\n        $codiceFiscale = $dati[0]['codicefiscale'];\r\n\r\n        // Se il prodotto selezionato non \u00e8 gi\u00e0 presente nel carrello, lo aggiunge.\r\n        if (!$dati) {\r\n            $query = sprintf(\"INSERT INTO tblcarrelli(codiceprodotto, codiceutente, quantita) VALUE ('%s','%s','%d')\", rendiSicuro($codiceInserimento), rendiSicuro($codiceFiscale), rendiSicuro($quantitaInserimento));\r\n            $dati = eseguiQuery($connessione, $query);\r\n            print '<p class=\"successo\">Inserimento nel carrello avvenuto correttamente</p>';\r\n        } else {\r\n            // Se \u00e8 gi\u00e0 presente vengono fatti dei controlli e viene aggiorata la quantit\u00e0\r\n            $quantitaTotale = $dati[0]['quantita'] + $quantitaInserimento;\r\n            if ($quantitaTotale > $dati[0]['numeropezzi']) {\r\n                print '<p class=\"errore\">Attenzione, non puoi inserire una quantit&agrave; di prodotto maggiore di quella in magazzino!</p>';\r\n            } else {\r\n                $query = sprintf(\"UPDATE tblcarrelli SET quantita='%d' WHERE codiceprodotto='%s' AND codiceutente ='%s'\", rendiSicuro($quantitaTotale), rendiSicuro($codiceInserimento), rendiSicuro($codiceFiscale));\r\n                $dati = eseguiQuery($connessione, $query);\r\n                print '<p class=\"successo\">Aggiornamento del carrello avvenuto correttamente</p>';\r\n            }\r\n        }\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"INSERT INTO tblcategorie(nome) VALUE ('%s')\", rendiSicuro($_POST['nome']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">' . \"L'inserimento della categoria &egrave; avvenuto correttamente</p>\";\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    if (trim($_POST['produttore']) == '') {\r\n        $query = sprintf(\"INSERT INTO tblconsole(nome) VALUE ('%s')\", rendiSicuro($_POST['nome']));\r\n    } else {\r\n        $query = sprintf(\"INSERT INTO tblconsole(nome,produttore) VALUE ('%s','%s')\", rendiSicuro($_POST['nome']), rendiSicuro($_POST['produttore']));\r\n    }\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">' . \"L'inserimento della console &egrave; avvenuto correttamente</p>\";\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\ninclude HOME_ROOT . '/html/testa.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"SELECT galleria FROM tblprodotti WHERE codiceprodotto='\" . rendiSicuro($_POST['codiceprodotto']) . \"'\");\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $percorsoGalleria = 'img/' . $dati[0]['galleria'];\r\n\r\n    for ($i = 0; $i < count($_FILES['immagini']['name']); $i++) {\r\n        if(gestioneImmagine($i,$dati[0]['galleria'])){\r\n            generaThumbnail($_FILES['immagini']['tmp_name'][$i],'/img/thumb/'.$dati[0]['galleria'],370,220,$i);\r\n        }\r\n    }\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n}\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\ninclude HOME_ROOT . '/html/testa.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $percorsoCartella = '../img/' . trim($_POST['galleria']);\r\n\r\n    //Se l'indice \u00e8 -1 indica che viene caricata una singola immagine.\r\n    $indice = -1;\r\n\r\n    gestioneImmagine($indice,'');\r\n    generaThumbnail($_FILES['immagine']['tmp_name'],'/img/thumb',200,268,$indice);\r\n\r\n    $query = sprintf(\"INSERT INTO tblprodotti(codiceprodotto, nomeprodotto, descrizione, prezzo, numeropezzi, immagine, galleria, categoria) VALUE ('%s','%s','%s','%d','%d','%s','%s','%s')\", rendiSicuro(strtoupper(trim($_POST['codiceprodotto']))), rendiSicuro($_POST['nomeprodotto']), rendiSicuro($_POST['descrizione']), rendiSicuro($_POST['prezzo']), rendiSicuro($_POST['numeropezzi']), rendiSicuro($_FILES['immagine']['name']), rendiSicuro(trim($_POST['galleria'])), rendiSicuro($_POST['categoria']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"INSERT INTO tblprodotticonsole(codiceprodotto, console) VALUE ('%s','%s')\", rendiSicuro($_POST['codiceprodotto']), rendiSicuro($_POST['console']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    if(!file_exists($percorsoCartella)){\r\n        mkdir($percorsoCartella);\r\n        print '<p class=\"successo\">'.\"La creazione della cartella &egrave; avvenuta con successo</p>\";\r\n    } else {\r\n        print '<p class=\"informazione\">'.\"La cartella &egrave; gi&agrave; esistente</p>\";\r\n    }\r\n\r\n    print '<p class=\"successo\">'.\"L'inserimento del prodotto &egrave; avvenuto con successo</p>\";\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n}\r\n\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\ninclude '../settings/configurazione.inc';\ninclude HOME_ROOT . '/script/funzioni.php';\n\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\n\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\n    $query = sprintf(\"INSERT INTO tblUtenti(codicefiscale, nome, cognome, datanascita, citta, indirizzo, email, telefono, user, psw, dirittoamministratore) VALUE ('%s','%s','%s','%s','%s','%s','%s','%s','%s','%s','%s')\", rendiSicuro(strtoupper($_POST['codicefiscale'])), rendiSicuro($_POST['nome']), rendiSicuro($_POST['cognome']), rendiSicuro($_POST['datanascita']),rendiSicuro($_POST['citta']), rendiSicuro($_POST['indirizzo']), rendiSicuro($_POST['email']), rendiSicuro($_POST['telefono']), rendiSicuro($_POST['username']), rendiSicuro(sha1($_POST['password'])), rendiSicuro(\"no\"));\n    $dati = eseguiQuery($connessione, $query);\n    chiudiConnessione($connessione);\n\n    print '<p class=\"successo\">' . \"L'inserimento dell'utente &egrave; avvenuto correttamente</p>\";\n\n} else {\n    include HOME_ROOT . '/html/testa.php';\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\n    include HOME_ROOT . '/html/coda.html';\n}\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n    $query = sprintf(\"UPDATE tblcategorie SET nome='%s' WHERE nome='%s'\", rendiSicuro($_POST['nome']), rendiSicuro($_POST['nomeOld']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">La modifica della categoria &egrave; avvenuta correttamente</p>';\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n    if (trim($_POST['produttore']) == '') {\r\n        $query = sprintf(\"UPDATE tblconsole SET nome='%s', produttore=NULL WHERE nome='%s'\", rendiSicuro($_POST['nome']), rendiSicuro($_POST['nomeOld']));\r\n    } else {\r\n        $query = sprintf(\"UPDATE tblconsole SET nome='%s', produttore='%s' WHERE nome='%s'\", rendiSicuro($_POST['nome']), rendiSicuro($_POST['produttore']), rendiSicuro($_POST['nomeOld']));\r\n    }\r\n\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n    print '<p class=\"successo\">La modifica della console &egrave; avvenuta correttamente</p>';\r\n\r\n} else {\r\n    include HOME_ROOT . '/html/testa.php';\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n    include HOME_ROOT . '/html/coda.html';\r\n}\r\n?>", "<?php\r\ninclude '../settings/configurazione.inc';\r\ninclude HOME_ROOT . '/html/testa.php';\r\ninclude HOME_ROOT . '/script/funzioni.php';\r\n\r\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\r\n\r\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\r\n\r\n//Se l'indice \u00e8 -1 indica che viene caricata una singola immagine.\r\n    $indice = -1;\r\n\r\n    if(gestioneImmagine($indice,'')){\r\n        generaThumbnail($_FILES['immagine']['tmp_name'],'/img/thumb',200,268,$indice);\r\n    }\r\n\r\n    $query = sprintf(\"SELECT galleria, immagine FROM tblprodotti WHERE codiceprodotto='%s'\", rendiSicuro($_POST['codiceprodotto']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n// Utilizzato per la rinomina della galleria\r\n    $galleriaOld = $dati[0]['galleria'];\r\n\r\n// Se il nome della galleria viene cambiato\r\n    if (HOME_ROOT . '/' . 'img' . '/' . $dati[0]['galleria'] != HOME_ROOT . '/' . 'img' . '/' . $_POST['galleria']) {\r\n        // Se avviene la rinomina della galleria, viene controllato se esiste e in caso rinominata la relativa cartella contenete le thumbnails\r\n        if (rename(HOME_ROOT . '/' . 'img' . '/' . $dati[0]['galleria'], HOME_ROOT . '/' . 'img' . '/' . $_POST['galleria'])) {\r\n            if(is_dir(HOME_ROOT . '/' . 'img/thumb' . '/' . $dati[0]['galleria'])) {\r\n                rename(HOME_ROOT . '/' . 'img/thumb' . '/' . $dati[0]['galleria'], HOME_ROOT . '/' . 'img/thumb' . '/' . $_POST['galleria']);\r\n                print '<p class=\"successo\">' . \"La cartella della galleria contenente le thumbnail &egrave; stata rinominata con successo</p>\";\r\n            }\r\n            print '<p class=\"successo\">' . \"La cartella della galleria &egrave; stata rinominata con successo</p>\";\r\n        } else {\r\n            print '<p class=\"informazione\">' . \"La cartella della galleria non &egrave; stata rinominata</p>\";\r\n        }\r\n    }\r\n\r\n// Se l'immagine principale viene sostituita, la vecchia immagine e la relativa thumbnail vengono cancellate\r\n    if (HOME_ROOT . '/' . 'img' . '/' . $dati[0]['immagine'] != HOME_ROOT . '/' . 'img' . '/' . $_FILES['immagine']['name']) {\r\n        unlink(HOME_ROOT . '/' . 'img' . '/' . $dati[0]['immagine']);\r\n        unlink(HOME_ROOT . '/' . 'img' . '/thumb/' . $dati[0]['immagine']);\r\n        print '<p class=\"successo\">' . \"L'immagine principale &egrave; stata aggiornata con successo</p>\";\r\n    }\r\n\r\n    $query = sprintf(\"UPDATE tblprodotti SET nomeprodotto='%s', descrizione='%s', prezzo='%d', numeropezzi='%d', immagine='%s',galleria='%s',categoria='%s' WHERE codiceprodotto='%s'\", rendiSicuro($_POST['nomeprodotto']), rendiSicuro($_POST['descrizione']), rendiSicuro($_POST['prezzo']), rendiSicuro($_POST['numeropezzi']), rendiSicuro($_FILES['immagine']['name']), rendiSicuro($_POST['galleria']), rendiSicuro($_POST['categoria']), rendiSicuro($_POST['codiceprodotto']));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    $query = sprintf(\"UPDATE tblprodotti SET galleria='%s' WHERE galleria='%s'\", rendiSicuro($_POST['galleria']), rendiSicuro($galleriaOld));\r\n    $dati = eseguiQuery($connessione, $query);\r\n\r\n    print '<p class=\"successo\">La modifica del prodotto &egrave; avvenuta correttamente</p>';\r\n\r\n    chiudiConnessione($connessione);\r\n\r\n} else {\r\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\r\n}\r\ninclude HOME_ROOT . '/html/coda.html';\r\n?>", "<?php\ninclude '../settings/configurazione.inc';\ninclude HOME_ROOT . '/script/funzioni.php';\n\nif($_SERVER['REQUEST_METHOD'] != 'GET'){\n\n    $connessione = creaConnessione(SERVER, UTENTE, PASSWORD, DATABASE);\n    $query = sprintf(\"UPDATE tblutenti SET codicefiscale='%s', nome='%s', cognome='%s', datanascita='%s',citta='%s', indirizzo='%s', email='%s', telefono='%s', user='%s', psw='%s' WHERE codicefiscale='%s'\", rendiSicuro(strtoupper($_POST['codicefiscale'])), rendiSicuro($_POST['nome']), rendiSicuro($_POST['cognome']), rendiSicuro($_POST['datanascita']),rendiSicuro($_POST['citta']), rendiSicuro($_POST['indirizzo']), rendiSicuro($_POST['email']), rendiSicuro($_POST['telefono']), rendiSicuro($_POST['username']), rendiSicuro(sha1($_POST['password'])),rendiSicuro($_POST['oldcodicefiscale']));\n    $dati = eseguiQuery($connessione, $query);\n\n    chiudiConnessione($connessione);\n\n// Aggiornata la tabella, la sessione verr\u00e0 distrutta e l'utente dovr\u00e0 ricollegarsi al sito\n    session_destroy();\n\n    print '<script type=\"text/javascript\">';\n    print \"$(window.location).attr('href', '../index.php');\";\n    print '</script>';\n\n} else {\n    include HOME_ROOT . '/html/testa.php';\n    print '<p class=\"errore\">Attenzione, non puoi accedere direttamente a questa pagina</p>';\n    include HOME_ROOT . '/html/coda.html';\n}\n?>\n", "<?php\r\n/* CONFIGURAZIONE NON NON NECESSARIA */\r\n\r\n/* HOME_ROOT indica il percorso assoluto della cartella del  file in cui viene inclusa; non necessita di ulteriore configurazione. Questa\r\ncostante \u00e8 necessaria per poter includere file in maniera assoluta da qualsiasi punto del sito*/\r\ndefine('HOME_ROOT',realpath(dirname(__FILE__).'/../'));\r\n// Inizializzazione della sessione\r\nsession_start();\r\n\r\n/* CONFIGURAZIONE OBBLIGATORIA */\r\n\r\n/* HOME_WEB indica il percorso della cartella in cui si trova il file index.php rispetto al filesystem del server.\r\nEsempio: il file index.php si trova nella cartella sito dentro alla cartella public_html\r\nHOME_WEB: /public_html/sito/\r\nLa costante viene utilizzata quando pu\u00f2 essere utilizzato un percorso di tipo relativo*/\r\ndefine('HOME_WEB','/');\r\n// Le costanti SERVER, UTENTE, PASSWORD, DATABASE sono necessarie per eseguire le query alla base di dati desiderata.\r\ndefine('SERVER','localhost');\r\ndefine('UTENTE','root');\r\ndefine('PASSWORD','root');\r\ndefine('DATABASE','ecommerce');\r\n\r\n/* CONFIGURAZIONE FACOLTATIVA */\r\n\r\n// PRODOTTIPERPAGINA indica il numero di prodotti da mostrare in una singola pagina del carrello o del catalogo.\r\ndefine('PRODOTTIPERPAGINA',3);\r\n?>\r\n"], "filenames": ["html/moduloEliminazioneImmagineIntermedio.php", "html/moduloInserimentoImmagineIntermedio.php", "html/moduloModificaCategoriaIntermedio.php", "html/moduloModificaConsoleIntermedio.php", "html/moduloModificaProdottoIntermedio.php", "html/moduloModificaUtente.php", "html/moduloVisualizzazioneCarrello.php", "html/moduloVisualizzazioneCatalogo.php", "html/moduloVisualizzazioneFattura.php", "html/testa.php", "script/funzioni.php", "script/scriptAmministrazione.php", "script/scriptConfermaAcquisto.php", "script/scriptControlloLoginAdmin.php", "script/scriptEliminazioneCarrello.php", "script/scriptEliminazioneCategoria.php", "script/scriptEliminazioneConsole.php", "script/scriptEliminazioneProdotto.php", "script/scriptInserimentoCarrello.php", "script/scriptInserimentoCategoria.php", "script/scriptInserimentoConsole.php", "script/scriptInserimentoImmagine.php", "script/scriptInserimentoProdotto.php", "script/scriptInserimentoUtente.php", "script/scriptModificaCategoria.php", "script/scriptModificaConsole.php", "script/scriptModificaProdotto.php", "script/scriptModificaUtente.php", "settings/configurazione.inc"], "buggy_code_start_loc": [7, 8, 9, 9, 8, 8, 13, 24, 7, 10, 20, 11, 11, 8, 15, 9, 9, 9, 14, 8, 9, 9, 17, 8, 8, 10, 17, 8, 16], "buggy_code_end_loc": [8, 9, 10, 10, 9, 9, 14, 25, 8, 16, 238, 12, 33, 9, 39, 16, 16, 51, 41, 9, 12, 10, 21, 9, 9, 13, 48, 9, 21], "fixing_code_start_loc": [7, 8, 9, 9, 8, 8, 13, 24, 7, 10, 21, 11, 11, 8, 15, 9, 9, 9, 14, 8, 9, 9, 17, 8, 8, 10, 17, 8, 16], "fixing_code_end_loc": [8, 9, 10, 10, 9, 9, 14, 25, 8, 14, 247, 12, 33, 9, 39, 16, 16, 51, 41, 9, 12, 10, 21, 9, 9, 13, 48, 9, 21], "type": "CWE-89", "message": "A vulnerability classified as critical was found in Miccighel PR-CWT. This vulnerability affects unknown code. The manipulation leads to sql injection. The name of the patch is e412127d07004668e5a213932c94807d87067a1f. It is recommended to apply a patch to fix this issue. VDB-217486 is the identifier assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2014-125041", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-05T15:15:10.177", "lastModified": "2023-01-11T20:05:13.710", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability classified as critical was found in Miccighel PR-CWT. This vulnerability affects unknown code. The manipulation leads to sql injection. The name of the patch is e412127d07004668e5a213932c94807d87067a1f. It is recommended to apply a patch to fix this issue. VDB-217486 is the identifier assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L", "attackVector": "ADJACENT_NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 5.5, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.1, "impactScore": 3.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:A/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "ADJACENT_NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 5.2}, "baseSeverity": "MEDIUM", "exploitabilityScore": 5.1, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:progetto-complementi_project:progetto-complementi:*:*:*:*:*:*:*:*", "versionEndExcluding": "2014-06-25", "matchCriteriaId": "338ABA5E-F9F2-4D88-9B66-12DAC0E69613"}]}]}], "references": [{"url": "https://github.com/Miccighel/PR-CWT/commit/e412127d07004668e5a213932c94807d87067a1f", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217486", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.217486", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Miccighel/PR-CWT/commit/e412127d07004668e5a213932c94807d87067a1f"}}