{"buggy_code": ["{% extends \"helpdesk/base.html\" %}\n\n{% load i18n humanize static in_list %}\n\n{% block helpdesk_title %}{% trans \"Tickets\" %}{% endblock %}\n\n{% block helpdesk_head %}\n    <!-- Timeline 3 CSS -->\n    {% if helpdesk_settings.HELPDESK_USE_CDN %}\n    <link title=\"timeline-styles\" rel=\"stylesheet\" href=\"https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css\">\n    {% else %}\n    <link title=\"timeline-styles\" rel=\"stylesheet\" href=\"{% static 'helpdesk/vendor/timeline3/css/timeline.css' %}\">\n    {% endif %}\n{% endblock %}\n\n{% block h1_title %}Tickets\n    {% if from_saved_query %} [{{ saved_query.title }}]{% endif %}\n{% endblock %}\n\n\n{% block helpdesk_breadcrumb %}\n    <li class=\"breadcrumb-item\">\n        <a href=\"{% url 'helpdesk:list' %}\">{% trans \"Tickets\" %}</a>\n    </li>\n    {% if from_saved_query and saved_query.user == user %}\n        <li class=\"breadcrumb-item\">{% trans \"Saved Query\" %}</li>\n        <li class=\"breadcrumb-item active\">{{ saved_query.title }}</li>\n    {% else %}\n        <li class=\"breadcrumb-item active\">{% trans \"Overview\" %}</li>\n    {% endif %}\n{% endblock %}\n\n\n{% block helpdesk_body %}\n    <div class=\"card\">\n        <div class=\"card-header\">\n            <ul class=\"nav nav-tabs\">\n                <li class=\"nav-item\" style=\"width: 200px;\">\n                    {% trans \"Query Results\" %}:\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link active\" href=\"#datatabletabcontents\" id=\"datatabletabcontents-tab\"\n                       data-toggle=\"tab\" role=\"tab\" aria-controls=\"datatabletabcontents\" aria-selected=true>\n                        <i class=\"fas fa-th-list\"></i>\n                        {% trans \"Table\" %}\n                    </a>\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"#timelinetabcontents\" id=\"timelinetabcontents-tab\" data-toggle=\"tab\"\n                       role=\"tab\" aria-controls=\"timelinetabcontents\" aria-selected=false>\n                        <i class=\"fas fa-history\"></i>\n                        {% trans \"Timeline\" %}\n                    </a>\n                </li>\n            </ul>\n        </div>\n        <div class=\"card-body\">\n            {{ search_message|safe }}\n            <div class=\"tab-content\" id=\"myTabContent\">\n                <div class=\"tab-pane fade show active\" id=\"datatabletabcontents\" role=\"tabpanel\"\n                     aria-labelledby=\"datatabletabcontents-tab\">\n                    <form method='post' action='{% url 'helpdesk:mass_update' %}' id=\"ticket_mass_update\">\n                        {% csrf_token %}\n                        <table class=\"table table-sm table-striped table-bordered table-hover\"\n                               id=\"ticketTable\" data-page-length='{{ default_tickets_per_page }}'>\n                            <thead class=\"thead-light\">\n                            <tr>\n                                <th></th>\n                                <th>{% trans \"Ticket\" %}</th>\n                                <th>{% trans \"Priority\" %}</th>\n                                <th>{% trans \"Queue\" %}</th>\n                                <th>{% trans \"Status\" %}</th>\n                                <th>{% trans \"Created\" %}</th>\n                                <th>{% trans \"Due Date\" %}</th>\n                                <th>{% trans \"Owner\" %}</th>\n                                <th>{% trans \"Submitter\" %}</th>\n                                <th>{% trans \"Time Spent\" %}</th>\n                                <th>{% trans \"KB item\" %}</th>\n                            </tr>\n                            </thead>\n                        </table>\n\n                        <p>\n                            <label>{% trans \"Select:\" %}</label>\n\n                            <button id=\"select_all_btn\" type=\"button\" class=\"btn btn-primary btn-sm\">\n                                <i class=\"fas fa-check-circle\"></i> {% trans \"All\" %}\n                            </button>\n\n                            <button id='select_none_btn' type=\"button\" class=\"btn btn-primary btn-sm\">\n                                <i class=\"fas fa-times-circle\"></i> {% trans \"None\" %}\n                            </button>\n\n                            <button id='select_inverse_btn' type=\"button\" class=\"btn btn-primary btn-sm\">\n                                <i class=\"fas fa-expand-arrows-alt\"></i> {% trans \"Invert\" %}\n                            </button>\n                        </p>\n\n                        <p>\n                            <label for='id_mass_action'>{% trans \"With Selected Tickets:\" %}</label>\n                            <select name='action' id='id_mass_action'>\n                                <option value='take'>{% trans \"Take (Assign to me)\" %}</option>\n                                <option value='delete'>{% trans \"Delete\" %}</option>\n                                <option value='merge'>{% trans \"Merge\" %}</option>\n                                <optgroup label='{% trans \"Close\" %}'>\n                                    <option value='close'>{% trans \"Close (Don't Send E-Mail)\" %}</option>\n                                    <option value='close_public'>{% trans \"Close (Send E-Mail)\" %}</option>\n                                </optgroup>\n                                <optgroup label='{% trans \"Assign To\" %}'>\n                                    <option value='unassign'>{% trans \"Nobody (Unassign)\" %}</option>\n                                    {% for u in user_choices %}\n                                        <option value='assign_{{ u.id }}'>{{ u.get_username }}</option>\n                                    {% endfor %}\n                                </optgroup>\n                                <optgroup label='{% trans \"Set KB Item\" %}'>\n                                    <option value='kbitem_none'>{% trans \"No KB Item\" %}</option>\n                                    {% for kbi in kb_items %}\n                                        <option value='kbitem_{{ kbi.id }}'>{{ kbi.category.title }}: {{ kbi.title }}</option>\n                                    {% endfor %}\n                                </optgroup>\n                            </select>\n                            <button type=\"submit\" class=\"btn btn-primary btn-sm\">\n                                <i class=\"fas fa-arrow-circle-right\"></i> {% trans \"Go\" %}\n                            </button>\n                        </p>\n                    </form>\n                </div>\n                <div class=\"tab-pane fade\" id=\"timelinetabcontents\" role=\"tabpanel\" aria-labelledby=\"timelinetabcontents-tab\">\n                    <div id='timeline-embed' style=\"width: 100%; height: 80vh\"></div>\n                </div>\n            </div>\n        </div>\n        <!-- /.panel-body -->\n    </div>\n    <!-- /.panel -->\n\n    <div class=\"card mb-3\">\n        <div class=\"card-header\">\n            <i class=\"fas fa-hand-pointer\"></i>\n            {% trans \"Query Selection\" %}\n        </div>\n        <div class=\"card-body\">\n            <!-- start accordion -->\n            <div class=\"accordion\" id=\"queryAccordion\">\n                <div class=\"card\">\n                    <div class=\"card-header\" id=\"headingOne\">\n                        <h5 class=\"mb-0\">\n                            <button class=\"btn btn-link btn-sm\" type=\"button\" data-toggle=\"collapse\"\n                                    data-target=\"#collapseOne\" aria-expanded=\"true\" aria-controls=\"collapseOne\">\n                                <i class=\"fas fa-filter\"></i>\n                                {% trans \"Filters\" %}\n                            </button>\n                        </h5>\n                    </div>\n\n                    <div id=\"collapseOne\" class=\"collapse show\" aria-labelledby=\"headingOne\"\n                         data-parent=\"#queryAccordion\">\n                        <div class=\"card-body\">\n                            <form method=\"get\">\n                                <div class=\"form-group float-right\">\n                                    <label for=\"filterBuilderSelect\">{% trans \"Add filter\" %}:</label>\n                                    <select class=\"custom-select custom-select-sm mb-0\"\n                                            aria-describedby=\"select-description\" name=\"select\" id=\"filterBuilderSelect\"\n                                            onChange=\"onFilterChange(this.value)\">\n                                        <option value=\"\">--</option>\n                                        <option id=\"filterBuilderSelect-Sort\" value=\"Sort\"{% if query_params.sorting %} disabled{% endif %}>\n                                            {% trans \"Sorting\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Owner\" value=\"Owner\"{% if query_params.filtering.assigned_to__id__in %} disabled{% endif %}>\n                                            {% trans \"Owner\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Queue\" value=\"Queue\"{% if query_params.filtering.queue__id__in %} disabled{% endif %}>\n                                            {% trans \"Queue\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Status\" value=\"Status\"{% if query_params.filtering.status__in %} disabled{% endif %}>\n                                            {% trans \"Status\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Keywords\" value=\"Keywords\"{% if query_params.search_string %} disabled{% endif %}>\n                                            {% trans \"Keywords\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Dates\" value=\"Dates\"{% if query_params.filtering.created__gte or query_params.filtering.created__lte %} disabled{% endif %}>\n                                            {% trans \"Date Range\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-KBItems\" value=\"KBItems\"{% if query_params.filtering.kbitem__in %} disabled{% endif %}>\n                                            {% trans \"Knowledge base items\" %}\n                                        </option>\n                                    </select>\n                                </div>\n                            </form>\n                        </div>\n\n                        <form method=\"get\">\n                            <ul class=\"list-group list-group-flush\">\n                                <li id=\"filterBoxSort\"\n                                    class=\"filterBox{% if query_params.sorting %} filterBoxShow{% endif %} list-group-item\"\n                                    id=\"filterBoxSort\">\n                                    {% include 'helpdesk/filters/sorting.html' %}\n                                </li>\n                                <li class=\"filterBox{% if query_params.filtering.assigned_to__id__in %} filterBoxShow{% endif %} list-group-item\"\n                                    id=filterBoxOwner>\n                                    {% include 'helpdesk/filters/owner.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.filtering.queue__id__in %} filterBoxShow{% endif %}\"\n                                    id=\"filterBoxQueue\">\n                                    {% include 'helpdesk/filters/queue.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.filtering.status__in %} filterBoxShow{% endif %}\"\n                                    id=\"filterBoxStatus\">\n                                    {% include 'helpdesk/filters/status.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.filtering.created__gte or query_params.filtering.created__lte %} filterBoxShow{% endif %}\"\n                                    id='filterBoxDates'>\n                                    {% include 'helpdesk/filters/date.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.search_string %} filterBoxShow{% endif %}\"\n                                    id=\"filterBoxKeywords\">\n                                    {% include 'helpdesk/filters/keywords.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.filtering.kbitem__in %} filterBoxShow{% endif %}\"\n                                    id=\"filterBoxKBItems\">\n                                    {% include 'helpdesk/filters/kbitems.html' %}\n                                </li>\n                                <li class=\"list-group-item\">\n                                    <input class=\"btn btn-primary btn-sm\" type='submit' value='{% trans \"Apply Filters\" %}'/>\n                                </li>\n                                {% if from_saved_query and saved_query.user == user %}\n                                    <li class=\"list-group-item\">\n                                        {% blocktrans with saved_query.title as query_name %}You are currently viewing saved query <strong>\"{{ query_name }}\"</strong>.{% endblocktrans %}\n                                        <a href='{% url 'helpdesk:delete_query' saved_query.id %}'>\n                                            {% trans \"Delete Saved Query\" %}\n                                        </a>\n                                    </li>\n                                {% endif %}\n                                {% if from_saved_query %}\n                                    <li class=\"list-group-item\">\n                                        {% blocktrans with saved_query.id as query_id %}<a href='../reports/?saved_query={{ query_id }}'>Run a report</a> on this query to see stats and charts for the data listed below.{% endblocktrans %}\n                                    </li>\n                                {% endif %}\n                            </ul>\n                        </form>\n                    </div>\n                </div> <!-- end card -->\n\n                <div class=\"card\">\n                    <div class=\"card-header\" id=\"headingTwo\">\n                        <h5 class=\"mb-0\">\n                            <button class=\"btn btn-link collapsed btn-sm\" type=\"button\" data-toggle=\"collapse\"\n                                    data-target=\"#collapseTwo\" aria-expanded=\"false\" aria-controls=\"collapseTwo\">\n                                <i class=\"fas fa-save\"></i>\n                                {% trans \"Save Query\" %}\n                            </button>\n                        </h5>\n                    </div>\n                    <div id=\"collapseTwo\" class=\"collapse\" aria-labelledby=\"headingTwo\" data-parent=\"#queryAccordion\">\n                        <div class=\"card-body\">\n                            <form method='post' action='{% url 'helpdesk:savequery' %}'>\n                                {% csrf_token %}\n                                <input type='hidden' name='query_encoded' value='{{ urlsafe_query }}'/>\n                                <dl>\n                                    <dt><label for='id_title'>{% trans \"Query Name\" %}</label></dt>\n                                    <dd><input type='text' name='title' id='id_title'/></dd>\n                                    <dd class='form_help_text'>{% trans \"This name appears in the drop-down list of saved queries. If you share your query, other users will see this name, so choose something clear and descriptive!\" %}</dd>\n\n                                    <dt><label for='id_shared'>{% trans \"Shared?\" %}</label></dt>\n                                    <dd><input type='checkbox' name='shared'\n                                               id='id_shared'/> {% trans \"Yes, share this query with other users.\" %}\n                                    </dd>\n                                    <dd class='form_help_text'>{% trans \"If you share this query, it will be visible by <em>all</em> other logged-in users.\" %}</dd>\n\n                                </dl>\n                                <div class='buttons'>\n                                    <input class=\"btn btn-primary\" type='submit' value='{% trans \"Save Query\" %}'>\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                </div> <!-- end card -->\n\n                {% if user_saved_queries %}\n                    <div class=\"card\">\n                        <div class=\"card-header\" id=\"headingThree\">\n                            <h5 class=\"mb-0\">\n                                <button class=\"btn btn-link collapsed btn-sm\" type=\"button\" data-toggle=\"collapse\"\n                                        data-target=\"#collapseThree\" aria-expanded=\"false\" aria-controls=\"collapseThree\">\n                                    <i class=\"fas fa-clipboard-check\"></i>\n                                    {% trans \"Use Saved Query\" %}\n                                </button>\n                            </h5>\n                        </div>\n                        <div id=\"collapseThree\" class=\"collapse\" aria-labelledby=\"headingThree\"\n                             data-parent=\"#queryAccordion\">\n                            <div class=\"card-body\">\n                                <form action='{% url 'helpdesk:list' %}'>\n                                    <p>\n                                        <label for='id_query_selector'>{% trans \"Query\" %}</label>\n                                        <select name='saved_query' id='id_query_selector'>\n                                        {% for q in user_saved_queries %}\n                                            <option value='{{ q.id }}'>\n                                                {{ q.title }}{% if q.shared %}\n                                                    (Shared{% if user != q.user %} by {{ q.user.get_username }}{% endif %})\n                                                {% endif %}\n                                            </option>\n                                        {% endfor %}\n                                    </select></p>\n                                    <input class=\"btn btn-primary\" type='submit' value='{% trans \"Run Query\" %}'>\n                                </form>\n                            </div>\n                        </div>\n                    </div> <!-- end card -->\n                {% endif %}\n            </div>\n            <!-- end accordion -->\n        </div>\n        <!-- end card-body -->\n    </div>\n    <!-- end top card -->\n\n{% endblock %}\n\n\n{% block helpdesk_js %}\n    <script src='{% static \"helpdesk/filter.js\" %}'></script>\n    <!-- Timeline 3 JavaScript -->\n    {% if helpdesk_settings.HELPDESK_USE_CDN %}\n    <script src=\"https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js\"></script>\n    {% else %}\n    <script src=\"{% static 'helpdesk/vendor/timeline3/js/timeline.js' %}\"></script>\n    {% endif %}\n    <script>\n        function get_url(row) {\n            return \"{% url 'helpdesk:view' 1234 %}\".replace(/1234/, row.id.toString());\n        }\n\n        $(document).ready(function () {\n            // Ticket DataTable Initialization\n            $('#ticketTable').DataTable({\n                language: {\n                    \"emptyTable\": \"{% trans 'No Tickets Match Your Selection' %}\"\n                },\n                processing: true,\n                serverSide: true,\n                ajax: {\n                    \"url\": \"{% url 'helpdesk:datatables_ticket_list' urlsafe_query %}\",\n                    \"type\": \"GET\",\n                },\n                createdRow: function (row, data, dataIndex) {\n                    $(row).addClass(data.row_class);\n                },\n                dom: 'ltBp',\n                buttons: [\"colvis\"],\n                columns: [\n                    {\n                        data: \"id\",\n                        orderable: false,\n                        render: function (data, type, row, meta) {\n                            const pk = data;\n                            if (type === 'display') {\n                                data = \"<input type='checkbox' name='ticket_id' value='\" + pk + \"' class='ticket_multi_select' />\"\n                            }\n                            return data\n                        }\n                    },\n                    {\n                        data: \"ticket\",\n                        render: function (data, type, row, meta) {\n                            if (type === 'display') {\n                                data = '<div class=\"tickettitle\"><a href=\"' + get_url(row) + '\" >' +\n                                    row.id + '. ' +\n                                    row.title + '</a></div>';\n                            }\n                            return data\n                        }\n                    },\n                    {\n                        data: \"priority\",\n                        render: function (data, type, row, meta) {\n                            let priority = \"success\";\n                            if (data === 4) {\n                                priority = \"warning\";\n                            } else if (data === 5) {\n                                priority = \"danger\";\n                            }\n                            return '<p class=\"text-' + priority + '\">' + data + '</p>';\n                        },\n                        visible: false,\n                    },\n                    {\n                        data: \"queue\",\n                        render: function (data, type, row, meta) {\n                            return data.title;\n                        },\n                        visible: false,\n                    },\n                    {data: \"status\"},\n                    {data: \"created\"},\n                    {data: \"due_date\", \"visible\": false},\n                    {\n                        data: \"assigned_to\",\n                        render: function (data, type, row, meta) {\n                            if (data !== \"None\") {\n                                return data;\n                            }\n                            return \"\";\n                        }\n                    },\n                    {data: \"submitter\"},\n                    {data: \"time_spent\", \"visible\": false},\n                    {data: \"kbitem\"},\n                ]\n            });\n\n            {# Timeline initialization when tab is displayed #}\n            // The TL.Timeline constructor takes at least two arguments:\n            // the id of the Timeline container (no '#'), and\n            // the URL to your JSON data file or Google spreadsheet.\n            // the id must refer to an element \"above\" this code,\n            // and the element must have CSS styling to give it width and height\n            // optionally, a third argument with configuration options can be passed.\n            // See below for more about options.\n            let timeline_loaded = false;\n            $('#timelinetabcontents-tab').on('shown.bs.tab', function (e) {\n                if (!timeline_loaded) {\n                    new TL.Timeline(\n                        'timeline-embed',\n                        '{% url 'helpdesk:timeline_ticket_list' urlsafe_query %}'\n                    );\n                    timeline_loaded = true;\n                }\n            });\n\n            {# Shortcuts to select/unselect multiple tickets #}\n            $(\"#select_all_btn\").click(function () {\n                $(\".ticket_multi_select\").prop('checked', true);\n            });\n            $(\"#select_none_btn\").click(function () {\n                $(\".ticket_multi_select\").prop('checked', false);\n            });\n            $(\"#select_inverse_btn\").click(function () {\n                $(\".ticket_multi_select\").each(function () {\n                    $(this).prop('checked', !$(this).prop('checked'));\n                });\n            });\n        })\n    </script>\n{% endblock %}\n\n"], "fixing_code": ["{% extends \"helpdesk/base.html\" %}\n\n{% load i18n humanize static in_list %}\n\n{% block helpdesk_title %}{% trans \"Tickets\" %}{% endblock %}\n\n{% block helpdesk_head %}\n    <!-- Timeline 3 CSS -->\n    {% if helpdesk_settings.HELPDESK_USE_CDN %}\n    <link title=\"timeline-styles\" rel=\"stylesheet\" href=\"https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css\">\n    {% else %}\n    <link title=\"timeline-styles\" rel=\"stylesheet\" href=\"{% static 'helpdesk/vendor/timeline3/css/timeline.css' %}\">\n    {% endif %}\n{% endblock %}\n\n{% block h1_title %}Tickets\n    {% if from_saved_query %} [{{ saved_query.title }}]{% endif %}\n{% endblock %}\n\n\n{% block helpdesk_breadcrumb %}\n    <li class=\"breadcrumb-item\">\n        <a href=\"{% url 'helpdesk:list' %}\">{% trans \"Tickets\" %}</a>\n    </li>\n    {% if from_saved_query and saved_query.user == user %}\n        <li class=\"breadcrumb-item\">{% trans \"Saved Query\" %}</li>\n        <li class=\"breadcrumb-item active\">{{ saved_query.title }}</li>\n    {% else %}\n        <li class=\"breadcrumb-item active\">{% trans \"Overview\" %}</li>\n    {% endif %}\n{% endblock %}\n\n\n{% block helpdesk_body %}\n    <div class=\"card\">\n        <div class=\"card-header\">\n            <ul class=\"nav nav-tabs\">\n                <li class=\"nav-item\" style=\"width: 200px;\">\n                    {% trans \"Query Results\" %}:\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link active\" href=\"#datatabletabcontents\" id=\"datatabletabcontents-tab\"\n                       data-toggle=\"tab\" role=\"tab\" aria-controls=\"datatabletabcontents\" aria-selected=true>\n                        <i class=\"fas fa-th-list\"></i>\n                        {% trans \"Table\" %}\n                    </a>\n                </li>\n                <li class=\"nav-item\">\n                    <a class=\"nav-link\" href=\"#timelinetabcontents\" id=\"timelinetabcontents-tab\" data-toggle=\"tab\"\n                       role=\"tab\" aria-controls=\"timelinetabcontents\" aria-selected=false>\n                        <i class=\"fas fa-history\"></i>\n                        {% trans \"Timeline\" %}\n                    </a>\n                </li>\n            </ul>\n        </div>\n        <div class=\"card-body\">\n            {{ search_message|safe }}\n            <div class=\"tab-content\" id=\"myTabContent\">\n                <div class=\"tab-pane fade show active\" id=\"datatabletabcontents\" role=\"tabpanel\"\n                     aria-labelledby=\"datatabletabcontents-tab\">\n                    <form method='post' action='{% url 'helpdesk:mass_update' %}' id=\"ticket_mass_update\">\n                        {% csrf_token %}\n                        <table class=\"table table-sm table-striped table-bordered table-hover\"\n                               id=\"ticketTable\" data-page-length='{{ default_tickets_per_page }}'>\n                            <thead class=\"thead-light\">\n                            <tr>\n                                <th></th>\n                                <th>{% trans \"Ticket\" %}</th>\n                                <th>{% trans \"Priority\" %}</th>\n                                <th>{% trans \"Queue\" %}</th>\n                                <th>{% trans \"Status\" %}</th>\n                                <th>{% trans \"Created\" %}</th>\n                                <th>{% trans \"Due Date\" %}</th>\n                                <th>{% trans \"Owner\" %}</th>\n                                <th>{% trans \"Submitter\" %}</th>\n                                <th>{% trans \"Time Spent\" %}</th>\n                                <th>{% trans \"KB item\" %}</th>\n                            </tr>\n                            </thead>\n                        </table>\n\n                        <p>\n                            <label>{% trans \"Select:\" %}</label>\n\n                            <button id=\"select_all_btn\" type=\"button\" class=\"btn btn-primary btn-sm\">\n                                <i class=\"fas fa-check-circle\"></i> {% trans \"All\" %}\n                            </button>\n\n                            <button id='select_none_btn' type=\"button\" class=\"btn btn-primary btn-sm\">\n                                <i class=\"fas fa-times-circle\"></i> {% trans \"None\" %}\n                            </button>\n\n                            <button id='select_inverse_btn' type=\"button\" class=\"btn btn-primary btn-sm\">\n                                <i class=\"fas fa-expand-arrows-alt\"></i> {% trans \"Invert\" %}\n                            </button>\n                        </p>\n\n                        <p>\n                            <label for='id_mass_action'>{% trans \"With Selected Tickets:\" %}</label>\n                            <select name='action' id='id_mass_action'>\n                                <option value='take'>{% trans \"Take (Assign to me)\" %}</option>\n                                <option value='delete'>{% trans \"Delete\" %}</option>\n                                <option value='merge'>{% trans \"Merge\" %}</option>\n                                <optgroup label='{% trans \"Close\" %}'>\n                                    <option value='close'>{% trans \"Close (Don't Send E-Mail)\" %}</option>\n                                    <option value='close_public'>{% trans \"Close (Send E-Mail)\" %}</option>\n                                </optgroup>\n                                <optgroup label='{% trans \"Assign To\" %}'>\n                                    <option value='unassign'>{% trans \"Nobody (Unassign)\" %}</option>\n                                    {% for u in user_choices %}\n                                        <option value='assign_{{ u.id }}'>{{ u.get_username }}</option>\n                                    {% endfor %}\n                                </optgroup>\n                                <optgroup label='{% trans \"Set KB Item\" %}'>\n                                    <option value='kbitem_none'>{% trans \"No KB Item\" %}</option>\n                                    {% for kbi in kb_items %}\n                                        <option value='kbitem_{{ kbi.id }}'>{{ kbi.category.title }}: {{ kbi.title }}</option>\n                                    {% endfor %}\n                                </optgroup>\n                            </select>\n                            <button type=\"submit\" class=\"btn btn-primary btn-sm\">\n                                <i class=\"fas fa-arrow-circle-right\"></i> {% trans \"Go\" %}\n                            </button>\n                        </p>\n                    </form>\n                </div>\n                <div class=\"tab-pane fade\" id=\"timelinetabcontents\" role=\"tabpanel\" aria-labelledby=\"timelinetabcontents-tab\">\n                    <div id='timeline-embed' style=\"width: 100%; height: 80vh\"></div>\n                </div>\n            </div>\n        </div>\n        <!-- /.panel-body -->\n    </div>\n    <!-- /.panel -->\n\n    <div class=\"card mb-3\">\n        <div class=\"card-header\">\n            <i class=\"fas fa-hand-pointer\"></i>\n            {% trans \"Query Selection\" %}\n        </div>\n        <div class=\"card-body\">\n            <!-- start accordion -->\n            <div class=\"accordion\" id=\"queryAccordion\">\n                <div class=\"card\">\n                    <div class=\"card-header\" id=\"headingOne\">\n                        <h5 class=\"mb-0\">\n                            <button class=\"btn btn-link btn-sm\" type=\"button\" data-toggle=\"collapse\"\n                                    data-target=\"#collapseOne\" aria-expanded=\"true\" aria-controls=\"collapseOne\">\n                                <i class=\"fas fa-filter\"></i>\n                                {% trans \"Filters\" %}\n                            </button>\n                        </h5>\n                    </div>\n\n                    <div id=\"collapseOne\" class=\"collapse show\" aria-labelledby=\"headingOne\"\n                         data-parent=\"#queryAccordion\">\n                        <div class=\"card-body\">\n                            <form method=\"get\">\n                                <div class=\"form-group float-right\">\n                                    <label for=\"filterBuilderSelect\">{% trans \"Add filter\" %}:</label>\n                                    <select class=\"custom-select custom-select-sm mb-0\"\n                                            aria-describedby=\"select-description\" name=\"select\" id=\"filterBuilderSelect\"\n                                            onChange=\"onFilterChange(this.value)\">\n                                        <option value=\"\">--</option>\n                                        <option id=\"filterBuilderSelect-Sort\" value=\"Sort\"{% if query_params.sorting %} disabled{% endif %}>\n                                            {% trans \"Sorting\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Owner\" value=\"Owner\"{% if query_params.filtering.assigned_to__id__in %} disabled{% endif %}>\n                                            {% trans \"Owner\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Queue\" value=\"Queue\"{% if query_params.filtering.queue__id__in %} disabled{% endif %}>\n                                            {% trans \"Queue\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Status\" value=\"Status\"{% if query_params.filtering.status__in %} disabled{% endif %}>\n                                            {% trans \"Status\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Keywords\" value=\"Keywords\"{% if query_params.search_string %} disabled{% endif %}>\n                                            {% trans \"Keywords\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-Dates\" value=\"Dates\"{% if query_params.filtering.created__gte or query_params.filtering.created__lte %} disabled{% endif %}>\n                                            {% trans \"Date Range\" %}\n                                        </option>\n                                        <option id=\"filterBuilderSelect-KBItems\" value=\"KBItems\"{% if query_params.filtering.kbitem__in %} disabled{% endif %}>\n                                            {% trans \"Knowledge base items\" %}\n                                        </option>\n                                    </select>\n                                </div>\n                            </form>\n                        </div>\n\n                        <form method=\"get\">\n                            <ul class=\"list-group list-group-flush\">\n                                <li id=\"filterBoxSort\"\n                                    class=\"filterBox{% if query_params.sorting %} filterBoxShow{% endif %} list-group-item\"\n                                    id=\"filterBoxSort\">\n                                    {% include 'helpdesk/filters/sorting.html' %}\n                                </li>\n                                <li class=\"filterBox{% if query_params.filtering.assigned_to__id__in %} filterBoxShow{% endif %} list-group-item\"\n                                    id=filterBoxOwner>\n                                    {% include 'helpdesk/filters/owner.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.filtering.queue__id__in %} filterBoxShow{% endif %}\"\n                                    id=\"filterBoxQueue\">\n                                    {% include 'helpdesk/filters/queue.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.filtering.status__in %} filterBoxShow{% endif %}\"\n                                    id=\"filterBoxStatus\">\n                                    {% include 'helpdesk/filters/status.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.filtering.created__gte or query_params.filtering.created__lte %} filterBoxShow{% endif %}\"\n                                    id='filterBoxDates'>\n                                    {% include 'helpdesk/filters/date.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.search_string %} filterBoxShow{% endif %}\"\n                                    id=\"filterBoxKeywords\">\n                                    {% include 'helpdesk/filters/keywords.html' %}\n                                </li>\n                                <li class=\"list-group-item filterBox{% if query_params.filtering.kbitem__in %} filterBoxShow{% endif %}\"\n                                    id=\"filterBoxKBItems\">\n                                    {% include 'helpdesk/filters/kbitems.html' %}\n                                </li>\n                                <li class=\"list-group-item\">\n                                    <input class=\"btn btn-primary btn-sm\" type='submit' value='{% trans \"Apply Filters\" %}'/>\n                                </li>\n                                {% if from_saved_query and saved_query.user == user %}\n                                    <li class=\"list-group-item\">\n                                        {% blocktrans with saved_query.title as query_name %}You are currently viewing saved query <strong>\"{{ query_name }}\"</strong>.{% endblocktrans %}\n                                        <a href='{% url 'helpdesk:delete_query' saved_query.id %}'>\n                                            {% trans \"Delete Saved Query\" %}\n                                        </a>\n                                    </li>\n                                {% endif %}\n                                {% if from_saved_query %}\n                                    <li class=\"list-group-item\">\n                                        {% blocktrans with saved_query.id as query_id %}<a href='../reports/?saved_query={{ query_id }}'>Run a report</a> on this query to see stats and charts for the data listed below.{% endblocktrans %}\n                                    </li>\n                                {% endif %}\n                            </ul>\n                        </form>\n                    </div>\n                </div> <!-- end card -->\n\n                <div class=\"card\">\n                    <div class=\"card-header\" id=\"headingTwo\">\n                        <h5 class=\"mb-0\">\n                            <button class=\"btn btn-link collapsed btn-sm\" type=\"button\" data-toggle=\"collapse\"\n                                    data-target=\"#collapseTwo\" aria-expanded=\"false\" aria-controls=\"collapseTwo\">\n                                <i class=\"fas fa-save\"></i>\n                                {% trans \"Save Query\" %}\n                            </button>\n                        </h5>\n                    </div>\n                    <div id=\"collapseTwo\" class=\"collapse\" aria-labelledby=\"headingTwo\" data-parent=\"#queryAccordion\">\n                        <div class=\"card-body\">\n                            <form method='post' action='{% url 'helpdesk:savequery' %}'>\n                                {% csrf_token %}\n                                <input type='hidden' name='query_encoded' value='{{ urlsafe_query }}'/>\n                                <dl>\n                                    <dt><label for='id_title'>{% trans \"Query Name\" %}</label></dt>\n                                    <dd><input type='text' name='title' id='id_title'/></dd>\n                                    <dd class='form_help_text'>{% trans \"This name appears in the drop-down list of saved queries. If you share your query, other users will see this name, so choose something clear and descriptive!\" %}</dd>\n\n                                    <dt><label for='id_shared'>{% trans \"Shared?\" %}</label></dt>\n                                    <dd><input type='checkbox' name='shared'\n                                               id='id_shared'/> {% trans \"Yes, share this query with other users.\" %}\n                                    </dd>\n                                    <dd class='form_help_text'>{% trans \"If you share this query, it will be visible by <em>all</em> other logged-in users.\" %}</dd>\n\n                                </dl>\n                                <div class='buttons'>\n                                    <input class=\"btn btn-primary\" type='submit' value='{% trans \"Save Query\" %}'>\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                </div> <!-- end card -->\n\n                {% if user_saved_queries %}\n                    <div class=\"card\">\n                        <div class=\"card-header\" id=\"headingThree\">\n                            <h5 class=\"mb-0\">\n                                <button class=\"btn btn-link collapsed btn-sm\" type=\"button\" data-toggle=\"collapse\"\n                                        data-target=\"#collapseThree\" aria-expanded=\"false\" aria-controls=\"collapseThree\">\n                                    <i class=\"fas fa-clipboard-check\"></i>\n                                    {% trans \"Use Saved Query\" %}\n                                </button>\n                            </h5>\n                        </div>\n                        <div id=\"collapseThree\" class=\"collapse\" aria-labelledby=\"headingThree\"\n                             data-parent=\"#queryAccordion\">\n                            <div class=\"card-body\">\n                                <form action='{% url 'helpdesk:list' %}'>\n                                    <p>\n                                        <label for='id_query_selector'>{% trans \"Query\" %}</label>\n                                        <select name='saved_query' id='id_query_selector'>\n                                        {% for q in user_saved_queries %}\n                                            <option value='{{ q.id }}'>\n                                                {{ q.title }}{% if q.shared %}\n                                                    (Shared{% if user != q.user %} by {{ q.user.get_username }}{% endif %})\n                                                {% endif %}\n                                            </option>\n                                        {% endfor %}\n                                    </select></p>\n                                    <input class=\"btn btn-primary\" type='submit' value='{% trans \"Run Query\" %}'>\n                                </form>\n                            </div>\n                        </div>\n                    </div> <!-- end card -->\n                {% endif %}\n            </div>\n            <!-- end accordion -->\n        </div>\n        <!-- end card-body -->\n    </div>\n    <!-- end top card -->\n\n{% endblock %}\n\n\n{% block helpdesk_js %}\n    <script src='{% static \"helpdesk/filter.js\" %}'></script>\n    <!-- Timeline 3 JavaScript -->\n    {% if helpdesk_settings.HELPDESK_USE_CDN %}\n    <script src=\"https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js\"></script>\n    {% else %}\n    <script src=\"{% static 'helpdesk/vendor/timeline3/js/timeline.js' %}\"></script>\n    {% endif %}\n    <script>\n        function get_url(row) {\n            return \"{% url 'helpdesk:view' 1234 %}\".replace(/1234/, row.id.toString());\n        }\n        \n        function htmlEntities(str) {\n            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n        }\n        \n        $(document).ready(function () {\n            // Ticket DataTable Initialization\n            $('#ticketTable').DataTable({\n                language: {\n                    \"emptyTable\": \"{% trans 'No Tickets Match Your Selection' %}\"\n                },\n                processing: true,\n                serverSide: true,\n                ajax: {\n                    \"url\": \"{% url 'helpdesk:datatables_ticket_list' urlsafe_query %}\",\n                    \"type\": \"GET\",\n                },\n                createdRow: function (row, data, dataIndex) {\n                    $(row).addClass(data.row_class);\n                },\n                dom: 'ltBp',\n                buttons: [\"colvis\"],\n                columns: [\n                    {\n                        data: \"id\",\n                        orderable: false,\n                        render: function (data, type, row, meta) {\n                            const pk = data;\n                            if (type === 'display') {\n                                data = \"<input type='checkbox' name='ticket_id' value='\" + pk + \"' class='ticket_multi_select' />\"\n                            }\n                            return data\n                        }\n                    },\n                    {\n                        data: \"ticket\",\n                        render: function (data, type, row, meta) {\n                            if (type === 'display') {\n                                data = '<div class=\"tickettitle\"><a href=\"' + get_url(row) + '\" >' +\n                                    row.id + '. ' +\n                                    htmlEntities(row.title) + '</a></div>';\n                            }\n                            return data\n                        }\n                    },\n                    {\n                        data: \"priority\",\n                        render: function (data, type, row, meta) {\n                            let priority = \"success\";\n                            if (data === 4) {\n                                priority = \"warning\";\n                            } else if (data === 5) {\n                                priority = \"danger\";\n                            }\n                            return '<p class=\"text-' + priority + '\">' + data + '</p>';\n                        },\n                        visible: false,\n                    },\n                    {\n                        data: \"queue\",\n                        render: function (data, type, row, meta) {\n                            return data.title;\n                        },\n                        visible: false,\n                    },\n                    {data: \"status\"},\n                    {data: \"created\"},\n                    {data: \"due_date\", \"visible\": false},\n                    {\n                        data: \"assigned_to\",\n                        render: function (data, type, row, meta) {\n                            if (data !== \"None\") {\n                                return data;\n                            }\n                            return \"\";\n                        }\n                    },\n                    {data: \"submitter\"},\n                    {data: \"time_spent\", \"visible\": false},\n                    {data: \"kbitem\"},\n                ]\n            });\n\n            {# Timeline initialization when tab is displayed #}\n            // The TL.Timeline constructor takes at least two arguments:\n            // the id of the Timeline container (no '#'), and\n            // the URL to your JSON data file or Google spreadsheet.\n            // the id must refer to an element \"above\" this code,\n            // and the element must have CSS styling to give it width and height\n            // optionally, a third argument with configuration options can be passed.\n            // See below for more about options.\n            let timeline_loaded = false;\n            $('#timelinetabcontents-tab').on('shown.bs.tab', function (e) {\n                if (!timeline_loaded) {\n                    new TL.Timeline(\n                        'timeline-embed',\n                        '{% url 'helpdesk:timeline_ticket_list' urlsafe_query %}'\n                    );\n                    timeline_loaded = true;\n                }\n            });\n\n            {# Shortcuts to select/unselect multiple tickets #}\n            $(\"#select_all_btn\").click(function () {\n                $(\".ticket_multi_select\").prop('checked', true);\n            });\n            $(\"#select_none_btn\").click(function () {\n                $(\".ticket_multi_select\").prop('checked', false);\n            });\n            $(\"#select_inverse_btn\").click(function () {\n                $(\".ticket_multi_select\").each(function () {\n                    $(this).prop('checked', !$(this).prop('checked'));\n                });\n            });\n        })\n    </script>\n{% endblock %}\n\n"], "filenames": ["helpdesk/templates/helpdesk/ticket_list.html"], "buggy_code_start_loc": [333], "buggy_code_end_loc": [370], "fixing_code_start_loc": [333], "fixing_code_end_loc": [374], "type": "CWE-79", "message": "django-helpdesk is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')", "other": {"cve": {"id": "CVE-2021-3945", "sourceIdentifier": "security@huntr.dev", "published": "2021-11-13T09:15:07.137", "lastModified": "2021-11-16T19:51:48.710", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "django-helpdesk is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"}, {"lang": "es", "value": "django-helpdesk es vulnerable a una Neutralizaci\u00f3n Inapropiada de Entradas Durante la Generaci\u00f3n de P\u00e1ginas Web (\"Cross-site Scripting\")"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:django-helpdesk_project:django-helpdesk:*:*:*:*:*:*:*:*", "versionEndIncluding": "0.3.0", "matchCriteriaId": "7FBAEDDA-7495-40C4-A863-7621F9A7DA0B"}]}]}], "references": [{"url": "https://github.com/django-helpdesk/django-helpdesk/commit/2c7065e0c4296e0c692fb4a7ee19c7357583af30", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/745f483c-70ed-441f-ab2e-7ac1305439a4", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/django-helpdesk/django-helpdesk/commit/2c7065e0c4296e0c692fb4a7ee19c7357583af30"}}