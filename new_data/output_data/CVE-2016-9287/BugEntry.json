{"buggy_code": ["<?php\n\n##################################################\n#\n# Copyright (c) 2004-2016 OIC Group, Inc.\n#\n# This file is part of Exponent\n#\n# Exponent is free software; you can redistribute\n# it and/or modify it under the terms of the GNU\n# General Public License as published by the Free\n# Software Foundation; either version 2 of the\n# License, or (at your option) any later version.\n#\n# GPL: http://www.gnu.org/licenses/gpl.txt\n#\n##################################################\n\n/**\n * @subpackage Controllers\n * @package Modules\n */\n\nclass notfoundController extends expController {\n    protected $add_permissions = array(\n        'showall'=>'Showall',\n        'show'=>'Show'\n    );\n\n    static function displayname() { return gt(\"Page Not Found\"); }\n    static function description() { return gt(\"This controller handles routing to the appropriate place when pages are not found.\"); }\n    static function hasSources() { return false; }\n    static function hasViews() { return false; }\n    static function hasContent() { return false; }\n    \n    public function handle() {\n        global $router;\n\n        $args = array_merge(array('controller'=>'notfound', 'action'=>'page_not_found'), $router->url_parts);   \n        header(\"Refresh: 0; url=\".$router->makeLink($args), false, 404);\n    }\n    \n    public function page_not_found() {\n        global $router;\n\n        header(':', true, 404);\n        $params = $router->params;\n        unset(\n            $params['controller'],\n            $params['action']\n        );\n        $terms = empty($params[0]) ? '' : $params[0];\n        if (empty($terms) && !empty($params['title'])) $terms = $params['title'];\n        expCSS::pushToHead(array(\n//\t        \"unique\"=>\"search-results\",\n\t        \"link\"=>$this->asset_path.\"css/results.css\",\n\t        )\n\t    );\n        // If magic quotes is on and the user uses modifiers like \" (quotes) they get escaped. We don't want that in this case.\n        if (get_magic_quotes_gpc()) {\n            $terms = stripslashes($terms);\n        }\n        $terms = htmlspecialchars($terms);\n\n        // check for server requested error documents here instead of treating them as a search request\n        if ($terms == SITE_404_FILE) {\n            self::handle_not_found();\n        } elseif ($terms == SITE_403_FILE) {\n            self::handle_not_authorized();\n        } elseif ($terms == SITE_500_FILE) {\n            self::handle_internal_error();\n        }\n\n        $search = new search();\n\t\t$page = new expPaginator(array(\n\t\t\t'model'=>'search',\n\t\t\t'controller'=>$this->params['controller'],\n\t\t\t'action'=>$this->params['action'],\n\t\t\t'records'=>$search->getSearchResults($terms, false, 0, 30),\n\t\t\t//'sql'=>$sql,\n            'limit'=>10,\n\t\t\t'order'=>'score',\n\t\t\t'dir'=>'DESC',\n            'page'=>(isset($this->params['page']) ? $this->params['page'] : 1),\n        ));\n\n        assign_to_template(array(\n            'page'=>$page,\n            'terms'=>$terms\n        ));\n    }\n\n    public static function handle_not_found() {\n        header(':', true, 404);\n        echo '<h1>', SITE_404_TITLE, '</h1><br />';\n        echo SITE_404_HTML;\n    }\n\n    public static function handle_not_authorized() {\n        header(':', true, 403);\n        echo SITE_403_HTML;\n    }\n\n    public static function handle_internal_error() {\n        header(':', true, 500);\n        echo '<h1>', gt('An Internal Server Error was Encountered!'), '</h1>';\n    }\n\n}\n\n?>"], "fixing_code": ["<?php\n\n##################################################\n#\n# Copyright (c) 2004-2016 OIC Group, Inc.\n#\n# This file is part of Exponent\n#\n# Exponent is free software; you can redistribute\n# it and/or modify it under the terms of the GNU\n# General Public License as published by the Free\n# Software Foundation; either version 2 of the\n# License, or (at your option) any later version.\n#\n# GPL: http://www.gnu.org/licenses/gpl.txt\n#\n##################################################\n\n/**\n * @subpackage Controllers\n * @package Modules\n */\n\nclass notfoundController extends expController {\n    protected $add_permissions = array(\n        'showall'=>'Showall',\n        'show'=>'Show'\n    );\n\n    static function displayname() { return gt(\"Page Not Found\"); }\n    static function description() { return gt(\"This controller handles routing to the appropriate place when pages are not found.\"); }\n    static function hasSources() { return false; }\n    static function hasViews() { return false; }\n    static function hasContent() { return false; }\n\n    public function handle() {\n        global $router;\n\n        $args = array_merge(array('controller'=>'notfound', 'action'=>'page_not_found'), $router->url_parts);\n        header(\"Refresh: 0; url=\".$router->makeLink($args), false, 404);\n    }\n\n    public function page_not_found() {\n        global $router;\n\n        header(':', true, 404);\n        $params = $router->params;\n        unset(\n            $params['controller'],\n            $params['action']\n        );\n        $terms = empty($params[0]) ? '' : $params[0];\n        if (empty($terms) && !empty($params['title'])) $terms = $params['title'];\n        expCSS::pushToHead(array(\n//\t        \"unique\"=>\"search-results\",\n\t        \"link\"=>$this->asset_path.\"css/results.css\",\n\t        )\n\t    );\n        // If magic quotes is on and the user uses modifiers like \" (quotes) they get escaped. We don't want that in this case.\n        if (get_magic_quotes_gpc()) {\n            $terms = stripslashes($terms);\n        }\n        $terms = expString::escape(htmlspecialchars($terms));\n\n        // check for server requested error documents here instead of treating them as a search request\n        if ($terms == SITE_404_FILE) {\n            self::handle_not_found();\n        } elseif ($terms == SITE_403_FILE) {\n            self::handle_not_authorized();\n        } elseif ($terms == SITE_500_FILE) {\n            self::handle_internal_error();\n        }\n\n        $search = new search();\n\t\t$page = new expPaginator(array(\n\t\t\t'model'=>'search',\n\t\t\t'controller'=>$this->params['controller'],\n\t\t\t'action'=>$this->params['action'],\n\t\t\t'records'=>$search->getSearchResults($terms, false, 0, 30),\n\t\t\t//'sql'=>$sql,\n            'limit'=>10,\n\t\t\t'order'=>'score',\n\t\t\t'dir'=>'DESC',\n            'page'=>(isset($this->params['page']) ? $this->params['page'] : 1),\n        ));\n\n        assign_to_template(array(\n            'page'=>$page,\n            'terms'=>$terms\n        ));\n    }\n\n    public static function handle_not_found() {\n        header(':', true, 404);\n        echo '<h1>', SITE_404_TITLE, '</h1><br />';\n        echo SITE_404_HTML;\n    }\n\n    public static function handle_not_authorized() {\n        header(':', true, 403);\n        echo SITE_403_HTML;\n    }\n\n    public static function handle_internal_error() {\n        header(':', true, 500);\n        echo '<h1>', gt('An Internal Server Error was Encountered!'), '</h1>';\n    }\n\n}\n\n?>"], "filenames": ["framework/modules/notfound/controllers/notfoundController.php"], "buggy_code_start_loc": [35], "buggy_code_end_loc": [64], "fixing_code_start_loc": [35], "fixing_code_end_loc": [64], "type": "CWE-89", "message": "In /framework/modules/notfound/controllers/notfoundController.php of Exponent CMS 2.4.0 patch1, untrusted input is passed into getSearchResults. The method getSearchResults is defined in the search model with the parameter '$term' used directly in SQL. Impact is a SQL injection.", "other": {"cve": {"id": "CVE-2016-9287", "sourceIdentifier": "cve@mitre.org", "published": "2016-11-15T11:59:00.203", "lastModified": "2016-11-29T18:02:59.613", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In /framework/modules/notfound/controllers/notfoundController.php of Exponent CMS 2.4.0 patch1, untrusted input is passed into getSearchResults. The method getSearchResults is defined in the search model with the parameter '$term' used directly in SQL. Impact is a SQL injection."}, {"lang": "es", "value": "En /framework/modules/notfound/controllers/notfoundController.php de Exponent CMS 2.4.0 patch1, la entrada no confiable se pasa a getSearchResults. El m\u00e9todo getSearchResults se define en el modelo de b\u00fasqueda con el par\u00e1metro '$ term' utilizado directamente en SQL. Impact es una inyecci\u00f3n de SQL."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": true, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:exponentcms:exponent_cms:2.4.0:p1:*:*:*:*:*:*", "matchCriteriaId": "134DAD01-D588-4554-9079-94C88BB9FC18"}]}]}], "references": [{"url": "http://www.securityfocus.com/bid/94322", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/exponentcms/exponent-cms/commit/4327ea96b3de89440693e06d03038121aa1fdcea", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/exponentcms/exponent-cms/commit/4327ea96b3de89440693e06d03038121aa1fdcea"}}