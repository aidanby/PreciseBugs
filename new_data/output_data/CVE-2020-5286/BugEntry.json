{"buggy_code": ["/**\n * 2007-2019 PrestaShop and Contributors\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://www.prestashop.com for more information.\n *\n * @author    PrestaShop SA <contact@prestashop.com>\n * @copyright 2007-2019 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n * International Registered Trademark & Property of PrestaShop SA\n */\n\nimport FormFieldToggle from \"./FormFieldToggle\";\n\nconst $ = window.$;\n\nexport default class ImportPage {\n  constructor() {\n    new FormFieldToggle();\n\n    $('.js-from-files-history-btn').on('click', () => this.showFilesHistoryHandler());\n    $('.js-close-files-history-block-btn').on('click', () => this.closeFilesHistoryHandler());\n    $('#fileHistoryTable').on('click', '.js-use-file-btn', (event) => this.useFileFromFilesHistory(event));\n    $('.js-change-import-file-btn').on('click', () => this.changeImportFileHandler());\n    $('.js-import-file').on('change', () => this.uploadFile());\n\n    this.toggleSelectedFile();\n    this.handleSubmit();\n  }\n\n  /**\n   * Handle submit and add confirm box in case the toggle button about\n   * deleting all entities before import is checked\n   */\n  handleSubmit() {\n    $('.js-import-form').on('submit', function() {\n      const $this = $(this);\n      if ($this.find('input[name=\"truncate\"]:checked').val() === '1') {\n        return confirm(`${$this.data('delete-confirm-message')} ${$.trim($('#entity > option:selected').text().toLowerCase())}?`);\n      }\n    });\n  }\n\n  /**\n   * Check if selected file names exists and if so, then display it\n   */\n  toggleSelectedFile() {\n    let selectFilename = $('#csv').val();\n    if (selectFilename.length > 0) {\n      this.showImportFileAlert(selectFilename);\n      this.hideFileUploadBlock();\n    }\n  }\n\n  changeImportFileHandler() {\n    this.hideImportFileAlert();\n    this.showFileUploadBlock();\n  }\n\n  /**\n   * Show files history event handler\n   */\n  showFilesHistoryHandler() {\n    this.showFilesHistory();\n    this.hideFileUploadBlock();\n  }\n\n  /**\n   * Close files history event handler\n   */\n  closeFilesHistoryHandler() {\n    this.closeFilesHistory();\n    this.showFileUploadBlock();\n  }\n\n  /**\n   * Show files history block\n   */\n  showFilesHistory() {\n    $('.js-files-history-block').removeClass('d-none');\n  }\n\n  /**\n   * Hide files history block\n   */\n  closeFilesHistory() {\n    $('.js-files-history-block').addClass('d-none');\n  }\n\n  /**\n   *  Prefill hidden file input with selected file name from history\n   */\n  useFileFromFilesHistory(event) {\n    let filename = $(event.target).closest('.btn-group').data('file');\n\n    $('.js-import-file-input').val(filename);\n\n    this.showImportFileAlert(filename);\n    this.closeFilesHistory();\n  }\n\n  /**\n   * Show alert with imported file name\n   */\n  showImportFileAlert(filename) {\n    $('.js-import-file-alert').removeClass('d-none');\n    $('.js-import-file').text(filename);\n  }\n\n  /**\n   * Hides selected import file alert\n   */\n  hideImportFileAlert() {\n    $('.js-import-file-alert').addClass('d-none');\n  }\n\n  /**\n   * Hides import file upload block\n   */\n  hideFileUploadBlock() {\n    $('.js-file-upload-form-group').addClass('d-none');\n  }\n\n  /**\n   * Hides import file upload block\n   */\n  showFileUploadBlock() {\n    $('.js-file-upload-form-group').removeClass('d-none');\n  }\n\n  /**\n   * Make file history button clickable\n   */\n  enableFilesHistoryBtn() {\n    $('.js-from-files-history-btn').removeAttr('disabled');\n  }\n\n  /**\n   * Show error message if file uploading failed\n   *\n   * @param {string} fileName\n   * @param {integer} fileSize\n   * @param {string} message\n   */\n  showImportFileError(fileName, fileSize, message) {\n    const $alert = $('.js-import-file-error');\n\n    const fileData = fileName + ' (' + this.humanizeSize(fileSize) + ')';\n\n    $alert.find('.js-file-data').html(fileData);\n    $alert.find('.js-error-message').html(message);\n    $alert.removeClass('d-none');\n  }\n\n  /**\n   * Hide file uploading error\n   */\n  hideImportFileError() {\n    const $alert = $('.js-import-file-error');\n    $alert.addClass('d-none');\n  }\n\n  /**\n   * Show file size in human readable format\n   *\n   * @param {int} bytes\n   *\n   * @returns {string}\n   */\n  humanizeSize(bytes) {\n    if (typeof bytes !== 'number') {\n      return '';\n    }\n\n    if (bytes >= 1000000000) {\n      return (bytes / 1000000000).toFixed(2) + ' GB';\n    }\n\n    if (bytes >= 1000000) {\n      return (bytes / 1000000).toFixed(2) + ' MB';\n    }\n\n    return (bytes / 1000).toFixed(2) + ' KB';\n  }\n\n  /**\n   * Upload selected import file\n   */\n  uploadFile() {\n    this.hideImportFileError();\n\n    const $input = $('#file');\n    const uploadedFile = $input.prop('files')[0];\n\n    const maxUploadSize = $input.data('max-file-upload-size');\n    if (maxUploadSize < uploadedFile.size) {\n      this.showImportFileError(uploadedFile.name, uploadedFile.size, 'File is too large');\n      return;\n    }\n\n    const data = new FormData();\n    data.append('file', uploadedFile);\n\n    $.ajax({\n      type: 'POST',\n      url: $('.js-import-form').data('file-upload-url'),\n      data: data,\n      cache: false,\n      contentType: false,\n      processData: false,\n    }).then(response => {\n      if (response.error) {\n        this.showImportFileError(uploadedFile.name, uploadedFile.size, response.error);\n        return;\n      }\n\n      let filename = response.file.name;\n\n      $('.js-import-file-input').val(filename);\n\n      this.showImportFileAlert(filename);\n      this.hideFileUploadBlock();\n      this.addFileToHistoryTable(filename);\n      this.enableFilesHistoryBtn();\n    });\n  }\n\n  /**\n   * Renders new row in files history table\n   *\n   * @param {string} filename\n   */\n  addFileToHistoryTable(filename) {\n    const $table = $('#fileHistoryTable');\n\n    let baseDeleteUrl = $table.data('delete-file-url');\n    let deleteUrl = baseDeleteUrl + '&filename=' + encodeURIComponent(filename);\n\n    let baseDownloadUrl = $table.data('download-file-url');\n    let downloadUrl = baseDownloadUrl + '&filename=' + encodeURIComponent(filename);\n\n    let $template = $table.find('tr:first').clone();\n\n    $template.removeClass('d-none');\n    $template.find('td:first').text(filename);\n    $template.find('.btn-group').attr('data-file', filename);\n    $template.find('.js-delete-file-btn').attr('href', deleteUrl);\n    $template.find('.js-download-file-btn').attr('href', downloadUrl);\n\n    $table.find('tbody').append($template);\n\n    let filesNumber = $table.find('tr').length - 1;\n    $('.js-files-history-number').text(filesNumber);\n  }\n}\n", "window.imports=function(e){function t(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,i){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,\"a\",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=\"\",t(t.s=325)}({255:function(e,t,o){\"use strict\";function i(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),l=o(324),r=function(e){return e&&e.__esModule?e:{default:e}}(l),a=window.$,s=function(){function e(){var t=this;i(this,e),new r.default,a(\".js-from-files-history-btn\").on(\"click\",function(){return t.showFilesHistoryHandler()}),a(\".js-close-files-history-block-btn\").on(\"click\",function(){return t.closeFilesHistoryHandler()}),a(\"#fileHistoryTable\").on(\"click\",\".js-use-file-btn\",function(e){return t.useFileFromFilesHistory(e)}),a(\".js-change-import-file-btn\").on(\"click\",function(){return t.changeImportFileHandler()}),a(\".js-import-file\").on(\"change\",function(){return t.uploadFile()}),this.toggleSelectedFile(),this.handleSubmit()}return n(e,[{key:\"handleSubmit\",value:function(){a(\".js-import-form\").on(\"submit\",function(){var e=a(this);if(\"1\"===e.find('input[name=\"truncate\"]:checked').val())return confirm(e.data(\"delete-confirm-message\")+\" \"+a.trim(a(\"#entity > option:selected\").text().toLowerCase())+\"?\")})}},{key:\"toggleSelectedFile\",value:function(){var e=a(\"#csv\").val();e.length>0&&(this.showImportFileAlert(e),this.hideFileUploadBlock())}},{key:\"changeImportFileHandler\",value:function(){this.hideImportFileAlert(),this.showFileUploadBlock()}},{key:\"showFilesHistoryHandler\",value:function(){this.showFilesHistory(),this.hideFileUploadBlock()}},{key:\"closeFilesHistoryHandler\",value:function(){this.closeFilesHistory(),this.showFileUploadBlock()}},{key:\"showFilesHistory\",value:function(){a(\".js-files-history-block\").removeClass(\"d-none\")}},{key:\"closeFilesHistory\",value:function(){a(\".js-files-history-block\").addClass(\"d-none\")}},{key:\"useFileFromFilesHistory\",value:function(e){var t=a(e.target).closest(\".btn-group\").data(\"file\");a(\".js-import-file-input\").val(t),this.showImportFileAlert(t),this.closeFilesHistory()}},{key:\"showImportFileAlert\",value:function(e){a(\".js-import-file-alert\").removeClass(\"d-none\"),a(\".js-import-file\").text(e)}},{key:\"hideImportFileAlert\",value:function(){a(\".js-import-file-alert\").addClass(\"d-none\")}},{key:\"hideFileUploadBlock\",value:function(){a(\".js-file-upload-form-group\").addClass(\"d-none\")}},{key:\"showFileUploadBlock\",value:function(){a(\".js-file-upload-form-group\").removeClass(\"d-none\")}},{key:\"enableFilesHistoryBtn\",value:function(){a(\".js-from-files-history-btn\").removeAttr(\"disabled\")}},{key:\"showImportFileError\",value:function(e,t,o){var i=a(\".js-import-file-error\"),n=e+\" (\"+this.humanizeSize(t)+\")\";i.find(\".js-file-data\").html(n),i.find(\".js-error-message\").html(o),i.removeClass(\"d-none\")}},{key:\"hideImportFileError\",value:function(){a(\".js-import-file-error\").addClass(\"d-none\")}},{key:\"humanizeSize\",value:function(e){return\"number\"!=typeof e?\"\":e>=1e9?(e/1e9).toFixed(2)+\" GB\":e>=1e6?(e/1e6).toFixed(2)+\" MB\":(e/1e3).toFixed(2)+\" KB\"}},{key:\"uploadFile\",value:function(){var e=this;this.hideImportFileError();var t=a(\"#file\"),o=t.prop(\"files\")[0];if(t.data(\"max-file-upload-size\")<o.size)return void this.showImportFileError(o.name,o.size,\"File is too large\");var i=new FormData;i.append(\"file\",o),a.ajax({type:\"POST\",url:a(\".js-import-form\").data(\"file-upload-url\"),data:i,cache:!1,contentType:!1,processData:!1}).then(function(t){if(t.error)return void e.showImportFileError(o.name,o.size,t.error);var i=t.file.name;a(\".js-import-file-input\").val(i),e.showImportFileAlert(i),e.hideFileUploadBlock(),e.addFileToHistoryTable(i),e.enableFilesHistoryBtn()})}},{key:\"addFileToHistoryTable\",value:function(e){var t=a(\"#fileHistoryTable\"),o=t.data(\"delete-file-url\"),i=o+\"&filename=\"+encodeURIComponent(e),n=t.data(\"download-file-url\"),l=n+\"&filename=\"+encodeURIComponent(e),r=t.find(\"tr:first\").clone();r.removeClass(\"d-none\"),r.find(\"td:first\").text(e),r.find(\".btn-group\").attr(\"data-file\",e),r.find(\".js-delete-file-btn\").attr(\"href\",i),r.find(\".js-download-file-btn\").attr(\"href\",l),t.find(\"tbody\").append(r);var s=t.find(\"tr\").length-1;a(\".js-files-history-number\").text(s)}}]),e}();t.default=s},324:function(e,t,o){\"use strict\";function i(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),l=window.$,r=function(){function e(){var t=this;i(this,e),l(\".js-entity-select\").on(\"change\",function(){return t.toggleForm()}),this.toggleForm()}return n(e,[{key:\"toggleForm\",value:function(){var e=l(\"#entity\").find(\"option:selected\"),t=parseInt(e.val()),o=e.text().toLowerCase();this.toggleEntityAlert(t),this.toggleFields(t,o),this.loadAvailableFields(t)}},{key:\"toggleEntityAlert\",value:function(e){var t=l(\".js-entity-alert\");[0,1].includes(e)?t.show():t.hide()}},{key:\"toggleFields\",value:function(e,t){var o=l(\".js-truncate-form-group\"),i=l(\".js-match-ref-form-group\"),n=l(\".js-regenerate-form-group\"),r=l(\".js-force-ids-form-group\"),a=l(\".js-entity-name\");8===e?o.hide():o.show(),[1,2].includes(e)?i.show():i.hide(),[0,1,5,6,8].includes(e)?n.show():n.hide(),[0,1,3,4,5,6,8,7].includes(e)?r.show():r.hide(),a.html(t)}},{key:\"loadAvailableFields\",value:function(e){var t=this,o=l(\".js-available-fields\");l.ajax({url:o.data(\"url\"),data:{entity:e},dataType:\"json\"}).then(function(e){t._removeAvailableFields(o);for(var i=0;i<e.length;i++)t._appendAvailableField(o,e[i].label+(e[i].required?\"*\":\"\"),e[i].description);o.find('[data-toggle=\"popover\"]').popover()})}},{key:\"_removeAvailableFields\",value:function(e){e.find('[data-toggle=\"popover\"]').popover(\"hide\"),e.empty()}},{key:\"_appendHelpBox\",value:function(e,t){var o=l(\".js-available-field-popover-template\").clone();o.attr(\"data-content\",t),o.removeClass(\"js-available-field-popover-template d-none\"),e.append(o)}},{key:\"_appendAvailableField\",value:function(e,t,o){var i=l(\".js-available-field-template\").clone();i.text(t),o&&this._appendHelpBox(i,o),i.removeClass(\"js-available-field-template d-none\"),i.appendTo(e)}}]),e}();t.default=r},325:function(e,t,o){\"use strict\";var i=o(255),n=function(e){return e&&e.__esModule?e:{default:e}}(i);/**\n                   * 2007-2019 PrestaShop and Contributors\n                   *\n                   * NOTICE OF LICENSE\n                   *\n                   * This source file is subject to the Open Software License (OSL 3.0)\n                   * that is bundled with this package in the file LICENSE.txt.\n                   * It is also available through the world-wide-web at this URL:\n                   * https://opensource.org/licenses/OSL-3.0\n                   * If you did not receive a copy of the license and are unable to\n                   * obtain it through the world-wide-web, please send an email\n                   * to license@prestashop.com so we can send you a copy immediately.\n                   *\n                   * DISCLAIMER\n                   *\n                   * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n                   * versions in the future. If you wish to customize PrestaShop for your\n                   * needs please refer to https://www.prestashop.com for more information.\n                   *\n                   * @author    PrestaShop SA <contact@prestashop.com>\n                   * @copyright 2007-2019 PrestaShop SA and Contributors\n                   * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n                   * International Registered Trademark & Property of PrestaShop SA\n                   */\n(0,window.$)(function(){new n.default})}});"], "fixing_code": ["/**\n * 2007-2019 PrestaShop and Contributors\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://www.prestashop.com for more information.\n *\n * @author    PrestaShop SA <contact@prestashop.com>\n * @copyright 2007-2019 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n * International Registered Trademark & Property of PrestaShop SA\n */\n\nimport FormFieldToggle from \"./FormFieldToggle\";\n\nconst $ = window.$;\n\nexport default class ImportPage {\n  constructor() {\n    new FormFieldToggle();\n\n    $('.js-from-files-history-btn').on('click', () => this.showFilesHistoryHandler());\n    $('.js-close-files-history-block-btn').on('click', () => this.closeFilesHistoryHandler());\n    $('#fileHistoryTable').on('click', '.js-use-file-btn', (event) => this.useFileFromFilesHistory(event));\n    $('.js-change-import-file-btn').on('click', () => this.changeImportFileHandler());\n    $('.js-import-file').on('change', () => this.uploadFile());\n\n    this.toggleSelectedFile();\n    this.handleSubmit();\n  }\n\n  /**\n   * Handle submit and add confirm box in case the toggle button about\n   * deleting all entities before import is checked\n   */\n  handleSubmit() {\n    $('.js-import-form').on('submit', function() {\n      const $this = $(this);\n      if ($this.find('input[name=\"truncate\"]:checked').val() === '1') {\n        return confirm(`${$this.data('delete-confirm-message')} ${$.trim($('#entity > option:selected').text().toLowerCase())}?`);\n      }\n    });\n  }\n\n  /**\n   * Check if selected file names exists and if so, then display it\n   */\n  toggleSelectedFile() {\n    let selectFilename = $('#csv').val();\n    if (selectFilename.length > 0) {\n      this.showImportFileAlert(selectFilename);\n      this.hideFileUploadBlock();\n    }\n  }\n\n  changeImportFileHandler() {\n    this.hideImportFileAlert();\n    this.showFileUploadBlock();\n  }\n\n  /**\n   * Show files history event handler\n   */\n  showFilesHistoryHandler() {\n    this.showFilesHistory();\n    this.hideFileUploadBlock();\n  }\n\n  /**\n   * Close files history event handler\n   */\n  closeFilesHistoryHandler() {\n    this.closeFilesHistory();\n    this.showFileUploadBlock();\n  }\n\n  /**\n   * Show files history block\n   */\n  showFilesHistory() {\n    $('.js-files-history-block').removeClass('d-none');\n  }\n\n  /**\n   * Hide files history block\n   */\n  closeFilesHistory() {\n    $('.js-files-history-block').addClass('d-none');\n  }\n\n  /**\n   *  Prefill hidden file input with selected file name from history\n   */\n  useFileFromFilesHistory(event) {\n    let filename = $(event.target).closest('.btn-group').data('file');\n\n    $('.js-import-file-input').val(filename);\n\n    this.showImportFileAlert(filename);\n    this.closeFilesHistory();\n  }\n\n  /**\n   * Show alert with imported file name\n   */\n  showImportFileAlert(filename) {\n    $('.js-import-file-alert').removeClass('d-none');\n    $('.js-import-file').text(filename);\n  }\n\n  /**\n   * Hides selected import file alert\n   */\n  hideImportFileAlert() {\n    $('.js-import-file-alert').addClass('d-none');\n  }\n\n  /**\n   * Hides import file upload block\n   */\n  hideFileUploadBlock() {\n    $('.js-file-upload-form-group').addClass('d-none');\n  }\n\n  /**\n   * Hides import file upload block\n   */\n  showFileUploadBlock() {\n    $('.js-file-upload-form-group').removeClass('d-none');\n  }\n\n  /**\n   * Make file history button clickable\n   */\n  enableFilesHistoryBtn() {\n    $('.js-from-files-history-btn').removeAttr('disabled');\n  }\n\n  /**\n   * Show error message if file uploading failed\n   *\n   * @param {string} fileName\n   * @param {integer} fileSize\n   * @param {string} message\n   */\n  showImportFileError(fileName, fileSize, message) {\n    const $alert = $('.js-import-file-error');\n\n    const fileData = fileName + ' (' + this.humanizeSize(fileSize) + ')';\n\n    $alert.find('.js-file-data').text(fileData);\n    $alert.find('.js-error-message').text(message);\n    $alert.removeClass('d-none');\n  }\n\n  /**\n   * Hide file uploading error\n   */\n  hideImportFileError() {\n    const $alert = $('.js-import-file-error');\n    $alert.addClass('d-none');\n  }\n\n  /**\n   * Show file size in human readable format\n   *\n   * @param {int} bytes\n   *\n   * @returns {string}\n   */\n  humanizeSize(bytes) {\n    if (typeof bytes !== 'number') {\n      return '';\n    }\n\n    if (bytes >= 1000000000) {\n      return (bytes / 1000000000).toFixed(2) + ' GB';\n    }\n\n    if (bytes >= 1000000) {\n      return (bytes / 1000000).toFixed(2) + ' MB';\n    }\n\n    return (bytes / 1000).toFixed(2) + ' KB';\n  }\n\n  /**\n   * Upload selected import file\n   */\n  uploadFile() {\n    this.hideImportFileError();\n\n    const $input = $('#file');\n    const uploadedFile = $input.prop('files')[0];\n\n    const maxUploadSize = $input.data('max-file-upload-size');\n    if (maxUploadSize < uploadedFile.size) {\n      this.showImportFileError(uploadedFile.name, uploadedFile.size, 'File is too large');\n      return;\n    }\n\n    const data = new FormData();\n    data.append('file', uploadedFile);\n\n    $.ajax({\n      type: 'POST',\n      url: $('.js-import-form').data('file-upload-url'),\n      data: data,\n      cache: false,\n      contentType: false,\n      processData: false,\n    }).then(response => {\n      if (response.error) {\n        this.showImportFileError(uploadedFile.name, uploadedFile.size, response.error);\n        return;\n      }\n\n      let filename = response.file.name;\n\n      $('.js-import-file-input').val(filename);\n\n      this.showImportFileAlert(filename);\n      this.hideFileUploadBlock();\n      this.addFileToHistoryTable(filename);\n      this.enableFilesHistoryBtn();\n    });\n  }\n\n  /**\n   * Renders new row in files history table\n   *\n   * @param {string} filename\n   */\n  addFileToHistoryTable(filename) {\n    const $table = $('#fileHistoryTable');\n\n    let baseDeleteUrl = $table.data('delete-file-url');\n    let deleteUrl = baseDeleteUrl + '&filename=' + encodeURIComponent(filename);\n\n    let baseDownloadUrl = $table.data('download-file-url');\n    let downloadUrl = baseDownloadUrl + '&filename=' + encodeURIComponent(filename);\n\n    let $template = $table.find('tr:first').clone();\n\n    $template.removeClass('d-none');\n    $template.find('td:first').text(filename);\n    $template.find('.btn-group').attr('data-file', filename);\n    $template.find('.js-delete-file-btn').attr('href', deleteUrl);\n    $template.find('.js-download-file-btn').attr('href', downloadUrl);\n\n    $table.find('tbody').append($template);\n\n    let filesNumber = $table.find('tr').length - 1;\n    $('.js-files-history-number').text(filesNumber);\n  }\n}\n", "window.imports=function(e){function t(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,i){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,\"a\",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=\"\",t(t.s=325)}({255:function(e,t,o){\"use strict\";function i(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),l=o(324),r=function(e){return e&&e.__esModule?e:{default:e}}(l),a=window.$,s=function(){function e(){var t=this;i(this,e),new r.default,a(\".js-from-files-history-btn\").on(\"click\",function(){return t.showFilesHistoryHandler()}),a(\".js-close-files-history-block-btn\").on(\"click\",function(){return t.closeFilesHistoryHandler()}),a(\"#fileHistoryTable\").on(\"click\",\".js-use-file-btn\",function(e){return t.useFileFromFilesHistory(e)}),a(\".js-change-import-file-btn\").on(\"click\",function(){return t.changeImportFileHandler()}),a(\".js-import-file\").on(\"change\",function(){return t.uploadFile()}),this.toggleSelectedFile(),this.handleSubmit()}return n(e,[{key:\"handleSubmit\",value:function(){a(\".js-import-form\").on(\"submit\",function(){var e=a(this);if(\"1\"===e.find('input[name=\"truncate\"]:checked').val())return confirm(e.data(\"delete-confirm-message\")+\" \"+a.trim(a(\"#entity > option:selected\").text().toLowerCase())+\"?\")})}},{key:\"toggleSelectedFile\",value:function(){var e=a(\"#csv\").val();e.length>0&&(this.showImportFileAlert(e),this.hideFileUploadBlock())}},{key:\"changeImportFileHandler\",value:function(){this.hideImportFileAlert(),this.showFileUploadBlock()}},{key:\"showFilesHistoryHandler\",value:function(){this.showFilesHistory(),this.hideFileUploadBlock()}},{key:\"closeFilesHistoryHandler\",value:function(){this.closeFilesHistory(),this.showFileUploadBlock()}},{key:\"showFilesHistory\",value:function(){a(\".js-files-history-block\").removeClass(\"d-none\")}},{key:\"closeFilesHistory\",value:function(){a(\".js-files-history-block\").addClass(\"d-none\")}},{key:\"useFileFromFilesHistory\",value:function(e){var t=a(e.target).closest(\".btn-group\").data(\"file\");a(\".js-import-file-input\").val(t),this.showImportFileAlert(t),this.closeFilesHistory()}},{key:\"showImportFileAlert\",value:function(e){a(\".js-import-file-alert\").removeClass(\"d-none\"),a(\".js-import-file\").text(e)}},{key:\"hideImportFileAlert\",value:function(){a(\".js-import-file-alert\").addClass(\"d-none\")}},{key:\"hideFileUploadBlock\",value:function(){a(\".js-file-upload-form-group\").addClass(\"d-none\")}},{key:\"showFileUploadBlock\",value:function(){a(\".js-file-upload-form-group\").removeClass(\"d-none\")}},{key:\"enableFilesHistoryBtn\",value:function(){a(\".js-from-files-history-btn\").removeAttr(\"disabled\")}},{key:\"showImportFileError\",value:function(e,t,o){var i=a(\".js-import-file-error\"),n=e+\" (\"+this.humanizeSize(t)+\")\";i.find(\".js-file-data\").text(n),i.find(\".js-error-message\").text(o),i.removeClass(\"d-none\")}},{key:\"hideImportFileError\",value:function(){a(\".js-import-file-error\").addClass(\"d-none\")}},{key:\"humanizeSize\",value:function(e){return\"number\"!=typeof e?\"\":e>=1e9?(e/1e9).toFixed(2)+\" GB\":e>=1e6?(e/1e6).toFixed(2)+\" MB\":(e/1e3).toFixed(2)+\" KB\"}},{key:\"uploadFile\",value:function(){var e=this;this.hideImportFileError();var t=a(\"#file\"),o=t.prop(\"files\")[0];if(t.data(\"max-file-upload-size\")<o.size)return void this.showImportFileError(o.name,o.size,\"File is too large\");var i=new FormData;i.append(\"file\",o),a.ajax({type:\"POST\",url:a(\".js-import-form\").data(\"file-upload-url\"),data:i,cache:!1,contentType:!1,processData:!1}).then(function(t){if(t.error)return void e.showImportFileError(o.name,o.size,t.error);var i=t.file.name;a(\".js-import-file-input\").val(i),e.showImportFileAlert(i),e.hideFileUploadBlock(),e.addFileToHistoryTable(i),e.enableFilesHistoryBtn()})}},{key:\"addFileToHistoryTable\",value:function(e){var t=a(\"#fileHistoryTable\"),o=t.data(\"delete-file-url\"),i=o+\"&filename=\"+encodeURIComponent(e),n=t.data(\"download-file-url\"),l=n+\"&filename=\"+encodeURIComponent(e),r=t.find(\"tr:first\").clone();r.removeClass(\"d-none\"),r.find(\"td:first\").text(e),r.find(\".btn-group\").attr(\"data-file\",e),r.find(\".js-delete-file-btn\").attr(\"href\",i),r.find(\".js-download-file-btn\").attr(\"href\",l),t.find(\"tbody\").append(r);var s=t.find(\"tr\").length-1;a(\".js-files-history-number\").text(s)}}]),e}();t.default=s},324:function(e,t,o){\"use strict\";function i(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}Object.defineProperty(t,\"__esModule\",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),l=window.$,r=function(){function e(){var t=this;i(this,e),l(\".js-entity-select\").on(\"change\",function(){return t.toggleForm()}),this.toggleForm()}return n(e,[{key:\"toggleForm\",value:function(){var e=l(\"#entity\").find(\"option:selected\"),t=parseInt(e.val()),o=e.text().toLowerCase();this.toggleEntityAlert(t),this.toggleFields(t,o),this.loadAvailableFields(t)}},{key:\"toggleEntityAlert\",value:function(e){var t=l(\".js-entity-alert\");[0,1].includes(e)?t.show():t.hide()}},{key:\"toggleFields\",value:function(e,t){var o=l(\".js-truncate-form-group\"),i=l(\".js-match-ref-form-group\"),n=l(\".js-regenerate-form-group\"),r=l(\".js-force-ids-form-group\"),a=l(\".js-entity-name\");8===e?o.hide():o.show(),[1,2].includes(e)?i.show():i.hide(),[0,1,5,6,8].includes(e)?n.show():n.hide(),[0,1,3,4,5,6,8,7].includes(e)?r.show():r.hide(),a.html(t)}},{key:\"loadAvailableFields\",value:function(e){var t=this,o=l(\".js-available-fields\");l.ajax({url:o.data(\"url\"),data:{entity:e},dataType:\"json\"}).then(function(e){t._removeAvailableFields(o);for(var i=0;i<e.length;i++)t._appendAvailableField(o,e[i].label+(e[i].required?\"*\":\"\"),e[i].description);o.find('[data-toggle=\"popover\"]').popover()})}},{key:\"_removeAvailableFields\",value:function(e){e.find('[data-toggle=\"popover\"]').popover(\"hide\"),e.empty()}},{key:\"_appendHelpBox\",value:function(e,t){var o=l(\".js-available-field-popover-template\").clone();o.attr(\"data-content\",t),o.removeClass(\"js-available-field-popover-template d-none\"),e.append(o)}},{key:\"_appendAvailableField\",value:function(e,t,o){var i=l(\".js-available-field-template\").clone();i.text(t),o&&this._appendHelpBox(i,o),i.removeClass(\"js-available-field-template d-none\"),i.appendTo(e)}}]),e}();t.default=r},325:function(e,t,o){\"use strict\";var i=o(255),n=function(e){return e&&e.__esModule?e:{default:e}}(i);/**\n                   * 2007-2019 PrestaShop and Contributors\n                   *\n                   * NOTICE OF LICENSE\n                   *\n                   * This source file is subject to the Open Software License (OSL 3.0)\n                   * that is bundled with this package in the file LICENSE.txt.\n                   * It is also available through the world-wide-web at this URL:\n                   * https://opensource.org/licenses/OSL-3.0\n                   * If you did not receive a copy of the license and are unable to\n                   * obtain it through the world-wide-web, please send an email\n                   * to license@prestashop.com so we can send you a copy immediately.\n                   *\n                   * DISCLAIMER\n                   *\n                   * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n                   * versions in the future. If you wish to customize PrestaShop for your\n                   * needs please refer to https://www.prestashop.com for more information.\n                   *\n                   * @author    PrestaShop SA <contact@prestashop.com>\n                   * @copyright 2007-2019 PrestaShop SA and Contributors\n                   * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n                   * International Registered Trademark & Property of PrestaShop SA\n                   */\n(0,window.$)(function(){new n.default})}});"], "filenames": ["admin-dev/themes/new-theme/js/pages/import/ImportPage.js", "admin-dev/themes/new-theme/public/imports.bundle.js"], "buggy_code_start_loc": [163, 1], "buggy_code_end_loc": [165, 2], "fixing_code_start_loc": [163, 1], "fixing_code_end_loc": [165, 2], "type": "CWE-79", "message": "In PrestaShop between versions 1.7.4.0 and 1.7.6.5, there is a reflected XSS when uploading a wrong file. The problem is fixed in 1.7.6.5", "other": {"cve": {"id": "CVE-2020-5286", "sourceIdentifier": "security-advisories@github.com", "published": "2020-04-20T17:15:16.117", "lastModified": "2020-04-22T15:02:43.027", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In PrestaShop between versions 1.7.4.0 and 1.7.6.5, there is a reflected XSS when uploading a wrong file. The problem is fixed in 1.7.6.5"}, {"lang": "es", "value": "En PrestaShop entre las versiones 1.7.4.0 y 1.7.6.5, hay una vulnerabilidad de tipo XSS reflejado cuando se carga un archivo incorrecto. El problema se corrigi\u00f3 en la versi\u00f3n 1.7.6.5."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 4.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 1.4}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:prestashop:prestashop:*:*:*:*:*:*:*:*", "versionStartExcluding": "1.7.4.0", "versionEndExcluding": "1.7.6.5", "matchCriteriaId": "7AF5F2BD-5E3B-4CD4-9495-14CE33503B5F"}]}]}], "references": [{"url": "https://github.com/PrestaShop/PrestaShop/commit/fc0625fb0a9aab1835515f1bea52e8e063384da7", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-98j8-hvjv-x47j", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/PrestaShop/PrestaShop/commit/fc0625fb0a9aab1835515f1bea52e8e063384da7"}}