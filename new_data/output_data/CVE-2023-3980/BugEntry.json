{"buggy_code": ["<?php\n$translate = $this->plugin('translate');\n$escape = $this->plugin('escapeHtml');\n$thumbnail = $this->plugin('thumbnail');\n?>\n<div class=\"preview-block\">\n\n<?php if ($this->heading): ?>\n<h2><?php echo $this->heading; ?></h2>\n<?php endif; ?>\n\n<ul class=\"resource-list preview\">\n<?php\n$showThumbnail = in_array('thumbnail', $this->components);\n$showHeading = in_array('resource-heading', $this->components);\n$showBody = in_array('resource-body', $this->components);\n$headingTerm = $this->siteSetting('browse_heading_property_term');\n$bodyTerm = $this->siteSetting('browse_body_property_term');\n\n$filterLocale = (bool) $this->siteSetting('filter_locale_values');\n$lang = $this->lang();\n$valueLang = $filterLocale ? [$lang, ''] : null;\n\nforeach ($this->resources as $resource):\n    $heading = $headingTerm ? $resource->value($headingTerm, ['default' => $translate('[Untitled]'), 'lang' => $valueLang]) : $resource->displayTitle(null, $valueLang);\n    $body = $bodyTerm ? $resource->value($bodyTerm, ['lang' => $valueLang]) : $resource->displayDescription(null, $valueLang);\n?>\n    <li class=\"<?php echo $this->resourceType; ?> resource\">\n        <?php\n        $linkContent = '';\n        if ($showThumbnail):\n            $linkContent .= $this->thumbnail($resource, 'medium');\n        endif;\n        if ($showHeading):\n            $linkContent .= '<span class=\"resource-name\">' . $escape($heading) . '</span>';\n        endif;\n        if ($linkContent !== '') {\n            echo $resource->linkRaw($linkContent, null, ['class' => 'resource-link']);\n        }\n        ?>\n        <?php if ($showBody && $body): ?>\n        <div class=\"description\"><?php echo $escape($body); ?></div>\n        <?php endif; ?>\n    </li>\n<?php endforeach; ?>\n</ul>\n\n<?php\nif ($this->linkText):\n    echo $this->hyperlink($this->linkText, $this->url(\n        'site/resource', ['controller' => $this->resourceType, 'action' => 'browse'], ['query' => $this->query], true\n    ));\nendif;\n?>\n\n</div>\n"], "fixing_code": ["<?php\n$translate = $this->plugin('translate');\n$escape = $this->plugin('escapeHtml');\n$thumbnail = $this->plugin('thumbnail');\n?>\n<div class=\"preview-block\">\n\n<?php if ($this->heading): ?>\n<h2><?php echo $escape($this->heading); ?></h2>\n<?php endif; ?>\n\n<ul class=\"resource-list preview\">\n<?php\n$showThumbnail = in_array('thumbnail', $this->components);\n$showHeading = in_array('resource-heading', $this->components);\n$showBody = in_array('resource-body', $this->components);\n$headingTerm = $this->siteSetting('browse_heading_property_term');\n$bodyTerm = $this->siteSetting('browse_body_property_term');\n\n$filterLocale = (bool) $this->siteSetting('filter_locale_values');\n$lang = $this->lang();\n$valueLang = $filterLocale ? [$lang, ''] : null;\n\nforeach ($this->resources as $resource):\n    $heading = $headingTerm ? $resource->value($headingTerm, ['default' => $translate('[Untitled]'), 'lang' => $valueLang]) : $resource->displayTitle(null, $valueLang);\n    $body = $bodyTerm ? $resource->value($bodyTerm, ['lang' => $valueLang]) : $resource->displayDescription(null, $valueLang);\n?>\n    <li class=\"<?php echo $this->resourceType; ?> resource\">\n        <?php\n        $linkContent = '';\n        if ($showThumbnail):\n            $linkContent .= $this->thumbnail($resource, 'medium');\n        endif;\n        if ($showHeading):\n            $linkContent .= '<span class=\"resource-name\">' . $escape($heading) . '</span>';\n        endif;\n        if ($linkContent !== '') {\n            echo $resource->linkRaw($linkContent, null, ['class' => 'resource-link']);\n        }\n        ?>\n        <?php if ($showBody && $body): ?>\n        <div class=\"description\"><?php echo $escape($body); ?></div>\n        <?php endif; ?>\n    </li>\n<?php endforeach; ?>\n</ul>\n\n<?php\nif ($this->linkText):\n    echo $this->hyperlink($this->linkText, $this->url(\n        'site/resource', ['controller' => $this->resourceType, 'action' => 'browse'], ['query' => $this->query], true\n    ));\nendif;\n?>\n\n</div>\n"], "filenames": ["application/view/common/block-layout/browse-preview.phtml"], "buggy_code_start_loc": [9], "buggy_code_end_loc": [10], "fixing_code_start_loc": [9], "fixing_code_end_loc": [10], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository omeka/omeka-s prior to 4.0.2.", "other": {"cve": {"id": "CVE-2023-3980", "sourceIdentifier": "security@huntr.dev", "published": "2023-07-27T19:15:10.427", "lastModified": "2023-08-03T13:41:37.933", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository omeka/omeka-s prior to 4.0.2."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.5}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:omeka:omeka:*:*:*:*:*:*:*:*", "versionEndExcluding": "4.0.2", "matchCriteriaId": "AFD2141E-7543-4384-8AD9-9279732AB5EF"}]}]}], "references": [{"url": "https://github.com/omeka/omeka-s/commit/c6833c0531a07bd914e9f85a61bbbc16e9b4c8df", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/6eb3cb9a-5c78-451f-ae76-0b1e62fe5e54", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/omeka/omeka-s/commit/c6833c0531a07bd914e9f85a61bbbc16e9b4c8df"}}