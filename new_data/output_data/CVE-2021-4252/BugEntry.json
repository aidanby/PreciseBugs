{"buggy_code": ["<?php\n### Check Whether User Can Manage Ban Options\nif(!current_user_can('manage_options')) {\n    die('Access Denied');\n}\n\n### Variables\n$base_name = plugin_basename('wp-ban/ban-options.php');\n$base_page = 'admin.php?page='.$base_name;\n$admin_login = trim($current_user->user_login);\n\n### Form Processing\n// Update Options\nif( ! empty( $_POST['Submit'] ) ) {\n    check_admin_referer('wp-ban_templates');\n    $text = '';\n\n    $banned_options = array();\n    $banned_options['reverse_proxy'] = isset( $_POST['banned_option_reverse_proxy'] ) ? intval( $_POST['banned_option_reverse_proxy'] ) : 0;\n\n    $banned_ips_post            = ! empty( $_POST['banned_ips'] )               ? explode( \"\\n\", trim( $_POST['banned_ips'] ) ) : array();\n    $banned_ips_range_post      = ! empty( $_POST['banned_ips_range'] )         ? explode( \"\\n\", trim( $_POST['banned_ips_range'] ) ) : array();\n    $banned_hosts_post          = ! empty( $_POST['banned_hosts'] )             ? explode( \"\\n\", trim($_POST['banned_hosts'] ) ) : array();\n    $banned_referers_post       = ! empty( $_POST['banned_referers'] )          ? explode( \"\\n\", trim($_POST['banned_referers'] ) ) : array();\n    $banned_user_agents_post    = ! empty( $_POST['banned_user_agents'] )       ? explode( \"\\n\", trim($_POST['banned_user_agents'] ) ) : array();\n    $banned_exclude_ips_post    = ! empty( $_POST['banned_exclude_ips'] )       ? explode( \"\\n\", trim( $_POST['banned_exclude_ips'] ) ) : array();\n    $banned_message             = ! empty( $_POST['banned_template_message'] )  ? trim( $_POST['banned_template_message'] ) : '';\n\n    $banned_ips = array();\n    if(!empty($banned_ips_post)) {\n        foreach($banned_ips_post as $banned_ip) {\n            if($admin_login == 'admin' && ($banned_ip == ban_get_ip() || is_admin_ip($banned_ip))) {\n                $text .= '<p style=\"color: blue;\">'.sprintf(__('This IP \\'%s\\' Belongs To The Admin And Will Not Be Added To Ban List', 'wp-ban'),$banned_ip).'</p>';\n            } else {\n                $banned_ips[] = trim($banned_ip);\n            }\n        }\n    }\n\n    $banned_ips_range = array();\n    if( ! empty( $banned_ips_range_post ) ) {\n        foreach( $banned_ips_range_post as $banned_ip_range ) {\n            $range = explode( '-', $banned_ip_range );\n            if( sizeof( $range ) === 2 ) {\n                $range_start = trim( $range[0] );\n                $range_end = trim( $range[1] );\n                if( $admin_login === 'admin' && ( check_ip_within_range( ban_get_ip(), $range_start, $range_end ) ) ) {\n                    $text .= '<p style=\"color: blue;\">'.sprintf( __( 'The Admin\\'s IP \\'%s\\' Fall Within This Range (%s - %s) And Will Not Be Added To Ban List', 'wp-ban' ), ban_get_ip(), $range_start, $range_end ).'</p>';\n                } else {\n                    $banned_ips_range[] = trim( $banned_ip_range );\n                }\n            }\n        }\n    }\n\n    $banned_hosts = array();\n    if(!empty($banned_hosts_post)) {\n        foreach($banned_hosts_post as $banned_host) {\n            if($admin_login == 'admin' && ($banned_host == @gethostbyaddr(ban_get_ip()) || is_admin_hostname($banned_host))) {\n                $text .= '<p style=\"color: blue;\">'.sprintf(__('This Hostname \\'%s\\' Belongs To The Admin And Will Not Be Added To Ban List', 'wp-ban'), $banned_host).'</p>';\n            } else {\n                $banned_hosts[] = trim($banned_host);\n            }\n        }\n    }\n\n    $banned_referers = array();\n    if(!empty($banned_referers_post)) {\n        foreach($banned_referers_post as $banned_referer) {\n            if(is_admin_referer($banned_referer)) {\n                $text .= '<p style=\"color: blue;\">'.sprintf(__('This Referer \\'%s\\' Belongs To This Site And Will Not Be Added To Ban List', 'wp-ban'), $banned_referer).'</p>';\n            } else {\n                $banned_referers[] = trim($banned_referer);\n            }\n        }\n    }\n\n    $banned_user_agents = array();\n    if(!empty($banned_user_agents_post)) {\n        foreach($banned_user_agents_post as $banned_user_agent) {\n            if(is_admin_user_agent($banned_user_agent)) {\n                $text .= '<p style=\"color: blue;\">'.sprintf(__('This User Agent \\'%s\\' Is Used By The Current Admin And Will Not Be Added To Ban List', 'wp-ban'), $banned_user_agent).'</p>';\n            } else {\n                $banned_user_agents[] = trim($banned_user_agent);\n            }\n        }\n    }\n\n    $banned_exclude_ips = array();\n    if(!empty($banned_exclude_ips_post)) {\n        foreach($banned_exclude_ips_post as $banned_exclude_ip) {\n            $banned_exclude_ips[] = trim($banned_exclude_ip);\n        }\n    }\n    $update_ban_queries = array();\n    $update_ban_queries[] = update_option( 'banned_options', $banned_options );\n    $update_ban_queries[] = update_option('banned_ips', $banned_ips);\n    $update_ban_queries[] = update_option('banned_ips_range', $banned_ips_range);\n    $update_ban_queries[] = update_option('banned_hosts', $banned_hosts);\n    $update_ban_queries[] = update_option('banned_referers', $banned_referers);\n    $update_ban_queries[] = update_option('banned_user_agents', $banned_user_agents);\n    $update_ban_queries[] = update_option('banned_exclude_ips', $banned_exclude_ips);\n    $update_ban_queries[] = update_option('banned_message', $banned_message);\n    $update_ban_text = array();\n    $update_ban_text[] = __( 'Banned Options', 'wp-ban' );\n    $update_ban_text[] = __('Banned IPs', 'wp-ban');\n    $update_ban_text[] = __('Banned IP Range', 'wp-ban');\n    $update_ban_text[] = __('Banned Host Names', 'wp-ban');\n    $update_ban_text[] = __('Banned Referers', 'wp-ban');\n    $update_ban_text[] = __('Banned User Agents', 'wp-ban');\n    $update_ban_text[] = __('Banned Excluded IPs', 'wp-ban');\n    $update_ban_text[] = __('Banned Message', 'wp-ban');\n    $i=0;\n    foreach($update_ban_queries as $update_ban_query) {\n        if($update_ban_query) {\n            $text .= '<p style=\"color: green;\">'.$update_ban_text[$i].' '.__('Updated', 'wp-ban').'</p>';\n        }\n        $i++;\n    }\n    if(empty($text)) {\n        $text = '<p style=\"color: red;\">'.__('No Ban Option Updated', 'wp-ban').'</p>';\n    }\n}\nif( ! empty( $_POST['do'] ) ) {\n    // Decide What To Do\n    switch( $_POST['do'] ) {\n        // Credits To Joe (Ttech) - http://blog.fileville.net/\n        case __('Reset Ban Stats', 'wp-ban'):\n            check_admin_referer('wp-ban_stats');\n            if( ! empty( $_POST['reset_ban_stats'] ) &&$_POST['reset_ban_stats'] === 'yes' ) {\n                $banned_stats = array('users' => array(), 'count' => 0);\n                update_option('banned_stats', $banned_stats);\n                $text = '<p style=\"color: green;\">'.__('All IP Ban Stats And Total Ban Stat Reseted', 'wp-ban').'</p>';\n            } else {\n                $banned_stats = get_option('banned_stats');\n                $delete_ips = (array) $_POST['delete_ips'];\n                foreach($delete_ips as $delete_ip) {\n                    unset($banned_stats['users'][$delete_ip]);\n                }\n                update_option('banned_stats', $banned_stats);\n                $text = '<p style=\"color: green;\">'.__('Selected IP Ban Stats Reseted', 'wp-ban').'</p>';\n            }\n            break;\n    }\n}\n\n$banned_ips = get_option('banned_ips');\n$banned_ips_range = get_option('banned_ips_range');\n$banned_hosts = get_option('banned_hosts');\n$banned_referers = get_option('banned_referers');\n$banned_user_agents = get_option('banned_user_agents');\n$banned_exclude_ips = get_option('banned_exclude_ips');\n$banned_ips_display = '';\n$banned_ips_range_display = '';\n$banned_hosts_display = '';\n$banned_referers_display = '';\n$banned_user_agents_display = '';\n$banned_exclude_ips_display = '';\nif(!empty($banned_ips)) {\n    foreach($banned_ips as $banned_ip) {\n        $banned_ips_display .= $banned_ip.\"\\n\";\n    }\n}\nif(!empty($banned_ips_range)) {\n    foreach($banned_ips_range as $banned_ip_range) {\n        $banned_ips_range_display .= $banned_ip_range.\"\\n\";\n    }\n}\nif(!empty($banned_hosts)) {\n    foreach($banned_hosts as $banned_host) {\n        $banned_hosts_display .= $banned_host.\"\\n\";\n    }\n}\nif(!empty($banned_referers)) {\n    foreach($banned_referers as $banned_referer) {\n        $banned_referers_display .= $banned_referer.\"\\n\";\n    }\n}\nif(!empty($banned_user_agents)) {\n    foreach($banned_user_agents as $banned_user_agent) {\n        $banned_user_agents_display .= $banned_user_agent.\"\\n\";\n    }\n}\nif(!empty($banned_exclude_ips)) {\n    foreach($banned_exclude_ips as $banned_exclude_ip) {\n        $banned_exclude_ips_display .= $banned_exclude_ip.\"\\n\";\n    }\n}\n$banned_ips_display = trim($banned_ips_display);\n$banned_ips_range_display = trim($banned_ips_range_display);\n$banned_hosts_display = trim($banned_hosts_display);\n$banned_referers_display = trim($banned_referers_display);\n$banned_user_agents_display = trim($banned_user_agents_display);\n$banned_exclude_ips_display = trim($banned_exclude_ips_display);\n$banned_stats = get_option( 'banned_stats' );\n$banned_options = get_option( 'banned_options' );\n?>\n<script type=\"text/javascript\">\n/* <![CDATA[*/\n    var checked = 0;\n    function banned_default_templates(template) {\n        var default_template;\n        switch(template) {\n            case \"message\":\n                default_template = \"<!DOCTYPE html>\\n<html>\\n<head>\\n<meta charset=\\\"utf-8\\\">\\n<title>%SITE_NAME% - %SITE_URL%</title>\\n</head>\\n<body>\\n<div id=\\\"wp-ban-container\\\">\\n<p style=\\\"text-align: center; font-weight: bold;\\\"><?php _e('You Are Banned.', 'wp-ban'); ?></p>\\n</div>\\n</body>\\n</html>\";\n                break;\n        }\n        jQuery(\"#banned_template_\" + template).val(default_template);\n    }\n    function toggle_checkbox() {\n        for(i = 0; i < <?php echo sizeof($banned_stats['users']); ?>; i++) {\n            if(checked == 0) {\n                jQuery(\"#ban-\" + i).attr(\"checked\", \"checked\");\n            } else {\n                jQuery(\"#ban-\" + i).removeAttr(\"checked\");\n            }\n        }\n        if(checked == 0) {\n            checked = 1;\n        } else {\n            checked = 0;\n        }\n    }\n    jQuery(document).ready(function() {\n        jQuery('#show_button').click(function(event)\n        {\n            event.preventDefault();\n            var banned_template_message_el = jQuery('#banned_template_message');\n            if(jQuery(banned_template_message_el).is(':hidden'))\n            {\n                jQuery(this).val('<?php _e('Show Current Banned Message', 'wp-ban'); ?>');\n                jQuery('#banned_preview_message').empty();\n                jQuery(banned_template_message_el).fadeIn('fast');\n            }\n            else\n            {\n                jQuery(this).val('<?php _e('Show Banned Message Template', 'wp-ban'); ?>');\n                jQuery.ajax({type: 'GET', url: '<?php echo admin_url('admin-ajax.php'); ?>', data: 'action=ban-admin', cache: false, success: function(data) {\n                    var html_message = data;\n                    jQuery(banned_template_message_el).fadeOut('fast', function() {\n                        jQuery(html_message).filter('#wp-ban-container').appendTo('#banned_preview_message');\n                    });\n                }});\n            }\n        });\n    });\n/* ]]> */\n</script>\n<?php if(!empty($text)) { echo '<!-- Last Action --><div id=\"message\" class=\"updated fade\"><p>'.$text.'</p></div>'; } ?>\n<!-- Ban Options -->\n<form method=\"post\" action=\"<?php echo admin_url('admin.php?page='.plugin_basename(__FILE__)); ?>\">\n<?php wp_nonce_field('wp-ban_templates'); ?>\n<div class=\"wrap\">\n    <h2><?php _e('Ban Options', 'wp-ban'); ?></h2>\n    <table class=\"widefat\">\n        <thead>\n            <tr>\n                <th><?php _e('Your Details', 'wp-ban'); ?></th>\n                <th><?php _e('Value', 'wp-ban'); ?></th>\n            </tr>\n        </thead>\n        <tr>\n            <td><?php _e('IP', 'wp-ban'); ?>:</td>\n            <td><strong><?php echo ban_get_ip(); ?></strong></td>\n        </tr>\n        <tr class=\"alternate\">\n            <td><?php _e('Host Name', 'wp-ban'); ?>:</td>\n            <td><strong><?php echo @gethostbyaddr(ban_get_ip()); ?></strong></td>\n        </tr>\n        <tr>\n            <td><?php _e('User Agent', 'wp-ban'); ?>:</td>\n            <td><strong><?php echo $_SERVER['HTTP_USER_AGENT']; ?></strong></td>\n        </tr>\n        <tr class=\"alternate\">\n            <td><?php _e('Site URL', 'wp-ban'); ?>:</td>\n            <td><strong><?php echo get_option('home'); ?></strong></td>\n        </tr>\n        <tr>\n            <td valign=\"top\" colspan=\"2\" align=\"center\">\n                <?php _e('Please <strong>DO NOT</strong> ban yourself.', 'wp-ban'); ?>\n            </td>\n        </tr>\n    </table>\n    <p>&nbsp;</p>\n    <table class=\"form-table\">\n        <tr>\n            <td width=\"40%\" valign=\"top\">\n                <strong><?php _e('Reverse Proxy Check', 'wp-ban'); ?>:</strong><br />\n                <?php _e( 'This will assume that incoming requests include the user\\'s IP address in the HTTP_X_FORWARDED_FOR (and the request IP will be from your proxy).', 'wp-ban' ); ?>\n            </td>\n            <td width=\"60%\">\n                <label>\n                    <input type=\"checkbox\" name=\"banned_option_reverse_proxy\" value=\"1\"<?php echo ( intval( $banned_options['reverse_proxy'] ) === 1 ) ? ' checked=\"checked\"' : ''; ?> />\n                    <?php _e( 'I am using a reverse proxy.', 'wp-ban' ); ?>\n                </label>\n                <p>\n                    <?php _e( 'If you\\'re not sure, leave this unchecked. Ticking this box when you don\\'t have a reverse proxy will make it easy to bypass the IP ban.', 'wp-ban' ); ?>\n                </p>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned IPs', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Use <strong>*</strong> for wildcards.', 'wp-ban'); ?><br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">192.168.1.100</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">192.168.1.*</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">192.168.*.*</span></p>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_ips\" dir=\"ltr\"><?php echo $banned_ips_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned IP Range', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <span dir=\"ltr\">192.168.1.1-192.168.1.255</span><br /><br />\n                <?php _e('Notes:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('No Wildcards Allowed.', 'wp-ban'); ?><br />\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_ips_range\" dir=\"ltr\"><?php echo $banned_ips_range_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned Host Names', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Use <strong>*</strong> for wildcards', 'wp-ban'); ?>.<br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">*.sg</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">*.cn</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">*.th</span></p>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_hosts\" dir=\"ltr\"><?php echo $banned_hosts_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned Referers', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Use <strong>*</strong> for wildcards', 'wp-ban'); ?>.<br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <span dir=\"ltr\">http://*.blogspot.com</span><br /><br />\n                <?php _e('Notes:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('There are ways to bypass this method of banning.', 'wp-ban'); ?>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_referers\" dir=\"ltr\"><?php echo $banned_referers_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned User Agents', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Use <strong>*</strong> for wildcards', 'wp-ban'); ?>.<br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">EmailSiphon*</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">LMQueueBot*</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">ContactBot*</span></p>\n                <?php _e('Suggestions:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('See <a href=\"http://www.user-agents.org/\">http://www.user-agents.org/</a>', 'wp-ban'); ?>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_user_agents\" dir=\"ltr\"><?php echo $banned_user_agents_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned Exclude IPs', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <span dir=\"ltr\">192.168.1.100</span><br /><br />\n                <?php _e('Notes:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('No Wildcards Allowed.', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('These Users Will Not Get Banned.', 'wp-ban'); ?>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_exclude_ips\" dir=\"ltr\"><?php echo $banned_exclude_ips_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned Message', 'wp-ban'); ?>:</strong><br /><br /><br />\n                    <?php _e('Allowed Variables:', 'wp-ban'); ?>\n                    <p style=\"margin: 2px 0\">- %SITE_NAME%</p>\n                    <p style=\"margin: 2px 0\">- %SITE_URL%</p>\n                    <p style=\"margin: 2px 0\">- %USER_ATTEMPTS_COUNT%</p>\n                    <p style=\"margin: 2px 0\">- %USER_IP%</p>\n                    <p style=\"margin: 2px 0\">- %USER_HOSTNAME%</p>\n                    <p style=\"margin: 2px 0\">- %TOTAL_ATTEMPTS_COUNT%</p><br />\n                    <p><?php printf(__('Note: Your message must be within %s', 'wp-ban'), htmlspecialchars('<div id=\"wp-ban-container\"></div>')); ?></p><br />\n                    <input type=\"button\" name=\"RestoreDefault\" value=\"<?php _e('Restore Default Template', 'wp-ban'); ?>\" onclick=\"banned_default_templates('message');\" class=\"button\" /><br /><br />\n                    <input type=\"button\" id=\"show_button\" value=\"<?php _e('Show Current Banned Message', 'wp-ban'); ?>\" class=\"button\" /><br />\n            </td>\n            <td>\n                <textarea cols=\"100\" style=\"width: 100%;\" rows=\"20\" id=\"banned_template_message\" name=\"banned_template_message\"><?php echo stripslashes(get_option('banned_message')); ?></textarea>\n                <div id=\"banned_preview_message\"></div>\n            </td>\n        </tr>\n    </table>\n    <p style=\"text-align: center;\">\n        <input type=\"submit\" name=\"Submit\" class=\"button\" value=\"<?php _e('Save Changes', 'wp-ban'); ?>\" />\n    </p>\n</div>\n</form>\n<p>&nbsp;</p>\n\n<form method=\"post\" action=\"<?php echo admin_url('admin.php?page='.plugin_basename(__FILE__)); ?>\">\n<?php wp_nonce_field('wp-ban_stats'); ?>\n<div class=\"wrap\">\n    <h3><?php _e('Ban Stats', 'wp-ban'); ?></h3>\n    <br style=\"clear\" />\n    <table class=\"widefat\">\n        <thead>\n            <tr>\n                <th width=\"40%\" style=\"text-align: center;\"><?php _e('IPs', 'wp-ban'); ?></th>\n                <th width=\"30%\" style=\"text-align: center;\"><?php _e('Attempts', 'wp-ban'); ?></th>\n                <th width=\"30%\"><input type=\"checkbox\" id=\"toogle_checkbox\" name=\"toogle_checkbox\" value=\"1\" onclick=\"toggle_checkbox();\" />&nbsp;<label for=\"toogle_checkbox\"><?php _e('Action', 'wp-ban'); ?></label></th>\n            </tr>\n        </thead>\n            <?php\n                // Credits To Joe (Ttech) - http://blog.fileville.net/\n                if(!empty($banned_stats['users'])) {\n                    $i = 0;\n                    ksort($banned_stats['users']);\n                    foreach($banned_stats['users'] as $key => $value) {\n                        if($i%2 == 0) {\n                            $style = '';\n                        }  else {\n                            $style = ' class=\"alternate\"';\n                        }\n                        echo \"<tr$style>\\n\";\n                        echo \"<td style=\\\"text-align: center;\\\">$key</td>\\n\";\n                        echo \"<td style=\\\"text-align: center;\\\">\".number_format_i18n(intval($value)).\"</td>\\n\";\n                        echo \"<td><input type=\\\"checkbox\\\" id=\\\"ban-$i\\\" name=\\\"delete_ips[]\\\" value=\\\"$key\\\" />&nbsp;<label for=\\\"ban-$i\\\">\".__('Reset this IP ban stat?', 'wp-ban').\"</label></td>\\n\";\n                        echo '</tr>'.\"\\n\";\n                        $i++;\n                    }\n                } else {\n                    echo \"<tr>\\n\";\n                    echo '<td colspan=\"3\" align=\"center\">'.__('No Attempts', 'wp-ban').'</td>'.\"\\n\";\n                    echo '</tr>'.\"\\n\";\n                }\n            ?>\n        <tr class=\"thead\">\n            <td style=\"text-align: center;\"><strong><?php _e('Total  Attempts:', 'wp-ban'); ?></strong></td>\n            <td style=\"text-align: center;\"><strong><?php echo number_format_i18n(intval($banned_stats['count'])); ?></strong></td>\n            <td><input type=\"checkbox\" id=\"reset_ban_stats\" name=\"reset_ban_stats\" value=\"yes\" />&nbsp;<label for=\"reset_ban_stats\"><?php _e('Reset all IP ban stats and total ban stat?', 'wp-ban'); ?></label></td>\n        </tr>\n    </table>\n    <p style=\"text-align: center;\"><input type=\"submit\" name=\"do\" value=\"<?php _e('Reset Ban Stats', 'wp-ban'); ?>\" class=\"button\" onclick=\"return confirm('<?php _e('You Are About To Reset Ban Stats.', 'wp-ban'); ?>\\n\\n<?php _e('This Action Is Not Reversible. Are you sure?', 'wp-ban'); ?>')\" /></p>\n</div>\n</form>\n<p>&nbsp;</p>\n"], "fixing_code": ["<?php\n### Check Whether User Can Manage Ban Options\nif(!current_user_can('manage_options')) {\n    die('Access Denied');\n}\n\n### Variables\n$base_name = plugin_basename('wp-ban/ban-options.php');\n$base_page = 'admin.php?page='.$base_name;\n$admin_login = trim($current_user->user_login);\n\n### Form Processing\n// Update Options\nif( ! empty( $_POST['Submit'] ) ) {\n    check_admin_referer('wp-ban_templates');\n    $text = '';\n\n    $banned_options = array();\n    $banned_options['reverse_proxy'] = isset( $_POST['banned_option_reverse_proxy'] ) ? intval( $_POST['banned_option_reverse_proxy'] ) : 0;\n\n    $banned_ips_post            = ! empty( $_POST['banned_ips'] )               ? explode( \"\\n\", trim( $_POST['banned_ips'] ) ) : array();\n    $banned_ips_range_post      = ! empty( $_POST['banned_ips_range'] )         ? explode( \"\\n\", trim( $_POST['banned_ips_range'] ) ) : array();\n    $banned_hosts_post          = ! empty( $_POST['banned_hosts'] )             ? explode( \"\\n\", trim($_POST['banned_hosts'] ) ) : array();\n    $banned_referers_post       = ! empty( $_POST['banned_referers'] )          ? explode( \"\\n\", trim($_POST['banned_referers'] ) ) : array();\n    $banned_user_agents_post    = ! empty( $_POST['banned_user_agents'] )       ? explode( \"\\n\", trim($_POST['banned_user_agents'] ) ) : array();\n    $banned_exclude_ips_post    = ! empty( $_POST['banned_exclude_ips'] )       ? explode( \"\\n\", trim( $_POST['banned_exclude_ips'] ) ) : array();\n    $banned_message             = ! empty( $_POST['banned_template_message'] )  ? trim( $_POST['banned_template_message'] ) : '';\n\n    $banned_ips = array();\n    if(!empty($banned_ips_post)) {\n        foreach($banned_ips_post as $banned_ip) {\n            if($admin_login == 'admin' && ($banned_ip == ban_get_ip() || is_admin_ip($banned_ip))) {\n                $text .= '<p style=\"color: blue;\">'.sprintf(__('This IP \\'%s\\' Belongs To The Admin And Will Not Be Added To Ban List', 'wp-ban'),$banned_ip).'</p>';\n            } else {\n                $banned_ips[] = trim($banned_ip);\n            }\n        }\n    }\n\n    $banned_ips_range = array();\n    if( ! empty( $banned_ips_range_post ) ) {\n        foreach( $banned_ips_range_post as $banned_ip_range ) {\n            $range = explode( '-', $banned_ip_range );\n            if( sizeof( $range ) === 2 ) {\n                $range_start = trim( $range[0] );\n                $range_end = trim( $range[1] );\n                if( $admin_login === 'admin' && ( check_ip_within_range( ban_get_ip(), $range_start, $range_end ) ) ) {\n                    $text .= '<p style=\"color: blue;\">'.sprintf( __( 'The Admin\\'s IP \\'%s\\' Fall Within This Range (%s - %s) And Will Not Be Added To Ban List', 'wp-ban' ), ban_get_ip(), $range_start, $range_end ).'</p>';\n                } else {\n                    $banned_ips_range[] = trim( $banned_ip_range );\n                }\n            }\n        }\n    }\n\n    $banned_hosts = array();\n    if(!empty($banned_hosts_post)) {\n        foreach($banned_hosts_post as $banned_host) {\n            if($admin_login == 'admin' && ($banned_host == @gethostbyaddr(ban_get_ip()) || is_admin_hostname($banned_host))) {\n                $text .= '<p style=\"color: blue;\">'.sprintf(__('This Hostname \\'%s\\' Belongs To The Admin And Will Not Be Added To Ban List', 'wp-ban'), $banned_host).'</p>';\n            } else {\n                $banned_hosts[] = trim($banned_host);\n            }\n        }\n    }\n\n    $banned_referers = array();\n    if(!empty($banned_referers_post)) {\n        foreach($banned_referers_post as $banned_referer) {\n            if(is_admin_referer($banned_referer)) {\n                $text .= '<p style=\"color: blue;\">'.sprintf(__('This Referer \\'%s\\' Belongs To This Site And Will Not Be Added To Ban List', 'wp-ban'), $banned_referer).'</p>';\n            } else {\n                $banned_referers[] = trim($banned_referer);\n            }\n        }\n    }\n\n    $banned_user_agents = array();\n    if(!empty($banned_user_agents_post)) {\n        foreach($banned_user_agents_post as $banned_user_agent) {\n            if(is_admin_user_agent($banned_user_agent)) {\n                $text .= '<p style=\"color: blue;\">'.sprintf(__('This User Agent \\'%s\\' Is Used By The Current Admin And Will Not Be Added To Ban List', 'wp-ban'), $banned_user_agent).'</p>';\n            } else {\n                $banned_user_agents[] = trim($banned_user_agent);\n            }\n        }\n    }\n\n    $banned_exclude_ips = array();\n    if(!empty($banned_exclude_ips_post)) {\n        foreach($banned_exclude_ips_post as $banned_exclude_ip) {\n            $banned_exclude_ips[] = trim($banned_exclude_ip);\n        }\n    }\n    $update_ban_queries = array();\n    $update_ban_queries[] = update_option( 'banned_options', $banned_options );\n    $update_ban_queries[] = update_option('banned_ips', $banned_ips);\n    $update_ban_queries[] = update_option('banned_ips_range', $banned_ips_range);\n    $update_ban_queries[] = update_option('banned_hosts', $banned_hosts);\n    $update_ban_queries[] = update_option('banned_referers', $banned_referers);\n    $update_ban_queries[] = update_option('banned_user_agents', $banned_user_agents);\n    $update_ban_queries[] = update_option('banned_exclude_ips', $banned_exclude_ips);\n    $update_ban_queries[] = update_option('banned_message', $banned_message);\n    $update_ban_text = array();\n    $update_ban_text[] = __( 'Banned Options', 'wp-ban' );\n    $update_ban_text[] = __('Banned IPs', 'wp-ban');\n    $update_ban_text[] = __('Banned IP Range', 'wp-ban');\n    $update_ban_text[] = __('Banned Host Names', 'wp-ban');\n    $update_ban_text[] = __('Banned Referers', 'wp-ban');\n    $update_ban_text[] = __('Banned User Agents', 'wp-ban');\n    $update_ban_text[] = __('Banned Excluded IPs', 'wp-ban');\n    $update_ban_text[] = __('Banned Message', 'wp-ban');\n    $i=0;\n    foreach($update_ban_queries as $update_ban_query) {\n        if($update_ban_query) {\n            $text .= '<p style=\"color: green;\">'.$update_ban_text[$i].' '.__('Updated', 'wp-ban').'</p>';\n        }\n        $i++;\n    }\n    if(empty($text)) {\n        $text = '<p style=\"color: red;\">'.__('No Ban Option Updated', 'wp-ban').'</p>';\n    }\n}\nif( ! empty( $_POST['do'] ) ) {\n    // Decide What To Do\n    switch( $_POST['do'] ) {\n        // Credits To Joe (Ttech) - http://blog.fileville.net/\n        case __('Reset Ban Stats', 'wp-ban'):\n            check_admin_referer('wp-ban_stats');\n            if( ! empty( $_POST['reset_ban_stats'] ) &&$_POST['reset_ban_stats'] === 'yes' ) {\n                $banned_stats = array('users' => array(), 'count' => 0);\n                update_option('banned_stats', $banned_stats);\n                $text = '<p style=\"color: green;\">'.__('All IP Ban Stats And Total Ban Stat Reseted', 'wp-ban').'</p>';\n            } else {\n                $banned_stats = get_option('banned_stats');\n                $delete_ips = (array) $_POST['delete_ips'];\n                foreach($delete_ips as $delete_ip) {\n                    unset($banned_stats['users'][$delete_ip]);\n                }\n                update_option('banned_stats', $banned_stats);\n                $text = '<p style=\"color: green;\">'.__('Selected IP Ban Stats Reseted', 'wp-ban').'</p>';\n            }\n            break;\n    }\n}\n\n$banned_ips = get_option('banned_ips');\n$banned_ips_range = get_option('banned_ips_range');\n$banned_hosts = get_option('banned_hosts');\n$banned_referers = get_option('banned_referers');\n$banned_user_agents = get_option('banned_user_agents');\n$banned_exclude_ips = get_option('banned_exclude_ips');\n$banned_ips_display = '';\n$banned_ips_range_display = '';\n$banned_hosts_display = '';\n$banned_referers_display = '';\n$banned_user_agents_display = '';\n$banned_exclude_ips_display = '';\nif(!empty($banned_ips)) {\n    foreach($banned_ips as $banned_ip) {\n        $banned_ips_display .= $banned_ip.\"\\n\";\n    }\n}\nif(!empty($banned_ips_range)) {\n    foreach($banned_ips_range as $banned_ip_range) {\n        $banned_ips_range_display .= $banned_ip_range.\"\\n\";\n    }\n}\nif(!empty($banned_hosts)) {\n    foreach($banned_hosts as $banned_host) {\n        $banned_hosts_display .= $banned_host.\"\\n\";\n    }\n}\nif(!empty($banned_referers)) {\n    foreach($banned_referers as $banned_referer) {\n        $banned_referers_display .= $banned_referer.\"\\n\";\n    }\n}\nif(!empty($banned_user_agents)) {\n    foreach($banned_user_agents as $banned_user_agent) {\n        $banned_user_agents_display .= $banned_user_agent.\"\\n\";\n    }\n}\nif(!empty($banned_exclude_ips)) {\n    foreach($banned_exclude_ips as $banned_exclude_ip) {\n        $banned_exclude_ips_display .= $banned_exclude_ip.\"\\n\";\n    }\n}\n$banned_ips_display = trim($banned_ips_display);\n$banned_ips_range_display = trim($banned_ips_range_display);\n$banned_hosts_display = trim($banned_hosts_display);\n$banned_referers_display = trim($banned_referers_display);\n$banned_user_agents_display = trim($banned_user_agents_display);\n$banned_exclude_ips_display = trim($banned_exclude_ips_display);\n$banned_stats = get_option( 'banned_stats' );\n$banned_options = get_option( 'banned_options' );\n?>\n<script type=\"text/javascript\">\n/* <![CDATA[*/\n    var checked = 0;\n    function banned_default_templates(template) {\n        var default_template;\n        switch(template) {\n            case \"message\":\n                default_template = \"<!DOCTYPE html>\\n<html>\\n<head>\\n<meta charset=\\\"utf-8\\\">\\n<title>%SITE_NAME% - %SITE_URL%</title>\\n</head>\\n<body>\\n<div id=\\\"wp-ban-container\\\">\\n<p style=\\\"text-align: center; font-weight: bold;\\\"><?php _e('You Are Banned.', 'wp-ban'); ?></p>\\n</div>\\n</body>\\n</html>\";\n                break;\n        }\n        jQuery(\"#banned_template_\" + template).val(default_template);\n    }\n    function toggle_checkbox() {\n        for(i = 0; i < <?php echo sizeof($banned_stats['users']); ?>; i++) {\n            if(checked == 0) {\n                jQuery(\"#ban-\" + i).attr(\"checked\", \"checked\");\n            } else {\n                jQuery(\"#ban-\" + i).removeAttr(\"checked\");\n            }\n        }\n        if(checked == 0) {\n            checked = 1;\n        } else {\n            checked = 0;\n        }\n    }\n    jQuery(document).ready(function() {\n        jQuery('#show_button').click(function(event)\n        {\n            event.preventDefault();\n            var banned_template_message_el = jQuery('#banned_template_message');\n            if(jQuery(banned_template_message_el).is(':hidden'))\n            {\n                jQuery(this).val('<?php _e('Show Current Banned Message', 'wp-ban'); ?>');\n                jQuery('#banned_preview_message').empty();\n                jQuery(banned_template_message_el).fadeIn('fast');\n            }\n            else\n            {\n                jQuery(this).val('<?php _e('Show Banned Message Template', 'wp-ban'); ?>');\n                jQuery.ajax({type: 'GET', url: '<?php echo admin_url('admin-ajax.php'); ?>', data: 'action=ban-admin', cache: false, success: function(data) {\n                    var html_message = data;\n                    jQuery(banned_template_message_el).fadeOut('fast', function() {\n                        jQuery(html_message).filter('#wp-ban-container').appendTo('#banned_preview_message');\n                    });\n                }});\n            }\n        });\n    });\n/* ]]> */\n</script>\n<?php if(!empty($text)) { echo '<!-- Last Action --><div id=\"message\" class=\"updated fade\"><p>'.$text.'</p></div>'; } ?>\n<!-- Ban Options -->\n<form method=\"post\" action=\"<?php echo admin_url('admin.php?page='.plugin_basename(__FILE__)); ?>\">\n<?php wp_nonce_field('wp-ban_templates'); ?>\n<div class=\"wrap\">\n    <h2><?php _e('Ban Options', 'wp-ban'); ?></h2>\n    <table class=\"widefat\">\n        <thead>\n            <tr>\n                <th><?php _e('Your Details', 'wp-ban'); ?></th>\n                <th><?php _e('Value', 'wp-ban'); ?></th>\n            </tr>\n        </thead>\n        <tr>\n            <td><?php _e('IP', 'wp-ban'); ?>:</td>\n            <td><strong><?php echo ban_get_ip(); ?></strong></td>\n        </tr>\n        <tr class=\"alternate\">\n            <td><?php _e('Host Name', 'wp-ban'); ?>:</td>\n            <td><strong><?php echo @gethostbyaddr(ban_get_ip()); ?></strong></td>\n        </tr>\n        <tr>\n            <td><?php _e('User Agent', 'wp-ban'); ?>:</td>\n            <td><strong><?php echo (!isset($_SERVER[\"HTTP_USER_AGENT\"]) ? __('Unknown', 'wp-ban') : esc_html($_SERVER['HTTP_USER_AGENT'])); ?></strong></td>\n        </tr>\n        <tr class=\"alternate\">\n            <td><?php _e('Site URL', 'wp-ban'); ?>:</td>\n            <td><strong><?php echo get_option('home'); ?></strong></td>\n        </tr>\n        <tr>\n            <td valign=\"top\" colspan=\"2\" align=\"center\">\n                <?php _e('Please <strong>DO NOT</strong> ban yourself.', 'wp-ban'); ?>\n            </td>\n        </tr>\n    </table>\n    <p>&nbsp;</p>\n    <table class=\"form-table\">\n        <tr>\n            <td width=\"40%\" valign=\"top\">\n                <strong><?php _e('Reverse Proxy Check', 'wp-ban'); ?>:</strong><br />\n                <?php _e( 'This will assume that incoming requests include the user\\'s IP address in the HTTP_X_FORWARDED_FOR (and the request IP will be from your proxy).', 'wp-ban' ); ?>\n            </td>\n            <td width=\"60%\">\n                <label>\n                    <input type=\"checkbox\" name=\"banned_option_reverse_proxy\" value=\"1\"<?php echo ( intval( $banned_options['reverse_proxy'] ) === 1 ) ? ' checked=\"checked\"' : ''; ?> />\n                    <?php _e( 'I am using a reverse proxy.', 'wp-ban' ); ?>\n                </label>\n                <p>\n                    <?php _e( 'If you\\'re not sure, leave this unchecked. Ticking this box when you don\\'t have a reverse proxy will make it easy to bypass the IP ban.', 'wp-ban' ); ?>\n                </p>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned IPs', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Use <strong>*</strong> for wildcards.', 'wp-ban'); ?><br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">192.168.1.100</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">192.168.1.*</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">192.168.*.*</span></p>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_ips\" dir=\"ltr\"><?php echo $banned_ips_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned IP Range', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <span dir=\"ltr\">192.168.1.1-192.168.1.255</span><br /><br />\n                <?php _e('Notes:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('No Wildcards Allowed.', 'wp-ban'); ?><br />\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_ips_range\" dir=\"ltr\"><?php echo $banned_ips_range_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned Host Names', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Use <strong>*</strong> for wildcards', 'wp-ban'); ?>.<br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">*.sg</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">*.cn</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">*.th</span></p>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_hosts\" dir=\"ltr\"><?php echo $banned_hosts_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned Referers', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Use <strong>*</strong> for wildcards', 'wp-ban'); ?>.<br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <span dir=\"ltr\">http://*.blogspot.com</span><br /><br />\n                <?php _e('Notes:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('There are ways to bypass this method of banning.', 'wp-ban'); ?>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_referers\" dir=\"ltr\"><?php echo $banned_referers_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned User Agents', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Use <strong>*</strong> for wildcards', 'wp-ban'); ?>.<br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">EmailSiphon*</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">LMQueueBot*</span></p>\n                <p style=\"margin: 2px 0\"><strong>&raquo;</strong> <span dir=\"ltr\">ContactBot*</span></p>\n                <?php _e('Suggestions:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('See <a href=\"http://www.user-agents.org/\">http://www.user-agents.org/</a>', 'wp-ban'); ?>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_user_agents\" dir=\"ltr\"><?php echo $banned_user_agents_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned Exclude IPs', 'wp-ban'); ?>:</strong><br />\n                <?php _e('Start each entry on a new line.', 'wp-ban'); ?><br /><br />\n                <?php _e('Examples:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <span dir=\"ltr\">192.168.1.100</span><br /><br />\n                <?php _e('Notes:', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('No Wildcards Allowed.', 'wp-ban'); ?><br />\n                <strong>&raquo;</strong> <?php _e('These Users Will Not Get Banned.', 'wp-ban'); ?>\n            </td>\n            <td>\n                <textarea cols=\"40\" rows=\"10\" name=\"banned_exclude_ips\" dir=\"ltr\"><?php echo $banned_exclude_ips_display; ?></textarea>\n            </td>\n        </tr>\n        <tr>\n            <td valign=\"top\">\n                <strong><?php _e('Banned Message', 'wp-ban'); ?>:</strong><br /><br /><br />\n                    <?php _e('Allowed Variables:', 'wp-ban'); ?>\n                    <p style=\"margin: 2px 0\">- %SITE_NAME%</p>\n                    <p style=\"margin: 2px 0\">- %SITE_URL%</p>\n                    <p style=\"margin: 2px 0\">- %USER_ATTEMPTS_COUNT%</p>\n                    <p style=\"margin: 2px 0\">- %USER_IP%</p>\n                    <p style=\"margin: 2px 0\">- %USER_HOSTNAME%</p>\n                    <p style=\"margin: 2px 0\">- %TOTAL_ATTEMPTS_COUNT%</p><br />\n                    <p><?php printf(__('Note: Your message must be within %s', 'wp-ban'), htmlspecialchars('<div id=\"wp-ban-container\"></div>')); ?></p><br />\n                    <input type=\"button\" name=\"RestoreDefault\" value=\"<?php _e('Restore Default Template', 'wp-ban'); ?>\" onclick=\"banned_default_templates('message');\" class=\"button\" /><br /><br />\n                    <input type=\"button\" id=\"show_button\" value=\"<?php _e('Show Current Banned Message', 'wp-ban'); ?>\" class=\"button\" /><br />\n            </td>\n            <td>\n                <textarea cols=\"100\" style=\"width: 100%;\" rows=\"20\" id=\"banned_template_message\" name=\"banned_template_message\"><?php echo stripslashes(get_option('banned_message')); ?></textarea>\n                <div id=\"banned_preview_message\"></div>\n            </td>\n        </tr>\n    </table>\n    <p style=\"text-align: center;\">\n        <input type=\"submit\" name=\"Submit\" class=\"button\" value=\"<?php _e('Save Changes', 'wp-ban'); ?>\" />\n    </p>\n</div>\n</form>\n<p>&nbsp;</p>\n\n<form method=\"post\" action=\"<?php echo admin_url('admin.php?page='.plugin_basename(__FILE__)); ?>\">\n<?php wp_nonce_field('wp-ban_stats'); ?>\n<div class=\"wrap\">\n    <h3><?php _e('Ban Stats', 'wp-ban'); ?></h3>\n    <br style=\"clear\" />\n    <table class=\"widefat\">\n        <thead>\n            <tr>\n                <th width=\"40%\" style=\"text-align: center;\"><?php _e('IPs', 'wp-ban'); ?></th>\n                <th width=\"30%\" style=\"text-align: center;\"><?php _e('Attempts', 'wp-ban'); ?></th>\n                <th width=\"30%\"><input type=\"checkbox\" id=\"toogle_checkbox\" name=\"toogle_checkbox\" value=\"1\" onclick=\"toggle_checkbox();\" />&nbsp;<label for=\"toogle_checkbox\"><?php _e('Action', 'wp-ban'); ?></label></th>\n            </tr>\n        </thead>\n            <?php\n                // Credits To Joe (Ttech) - http://blog.fileville.net/\n                if(!empty($banned_stats['users'])) {\n                    $i = 0;\n                    ksort($banned_stats['users']);\n                    foreach($banned_stats['users'] as $key => $value) {\n                        if($i%2 == 0) {\n                            $style = '';\n                        }  else {\n                            $style = ' class=\"alternate\"';\n                        }\n                        echo \"<tr$style>\\n\";\n                        echo \"<td style=\\\"text-align: center;\\\">$key</td>\\n\";\n                        echo \"<td style=\\\"text-align: center;\\\">\".number_format_i18n(intval($value)).\"</td>\\n\";\n                        echo \"<td><input type=\\\"checkbox\\\" id=\\\"ban-$i\\\" name=\\\"delete_ips[]\\\" value=\\\"$key\\\" />&nbsp;<label for=\\\"ban-$i\\\">\".__('Reset this IP ban stat?', 'wp-ban').\"</label></td>\\n\";\n                        echo '</tr>'.\"\\n\";\n                        $i++;\n                    }\n                } else {\n                    echo \"<tr>\\n\";\n                    echo '<td colspan=\"3\" align=\"center\">'.__('No Attempts', 'wp-ban').'</td>'.\"\\n\";\n                    echo '</tr>'.\"\\n\";\n                }\n            ?>\n        <tr class=\"thead\">\n            <td style=\"text-align: center;\"><strong><?php _e('Total  Attempts:', 'wp-ban'); ?></strong></td>\n            <td style=\"text-align: center;\"><strong><?php echo number_format_i18n(intval($banned_stats['count'])); ?></strong></td>\n            <td><input type=\"checkbox\" id=\"reset_ban_stats\" name=\"reset_ban_stats\" value=\"yes\" />&nbsp;<label for=\"reset_ban_stats\"><?php _e('Reset all IP ban stats and total ban stat?', 'wp-ban'); ?></label></td>\n        </tr>\n    </table>\n    <p style=\"text-align: center;\"><input type=\"submit\" name=\"do\" value=\"<?php _e('Reset Ban Stats', 'wp-ban'); ?>\" class=\"button\" onclick=\"return confirm('<?php _e('You Are About To Reset Ban Stats.', 'wp-ban'); ?>\\n\\n<?php _e('This Action Is Not Reversible. Are you sure?', 'wp-ban'); ?>')\" /></p>\n</div>\n</form>\n<p>&nbsp;</p>\n"], "filenames": ["ban-options.php"], "buggy_code_start_loc": [272], "buggy_code_end_loc": [273], "fixing_code_start_loc": [272], "fixing_code_end_loc": [273], "type": "CWE-707", "message": "A vulnerability, which was classified as problematic, has been found in WP-Ban. This issue affects the function toggle_checkbox of the file ban-options.php. The manipulation of the argument $_SERVER[\"HTTP_USER_AGENT\"] leads to cross site scripting. The attack may be initiated remotely. The name of the patch is 13e0b1e922f3aaa3f8fcb1dd6d50200dd693fd76. It is recommended to apply a patch to fix this issue. The identifier VDB-216209 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2021-4252", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-18T22:15:10.243", "lastModified": "2022-12-22T19:26:08.510", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, has been found in WP-Ban. This issue affects the function toggle_checkbox of the file ban-options.php. The manipulation of the argument $_SERVER[\"HTTP_USER_AGENT\"] leads to cross site scripting. The attack may be initiated remotely. The name of the patch is 13e0b1e922f3aaa3f8fcb1dd6d50200dd693fd76. It is recommended to apply a patch to fix this issue. The identifier VDB-216209 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:wp-ban_project:wp-ban:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "2021-11-24", "matchCriteriaId": "F064FEA7-220B-4644-91B7-4827ABFAF247"}]}]}], "references": [{"url": "https://github.com/lesterchan/wp-ban/commit/13e0b1e922f3aaa3f8fcb1dd6d50200dd693fd76", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/lesterchan/wp-ban/pull/11", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.216209", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/lesterchan/wp-ban/commit/13e0b1e922f3aaa3f8fcb1dd6d50200dd693fd76"}}