{"buggy_code": ["<?php\n/**\n* Add token entry\n*/\n?>\n<div class='container-fluid <?php if (!isset($ajax) || $ajax = false):?> col-12 side-body <?php echo getSideBodyClass(false); ?> <?php endif; ?>'>\n\n<?php if (!isset($ajax) || $ajax = false) { ?>\n  <h3>\n  <?php\n\n    if ($token_subaction == \"edit\") {\n        eT(\"Edit survey participant\");\n    } else {\n        eT(\"Add survey participant\");\n    }\n\n    ?>\n  </h3>\n<?php } ?>\n<?php\nforeach ($tokendata as $Key => $Value) {\n    $$Key = $Value;\n}\n?>\n\n<div class=\"row\">\n  <div class=\"col-md-12 content-right\">\n    <?php echo CHtml::form(array(\"admin/tokens/sa/{$token_subaction}/surveyid/{$surveyid}/tokenid/{$tokenid}\"), 'post', array('id'=>'edittoken', 'class'=>'')); ?>\n      <!-- Tabs -->\n      <?php if( count($attrfieldnames) > 0 ):?>\n        <ul class=\"nav nav-tabs\" id=\"edit-survey-text-element-language-selection\">\n\n          <!-- Common  -->\n          <li role=\"presentation\" class=\"active\">\n            <a data-toggle=\"tab\" href=\"#general\" aria-expanded=\"true\">\n              <?php eT('General'); ?>\n            </a>\n          </li>\n\n          <!-- Custom attibutes -->\n          <li role=\"presentation\" class=\"\">\n            <a data-toggle=\"tab\" href=\"#custom\" aria-expanded=\"false\">\n              <?php eT('Additional attributes'); ?>\n            </a>\n          </li>\n        </ul>\n      <?php endif; ?>\n\n      <!-- Tabs content-->\n      <div class=\"tab-content\">\n        <div id=\"general\" class=\"tab-pane fade in active\">\n            <div class=\"ls-flex-column ls-space padding left-5 right-35 col-md-6\">\n            <!-- General -->\n                <!-- ID,Completed  -->\n                <div class=\"form-group\">\n                <!-- ID  -->\n                <label class=\" control-label\">ID:</label>\n                <div class=\"\">\n                    <p class=\"form-control-static\">\n                    <?php\n                    if ($token_subaction == \"edit\") {\n                        echo $tokenid;\n                    } else {\n                        eT(\"Auto\");\n                    }\n                    ?>\n                    </p>\n                </div>\n                </div>\n                <div class=\"form-group\">\n                <!--\n                TODO:\n                To take in account the anonomyzed survey case (completed field contain no date, but a {Y,N}), the code become more complexe\n                It will need a refactorisation .\n                maybe a widget? At least, a lot of variable should be set in the controller (classes etc)\n                -->\n                <?php $sCointainerClass = ($oSurvey->anonymized != 'Y') ? 'yes-no-date-container' : 'yes-no-container'; ?>\n                <!-- Completed -->\n                <label class=\" control-label\" for='completed'>\n                    <?php eT(\"Completed?\"); ?>\n                </label>\n                <div class=\"selector__yesNoContainer <?php echo $sCointainerClass; ?>\" id=\"completed-yes-no-date-container\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n                    <div class=\"row\">\n                    <?php if ($oSurvey->anonymized != 'Y'):?>\n\n                        <?php\n                        $bCompletedValue = \"0\";\n                        if (isset($completed) && $completed != 'N')\n                        {\n                            $completedDBFormat     = $completed;\n                            $bCompletedValue       = \"1\";\n                            $completed             = convertToGlobalSettingFormat($completed, true);\n                        }\n                        ?>\n\n                        <div class=\"\">\n                        <?php\n                            $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                            'name' => \"completed-switch\",\n                            'id'=>\"completed-switch\",\n                            'htmlOptions'=>array('class'=>\"YesNoDateSwitch action_toggle_bootstrap_switch\"),\n                            'value' => $bCompletedValue,\n                            'onLabel'=>gT('Yes'),\n                            'offLabel' => gT('No')));\n                        ?>\n                        </div>\n                    <?php else: ?>\n                        <div class=\"\">\n                        <?php\n                        $completedDBFormat = $completed;\n                        $bCompletedValue   = (isset($completed) && $completed != 'N') ? \"1\" : \"0\";\n                        $completed         = (isset($completed) && $completed != 'N') ? 'Y' : 'N';\n                        ?>\n\n                        <?php\n                            $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                            'name' => \"completed-switch\",\n                            'id'=>\"completed-switch\",\n                            'htmlOptions'=>array('class'=>\"YesNoSwitch action_toggle_bootstrap_switch\"),\n                            'value' => $bCompletedValue,\n                            'onLabel'=>gT('Yes'),\n                            'offLabel' => gT('No')));\n                        ?>\n                        </div>\n                    <?php endif; ?>\n\n                    <?php if ($oSurvey->anonymized != 'Y'):?>\n                        <div class=\"\">\n                            <div id=\"sent-date-container\" class=\"date-container\"  <?php if (!$bCompletedValue):?>style=\"display: none;\"<?php endif; ?>>\n                            <div id=\"completed-date_datetimepicker\" class=\"input-group date\">\n                                <input class=\"YesNoDatePicker form-control\" id=\"completed-date\" type=\"text\" value=\"<?php echo isset($completed) ? $completed : ''?>\" name=\"completed-date\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\">\n                                <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                            </div>\n                            </div>\n                        </div>\n                        <?php endif; ?>\n                    </div>\n                    <input class='form-control hidden YesNoDateHidden' type='text' size='20' id='completed' name='completed' value=\"<?php if (isset($completed)) {echo $completed; } else {echo \" N \"; }?>\" />\n                </div>\n\n            </div>\n\n            <!-- First name, Last name -->            \n            <div class=\"form-group\">\n                <label class=\" control-label\" for='firstname'>\n                <?php eT(\"First name:\"); ?>\n                </label>\n                <div class=\"\">\n                <input class='form-control' type='text' size='30' id='firstname' name='firstname' value=\"<?php if (isset($firstname)) {echo $firstname; } ?>\" />\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='lastname'>\n                <?php eT(\"Last name:\"); ?>\n                </label>\n                <div class=\"\">\n                <input class='form-control' type='text' size='30' id='lastname' name='lastname' value=\"<?php if (isset($lastname)) {echo $lastname; } ?>\" />\n                </div>\n            </div>\n\n\n            <!-- Token, language -->\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='token'>\n                <?php eT(\"Token:\"); ?>\n                </label>\n                <div class=\"\">\n                <input class='form-control' type='text' maxlength=\"<?php echo $iTokenLength; ?>\" size='20' name='token' id='token' value=\"<?php if (isset($token)) {echo $token; } ?>\" />\n                <?php if ($token_subaction == \"addnew\"): ?>\n                    <span id=\"helpBlock\" class=\"help-block\"><?php eT(\"You can leave this blank, and automatically generate tokens using 'Generate Tokens'\"); ?></span>\n                <?php endif; ?>\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='language'>\n                <?php eT(\"Language:\"); ?>\n                </label>\n                <div class=\"\">\n                <?php if (isset($language)) {echo languageDropdownClean($surveyid, $language); } else {echo languageDropdownClean($surveyid, Survey::model()->findByPk($surveyid)->language); }?>\n                </div>\n            </div>\n        </div>\n        <div class=\"ls-flex-column ls-space padding left-5 right-35 col-md-6\">\n\n            <!-- Email, Email Status  -->\n            <div class=\"form-group\">\n            <label class=\" control-label\" for='email'>\n                <?php eT(\"Email:\"); ?>\n            </label>\n            <div class=\"\">\n                <input class='form-control' type='text' maxlength='320' size='50' id='email' name='email' value=\"<?php if (isset($email)) {echo $email; } ?>\" />\n            </div>\n            </div>\n\n            <!-- Email Status -->\n            <div class=\"form-group\">\n            <label class=\" control-label\" for='emailstatus'>\n                <?php eT(\"Email status:\"); ?>\n            </label>\n            <div class=\"\">\n                <input class='form-control' type='text' maxlength='320' size='50' id='emailstatus' name='emailstatus' placeholder='OK' value=\"<?php if (isset($emailstatus)) {echo $emailstatus; } else {echo \" OK \"; }?>\" />\n            </div>\n            </div>\n\n            <!-- Invitation sent, Reminder sent -->\n            <div class=\"form-group\">\n            <!-- Invitation sent -->\n            <label class=\" control-label\" for='sent'>\n                <?php eT(\"Invitation sent?\"); ?>\n            </label>\n            <div class=\"selector__yesNoContainer <?php echo $sCointainerClass; ?>\" id=\"sent-yes-no-date-container\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n                <div class=\"row\">\n                <div class=\"\">\n                    <?php if ($oSurvey->anonymized != 'Y'):?>\n                    <?php\n                        // TODO: move to controller\n                        $bSwitchValue       = (isset($sent) && $sent != 'N') ? \"1\" : \"0\";\n                        $bRemindSwitchValue = (isset($remindersent) && $remindersent != 'N') ? \"1\" : \"0\";\n\n                        $bSwitchValue = \"0\";\n                        if (isset($sent) && $sent != 'N')\n                        {\n                            $bSwitchValue     = \"1\";\n                            $sentDBValue      = $sent;\n                            $sent             = convertToGlobalSettingFormat($sent, true);\n                        }\n\n                        $bRemindSwitchValue = \"0\";\n                        if (isset($remindersent) && $remindersent != 'N')\n                        {\n                            $bRemindSwitchValue       = \"1\";\n                            $remindersentDBValue      = $remindersent;\n                            $remindersent             = convertToGlobalSettingFormat($remindersent, true);\n                        }\n                    ?>\n\n                    <?php\n                        $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                        'name' => \"sent-switch\",\n                        'id'=>\"sent-switch\",\n                        'htmlOptions'=>array('class'=>\"YesNoDateSwitch action_toggle_bootstrap_switch\"),\n                        'value' => $bSwitchValue,\n                        'onLabel'=>gT('Yes'),\n                        'offLabel' => gT('No')));\n                    ?>\n                    <?php else:?>\n                        <?php\n                            $sentDBValue = $sent;\n                            $remindersentDBValue = $remindersent;\n                            $bSwitchValue       = (isset($sent) && $sent != 'N') ? \"1\" : \"0\";\n                            $bRemindSwitchValue = (isset($remindersent) && $remindersent != 'N') ? \"1\" : \"0\";\n                        ?>\n\n                            <?php\n                            $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                                'name' => \"sent-switch\",\n                                'id'=>\"sent-switch\",\n                                'htmlOptions'=>array('class'=>\"YesNoSwitch action_toggle_bootstrap_switch\"),\n                                'value' => $bSwitchValue,\n                                'onLabel'=>gT('Yes'),\n                                'offLabel' => gT('No')));\n                            ?>\n                    <?php endif; ?>\n                </div>\n\n                <div class=\"\">\n                    <div id=\"sent-date-container\" data-parent=\"#sent-switch\" class=\"selector__date-container_hidden date-container\" <?php if (!$bSwitchValue){ echo \"style='display:none;'\"; }?> >\n                        <!-- Sent Date -->\n                        <div id=\"sent-date_datetimepicker\" class=\"input-group date\">\n                        <input class=\"YesNoDatePicker form-control\" id=\"sent-date\" type=\"text\" value=\"<?php echo isset($sent) ? $sent : ''?>\" name=\"sent-date\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\">\n                        <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                        </div>\n                    </div>\n                </div>\n                </div>\n                <input class='form-control hidden YesNoDateHidden' type='text' size='20' id='sent' name='sent' value=\"<?php if (isset($sent)) {echo $sent; } else {echo \" N \"; }?>\" />\n            </div>\n            </div>\n            <div class=\"form-group\">\n            <!-- Reminder sent -->\n            <label class=\" control-label\" for='remindersent'>\n                <?php eT(\"Reminder sent?\"); ?>\n            </label>\n            <div class=\"selector__yesNoContainer <?php echo $sCointainerClass; ?>\" id=\"remind-yes-no-date-container\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n\n                <div class=\"row\">\n                <div class=\"\">\n                    <?php if ($oSurvey->anonymized != 'Y') {\n                        ?>\n                    <?php\n                        $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                        'name' => \"remind-switch\",\n                        'id'=>\"remind-switch\",\n                        'htmlOptions'=>array('class'=>\"YesNoDateSwitch action_toggle_bootstrap_switch\"),\n                        'value' => $bRemindSwitchValue,\n                        'onLabel'=>gT('Yes'),\n                        'offLabel' => gT('No')));\n                    ?>\n                    <?php } else { ?>\n                        <?php\n                            $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                            'name' => \"sent-switch\",\n                            'id'=>\"sent-switch\",\n                            'htmlOptions'=>array('class'=>\"YesNoSwitch action_toggle_bootstrap_switch\"),\n                            'value' => $bSwitchValue,\n                            'onLabel'=>gT('Yes'),\n                            'offLabel' => gT('No')));\n                        ?>\n                    <?php } ?>\n                </div>\n\n                <div class=\"\">\n                    <div id=\"remind-date-container\" data-parent=\"#remind-switch\" class=\"selector__date-container_hidden date-container\" <?php if (!$bRemindSwitchValue){ echo \"style='display:none;'\"; }?> >\n\n                        <div id=\"remind-date_datetimepicker\" class=\"input-group date\">\n                        <input class=\"YesNoDatePicker form-control\" id=\"remind-date\" type=\"text\" value=\"<?php echo isset($remindersent) ? $remindersent : ''?>\" name=\"remind-date\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\">\n                        <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                        </div>\n                    </div>\n                </div>\n                </div>\n                <input class='form-control hidden YesNoDateHidden' type='text' size='20' id='remindersent' name='remindersent' value=\"<?php if (isset($remindersent)) {echo $remindersent; } else {echo \" N \"; }?>\" />\n            </div>\n                \n            <!-- Reminder count, Uses left -->\n            <div class=\"form-group\">\n                <!-- Reminder count -->\n                <?php if ($token_subaction == \"edit\"): ?>\n                <label class=\" control-label\" for='remindercount'>\n                    <?php eT(\"Reminder count:\"); ?>\n                </label>\n                <div class=\"\">\n                    <input class='form-control' type='number' size='6' id='remindercount' name='remindercount' value=\"<?php echo $remindercount; ?>\" />\n                </div>\n                <?php endif; ?>\n            </div>\n\n                <!-- Uses left -->\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='usesleft'>\n                <?php eT(\"Uses left:\"); ?>\n                </label>\n                <div class=\"\">\n                <input class='form-control' type='number' size='20' id='usesleft' name='usesleft' value=\"<?php if (isset($usesleft)) {echo $usesleft; } else {echo \" 1 \"; }?>\" />\n                </div>\n            </div>\n            </div>\n        </div>\n\n        <div class=\"ls-flex-column ls-space padding left-5 right-35 col-md-12\">\n            <!-- Valid from to  -->\n            <div class=\"form-group\">\n            <?php\n                if (isset($validfrom) && $validfrom != 'N')\n                {\n                    $validfrom = convertToGlobalSettingFormat($validfrom, true);\n                }\n\n                if (isset($validuntil) && $validuntil != 'N')\n                {\n                    $validuntil = convertToGlobalSettingFormat($validuntil, true);\n                }\n            ?>\n\n            <!-- From -->\n            <label class=\" control-label\" for='validfrom'>\n                <?php eT(\"Valid from\"); ?>:</label>\n            <div class=\" has-feedback\">\n                <div id=\"validfrom_datetimepicker\" class=\"input-group date\">\n                <input class=\"YesNoDatePicker form-control\" id=\"validfrom\" type=\"text\" value=\"<?php echo isset($validfrom) ? $validfrom : ''?>\" name=\"validfrom\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n                <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                </div>\n            </div>\n            </div>\n\n            <div class=\"form-group\">\n            <!-- To -->\n            <label class=\" control-label\" for='validuntil'>\n                <?php eT('Until:'); ?>\n            </label>\n            <div class=\" has-feedback\">\n                <div id=\"validuntil_datetimepicker\" class=\"input-group date\">\n                <input class=\"YesNoDatePicker form-control\" id=\"validuntil\" type=\"text\" value=\"<?php echo isset($validuntil) ? $validuntil : ''?>\" name=\"validuntil\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n                <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                </div>\n            </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Custom attibutes -->\n    <div id=\"custom\" class=\"tab-pane fade in\">\n        <!-- Attributes -->\n        <?php foreach ($attrfieldnames as $attr_name => $attr_description): ?>\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='<?php echo $attr_name; ?>'>\n                    <?php echo $attr_description['description'].($attr_description['mandatory'] == 'Y' ? '*' : '') ?>:\n                </label>\n                <div class=\"\">\n                    <input class='form-control' type='text' size='55' id='<?php echo $attr_name; ?>' name='<?php echo $attr_name; ?>' value='<?php if (isset($$attr_name)){echo htmlspecialchars($$attr_name, ENT_QUOTES, 'utf-8');}?>' />\n                </div>\n            </div>\n            <?php endforeach; ?>\n        </div>\n</div>\n\n  <!-- Buttons -->\n  <p>\n    <?php\n    switch ($token_subaction)\n    {\n        case \"edit\":?>\n          <input type='submit' class=\"hidden\" value='<?php eT(\"Update token entry\"); ?>' />\n          <input type='hidden' name='subaction' value='updatetoken' />\n          <input type='hidden' name='tid' value='<?php echo $tokenid; ?>' />\n        <?php break;\n        case \"addnew\": ?>\n          <input type='submit' class='hidden' value='<?php eT(\"Add token entry\"); ?>' />\n          <input type='hidden' name='subaction' value='inserttoken' />\n        <?php break;\n    } ?>\n          <input type='hidden' name='sid' value='<?php echo $surveyid; ?>' />\n  </p>\n  </form>\n</div>\n</div>\n\n\n  <div style=\"display: none;\">\n    <?php\n        Yii::app()->getController()->widget('yiiwheels.widgets.datetimepicker.WhDateTimePicker', array(\n        'name' => \"no\",\n        'id'   => \"no\",\n        'value' => '',\n\n        ));\n    ?>\n  </div>\n</div>\n<?php\nApp()->getClientScript()->registerScript('TokenformViewBSSwitcher', \"\nLS.renderBootstrapSwitch();\n\", LSYii_ClientScript::POS_POSTSCRIPT);\n?>\n"], "fixing_code": ["<?php\n/**\n* Add token entry\n*/\n?>\n<div class='container-fluid <?php if (!isset($ajax) || $ajax = false):?> col-12 side-body <?php echo getSideBodyClass(false); ?> <?php endif; ?>'>\n\n<?php if (!isset($ajax) || $ajax = false) { ?>\n  <h3>\n  <?php\n\n    if ($token_subaction == \"edit\") {\n        eT(\"Edit survey participant\");\n    } else {\n        eT(\"Add survey participant\");\n    }\n\n    ?>\n  </h3>\n<?php } ?>\n<?php\nforeach ($tokendata as $Key => $Value) {\n    $$Key = $Value;\n}\n?>\n\n<div class=\"row\">\n  <div class=\"col-md-12 content-right\">\n    <?php echo CHtml::form(array(\"admin/tokens/sa/{$token_subaction}/surveyid/{$surveyid}/tokenid/{$tokenid}\"), 'post', array('id'=>'edittoken', 'class'=>'')); ?>\n      <!-- Tabs -->\n      <?php if( count($attrfieldnames) > 0 ):?>\n        <ul class=\"nav nav-tabs\" id=\"edit-survey-text-element-language-selection\">\n\n          <!-- Common  -->\n          <li role=\"presentation\" class=\"active\">\n            <a data-toggle=\"tab\" href=\"#general\" aria-expanded=\"true\">\n              <?php eT('General'); ?>\n            </a>\n          </li>\n\n          <!-- Custom attibutes -->\n          <li role=\"presentation\" class=\"\">\n            <a data-toggle=\"tab\" href=\"#custom\" aria-expanded=\"false\">\n              <?php eT('Additional attributes'); ?>\n            </a>\n          </li>\n        </ul>\n      <?php endif; ?>\n\n      <!-- Tabs content-->\n      <div class=\"tab-content\">\n        <div id=\"general\" class=\"tab-pane fade in active\">\n            <div class=\"ls-flex-column ls-space padding left-5 right-35 col-md-6\">\n            <!-- General -->\n                <!-- ID,Completed  -->\n                <div class=\"form-group\">\n                <!-- ID  -->\n                <label class=\" control-label\">ID:</label>\n                <div class=\"\">\n                    <p class=\"form-control-static\">\n                    <?php\n                    if ($token_subaction == \"edit\") {\n                        echo $tokenid;\n                    } else {\n                        eT(\"Auto\");\n                    }\n                    ?>\n                    </p>\n                </div>\n                </div>\n                <div class=\"form-group\">\n                <!--\n                TODO:\n                To take in account the anonomyzed survey case (completed field contain no date, but a {Y,N}), the code become more complexe\n                It will need a refactorisation .\n                maybe a widget? At least, a lot of variable should be set in the controller (classes etc)\n                -->\n                <?php $sCointainerClass = ($oSurvey->anonymized != 'Y') ? 'yes-no-date-container' : 'yes-no-container'; ?>\n                <!-- Completed -->\n                <label class=\" control-label\" for='completed'>\n                    <?php eT(\"Completed?\"); ?>\n                </label>\n                <div class=\"selector__yesNoContainer <?php echo $sCointainerClass; ?>\" id=\"completed-yes-no-date-container\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n                    <div class=\"row\">\n                    <?php if ($oSurvey->anonymized != 'Y'):?>\n\n                        <?php\n                        $bCompletedValue = \"0\";\n                        if (isset($completed) && $completed != 'N')\n                        {\n                            $completedDBFormat     = $completed;\n                            $bCompletedValue       = \"1\";\n                            $completed             = convertToGlobalSettingFormat($completed, true);\n                        }\n                        ?>\n\n                        <div class=\"\">\n                        <?php\n                            $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                            'name' => \"completed-switch\",\n                            'id'=>\"completed-switch\",\n                            'htmlOptions'=>array('class'=>\"YesNoDateSwitch action_toggle_bootstrap_switch\"),\n                            'value' => $bCompletedValue,\n                            'onLabel'=>gT('Yes'),\n                            'offLabel' => gT('No')));\n                        ?>\n                        </div>\n                    <?php else: ?>\n                        <div class=\"\">\n                        <?php\n                        $completedDBFormat = $completed;\n                        $bCompletedValue   = (isset($completed) && $completed != 'N') ? \"1\" : \"0\";\n                        $completed         = (isset($completed) && $completed != 'N') ? 'Y' : 'N';\n                        ?>\n\n                        <?php\n                            $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                            'name' => \"completed-switch\",\n                            'id'=>\"completed-switch\",\n                            'htmlOptions'=>array('class'=>\"YesNoSwitch action_toggle_bootstrap_switch\"),\n                            'value' => $bCompletedValue,\n                            'onLabel'=>gT('Yes'),\n                            'offLabel' => gT('No')));\n                        ?>\n                        </div>\n                    <?php endif; ?>\n\n                    <?php if ($oSurvey->anonymized != 'Y'):?>\n                        <div class=\"\">\n                            <div id=\"sent-date-container\" class=\"date-container\"  <?php if (!$bCompletedValue):?>style=\"display: none;\"<?php endif; ?>>\n                            <div id=\"completed-date_datetimepicker\" class=\"input-group date\">\n                                <input class=\"YesNoDatePicker form-control\" id=\"completed-date\" type=\"text\" value=\"<?php echo isset($completed) ? $completed : ''?>\" name=\"completed-date\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\">\n                                <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                            </div>\n                            </div>\n                        </div>\n                        <?php endif; ?>\n                    </div>\n                    <input class='form-control hidden YesNoDateHidden' type='text' size='20' id='completed' name='completed' value=\"<?php if (isset($completed)) {echo $completed; } else {echo \" N \"; }?>\" />\n                </div>\n\n            </div>\n\n            <!-- First name, Last name -->            \n            <div class=\"form-group\">\n                <label class=\" control-label\" for='firstname'>\n                <?php eT(\"First name:\"); ?>\n                </label>\n                <div class=\"\">\n                    <?=TbHtml::textField('firstname', $firstname, [\n                        'class' => 'form-control',\n                        'size' => '30',\n                    ]);?>\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='lastname'>\n                <?php eT(\"Last name:\"); ?>\n                </label>\n                <div class=\"\">\n                    <?=TbHtml::textField('lastname', $lastname, [\n                        'class' => 'form-control',\n                        'size' => '30',\n                    ]);?>\n                </div>\n            </div>\n\n\n            <!-- Token, language -->\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='token'>\n                <?php eT(\"Token:\"); ?>\n                </label>\n                <div class=\"\">\n                <input class='form-control' type='text' maxlength=\"<?php echo $iTokenLength; ?>\" size='20' name='token' id='token' value=\"<?php if (isset($token)) {echo $token; } ?>\" />\n                <?php if ($token_subaction == \"addnew\"): ?>\n                    <span id=\"helpBlock\" class=\"help-block\"><?php eT(\"You can leave this blank, and automatically generate tokens using 'Generate Tokens'\"); ?></span>\n                <?php endif; ?>\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='language'>\n                <?php eT(\"Language:\"); ?>\n                </label>\n                <div class=\"\">\n                <?php if (isset($language)) {echo languageDropdownClean($surveyid, $language); } else {echo languageDropdownClean($surveyid, Survey::model()->findByPk($surveyid)->language); }?>\n                </div>\n            </div>\n        </div>\n        <div class=\"ls-flex-column ls-space padding left-5 right-35 col-md-6\">\n\n            <!-- Email, Email Status  -->\n            <div class=\"form-group\">\n            <label class=\" control-label\" for='email'>\n                <?php eT(\"Email:\"); ?>\n            </label>\n            <div class=\"\">\n                <?=TbHtml::emailField('email', $email, [\n                        'class' => 'form-control',\n                        'size' => '50',\n                        'maxlength' => '320' \n                ]);?>\n            </div>\n            </div>\n\n            <!-- Email Status -->\n            <div class=\"form-group\">\n            <label class=\" control-label\" for='emailstatus'>\n                <?php eT(\"Email status:\"); ?>\n            </label>\n            <div class=\"\">\n                <?=TbHtml::textField('emailstatus', $emailstatus, [\n                        'class' => 'form-control',\n                        'size' => '50',\n                        'maxlength' => '320',\n                        'placeholder' => 'OK'\n                ]);?>\n            </div>\n            </div>\n\n            <!-- Invitation sent, Reminder sent -->\n            <div class=\"form-group\">\n            <!-- Invitation sent -->\n            <label class=\" control-label\" for='sent'>\n                <?php eT(\"Invitation sent?\"); ?>\n            </label>\n            <div class=\"selector__yesNoContainer <?php echo $sCointainerClass; ?>\" id=\"sent-yes-no-date-container\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n                <div class=\"row\">\n                <div class=\"\">\n                    <?php if ($oSurvey->anonymized != 'Y'):?>\n                    <?php\n                        // TODO: move to controller\n                        $bSwitchValue       = (isset($sent) && $sent != 'N') ? \"1\" : \"0\";\n                        $bRemindSwitchValue = (isset($remindersent) && $remindersent != 'N') ? \"1\" : \"0\";\n\n                        $bSwitchValue = \"0\";\n                        if (isset($sent) && $sent != 'N')\n                        {\n                            $bSwitchValue     = \"1\";\n                            $sentDBValue      = $sent;\n                            $sent             = convertToGlobalSettingFormat($sent, true);\n                        }\n\n                        $bRemindSwitchValue = \"0\";\n                        if (isset($remindersent) && $remindersent != 'N')\n                        {\n                            $bRemindSwitchValue       = \"1\";\n                            $remindersentDBValue      = $remindersent;\n                            $remindersent             = convertToGlobalSettingFormat($remindersent, true);\n                        }\n                    ?>\n\n                    <?php\n                        $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                        'name' => \"sent-switch\",\n                        'id'=>\"sent-switch\",\n                        'htmlOptions'=>array('class'=>\"YesNoDateSwitch action_toggle_bootstrap_switch\"),\n                        'value' => $bSwitchValue,\n                        'onLabel'=>gT('Yes'),\n                        'offLabel' => gT('No')));\n                    ?>\n                    <?php else:?>\n                        <?php\n                            $sentDBValue = $sent;\n                            $remindersentDBValue = $remindersent;\n                            $bSwitchValue       = (isset($sent) && $sent != 'N') ? \"1\" : \"0\";\n                            $bRemindSwitchValue = (isset($remindersent) && $remindersent != 'N') ? \"1\" : \"0\";\n                        ?>\n\n                            <?php\n                            $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                                'name' => \"sent-switch\",\n                                'id'=>\"sent-switch\",\n                                'htmlOptions'=>array('class'=>\"YesNoSwitch action_toggle_bootstrap_switch\"),\n                                'value' => $bSwitchValue,\n                                'onLabel'=>gT('Yes'),\n                                'offLabel' => gT('No')));\n                            ?>\n                    <?php endif; ?>\n                </div>\n\n                <div class=\"\">\n                    <div id=\"sent-date-container\" data-parent=\"#sent-switch\" class=\"selector__date-container_hidden date-container\" <?php if (!$bSwitchValue){ echo \"style='display:none;'\"; }?> >\n                        <!-- Sent Date -->\n                        <div id=\"sent-date_datetimepicker\" class=\"input-group date\">\n                        <input class=\"YesNoDatePicker form-control\" id=\"sent-date\" type=\"text\" value=\"<?php echo isset($sent) ? $sent : ''?>\" name=\"sent-date\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\">\n                        <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                        </div>\n                    </div>\n                </div>\n                </div>\n                <input class='form-control hidden YesNoDateHidden' type='text' size='20' id='sent' name='sent' value=\"<?php if (isset($sent)) {echo $sent; } else {echo \" N \"; }?>\" />\n            </div>\n            </div>\n            <div class=\"form-group\">\n            <!-- Reminder sent -->\n            <label class=\" control-label\" for='remindersent'>\n                <?php eT(\"Reminder sent?\"); ?>\n            </label>\n            <div class=\"selector__yesNoContainer <?php echo $sCointainerClass; ?>\" id=\"remind-yes-no-date-container\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n\n                <div class=\"row\">\n                <div class=\"\">\n                    <?php if ($oSurvey->anonymized != 'Y') {\n                        ?>\n                    <?php\n                        $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                        'name' => \"remind-switch\",\n                        'id'=>\"remind-switch\",\n                        'htmlOptions'=>array('class'=>\"YesNoDateSwitch action_toggle_bootstrap_switch\"),\n                        'value' => $bRemindSwitchValue,\n                        'onLabel'=>gT('Yes'),\n                        'offLabel' => gT('No')));\n                    ?>\n                    <?php } else { ?>\n                        <?php\n                            $this->widget('yiiwheels.widgets.switch.WhSwitch', array(\n                            'name' => \"sent-switch\",\n                            'id'=>\"sent-switch\",\n                            'htmlOptions'=>array('class'=>\"YesNoSwitch action_toggle_bootstrap_switch\"),\n                            'value' => $bSwitchValue,\n                            'onLabel'=>gT('Yes'),\n                            'offLabel' => gT('No')));\n                        ?>\n                    <?php } ?>\n                </div>\n\n                <div class=\"\">\n                    <div id=\"remind-date-container\" data-parent=\"#remind-switch\" class=\"selector__date-container_hidden date-container\" <?php if (!$bRemindSwitchValue){ echo \"style='display:none;'\"; }?> >\n\n                        <div id=\"remind-date_datetimepicker\" class=\"input-group date\">\n                        <input class=\"YesNoDatePicker form-control\" id=\"remind-date\" type=\"text\" value=\"<?php echo isset($remindersent) ? $remindersent : ''?>\" name=\"remind-date\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\">\n                        <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                        </div>\n                    </div>\n                </div>\n                </div>\n                <input class='form-control hidden YesNoDateHidden' type='text' size='20' id='remindersent' name='remindersent' value=\"<?php if (isset($remindersent)) {echo $remindersent; } else {echo \" N \"; }?>\" />\n            </div>\n                \n            <!-- Reminder count, Uses left -->\n            <div class=\"form-group\">\n                <!-- Reminder count -->\n                <?php if ($token_subaction == \"edit\"): ?>\n                <label class=\" control-label\" for='remindercount'>\n                    <?php eT(\"Reminder count:\"); ?>\n                </label>\n                <div class=\"\">\n                    <input class='form-control' type='number' size='6' id='remindercount' name='remindercount' value=\"<?php echo $remindercount; ?>\" />\n                </div>\n                <?php endif; ?>\n            </div>\n\n                <!-- Uses left -->\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='usesleft'>\n                <?php eT(\"Uses left:\"); ?>\n                </label>\n                <div class=\"\">\n                <input class='form-control' type='number' size='20' id='usesleft' name='usesleft' value=\"<?php if (isset($usesleft)) {echo $usesleft; } else {echo \" 1 \"; }?>\" />\n                </div>\n            </div>\n            </div>\n        </div>\n\n        <div class=\"ls-flex-column ls-space padding left-5 right-35 col-md-12\">\n            <!-- Valid from to  -->\n            <div class=\"form-group\">\n            <?php\n                if (isset($validfrom) && $validfrom != 'N')\n                {\n                    $validfrom = convertToGlobalSettingFormat($validfrom, true);\n                }\n\n                if (isset($validuntil) && $validuntil != 'N')\n                {\n                    $validuntil = convertToGlobalSettingFormat($validuntil, true);\n                }\n            ?>\n\n            <!-- From -->\n            <label class=\" control-label\" for='validfrom'>\n                <?php eT(\"Valid from\"); ?>:</label>\n            <div class=\" has-feedback\">\n                <div id=\"validfrom_datetimepicker\" class=\"input-group date\">\n                <input class=\"YesNoDatePicker form-control\" id=\"validfrom\" type=\"text\" value=\"<?php echo isset($validfrom) ? $validfrom : ''?>\" name=\"validfrom\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n                <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                </div>\n            </div>\n            </div>\n\n            <div class=\"form-group\">\n            <!-- To -->\n            <label class=\" control-label\" for='validuntil'>\n                <?php eT('Until:'); ?>\n            </label>\n            <div class=\" has-feedback\">\n                <div id=\"validuntil_datetimepicker\" class=\"input-group date\">\n                <input class=\"YesNoDatePicker form-control\" id=\"validuntil\" type=\"text\" value=\"<?php echo isset($validuntil) ? $validuntil : ''?>\" name=\"validuntil\" data-date-format=\"<?php echo $dateformatdetails['jsdate']; ?> HH:mm\" data-locale=\"<?php echo convertLStoDateTimePickerLocale(Yii::app()->session['adminlang']); ?>\">\n                <span class=\"input-group-addon\"><span class=\"fa fa-calendar\"></span></span>\n                </div>\n            </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Custom attibutes -->\n    <div id=\"custom\" class=\"tab-pane fade in\">\n        <!-- Attributes -->\n        <?php foreach ($attrfieldnames as $attr_name => $attr_description): ?>\n            <div class=\"form-group\">\n                <label class=\" control-label\" for='<?php echo $attr_name; ?>'>\n                    <?php echo $attr_description['description'].($attr_description['mandatory'] == 'Y' ? '*' : '') ?>:\n                </label>\n                <div class=\"\">\n                    <input class='form-control' type='text' size='55' id='<?php echo $attr_name; ?>' name='<?php echo $attr_name; ?>' value='<?php if (isset($$attr_name)){echo htmlspecialchars($$attr_name, ENT_QUOTES, 'utf-8');}?>' />\n                </div>\n            </div>\n            <?php endforeach; ?>\n        </div>\n</div>\n\n  <!-- Buttons -->\n  <p>\n    <?php\n    switch ($token_subaction)\n    {\n        case \"edit\":?>\n          <input type='submit' class=\"hidden\" value='<?php eT(\"Update token entry\"); ?>' />\n          <input type='hidden' name='subaction' value='updatetoken' />\n          <input type='hidden' name='tid' value='<?php echo $tokenid; ?>' />\n        <?php break;\n        case \"addnew\": ?>\n          <input type='submit' class='hidden' value='<?php eT(\"Add token entry\"); ?>' />\n          <input type='hidden' name='subaction' value='inserttoken' />\n        <?php break;\n    } ?>\n          <input type='hidden' name='sid' value='<?php echo $surveyid; ?>' />\n  </p>\n  </form>\n</div>\n</div>\n\n\n  <div style=\"display: none;\">\n    <?php\n        Yii::app()->getController()->widget('yiiwheels.widgets.datetimepicker.WhDateTimePicker', array(\n        'name' => \"no\",\n        'id'   => \"no\",\n        'value' => '',\n\n        ));\n    ?>\n  </div>\n</div>\n<?php\nApp()->getClientScript()->registerScript('TokenformViewBSSwitcher', \"\nLS.renderBootstrapSwitch();\n\", LSYii_ClientScript::POS_POSTSCRIPT);\n?>\n"], "filenames": ["application/views/admin/token/tokenform.php"], "buggy_code_start_loc": [150], "buggy_code_end_loc": [203], "fixing_code_start_loc": [150], "fixing_code_end_loc": [218], "type": "CWE-79", "message": "LimeSurvey 3.21.1 is affected by cross-site scripting (XSS) in the Add Participants Function (First and last name parameters). When the survey participant being edited, e.g. by an administrative user, the JavaScript code will be executed in the browser.", "other": {"cve": {"id": "CVE-2020-25797", "sourceIdentifier": "cve@mitre.org", "published": "2020-12-31T18:15:13.030", "lastModified": "2021-01-05T14:20:47.523", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "LimeSurvey 3.21.1 is affected by cross-site scripting (XSS) in the Add Participants Function (First and last name parameters). When the survey participant being edited, e.g. by an administrative user, the JavaScript code will be executed in the browser."}, {"lang": "es", "value": "LimeSurvey versi\u00f3n 3.21.1, est\u00e1 afectado por una vulnerabilidad de tipo cross-site scripting (XSS) en la Funci\u00f3n Add Participants (par\u00e1metros first y last name).&#xa0;Cuando el participante de la encuesta sea editado, por ejemplo, por un usuario administrativo, el c\u00f3digo JavaScript ser\u00e1 ejecutado en el navegador."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:limesurvey:limesurvey:3.21.1:*:*:*:*:*:*:*", "matchCriteriaId": "CA401C3E-D4E1-4E2A-AC60-047600277AD2"}]}]}], "references": [{"url": "https://bugs.limesurvey.org/view.php?id=15680", "source": "cve@mitre.org", "tags": ["Exploit", "Vendor Advisory"]}, {"url": "https://github.com/LimeSurvey/LimeSurvey/commit/0a7bdfa1c166f734d11a1528c8d9a7d61b670ad7", "source": "cve@mitre.org", "tags": ["Patch", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/LimeSurvey/LimeSurvey/commit/0a7bdfa1c166f734d11a1528c8d9a7d61b670ad7"}}