{"buggy_code": ["<?php\r\ndefine('ROOT_PATH', realpath(dirname(__FILE__) . '/../../') . '/');\r\n\r\nrequire_once ROOT_PATH . 'core/template/header-admin.php';\r\n\r\n?>\r\n<?php require_once $_SERVER['DOCUMENT_ROOT'] . '/core/template/admin-menu-horizontal.php';?>\r\n  <button class=\"btn btn-primary position-fixed start-0 translate-middle-y d-md-none tools-settings\" type=\"button\" data-bs-toggle=\"offcanvas\" data-bs-target=\"#sidebarOffcanvas\" aria-controls=\"sidebarOffcanvas\">\r\n      <i class=\"fas fa-bars\"></i>\r\n  </button>\r\n <?php require_once  $_SERVER['DOCUMENT_ROOT'] . '/core/tools/sidebar.php';?>\r\n<div class=\"container-fluid mt-4 main-content admin-layout\">\r\n    <div class=\"row\">\r\n            <main role=\"main\" class=\"col-md-9 ml-sm-auto col-lg-10 px-4  content-up\">\r\n\r\n<?php   \r\n    $possible_rows = [5, 15, 45, 55, 75, 150, 250, 350]; // galimos eilu\u010di\u0173 reik\u0161m\u0117s\r\n    $records_per_page = isset($_GET['rows']) ? intval($_GET['rows']) : 5; // pasirinktos eilut\u0117s\r\n\r\n        $i = 1;\r\n                $page = isset($_GET['page']) ? (int)$_GET['page'] : 1;\r\n                $offset = ($page - 1) * $records_per_page;\r\n                $search_term = isset($_GET['search_term']) ? $_GET['search_term'] : '';\r\n            \r\n                $start = ($page - 1) * $records_per_page;\r\n\r\n                $posts = getAllPostsPagination($db, $prefix, $start, $records_per_page, $search_term);\r\n                $total_posts = countAllPosts($db, $prefix);\r\n                $total_pages = ceil($total_posts / $records_per_page);\r\n                $menuItems = getMenuItems($db, $prefix);\r\n                $menuItemsIndexed = array_column($menuItems, null, 'id');\r\n          ?>\r\n       \r\n            <div class=\"col-sm-9\">\r\n                <?php\r\n                if (isset($_SESSION['success_message'])) {\r\n                    echo \"<div class='alert alert-success alert-dismissible fade show slow-fade'>\r\n                        \" . htmlspecialchars($_SESSION['success_message']) . \"\r\n                        <button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>\r\n                    </div>\";\r\n                    unset($_SESSION['success_message']);\r\n                }\r\n\r\n                if (isset($_SESSION['error_message'])) {\r\n                    echo \"<div class='alert alert-danger alert-dismissible fade show slow-fade'>\r\n                        \" . htmlspecialchars($_SESSION['error_message']) . \"\r\n                        <button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>\r\n                    </div>\";\r\n                    unset($_SESSION['error_message']);\r\n                }\r\n                ?>\r\n            </div>\r\n            <h2><?php echo t(\"Posts on pages\");?></h2>\r\n            <button type=\"button\" class=\"btn btn-sm btn-primary\" onclick=\"loadPostForm('create')\" title=\"Add\">\r\n              <i class=\"fas fa-pencil\"></i>\r\n            </button>\r\n            <div class=\"col-md-12 mt-3\">\r\n                 <!-- I\u0161veda Puslapio redagavimo lang\u0105 -->\r\n            <div id=\"get-post-edit\"></div>\r\n               <div class=\"row\">\r\n                <div class=\"col-md-1\">\r\n                <form method=\"GET\" id=\"rows-form\">\r\n                <label for=\"rows\"><?php echo t(\"Per page:\");?></label>\r\n                <select name=\"rows\" class=\"form-select\" id=\"rows\" onchange=\"document.getElementById('rows-form').submit()\">\r\n                    <?php foreach($possible_rows as $rows): ?>\r\n                        <option value=\"<?php echo $rows; ?>\" <?php echo ($rows == $records_per_page ? 'selected' : ''); ?>>\r\n                            <?php echo $rows; ?>\r\n                        </option>\r\n                    <?php endforeach; ?>\r\n                </select>\r\n            </form>\r\n                </div>\r\n                <div class=\"col-md-9\">\r\n                <label for=\"search_term\"><?php echo t(\"Search for posts or pages\");?></label>\r\n                <div class=\"input-wrapper\">\r\n                     <input type=\"text\" id=\"search_term\" class=\"form-control search-input-long\" name=\"search_term\" placeholder=\"<?php echo t(\"Search post...\");?>\">\r\n                    <span id=\"clear-search\" class=\"clear-button\">&times;</span>\r\n                 </div>\r\n\r\n                </div>\r\n            \r\n          </div>\r\n        </div>\r\n         \r\n           \r\n            <table class=\"table\">\r\n                <thead>\r\n                    <tr>\r\n                        <th style=\"width: 3%;\"><?php echo t(\"No.\");?></th>\r\n                        <th style=\"width: 17%;\"><?php echo t(\"Title\");?></th>\r\n                        <th style=\"width: 40%;\"><?php echo t(\"Content\");?></th>\r\n                        <th style=\"width: 12%;\"><?php echo t(\"Page\");?></th>\r\n                        <th style=\"width: 3%;\"><i title=\"<?php echo t(\"Public\");?>\" class=\"fas fa-eye\"></i></th>\r\n                        <th style=\"width: 8%;\"><?php echo t(\"Author\");?></th>\r\n                        <th style=\"width: 10%;\"><?php echo t(\"Actions\");?></th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                <?php foreach ($posts as $post) { \r\n                        if (isset($menuItemsIndexed[$post['menu_id']])) {\r\n                            $post['menu_name'] = $menuItemsIndexed[$post['menu_id']]['name'];\r\n                        } else {\r\n                            $post['menu_name'] = '';\r\n                        }\r\n                     ?>\r\n                      <tr class=\"posts-row\" data-key=\"<?php echo htmlspecialchars($post['title']); ?>\" data-value=\"<?php echo htmlspecialchars($post['content']); ?>\" data-menu_name=\"<?php echo htmlspecialchars($post['menu_name']); ?>\">\r\n                           <td><?php echo $i++; ?>.</td>\r\n                            <td><?php echo htmlspecialchars($post['title']); ?></td>\r\n                            \r\n                            <td>\r\n                            <?php\r\n                                $content = htmlspecialchars_decode($post['content']);\r\n                                $content = preg_replace('/<img[^>]+>/i', '[image or file]', $content);\r\n                                $content = preg_replace('/<hr[^>]*>/i', '___', $content);\r\n\r\n                                // Pakei\u010diamas vis\u0173 nauj\u0173 eilu\u010di\u0173 simbolis \u012f tarp\u0105\r\n                                $content = str_replace(array(\"\\r\", \"\\n\"), ' ', $content);\r\n                                // Pa\u0161alinamos visos HTML \u017eymos\r\n                                $content = strip_tags($content);\r\n\r\n                                $max_length = 150;\r\n                                if (strlen($content) > $max_length) {\r\n                                    echo substr($content, 0, $max_length) . '...';\r\n                                } else {\r\n                                    echo $content;\r\n                                }\r\n                            ?>\r\n                            </td>\r\n                            <td><?php echo htmlspecialchars($post['menu_name']); ?></td>\r\n                            <td><?php  // View on page post\r\n                                        $menu_id = $post['menu_id'];\r\n                                        $menu_item = getMenuByMenuId($db, $prefix, $menu_id);\r\n                                        $page_url = $menu_item['page_url'];\r\n                                        $menuUrl = generateMenuUrl($db, $prefix, $page_url);\r\n                                     if ($post['status'] == 'published') {\r\n                                        echo '<a href=\"' . $menuUrl . '\">On</a>';\r\n                                    } elseif ($post['status'] == 'draft') {\r\n                                        echo 'Off';\r\n                                    }\r\n                                  ?></td>\r\n                            <td><?php echo htmlspecialchars($user_name); ?></td>\r\n                            <td>\r\n                                <button type=\"button\" class=\"btn btn-sm btn-primary\" onclick=\"loadPostEditForm(<?php echo $post['id']; ?>)\" title=\"<?php echo t(\"Edit\");?>\">\r\n                                    <i class=\"fas fa-edit\"></i>\r\n                                </button>\r\n\r\n                                <button type=\"button\" class=\"btn btn-sm btn-danger\" data-bs-toggle=\"modal\" data-bs-target=\"#confirmDeletePostModal\" data-post-id=\"<?php echo $post['id']; ?>\" title=\"<?php echo t(\"Delete\");?>\">\r\n                                    \r\n                                <i class=\"fas fa-trash-alt\"></i>\r\n                                </button>\r\n                            </td>\r\n                        </tr>\r\n                    <?php } ?>\r\n                </tbody>\r\n            </table>\r\n            <div class=\"d-flex justify-content-center mt-3\">\r\n            <nav aria-label=\"Page navigation\">\r\n            <ul class=\"pagination\">\r\n                <li class=\"page-item <?php echo ($page <= 1) ? 'disabled' : ''; ?>\">\r\n                    <a class=\"page-link\" href=\"?page=<?php echo $page - 1; ?>\" aria-label=\"Previous\">\r\n                    <span aria-hidden=\"true\">\u00ab</span>\r\n                     </a>\r\n                 </li>\r\n          <?php  $num_pages_to_display = 5;\r\n                 for ($i = max(1, $page - $num_pages_to_display); $i <= min($page + $num_pages_to_display, $total_pages); $i++): ?>\r\n                    <li class=\"page-item <?php echo ($i == $page) ? 'active' : ''; ?>\">\r\n                        <a class=\"page-link\" href=\"?page=<?php echo $i; ?>\"><?php echo $i; ?></a>\r\n                    </li>\r\n            <?php endfor; ?>\r\n                    <li class=\"page-item <?php echo ($page >= $total_pages) ? 'disabled' : ''; ?>\">\r\n                        <a class=\"page-link\" href=\"?page=<?php echo $page + 1; ?>\" aria-label=\"Next\">\r\n                        <span aria-hidden=\"true\">\u00bb</span>\r\n                        </a>\r\n                    </li>\r\n            </ul>\r\n        </nav>\r\n            </div>\r\n      \r\n      </main>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"modal fade\" id=\"confirmDeletePostModal\" tabindex=\"-1\" aria-labelledby=\"cconfirmDeletePostModalLabel\" aria-hidden=\"true\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h5 class=\"modal-title\" id=\"confirmDeletePostModalLabel\"><?php echo t(\"Confirm deletion\");?></h5>\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n      <?php echo t(\"Are you sure you want to delete this post?\");?> \r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\"><?php echo t(\"Cancel\");?></button>\r\n        <button type=\"button\" class=\"btn btn-danger  delete-post-btn\" id=\"confirm-delete-post-btn\"><?php echo t(\"Delete\");?></button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<script>\r\n  function loadPostEditForm(postId) {\r\n    loadPostForm('edit', postId);\r\n  }\r\n \r\n  \r\n  function loadPostAddForm(postMenuId) {\r\n    loadPostForm('create', postMenuId);\r\n  }\r\n \r\n  \r\n document.querySelector('#search_term').addEventListener('input', function() {\r\n        if (this.value !== '') {\r\n            document.querySelector('#clear-search').style.display = 'block';\r\n        } else {\r\n            document.querySelector('#clear-search').style.display = 'none';\r\n        }\r\n });\r\n\r\n document.querySelector('#clear-search').addEventListener('click', function() {\r\n    var searchInput = document.querySelector('#search_term');\r\n    searchInput.value = '';\r\n    this.style.display = 'none';\r\n    var event = new Event('keyup');\r\n    searchInput.dispatchEvent(event);\r\n });\r\n \r\n $(document).ready(function() {\r\n    $('#search_term').on('keyup', function() {\r\n        var search_term = $(this).val().toLowerCase();\r\n\r\n        $('.posts-row').each(function() {\r\n            var key = $(this).data('key').toLowerCase();\r\n            var value = $(this).data('value').toLowerCase();\r\n            var menu_name = $(this).data('menu_name').toLowerCase();\r\n\r\n            if (key.includes(search_term) || value.includes(search_term) || menu_name.includes(search_term)) {\r\n                $(this).show();\r\n            } else {\r\n                $(this).hide();\r\n            }\r\n        });\r\n    });\r\n});\r\n\r\n   \r\n$('button[data-bs-target=\"#confirmDeletePostModal\"]').on('click', function () {\r\n    const postId = $(this).data('post-id');\r\n    $('#confirmDeletePostModal').data('post-id', postId);\r\n    $('#confirmDeletePostModal').modal('show');\r\n  });\r\n\r\n$('#confirm-delete-post-btn').on('click', function () {\r\n    const postId = $('#confirmDeletePostModal').data('post-id');\r\n    $.ajax({\r\n      type: 'POST',\r\n      url: 'delete_post.php',\r\n      data: {\r\n        action: 'delete_post',\r\n        post_id: postId\r\n      },\r\n      success: function(response) {\r\n        $('#confirmDeletePostModal').modal('hide');\r\n        window.location.href = 'posts.php';\r\n      },\r\n      error: function(jqXHR, textStatus, errorThrown) {\r\n        console.error(textStatus, errorThrown);\r\n      }\r\n    });\r\n  });\r\n\r\n</script>\r\n<?php\r\nif (isset($_GET['edit_post_id'])) {\r\n    $edit_post_id = $_GET['edit_post_id'];\r\n    echo \"<script>loadPostEditForm($edit_post_id);</script>\";\r\n}\r\nif (isset($_GET['menu_id'])) {\r\n    $menu_id = $_GET['menu_id'];\r\n    echo \"<script>loadPostAddForm($menu_id);</script>\";\r\n}\r\n?>\r\n<script src=\"js/admin-post-edit.js\"></script>\r\n\r\n<?php require_once ROOT_PATH . 'core/template/admin-footer.php';?>\r\n"], "fixing_code": ["<?php\r\ndefine('ROOT_PATH', realpath(dirname(__FILE__) . '/../../') . '/');\r\n\r\nrequire_once ROOT_PATH . 'core/template/header-admin.php';\r\n\r\n?>\r\n<?php require_once $_SERVER['DOCUMENT_ROOT'] . '/core/template/admin-menu-horizontal.php';?>\r\n  <button class=\"btn btn-primary position-fixed start-0 translate-middle-y d-md-none tools-settings\" type=\"button\" data-bs-toggle=\"offcanvas\" data-bs-target=\"#sidebarOffcanvas\" aria-controls=\"sidebarOffcanvas\">\r\n      <i class=\"fas fa-bars\"></i>\r\n  </button>\r\n <?php require_once  $_SERVER['DOCUMENT_ROOT'] . '/core/tools/sidebar.php';?>\r\n<div class=\"container-fluid mt-4 main-content admin-layout\">\r\n    <div class=\"row\">\r\n            <main role=\"main\" class=\"col-md-9 ml-sm-auto col-lg-10 px-4  content-up\">\r\n\r\n<?php   \r\n    $possible_rows = [5, 15, 45, 55, 75, 150, 250, 350]; // galimos eilu\u010di\u0173 reik\u0161m\u0117s\r\n    $records_per_page = isset($_GET['rows']) ? intval($_GET['rows']) : 5; // pasirinktos eilut\u0117s\r\n\r\n        $i = 1;\r\n                $page = isset($_GET['page']) ? (int)$_GET['page'] : 1;\r\n                $offset = ($page - 1) * $records_per_page;\r\n                $search_term = isset($_GET['search_term']) ? $_GET['search_term'] : '';\r\n            \r\n                $start = ($page - 1) * $records_per_page;\r\n\r\n                $posts = getAllPostsPagination($db, $prefix, $start, $records_per_page, $search_term);\r\n                $total_posts = countAllPosts($db, $prefix);\r\n                $total_pages = ceil($total_posts / $records_per_page);\r\n                $menuItems = getMenuItems($db, $prefix);\r\n                $menuItemsIndexed = array_column($menuItems, null, 'id');\r\n          ?>\r\n       \r\n            <div class=\"col-sm-9\">\r\n                <?php\r\n                if (isset($_SESSION['success_message'])) {\r\n                    echo \"<div class='alert alert-success alert-dismissible fade show slow-fade'>\r\n                        \" . htmlspecialchars($_SESSION['success_message']) . \"\r\n                        <button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>\r\n                    </div>\";\r\n                    unset($_SESSION['success_message']);\r\n                }\r\n\r\n                if (isset($_SESSION['error_message'])) {\r\n                    echo \"<div class='alert alert-danger alert-dismissible fade show slow-fade'>\r\n                        \" . htmlspecialchars($_SESSION['error_message']) . \"\r\n                        <button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>\r\n                    </div>\";\r\n                    unset($_SESSION['error_message']);\r\n                }\r\n                ?>\r\n            </div>\r\n            <h2><?php echo t(\"Posts on pages\");?></h2>\r\n            <button type=\"button\" class=\"btn btn-sm btn-primary\" onclick=\"loadPostForm('create')\" title=\"Add\">\r\n              <i class=\"fas fa-pencil\"></i>\r\n            </button>\r\n            <div class=\"col-md-12 mt-3\">\r\n                 <!-- I\u0161veda Puslapio redagavimo lang\u0105 -->\r\n            <div id=\"get-post-edit\"></div>\r\n               <div class=\"row\">\r\n                <div class=\"col-md-1\">\r\n                <form method=\"GET\" id=\"rows-form\">\r\n                <label for=\"rows\"><?php echo t(\"Per page:\");?></label>\r\n                <select name=\"rows\" class=\"form-select\" id=\"rows\" onchange=\"document.getElementById('rows-form').submit()\">\r\n                    <?php foreach($possible_rows as $rows): ?>\r\n                        <option value=\"<?php echo $rows; ?>\" <?php echo ($rows == $records_per_page ? 'selected' : ''); ?>>\r\n                            <?php echo $rows; ?>\r\n                        </option>\r\n                    <?php endforeach; ?>\r\n                </select>\r\n            </form>\r\n                </div>\r\n                <div class=\"col-md-9\">\r\n                <label for=\"search_term\"><?php echo t(\"Search for posts or pages\");?></label>\r\n                <div class=\"input-wrapper\">\r\n                     <input type=\"text\" id=\"search_term\" class=\"form-control search-input-long\" name=\"search_term\" placeholder=\"<?php echo t(\"Search post...\");?>\">\r\n                    <span id=\"clear-search\" class=\"clear-button\">&times;</span>\r\n                 </div>\r\n\r\n                </div>\r\n            \r\n          </div>\r\n        </div>\r\n         \r\n           \r\n            <table class=\"table\">\r\n                <thead>\r\n                    <tr>\r\n                        <th style=\"width: 3%;\"><?php echo t(\"No.\");?></th>\r\n                        <th style=\"width: 17%;\"><?php echo t(\"Title\");?></th>\r\n                        <th style=\"width: 40%;\"><?php echo t(\"Content\");?></th>\r\n                        <th style=\"width: 12%;\"><?php echo t(\"Page\");?></th>\r\n                        <th style=\"width: 3%;\"><i title=\"<?php echo t(\"Public\");?>\" class=\"fas fa-eye\"></i></th>\r\n                        <th style=\"width: 8%;\"><?php echo t(\"Author\");?></th>\r\n                        <th style=\"width: 10%;\"><?php echo t(\"Actions\");?></th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                <?php foreach ($posts as $post) { \r\n                        if (isset($menuItemsIndexed[$post['menu_id']])) {\r\n                            $post['menu_name'] = $menuItemsIndexed[$post['menu_id']]['name'];\r\n                        } else {\r\n                            $post['menu_name'] = '';\r\n                        }\r\n                     ?>\r\n                      <tr class=\"posts-row\" data-key=\"<?php echo htmlspecialchars($post['title']); ?>\" data-value=\"<?php echo htmlspecialchars($post['content']); ?>\" data-menu_name=\"<?php echo htmlspecialchars($post['menu_name']); ?>\">\r\n                           <td><?php echo $i++; ?>.</td>\r\n                            <td><?php echo htmlspecialchars($post['title']); ?></td>\r\n                            \r\n                            <td>\r\n                            <?php\r\n                                $content = htmlspecialchars_decode($post['content']);\r\n                                $content = preg_replace('/<img[^>]+>/i', '[image or file]', $content);\r\n                                $content = preg_replace('/<hr[^>]*>/i', '___', $content);\r\n\r\n                                // Pakei\u010diamas vis\u0173 nauj\u0173 eilu\u010di\u0173 simbolis \u012f tarp\u0105\r\n                                $content = str_replace(array(\"\\r\", \"\\n\"), ' ', $content);\r\n                                // Pa\u0161alinamos visos HTML \u017eymos\r\n                                $content = strip_tags($content);\r\n\r\n                                $max_length = 150;\r\n                                if (strlen($content) > $max_length) {\r\n                                    echo substr($content, 0, $max_length) . '...';\r\n                                } else {\r\n                                    echo $content;\r\n                                }\r\n                            ?>\r\n                            </td>\r\n                            <td><?php echo htmlspecialchars($post['menu_name']); ?></td>\r\n                            <td><?php  // View on page post\r\n                                        $menu_id = $post['menu_id'];\r\n                                        $menu_item = getMenuByMenuId($db, $prefix, $menu_id);\r\n                                        $page_url = $menu_item['page_url'];\r\n                                        $menuUrl = generateMenuUrl($db, $prefix, $page_url);\r\n                                     if ($post['status'] == 'published') {\r\n                                        echo '<a href=\"' . $menuUrl . '\">On</a>';\r\n                                    } elseif ($post['status'] == 'draft') {\r\n                                        echo 'Off';\r\n                                    }\r\n                                  ?></td>\r\n                            <td><?php echo htmlspecialchars($user_name); ?></td>\r\n                            <td>\r\n                                <button type=\"button\" class=\"btn btn-sm btn-primary\" onclick=\"loadPostEditForm(<?php echo $post['id']; ?>)\" title=\"<?php echo t(\"Edit\");?>\">\r\n                                    <i class=\"fas fa-edit\"></i>\r\n                                </button>\r\n\r\n                                <button type=\"button\" class=\"btn btn-sm btn-danger\" data-bs-toggle=\"modal\" data-bs-target=\"#confirmDeletePostModal\" data-post-id=\"<?php echo $post['id']; ?>\" title=\"<?php echo t(\"Delete\");?>\">\r\n                                    \r\n                                <i class=\"fas fa-trash-alt\"></i>\r\n                                </button>\r\n                            </td>\r\n                        </tr>\r\n                    <?php } ?>\r\n                </tbody>\r\n            </table>\r\n            <div class=\"d-flex justify-content-center mt-3\">\r\n            <nav aria-label=\"Page navigation\">\r\n            <ul class=\"pagination\">\r\n                <li class=\"page-item <?php echo ($page <= 1) ? 'disabled' : ''; ?>\">\r\n                    <a class=\"page-link\" href=\"?page=<?php echo $page - 1; ?>\" aria-label=\"Previous\">\r\n                    <span aria-hidden=\"true\">\u00ab</span>\r\n                     </a>\r\n                 </li>\r\n          <?php  $num_pages_to_display = 5;\r\n                 for ($i = max(1, $page - $num_pages_to_display); $i <= min($page + $num_pages_to_display, $total_pages); $i++): ?>\r\n                    <li class=\"page-item <?php echo ($i == $page) ? 'active' : ''; ?>\">\r\n                        <a class=\"page-link\" href=\"?page=<?php echo $i; ?>\"><?php echo $i; ?></a>\r\n                    </li>\r\n            <?php endfor; ?>\r\n                    <li class=\"page-item <?php echo ($page >= $total_pages) ? 'disabled' : ''; ?>\">\r\n                        <a class=\"page-link\" href=\"?page=<?php echo $page + 1; ?>\" aria-label=\"Next\">\r\n                        <span aria-hidden=\"true\">\u00bb</span>\r\n                        </a>\r\n                    </li>\r\n            </ul>\r\n        </nav>\r\n            </div>\r\n      \r\n      </main>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"modal fade\" id=\"confirmDeletePostModal\" tabindex=\"-1\" aria-labelledby=\"cconfirmDeletePostModalLabel\" aria-hidden=\"true\">\r\n  <div class=\"modal-dialog\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h5 class=\"modal-title\" id=\"confirmDeletePostModalLabel\"><?php echo t(\"Confirm deletion\");?></h5>\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n      <?php echo t(\"Are you sure you want to delete this post?\");?> \r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\"><?php echo t(\"Cancel\");?></button>\r\n        <button type=\"button\" class=\"btn btn-danger  delete-post-btn\" id=\"confirm-delete-post-btn\"><?php echo t(\"Delete\");?></button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<script>\r\n  function loadPostEditForm(postId) {\r\n    loadPostForm('edit', postId);\r\n  }\r\n \r\n  \r\n  function loadPostAddForm(postMenuId) {\r\n    loadPostForm('create', postMenuId);\r\n  }\r\n \r\n  \r\n document.querySelector('#search_term').addEventListener('input', function() {\r\n        if (this.value !== '') {\r\n            document.querySelector('#clear-search').style.display = 'block';\r\n        } else {\r\n            document.querySelector('#clear-search').style.display = 'none';\r\n        }\r\n });\r\n\r\n document.querySelector('#clear-search').addEventListener('click', function() {\r\n    var searchInput = document.querySelector('#search_term');\r\n    searchInput.value = '';\r\n    this.style.display = 'none';\r\n    var event = new Event('keyup');\r\n    searchInput.dispatchEvent(event);\r\n });\r\n \r\n $(document).ready(function() {\r\n    $('#search_term').on('keyup', function() {\r\n        var search_term = $(this).val().toLowerCase();\r\n\r\n        $('.posts-row').each(function() {\r\n            var key = $(this).data('key').toLowerCase();\r\n            var value = $(this).data('value').toLowerCase();\r\n            var menu_name = $(this).data('menu_name').toLowerCase();\r\n\r\n            if (key.includes(search_term) || value.includes(search_term) || menu_name.includes(search_term)) {\r\n                $(this).show();\r\n            } else {\r\n                $(this).hide();\r\n            }\r\n        });\r\n    });\r\n});\r\n\r\n   \r\n$('button[data-bs-target=\"#confirmDeletePostModal\"]').on('click', function () {\r\n    const postId = $(this).data('post-id');\r\n    $('#confirmDeletePostModal').data('post-id', postId);\r\n    $('#confirmDeletePostModal').modal('show');\r\n  });\r\n\r\n$('#confirm-delete-post-btn').on('click', function () {\r\n    const postId = $('#confirmDeletePostModal').data('post-id');\r\n    $.ajax({\r\n      type: 'POST',\r\n      url: 'delete_post.php',\r\n      data: {\r\n        action: 'delete_post',\r\n        post_id: postId\r\n      },\r\n      success: function(response) {\r\n        $('#confirmDeletePostModal').modal('hide');\r\n        window.location.href = 'posts.php';\r\n      },\r\n      error: function(jqXHR, textStatus, errorThrown) {\r\n        console.error(textStatus, errorThrown);\r\n      }\r\n    });\r\n  });\r\n\r\n</script>\r\n<?php\r\nif (isset($_GET['edit_post_id'])) {\r\n    $edit_post_id = filter_input(INPUT_GET, 'edit_post_id', FILTER_SANITIZE_NUMBER_INT);\r\n    $safe_edit_post_id = htmlspecialchars($edit_post_id, ENT_QUOTES, 'UTF-8');\r\n    echo \"<script>loadPostEditForm($safe_edit_post_id);</script>\";\r\n}\r\n\r\nif (isset($_GET['menu_id'])) {\r\n    $menu_id = filter_input(INPUT_GET, 'menu_id', FILTER_SANITIZE_NUMBER_INT);\r\n    $safe_menu_id = htmlspecialchars($menu_id, ENT_QUOTES, 'UTF-8');\r\n    echo \"<script>loadPostAddForm($safe_menu_id);</script>\";\r\n}\r\n\r\n?>\r\n<script src=\"js/admin-post-edit.js\"></script>\r\n\r\n<?php require_once ROOT_PATH . 'core/template/admin-footer.php';?>\r\n"], "filenames": ["core/tools/posts.php"], "buggy_code_start_loc": [275], "buggy_code_end_loc": [281], "fixing_code_start_loc": [275], "fixing_code_end_loc": [286], "type": "CWE-79", "message": "A vulnerability, which was classified as problematic, has been found in flusity CMS. This issue affects the function loadPostAddForm of the file core/tools/posts.php. The manipulation of the argument edit_post_id leads to cross site scripting. The attack may be initiated remotely. The exploit has been disclosed to the public and may be used. This product takes the approach of rolling releases to provide continious delivery. Therefore, version details for affected and updated releases are not available. The identifier of the patch is 6943991c62ed87c7a57989a0cb7077316127def8. It is recommended to apply a patch to fix this issue. The identifier VDB-243641 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2023-5810", "sourceIdentifier": "cna@vuldb.com", "published": "2023-10-27T01:15:32.317", "lastModified": "2024-02-29T01:42:27.413", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, has been found in flusity CMS. This issue affects the function loadPostAddForm of the file core/tools/posts.php. The manipulation of the argument edit_post_id leads to cross site scripting. The attack may be initiated remotely. The exploit has been disclosed to the public and may be used. This product takes the approach of rolling releases to provide continious delivery. Therefore, version details for affected and updated releases are not available. The identifier of the patch is 6943991c62ed87c7a57989a0cb7077316127def8. It is recommended to apply a patch to fix this issue. The identifier VDB-243641 was assigned to this vulnerability."}, {"lang": "es", "value": "Una vulnerabilidad clasificada como problem\u00e1tica fue encontrada en flusity CMS. Este problema afecta la funci\u00f3n loadPostAddForm del archivo core/tools/posts.php. La manipulaci\u00f3n del argumento edit_post_id conduce a cross site scripting. El ataque puede iniciarse de forma remota. El exploit ha sido divulgado al p\u00fablico y puede utilizarse. Este producto adopta el enfoque de lanzamientos continuos para proporcionar una entrega continua. Por lo tanto, los detalles de las versiones afectadas y actualizadas no est\u00e1n disponibles. El identificador del parche es 6943991c62ed87c7a57989a0cb7077316127def8. Se recomienda aplicar un parche para solucionar este problema. A esta vulnerabilidad se le asign\u00f3 el identificador VDB-243641."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 2.4, "baseSeverity": "LOW"}, "exploitabilityScore": 0.9, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:M/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "MULTIPLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.3}, "baseSeverity": "LOW", "exploitabilityScore": 6.4, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "cna@vuldb.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:flusity:flusity:*:*:*:*:*:*:*:*", "versionEndExcluding": "2023-10-24", "matchCriteriaId": "9989CEDF-D8FF-40B5-8E62-E4ABECFDBADC"}]}]}], "references": [{"url": "https://github.com/flusity/flusity-CMS/commit/6943991c62ed87c7a57989a0cb7077316127def8", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://github.com/flusity/flusity-CMS/issues/2", "source": "cna@vuldb.com", "tags": ["Exploit", "Issue Tracking", "Mitigation", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.243641", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.243641", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/flusity/flusity-CMS/commit/6943991c62ed87c7a57989a0cb7077316127def8"}}