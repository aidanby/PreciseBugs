{"buggy_code": ["<?php\r\n/*\r\nPlugin Name: A Forms\r\nPlugin URI: http://wordpress.org/extend/plugins/a-forms/\r\nDescription: Adds a contact form to your wordpress site.\r\n\r\nInstallation:\r\n\r\n1) Install WordPress 3.6 or higher\r\n\r\n2) Download the latest from:\r\n\r\nhttp://wordpress.org/extend/plugins/tom-m8te \r\n\r\nhttp://wordpress.org/extend/plugins/jquery-ui-theme \r\n\r\nhttp://wordpress.org/extend/plugins/a-forms\r\n\r\n3) Login to WordPress admin, click on Plugins / Add New / Upload, then upload the zip file you just downloaded.\r\n\r\n4) Activate the plugin.\r\n\r\nVersion: 1.4.2\r\nAuthor: TheOnlineHero - Tom Skroza\r\nLicense: GPL2\r\n*/\r\n\r\nrequire_once(\"a-form.php\");\r\nrequire_once(\"a-form-section.php\");\r\nrequire_once(\"a-form-fields.php\");\r\nrequire_once(\"a-forms-path.php\");\r\ninclude_once (dirname (__FILE__) . '/tinymce/tinymce.php'); \r\n\r\ndefine(__AFORMS_DEFAULT_LIMIT__, \"10\");\r\n\r\nfunction a_forms_activate() {\r\n  global $wpdb;\r\n\r\n  $a_form_forms_table = $wpdb->prefix . \"a_form_forms\";\r\n  $checktable = $wpdb->query(\"SHOW TABLES LIKE '$a_form_forms_table'\");\r\n  if ($checktable == 0) {\r\n\r\n    $sql = \"CREATE TABLE $a_form_forms_table (\r\n      ID mediumint(9) NOT NULL AUTO_INCREMENT, \r\n      form_name VARCHAR(255) DEFAULT '',\r\n      to_email VARCHAR(255) DEFAULT '',\r\n      to_cc_email VARCHAR(255) DEFAULT '',\r\n      to_bcc_email VARCHAR(255) DEFAULT '',\r\n      subject VARCHAR(255) DEFAULT '',\r\n      show_section_names tinyint(4) NOT NULL DEFAULT 1,\r\n      field_name_id mediumint(9), \r\n      field_email_id mediumint(9), \r\n      field_subject_id mediumint(9), \r\n      send_confirmation_email tinyint(4) NOT NULL DEFAULT 0,\r\n      confirmation_from_email VARCHAR(255) DEFAULT '',\r\n      success_message longtext DEFAULT '',\r\n      success_redirect_url VARCHAR(255) DEFAULT '',\r\n      include_captcha tinyint(4) NOT NULL DEFAULT 0,\r\n      tracking_enabled tinyint(4) NOT NULL DEFAULT 1,\r\n      created_at DATETIME,\r\n      updated_at DATETIME,\r\n      PRIMARY KEY  (ID),\r\n      UNIQUE (form_name)\r\n    )\";\r\n    $wpdb->query($sql); \r\n\r\n    $a_form_sections_table = $wpdb->prefix . \"a_form_sections\";\r\n    $sql = \"CREATE TABLE $a_form_sections_table (\r\n      ID mediumint(9) NOT NULL AUTO_INCREMENT, \r\n      section_name VARCHAR(255) DEFAULT '',\r\n      section_order mediumint(9) NOT NULL DEFAULT 0, \r\n      form_id mediumint(9) NOT NULL, \r\n      created_at DATETIME,\r\n      updated_at DATETIME,\r\n      PRIMARY KEY  (ID)\r\n    )\";\r\n    $wpdb->query($sql); \r\n\r\n    $a_form_fields_table = $wpdb->prefix . \"a_form_fields\";\r\n    $sql = \"CREATE TABLE $a_form_fields_table (\r\n      FID mediumint(9) NOT NULL AUTO_INCREMENT, \r\n      field_type VARCHAR(255) DEFAULT '',\r\n      field_label VARCHAR(255) DEFAULT '', \r\n      value_options VARCHAR(255) DEFAULT '',\r\n      field_order mediumint(9) NOT NULL DEFAULT 0, \r\n      validation VARCHAR(255) DEFAULT '',\r\n      file_ext_allowed VARCHAR(255) DEFAULT '',\r\n      form_id mediumint(9) NOT NULL,\r\n      section_id mediumint(9) NOT NULL,\r\n      created_at DATETIME,\r\n      updated_at DATETIME,\r\n      PRIMARY KEY  (FID)\r\n    )\";\r\n    $wpdb->query($sql);\r\n\r\n    $a_form_tracks_table = $wpdb->prefix . \"a_form_tracks\";\r\n    $sql = \"CREATE TABLE $a_form_tracks_table (\r\n      ID mediumint(9) NOT NULL AUTO_INCREMENT, \r\n      content longtext NOT NULL,\r\n      track_type VARCHAR(255) DEFAULT '',\r\n      form_id mediumint(9) NOT NULL,\r\n      referrer_url VARCHAR(255) DEFAULT '',\r\n      fields_array mediumtext DEFAULT '',\r\n      created_at DATETIME,\r\n      updated_at DATETIME,\r\n      PRIMARY KEY  (ID)\r\n    )\";\r\n    $wpdb->query($sql);\r\n\r\n  }\r\n\r\n  $checkcol = $wpdb->query(\"SHOW COLUMNS FROM '$a_form_forms_table' LIKE 'include_admin_in_emails'\");\r\n  if ($checkcol == 0) {\r\n    $sql = \"ALTER TABLE $a_form_forms_table ADD include_admin_in_emails VARCHAR(1)\";\r\n    $wpdb->query($sql); \r\n  }\r\n\r\n  $checkcol = $wpdb->query(\"SHOW COLUMNS FROM '$a_form_forms_table' LIKE 'captcha_type'\");\r\n  if ($checkcol == 0) {\r\n    $sql = \"ALTER TABLE $a_form_forms_table ADD captcha_type VARCHAR(1) DEFAULT '0'\";\r\n    $wpdb->query($sql); \r\n  }\r\n\r\n  if (!is_dir(get_template_directory().\"/aforms_css\")) {\r\n    aform_copy_directory(AFormsPath::normalize(dirname(__FILE__).\"/css\"), get_template_directory());  \r\n  } else {\r\n    add_option(\"aform_current_css_file\", \"default.css\");\r\n  }\r\n\r\n}\r\nregister_activation_hook( __FILE__, 'a_forms_activate' );\r\n\r\n//call register settings function\r\nadd_action( 'admin_init', 'register_a_forms_settings' );\r\nfunction register_a_forms_settings() {\r\n  register_setting( 'a-forms-settings-group', 'a_forms_admin_email' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_mail_host' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_smtp_auth' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_smtp_port' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_enable_tls' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_enable_ssl' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_smtp_username' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_smtp_password' );\r\n}\r\n\r\nfunction are_a_forms_dependencies_installed() {\r\n  return is_plugin_active(\"tom-m8te/tom-m8te.php\") && is_plugin_active(\"jquery-ui-theme/jquery-ui-theme.php\");\r\n}\r\n\r\nadd_action( 'admin_notices', 'a_forms_notice_notice' );\r\nfunction a_forms_notice_notice(){\r\n  $activate_nonce = wp_create_nonce( \"activate-a-forms-dependencies\" );\r\n  $tom_active = is_plugin_active(\"tom-m8te/tom-m8te.php\");\r\n  $jquery_ui_theme_active = is_plugin_active(\"jquery-ui-theme/jquery-ui-theme.php\");\r\n  if (!($tom_active && $jquery_ui_theme_active)) { ?>\r\n    <div class='updated below-h2'><p>Before you can use A Forms, please install/activate the following plugin(s):</p>\r\n    <ul>\r\n      <?php if (!$tom_active) { ?>\r\n        <li>\r\n          <a target=\"_blank\" href=\"http://wordpress.org/extend/plugins/tom-m8te/\">Tom M8te</a> \r\n           &#8211; \r\n          <?php if (file_exists(ABSPATH.\"/wp-content/plugins/tom-m8te/tom-m8te.php\")) { ?>\r\n            <a href=\"<?php echo(get_option(\"siteurl\")); ?>/wp-admin/?a_forms_install_dependency=tom-m8te&_wpnonce=<?php echo($activate_nonce); ?>\">Activate</a>\r\n          <?php } else { ?>\r\n            <a href=\"<?php echo(get_option(\"siteurl\")); ?>/wp-admin/plugin-install.php?tab=plugin-information&plugin=tom-m8te&_wpnonce=<?php echo($activate_nonce); ?>&TB_iframe=true&width=640&height=876\">Install</a> \r\n          <?php } ?>\r\n        </li>\r\n      <?php }\r\n      if (!$jquery_ui_theme_active) { ?>\r\n        <li>\r\n          <a target=\"_blank\" href=\"http://wordpress.org/extend/plugins/jquery-ui-theme/\">JQuery UI Theme</a>\r\n           &#8211; \r\n          <?php if (file_exists(ABSPATH.\"/wp-content/plugins/jquery-ui-theme/jquery-ui-theme.php\")) { ?>\r\n            <a href=\"<?php echo(get_option(\"siteurl\")); ?>/wp-admin/?a_forms_install_dependency=jquery-ui-theme&_wpnonce=<?php echo($activate_nonce); ?>\">Activate</a>\r\n          <?php } else { ?>\r\n            <a href=\"<?php echo(get_option(\"siteurl\")); ?>/wp-admin/plugin-install.php?tab=plugin-information&plugin=jquery-ui-theme&_wpnonce=<?php echo($activate_nonce); ?>&TB_iframe=true&width=640&height=876\">Install</a> \r\n          <?php } ?>\r\n        </li>\r\n      <?php } ?>\r\n    </ul>\r\n    </div>\r\n    <?php\r\n  }\r\n\r\n}\r\n\r\nadd_action( 'admin_init', 'register_a_forms_install_dependency_settings' );\r\nfunction register_a_forms_install_dependency_settings() {\r\n  if (isset($_GET[\"a_forms_install_dependency\"])) {\r\n    if (wp_verify_nonce($_REQUEST['_wpnonce'], \"activate-a-forms-dependencies\")) {\r\n      switch ($_GET[\"a_forms_install_dependency\"]) {\r\n        case 'jquery-ui-theme':\r\n          activate_plugin('jquery-ui-theme/jquery-ui-theme.php', 'plugins.php?error=false&plugin=jquery-ui-theme.php');\r\n          wp_redirect(get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms.php\");\r\n          exit();\r\n          break; \r\n        case 'tom-m8te':  \r\n          activate_plugin('tom-m8te/tom-m8te.php', 'plugins.php?error=false&plugin=tom-m8te.php');\r\n          wp_redirect(get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms.php\");\r\n          exit();\r\n          break;   \r\n        default:\r\n          throw new Exception(\"Sorry unable to install plugin.\");\r\n          break;\r\n      }\r\n    } else {\r\n      die(\"Security Check Failed.\");\r\n    }\r\n  }\r\n}\r\n\r\nadd_action('admin_menu', 'register_a_forms_page');\r\nfunction register_a_forms_page() {\r\n  if (are_a_forms_dependencies_installed()) {\r\n    add_menu_page('A Forms', 'A Forms', 'manage_options', 'a-forms/a-forms.php', 'a_form_initial_page');\r\n    add_submenu_page('a-forms/a-forms.php', 'Settings', 'Settings', 'manage_options', 'a-forms/a-forms-settings.php', 'a_form_settings_page');\r\n    add_submenu_page('a-forms/a-forms.php', 'Tracking', 'Tracking', 'manage_options', 'a-forms/a-forms-tracking.php', 'a_form_tracking_page');\r\n    add_submenu_page('a-forms/a-forms.php', 'Styling', 'Styling', 'update_themes', 'a-forms/a-forms-styling.php');\r\n  }\r\n}\r\n\r\nadd_action('wp_ajax_aform_css_file_selector', 'aform_css_file_selector');\r\nfunction aform_css_file_selector() {\r\n  if (are_a_forms_dependencies_installed()) {\r\n    update_option(\"aform_current_css_file\", esc_html($_POST[\"css_file_selection\"]));\r\n    echo(@file_get_contents(get_template_directory().\"/aforms_css/\".esc_html($_POST[\"css_file_selection\"])));\r\n  }\r\n  die();  \r\n}\r\n\r\nadd_action('wp_ajax_add_field_to_section', 'add_field_to_section');\r\nfunction add_field_to_section() {\r\n  global $wpdb;\r\n  $section = tom_get_row_by_id(\"a_form_sections\", \"*\", \"ID\", esc_html($_POST[\"section_id\"]));\r\n  tom_insert_record(\"a_form_fields\", array(\"field_order\" => esc_html($_POST[\"field_order\"]), \"section_id\" => esc_html($_POST[\"section_id\"]), \"form_id\" => $section->form_id));\r\n  echo $section->ID.\"::\".$wpdb->insert_id;\r\n  die();  \r\n}\r\n\r\n\r\nadd_action('wp_ajax_aforms_tinymce', 'aforms_tinymce');\r\n/**\r\n * Call TinyMCE window content via admin-ajax\r\n * \r\n * @since 1.7.0 \r\n * @return html content\r\n */\r\nfunction aforms_tinymce() {\r\n  if (are_a_forms_dependencies_installed()) {\r\n    // check for rights\r\n    if ( !current_user_can('edit_pages') && !current_user_can('edit_posts') ) \r\n      die(__(\"You are not allowed to be here\"));\r\n          \r\n    include_once( dirname( dirname(__FILE__) ) . '/a-forms/tinymce/window.php');\r\n    \r\n    die(); \r\n  } \r\n}\r\n\r\nfunction a_form_initial_page() {\r\n  wp_enqueue_script('jquery');\r\n  wp_enqueue_script('jquery-ui-sortable');\r\n\r\n  wp_register_script(\"a-forms\", plugins_url(\"/js/application.js\", __FILE__));\r\n  wp_enqueue_script(\"a-forms\");\r\n\r\n  wp_localize_script( 'a-forms', 'AFormsAjax', array(\r\n    \"ajax_url\" => admin_url('admin-ajax.php'),\r\n    \"base_url\" => get_option('siteurl').\"/wp-admin/admin.php?page=a-forms/a-forms.php\",\r\n    \"sort_section_url\" => get_option('siteurl').\"/wp-admin/admin.php?page=a-forms/a-forms.php&a_form_page=section_section_sort\",\r\n    \"sort_field_url\" => get_option('siteurl').\"/wp-admin/admin.php?page=a-forms/a-forms.php&a_form_page=section_field_sort\"\r\n  ));\r\n\r\n  wp_register_style(\"a-forms\", plugins_url(\"/admin_css/style.css\", __FILE__));\r\n  wp_enqueue_style(\"a-forms\");\r\n\r\n  // If you don't use Securimage and Tom M8te is not setup to use Securimage, then ...\r\n  if (get_option(\"include_securimage\") != \"1\" && !class_exists(\"Securimage\")) {\r\n    // Make Tom M8te use Securimage.\r\n    update_option(\"include_securimage\", \"1\");\r\n  } \r\n\r\n  if (esc_html(tom_get_query_string_value(\"a_form_page\")) == \"fields\") {\r\n    if (esc_html($_GET[\"action\"]) == \"delete\") {\r\n      AFormFields::delete();\r\n    }\r\n  }\r\n\r\n  if (tom_get_query_string_value(\"a_form_page\") == \"section\") {\r\n    a_form_section_page();\r\n  } else if (tom_get_query_string_value(\"a_form_page\") == \"section_section_sort\") {\r\n    tom_update_record_by_id(\"a_form_sections\", array(\"section_order\" => esc_html($_POST[\"section_order\"])), \"ID\", esc_html($_POST[\"ID\"]));\r\n    exit;\r\n  } else if (tom_get_query_string_value(\"a_form_page\") == \"section_field_sort\") {\r\n    tom_update_record_by_id(\"a_form_fields\", array(\"field_order\" => esc_html($_POST[\"field_order\"]), \"section_id\" => esc_html($_POST[\"section_id\"])), \"FID\", esc_html($_POST[\"FID\"]));\r\n    exit;\r\n  } else if (tom_get_query_string_value(\"a_form_page\") == \"create_field\") {\r\n\r\n    exit;\r\n  } else {\r\n    a_form_page();\r\n  }\r\n  ?>\r\n  <div class=\"clear\"></div>\r\n  <?php \r\n    tom_add_social_share_links(\"http://wordpress.org/extend/plugins/a-forms/\");\r\n}\r\n\r\nfunction a_form_page() {\r\n  if (tom_get_query_string_value(\"a_form_page\") != \"section\") {\r\n    if (isset($_POST[\"action\"])) {\r\n      $action = esc_html($_POST[\"action\"]);\r\n      if ($action == \"Update\") {\r\n        AForm::update();\r\n      }\r\n      if ($action == \"Create\") {\r\n        AForm::create();\r\n      }\r\n    }\r\n    if ($_GET[\"action\"] == \"delete\") {\r\n      AForm::delete();\r\n    }    \r\n  }\r\n  ?>\r\n  \r\n  <div class=\"wrap a-form\">\r\n  <h2>A Forms <a class=\"add-new-h2\" href=\"<?php echo(get_option('siteurl')); ?>/wp-admin/admin.php?page=a-forms/a-forms.php&action=new\">Add New Form</a></h2>\r\n  <?php\r\n\r\n  if (isset($_GET[\"message\"]) && $_GET[\"message\"] != \"\") {\r\n    echo(\"<div class='updated below-h2'><p>\".esc_html($_GET[\"message\"]).\"</p></div>\");\r\n  }\r\n\r\n  if (isset($_GET[\"action\"]) && $_GET[\"action\"] != \"delete\") {\r\n    if ($_GET[\"action\"] == \"edit\") {\r\n      // Display Edit Page\r\n      $a_form = tom_get_row_by_id(\"a_form_forms\", \"*\", \"ID\", esc_html($_GET[\"id\"])); ?>\r\n\r\n        <div class=\"postbox \" style=\"display: block; \">\r\n        <div class=\"inside\">\r\n          <form action=\"\" method=\"post\">\r\n            <?php AForm::render_admin_a_form_forms_form($a_form, \"Update\"); ?>\r\n          </form>\r\n        </div>\r\n        </div>\r\n\r\n    \r\n    <?php }\r\n\r\n    if (esc_html($_GET[\"action\"]) == \"new\") {\r\n      // Display New Page\r\n      ?>\r\n\r\n        <div class=\"postbox \" style=\"display: block; \">\r\n        <div class=\"inside\">\r\n          <form action=\"\" method=\"post\">\r\n            <?php \r\n\r\n            if (!isset($_POST[\"to_email\"])) {\r\n              $_POST[\"to_email\"] = get_option(\"admin_email\");\r\n            }\r\n            if (!isset($_POST[\"show_section_names\"])) {\r\n              $_POST[\"show_section_names\"] = \"1\";\r\n            }\r\n            if (!isset($_POST[\"tracking_enabled\"])) {\r\n              $_POST[\"tracking_enabled\"] = \"1\";\r\n            }\r\n\r\n            AForm::render_admin_a_form_forms_form(null, \"Create\"); ?>\r\n          </form>\r\n        </div>\r\n        </div>\r\n    <?php }\r\n\r\n  } else { ?>\r\n\r\n\r\n      <div class=\"postbox \" style=\"display: block; \">\r\n      <div class=\"inside\">\r\n        <?php\r\n\r\n        $forms = tom_get_results(\"a_form_forms\", \"*\", \"\");\r\n        if (count($forms) == 0) {\r\n          $url = get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms.php&action=new\";\r\n          tom_javascript_redirect_to($url, \"<p>Start by creating a form.</p>\");\r\n        } else {\r\n          tom_generate_datatable(\"a_form_forms\", array(\"ID\", \"form_name\", \"include_admin_in_emails\", \"to_email\", \"tracking_enabled\"), \"ID\", \"\", array(\"form_name ASC\"), __AFORMS_DEFAULT_LIMIT__, get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms.php\", false, true, true, true, true);   \r\n        }\r\n        ?>\r\n      </div>\r\n      </div>\r\n    <?php\r\n  }\r\n  ?>\r\n  </div>\r\n  <?php\r\n}\r\n\r\nfunction a_form_section_page() {\r\n  if (isset($_POST[\"action\"])) {\r\n    if ($_POST[\"action\"] == \"Update\") {\r\n      AFormSection::update();\r\n    }\r\n    if ($_POST[\"action\"] == \"Create\") {\r\n      AFormSection::create();\r\n    }\r\n  }\r\n  if ($_GET[\"action\"] == \"delete\") {\r\n    AFormSection::delete();\r\n  }\r\n\r\n  ?>\r\n  \r\n  <div class=\"wrap a-form\">\r\n  <h2>A Forms <a class=\"add-new-h2\" href=\"<?php echo(get_option('siteurl')); ?>/wp-admin/admin.php?page=a-forms/a-forms.php&action=new\">Add New Form</a></h2>\r\n  \r\n  <?php\r\n\r\n  if (isset($_GET[\"message\"]) && $_GET[\"message\"] != \"\") {\r\n    echo(\"<div class='updated below-h2'><p>\".esc_html($_GET[\"message\"]).\"</p></div>\");\r\n  }\r\n\r\n  if (isset($_GET[\"action\"]) && $_GET[\"action\"] != \"delete\") {\r\n    if ($_GET[\"action\"] == \"edit\") {\r\n      // Display Edit Page\r\n      $a_form = tom_get_row_by_id(\"a_form_sections\", \"*\", \"ID\", esc_html($_GET[\"id\"])); ?>\r\n      <div class=\"postbox \" style=\"display: block; \">\r\n      <div class=\"inside\">\r\n        <form action=\"\" method=\"post\">\r\n          <?php AFormSection::render_admin_a_form_sections_form($a_form, \"Update\"); ?>\r\n        </form>\r\n      </div>\r\n      </div>\r\n      </div>\r\n    <?php }\r\n\r\n    if (esc_html($_GET[\"action\"]) == \"new\") {\r\n      // Display New Page\r\n      ?>\r\n      <div class=\"postbox \" style=\"display: block; \">\r\n      <div class=\"inside\">\r\n        <form action=\"\" method=\"post\">\r\n          <?php AFormSection::render_admin_a_form_sections_form(null, \"Create\"); ?>\r\n        </form>\r\n      </div>\r\n      </div>\r\n      </div>\r\n    <?php }\r\n  }\r\n}\r\n\r\nfunction a_form_settings_page() { ?>\r\n  <div class=\"wrap\">\r\n  <h2>Settings</h2>\r\n  <div class=\"postbox \" style=\"display: block; \">\r\n  <div class=\"inside\">\r\n  <form method=\"post\" action=\"options.php\">\r\n    <?php settings_fields( 'a-forms-settings-group' ); ?>\r\n    <h3>Admin Settings</h3>\r\n    <table class=\"form-table\">\r\n      <tbody>\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_admin_email\">Admin Email:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"text\" id=\"a_forms_admin_email\" name=\"a_forms_admin_email\" value=\"<?php echo get_option('a_forms_admin_email'); ?>\" />\r\n            <span class=\"example\">e.g: admin@yourcompany.com.au</span>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n    <h3>SMTP Settings</h3>\r\n    <table class=\"form-table\">\r\n      <tbody>\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_mail_host\">Mail Host:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"text\" id=\"a_forms_mail_host\" name=\"a_forms_mail_host\" value=\"<?php echo get_option('a_forms_mail_host'); ?>\" />\r\n            <span class=\"example\">e.g: mail.yourdomain.com</span>\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_smtp_auth\">Enable SMTP Authentication:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"hidden\" name=\"a_forms_smtp_auth\" value=\"0\">\r\n            <input type=\"checkbox\" id=\"a_forms_smtp_auth\" name=\"a_forms_smtp_auth\" value=\"1\" <?php if (get_option('a_forms_smtp_auth')) {echo \"checked\";} ?> />\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_enable_tls\">Enable TLS:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"hidden\" name=\"a_forms_enable_tls\" value=\"0\">\r\n            <input type=\"checkbox\" id=\"a_forms_enable_tls\" name=\"a_forms_enable_tls\" value=\"1\" <?php if (get_option('a_forms_enable_tls')) {echo \"checked\";} ?> />\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_enable_ssl\">Enable SSL:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"hidden\" name=\"a_forms_enable_ssl\" value=\"0\">\r\n            <input type=\"checkbox\" id=\"a_forms_enable_ssl\" name=\"a_forms_enable_ssl\" value=\"1\" <?php if (get_option('a_forms_enable_ssl')) {echo \"checked\";} ?> />\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_smtp_port\">SMTP Port:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"text\" id=\"a_forms_smtp_port\" name=\"a_forms_smtp_port\" value=\"<?php echo get_option('a_forms_smtp_port'); ?>\" />\r\n            <span class=\"example\">e.g: 26</span>\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_smtp_username\">SMTP Username:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"text\" id=\"a_forms_smtp_username\" name=\"a_forms_smtp_username\" value=\"<?php echo get_option('a_forms_smtp_username'); ?>\" />\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_smtp_password\">SMTP Password:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"password\" id=\"a_forms_smtp_password\" name=\"a_forms_smtp_password\" value=\"<?php echo get_option('a_forms_smtp_password'); ?>\" />\r\n          </td>\r\n        </tr>\r\n    \r\n      </tbody>\r\n    </table>\r\n\r\n    <p class=\"submit\">\r\n      <input type=\"submit\" name=\"Submit\" value=\"Update Settings\">\r\n    </p>\r\n\r\n  </form>\r\n  </div>\r\n  </div>\r\n  </div>\r\n<?php\r\n  tom_add_social_share_links(\"http://wordpress.org/extend/plugins/a-forms/\");\r\n}\r\n\r\nfunction a_form_tracking_page() { \r\n  wp_enqueue_script('jquery');\r\n  wp_enqueue_script('jquery-ui-datepicker');\r\n  wp_register_script(\"a-forms\", plugins_url(\"/js/application.js\", __FILE__));\r\n  wp_enqueue_script('jquery-ui-sortable');\r\n  wp_enqueue_script(\"a-forms\");\r\n  wp_register_style(\"a-forms\", plugins_url(\"/admin_css/style.css\", __FILE__));\r\n  wp_enqueue_style(\"a-forms\");\r\n\r\n  wp_enqueue_style(\"jquery-ui-core\");\r\n  wp_enqueue_style(\"jquery-ui\");\r\n  wp_enqueue_style(\"jquery-ui-datepicker\");\r\n  ?>\r\n\r\n  <script language=\"javascript\">\r\n  jQuery(function() {\r\n    jQuery('.datepicker').datepicker({\r\n      dateFormat : 'yy-m-d',\r\n      showOn: \"button\",\r\n      buttonImage: \"<?php echo(plugins_url( '/images/calendar.gif', __FILE__ )); ?>\",\r\n      buttonImageOnly: true\r\n    });\r\n  });\r\n  </script>\r\n\r\n  <div class=\"wrap\">\r\n  <h2>Tracking</h2>\r\n  <?php if (esc_html(tom_get_query_string_value(\"id\")) != \"\") { \r\n    if (esc_html(tom_get_query_string_value(\"action\")) != \"view\") { ?>\r\n      <form action=\"\" method=\"post\">\r\n        <?php tom_add_form_field(null, \"text\", \"Search Text\", \"search_text\", \"search_text\", array(), \"p\", array()); ?>\r\n        <?php tom_add_form_field(null, \"text\", \"Date From\", \"search_date_from\", \"search_date_from\", array(\"class\" => \"datepicker\"), \"p\", array()); ?>\r\n        <?php tom_add_form_field(null, \"text\", \"Date To\", \"search_date_to\", \"search_date_to\", array(\"class\" => \"datepicker\"), \"p\", array()); ?>\r\n        <p><input type=\"submit\" name=\"action\" value=\"Search\" /></p>\r\n      </form>\r\n    <?php } ?>\r\n  <?php } ?>\r\n  <?php \r\n    if (!isset($_GET[\"action\"])) {\r\n      tom_generate_datatable(\"a_form_forms\", array(\"ID\", \"form_name\"), \"ID\", \"\", array(), \"30\", \"?page=a-forms/a-forms-tracking.php\", true, false, false, false, true, \"Y-m-d\", array()); \r\n    } else if ($_GET[\"action\"] == \"show\") {\r\n      $limit_clause = \"10\";\r\n      \r\n      $page_no = 0;\r\n      if (isset($_GET[\"a_form_tracks_page\"])) {\r\n        $page_no = esc_html($_GET[\"a_form_tracks_page\"]);\r\n      }\r\n      $offset = $page_no * $limit_clause;\r\n      $where_sql = \"form_id=\".esc_html($_GET[\"id\"]);\r\n      if (esc_html(tom_get_query_string_value(\"search_text\")) != \"\") {\r\n        $where_sql .= \" AND content LIKE '%\".esc_html($_POST[\"search_text\"]).\"%'\";\r\n      }\r\n\r\n      if ((esc_html(tom_get_query_string_value(\"search_date_from\")) != null) && (esc_html(tom_get_query_string_value(\"search_date_to\")) != null)) {\r\n        $where_sql .= \" AND (created_at BETWEEN '\".esc_html(tom_get_query_string_value(\"search_date_from\")).\" 00:00:00' AND '\".esc_html(tom_get_query_string_value(\"search_date_to\")).\" 23:59:59')\";\r\n      } else if (esc_html(tom_get_query_string_value(\"search_date_from\")) != null) {\r\n        $where_sql .= \" AND created_at > '\".esc_html(tom_get_query_string_value(\"search_date_from\")).\" 00:00:00'\";\r\n      } else if (esc_html(tom_get_query_string_value(\"search_date_to\")) != null) {\r\n        $where_sql .= \" AND created_at < '\".esc_html(tom_get_query_string_value(\"search_date_to\")).\" 23:59:59'\";\r\n      }\r\n\r\n      $tracks = tom_get_results(\"a_form_tracks\", \"*\", $where_sql, array(\"created_at DESC\"), \"$limit_clause OFFSET $offset\");\r\n      $fields = tom_get_results(\"a_form_fields\", \"*\", \"form_id=\".esc_html($_GET[\"id\"]), array());\r\n      \r\n      $total_tracks = count(tom_get_results(\"a_form_tracks\", \"*\", $where_sql, array(\"created_at DESC\")));\r\n\r\n      if ($total_tracks > 0) {\r\n        tom_generate_datatable_pagination(\"a_form_tracks\", $total_tracks, $limit_clause, esc_html($_GET[\"a_form_tracks_page\"]), \"?page=a-forms/a-forms-tracking.php&action=show&id=\".esc_html($_GET[\"id\"]).\"&search_text=\".esc_html(tom_get_query_string_value(\"search_text\")).\"&search_date_from=\".esc_html(tom_get_query_string_value(\"search_date_from\")).\"&search_date_to=\".esc_html(tom_get_query_string_value(\"search_date_to\")), \"ASC\", \"top\");\r\n      ?>\r\n        <table id=\"tracking\">\r\n          <thead>\r\n            <tr>\r\n              <td>ID</td>\r\n              <?php           \r\n                foreach ($fields as $field) {\r\n                  echo(\"<th>\".$field->field_label.\"</th>\");\r\n                }\r\n              ?>\r\n              <th>Referrer URL</th>\r\n              <th>Date Sent</th>\r\n              <th>View Form</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <?php foreach ($tracks as $track) {\r\n              $fields_array = unserialize($track->fields_array); \r\n              echo(\"<tr><td>\".$track->ID.\"</td>\");\r\n              foreach ($fields as $field) {\r\n                $content = $fields_array[str_replace(\" \", \"_\", strtolower($field->field_label))];\r\n                echo(\"<td>\");\r\n                if ($content != \"\" && $field->field_type == \"file\") {\r\n                  echo(\"<a href='\".get_option(\"siteurl\").\"/wp-content/plugins/tom-m8te/tom-download-file.php?file=\".$content.\"'>download</a>\");\r\n                } else {\r\n                  echo(preg_replace(\"/, $/\", \"\", $content));\r\n                }\r\n                echo(\"</td>\");\r\n              }\r\n\r\n              echo(\"<td>\".$track->referrer_url.\"</td>\");\r\n              echo(\"<td>\".gmdate(\"Y-m-d H:i:s\", strtotime($track->created_at )).\" GMT</td>\");\r\n              echo(\"<td><a href='\".\r\nget_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms-tracking.php&action=view&id=\".$track->ID.\"'>View</a></td>\");\r\n              echo(\"</tr>\");\r\n            }?>\r\n          </tbody>\r\n        </table>\r\n        <?php\r\n        tom_generate_datatable_pagination(\"a_form_tracks\", $total_tracks, $limit_clause, $_GET[\"a_form_tracks_page\"], \"?page=a-forms/a-forms-tracking.php&action=show&id=\".$_GET[\"id\"], \"ASC\", \"bottom\");\r\n      } else {\r\n        echo(\"<p>No records found!</p>\");\r\n      }\r\n    } else if ($_GET[\"action\"] == \"view\") {\r\n      $view = tom_get_row_by_id(\"a_form_tracks\", \"*\", \"ID\", $_GET[\"id\"]);\r\n      echo \"<p><textarea rows='40' cols='160'>\".$view->content.\"</textarea></p>\";\r\n      echo(\"<p><a href='\".get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms-tracking.php&action=show&id=\".$view->form_id.\"'>Back</a></p>\");\r\n    }\r\n    \r\n  ?>\r\n  </div>\r\n  <?php\r\n  tom_add_social_share_links(\"http://wordpress.org/extend/plugins/a-forms/\");\r\n}\r\n\r\nadd_shortcode( 'a-form', 'a_form_shortcode' );\r\n\r\nfunction a_form_shortcode($atts) {\r\n  if (is_plugin_active(\"tom-m8te/tom-m8te.php\") && is_plugin_active(\"jquery-ui-theme/jquery-ui-theme.php\")) {\r\n\r\n    $nonce_passed = true;\r\n    $return_content = \"\";\r\n    $email_content = \"\";\r\n    $validation_array = array();\r\n    $from_email = get_option(\"admin_email\");\r\n    $current_datetime = gmdate( 'Y-m-d H:i:s');\r\n\r\n    $form = tom_get_row_by_id(\"a_form_forms\", \"*\", \"ID\", $atts[\"id\"]);\r\n    $sections = tom_get_results(\"a_form_sections\", \"*\", \"form_id='\".$atts[\"id\"].\"'\", array(\"section_order ASC\"));\r\n\r\n    $form_name = \"a_form_\".str_replace(\" \", \"_\", strtolower($form->form_name)).\"_\";\r\n\r\n    $form_valid = true;\r\n    $section_index = 0;\r\n\r\n    if (isset($_POST[\"send_a_form_section\"])) {\r\n      $section_index = esc_html($_POST[\"send_a_form_section\"]);\r\n    } else {\r\n      $section_index = 0;\r\n    }\r\n\r\n    // Get this section.\r\n    $section = $sections[$section_index];\r\n\r\n    // Add validation for this section only.\r\n    $fields = tom_get_results(\"a_form_fields\", \"*\", \"section_id='\".$section->ID.\"'\");\r\n    foreach ($fields as $field) {\r\n      $field_name = str_replace(\" \", \"_\", strtolower($field->field_label));\r\n      $validation_array[$form_name.$field_name] = $field->validation;\r\n    }\r\n\r\n    // Check to see if User submits a form action.\r\n    if (isset($_POST[\"send_a_form\"]) && ($atts[\"id\"] == $_POST[\"send_a_form\"])) {\r\n\r\n      foreach ($_POST as $key => $value) {\r\n        $_POST[$key] = esc_attr(esc_html($value));\r\n      }\r\n\r\n      // User has submitted an aform.\r\n      $captcha_valid = true;\r\n      $form_valid = tom_validate_form($validation_array);\r\n\r\n      $field_values = array();\r\n      $attachment_urls = array();\r\n\r\n      if (isset($_POST[\"a_form_attachment_urls\"]) && $_POST[\"a_form_attachment_urls\"] != \"\") {\r\n        $attachment_urls = explode(\"::\", esc_html($_POST[\"a_form_attachment_urls\"]));\r\n      }\r\n\r\n      // Construct email content.\r\n      $all_fields = tom_get_results(\"a_form_fields\", \"*\", \"form_id='\".$atts[\"id\"].\"'\");\r\n      foreach ($all_fields as $field) {\r\n        $field_name = str_replace(\" \", \"_\", strtolower($field->field_label));\r\n\r\n        if ($field->field_type == \"checkbox\") {\r\n          $i = 0;\r\n          $email_content .= $field->field_label.\": \";\r\n          $answers = \"\";\r\n          foreach (explode(\",\", $field->value_options) as $key) {\r\n            if (esc_html($_POST[$form_name.$field_name.\"_\".$i]) != \"\") {\r\n              $content = str_replace('\\\"', \"\\\"\", esc_html($_POST[$form_name.$field_name.\"_\".$i]));\r\n              $content = str_replace(\"\\'\", '\\'', $content);\r\n              $answers .= $content.\", \";\r\n            }\r\n            $i++;\r\n          }\r\n          $email_content .= preg_replace(\"/, $/\", \"\", $answers);\r\n          $email_content .= \"\\n\\n\";\r\n          $field_values[$field_name] = $answers;\r\n        } else if ($field->field_type == \"file\") {\r\n          // Upload file.\r\n\r\n          try {\r\n            $filedst = AForm::upload_file($form_name.$field_name, $field->file_ext_allowed);\r\n            array_push($attachment_urls, $form_name.$field_name.\"=>\".$filedst);\r\n          } catch(Exception $ex) {\r\n            $form_valid = false;\r\n            $_SESSION[$form_name.$field_name.\"_error\"] = $ex->getMessage();\r\n          }\r\n          \r\n          if ($filedst != \"\") {\r\n            $field_values[$field_name] = $filedst;\r\n          } else {\r\n            if (esc_html($_POST[\"a_form_attachment_urls\"]) != \"\") {\r\n              $records = explode(\"::\", esc_html($_POST[\"a_form_attachment_urls\"]));\r\n              foreach ($records as $record) {\r\n                $key_value = explode(\"=>\", $record);\r\n                if ($key_value[0] == $form_name.$field_name && $key_value[1] != \"\") {\r\n                  $field_values[$field_name] = $key_value[1];\r\n                }\r\n              }\r\n            }\r\n          }\r\n          \r\n        } else {\r\n          $content = str_replace('\\\"', \"\\\"\", esc_html($_POST[$form_name.$field_name]));\r\n          $content = str_replace(\"\\'\", '\\'', $content);\r\n          $email_content .= $field->field_label.\": \".$content.\"\\n\\n\";\r\n          $field_values[$field_name] = $content;\r\n        }\r\n        \r\n      }\r\n\r\n      // Check to see if the user has clicked the Send button and check to see if the form is using a captcha.\r\n      if (isset($_POST[\"action\"]) && $_POST[\"action\"] == \"Send\" && isset($_POST[$form_name.\"captcha\"]) && $form->include_captcha) {\r\n\r\n        // User clicked on Send button and the form has a captcha.\r\n        // Check the type of captcha.\r\n        if ($form->captcha_type == \"0\") {\r\n          // Form is using the Securimage Captcha.\r\n          $captcha_valid = tom_check_captcha($form_name.\"captcha\");\r\n        } else {\r\n          // Form is using the Math Captcha.\r\n\r\n          // Check that the answer is first number plus second number.\r\n          $captcha_valid = \r\n          (\r\n            (\r\n              esc_html($_POST[aform_field_name($form, \"captcha_first_number\")]) \r\n              + \r\n              esc_html($_POST[aform_field_name($form, \"captcha_second_number\")])\r\n            ) \r\n            == esc_html($_POST[aform_field_name($form, \"captcha\")])\r\n          );\r\n\r\n          // Check to see if captcha is valid.\r\n          if ($captcha_valid == false) {\r\n            // Captcha is invalid, so display error message.\r\n            $_SESSION[\"a_form_\".str_replace(\" \", \"_\", strtolower($form->form_name)).\"_captcha_error\"] = \"invalid captcha code, try again!\";\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Check to see if form is valid.\r\n      $nonce_passed = wp_verify_nonce($_REQUEST[\"_wpnonce\"], \"a-forms-contact-a-form\");\r\n      if ($nonce_passed && $form_valid && $captcha_valid) {\r\n        // Form is valid.\r\n        if (esc_html($_POST[\"action\"]) == \"Send\") {\r\n          // User clicked Send, so since form is valid and they click Send, send the email.\r\n\r\n          $subject = $form->subject;\r\n          $from_name = \"\";\r\n          $user_email = \"\";\r\n          if ($form->field_name_id != \"\") {\r\n            $row = tom_get_row_by_id(\"a_form_fields\", \"*\", \"FID\", $form->field_name_id);\r\n            $from_name = esc_html($_POST[$form_name.str_replace(\" \", \"_\", strtolower($row->field_label))]);\r\n          }\r\n          if ($form->field_email_id != \"\") {\r\n            $row = tom_get_row_by_id(\"a_form_fields\", \"*\", \"FID\", $form->field_email_id);\r\n            $user_email = esc_html($_POST[$form_name.str_replace(\" \", \"_\", strtolower($row->field_label))]);\r\n          }\r\n          if ($form->field_subject_id != \"\") {\r\n            $row = tom_get_row_by_id(\"a_form_fields\", \"*\", \"FID\", $form->field_subject_id);\r\n            if (isset($_POST[$form_name.str_replace(\" \", \"_\", strtolower($row->field_label))])) {\r\n              $subject .= \" - \".esc_html($_POST[$form_name.str_replace(\" \", \"_\", strtolower($row->field_label))]);\r\n            }\r\n          }\r\n\r\n          if ($form->confirmation_from_email != \"\") {\r\n            $from_email = $form->confirmation_from_email;\r\n          }\r\n\r\n          // Send Email.\r\n          $cc_emails = $form->to_cc_email;\r\n          if ($user_email != \"\" && $form->send_confirmation_email) {\r\n            if ($cc_emails == \"\") {\r\n              $cc_emails .= $user_email;\r\n            } else {\r\n              $cc_emails .= \", \".$user_email;\r\n            }\r\n          }\r\n          if ($cc_emails == \"\") {\r\n            $cc_emails .= $from_email;\r\n          } else {\r\n            $cc_emails .= \", \".$from_email;\r\n          }\r\n\r\n          // Rip up $attachment_urls so we're left with only the paths to the files uploaded.\r\n          $smtp_attachment_urls = array();\r\n          foreach ($attachment_urls as $attach_url) {\r\n            $temp = explode(\"=>\", $attach_url);\r\n            array_push($smtp_attachment_urls, $temp[1]);\r\n          }\r\n\r\n          $secure_algorithms = array();\r\n          if (get_option(\"a_forms_enable_tls\")) {\r\n            $secure_algorithms[\"tls\"] = \"tls\";\r\n          }\r\n          if (get_option(\"a_forms_enable_ssl\")) {\r\n            $secure_algorithms[\"ssl\"] = \"ssl\";\r\n          }\r\n\r\n          $mail_message = tom_send_email(false, get_option(\"a_forms_admin_email\").\", \".$form->to_email, $cc_emails, $form->to_bcc_email, $from_email, $from_name, $subject, $email_content, \"\", $smtp_attachment_urls, get_option(\"a_forms_smtp_auth\"), get_option(\"a_forms_mail_host\"), get_option(\"a_forms_smtp_port\"), get_option(\"a_forms_smtp_username\"), get_option(\"a_forms_smtp_password\"), $secure_algorithms);        \r\n          \r\n          if ($mail_message == \"<div class='success'>Message sent!</div>\") {\r\n\r\n            if ($form->success_message != \"\") {\r\n              $mail_message = \"<div class='success'>\".$form->success_message.\"</div>\";\r\n            }\r\n\r\n            if ($form->tracking_enabled) {\r\n              tom_insert_record(\"a_form_tracks\", array(\"created_at\" => $current_datetime, \"form_id\" => esc_html($_POST[\"send_a_form\"]), \"content\" => $email_content, \"track_type\" => \"Successful Email\", \"referrer_url\" => $_SERVER[\"HTTP_REFERER\"], \"fields_array\" => serialize($field_values)));  \r\n            }        \r\n\r\n            if ($form->success_redirect_url != \"\") {\r\n              tom_javascript_redirect_to($form->success_redirect_url, \"<p>Please <a href='$url'>Click Next</a> to continue.</p>\");\r\n            }\r\n\r\n          } else {\r\n            if ($form->tracking_enabled) {\r\n              tom_insert_record(\"a_form_tracks\", array(\"created_at\" => $current_datetime, \"form_id\" => esc_html($_POST[\"send_a_form\"]), \"content\" => \"Error Message: \".$mail_message.\".\\n\\nContent: \".$email_content, \"track_type\" => \"Failed Email\", \"referrer_url\" => $_SERVER[\"HTTP_REFERER\"], \"fields_array\" => serialize($field_values)));\r\n            }\r\n          }          \r\n\r\n          $return_content .= $mail_message;\r\n        }\r\n      } else {\r\n\r\n        // Check to see if the input field values are valid, but not the wpnonce value.\r\n        if ($form_valid && $captcha_valid && $nonce_passed == false) {\r\n          // The input field values are valid except the wpnonce value. Therefore there must have been a cross site spam attack. So display fail send email message.\r\n          $return_content .= \"<div class='a-form error'>Failed to send your message. Please try again later.</div>\";\r\n        }\r\n        $form_valid = false;\r\n\r\n      }\r\n\r\n    }\r\n    \r\n    $aform_form_nonce = wp_create_nonce( \"a-forms-contact-a-form\" );\r\n    $return_content .= \"<form action='' id='\".str_replace(\" \", \"_\", strtolower($form->form_name)).\"' method='post' class='a-form' enctype='multipart/form-data'>\";\r\n\r\n    $return_content .= \"<input type='hidden' name='_wpnonce' value='\".$aform_form_nonce.\"'/>\";\r\n    $return_content .= \"<fieldset>\";\r\n    // Get next section\r\n    if (esc_html($_POST[\"action\"]) == \"Next\") {\r\n      if ($form_valid) {\r\n        $section_index++;\r\n      } \r\n    }\r\n\r\n    // Get previous section.\r\n    if (esc_html($_POST[\"action\"]) == \"Back\") {\r\n      $section_index--;\r\n    }\r\n\r\n    $section = $sections[$section_index];\r\n\r\n    // Navigate through all the other sections and make all fields hidden.\r\n    $hidden_fields = tom_get_results(\"a_form_fields\", \"*\", \"form_id = '\".$atts[\"id\"].\"' AND section_id <> '\".$section->ID.\"'\");\r\n    foreach ($hidden_fields as $field) {\r\n      $field_name = str_replace(\" \", \"_\", strtolower($field->field_label));\r\n      ob_start();\r\n      \r\n      if ($field->field_type == \"checkbox\") {\r\n        $i = 0;\r\n        foreach (explode(\",\", $field->value_options) as $key) {\r\n          tom_add_form_field(null, \"hidden\", $field->field_label, $form_name.$field_name.\"_\".$i, $form_name.$field_name.\"_\".$i, array(), \"p\", array(), array());  \r\n          $i++;\r\n        }\r\n      } else {\r\n\r\n        tom_add_form_field(null, \"hidden\", $field->field_label, $form_name.$field_name, $form_name.$field_name, array(), \"p\", array(), array());\r\n        \r\n      }\r\n      \r\n      $return_content .= ob_get_contents();\r\n      ob_end_clean();\r\n    }\r\n\r\n    $input_attachment_urls = \"\";\r\n\r\n    if (count($attachment_urls) > 0) {\r\n      $attachment_urls = array_filter( $attachment_urls, 'strlen' );\r\n      $input_attachment_urls = implode(\"::\", str_replace(\"\\\\\\\\\", '\\\\', $attachment_urls));\r\n    }\r\n\r\n    $return_content .= \"<input type='hidden' name='a_form_attachment_urls' value='\".$input_attachment_urls.\"' />\";\r\n\r\n    $fields = tom_get_results(\"a_form_fields\", \"*\", \"section_id='\".$section->ID.\"'\", array(\"field_order ASC\"));\r\n\r\n    // Render form fields.\r\n    if ($form->show_section_names) {\r\n      $return_content .= \"<legend>\".$section->section_name.\"</legend>\";\r\n    }\r\n\r\n    foreach ($fields as $field) {\r\n      $field_name = str_replace(\" \", \"_\", strtolower($field->field_label));\r\n      $value_options = array();\r\n      if ($field->value_options != \"\") {\r\n        $options = explode(\",\", $field->value_options);\r\n        foreach($options as $option_with_label) {\r\n          $temp_array = explode(\":\", $option_with_label);\r\n          $option = $temp_array[1];\r\n          $value = $temp_array[0];\r\n          if ($option == \"\") {\r\n            $option = $value;\r\n          }\r\n          $value_options[$option] = $value;\r\n        }\r\n      }\r\n      $field_label = $field->field_label;\r\n      if (preg_match(\"/required/\",$validation_array[$form_name.$field_name])) {\r\n        $field_label .= \"<abbr title='required'>*</abbr>\";\r\n      }\r\n\r\n      ob_start();\r\n      if ($field->field_type == \"file\" && $field->file_ext_allowed != \"\") {\r\n        echo(\"<div>\");\r\n      } \r\n      $error_class = \"\";\r\n      if (isset($_SESSION[$form_name.$field_name.\"_error\"])) {\r\n        $error_class = \"error\";\r\n      }\r\n      tom_add_form_field(null, $field->field_type, $field_label, $form_name.$field_name, $form_name.$field_name, array(\"class\" => $field->field_type), \"div\", array(\"class\" => $error_class), $value_options);\r\n      if ($field->field_type == \"file\" && $field->file_ext_allowed != \"\") {\r\n        $extensions_allowed = $field->file_ext_allowed;\r\n        $extensions_allowed = preg_replace('/(\\s)+/',' ', $extensions_allowed);\r\n        $extensions_allowed = preg_replace('/(\\s)+$/', '', $extensions_allowed);\r\n        $extensions_allowed = preg_replace('/(\\s)/', ', ', $extensions_allowed);\r\n        $extensions_allowed = preg_replace('/ \\.([a-z|A-Z])*$/', ' and $0', $extensions_allowed);\r\n        $extensions_allowed = preg_replace('/,(\\s)+and/', ' and', $extensions_allowed);\r\n        echo(\"<span class='file-ext-allowed'>Can only accept: \".$extensions_allowed.\"</span>\");\r\n        echo(\"</div>\");\r\n      }\r\n\r\n      $return_content .= ob_get_contents();\r\n      ob_end_clean();\r\n    }\r\n    \r\n    $return_content .= \"</fieldset><fieldset class='submit'><div><input type='hidden' name='send_a_form_section' value='\".$section_index.\"' /><input type='hidden' name='send_a_form' value='\".$atts[\"id\"].\"' />\";\r\n\r\n    // Add action buttons\r\n    // Check if more then one section\r\n    if (count($sections) > 1) {\r\n      // There is more then one section.\r\n\r\n      if (($section_index+1) == count($sections)) {\r\n        // Looking at the last section.\r\n        $return_content .= render_a_form_submit_html($form);\r\n      } else {\r\n        // Not looking at the last section.\r\n        $return_content .= \"<input type='submit' name='action' value='Next' class='next'/>\";\r\n      }\r\n\r\n    } else {\r\n      // Only one section.\r\n      $return_content .= render_a_form_submit_html($form);\r\n    }\r\n\r\n    // Check which section your currently looking at.\r\n    if ($section_index > 0) {\r\n      // Not looking at the first section.\r\n      $return_content .= \"<input type='submit' name='action' value='Back' class='prev'/>\";\r\n    }\r\n\r\n    return $return_content.\"</div></fieldset></form>\";\r\n\r\n  }\r\n}\r\n\r\nfunction render_a_form_submit_html($form) {\r\n  $return_content = \"\";\r\n  if ($form->include_captcha) {\r\n    ob_start();\r\n    if ($form->captcha_type == \"0\") {\r\n\r\n      tom_add_form_field(null, \"captcha\", \"Captcha\", aform_field_name($form, \"captcha\"), aform_field_name($form, \"captcha\"), array(), \"div\", array(\"class\" => \"captcha\"));\r\n\r\n    } else {\r\n\r\n      $first_number = $_POST[aform_field_name($form, \"captcha_first_number\")] = rand(1, 20);\r\n      $second_number = $_POST[aform_field_name($form, \"captcha_second_number\")] = rand(1, 20);\r\n\r\n      tom_add_form_field(null, \"hidden\", \"First number\", aform_field_name($form, \"captcha_first_number\"), \r\n        aform_field_name($form, \"captcha_first_number\")\r\n        , array(), \"div\", array());\r\n      tom_add_form_field(null, \"hidden\", \"Second number\", aform_field_name($form, \"captcha_second_number\"), aform_field_name($form, \"captcha_second_number\"), array(), \"div\", array());\r\n\r\n      tom_add_form_field(null, \"text\", \"What is \".$first_number.\" + \".$second_number, aform_field_name($form, \"captcha\"), aform_field_name($form, \"captcha\"), array(), \"div\", array(\"class\" => \"captcha\"));\r\n    }\r\n    $return_content .= ob_get_contents();\r\n    ob_end_clean();\r\n  }\r\n  $return_content .= \"<input type='submit' name='action' value='Send' class='send'/>\";\r\n  return $return_content;\r\n}\r\n\r\nadd_action('wp_head', 'add_a_forms_js_and_css');\r\nfunction add_a_forms_js_and_css() { \r\n  wp_enqueue_script('jquery');\r\n\r\n  wp_register_script(\"a-forms\", plugins_url(\"/js/application.js\", __FILE__));\r\n  wp_enqueue_script(\"a-forms\");\r\n\r\n  wp_register_style(\"a-forms\", get_template_directory_uri().'/aforms_css/'.get_option(\"aform_current_css_file\"));\r\n  wp_enqueue_style(\"a-forms\");\r\n} \r\n\r\nfunction aform_field_name($form, $field_name) {\r\n  return \"a_form_\".str_replace(\" \", \"_\", strtolower($form->form_name)).\"_\".$field_name;\r\n}\r\n\r\n// Copy directory to another location.\r\nfunction aform_copy_directory($src,$dst) { \r\n    $dir = opendir($src); \r\n    try{\r\n        @mkdir($dst); \r\n        while(false !== ( $file = readdir($dir)) ) { \r\n            if (( $file != '.' ) && ( $file != '..' )) { \r\n                if ( is_dir($src . '/' . $file) ) { \r\n                    aform_copy_directory($src . '/' . $file,$dst . '/' . $file); \r\n                } else { \r\n                    copy($src . '/' . $file,$dst . '/' . $file);\r\n                } \r\n            }   \r\n        }\r\n        closedir($dir); \r\n    } catch(Exception $ex) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n?>", "=== A Forms ===\r\nContributors: MMDeveloper\r\nDonate link: \r\nTags: form, contact, plugin\r\nRequires at least: 3.3\r\nTested up to: 3.6\r\nStable tag: 1.4.2\r\nLicense: GPLv2 or later\r\nLicense URI: http://www.gnu.org/licenses/gpl-2.0.html\r\n\r\nCreate easy contact forms.\r\n\r\n== Description ==\r\n\r\nA wordpress plugin that allows you to add a form on your website.\r\n\r\n== Installation ==\r\n\r\n1) Install WordPress 3.6 or higher\r\n\r\n2) Download the latest from:\r\n\r\nhttp://wordpress.org/extend/plugins/tom-m8te \r\n\r\nhttp://wordpress.org/extend/plugins/jquery-ui-theme \r\n\r\nhttp://wordpress.org/extend/plugins/a-forms\r\n\r\n3) Login to WordPress admin, click on Plugins / Add New / Upload, then upload the zip file you just downloaded.\r\n\r\n4) Activate the plugin.\r\n\r\n\r\n== Changelog ==\r\n\r\n= 1.4.2 =\r\n\r\n* Fixed another issue with critical cross-site scripting.\r\n\r\n= 1.4.1 =\r\n\r\n* Fixed up critical cross-site scripting vulnerability. \r\n\r\n= 1.4.0 =\r\n\r\n* Able to use Math generated captcha as well as Securimage Captcha.\r\n\r\n= 1.3.3 =\r\n\r\n* Able to now use algorithms such as SSL or TLS security algorithms when sending out emails.\r\n\r\n= 1.3.2 =\r\n\r\n* Found bugs where you have two or more A Forms on the same page and it didn't know which validation belonged to which form, this has now been fixed.\r\n\r\n= 1.3.1 =\r\n\r\n* Found that if you put quotes in the email, it would display them incorrectly. There were major issues with displaying the form information on the site, so I changed how to present information on the tracking screen.\r\n\r\n= 1.3.0 =\r\n\r\n* Changed how the dependency plugin code works. Fixed the from email address not showing the correct email.\r\n\r\n= 1.2.4 =\r\n\r\n* Added social share links to the bottom of all admin pages.\r\n\r\n= 1.2.3 =\r\n\r\n* Fixed a div issue and added ability to reset stylesheet.\r\n\r\n= 1.2.2 =\r\n\r\n* Fixed up css issues. Added search facility with tracking.\r\n\r\n= 1.2.1 =\r\n\r\n* When you activate, don't print useless warning error messages to the log.\r\n\r\n= 1.2 =\r\n\r\n* Improved code with styles. Updated admin GUI. Updated tracking page.\r\n\r\n= 1.1 =\r\n\r\n* Fixed section issue.\r\n\r\n= 1.0 =\r\n\r\n* Initial Commit\r\n\r\n== Upgrade notice ==\r\n\r\n= 1.4.2 =\r\n\r\n* Fixed another issue with critical cross-site scripting.\r\n\r\n= 1.4.1 =\r\n\r\n* Fixed up critical cross-site scripting vulnerability. \r\n\r\n= 1.4.0 =\r\n\r\n* Able to use Math generated captcha as well as Securimage Captcha.\r\n\r\n= 1.3.3 =\r\n\r\n* Able to now use algorithms such as SSL or TLS security algorithms when sending out emails.\r\n\r\n= 1.3.2 =\r\n\r\n* Found bugs where you have two or more A Forms on the same page and it didn't know which validation belonged to which form, this has now been fixed.\r\n\r\n= 1.3.1 =\r\n\r\n* Found that if you put quotes in the email, it would display them incorrectly. There were major issues with displaying the form information on the site, so I changed how to present information on the tracking screen.\r\n\r\n= 1.3.0 =\r\n\r\n* Changed how the dependency plugin code works. Fixed the from email address not showing the correct email.\r\n\r\n= 1.2.4 =\r\n\r\n* Added social share links to the bottom of all admin pages.\r\n\r\n= 1.2.3 =\r\n\r\n* Fixed a div issue and added ability to reset stylesheet.\r\n\r\n= 1.2.2 =\r\n\r\n* Fixed up css issues. Added search facility with tracking.\r\n\r\n= 1.2.1 =\r\n\r\n* When you activate, don't print useless warning error messages to the log.\r\n\r\n= 1.2 =\r\n\r\n* Improved code with styles. Updated admin GUI. Updated tracking page.\r\n\r\n= 1.1 =\r\n\r\n* Fixed section issue.\r\n\r\n= 1.0 =\r\n\r\n* Initial Commit"], "fixing_code": ["<?php\r\n/*\r\nPlugin Name: A Forms\r\nPlugin URI: http://wordpress.org/extend/plugins/a-forms/\r\nDescription: Adds a contact form to your wordpress site.\r\n\r\nInstallation:\r\n\r\n1) Install WordPress 3.6 or higher\r\n\r\n2) Download the latest from:\r\n\r\nhttp://wordpress.org/extend/plugins/tom-m8te \r\n\r\nhttp://wordpress.org/extend/plugins/jquery-ui-theme \r\n\r\nhttp://wordpress.org/extend/plugins/a-forms\r\n\r\n3) Login to WordPress admin, click on Plugins / Add New / Upload, then upload the zip file you just downloaded.\r\n\r\n4) Activate the plugin.\r\n\r\nVersion: 1.4.3\r\nAuthor: TheOnlineHero - Tom Skroza\r\nLicense: GPL2\r\n*/\r\n\r\nrequire_once(\"a-form.php\");\r\nrequire_once(\"a-form-section.php\");\r\nrequire_once(\"a-form-fields.php\");\r\nrequire_once(\"a-forms-path.php\");\r\ninclude_once (dirname (__FILE__) . '/tinymce/tinymce.php'); \r\n\r\ndefine(__AFORMS_DEFAULT_LIMIT__, \"10\");\r\n\r\nfunction a_forms_activate() {\r\n  global $wpdb;\r\n\r\n  $a_form_forms_table = $wpdb->prefix . \"a_form_forms\";\r\n  $checktable = $wpdb->query(\"SHOW TABLES LIKE '$a_form_forms_table'\");\r\n  if ($checktable == 0) {\r\n\r\n    $sql = \"CREATE TABLE $a_form_forms_table (\r\n      ID mediumint(9) NOT NULL AUTO_INCREMENT, \r\n      form_name VARCHAR(255) DEFAULT '',\r\n      to_email VARCHAR(255) DEFAULT '',\r\n      to_cc_email VARCHAR(255) DEFAULT '',\r\n      to_bcc_email VARCHAR(255) DEFAULT '',\r\n      subject VARCHAR(255) DEFAULT '',\r\n      show_section_names tinyint(4) NOT NULL DEFAULT 1,\r\n      field_name_id mediumint(9), \r\n      field_email_id mediumint(9), \r\n      field_subject_id mediumint(9), \r\n      send_confirmation_email tinyint(4) NOT NULL DEFAULT 0,\r\n      confirmation_from_email VARCHAR(255) DEFAULT '',\r\n      success_message longtext DEFAULT '',\r\n      success_redirect_url VARCHAR(255) DEFAULT '',\r\n      include_captcha tinyint(4) NOT NULL DEFAULT 0,\r\n      tracking_enabled tinyint(4) NOT NULL DEFAULT 1,\r\n      created_at DATETIME,\r\n      updated_at DATETIME,\r\n      PRIMARY KEY  (ID),\r\n      UNIQUE (form_name)\r\n    )\";\r\n    $wpdb->query($sql); \r\n\r\n    $a_form_sections_table = $wpdb->prefix . \"a_form_sections\";\r\n    $sql = \"CREATE TABLE $a_form_sections_table (\r\n      ID mediumint(9) NOT NULL AUTO_INCREMENT, \r\n      section_name VARCHAR(255) DEFAULT '',\r\n      section_order mediumint(9) NOT NULL DEFAULT 0, \r\n      form_id mediumint(9) NOT NULL, \r\n      created_at DATETIME,\r\n      updated_at DATETIME,\r\n      PRIMARY KEY  (ID)\r\n    )\";\r\n    $wpdb->query($sql); \r\n\r\n    $a_form_fields_table = $wpdb->prefix . \"a_form_fields\";\r\n    $sql = \"CREATE TABLE $a_form_fields_table (\r\n      FID mediumint(9) NOT NULL AUTO_INCREMENT, \r\n      field_type VARCHAR(255) DEFAULT '',\r\n      field_label VARCHAR(255) DEFAULT '', \r\n      value_options VARCHAR(255) DEFAULT '',\r\n      field_order mediumint(9) NOT NULL DEFAULT 0, \r\n      validation VARCHAR(255) DEFAULT '',\r\n      file_ext_allowed VARCHAR(255) DEFAULT '',\r\n      form_id mediumint(9) NOT NULL,\r\n      section_id mediumint(9) NOT NULL,\r\n      created_at DATETIME,\r\n      updated_at DATETIME,\r\n      PRIMARY KEY  (FID)\r\n    )\";\r\n    $wpdb->query($sql);\r\n\r\n    $a_form_tracks_table = $wpdb->prefix . \"a_form_tracks\";\r\n    $sql = \"CREATE TABLE $a_form_tracks_table (\r\n      ID mediumint(9) NOT NULL AUTO_INCREMENT, \r\n      content longtext NOT NULL,\r\n      track_type VARCHAR(255) DEFAULT '',\r\n      form_id mediumint(9) NOT NULL,\r\n      referrer_url VARCHAR(255) DEFAULT '',\r\n      fields_array mediumtext DEFAULT '',\r\n      created_at DATETIME,\r\n      updated_at DATETIME,\r\n      PRIMARY KEY  (ID)\r\n    )\";\r\n    $wpdb->query($sql);\r\n\r\n  }\r\n\r\n  $checkcol = $wpdb->query(\"SHOW COLUMNS FROM '$a_form_forms_table' LIKE 'include_admin_in_emails'\");\r\n  if ($checkcol == 0) {\r\n    $sql = \"ALTER TABLE $a_form_forms_table ADD include_admin_in_emails VARCHAR(1)\";\r\n    $wpdb->query($sql); \r\n  }\r\n\r\n  $checkcol = $wpdb->query(\"SHOW COLUMNS FROM '$a_form_forms_table' LIKE 'captcha_type'\");\r\n  if ($checkcol == 0) {\r\n    $sql = \"ALTER TABLE $a_form_forms_table ADD captcha_type VARCHAR(1) DEFAULT '0'\";\r\n    $wpdb->query($sql); \r\n  }\r\n\r\n  if (!is_dir(get_template_directory().\"/aforms_css\")) {\r\n    aform_copy_directory(AFormsPath::normalize(dirname(__FILE__).\"/css\"), get_template_directory());  \r\n  } else {\r\n    add_option(\"aform_current_css_file\", \"default.css\");\r\n  }\r\n\r\n}\r\nregister_activation_hook( __FILE__, 'a_forms_activate' );\r\n\r\n//call register settings function\r\nadd_action( 'admin_init', 'register_a_forms_settings' );\r\nfunction register_a_forms_settings() {\r\n  register_setting( 'a-forms-settings-group', 'a_forms_admin_email' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_mail_host' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_smtp_auth' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_smtp_port' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_enable_tls' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_enable_ssl' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_smtp_username' );\r\n  register_setting( 'a-forms-settings-group', 'a_forms_smtp_password' );\r\n}\r\n\r\nfunction are_a_forms_dependencies_installed() {\r\n  return is_plugin_active(\"tom-m8te/tom-m8te.php\") && is_plugin_active(\"jquery-ui-theme/jquery-ui-theme.php\");\r\n}\r\n\r\nadd_action( 'admin_notices', 'a_forms_notice_notice' );\r\nfunction a_forms_notice_notice(){\r\n  $activate_nonce = wp_create_nonce( \"activate-a-forms-dependencies\" );\r\n  $tom_active = is_plugin_active(\"tom-m8te/tom-m8te.php\");\r\n  $jquery_ui_theme_active = is_plugin_active(\"jquery-ui-theme/jquery-ui-theme.php\");\r\n  if (!($tom_active && $jquery_ui_theme_active)) { ?>\r\n    <div class='updated below-h2'><p>Before you can use A Forms, please install/activate the following plugin(s):</p>\r\n    <ul>\r\n      <?php if (!$tom_active) { ?>\r\n        <li>\r\n          <a target=\"_blank\" href=\"http://wordpress.org/extend/plugins/tom-m8te/\">Tom M8te</a> \r\n           &#8211; \r\n          <?php if (file_exists(ABSPATH.\"/wp-content/plugins/tom-m8te/tom-m8te.php\")) { ?>\r\n            <a href=\"<?php echo(get_option(\"siteurl\")); ?>/wp-admin/?a_forms_install_dependency=tom-m8te&_wpnonce=<?php echo($activate_nonce); ?>\">Activate</a>\r\n          <?php } else { ?>\r\n            <a href=\"<?php echo(get_option(\"siteurl\")); ?>/wp-admin/plugin-install.php?tab=plugin-information&plugin=tom-m8te&_wpnonce=<?php echo($activate_nonce); ?>&TB_iframe=true&width=640&height=876\">Install</a> \r\n          <?php } ?>\r\n        </li>\r\n      <?php }\r\n      if (!$jquery_ui_theme_active) { ?>\r\n        <li>\r\n          <a target=\"_blank\" href=\"http://wordpress.org/extend/plugins/jquery-ui-theme/\">JQuery UI Theme</a>\r\n           &#8211; \r\n          <?php if (file_exists(ABSPATH.\"/wp-content/plugins/jquery-ui-theme/jquery-ui-theme.php\")) { ?>\r\n            <a href=\"<?php echo(get_option(\"siteurl\")); ?>/wp-admin/?a_forms_install_dependency=jquery-ui-theme&_wpnonce=<?php echo($activate_nonce); ?>\">Activate</a>\r\n          <?php } else { ?>\r\n            <a href=\"<?php echo(get_option(\"siteurl\")); ?>/wp-admin/plugin-install.php?tab=plugin-information&plugin=jquery-ui-theme&_wpnonce=<?php echo($activate_nonce); ?>&TB_iframe=true&width=640&height=876\">Install</a> \r\n          <?php } ?>\r\n        </li>\r\n      <?php } ?>\r\n    </ul>\r\n    </div>\r\n    <?php\r\n  }\r\n\r\n}\r\n\r\nadd_action( 'admin_init', 'register_a_forms_install_dependency_settings' );\r\nfunction register_a_forms_install_dependency_settings() {\r\n  if (isset($_GET[\"a_forms_install_dependency\"])) {\r\n    if (wp_verify_nonce($_REQUEST['_wpnonce'], \"activate-a-forms-dependencies\")) {\r\n      switch ($_GET[\"a_forms_install_dependency\"]) {\r\n        case 'jquery-ui-theme':\r\n          activate_plugin('jquery-ui-theme/jquery-ui-theme.php', 'plugins.php?error=false&plugin=jquery-ui-theme.php');\r\n          wp_redirect(get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms.php\");\r\n          exit();\r\n          break; \r\n        case 'tom-m8te':  \r\n          activate_plugin('tom-m8te/tom-m8te.php', 'plugins.php?error=false&plugin=tom-m8te.php');\r\n          wp_redirect(get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms.php\");\r\n          exit();\r\n          break;   \r\n        default:\r\n          throw new Exception(\"Sorry unable to install plugin.\");\r\n          break;\r\n      }\r\n    } else {\r\n      die(\"Security Check Failed.\");\r\n    }\r\n  }\r\n}\r\n\r\nadd_action('admin_menu', 'register_a_forms_page');\r\nfunction register_a_forms_page() {\r\n  if (are_a_forms_dependencies_installed()) {\r\n    add_menu_page('A Forms', 'A Forms', 'manage_options', 'a-forms/a-forms.php', 'a_form_initial_page');\r\n    add_submenu_page('a-forms/a-forms.php', 'Settings', 'Settings', 'manage_options', 'a-forms/a-forms-settings.php', 'a_form_settings_page');\r\n    add_submenu_page('a-forms/a-forms.php', 'Tracking', 'Tracking', 'manage_options', 'a-forms/a-forms-tracking.php', 'a_form_tracking_page');\r\n    add_submenu_page('a-forms/a-forms.php', 'Styling', 'Styling', 'update_themes', 'a-forms/a-forms-styling.php');\r\n  }\r\n}\r\n\r\nadd_action('wp_ajax_aform_css_file_selector', 'aform_css_file_selector');\r\nfunction aform_css_file_selector() {\r\n  if (are_a_forms_dependencies_installed()) {\r\n    update_option(\"aform_current_css_file\", ($_POST[\"css_file_selection\"]));\r\n    echo(@file_get_contents(get_template_directory().\"/aforms_css/\".($_POST[\"css_file_selection\"])));\r\n  }\r\n  die();  \r\n}\r\n\r\nadd_action('wp_ajax_add_field_to_section', 'add_field_to_section');\r\nfunction add_field_to_section() {\r\n  global $wpdb;\r\n  $section = tom_get_row_by_id(\"a_form_sections\", \"*\", \"ID\", ($_POST[\"section_id\"]));\r\n  tom_insert_record(\"a_form_fields\", array(\"field_order\" => ($_POST[\"field_order\"]), \"section_id\" => ($_POST[\"section_id\"]), \"form_id\" => $section->form_id));\r\n  echo $section->ID.\"::\".$wpdb->insert_id;\r\n  die();  \r\n}\r\n\r\n\r\nadd_action('wp_ajax_aforms_tinymce', 'aforms_tinymce');\r\n/**\r\n * Call TinyMCE window content via admin-ajax\r\n * \r\n * @since 1.7.0 \r\n * @return html content\r\n */\r\nfunction aforms_tinymce() {\r\n  if (are_a_forms_dependencies_installed()) {\r\n    // check for rights\r\n    if ( !current_user_can('edit_pages') && !current_user_can('edit_posts') ) \r\n      die(__(\"You are not allowed to be here\"));\r\n          \r\n    include_once( dirname( dirname(__FILE__) ) . '/a-forms/tinymce/window.php');\r\n    \r\n    die(); \r\n  } \r\n}\r\n\r\nfunction a_form_initial_page() {\r\n  wp_enqueue_script('jquery');\r\n  wp_enqueue_script('jquery-ui-sortable');\r\n\r\n  wp_register_script(\"a-forms\", plugins_url(\"/js/application.js\", __FILE__));\r\n  wp_enqueue_script(\"a-forms\");\r\n\r\n  wp_localize_script( 'a-forms', 'AFormsAjax', array(\r\n    \"ajax_url\" => admin_url('admin-ajax.php'),\r\n    \"base_url\" => get_option('siteurl').\"/wp-admin/admin.php?page=a-forms/a-forms.php\",\r\n    \"sort_section_url\" => get_option('siteurl').\"/wp-admin/admin.php?page=a-forms/a-forms.php&a_form_page=section_section_sort\",\r\n    \"sort_field_url\" => get_option('siteurl').\"/wp-admin/admin.php?page=a-forms/a-forms.php&a_form_page=section_field_sort\"\r\n  ));\r\n\r\n  wp_register_style(\"a-forms\", plugins_url(\"/admin_css/style.css\", __FILE__));\r\n  wp_enqueue_style(\"a-forms\");\r\n\r\n  // If you don't use Securimage and Tom M8te is not setup to use Securimage, then ...\r\n  if (get_option(\"include_securimage\") != \"1\" && !class_exists(\"Securimage\")) {\r\n    // Make Tom M8te use Securimage.\r\n    update_option(\"include_securimage\", \"1\");\r\n  } \r\n\r\n  if ((tom_get_query_string_value(\"a_form_page\")) == \"fields\") {\r\n    if (($_GET[\"action\"]) == \"delete\") {\r\n      AFormFields::delete();\r\n    }\r\n  }\r\n\r\n  if (tom_get_query_string_value(\"a_form_page\") == \"section\") {\r\n    a_form_section_page();\r\n  } else if (tom_get_query_string_value(\"a_form_page\") == \"section_section_sort\") {\r\n    tom_update_record_by_id(\"a_form_sections\", array(\"section_order\" => ($_POST[\"section_order\"])), \"ID\", ($_POST[\"ID\"]));\r\n    exit;\r\n  } else if (tom_get_query_string_value(\"a_form_page\") == \"section_field_sort\") {\r\n    tom_update_record_by_id(\"a_form_fields\", array(\"field_order\" => ($_POST[\"field_order\"]), \"section_id\" => ($_POST[\"section_id\"])), \"FID\", ($_POST[\"FID\"]));\r\n    exit;\r\n  } else if (tom_get_query_string_value(\"a_form_page\") == \"create_field\") {\r\n\r\n    exit;\r\n  } else {\r\n    a_form_page();\r\n  }\r\n  ?>\r\n  <div class=\"clear\"></div>\r\n  <?php \r\n    tom_add_social_share_links(\"http://wordpress.org/extend/plugins/a-forms/\");\r\n}\r\n\r\nfunction a_form_page() {\r\n  if (tom_get_query_string_value(\"a_form_page\") != \"section\") {\r\n    if (isset($_POST[\"action\"])) {\r\n      $action = ($_POST[\"action\"]);\r\n      if ($action == \"Update\") {\r\n        AForm::update();\r\n      }\r\n      if ($action == \"Create\") {\r\n        AForm::create();\r\n      }\r\n    }\r\n    if ($_GET[\"action\"] == \"delete\") {\r\n      AForm::delete();\r\n    }    \r\n  }\r\n  ?>\r\n  \r\n  <div class=\"wrap a-form\">\r\n  <h2>A Forms <a class=\"add-new-h2\" href=\"<?php echo(get_option('siteurl')); ?>/wp-admin/admin.php?page=a-forms/a-forms.php&action=new\">Add New Form</a></h2>\r\n  <?php\r\n\r\n  if (isset($_GET[\"message\"]) && $_GET[\"message\"] != \"\") {\r\n    echo(\"<div class='updated below-h2'><p>\".($_GET[\"message\"]).\"</p></div>\");\r\n  }\r\n\r\n  if (isset($_GET[\"action\"]) && $_GET[\"action\"] != \"delete\") {\r\n    if ($_GET[\"action\"] == \"edit\") {\r\n      // Display Edit Page\r\n      $a_form = tom_get_row_by_id(\"a_form_forms\", \"*\", \"ID\", ($_GET[\"id\"])); ?>\r\n\r\n        <div class=\"postbox \" style=\"display: block; \">\r\n        <div class=\"inside\">\r\n          <form action=\"\" method=\"post\">\r\n            <?php AForm::render_admin_a_form_forms_form($a_form, \"Update\"); ?>\r\n          </form>\r\n        </div>\r\n        </div>\r\n\r\n    \r\n    <?php }\r\n\r\n    if (($_GET[\"action\"]) == \"new\") {\r\n      // Display New Page\r\n      ?>\r\n\r\n        <div class=\"postbox \" style=\"display: block; \">\r\n        <div class=\"inside\">\r\n          <form action=\"\" method=\"post\">\r\n            <?php \r\n\r\n            if (!isset($_POST[\"to_email\"])) {\r\n              $_POST[\"to_email\"] = get_option(\"admin_email\");\r\n            }\r\n            if (!isset($_POST[\"show_section_names\"])) {\r\n              $_POST[\"show_section_names\"] = \"1\";\r\n            }\r\n            if (!isset($_POST[\"tracking_enabled\"])) {\r\n              $_POST[\"tracking_enabled\"] = \"1\";\r\n            }\r\n\r\n            AForm::render_admin_a_form_forms_form(null, \"Create\"); ?>\r\n          </form>\r\n        </div>\r\n        </div>\r\n    <?php }\r\n\r\n  } else { ?>\r\n\r\n\r\n      <div class=\"postbox \" style=\"display: block; \">\r\n      <div class=\"inside\">\r\n        <?php\r\n\r\n        $forms = tom_get_results(\"a_form_forms\", \"*\", \"\");\r\n        if (count($forms) == 0) {\r\n          $url = get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms.php&action=new\";\r\n          tom_javascript_redirect_to($url, \"<p>Start by creating a form.</p>\");\r\n        } else {\r\n          tom_generate_datatable(\"a_form_forms\", array(\"ID\", \"form_name\", \"include_admin_in_emails\", \"to_email\", \"tracking_enabled\"), \"ID\", \"\", array(\"form_name ASC\"), __AFORMS_DEFAULT_LIMIT__, get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms.php\", false, true, true, true, true);   \r\n        }\r\n        ?>\r\n      </div>\r\n      </div>\r\n    <?php\r\n  }\r\n  ?>\r\n  </div>\r\n  <?php\r\n}\r\n\r\nfunction a_form_section_page() {\r\n  if (isset($_POST[\"action\"])) {\r\n    if ($_POST[\"action\"] == \"Update\") {\r\n      AFormSection::update();\r\n    }\r\n    if ($_POST[\"action\"] == \"Create\") {\r\n      AFormSection::create();\r\n    }\r\n  }\r\n  if ($_GET[\"action\"] == \"delete\") {\r\n    AFormSection::delete();\r\n  }\r\n\r\n  ?>\r\n  \r\n  <div class=\"wrap a-form\">\r\n  <h2>A Forms <a class=\"add-new-h2\" href=\"<?php echo(get_option('siteurl')); ?>/wp-admin/admin.php?page=a-forms/a-forms.php&action=new\">Add New Form</a></h2>\r\n  \r\n  <?php\r\n\r\n  if (isset($_GET[\"message\"]) && $_GET[\"message\"] != \"\") {\r\n    echo(\"<div class='updated below-h2'><p>\".($_GET[\"message\"]).\"</p></div>\");\r\n  }\r\n\r\n  if (isset($_GET[\"action\"]) && $_GET[\"action\"] != \"delete\") {\r\n    if ($_GET[\"action\"] == \"edit\") {\r\n      // Display Edit Page\r\n      $a_form = tom_get_row_by_id(\"a_form_sections\", \"*\", \"ID\", ($_GET[\"id\"])); ?>\r\n      <div class=\"postbox \" style=\"display: block; \">\r\n      <div class=\"inside\">\r\n        <form action=\"\" method=\"post\">\r\n          <?php AFormSection::render_admin_a_form_sections_form($a_form, \"Update\"); ?>\r\n        </form>\r\n      </div>\r\n      </div>\r\n      </div>\r\n    <?php }\r\n\r\n    if (($_GET[\"action\"]) == \"new\") {\r\n      // Display New Page\r\n      ?>\r\n      <div class=\"postbox \" style=\"display: block; \">\r\n      <div class=\"inside\">\r\n        <form action=\"\" method=\"post\">\r\n          <?php AFormSection::render_admin_a_form_sections_form(null, \"Create\"); ?>\r\n        </form>\r\n      </div>\r\n      </div>\r\n      </div>\r\n    <?php }\r\n  }\r\n}\r\n\r\nfunction a_form_settings_page() { ?>\r\n  <div class=\"wrap\">\r\n  <h2>Settings</h2>\r\n  <div class=\"postbox \" style=\"display: block; \">\r\n  <div class=\"inside\">\r\n  <form method=\"post\" action=\"options.php\">\r\n    <?php settings_fields( 'a-forms-settings-group' ); ?>\r\n    <h3>Admin Settings</h3>\r\n    <table class=\"form-table\">\r\n      <tbody>\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_admin_email\">Admin Email:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"text\" id=\"a_forms_admin_email\" name=\"a_forms_admin_email\" value=\"<?php echo get_option('a_forms_admin_email'); ?>\" />\r\n            <span class=\"example\">e.g: admin@yourcompany.com.au</span>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n    <h3>SMTP Settings</h3>\r\n    <table class=\"form-table\">\r\n      <tbody>\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_mail_host\">Mail Host:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"text\" id=\"a_forms_mail_host\" name=\"a_forms_mail_host\" value=\"<?php echo get_option('a_forms_mail_host'); ?>\" />\r\n            <span class=\"example\">e.g: mail.yourdomain.com</span>\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_smtp_auth\">Enable SMTP Authentication:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"hidden\" name=\"a_forms_smtp_auth\" value=\"0\">\r\n            <input type=\"checkbox\" id=\"a_forms_smtp_auth\" name=\"a_forms_smtp_auth\" value=\"1\" <?php if (get_option('a_forms_smtp_auth')) {echo \"checked\";} ?> />\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_enable_tls\">Enable TLS:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"hidden\" name=\"a_forms_enable_tls\" value=\"0\">\r\n            <input type=\"checkbox\" id=\"a_forms_enable_tls\" name=\"a_forms_enable_tls\" value=\"1\" <?php if (get_option('a_forms_enable_tls')) {echo \"checked\";} ?> />\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_enable_ssl\">Enable SSL:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"hidden\" name=\"a_forms_enable_ssl\" value=\"0\">\r\n            <input type=\"checkbox\" id=\"a_forms_enable_ssl\" name=\"a_forms_enable_ssl\" value=\"1\" <?php if (get_option('a_forms_enable_ssl')) {echo \"checked\";} ?> />\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_smtp_port\">SMTP Port:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"text\" id=\"a_forms_smtp_port\" name=\"a_forms_smtp_port\" value=\"<?php echo get_option('a_forms_smtp_port'); ?>\" />\r\n            <span class=\"example\">e.g: 26</span>\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_smtp_username\">SMTP Username:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"text\" id=\"a_forms_smtp_username\" name=\"a_forms_smtp_username\" value=\"<?php echo get_option('a_forms_smtp_username'); ?>\" />\r\n          </td>\r\n        </tr>\r\n\r\n        <tr valign=\"top\">\r\n          <th scope=\"row\">\r\n            <label for=\"a_forms_smtp_password\">SMTP Password:</label>\r\n          </th>\r\n          <td>\r\n            <input type=\"password\" id=\"a_forms_smtp_password\" name=\"a_forms_smtp_password\" value=\"<?php echo get_option('a_forms_smtp_password'); ?>\" />\r\n          </td>\r\n        </tr>\r\n    \r\n      </tbody>\r\n    </table>\r\n\r\n    <p class=\"submit\">\r\n      <input type=\"submit\" name=\"Submit\" value=\"Update Settings\">\r\n    </p>\r\n\r\n  </form>\r\n  </div>\r\n  </div>\r\n  </div>\r\n<?php\r\n  tom_add_social_share_links(\"http://wordpress.org/extend/plugins/a-forms/\");\r\n}\r\n\r\nfunction a_form_tracking_page() { \r\n  wp_enqueue_script('jquery');\r\n  wp_enqueue_script('jquery-ui-datepicker');\r\n  wp_register_script(\"a-forms\", plugins_url(\"/js/application.js\", __FILE__));\r\n  wp_enqueue_script('jquery-ui-sortable');\r\n  wp_enqueue_script(\"a-forms\");\r\n  wp_register_style(\"a-forms\", plugins_url(\"/admin_css/style.css\", __FILE__));\r\n  wp_enqueue_style(\"a-forms\");\r\n\r\n  wp_enqueue_style(\"jquery-ui-core\");\r\n  wp_enqueue_style(\"jquery-ui\");\r\n  wp_enqueue_style(\"jquery-ui-datepicker\");\r\n  ?>\r\n\r\n  <script language=\"javascript\">\r\n  jQuery(function() {\r\n    jQuery('.datepicker').datepicker({\r\n      dateFormat : 'yy-m-d',\r\n      showOn: \"button\",\r\n      buttonImage: \"<?php echo(plugins_url( '/images/calendar.gif', __FILE__ )); ?>\",\r\n      buttonImageOnly: true\r\n    });\r\n  });\r\n  </script>\r\n\r\n  <div class=\"wrap\">\r\n  <h2>Tracking</h2>\r\n  <?php if ((tom_get_query_string_value(\"id\")) != \"\") { \r\n    if ((tom_get_query_string_value(\"action\")) != \"view\") { ?>\r\n      <form action=\"\" method=\"post\">\r\n        <?php tom_add_form_field(null, \"text\", \"Search Text\", \"search_text\", \"search_text\", array(), \"p\", array()); ?>\r\n        <?php tom_add_form_field(null, \"text\", \"Date From\", \"search_date_from\", \"search_date_from\", array(\"class\" => \"datepicker\"), \"p\", array()); ?>\r\n        <?php tom_add_form_field(null, \"text\", \"Date To\", \"search_date_to\", \"search_date_to\", array(\"class\" => \"datepicker\"), \"p\", array()); ?>\r\n        <p><input type=\"submit\" name=\"action\" value=\"Search\" /></p>\r\n      </form>\r\n    <?php } ?>\r\n  <?php } ?>\r\n  <?php \r\n    if (!isset($_GET[\"action\"])) {\r\n      tom_generate_datatable(\"a_form_forms\", array(\"ID\", \"form_name\"), \"ID\", \"\", array(), \"30\", \"?page=a-forms/a-forms-tracking.php\", true, false, false, false, true, \"Y-m-d\", array()); \r\n    } else if ($_GET[\"action\"] == \"show\") {\r\n      $limit_clause = \"10\";\r\n      \r\n      $page_no = 0;\r\n      if (isset($_GET[\"a_form_tracks_page\"])) {\r\n        $page_no = ($_GET[\"a_form_tracks_page\"]);\r\n      }\r\n      $offset = $page_no * $limit_clause;\r\n      $where_sql = \"form_id=\".($_GET[\"id\"]);\r\n      if ((tom_get_query_string_value(\"search_text\")) != \"\") {\r\n        $where_sql .= \" AND content LIKE '%\".($_POST[\"search_text\"]).\"%'\";\r\n      }\r\n\r\n      if (((tom_get_query_string_value(\"search_date_from\")) != null) && ((tom_get_query_string_value(\"search_date_to\")) != null)) {\r\n        $where_sql .= \" AND (created_at BETWEEN '\".(tom_get_query_string_value(\"search_date_from\")).\" 00:00:00' AND '\".(tom_get_query_string_value(\"search_date_to\")).\" 23:59:59')\";\r\n      } else if ((tom_get_query_string_value(\"search_date_from\")) != null) {\r\n        $where_sql .= \" AND created_at > '\".(tom_get_query_string_value(\"search_date_from\")).\" 00:00:00'\";\r\n      } else if ((tom_get_query_string_value(\"search_date_to\")) != null) {\r\n        $where_sql .= \" AND created_at < '\".(tom_get_query_string_value(\"search_date_to\")).\" 23:59:59'\";\r\n      }\r\n\r\n      $tracks = tom_get_results(\"a_form_tracks\", \"*\", $where_sql, array(\"created_at DESC\"), \"$limit_clause OFFSET $offset\");\r\n      $fields = tom_get_results(\"a_form_fields\", \"*\", \"form_id=\".($_GET[\"id\"]), array());\r\n      \r\n      $total_tracks = count(tom_get_results(\"a_form_tracks\", \"*\", $where_sql, array(\"created_at DESC\")));\r\n\r\n      if ($total_tracks > 0) {\r\n        tom_generate_datatable_pagination(\"a_form_tracks\", $total_tracks, $limit_clause, ($_GET[\"a_form_tracks_page\"]), \"?page=a-forms/a-forms-tracking.php&action=show&id=\".($_GET[\"id\"]).\"&search_text=\".(tom_get_query_string_value(\"search_text\")).\"&search_date_from=\".(tom_get_query_string_value(\"search_date_from\")).\"&search_date_to=\".(tom_get_query_string_value(\"search_date_to\")), \"ASC\", \"top\");\r\n      ?>\r\n        <table id=\"tracking\">\r\n          <thead>\r\n            <tr>\r\n              <td>ID</td>\r\n              <?php           \r\n                foreach ($fields as $field) {\r\n                  echo(\"<th>\".$field->field_label.\"</th>\");\r\n                }\r\n              ?>\r\n              <th>Referrer URL</th>\r\n              <th>Date Sent</th>\r\n              <th>View Form</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <?php foreach ($tracks as $track) {\r\n              $fields_array = unserialize($track->fields_array); \r\n              echo(\"<tr><td>\".$track->ID.\"</td>\");\r\n              foreach ($fields as $field) {\r\n                $content = $fields_array[str_replace(\" \", \"_\", strtolower($field->field_label))];\r\n                echo(\"<td>\");\r\n                if ($content != \"\" && $field->field_type == \"file\") {\r\n                  echo(\"<a href='\".get_option(\"siteurl\").\"/wp-content/plugins/tom-m8te/tom-download-file.php?file=\".$content.\"'>download</a>\");\r\n                } else {\r\n                  echo(preg_replace(\"/, $/\", \"\", esc_html($content)));\r\n                }\r\n                echo(\"</td>\");\r\n              }\r\n\r\n              echo(\"<td>\".$track->referrer_url.\"</td>\");\r\n              echo(\"<td>\".gmdate(\"Y-m-d H:i:s\", strtotime($track->created_at )).\" GMT</td>\");\r\n              echo(\"<td><a href='\".\r\nget_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms-tracking.php&action=view&id=\".$track->ID.\"'>View</a></td>\");\r\n              echo(\"</tr>\");\r\n            }?>\r\n          </tbody>\r\n        </table>\r\n        <?php\r\n        tom_generate_datatable_pagination(\"a_form_tracks\", $total_tracks, $limit_clause, $_GET[\"a_form_tracks_page\"], \"?page=a-forms/a-forms-tracking.php&action=show&id=\".$_GET[\"id\"], \"ASC\", \"bottom\");\r\n      } else {\r\n        echo(\"<p>No records found!</p>\");\r\n      }\r\n    } else if ($_GET[\"action\"] == \"view\") {\r\n      $view = tom_get_row_by_id(\"a_form_tracks\", \"*\", \"ID\", $_GET[\"id\"]);\r\n      echo \"<p><textarea rows='40' cols='160'>\".esc_html(stripcslashes($view->content)).\"</textarea></p>\";\r\n      echo(\"<p><a href='\".get_option(\"siteurl\").\"/wp-admin/admin.php?page=a-forms/a-forms-tracking.php&action=show&id=\".$view->form_id.\"'>Back</a></p>\");\r\n    }\r\n    \r\n  ?>\r\n  </div>\r\n  <?php\r\n  tom_add_social_share_links(\"http://wordpress.org/extend/plugins/a-forms/\");\r\n}\r\n\r\nadd_shortcode( 'a-form', 'a_form_shortcode' );\r\n\r\nfunction a_form_shortcode($atts) {\r\n  if (is_plugin_active(\"tom-m8te/tom-m8te.php\") && is_plugin_active(\"jquery-ui-theme/jquery-ui-theme.php\")) {\r\n\r\n    $nonce_passed = true;\r\n    $return_content = \"\";\r\n    $email_content = \"\";\r\n    $validation_array = array();\r\n    $from_email = get_option(\"admin_email\");\r\n    $current_datetime = gmdate( 'Y-m-d H:i:s');\r\n\r\n    $form = tom_get_row_by_id(\"a_form_forms\", \"*\", \"ID\", $atts[\"id\"]);\r\n    $sections = tom_get_results(\"a_form_sections\", \"*\", \"form_id='\".$atts[\"id\"].\"'\", array(\"section_order ASC\"));\r\n\r\n    $form_name = \"a_form_\".str_replace(\" \", \"_\", strtolower($form->form_name)).\"_\";\r\n\r\n    $form_valid = true;\r\n    $section_index = 0;\r\n\r\n    if (isset($_POST[\"send_a_form_section\"])) {\r\n      $section_index = ($_POST[\"send_a_form_section\"]);\r\n    } else {\r\n      $section_index = 0;\r\n    }\r\n\r\n    // Get this section.\r\n    $section = $sections[$section_index];\r\n\r\n    // Add validation for this section only.\r\n    $fields = tom_get_results(\"a_form_fields\", \"*\", \"section_id='\".$section->ID.\"'\");\r\n    foreach ($fields as $field) {\r\n      $field_name = str_replace(\" \", \"_\", strtolower($field->field_label));\r\n      $validation_array[$form_name.$field_name] = $field->validation;\r\n    }\r\n\r\n    // Check to see if User submits a form action.\r\n    if (isset($_POST[\"send_a_form\"]) && ($atts[\"id\"] == $_POST[\"send_a_form\"])) {\r\n\r\n      // User has submitted an aform.\r\n      $captcha_valid = true;\r\n      $form_valid = tom_validate_form($validation_array);\r\n\r\n      $field_values = array();\r\n      $attachment_urls = array();\r\n\r\n      if (isset($_POST[\"a_form_attachment_urls\"]) && $_POST[\"a_form_attachment_urls\"] != \"\") {\r\n        $attachment_urls = explode(\"::\", ($_POST[\"a_form_attachment_urls\"]));\r\n      }\r\n\r\n      // Construct email content.\r\n      $all_fields = tom_get_results(\"a_form_fields\", \"*\", \"form_id='\".$atts[\"id\"].\"'\");\r\n      foreach ($all_fields as $field) {\r\n        $field_name = str_replace(\" \", \"_\", strtolower($field->field_label));\r\n\r\n        if ($field->field_type == \"checkbox\") {\r\n          $i = 0;\r\n          $email_content .= $field->field_label.\": \";\r\n          $answers = \"\";\r\n          foreach (explode(\",\", $field->value_options) as $key) {\r\n            if (($_POST[$form_name.$field_name.\"_\".$i]) != \"\") {\r\n              $content = str_replace('\\\"', \"\\\"\", ($_POST[$form_name.$field_name.\"_\".$i]));\r\n              $content = str_replace(\"\\'\", '\\'', $content);\r\n              $answers .= $content.\", \";\r\n            }\r\n            $i++;\r\n          }\r\n          $email_content .= preg_replace(\"/, $/\", \"\", $answers);\r\n          $email_content .= \"\\n\\n\";\r\n          $field_values[$field_name] = $answers;\r\n        } else if ($field->field_type == \"file\") {\r\n          // Upload file.\r\n\r\n          try {\r\n            $filedst = AForm::upload_file($form_name.$field_name, $field->file_ext_allowed);\r\n            array_push($attachment_urls, $form_name.$field_name.\"=>\".$filedst);\r\n          } catch(Exception $ex) {\r\n            $form_valid = false;\r\n            $_SESSION[$form_name.$field_name.\"_error\"] = $ex->getMessage();\r\n          }\r\n          \r\n          if ($filedst != \"\") {\r\n            $field_values[$field_name] = $filedst;\r\n          } else {\r\n            if (($_POST[\"a_form_attachment_urls\"]) != \"\") {\r\n              $records = explode(\"::\", ($_POST[\"a_form_attachment_urls\"]));\r\n              foreach ($records as $record) {\r\n                $key_value = explode(\"=>\", $record);\r\n                if ($key_value[0] == $form_name.$field_name && $key_value[1] != \"\") {\r\n                  $field_values[$field_name] = $key_value[1];\r\n                }\r\n              }\r\n            }\r\n          }\r\n          \r\n        } else {\r\n          $content = str_replace('\\\"', \"\\\"\", ($_POST[$form_name.$field_name]));\r\n          $content = str_replace(\"\\'\", '\\'', $content);\r\n          $email_content .= $field->field_label.\": \".$content.\"\\n\\n\";\r\n          $field_values[$field_name] = $content;\r\n        }\r\n        \r\n      }\r\n\r\n      // Check to see if the user has clicked the Send button and check to see if the form is using a captcha.\r\n      if (isset($_POST[\"action\"]) && $_POST[\"action\"] == \"Send\" && isset($_POST[$form_name.\"captcha\"]) && $form->include_captcha) {\r\n\r\n        // User clicked on Send button and the form has a captcha.\r\n        // Check the type of captcha.\r\n        if ($form->captcha_type == \"0\") {\r\n          // Form is using the Securimage Captcha.\r\n          $captcha_valid = tom_check_captcha($form_name.\"captcha\");\r\n        } else {\r\n          // Form is using the Math Captcha.\r\n\r\n          // Check that the answer is first number plus second number.\r\n          $captcha_valid = \r\n          (\r\n            (\r\n              ($_POST[aform_field_name($form, \"captcha_first_number\")]) \r\n              + \r\n              ($_POST[aform_field_name($form, \"captcha_second_number\")])\r\n            ) \r\n            == ($_POST[aform_field_name($form, \"captcha\")])\r\n          );\r\n\r\n          // Check to see if captcha is valid.\r\n          if ($captcha_valid == false) {\r\n            // Captcha is invalid, so display error message.\r\n            $_SESSION[\"a_form_\".str_replace(\" \", \"_\", strtolower($form->form_name)).\"_captcha_error\"] = \"invalid captcha code, try again!\";\r\n          }\r\n        }\r\n      }\r\n      \r\n      // Check to see if form is valid.\r\n      $nonce_passed = wp_verify_nonce($_REQUEST[\"_wpnonce\"], \"a-forms-contact-a-form\");\r\n      if ($nonce_passed && $form_valid && $captcha_valid) {\r\n        // Form is valid.\r\n        if (($_POST[\"action\"]) == \"Send\") {\r\n          // User clicked Send, so since form is valid and they click Send, send the email.\r\n\r\n          $subject = $form->subject;\r\n          $from_name = \"\";\r\n          $user_email = \"\";\r\n          if ($form->field_name_id != \"\") {\r\n            $row = tom_get_row_by_id(\"a_form_fields\", \"*\", \"FID\", $form->field_name_id);\r\n            $from_name = ($_POST[$form_name.str_replace(\" \", \"_\", strtolower($row->field_label))]);\r\n          }\r\n          if ($form->field_email_id != \"\") {\r\n            $row = tom_get_row_by_id(\"a_form_fields\", \"*\", \"FID\", $form->field_email_id);\r\n            $user_email = ($_POST[$form_name.str_replace(\" \", \"_\", strtolower($row->field_label))]);\r\n          }\r\n          if ($form->field_subject_id != \"\") {\r\n            $row = tom_get_row_by_id(\"a_form_fields\", \"*\", \"FID\", $form->field_subject_id);\r\n            if (isset($_POST[$form_name.str_replace(\" \", \"_\", strtolower($row->field_label))])) {\r\n              $subject .= \" - \".($_POST[$form_name.str_replace(\" \", \"_\", strtolower($row->field_label))]);\r\n            }\r\n          }\r\n\r\n          if ($form->confirmation_from_email != \"\") {\r\n            $from_email = $form->confirmation_from_email;\r\n          }\r\n\r\n          // Send Email.\r\n          $cc_emails = $form->to_cc_email;\r\n          if ($user_email != \"\" && $form->send_confirmation_email) {\r\n            if ($cc_emails == \"\") {\r\n              $cc_emails .= $user_email;\r\n            } else {\r\n              $cc_emails .= \", \".$user_email;\r\n            }\r\n          }\r\n          if ($cc_emails == \"\") {\r\n            $cc_emails .= $from_email;\r\n          } else {\r\n            $cc_emails .= \", \".$from_email;\r\n          }\r\n\r\n          // Rip up $attachment_urls so we're left with only the paths to the files uploaded.\r\n          $smtp_attachment_urls = array();\r\n          foreach ($attachment_urls as $attach_url) {\r\n            $temp = explode(\"=>\", $attach_url);\r\n            array_push($smtp_attachment_urls, $temp[1]);\r\n          }\r\n\r\n          $secure_algorithms = array();\r\n          if (get_option(\"a_forms_enable_tls\")) {\r\n            $secure_algorithms[\"tls\"] = \"tls\";\r\n          }\r\n          if (get_option(\"a_forms_enable_ssl\")) {\r\n            $secure_algorithms[\"ssl\"] = \"ssl\";\r\n          }\r\n\r\n          $mail_message = tom_send_email(false, get_option(\"a_forms_admin_email\").\", \".$form->to_email, $cc_emails, $form->to_bcc_email, $from_email, $from_name, $subject, $email_content, \"\", $smtp_attachment_urls, get_option(\"a_forms_smtp_auth\"), get_option(\"a_forms_mail_host\"), get_option(\"a_forms_smtp_port\"), get_option(\"a_forms_smtp_username\"), get_option(\"a_forms_smtp_password\"), $secure_algorithms);        \r\n          \r\n          if ($mail_message == \"<div class='success'>Message sent!</div>\") {\r\n\r\n            if ($form->success_message != \"\") {\r\n              $mail_message = \"<div class='success'>\".$form->success_message.\"</div>\";\r\n            }\r\n\r\n            if ($form->tracking_enabled) {\r\n              tom_insert_record(\"a_form_tracks\", array(\"created_at\" => $current_datetime, \"form_id\" => ($_POST[\"send_a_form\"]), \"content\" => $email_content, \"track_type\" => \"Successful Email\", \"referrer_url\" => $_SERVER[\"HTTP_REFERER\"], \"fields_array\" => serialize($field_values)));  \r\n            }        \r\n\r\n            if ($form->success_redirect_url != \"\") {\r\n              tom_javascript_redirect_to($form->success_redirect_url, \"<p>Please <a href='$url'>Click Next</a> to continue.</p>\");\r\n            }\r\n\r\n          } else {\r\n            if ($form->tracking_enabled) {\r\n              tom_insert_record(\"a_form_tracks\", array(\"created_at\" => $current_datetime, \"form_id\" => ($_POST[\"send_a_form\"]), \"content\" => \"Error Message: \".$mail_message.\".\\n\\nContent: \".$email_content, \"track_type\" => \"Failed Email\", \"referrer_url\" => $_SERVER[\"HTTP_REFERER\"], \"fields_array\" => serialize($field_values)));\r\n            }\r\n          }          \r\n\r\n          $return_content .= $mail_message;\r\n        }\r\n      } else {\r\n\r\n        // Check to see if the input field values are valid, but not the wpnonce value.\r\n        if ($form_valid && $captcha_valid && $nonce_passed == false) {\r\n          // The input field values are valid except the wpnonce value. Therefore there must have been a cross site spam attack. So display fail send email message.\r\n          $return_content .= \"<div class='a-form error'>Failed to send your message. Please try again later.</div>\";\r\n        }\r\n        $form_valid = false;\r\n\r\n      }\r\n\r\n    }\r\n    \r\n    $aform_form_nonce = wp_create_nonce( \"a-forms-contact-a-form\" );\r\n    $return_content .= \"<form action='' id='\".str_replace(\" \", \"_\", strtolower($form->form_name)).\"' method='post' class='a-form' enctype='multipart/form-data'>\";\r\n\r\n    $return_content .= \"<input type='hidden' name='_wpnonce' value='\".$aform_form_nonce.\"'/>\";\r\n    $return_content .= \"<fieldset>\";\r\n    // Get next section\r\n    if (($_POST[\"action\"]) == \"Next\") {\r\n      if ($form_valid) {\r\n        $section_index++;\r\n      } \r\n    }\r\n\r\n    // Get previous section.\r\n    if (($_POST[\"action\"]) == \"Back\") {\r\n      $section_index--;\r\n    }\r\n\r\n    $section = $sections[$section_index];\r\n\r\n    // Navigate through all the other sections and make all fields hidden.\r\n    $hidden_fields = tom_get_results(\"a_form_fields\", \"*\", \"form_id = '\".$atts[\"id\"].\"' AND section_id <> '\".$section->ID.\"'\");\r\n    foreach ($hidden_fields as $field) {\r\n      $field_name = str_replace(\" \", \"_\", strtolower($field->field_label));\r\n      ob_start();\r\n      \r\n      if ($field->field_type == \"checkbox\") {\r\n        $i = 0;\r\n        foreach (explode(\",\", $field->value_options) as $key) {\r\n          tom_add_form_field(null, \"hidden\", $field->field_label, $form_name.$field_name.\"_\".$i, $form_name.$field_name.\"_\".$i, array(), \"p\", array(), array());  \r\n          $i++;\r\n        }\r\n      } else {\r\n\r\n        tom_add_form_field(null, \"hidden\", $field->field_label, $form_name.$field_name, $form_name.$field_name, array(), \"p\", array(), array());\r\n        \r\n      }\r\n      \r\n      $return_content .= ob_get_contents();\r\n      ob_end_clean();\r\n    }\r\n\r\n    $input_attachment_urls = \"\";\r\n\r\n    if (count($attachment_urls) > 0) {\r\n      $attachment_urls = array_filter( $attachment_urls, 'strlen' );\r\n      $input_attachment_urls = implode(\"::\", str_replace(\"\\\\\\\\\", '\\\\', $attachment_urls));\r\n    }\r\n\r\n    $return_content .= \"<input type='hidden' name='a_form_attachment_urls' value='\".$input_attachment_urls.\"' />\";\r\n\r\n    $fields = tom_get_results(\"a_form_fields\", \"*\", \"section_id='\".$section->ID.\"'\", array(\"field_order ASC\"));\r\n\r\n    // Render form fields.\r\n    if ($form->show_section_names) {\r\n      $return_content .= \"<legend>\".$section->section_name.\"</legend>\";\r\n    }\r\n\r\n    foreach ($fields as $field) {\r\n      $field_name = str_replace(\" \", \"_\", strtolower($field->field_label));\r\n      $value_options = array();\r\n      if ($field->value_options != \"\") {\r\n        $options = explode(\",\", $field->value_options);\r\n        foreach($options as $option_with_label) {\r\n          $temp_array = explode(\":\", $option_with_label);\r\n          $option = $temp_array[1];\r\n          $value = $temp_array[0];\r\n          if ($option == \"\") {\r\n            $option = $value;\r\n          }\r\n          $value_options[$option] = $value;\r\n        }\r\n      }\r\n      $field_label = $field->field_label;\r\n      if (preg_match(\"/required/\",$validation_array[$form_name.$field_name])) {\r\n        $field_label .= \"<abbr title='required'>*</abbr>\";\r\n      }\r\n\r\n      ob_start();\r\n      if ($field->field_type == \"file\" && $field->file_ext_allowed != \"\") {\r\n        echo(\"<div>\");\r\n      } \r\n      $error_class = \"\";\r\n      if (isset($_SESSION[$form_name.$field_name.\"_error\"])) {\r\n        $error_class = \"error\";\r\n      }\r\n      tom_add_form_field(null, $field->field_type, $field_label, $form_name.$field_name, $form_name.$field_name, array(\"class\" => $field->field_type), \"div\", array(\"class\" => $error_class), $value_options);\r\n      if ($field->field_type == \"file\" && $field->file_ext_allowed != \"\") {\r\n        $extensions_allowed = $field->file_ext_allowed;\r\n        $extensions_allowed = preg_replace('/(\\s)+/',' ', $extensions_allowed);\r\n        $extensions_allowed = preg_replace('/(\\s)+$/', '', $extensions_allowed);\r\n        $extensions_allowed = preg_replace('/(\\s)/', ', ', $extensions_allowed);\r\n        $extensions_allowed = preg_replace('/ \\.([a-z|A-Z])*$/', ' and $0', $extensions_allowed);\r\n        $extensions_allowed = preg_replace('/,(\\s)+and/', ' and', $extensions_allowed);\r\n        echo(\"<span class='file-ext-allowed'>Can only accept: \".$extensions_allowed.\"</span>\");\r\n        echo(\"</div>\");\r\n      }\r\n\r\n      $return_content .= ob_get_contents();\r\n      ob_end_clean();\r\n    }\r\n    \r\n    $return_content .= \"</fieldset><fieldset class='submit'><div><input type='hidden' name='send_a_form_section' value='\".$section_index.\"' /><input type='hidden' name='send_a_form' value='\".$atts[\"id\"].\"' />\";\r\n\r\n    // Add action buttons\r\n    // Check if more then one section\r\n    if (count($sections) > 1) {\r\n      // There is more then one section.\r\n\r\n      if (($section_index+1) == count($sections)) {\r\n        // Looking at the last section.\r\n        $return_content .= render_a_form_submit_html($form);\r\n      } else {\r\n        // Not looking at the last section.\r\n        $return_content .= \"<input type='submit' name='action' value='Next' class='next'/>\";\r\n      }\r\n\r\n    } else {\r\n      // Only one section.\r\n      $return_content .= render_a_form_submit_html($form);\r\n    }\r\n\r\n    // Check which section your currently looking at.\r\n    if ($section_index > 0) {\r\n      // Not looking at the first section.\r\n      $return_content .= \"<input type='submit' name='action' value='Back' class='prev'/>\";\r\n    }\r\n\r\n    return $return_content.\"</div></fieldset></form>\";\r\n\r\n  }\r\n}\r\n\r\nfunction render_a_form_submit_html($form) {\r\n  $return_content = \"\";\r\n  if ($form->include_captcha) {\r\n    ob_start();\r\n    if ($form->captcha_type == \"0\") {\r\n\r\n      tom_add_form_field(null, \"captcha\", \"Captcha\", aform_field_name($form, \"captcha\"), aform_field_name($form, \"captcha\"), array(), \"div\", array(\"class\" => \"captcha\"));\r\n\r\n    } else {\r\n\r\n      $first_number = $_POST[aform_field_name($form, \"captcha_first_number\")] = rand(1, 20);\r\n      $second_number = $_POST[aform_field_name($form, \"captcha_second_number\")] = rand(1, 20);\r\n\r\n      tom_add_form_field(null, \"hidden\", \"First number\", aform_field_name($form, \"captcha_first_number\"), \r\n        aform_field_name($form, \"captcha_first_number\")\r\n        , array(), \"div\", array());\r\n      tom_add_form_field(null, \"hidden\", \"Second number\", aform_field_name($form, \"captcha_second_number\"), aform_field_name($form, \"captcha_second_number\"), array(), \"div\", array());\r\n\r\n      tom_add_form_field(null, \"text\", \"What is \".$first_number.\" + \".$second_number, aform_field_name($form, \"captcha\"), aform_field_name($form, \"captcha\"), array(), \"div\", array(\"class\" => \"captcha\"));\r\n    }\r\n    $return_content .= ob_get_contents();\r\n    ob_end_clean();\r\n  }\r\n  $return_content .= \"<input type='submit' name='action' value='Send' class='send'/>\";\r\n  return $return_content;\r\n}\r\n\r\nadd_action('wp_head', 'add_a_forms_js_and_css');\r\nfunction add_a_forms_js_and_css() { \r\n  wp_enqueue_script('jquery');\r\n\r\n  wp_register_script(\"a-forms\", plugins_url(\"/js/application.js\", __FILE__));\r\n  wp_enqueue_script(\"a-forms\");\r\n\r\n  wp_register_style(\"a-forms\", get_template_directory_uri().'/aforms_css/'.get_option(\"aform_current_css_file\"));\r\n  wp_enqueue_style(\"a-forms\");\r\n} \r\n\r\nfunction aform_field_name($form, $field_name) {\r\n  return \"a_form_\".str_replace(\" \", \"_\", strtolower($form->form_name)).\"_\".$field_name;\r\n}\r\n\r\n// Copy directory to another location.\r\nfunction aform_copy_directory($src,$dst) { \r\n    $dir = opendir($src); \r\n    try{\r\n        @mkdir($dst); \r\n        while(false !== ( $file = readdir($dir)) ) { \r\n            if (( $file != '.' ) && ( $file != '..' )) { \r\n                if ( is_dir($src . '/' . $file) ) { \r\n                    aform_copy_directory($src . '/' . $file,$dst . '/' . $file); \r\n                } else { \r\n                    copy($src . '/' . $file,$dst . '/' . $file);\r\n                } \r\n            }   \r\n        }\r\n        closedir($dir); \r\n    } catch(Exception $ex) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n?>", "=== A Forms ===\r\nContributors: MMDeveloper\r\nDonate link: \r\nTags: form, contact, plugin\r\nRequires at least: 3.3\r\nTested up to: 3.6\r\nStable tag: 1.4.3\r\nLicense: GPLv2 or later\r\nLicense URI: http://www.gnu.org/licenses/gpl-2.0.html\r\n\r\nCreate easy contact forms.\r\n\r\n== Description ==\r\n\r\nA wordpress plugin that allows you to add a form on your website.\r\n\r\n== Installation ==\r\n\r\n1) Install WordPress 3.6 or higher\r\n\r\n2) Download the latest from:\r\n\r\nhttp://wordpress.org/extend/plugins/tom-m8te \r\n\r\nhttp://wordpress.org/extend/plugins/jquery-ui-theme \r\n\r\nhttp://wordpress.org/extend/plugins/a-forms\r\n\r\n3) Login to WordPress admin, click on Plugins / Add New / Upload, then upload the zip file you just downloaded.\r\n\r\n4) Activate the plugin.\r\n\r\n\r\n== Changelog ==\r\n\r\n= 1.4.3 =\r\n\r\n* Fixed yet another issue with critical cross-site scripting. I've forced SiteLock to check and check, and I think its finally fixed.\r\n\r\n= 1.4.2 =\r\n\r\n* Fixed another issue with critical cross-site scripting.\r\n\r\n= 1.4.1 =\r\n\r\n* Fixed up critical cross-site scripting vulnerability. \r\n\r\n= 1.4.0 =\r\n\r\n* Able to use Math generated captcha as well as Securimage Captcha.\r\n\r\n= 1.3.3 =\r\n\r\n* Able to now use algorithms such as SSL or TLS security algorithms when sending out emails.\r\n\r\n= 1.3.2 =\r\n\r\n* Found bugs where you have two or more A Forms on the same page and it didn't know which validation belonged to which form, this has now been fixed.\r\n\r\n= 1.3.1 =\r\n\r\n* Found that if you put quotes in the email, it would display them incorrectly. There were major issues with displaying the form information on the site, so I changed how to present information on the tracking screen.\r\n\r\n= 1.3.0 =\r\n\r\n* Changed how the dependency plugin code works. Fixed the from email address not showing the correct email.\r\n\r\n= 1.2.4 =\r\n\r\n* Added social share links to the bottom of all admin pages.\r\n\r\n= 1.2.3 =\r\n\r\n* Fixed a div issue and added ability to reset stylesheet.\r\n\r\n= 1.2.2 =\r\n\r\n* Fixed up css issues. Added search facility with tracking.\r\n\r\n= 1.2.1 =\r\n\r\n* When you activate, don't print useless warning error messages to the log.\r\n\r\n= 1.2 =\r\n\r\n* Improved code with styles. Updated admin GUI. Updated tracking page.\r\n\r\n= 1.1 =\r\n\r\n* Fixed section issue.\r\n\r\n= 1.0 =\r\n\r\n* Initial Commit\r\n\r\n== Upgrade notice ==\r\n\r\n= 1.4.3 =\r\n\r\n* Fixed yet another issue with critical cross-site scripting. I've forced SiteLock to check and check, and I think its finally fixed.\r\n\r\n= 1.4.2 =\r\n\r\n* Fixed another issue with critical cross-site scripting.\r\n\r\n= 1.4.1 =\r\n\r\n* Fixed up critical cross-site scripting vulnerability. \r\n\r\n= 1.4.0 =\r\n\r\n* Able to use Math generated captcha as well as Securimage Captcha.\r\n\r\n= 1.3.3 =\r\n\r\n* Able to now use algorithms such as SSL or TLS security algorithms when sending out emails.\r\n\r\n= 1.3.2 =\r\n\r\n* Found bugs where you have two or more A Forms on the same page and it didn't know which validation belonged to which form, this has now been fixed.\r\n\r\n= 1.3.1 =\r\n\r\n* Found that if you put quotes in the email, it would display them incorrectly. There were major issues with displaying the form information on the site, so I changed how to present information on the tracking screen.\r\n\r\n= 1.3.0 =\r\n\r\n* Changed how the dependency plugin code works. Fixed the from email address not showing the correct email.\r\n\r\n= 1.2.4 =\r\n\r\n* Added social share links to the bottom of all admin pages.\r\n\r\n= 1.2.3 =\r\n\r\n* Fixed a div issue and added ability to reset stylesheet.\r\n\r\n= 1.2.2 =\r\n\r\n* Fixed up css issues. Added search facility with tracking.\r\n\r\n= 1.2.1 =\r\n\r\n* When you activate, don't print useless warning error messages to the log.\r\n\r\n= 1.2 =\r\n\r\n* Improved code with styles. Updated admin GUI. Updated tracking page.\r\n\r\n= 1.1 =\r\n\r\n* Fixed section issue.\r\n\r\n= 1.0 =\r\n\r\n* Initial Commit"], "filenames": ["a-forms.php", "readme.txt"], "buggy_code_start_loc": [23, 7], "buggy_code_end_loc": [931, 93], "fixing_code_start_loc": [23, 7], "fixing_code_end_loc": [927, 102], "type": "CWE-79", "message": "A vulnerability, which was classified as problematic, was found in MMDeveloper A Forms Plugin up to 1.4.2. This affects an unknown part of the file a-forms.php. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. Upgrading to version 1.4.3 is able to address this issue. The name of the patch is 3e693197bd69b7173cc16d8d2e0a7d501a2a0b06. It is recommended to upgrade the affected component. The identifier VDB-222609 was assigned to this vulnerability.", "other": {"cve": {"id": "CVE-2013-10020", "sourceIdentifier": "cna@vuldb.com", "published": "2023-03-10T01:15:11.693", "lastModified": "2023-03-15T16:30:22.617", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, was found in MMDeveloper A Forms Plugin up to 1.4.2. This affects an unknown part of the file a-forms.php. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. Upgrading to version 1.4.3 is able to address this issue. The name of the patch is 3e693197bd69b7173cc16d8d2e0a7d501a2a0b06. It is recommended to upgrade the affected component. The identifier VDB-222609 was assigned to this vulnerability."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:a-forms_project:a-forms:*:*:*:*:*:wordpress:*:*", "versionEndExcluding": "1.4.3", "matchCriteriaId": "609BC45D-1F78-4B5C-A054-39FB8BE33DEA"}]}]}], "references": [{"url": "https://github.com/wp-plugins/a-forms/commit/3e693197bd69b7173cc16d8d2e0a7d501a2a0b06", "source": "cna@vuldb.com", "tags": ["Patch"]}, {"url": "https://vuldb.com/?ctiid.222609", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory", "VDB Entry"]}, {"url": "https://vuldb.com/?id.222609", "source": "cna@vuldb.com", "tags": ["Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/wp-plugins/a-forms/commit/3e693197bd69b7173cc16d8d2e0a7d501a2a0b06"}}