{"buggy_code": ["<!DOCTYPE html>\n<html lang=\"<?php echo erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'content_language')?>\" dir=\"<?php echo erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language')?>\">\n<head>\n    <?php if (isset($Result['fullheight']) && $Result['fullheight']) : ?>\n        <style>\n            html, body {\n                height: 100% !important;\n            }\n        </style>\n    <?php  endif; ?>\n<?php $Result['anonymous'] = true; ?>\n<?php include_once(erLhcoreClassDesign::designtpl('pagelayouts/parts/page_head_user.tpl.php'));?>\n\n    <?php if (isset($Result['no_mobile_css'])) : ?>\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"<?php echo erLhcoreClassDesign::designCSS('css/no_mobile_widget.css;css/no_mobile_widget_override.css');?>\" />\n    <?php else : ?>\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"<?php echo erLhcoreClassDesign::designCSS('css/widget.css;css/widget_override.css');?>\" />\n    <?php endif; ?>\n\n<?php if (isset($Result['theme']) && $Result['theme']->custom_widget_css != '') : ?>\n<style type=\"text/css\">\n<?php echo $Result['theme']->custom_widget_css?>\n</style>\n<?php endif;?>\n\n</head>\n<body<?php isset($Result['pagelayout_css_append']) ? print ' class=\"'.$Result['pagelayout_css_append'].'\" ' : ''?>>\n\n<div id=\"widget-layout\" class=\"row<?php (isset($Result['chat'])) ? print ' has-chat' : '';?>\">\n\t<div class=\"col-12\">\n        <?php include(erLhcoreClassDesign::designtpl('pagelayouts/parts/widget/before_widget_content.tpl.php'));?>\n            <div id=\"widget-content-body\"><?php echo $Result['content']; ?></div>\n        <?php include(erLhcoreClassDesign::designtpl('pagelayouts/parts/widget/after_widget_content.tpl.php'));?>\n     </div>\n</div>\n\n<div id=\"widget-layout-js\">\n<?php if (isset($Result['dynamic_height'])) : ?>\n<script>\nvar wasFocused = false;\nlhinst.isWidgetMode = true;\n\n$('input[type=\"text\"]').first().click(function(){if (wasFocused == false){wasFocused=true;$(this).select().focus();}});\n$('textarea').first().click(function(){if (wasFocused == false){wasFocused=true;$(this).select();}});\nif (!!window.postMessage) {\n    <?php if (!isset($Result['fullheight']) || (isset($Result['fullheight']) && !$Result['fullheight'])) : ?>\n        var heightContent = 0;\n        var heightElement = $('#widget-layout');\n        var intervalCounter = setInterval(function(){\n            try {\n                var currentHeight = heightElement.height();\n                if (heightContent != currentHeight) {\n                    heightContent = currentHeight;\n                    parent.postMessage('<?php echo $Result['dynamic_height_message']?>:'+(parseInt(heightContent)+<?php (isset($Result['dynamic_height_append'])) ? print $Result['dynamic_height_append'] : print 15?>), '*');\n                };\n            } catch (e) {\n                clearInterval(intervalCounter);\n            }\n        },200);\n\n    <?php endif; ?>\n\t<?php if (isset($Result['chat']) && is_numeric($Result['chat']->id)) : ?>\n\tparent.postMessage(\"lhc_ch:hash:<?php echo $Result['chat']->id,'_',$Result['chat']->hash?>\", '*');\n\tparent.postMessage(\"lhc_ch:hash_resume:<?php echo $Result['chat']->id,'_',$Result['chat']->hash?>\", '*');\n\t<?php endif; ?>\n\t<?php if (isset($Result['additional_post_message'])) : ?>\n\tparent.postMessage(\"<?php echo $Result['additional_post_message']?>\", '*');\n\t<?php endif;?>\n\t<?php if (isset($Result['parent_messages'])) : \n\tforeach ($Result['parent_messages'] as $msgPArent) : ?>\n\tparent.postMessage(\"<?php echo $msgPArent?>\", '*');\n\t<?php endforeach;endif;?>\n\n    function handleCrossMessage(e) {\n        if (typeof e.data !== 'string') { return; }\n        var action = e.data.split(':')[0];\n        if (action == 'lhc_load_ext') {\n            const parts = e.data.replace('lhc_load_ext:','').split('::');\n            lhinst.executeExtension(parts[0],JSON.parse(parts[1]));\n        }\n    }\n\n    if ( window.addEventListener ){\n        // FF\n        window.addEventListener(\"message\", handleCrossMessage, false);\n    } else if ( window.attachEvent ) {\n        // IE\n        window.attachEvent(\"onmessage\", handleCrossMessage);\n    } else if ( document.attachEvent ) {\n        // IE\n        document.attachEvent(\"onmessage\", handleCrossMessage);\n    };\n\n    $(window).on('load',function() {\n        <?php if (!isset($Result['fullheight']) || (isset($Result['fullheight']) && !$Result['fullheight'])) : ?>\n        var currentHeight = heightElement.height();\n        if (heightContent != currentHeight){\n            heightContent = currentHeight;\n            try {\n                parent.postMessage('<?php echo $Result['dynamic_height_message']?>:'+(parseInt(heightContent)+<?php (isset($Result['dynamic_height_append'])) ? print $Result['dynamic_height_append'] : print 15?>), '*');\n            } catch(e) {\n\n            };\n        };\n        <?php endif; ?>\n        setTimeout(function () {\n            parent.postMessage(\"lhc_widget_loaded\", '*');\n        },300);\n    });\n\n};\n</script>\n<?php endif;?>\n<?php if (erConfigClassLhConfig::getInstance()->getSetting( 'site', 'debug_output' ) == true) {\n    $debug = ezcDebug::getInstance();\n    echo \"<div><pre class='bg-light text-dark m-2 p-2 border'>\" . json_encode(erLhcoreClassUser::$permissionsChecks, JSON_PRETTY_PRINT) . \"</pre></div>\";\n    echo $debug->generateOutput();\n} ?>\n</div>\n\n</body>\n</html>"], "fixing_code": ["<!DOCTYPE html>\n<html lang=\"<?php echo erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'content_language')?>\" dir=\"<?php echo erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language')?>\">\n<head>\n    <?php if (isset($Result['fullheight']) && $Result['fullheight']) : ?>\n        <style>\n            html, body {\n                height: 100% !important;\n            }\n        </style>\n    <?php  endif; ?>\n<?php $Result['anonymous'] = true; ?>\n<?php include_once(erLhcoreClassDesign::designtpl('pagelayouts/parts/page_head_user.tpl.php'));?>\n\n    <?php if (isset($Result['no_mobile_css'])) : ?>\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"<?php echo erLhcoreClassDesign::designCSS('css/no_mobile_widget.css;css/no_mobile_widget_override.css');?>\" />\n    <?php else : ?>\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"<?php echo erLhcoreClassDesign::designCSS('css/widget.css;css/widget_override.css');?>\" />\n    <?php endif; ?>\n\n<?php if (isset($Result['theme']) && $Result['theme']->custom_widget_css != '') : ?>\n<style type=\"text/css\">\n<?php echo $Result['theme']->custom_widget_css?>\n</style>\n<?php endif;?>\n\n</head>\n<body<?php isset($Result['pagelayout_css_append']) ? print ' class=\"'.$Result['pagelayout_css_append'].'\" ' : ''?>>\n\n<div id=\"widget-layout\" class=\"row<?php (isset($Result['chat'])) ? print ' has-chat' : '';?>\">\n\t<div class=\"col-12\">\n        <?php include(erLhcoreClassDesign::designtpl('pagelayouts/parts/widget/before_widget_content.tpl.php'));?>\n            <div id=\"widget-content-body\"><?php echo $Result['content']; ?></div>\n        <?php include(erLhcoreClassDesign::designtpl('pagelayouts/parts/widget/after_widget_content.tpl.php'));?>\n     </div>\n</div>\n\n<div id=\"widget-layout-js\">\n<?php if (isset($Result['dynamic_height'])) : ?>\n<script>\nvar wasFocused = false;\nlhinst.isWidgetMode = true;\n\n$('input[type=\"text\"]').first().click(function(){if (wasFocused == false){wasFocused=true;$(this).select().focus();}});\n$('textarea').first().click(function(){if (wasFocused == false){wasFocused=true;$(this).select();}});\nif (!!window.postMessage) {\n    <?php if (!isset($Result['fullheight']) || (isset($Result['fullheight']) && !$Result['fullheight'])) : ?>\n        var heightContent = 0;\n        var heightElement = $('#widget-layout');\n        var intervalCounter = setInterval(function(){\n            try {\n                var currentHeight = heightElement.height();\n                if (heightContent != currentHeight) {\n                    heightContent = currentHeight;\n                    parent.postMessage('<?php echo $Result['dynamic_height_message']?>:'+(parseInt(heightContent)+<?php (isset($Result['dynamic_height_append'])) ? print $Result['dynamic_height_append'] : print 15?>), '*');\n                };\n            } catch (e) {\n                clearInterval(intervalCounter);\n            }\n        },200);\n\n    <?php endif; ?>\n\t<?php if (isset($Result['chat']) && is_numeric($Result['chat']->id)) : ?>\n\tparent.postMessage(\"lhc_ch:hash:<?php echo $Result['chat']->id,'_',$Result['chat']->hash?>\", '*');\n\tparent.postMessage(\"lhc_ch:hash_resume:<?php echo $Result['chat']->id,'_',$Result['chat']->hash?>\", '*');\n\t<?php endif; ?>\n\t<?php if (isset($Result['additional_post_message'])) : ?>\n\tparent.postMessage(<?php echo json_encode($Result['additional_post_message'])?>, '*');\n\t<?php endif;?>\n\t<?php if (isset($Result['parent_messages'])) : \n\tforeach ($Result['parent_messages'] as $msgPArent) : ?>\n\tparent.postMessage(<?php echo json_encode($msgPArent)?>, '*');\n\t<?php endforeach;endif;?>\n\n    function handleCrossMessage(e) {\n        if (typeof e.data !== 'string') { return; }\n        var action = e.data.split(':')[0];\n        if (action == 'lhc_load_ext') {\n            const parts = e.data.replace('lhc_load_ext:','').split('::');\n            lhinst.executeExtension(parts[0],JSON.parse(parts[1]));\n        }\n    }\n\n    if ( window.addEventListener ){\n        // FF\n        window.addEventListener(\"message\", handleCrossMessage, false);\n    } else if ( window.attachEvent ) {\n        // IE\n        window.attachEvent(\"onmessage\", handleCrossMessage);\n    } else if ( document.attachEvent ) {\n        // IE\n        document.attachEvent(\"onmessage\", handleCrossMessage);\n    };\n\n    $(window).on('load',function() {\n        <?php if (!isset($Result['fullheight']) || (isset($Result['fullheight']) && !$Result['fullheight'])) : ?>\n        var currentHeight = heightElement.height();\n        if (heightContent != currentHeight){\n            heightContent = currentHeight;\n            try {\n                parent.postMessage('<?php echo $Result['dynamic_height_message']?>:'+(parseInt(heightContent)+<?php (isset($Result['dynamic_height_append'])) ? print $Result['dynamic_height_append'] : print 15?>), '*');\n            } catch(e) {\n\n            };\n        };\n        <?php endif; ?>\n        setTimeout(function () {\n            parent.postMessage(\"lhc_widget_loaded\", '*');\n        },300);\n    });\n\n};\n</script>\n<?php endif;?>\n<?php if (erConfigClassLhConfig::getInstance()->getSetting( 'site', 'debug_output' ) == true) {\n    $debug = ezcDebug::getInstance();\n    echo \"<div><pre class='bg-light text-dark m-2 p-2 border'>\" . json_encode(erLhcoreClassUser::$permissionsChecks, JSON_PRETTY_PRINT) . \"</pre></div>\";\n    echo $debug->generateOutput();\n} ?>\n</div>\n\n</body>\n</html>"], "filenames": ["lhc_web/design/defaulttheme/tpl/pagelayouts/widget.php"], "buggy_code_start_loc": [67], "buggy_code_end_loc": [72], "fixing_code_start_loc": [67], "fixing_code_end_loc": [72], "type": "CWE-79", "message": "livehelperchat is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')", "other": {"cve": {"id": "CVE-2021-4176", "sourceIdentifier": "security@huntr.dev", "published": "2021-12-29T15:15:07.960", "lastModified": "2022-01-06T20:19:39.087", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "livehelperchat is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"}, {"lang": "es", "value": "livehelperchat es vulnerable a una Neutralizaci\u00f3n Inapropiada de la Entrada Durante la Generaci\u00f3n de la P\u00e1gina Web (\"Cross-site Scripting\")"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.5}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:livehelperchat:live_helper_chat:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.91", "matchCriteriaId": "744AB687-C4FD-47D3-BE0A-186C84B8E942"}]}]}], "references": [{"url": "https://github.com/livehelperchat/livehelperchat/commit/1f67cf9f251289a5094774307c2c3d638f9f0ba6", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/8b531ae9-2d36-43ff-af33-4d81acfb2f27", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/livehelperchat/livehelperchat/commit/1f67cf9f251289a5094774307c2c3d638f9f0ba6"}}