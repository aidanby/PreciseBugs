{"buggy_code": ["<?php\r\nfunction zip() {\r\n\tglobal $list, $options, $PHP_SELF;\r\n?>\r\n<form name=\"ziplist\" method=\"post\" action=\"<?php echo $PHP_SELF; ?>\"><input type=\"hidden\" name=\"act\" value=\"zip_go\" />\r\n\t<table cellspacing=\"5\">\r\n\t\t<tr>\r\n\t\t\t<td align=\"center\"><strong>Adding files to a ZIP archive</strong></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td align=\"center\">\r\n\t\t\t\t<table>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td>Archive Name:&nbsp;<input type=\"text\" name=\"archive\" size=\"25\" value=\".zip\" /></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td><input type=\"checkbox\" name=\"no_compression\"<?php echo ($options['disable_archive_compression'] ? ' disabled=\"disabled\" checked=\"checked\"' : ''); ?> />&nbsp;Do not use compression</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t\t<table>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td><input type=\"submit\" value=\"Add Files\" /></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n<?php\r\n\techo \"<br />Selected File\" . (count ( $_GET [\"files\"] ) > 1 ? \"s\" : \"\") . \": \";\r\n\tfor($i = 0; $i < count ( $_GET [\"files\"] ); $i ++) {\r\n\t\t$file = $list [($_GET [\"files\"] [$i])];\r\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"files[]\\\" value=\\\"{$_GET[files][$i]}\\\" />\\r\\n\";\r\n\t\techo \"<b>\" . basename ( $file [\"name\"] ) . \"</b>\";\r\n\t\techo ($i == count ( $_GET [\"files\"] ) - 1) ? \".\" : \",&nbsp;\";\r\n\t}\r\n?>\r\n<br /><br />\r\n</form>\r\n<?php\r\n}\r\n\r\nfunction zip_go() {\r\n\tglobal $list, $options;\r\n\t$saveTo = realpath ( $options['download_dir'] ) . '/';\r\n\t$_POST [\"archive\"] = (strlen ( trim ( urldecode ( $_POST [\"archive\"] ) ) ) > 4 && substr ( trim ( urldecode ( $_POST [\"archive\"] ) ), - 4 ) == \".zip\") ? trim ( urldecode ( $_POST [\"archive\"] ) ) : \"archive.zip\";\r\n\t$_POST [\"archive\"] = $saveTo.basename($_POST [\"archive\"]);\r\n\tfor($i = 0; $i < count ( $_POST [\"files\"] ); $i ++) {\r\n\t\t$files [] = $list [($_POST [\"files\"] [$i])];\r\n\t}\r\n\tforeach ( $files as $file ) {\r\n\t\t$CurrDir = ROOT_DIR;\r\n\t\t$inCurrDir = stristr ( dirname ( $file [\"name\"] ), $CurrDir ) ? TRUE : FALSE;\r\n\t\tif ($inCurrDir) {\r\n\t\t\t$add_files [] = substr ( $file [\"name\"], (strlen ( $CurrDir ) + 1) );\r\n\t\t}\r\n\t}\r\n\trequire_once (CLASS_DIR . \"pclzip.php\");\r\n\t$archive = new PclZip ( $_POST [\"archive\"] );\r\n\t$no_compression = ($options['disable_archive_compression'] || isset($_POST[\"no_compression\"]));\r\n\tif (file_exists ( $_POST [\"archive\"] )) {\r\n\t\tif ($no_compression) { $v_list = $archive->add ( $add_files, PCLZIP_OPT_REMOVE_ALL_PATH, PCLZIP_OPT_NO_COMPRESSION); }\r\n\t\telse { $v_list = $archive->add ( $add_files, PCLZIP_OPT_REMOVE_ALL_PATH); }\r\n\t} else {\r\n\t\tif ($no_compression) { $v_list = $archive->create ( $add_files, PCLZIP_OPT_REMOVE_ALL_PATH, PCLZIP_OPT_NO_COMPRESSION); }\r\n\t\telse { $v_list = $archive->create ( $add_files, PCLZIP_OPT_REMOVE_ALL_PATH); }\r\n\t}\r\n\tif ($v_list == 0) {\r\n\t\techo \"Error: \" . $archive->errorInfo ( true ) . \"<br /><br />\";\r\n\t\treturn;\r\n\t} else {\r\n\t\techo \"Archive <b>\" . $_POST [\"archive\"] . \"</b> successfully created!<br /><br />\";\r\n\t}\r\n\tif (is_file($_POST['archive'])) {\r\n\t\t$time = filemtime($_POST['archive']); while (isset($list[$time])) { $time++; }\r\n\t\t$list[$time] = array(\"name\" => $_POST['archive'], \"size\" => bytesToKbOrMbOrGb(filesize($_POST['archive'])), \"date\" => $time);\r\n\t\tif (!updateListInFile($list)) { echo lang(146).\"<br /><br />\"; }\r\n\t}\r\n}\r\n?>"], "fixing_code": ["<?php\r\nfunction zip() {\r\n\tglobal $list, $options;\r\n?>\r\n<form name=\"ziplist\" method=\"post\" action=\"<?php echo $_SERVER['SCRIPT_NAME']; ?>\"><input type=\"hidden\" name=\"act\" value=\"zip_go\" />\r\n\t<table cellspacing=\"5\">\r\n\t\t<tr>\r\n\t\t\t<td align=\"center\"><strong>Adding files to a ZIP archive</strong></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td align=\"center\">\r\n\t\t\t\t<table>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td>Archive Name:&nbsp;<input type=\"text\" name=\"archive\" size=\"25\" value=\".zip\" /></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td><input type=\"checkbox\" name=\"no_compression\"<?php echo ($options['disable_archive_compression'] ? ' disabled=\"disabled\" checked=\"checked\"' : ''); ?> />&nbsp;Do not use compression</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t\t<table>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td><input type=\"submit\" value=\"Add Files\" /></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</table>\r\n<?php\r\n\techo \"<br />Selected File\" . (count ( $_GET [\"files\"] ) > 1 ? \"s\" : \"\") . \": \";\r\n\tfor($i = 0; $i < count ( $_GET [\"files\"] ); $i ++) {\r\n\t\t$file = $list [($_GET [\"files\"] [$i])];\r\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"files[]\\\" value=\\\"{$_GET[files][$i]}\\\" />\\r\\n\";\r\n\t\techo \"<b>\" . basename ( $file [\"name\"] ) . \"</b>\";\r\n\t\techo ($i == count ( $_GET [\"files\"] ) - 1) ? \".\" : \",&nbsp;\";\r\n\t}\r\n?>\r\n<br /><br />\r\n</form>\r\n<?php\r\n}\r\n\r\nfunction zip_go() {\r\n\tglobal $list, $options;\r\n\t$saveTo = realpath ( $options['download_dir'] ) . '/';\r\n\t$_POST [\"archive\"] = (strlen ( trim ( urldecode ($_POST['archive']) ) ) > 4 && substr ( trim ( urldecode ($_POST['archive']) ), - 4 ) == \".zip\") ? trim ( urldecode ($_POST['archive']) ) : \"archive.zip\";\r\n\t$_POST [\"archive\"] = $saveTo.basename($_POST [\"archive\"]);\r\n\tfor($i = 0; $i < count ( $_POST [\"files\"] ); $i ++) {\r\n\t\t$files [] = $list [($_POST [\"files\"] [$i])];\r\n\t}\r\n\tforeach ( $files as $file ) {\r\n\t\t$CurrDir = ROOT_DIR;\r\n\t\t$inCurrDir = stristr ( dirname ( $file [\"name\"] ), $CurrDir ) ? TRUE : FALSE;\r\n\t\tif ($inCurrDir) {\r\n\t\t\t$add_files [] = substr ( $file [\"name\"], (strlen ( $CurrDir ) + 1) );\r\n\t\t}\r\n\t}\r\n\trequire_once (CLASS_DIR . \"pclzip.php\");\r\n\t$archive = new PclZip ($_POST['archive']);\r\n\t$no_compression = ($options['disable_archive_compression'] || isset($_POST[\"no_compression\"]));\r\n\tif (file_exists ($_POST['archive'])) {\r\n\t\tif ($no_compression) { $v_list = $archive->add ( $add_files, PCLZIP_OPT_REMOVE_ALL_PATH, PCLZIP_OPT_NO_COMPRESSION); }\r\n\t\telse { $v_list = $archive->add ( $add_files, PCLZIP_OPT_REMOVE_ALL_PATH); }\r\n\t} else {\r\n\t\tif ($no_compression) { $v_list = $archive->create ( $add_files, PCLZIP_OPT_REMOVE_ALL_PATH, PCLZIP_OPT_NO_COMPRESSION); }\r\n\t\telse { $v_list = $archive->create ( $add_files, PCLZIP_OPT_REMOVE_ALL_PATH); }\r\n\t}\r\n\r\n\tif ($v_list != 0 && is_file($_POST['archive'])) {\r\n\t\techo \"Archive <b>\" . htmlspecialchars($_POST['archive']) . \"</b> successfully created!<br /><br />\";\r\n\r\n\t\t$time = filemtime($_POST['archive']); while (isset($list[$time])) { $time++; }\r\n\t\t$list[$time] = array(\"name\" => $_POST['archive'], \"size\" => bytesToKbOrMbOrGb(filesize($_POST['archive'])), \"date\" => $time);\r\n\t\tif (!updateListInFile($list)) { echo lang(146).\"<br /><br />\"; }\r\n\t} else {\r\n\t\techo \"Error: \" . htmlspecialchars($archive->errorInfo(true)) . \"<br /><br />\";\r\n\t\treturn;\r\n\t}\r\n}"], "filenames": ["classes/options/zip.php"], "buggy_code_start_loc": [3], "buggy_code_end_loc": [80], "fixing_code_start_loc": [3], "fixing_code_end_loc": [79], "type": "CWE-79", "message": "** UNSUPPPORTED WHEN ASSIGNED **** UNSUPPORTED WHEN ASSIGNED ** A vulnerability classified as problematic has been found in Th3-822 Rapidleech. This affects the function zip_go of the file classes/options/zip.php. The manipulation of the argument archive leads to cross site scripting. It is possible to initiate the attack remotely. The name of the patch is 885a87ea4ee5e14fa95801eca255604fb2e138c6. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-218295. NOTE: This vulnerability only affects products that are no longer supported by the maintainer.", "other": {"cve": {"id": "CVE-2021-4312", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-13T18:15:10.833", "lastModified": "2023-01-23T17:54:03.727", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "** UNSUPPPORTED WHEN ASSIGNED **** UNSUPPORTED WHEN ASSIGNED ** A vulnerability classified as problematic has been found in Th3-822 Rapidleech. This affects the function zip_go of the file classes/options/zip.php. The manipulation of the argument archive leads to cross site scripting. It is possible to initiate the attack remotely. The name of the patch is 885a87ea4ee5e14fa95801eca255604fb2e138c6. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-218295. NOTE: This vulnerability only affects products that are no longer supported by the maintainer."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:rapidleech:rapidleech:*:*:*:*:*:*:*:*", "versionEndExcluding": "2021-09-11", "matchCriteriaId": "E773E284-0416-4B8D-ABCD-6D96F225B69A"}]}]}], "references": [{"url": "https://github.com/Th3-822/rapidleech/commit/885a87ea4ee5e14fa95801eca255604fb2e138c6", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.218295", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.218295", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Th3-822/rapidleech/commit/885a87ea4ee5e14fa95801eca255604fb2e138c6"}}