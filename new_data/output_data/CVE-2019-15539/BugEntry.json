{"buggy_code": ["<?php\n# MantisBT - A PHP based bugtracking system\n\n# MantisBT is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 2 of the License, or\n# (at your option) any later version.\n#\n# MantisBT is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with MantisBT.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edit Project Documentation\n *\n * @package MantisBT\n * @copyright Copyright 2000 - 2002  Kenzaburo Ito - kenito@300baud.org\n * @copyright Copyright 2002  MantisBT Team - mantisbt-dev@lists.sourceforge.net\n * @link http://www.mantisbt.org\n *\n * @uses core.php\n * @uses access_api.php\n * @uses config_api.php\n * @uses database_api.php\n * @uses file_api.php\n * @uses form_api.php\n * @uses gpc_api.php\n * @uses html_api.php\n * @uses lang_api.php\n * @uses print_api.php\n * @uses string_api.php\n * @uses utility_api.php\n */\n\nrequire_once( 'core.php' );\nrequire_api( 'access_api.php' );\nrequire_api( 'config_api.php' );\nrequire_api( 'database_api.php' );\nrequire_api( 'file_api.php' );\nrequire_api( 'form_api.php' );\nrequire_api( 'gpc_api.php' );\nrequire_api( 'html_api.php' );\nrequire_api( 'lang_api.php' );\nrequire_api( 'print_api.php' );\nrequire_api( 'string_api.php' );\nrequire_api( 'utility_api.php' );\n\n# Check if project documentation feature is enabled.\nif( OFF == config_get( 'enable_project_documentation' ) ||\n\t!file_is_uploading_enabled() ||\n\t!file_allow_project_upload() ) {\n\taccess_denied();\n}\n\n$t_file_id = gpc_get_int( 'file_id' );\n\n$t_project_id = file_get_field( $t_file_id, 'project_id', 'project' );\n\naccess_ensure_project_level( config_get( 'upload_project_file_threshold' ), $t_project_id );\n\n$t_query = 'SELECT * FROM {project_file} WHERE id=' . db_param();\n$t_result = db_query( $t_query, array( $t_file_id ) );\n$t_row = db_fetch_array( $t_result );\nextract( $t_row, EXTR_PREFIX_ALL, 'v' );\n\n$v_title = string_attribute( $v_title );\n$v_description = string_textarea( $v_description );\n\n$t_max_file_size = file_get_max_file_size();\n\nlayout_page_header();\n\nlayout_page_begin( 'proj_doc_page.php' );\n\nprint_doc_menu();\n\n?>\n\n<div class=\"col-md-12 col-xs-12\">\n<div class=\"space-10\"></div>\n<div class=\"form-container\">\n<form method=\"post\" enctype=\"multipart/form-data\" action=\"proj_doc_update.php\">\n<?php echo form_security_field( 'proj_doc_update' ) ?>\n<input type=\"hidden\" name=\"file_id\" value=\"<?php echo $t_file_id ?>\"/>\n<div class=\"widget-box widget-color-blue2\">\n\t<div class=\"widget-header widget-header-small\">\n\t\t<h4 class=\"widget-title lighter\">\n\t\t\t<i class=\"ace-icon fa fa-edit\"></i>\n\t\t\t<?php echo lang_get('upload_file_title') ?>\n\t\t</h4>\n\t</div>\n<div class=\"widget-body\">\n<div class=\"widget-main no-padding\">\n<div class=\"table-responsive\">\n<table class=\"table table-bordered table-condensed table-striped\">\n<tr>\n\t<th class=\"category\" width=\"20%\">\n\t\t<span class=\"required\">*</span> <?php echo lang_get( 'title' ) ?>\n\t</th>\n\t<td width=\"80%\">\n\t\t<input type=\"text\" name=\"title\" class=\"input-sm\" size=\"70\" maxlength=\"250\" value=\"<?php echo $v_title ?>\" required />\n\t</td>\n</tr>\n<tr>\n\t<th class=\"category\">\n\t\t<?php echo lang_get( 'description' ) ?>\n\t</th>\n\t<td>\n\t\t<textarea class=\"form-control\" name=\"description\" cols=\"60\" rows=\"7\"><?php echo $v_description ?></textarea>\n\t</td>\n</tr>\n<tr>\n\t<th class=\"category\">\n\t\t<?php echo lang_get( 'filename' ) ?>\n\t</th>\n\t<td>\n\t\t<?php\n\t\t\t$t_href = '<a href=\"file_download.php?file_id='.$v_id.'&amp;type=doc\">';\n\t\t\techo $t_href;\n\t\t\tprint_file_icon( $v_filename );\n\t\t\techo '</a>&#160;' . $t_href . file_get_display_name( $v_filename ) . '</a>';\n\t\t?>\n\t</td>\n</tr>\n<tr>\n\t<td class=\"category\">\n\t\t<?php echo lang_get( 'select_file' ); ?>\n\t\t<br />\n\t\t<?php print_max_filesize( $t_max_file_size ); ?>\n\t</td>\n\t<td>\n\t\t<input type=\"hidden\" name=\"max_file_size\" value=\"<?php echo $t_max_file_size ?>\" />\n\t\t<input name=\"file\" type=\"file\" size=\"70\" />\n\t</td>\n<tr>\n</table>\n</div>\n</div>\n\t<div class=\"widget-toolbox padding-8 clearfix\">\n\t\t<span class=\"required pull-right\"> * <?php echo lang_get('required') ?></span>\n\t\t<input type=\"submit\" class=\"btn btn-primary btn-white btn-round\"\n\t\t\tvalue=\"<?php echo lang_get('file_update_button') ?>\"/>\n\t</div>\n</div>\n</div>\n</form>\n</div>\n\n\t<div class=\"space-10\"></div>\n\t<form method=\"post\" action=\"proj_doc_delete.php\">\n\t<?php echo form_security_field( 'proj_doc_delete' ) ?>\n\t<input type=\"hidden\" name=\"file_id\" value=\"<?php echo $t_file_id ?>\" />\n\t<input type=\"hidden\" name=\"title\" value=\"<?php echo $v_title ?>\" />\n\t<input type=\"submit\" class=\"btn btn-sm btn-primary btn-white btn-round\" value=\"<?php echo lang_get( 'file_delete_button' ) ?>\" />\n\t</form>\n</div>\n\n<?php\nlayout_page_end();\n"], "fixing_code": ["<?php\n# MantisBT - A PHP based bugtracking system\n\n# MantisBT is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 2 of the License, or\n# (at your option) any later version.\n#\n# MantisBT is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with MantisBT.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Edit Project Documentation\n *\n * @package MantisBT\n * @copyright Copyright 2000 - 2002  Kenzaburo Ito - kenito@300baud.org\n * @copyright Copyright 2002  MantisBT Team - mantisbt-dev@lists.sourceforge.net\n * @link http://www.mantisbt.org\n *\n * @uses core.php\n * @uses access_api.php\n * @uses config_api.php\n * @uses database_api.php\n * @uses file_api.php\n * @uses form_api.php\n * @uses gpc_api.php\n * @uses html_api.php\n * @uses lang_api.php\n * @uses print_api.php\n * @uses string_api.php\n * @uses utility_api.php\n */\n\nrequire_once( 'core.php' );\nrequire_api( 'access_api.php' );\nrequire_api( 'config_api.php' );\nrequire_api( 'database_api.php' );\nrequire_api( 'file_api.php' );\nrequire_api( 'form_api.php' );\nrequire_api( 'gpc_api.php' );\nrequire_api( 'html_api.php' );\nrequire_api( 'lang_api.php' );\nrequire_api( 'print_api.php' );\nrequire_api( 'string_api.php' );\nrequire_api( 'utility_api.php' );\n\n# Check if project documentation feature is enabled.\nif( OFF == config_get( 'enable_project_documentation' ) ||\n\t!file_is_uploading_enabled() ||\n\t!file_allow_project_upload() ) {\n\taccess_denied();\n}\n\n$t_file_id = gpc_get_int( 'file_id' );\n\n$t_project_id = file_get_field( $t_file_id, 'project_id', 'project' );\n\naccess_ensure_project_level( config_get( 'upload_project_file_threshold' ), $t_project_id );\n\n$t_query = 'SELECT * FROM {project_file} WHERE id=' . db_param();\n$t_result = db_query( $t_query, array( $t_file_id ) );\n$t_row = db_fetch_array( $t_result );\nextract( $t_row, EXTR_PREFIX_ALL, 'v' );\n\n$v_title = string_attribute( $v_title );\n$v_description = string_textarea( $v_description );\n\n$t_max_file_size = file_get_max_file_size();\n\nlayout_page_header();\n\nlayout_page_begin( 'proj_doc_page.php' );\n\nprint_doc_menu();\n\n?>\n\n<div class=\"col-md-12 col-xs-12\">\n<div class=\"space-10\"></div>\n<div class=\"form-container\">\n<form method=\"post\" enctype=\"multipart/form-data\" action=\"proj_doc_update.php\">\n<?php echo form_security_field( 'proj_doc_update' ) ?>\n<input type=\"hidden\" name=\"file_id\" value=\"<?php echo $t_file_id ?>\"/>\n<div class=\"widget-box widget-color-blue2\">\n\t<div class=\"widget-header widget-header-small\">\n\t\t<h4 class=\"widget-title lighter\">\n\t\t\t<i class=\"ace-icon fa fa-edit\"></i>\n\t\t\t<?php echo lang_get('upload_file_title') ?>\n\t\t</h4>\n\t</div>\n<div class=\"widget-body\">\n<div class=\"widget-main no-padding\">\n<div class=\"table-responsive\">\n<table class=\"table table-bordered table-condensed table-striped\">\n<tr>\n\t<th class=\"category\" width=\"20%\">\n\t\t<span class=\"required\">*</span> <?php echo lang_get( 'title' ) ?>\n\t</th>\n\t<td width=\"80%\">\n\t\t<input type=\"text\" name=\"title\" class=\"input-sm\" size=\"70\" maxlength=\"250\" value=\"<?php echo $v_title ?>\" required />\n\t</td>\n</tr>\n<tr>\n\t<th class=\"category\">\n\t\t<?php echo lang_get( 'description' ) ?>\n\t</th>\n\t<td>\n\t\t<textarea class=\"form-control\" name=\"description\" cols=\"60\" rows=\"7\"><?php echo $v_description ?></textarea>\n\t</td>\n</tr>\n<tr>\n\t<th class=\"category\">\n\t\t<?php echo lang_get( 'filename' ) ?>\n\t</th>\n\t<td>\n\t\t<?php\n\t\t\t$t_href = '<a href=\"file_download.php?file_id='.$v_id.'&amp;type=doc\">';\n\t\t\techo $t_href;\n\t\t\tprint_file_icon( $v_filename );\n\t\t\techo '</a>&#160;' . $t_href . string_html_specialchars( file_get_display_name( $v_filename ) ) . '</a>';\n\t\t?>\n\t</td>\n</tr>\n<tr>\n\t<td class=\"category\">\n\t\t<?php echo lang_get( 'select_file' ); ?>\n\t\t<br />\n\t\t<?php print_max_filesize( $t_max_file_size ); ?>\n\t</td>\n\t<td>\n\t\t<input type=\"hidden\" name=\"max_file_size\" value=\"<?php echo $t_max_file_size ?>\" />\n\t\t<input name=\"file\" type=\"file\" size=\"70\" />\n\t</td>\n<tr>\n</table>\n</div>\n</div>\n\t<div class=\"widget-toolbox padding-8 clearfix\">\n\t\t<span class=\"required pull-right\"> * <?php echo lang_get('required') ?></span>\n\t\t<input type=\"submit\" class=\"btn btn-primary btn-white btn-round\"\n\t\t\tvalue=\"<?php echo lang_get('file_update_button') ?>\"/>\n\t</div>\n</div>\n</div>\n</form>\n</div>\n\n\t<div class=\"space-10\"></div>\n\t<form method=\"post\" action=\"proj_doc_delete.php\">\n\t<?php echo form_security_field( 'proj_doc_delete' ) ?>\n\t<input type=\"hidden\" name=\"file_id\" value=\"<?php echo $t_file_id ?>\" />\n\t<input type=\"hidden\" name=\"title\" value=\"<?php echo $v_title ?>\" />\n\t<input type=\"submit\" class=\"btn btn-sm btn-primary btn-white btn-round\" value=\"<?php echo lang_get( 'file_delete_button' ) ?>\" />\n\t</form>\n</div>\n\n<?php\nlayout_page_end();\n"], "filenames": ["proj_doc_edit_page.php"], "buggy_code_start_loc": [125], "buggy_code_end_loc": [126], "fixing_code_start_loc": [125], "fixing_code_end_loc": [126], "type": "CWE-79", "message": "The proj_doc_edit_page.php Project Documentation feature in MantisBT before 2.21.3 has a stored cross-site scripting (XSS) vulnerability, allowing execution of arbitrary code (if CSP settings permit it) after uploading an attachment with a crafted filename. The code is executed when editing the document's page.", "other": {"cve": {"id": "CVE-2019-15539", "sourceIdentifier": "cve@mitre.org", "published": "2020-03-19T19:15:11.693", "lastModified": "2020-03-24T17:16:15.753", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The proj_doc_edit_page.php Project Documentation feature in MantisBT before 2.21.3 has a stored cross-site scripting (XSS) vulnerability, allowing execution of arbitrary code (if CSP settings permit it) after uploading an attachment with a crafted filename. The code is executed when editing the document's page."}, {"lang": "es", "value": "La funcionalidad Project Documentation del archivo proj_doc_edit_page.php en MantisBT versiones anteriores a 2.21.3, presenta una vulnerabilidad de tipo cross-site scripting (XSS) almacenado, permitiendo una ejecuci\u00f3n de c\u00f3digo arbitrario (si la configuraci\u00f3n CSP lo permite) despu\u00e9s de cargar un archivo adjunto con un nombre de archivo dise\u00f1ado. El c\u00f3digo se ejecuta al editar la p\u00e1gina del documento."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:mantisbt:mantisbt:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.21.3", "matchCriteriaId": "4B2948D4-038D-4C4B-AFCB-00FA9301763A"}]}]}], "references": [{"url": "https://github.com/mantisbt/mantisbt/commit/bd094dede74ff6e313e286e949e2387233a96eea", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://mantisbt.org/bugs/view.php?id=26078", "source": "cve@mitre.org", "tags": ["Permissions Required", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/mantisbt/mantisbt/commit/bd094dede74ff6e313e286e949e2387233a96eea"}}