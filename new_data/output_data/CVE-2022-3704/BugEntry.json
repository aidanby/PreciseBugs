{"buggy_code": ["<% content_for :style do %>\n  #route_table {\n    margin: 0;\n    border-collapse: collapse;\n  }\n\n  #route_table thead tr {\n    border-bottom: 2px solid #ddd;\n  }\n\n  #route_table thead tr.bottom {\n    border-bottom: none;\n  }\n\n  #route_table thead tr.bottom th {\n    padding: 10px 0;\n    line-height: 15px;\n  }\n\n  #route_table thead tr.bottom th input#search {\n    -webkit-appearance: textfield;\n  }\n\n  #route_table tbody tr {\n    border-bottom: 1px solid #ddd;\n  }\n\n  #route_table tbody tr:nth-child(odd) {\n    background: #f2f2f2;\n  }\n\n  #route_table tbody.exact_matches,\n  #route_table tbody.fuzzy_matches {\n    background-color: LightGoldenRodYellow;\n    border-bottom: solid 2px SlateGrey;\n  }\n\n  #route_table tbody.exact_matches tr,\n  #route_table tbody.fuzzy_matches tr {\n    background: none;\n    border-bottom: none;\n  }\n\n  #route_table td {\n    padding: 4px 30px;\n  }\n\n  #path_search {\n    width: 80%;\n    font-size: inherit;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    #route_table tbody tr:nth-child(odd) {\n      background: #282828;\n    }\n\n    #route_table tbody.exact_matches tr,\n    #route_table tbody.fuzzy_matches tr {\n      background: DarkSlateGrey;\n    }\n  }\n<% end %>\n\n<table id='route_table' class='route_table'>\n  <thead>\n    <tr>\n      <th>Helper</th>\n      <th>HTTP Verb</th>\n      <th>Path</th>\n      <th>Controller#Action</th>\n    </tr>\n    <tr class='bottom'>\n      <th><%# Helper %>\n        <%= link_to \"Path\", \"#\", 'data-route-helper' => '_path',\n                    title: \"Returns a relative path (without the http or domain)\" %> /\n        <%= link_to \"Url\", \"#\", 'data-route-helper' => '_url',\n                    title: \"Returns an absolute URL (with the http and domain)\"   %>\n      </th>\n      <th><%# HTTP Verb %>\n      </th>\n      <th><%# Path %>\n        <%= search_field(:path, nil, id: 'search', placeholder: \"Path Match\") %>\n      </th>\n      <th><%# Controller#action %>\n      </th>\n    </tr>\n  </thead>\n  <tbody class='exact_matches' id='exact_matches'>\n  </tbody>\n  <tbody class='fuzzy_matches' id='fuzzy_matches'>\n  </tbody>\n  <tbody>\n    <%= yield %>\n  </tbody>\n</table>\n\n<script>\n  // support forEach iterator on NodeList\n  NodeList.prototype.forEach = Array.prototype.forEach;\n\n  // Enables path search functionality\n  function setupMatchPaths() {\n    // Check if there are any matched results in a section\n    function checkNoMatch(section, noMatchText) {\n      if (section.children.length <= 1) {\n        section.innerHTML += noMatchText;\n      }\n    }\n\n    // get JSON from URL and invoke callback with result\n    function getJSON(url, success) {\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', url);\n      xhr.onload = function() {\n        if (this.status == 200)\n          success(JSON.parse(this.response));\n      };\n      xhr.send();\n    }\n\n    function delayedKeyup(input, callback) {\n      var timeout;\n      input.onkeyup = function(){\n        if (timeout) clearTimeout(timeout);\n        timeout = setTimeout(callback, 300);\n      }\n    }\n\n    // remove params or fragments\n    function sanitizePath(path) {\n      return path.replace(/[#?].*/, '');\n    }\n\n    var pathElements = document.querySelectorAll('#route_table [data-route-path]'),\n        searchElem   = document.querySelector('#search'),\n        exactSection = document.querySelector('#exact_matches'),\n        fuzzySection = document.querySelector('#fuzzy_matches');\n\n    // Remove matches when no search value is present\n    searchElem.onblur = function(e) {\n      if (searchElem.value === \"\") {\n        exactSection.innerHTML = \"\";\n        fuzzySection.innerHTML = \"\";\n      }\n    }\n\n    // On key press perform a search for matching paths\n    delayedKeyup(searchElem, function() {\n      var path = sanitizePath(searchElem.value),\n          defaultExactMatch = '<tr><th colspan=\"4\">Paths Matching (' + path +'):</th></tr>',\n          defaultFuzzyMatch = '<tr><th colspan=\"4\">Paths Containing (' + path +'):</th></tr>',\n          noExactMatch      = '<tr><th colspan=\"4\">No Exact Matches Found</th></tr>',\n          noFuzzyMatch      = '<tr><th colspan=\"4\">No Fuzzy Matches Found</th></tr>';\n\n      if (!path)\n        return searchElem.onblur();\n\n      getJSON('/rails/info/routes?path=' + path, function(matches){\n        // Clear out results section\n        exactSection.innerHTML = defaultExactMatch;\n        fuzzySection.innerHTML = defaultFuzzyMatch;\n\n        // Display exact matches and fuzzy matches\n        pathElements.forEach(function(elem) {\n          var elemPath = elem.getAttribute('data-route-path');\n\n          if (matches['exact'].indexOf(elemPath) != -1)\n            exactSection.appendChild(elem.parentNode.cloneNode(true));\n\n          if (matches['fuzzy'].indexOf(elemPath) != -1)\n            fuzzySection.appendChild(elem.parentNode.cloneNode(true));\n        })\n\n        // Display 'No Matches' message when no matches are found\n        checkNoMatch(exactSection, noExactMatch);\n        checkNoMatch(fuzzySection, noFuzzyMatch);\n      })\n    })\n  }\n\n  // Enables functionality to toggle between `_path` and `_url` helper suffixes\n  function setupRouteToggleHelperLinks() {\n\n    // Sets content for each element\n    function setValOn(elems, val) {\n      elems.forEach(function(elem) {\n        elem.innerHTML = val;\n      });\n    }\n\n    // Sets onClick event for each element\n    function onClick(elems, func) {\n      elems.forEach(function(elem) {\n        elem.onclick = func;\n      });\n    }\n\n    var toggleLinks = document.querySelectorAll('#route_table [data-route-helper]');\n\n    onClick(toggleLinks, function(){\n      var helperTxt   = this.getAttribute(\"data-route-helper\"),\n          helperElems = document.querySelectorAll('[data-route-name] span.helper');\n\n      setValOn(helperElems, helperTxt);\n    });\n  }\n\n  setupMatchPaths();\n  setupRouteToggleHelperLinks();\n\n  // Focus the search input after page has loaded\n  document.getElementById('search').focus();\n</script>\n"], "fixing_code": ["<% content_for :style do %>\n  #route_table {\n    margin: 0;\n    border-collapse: collapse;\n  }\n\n  #route_table thead tr {\n    border-bottom: 2px solid #ddd;\n  }\n\n  #route_table thead tr.bottom {\n    border-bottom: none;\n  }\n\n  #route_table thead tr.bottom th {\n    padding: 10px 0;\n    line-height: 15px;\n  }\n\n  #route_table thead tr.bottom th input#search {\n    -webkit-appearance: textfield;\n  }\n\n  #route_table tbody tr {\n    border-bottom: 1px solid #ddd;\n  }\n\n  #route_table tbody tr:nth-child(odd) {\n    background: #f2f2f2;\n  }\n\n  #route_table tbody.exact_matches,\n  #route_table tbody.fuzzy_matches {\n    background-color: LightGoldenRodYellow;\n    border-bottom: solid 2px SlateGrey;\n  }\n\n  #route_table tbody.exact_matches tr,\n  #route_table tbody.fuzzy_matches tr {\n    background: none;\n    border-bottom: none;\n  }\n\n  #route_table td {\n    padding: 4px 30px;\n  }\n\n  #path_search {\n    width: 80%;\n    font-size: inherit;\n  }\n\n  @media (prefers-color-scheme: dark) {\n    #route_table tbody tr:nth-child(odd) {\n      background: #282828;\n    }\n\n    #route_table tbody.exact_matches tr,\n    #route_table tbody.fuzzy_matches tr {\n      background: DarkSlateGrey;\n    }\n  }\n<% end %>\n\n<table id='route_table' class='route_table'>\n  <thead>\n    <tr>\n      <th>Helper</th>\n      <th>HTTP Verb</th>\n      <th>Path</th>\n      <th>Controller#Action</th>\n    </tr>\n    <tr class='bottom'>\n      <th><%# Helper %>\n        <%= link_to \"Path\", \"#\", 'data-route-helper' => '_path',\n                    title: \"Returns a relative path (without the http or domain)\" %> /\n        <%= link_to \"Url\", \"#\", 'data-route-helper' => '_url',\n                    title: \"Returns an absolute URL (with the http and domain)\"   %>\n      </th>\n      <th><%# HTTP Verb %>\n      </th>\n      <th><%# Path %>\n        <%= search_field(:path, nil, id: 'search', placeholder: \"Path Match\") %>\n      </th>\n      <th><%# Controller#action %>\n      </th>\n    </tr>\n  </thead>\n  <tbody class='exact_matches' id='exact_matches'>\n  </tbody>\n  <tbody class='fuzzy_matches' id='fuzzy_matches'>\n  </tbody>\n  <tbody>\n    <%= yield %>\n  </tbody>\n</table>\n\n<script>\n  // support forEach iterator on NodeList\n  NodeList.prototype.forEach = Array.prototype.forEach;\n\n  // Enables path search functionality\n  function setupMatchPaths() {\n    // Check if there are any matched results in a section\n    function checkNoMatch(section, trElement) {\n      if (section.children.length <= 1) {\n        section.appendChild(trElement);\n      }\n    }\n\n    // get JSON from URL and invoke callback with result\n    function getJSON(url, success) {\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', url);\n      xhr.onload = function() {\n        if (this.status == 200)\n          success(JSON.parse(this.response));\n      };\n      xhr.send();\n    }\n\n    function delayedKeyup(input, callback) {\n      var timeout;\n      input.onkeyup = function(){\n        if (timeout) clearTimeout(timeout);\n        timeout = setTimeout(callback, 300);\n      }\n    }\n\n    // remove params or fragments\n    function sanitizePath(path) {\n      return path.replace(/[#?].*/, '');\n    }\n\n    var pathElements = document.querySelectorAll('#route_table [data-route-path]'),\n        searchElem   = document.querySelector('#search'),\n        exactSection = document.querySelector('#exact_matches'),\n        fuzzySection = document.querySelector('#fuzzy_matches');\n\n    // Remove matches when no search value is present\n    searchElem.onblur = function(e) {\n      if (searchElem.value === \"\") {\n        exactSection.innerHTML = \"\";\n        fuzzySection.innerHTML = \"\";\n      }\n    }\n\n    function buildTr(string) {\n      var tr = document.createElement('tr');\n      var th = document.createElement('th');\n      th.setAttribute('colspan', 4);\n      tr.appendChild(th);\n      th.innerText = string;\n      return tr;\n    }\n\n    // On key press perform a search for matching paths\n    delayedKeyup(searchElem, function() {\n      var path = sanitizePath(searchElem.value),\n          defaultExactMatch = buildTr('Paths Matching (' + path + '):'),\n          defaultFuzzyMatch = buildTr('Paths Containing (' + path +'):'),\n          noExactMatch      = buildTr('No Exact Matches Found'),\n          noFuzzyMatch      = buildTr('No Fuzzy Matches Found');\n\n      if (!path)\n        return searchElem.onblur();\n\n      getJSON('/rails/info/routes?path=' + path, function(matches){\n        // Clear out results section\n        exactSection.replaceChildren(defaultExactMatch);\n        fuzzySection.replaceChildren(defaultFuzzyMatch);\n\n        // Display exact matches and fuzzy matches\n        pathElements.forEach(function(elem) {\n          var elemPath = elem.getAttribute('data-route-path');\n\n          if (matches['exact'].indexOf(elemPath) != -1)\n            exactSection.appendChild(elem.parentNode.cloneNode(true));\n\n          if (matches['fuzzy'].indexOf(elemPath) != -1)\n            fuzzySection.appendChild(elem.parentNode.cloneNode(true));\n        })\n\n        // Display 'No Matches' message when no matches are found\n        checkNoMatch(exactSection, noExactMatch);\n        checkNoMatch(fuzzySection, noFuzzyMatch);\n      })\n    })\n  }\n\n  // Enables functionality to toggle between `_path` and `_url` helper suffixes\n  function setupRouteToggleHelperLinks() {\n\n    // Sets content for each element\n    function setValOn(elems, val) {\n      elems.forEach(function(elem) {\n        elem.innerHTML = val;\n      });\n    }\n\n    // Sets onClick event for each element\n    function onClick(elems, func) {\n      elems.forEach(function(elem) {\n        elem.onclick = func;\n      });\n    }\n\n    var toggleLinks = document.querySelectorAll('#route_table [data-route-helper]');\n\n    onClick(toggleLinks, function(){\n      var helperTxt   = this.getAttribute(\"data-route-helper\"),\n          helperElems = document.querySelectorAll('[data-route-name] span.helper');\n\n      setValOn(helperElems, helperTxt);\n    });\n  }\n\n  setupMatchPaths();\n  setupRouteToggleHelperLinks();\n\n  // Focus the search input after page has loaded\n  document.getElementById('search').focus();\n</script>\n"], "filenames": ["actionpack/lib/action_dispatch/middleware/templates/routes/_table.html.erb"], "buggy_code_start_loc": [105], "buggy_code_end_loc": [163], "fixing_code_start_loc": [105], "fixing_code_end_loc": [172], "type": "CWE-707", "message": "** DISPUTED ** A vulnerability classified as problematic has been found in Ruby on Rails. This affects an unknown part of the file actionpack/lib/action_dispatch/middleware/templates/routes/_table.html.erb. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. The real existence of this vulnerability is still doubted at the moment. The name of the patch is be177e4566747b73ff63fd5f529fab564e475ed4. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-212319. NOTE: Maintainer declares that there isn\u2019t a valid attack vector. The issue was wrongly reported as a security vulnerability by a non-member of the Rails team.", "other": {"cve": {"id": "CVE-2022-3704", "sourceIdentifier": "cna@vuldb.com", "published": "2022-10-26T20:15:10.730", "lastModified": "2023-01-19T23:15:13.027", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "** DISPUTED ** A vulnerability classified as problematic has been found in Ruby on Rails. This affects an unknown part of the file actionpack/lib/action_dispatch/middleware/templates/routes/_table.html.erb. The manipulation leads to cross site scripting. It is possible to initiate the attack remotely. The real existence of this vulnerability is still doubted at the moment. The name of the patch is be177e4566747b73ff63fd5f529fab564e475ed4. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-212319. NOTE: Maintainer declares that there isn\u2019t a valid attack vector. The issue was wrongly reported as a security vulnerability by a non-member of the Rails team."}, {"lang": "es", "value": "Se ha encontrado una vulnerabilidad clasificada como problem\u00e1tica en Ruby on Rails. Afecta a una parte desconocida del archivo actionpack/lib/action_dispatch/middleware/templates/routes/_table.html.erb. La manipulaci\u00f3n conlleva a un ataque de tipo cross site scripting. Es posible iniciar el ataque de forma remota. El nombre del parche es be177e4566747b73ff63fd5f529fab564e475ed4. Es recomendado aplicar el parche para corregir este problema. El identificador asociado a esta vulnerabilidad es VDB-212319"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}, {"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-707"}, {"lang": "en", "value": "CWE-74"}, {"lang": "en", "value": "CWE-79"}]}, {"source": "nvd@nist.gov", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:rubyonrails:rails:-:*:*:*:*:*:*:*", "matchCriteriaId": "2DE62461-5072-4B51-9043-C6AA48A95069"}]}]}], "references": [{"url": "https://github.com/rails/rails/commit/be177e4566747b73ff63fd5f529fab564e475ed4", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/rails/rails/issues/46244", "source": "cna@vuldb.com", "tags": ["Exploit", "Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?id.212319", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/rails/rails/commit/be177e4566747b73ff63fd5f529fab564e475ed4"}}