{"buggy_code": ["<?php\n\nnamespace LibrarianApp;\n\nuse Exception;\nuse Librarian\\Html\\Bootstrap;\nuse Librarian\\Media\\Temporal;\nuse Librarian\\Mvc\\TextView;\n\nclass DashboardView extends TextView {\n\n    use SharedHtmlView;\n\n    /**\n     * Dashboard HTML.\n     *\n     * @param $data\n     * @return string\n     * @throws Exception\n     */\n    public function main($data) {\n\n        $this->title($this->lang->t9n('Dashboard'));\n\n        $this->head();\n\n        /** @var Bootstrap\\Breadcrumb $el */\n        $el = $this->di->get('Breadcrumb');\n\n        $el->style('margin: 0 -15px');\n        $el->addClass('bg-transparent');\n        $el->item('IL', '#dashboard');\n        $el->item($this->lang->t9n('Dashboard'));\n        $bc = $el->render();\n\n        $el = null;\n\n        // Cards array.\n        $cards = [];\n\n        /*\n         * Quick search.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_search') === '0') {\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->context('link');\n            $el->addClass('p-0 ml-3');\n            $el->style('transform: translateY(-2px)');\n            $el->attr('data-dismiss', 'modal');\n            $el->attr('data-toggle', 'modal');\n            $el->dataTarget('#modal-advanced-search');\n            $el->html($this->lang->t9n('Advanced'));\n            $advanced_button = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->context('link');\n            $el->addClass('p-0 ml-3');\n            $el->style('transform: translateY(-2px)');\n            $el->attr('data-dismiss', 'modal');\n            $el->attr('data-toggle', 'modal');\n            $el->dataTarget('#modal-searches');\n            $el->html($this->lang->t9n('Previous'));\n            $searches_button = $el->render();\n\n            $el = null;\n\n            $search_html = $this->sharedQuickSearch();\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n<<<HTML\n<div>\n    <b class=\"text-uppercase\">{$this->lang->t9n('Search-NOUN')}</b> $advanced_button $searches_button\n</div>\nHTML\n            , 'px-4 pt-3');\n            $el->body($search_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Import panel.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_import') === '0') {\n\n            $button_class = $this::$theme === 'dark' ? 'secondary' : 'light';\n            $help_class = $this::$theme === 'dark' ? 'dark' : 'secondary';\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->elementName('a');\n            $el->href('#import/uid');\n            $el->context($button_class);\n            $el->addClass('btn-block mb-4 py-3 rounded-0');\n            $el->html(\n<<<EOT\n<h5>DOI, Pubmed ID&hellip;</h5>\n<span class=\"text-{$help_class}\">10.2234/26548.225</span>\nEOT\n                );\n            $card_uid = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->elementName('a');\n            $el->href('#import/file');\n            $el->context($button_class);\n            $el->addClass('btn-block mb-4 py-3 rounded-0');\n            $el->html(\n<<<EOT\n<h5>{$this->lang->t9n('Published PDFs')}</h5>\n<span class=\"mdi mdi-24px mdi-file-pdf-box text-{$help_class}\"></span>\n<span class=\"text-{$help_class}\">+ 10.2234/2654.225</span>\nEOT\n            );\n            $card_file = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->elementName('a');\n            $el->href('#import/text');\n            $el->context($button_class);\n            $el->addClass('btn-block mb-4 py-3 rounded-0');\n            $el->html(\n<<<EOT\n<h5>RIS, BibTex, Endnote</h5>\n<span class=\"text-{$help_class}\">@article{Smith2011</span>\nEOT\n            );\n            $card_text = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->elementName('a');\n            $el->href('#import/manual');\n            $el->context($button_class);\n            $el->addClass('btn-block mb-4 py-3 rounded-0');\n            $el->html(\n<<<EOT\n<h5>{$this->lang->t9n('Unpublished file')}</h5>\n<span class=\"mdi mdi-24px mdi-file-word-box text-{$help_class}\"></span>\n<span class=\"mdi mdi-24px mdi-image text-{$help_class}\"></span>\n<span class=\"mdi mdi-24px mdi-file-pdf-box text-{$help_class}\"></span>\nEOT\n            );\n            $card_manual = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Row $el */\n            $el = $this->di->get('Row');\n\n            $el->column($card_uid, 'col-sm-6');\n            $el->column($card_file, 'col-sm-6');\n            $el->column($card_manual, 'col-sm-6');\n            $el->column($card_text, 'col-sm-6');\n            $button_row = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<span>\n    <b class=\"text-uppercase\">{$this->lang->t9n('Import')}</b>\n</span>\nHTML\n                , 'px-4 pt-3');\n            $el->body($button_row, null, 'px-4 pb-2');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last items.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_items') === '0') {\n\n            $last5_html =\n                <<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_items']) === 0) {\n\n                $last5_html .=\n                    <<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase pb-4 align-middle\">\n                {$this->lang->t9n('No items')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_items'] as $item) {\n\n                $item_url = IL_BASE_URL . 'index.php/item#summary?id=' . $item['id'];\n\n                if ((int) $item['has_pdf'] === 1) {\n\n                    /** @var Bootstrap\\Badge $el */\n                    $el = $this->di->get('Badge');\n\n                    $el->context('warning');\n                    $el->addClass('mr-2 border border-warning');\n                    $el->html('PDF');\n                    $pdf_badge = $el->render();\n\n                    $el = null;\n\n                    $pdf_url = IL_BASE_URL . 'index.php/pdf?id=' . $item['id'];\n                    $pdf_button = \"<a href=\\\"{$pdf_url}\\\">{$pdf_badge}</a>\";\n\n                } else {\n\n                    /** @var Bootstrap\\Badge $el */\n                    $el = $this->di->get('Badge');\n\n                    $el->context('default');\n                    $el->addClass('mr-2 border border-secondary text-secondary');\n                    $el->html('PDF');\n                    $pdf_button = $el->render();\n\n                    $el = null;\n                }\n\n                $last5_html .=\n                    <<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                $pdf_button\n                <a href=\"{$item_url}\">{$item['title']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $last5_html .=\n                <<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<span>\n    <b class=\"text-uppercase\">{$this->lang->t9n('Items')}</b>\n    <a class=\"mx-3\" href=\"#items/main\">{$this->lang->t9n('List-NOUN')}</a>\n    <a href=\"#items/filter\">{$this->lang->t9n('Filter-NOUN')}</a>\n</span>\nHTML\n                , 'px-4 pt-3 pb-3');\n            $el->body($last5_html, null, 'px-4 pt-1 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last projects.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_projects') === '0') {\n\n            $project_html =\n                <<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_projects']) === 0) {\n\n                $project_html .=\n                    <<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"align-middle text-center text-uppercase text-secondary pb-4\">\n                {$this->lang->t9n('No projects')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_projects'] as $project) {\n\n                $item_url = IL_BASE_URL . 'index.php/project#project/browse?id=' . $project['id'];\n\n                $project_html .=\n                    <<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                <a href=\"{$item_url}\">{$project['project']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $project_html .=\n                <<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<span>\n    <b class=\"text-uppercase\">{$this->lang->t9n('Projects')}</b>\n    <a class=\"mx-3\" href=\"#projects/main\">{$this->lang->t9n('List-NOUN')}</a>\n</span>\nHTML\n                , 'px-4 pt-3');\n            $el->body($project_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last item notes.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_item_notes') === '0') {\n\n            $notes_html =\n<<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_notes']) === 0) {\n\n                $notes_html .=\n<<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase align-middle pb-4\">\n                {$this->lang->t9n('No notes')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_notes'] as $item) {\n\n                $item_url = IL_BASE_URL . 'index.php/item#notes?id=' . $item['id'];\n\n                $note = $this->sanitation->lmth($item['note']);\n\n                $notes_html .=\n<<<HTML\n        <tr>\n            <td class=\"text-truncate\" style=\"direction: rtl\">\n                <a href=\"{$item_url}\">{$note}&lrm;</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $notes_html .=\n<<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n<<<HTML\n<b class=\"text-uppercase\">{$this->lang->t9n('Item notes')}</b>\nHTML\n                , 'px-4 pt-3');\n            $el->body($notes_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Project notes.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_project_notes') === '0') {\n\n            $project_notes =\n                <<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_project_notes']) === 0) {\n\n                $project_notes .=\n                    <<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase align-middle pb-4\">\n                {$this->lang->t9n('No notes')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_project_notes'] as $project) {\n\n                $item_url = IL_BASE_URL . 'index.php/project#project/notes?id=' . $project['id'];\n\n                $project_notes .=\n                    <<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                <a href=\"{$item_url}\">{$project['note']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $project_notes .=\n                <<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<b class=\"text-uppercase\">{$this->lang->t9n('Project notes')}</b>\nHTML\n                , 'px-4 pt-3');\n            $el->body($project_notes, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last items discussed.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_item_discussions') === '0') {\n\n            $discussed_html =\n<<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_discussed']) === 0) {\n\n                $discussed_html .=\n<<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase pb-4 align-middle\">\n                {$this->lang->t9n('No posts')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_discussed'] as $item) {\n\n                $item_url = IL_BASE_URL . 'index.php/item#itemdiscussion?id=' . $item['id'];\n\n                $discussed_html .=\n<<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                <a href=\"{$item_url}\">{$item['message']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $discussed_html .=\n<<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n<<<HTML\n<b class=\"text-uppercase\">{$this->lang->t9n('Item discussions')}</b>\nHTML\n                , 'px-4 pt-3');\n            $el->body($discussed_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last projects discussed.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_project_discussions') === '0') {\n\n            $discussed_html =\n                <<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_discussed_projects']) === 0) {\n\n                $discussed_html .=\n                    <<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase pb-4 align-middle\">\n                {$this->lang->t9n('No posts')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_discussed_projects'] as $project) {\n\n                $item_url = IL_BASE_URL . 'index.php/project#project/discussion?id=' . $project['project_id'];\n\n                $discussed_html .=\n                    <<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                <a href=\"{$item_url}\">{$project['message']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $discussed_html .=\n                <<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<b class=\"text-uppercase\">{$this->lang->t9n('Project discussions')}</b>\nHTML\n                , 'px-4 pt-3');\n            $el->body($discussed_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Active sessions.\n         */\n\n        /** @var Temporal $temporal */\n        $temporal = $this->di->get('Temporal');\n\n        $active_sessions = $this->session->readSessionFiles($data['sessions']);\n\n        $sessions_card =\n<<<HTML\n<div class=\"pl-4 text-uppercase\">{$this->lang->t9n('Logged devices')}</div>\nHTML;\n\n        foreach ($active_sessions as $active_session) {\n\n            $created = $temporal->toUserTime($active_session['created']);\n            $updated = $temporal->toUserTime($active_session['last_accessed']);\n\n            $sessions_card .=\n<<<HTML\n<table class=\"ml-4 mb-2 text-muted\">\n    <tbody>\n        <tr>\n            <td class=\"align-top pr-3 text-primary\">\n                <small><b class=\"text-uppercase\">{$this->lang->t9n('Client IP')}</b></small>\n            </td>\n            <td>\n                {$active_session['remote_ip']}\n            </td>\n        </tr>\n        <tr>\n            <td class=\"align-top pr-3\">\n                <small><b class=\"text-uppercase\">{$this->lang->t9n('Software')}</b></small>\n            </td>\n            <td>\n                {$active_session['user_agent']}\n            </td>\n        </tr>\n        <tr>\n            <td class=\"align-top pr-3\">\n                <small><b class=\"text-uppercase\">{$this->lang->t9n('Started')}</b></small>\n            </td>\n            <td>\n                $created\n            </td>\n        </tr>\n        <tr>\n            <td class=\"align-top pr-3\">\n                <small><b class=\"text-uppercase\">{$this->lang->t9n('Last access')}</b></small>\n            </td>\n            <td>\n                $updated\n            </td>\n        </tr>\n    </tbody>\n</table>\nHTML;\n        }\n\n        /*\n         * Row.\n         */\n\n        /** @var Bootstrap\\Row $el */\n        $el = $this->di->get('Row');\n\n        $el->addClass('d-flex align-content-start no-gutters');\n        $el->column($bc, 'col-12');\n        $el->column($cards[0] ?? '', 'col-xl-6 mb-3 pr-xl-2');\n        $el->column($cards[1] ?? '', 'col-xl-6 mb-3 pl-xl-2');\n        $el->column($cards[2] ?? '', 'col-xl-6 mb-3 pr-xl-2');\n        $el->column($cards[3] ?? '', 'col-xl-6 mb-3 pl-xl-2');\n        $el->column($cards[4] ?? '', 'col-xl-6 mb-3 pr-xl-2');\n        $el->column($cards[5] ?? '', 'col-xl-6 mb-3 pl-xl-2');\n        $el->column($cards[6] ?? '', 'col-xl-6 mb-3 pr-xl-2');\n        $el->column($cards[7] ?? '', 'col-xl-6 mb-3 pl-xl-2');\n        $el->column($sessions_card, 'col-12 mb-3');\n\n        $content = $el->render();\n\n        /*\n         * Advanced search modal.\n         */\n\n        /** @var Bootstrap\\Button $el */\n        $el = $this->di->get('Button');\n\n        $el->addClass('search-submit');\n        $el->context('primary');\n        $el->html($this->lang->t9n('Search-VERB'));\n        $search_button = $el->render();\n\n        $el = null;\n\n        /** @var Bootstrap\\Modal $el */\n        $el = $this->di->get('Modal');\n\n        $el->id('modal-advanced-search');\n        $el->header($this->lang->t9n('Search library'));\n        $el->button($search_button);\n        $el->body($this->sharedAdvancedSearch($data['tags']), 'bg-darker-5');\n        $el->componentSize('large');\n        $content .= $el->render();\n\n        $el = null;\n\n        $this->append([\n            'html' => $content\n        ]);\n\n        return $this->send();\n    }\n}\n"], "fixing_code": ["<?php\n\nnamespace LibrarianApp;\n\nuse Exception;\nuse Librarian\\Html\\Bootstrap;\nuse Librarian\\Media\\Temporal;\nuse Librarian\\Mvc\\TextView;\n\nclass DashboardView extends TextView {\n\n    use SharedHtmlView;\n\n    /**\n     * Dashboard HTML.\n     *\n     * @param $data\n     * @return string\n     * @throws Exception\n     */\n    public function main($data) {\n\n        $this->title($this->lang->t9n('Dashboard'));\n\n        $this->head();\n\n        /** @var Bootstrap\\Breadcrumb $el */\n        $el = $this->di->get('Breadcrumb');\n\n        $el->style('margin: 0 -15px');\n        $el->addClass('bg-transparent');\n        $el->item('IL', '#dashboard');\n        $el->item($this->lang->t9n('Dashboard'));\n        $bc = $el->render();\n\n        $el = null;\n\n        // Cards array.\n        $cards = [];\n\n        /*\n         * Quick search.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_search') === '0') {\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->context('link');\n            $el->addClass('p-0 ml-3');\n            $el->style('transform: translateY(-2px)');\n            $el->attr('data-dismiss', 'modal');\n            $el->attr('data-toggle', 'modal');\n            $el->dataTarget('#modal-advanced-search');\n            $el->html($this->lang->t9n('Advanced'));\n            $advanced_button = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->context('link');\n            $el->addClass('p-0 ml-3');\n            $el->style('transform: translateY(-2px)');\n            $el->attr('data-dismiss', 'modal');\n            $el->attr('data-toggle', 'modal');\n            $el->dataTarget('#modal-searches');\n            $el->html($this->lang->t9n('Previous'));\n            $searches_button = $el->render();\n\n            $el = null;\n\n            $search_html = $this->sharedQuickSearch();\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n<<<HTML\n<div>\n    <b class=\"text-uppercase\">{$this->lang->t9n('Search-NOUN')}</b> $advanced_button $searches_button\n</div>\nHTML\n            , 'px-4 pt-3');\n            $el->body($search_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Import panel.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_import') === '0') {\n\n            $button_class = $this::$theme === 'dark' ? 'secondary' : 'light';\n            $help_class = $this::$theme === 'dark' ? 'dark' : 'secondary';\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->elementName('a');\n            $el->href('#import/uid');\n            $el->context($button_class);\n            $el->addClass('btn-block mb-4 py-3 rounded-0');\n            $el->html(\n<<<EOT\n<h5>DOI, Pubmed ID&hellip;</h5>\n<span class=\"text-{$help_class}\">10.2234/26548.225</span>\nEOT\n                );\n            $card_uid = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->elementName('a');\n            $el->href('#import/file');\n            $el->context($button_class);\n            $el->addClass('btn-block mb-4 py-3 rounded-0');\n            $el->html(\n<<<EOT\n<h5>{$this->lang->t9n('Published PDFs')}</h5>\n<span class=\"mdi mdi-24px mdi-file-pdf-box text-{$help_class}\"></span>\n<span class=\"text-{$help_class}\">+ 10.2234/2654.225</span>\nEOT\n            );\n            $card_file = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->elementName('a');\n            $el->href('#import/text');\n            $el->context($button_class);\n            $el->addClass('btn-block mb-4 py-3 rounded-0');\n            $el->html(\n<<<EOT\n<h5>RIS, BibTex, Endnote</h5>\n<span class=\"text-{$help_class}\">@article{Smith2011</span>\nEOT\n            );\n            $card_text = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Button $el */\n            $el = $this->di->get('Button');\n\n            $el->elementName('a');\n            $el->href('#import/manual');\n            $el->context($button_class);\n            $el->addClass('btn-block mb-4 py-3 rounded-0');\n            $el->html(\n<<<EOT\n<h5>{$this->lang->t9n('Unpublished file')}</h5>\n<span class=\"mdi mdi-24px mdi-file-word-box text-{$help_class}\"></span>\n<span class=\"mdi mdi-24px mdi-image text-{$help_class}\"></span>\n<span class=\"mdi mdi-24px mdi-file-pdf-box text-{$help_class}\"></span>\nEOT\n            );\n            $card_manual = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Row $el */\n            $el = $this->di->get('Row');\n\n            $el->column($card_uid, 'col-sm-6');\n            $el->column($card_file, 'col-sm-6');\n            $el->column($card_manual, 'col-sm-6');\n            $el->column($card_text, 'col-sm-6');\n            $button_row = $el->render();\n\n            $el = null;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<span>\n    <b class=\"text-uppercase\">{$this->lang->t9n('Import')}</b>\n</span>\nHTML\n                , 'px-4 pt-3');\n            $el->body($button_row, null, 'px-4 pb-2');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last items.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_items') === '0') {\n\n            $last5_html =\n                <<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_items']) === 0) {\n\n                $last5_html .=\n                    <<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase pb-4 align-middle\">\n                {$this->lang->t9n('No items')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_items'] as $item) {\n\n                $item_url = IL_BASE_URL . 'index.php/item#summary?id=' . $item['id'];\n\n                if ((int) $item['has_pdf'] === 1) {\n\n                    /** @var Bootstrap\\Badge $el */\n                    $el = $this->di->get('Badge');\n\n                    $el->context('warning');\n                    $el->addClass('mr-2 border border-warning');\n                    $el->html('PDF');\n                    $pdf_badge = $el->render();\n\n                    $el = null;\n\n                    $pdf_url = IL_BASE_URL . 'index.php/pdf?id=' . $item['id'];\n                    $pdf_button = \"<a href=\\\"{$pdf_url}\\\">{$pdf_badge}</a>\";\n\n                } else {\n\n                    /** @var Bootstrap\\Badge $el */\n                    $el = $this->di->get('Badge');\n\n                    $el->context('default');\n                    $el->addClass('mr-2 border border-secondary text-secondary');\n                    $el->html('PDF');\n                    $pdf_button = $el->render();\n\n                    $el = null;\n                }\n\n                $last5_html .=\n                    <<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                $pdf_button\n                <a href=\"{$item_url}\">{$item['title']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $last5_html .=\n                <<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<span>\n    <b class=\"text-uppercase\">{$this->lang->t9n('Items')}</b>\n    <a class=\"mx-3\" href=\"#items/main\">{$this->lang->t9n('List-NOUN')}</a>\n    <a href=\"#items/filter\">{$this->lang->t9n('Filter-NOUN')}</a>\n</span>\nHTML\n                , 'px-4 pt-3 pb-3');\n            $el->body($last5_html, null, 'px-4 pt-1 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last projects.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_projects') === '0') {\n\n            $project_html =\n                <<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_projects']) === 0) {\n\n                $project_html .=\n                    <<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"align-middle text-center text-uppercase text-secondary pb-4\">\n                {$this->lang->t9n('No projects')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_projects'] as $project) {\n\n                $item_url = IL_BASE_URL . 'index.php/project#project/browse?id=' . $project['id'];\n\n                $project_html .=\n                    <<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                <a href=\"{$item_url}\">{$project['project']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $project_html .=\n                <<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<span>\n    <b class=\"text-uppercase\">{$this->lang->t9n('Projects')}</b>\n    <a class=\"mx-3\" href=\"#projects/main\">{$this->lang->t9n('List-NOUN')}</a>\n</span>\nHTML\n                , 'px-4 pt-3');\n            $el->body($project_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last item notes.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_item_notes') === '0') {\n\n            $notes_html =\n<<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_notes']) === 0) {\n\n                $notes_html .=\n<<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase align-middle pb-4\">\n                {$this->lang->t9n('No notes')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_notes'] as $item) {\n\n                $item_url = IL_BASE_URL . 'index.php/item#notes?id=' . $item['id'];\n\n                $note = $this->sanitation->lmth($item['note']);\n\n                $notes_html .=\n<<<HTML\n        <tr>\n            <td class=\"text-truncate\" style=\"direction: rtl\">\n                <a href=\"{$item_url}\">{$note}&lrm;</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $notes_html .=\n<<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n<<<HTML\n<b class=\"text-uppercase\">{$this->lang->t9n('Item notes')}</b>\nHTML\n                , 'px-4 pt-3');\n            $el->body($notes_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Project notes.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_project_notes') === '0') {\n\n            $project_notes =\n                <<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_project_notes']) === 0) {\n\n                $project_notes .=\n                    <<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase align-middle pb-4\">\n                {$this->lang->t9n('No notes')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_project_notes'] as $project) {\n\n                $item_url = IL_BASE_URL . 'index.php/project#project/notes?id=' . $project['id'];\n\n                $project_notes .=\n                    <<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                <a href=\"{$item_url}\">{$project['note']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $project_notes .=\n                <<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<b class=\"text-uppercase\">{$this->lang->t9n('Project notes')}</b>\nHTML\n                , 'px-4 pt-3');\n            $el->body($project_notes, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last items discussed.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_item_discussions') === '0') {\n\n            $discussed_html =\n<<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_discussed']) === 0) {\n\n                $discussed_html .=\n<<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase pb-4 align-middle\">\n                {$this->lang->t9n('No posts')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_discussed'] as $item) {\n\n                $item_url = IL_BASE_URL . 'index.php/item#itemdiscussion?id=' . $item['id'];\n\n                $discussed_html .=\n<<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                <a href=\"{$item_url}\">{$item['message']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $discussed_html .=\n<<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n<<<HTML\n<b class=\"text-uppercase\">{$this->lang->t9n('Item discussions')}</b>\nHTML\n                , 'px-4 pt-3');\n            $el->body($discussed_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Last projects discussed.\n         */\n\n        if ($this->app_settings->getUser('dashboard_remove_project_discussions') === '0') {\n\n            $discussed_html =\n                <<<HTML\n<table style=\"table-layout: fixed;width:100%;line-height: 2rem\">\n    <tbody>\nHTML;\n\n            if (count($data['last_discussed_projects']) === 0) {\n\n                $discussed_html .=\n                    <<<HTML\n        <tr>\n            <td style=\"height: 10rem\" class=\"text-center text-secondary text-uppercase pb-4 align-middle\">\n                {$this->lang->t9n('No posts')}\n            </td>\n        </tr>\nHTML;\n            }\n\n            foreach ($data['last_discussed_projects'] as $project) {\n\n                $item_url = IL_BASE_URL . 'index.php/project#project/discussion?id=' . $project['project_id'];\n\n                $discussed_html .=\n                    <<<HTML\n        <tr>\n            <td class=\"text-truncate\">\n                <a href=\"{$item_url}\">{$project['message']}</a>\n            </td>\n        </tr>\nHTML;\n            }\n\n            $discussed_html .=\n                <<<HTML\n    </tbody>\n</table>\nHTML;\n\n            /** @var Bootstrap\\Card $el */\n            $el = $this->di->get('Card');\n\n            $el->addClass('h-100');\n            $el->header(\n                <<<HTML\n<b class=\"text-uppercase\">{$this->lang->t9n('Project discussions')}</b>\nHTML\n                , 'px-4 pt-3');\n            $el->body($discussed_html, null, 'px-4 pb-4');\n            $cards[] = $el->render();\n\n            $el = null;\n        }\n\n        /*\n         * Active sessions.\n         */\n\n        /** @var Temporal $temporal */\n        $temporal = $this->di->get('Temporal');\n\n        $active_sessions = $this->session->readSessionFiles($data['sessions']);\n\n        $sessions_card =\n<<<HTML\n<div class=\"pl-4 text-uppercase\">{$this->lang->t9n('Logged devices')}</div>\nHTML;\n\n        foreach ($active_sessions as $active_session) {\n\n            $created = $temporal->toUserTime($active_session['created']);\n            $updated = $temporal->toUserTime($active_session['last_accessed']);\n            $user_agent = $this->sanitation->html($active_session['user_agent']);\n\n            $sessions_card .=\n<<<HTML\n<table class=\"ml-4 mb-2 text-muted\">\n    <tbody>\n        <tr>\n            <td class=\"align-top pr-3 text-primary\">\n                <small><b class=\"text-uppercase\">{$this->lang->t9n('Client IP')}</b></small>\n            </td>\n            <td>\n                {$active_session['remote_ip']}\n            </td>\n        </tr>\n        <tr>\n            <td class=\"align-top pr-3\">\n                <small><b class=\"text-uppercase\">{$this->lang->t9n('Software')}</b></small>\n            </td>\n            <td>\n                <small>{$user_agent}</small>\n            </td>\n        </tr>\n        <tr>\n            <td class=\"align-top pr-3\">\n                <small><b class=\"text-uppercase\">{$this->lang->t9n('Started')}</b></small>\n            </td>\n            <td>\n                $created\n            </td>\n        </tr>\n        <tr>\n            <td class=\"align-top pr-3\">\n                <small><b class=\"text-uppercase\">{$this->lang->t9n('Last access')}</b></small>\n            </td>\n            <td>\n                $updated\n            </td>\n        </tr>\n    </tbody>\n</table>\nHTML;\n        }\n\n        /*\n         * Row.\n         */\n\n        /** @var Bootstrap\\Row $el */\n        $el = $this->di->get('Row');\n\n        $el->addClass('d-flex align-content-start no-gutters');\n        $el->column($bc, 'col-12');\n        $el->column($cards[0] ?? '', 'col-xl-6 mb-3 pr-xl-2');\n        $el->column($cards[1] ?? '', 'col-xl-6 mb-3 pl-xl-2');\n        $el->column($cards[2] ?? '', 'col-xl-6 mb-3 pr-xl-2');\n        $el->column($cards[3] ?? '', 'col-xl-6 mb-3 pl-xl-2');\n        $el->column($cards[4] ?? '', 'col-xl-6 mb-3 pr-xl-2');\n        $el->column($cards[5] ?? '', 'col-xl-6 mb-3 pl-xl-2');\n        $el->column($cards[6] ?? '', 'col-xl-6 mb-3 pr-xl-2');\n        $el->column($cards[7] ?? '', 'col-xl-6 mb-3 pl-xl-2');\n        $el->column($sessions_card, 'col-12 mb-3');\n\n        $content = $el->render();\n\n        /*\n         * Advanced search modal.\n         */\n\n        /** @var Bootstrap\\Button $el */\n        $el = $this->di->get('Button');\n\n        $el->addClass('search-submit');\n        $el->context('primary');\n        $el->html($this->lang->t9n('Search-VERB'));\n        $search_button = $el->render();\n\n        $el = null;\n\n        /** @var Bootstrap\\Modal $el */\n        $el = $this->di->get('Modal');\n\n        $el->id('modal-advanced-search');\n        $el->header($this->lang->t9n('Search library'));\n        $el->button($search_button);\n        $el->body($this->sharedAdvancedSearch($data['tags']), 'bg-darker-5');\n        $el->componentSize('large');\n        $content .= $el->render();\n\n        $el = null;\n\n        $this->append([\n            'html' => $content\n        ]);\n\n        return $this->send();\n    }\n}\n"], "filenames": ["app/views/dashboard.php"], "buggy_code_start_loc": [611], "buggy_code_end_loc": [631], "fixing_code_start_loc": [612], "fixing_code_end_loc": [632], "type": "CWE-79", "message": "Cross-site Scripting (XSS) - Stored in GitHub repository mkucej/i-librarian-free prior to 5.10.4.", "other": {"cve": {"id": "CVE-2023-3021", "sourceIdentifier": "security@huntr.dev", "published": "2023-05-31T17:15:09.637", "lastModified": "2023-06-06T19:30:22.443", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Cross-site Scripting (XSS) - Stored in GitHub repository mkucej/i-librarian-free prior to 5.10.4."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:N/I:N/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "NONE", "integrityImpact": "NONE", "availabilityImpact": "LOW", "baseScore": 4.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 1.4}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:scilico:i\\,_librarian:*:*:*:*:*:*:*:*", "versionEndExcluding": "5.10.4", "matchCriteriaId": "513B3BAD-180D-4EF2-A57E-8EAE08875245"}]}]}], "references": [{"url": "https://github.com/mkucej/i-librarian-free/commit/187e5ff4f413047fb522a9ab24c3c42555d7cfe7", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/9d289d3a-2931-4e94-b61c-449581736eff", "source": "security@huntr.dev", "tags": ["Exploit", "Patch"]}]}, "github_commit_url": "https://github.com/mkucej/i-librarian-free/commit/187e5ff4f413047fb522a9ab24c3c42555d7cfe7"}}