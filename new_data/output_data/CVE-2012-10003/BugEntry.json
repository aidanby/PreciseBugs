{"buggy_code": ["<?php\nrequire (\"config.php\");\nrequire (\"funcsv2.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html><head><title>Torrent Information</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head><body>\n<?php\nrequire_once(\"torrent_functions.php\");\n?>\n<table width=\"50%\" border=0><tr><td>\nThis script parses a torrent file and displays detailed information about it.\n</td></tr>\n</table><br>\n<form enctype=\"multipart/form-data\" method=\"POST\" action=\"<?php echo $_SERVER[\"PHP_SELF\"]; ?>\">\nTorrent file: <input type=\"file\" name=\"torrent\" size=\"40\"><br>\n<br>\nOR\n<br><br>\nTorrent URL: <input type=text name=\"url\" size=\"50\"><br><br>\nOutput type: <select name=\"output\">\n<option value=\"-1\">Auto-detect\n<option value=\"0\">Classic (raw)\n<option value=\"1\">.torrent file\n<option value=\"2\">/scrape\n<option value=\"3\">/announce\n</select><br><br>\n<input type=\"submit\" value=\"Decode\">\n</form>\n\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body></html>\n", "<?php\n\nrequire (\"config.php\");\nrequire (\"funcsv2.php\"); //required for errorMessage() function\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n<html>\n<head>\n\t<title>Batch Upload Torrents</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head>\n<body>\n<center>\n<h1>Batch Upload Torrents</h1>\n</center>\n<br>\n\n<?php\n\nif (isset($_FILES[\"zipfile\"]) && $_FILES[\"zipfile\"][\"error\"] != 4 && isset($_FILES[\"zipfile\"][\"tmp_name\"])) //4 corresponds to the error no file uploaded\n{\n\t?>\n\t<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n\t<br><br>\n\t<?php\n\t$zip = zip_open($_FILES[\"zipfile\"][\"tmp_name\"]);\n\t\n\tif ($zip == true)\n\t{\n\t\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Couldn't connect to the database, contact the administrator</p>\");\n\t\tmysql_select_db($database) or die(errorMessage() . \"Can't open the database.</p>\");\n\t\n\t   while ($zip_entry = zip_read($zip))\n\t   {\n\t   \techo \"Name: \" . zip_entry_name($zip_entry) . \"<br>\\n\";\n\t      if (substr(zip_entry_name($zip_entry), -8) == \".torrent\")\n\t\t\t{\n\t\t\t\t$error_status = true;\n\t\t\t\tif (zip_entry_open($zip, $zip_entry, \"r\"))\n\t\t\t   {\n\t\t\t   \t//read in file from zip\n\t\t\t  \t\t$buffer = zip_entry_read($zip_entry, zip_entry_filesize($zip_entry));\n\t\t\t      //go through each torrent file and add it if possible\n\t\t\t\t\trequire_once (\"BDecode.php\");\n\t\t\t\t\trequire_once (\"BEncode.php\");\n\t\t\t\t\t\n\t\t\t\t\t$tracker_url = $website_url . substr($_SERVER['REQUEST_URI'], 0, -16) . $announceurl;\n\t\t\t\t\t\n\t\t\t\t\t$array = BDecode($buffer);\n\t\t\t\t\tif (!$array)\n\t\t\t\t\t{\n\t\t\t\t\t\techo errorMessage() . \"Error: The parser was unable to load this torrent.</p>\\n\";\n\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (isset($array[\"announce-list\"])) {\n\t\t\t\t\t\t//multiple trackers are listed\n\t\t\t\t\t\t$found_tracker = false;\n\t\t\t\t\t\tfor ($i = 0; $i < count($array[\"announce-list\"]); $i++) {\n\t\t\t\t\t\t\tif (strtolower($array[\"announce-list\"][$i][0]) == $tracker_url) {\n\t\t\t\t\t\t\t\t$found_tracker = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ($found_tracker == false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\techo errorMessage() . \"Error: Multiple trackers were found but none of them match the\n\t\t\t\t\t\t\t\tannounce URL:<br>$tracker_url<br>Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t\t\texit;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//a single tracker is listed\n\t\t\t\t\t\tif (strtolower($array[\"announce\"]) != $tracker_url) {\n\t\t\t\t\t\t\techo errorMessage() . \"Error: The tracker announce URL does not match this:<br>$tracker_url<br>Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t\t\texit;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (function_exists(\"sha1\"))\n\t\t\t\t\t\t$hash = @sha1(BEncode($array[\"info\"]));\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\techo errorMessage() . \"Error: It looks like you do not have a hash function available, this will not work.</p>\\n\";\n\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t//figure out total size of all files in torrent, needed for insertion into database\n\t\t\t\t\t$info = $array[\"info\"];\n\t\t\t\t\t$total_size = 0;\n\t\t\t\t\tif (isset($info[\"files\"]))\n\t\t\t\t\t{\n\t\t\t\t\t\tforeach ($info[\"files\"] as $file)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$total_size = $total_size + $file[\"length\"];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$total_size = $info[\"length\"];\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//Validate torrent file, make sure everything is correct\n\t\t\t\t\t$filename = $array[\"info\"][\"name\"];\n\t\t\t\t\t$filename = mysql_real_escape_string($filename);\n\t\t\t\t\t$filename = stripslashes($filename);\n\t\t\t\t\t$filename = clean($filename);\n\t\t\t\t\n\t\t\t\t\tif ((strlen($hash) != 40) || !verifyHash($hash))\n\t\t\t\t\t{\n\t\t\t\t\t\techo errorMessage() . \"Error: Info hash must be exactly 40 hex bytes.</p>\\n\";\n\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\t\tif ($error_status == true)\n\t\t\t\t\t{\n\t\t\t\t\t\t$query = \"INSERT INTO \" . $prefix . \"namemap (info_hash, filename, url, size, pubDate) VALUES (\\\"$hash\\\", \\\"$filename\\\", \\\"$url\\\", \\\"$total_size\\\", \\\"\" . date('D, j M Y h:i:s') . \"\\\")\";\n\t\t\t\t\t\t$status = makeTorrent($hash, true);\n\t\t\t\t\t\tquickQuery($query);\n\t\t\t\t\t\tif ($status == true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t//create torrent file in folder, at this point we assume it's valid\n\t\t\t\t\t\t\tif (!$handle = fopen(\"torrents/\" . $filename . \".torrent\", 'w'))\n\t\t\t\t\t\t\t{\n\t         \t\t\t\techo errorMessage() . \"Error: Can't write to file.</p>\\n\";\n\t        \t\t\t\t\tbreak;\n\t    \t\t\t\t\t}\n\t\t\t\t\t\t\t//populate file with contents\n\t\t\t\t\t   \tif (fwrite($handle, $buffer) === FALSE)\n\t\t\t\t\t   \t{\n\t\t\t\t\t       \techo errorMessage() . \"Error: Can't write to file.</p>\\n\";\n\t\t\t\t\t      \tbreak;\n\t\t\t\t\t   \t}\n\t\t\t\t\t   \tfclose($handle);\n\t\t\t\t\t\t\t//make torrent file readable by all\n\t\t\t\t\t\t\tchmod(\"torrents/\" . $filename . \".torrent\", 0644);\n\t\t\t\t\t\t\techo \"<p class=\\\"success\\\">Torrent was added successfully.</p>\\n\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\techo errorMessage() . \"There were some errors. Check if this torrent has been added previously.</p>\\n\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\n\t\t\t      zip_entry_close($zip_entry);\n\t\t\t    }\n\t\t\t} \n\t\t\telse\n\t\t\t\techo errorMessage() . \"Unable to add torrent, it doesn't end in .torrent</p>\\n\";\n\t\t\t\n\t\techo \"<br>\";\n\t   }\n\t   zip_close($zip);\n\t}\n\n\t//finished reading zip file\n\t\n\t//run RSS generator because we have new torrents in database\n\trequire_once(\"rss_generator.php\");\n\n\n}\nelse\n{\n\t//display upload box\n\t?>\n\t<?php require(\"config.php\"); $tracker_url = $website_url . substr($_SERVER['REQUEST_URI'], 0, -16) . $announceurl; ?>\n\t<p>This page lets you upload a zip file containing multiple torrents and add them into the database.  The\n\tzip file cannot have any folders in it.  This requires that you are running PHP with compiled zip support.\n\tIf you are unsure, check with your system administrator or phpinfo().  Any torrents that already exist in\n\tthe database will be skipped.  If you want to use HTTP seeding you'll need to add this feature to the torrent\n\tfiles before you zip and upload the file.  If you are uploading a very large zip file this may take some time...\n\t<br>\n\t<br>\n\tThe torrents you are batch uploading should include the following Tracker URL: <b><?php echo $tracker_url ?></b></p>\n\t\n\t<?php\n\tif (function_exists(\"zip_open\"))\n\t{\n\t\t?>\n\t\t<form enctype=\"multipart/form-data\" action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\" method=\"post\">\n\t\t<b>Zip File:</b><input type=\"file\" name=\"zipfile\" size=\"50\"/>\n\t\t<input type=\"submit\" value=\"Upload ZIP File\"/>\n\t\t</form>\n\t\t<?php\n\t}\n\telse\n\t\techo errorMessage() . \"Error: It looks like you don't have ZIP support compiled into PHP.</p>\\n\";\n}\n\n?>\n\n<br>\n<br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body>\n</html>\n", "<?php\n\nrequire (\"config.php\");\nrequire (\"funcsv2.php\"); //required for errorMessage() function\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n<html>\n<head>\n\t<title>Change CSS File</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n\t<style type=\"text/css\">\n\t\ttd.cell{\n\t\t\twidth: 2%;\n\t\t\t}\n\t</style>\n\t<script type=\"text/javascript\">\n\tfunction changeColor(color)\n\t{\n\t\tdocument.getElementById(\"color_box\").value = color;\n\t\tdocument.getElementById(\"thecolor\").style.backgroundColor = color;\n\t}\n\t</script>\n</head>\n<body>\n<center>\n<h1>Change CSS File</h1>\n</center>\n<br>\n\n<?php\n\nif (isset($_POST[\"set_css\"]))\n{\n\t//delete style.css file\n\tif (copy(\"./css/\" . $_POST[\"set_css\"], \"./css/style.css\"))\n\t\techo \"<p class=\\\"success\\\">style.css file has been replaced with \" . $_POST[\"set_css\"] . \"</p>\";\n\telse\n\t{\n\t\techo errorMessage() . \"Error: Unable to copy over style.css, are the permissions correct?</p>\";\n\t\texit();\n\t}\n}\nelseif (isset($_POST[\"delete_css\"]))\n{\n\t//delete css file\n\tif (unlink(\"./css/\" . $_POST[\"delete_css\"]))\n\t\techo \"<p class=\\\"success\\\">\" . $_POST[\"delete_css\"] . \" has been deleted</p>\";\n\telse\n\t{\n\t\techo errorMessage() . \"Error: Unable to delete \" . $_POST[\"delete_css\"] . \", are you sure the permissions are correct?</p>\";\n\t\texit();\n\t}\n}\nelseif (isset($_POST[\"create_css\"]))\n{\n\t//create new css file by copying over style.css into new file\n\tif (substr($_POST[\"create_css\"], -4) == \".css\")\n\t{\n\t\tif (!file_exists(\"./css/\" . $_POST[\"create_css\"]))\n\t\t{\n\t\t\tif (copy(\"./css/style.css\", \"./css/\" . $_POST[\"create_css\"]))\n\t\t\t\techo \"<p class=\\\"success\\\">\" . $_POST[\"create_css\"] . \", was created successfuly</p>\";\n\t\t\telse\n\t\t\t{\n\t\t\t\techo errorMessage() . \"Error: Unabled to create \" . $_POST[\"create_css\"] . \", are you sure the permissions are correct?</p>\";\n\t\t\t\texit();\t\t\t\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\techo errorMessage() . \"Error: \" . $_POST[\"create_css\"] . \" already exists, please choose a different name</p>\";\n\t\t\texit();\n\t\t}\n\t}\n\telse\n\t{\n\t\techo errorMessage() . \"Error: Your file doesn't end with .css</p>\";\n\t\texit();\n\t}\n}\n\nif (isset($_POST[\"create_css\"]) || isset($_POST[\"edit_css\"]))\n{\n\t//display color picker\n\t?>\n\t<h2>Color Picker:</h2>\n\t<table style=\"cursor: pointer;\" border=\"0\">\n\t<?php\n\tfunction rgbhex($red, $green, $blue)\n\t{\n\t\treturn sprintf('#%02X%02X%02X', $red, $green, $blue);\n\t}\n\t\n\t//create table of 216 web safe colors\n\tfor ($red = 0; $red < 256; $red = $red + 51)\n\t{\n\t\techo \"<tr>\";\n\t\tfor ($green = 0; $green < 256; $green = $green + 51)\n\t\t{\n\t\t\tfor ($blue = 0; $blue < 256; $blue = $blue + 51)\n\t\t\t{\n\t\t\t\t$hexcolor = rgbhex($red, $green, $blue);\n\t\t\t\techo \"<td bgcolor='\" . $hexcolor . \"' title='\" . $hexcolor . \"' class='cell' onClick=\\\"changeColor('\" . $hexcolor . \"')\\\">&nbsp;</td>\\n\";\n\t\t\t}\n\t\t}\n\t\techo \"</tr>\";\n\t}\n\t\n\t?>\n\t</table>\n\t<br>\n\t<b>Color:</b>\n\t<table border=\"0\"><tr>\n\t<td id=\"thecolor\" align=\"left\" bgcolor=\"#000000\"><input type=\"text\" id=\"color_box\" value=\"#000000\"/>\n\t</td></tr>\n\t</table>\n\t<br>\n\t<?php\n\t\n\tif (isset($_POST[\"create_css\"]))\n\t\t$filename = $_POST[\"create_css\"];\n\tif (isset($_POST[\"edit_css\"]))\n\t\t$filename = $_POST[\"edit_css\"];\n\t//display text box with css in it\n\t?>\n\t<h2>Editing File: <?php echo $filename;?></h2>\n\t<form action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\" method=\"post\">\n\t<input type=\"hidden\" name=\"hidden_filename\" value=\"<?php echo $filename;?>\"/>\n\t<input type=\"hidden\" name=\"current_css_file\" value=\"<?php echo $_POST['current_css_file'];?>\"/>\n\t<textarea name=\"file_contents\" cols=\"120\" rows=\"20\"><?php\n\t//open css file\n\treadfile(\"./css/\" . $filename);\n\t?></textarea>\n\t<br><br>\n\t<input type=\"submit\" value=\"Save File\"/>\n\t</form>\n\t<?php\n\t\n}\n\nif (isset($_POST[\"file_contents\"]))\n{\n\t//save previously edited text into file\n\tif (is_writable(\"./css/\" . $_POST[\"hidden_filename\"]))\n\t{\n\t\t//open file\n\t\t$stream = fopen(\"./css/\" . $_POST[\"hidden_filename\"], \"w\");\n\t\tfwrite($stream, $_POST[\"file_contents\"]);\n\t\tfclose($stream);\n\t\techo \"<p class=\\\"success\\\">\" . $_POST[\"hidden_filename\"] . \", was saved successfuly</p>\";\n\t}\n\telse\n\t{\n\t\techo errorMessage() . \"Error: The file cannot be saved, check the permissions</p>\";\n\t\texit();\n\t}\n\t//if editing the current css file, replace that too\n\tif ($_POST[\"current_css_file\"] == $_POST[\"hidden_filename\"])\n\t{\n\t\tif (copy(\"./css/\" . $_POST[\"hidden_filename\"], \"./css/style.css\"))\n\t\t\techo \"<p class=\\\"success\\\">style.css file has been replaced with \" . $_POST[\"hidden_filename\"] . \"</p>\";\n\t\telse\n\t\t{\n\t\t\techo errorMessage() . \"Error: Unable to copy over style.css, are the permissions correct?</p>\";\n\t\t\texit();\n\t\t}\n\t}\n}\n\nif (!isset($_POST[\"create_css\"]) && !isset($_POST[\"edit_css\"]) && !isset($_POST[\"delete_css\"]) && \n!isset($_POST[\"set_css\"]) && !isset($_POST[\"file_contents\"]))\n{\n\t//save all files in css directory to array\n\t$current_css_file = \"\";\n\t$css_style_md5 = md5_file(\"./css/style.css\");\n\t$number_files = 0;\n\tif ($dh = opendir(\"./css/\"))\n\t{\n\t\twhile (($file = readdir($dh)) !== false)\n\t\t{\n\t\t\tif (filetype(\"./css/\" . $file) == \"file\" && $file != \"index.php\" && $file != \"style.css\" && substr($file, -4) == \".css\")\n\t\t\t{\n\t\t\t\tif (md5_file(\"./css/\" . $file) == $css_style_md5)\n\t\t\t\t\t$current_css_file = $file;\n\t\t\t\t$files_array[$number_files] = $file;\n\t\t\t\t$number_files++;\n\t\t\t}\n\t\t}\n\t\tclosedir($dh);\n\t}\n\techo \"<b>Currently Used CSS File: \" . $current_css_file . \"</b><br><br>\";\n\t?>\n\t\n\t<form action=\"<?php echo $_SERVER['PHP_SELF'];?>\" method=\"post\">\n\t<b>Set CSS File:</b><select name=\"set_css\">\n\t<?php\n\tfor ($i = 0; $i < $number_files; $i++)\n\t{\n\t\tif ($files_array[$i] != $current_css_file) //no point setting it to itself...\n\t\t\techo \"<option value=\\\"\" . $files_array[$i] . \"\\\">\" . $files_array[$i] . \"</option>\\n\\t\";\n\t}\n\t?>\n\t</select>\n\t<input type=\"submit\" value=\"Set CSS File\"/>\n\t</form>\n\t<br><br>\n\t\n\t<form action=\"<?php echo $_SERVER['PHP_SELF'];?>\" method=\"post\"> \n\t<b>Delete CSS File:</b><select name=\"delete_css\">\n\t<?php\n\tfor ($i = 0; $i < $number_files; $i++)\n\t{\n\t\tif ($files_array[$i] != $current_css_file) //can't delete the file if it's already being used...\n\t\t\techo \"<option value=\\\"\" . $files_array[$i] . \"\\\">\" . $files_array[$i] . \"</option>\\n\\t\";\n\t}\n\t?>\n\t</select>\n\t<input type=\"submit\" value=\"Delete CSS File\"/>\n\t</form>\n\t<br><br>\n\t\n\t<form action=\"<?php echo $_SERVER['PHP_SELF'];?>\" method=\"post\">\n\t<input type=\"hidden\" name=\"current_css_file\" value=\"<?php echo $current_css_file;?>\"/>\n\t<b>Edit Existing CSS File:</b><select name=\"edit_css\">\n\t<?php\n\tfor ($i = 0; $i < $number_files; $i++)\n\t{\n\t\techo \"<option value=\\\"\" . $files_array[$i] . \"\\\">\" . $files_array[$i] . \"</option>\\n\\t\";\n\t}\n\t?>\n\t</select>\n\t<input type=\"submit\" value=\"Edit CSS File\"/>\n\t</form>\n\t<br><br>\n\t\n\t<form action=\"<?php echo $_SERVER['PHP_SELF'];?>\" method=\"post\"> \n\t<b>Create New CSS File (e.g. mycssfile.css):</b>\n\t<input type=\"text\" size=\"40\" name=\"create_css\"/>\n\t<input type=\"submit\" value=\"Create New CSS File\"/>\n\t</form>\n\t<?php\n}\n?>\n\n<br>\n<br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body>\n</html>\n", "<?php\nrequire (\"config.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n\t<title>Delete Torrent(s) From Database</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./css/style.css\" />\n\t<script language=\"javascript\">\n\tfunction selectRow(checkBox)\n\t{\n\t\tif (checkBox.value % 2 == 1) //odd\n\t\t\tvar Style = \"row1\";\n\t\telse //even\n\t\t\tvar Style = \"row0\";\n\t\tif (checkBox.checked == true)\n\t\t\tvar Style = \"selected\";\n\t\tvar el = checkBox.parentNode;\n\t\twhile(el.tagName.toLowerCase() != \"tr\")\n\t\t{\n\t\t\tel = el.parentNode;\n    \t\t}\n    \t\tel.className = Style;\n\t}\n\t</script>\n</head>\n<body>\n<form action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\"  method=\"POST\">\n<?php\nrequire_once(\"funcsv2.php\");\n\n// check database user\nif (isset($dbuser) && isset($dbpass))\n{\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Cannot connect to database. Check your username and password in the config file.</p>\");\n\tmysql_select_db($database) or die(errorMessage() . \"Error selecting database.</p>\");\n\n\tforeach ($_POST as $left => $right)\n\t{\n\t\tif (strlen($left) == 41)\n\t\t{\n\t\t\tif (!is_numeric($right) || !verifyHash(substr($left, 1)))\n\t\t\t\tcontinue;\n\t\t\t$hash = substr($left, 1);\n\t\t\t//delete torrent file\n\t\t\t$query = \"SELECT filename FROM \".$prefix.\"namemap WHERE info_hash =\\\"$hash\\\"\";\n\t\t\t$delete_file = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\t\t$delete = mysql_fetch_row($delete_file);\n\t\t\tunlink(\"torrents/\" . $delete[0] . \".torrent\");\n\t\t\t//continue deleting information in database\n\t\t\t@mysql_query(\"DELETE FROM \" . $prefix . \"summary WHERE info_hash=\\\"$hash\\\"\");\n\t\t\t@mysql_query(\"DELETE FROM \" . $prefix . \"namemap WHERE info_hash=\\\"$hash\\\"\"); \n\t\t\t@mysql_query(\"DELETE FROM \" . $prefix . \"timestamps WHERE info_hash=\\\"$hash\\\"\");\n\t\t\t@mysql_query(\"DELETE FROM \" . $prefix . \"webseedfiles WHERE info_hash=\\\"$hash\\\"\");\n\t\t\t@mysql_query(\"DROP TABLE \" . $prefix . \"y$hash\");\n\t\t\t@mysql_query(\"DROP TABLE \" . $prefix . \"x$hash\");\n\t\t\t//optimize tables, good after major changes have been made to database\n\t\t\t@mysql_query(\"OPTIMIZE TABLE \" . $prefix . \"summary\");\n\t\t\t@mysql_query(\"OPTIMIZE TABLE \" . $prefix . \"namemap\");\n\t\t\t@mysql_query(\"OPTIMIZE TABLE \" . $prefix . \"timestamps\");\n\t\t\t//run RSS generator\n\t\t\trequire_once(\"rss_generator.php\");\n\t\t}\n\t}\n}\nelse\n{\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\n\tmysql_select_db($database) or die(errorMessage() . \"Tracker error: can't open database $database - \" . mysql_error() . \"</p>\");\n\t$GLOBALS[\"maydelete\"] = false;\n}\n\n?>\n<h1>Delete Torrent(s) From Database</h1>\n<table class=\"torrentlist\" cellspacing=\"1\">\n<tr>\n\t<th>Name/Info Hash</th>\n\t<th>File Size</th>\n\t<th>Seeders</th>\n\t<th>Leechers</th>\n\t<th>Completed D/Ls</th>\n\t<th>Bytes Transfered</th>\n\t<th>Delete?</th>\n</tr>\n<?php\n\n$results = mysql_query(\"SELECT \".$prefix.\"summary.info_hash, \".$prefix.\"namemap.size, \".$prefix.\"summary.seeds, \".$prefix.\"summary.leechers, format(\".$prefix.\"summary.finished,0), format(\".$prefix.\"summary.dlbytes/1073741824,3), \".$prefix.\"namemap.filename FROM \".$prefix.\"summary LEFT JOIN \".$prefix.\"namemap ON \".$prefix.\"summary.info_hash = \".$prefix.\"namemap.info_hash ORDER BY \".$prefix.\"namemap.filename\") or die(errorMessage() . \"\" . mysql_error() . \"</p>\");\n\n$i = 0;\n\nwhile ($data = mysql_fetch_row($results)) {\n\t$writeout = \"row\" . $i % 2;\n\t$hash = $data[0];\n\tif (is_null($data[6]))\n\t\t$data[6] = $data[0];\n\tif (strlen($data[6]) == 0)\n\t\t$data[6] = $data[0];\n\t\t\n\techo \"<tr class=\\\"$writeout\\\">\\n\";\n\techo \"\\t<td>\".$data[6].\"</td>\\n\";\n\techo \"\\t<td>\".bytesToString($data[1]).\"</td>\\n\";\n\tfor ($j=2; $j < 5; $j++)\n\t\techo \"\\t<td class=\\\"center\\\">$data[$j]</td>\\n\";\n\techo \"\\t<td class=\\\"center\\\">$data[5] GB</td>\\n\";\n\t\n\techo \"\\t<td class=\\\"center\\\"><input type=\\\"checkbox\\\" name=\\\"x$hash\\\" value=\\\"$i\\\" onclick=\\\"selectRow(this);\\\"/></td>\\n\";\n\techo \"</tr>\\n\";\n\t$i++;\n}\n\n?>\n</table>\n<p class=\"error\">Warning: there is no confirmation for deleting files. Clicking this button is final.</p>\n<p class=\"center\"><input type=\"submit\" value=\"Delete\" /></p>\n</form>\n<a href=\"index.php\"><img src=\"images/stats.png\" border=\"0\" class=\"icon\" alt=\"Tracker Statistics\" title=\"Tracker Statistics\" /></a><a href=\"index.php\">Return to Statistics Page</a><br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body></html>\n", "<?php\nrequire (\"config.php\");\nrequire_once (\"funcsv2.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n<html>\n<head>\n\t<title>Edit Torrent in Database</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head>\n<body>\n<h1>Edit Torrent in Database</h1>\n<h2>This page allows you to edit torrents that are already in the database.  If you need to change other things about\nthe torrent please <a href=\"deleter.php\">delete it</a> and add it again.</h2>\n\t\n<?php\n\n//connect to database\nif ($GLOBALS[\"persist\"])\n\t$db = mysql_pconnect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\nelse\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\nmysql_select_db($database) or die(errorMessage() . \"Error selecting database.</p>\");\n\n//get filename from URL string\nif (isset($_GET['filename'])) {\n\t$filename = $_GET['filename'];\n}\n\n//if not edit database or filename set, display all torrents as links\nif (!isset($_POST[\"editdatabase\"]) && !isset($filename))\n{\n\t?>\n\t<p><strong>Click on a file to edit it:</strong></p>\n\t<table border=\"0\">\n\t<?php\n\t$query = \"SELECT filename FROM \".$prefix.\"namemap ORDER BY filename ASC\";\n\t$rows = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\n\twhile ($data = mysql_fetch_row($rows))\n\t{\n\t\techo \"<tr><td><a href=\\\"\" . $PHP_SELF . \"?filename=\" . rawurlencode($data[0]) . \"\\\">\" . $data[0] . \"</a></td></tr>\\n\";\n\t}\n\t?>\n\t</table>\n\t<?php\n}\n\nif (isset($filename) && !isset($_POST[\"editdatabase\"]))\n{\n\t$query = \"SELECT info_hash,filename,url,pubDate FROM \".$prefix.\"namemap WHERE filename = '\" . mysql_real_escape_string($filename) . \"'\";\n\t$rows = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\n\t$data = mysql_fetch_row($rows); //should be only one entry...\n\t?>\n\t<form action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\" method=\"POST\">\n\t<input type=\"hidden\" name=\"editdatabase\" value=\"1\">\n\t<input type=\"hidden\" name=\"<?php echo $data[0];?>\" value=\"<?php echo $data[0];?>\">\n\t<input type=\"hidden\" name=\"<?php echo $data[0] . \"_old_filename\";?>\" value=\"<?php echo $data[1];?>\">\n\t<table border=\"0\">\n\t<tr><td><b>Info Hash: </b></td><td><?php echo $data[0];?></td></tr>\n\t<tr><td><b>Filename:</b></td><td><input type=\"text\" name=\"<?php echo $data[0] . \"_filename\";?>\" size=\"60\" value=\"<?php echo $data[1];?>\"></td></tr>\n\t<tr><td><b>URL:</b></td><td><input type=\"text\" name=\"<?php echo $data[0] . \"_url\";?>\" size=\"60\" value=\"<?php echo $data[2];?>\"></td></tr>\n\t<tr><td><b>Publication Date:</b></td><td><input type=\"text\" name=\"<?php echo $data[0] . \"_pubDate\";?>\" size=\"60\" value=\"<?php echo $data[3];?>\"></td></tr>\n\t<tr><td><hr></td><td><hr></td></tr>\t\t\n\t\n\t</table>\n\t<br>\n\t<input type=\"submit\" value=\"Edit Entry\">\n\t</form>\n\t\n\t<?php\n}\n\n//write data to database\nif (isset($_POST[\"editdatabase\"]))\n{\n\t$temp_counter = (count($_POST)-1)/5;\n\tarray_shift($_POST);\n\t\n\tfor ($i = 0; $i < $temp_counter; $i++)\n\t{\n\t\t$temp_hash = htmlspecialchars(array_shift($_POST));\n\t\t$old_filename = htmlspecialchars(array_shift($_POST));\n\t\t$temp_filename = array_shift($_POST);\n\t\t$temp_filename = Ltrim($temp_filename);\n\t\t$temp_filename = htmlspecialchars(rtrim($temp_filename));\n\t\t$temp_url = htmlspecialchars(array_shift($_POST));\n\t\t$temp_pubDate = htmlspecialchars(array_shift($_POST));\n\t\t$query = \"UPDATE \".$prefix.\"namemap SET filename=\\\"$temp_filename\\\", url=\\\"$temp_url\\\", pubDate=\\\"$temp_pubDate\\\" WHERE info_hash=\\\"$temp_hash\\\"\";\n\t\tmysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\t//if filename changes, rename .torrent\n\t\tif ($old_filename != $temp_filename)\n\t\t\trename(\"torrents/\" . $old_filename . \".torrent\", \"torrents/\" . $temp_filename . \".torrent\");\n\t}\n\t\n\t//run RSS generator\n\trequire_once(\"rss_generator.php\");\n\t\n\techo \"<br><p class=\\\"success\\\">The database was edited successfully!</p>\\n\";\n}\n\n?>\n<br>\n<br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body>\n</html>\n", "<?php\nrequire (\"config.php\");\nrequire_once (\"funcsv2.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html><head><title>Edit Config File</title>\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head><body>\n\n<?php\n//open up config file and display for editing\nif (!isset($_POST[\"saveconfig\"]))\n{\n\t?>\n\t<h1>Edit Config File</h1>\n\t<form action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\" method=\"POST\">\n\t<input type=\"hidden\" name=\"saveconfig\" value=\"1\">\n\t<h2>This page allows you to configure the \"config.php\" settings.  This file stores all the necessary\n\tsettings for your tracker.  Please do NOT edit the \"config.php\" file directly, \n\tuse this admin page for any changes.</h2>\n\t<h2><span class=\"notice\">*</span> - required value</h2>\n\t<table border=\"1\" cellpadding=\"3\">\n\t<?php\n\t//open up config file\n\t$fr = fopen(\"config.php\", \"r\") or die(errorMessage() . \"Error: couldn't read config.php!</p>\");\n\t$temp = fgets($fr);\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Make tracker hidden: This will require a login by either the admin or upload user in order to\n\tsee the torrents available on the main statistics page.  This does not mean it's a private tracker.  If you\n\tneed a private tracker, there are many other trackers out there.  Also, you will need to secure the \"torrents\"\n\tfolder with an .htaccess file for Apache or some other method.  The tracker will still accept all valid\n\tconnections by clients.  There is no user checking in that regard.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"hiddentracker\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Enable or disable scraping by clients.  Generally it is safe to leave this on unless\n\tyou have a large number of torrents or users which can lead to increased bandwidth usage.  Also, scraping\n\tcan possibily be used maliciously by abusive clients.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"scrape\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td>Short Announce URL: You can turn on the short announce feature, making the URL end in /announce for your tracker. You should not utilize both tracker URL forms in one torrent at the same time, or you will get inconsistent results. Note: You will need the provided htaccess file, have URL rewrite capabilities, and have it properly set up to use this feature. Otherwise, leave it disabled.</td>\n\t<td><select name=\"announceurl\" id=\"announceurl\">\n\t<option title=\"disabled\" value=\"announce.php\"<?php if($temp == \"announce.php\") echo \" selected=\\\"selected\\\"\";?>>disabled</option>\n\t<option title=\"enabled\" value=\"announce\"<?php if($temp == \"announce\") echo \" selected=\\\"selected\\\"\";?>>enabled</option>\n\t</select>\n\t</td>\n\t</tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span>Lists the number of torrents on each page on your torrent tracker list. Default is 10.</td>\n\t<td><input type=\"text\" name=\"indexpagelimitspecify\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span>Lists the number of torrents on each page on the detailed statistics page. Default is 5.</td>\n\t<td><input type=\"text\" name=\"statspagelimitspecify\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Maximum reannounce interval (in seconds) 1800 == 30 minutes</td>\n\t<td><input type=\"text\" name=\"report_interval\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Minimum reannounce interval (also in seconds) 300 == 5 minutes</td>\n\t<td><input type=\"text\" name=\"min_interval\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Number of peers to send in one request.  Some logic will break if you set this to more than 300,\n\tso please don't do that. 100 is the most you should set anyway.</td>\n\t<td><input type=\"text\" name=\"maxpeers\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\t\n\t<tr><td>If set, NAT checking will be performed.\n\tThis may cause trouble with some providers, so it's\n\toff by default.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"NAT\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Persistent MySQL connections:\n\tCheck with your webmaster to see if you're allowed to use these.\n\tHighly recommended, especially for higher loads, but generally\n\tnot allowed unless it's a dedicated machine.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"persist\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Allow users to override ip address.\n\tEnable this if you know people have a legit reason to use\n\tthis function. Leave disabled otherwise.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"ip_override\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>For heavily loaded trackers, uncheck this. It will stop count the number\n\tof downloaded bytes and the speed of the torrent, but will significantly reduce\n\tthe load.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"countbytes\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Username for individual who can add torrents to tracker database.\n\tThis user is only able to create, and not delete torrents to the tracker.\n\tFor full privileges, see the admin user.</td>\n\t<td><input type=\"text\" name=\"upload_username\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Password for individual who can add torrents to tracker database.\n\tAgain, this user is only able to create, and not delete torrents to the tracker.\n\tFor full privileges, see the admin user.<br><br>\n\t<input type=\"hidden\" name=\"old_upload_password\" value=\"<?php echo $temp;?>\">\n\t<b>Current MD5 hashed username+password: <?php echo $temp;?></b></td>\n\t<td><input type=\"password\" name=\"upload_password\" size=\"40\" value=\"\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Admin username. The admin is able to go to the admin page and show detailed \n\tinformation about the tracker as well as access a few other important tools.\n\tThe admin is also able to upload torrents to the database\n\tjust like the previous account.</td>\n\t<td><input type=\"text\" name=\"admin_username\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Password for admin.  Again, The admin is able to go to the admin page and show detailed \n\tinformation about the tracker as well as access a few other important tools.\n\tThe admin is also able to upload torrents to the database.<br><br>\n\t<input type=\"hidden\" name=\"old_admin_password\" value=\"<?php echo $temp;?>\">\n\t<b>Current MD5 hashed username+password: <?php echo $temp;?></b></td>\n\t<td><input type=\"password\" name=\"admin_password\" size=\"40\" value=\"\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = clean(substr($temp, strpos($temp, \"=\")+3, -3));\n\t?>\n\t<tr><td>Title on index.php statistics page, if not set, defaults to \"Tracker Statistics\"</td>\n\t<td><input type=\"text\" name=\"title\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Database Hostname: This is the MySQL database hostname, if it is the local machine, it should\n\tbe set to localhost.</td>\n\t<td><input type=\"text\" name=\"dbhost\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Database Username: This is the user who has access to the database table.  If you are unsure,\n\tcheck with your system administrator.</td>\n\t<td><input type=\"text\" name=\"dbuser\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Database Password: This is the password for the user who has access to the database table.\n\tIf you are unsure, check with your system administrator.</td>\n\t<td><input type=\"text\" name=\"dbpass\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Database name: This is the name of the database.  If you are unsure, check with\n\tyour system administrator.</td>\n\t<td><input type=\"text\" name=\"database\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Enable RSS feed:\n\tIf you do not want the RSS feed to be created for privacy reasons or do not need it disable this checkbox.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"enablerss\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = clean(substr($temp, strpos($temp, \"=\")+3, -3));\n\t?>\n\t<tr><td>RSS Title: In the rss.xml file, this is the main <pre>&lt;title&gt;</pre> tag.</td>\n\t<td><input type=\"text\" name=\"rss_title\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td>RSS link to main website: In the rss.xml file, this is the main <pre>&lt;link&gt;</pre> tag.</td>\n\t<td><input type=\"text\" name=\"rss_link\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = clean(substr($temp, strpos($temp, \"=\")+3, -3));\n\t?>\n\t<tr><td>RSS description: In the rss.xml file, this is the main <pre>&lt;description&gt;</pre> tag.</td>\n\t<td><input type=\"text\" name=\"rss_description\" size=\"60\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Main website url that the tracker runs on, example: http://www.mywebsite.com</td>\n\t<td><input type=\"text\" name=\"website_url\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> For HTTP seeding, this is the maximum total upload rate per second in kilobytes, for example 100 would be 100 KB/s</td>\n\t<td><input type=\"text\" name=\"max_upload_rate\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> For HTTP seeding, this is the maximum number of uploads to run at a time</td>\n\t<td><input type=\"text\" name=\"max_uploads\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\t\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Timezone that the server runs on</td>\n\t<td>\n\t<select name=\"timezone\" id=\"timezone\">\n\t<option title=\"[UTC - 12] Baker Island Time\" value=\"-1200\"<?php if($temp == \"-1200\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 12] Baker Island Time</option>\n\t<option title=\"[UTC - 11] Niue Time, Samoa Standard Time\" value=\"-1100\"<?php if($temp == \"-1100\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 11] Niue Time, Samoa Standard Time</option>\n\t<option title=\"[UTC - 10] Hawaii-Aleutian Standard Time, Cook Island Time\" value=\"-1000\"<?php if($temp == \"-1000\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 10] Hawaii-Aleutian Standard Time, Cook Isl...</option>\n\t<option title=\"[UTC - 9:30] Marquesas Islands Time\" value=\"-0930\"<?php if($temp == \"-0930\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 9:30] Marquesas Islands Time</option>\n\t<option title=\"[UTC - 9] Alaska Standard Time, Gambier Island Time\" value=\"-0900\"<?php if($temp == \"-0900\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 9] Alaska Standard Time, Gambier Island Tim...</option>\n\t<option title=\"[UTC - 8] Pacific Standard Time\" value=\"-0800\"<?php if($temp == \"-0800\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 8] Pacific Standard Time</option>\n\t<option title=\"[UTC - 7] Mountain Standard Time\" value=\"-0700\"<?php if($temp == \"-0700\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 7] Mountain Standard Time</option>\n\t<option title=\"[UTC - 6] Central Standard Time\" value=\"-0600\"<?php if($temp == \"-0600\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 6] Central Standard Time</option>\n\t<option title=\"[UTC - 5] Eastern Standard Time\" value=\"-0500\"<?php if($temp == \"-0500\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 5] Eastern Standard Time</option>\n\t<option title=\"[UTC - 4] Atlantic Standard Time\" value=\"-0400\"<?php if($temp == \"-0400\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 4] Atlantic Standard Time</option>\n\t<option title=\"[UTC - 3:30] Newfoundland Standard Time\" value=\"-0330\"<?php if($temp == \"-0330\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 3:30] Newfoundland Standard Time</option>\n\t<option title=\"[UTC - 3] Amazon Standard Time, Central Greenland Time\" value=\"-0300\"<?php if($temp == \"-0300\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 3] Amazon Standard Time, Central Greenland ...</option>\n\t<option title=\"[UTC - 2] Fernando de Noronha Time, South Georgia &amp; the South Sandwich Islands Time\" value=\"-0200\"<?php if($temp == \"-0200\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 2] Fernando de Noronha Time, South Georgia ...</option>\n\t<option title=\"[UTC - 1] Azores Standard Time, Cape Verde Time, Eastern Greenland Time\" value=\"-0100\"<?php if($temp == \"-0100\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 1] Azores Standard Time, Cape Verde Time, E...</option>\n\t<option title=\"[UTC] Western European Time, Greenwich Mean Time\" value=\"+0000\"<?php if($temp == \"+0000\") echo \" selected=\\\"selected\\\"\";?>>[UTC] Western European Time, Greenwich Mean Time</option>\n\t<option title=\"[UTC + 1] Central European Time, West African Time\" value=\"+0100\"<?php if($temp == \"+0100\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 1] Central European Time, West African Time</option>\n\t<option title=\"[UTC + 2] Eastern European Time, Central African Time\" value=\"+0200\"<?php if($temp == \"+0200\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 2] Eastern European Time, Central African T...</option>\n\t<option title=\"[UTC + 3] Moscow Standard Time, Eastern African Time\" value=\"+0300\"<?php if($temp == \"+0300\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 3] Moscow Standard Time, Eastern African Ti...</option>\n\t<option title=\"[UTC + 3:30] Iran Standard Time\" value=\"+0330\"<?php if($temp == \"+0330\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 3:30] Iran Standard Time</option>\n\t<option title=\"[UTC + 4] Gulf Standard Time, Samara Standard Time\" value=\"+0400\"<?php if($temp == \"+0400\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 4] Gulf Standard Time, Samara Standard Time</option>\n\t<option title=\"[UTC + 4:30] Afghanistan Time\" value=\"+0430\"<?php if($temp == \"+0430\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 4:30] Afghanistan Time</option>\n\t<option title=\"[UTC + 5] Pakistan Standard Time, Yekaterinburg Standard Time\" value=\"+0500\"<?php if($temp == \"+0500\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 5] Pakistan Standard Time, Yekaterinburg St...</option>\n\t<option title=\"[UTC + 5:30] Indian Standard Time, Sri Lanka Time\" value=\"+0530\"<?php if($temp == \"+0530\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 5:30] Indian Standard Time, Sri Lanka Time</option>\n\t<option title=\"[UTC + 6] Bangladesh Time, Bhutan Time, Novosibirsk Standard Time\" value=\"+0600\"<?php if($temp == \"+0600\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 6] Bangladesh Time, Bhutan Time, Novosibirs...</option>\n\t<option title=\"[UTC + 6:30] Cocos Islands Time, Myanmar Time\" value=\"+0630\"<?php if($temp == \"+0630\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 6:30] Cocos Islands Time, Myanmar Time</option>\n\t<option title=\"[UTC + 7] Indochina Time, Krasnoyarsk Standard Time\" value=\"+0700\"<?php if($temp == \"+0700\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 7] Indochina Time, Krasnoyarsk Standard Tim...</option>\n\t<option title=\"[UTC + 8] Chinese Standard Time, Australian Western Standard Time, Irkutsk Standard Time\" value=\"+0800\"<?php if($temp == \"+0800\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 8] Chinese Standard Time, Australian Wester...</option>\n\t<option title=\"[UTC + 9] Japan Standard Time, Korea Standard Time, Chita Standard Time\" value=\"+0900\"<?php if($temp == \"+0900\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 9] Japan Standard Time, Korea Standard Time...</option>\n\t<option title=\"[UTC + 9:30] Australian Central Standard Time\" value=\"+0930\"<?php if($temp == \"+0930\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 9:30] Australian Central Standard Time</option>\n\t<option title=\"[UTC + 10] Australian Eastern Standard Time, Vladivostok Standard Time\" value=\"+1000\"<?php if($temp == \"+1000\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 10] Australian Eastern Standard Time, Vladi...</option>\n\t<option title=\"[UTC + 10:30] Lord Howe Standard Time\" value=\"+1030\"<?php if($temp == \"+1030\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 10:30] Lord Howe Standard Time</option>\n\t<option title=\"[UTC + 11] Solomon Island Time, Magadan Standard Time\" value=\"+1100\"<?php if($temp == \"+1100\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 11] Solomon Island Time, Magadan Standard T...</option>\n\t<option title=\"[UTC + 11:30] Norfolk Island Time\" value=\"+1130\"<?php if($temp == \"+1130\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 11:30] Norfolk Island Time</option>\n\t<option title=\"[UTC + 12] New Zealand Time, Fiji Time, Kamchatka Standard Time\" value=\"+1200\"<?php if($temp == \"+1200\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 12] New Zealand Time, Fiji Time, Kamchatka ...</option>\n\t<option title=\"[UTC + 13] Tonga Time, Phoenix Islands Time\" value=\"+1300\"<?php if($temp == \"+1300\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 13] Tonga Time, Phoenix Islands Time</option>\n\t<option title=\"[UTC + 14] Line Island Time\" value=\"+1400\"<?php if($temp == \"+1400\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 14] Line Island Time</option>\n\t</select>\n\t</td>\n\t</tr>\n\t<?php\n\t\n\t//get MySQL table prefix, store in hidden form field\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<input type=\"hidden\" name=\"prefix\" value=\"<?php echo $temp;?>\" />\t\n\n\t<?php\n\tfclose($fr);\n\n\t?>\t\t\n\t</table>\n\t<input type=\"submit\" value=\"Save Config\">\n\t</form>\n\t\n\t<?php\n}\n\n\nif (isset($_POST[\"saveconfig\"]))\n{\n\t//check required entries for values, if blank: error out\n\tif ($_POST[\"announceurl\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The announce URL is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"indexpagelimitspecify\"]) || $_POST[\"indexpagelimitspecify\"] == \"\" || $_POST[\"indexpagelimitspecify\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The index page limit is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"statspagelimitspecify\"]) || $_POST[\"statspagelimitspecify\"] == \"\" || $_POST[\"statspagelimitspecify\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The statistics page limit is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"report_interval\"]) || $_POST[\"report_interval\"] == \"\" || $_POST[\"report_interval\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The maximum reannounce interval is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"min_interval\"]) || $_POST[\"min_interval\"] == \"\" || $_POST[\"min_interval\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The minimum reannounce interval is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"maxpeers\"]) || $_POST[\"maxpeers\"] == \"\" || $_POST[\"maxpeers\"] > 300 || $_POST[\"maxpeers\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The number of peers to send in one request is not an integer, over 300, a negative number, zero, or blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"upload_username\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The upload username is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"admin_username\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The admin username is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"dbhost\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The database hostname is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"dbuser\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The database username is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"dbpass\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The database password is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"database\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The database name is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"rss_link\"] != \"\" && Substr($_POST[\"rss_link\"], 0, 7) != \"http://\")\n\t{\n\t\techo errorMessage() . \"Error: The RSS website URL does not start with http://</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"website_url\"] == \"\" || Substr($_POST[\"website_url\"], 0, 7) != \"http://\")\n\t{\n\t\techo errorMessage() . \"Error: The website URL does not start with http:// or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"max_upload_rate\"]) || $_POST[\"max_upload_rate\"] == \"\" || $_POST[\"max_upload_rate\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The maximum upload rate is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"max_uploads\"]) || $_POST[\"max_uploads\"] == \"\" || $_POST[\"max_uploads\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The maximum uploads is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"timezone\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The timezone is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"upload_username\"] == $_POST[\"admin_username\"])\n\t{\n\t\techo errorMessage() . \"Error: The admin username cannot be the same as the upload username.</p>\";\n\t\texit();\n\t}\n\t\n\t//calculate new MD5 password if needed\n\tif ($_POST[\"upload_password\"] != \"\")\n\t{\n\t\t$_POST[\"upload_password\"] = md5($_POST[\"upload_username\"].$_POST[\"upload_password\"]);\n\t}\n\telse\n\t\t$_POST[\"upload_password\"] = $_POST[\"old_upload_password\"];\n\tif ($_POST[\"admin_password\"] != \"\")\n\t{\n\t\t$_POST[\"admin_password\"] = md5($_POST[\"admin_username\"].$_POST[\"admin_password\"]);\n\t}\n\telse\n\t\t$_POST[\"admin_password\"] = $_POST[\"old_admin_password\"];\n\t\t\n\t//check if config.php has write access\n\tif (is_writable(\"config.php\"))\n\t{\n\t\t//go through checkboxes and change \"on\" to \"true\"\n\t\tif (isset($_POST[\"hiddentracker\"]))\n\t\t\t$hiddentracker = \"true\";\n\t\telse\n\t\t\t$hiddentracker = \"false\";\t\n\t\tif (isset($_POST[\"enablerss\"]))\n\t\t\t$enablerss = \"true\";\n\t\telse\n\t\t\t$enablerss = \"false\";\n\t\tif (isset($_POST[\"scrape\"]))\n\t\t\t$scrape = \"true\";\n\t\telse\n\t\t\t$scrape = \"false\";\n\t\tif (isset($_POST[\"NAT\"]))\n\t\t\t$NAT = \"true\";\n\t\telse\n\t\t\t$NAT = \"false\";\n\t\tif (isset($_POST[\"persist\"]))\n\t\t\t$persist = \"true\";\n\t\telse\n\t\t\t$persist = \"false\";\n\t\tif (isset($_POST[\"ip_override\"]))\n\t\t\t$ip_override = \"true\";\n\t\telse\n\t\t\t$ip_override = \"false\";\n\t\tif (isset($_POST[\"countbytes\"]))\n\t\t\t$countbytes = \"true\";\n\t\telse\n\t\t\t$countbytes = \"false\";\n\n\t\t//write config.php file\n\t\t$fd = fopen(\"config.php\", \"w\") or die(errorMessage() . \"Warning: write to config.php!</p>\");\n\t\tfwrite($fd, \n\t\t\"<?php //Please do NOT edit this file, use the admin page for changes.\\n\" .\n\t\t\"\\$GLOBALS['hiddentracker'] = \" . $hiddentracker . \";\\n\" .\n\t\t\"\\$GLOBALS['scrape'] = \" . $scrape . \";\\n\" .\n\t\t\"\\$announceurl = '\" . htmlspecialchars($_POST[\"announceurl\"]) . \"';\\n\" .\n\t\t\"\\$GLOBALS['indexpagelimitspecify'] = \" . htmlspecialchars($_POST[\"indexpagelimitspecify\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['statspagelimitspecify'] = \" . htmlspecialchars($_POST[\"statspagelimitspecify\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['report_interval'] = \" . htmlspecialchars($_POST[\"report_interval\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['min_interval'] = \" . htmlspecialchars($_POST[\"min_interval\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['maxpeers'] = \" . htmlspecialchars($_POST[\"maxpeers\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['NAT'] = \" . $NAT . \";\\n\" .\n\t\t\"\\$GLOBALS['persist'] = \" . $persist . \";\\n\" .\n\t\t\"\\$GLOBALS['ip_override'] = \" . $ip_override . \";\\n\" .\n\t\t\"\\$GLOBALS['countbytes'] = \" . $countbytes . \";\\n\" .\n\t\t\"\\$upload_username = '\" . htmlspecialchars($_POST[\"upload_username\"]) . \"';\\n\" .\n\t\t\"\\$upload_password = '\" . htmlspecialchars($_POST[\"upload_password\"]) . \"';\\n\" .\n\t\t\"\\$admin_username = '\" . htmlspecialchars($_POST[\"admin_username\"]) . \"';\\n\" .\n\t\t\"\\$admin_password = '\" . htmlspecialchars($_POST[\"admin_password\"]) . \"';\\n\" .\n\t\t\"\\$GLOBALS['title'] = '\" . htmlspecialchars(addquotes($_POST[\"title\"])) . \"';\\n\" .\n\t\t\"\\$dbhost = '\" . htmlspecialchars($_POST[\"dbhost\"]) . \"';\\n\" .\n\t\t\"\\$dbuser = '\" . htmlspecialchars($_POST[\"dbuser\"]) . \"';\\n\" .\n\t\t\"\\$dbpass = '\" . htmlspecialchars($_POST[\"dbpass\"]) . \"';\\n\" .\n\t\t\"\\$database = '\" . htmlspecialchars($_POST[\"database\"]) . \"';\\n\" .\n\t\t\"\\$enablerss = \" . $enablerss . \";\\n\" .\n\t\t\"\\$rss_title = '\" . htmlspecialchars(addquotes($_POST[\"rss_title\"])) . \"';\\n\" .\n\t\t\"\\$rss_link = '\" . htmlspecialchars($_POST[\"rss_link\"]) . \"';\\n\" .\n\t\t\"\\$rss_description = '\" . htmlspecialchars(addquotes($_POST[\"rss_description\"])) . \"';\\n\" .\n\t\t\"\\$website_url = '\" . htmlspecialchars($_POST[\"website_url\"]) . \"';\\n\" .\n\t\t\"\\$GLOBALS['max_upload_rate'] = \" . htmlspecialchars($_POST['max_upload_rate']) . \";\\n\" .\n\t\t\"\\$GLOBALS['max_uploads'] = \" . htmlspecialchars($_POST['max_uploads']) . \";\\n\" .\n\t\t\"\\$timezone = '\" . htmlspecialchars($_POST[\"timezone\"]) . \"';\\n\" .\n\t\t\"\\$prefix = '\" . htmlspecialchars($_POST[\"prefix\"]) . \"';\\n\" .\n\t\t\"?>\"\n\t\t);\n\n\t\tfclose($fd);\n\t\techo \"<br><p class=\\\"success\\\">config.php file was edited successfully!</p>\\n\";\n\t\t\n\t\t//run RSS generator\n\t\trequire_once(\"rss_generator.php\");\n\t}\n\telse\n\t{\n\t\techo errorMessage() . \"config.php was not able to be written.  Please check the permissions and try again.</p>\\n\";\n\t}\n}\n\n?>\n<br>\n<br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body>\n</html>\n", "<?php\nrequire_once (\"funcsv2.php\");\n\n//check if config.php file already exists, if so, this could be an already existing installation\nif (file_exists(\"config.php\"))\n{\n\techo \"<font color=red><strong>The config.php file already exists.  This is an indication of an already existing installation\" .\n\t\" of RivetTracker.  If you are sure you are installing for the first time, please try recopying the files/folders.\" .\n\t\" This is also a security feature to prevent malicious attempts to run the installer if you forgot to delete it.\" .\n\t\" This installer will now abort.</strong></font>\";\n\texit();\n}\n\nif (isset($_POST[\"download\"]))\n{\n\t//download config.php using header()\n\theader('content-type: application/octet-stream');\n\theader(\"Content-Disposition: attachment; filename=\\\"config.php\\\"\");\n\n\tprint \"<?php //Please do NOT edit this file, use the admin page for changes.\\n\";\n\tprint \"\\$GLOBALS['hiddentracker'] = \" . htmlspecialchars($_POST[\"hiddentracker\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['scrape'] = \" . htmlspecialchars($_POST[\"scrape\"]) . \";\\n\";\n\tprint \"\\$announceurl = '\" . htmlspecialchars($_POST[\"announceurl\"]) . \"';\\n\";\n\tprint \"\\$GLOBALS['indexpagelimitspecify'] = \" . htmlspecialchars($_POST[\"indexpagelimitspecify\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['statspagelimitspecify'] = \" . htmlspecialchars($_POST[\"statspagelimitspecify\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['report_interval'] = \" . htmlspecialchars($_POST[\"report_interval\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['min_interval'] = \" . htmlspecialchars($_POST[\"min_interval\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['maxpeers'] = \" . htmlspecialchars($_POST[\"maxpeers\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['NAT'] = \" . htmlspecialchars($_POST[\"NAT\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['persist'] = \" . htmlspecialchars($_POST[\"persist\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['ip_override'] = \" . htmlspecialchars($_POST[\"ip_override\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['countbytes'] = \" . htmlspecialchars($_POST[\"countbytes\"]) . \";\\n\";\n\tprint \"\\$upload_username = '\" . htmlspecialchars($_POST[\"upload_username\"]) . \"';\\n\";\n\tprint \"\\$upload_password = '\" . htmlspecialchars($_POST[\"upload_password\"]) . \"';\\n\";\n\tprint \"\\$admin_username = '\" . htmlspecialchars($_POST[\"admin_username\"]) . \"';\\n\";\n\tprint \"\\$admin_password = '\" . htmlspecialchars($_POST[\"admin_password\"]) . \"';\\n\";\n\tprint \"\\$GLOBALS['title'] = '\" . htmlspecialchars(addquotes($_POST[\"title\"])) . \"';\\n\";\n\tprint \"\\$dbhost = '\" . htmlspecialchars($_POST[\"dbhost\"]) . \"';\\n\";\n\tprint \"\\$dbuser = '\" . htmlspecialchars($_POST[\"dbuser\"]) . \"';\\n\";\n\tprint \"\\$dbpass = '\" . htmlspecialchars($_POST[\"dbpass\"]) . \"';\\n\";\n\tprint \"\\$database = '\" . htmlspecialchars($_POST[\"database\"]) . \"';\\n\";\n\tprint \"\\$enablerss = \" . htmlspecialchars($_POST['enablerss']) . \";\\n\";\n\tprint \"\\$rss_title = '\" . htmlspecialchars(addquotes($_POST[\"rss_title\"])) . \"';\\n\";\n\tprint \"\\$rss_link = '\" . htmlspecialchars($_POST[\"rss_link\"]) . \"';\\n\";\n\tprint \"\\$rss_description = '\" . htmlspecialchars($_POST[\"rss_description\"]) . \"';\\n\";\n\tprint \"\\$website_url = '\" . htmlspecialchars($_POST['website_url']) . \"';\\n\";\n\tprint \"\\$GLOBALS['max_upload_rate'] = \" . htmlspecialchars($_POST['max_upload_rate']) . \";\\n\";\n\tprint \"\\$GLOBALS['max_uploads'] = \" . htmlspecialchars($_POST['max_uploads']) . \";\\n\";\n\tprint \"\\$timezone = '\" . htmlspecialchars($_POST['timezone']) . \"';\\n\";\n\tprint \"\\$prefix = '\" . htmlspecialchars($_POST['prefix']) . \"';\\n\";\n\tprint \"?>\";\nexit;\n}\n\n?>\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n<html>\n<head>\n\t<title>RivetTracker Installer</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head>\n<body>\n<p align=\"right\"><a href=\"./docs/help.html\"><img src=\"images/help.png\" border=\"0\" class=\"icon\" alt=\"Help\" title=\"Help\" /></a><a href=\"./docs/help.html\">Help</a></p>\n\n<?php\n\n\tif (!isset($_POST[\"started\"]))\n\t{\n\t\t?>\n\t\t<center>\n\t\t<h1>RivetTracker Installer</h1>\n\t\t<img src=\"images/install.png\" border=\"0\" class=\"icon\" alt=\"RivetTracker Installation\" title=\"RivetTracker Installation\" />\n\t\t</center>\n\n\t\t<?php\n\t\t//Check PHP version\n\t\techo \"<p>PHP Version: \" . PHP_VERSION . \"</p>\";\n\t\t//http://php.net/manual/en/function.version-compare.php\n\t\tif (version_compare(PHP_VERSION, '5.0.0', '<')) {\n\t\t\techo \"<p>You're not running PHP 5.0, you may have problems.</p>\";\n\t\t}\n\t\t//Check for MySQL support\n\t\tif (class_exists('mysqli') OR function_exists('mysql_connect')) {\n\t\t\techo \"<p>MySQL Enabled: Yes</p>\";\n\t\t} else {\n\t\t\techo \"<p>MySQL Enabled: No (this is a requirement)</p>\";\n\t\t\techo \"</body></html>\";\n\t\t\texit();\n\t\t}\n\n\t\t?>\n\t\t<br>\n\t\t<form method=\"post\" action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\">\n\t\t<input type=\"hidden\" name=\"started\" value=\"1\">\n\t\t<h2>The MySQL database needs to be prepared for the tracker. This script will help\n\t\tyou do that.</h2>\n\t\t<h2>You have two choices:</h2>\n\t\t<ul>\n\t\t<li><h2>If you have a username, password, and database for the tracker already\n\t\tcreated:</h2></li>\n\t\t</ul>\n\t\t<input type=\"submit\" name=\"preexisting\" value=\"Click Here\">\n\t\t<br>\n\t\t<ul>\n\t\t<li><h2>If you need to create the account and database, and you have the username and password\n\t\tof a user who can create user accounts and databases:</h2></li>\n\t\t</ul>\n\t\t<input type=\"submit\" name=\"makeaccount\" value=\"Click Here\">\n\t\t</form>\n\t\t<br>\n\t\t</body></html><?php exit;\n\t}\n\tif (isset($_POST[\"preexisting\"]))\n\t{\n\t\t?>\n\t\t<form method=\"post\" action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\">\n\t\t<input type=\"hidden\" name=\"maketables\" value=\"1\">\n\t\t<input type=\"hidden\" name=\"started\" value=\"1\">\n\t\t<h1>RivetTracker Installation</h1>\n\t\t<center>\n\t\t<img src=\"images/install.png\" border=\"0\" class=\"icon\" alt=\"RivetTracker Installation\" title=\"RivetTracker Installation\" />\n\t\t</center>\n\t\t<br><br>\n\t\t<table border=0 cellpadding=5>\n\t\t<tr><td align=\"right\">Database hostname:<br>(in MySQL format, example: localhost)</td><td align=\"left\"><input type=\"text\" name=\"host\" value=\"localhost\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Tracker's database username:</td><td align=\"left\"><input type=\"text\" name=\"username\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Tracker's database password:</td><td align=\"left\"><input type=\"password\" name=\"password\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Database name:</td><td align=\"left\"><input type=\"text\" name=\"database\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Table Prefix:<br> (If you want to use an existing<br> database this will add the tables\n\t\tin<br> with the specified prefix. If you<br> are unsure, leave this blank.)<br>e.g.: rt_</td><td align=\"left\"><input type=\"text\" name=\"prefix\" size=\"40\"></td></tr>\n\t\t</table>\n\t\t<br><br>\n\t\t<center>\n\t\t<input type=\"submit\" value=\"Install\">\n\t\t</center>\n\t\t<br>\n\t\t</form></body></html><?php exit;\n\n\t}\n\tif (isset($_POST[\"makeaccount\"]))\n\t{\n\t\t?>\n\t\t<form method=\"post\" action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\">\n\t\t<input type=\"hidden\" name=\"domakeaccount\" value=\"1\">\n\t\t<input type=\"hidden\" name=\"started\" value=\"1\">\n\t\t<h1>Tracker Installation</h1>\n\t\t<center>\n\t\t<img src=\"images/install.png\" border=\"0\" class=\"icon\" alt=\"RivetTracker Installation\" title=\"RivetTracker Installation\" />\n\t\t</center>\n\t\t<br><br>\n\t\t<table border=0 cellpadding=5>\n\t\t<tr><td align=\"right\">Username of database admin:</td><td align=\"left\"><input type=\"text\" name=\"adminname\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Password of database admin:</td><td align=\"left\"><input type=\"password\" name=\"adminpass\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Database hostname:<br>(in MySQL format, example: localhost)</td><td align=\"left\"><input type=\"text\" name=\"host\" size=\"40\" value=\"localhost\"></td></tr>\n\t\t<tr><td align=\"right\">Create user for MySQL:<br>(make sure this user does not already exist)</td><td align=\"left\"><input type=\"text\" name=\"username\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Password:</td><td align=\"left\"><input type=\"password\" name=\"password\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Create database (name):</td><td align=\"left\"><input type=\"text\" name=\"database\" size=\"40\"></td></tr>\n\t\t</table>\n\t\t<br><br>\n\t\t<center>\t\t\n\t\t<input type=\"submit\" value=\"Install\">\n\t\t</center>\n\t\t</form></body></html>\n\t\t<?php exit;\n\t}\n\n\tif (isset($_POST[\"prefix\"])) {\n\t\t$prefix = $_POST[\"prefix\"];\n\t} else {\n\t\t$prefix = \"\";\n\t}\n\n\t$makenamemap= 'CREATE TABLE ' . $prefix . 'namemap (info_hash char(40) NOT NULL default \"\", filename varchar(250) NOT NULL default \"\", url varchar(250) NOT NULL default \"\", size bigint(20) unsigned NOT NULL, pubDate varchar(25) NOT NULL default \"\", PRIMARY KEY(info_hash)) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\t$makesummary = 'CREATE TABLE ' . $prefix . 'summary (info_hash char(40) NOT NULL default \"\", dlbytes bigint unsigned NOT NULL default 0, seeds int unsigned NOT NULL default 0, leechers int unsigned NOT NULL default 0, finished int unsigned NOT NULL default 0, lastcycle int unsigned NOT NULL default \"0\", lastSpeedCycle int unsigned NOT NULL DEFAULT \"0\", speed bigint unsigned NOT NULL default 0, piecelength int(11) NOT NULL default -1, numpieces int(11) NOT NULL default 0, PRIMARY KEY (info_hash)) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\t$maketimestamps = 'CREATE TABLE ' . $prefix . 'timestamps (info_hash char(40) not null, sequence int unsigned not null auto_increment, bytes bigint unsigned not null, delta smallint unsigned not null, primary key(sequence), key sorting (info_hash)) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\t$makespeedlimit = 'CREATE TABLE ' . $prefix . 'speedlimit (uploaded bigint(25) NOT NULL default 0, total_uploaded bigint(30) NOT NULL default 0, started bigint(25) NOT NULL default 0) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\t$makewebseedfiles = 'CREATE TABLE ' . $prefix . 'webseedfiles (info_hash char(40) default NULL, filename char(250) NOT NULL default \"\", startpiece int(11) NOT NULL default 0, endpiece int(11) NOT NULL default 0, startpieceoffset int(11) NOT NULL default 0, fileorder int(11) NOT NULL default 0, UNIQUE KEY fileseq (info_hash,fileorder)) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\tif (isset($_POST[\"maketables\"]))\n\t{\n\t\t$username = $_POST[\"username\"] or die(errorMessage() . \"No username was given, please try again.</p>\");\n\t\t$password = $_POST[\"password\"] or die(errorMessage() . \"No username password was given, this is a huge security risk, please try again.</p>\");\n\t\t$database = $_POST[\"database\"] or die(errorMessage() . \"No database specified, please try again.</p>\");\n\t\t$hostname = $_POST[\"host\"] or die(errorMessage() . \"No database hostname specified, please try again.</p>\");\n\n\t\t$db = mysql_connect($hostname, $username, $password) or die(errorMessage() . \"Can't connect to database: \" . mysql_error() . \"</p>\"); \n\t\tmysql_select_db($database) or die(errorMessage() . \"Can't select database: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makesummary) or die(errorMessage() . \"Can't make the summary table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makenamemap) or die(errorMessage() . \"Can't make the namemap table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($maketimestamps) or die(errorMessage() . \"Can't make the timestamps table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makespeedlimit) or die(errorMessage() . \"Can't make the speedlimit table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makewebseedfiles) or die(errorMessage() . \"Can't make the webseedfiles table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query(\"INSERT INTO \".$prefix.\"speedlimit values (0,0,0)\") or die(errorMessage() . \"Can't insert zeros into speedlimit table: \" . mysql_error() . \"</p>\");\n\t\techo \"<p class=\\\"success\\\">Database was created successfully!</p><br><br>\";\n\t}\n\n\tif (isset($_POST[\"domakeaccount\"]))\n\t{\n\t\t$username = $_POST[\"username\"] or die(errorMessage() . \"No username was given, please try again.</p>\");\n\t\t$password = $_POST[\"password\"] or die(errorMessage() . \"No username password was given, this is a huge security risk, please try again.</p>\");\n\t\t$database = $_POST[\"database\"] or die(errorMessage() . \"No database specified, please try again.</p>\");\n\t\t$hostname = $_POST[\"host\"] or die(errorMessage() . \"No database hostname specified, please try again.</p>\");\n\n\t\t$dbadmin = $_POST[\"adminname\"] or die(errorMessage() . \"No admin username was given, please try again.</p>\");\n\t\t$dbpass = $_POST[\"adminpass\"]; // No admin password, OK but huge security risk...\n\t\t\n\t\t// Escaping strings will be ignored for now.\n\t\t$db = mysql_connect($hostname, $dbadmin, $dbpass) or die(errorMessage() . \"Error connecting: \" . mysql_error() . \"</p>\");\n\t\tmysql_select_db(\"mysql\") or die(errorMessage() . \"Can't select db \\\"mysql\\\":\" . mysql_error() . \"</p>\");\n\n\t\tmysql_query(\"INSERT INTO user SET user=\\\"$username\\\", password=PASSWORD(\\\"$password\\\"), host=\\\"\\\"\") or die(errorMessage() . \"Can't make user: \" . mysql_error() . \"</p>\");\n\t\tmysql_query(\"INSERT INTO db SET Host=\\\"%\\\", db=\\\"$database\\\", user=\\\"$username\\\", select_priv='Y', Insert_priv='Y', Update_priv='Y', Delete_priv='Y', Create_priv='Y', Drop_priv='Y', Alter_priv='Y', index_priv='Y'\") or die(errorMessage() . \"Cannot insert into \\\"Db\\\": \" . mysql_error() . \"</p>\");\n\t\tmysql_query(\"CREATE DATABASE $database\") or die(errorMessage() . \"Can't make database: \" . mysql_error() . \"</p>\");\n\t\t\n\t\tmysql_query(\"FLUSH PRIVILEGES\") or die(errorMessage() . \"Can't flush privileges: \" . mysql_error() . \"</p>\");\n\t\n\t\tmysql_select_db($database) or die(errorMessage() . \"Can't select database \\\"$database\\\":\" . mysql_error() . \"</p>\");\n\t\n\t\tmysql_query($makesummary) or die(errorMessage() . \"Can't make the summary table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makenamemap) or die(errorMessage() . \"Can't make the namemap table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($maketimestamps) or die(errorMessage() . \"Can't make the timestamps table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makespeedlimit) or die(errorMessage() . \"Can't make the speedlimit table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makewebseedfiles) or die(errorMessage() . \"Can't make the webseedfiles table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query(\"INSERT INTO \".$prefix.\"speedlimit values (0,0,0)\") or die(errorMessage() . \"Can't insert zeros into speedlimit table: \" . mysql_error() . \"</p>\");\n\t\techo \"<p class=\\\"success\\\">Database was created successfully!</p><br><br>\";\n\n\t}\n\n\tif (isset($_POST[\"domakeaccount\"]) || isset($_POST[\"maketables\"]))\n\t{\n\t\t//have user set values for config.php\n\t\t?>\n\t\t<form method=\"post\" action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\">\n\t\t<input type=\"hidden\" name=\"config\" value=\"1\">\n\t\t<input type=\"hidden\" name=\"started\" value=\"1\">\n\t\t<?php\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"dbhost\\\" value=\\\"\" . $hostname . \"\\\">\\n\";\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"dbuser\\\" value=\\\"\" . $username . \"\\\">\\n\";\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"dbpass\\\" value=\\\"\" . $password . \"\\\">\\n\";\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"database\\\" value=\\\"\" . $database . \"\\\">\\n\";\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"prefix\\\" value=\\\"\" . $prefix . \"\\\">\\n\";\n\t\t?>\n\t\t<h1>Create Configuration File</h1>\n\t\t<br><br>\n\t\t<h2>This last step allows you to configure the \"config.php\" file.  This file stores all the necessary\n\t\tsettings for your tracker.  You can edit these settings at a later time in the admin page if you need\n\t\tto change them.  Please do NOT edit the \"config.php\" file directly, use the admin page for any changes.\n\t\tIt's usually pretty safe to leave most of the settings to the default unless you know what you're doing.</h2>\n\t\t<h2><span class=\"notice\">*</span> - required value</h2>\n\t\t<table border=1 cellpadding=3>\n\t\t\n\t\t<tr><td>Make tracker hidden: This will require a login by either the admin or upload user in order to\n\t\tsee the torrents available on the main statistics page.  This does not mean it's a private tracker.  If you\n\t\tneed a private tracker, there are many other trackers out there.  Also, you will need to secure the \"torrents\"\n\t\tfolder with an .htaccess file for Apache or some other method.  The tracker will still accept all valid\n\t\tconnections by clients.  There is no user checking in that regard.</td>\n\t\t<td><input type=\"checkbox\" name=\"hiddentracker\"></td></tr>\n\t\t\n\t\t<tr><td>Enable or disable scraping by clients.  Generally it is safe to leave this on unless\n\t\tyou have a large number of torrents or users which can lead to increased bandwidth usage.  Also, scraping\n\t\tcan possibily be used maliciously by abusive clients.</td>\n\t\t<td><input type=\"checkbox\" name=\"scrape\" checked></td></tr>\n\n\t\t<tr><td>Short Announce URL: You can enable the short announce feature, making the URL end in /announce for\n\t\tyour tracker.  You should not utilize both tracker URL forms in one torrent at the same time, or you will get\n\t\tinconsistent results.  Note: You will need the provided htaccess file, have URL rewrite capabilities, and have\n\t\tit properly set up to use this feature.  Otherwise, leave it disabled.</td>\n\t\t<td><select name=\"announceurl\" id=\"announceurl\">\n\t\t<option title=\"disabled\" value=\"announce.php\"<?php if($temp == \"announce.php\") echo \" selected=\\\"selected\\\"\";?>>disabled</option>\n\t\t<option title=\"enabled\" value=\"announce\"<?php if($temp == \"announce\") echo \" selected=\\\"selected\\\"\";?>>enabled</option>\n\t\t</select>\n\t\t</td>\n\t\t</tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Lists the number of torrents on each page on your torrent tracker list.  Default is 10.</td>\n\t\t<td><input type=\"text\" name=\"indexpagelimitspecify\" size=\"40\" value=\"10\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Lists the number of torrents on each page on the detailed statistics page.  Default is 5.</td>\n\t\t<td><input type=\"text\" name=\"statspagelimitspecify\" size=\"40\" value=\"5\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Maximum reannounce interval (in seconds) 1800 == 30 minutes</td>\n\t\t<td><input type=\"text\" name=\"report_interval\" size=\"40\" value=\"1800\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Minimum reannounce interval (also in seconds) 300 == 5 minutes</td>\n\t\t<td><input type=\"text\" name=\"min_interval\" size=\"40\" value=\"300\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Number of peers to send in one request.  Some logic will break if you set this to more than 300,\n\t\tso please don't do that. 100 is the most you should set anyway.</td>\n\t\t<td><input type=\"text\" name=\"maxpeers\" size=\"40\" value=\"50\"></td></tr>\n\n\t\t<tr><td>If set, NAT checking will be performed.\n\t\tThis may cause trouble with some providers, so it's\n\t\toff by default.</td>\n\t\t<td><input type=\"checkbox\" name=\"NAT\"></td></tr>\n\n\t\t<tr><td>Persistent MySQL connections:\n\t\tCheck with your webmaster to see if you're allowed to use these.\n\t\tHighly recommended, especially for higher loads, but generally\n\t\tnot allowed unless it's a dedicated machine.</td>\n\t\t<td><input type=\"checkbox\" name=\"persist\"></td></tr>\n\n\t\t<tr><td>Allow users to override ip address.\n\t\tEnable this if you know people have a legit reason to use\n\t\tthis function. Leave disabled otherwise.</td>\n\t\t<td><input type=\"checkbox\" name=\"ip_override\"></td></tr>\n\n\t\t<tr><td>For heavily loaded trackers, uncheck this. It will stop count the number\n\t\tof downloaded bytes and the speed of the torrent, but will significantly reduce\n\t\tthe load.</td>\n\t\t<td><input type=\"checkbox\" name=\"countbytes\" checked></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Username for individual who can add torrents to tracker database.\n\t\tThis user is only able to create, and not delete torrents to the tracker.\n\t\tFor full privileges, see the admin user.</td>\n\t\t<td><input type=\"text\" name=\"upload_username\" size=\"40\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Password for individual who can add torrents to tracker database.\n\t\tAgain, this user is only able to create, and not delete torrents to the tracker.\n\t\tFor full privileges, see the admin user.</td>\n\t\t<td><input type=\"password\" name=\"upload_password\" size=\"40\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Admin username. The admin is able to go to the admin page and show detailed \n\t\tinformation about the tracker as well as access a few other important tools.\n\t\tThe admin is also able to upload torrents to the database\n\t\tjust like the previous account.</td>\n\t\t<td><input type=\"text\" name=\"admin_username\" size=\"40\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Password for admin.  Again, The admin is able to go to the admin page and show detailed \n\t\tinformation about the tracker as well as access a few other important tools.\n\t\tThe admin is also able to upload torrents to the database.</td>\n\t\t<td><input type=\"password\" name=\"admin_password\" size=\"40\"></td></tr>\n\n\t\t<tr><td>Title on index.php statistics page, if not set, defaults to \"Tracker Statistics\"</td>\n\t\t<td><input type=\"text\" name=\"title\" size=\"40\"></td></tr>\n\t\t\n\t\t<tr><td>Enable RSS feed: If you do not want the RSS feed to be created for \n\t\tprivacy reasons or do not need it disable this checkbox.</td>\n\t\t<td><input type=\"checkbox\" name=\"enablerss\" checked></td></tr>\n\t\t\n\t\t<tr><td>RSS Title: In the rss.xml file, this is the main <pre>&lt;title&gt;</pre> tag.</td>\n\t\t<td><input type=\"text\" name=\"rss_title\" size=\"40\"></td></tr>\n\t\t\n\t\t<tr><td>RSS link to main website: In the rss.xml file, this is the main <pre>&lt;link&gt;</pre> tag.</td>\n\t\t<td><input type=\"text\" name=\"rss_link\" size=\"40\"></td></tr>\n\t\t\n\t\t<tr><td>RSS description: In the rss.xml file, this is the main <pre>&lt;description&gt;</pre> tag.</td>\n\t\t<td><input type=\"text\" name=\"rss_description\" size=\"60\"></td></tr>\n\t\t\n\t\t<tr><td><span class=\"notice\">* </span>Main website url that the tracker runs on, example: http://www.mywebsite.com</td>\n\t\t<td><input type=\"text\" name=\"website_url\" size=\"40\"></td></tr>\n\t\t\n\t\t<tr><td><span class=\"notice\">* </span>For HTTP seeding, this is the maximum total upload rate per second in kilobytes, for example 100 would be 100 KB/s</td>\n\t\t<td><input type=\"text\" name=\"max_upload_rate\" size=\"40\" value=\"100\"></td></tr>\n\t\t\n\t\t<tr><td><span class=\"notice\">* </span>For HTTP seeding, this is the maximum number of uploads to run at a time</td>\n\t\t<td><input type=\"text\" name=\"max_uploads\" size=\"40\" value=\"5\"></td></tr>\n\t\t\n\t\t<tr><td><span class=\"notice\">* </span>Timezone that the server runs on</td>\n\t\t<td>\n\t\t<select name=\"timezone\" id=\"timezone\">\n\t\t<option title=\"[UTC - 12] Baker Island Time\" value=\"-1200\">[UTC - 12] Baker Island Time</option>\n\t\t<option title=\"[UTC - 11] Niue Time, Samoa Standard Time\" value=\"-1100\">[UTC - 11] Niue Time, Samoa Standard Time</option>\n\t\t<option title=\"[UTC - 10] Hawaii-Aleutian Standard Time, Cook Island Time\" value=\"-1000\">[UTC - 10] Hawaii-Aleutian Standard Time, Cook Isl...</option>\n\t\t<option title=\"[UTC - 9:30] Marquesas Islands Time\" value=\"-0930\">[UTC - 9:30] Marquesas Islands Time</option>\n\t\t<option title=\"[UTC - 9] Alaska Standard Time, Gambier Island Time\" value=\"-0900\">[UTC - 9] Alaska Standard Time, Gambier Island Tim...</option>\n\t\t<option title=\"[UTC - 8] Pacific Standard Time\" value=\"-0800\">[UTC - 8] Pacific Standard Time</option>\n\t\t<option title=\"[UTC - 7] Mountain Standard Time\" value=\"-0700\">[UTC - 7] Mountain Standard Time</option>\n\t\t<option title=\"[UTC - 6] Central Standard Time\" value=\"-0600\">[UTC - 6] Central Standard Time</option>\n\t\t<option title=\"[UTC - 5] Eastern Standard Time\" value=\"-0500\">[UTC - 5] Eastern Standard Time</option>\n\t\t<option title=\"[UTC - 4] Atlantic Standard Time\" value=\"-0400\">[UTC - 4] Atlantic Standard Time</option>\n\t\t<option title=\"[UTC - 3:30] Newfoundland Standard Time\" value=\"-0330\">[UTC - 3:30] Newfoundland Standard Time</option>\n\t\t<option title=\"[UTC - 3] Amazon Standard Time, Central Greenland Time\" value=\"-0300\">[UTC - 3] Amazon Standard Time, Central Greenland ...</option>\n\t\t<option title=\"[UTC - 2] Fernando de Noronha Time, South Georgia &amp; the South Sandwich Islands Time\" value=\"-0200\">[UTC - 2] Fernando de Noronha Time, South Georgia ...</option>\n\t\t<option title=\"[UTC - 1] Azores Standard Time, Cape Verde Time, Eastern Greenland Time\" value=\"-0100\">[UTC - 1] Azores Standard Time, Cape Verde Time, E...</option>\n\t\t<option title=\"[UTC] Western European Time, Greenwich Mean Time\" value=\"+0000\" selected=\"selected\">[UTC] Western European Time, Greenwich Mean Time</option>\n\t\t<option title=\"[UTC + 1] Central European Time, West African Time\" value=\"+0100\">[UTC + 1] Central European Time, West African Time</option>\n\t\t<option title=\"[UTC + 2] Eastern European Time, Central African Time\" value=\"+0200\">[UTC + 2] Eastern European Time, Central African T...</option>\n\t\t<option title=\"[UTC + 3] Moscow Standard Time, Eastern African Time\" value=\"+0300\">[UTC + 3] Moscow Standard Time, Eastern African Ti...</option>\n\t\t<option title=\"[UTC + 3:30] Iran Standard Time\" value=\"+0330\">[UTC + 3:30] Iran Standard Time</option>\n\t\t<option title=\"[UTC + 4] Gulf Standard Time, Samara Standard Time\" value=\"+0400\">[UTC + 4] Gulf Standard Time, Samara Standard Time</option>\n\t\t<option title=\"[UTC + 4:30] Afghanistan Time\" value=\"+0430\">[UTC + 4:30] Afghanistan Time</option>\n\t\t<option title=\"[UTC + 5] Pakistan Standard Time, Yekaterinburg Standard Time\" value=\"+0500\">[UTC + 5] Pakistan Standard Time, Yekaterinburg St...</option>\n\t\t<option title=\"[UTC + 5:30] Indian Standard Time, Sri Lanka Time\" value=\"+0530\">[UTC + 5:30] Indian Standard Time, Sri Lanka Time</option>\n\t\t<option title=\"[UTC + 6] Bangladesh Time, Bhutan Time, Novosibirsk Standard Time\" value=\"+0600\">[UTC + 6] Bangladesh Time, Bhutan Time, Novosibirs...</option>\n\t\t<option title=\"[UTC + 6:30] Cocos Islands Time, Myanmar Time\" value=\"+0630\">[UTC + 6:30] Cocos Islands Time, Myanmar Time</option>\n\t\t<option title=\"[UTC + 7] Indochina Time, Krasnoyarsk Standard Time\" value=\"+0700\">[UTC + 7] Indochina Time, Krasnoyarsk Standard Tim...</option>\n\t\t<option title=\"[UTC + 8] Chinese Standard Time, Australian Western Standard Time, Irkutsk Standard Time\" value=\"+0800\">[UTC + 8] Chinese Standard Time, Australian Wester...</option>\n\t\t<option title=\"[UTC + 9] Japan Standard Time, Korea Standard Time, Chita Standard Time\" value=\"+0900\">[UTC + 9] Japan Standard Time, Korea Standard Time...</option>\n\t\t<option title=\"[UTC + 9:30] Australian Central Standard Time\" value=\"+0930\">[UTC + 9:30] Australian Central Standard Time</option>\n\t\t<option title=\"[UTC + 10] Australian Eastern Standard Time, Vladivostok Standard Time\" value=\"+1000\">[UTC + 10] Australian Eastern Standard Time, Vladi...</option>\n\t\t<option title=\"[UTC + 10:30] Lord Howe Standard Time\" value=\"+1030\">[UTC + 10:30] Lord Howe Standard Time</option>\n\t\t<option title=\"[UTC + 11] Solomon Island Time, Magadan Standard Time\" value=\"+1100\">[UTC + 11] Solomon Island Time, Magadan Standard T...</option>\n\t\t<option title=\"[UTC + 11:30] Norfolk Island Time\" value=\"+1130\">[UTC + 11:30] Norfolk Island Time</option>\n\t\t<option title=\"[UTC + 12] New Zealand Time, Fiji Time, Kamchatka Standard Time\" value=\"+1200\">[UTC + 12] New Zealand Time, Fiji Time, Kamchatka ...</option>\n\t\t<option title=\"[UTC + 13] Tonga Time, Phoenix Islands Time\" value=\"+1300\">[UTC + 13] Tonga Time, Phoenix Islands Time</option>\n\t\t<option title=\"[UTC + 14] Line Island Time\" value=\"+1400\">[UTC + 14] Line Island Time</option>\n\t\t</select>\n\t\t</td>\n\t\t</tr>\n\t\t\n\t\t</table>\n\t\t<br>\n\t\t<center>\n\t\t<input type=\"submit\" value=\"Create Config File\">\n\t\t</center>\n\t\t<br><br><br>\n\t\t</form>\n\t\t</body>\n\t\t</html>\n\t\t<?php\n\t}\n\n\tif (isset($_POST[\"config\"]))\n\t{\n\t\t//check required entries for values, if blank: error out\n\t\tif ($_POST[\"announceurl\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The announce URL is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"indexpagelimitspecify\"]) || $_POST[\"indexpagelimitspecify\"] == \"\" || $_POST[\"indexpagelimitspecify\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The index page limit is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"statspagelimitspecify\"]) || $_POST[\"statspagelimitspecify\"] == \"\" || $_POST[\"statspagelimitspecify\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The statistics page limit is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"report_interval\"]) || $_POST[\"report_interval\"] == \"\" || $_POST[\"report_interval\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The maximum reannounce interval is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"min_interval\"]) || $_POST[\"min_interval\"] == \"\" || $_POST[\"min_interval\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The minimum reannounce interval is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"maxpeers\"]) || $_POST[\"maxpeers\"] == \"\" || $_POST[\"maxpeers\"] > 300 || $_POST[\"maxpeers\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The number of peers to send in one request is not an integer, over 300, a negative number, zero, or blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"upload_username\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The upload username is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"upload_password\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The upload user password is blank. This is considered a security risk.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"admin_username\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The admin username is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"admin_password\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The admin user password is blank. This is considered a LARGE security risk.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"dbhost\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The database hostname is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"dbuser\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The database username is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"dbpass\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The database password is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"database\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The database name is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"rss_link\"] != \"\" && Substr($_POST[\"rss_link\"], 0, 7) != \"http://\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The RSS website URL does not start with http://</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"website_url\"] == \"\" || Substr($_POST[\"website_url\"], 0, 7) != \"http://\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The website URL does not start with http:// or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"max_upload_rate\"]) || $_POST[\"max_upload_rate\"] == \"\" || $_POST[\"max_upload_rate\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The maximum upload rate is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"max_uploads\"]) || $_POST[\"max_uploads\"] == \"\" || $_POST[\"max_uploads\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The maximum uploads is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"timezone\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The timezone is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"upload_username\"] == $_POST[\"admin_username\"])\n\t\t{\n\t\t\techo errorMessage() . \"Error: The admin username cannot be the same as the upload username.</p>\";\n\t\t\texit();\n\t\t}\n\t\n\t\t//create config.php based on user input\n\t\t//first try creating it on the server\n\t\tif (is_writable(\"./\"))\n\t\t{\n\t\t\t//go through checkboxes and change \"on\" to \"true\"\n\t\t\tif ($_POST[\"hiddentracker\"] == \"on\")\n\t\t\t\t$hiddentracker = \"true\";\n\t\t\telse\n\t\t\t\t$hiddentracker = \"false\";\t\n\t\t\tif ($_POST[\"enablerss\"] == \"on\")\n\t\t\t\t$enablerss = \"true\";\n\t\t\telse\n\t\t\t\t$enablerss = \"false\";\n\t\t\tif ($_POST[\"scrape\"] == \"on\")\n\t\t\t\t$scrape = \"true\";\n\t\t\telse\n\t\t\t\t$scrape = \"false\";\n\t\t\tif ($_POST[\"NAT\"] == \"on\")\n\t\t\t\t$NAT = \"true\";\n\t\t\telse\n\t\t\t\t$NAT = \"false\";\n\t\t\tif ($_POST[\"persist\"] == \"on\")\n\t\t\t\t$persist = \"true\";\n\t\t\telse\n\t\t\t\t$persist = \"false\";\n\t\t\tif ($_POST[\"ip_override\"] == \"on\")\n\t\t\t\t$ip_override = \"true\";\n\t\t\telse\n\t\t\t\t$ip_override = \"false\";\n\t\t\tif ($_POST[\"countbytes\"] == \"on\")\n\t\t\t\t$countbytes = \"true\";\n\t\t\telse\n\t\t\t\t$countbytes = \"false\";\n\n\t\t\t//write config.php file\n\t\t\t$fd = fopen(\"config.php\", \"w\") or die(errorMessage() . \"Error: couldn't make config.php!</p>\");\n\t\t\tfwrite($fd, \n\t\t\t\"<?php //Please do NOT edit this file, use the admin page for changes.\\n\" .\n\t\t\t\"\\$GLOBALS['hiddentracker'] = \" . $hiddentracker . \";\\n\" .\n\t\t\t\"\\$GLOBALS['scrape'] = \" . $scrape . \";\\n\" .\n\t\t\t\"\\$announceurl = \" . htmlspecialchars($_POST[\"announceurl\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['indexpagelimitspecify'] = \" . htmlspecialchars($_POST[\"indexpagelimitspecify\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['statspagelimitspecify'] = \" . htmlspecialchars($_POST[\"statspagelimitspecify\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['report_interval'] = \" . htmlspecialchars($_POST[\"report_interval\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['min_interval'] = \" . htmlspecialchars($_POST[\"min_interval\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['maxpeers'] = \" . htmlspecialchars($_POST[\"maxpeers\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['NAT'] = \" . $NAT . \";\\n\" .\n\t\t\t\"\\$GLOBALS['persist'] = \" . $persist . \";\\n\" .\n\t\t\t\"\\$GLOBALS['ip_override'] = \" . $ip_override . \";\\n\" .\n\t\t\t\"\\$GLOBALS['countbytes'] = \" . $countbytes . \";\\n\" .\n\t\t\t\"\\$upload_username = '\" . htmlspecialchars($_POST[\"upload_username\"]) . \"';\\n\" .\n\t\t\t\"\\$upload_password = '\" . md5($_POST[\"upload_username\"].$_POST[\"upload_password\"]) . \"';\\n\" .\n\t\t\t\"\\$admin_username = '\" . htmlspecialchars($_POST[\"admin_username\"]) . \"';\\n\" .\n\t\t\t\"\\$admin_password = '\" . md5($_POST[\"admin_username\"].$_POST[\"admin_password\"]) . \"';\\n\" .\n\t\t\t\"\\$GLOBALS['title'] = '\" . htmlspecialchars(addquotes($_POST[\"title\"])) . \"';\\n\" .\n\t\t\t\"\\$dbhost = '\" . htmlspecialchars($_POST[\"dbhost\"]) . \"';\\n\" .\n\t\t\t\"\\$dbuser = '\" . htmlspecialchars($_POST[\"dbuser\"]) . \"';\\n\" .\n\t\t\t\"\\$dbpass = '\" . htmlspecialchars($_POST[\"dbpass\"]) . \"';\\n\" .\n\t\t\t\"\\$database = '\" . htmlspecialchars($_POST[\"database\"]) . \"';\\n\" .\n\t\t\t\"\\$enablerss = \" . $enablerss . \";\\n\" .\n\t\t\t\"\\$rss_title = '\" . htmlspecialchars(addquotes($_POST[\"rss_title\"])) . \"';\\n\" .\n\t\t\t\"\\$rss_link = '\" . htmlspecialchars($_POST[\"rss_link\"]) . \"';\\n\" .\n\t\t\t\"\\$rss_description = '\" . htmlspecialchars(addquotes($_POST[\"rss_description\"])) . \"';\\n\" .\n\t\t\t\"\\$website_url = '\" . htmlspecialchars($_POST[\"website_url\"]) . \"';\\n\" .\n\t\t\t\"\\$GLOBALS['max_upload_rate'] = \" . htmlspecialchars($_POST['max_upload_rate']) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['max_uploads'] = \" . htmlspecialchars($_POST['max_uploads']) . \";\\n\" .\n\t\t\t\"\\$timezone = '\" . htmlspecialchars($_POST[\"timezone\"]) . \"';\\n\" .\n\t\t\t\"\\$prefix = '\" . htmlspecialchars($_POST[\"prefix\"]) . \"';\\n\" .\n\t\t\t\"?>\"\n\t\t\t);\n\n\t\t\tfclose($fd);\n\t\t\techo \"<br><p class=\\\"success\\\">config.php file was created successfully!</p>\";\n\t\t}\n\n\t\t//if unable to create on server, user downloads config.php file for future upload\n\t\tif (!is_writable(\"./\"))\n\t\t{\n\t\t\t?>\n\t\t\t<h2>\"config.php\" was unable to be created on the server, \n\t\t\tyou will have to download the file and upload it manually.</h2>\n\t\t\t<br>\n\t\t\t<form method=\"post\" action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\">\n\t\t\t<input type=\"hidden\" name=\"download\" value=\"1\">\n\t\t\t<input type=\"hidden\" name=\"hiddentracker\" value=\"<?php if (isset($_POST['hiddentracker']) AND $_POST['hiddentracker'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"scrape\" value=\"<?php if (isset($_POST['scrape']) AND $_POST['scrape'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"announceurl\" value=\"<?php echo $_POST['announceurl'];?>\">\n\t\t\t<input type=\"hidden\" name=\"indexpagelimitspecify\" value=\"<?php echo $_POST['indexpagelimitspecify'];?>\">\n\t\t\t<input type=\"hidden\" name=\"statspagelimitspecify\" value=\"<?php echo $_POST['statspagelimitspecify'];?>\">\n\t\t\t<input type=\"hidden\" name=\"report_interval\" value=\"<?php echo $_POST['report_interval'];?>\">\n\t\t\t<input type=\"hidden\" name=\"min_interval\" value=\"<?php echo $_POST['min_interval'];?>\">\n\t\t\t<input type=\"hidden\" name=\"maxpeers\" value=\"<?php echo $_POST['maxpeers'];?>\">\n\t\t\t<input type=\"hidden\" name=\"NAT\" value=\"<?php if (isset($_POST['NAT']) AND $_POST['NAT'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"persist\" value=\"<?php if (isset($_POST['persist']) AND $_POST['persist'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"ip_override\" value=\"<?php if (isset($_POST['ip_override']) AND $_POST['ip_override'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"countbytes\" value=\"<?php if (isset($_POST['countbytes']) AND $_POST['countbytes'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"upload_username\" value=\"<?php echo $_POST['upload_username'];?>\">\n\t\t\t<input type=\"hidden\" name=\"upload_password\" value=\"<?php echo md5($_POST[\"upload_username\"].$_POST[\"upload_password\"]);?>\">\n\t\t\t<input type=\"hidden\" name=\"admin_username\" value=\"<?php echo $_POST['admin_username'];?>\">\n\t\t\t<input type=\"hidden\" name=\"admin_password\" value=\"<?php echo md5($_POST[\"admin_username\"].$_POST[\"admin_password\"]);?>\">\n\t\t\t<input type=\"hidden\" name=\"title\" value=\"<?php echo $_POST['title'];?>\">\n\t\t\t<input type=\"hidden\" name=\"dbhost\" value=\"<?php echo $_POST['dbhost'];?>\">\n\t\t\t<input type=\"hidden\" name=\"dbuser\" value=\"<?php echo $_POST['dbuser'];?>\">\n\t\t\t<input type=\"hidden\" name=\"dbpass\" value=\"<?php echo $_POST['dbpass'];?>\">\n\t\t\t<input type=\"hidden\" name=\"database\" value=\"<?php echo $_POST['database'];?>\">\n\t\t\t<input type=\"hidden\" name=\"enablerss\" value=\"<?php if (isset($_POST['enablerss']) AND $_POST['enablerss'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"rss_title\" value=\"<?php echo $_POST['rss_title'];?>\">\n\t\t\t<input type=\"hidden\" name=\"rss_link\" value=\"<?php echo $_POST['rss_link'];?>\">\n\t\t\t<input type=\"hidden\" name=\"rss_description\" value=\"<?php echo $_POST['rss_description'];?>\">\n\t\t\t<input type=\"hidden\" name=\"website_url\" value=\"<?php echo $_POST['website_url'];?>\">\n\t\t\t<input type=\"hidden\" name=\"max_upload_rate\" value=\"<?php echo $_POST['max_upload_rate'];?>\">\n\t\t\t<input type=\"hidden\" name=\"max_uploads\" value=\"<?php echo $_POST['max_uploads'];?>\">\n\t\t\t<input type=\"hidden\" name=\"timezone\" value=\"<?php echo $_POST['timezone'];?>\">\n\t\t\t<input type=\"hidden\" name=\"prefix\" value=\"<?php echo $_POST['prefix'];?>\">\n\t\t\t<input type=\"submit\" value=\"Download config.php File\">\n\t\t\t</form>\n\t\t\t<br>\n\t\t\t<?php\n\t\t}\n\n\t\t//display message to delete install.php file\n\t\techo \"<p class=\\\"error\\\">Make sure you go and delete this installer script when you are done! (install.php)</p><br><br>\\n\";\n\t\techo \"<p class=\\\"error\\\">Also, check the permissions and make sure the 'torrents' and 'rss' folders are able to be written to by the server.</p><br><br>\\n\";\n\t\techo \"<br><center><a href=\\\"index.php\\\">Main Statistics Page</a></center>\\n\";\t\t\n\t\techo \"</body></html>\\n\";\n\t}\n\n?>\n", "<?php\nrequire_once(\"config.php\");\nrequire_once(\"funcsv2.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'] && !$_SESSION['upload_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=error\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n\t<title>Add Torrent to Tracker</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./css/style.css\" />\n</head>\n<body>\n\n<?php\n$tracker_url = $website_url . substr($_SERVER['PHP_SELF'], 0, -15) . $announceurl;\n\nif (isset($_FILES[\"torrent\"]))\n\taddTorrent();\n\n\nendOutput();\n\n\t\nfunction addTorrent()\n{\n\trequire (\"config.php\");\n\t$tracker_url = $website_url . substr($_SERVER['PHP_SELF'], 0, -15) . $announceurl;\n\t\n\t$hash = strtolower($_POST[\"hash\"]);\n\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Couldn't connect to the database, contact the administrator</p>\");\n\tmysql_select_db($database) or die(errorMessage() . \"Can't open the database.</p>\");\n\t\n\trequire_once (\"funcsv2.php\");\n\trequire_once (\"BDecode.php\");\n\trequire_once (\"BEncode.php\");\n\t\n\tif ($_FILES[\"torrent\"][\"error\"] != 4)\t\n\t{\n\t\t$fd = fopen($_FILES[\"torrent\"][\"tmp_name\"], \"rb\") or die(errorMessage() . \"File upload error 1</p>\\n\");\n\t\tis_uploaded_file($_FILES[\"torrent\"][\"tmp_name\"]) or die(errorMessage() . \"File upload error 2</p>\\n\");\n\t\t$alltorrent = fread($fd, filesize($_FILES[\"torrent\"][\"tmp_name\"]));\n\n\t\t$array = BDecode($alltorrent);\n\t\tif (!$array)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The parser was unable to load your torrent.  Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\tendOutput();\n\t\t\texit;\n\t\t}\n\n\t\tif (isset($array[\"announce-list\"])) {\n\t\t\t//multiple trackers are listed\n\t\t\t$found_tracker = false;\n\t\t\tfor ($i = 0; $i < count($array[\"announce-list\"]); $i++) {\n\t\t\t\tif (strtolower($array[\"announce-list\"][$i][0]) == $tracker_url) {\n\t\t\t\t\t$found_tracker = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ($found_tracker == false)\n\t\t\t{\n\t\t\t\techo errorMessage() . \"Error: Multiple trackers were found but none of them match the\n\t\t\t\t\tannounce URL:<br>$tracker_url<br>Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\t\tendOutput();\n\t\t\t\texit;\n\t\t\t}\n\t\t} else {\n\t\t\t//a single tracker is listed\n\t\t\tif (strtolower($array[\"announce\"]) != $tracker_url) {\n\t\t\t\techo errorMessage() . \"Error: The tracker announce URL does not match this:<br>$tracker_url<br>Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\t\tendOutput();\n\t\t\t\texit;\n\t\t\t}\n\t\t}\n\n\t\tif (isset($_POST[\"httpseed\"]) && $_POST[\"httpseed\"] == \"enabled\" && $_POST[\"relative_path\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: HTTP seeding was checked however no relative path was given.</p>\\n\";\n\t\t\tendOutput();\n\t\t\texit;\n\t\t}\n\t\tif (isset($_POST[\"httpseed\"]) && $_POST[\"httpseed\"] == \"enabled\" && $_POST[\"relative_path\"] != \"\")\n\t\t{\n\t\t\tif (Substr($_POST[\"relative_path\"], -1) == \"/\")\n\t\t\t{\n\t\t\t\tif (!is_dir($_POST[\"relative_path\"]))\n\t\t\t\t{\n\t\t\t\t\techo errorMessage() . \"Error: HTTP seeding relative path ends in / but is not a valid directory.</p>\\n\";\n\t\t\t\t\tendOutput();\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!is_file($_POST[\"relative_path\"]))\n\t\t\t\t{\n\t\t\t\t\techo errorMessage() . \"Error: HTTP seeding relative path is not a valid file.</p>\\n\";\n\t\t\t\t\tendOutput();\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (isset($_POST[\"getrightseed\"]) && $_POST[\"getrightseed\"] == \"enabled\" && $_POST[\"httpftplocation\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: GetRight HTTP seeding was checked however no URL was given.</p>\\n\";\n\t\t\tendOutput();\n\t\t\texit;\n\t\t}\n\t\tif (isset($_POST[\"getrightseed\"]) && $_POST[\"getrightseed\"] == \"enabled\" &&\n\t\t\t(Substr($_POST[\"httpftplocation\"], 0, 7) != \"http://\" && Substr($_POST[\"httpftplocation\"], 0, 6) != \"ftp://\")\n\t\t)\n\t\t{\n\t\t\techo errorMessage() . \"Error: GetRight HTTP seeding URL must start with http:// or ftp://</p>\\n\";\n\t\t\tendOutput();\n\t\t\texit;\n\t\t}\n\t\t$hash = @sha1(BEncode($array[\"info\"]));\n\t\tfclose($fd);\n\t\t\n\t\t$target_path = \"torrents/\";\n\t\t$target_path = $target_path . basename( clean($_FILES['torrent']['name'])); \n\t\t$move_torrent = move_uploaded_file($_FILES[\"torrent\"][\"tmp_name\"], $target_path);\n\t\tif ($move_torrent == false)\n\t\t{\n\t\t\techo errorMessage() . \"Unable to move \" . $_FILES[\"torrent\"][\"tmp_name\"] . \" to torrents/</p>\\n\";\n\t\t}\t\n\t}\n\t\n\n\tif (isset($_POST[\"filename\"]))\n\t\t$filename = clean($_POST[\"filename\"]);\n\telse\n\t\t$filename = \"\";\n\t\n\tif (isset($_POST[\"url\"]))\n\t\t$url = clean($_POST[\"url\"]);\n\telse\n\t\t$url = \"\";\n\n\tif (isset($_POST[\"autoset\"]))\n\tif (strcmp($_POST[\"autoset\"], \"enabled\") == 0)\n\t{\n\t\tif (strlen($filename) == 0 && isset($array[\"info\"][\"name\"]))\n\t\t\t$filename = $array[\"info\"][\"name\"];\n\t}\n\t\n\n\t//figure out total size of all files in torrent\n\t$info = $array[\"info\"];\n\t$total_size = 0;\n\tif (isset($info[\"files\"]))\n\t{\n\t\tforeach ($info[\"files\"] as $file)\n\t\t{\n\t\t\t$total_size = $total_size + $file[\"length\"];\n\t\t}\n\t}\n\telse\n\t{\n\t\t$total_size = $info[\"length\"];\n\t}\n\t\n\t//Validate torrent file, make sure everything is correct\n\t\n\t$filename = mysql_real_escape_string($filename);\n\t$filename = stripslashes($filename);\n\t$filename = htmlspecialchars(clean($filename));\n\t$url = htmlspecialchars(mysql_real_escape_string($url));\n\n\tif ((strlen($hash) != 40) || !verifyHash($hash))\n\t{\n\t\techo errorMessage() . \"Error: Info hash must be exactly 40 hex bytes.</p>\\n\";\n\t\tendOutput();\n\t}\n\n\tif (Substr($url, 0, 7) != \"http://\" && $url != \"\")\n\t{\n\t\techo errorMessage() . \"Error: The Torrent URL does not start with http:// Make sure you entered a correct URL.</p>\\n\";\n\t\tendOutput();\n\t}\n\n\t$query = \"INSERT INTO \".$prefix.\"namemap (info_hash, filename, url, size, pubDate) VALUES (\\\"$hash\\\", \\\"$filename\\\", \\\"$url\\\", \\\"$total_size\\\", \\\"\" . date('D, j M Y h:i:s') . \"\\\")\";\n\t$status = makeTorrent($hash, true);\n\tquickQuery($query);\n\tif ($status)\n\t{\n\t\techo \"<p class=\\\"success\\\">Torrent was added successfully.</p>\\n\";\n\t\techo \"<a href=\\\"newtorrents.php\\\"><img src=\\\"images/add.png\\\" border=\\\"0\\\" class=\\\"icon\\\" alt=\\\"Add Torrent\\\" title=\\\"Add Torrent\\\" /></a><a href=\\\"newtorrents.php\\\">Add Another Torrent</a><br>\\n\";\n\t\t//rename torrent file to match filename\n\t\trename(\"torrents/\" . clean($_FILES['torrent']['name']), \"torrents/\" . $filename . \".torrent\");\n\t\t//make torrent file readable by all\n\t\tchmod(\"torrents/\" . $filename . \".torrent\", 0644);\n\t\n\t\t//run RSS generator\n\t\trequire_once(\"rss_generator.php\");\n\t\t//Display information from DumpTorrentCGI.php\n\t\trequire_once(\"torrent_functions.php\");\n\t}\n\telse\n\t{\n\t\techo errorMessage() . \"There were some errors. Check if this torrent has been added previously.</p>\\n\";\n\t\t//delete torrent file if it doesn't exist in database\n\t\t$query = \"SELECT COUNT(*) FROM \".$prefix.\"summary WHERE info_hash = '$hash'\";\n\t\t$results = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\t$data = mysql_fetch_row($results);\n\t\tif ($data[0] == 0)\n\t\t{\n\t\t\tif (file_exists(\"torrents/\" . $_FILES['torrent']['name']))\n\t\t\t\tunlink(\"torrents/\" . $_FILES['torrent']['name']);\n\t\t}\n\t\t//make torrent file readable by all\n\t\tchmod(\"torrents/\" . $filename . \".torrent\", 0644);\n\t\tendOutput();\n\t}\n}\n\nfunction endOutput() \n{\n\trequire (\"config.php\");\n\t$tracker_url = $website_url . substr($_SERVER['PHP_SELF'], 0, -15) . $announceurl;\n\t?>\n\t<p align=\"right\"><a href=\"./docs/help.html\"><img src=\"images/help.png\" border=\"0\" class=\"icon\" alt=\"Help\" title=\"Help\" /></a><a href=\"./docs/help.html\">Help</a></p>\n\t<div class=\"center\">\n\t<h1>Add Torrent to Tracker Database</h1>\n\t<h3>Tracker URL: <?php echo $tracker_url;?></h3>\n\t<form enctype=\"multipart/form-data\" method=\"post\" action=\"<?php echo $_SERVER['PHP_SELF']; ?>\">\n\t<table>\n\t<tr>\n\t\t<td class=\"right\">Torrent file:</td>\n\t\t<td class=\"left\"><?php\n\t\tif (function_exists(\"sha1\"))\n\t\t\techo \"<input type=\\\"file\\\" name=\\\"torrent\\\" size=\\\"50\\\"/>\";\n\t\telse\n\t\t\techo '<i>File uploading not available - no SHA1 function.</i>';\n\t\t?></td>\n\t</tr>\n\t<tr><td colspan=\"2\"><hr></td></tr>\n\t<tr>\t\n\t<td class=\"center\" colspan=\"2\"><input type=\"checkbox\" name=\"httpseed\" value=\"enabled\">Use BitTornado HTTP seeding specification (optional)</td>\n\t</tr>\n\t<tr>\n\t<td class=\"right\">Relative location of file or directory:<br>e.g. ../../files/file.zip</td>\n\t<td class=\"left\"><input type=\"text\" name=\"relative_path\" size=\"70\"/></td>\n\t</tr>\n\t<tr><td colspan=\"2\"><hr></td></tr>\n\t<tr>\n\t<td class=\"center\" colspan=\"2\"><input type=\"checkbox\" name=\"getrightseed\" value=\"enabled\">Use GetRight HTTP seeding specification (optional)</td>\n\t</tr>\n\t<tr>\n\t<td class=\"right\">FTP/HTTP URL of file or directory:<br>e.g. http://yourwebsite.com/file.zip</td>\n\t<td class=\"left\"><input type=\"text\" name=\"httpftplocation\" size=\"70\"/></td>\n\t</tr>\n\t<tr><td colspan=\"2\"><hr></td></tr>\n\t<?php if (function_exists(\"sha1\")) \n\t\techo \"<tr><td class=\\\"center\\\" colspan=\\\"2\\\"><input type=\\\"checkbox\\\" name=\\\"autoset\\\" value=\\\"enabled\\\" checked=\\\"checked\\\" /> Fill in fields below automatically using data from the torrent file.</td></tr>\\n\";\n\t?>\n\t<tr>\n\t\t<td class=\"right\">Info Hash:</td>\n\t\t<td class=\"left\"><input type=\"text\" name=\"hash\" size=\"40\"/></td>\n\t</tr>\n\t<tr>\n\t\t<td class=\"right\">File name (optional): </td>\n\t\t<td class=\"left\"><input type=\"text\" name=\"filename\" size=\"60\" maxlength=\"200\"/></td>\n\t</tr>\n\t<tr>\n\t\t<td class=\"right\">Torrent's URL (optional): </td>\n\t\t<td class=\"left\"><input type=\"text\" name=\"url\" size=\"60\" maxlength=\"200\"/></td>\n\t</tr>\n\t<tr><td colspan=\"2\"><hr></td></tr>\n\t<tr>\n\t\t<td class=\"center\" colspan=\"2\"><input type=\"submit\" value=\"Add Torrent to Database\"/> - <input type=\"reset\" value=\"Clear Settings\"/></td>\n\t</tr>\n\t</table>\n\t<br>\n\t<input type=\"hidden\" name=\"username\" value=\"<?php echo $_POST['username']; ?>\"/>\n\t<input type=\"hidden\" name=\"password\" value=\"<?php echo $_POST['password']; ?>\"/>\n\t</form>\n\t<a href=\"index.php\"><img src=\"images/stats.png\" border=\"0\" class=\"icon\" alt=\"Tracker Statistics\" title=\"Tracker Statistics\" /></a><a href=\"index.php\">Return to Statistics Page</a><br>\n\t</div>\n\t</body></html>\n\t<?php \t\n\t// Still in function endOutput()\n\texit;\n}\n?>\n", "<?php\r\nrequire (\"config.php\");\r\nrequire_once (\"funcsv2.php\");\r\n//Check session\r\nsession_start();\r\n\r\nif (!$_SESSION['admin_logged_in'])\r\n{\r\n\t//check fails\r\n\theader(\"Location: authenticate.php?status=session\");\r\n\texit();\r\n}\r\n?>\r\n\r\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\r\n\r\n<html>\r\n<head>\r\n\t<title>Tracker User Statistics</title>\r\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\r\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\r\n</head>\r\n<body>\r\n<h1>Tracker User Statistics</h1>\r\n\r\n<form action=\"<?php echo $_SERVER[\"PHP_SELF\"];?>\" method=\"POST\">\r\nFilename Search:<input type=\"text\" name=\"filename_search\" size=\"40\"<?php if (isset($_POST[\"filename_search\"]))echo \" value=\\\"\" . $_POST[\"filename_search\"] . \"\\\"\";?>>\r\n<input type=\"submit\" value=\"Search\">\r\n</form>\r\n<br>\r\n\r\n<?php\r\nrequire_once (\"config.php\");\r\nrequire_once (\"funcsv2.php\");\r\n\r\n//connect to database and grab each torrent in database\r\nif ($GLOBALS[\"persist\"])\r\n\t$db = mysql_pconnect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\r\nelse\r\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\r\nmysql_select_db($database) or die(errorMessage() . \"Tracker error: can't open database $database - \" . mysql_error() . \"</p>\");\r\n\r\n//Display search information\r\nif (isset($_POST[\"filename_search\"]) && $_POST[\"filename_search\"] != \"\")\r\n{\r\n\techo \"<h2 align=\\\"center\\\">Search Results:</h2>\";\r\n\t$query = \"SELECT * FROM \".$prefix.\"summary LEFT JOIN \".$prefix.\"namemap ON \".$prefix.\"summary.info_hash = \".$prefix.\"namemap.info_hash WHERE \".$prefix.\"namemap.filename REGEXP \\\"$_POST[filename_search]\\\" ORDER BY \".$prefix.\"namemap.filename\";\r\n}\r\nelse //display everything\r\n{\r\n\t$scriptname = $_SERVER[\"PHP_SELF\"] . \"?\";\r\n\t\r\n\tif (!isset($_GET[\"activeonly\"])) \r\n\t\techo \"<a href=\\\"$scriptname\" . \"activeonly=yes\\\">Show only torrents with seeders/leechers</a>\\n\";\r\n\telse\r\n\t{\r\n\t\techo \"<a href=\\\"$scriptname\\\">Show all torrents</a>\\n\";\r\n\t\t$scriptname = $scriptname . \"activeonly=yes&\";\t\r\n\t}\r\n\r\n\tif (isset($_GET[\"activeonly\"]))\r\n\t\t$where = \" WHERE leechers+seeds > 0\";\r\n\telse\r\n\t\t$where = \" \";\r\n\t\r\n\t$query = \"SELECT COUNT(*) FROM \".$prefix.\"summary $where\";\r\n\t$results = mysql_query($query);\r\n\t$res = mysql_result($results,0,0);\r\n\t\r\n\techo \"<p align='center'>Page: \\n\";\r\n\t$count = 0;\r\n\t$page = 1;\r\n\twhile($count < $res)\r\n\t{\r\n\t\tif (isset($_GET[\"page_number\"]) && $page == $_GET[\"page_number\"])\r\n\t\t\techo \"<b><a href=\\\"$scriptname\" . \"page_number=$page\\\">($page)</a></b>-\\n\";\r\n\t\telse if (!isset($_GET[\"page_number\"]) && $page == 1)\r\n\t\t\techo \"<b><a href=\\\"$scriptname\" . \"page_number=$page\\\">($page)</a></b>-\\n\";\r\n\t\telse\r\n\t\t\techo \"<a href=\\\"$scriptname\" . \"page_number=$page\\\">$page</a>-\\n\";\r\n\t\t$page++;\r\n\t\t$count = $count + ($GLOBALS[\"statspagelimitspecify\"]);\r\n\t}\r\n\techo \"</p>\\n\";\r\n\t\r\n\tif (!isset($_GET[\"page_number\"]))\r\n\t\t$query = \"SELECT * FROM \".$prefix.\"summary LEFT JOIN \".$prefix.\"namemap ON \".$prefix.\"summary.info_hash = \".$prefix.\"namemap.info_hash $where ORDER BY \".$prefix.\"namemap.filename LIMIT 0,${GLOBALS['statspagelimitspecify']}\";\r\n\telse\r\n\t{\r\n\t\t$page_limit = ($_GET[\"page_number\"] - 1) * ($GLOBALS[\"statspagelimitspecify\"]);\r\n\t\t$query = \"SELECT * FROM \".$prefix.\"summary LEFT JOIN \".$prefix.\"namemap ON \".$prefix.\"summary.info_hash = \".$prefix.\"namemap.info_hash $where ORDER BY \".$prefix.\"namemap.filename LIMIT $page_limit,${GLOBALS['statspagelimitspecify']}\";\r\n\t}\r\n}\r\n\r\n$results = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\r\n\r\nwhile ($data = mysql_fetch_row($results))\r\n{\r\n\t$xhash = \"x\" . $data[0];\r\n\t$query2 = \"SELECT * FROM \".$prefix.\"$xhash\";\r\n\t$results2 = mysql_query($query2) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\r\n\r\n\tif (mysql_num_rows($results2) == 0 && isset($_GET[\"activeonly\"]))\r\n\t\tbreak;\r\n\telse\r\n\t{\r\n\t\techo \"<hr><table>\\n\";\r\n\t\techo \"<tr><th>Info Hash</th><th>Filename</th><th>URL</th><th>File Size</th><th>Publication Date</th></tr>\\n\";\r\n\t\techo \"<tr><td>\" . $data[0] . \"</td><td>\" . $data[11] . \"</td><td>\\n\";\r\n\t\tif (Substr($data[12], 0, 7) == \"http://\")\r\n\t\t\techo \"<a href=\\\"\" . $data[12] . \"\\\">\" . $data[12] . \"</a>\\n\";\r\n\t\telse\r\n\t\t\techo $data[12];\r\n\t\techo \"</td><td>\" . bytesToString($data[13]) . \"</td>\\n\";\r\n\t\techo \"<td>\" . $data[14] . \"</td></tr>\\n\";\r\n\t\techo \"</table>\\n\";\r\n\t}\r\n\r\n\techo \"<table>\\n\";\r\n\techo \"<tr><th class=\\\"subheader\\\">IP Address</th><th class=\\\"subheader\\\">Data Left to Download</th><th class=\\\"subheader\\\" width=200>Percent Finished</th><th class=\\\"subheader\\\">Port</th><th class=\\\"subheader\\\">Last Update</th><th class=\\\"subheader\\\">NAT User</th></tr>\\n\";\r\n\twhile ($data2 = mysql_fetch_row($results2))\r\n\t{\r\n\t\t//grab information on each user\r\n\t\techo \"<tr><td>\" . $data2[2] . \"</td>\\n\";\r\n\t\techo \"<td>\" . bytesToString($data2[1]) . \"</td>\\n\";\r\n\r\n\t\t//calculate percent done for user\r\n\t\t$percent_done = 1.00;\r\n\t\tif ($data2[1] != 0) //only run calculation if they are still downloading\r\n\t\t{\r\n\t\t\t$size_in_bytes = $data[13];\r\n\t\t\tif ($size_in_bytes == 0) //thou shalt not divide by zero\r\n\t\t\t\t$percent_done = 0;\r\n\t\t\telse\r\n\t\t\t\t$percent_done = round(($size_in_bytes - $data2[1]) / $size_in_bytes, 3);\r\n\t\t}\r\n\r\n\t\t?>\r\n\t\t<td>\r\n\t\t<table class=\"percentages\" cellspacing=\"0\">\r\n\t\t<tr>\r\n\t\t<td align=\"right\" class=\"percent\" width=\"<?php echo round($percent_done * 200, 0); ?>\" height=\"15\">\r\n\t\t<?php if ($percent_done > .5) echo $percent_done * 100 . \"%\"; ?>\r\n\t\t</td>\r\n\t\t<td align=\"left\" class=\"percentleft\" width=\"<?php echo 200 - round($percent_done * 200, 0); ?>\" height=\"15\">\r\n\t\t<?php if ($percent_done <= .5) echo $percent_done * 100 . \"%\"; ?>\t\t\r\n\t\t</td>\r\n\t\t</tr>\r\n\t\t</table>\r\n\t\t</td>\r\n\t\t<?php\r\n\t\techo \"<td>\" . $data2[3] . \"</td>\\n\"; //port\r\n\t\techo \"<td>\" . date('g:ia m-d-Y', $data2[5]) . \"</td>\\n\"; //last time check-in\r\n\t\techo \"<td>\" . $data2[7] . \"</td>\\n\"; //NAT user\r\n\t\techo \"</tr>\\n\";\r\n\t}\r\n\techo \"</table><br>\\n\";\r\n}\r\necho \"<hr>\";\r\nif (!isset($_POST[\"filename_search\"]))\r\n{\r\n\techo \"<p align='center'>Page: \\n\";\r\n\t$count = 0;\r\n\t$page = 1;\r\n\twhile($count < $res)\r\n\t{\r\n\tif (isset($_GET[\"page_number\"]) && $page == $_GET[\"page_number\"])\r\n\t\techo \"<b><a href=\\\"$scriptname\" . \"page_number=$page\\\">($page)</a></b>-\\n\";\r\n\telse if (!isset($_GET[\"page_number\"]) && $page == 1)\r\n\t\techo \"<b><a href=\\\"$scriptname\" . \"page_number=$page\\\">($page)</a></b>-\\n\";\r\n\telse\r\n\t\techo \"<a href=\\\"$scriptname\" . \"page_number=$page\\\">$page</a>-\\n\";\r\n\t$page++;\r\n\t$count = $count + ($GLOBALS[\"statspagelimitspecify\"]);\r\n\t}\r\n\techo \"</p>\\n\";\r\n}\r\n?>\r\n\r\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\r\n</body>\r\n</html>\r\n"], "fixing_code": ["<?php\nrequire (\"config.php\");\nrequire (\"funcsv2.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html><head><title>Torrent Information</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head><body>\n<?php\nrequire_once(\"torrent_functions.php\");\n?>\n<table width=\"50%\" border=0><tr><td>\nThis script parses a torrent file and displays detailed information about it.\n</td></tr>\n</table><br>\n<form enctype=\"multipart/form-data\" method=\"POST\" action=\"<?php echo htmlentities($_SERVER['PHP_SELF']); ?>\">\nTorrent file: <input type=\"file\" name=\"torrent\" size=\"40\"><br>\n<br>\nOR\n<br><br>\nTorrent URL: <input type=text name=\"url\" size=\"50\"><br><br>\nOutput type: <select name=\"output\">\n<option value=\"-1\">Auto-detect\n<option value=\"0\">Classic (raw)\n<option value=\"1\">.torrent file\n<option value=\"2\">/scrape\n<option value=\"3\">/announce\n</select><br><br>\n<input type=\"submit\" value=\"Decode\">\n</form>\n\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body></html>\n", "<?php\n\nrequire (\"config.php\");\nrequire (\"funcsv2.php\"); //required for errorMessage() function\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n<html>\n<head>\n\t<title>Batch Upload Torrents</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head>\n<body>\n<center>\n<h1>Batch Upload Torrents</h1>\n</center>\n<br>\n\n<?php\n\nif (isset($_FILES[\"zipfile\"]) && $_FILES[\"zipfile\"][\"error\"] != 4 && isset($_FILES[\"zipfile\"][\"tmp_name\"])) //4 corresponds to the error no file uploaded\n{\n\t?>\n\t<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n\t<br><br>\n\t<?php\n\t$zip = zip_open($_FILES[\"zipfile\"][\"tmp_name\"]);\n\t\n\tif ($zip == true)\n\t{\n\t\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Couldn't connect to the database, contact the administrator</p>\");\n\t\tmysql_select_db($database) or die(errorMessage() . \"Can't open the database.</p>\");\n\t\n\t   while ($zip_entry = zip_read($zip))\n\t   {\n\t   \techo \"Name: \" . zip_entry_name($zip_entry) . \"<br>\\n\";\n\t      if (substr(zip_entry_name($zip_entry), -8) == \".torrent\")\n\t\t\t{\n\t\t\t\t$error_status = true;\n\t\t\t\tif (zip_entry_open($zip, $zip_entry, \"r\"))\n\t\t\t   {\n\t\t\t   \t//read in file from zip\n\t\t\t  \t\t$buffer = zip_entry_read($zip_entry, zip_entry_filesize($zip_entry));\n\t\t\t      //go through each torrent file and add it if possible\n\t\t\t\t\trequire_once (\"BDecode.php\");\n\t\t\t\t\trequire_once (\"BEncode.php\");\n\t\t\t\t\t\n\t\t\t\t\t$tracker_url = $website_url . substr($_SERVER['REQUEST_URI'], 0, -16) . $announceurl;\n\t\t\t\t\t\n\t\t\t\t\t$array = BDecode($buffer);\n\t\t\t\t\tif (!$array)\n\t\t\t\t\t{\n\t\t\t\t\t\techo errorMessage() . \"Error: The parser was unable to load this torrent.</p>\\n\";\n\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t}\n\t\t\t\t\tif (isset($array[\"announce-list\"])) {\n\t\t\t\t\t\t//multiple trackers are listed\n\t\t\t\t\t\t$found_tracker = false;\n\t\t\t\t\t\tfor ($i = 0; $i < count($array[\"announce-list\"]); $i++) {\n\t\t\t\t\t\t\tif (strtolower($array[\"announce-list\"][$i][0]) == $tracker_url) {\n\t\t\t\t\t\t\t\t$found_tracker = true;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ($found_tracker == false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\techo errorMessage() . \"Error: Multiple trackers were found but none of them match the\n\t\t\t\t\t\t\t\tannounce URL:<br>$tracker_url<br>Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t\t\texit;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//a single tracker is listed\n\t\t\t\t\t\tif (strtolower($array[\"announce\"]) != $tracker_url) {\n\t\t\t\t\t\t\techo errorMessage() . \"Error: The tracker announce URL does not match this:<br>$tracker_url<br>Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t\t\texit;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (function_exists(\"sha1\"))\n\t\t\t\t\t\t$hash = @sha1(BEncode($array[\"info\"]));\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\techo errorMessage() . \"Error: It looks like you do not have a hash function available, this will not work.</p>\\n\";\n\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\t//figure out total size of all files in torrent, needed for insertion into database\n\t\t\t\t\t$info = $array[\"info\"];\n\t\t\t\t\t$total_size = 0;\n\t\t\t\t\tif (isset($info[\"files\"]))\n\t\t\t\t\t{\n\t\t\t\t\t\tforeach ($info[\"files\"] as $file)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$total_size = $total_size + $file[\"length\"];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$total_size = $info[\"length\"];\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t//Validate torrent file, make sure everything is correct\n\t\t\t\t\t$filename = $array[\"info\"][\"name\"];\n\t\t\t\t\t$filename = mysql_real_escape_string($filename);\n\t\t\t\t\t$filename = stripslashes($filename);\n\t\t\t\t\t$filename = clean($filename);\n\t\t\t\t\n\t\t\t\t\tif ((strlen($hash) != 40) || !verifyHash($hash))\n\t\t\t\t\t{\n\t\t\t\t\t\techo errorMessage() . \"Error: Info hash must be exactly 40 hex bytes.</p>\\n\";\n\t\t\t\t\t\t$error_status = false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\n\t\t\t\t\tif ($error_status == true)\n\t\t\t\t\t{\n\t\t\t\t\t\t$query = \"INSERT INTO \" . $prefix . \"namemap (info_hash, filename, url, size, pubDate) VALUES (\\\"$hash\\\", \\\"$filename\\\", \\\"$url\\\", \\\"$total_size\\\", \\\"\" . date('D, j M Y h:i:s') . \"\\\")\";\n\t\t\t\t\t\t$status = makeTorrent($hash, true);\n\t\t\t\t\t\tquickQuery($query);\n\t\t\t\t\t\tif ($status == true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t//create torrent file in folder, at this point we assume it's valid\n\t\t\t\t\t\t\tif (!$handle = fopen(\"torrents/\" . $filename . \".torrent\", 'w'))\n\t\t\t\t\t\t\t{\n\t         \t\t\t\techo errorMessage() . \"Error: Can't write to file.</p>\\n\";\n\t        \t\t\t\t\tbreak;\n\t    \t\t\t\t\t}\n\t\t\t\t\t\t\t//populate file with contents\n\t\t\t\t\t   \tif (fwrite($handle, $buffer) === FALSE)\n\t\t\t\t\t   \t{\n\t\t\t\t\t       \techo errorMessage() . \"Error: Can't write to file.</p>\\n\";\n\t\t\t\t\t      \tbreak;\n\t\t\t\t\t   \t}\n\t\t\t\t\t   \tfclose($handle);\n\t\t\t\t\t\t\t//make torrent file readable by all\n\t\t\t\t\t\t\tchmod(\"torrents/\" . $filename . \".torrent\", 0644);\n\t\t\t\t\t\t\techo \"<p class=\\\"success\\\">Torrent was added successfully.</p>\\n\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\techo errorMessage() . \"There were some errors. Check if this torrent has been added previously.</p>\\n\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\n\t\t\t      zip_entry_close($zip_entry);\n\t\t\t    }\n\t\t\t} \n\t\t\telse\n\t\t\t\techo errorMessage() . \"Unable to add torrent, it doesn't end in .torrent</p>\\n\";\n\t\t\t\n\t\techo \"<br>\";\n\t   }\n\t   zip_close($zip);\n\t}\n\n\t//finished reading zip file\n\t\n\t//run RSS generator because we have new torrents in database\n\trequire_once(\"rss_generator.php\");\n\n\n}\nelse\n{\n\t//display upload box\n\t?>\n\t<?php require(\"config.php\"); $tracker_url = $website_url . substr($_SERVER['REQUEST_URI'], 0, -16) . $announceurl; ?>\n\t<p>This page lets you upload a zip file containing multiple torrents and add them into the database.  The\n\tzip file cannot have any folders in it.  This requires that you are running PHP with compiled zip support.\n\tIf you are unsure, check with your system administrator or phpinfo().  Any torrents that already exist in\n\tthe database will be skipped.  If you want to use HTTP seeding you'll need to add this feature to the torrent\n\tfiles before you zip and upload the file.  If you are uploading a very large zip file this may take some time...\n\t<br>\n\t<br>\n\tThe torrents you are batch uploading should include the following Tracker URL: <b><?php echo $tracker_url ?></b></p>\n\t\n\t<?php\n\tif (function_exists(\"zip_open\"))\n\t{\n\t\t?>\n\t\t<form enctype=\"multipart/form-data\" action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"post\">\n\t\t<b>Zip File:</b><input type=\"file\" name=\"zipfile\" size=\"50\"/>\n\t\t<input type=\"submit\" value=\"Upload ZIP File\"/>\n\t\t</form>\n\t\t<?php\n\t}\n\telse\n\t\techo errorMessage() . \"Error: It looks like you don't have ZIP support compiled into PHP.</p>\\n\";\n}\n\n?>\n\n<br>\n<br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body>\n</html>\n", "<?php\n\nrequire (\"config.php\");\nrequire (\"funcsv2.php\"); //required for errorMessage() function\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n<html>\n<head>\n\t<title>Change CSS File</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n\t<style type=\"text/css\">\n\t\ttd.cell{\n\t\t\twidth: 2%;\n\t\t\t}\n\t</style>\n\t<script type=\"text/javascript\">\n\tfunction changeColor(color)\n\t{\n\t\tdocument.getElementById(\"color_box\").value = color;\n\t\tdocument.getElementById(\"thecolor\").style.backgroundColor = color;\n\t}\n\t</script>\n</head>\n<body>\n<center>\n<h1>Change CSS File</h1>\n</center>\n<br>\n\n<?php\n\nif (isset($_POST[\"set_css\"]))\n{\n\t//delete style.css file\n\tif (copy(\"./css/\" . $_POST[\"set_css\"], \"./css/style.css\"))\n\t\techo \"<p class=\\\"success\\\">style.css file has been replaced with \" . $_POST[\"set_css\"] . \"</p>\";\n\telse\n\t{\n\t\techo errorMessage() . \"Error: Unable to copy over style.css, are the permissions correct?</p>\";\n\t\texit();\n\t}\n}\nelseif (isset($_POST[\"delete_css\"]))\n{\n\t//delete css file\n\tif (unlink(\"./css/\" . $_POST[\"delete_css\"]))\n\t\techo \"<p class=\\\"success\\\">\" . $_POST[\"delete_css\"] . \" has been deleted</p>\";\n\telse\n\t{\n\t\techo errorMessage() . \"Error: Unable to delete \" . $_POST[\"delete_css\"] . \", are you sure the permissions are correct?</p>\";\n\t\texit();\n\t}\n}\nelseif (isset($_POST[\"create_css\"]))\n{\n\t//create new css file by copying over style.css into new file\n\tif (substr($_POST[\"create_css\"], -4) == \".css\")\n\t{\n\t\tif (!file_exists(\"./css/\" . $_POST[\"create_css\"]))\n\t\t{\n\t\t\tif (copy(\"./css/style.css\", \"./css/\" . $_POST[\"create_css\"]))\n\t\t\t\techo \"<p class=\\\"success\\\">\" . $_POST[\"create_css\"] . \", was created successfuly</p>\";\n\t\t\telse\n\t\t\t{\n\t\t\t\techo errorMessage() . \"Error: Unabled to create \" . $_POST[\"create_css\"] . \", are you sure the permissions are correct?</p>\";\n\t\t\t\texit();\t\t\t\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\techo errorMessage() . \"Error: \" . $_POST[\"create_css\"] . \" already exists, please choose a different name</p>\";\n\t\t\texit();\n\t\t}\n\t}\n\telse\n\t{\n\t\techo errorMessage() . \"Error: Your file doesn't end with .css</p>\";\n\t\texit();\n\t}\n}\n\nif (isset($_POST[\"create_css\"]) || isset($_POST[\"edit_css\"]))\n{\n\t//display color picker\n\t?>\n\t<h2>Color Picker:</h2>\n\t<table style=\"cursor: pointer;\" border=\"0\">\n\t<?php\n\tfunction rgbhex($red, $green, $blue)\n\t{\n\t\treturn sprintf('#%02X%02X%02X', $red, $green, $blue);\n\t}\n\t\n\t//create table of 216 web safe colors\n\tfor ($red = 0; $red < 256; $red = $red + 51)\n\t{\n\t\techo \"<tr>\";\n\t\tfor ($green = 0; $green < 256; $green = $green + 51)\n\t\t{\n\t\t\tfor ($blue = 0; $blue < 256; $blue = $blue + 51)\n\t\t\t{\n\t\t\t\t$hexcolor = rgbhex($red, $green, $blue);\n\t\t\t\techo \"<td bgcolor='\" . $hexcolor . \"' title='\" . $hexcolor . \"' class='cell' onClick=\\\"changeColor('\" . $hexcolor . \"')\\\">&nbsp;</td>\\n\";\n\t\t\t}\n\t\t}\n\t\techo \"</tr>\";\n\t}\n\t\n\t?>\n\t</table>\n\t<br>\n\t<b>Color:</b>\n\t<table border=\"0\"><tr>\n\t<td id=\"thecolor\" align=\"left\" bgcolor=\"#000000\"><input type=\"text\" id=\"color_box\" value=\"#000000\"/>\n\t</td></tr>\n\t</table>\n\t<br>\n\t<?php\n\t\n\tif (isset($_POST[\"create_css\"]))\n\t\t$filename = $_POST[\"create_css\"];\n\tif (isset($_POST[\"edit_css\"]))\n\t\t$filename = $_POST[\"edit_css\"];\n\t//display text box with css in it\n\t?>\n\t<h2>Editing File: <?php echo $filename;?></h2>\n\t<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"post\">\n\t<input type=\"hidden\" name=\"hidden_filename\" value=\"<?php echo $filename;?>\"/>\n\t<input type=\"hidden\" name=\"current_css_file\" value=\"<?php echo $_POST['current_css_file'];?>\"/>\n\t<textarea name=\"file_contents\" cols=\"120\" rows=\"20\"><?php\n\t//open css file\n\treadfile(\"./css/\" . $filename);\n\t?></textarea>\n\t<br><br>\n\t<input type=\"submit\" value=\"Save File\"/>\n\t</form>\n\t<?php\n\t\n}\n\nif (isset($_POST[\"file_contents\"]))\n{\n\t//save previously edited text into file\n\tif (is_writable(\"./css/\" . $_POST[\"hidden_filename\"]))\n\t{\n\t\t//open file\n\t\t$stream = fopen(\"./css/\" . $_POST[\"hidden_filename\"], \"w\");\n\t\tfwrite($stream, $_POST[\"file_contents\"]);\n\t\tfclose($stream);\n\t\techo \"<p class=\\\"success\\\">\" . $_POST[\"hidden_filename\"] . \", was saved successfuly</p>\";\n\t}\n\telse\n\t{\n\t\techo errorMessage() . \"Error: The file cannot be saved, check the permissions</p>\";\n\t\texit();\n\t}\n\t//if editing the current css file, replace that too\n\tif ($_POST[\"current_css_file\"] == $_POST[\"hidden_filename\"])\n\t{\n\t\tif (copy(\"./css/\" . $_POST[\"hidden_filename\"], \"./css/style.css\"))\n\t\t\techo \"<p class=\\\"success\\\">style.css file has been replaced with \" . $_POST[\"hidden_filename\"] . \"</p>\";\n\t\telse\n\t\t{\n\t\t\techo errorMessage() . \"Error: Unable to copy over style.css, are the permissions correct?</p>\";\n\t\t\texit();\n\t\t}\n\t}\n}\n\nif (!isset($_POST[\"create_css\"]) && !isset($_POST[\"edit_css\"]) && !isset($_POST[\"delete_css\"]) && \n!isset($_POST[\"set_css\"]) && !isset($_POST[\"file_contents\"]))\n{\n\t//save all files in css directory to array\n\t$current_css_file = \"\";\n\t$css_style_md5 = md5_file(\"./css/style.css\");\n\t$number_files = 0;\n\tif ($dh = opendir(\"./css/\"))\n\t{\n\t\twhile (($file = readdir($dh)) !== false)\n\t\t{\n\t\t\tif (filetype(\"./css/\" . $file) == \"file\" && $file != \"index.php\" && $file != \"style.css\" && substr($file, -4) == \".css\")\n\t\t\t{\n\t\t\t\tif (md5_file(\"./css/\" . $file) == $css_style_md5)\n\t\t\t\t\t$current_css_file = $file;\n\t\t\t\t$files_array[$number_files] = $file;\n\t\t\t\t$number_files++;\n\t\t\t}\n\t\t}\n\t\tclosedir($dh);\n\t}\n\techo \"<b>Currently Used CSS File: \" . $current_css_file . \"</b><br><br>\";\n\t?>\n\t\n\t<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"post\">\n\t<b>Set CSS File:</b><select name=\"set_css\">\n\t<?php\n\tfor ($i = 0; $i < $number_files; $i++)\n\t{\n\t\tif ($files_array[$i] != $current_css_file) //no point setting it to itself...\n\t\t\techo \"<option value=\\\"\" . $files_array[$i] . \"\\\">\" . $files_array[$i] . \"</option>\\n\\t\";\n\t}\n\t?>\n\t</select>\n\t<input type=\"submit\" value=\"Set CSS File\"/>\n\t</form>\n\t<br><br>\n\t\n\t<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"post\"> \n\t<b>Delete CSS File:</b><select name=\"delete_css\">\n\t<?php\n\tfor ($i = 0; $i < $number_files; $i++)\n\t{\n\t\tif ($files_array[$i] != $current_css_file) //can't delete the file if it's already being used...\n\t\t\techo \"<option value=\\\"\" . $files_array[$i] . \"\\\">\" . $files_array[$i] . \"</option>\\n\\t\";\n\t}\n\t?>\n\t</select>\n\t<input type=\"submit\" value=\"Delete CSS File\"/>\n\t</form>\n\t<br><br>\n\t\n\t<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"post\">\n\t<input type=\"hidden\" name=\"current_css_file\" value=\"<?php echo $current_css_file;?>\"/>\n\t<b>Edit Existing CSS File:</b><select name=\"edit_css\">\n\t<?php\n\tfor ($i = 0; $i < $number_files; $i++)\n\t{\n\t\techo \"<option value=\\\"\" . $files_array[$i] . \"\\\">\" . $files_array[$i] . \"</option>\\n\\t\";\n\t}\n\t?>\n\t</select>\n\t<input type=\"submit\" value=\"Edit CSS File\"/>\n\t</form>\n\t<br><br>\n\t\n\t<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"post\"> \n\t<b>Create New CSS File (e.g. mycssfile.css):</b>\n\t<input type=\"text\" size=\"40\" name=\"create_css\"/>\n\t<input type=\"submit\" value=\"Create New CSS File\"/>\n\t</form>\n\t<?php\n}\n?>\n\n<br>\n<br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body>\n</html>\n", "<?php\nrequire (\"config.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n\t<title>Delete Torrent(s) From Database</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./css/style.css\" />\n\t<script language=\"javascript\">\n\tfunction selectRow(checkBox)\n\t{\n\t\tif (checkBox.value % 2 == 1) //odd\n\t\t\tvar Style = \"row1\";\n\t\telse //even\n\t\t\tvar Style = \"row0\";\n\t\tif (checkBox.checked == true)\n\t\t\tvar Style = \"selected\";\n\t\tvar el = checkBox.parentNode;\n\t\twhile(el.tagName.toLowerCase() != \"tr\")\n\t\t{\n\t\t\tel = el.parentNode;\n    \t\t}\n    \t\tel.className = Style;\n\t}\n\t</script>\n</head>\n<body>\n<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\"  method=\"POST\">\n<?php\nrequire_once(\"funcsv2.php\");\n\n// check database user\nif (isset($dbuser) && isset($dbpass))\n{\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Cannot connect to database. Check your username and password in the config file.</p>\");\n\tmysql_select_db($database) or die(errorMessage() . \"Error selecting database.</p>\");\n\n\tforeach ($_POST as $left => $right)\n\t{\n\t\tif (strlen($left) == 41)\n\t\t{\n\t\t\tif (!is_numeric($right) || !verifyHash(substr($left, 1)))\n\t\t\t\tcontinue;\n\t\t\t$hash = substr($left, 1);\n\t\t\t//delete torrent file\n\t\t\t$query = \"SELECT filename FROM \".$prefix.\"namemap WHERE info_hash =\\\"$hash\\\"\";\n\t\t\t$delete_file = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\t\t$delete = mysql_fetch_row($delete_file);\n\t\t\tunlink(\"torrents/\" . $delete[0] . \".torrent\");\n\t\t\t//continue deleting information in database\n\t\t\t@mysql_query(\"DELETE FROM \" . $prefix . \"summary WHERE info_hash=\\\"$hash\\\"\");\n\t\t\t@mysql_query(\"DELETE FROM \" . $prefix . \"namemap WHERE info_hash=\\\"$hash\\\"\"); \n\t\t\t@mysql_query(\"DELETE FROM \" . $prefix . \"timestamps WHERE info_hash=\\\"$hash\\\"\");\n\t\t\t@mysql_query(\"DELETE FROM \" . $prefix . \"webseedfiles WHERE info_hash=\\\"$hash\\\"\");\n\t\t\t@mysql_query(\"DROP TABLE \" . $prefix . \"y$hash\");\n\t\t\t@mysql_query(\"DROP TABLE \" . $prefix . \"x$hash\");\n\t\t\t//optimize tables, good after major changes have been made to database\n\t\t\t@mysql_query(\"OPTIMIZE TABLE \" . $prefix . \"summary\");\n\t\t\t@mysql_query(\"OPTIMIZE TABLE \" . $prefix . \"namemap\");\n\t\t\t@mysql_query(\"OPTIMIZE TABLE \" . $prefix . \"timestamps\");\n\t\t\t//run RSS generator\n\t\t\trequire_once(\"rss_generator.php\");\n\t\t}\n\t}\n}\nelse\n{\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\n\tmysql_select_db($database) or die(errorMessage() . \"Tracker error: can't open database $database - \" . mysql_error() . \"</p>\");\n\t$GLOBALS[\"maydelete\"] = false;\n}\n\n?>\n<h1>Delete Torrent(s) From Database</h1>\n<table class=\"torrentlist\" cellspacing=\"1\">\n<tr>\n\t<th>Name/Info Hash</th>\n\t<th>File Size</th>\n\t<th>Seeders</th>\n\t<th>Leechers</th>\n\t<th>Completed D/Ls</th>\n\t<th>Bytes Transfered</th>\n\t<th>Delete?</th>\n</tr>\n<?php\n\n$results = mysql_query(\"SELECT \".$prefix.\"summary.info_hash, \".$prefix.\"namemap.size, \".$prefix.\"summary.seeds, \".$prefix.\"summary.leechers, format(\".$prefix.\"summary.finished,0), format(\".$prefix.\"summary.dlbytes/1073741824,3), \".$prefix.\"namemap.filename FROM \".$prefix.\"summary LEFT JOIN \".$prefix.\"namemap ON \".$prefix.\"summary.info_hash = \".$prefix.\"namemap.info_hash ORDER BY \".$prefix.\"namemap.filename\") or die(errorMessage() . \"\" . mysql_error() . \"</p>\");\n\n$i = 0;\n\nwhile ($data = mysql_fetch_row($results)) {\n\t$writeout = \"row\" . $i % 2;\n\t$hash = $data[0];\n\tif (is_null($data[6]))\n\t\t$data[6] = $data[0];\n\tif (strlen($data[6]) == 0)\n\t\t$data[6] = $data[0];\n\t\t\n\techo \"<tr class=\\\"$writeout\\\">\\n\";\n\techo \"\\t<td>\".$data[6].\"</td>\\n\";\n\techo \"\\t<td>\".bytesToString($data[1]).\"</td>\\n\";\n\tfor ($j=2; $j < 5; $j++)\n\t\techo \"\\t<td class=\\\"center\\\">$data[$j]</td>\\n\";\n\techo \"\\t<td class=\\\"center\\\">$data[5] GB</td>\\n\";\n\t\n\techo \"\\t<td class=\\\"center\\\"><input type=\\\"checkbox\\\" name=\\\"x$hash\\\" value=\\\"$i\\\" onclick=\\\"selectRow(this);\\\"/></td>\\n\";\n\techo \"</tr>\\n\";\n\t$i++;\n}\n\n?>\n</table>\n<p class=\"error\">Warning: there is no confirmation for deleting files. Clicking this button is final.</p>\n<p class=\"center\"><input type=\"submit\" value=\"Delete\" /></p>\n</form>\n<a href=\"index.php\"><img src=\"images/stats.png\" border=\"0\" class=\"icon\" alt=\"Tracker Statistics\" title=\"Tracker Statistics\" /></a><a href=\"index.php\">Return to Statistics Page</a><br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body></html>\n", "<?php\nrequire (\"config.php\");\nrequire_once (\"funcsv2.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n<html>\n<head>\n\t<title>Edit Torrent in Database</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head>\n<body>\n<h1>Edit Torrent in Database</h1>\n<h2>This page allows you to edit torrents that are already in the database.  If you need to change other things about\nthe torrent please <a href=\"deleter.php\">delete it</a> and add it again.</h2>\n\t\n<?php\n\n//connect to database\nif ($GLOBALS[\"persist\"])\n\t$db = mysql_pconnect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\nelse\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\nmysql_select_db($database) or die(errorMessage() . \"Error selecting database.</p>\");\n\n//get filename from URL string\nif (isset($_GET['filename'])) {\n\t$filename = $_GET['filename'];\n}\n\n//if not edit database or filename set, display all torrents as links\nif (!isset($_POST[\"editdatabase\"]) && !isset($filename))\n{\n\t?>\n\t<p><strong>Click on a file to edit it:</strong></p>\n\t<table border=\"0\">\n\t<?php\n\t$query = \"SELECT filename FROM \".$prefix.\"namemap ORDER BY filename ASC\";\n\t$rows = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\n\twhile ($data = mysql_fetch_row($rows))\n\t{\n\t\techo \"<tr><td><a href=\\\"\" . htmlentities($_SERVER['PHP_SELF']) . \"?filename=\" . rawurlencode($data[0]) . \"\\\">\" . $data[0] . \"</a></td></tr>\\n\";\n\t}\n\t?>\n\t</table>\n\t<?php\n}\n\nif (isset($filename) && !isset($_POST[\"editdatabase\"]))\n{\n\t$query = \"SELECT info_hash,filename,url,pubDate FROM \".$prefix.\"namemap WHERE filename = '\" . mysql_real_escape_string($filename) . \"'\";\n\t$rows = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\n\t$data = mysql_fetch_row($rows); //should be only one entry...\n\t?>\n\t<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"POST\">\n\t<input type=\"hidden\" name=\"editdatabase\" value=\"1\">\n\t<input type=\"hidden\" name=\"<?php echo $data[0];?>\" value=\"<?php echo $data[0];?>\">\n\t<input type=\"hidden\" name=\"<?php echo $data[0] . \"_old_filename\";?>\" value=\"<?php echo $data[1];?>\">\n\t<table border=\"0\">\n\t<tr><td><b>Info Hash: </b></td><td><?php echo $data[0];?></td></tr>\n\t<tr><td><b>Filename:</b></td><td><input type=\"text\" name=\"<?php echo $data[0] . \"_filename\";?>\" size=\"60\" value=\"<?php echo $data[1];?>\"></td></tr>\n\t<tr><td><b>URL:</b></td><td><input type=\"text\" name=\"<?php echo $data[0] . \"_url\";?>\" size=\"60\" value=\"<?php echo $data[2];?>\"></td></tr>\n\t<tr><td><b>Publication Date:</b></td><td><input type=\"text\" name=\"<?php echo $data[0] . \"_pubDate\";?>\" size=\"60\" value=\"<?php echo $data[3];?>\"></td></tr>\n\t<tr><td><hr></td><td><hr></td></tr>\t\t\n\t\n\t</table>\n\t<br>\n\t<input type=\"submit\" value=\"Edit Entry\">\n\t</form>\n\t\n\t<?php\n}\n\n//write data to database\nif (isset($_POST[\"editdatabase\"]))\n{\n\t$temp_counter = (count($_POST)-1)/5;\n\tarray_shift($_POST);\n\t\n\tfor ($i = 0; $i < $temp_counter; $i++)\n\t{\n\t\t$temp_hash = htmlspecialchars(array_shift($_POST));\n\t\t$old_filename = htmlspecialchars(array_shift($_POST));\n\t\t$temp_filename = array_shift($_POST);\n\t\t$temp_filename = Ltrim($temp_filename);\n\t\t$temp_filename = htmlspecialchars(rtrim($temp_filename));\n\t\t$temp_url = htmlspecialchars(array_shift($_POST));\n\t\t$temp_pubDate = htmlspecialchars(array_shift($_POST));\n\t\t$query = \"UPDATE \".$prefix.\"namemap SET filename=\\\"$temp_filename\\\", url=\\\"$temp_url\\\", pubDate=\\\"$temp_pubDate\\\" WHERE info_hash=\\\"$temp_hash\\\"\";\n\t\tmysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\t//if filename changes, rename .torrent\n\t\tif ($old_filename != $temp_filename)\n\t\t\trename(\"torrents/\" . $old_filename . \".torrent\", \"torrents/\" . $temp_filename . \".torrent\");\n\t}\n\t\n\t//run RSS generator\n\trequire_once(\"rss_generator.php\");\n\t\n\techo \"<br><p class=\\\"success\\\">The database was edited successfully!</p>\\n\";\n}\n\n?>\n<br>\n<br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body>\n</html>\n", "<?php\nrequire (\"config.php\");\nrequire_once (\"funcsv2.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=session\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html><head><title>Edit Config File</title>\n\t<meta http-equiv=\"Content-type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head><body>\n\n<?php\n//open up config file and display for editing\nif (!isset($_POST[\"saveconfig\"]))\n{\n\t?>\n\t<h1>Edit Config File</h1>\n\t<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"POST\">\n\t<input type=\"hidden\" name=\"saveconfig\" value=\"1\">\n\t<h2>This page allows you to configure the \"config.php\" settings.  This file stores all the necessary\n\tsettings for your tracker.  Please do NOT edit the \"config.php\" file directly, \n\tuse this admin page for any changes.</h2>\n\t<h2><span class=\"notice\">*</span> - required value</h2>\n\t<table border=\"1\" cellpadding=\"3\">\n\t<?php\n\t//open up config file\n\t$fr = fopen(\"config.php\", \"r\") or die(errorMessage() . \"Error: couldn't read config.php!</p>\");\n\t$temp = fgets($fr);\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Make tracker hidden: This will require a login by either the admin or upload user in order to\n\tsee the torrents available on the main statistics page.  This does not mean it's a private tracker.  If you\n\tneed a private tracker, there are many other trackers out there.  Also, you will need to secure the \"torrents\"\n\tfolder with an .htaccess file for Apache or some other method.  The tracker will still accept all valid\n\tconnections by clients.  There is no user checking in that regard.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"hiddentracker\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Enable or disable scraping by clients.  Generally it is safe to leave this on unless\n\tyou have a large number of torrents or users which can lead to increased bandwidth usage.  Also, scraping\n\tcan possibily be used maliciously by abusive clients.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"scrape\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td>Short Announce URL: You can turn on the short announce feature, making the URL end in /announce for your tracker. You should not utilize both tracker URL forms in one torrent at the same time, or you will get inconsistent results. Note: You will need the provided htaccess file, have URL rewrite capabilities, and have it properly set up to use this feature. Otherwise, leave it disabled.</td>\n\t<td><select name=\"announceurl\" id=\"announceurl\">\n\t<option title=\"disabled\" value=\"announce.php\"<?php if($temp == \"announce.php\") echo \" selected=\\\"selected\\\"\";?>>disabled</option>\n\t<option title=\"enabled\" value=\"announce\"<?php if($temp == \"announce\") echo \" selected=\\\"selected\\\"\";?>>enabled</option>\n\t</select>\n\t</td>\n\t</tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span>Lists the number of torrents on each page on your torrent tracker list. Default is 10.</td>\n\t<td><input type=\"text\" name=\"indexpagelimitspecify\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span>Lists the number of torrents on each page on the detailed statistics page. Default is 5.</td>\n\t<td><input type=\"text\" name=\"statspagelimitspecify\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Maximum reannounce interval (in seconds) 1800 == 30 minutes</td>\n\t<td><input type=\"text\" name=\"report_interval\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Minimum reannounce interval (also in seconds) 300 == 5 minutes</td>\n\t<td><input type=\"text\" name=\"min_interval\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Number of peers to send in one request.  Some logic will break if you set this to more than 300,\n\tso please don't do that. 100 is the most you should set anyway.</td>\n\t<td><input type=\"text\" name=\"maxpeers\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\t\n\t<tr><td>If set, NAT checking will be performed.\n\tThis may cause trouble with some providers, so it's\n\toff by default.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"NAT\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Persistent MySQL connections:\n\tCheck with your webmaster to see if you're allowed to use these.\n\tHighly recommended, especially for higher loads, but generally\n\tnot allowed unless it's a dedicated machine.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"persist\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Allow users to override ip address.\n\tEnable this if you know people have a legit reason to use\n\tthis function. Leave disabled otherwise.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"ip_override\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>For heavily loaded trackers, uncheck this. It will stop count the number\n\tof downloaded bytes and the speed of the torrent, but will significantly reduce\n\tthe load.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"countbytes\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Username for individual who can add torrents to tracker database.\n\tThis user is only able to create, and not delete torrents to the tracker.\n\tFor full privileges, see the admin user.</td>\n\t<td><input type=\"text\" name=\"upload_username\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Password for individual who can add torrents to tracker database.\n\tAgain, this user is only able to create, and not delete torrents to the tracker.\n\tFor full privileges, see the admin user.<br><br>\n\t<input type=\"hidden\" name=\"old_upload_password\" value=\"<?php echo $temp;?>\">\n\t<b>Current MD5 hashed username+password: <?php echo $temp;?></b></td>\n\t<td><input type=\"password\" name=\"upload_password\" size=\"40\" value=\"\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Admin username. The admin is able to go to the admin page and show detailed \n\tinformation about the tracker as well as access a few other important tools.\n\tThe admin is also able to upload torrents to the database\n\tjust like the previous account.</td>\n\t<td><input type=\"text\" name=\"admin_username\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Password for admin.  Again, The admin is able to go to the admin page and show detailed \n\tinformation about the tracker as well as access a few other important tools.\n\tThe admin is also able to upload torrents to the database.<br><br>\n\t<input type=\"hidden\" name=\"old_admin_password\" value=\"<?php echo $temp;?>\">\n\t<b>Current MD5 hashed username+password: <?php echo $temp;?></b></td>\n\t<td><input type=\"password\" name=\"admin_password\" size=\"40\" value=\"\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = clean(substr($temp, strpos($temp, \"=\")+3, -3));\n\t?>\n\t<tr><td>Title on index.php statistics page, if not set, defaults to \"Tracker Statistics\"</td>\n\t<td><input type=\"text\" name=\"title\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Database Hostname: This is the MySQL database hostname, if it is the local machine, it should\n\tbe set to localhost.</td>\n\t<td><input type=\"text\" name=\"dbhost\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Database Username: This is the user who has access to the database table.  If you are unsure,\n\tcheck with your system administrator.</td>\n\t<td><input type=\"text\" name=\"dbuser\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Database Password: This is the password for the user who has access to the database table.\n\tIf you are unsure, check with your system administrator.</td>\n\t<td><input type=\"text\" name=\"dbpass\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Database name: This is the name of the database.  If you are unsure, check with\n\tyour system administrator.</td>\n\t<td><input type=\"text\" name=\"database\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td>Enable RSS feed:\n\tIf you do not want the RSS feed to be created for privacy reasons or do not need it disable this checkbox.</td>\n\t<td><input type=\"checkbox\" value=\"<?php if($temp == \"true\") echo \"on\"; else echo \"off\"?>\" name=\"enablerss\"<?php if ($temp == \"true\") echo \" checked\";?>></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = clean(substr($temp, strpos($temp, \"=\")+3, -3));\n\t?>\n\t<tr><td>RSS Title: In the rss.xml file, this is the main <pre>&lt;title&gt;</pre> tag.</td>\n\t<td><input type=\"text\" name=\"rss_title\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td>RSS link to main website: In the rss.xml file, this is the main <pre>&lt;link&gt;</pre> tag.</td>\n\t<td><input type=\"text\" name=\"rss_link\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = clean(substr($temp, strpos($temp, \"=\")+3, -3));\n\t?>\n\t<tr><td>RSS description: In the rss.xml file, this is the main <pre>&lt;description&gt;</pre> tag.</td>\n\t<td><input type=\"text\" name=\"rss_description\" size=\"60\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Main website url that the tracker runs on, example: http://www.mywebsite.com</td>\n\t<td><input type=\"text\" name=\"website_url\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> For HTTP seeding, this is the maximum total upload rate per second in kilobytes, for example 100 would be 100 KB/s</td>\n\t<td><input type=\"text\" name=\"max_upload_rate\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+2, -2);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> For HTTP seeding, this is the maximum number of uploads to run at a time</td>\n\t<td><input type=\"text\" name=\"max_uploads\" size=\"40\" value=\"<?php echo $temp;?>\"></td></tr>\t\n\t<?php\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<tr><td><span class=\"notice\">*</span> Timezone that the server runs on</td>\n\t<td>\n\t<select name=\"timezone\" id=\"timezone\">\n\t<option title=\"[UTC - 12] Baker Island Time\" value=\"-1200\"<?php if($temp == \"-1200\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 12] Baker Island Time</option>\n\t<option title=\"[UTC - 11] Niue Time, Samoa Standard Time\" value=\"-1100\"<?php if($temp == \"-1100\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 11] Niue Time, Samoa Standard Time</option>\n\t<option title=\"[UTC - 10] Hawaii-Aleutian Standard Time, Cook Island Time\" value=\"-1000\"<?php if($temp == \"-1000\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 10] Hawaii-Aleutian Standard Time, Cook Isl...</option>\n\t<option title=\"[UTC - 9:30] Marquesas Islands Time\" value=\"-0930\"<?php if($temp == \"-0930\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 9:30] Marquesas Islands Time</option>\n\t<option title=\"[UTC - 9] Alaska Standard Time, Gambier Island Time\" value=\"-0900\"<?php if($temp == \"-0900\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 9] Alaska Standard Time, Gambier Island Tim...</option>\n\t<option title=\"[UTC - 8] Pacific Standard Time\" value=\"-0800\"<?php if($temp == \"-0800\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 8] Pacific Standard Time</option>\n\t<option title=\"[UTC - 7] Mountain Standard Time\" value=\"-0700\"<?php if($temp == \"-0700\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 7] Mountain Standard Time</option>\n\t<option title=\"[UTC - 6] Central Standard Time\" value=\"-0600\"<?php if($temp == \"-0600\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 6] Central Standard Time</option>\n\t<option title=\"[UTC - 5] Eastern Standard Time\" value=\"-0500\"<?php if($temp == \"-0500\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 5] Eastern Standard Time</option>\n\t<option title=\"[UTC - 4] Atlantic Standard Time\" value=\"-0400\"<?php if($temp == \"-0400\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 4] Atlantic Standard Time</option>\n\t<option title=\"[UTC - 3:30] Newfoundland Standard Time\" value=\"-0330\"<?php if($temp == \"-0330\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 3:30] Newfoundland Standard Time</option>\n\t<option title=\"[UTC - 3] Amazon Standard Time, Central Greenland Time\" value=\"-0300\"<?php if($temp == \"-0300\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 3] Amazon Standard Time, Central Greenland ...</option>\n\t<option title=\"[UTC - 2] Fernando de Noronha Time, South Georgia &amp; the South Sandwich Islands Time\" value=\"-0200\"<?php if($temp == \"-0200\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 2] Fernando de Noronha Time, South Georgia ...</option>\n\t<option title=\"[UTC - 1] Azores Standard Time, Cape Verde Time, Eastern Greenland Time\" value=\"-0100\"<?php if($temp == \"-0100\") echo \" selected=\\\"selected\\\"\";?>>[UTC - 1] Azores Standard Time, Cape Verde Time, E...</option>\n\t<option title=\"[UTC] Western European Time, Greenwich Mean Time\" value=\"+0000\"<?php if($temp == \"+0000\") echo \" selected=\\\"selected\\\"\";?>>[UTC] Western European Time, Greenwich Mean Time</option>\n\t<option title=\"[UTC + 1] Central European Time, West African Time\" value=\"+0100\"<?php if($temp == \"+0100\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 1] Central European Time, West African Time</option>\n\t<option title=\"[UTC + 2] Eastern European Time, Central African Time\" value=\"+0200\"<?php if($temp == \"+0200\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 2] Eastern European Time, Central African T...</option>\n\t<option title=\"[UTC + 3] Moscow Standard Time, Eastern African Time\" value=\"+0300\"<?php if($temp == \"+0300\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 3] Moscow Standard Time, Eastern African Ti...</option>\n\t<option title=\"[UTC + 3:30] Iran Standard Time\" value=\"+0330\"<?php if($temp == \"+0330\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 3:30] Iran Standard Time</option>\n\t<option title=\"[UTC + 4] Gulf Standard Time, Samara Standard Time\" value=\"+0400\"<?php if($temp == \"+0400\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 4] Gulf Standard Time, Samara Standard Time</option>\n\t<option title=\"[UTC + 4:30] Afghanistan Time\" value=\"+0430\"<?php if($temp == \"+0430\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 4:30] Afghanistan Time</option>\n\t<option title=\"[UTC + 5] Pakistan Standard Time, Yekaterinburg Standard Time\" value=\"+0500\"<?php if($temp == \"+0500\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 5] Pakistan Standard Time, Yekaterinburg St...</option>\n\t<option title=\"[UTC + 5:30] Indian Standard Time, Sri Lanka Time\" value=\"+0530\"<?php if($temp == \"+0530\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 5:30] Indian Standard Time, Sri Lanka Time</option>\n\t<option title=\"[UTC + 6] Bangladesh Time, Bhutan Time, Novosibirsk Standard Time\" value=\"+0600\"<?php if($temp == \"+0600\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 6] Bangladesh Time, Bhutan Time, Novosibirs...</option>\n\t<option title=\"[UTC + 6:30] Cocos Islands Time, Myanmar Time\" value=\"+0630\"<?php if($temp == \"+0630\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 6:30] Cocos Islands Time, Myanmar Time</option>\n\t<option title=\"[UTC + 7] Indochina Time, Krasnoyarsk Standard Time\" value=\"+0700\"<?php if($temp == \"+0700\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 7] Indochina Time, Krasnoyarsk Standard Tim...</option>\n\t<option title=\"[UTC + 8] Chinese Standard Time, Australian Western Standard Time, Irkutsk Standard Time\" value=\"+0800\"<?php if($temp == \"+0800\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 8] Chinese Standard Time, Australian Wester...</option>\n\t<option title=\"[UTC + 9] Japan Standard Time, Korea Standard Time, Chita Standard Time\" value=\"+0900\"<?php if($temp == \"+0900\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 9] Japan Standard Time, Korea Standard Time...</option>\n\t<option title=\"[UTC + 9:30] Australian Central Standard Time\" value=\"+0930\"<?php if($temp == \"+0930\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 9:30] Australian Central Standard Time</option>\n\t<option title=\"[UTC + 10] Australian Eastern Standard Time, Vladivostok Standard Time\" value=\"+1000\"<?php if($temp == \"+1000\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 10] Australian Eastern Standard Time, Vladi...</option>\n\t<option title=\"[UTC + 10:30] Lord Howe Standard Time\" value=\"+1030\"<?php if($temp == \"+1030\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 10:30] Lord Howe Standard Time</option>\n\t<option title=\"[UTC + 11] Solomon Island Time, Magadan Standard Time\" value=\"+1100\"<?php if($temp == \"+1100\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 11] Solomon Island Time, Magadan Standard T...</option>\n\t<option title=\"[UTC + 11:30] Norfolk Island Time\" value=\"+1130\"<?php if($temp == \"+1130\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 11:30] Norfolk Island Time</option>\n\t<option title=\"[UTC + 12] New Zealand Time, Fiji Time, Kamchatka Standard Time\" value=\"+1200\"<?php if($temp == \"+1200\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 12] New Zealand Time, Fiji Time, Kamchatka ...</option>\n\t<option title=\"[UTC + 13] Tonga Time, Phoenix Islands Time\" value=\"+1300\"<?php if($temp == \"+1300\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 13] Tonga Time, Phoenix Islands Time</option>\n\t<option title=\"[UTC + 14] Line Island Time\" value=\"+1400\"<?php if($temp == \"+1400\") echo \" selected=\\\"selected\\\"\";?>>[UTC + 14] Line Island Time</option>\n\t</select>\n\t</td>\n\t</tr>\n\t<?php\n\t\n\t//get MySQL table prefix, store in hidden form field\n\t$temp = fgets($fr);\n\t$temp = substr($temp, strpos($temp, \"=\")+3, -3);\n\t?>\n\t<input type=\"hidden\" name=\"prefix\" value=\"<?php echo $temp;?>\" />\t\n\n\t<?php\n\tfclose($fr);\n\n\t?>\t\t\n\t</table>\n\t<input type=\"submit\" value=\"Save Config\">\n\t</form>\n\t\n\t<?php\n}\n\n\nif (isset($_POST[\"saveconfig\"]))\n{\n\t//check required entries for values, if blank: error out\n\tif ($_POST[\"announceurl\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The announce URL is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"indexpagelimitspecify\"]) || $_POST[\"indexpagelimitspecify\"] == \"\" || $_POST[\"indexpagelimitspecify\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The index page limit is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"statspagelimitspecify\"]) || $_POST[\"statspagelimitspecify\"] == \"\" || $_POST[\"statspagelimitspecify\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The statistics page limit is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"report_interval\"]) || $_POST[\"report_interval\"] == \"\" || $_POST[\"report_interval\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The maximum reannounce interval is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"min_interval\"]) || $_POST[\"min_interval\"] == \"\" || $_POST[\"min_interval\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The minimum reannounce interval is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"maxpeers\"]) || $_POST[\"maxpeers\"] == \"\" || $_POST[\"maxpeers\"] > 300 || $_POST[\"maxpeers\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The number of peers to send in one request is not an integer, over 300, a negative number, zero, or blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"upload_username\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The upload username is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"admin_username\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The admin username is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"dbhost\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The database hostname is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"dbuser\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The database username is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"dbpass\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The database password is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"database\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The database name is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"rss_link\"] != \"\" && Substr($_POST[\"rss_link\"], 0, 7) != \"http://\")\n\t{\n\t\techo errorMessage() . \"Error: The RSS website URL does not start with http://</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"website_url\"] == \"\" || Substr($_POST[\"website_url\"], 0, 7) != \"http://\")\n\t{\n\t\techo errorMessage() . \"Error: The website URL does not start with http:// or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"max_upload_rate\"]) || $_POST[\"max_upload_rate\"] == \"\" || $_POST[\"max_upload_rate\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The maximum upload rate is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif (!is_numeric($_POST[\"max_uploads\"]) || $_POST[\"max_uploads\"] == \"\" || $_POST[\"max_uploads\"] <= 0)\n\t{\n\t\techo errorMessage() . \"Error: The maximum uploads is not an integer, a negative number, or is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"timezone\"] == \"\")\n\t{\n\t\techo errorMessage() . \"Error: The timezone is blank.</p>\";\n\t\texit();\n\t}\n\tif ($_POST[\"upload_username\"] == $_POST[\"admin_username\"])\n\t{\n\t\techo errorMessage() . \"Error: The admin username cannot be the same as the upload username.</p>\";\n\t\texit();\n\t}\n\t\n\t//calculate new MD5 password if needed\n\tif ($_POST[\"upload_password\"] != \"\")\n\t{\n\t\t$_POST[\"upload_password\"] = md5($_POST[\"upload_username\"].$_POST[\"upload_password\"]);\n\t}\n\telse\n\t\t$_POST[\"upload_password\"] = $_POST[\"old_upload_password\"];\n\tif ($_POST[\"admin_password\"] != \"\")\n\t{\n\t\t$_POST[\"admin_password\"] = md5($_POST[\"admin_username\"].$_POST[\"admin_password\"]);\n\t}\n\telse\n\t\t$_POST[\"admin_password\"] = $_POST[\"old_admin_password\"];\n\t\t\n\t//check if config.php has write access\n\tif (is_writable(\"config.php\"))\n\t{\n\t\t//go through checkboxes and change \"on\" to \"true\"\n\t\tif (isset($_POST[\"hiddentracker\"]))\n\t\t\t$hiddentracker = \"true\";\n\t\telse\n\t\t\t$hiddentracker = \"false\";\t\n\t\tif (isset($_POST[\"enablerss\"]))\n\t\t\t$enablerss = \"true\";\n\t\telse\n\t\t\t$enablerss = \"false\";\n\t\tif (isset($_POST[\"scrape\"]))\n\t\t\t$scrape = \"true\";\n\t\telse\n\t\t\t$scrape = \"false\";\n\t\tif (isset($_POST[\"NAT\"]))\n\t\t\t$NAT = \"true\";\n\t\telse\n\t\t\t$NAT = \"false\";\n\t\tif (isset($_POST[\"persist\"]))\n\t\t\t$persist = \"true\";\n\t\telse\n\t\t\t$persist = \"false\";\n\t\tif (isset($_POST[\"ip_override\"]))\n\t\t\t$ip_override = \"true\";\n\t\telse\n\t\t\t$ip_override = \"false\";\n\t\tif (isset($_POST[\"countbytes\"]))\n\t\t\t$countbytes = \"true\";\n\t\telse\n\t\t\t$countbytes = \"false\";\n\n\t\t//write config.php file\n\t\t$fd = fopen(\"config.php\", \"w\") or die(errorMessage() . \"Warning: write to config.php!</p>\");\n\t\tfwrite($fd, \n\t\t\"<?php //Please do NOT edit this file, use the admin page for changes.\\n\" .\n\t\t\"\\$GLOBALS['hiddentracker'] = \" . $hiddentracker . \";\\n\" .\n\t\t\"\\$GLOBALS['scrape'] = \" . $scrape . \";\\n\" .\n\t\t\"\\$announceurl = '\" . htmlspecialchars($_POST[\"announceurl\"]) . \"';\\n\" .\n\t\t\"\\$GLOBALS['indexpagelimitspecify'] = \" . htmlspecialchars($_POST[\"indexpagelimitspecify\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['statspagelimitspecify'] = \" . htmlspecialchars($_POST[\"statspagelimitspecify\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['report_interval'] = \" . htmlspecialchars($_POST[\"report_interval\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['min_interval'] = \" . htmlspecialchars($_POST[\"min_interval\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['maxpeers'] = \" . htmlspecialchars($_POST[\"maxpeers\"]) . \";\\n\" .\n\t\t\"\\$GLOBALS['NAT'] = \" . $NAT . \";\\n\" .\n\t\t\"\\$GLOBALS['persist'] = \" . $persist . \";\\n\" .\n\t\t\"\\$GLOBALS['ip_override'] = \" . $ip_override . \";\\n\" .\n\t\t\"\\$GLOBALS['countbytes'] = \" . $countbytes . \";\\n\" .\n\t\t\"\\$upload_username = '\" . htmlspecialchars($_POST[\"upload_username\"]) . \"';\\n\" .\n\t\t\"\\$upload_password = '\" . htmlspecialchars($_POST[\"upload_password\"]) . \"';\\n\" .\n\t\t\"\\$admin_username = '\" . htmlspecialchars($_POST[\"admin_username\"]) . \"';\\n\" .\n\t\t\"\\$admin_password = '\" . htmlspecialchars($_POST[\"admin_password\"]) . \"';\\n\" .\n\t\t\"\\$GLOBALS['title'] = '\" . htmlspecialchars(addquotes($_POST[\"title\"])) . \"';\\n\" .\n\t\t\"\\$dbhost = '\" . htmlspecialchars($_POST[\"dbhost\"]) . \"';\\n\" .\n\t\t\"\\$dbuser = '\" . htmlspecialchars($_POST[\"dbuser\"]) . \"';\\n\" .\n\t\t\"\\$dbpass = '\" . htmlspecialchars($_POST[\"dbpass\"]) . \"';\\n\" .\n\t\t\"\\$database = '\" . htmlspecialchars($_POST[\"database\"]) . \"';\\n\" .\n\t\t\"\\$enablerss = \" . $enablerss . \";\\n\" .\n\t\t\"\\$rss_title = '\" . htmlspecialchars(addquotes($_POST[\"rss_title\"])) . \"';\\n\" .\n\t\t\"\\$rss_link = '\" . htmlspecialchars($_POST[\"rss_link\"]) . \"';\\n\" .\n\t\t\"\\$rss_description = '\" . htmlspecialchars(addquotes($_POST[\"rss_description\"])) . \"';\\n\" .\n\t\t\"\\$website_url = '\" . htmlspecialchars($_POST[\"website_url\"]) . \"';\\n\" .\n\t\t\"\\$GLOBALS['max_upload_rate'] = \" . htmlspecialchars($_POST['max_upload_rate']) . \";\\n\" .\n\t\t\"\\$GLOBALS['max_uploads'] = \" . htmlspecialchars($_POST['max_uploads']) . \";\\n\" .\n\t\t\"\\$timezone = '\" . htmlspecialchars($_POST[\"timezone\"]) . \"';\\n\" .\n\t\t\"\\$prefix = '\" . htmlspecialchars($_POST[\"prefix\"]) . \"';\\n\" .\n\t\t\"?>\"\n\t\t);\n\n\t\tfclose($fd);\n\t\techo \"<br><p class=\\\"success\\\">config.php file was edited successfully!</p>\\n\";\n\t\t\n\t\t//run RSS generator\n\t\trequire_once(\"rss_generator.php\");\n\t}\n\telse\n\t{\n\t\techo errorMessage() . \"config.php was not able to be written.  Please check the permissions and try again.</p>\\n\";\n\t}\n}\n\n?>\n<br>\n<br>\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\n</body>\n</html>\n", "<?php\nrequire_once (\"funcsv2.php\");\n\n//check if config.php file already exists, if so, this could be an already existing installation\nif (file_exists(\"config.php\"))\n{\n\techo \"<font color=red><strong>The config.php file already exists.  This is an indication of an already existing installation\" .\n\t\" of RivetTracker.  If you are sure you are installing for the first time, please try recopying the files/folders.\" .\n\t\" This is also a security feature to prevent malicious attempts to run the installer if you forgot to delete it.\" .\n\t\" This installer will now abort.</strong></font>\";\n\texit();\n}\n\nif (isset($_POST[\"download\"]))\n{\n\t//download config.php using header()\n\theader('content-type: application/octet-stream');\n\theader(\"Content-Disposition: attachment; filename=\\\"config.php\\\"\");\n\n\tprint \"<?php //Please do NOT edit this file, use the admin page for changes.\\n\";\n\tprint \"\\$GLOBALS['hiddentracker'] = \" . htmlspecialchars($_POST[\"hiddentracker\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['scrape'] = \" . htmlspecialchars($_POST[\"scrape\"]) . \";\\n\";\n\tprint \"\\$announceurl = '\" . htmlspecialchars($_POST[\"announceurl\"]) . \"';\\n\";\n\tprint \"\\$GLOBALS['indexpagelimitspecify'] = \" . htmlspecialchars($_POST[\"indexpagelimitspecify\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['statspagelimitspecify'] = \" . htmlspecialchars($_POST[\"statspagelimitspecify\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['report_interval'] = \" . htmlspecialchars($_POST[\"report_interval\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['min_interval'] = \" . htmlspecialchars($_POST[\"min_interval\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['maxpeers'] = \" . htmlspecialchars($_POST[\"maxpeers\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['NAT'] = \" . htmlspecialchars($_POST[\"NAT\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['persist'] = \" . htmlspecialchars($_POST[\"persist\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['ip_override'] = \" . htmlspecialchars($_POST[\"ip_override\"]) . \";\\n\";\n\tprint \"\\$GLOBALS['countbytes'] = \" . htmlspecialchars($_POST[\"countbytes\"]) . \";\\n\";\n\tprint \"\\$upload_username = '\" . htmlspecialchars($_POST[\"upload_username\"]) . \"';\\n\";\n\tprint \"\\$upload_password = '\" . htmlspecialchars($_POST[\"upload_password\"]) . \"';\\n\";\n\tprint \"\\$admin_username = '\" . htmlspecialchars($_POST[\"admin_username\"]) . \"';\\n\";\n\tprint \"\\$admin_password = '\" . htmlspecialchars($_POST[\"admin_password\"]) . \"';\\n\";\n\tprint \"\\$GLOBALS['title'] = '\" . htmlspecialchars(addquotes($_POST[\"title\"])) . \"';\\n\";\n\tprint \"\\$dbhost = '\" . htmlspecialchars($_POST[\"dbhost\"]) . \"';\\n\";\n\tprint \"\\$dbuser = '\" . htmlspecialchars($_POST[\"dbuser\"]) . \"';\\n\";\n\tprint \"\\$dbpass = '\" . htmlspecialchars($_POST[\"dbpass\"]) . \"';\\n\";\n\tprint \"\\$database = '\" . htmlspecialchars($_POST[\"database\"]) . \"';\\n\";\n\tprint \"\\$enablerss = \" . htmlspecialchars($_POST['enablerss']) . \";\\n\";\n\tprint \"\\$rss_title = '\" . htmlspecialchars(addquotes($_POST[\"rss_title\"])) . \"';\\n\";\n\tprint \"\\$rss_link = '\" . htmlspecialchars($_POST[\"rss_link\"]) . \"';\\n\";\n\tprint \"\\$rss_description = '\" . htmlspecialchars($_POST[\"rss_description\"]) . \"';\\n\";\n\tprint \"\\$website_url = '\" . htmlspecialchars($_POST['website_url']) . \"';\\n\";\n\tprint \"\\$GLOBALS['max_upload_rate'] = \" . htmlspecialchars($_POST['max_upload_rate']) . \";\\n\";\n\tprint \"\\$GLOBALS['max_uploads'] = \" . htmlspecialchars($_POST['max_uploads']) . \";\\n\";\n\tprint \"\\$timezone = '\" . htmlspecialchars($_POST['timezone']) . \"';\\n\";\n\tprint \"\\$prefix = '\" . htmlspecialchars($_POST['prefix']) . \"';\\n\";\n\tprint \"?>\";\nexit;\n}\n\n?>\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\n<html>\n<head>\n\t<title>RivetTracker Installer</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\n</head>\n<body>\n<p align=\"right\"><a href=\"./docs/help.html\"><img src=\"images/help.png\" border=\"0\" class=\"icon\" alt=\"Help\" title=\"Help\" /></a><a href=\"./docs/help.html\">Help</a></p>\n\n<?php\n\n\tif (!isset($_POST[\"started\"]))\n\t{\n\t\t?>\n\t\t<center>\n\t\t<h1>RivetTracker Installer</h1>\n\t\t<img src=\"images/install.png\" border=\"0\" class=\"icon\" alt=\"RivetTracker Installation\" title=\"RivetTracker Installation\" />\n\t\t</center>\n\n\t\t<?php\n\t\t//Check PHP version\n\t\techo \"<p>PHP Version: \" . PHP_VERSION . \"</p>\";\n\t\t//http://php.net/manual/en/function.version-compare.php\n\t\tif (version_compare(PHP_VERSION, '5.0.0', '<')) {\n\t\t\techo \"<p>You're not running PHP 5.0, you may have problems.</p>\";\n\t\t}\n\t\t//Check for MySQL support\n\t\tif (class_exists('mysqli') OR function_exists('mysql_connect')) {\n\t\t\techo \"<p>MySQL Enabled: Yes</p>\";\n\t\t} else {\n\t\t\techo \"<p>MySQL Enabled: No (this is a requirement)</p>\";\n\t\t\techo \"</body></html>\";\n\t\t\texit();\n\t\t}\n\n\t\t?>\n\t\t<br>\n\t\t<form method=\"post\" action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\">\n\t\t<input type=\"hidden\" name=\"started\" value=\"1\">\n\t\t<h2>The MySQL database needs to be prepared for the tracker. This script will help\n\t\tyou do that.</h2>\n\t\t<h2>You have two choices:</h2>\n\t\t<ul>\n\t\t<li><h2>If you have a username, password, and database for the tracker already\n\t\tcreated:</h2></li>\n\t\t</ul>\n\t\t<input type=\"submit\" name=\"preexisting\" value=\"Click Here\">\n\t\t<br>\n\t\t<ul>\n\t\t<li><h2>If you need to create the account and database, and you have the username and password\n\t\tof a user who can create user accounts and databases:</h2></li>\n\t\t</ul>\n\t\t<input type=\"submit\" name=\"makeaccount\" value=\"Click Here\">\n\t\t</form>\n\t\t<br>\n\t\t</body></html><?php exit;\n\t}\n\tif (isset($_POST[\"preexisting\"]))\n\t{\n\t\t?>\n\t\t<form method=\"post\" action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\">\n\t\t<input type=\"hidden\" name=\"maketables\" value=\"1\">\n\t\t<input type=\"hidden\" name=\"started\" value=\"1\">\n\t\t<h1>RivetTracker Installation</h1>\n\t\t<center>\n\t\t<img src=\"images/install.png\" border=\"0\" class=\"icon\" alt=\"RivetTracker Installation\" title=\"RivetTracker Installation\" />\n\t\t</center>\n\t\t<br><br>\n\t\t<table border=0 cellpadding=5>\n\t\t<tr><td align=\"right\">Database hostname:<br>(in MySQL format, example: localhost)</td><td align=\"left\"><input type=\"text\" name=\"host\" value=\"localhost\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Tracker's database username:</td><td align=\"left\"><input type=\"text\" name=\"username\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Tracker's database password:</td><td align=\"left\"><input type=\"password\" name=\"password\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Database name:</td><td align=\"left\"><input type=\"text\" name=\"database\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Table Prefix:<br> (If you want to use an existing<br> database this will add the tables\n\t\tin<br> with the specified prefix. If you<br> are unsure, leave this blank.)<br>e.g.: rt_</td><td align=\"left\"><input type=\"text\" name=\"prefix\" size=\"40\"></td></tr>\n\t\t</table>\n\t\t<br><br>\n\t\t<center>\n\t\t<input type=\"submit\" value=\"Install\">\n\t\t</center>\n\t\t<br>\n\t\t</form></body></html><?php exit;\n\n\t}\n\tif (isset($_POST[\"makeaccount\"]))\n\t{\n\t\t?>\n\t\t<form method=\"post\" action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\">\n\t\t<input type=\"hidden\" name=\"domakeaccount\" value=\"1\">\n\t\t<input type=\"hidden\" name=\"started\" value=\"1\">\n\t\t<h1>Tracker Installation</h1>\n\t\t<center>\n\t\t<img src=\"images/install.png\" border=\"0\" class=\"icon\" alt=\"RivetTracker Installation\" title=\"RivetTracker Installation\" />\n\t\t</center>\n\t\t<br><br>\n\t\t<table border=0 cellpadding=5>\n\t\t<tr><td align=\"right\">Username of database admin:</td><td align=\"left\"><input type=\"text\" name=\"adminname\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Password of database admin:</td><td align=\"left\"><input type=\"password\" name=\"adminpass\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Database hostname:<br>(in MySQL format, example: localhost)</td><td align=\"left\"><input type=\"text\" name=\"host\" size=\"40\" value=\"localhost\"></td></tr>\n\t\t<tr><td align=\"right\">Create user for MySQL:<br>(make sure this user does not already exist)</td><td align=\"left\"><input type=\"text\" name=\"username\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Password:</td><td align=\"left\"><input type=\"password\" name=\"password\" size=\"40\"></td></tr>\n\t\t<tr><td align=\"right\">Create database (name):</td><td align=\"left\"><input type=\"text\" name=\"database\" size=\"40\"></td></tr>\n\t\t</table>\n\t\t<br><br>\n\t\t<center>\t\t\n\t\t<input type=\"submit\" value=\"Install\">\n\t\t</center>\n\t\t</form></body></html>\n\t\t<?php exit;\n\t}\n\n\tif (isset($_POST[\"prefix\"])) {\n\t\t$prefix = $_POST[\"prefix\"];\n\t} else {\n\t\t$prefix = \"\";\n\t}\n\n\t$makenamemap= 'CREATE TABLE ' . $prefix . 'namemap (info_hash char(40) NOT NULL default \"\", filename varchar(250) NOT NULL default \"\", url varchar(250) NOT NULL default \"\", size bigint(20) unsigned NOT NULL, pubDate varchar(25) NOT NULL default \"\", PRIMARY KEY(info_hash)) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\t$makesummary = 'CREATE TABLE ' . $prefix . 'summary (info_hash char(40) NOT NULL default \"\", dlbytes bigint unsigned NOT NULL default 0, seeds int unsigned NOT NULL default 0, leechers int unsigned NOT NULL default 0, finished int unsigned NOT NULL default 0, lastcycle int unsigned NOT NULL default \"0\", lastSpeedCycle int unsigned NOT NULL DEFAULT \"0\", speed bigint unsigned NOT NULL default 0, piecelength int(11) NOT NULL default -1, numpieces int(11) NOT NULL default 0, PRIMARY KEY (info_hash)) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\t$maketimestamps = 'CREATE TABLE ' . $prefix . 'timestamps (info_hash char(40) not null, sequence int unsigned not null auto_increment, bytes bigint unsigned not null, delta smallint unsigned not null, primary key(sequence), key sorting (info_hash)) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\t$makespeedlimit = 'CREATE TABLE ' . $prefix . 'speedlimit (uploaded bigint(25) NOT NULL default 0, total_uploaded bigint(30) NOT NULL default 0, started bigint(25) NOT NULL default 0) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\t$makewebseedfiles = 'CREATE TABLE ' . $prefix . 'webseedfiles (info_hash char(40) default NULL, filename char(250) NOT NULL default \"\", startpiece int(11) NOT NULL default 0, endpiece int(11) NOT NULL default 0, startpieceoffset int(11) NOT NULL default 0, fileorder int(11) NOT NULL default 0, UNIQUE KEY fileseq (info_hash,fileorder)) DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci ENGINE = innodb';\n\tif (isset($_POST[\"maketables\"]))\n\t{\n\t\t$username = $_POST[\"username\"] or die(errorMessage() . \"No username was given, please try again.</p>\");\n\t\t$password = $_POST[\"password\"] or die(errorMessage() . \"No username password was given, this is a huge security risk, please try again.</p>\");\n\t\t$database = $_POST[\"database\"] or die(errorMessage() . \"No database specified, please try again.</p>\");\n\t\t$hostname = $_POST[\"host\"] or die(errorMessage() . \"No database hostname specified, please try again.</p>\");\n\n\t\t$db = mysql_connect($hostname, $username, $password) or die(errorMessage() . \"Can't connect to database: \" . mysql_error() . \"</p>\"); \n\t\tmysql_select_db($database) or die(errorMessage() . \"Can't select database: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makesummary) or die(errorMessage() . \"Can't make the summary table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makenamemap) or die(errorMessage() . \"Can't make the namemap table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($maketimestamps) or die(errorMessage() . \"Can't make the timestamps table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makespeedlimit) or die(errorMessage() . \"Can't make the speedlimit table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makewebseedfiles) or die(errorMessage() . \"Can't make the webseedfiles table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query(\"INSERT INTO \".$prefix.\"speedlimit values (0,0,0)\") or die(errorMessage() . \"Can't insert zeros into speedlimit table: \" . mysql_error() . \"</p>\");\n\t\techo \"<p class=\\\"success\\\">Database was created successfully!</p><br><br>\";\n\t}\n\n\tif (isset($_POST[\"domakeaccount\"]))\n\t{\n\t\t$username = $_POST[\"username\"] or die(errorMessage() . \"No username was given, please try again.</p>\");\n\t\t$password = $_POST[\"password\"] or die(errorMessage() . \"No username password was given, this is a huge security risk, please try again.</p>\");\n\t\t$database = $_POST[\"database\"] or die(errorMessage() . \"No database specified, please try again.</p>\");\n\t\t$hostname = $_POST[\"host\"] or die(errorMessage() . \"No database hostname specified, please try again.</p>\");\n\n\t\t$dbadmin = $_POST[\"adminname\"] or die(errorMessage() . \"No admin username was given, please try again.</p>\");\n\t\t$dbpass = $_POST[\"adminpass\"]; // No admin password, OK but huge security risk...\n\t\t\n\t\t// Escaping strings will be ignored for now.\n\t\t$db = mysql_connect($hostname, $dbadmin, $dbpass) or die(errorMessage() . \"Error connecting: \" . mysql_error() . \"</p>\");\n\t\tmysql_select_db(\"mysql\") or die(errorMessage() . \"Can't select db \\\"mysql\\\":\" . mysql_error() . \"</p>\");\n\n\t\tmysql_query(\"INSERT INTO user SET user=\\\"$username\\\", password=PASSWORD(\\\"$password\\\"), host=\\\"\\\"\") or die(errorMessage() . \"Can't make user: \" . mysql_error() . \"</p>\");\n\t\tmysql_query(\"INSERT INTO db SET Host=\\\"%\\\", db=\\\"$database\\\", user=\\\"$username\\\", select_priv='Y', Insert_priv='Y', Update_priv='Y', Delete_priv='Y', Create_priv='Y', Drop_priv='Y', Alter_priv='Y', index_priv='Y'\") or die(errorMessage() . \"Cannot insert into \\\"Db\\\": \" . mysql_error() . \"</p>\");\n\t\tmysql_query(\"CREATE DATABASE $database\") or die(errorMessage() . \"Can't make database: \" . mysql_error() . \"</p>\");\n\t\t\n\t\tmysql_query(\"FLUSH PRIVILEGES\") or die(errorMessage() . \"Can't flush privileges: \" . mysql_error() . \"</p>\");\n\t\n\t\tmysql_select_db($database) or die(errorMessage() . \"Can't select database \\\"$database\\\":\" . mysql_error() . \"</p>\");\n\t\n\t\tmysql_query($makesummary) or die(errorMessage() . \"Can't make the summary table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makenamemap) or die(errorMessage() . \"Can't make the namemap table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($maketimestamps) or die(errorMessage() . \"Can't make the timestamps table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makespeedlimit) or die(errorMessage() . \"Can't make the speedlimit table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query($makewebseedfiles) or die(errorMessage() . \"Can't make the webseedfiles table: \" . mysql_error() . \"</p>\");\n\t\tmysql_query(\"INSERT INTO \".$prefix.\"speedlimit values (0,0,0)\") or die(errorMessage() . \"Can't insert zeros into speedlimit table: \" . mysql_error() . \"</p>\");\n\t\techo \"<p class=\\\"success\\\">Database was created successfully!</p><br><br>\";\n\n\t}\n\n\tif (isset($_POST[\"domakeaccount\"]) || isset($_POST[\"maketables\"]))\n\t{\n\t\t//have user set values for config.php\n\t\t?>\n\t\t<form method=\"post\" action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\">\n\t\t<input type=\"hidden\" name=\"config\" value=\"1\">\n\t\t<input type=\"hidden\" name=\"started\" value=\"1\">\n\t\t<?php\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"dbhost\\\" value=\\\"\" . $hostname . \"\\\">\\n\";\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"dbuser\\\" value=\\\"\" . $username . \"\\\">\\n\";\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"dbpass\\\" value=\\\"\" . $password . \"\\\">\\n\";\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"database\\\" value=\\\"\" . $database . \"\\\">\\n\";\n\t\techo \"<input type=\\\"hidden\\\" name=\\\"prefix\\\" value=\\\"\" . $prefix . \"\\\">\\n\";\n\t\t?>\n\t\t<h1>Create Configuration File</h1>\n\t\t<br><br>\n\t\t<h2>This last step allows you to configure the \"config.php\" file.  This file stores all the necessary\n\t\tsettings for your tracker.  You can edit these settings at a later time in the admin page if you need\n\t\tto change them.  Please do NOT edit the \"config.php\" file directly, use the admin page for any changes.\n\t\tIt's usually pretty safe to leave most of the settings to the default unless you know what you're doing.</h2>\n\t\t<h2><span class=\"notice\">*</span> - required value</h2>\n\t\t<table border=1 cellpadding=3>\n\t\t\n\t\t<tr><td>Make tracker hidden: This will require a login by either the admin or upload user in order to\n\t\tsee the torrents available on the main statistics page.  This does not mean it's a private tracker.  If you\n\t\tneed a private tracker, there are many other trackers out there.  Also, you will need to secure the \"torrents\"\n\t\tfolder with an .htaccess file for Apache or some other method.  The tracker will still accept all valid\n\t\tconnections by clients.  There is no user checking in that regard.</td>\n\t\t<td><input type=\"checkbox\" name=\"hiddentracker\"></td></tr>\n\t\t\n\t\t<tr><td>Enable or disable scraping by clients.  Generally it is safe to leave this on unless\n\t\tyou have a large number of torrents or users which can lead to increased bandwidth usage.  Also, scraping\n\t\tcan possibily be used maliciously by abusive clients.</td>\n\t\t<td><input type=\"checkbox\" name=\"scrape\" checked></td></tr>\n\n\t\t<tr><td>Short Announce URL: You can enable the short announce feature, making the URL end in /announce for\n\t\tyour tracker.  You should not utilize both tracker URL forms in one torrent at the same time, or you will get\n\t\tinconsistent results.  Note: You will need the provided htaccess file, have URL rewrite capabilities, and have\n\t\tit properly set up to use this feature.  Otherwise, leave it disabled.</td>\n\t\t<td><select name=\"announceurl\" id=\"announceurl\">\n\t\t<option title=\"disabled\" value=\"announce.php\"<?php if($temp == \"announce.php\") echo \" selected=\\\"selected\\\"\";?>>disabled</option>\n\t\t<option title=\"enabled\" value=\"announce\"<?php if($temp == \"announce\") echo \" selected=\\\"selected\\\"\";?>>enabled</option>\n\t\t</select>\n\t\t</td>\n\t\t</tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Lists the number of torrents on each page on your torrent tracker list.  Default is 10.</td>\n\t\t<td><input type=\"text\" name=\"indexpagelimitspecify\" size=\"40\" value=\"10\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Lists the number of torrents on each page on the detailed statistics page.  Default is 5.</td>\n\t\t<td><input type=\"text\" name=\"statspagelimitspecify\" size=\"40\" value=\"5\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Maximum reannounce interval (in seconds) 1800 == 30 minutes</td>\n\t\t<td><input type=\"text\" name=\"report_interval\" size=\"40\" value=\"1800\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Minimum reannounce interval (also in seconds) 300 == 5 minutes</td>\n\t\t<td><input type=\"text\" name=\"min_interval\" size=\"40\" value=\"300\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Number of peers to send in one request.  Some logic will break if you set this to more than 300,\n\t\tso please don't do that. 100 is the most you should set anyway.</td>\n\t\t<td><input type=\"text\" name=\"maxpeers\" size=\"40\" value=\"50\"></td></tr>\n\n\t\t<tr><td>If set, NAT checking will be performed.\n\t\tThis may cause trouble with some providers, so it's\n\t\toff by default.</td>\n\t\t<td><input type=\"checkbox\" name=\"NAT\"></td></tr>\n\n\t\t<tr><td>Persistent MySQL connections:\n\t\tCheck with your webmaster to see if you're allowed to use these.\n\t\tHighly recommended, especially for higher loads, but generally\n\t\tnot allowed unless it's a dedicated machine.</td>\n\t\t<td><input type=\"checkbox\" name=\"persist\"></td></tr>\n\n\t\t<tr><td>Allow users to override ip address.\n\t\tEnable this if you know people have a legit reason to use\n\t\tthis function. Leave disabled otherwise.</td>\n\t\t<td><input type=\"checkbox\" name=\"ip_override\"></td></tr>\n\n\t\t<tr><td>For heavily loaded trackers, uncheck this. It will stop count the number\n\t\tof downloaded bytes and the speed of the torrent, but will significantly reduce\n\t\tthe load.</td>\n\t\t<td><input type=\"checkbox\" name=\"countbytes\" checked></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Username for individual who can add torrents to tracker database.\n\t\tThis user is only able to create, and not delete torrents to the tracker.\n\t\tFor full privileges, see the admin user.</td>\n\t\t<td><input type=\"text\" name=\"upload_username\" size=\"40\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Password for individual who can add torrents to tracker database.\n\t\tAgain, this user is only able to create, and not delete torrents to the tracker.\n\t\tFor full privileges, see the admin user.</td>\n\t\t<td><input type=\"password\" name=\"upload_password\" size=\"40\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Admin username. The admin is able to go to the admin page and show detailed \n\t\tinformation about the tracker as well as access a few other important tools.\n\t\tThe admin is also able to upload torrents to the database\n\t\tjust like the previous account.</td>\n\t\t<td><input type=\"text\" name=\"admin_username\" size=\"40\"></td></tr>\n\n\t\t<tr><td><span class=\"notice\">* </span>Password for admin.  Again, The admin is able to go to the admin page and show detailed \n\t\tinformation about the tracker as well as access a few other important tools.\n\t\tThe admin is also able to upload torrents to the database.</td>\n\t\t<td><input type=\"password\" name=\"admin_password\" size=\"40\"></td></tr>\n\n\t\t<tr><td>Title on index.php statistics page, if not set, defaults to \"Tracker Statistics\"</td>\n\t\t<td><input type=\"text\" name=\"title\" size=\"40\"></td></tr>\n\t\t\n\t\t<tr><td>Enable RSS feed: If you do not want the RSS feed to be created for \n\t\tprivacy reasons or do not need it disable this checkbox.</td>\n\t\t<td><input type=\"checkbox\" name=\"enablerss\" checked></td></tr>\n\t\t\n\t\t<tr><td>RSS Title: In the rss.xml file, this is the main <pre>&lt;title&gt;</pre> tag.</td>\n\t\t<td><input type=\"text\" name=\"rss_title\" size=\"40\"></td></tr>\n\t\t\n\t\t<tr><td>RSS link to main website: In the rss.xml file, this is the main <pre>&lt;link&gt;</pre> tag.</td>\n\t\t<td><input type=\"text\" name=\"rss_link\" size=\"40\"></td></tr>\n\t\t\n\t\t<tr><td>RSS description: In the rss.xml file, this is the main <pre>&lt;description&gt;</pre> tag.</td>\n\t\t<td><input type=\"text\" name=\"rss_description\" size=\"60\"></td></tr>\n\t\t\n\t\t<tr><td><span class=\"notice\">* </span>Main website url that the tracker runs on, example: http://www.mywebsite.com</td>\n\t\t<td><input type=\"text\" name=\"website_url\" size=\"40\"></td></tr>\n\t\t\n\t\t<tr><td><span class=\"notice\">* </span>For HTTP seeding, this is the maximum total upload rate per second in kilobytes, for example 100 would be 100 KB/s</td>\n\t\t<td><input type=\"text\" name=\"max_upload_rate\" size=\"40\" value=\"100\"></td></tr>\n\t\t\n\t\t<tr><td><span class=\"notice\">* </span>For HTTP seeding, this is the maximum number of uploads to run at a time</td>\n\t\t<td><input type=\"text\" name=\"max_uploads\" size=\"40\" value=\"5\"></td></tr>\n\t\t\n\t\t<tr><td><span class=\"notice\">* </span>Timezone that the server runs on</td>\n\t\t<td>\n\t\t<select name=\"timezone\" id=\"timezone\">\n\t\t<option title=\"[UTC - 12] Baker Island Time\" value=\"-1200\">[UTC - 12] Baker Island Time</option>\n\t\t<option title=\"[UTC - 11] Niue Time, Samoa Standard Time\" value=\"-1100\">[UTC - 11] Niue Time, Samoa Standard Time</option>\n\t\t<option title=\"[UTC - 10] Hawaii-Aleutian Standard Time, Cook Island Time\" value=\"-1000\">[UTC - 10] Hawaii-Aleutian Standard Time, Cook Isl...</option>\n\t\t<option title=\"[UTC - 9:30] Marquesas Islands Time\" value=\"-0930\">[UTC - 9:30] Marquesas Islands Time</option>\n\t\t<option title=\"[UTC - 9] Alaska Standard Time, Gambier Island Time\" value=\"-0900\">[UTC - 9] Alaska Standard Time, Gambier Island Tim...</option>\n\t\t<option title=\"[UTC - 8] Pacific Standard Time\" value=\"-0800\">[UTC - 8] Pacific Standard Time</option>\n\t\t<option title=\"[UTC - 7] Mountain Standard Time\" value=\"-0700\">[UTC - 7] Mountain Standard Time</option>\n\t\t<option title=\"[UTC - 6] Central Standard Time\" value=\"-0600\">[UTC - 6] Central Standard Time</option>\n\t\t<option title=\"[UTC - 5] Eastern Standard Time\" value=\"-0500\">[UTC - 5] Eastern Standard Time</option>\n\t\t<option title=\"[UTC - 4] Atlantic Standard Time\" value=\"-0400\">[UTC - 4] Atlantic Standard Time</option>\n\t\t<option title=\"[UTC - 3:30] Newfoundland Standard Time\" value=\"-0330\">[UTC - 3:30] Newfoundland Standard Time</option>\n\t\t<option title=\"[UTC - 3] Amazon Standard Time, Central Greenland Time\" value=\"-0300\">[UTC - 3] Amazon Standard Time, Central Greenland ...</option>\n\t\t<option title=\"[UTC - 2] Fernando de Noronha Time, South Georgia &amp; the South Sandwich Islands Time\" value=\"-0200\">[UTC - 2] Fernando de Noronha Time, South Georgia ...</option>\n\t\t<option title=\"[UTC - 1] Azores Standard Time, Cape Verde Time, Eastern Greenland Time\" value=\"-0100\">[UTC - 1] Azores Standard Time, Cape Verde Time, E...</option>\n\t\t<option title=\"[UTC] Western European Time, Greenwich Mean Time\" value=\"+0000\" selected=\"selected\">[UTC] Western European Time, Greenwich Mean Time</option>\n\t\t<option title=\"[UTC + 1] Central European Time, West African Time\" value=\"+0100\">[UTC + 1] Central European Time, West African Time</option>\n\t\t<option title=\"[UTC + 2] Eastern European Time, Central African Time\" value=\"+0200\">[UTC + 2] Eastern European Time, Central African T...</option>\n\t\t<option title=\"[UTC + 3] Moscow Standard Time, Eastern African Time\" value=\"+0300\">[UTC + 3] Moscow Standard Time, Eastern African Ti...</option>\n\t\t<option title=\"[UTC + 3:30] Iran Standard Time\" value=\"+0330\">[UTC + 3:30] Iran Standard Time</option>\n\t\t<option title=\"[UTC + 4] Gulf Standard Time, Samara Standard Time\" value=\"+0400\">[UTC + 4] Gulf Standard Time, Samara Standard Time</option>\n\t\t<option title=\"[UTC + 4:30] Afghanistan Time\" value=\"+0430\">[UTC + 4:30] Afghanistan Time</option>\n\t\t<option title=\"[UTC + 5] Pakistan Standard Time, Yekaterinburg Standard Time\" value=\"+0500\">[UTC + 5] Pakistan Standard Time, Yekaterinburg St...</option>\n\t\t<option title=\"[UTC + 5:30] Indian Standard Time, Sri Lanka Time\" value=\"+0530\">[UTC + 5:30] Indian Standard Time, Sri Lanka Time</option>\n\t\t<option title=\"[UTC + 6] Bangladesh Time, Bhutan Time, Novosibirsk Standard Time\" value=\"+0600\">[UTC + 6] Bangladesh Time, Bhutan Time, Novosibirs...</option>\n\t\t<option title=\"[UTC + 6:30] Cocos Islands Time, Myanmar Time\" value=\"+0630\">[UTC + 6:30] Cocos Islands Time, Myanmar Time</option>\n\t\t<option title=\"[UTC + 7] Indochina Time, Krasnoyarsk Standard Time\" value=\"+0700\">[UTC + 7] Indochina Time, Krasnoyarsk Standard Tim...</option>\n\t\t<option title=\"[UTC + 8] Chinese Standard Time, Australian Western Standard Time, Irkutsk Standard Time\" value=\"+0800\">[UTC + 8] Chinese Standard Time, Australian Wester...</option>\n\t\t<option title=\"[UTC + 9] Japan Standard Time, Korea Standard Time, Chita Standard Time\" value=\"+0900\">[UTC + 9] Japan Standard Time, Korea Standard Time...</option>\n\t\t<option title=\"[UTC + 9:30] Australian Central Standard Time\" value=\"+0930\">[UTC + 9:30] Australian Central Standard Time</option>\n\t\t<option title=\"[UTC + 10] Australian Eastern Standard Time, Vladivostok Standard Time\" value=\"+1000\">[UTC + 10] Australian Eastern Standard Time, Vladi...</option>\n\t\t<option title=\"[UTC + 10:30] Lord Howe Standard Time\" value=\"+1030\">[UTC + 10:30] Lord Howe Standard Time</option>\n\t\t<option title=\"[UTC + 11] Solomon Island Time, Magadan Standard Time\" value=\"+1100\">[UTC + 11] Solomon Island Time, Magadan Standard T...</option>\n\t\t<option title=\"[UTC + 11:30] Norfolk Island Time\" value=\"+1130\">[UTC + 11:30] Norfolk Island Time</option>\n\t\t<option title=\"[UTC + 12] New Zealand Time, Fiji Time, Kamchatka Standard Time\" value=\"+1200\">[UTC + 12] New Zealand Time, Fiji Time, Kamchatka ...</option>\n\t\t<option title=\"[UTC + 13] Tonga Time, Phoenix Islands Time\" value=\"+1300\">[UTC + 13] Tonga Time, Phoenix Islands Time</option>\n\t\t<option title=\"[UTC + 14] Line Island Time\" value=\"+1400\">[UTC + 14] Line Island Time</option>\n\t\t</select>\n\t\t</td>\n\t\t</tr>\n\t\t\n\t\t</table>\n\t\t<br>\n\t\t<center>\n\t\t<input type=\"submit\" value=\"Create Config File\">\n\t\t</center>\n\t\t<br><br><br>\n\t\t</form>\n\t\t</body>\n\t\t</html>\n\t\t<?php\n\t}\n\n\tif (isset($_POST[\"config\"]))\n\t{\n\t\t//check required entries for values, if blank: error out\n\t\tif ($_POST[\"announceurl\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The announce URL is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"indexpagelimitspecify\"]) || $_POST[\"indexpagelimitspecify\"] == \"\" || $_POST[\"indexpagelimitspecify\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The index page limit is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"statspagelimitspecify\"]) || $_POST[\"statspagelimitspecify\"] == \"\" || $_POST[\"statspagelimitspecify\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The statistics page limit is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"report_interval\"]) || $_POST[\"report_interval\"] == \"\" || $_POST[\"report_interval\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The maximum reannounce interval is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"min_interval\"]) || $_POST[\"min_interval\"] == \"\" || $_POST[\"min_interval\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The minimum reannounce interval is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"maxpeers\"]) || $_POST[\"maxpeers\"] == \"\" || $_POST[\"maxpeers\"] > 300 || $_POST[\"maxpeers\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The number of peers to send in one request is not an integer, over 300, a negative number, zero, or blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"upload_username\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The upload username is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"upload_password\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The upload user password is blank. This is considered a security risk.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"admin_username\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The admin username is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"admin_password\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The admin user password is blank. This is considered a LARGE security risk.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"dbhost\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The database hostname is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"dbuser\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The database username is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"dbpass\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The database password is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"database\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The database name is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"rss_link\"] != \"\" && Substr($_POST[\"rss_link\"], 0, 7) != \"http://\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The RSS website URL does not start with http://</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"website_url\"] == \"\" || Substr($_POST[\"website_url\"], 0, 7) != \"http://\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The website URL does not start with http:// or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"max_upload_rate\"]) || $_POST[\"max_upload_rate\"] == \"\" || $_POST[\"max_upload_rate\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The maximum upload rate is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif (!is_numeric($_POST[\"max_uploads\"]) || $_POST[\"max_uploads\"] == \"\" || $_POST[\"max_uploads\"] <= 0)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The maximum uploads is not an integer, a negative number, or is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"timezone\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: The timezone is blank.</p>\";\n\t\t\texit();\n\t\t}\n\t\tif ($_POST[\"upload_username\"] == $_POST[\"admin_username\"])\n\t\t{\n\t\t\techo errorMessage() . \"Error: The admin username cannot be the same as the upload username.</p>\";\n\t\t\texit();\n\t\t}\n\t\n\t\t//create config.php based on user input\n\t\t//first try creating it on the server\n\t\tif (is_writable(\"./\"))\n\t\t{\n\t\t\t//go through checkboxes and change \"on\" to \"true\"\n\t\t\tif ($_POST[\"hiddentracker\"] == \"on\")\n\t\t\t\t$hiddentracker = \"true\";\n\t\t\telse\n\t\t\t\t$hiddentracker = \"false\";\t\n\t\t\tif ($_POST[\"enablerss\"] == \"on\")\n\t\t\t\t$enablerss = \"true\";\n\t\t\telse\n\t\t\t\t$enablerss = \"false\";\n\t\t\tif ($_POST[\"scrape\"] == \"on\")\n\t\t\t\t$scrape = \"true\";\n\t\t\telse\n\t\t\t\t$scrape = \"false\";\n\t\t\tif ($_POST[\"NAT\"] == \"on\")\n\t\t\t\t$NAT = \"true\";\n\t\t\telse\n\t\t\t\t$NAT = \"false\";\n\t\t\tif ($_POST[\"persist\"] == \"on\")\n\t\t\t\t$persist = \"true\";\n\t\t\telse\n\t\t\t\t$persist = \"false\";\n\t\t\tif ($_POST[\"ip_override\"] == \"on\")\n\t\t\t\t$ip_override = \"true\";\n\t\t\telse\n\t\t\t\t$ip_override = \"false\";\n\t\t\tif ($_POST[\"countbytes\"] == \"on\")\n\t\t\t\t$countbytes = \"true\";\n\t\t\telse\n\t\t\t\t$countbytes = \"false\";\n\n\t\t\t//write config.php file\n\t\t\t$fd = fopen(\"config.php\", \"w\") or die(errorMessage() . \"Error: couldn't make config.php!</p>\");\n\t\t\tfwrite($fd, \n\t\t\t\"<?php //Please do NOT edit this file, use the admin page for changes.\\n\" .\n\t\t\t\"\\$GLOBALS['hiddentracker'] = \" . $hiddentracker . \";\\n\" .\n\t\t\t\"\\$GLOBALS['scrape'] = \" . $scrape . \";\\n\" .\n\t\t\t\"\\$announceurl = \" . htmlspecialchars($_POST[\"announceurl\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['indexpagelimitspecify'] = \" . htmlspecialchars($_POST[\"indexpagelimitspecify\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['statspagelimitspecify'] = \" . htmlspecialchars($_POST[\"statspagelimitspecify\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['report_interval'] = \" . htmlspecialchars($_POST[\"report_interval\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['min_interval'] = \" . htmlspecialchars($_POST[\"min_interval\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['maxpeers'] = \" . htmlspecialchars($_POST[\"maxpeers\"]) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['NAT'] = \" . $NAT . \";\\n\" .\n\t\t\t\"\\$GLOBALS['persist'] = \" . $persist . \";\\n\" .\n\t\t\t\"\\$GLOBALS['ip_override'] = \" . $ip_override . \";\\n\" .\n\t\t\t\"\\$GLOBALS['countbytes'] = \" . $countbytes . \";\\n\" .\n\t\t\t\"\\$upload_username = '\" . htmlspecialchars($_POST[\"upload_username\"]) . \"';\\n\" .\n\t\t\t\"\\$upload_password = '\" . md5($_POST[\"upload_username\"].$_POST[\"upload_password\"]) . \"';\\n\" .\n\t\t\t\"\\$admin_username = '\" . htmlspecialchars($_POST[\"admin_username\"]) . \"';\\n\" .\n\t\t\t\"\\$admin_password = '\" . md5($_POST[\"admin_username\"].$_POST[\"admin_password\"]) . \"';\\n\" .\n\t\t\t\"\\$GLOBALS['title'] = '\" . htmlspecialchars(addquotes($_POST[\"title\"])) . \"';\\n\" .\n\t\t\t\"\\$dbhost = '\" . htmlspecialchars($_POST[\"dbhost\"]) . \"';\\n\" .\n\t\t\t\"\\$dbuser = '\" . htmlspecialchars($_POST[\"dbuser\"]) . \"';\\n\" .\n\t\t\t\"\\$dbpass = '\" . htmlspecialchars($_POST[\"dbpass\"]) . \"';\\n\" .\n\t\t\t\"\\$database = '\" . htmlspecialchars($_POST[\"database\"]) . \"';\\n\" .\n\t\t\t\"\\$enablerss = \" . $enablerss . \";\\n\" .\n\t\t\t\"\\$rss_title = '\" . htmlspecialchars(addquotes($_POST[\"rss_title\"])) . \"';\\n\" .\n\t\t\t\"\\$rss_link = '\" . htmlspecialchars($_POST[\"rss_link\"]) . \"';\\n\" .\n\t\t\t\"\\$rss_description = '\" . htmlspecialchars(addquotes($_POST[\"rss_description\"])) . \"';\\n\" .\n\t\t\t\"\\$website_url = '\" . htmlspecialchars($_POST[\"website_url\"]) . \"';\\n\" .\n\t\t\t\"\\$GLOBALS['max_upload_rate'] = \" . htmlspecialchars($_POST['max_upload_rate']) . \";\\n\" .\n\t\t\t\"\\$GLOBALS['max_uploads'] = \" . htmlspecialchars($_POST['max_uploads']) . \";\\n\" .\n\t\t\t\"\\$timezone = '\" . htmlspecialchars($_POST[\"timezone\"]) . \"';\\n\" .\n\t\t\t\"\\$prefix = '\" . htmlspecialchars($_POST[\"prefix\"]) . \"';\\n\" .\n\t\t\t\"?>\"\n\t\t\t);\n\n\t\t\tfclose($fd);\n\t\t\techo \"<br><p class=\\\"success\\\">config.php file was created successfully!</p>\";\n\t\t}\n\n\t\t//if unable to create on server, user downloads config.php file for future upload\n\t\tif (!is_writable(\"./\"))\n\t\t{\n\t\t\t?>\n\t\t\t<h2>\"config.php\" was unable to be created on the server, \n\t\t\tyou will have to download the file and upload it manually.</h2>\n\t\t\t<br>\n\t\t\t<form method=\"post\" action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\">\n\t\t\t<input type=\"hidden\" name=\"download\" value=\"1\">\n\t\t\t<input type=\"hidden\" name=\"hiddentracker\" value=\"<?php if (isset($_POST['hiddentracker']) AND $_POST['hiddentracker'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"scrape\" value=\"<?php if (isset($_POST['scrape']) AND $_POST['scrape'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"announceurl\" value=\"<?php echo $_POST['announceurl'];?>\">\n\t\t\t<input type=\"hidden\" name=\"indexpagelimitspecify\" value=\"<?php echo $_POST['indexpagelimitspecify'];?>\">\n\t\t\t<input type=\"hidden\" name=\"statspagelimitspecify\" value=\"<?php echo $_POST['statspagelimitspecify'];?>\">\n\t\t\t<input type=\"hidden\" name=\"report_interval\" value=\"<?php echo $_POST['report_interval'];?>\">\n\t\t\t<input type=\"hidden\" name=\"min_interval\" value=\"<?php echo $_POST['min_interval'];?>\">\n\t\t\t<input type=\"hidden\" name=\"maxpeers\" value=\"<?php echo $_POST['maxpeers'];?>\">\n\t\t\t<input type=\"hidden\" name=\"NAT\" value=\"<?php if (isset($_POST['NAT']) AND $_POST['NAT'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"persist\" value=\"<?php if (isset($_POST['persist']) AND $_POST['persist'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"ip_override\" value=\"<?php if (isset($_POST['ip_override']) AND $_POST['ip_override'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"countbytes\" value=\"<?php if (isset($_POST['countbytes']) AND $_POST['countbytes'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"upload_username\" value=\"<?php echo $_POST['upload_username'];?>\">\n\t\t\t<input type=\"hidden\" name=\"upload_password\" value=\"<?php echo md5($_POST[\"upload_username\"].$_POST[\"upload_password\"]);?>\">\n\t\t\t<input type=\"hidden\" name=\"admin_username\" value=\"<?php echo $_POST['admin_username'];?>\">\n\t\t\t<input type=\"hidden\" name=\"admin_password\" value=\"<?php echo md5($_POST[\"admin_username\"].$_POST[\"admin_password\"]);?>\">\n\t\t\t<input type=\"hidden\" name=\"title\" value=\"<?php echo $_POST['title'];?>\">\n\t\t\t<input type=\"hidden\" name=\"dbhost\" value=\"<?php echo $_POST['dbhost'];?>\">\n\t\t\t<input type=\"hidden\" name=\"dbuser\" value=\"<?php echo $_POST['dbuser'];?>\">\n\t\t\t<input type=\"hidden\" name=\"dbpass\" value=\"<?php echo $_POST['dbpass'];?>\">\n\t\t\t<input type=\"hidden\" name=\"database\" value=\"<?php echo $_POST['database'];?>\">\n\t\t\t<input type=\"hidden\" name=\"enablerss\" value=\"<?php if (isset($_POST['enablerss']) AND $_POST['enablerss'] == 'on') echo 'true'; else echo 'false';?>\">\n\t\t\t<input type=\"hidden\" name=\"rss_title\" value=\"<?php echo $_POST['rss_title'];?>\">\n\t\t\t<input type=\"hidden\" name=\"rss_link\" value=\"<?php echo $_POST['rss_link'];?>\">\n\t\t\t<input type=\"hidden\" name=\"rss_description\" value=\"<?php echo $_POST['rss_description'];?>\">\n\t\t\t<input type=\"hidden\" name=\"website_url\" value=\"<?php echo $_POST['website_url'];?>\">\n\t\t\t<input type=\"hidden\" name=\"max_upload_rate\" value=\"<?php echo $_POST['max_upload_rate'];?>\">\n\t\t\t<input type=\"hidden\" name=\"max_uploads\" value=\"<?php echo $_POST['max_uploads'];?>\">\n\t\t\t<input type=\"hidden\" name=\"timezone\" value=\"<?php echo $_POST['timezone'];?>\">\n\t\t\t<input type=\"hidden\" name=\"prefix\" value=\"<?php echo $_POST['prefix'];?>\">\n\t\t\t<input type=\"submit\" value=\"Download config.php File\">\n\t\t\t</form>\n\t\t\t<br>\n\t\t\t<?php\n\t\t}\n\n\t\t//display message to delete install.php file\n\t\techo \"<p class=\\\"error\\\">Make sure you go and delete this installer script when you are done! (install.php)</p><br><br>\\n\";\n\t\techo \"<p class=\\\"error\\\">Also, check the permissions and make sure the 'torrents' and 'rss' folders are able to be written to by the server.</p><br><br>\\n\";\n\t\techo \"<br><center><a href=\\\"index.php\\\">Main Statistics Page</a></center>\\n\";\t\t\n\t\techo \"</body></html>\\n\";\n\t}\n\n?>\n", "<?php\nrequire_once(\"config.php\");\nrequire_once(\"funcsv2.php\");\n//Check session\nsession_start();\n\nif (!$_SESSION['admin_logged_in'] && !$_SESSION['upload_logged_in'])\n{\n\t//check fails\n\theader(\"Location: authenticate.php?status=error\");\n\texit();\n}\n?>\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n\t<title>Add Torrent to Tracker</title>\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./css/style.css\" />\n</head>\n<body>\n\n<?php\n$tracker_url = $website_url . substr($_SERVER['PHP_SELF'], 0, -15) . $announceurl;\n\nif (isset($_FILES[\"torrent\"]))\n\taddTorrent();\n\n\nendOutput();\n\n\t\nfunction addTorrent()\n{\n\trequire (\"config.php\");\n\t$tracker_url = $website_url . substr($_SERVER['PHP_SELF'], 0, -15) . $announceurl;\n\t\n\t$hash = strtolower($_POST[\"hash\"]);\n\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Couldn't connect to the database, contact the administrator</p>\");\n\tmysql_select_db($database) or die(errorMessage() . \"Can't open the database.</p>\");\n\t\n\trequire_once (\"funcsv2.php\");\n\trequire_once (\"BDecode.php\");\n\trequire_once (\"BEncode.php\");\n\t\n\tif ($_FILES[\"torrent\"][\"error\"] != 4)\t\n\t{\n\t\t$fd = fopen($_FILES[\"torrent\"][\"tmp_name\"], \"rb\") or die(errorMessage() . \"File upload error 1</p>\\n\");\n\t\tis_uploaded_file($_FILES[\"torrent\"][\"tmp_name\"]) or die(errorMessage() . \"File upload error 2</p>\\n\");\n\t\t$alltorrent = fread($fd, filesize($_FILES[\"torrent\"][\"tmp_name\"]));\n\n\t\t$array = BDecode($alltorrent);\n\t\tif (!$array)\n\t\t{\n\t\t\techo errorMessage() . \"Error: The parser was unable to load your torrent.  Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\tendOutput();\n\t\t\texit;\n\t\t}\n\n\t\tif (isset($array[\"announce-list\"])) {\n\t\t\t//multiple trackers are listed\n\t\t\t$found_tracker = false;\n\t\t\tfor ($i = 0; $i < count($array[\"announce-list\"]); $i++) {\n\t\t\t\tif (strtolower($array[\"announce-list\"][$i][0]) == $tracker_url) {\n\t\t\t\t\t$found_tracker = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ($found_tracker == false)\n\t\t\t{\n\t\t\t\techo errorMessage() . \"Error: Multiple trackers were found but none of them match the\n\t\t\t\t\tannounce URL:<br>$tracker_url<br>Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\t\tendOutput();\n\t\t\t\texit;\n\t\t\t}\n\t\t} else {\n\t\t\t//a single tracker is listed\n\t\t\tif (strtolower($array[\"announce\"]) != $tracker_url) {\n\t\t\t\techo errorMessage() . \"Error: The tracker announce URL does not match this:<br>$tracker_url<br>Please re-create and re-upload the torrent.</p>\\n\";\n\t\t\t\tendOutput();\n\t\t\t\texit;\n\t\t\t}\n\t\t}\n\n\t\tif (isset($_POST[\"httpseed\"]) && $_POST[\"httpseed\"] == \"enabled\" && $_POST[\"relative_path\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: HTTP seeding was checked however no relative path was given.</p>\\n\";\n\t\t\tendOutput();\n\t\t\texit;\n\t\t}\n\t\tif (isset($_POST[\"httpseed\"]) && $_POST[\"httpseed\"] == \"enabled\" && $_POST[\"relative_path\"] != \"\")\n\t\t{\n\t\t\tif (Substr($_POST[\"relative_path\"], -1) == \"/\")\n\t\t\t{\n\t\t\t\tif (!is_dir($_POST[\"relative_path\"]))\n\t\t\t\t{\n\t\t\t\t\techo errorMessage() . \"Error: HTTP seeding relative path ends in / but is not a valid directory.</p>\\n\";\n\t\t\t\t\tendOutput();\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!is_file($_POST[\"relative_path\"]))\n\t\t\t\t{\n\t\t\t\t\techo errorMessage() . \"Error: HTTP seeding relative path is not a valid file.</p>\\n\";\n\t\t\t\t\tendOutput();\n\t\t\t\t\texit;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (isset($_POST[\"getrightseed\"]) && $_POST[\"getrightseed\"] == \"enabled\" && $_POST[\"httpftplocation\"] == \"\")\n\t\t{\n\t\t\techo errorMessage() . \"Error: GetRight HTTP seeding was checked however no URL was given.</p>\\n\";\n\t\t\tendOutput();\n\t\t\texit;\n\t\t}\n\t\tif (isset($_POST[\"getrightseed\"]) && $_POST[\"getrightseed\"] == \"enabled\" &&\n\t\t\t(Substr($_POST[\"httpftplocation\"], 0, 7) != \"http://\" && Substr($_POST[\"httpftplocation\"], 0, 6) != \"ftp://\")\n\t\t)\n\t\t{\n\t\t\techo errorMessage() . \"Error: GetRight HTTP seeding URL must start with http:// or ftp://</p>\\n\";\n\t\t\tendOutput();\n\t\t\texit;\n\t\t}\n\t\t$hash = @sha1(BEncode($array[\"info\"]));\n\t\tfclose($fd);\n\t\t\n\t\t$target_path = \"torrents/\";\n\t\t$target_path = $target_path . basename( clean($_FILES['torrent']['name'])); \n\t\t$move_torrent = move_uploaded_file($_FILES[\"torrent\"][\"tmp_name\"], $target_path);\n\t\tif ($move_torrent == false)\n\t\t{\n\t\t\techo errorMessage() . \"Unable to move \" . $_FILES[\"torrent\"][\"tmp_name\"] . \" to torrents/</p>\\n\";\n\t\t}\t\n\t}\n\t\n\n\tif (isset($_POST[\"filename\"]))\n\t\t$filename = clean($_POST[\"filename\"]);\n\telse\n\t\t$filename = \"\";\n\t\n\tif (isset($_POST[\"url\"]))\n\t\t$url = clean($_POST[\"url\"]);\n\telse\n\t\t$url = \"\";\n\n\tif (isset($_POST[\"autoset\"]))\n\tif (strcmp($_POST[\"autoset\"], \"enabled\") == 0)\n\t{\n\t\tif (strlen($filename) == 0 && isset($array[\"info\"][\"name\"]))\n\t\t\t$filename = $array[\"info\"][\"name\"];\n\t}\n\t\n\n\t//figure out total size of all files in torrent\n\t$info = $array[\"info\"];\n\t$total_size = 0;\n\tif (isset($info[\"files\"]))\n\t{\n\t\tforeach ($info[\"files\"] as $file)\n\t\t{\n\t\t\t$total_size = $total_size + $file[\"length\"];\n\t\t}\n\t}\n\telse\n\t{\n\t\t$total_size = $info[\"length\"];\n\t}\n\t\n\t//Validate torrent file, make sure everything is correct\n\t\n\t$filename = mysql_real_escape_string($filename);\n\t$filename = stripslashes($filename);\n\t$filename = htmlspecialchars(clean($filename));\n\t$url = htmlspecialchars(mysql_real_escape_string($url));\n\n\tif ((strlen($hash) != 40) || !verifyHash($hash))\n\t{\n\t\techo errorMessage() . \"Error: Info hash must be exactly 40 hex bytes.</p>\\n\";\n\t\tendOutput();\n\t}\n\n\tif (Substr($url, 0, 7) != \"http://\" && $url != \"\")\n\t{\n\t\techo errorMessage() . \"Error: The Torrent URL does not start with http:// Make sure you entered a correct URL.</p>\\n\";\n\t\tendOutput();\n\t}\n\n\t$query = \"INSERT INTO \".$prefix.\"namemap (info_hash, filename, url, size, pubDate) VALUES (\\\"$hash\\\", \\\"$filename\\\", \\\"$url\\\", \\\"$total_size\\\", \\\"\" . date('D, j M Y h:i:s') . \"\\\")\";\n\t$status = makeTorrent($hash, true);\n\tquickQuery($query);\n\tif ($status)\n\t{\n\t\techo \"<p class=\\\"success\\\">Torrent was added successfully.</p>\\n\";\n\t\techo \"<a href=\\\"newtorrents.php\\\"><img src=\\\"images/add.png\\\" border=\\\"0\\\" class=\\\"icon\\\" alt=\\\"Add Torrent\\\" title=\\\"Add Torrent\\\" /></a><a href=\\\"newtorrents.php\\\">Add Another Torrent</a><br>\\n\";\n\t\t//rename torrent file to match filename\n\t\trename(\"torrents/\" . clean($_FILES['torrent']['name']), \"torrents/\" . $filename . \".torrent\");\n\t\t//make torrent file readable by all\n\t\tchmod(\"torrents/\" . $filename . \".torrent\", 0644);\n\t\n\t\t//run RSS generator\n\t\trequire_once(\"rss_generator.php\");\n\t\t//Display information from DumpTorrentCGI.php\n\t\trequire_once(\"torrent_functions.php\");\n\t}\n\telse\n\t{\n\t\techo errorMessage() . \"There were some errors. Check if this torrent has been added previously.</p>\\n\";\n\t\t//delete torrent file if it doesn't exist in database\n\t\t$query = \"SELECT COUNT(*) FROM \".$prefix.\"summary WHERE info_hash = '$hash'\";\n\t\t$results = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\n\t\t$data = mysql_fetch_row($results);\n\t\tif ($data[0] == 0)\n\t\t{\n\t\t\tif (file_exists(\"torrents/\" . $_FILES['torrent']['name']))\n\t\t\t\tunlink(\"torrents/\" . $_FILES['torrent']['name']);\n\t\t}\n\t\t//make torrent file readable by all\n\t\tchmod(\"torrents/\" . $filename . \".torrent\", 0644);\n\t\tendOutput();\n\t}\n}\n\nfunction endOutput() \n{\n\trequire (\"config.php\");\n\t$tracker_url = $website_url . substr($_SERVER['PHP_SELF'], 0, -15) . $announceurl;\n\t?>\n\t<p align=\"right\"><a href=\"./docs/help.html\"><img src=\"images/help.png\" border=\"0\" class=\"icon\" alt=\"Help\" title=\"Help\" /></a><a href=\"./docs/help.html\">Help</a></p>\n\t<div class=\"center\">\n\t<h1>Add Torrent to Tracker Database</h1>\n\t<h3>Tracker URL: <?php echo $tracker_url;?></h3>\n\t<form enctype=\"multipart/form-data\" method=\"post\" action=\"<?php echo htmlentities($_SERVER['PHP_SELF']); ?>\">\n\t<table>\n\t<tr>\n\t\t<td class=\"right\">Torrent file:</td>\n\t\t<td class=\"left\"><?php\n\t\tif (function_exists(\"sha1\"))\n\t\t\techo \"<input type=\\\"file\\\" name=\\\"torrent\\\" size=\\\"50\\\"/>\";\n\t\telse\n\t\t\techo '<i>File uploading not available - no SHA1 function.</i>';\n\t\t?></td>\n\t</tr>\n\t<tr><td colspan=\"2\"><hr></td></tr>\n\t<tr>\t\n\t<td class=\"center\" colspan=\"2\"><input type=\"checkbox\" name=\"httpseed\" value=\"enabled\">Use BitTornado HTTP seeding specification (optional)</td>\n\t</tr>\n\t<tr>\n\t<td class=\"right\">Relative location of file or directory:<br>e.g. ../../files/file.zip</td>\n\t<td class=\"left\"><input type=\"text\" name=\"relative_path\" size=\"70\"/></td>\n\t</tr>\n\t<tr><td colspan=\"2\"><hr></td></tr>\n\t<tr>\n\t<td class=\"center\" colspan=\"2\"><input type=\"checkbox\" name=\"getrightseed\" value=\"enabled\">Use GetRight HTTP seeding specification (optional)</td>\n\t</tr>\n\t<tr>\n\t<td class=\"right\">FTP/HTTP URL of file or directory:<br>e.g. http://yourwebsite.com/file.zip</td>\n\t<td class=\"left\"><input type=\"text\" name=\"httpftplocation\" size=\"70\"/></td>\n\t</tr>\n\t<tr><td colspan=\"2\"><hr></td></tr>\n\t<?php if (function_exists(\"sha1\")) \n\t\techo \"<tr><td class=\\\"center\\\" colspan=\\\"2\\\"><input type=\\\"checkbox\\\" name=\\\"autoset\\\" value=\\\"enabled\\\" checked=\\\"checked\\\" /> Fill in fields below automatically using data from the torrent file.</td></tr>\\n\";\n\t?>\n\t<tr>\n\t\t<td class=\"right\">Info Hash:</td>\n\t\t<td class=\"left\"><input type=\"text\" name=\"hash\" size=\"40\"/></td>\n\t</tr>\n\t<tr>\n\t\t<td class=\"right\">File name (optional): </td>\n\t\t<td class=\"left\"><input type=\"text\" name=\"filename\" size=\"60\" maxlength=\"200\"/></td>\n\t</tr>\n\t<tr>\n\t\t<td class=\"right\">Torrent's URL (optional): </td>\n\t\t<td class=\"left\"><input type=\"text\" name=\"url\" size=\"60\" maxlength=\"200\"/></td>\n\t</tr>\n\t<tr><td colspan=\"2\"><hr></td></tr>\n\t<tr>\n\t\t<td class=\"center\" colspan=\"2\"><input type=\"submit\" value=\"Add Torrent to Database\"/> - <input type=\"reset\" value=\"Clear Settings\"/></td>\n\t</tr>\n\t</table>\n\t<br>\n\t<input type=\"hidden\" name=\"username\" value=\"<?php echo $_POST['username']; ?>\"/>\n\t<input type=\"hidden\" name=\"password\" value=\"<?php echo $_POST['password']; ?>\"/>\n\t</form>\n\t<a href=\"index.php\"><img src=\"images/stats.png\" border=\"0\" class=\"icon\" alt=\"Tracker Statistics\" title=\"Tracker Statistics\" /></a><a href=\"index.php\">Return to Statistics Page</a><br>\n\t</div>\n\t</body></html>\n\t<?php \t\n\t// Still in function endOutput()\n\texit;\n}\n?>\n", "<?php\r\nrequire (\"config.php\");\r\nrequire_once (\"funcsv2.php\");\r\n//Check session\r\nsession_start();\r\n\r\nif (!$_SESSION['admin_logged_in'])\r\n{\r\n\t//check fails\r\n\theader(\"Location: authenticate.php?status=session\");\r\n\texit();\r\n}\r\n?>\r\n\r\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\r\n\r\n<html>\r\n<head>\r\n\t<title>Tracker User Statistics</title>\r\n\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\" />\r\n\t<link rel=\"stylesheet\" href=\"./css/style.css\" type=\"text/css\" />\r\n</head>\r\n<body>\r\n<h1>Tracker User Statistics</h1>\r\n\r\n<form action=\"<?php echo htmlentities($_SERVER['PHP_SELF']);?>\" method=\"POST\">\r\nFilename Search:<input type=\"text\" name=\"filename_search\" size=\"40\"<?php if (isset($_POST[\"filename_search\"]))echo \" value=\\\"\" . $_POST[\"filename_search\"] . \"\\\"\";?>>\r\n<input type=\"submit\" value=\"Search\">\r\n</form>\r\n<br>\r\n\r\n<?php\r\nrequire_once (\"config.php\");\r\nrequire_once (\"funcsv2.php\");\r\n\r\n//connect to database and grab each torrent in database\r\nif ($GLOBALS[\"persist\"])\r\n\t$db = mysql_pconnect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\r\nelse\r\n\t$db = mysql_connect($dbhost, $dbuser, $dbpass) or die(errorMessage() . \"Tracker error: can't connect to database - \" . mysql_error() . \"</p>\");\r\nmysql_select_db($database) or die(errorMessage() . \"Tracker error: can't open database $database - \" . mysql_error() . \"</p>\");\r\n\r\n//Display search information\r\nif (isset($_POST[\"filename_search\"]) && $_POST[\"filename_search\"] != \"\")\r\n{\r\n\techo \"<h2 align=\\\"center\\\">Search Results:</h2>\";\r\n\t$query = \"SELECT * FROM \".$prefix.\"summary LEFT JOIN \".$prefix.\"namemap ON \".$prefix.\"summary.info_hash = \".$prefix.\"namemap.info_hash WHERE \".$prefix.\"namemap.filename REGEXP \\\"$_POST[filename_search]\\\" ORDER BY \".$prefix.\"namemap.filename\";\r\n}\r\nelse //display everything\r\n{\r\n\t$scriptname = htmlentities($_SERVER['PHP_SELF']) . \"?\";\r\n\t\r\n\tif (!isset($_GET[\"activeonly\"])) \r\n\t\techo \"<a href=\\\"$scriptname\" . \"activeonly=yes\\\">Show only torrents with seeders/leechers</a>\\n\";\r\n\telse\r\n\t{\r\n\t\techo \"<a href=\\\"$scriptname\\\">Show all torrents</a>\\n\";\r\n\t\t$scriptname = $scriptname . \"activeonly=yes&\";\t\r\n\t}\r\n\r\n\tif (isset($_GET[\"activeonly\"]))\r\n\t\t$where = \" WHERE leechers+seeds > 0\";\r\n\telse\r\n\t\t$where = \" \";\r\n\t\r\n\t$query = \"SELECT COUNT(*) FROM \".$prefix.\"summary $where\";\r\n\t$results = mysql_query($query);\r\n\t$res = mysql_result($results,0,0);\r\n\t\r\n\techo \"<p align='center'>Page: \\n\";\r\n\t$count = 0;\r\n\t$page = 1;\r\n\twhile($count < $res)\r\n\t{\r\n\t\tif (isset($_GET[\"page_number\"]) && $page == $_GET[\"page_number\"])\r\n\t\t\techo \"<b><a href=\\\"$scriptname\" . \"page_number=$page\\\">($page)</a></b>-\\n\";\r\n\t\telse if (!isset($_GET[\"page_number\"]) && $page == 1)\r\n\t\t\techo \"<b><a href=\\\"$scriptname\" . \"page_number=$page\\\">($page)</a></b>-\\n\";\r\n\t\telse\r\n\t\t\techo \"<a href=\\\"$scriptname\" . \"page_number=$page\\\">$page</a>-\\n\";\r\n\t\t$page++;\r\n\t\t$count = $count + ($GLOBALS[\"statspagelimitspecify\"]);\r\n\t}\r\n\techo \"</p>\\n\";\r\n\t\r\n\tif (!isset($_GET[\"page_number\"]))\r\n\t\t$query = \"SELECT * FROM \".$prefix.\"summary LEFT JOIN \".$prefix.\"namemap ON \".$prefix.\"summary.info_hash = \".$prefix.\"namemap.info_hash $where ORDER BY \".$prefix.\"namemap.filename LIMIT 0,${GLOBALS['statspagelimitspecify']}\";\r\n\telse\r\n\t{\r\n\t\t$page_limit = ($_GET[\"page_number\"] - 1) * ($GLOBALS[\"statspagelimitspecify\"]);\r\n\t\t$query = \"SELECT * FROM \".$prefix.\"summary LEFT JOIN \".$prefix.\"namemap ON \".$prefix.\"summary.info_hash = \".$prefix.\"namemap.info_hash $where ORDER BY \".$prefix.\"namemap.filename LIMIT $page_limit,${GLOBALS['statspagelimitspecify']}\";\r\n\t}\r\n}\r\n\r\n$results = mysql_query($query) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\r\n\r\nwhile ($data = mysql_fetch_row($results))\r\n{\r\n\t$xhash = \"x\" . $data[0];\r\n\t$query2 = \"SELECT * FROM \".$prefix.\"$xhash\";\r\n\t$results2 = mysql_query($query2) or die(errorMessage() . \"Can't do SQL query - \" . mysql_error() . \"</p>\");\r\n\r\n\tif (mysql_num_rows($results2) == 0 && isset($_GET[\"activeonly\"]))\r\n\t\tbreak;\r\n\telse\r\n\t{\r\n\t\techo \"<hr><table>\\n\";\r\n\t\techo \"<tr><th>Info Hash</th><th>Filename</th><th>URL</th><th>File Size</th><th>Publication Date</th></tr>\\n\";\r\n\t\techo \"<tr><td>\" . $data[0] . \"</td><td>\" . $data[11] . \"</td><td>\\n\";\r\n\t\tif (Substr($data[12], 0, 7) == \"http://\")\r\n\t\t\techo \"<a href=\\\"\" . $data[12] . \"\\\">\" . $data[12] . \"</a>\\n\";\r\n\t\telse\r\n\t\t\techo $data[12];\r\n\t\techo \"</td><td>\" . bytesToString($data[13]) . \"</td>\\n\";\r\n\t\techo \"<td>\" . $data[14] . \"</td></tr>\\n\";\r\n\t\techo \"</table>\\n\";\r\n\t}\r\n\r\n\techo \"<table>\\n\";\r\n\techo \"<tr><th class=\\\"subheader\\\">IP Address</th><th class=\\\"subheader\\\">Data Left to Download</th><th class=\\\"subheader\\\" width=200>Percent Finished</th><th class=\\\"subheader\\\">Port</th><th class=\\\"subheader\\\">Last Update</th><th class=\\\"subheader\\\">NAT User</th></tr>\\n\";\r\n\twhile ($data2 = mysql_fetch_row($results2))\r\n\t{\r\n\t\t//grab information on each user\r\n\t\techo \"<tr><td>\" . $data2[2] . \"</td>\\n\";\r\n\t\techo \"<td>\" . bytesToString($data2[1]) . \"</td>\\n\";\r\n\r\n\t\t//calculate percent done for user\r\n\t\t$percent_done = 1.00;\r\n\t\tif ($data2[1] != 0) //only run calculation if they are still downloading\r\n\t\t{\r\n\t\t\t$size_in_bytes = $data[13];\r\n\t\t\tif ($size_in_bytes == 0) //thou shalt not divide by zero\r\n\t\t\t\t$percent_done = 0;\r\n\t\t\telse\r\n\t\t\t\t$percent_done = round(($size_in_bytes - $data2[1]) / $size_in_bytes, 3);\r\n\t\t}\r\n\r\n\t\t?>\r\n\t\t<td>\r\n\t\t<table class=\"percentages\" cellspacing=\"0\">\r\n\t\t<tr>\r\n\t\t<td align=\"right\" class=\"percent\" width=\"<?php echo round($percent_done * 200, 0); ?>\" height=\"15\">\r\n\t\t<?php if ($percent_done > .5) echo $percent_done * 100 . \"%\"; ?>\r\n\t\t</td>\r\n\t\t<td align=\"left\" class=\"percentleft\" width=\"<?php echo 200 - round($percent_done * 200, 0); ?>\" height=\"15\">\r\n\t\t<?php if ($percent_done <= .5) echo $percent_done * 100 . \"%\"; ?>\t\t\r\n\t\t</td>\r\n\t\t</tr>\r\n\t\t</table>\r\n\t\t</td>\r\n\t\t<?php\r\n\t\techo \"<td>\" . $data2[3] . \"</td>\\n\"; //port\r\n\t\techo \"<td>\" . date('g:ia m-d-Y', $data2[5]) . \"</td>\\n\"; //last time check-in\r\n\t\techo \"<td>\" . $data2[7] . \"</td>\\n\"; //NAT user\r\n\t\techo \"</tr>\\n\";\r\n\t}\r\n\techo \"</table><br>\\n\";\r\n}\r\necho \"<hr>\";\r\nif (!isset($_POST[\"filename_search\"]))\r\n{\r\n\techo \"<p align='center'>Page: \\n\";\r\n\t$count = 0;\r\n\t$page = 1;\r\n\twhile($count < $res)\r\n\t{\r\n\tif (isset($_GET[\"page_number\"]) && $page == $_GET[\"page_number\"])\r\n\t\techo \"<b><a href=\\\"$scriptname\" . \"page_number=$page\\\">($page)</a></b>-\\n\";\r\n\telse if (!isset($_GET[\"page_number\"]) && $page == 1)\r\n\t\techo \"<b><a href=\\\"$scriptname\" . \"page_number=$page\\\">($page)</a></b>-\\n\";\r\n\telse\r\n\t\techo \"<a href=\\\"$scriptname\" . \"page_number=$page\\\">$page</a>-\\n\";\r\n\t$page++;\r\n\t$count = $count + ($GLOBALS[\"statspagelimitspecify\"]);\r\n\t}\r\n\techo \"</p>\\n\";\r\n}\r\n?>\r\n\r\n<a href=\"admin.php\"><img src=\"images/admin.png\" border=\"0\" class=\"icon\" alt=\"Admin Page\" title=\"Admin Page\" /></a><a href=\"admin.php\">Return to Admin Page</a>\r\n</body>\r\n</html>\r\n"], "filenames": ["DumpTorrentCGI.php", "batch_upload.php", "css.php", "deleter.php", "edit_database.php", "editconfig.php", "install.php", "newtorrents.php", "statistics.php"], "buggy_code_start_loc": [27, 193, 139, 39, 54, 27, 95, 237, 26], "buggy_code_end_loc": [28, 194, 249, 40, 69, 28, 601, 238, 52], "fixing_code_start_loc": [27, 193, 139, 39, 54, 27, 95, 237, 26], "fixing_code_end_loc": [28, 194, 249, 40, 69, 28, 601, 238, 52], "type": "CWE-79", "message": "A vulnerability, which was classified as problematic, has been found in ahmyi RivetTracker. This issue affects some unknown processing. The manipulation of the argument $_SERVER['PHP_SELF'] leads to cross site scripting. The attack may be initiated remotely. The name of the patch is f053c5cc2bc44269b0496b5f275e349928a92ef9. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-217271.", "other": {"cve": {"id": "CVE-2012-10003", "sourceIdentifier": "cna@vuldb.com", "published": "2023-01-03T12:15:10.117", "lastModified": "2023-01-10T17:17:51.723", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, has been found in ahmyi RivetTracker. This issue affects some unknown processing. The manipulation of the argument $_SERVER['PHP_SELF'] leads to cross site scripting. The attack may be initiated remotely. The name of the patch is f053c5cc2bc44269b0496b5f275e349928a92ef9. It is recommended to apply a patch to fix this issue. The associated identifier of this vulnerability is VDB-217271."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 3.5, "baseSeverity": "LOW"}, "exploitabilityScore": 2.1, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.0}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:rivettracker_project:rivettracker:*:*:*:*:*:*:*:*", "versionEndExcluding": "2012-03-03", "matchCriteriaId": "55E334E2-309B-4826-A549-2CF3CCC483A2"}]}]}], "references": [{"url": "https://github.com/ahmyi/rivettracker/commit/f053c5cc2bc44269b0496b5f275e349928a92ef9", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/ahmyi/rivettracker/pull/1", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217271", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory", "VDB Entry"]}, {"url": "https://vuldb.com/?id.217271", "source": "cna@vuldb.com", "tags": ["Permissions Required", "Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/ahmyi/rivettracker/commit/f053c5cc2bc44269b0496b5f275e349928a92ef9"}}