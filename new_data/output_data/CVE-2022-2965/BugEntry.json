{"buggy_code": ["<?php\n/**********************************************************************\n\tCopyright (C) NotrinosERP.\n\tReleased under the terms of the GNU General Public License, GPL, \n\tas published by the Free Software Foundation, either version 3 \n\tof the License, or (at your option) any later version.\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  \n\tSee the License here <http://www.gnu.org/licenses/gpl-3.0.html>.\n***********************************************************************/\nif (!isset($path_to_root) || isset($_GET['path_to_root']) || isset($_POST['path_to_root']))\n\tdie(_('Restricted access'));\ninclude_once($path_to_root.'/includes/ui.inc');\ninclude_once($path_to_root.'/includes/page/header.inc');\n\n$js = \"<script>\n\tfunction defaultCompany() {\n\t\tdocument.forms[0].company_login_name.options[\".user_company().\"].selected = true;\n\t}\n</script>\";\n\nadd_js_file('login.js');\n// Display demo user name and password within login form if allow_demo_mode option is true\nif ($SysPrefs->allow_demo_mode == true)\n\t$demo_text = _('Login as user: demouser and password: password');\nelse {\n\t$demo_text = _('Please login here');\n\tif (@$SysPrefs->allow_password_reset)\n\t\t$demo_text .= ' '._('or').\" <a href='\".$path_to_root.\"/index.php?reset=1'>\"._('request new password').\"</a>\";\n}\n\nif (check_faillog()) {\n\t$blocked = true;\n\n\t$js .= \"<script>setTimeout(function() {\n\t\tdocument.getElementsByName('SubmitUser')[0].disabled=0;\n\t\tdocument.getElementById('log_msg').innerHTML='$demo_text'}, 1000*\".$SysPrefs->login_delay.\");</script>\";\n\t$demo_text = '<span class=\"redfg\">'._('Too many failed login attempts.<br>Please wait a while or try later.').'</span>';\n}\nelseif ($_SESSION['wa_current_user']->login_attempt > 1)\n\t$demo_text = '<span class=\"redfg\">'._('Invalid password or username. Please, try again.').'</span>';\n\nflush_dir(user_js_cache());\nif (!isset($def_coy))\n\t$def_coy = 0;\n\n$def_theme = 'default';\n$login_timeout = $_SESSION['wa_current_user']->last_act;\n$title = $login_timeout ? _('Authorization timeout') : $SysPrefs->app_title.' '.$version.' - '._('Login');\n$encoding = isset($_SESSION['language']->encoding) ? $_SESSION['language']->encoding : 'iso-8859-1';\n$rtl = isset($_SESSION['language']->dir) ? $_SESSION['language']->dir : 'ltr';\n$onload = !$login_timeout ? \"onload='defaultCompany()'\" : '';\n\necho \"<!DOCTYPE html>\\n\";\necho \"<html dir='\".$rtl.\"' >\\n\";\necho \"<head profile=\\\"http://www.w3.org/2005/10/profile\\\"><title>\".$title.\"</title>\\n\";\necho \"<meta charset='\".$encoding.\"' >\\n\";\necho \"<meta name='viewport' content='width=device-width,initial-scale=1'>\";\necho \"<link href='\".$path_to_root.'/themes/'.$def_theme.\"/default.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.'/themes/'.$def_theme.\"/local_style/access.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.\"/libraries/fontawesome/css/all.min.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.\"/themes/default/images/favicon.ico' rel='icon' type='image/x-icon'> \\n\";\nsend_scripts();\n\nif (!$login_timeout)\n\techo $js;\n\necho \"</head>\\n\";\necho \"<body id='loginscreen' \".$onload.\">\\n\";\necho \"<table class='titletext'><tr><td>\".$title.\"</td></tr></table>\\n\";\n\t\ndiv_start('_page_body');\nbr(2);\nstart_form(false, $_SESSION['timeout']['uri'], 'loginform');\nstart_table(false, \"class='login'\");\nstart_row();\necho \"<td align='center' colspan=2>\";\nif (!$login_timeout) // logo\n\techo \"<a target='_blank' href='\".$SysPrefs->power_url.\"'><img src='\".$path_to_root.\"/themes/\".$def_theme.\"/images/notrinos_erp.png' alt='NotrinosERP' height='50' onload='fixPNG(this)' border='0' ></a>\";\nelse\n\techo \"<font size=5>\"._('Authorization timeout').\"</font>\";\necho \"</td>\\n\";\nend_row();\n\nif (!$login_timeout)\n\ttable_section_title(_('Version').' '.$version.'   Build '.$SysPrefs->build_version.' - '._('Login'));\n\necho \"<tr><td colspan='2'></td></tr>\";\n\n$value = $login_timeout ? $_SESSION['wa_current_user']->loginname : ($SysPrefs->allow_demo_mode ? 'demouser' : '');\n\necho \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-user' title='\"._('User').\"'></i>\";\necho \"<input required class='input' id='user' name='user_name_entry_field' type='text' placeholder='\"._('User name:').\"' value='$value'></div></td></tr>\";\n\n$password = $SysPrefs->allow_demo_mode ? 'password' : '';\n\necho \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-key' title='\"._('Password').\"'></i>\";\necho \"<input required class='input' id='pass' name='password' type='password' placeholder='\"._('Password:').\"' value='$password'></div></td></tr>\";\n\nif ($login_timeout)\n\thidden('company_login_name', user_company());\nelse {\n\t$coy =  user_company();\n\tif (!isset($coy))\n\t\t$coy = $def_coy;\n\techo \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-building' title='\"._('Company').\"'></i>\";\n\tif (!@$SysPrefs->text_company_selection) {\n\t\techo \"<select name='company_login_name'>\\n\";\n\t\tfor ($i = 0; $i < count($db_connections); $i++)\n\t\t\techo \"<option value=\".$i.' '.($i==$coy ? 'selected' : '').'>'.$db_connections[$i]['name'].'</option>';\n\t\techo \"</select>\\n\";\n\t}\n\telse\n\t\techo \"<input required type='text' name='company_login_nickname' placeholder='\"._('Company').\"'>\";\n\techo '</div></td></tr>';\n}; \nstart_row();\nlabel_cell($demo_text, \"colspan=2 align='center' id='log_msg'\");\nend_row();\n\nstart_row();\necho \"<input type='hidden' id=ui_mode name='ui_mode' value='\".!fallback_mode().\"' >\\n\";\necho \"<td colspan='2'><center><input type='submit' value='&nbsp;&nbsp;\"._('Login').\"&nbsp;&nbsp;&#8250;' name='SubmitUser'\".\" onclick='\".(in_ajax() ? 'retry();': 'set_fullmode();').\"'\".(isset($blocked) ? \" disabled\" : '').\" ></center></td>\\n\";\nend_row();\n\nend_table(1);\n\nforeach($_SESSION['timeout']['post'] as $p => $val) {\n\t// add all request variables to be resend together with login data\n\tif (!in_array($p, array('ui_mode', 'user_name_entry_field', 'password', 'SubmitUser', 'company_login_name')))\n\t\tif (!is_array($val))\n\t\t\techo \"<input type='hidden' name='\".$p.\"' value='\".$val.\"'>\";\n\t\telse\n\t\t\tforeach($val as $i => $v)\n\t\t\t\techo \"<input type='hidden' name='{$p}[$i]' value='$v'>\";\n}\nend_form(1);\n$Ajax->addScript(true, \"if (document.forms.length) document.forms[0].password.focus();\");\n\necho \"<script>\n\t//<![CDATA[\n\t\t<!--\n\t\tdocument.forms[0].user_name_entry_field.select();\n\t\tdocument.forms[0].user_name_entry_field.focus();\n\t\t//-->\n\t//]]>\n</script>\";\ndiv_end();\necho \"<table class='bottomBar'>\\n\";\necho '<tr>';\nif (isset($_SESSION['wa_current_user'])) \n\t$date = Today().' | '.Now();\nelse\t\n\t$date = date('m/d/Y').' | '.date('h.i am');\necho \"<td class='bottomBarCell'>\".$date.\"</td>\\n\";\necho \"</tr></table>\\n\";\necho \"<table class='footer'>\\n\";\necho \"<tr>\\n\";\necho \"<td><a target='_blank' href='\".$SysPrefs->power_url.\"' tabindex='-1'>\".$SysPrefs->app_title.' '.$version.' - '._('Theme:').' '.$def_theme.\"</a></td>\\n\";\necho \"</tr>\\n\";\necho \"<tr>\\n\";\necho \"<td><a target='_blank' href='\".$SysPrefs->power_url.\"' tabindex='-1'>\".$SysPrefs->power_by.\"</a></td>\\n\";\necho \"</tr>\\n\";\necho \"</table><br><br>\\n\";\necho \"</body></html>\\n\";\n", "<?php\n/**********************************************************************\n\tCopyright (C) NotrinosERP.\n\tReleased under the terms of the GNU General Public License, GPL, \n\tas published by the Free Software Foundation, either version 3 \n\tof the License, or (at your option) any later version.\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  \n\tSee the License here <http://www.gnu.org/licenses/gpl-3.0.html>.\n***********************************************************************/\nif (!isset($path_to_root) || isset($_GET['path_to_root']) || isset($_POST['path_to_root']))\n\tdie(_('Restricted access'));\ninclude_once($path_to_root.'/includes/ui.inc');\ninclude_once($path_to_root.'/includes/page/header.inc');\n\n$js = \"<script>\nfunction defaultCompany() {\n\tdocument.forms[0].company_login_name.options[\".user_company().\"].selected = true;\n}\n</script>\";\nadd_js_file('login.js');\n\nif (!isset($def_coy))\n\t$def_coy = 0;\n$def_theme = 'default';\n\n$login_timeout = $_SESSION['wa_current_user']->last_act;\n\n$title = $SysPrefs->app_title.' '.$version.' - '._('Password reset');\n$encoding = isset($_SESSION['language']->encoding) ? $_SESSION['language']->encoding : 'iso-8859-1';\n$rtl = isset($_SESSION['language']->dir) ? $_SESSION['language']->dir : 'ltr';\n$onload = !$login_timeout ? \"onload='defaultCompany()'\" : '';\n\necho \"<!DOCTYPE html>\\n\";\necho \"<html dir='\".$rtl.\"' >\\n\";\necho \"<head profile=\\\"http://www.w3.org/2005/10/profile\\\"><title>\".$title.\"</title>\\n\";\necho \"<meta charset='\".$encoding.\"' >\\n\";\necho \"<meta name='viewport' content='width=device-width,initial-scale=1'>\";\necho \"<link href='\".$path_to_root.'/themes/'.$def_theme.\"/default.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.'/themes/'.$def_theme.\"/local_style/access.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.\"/libraries/fontawesome/css/all.min.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.\"/themes/default/images/favicon.ico' rel='icon' type='image/x-icon'> \\n\";\nsend_scripts();\necho $js;\necho \"</head>\\n\";\n\necho \"<body id='loginscreen' \".$onload.\">\\n\";\n\necho \"<table class='titletext'><tr><td>\".$title.\"</td></tr></table>\\n\";\n\t\ndiv_start('_page_body');\nbr(2);\nstart_form(false, @$_SESSION['timeout']['uri'], 'resetform');\nstart_table(false, \"class='login'\");\nstart_row();\necho \"<td align='center' colspan=2>\";\necho \"<a target='_blank' href='\".$SysPrefs->power_url.\"'><img src='\".$path_to_root.'/themes/'.$def_theme.\"/images/notrinos_erp.png' alt='NotrinosERP' height='50' onload='fixPNG(this)' border='0' ></a>\";\necho \"</td>\\n\";\nend_row();\n\necho \"<input type='hidden' id=ui_mode name='ui_mode' value='\".fallback_mode().\"' >\\n\";\ntable_section_title(_('Version').' '.$version.\"   Build \".$SysPrefs->build_version.' - '._('Password reset'));\necho \"<tr><td colspan='2'></td></tr>\";\necho \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-envelope' title='\"._('Email').\"'></i>\";\necho \"<input required class='input' id='email' name='email_entry_field' type='text' placeholder='\"._('Email:').\"'></div></td></tr>\";\n\n$coy =  user_company();\nif (!isset($coy))\n\t$coy = $def_coy;\necho \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-building' title='\"._('Company').\"'></i>\";\nif (!@$SysPrefs->text_company_selection) {\n\techo \"<select name='company_login_name'>\\n\";\n\tfor ($i = 0; $i < count($db_connections); $i++)\n\t\techo \"<option value=\".$i.' '.($i==$coy ? 'selected' : '').'>'.$db_connections[$i]['name'].'</option>';\n\techo \"</select>\\n\";\n}\nelse\n\techo \"<input required type='text' name='company_login_nickname' placeholder='\"._('Company').\"'>\";\necho '</div></td></tr>';\n\nstart_row();\nlabel_cell('Please enter your e-mail', \"colspan=2 align='center' id='log_msg'\");\nend_row();\n\nstart_row();\necho \"<td colspan='2'><center><input type='submit' value='&nbsp;&nbsp;\"._('Send password').\"&nbsp;&nbsp;&#8250;' name='SubmitReset' onclick='set_fullmode();'></center></td>\\n\";\nend_row();\nend_table(1);\n\nend_form(1);\n$Ajax->addScript(true, \"document.forms[0].password.focus();\");\n\necho \"<script>\n//<![CDATA[\n\t<!--\n\tdocument.forms[0].email_entry_field.select();\n\tdocument.forms[0].email_entry_field.focus();\n\t//-->\n//]]>\n</script>\";\ndiv_end();\necho \"<table class='bottomBar'>\\n\";\necho \"<tr>\";\n\nif (isset($_SESSION['wa_current_user'])) \n\t$date = Today().' | '.Now();\nelse\t\n\t$date = date('m/d/Y').' | '.date(\"h.i am\");\n\necho \"<td class='bottomBarCell'>\".$date.\"</td>\\n\";\necho \"</tr></table>\\n\";\necho \"<table class='footer'>\\n\";\necho \"<tr>\\n\";\necho \"<td><a target='_blank' href='\".$SysPrefs->power_url.\"' tabindex='-1'>\".$SysPrefs->app_title.' '.$version.' - ' ._('Theme:').' '.$def_theme.\"</a></td>\\n\";\necho \"</tr>\\n\";\necho \"<tr>\\n\";\necho \"<td><a target='_blank' href='\".$SysPrefs->power_url.\"' tabindex='-1'>\".$SysPrefs->power_by.\"</a></td>\\n\";\necho \"</tr>\\n\";\necho \"</table><br><br>\\n\";\necho \"</body></html>\\n\";\n", "<?php\n/**********************************************************************\n\tCopyright (C) FrontAccounting, LLC.\n\tReleased under the terms of the GNU General Public License, GPL, \n\tas published by the Free Software Foundation, either version 3 \n\tof the License, or (at your option) any later version.\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  \n\tSee the License here <http://www.gnu.org/licenses/gpl-3.0.html>.\n***********************************************************************/\n/*\n\tIf no context is set current page/menu screen is selected.\n*/\nfunction help_url($context=null) {\n\n\tglobal $SysPrefs, $help_context;\n\n\t$country = $_SESSION['language']->code;\n\t$clean = 0;\n\t\n\tif ($context!=null)\n\t\t$help_page_url = $context;\n\telseif (isset($help_context))\n\t\t$help_page_url = $help_context;\n\telse {// main menu\n\t\t$app = $_SESSION['sel_app'];\n\t\t$help_page_url = $_SESSION['App']->applications[$app]->help_context;\n\t\t$clean = 1;\n\t}\n\n\tif (@$SysPrefs->old_style_help)\n\t\t$help_page_url = _($help_page_url);\n\n\tif ($clean)\n\t\t$help_page_url = access_string($help_page_url, true);\n\n\treturn html_specials_encode(\n\t\t$SysPrefs->help_base_url\n\t\t.urlencode(strtr(ucwords($help_page_url), array(' '=>'', '/'=>'', '&'=>'And')))\n\t\t.'&ctxhelp=1&lang='.$country);\n}\n\nfunction send_css($css = '') {\n\tglobal $css_files;\n\n\tinit_css();\n\n\tforeach ($css_files as $css_file) {\n\t\techo \"<link href='\".$css_file.\"' rel='stylesheet' type='text/css'> \\n\";\n\t}\n\tif ($css)\n\t\techo \"<link href='\".$css.\"' rel='stylesheet' type='text/css'> \\n\";\n}\n\nfunction send_scripts() {\n\tglobal $SysPrefs, $path_to_root, $js_static, $js_path, $js_userlib;\n\n\t$js ='';\n\tforeach($js_static as $jsfile) {\n\t\t$basename = basename($jsfile);\n\t\t$fpath = user_js_cache().'/'.$basename;\n\t\t// compress also static files\n\t\tif (!file_exists($fpath) || $SysPrefs->go_debug) {\n\t\t\t// don't need to compress minified files\n\t\t\tif(strpos($basename, '.min.js' ) !== false)\n\t\t\t\tcopy($js_path.$jsfile, $fpath);\n\t\t\telse\n\t\t\t\tcache_js_file($fpath, file_get_contents($js_path.$jsfile));\n\t\t}\n\n\t\t$js .= '<script src=\"'.$fpath.'\"></script>';\n\t}\n\tforeach($js_userlib as $jsfile) {\n\t\t$js .= '<script src=\"'.$jsfile.'\"></script>';\n\t}\n\n\techo $js;\n}\n\nfunction page_header($title, $no_menu=false, $is_index=false, $onload='', $js='', $css='') {\n\t// titles and screen header\n\tglobal $path_to_root, $SysPrefs, $db_connections;\n\n\tif (in_ajax() || isset($_POST['REP_ID']))\n\t\treturn; // just for speed up\n\n\t$theme = user_theme();\n\n\tif ($SysPrefs->help_base_url != null && $SysPrefs->use_popup_windows && $js == '') {\n\t\tif (!function_exists('get_js_open_window'))\n\t\t\tinclude_once($path_to_root.'/includes/ui/ui_view.inc');\n\t\t\n\t\tadd_js_source(get_js_open_window(900, 500));\n\t}\n\tif ($js != '')\n\t\tadd_js_source($js);\n\n\tif (!isset($no_menu))\n\t\t$no_menu = false;\n\t\n\tif (isset($_SESSION['App']) && is_object($_SESSION['App']) && isset($_SESSION['App']->selected_application) && $_SESSION['App']->selected_application != '')\n\t\t$sel_app = $_SESSION['App']->selected_application;\n\telseif (isset($_SESSION['sel_app']) && $_SESSION['sel_app'] != '')\n\t\t$sel_app = $_SESSION['sel_app'];\n\telse\n\t\t$sel_app = user_startup_tab();\n\t\n\t$_SESSION['sel_app'] = $sel_app;\n\n\t// When startup tab for current user was set to already \n\t// removed/inactivated extension module select Sales tab as default.\n\tif (isset($_SESSION['App']) && is_object($_SESSION['App']))\n\t\t$_SESSION['App']->selected_application = isset($_SESSION['App']->applications[$sel_app]) ? $sel_app : 'orders';\n\n\t$page_header_args = func_get_args();\n\tif(isset($db_connections))\t// skip before installation\n\t\thook_invoke_all('pre_header', $page_header_args);\n\n\t$encoding = $_SESSION['language']->encoding;\n\n\tif (!headers_sent())\n\t\theader(\"Content-type: text/html; charset=$encoding\");\n\t\n\techo \"<!DOCTYPE html>\\n\";\n\techo \"<html dir='\" . $_SESSION['language']->dir . \"' >\\n\";\n\techo \"<head profile=\\\"http://www.w3.org/2005/10/profile\\\"><title>\".$title.\"</title>\";\n\tif (strpos($_SERVER['HTTP_USER_AGENT'], 'Trident/7.0; rv:11.0') != -1) // IE 11 doesn't work with input file type in form.\n\t\techo \"<meta http-equiv='X-UA-Compatible' content='IE=10'>\\n\";\n\techo \"<meta charset='\".$encoding.\"'>\";\n\techo \"<meta name='viewport' content='width=device-width,initial-scale=1'>\";\n\techo \"<link href='\".$path_to_root.\"/themes/default/images/favicon.ico' rel='icon' type='image/x-icon'> \\n\";\n\n\tsend_css($css);\n\n\tsend_scripts();\n\n\techo \"</head> \\n\";\n\tif ($onload == '')\n\t\techo '<body>';\n\telse\n\t\techo \"<body onload=\\\"$onload\\\">\";\n\n\tinclude_once($path_to_root.'/themes/'.$theme.'/renderer.php');\n\t$rend = new renderer();\n\t$rend->menu_header($title, $no_menu, $is_index);\n\terror_box();\n}"], "fixing_code": ["<?php\n/**********************************************************************\n\tCopyright (C) NotrinosERP.\n\tReleased under the terms of the GNU General Public License, GPL, \n\tas published by the Free Software Foundation, either version 3 \n\tof the License, or (at your option) any later version.\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  \n\tSee the License here <http://www.gnu.org/licenses/gpl-3.0.html>.\n***********************************************************************/\nif (!isset($path_to_root) || isset($_GET['path_to_root']) || isset($_POST['path_to_root']))\n\tdie(_('Restricted access'));\ninclude_once($path_to_root.'/includes/ui.inc');\ninclude_once($path_to_root.'/includes/page/header.inc');\n\n$js = \"<script>\n\tfunction defaultCompany() {\n\t\tdocument.forms[0].company_login_name.options[\".user_company().\"].selected = true;\n\t}\n</script>\";\n\nadd_js_file('login.js');\n// Display demo user name and password within login form if allow_demo_mode option is true\nif ($SysPrefs->allow_demo_mode == true)\n\t$demo_text = _('Login as user: demouser and password: password');\nelse {\n\t$demo_text = _('Please login here');\n\tif (@$SysPrefs->allow_password_reset)\n\t\t$demo_text .= ' '._('or').\" <a href='\".$path_to_root.\"/index.php?reset=1'>\"._('request new password').\"</a>\";\n}\n\nif (check_faillog()) {\n\t$blocked = true;\n\n\t$js .= \"<script>setTimeout(function() {\n\t\tdocument.getElementsByName('SubmitUser')[0].disabled=0;\n\t\tdocument.getElementById('log_msg').innerHTML='$demo_text'}, 1000*\".$SysPrefs->login_delay.\");</script>\";\n\t$demo_text = '<span class=\"redfg\">'._('Too many failed login attempts.<br>Please wait a while or try later.').'</span>';\n}\nelseif ($_SESSION['wa_current_user']->login_attempt > 1)\n\t$demo_text = '<span class=\"redfg\">'._('Invalid password or username. Please, try again.').'</span>';\n\nflush_dir(user_js_cache());\nif (!isset($def_coy))\n\t$def_coy = 0;\n\n$def_theme = 'default';\n$login_timeout = $_SESSION['wa_current_user']->last_act;\n$title = $login_timeout ? _('Authorization timeout') : $SysPrefs->app_title.' '.$version.' - '._('Login');\n$encoding = isset($_SESSION['language']->encoding) ? $_SESSION['language']->encoding : 'iso-8859-1';\n$rtl = isset($_SESSION['language']->dir) ? $_SESSION['language']->dir : 'ltr';\n$onload = !$login_timeout ? \"onload='defaultCompany()'\" : '';\n\nif (!headers_sent())\n\theader(\"X-Frame-Options: SAMEORIGIN\");\n\necho \"<!DOCTYPE html>\\n\";\necho \"<html dir='\".$rtl.\"' >\\n\";\necho \"<head profile=\\\"http://www.w3.org/2005/10/profile\\\"><title>\".$title.\"</title>\\n\";\necho \"<meta charset='\".$encoding.\"' >\\n\";\necho \"<meta name='viewport' content='width=device-width,initial-scale=1'>\";\necho \"<link href='\".$path_to_root.'/themes/'.$def_theme.\"/default.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.'/themes/'.$def_theme.\"/local_style/access.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.\"/libraries/fontawesome/css/all.min.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.\"/themes/default/images/favicon.ico' rel='icon' type='image/x-icon'> \\n\";\nsend_scripts();\n\nif (!$login_timeout)\n\techo $js;\n\necho \"</head>\\n\";\necho \"<body id='loginscreen' \".$onload.\">\\n\";\necho \"<table class='titletext'><tr><td>\".$title.\"</td></tr></table>\\n\";\n\t\ndiv_start('_page_body');\nbr(2);\nstart_form(false, $_SESSION['timeout']['uri'], 'loginform');\nstart_table(false, \"class='login'\");\nstart_row();\necho \"<td align='center' colspan=2>\";\nif (!$login_timeout) // logo\n\techo \"<a target='_blank' href='\".$SysPrefs->power_url.\"'><img src='\".$path_to_root.\"/themes/\".$def_theme.\"/images/notrinos_erp.png' alt='NotrinosERP' height='50' onload='fixPNG(this)' border='0' ></a>\";\nelse\n\techo \"<font size=5>\"._('Authorization timeout').\"</font>\";\necho \"</td>\\n\";\nend_row();\n\nif (!$login_timeout)\n\ttable_section_title(_('Version').' '.$version.'   Build '.$SysPrefs->build_version.' - '._('Login'));\n\necho \"<tr><td colspan='2'></td></tr>\";\n\n$value = $login_timeout ? $_SESSION['wa_current_user']->loginname : ($SysPrefs->allow_demo_mode ? 'demouser' : '');\n\necho \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-user' title='\"._('User').\"'></i>\";\necho \"<input required class='input' id='user' name='user_name_entry_field' type='text' placeholder='\"._('User name:').\"' value='$value'></div></td></tr>\";\n\n$password = $SysPrefs->allow_demo_mode ? 'password' : '';\n\necho \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-key' title='\"._('Password').\"'></i>\";\necho \"<input required class='input' id='pass' name='password' type='password' placeholder='\"._('Password:').\"' value='$password'></div></td></tr>\";\n\nif ($login_timeout)\n\thidden('company_login_name', user_company());\nelse {\n\t$coy =  user_company();\n\tif (!isset($coy))\n\t\t$coy = $def_coy;\n\techo \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-building' title='\"._('Company').\"'></i>\";\n\tif (!@$SysPrefs->text_company_selection) {\n\t\techo \"<select name='company_login_name'>\\n\";\n\t\tfor ($i = 0; $i < count($db_connections); $i++)\n\t\t\techo \"<option value=\".$i.' '.($i==$coy ? 'selected' : '').'>'.$db_connections[$i]['name'].'</option>';\n\t\techo \"</select>\\n\";\n\t}\n\telse\n\t\techo \"<input required type='text' name='company_login_nickname' placeholder='\"._('Company').\"'>\";\n\techo '</div></td></tr>';\n}; \nstart_row();\nlabel_cell($demo_text, \"colspan=2 align='center' id='log_msg'\");\nend_row();\n\nstart_row();\necho \"<input type='hidden' id=ui_mode name='ui_mode' value='\".!fallback_mode().\"' >\\n\";\necho \"<td colspan='2'><center><input type='submit' value='&nbsp;&nbsp;\"._('Login').\"&nbsp;&nbsp;&#8250;' name='SubmitUser'\".\" onclick='\".(in_ajax() ? 'retry();': 'set_fullmode();').\"'\".(isset($blocked) ? \" disabled\" : '').\" ></center></td>\\n\";\nend_row();\n\nend_table(1);\n\nforeach($_SESSION['timeout']['post'] as $p => $val) {\n\t// add all request variables to be resend together with login data\n\tif (!in_array($p, array('ui_mode', 'user_name_entry_field', 'password', 'SubmitUser', 'company_login_name')))\n\t\tif (!is_array($val))\n\t\t\techo \"<input type='hidden' name='\".$p.\"' value='\".$val.\"'>\";\n\t\telse\n\t\t\tforeach($val as $i => $v)\n\t\t\t\techo \"<input type='hidden' name='{$p}[$i]' value='$v'>\";\n}\nend_form(1);\n$Ajax->addScript(true, \"if (document.forms.length) document.forms[0].password.focus();\");\n\necho \"<script>\n\t//<![CDATA[\n\t\t<!--\n\t\tdocument.forms[0].user_name_entry_field.select();\n\t\tdocument.forms[0].user_name_entry_field.focus();\n\t\t//-->\n\t//]]>\n</script>\";\ndiv_end();\necho \"<table class='bottomBar'>\\n\";\necho '<tr>';\nif (isset($_SESSION['wa_current_user'])) \n\t$date = Today().' | '.Now();\nelse\t\n\t$date = date('m/d/Y').' | '.date('h.i am');\necho \"<td class='bottomBarCell'>\".$date.\"</td>\\n\";\necho \"</tr></table>\\n\";\necho \"<table class='footer'>\\n\";\necho \"<tr>\\n\";\necho \"<td><a target='_blank' href='\".$SysPrefs->power_url.\"' tabindex='-1'>\".$SysPrefs->app_title.' '.$version.' - '._('Theme:').' '.$def_theme.\"</a></td>\\n\";\necho \"</tr>\\n\";\necho \"<tr>\\n\";\necho \"<td><a target='_blank' href='\".$SysPrefs->power_url.\"' tabindex='-1'>\".$SysPrefs->power_by.\"</a></td>\\n\";\necho \"</tr>\\n\";\necho \"</table><br><br>\\n\";\necho \"</body></html>\\n\";\n", "<?php\n/**********************************************************************\n\tCopyright (C) NotrinosERP.\n\tReleased under the terms of the GNU General Public License, GPL, \n\tas published by the Free Software Foundation, either version 3 \n\tof the License, or (at your option) any later version.\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  \n\tSee the License here <http://www.gnu.org/licenses/gpl-3.0.html>.\n***********************************************************************/\nif (!isset($path_to_root) || isset($_GET['path_to_root']) || isset($_POST['path_to_root']))\n\tdie(_('Restricted access'));\ninclude_once($path_to_root.'/includes/ui.inc');\ninclude_once($path_to_root.'/includes/page/header.inc');\n\n$js = \"<script>\nfunction defaultCompany() {\n\tdocument.forms[0].company_login_name.options[\".user_company().\"].selected = true;\n}\n</script>\";\nadd_js_file('login.js');\n\nif (!isset($def_coy))\n\t$def_coy = 0;\n$def_theme = 'default';\n\n$login_timeout = $_SESSION['wa_current_user']->last_act;\n\n$title = $SysPrefs->app_title.' '.$version.' - '._('Password reset');\n$encoding = isset($_SESSION['language']->encoding) ? $_SESSION['language']->encoding : 'iso-8859-1';\n$rtl = isset($_SESSION['language']->dir) ? $_SESSION['language']->dir : 'ltr';\n$onload = !$login_timeout ? \"onload='defaultCompany()'\" : '';\n\nif (!headers_sent())\n\theader(\"X-Frame-Options: SAMEORIGIN\");\n\necho \"<!DOCTYPE html>\\n\";\necho \"<html dir='\".$rtl.\"' >\\n\";\necho \"<head profile=\\\"http://www.w3.org/2005/10/profile\\\"><title>\".$title.\"</title>\\n\";\necho \"<meta charset='\".$encoding.\"' >\\n\";\necho \"<meta name='viewport' content='width=device-width,initial-scale=1'>\";\necho \"<link href='\".$path_to_root.'/themes/'.$def_theme.\"/default.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.'/themes/'.$def_theme.\"/local_style/access.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.\"/libraries/fontawesome/css/all.min.css' rel='stylesheet'> \\n\";\necho \"<link href='\".$path_to_root.\"/themes/default/images/favicon.ico' rel='icon' type='image/x-icon'> \\n\";\nsend_scripts();\necho $js;\necho \"</head>\\n\";\n\necho \"<body id='loginscreen' \".$onload.\">\\n\";\n\necho \"<table class='titletext'><tr><td>\".$title.\"</td></tr></table>\\n\";\n\t\ndiv_start('_page_body');\nbr(2);\nstart_form(false, @$_SESSION['timeout']['uri'], 'resetform');\nstart_table(false, \"class='login'\");\nstart_row();\necho \"<td align='center' colspan=2>\";\necho \"<a target='_blank' href='\".$SysPrefs->power_url.\"'><img src='\".$path_to_root.'/themes/'.$def_theme.\"/images/notrinos_erp.png' alt='NotrinosERP' height='50' onload='fixPNG(this)' border='0' ></a>\";\necho \"</td>\\n\";\nend_row();\n\necho \"<input type='hidden' id=ui_mode name='ui_mode' value='\".fallback_mode().\"' >\\n\";\ntable_section_title(_('Version').' '.$version.\"   Build \".$SysPrefs->build_version.' - '._('Password reset'));\necho \"<tr><td colspan='2'></td></tr>\";\necho \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-envelope' title='\"._('Email').\"'></i>\";\necho \"<input required class='input' id='email' name='email_entry_field' type='text' placeholder='\"._('Email:').\"'></div></td></tr>\";\n\n$coy =  user_company();\nif (!isset($coy))\n\t$coy = $def_coy;\necho \"<tr><td class='login_input'><div class='input_container'><i class='fas fa-building' title='\"._('Company').\"'></i>\";\nif (!@$SysPrefs->text_company_selection) {\n\techo \"<select name='company_login_name'>\\n\";\n\tfor ($i = 0; $i < count($db_connections); $i++)\n\t\techo \"<option value=\".$i.' '.($i==$coy ? 'selected' : '').'>'.$db_connections[$i]['name'].'</option>';\n\techo \"</select>\\n\";\n}\nelse\n\techo \"<input required type='text' name='company_login_nickname' placeholder='\"._('Company').\"'>\";\necho '</div></td></tr>';\n\nstart_row();\nlabel_cell('Please enter your e-mail', \"colspan=2 align='center' id='log_msg'\");\nend_row();\n\nstart_row();\necho \"<td colspan='2'><center><input type='submit' value='&nbsp;&nbsp;\"._('Send password').\"&nbsp;&nbsp;&#8250;' name='SubmitReset' onclick='set_fullmode();'></center></td>\\n\";\nend_row();\nend_table(1);\n\nend_form(1);\n$Ajax->addScript(true, \"document.forms[0].password.focus();\");\n\necho \"<script>\n//<![CDATA[\n\t<!--\n\tdocument.forms[0].email_entry_field.select();\n\tdocument.forms[0].email_entry_field.focus();\n\t//-->\n//]]>\n</script>\";\ndiv_end();\necho \"<table class='bottomBar'>\\n\";\necho \"<tr>\";\n\nif (isset($_SESSION['wa_current_user'])) \n\t$date = Today().' | '.Now();\nelse\t\n\t$date = date('m/d/Y').' | '.date(\"h.i am\");\n\necho \"<td class='bottomBarCell'>\".$date.\"</td>\\n\";\necho \"</tr></table>\\n\";\necho \"<table class='footer'>\\n\";\necho \"<tr>\\n\";\necho \"<td><a target='_blank' href='\".$SysPrefs->power_url.\"' tabindex='-1'>\".$SysPrefs->app_title.' '.$version.' - ' ._('Theme:').' '.$def_theme.\"</a></td>\\n\";\necho \"</tr>\\n\";\necho \"<tr>\\n\";\necho \"<td><a target='_blank' href='\".$SysPrefs->power_url.\"' tabindex='-1'>\".$SysPrefs->power_by.\"</a></td>\\n\";\necho \"</tr>\\n\";\necho \"</table><br><br>\\n\";\necho \"</body></html>\\n\";\n", "<?php\n/**********************************************************************\n\tCopyright (C) FrontAccounting, LLC.\n\tReleased under the terms of the GNU General Public License, GPL, \n\tas published by the Free Software Foundation, either version 3 \n\tof the License, or (at your option) any later version.\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  \n\tSee the License here <http://www.gnu.org/licenses/gpl-3.0.html>.\n***********************************************************************/\n/*\n\tIf no context is set current page/menu screen is selected.\n*/\nfunction help_url($context=null) {\n\n\tglobal $SysPrefs, $help_context;\n\n\t$country = $_SESSION['language']->code;\n\t$clean = 0;\n\t\n\tif ($context!=null)\n\t\t$help_page_url = $context;\n\telseif (isset($help_context))\n\t\t$help_page_url = $help_context;\n\telse {// main menu\n\t\t$app = $_SESSION['sel_app'];\n\t\t$help_page_url = $_SESSION['App']->applications[$app]->help_context;\n\t\t$clean = 1;\n\t}\n\n\tif (@$SysPrefs->old_style_help)\n\t\t$help_page_url = _($help_page_url);\n\n\tif ($clean)\n\t\t$help_page_url = access_string($help_page_url, true);\n\n\treturn html_specials_encode(\n\t\t$SysPrefs->help_base_url\n\t\t.urlencode(strtr(ucwords($help_page_url), array(' '=>'', '/'=>'', '&'=>'And')))\n\t\t.'&ctxhelp=1&lang='.$country);\n}\n\nfunction send_css($css='') {\n\tglobal $css_files;\n\n\tinit_css();\n\n\tforeach ($css_files as $css_file) {\n\t\techo \"<link href='\".$css_file.\"' rel='stylesheet' type='text/css'> \\n\";\n\t}\n\tif ($css)\n\t\techo \"<link href='\".$css.\"' rel='stylesheet' type='text/css'> \\n\";\n}\n\nfunction send_scripts() {\n\tglobal $SysPrefs, $path_to_root, $js_static, $js_path, $js_userlib;\n\n\t$js ='';\n\tforeach($js_static as $jsfile) {\n\t\t$basename = basename($jsfile);\n\t\t$fpath = user_js_cache().'/'.$basename;\n\t\t// compress also static files\n\t\tif (!file_exists($fpath) || $SysPrefs->go_debug) {\n\t\t\t// don't need to compress minified files\n\t\t\tif(strpos($basename, '.min.js' ) !== false)\n\t\t\t\tcopy($js_path.$jsfile, $fpath);\n\t\t\telse\n\t\t\t\tcache_js_file($fpath, file_get_contents($js_path.$jsfile));\n\t\t}\n\n\t\t$js .= '<script src=\"'.$fpath.'\"></script>';\n\t}\n\tforeach($js_userlib as $jsfile) {\n\t\t$js .= '<script src=\"'.$jsfile.'\"></script>';\n\t}\n\n\techo $js;\n}\n\nfunction page_header($title, $no_menu=false, $is_index=false, $onload='', $js='', $css='') {\n\t// titles and screen header\n\tglobal $path_to_root, $SysPrefs, $db_connections;\n\n\tif (in_ajax() || isset($_POST['REP_ID']))\n\t\treturn; // just for speed up\n\n\t$theme = user_theme();\n\n\tif ($SysPrefs->help_base_url != null && $SysPrefs->use_popup_windows && $js == '') {\n\t\tif (!function_exists('get_js_open_window'))\n\t\t\tinclude_once($path_to_root.'/includes/ui/ui_view.inc');\n\t\t\n\t\tadd_js_source(get_js_open_window(900, 500));\n\t}\n\tif ($js != '')\n\t\tadd_js_source($js);\n\n\tif (!isset($no_menu))\n\t\t$no_menu = false;\n\t\n\tif (isset($_SESSION['App']) && is_object($_SESSION['App']) && isset($_SESSION['App']->selected_application) && $_SESSION['App']->selected_application != '')\n\t\t$sel_app = $_SESSION['App']->selected_application;\n\telseif (isset($_SESSION['sel_app']) && $_SESSION['sel_app'] != '')\n\t\t$sel_app = $_SESSION['sel_app'];\n\telse\n\t\t$sel_app = user_startup_tab();\n\t\n\t$_SESSION['sel_app'] = $sel_app;\n\n\t// When startup tab for current user was set to already \n\t// removed/inactivated extension module select Sales tab as default.\n\tif (isset($_SESSION['App']) && is_object($_SESSION['App']))\n\t\t$_SESSION['App']->selected_application = isset($_SESSION['App']->applications[$sel_app]) ? $sel_app : 'orders';\n\n\t$page_header_args = func_get_args();\n\tif(isset($db_connections))\t// skip before installation\n\t\thook_invoke_all('pre_header', $page_header_args);\n\n\t$encoding = $_SESSION['language']->encoding;\n\n\tif (!headers_sent()) {\n\t\theader(\"Content-type: text/html; charset=$encoding\");\n\t\theader(\"X-Frame-Options: SAMEORIGIN\");\n\t}\n\t\n\techo \"<!DOCTYPE html>\\n\";\n\techo \"<html dir='\" . $_SESSION['language']->dir . \"' >\\n\";\n\techo \"<head profile=\\\"http://www.w3.org/2005/10/profile\\\"><title>\".$title.\"</title>\";\n\tif (strpos($_SERVER['HTTP_USER_AGENT'], 'Trident/7.0; rv:11.0') != -1) // IE 11 doesn't work with input file type in form.\n\t\techo \"<meta http-equiv='X-UA-Compatible' content='IE=10'>\\n\";\n\techo \"<meta charset='\".$encoding.\"'>\";\n\techo \"<meta name='viewport' content='width=device-width,initial-scale=1'>\";\n\techo \"<link href='\".$path_to_root.\"/themes/default/images/favicon.ico' rel='icon' type='image/x-icon'> \\n\";\n\n\tsend_css($css);\n\n\tsend_scripts();\n\n\techo \"</head> \\n\";\n\tif ($onload == '')\n\t\techo '<body>';\n\telse\n\t\techo \"<body onload=\\\"$onload\\\">\";\n\n\tinclude_once($path_to_root.'/themes/'.$theme.'/renderer.php');\n\t$rend = new renderer();\n\t$rend->menu_header($title, $no_menu, $is_index);\n\terror_box();\n}\n"], "filenames": ["access/login.php", "access/password_reset.php", "includes/page/header.inc"], "buggy_code_start_loc": [53, 33, 44], "buggy_code_end_loc": [53, 33, 149], "fixing_code_start_loc": [54, 34, 44], "fixing_code_end_loc": [57, 37, 151], "type": "CWE-1021", "message": "Improper Restriction of Rendered UI Layers or Frames in GitHub repository notrinos/notrinoserp prior to 0.7.", "other": {"cve": {"id": "CVE-2022-2965", "sourceIdentifier": "security@huntr.dev", "published": "2022-08-23T16:15:10.387", "lastModified": "2022-08-26T20:16:29.210", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Improper Restriction of Rendered UI Layers or Frames in GitHub repository notrinos/notrinoserp prior to 0.7."}, {"lang": "es", "value": "Una Restricci\u00f3n Inapropiada de Capas o Marcos de Interfaz de Usuario Renderizados en el repositorio de GitHub notrinos/notrinoserp versiones anteriores a 0.7."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "NONE", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.3, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 1.4}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:H/PR:H/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 6.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 0.5, "impactScore": 5.9}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-1021"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:notrinos:notrinoserp:*:*:*:*:*:*:*:*", "versionEndExcluding": "0.7", "matchCriteriaId": "1DA2C016-D055-4DB8-AE79-4E8247EAD917"}]}]}], "references": [{"url": "https://github.com/notrinos/notrinoserp/commit/c2ff3d8e85a811003b796ca38f5b3290deeaa3aa", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/61e3bdf7-3548-45ea-b105-967abc0977f4", "source": "security@huntr.dev", "tags": ["Exploit", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/notrinos/notrinoserp/commit/c2ff3d8e85a811003b796ca38f5b3290deeaa3aa"}}