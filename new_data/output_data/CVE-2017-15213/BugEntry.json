{"buggy_code": ["<script>\nfunction toggleCheckbox(id)\n{\n\tvar el = document.getElementById(id);\n\tif (el != null) {\n\t\tif (el.checked) {\n\t\t\tel.checked = false;\n\t\t} else {\n\t\t\tel.checked = true;\n\t\t}\n\t}\n}\n</script>\n<?php \nif ($do == 'admin'): echo tpl_form(Filters::noXSS(CreateURL($do, 'editallusers')), null, null, null, 'id=\"editallusers\"');\n               else: echo tpl_form(Filters::noXSS($_SERVER['SCRIPT_NAME']), null, null, null, 'id=\"editallusers\"');\nendif;\nif ($do == 'admin'): ?>\n\t<input type=\"hidden\" name=\"action\" value=\"admin.editallusers\" />\n\t<input type=\"hidden\" name=\"do\" value=\"admin\" />\n\t<input type=\"hidden\" name=\"area\" value=\"editallusers\" />\n<?php endif; ?>\n<style>.bulkedituser td.inactive{color:#999;}</style>\n<table class=\"bulkedituser\">\n\t<thead>\n\t<tr class=\"account_header\">\n\t\t<th></th>\n\t\t<th><?php echo Filters::noXSS(L('realname')); ?></th>\n\t\t<th><?php echo Filters::noXSS(L('username')); ?></th>\n\t\t<th><?php echo Filters::noXSS(L('emailaddress')); ?></th>\n\t\t<th><?php echo Filters::noXSS(L('jabberid')); ?></th>\n                <th><?php echo Filters::noXSS(L('regdate')); ?></th>\n                <th><?php echo Filters::noXSS(L('language')); ?></th>\n                <th><?php echo Filters::noXSS(L('timezone')); ?></th>\n                <th><?php echo Filters::noXSS(L('dateformat')); ?></th>\n                <th><?php echo Filters::noXSS(L('dateformat_extended')); ?></th>\n\t</tr>\n\t</thead>\n\t<tbody>\n\t<?php\n\tforeach (Flyspray::ListUsers() as $usr) {\n\t\tif ( $usr['account_enabled'] ) {\n\t\t\techo '<tr class=\"account_enabled\" onclick=\"toggleCheckbox('.$usr['user_id'].')\">';\n\t\t} else {\n\t\t\techo '<tr class=\"account_disabled\" onclick=\"toggleCheckbox('.$usr['user_id'].')\">';\n\t\t} ?>\n\t\t<td><input id=\"<?php echo $usr['user_id'] ?>\" onclick=\"event.stopPropagation()\" type=\"checkbox\" name=\"checkedUsers[]\" value=\"<?php echo $usr['user_id']; ?>\"></td>\n\t\t<td><a href=\"<?php echo CreateURL('edituser', $usr['user_id'] ); ?>\"><?php echo $usr['real_name']; ?></a></td>\n\t\t<td><?php echo $usr['user_name']; ?></td>\n\t\t<td<?= ($usr['notify_type']==0 || $usr['notify_type']==2) ? ' class=\"inactive\"':''; ?>><?php echo $usr['email_address']; ?></td>\n\t\t<td<?= ($usr['notify_type']==0 || $usr['notify_type']==1) ? ' class=\"inactive\"':''; ?>><?php echo Filters::noXSS($usr['jabber_id']); ?></td>\n                <td><?php echo formatDate($usr['register_date']); ?></td>\n                <td><?php echo Filters::noXSS($usr['lang_code']); ?></td>\n                <td><?php echo Filters::noXSS($usr['time_zone']); ?></td>\n                <td><?php echo Filters::noXSS($usr['dateformat']); ?></td>\n                <td><?php echo Filters::noXSS($usr['dateformat_extended']); ?></td>\n\t</tr>\n\t<?php } ?>\n\t</tbody>\n</table>\n\n<button type=\"submit\" id=\"buSubmit\" name=\"enable\"><?php echo Filters::noXSS(L('enableaccounts')); ?></button>\n<button type=\"submit\" id=\"buSubmit\" name=\"disable\"><?php echo Filters::noXSS(L('disableaccounts')); ?></button>\n<button type=\"submit\" id=\"buSubmit\" name=\"delete\"><?php echo Filters::noXSS(L('deleteaccounts')); ?></button>\n\n<!-- TODO Should still add these to bulk edit, but hasn't been done yet\n<ul class=\"form_elements\">\n<li class=\"required\">\n      <label for=\"notify_type\"><?php echo Filters::noXSS(L('notifications')); ?></label>\n      <select id=\"notify_type\" name=\"notify_type\">\n        <?php echo tpl_options($fs->GetNotificationOptions(), Req::val('notify_type')); ?>\n\n      </select>\n</li>\n<li>\n      <label for=\"time_zone\"><?php echo Filters::noXSS(L('timezone')); ?></label>\n      <select id=\"time_zone\" name=\"time_zone\">\n        <?php\n          $times = array();\n          for ($i = -12; $i <= 13; $i++) {\n            $times[$i] = L('GMT') . (($i == 0) ? ' ' : (($i > 0) ? '+' . $i : $i));\n          }\n        ?>\n        <?php echo tpl_options($times, Req::val('time_zone', 0)); ?>\n\n      </select>\n</li>\n\n    <?php if (isset($groups)): ?>\n    <li>\n      <label for=\"groupin\"><?php echo Filters::noXSS(L('globalgroup')); ?></label>\n      <select id=\"groupin\" class=\"adminlist\" name=\"group_in\">\n        <?php echo tpl_options($groups, Req::val('group_in')); ?>\n\n      </select>\n    </li>\n    <?php endif; ?>\n\n  </ul>\n  <p><button type=\"submit\" id=\"buSubmit\"><?php echo Filters::noXSS(L('Update Accounts')); ?></button></p>\n-->\n</form>\n"], "fixing_code": ["<script>\nfunction toggleCheckbox(id)\n{\n\tvar el = document.getElementById(id);\n\tif (el != null) {\n\t\tif (el.checked) {\n\t\t\tel.checked = false;\n\t\t} else {\n\t\t\tel.checked = true;\n\t\t}\n\t}\n}\n</script>\n<?php \nif ($do == 'admin'): echo tpl_form(Filters::noXSS(CreateURL($do, 'editallusers')), null, null, null, 'id=\"editallusers\"');\n               else: echo tpl_form(Filters::noXSS($_SERVER['SCRIPT_NAME']), null, null, null, 'id=\"editallusers\"');\nendif;\nif ($do == 'admin'): ?>\n\t<input type=\"hidden\" name=\"action\" value=\"admin.editallusers\" />\n\t<input type=\"hidden\" name=\"do\" value=\"admin\" />\n\t<input type=\"hidden\" name=\"area\" value=\"editallusers\" />\n<?php endif; ?>\n<style>.bulkedituser td.inactive{color:#999;}</style>\n<table class=\"bulkedituser\">\n\t<thead>\n\t<tr class=\"account_header\">\n\t\t<th></th>\n\t\t<th><?php echo Filters::noXSS(L('realname')); ?></th>\n\t\t<th><?php echo Filters::noXSS(L('username')); ?></th>\n\t\t<th><?php echo Filters::noXSS(L('emailaddress')); ?></th>\n\t\t<th><?php echo Filters::noXSS(L('jabberid')); ?></th>\n                <th><?php echo Filters::noXSS(L('regdate')); ?></th>\n                <th><?php echo Filters::noXSS(L('language')); ?></th>\n                <th><?php echo Filters::noXSS(L('timezone')); ?></th>\n                <th><?php echo Filters::noXSS(L('dateformat')); ?></th>\n                <th><?php echo Filters::noXSS(L('dateformat_extended')); ?></th>\n\t</tr>\n\t</thead>\n\t<tbody>\n\t<?php\n\tforeach (Flyspray::ListUsers() as $usr) {\n\t\tif ( $usr['account_enabled'] ) {\n\t\t\techo '<tr class=\"account_enabled\" onclick=\"toggleCheckbox('.$usr['user_id'].')\">';\n\t\t} else {\n\t\t\techo '<tr class=\"account_disabled\" onclick=\"toggleCheckbox('.$usr['user_id'].')\">';\n\t\t} ?>\n\t\t<td><input id=\"<?php echo $usr['user_id'] ?>\" onclick=\"event.stopPropagation()\" type=\"checkbox\" name=\"checkedUsers[]\" value=\"<?php echo $usr['user_id']; ?>\"></td>\n\t\t<td><a href=\"<?php echo CreateURL('edituser', $usr['user_id'] ); ?>\"><?php echo Filters::noXSS($usr['real_name']); ?></a></td>\n\t\t<td><?php echo $usr['user_name']; ?></td>\n\t\t<td<?= ($usr['notify_type']==0 || $usr['notify_type']==2) ? ' class=\"inactive\"':''; ?>><?php echo Filters::noXSS($usr['email_address']); ?></td>\n\t\t<td<?= ($usr['notify_type']==0 || $usr['notify_type']==1) ? ' class=\"inactive\"':''; ?>><?php echo Filters::noXSS($usr['jabber_id']); ?></td>\n                <td><?php echo formatDate($usr['register_date']); ?></td>\n                <td><?php echo Filters::noXSS($usr['lang_code']); ?></td>\n                <td><?php echo Filters::noXSS($usr['time_zone']); ?></td>\n                <td><?php echo Filters::noXSS($usr['dateformat']); ?></td>\n                <td><?php echo Filters::noXSS($usr['dateformat_extended']); ?></td>\n\t</tr>\n\t<?php } ?>\n\t</tbody>\n</table>\n\n<button type=\"submit\" id=\"buSubmit\" name=\"enable\"><?php echo Filters::noXSS(L('enableaccounts')); ?></button>\n<button type=\"submit\" id=\"buSubmit\" name=\"disable\"><?php echo Filters::noXSS(L('disableaccounts')); ?></button>\n<button type=\"submit\" id=\"buSubmit\" name=\"delete\"><?php echo Filters::noXSS(L('deleteaccounts')); ?></button>\n\n<!-- TODO Should still add these to bulk edit, but hasn't been done yet\n<ul class=\"form_elements\">\n<li class=\"required\">\n      <label for=\"notify_type\"><?php echo Filters::noXSS(L('notifications')); ?></label>\n      <select id=\"notify_type\" name=\"notify_type\">\n        <?php echo tpl_options($fs->GetNotificationOptions(), Req::val('notify_type')); ?>\n\n      </select>\n</li>\n<li>\n      <label for=\"time_zone\"><?php echo Filters::noXSS(L('timezone')); ?></label>\n      <select id=\"time_zone\" name=\"time_zone\">\n        <?php\n          $times = array();\n          for ($i = -12; $i <= 13; $i++) {\n            $times[$i] = L('GMT') . (($i == 0) ? ' ' : (($i > 0) ? '+' . $i : $i));\n          }\n        ?>\n        <?php echo tpl_options($times, Req::val('time_zone', 0)); ?>\n\n      </select>\n</li>\n\n    <?php if (isset($groups)): ?>\n    <li>\n      <label for=\"groupin\"><?php echo Filters::noXSS(L('globalgroup')); ?></label>\n      <select id=\"groupin\" class=\"adminlist\" name=\"group_in\">\n        <?php echo tpl_options($groups, Req::val('group_in')); ?>\n\n      </select>\n    </li>\n    <?php endif; ?>\n\n  </ul>\n  <p><button type=\"submit\" id=\"buSubmit\"><?php echo Filters::noXSS(L('Update Accounts')); ?></button></p>\n-->\n</form>\n"], "filenames": ["themes/CleanFS/templates/common.editallusers.tpl"], "buggy_code_start_loc": [48], "buggy_code_end_loc": [51], "fixing_code_start_loc": [48], "fixing_code_end_loc": [51], "type": "CWE-79", "message": "Stored XSS vulnerability in Flyspray before 1.0-rc6 allows an authenticated user to inject JavaScript to gain administrator privileges, via the real_name or email_address field to themes/CleanFS/templates/common.editallusers.tpl.", "other": {"cve": {"id": "CVE-2017-15213", "sourceIdentifier": "cve@mitre.org", "published": "2017-10-11T01:32:55.240", "lastModified": "2017-10-27T18:54:41.463", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Stored XSS vulnerability in Flyspray before 1.0-rc6 allows an authenticated user to inject JavaScript to gain administrator privileges, via the real_name or email_address field to themes/CleanFS/templates/common.editallusers.tpl."}, {"lang": "es", "value": "Cross-Site Scripting (XSS) persistente en Flyspray en versiones anteriores a 1.0-rc6 permite que un usuario autenticado inyecte JavaScript para obtener privilegios de administrador mediante los campos real_name o email_address en themes/CleanFS/templates/common.editallusers.tpl."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:flyspray:flyspray:*:rc4:*:*:*:*:*:*", "versionEndIncluding": "1.0", "matchCriteriaId": "DADD112F-F7E0-4884-B439-813880F7BCFA"}]}]}], "references": [{"url": "http://openwall.com/lists/oss-security/2017/10/07/1", "source": "cve@mitre.org", "tags": ["Mailing List", "Patch", "Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/Flyspray/flyspray/commit/754ec5d04348ef7ecb8cb02ade976dc412b031f8", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "Patch"]}, {"url": "https://github.com/Flyspray/flyspray/releases/tag/v1.0-rc6", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/Flyspray/flyspray/commit/754ec5d04348ef7ecb8cb02ade976dc412b031f8"}}