{"buggy_code": ["@extends('layout.default')\n\n@section('title', $__t('Shopping list'))\n@section('activeNav', 'shoppinglist')\n@section('viewJsName', 'shoppinglist')\n\n@push('pageScripts')\n<script src=\"{{ $U('/node_modules/datatables.net-rowgroup/js/dataTables.rowGroup.min.js?v=', true) }}{{ $version }}\"></script>\n<script src=\"{{ $U('/node_modules/datatables.net-rowgroup-bs4/js/rowGroup.bootstrap4.min.js?v=', true) }}{{ $version }}\"></script>\n<script src=\"{{ $U('/viewjs/purchase.js?v=', true) }}{{ $version }}\"></script>\n@endpush\n\n@push('pageStyles')\n<link href=\"{{ $U('/node_modules/animate.css/animate.min.css?v=', true) }}{{ $version }}\"\n\trel=\"stylesheet\">\n<link href=\"{{ $U('/node_modules/datatables.net-rowgroup-bs4/css/rowGroup.bootstrap4.min.css?v=', true) }}{{ $version }}\"\n\trel=\"stylesheet\">\n\n<style>\n\ttr.dtrg-group {\n\t\tcursor: pointer;\n\t}\n\n</style>\n@endpush\n\n@section('content')\n<div class=\"row d-print-none hide-on-fullscreen-card\">\n\t<div class=\"col\">\n\t\t<div class=\"row\">\n\t\t\t<h2 class=\"col-sm-12 col-md-6 mb-2 title\">@yield('title')</h2>\n\t\t\t@if(GROCY_FEATURE_FLAG_SHOPPINGLIST_MULTIPLE_LISTS)\n\t\t\t<div class=\"col-sm-12 col-md-6 d-flex align-items-end flex-wrap\">\n\t\t\t\t<div class=\"d-inline-block flex-grow-1 pr-1 mb-1\">\n\t\t\t\t\t<select class=\"form-control form-control-sm\"\n\t\t\t\t\t\tid=\"selected-shopping-list\">\n\t\t\t\t\t\t@foreach($shoppingLists as $shoppingList)\n\t\t\t\t\t\t<option @if($shoppingList->id == $selectedShoppingListId) selected=\"selected\" @endif value=\"{{ $shoppingList->id }}\">{{ $shoppingList->name }}</option>\n\t\t\t\t\t\t@endforeach\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"d-inline-block mb-1\">\n\t\t\t\t\t<a class=\"btn btn-outline-dark btn-sm responsive-button\"\n\t\t\t\t\t\thref=\"{{ $U('/shoppinglist/new') }}\">\n\t\t\t\t\t\t{{ $__t('New shopping list') }}\n\t\t\t\t\t</a>\n\t\t\t\t\t<a id=\"delete-selected-shopping-list\"\n\t\t\t\t\t\tclass=\"btn btn-outline-danger btn-sm responsive-button @if($selectedShoppingListId == 1) disabled @endif\"\n\t\t\t\t\t\thref=\"#\">\n\t\t\t\t\t\t{{ $__t('Delete shopping list') }}\n\t\t\t\t\t</a>\n\t\t\t\t\t<a id=\"print-shopping-list-button\"\n\t\t\t\t\t\tclass=\"btn btn-outline-dark btn-sm responsive-button\"\n\t\t\t\t\t\thref=\"#\">\n\t\t\t\t\t\t{{ $__t('Print') }}\n\t\t\t\t\t</a>\n\t\t\t\t\t<!--<div class=\"dropdown d-inline-block\">\n\t\t\t\t\t\t\t<button class=\"btn btn-outline-dark responsive-button dropdown-toggle\" data-toggle=\"dropdown\"><i class=\"fas fa-file-export\"></i> {{ $__t('Output') }}</button>\n\t\t\t\t\t\t\t<div class=\"dropdown-menu\">\n\t\t\t\t\t\t\t\t<a id=\"print-shopping-list-button\" class=\"dropdown-item\" href=\"#\"><i class=\"fas fa-print\"></i> {{ $__t('Print') }}</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>-->\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t@else\n\t\t\t<input type=\"hidden\"\n\t\t\t\tname=\"selected-shopping-list\"\n\t\t\t\tid=\"selected-shopping-list\"\n\t\t\t\tvalue=\"1\">\n\t\t\t@endif\n\t\t</div>\n\t\t<hr>\n\t\t<p data-status-filter=\"belowminstockamount\"\n\t\t\tclass=\"normal-message status-filter-message responsive-button\">{{ $__n(count($missingProducts), '%s product is below defined min. stock amount', '%s products are below defined min. stock amount') }}</p>\n\t</div>\n</div>\n\n<div class=\"row mt-3 d-print-none hide-on-fullscreen-card\">\n\t<div class=\"col-md-12 mb-2\">\n\t\t<a class=\"btn btn-primary responsive-button btn-sm mb-1\"\n\t\t\thref=\"{{ $U('/shoppinglistitem/new?list=' . $selectedShoppingListId) }}\">\n\t\t\t{{ $__t('Add item') }}\n\t\t</a>\n\t\t<a id=\"clear-shopping-list\"\n\t\t\tclass=\"btn btn-outline-danger btn-sm mb-1 responsive-button @if($listItems->count() == 0) disabled @endif\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Clear list') }}\n\t\t</a>\n\t\t<a id=\"add-all-items-to-stock-button\"\n\t\t\tclass=\"btn btn-outline-primary btn-sm mb-1 responsive-button\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Add all list items to stock') }}\n\t\t</a>\n\t\t<a id=\"add-products-below-min-stock-amount\"\n\t\t\tclass=\"btn btn-outline-primary btn-sm mb-1 responsive-button\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Add products that are below defined min. stock amount') }}\n\t\t</a>\n\t</div>\n\t<div class=\"col-xs-12 col-md-5\">\n\t\t<div class=\"input-group mb-3\">\n\t\t\t<div class=\"input-group-prepend\">\n\t\t\t\t<span class=\"input-group-text\"><i class=\"fas fa-search\"></i></span>\n\t\t\t</div>\n\t\t\t<input type=\"text\"\n\t\t\t\tid=\"search\"\n\t\t\t\tclass=\"form-control\"\n\t\t\t\tplaceholder=\"{{ $__t('Search') }}\">\n\t\t</div>\n\t</div>\n\t<div class=\"col-xs-12 col-md-4 col-lg-5\">\n\t\t<div class=\"input-group mb-3\">\n\t\t\t<div class=\"input-group-prepend\">\n\t\t\t\t<span class=\"input-group-text\"><i class=\"fas fa-filter\"></i></span>\n\t\t\t</div>\n\t\t\t<select class=\"form-control\"\n\t\t\t\tid=\"status-filter\">\n\t\t\t\t<option value=\"all\">{{ $__t('All') }}</option>\n\t\t\t\t<option value=\"belowminstockamount\">{{ $__t('Below min. stock amount') }}</option>\n\t\t\t\t<option value=\"xxUNDONExx\">{{ $__t('Only undone items') }}</option>\n\t\t\t</select>\n\t\t</div>\n\t</div>\n\t<div class=\"col-xs-12 col-md-3 col-lg-2 mb-3\">\n\t\t<a id=\"shopping-list-compact-view-button\"\n\t\t\tclass=\"btn btn-outline-dark responsive-button switch-view-mode-button w-100\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Compact view') }}\n\t\t</a>\n\t</div>\n</div>\n\n<div id=\"shoppinglist-main\"\n\tclass=\"row d-print-none\">\n\t<div class=\"@if(boolval($userSettings['shopping_list_show_calendar'])) col-xs-12 col-md-8 @else col-12 @endif pb-3\">\n\t\t<a id=\"shopping-list-normal-view-button\"\n\t\t\tclass=\"btn btn-outline-dark btn-block switch-view-mode-button d-none\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Normal view') }}\n\t\t</a>\n\t\t<table id=\"shoppinglist-table\"\n\t\t\tclass=\"table table-sm table-striped dt-responsive\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th class=\"border-right\"></th>\n\t\t\t\t\t<th>{{ $__t('Product') }} / <em>{{ $__t('Note') }}</em></th>\n\t\t\t\t\t<th>{{ $__t('Amount') }}</th>\n\t\t\t\t\t<th class=\"d-none\">Hiden product group</th>\n\t\t\t\t\t<th class=\"d-none\">Hidden status</th>\n\n\t\t\t\t\t@include('components.userfields_thead', array(\n\t\t\t\t\t'userfields' => $userfields\n\t\t\t\t\t))\n\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody class=\"d-none\">\n\t\t\t\t@foreach($listItems as $listItem)\n\t\t\t\t<tr id=\"shoppinglistitem-{{ $listItem->id }}-row\"\n\t\t\t\t\tclass=\"@if(FindObjectInArrayByPropertyValue($missingProducts, 'id', $listItem->product_id) !== null) table-info @endif @if($listItem->done == 1) text-muted text-strike-through @endif\">\n\t\t\t\t\t<td class=\"fit-content border-right\">\n\t\t\t\t\t\t<a class=\"btn btn-success btn-sm order-listitem-button\"\n\t\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\t\tdata-item-id=\"{{ $listItem->id }}\"\n\t\t\t\t\t\t\tdata-item-done=\"{{ $listItem->done }}\"\n\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\n\t\t\t\t\t\t\tdata-placement=\"right\"\n\t\t\t\t\t\t\ttitle=\"{{ $__t('Mark this item as done') }}\">\n\t\t\t\t\t\t\t<i class=\"fas fa-check\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a class=\"btn btn-sm btn-info\"\n\t\t\t\t\t\t\thref=\"{{ $U('/shoppinglistitem/') . $listItem->id . '?list=' . $selectedShoppingListId }}\"\n\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\n\t\t\t\t\t\t\tdata-placement=\"right\"\n\t\t\t\t\t\t\ttitle=\"{{ $__t('Edit this item') }}\">\n\t\t\t\t\t\t\t<i class=\"fas fa-edit\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a class=\"btn btn-sm btn-danger shoppinglist-delete-button\"\n\t\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\t\tdata-shoppinglist-id=\"{{ $listItem->id }}\"\n\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\n\t\t\t\t\t\t\tdata-placement=\"right\"\n\t\t\t\t\t\t\ttitle=\"{{ $__t('Delete this item') }}\">\n\t\t\t\t\t\t\t<i class=\"fas fa-trash\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a class=\"btn btn-sm btn-primary @if(empty($listItem->product_id)) disabled @else shopping-list-stock-add-workflow-list-item-button @endif\"\n\t\t\t\t\t\t\thref=\"{{ $U('/purchase?embedded&flow=shoppinglistitemtostock&product=') }}{{ $listItem->product_id }}&amount={{ $listItem->amount }}&listitemid={{ $listItem->id }}\"\n\t\t\t\t\t\t\t@if(!empty($listItem->product_id)) data-toggle=\"tooltip\" title=\"{{ $__t('Add %1$s of %2$s to stock', $listItem->amount . ' ' . $__n($listItem->amount, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name_plural), FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->name, $listItem->amount) }}\" @endif>\n\t\t\t\t\t\t\t<i class=\"fas fa-box\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t@if(!empty($listItem->product_id)) {{ FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->name }}<br>@endif<em>{!! nl2br($listItem->note) !!}</em>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class=\"locale-number locale-number-quantity-amount\">{{ $listItem->amount }}</span> @if(!empty($listItem->product_id)){{ $__n($listItem->amount, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name_plural) }}@endif\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class=\"d-none\">\n\t\t\t\t\t\t@if(!empty(FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->product_group_id)) {{ FindObjectInArrayByPropertyValue($productGroups, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->product_group_id)->name }} @else <span class=\"font-italic font-weight-light\">{{ $__t('Ungrouped') }}</span> @endif\n\t\t\t\t\t</td>\n\t\t\t\t\t<td id=\"shoppinglistitem-{{ $listItem->id }}-status-info\"\n\t\t\t\t\t\tclass=\"d-none\">\n\t\t\t\t\t\t@if(FindObjectInArrayByPropertyValue($missingProducts, 'id', $listItem->product_id) !== null) belowminstockamount @endif\n\t\t\t\t\t\t@if($listItem->done != 1) xxUNDONExx @endif\n\t\t\t\t\t</td>\n\n\t\t\t\t\t@include('components.userfields_tbody', array(\n\t\t\t\t\t'userfields' => $userfields,\n\t\t\t\t\t'userfieldValues' => FindAllObjectsInArrayByPropertyValue($userfieldValues, 'object_id', $listItem->product_id)\n\t\t\t\t\t))\n\n\t\t\t\t</tr>\n\t\t\t\t@endforeach\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n\n\t@if(boolval($userSettings['shopping_list_show_calendar']))\n\t<div class=\"col-xs-12 col-md-4 mt-md-2 d-print-none\">\n\t\t@include('components.calendarcard')\n\t</div>\n\t@endif\n\n\t<div class=\"@if(boolval($userSettings['shopping_list_show_calendar'])) col-xs-12 col-md-8 @else col-12 @endif d-print-none pt-2\">\n\t\t<div class=\"form-group\">\n\t\t\t<label class=\"text-larger font-weight-bold\"\n\t\t\t\tfor=\"notes\">{{ $__t('Notes') }}</label>\n\t\t\t<a id=\"save-description-button\"\n\t\t\t\tclass=\"btn btn-success btn-sm ml-1 mb-2\"\n\t\t\t\thref=\"#\">{{ $__t('Save') }}</a>\n\t\t\t<a id=\"clear-description-button\"\n\t\t\t\tclass=\"btn btn-danger btn-sm ml-1 mb-2\"\n\t\t\t\thref=\"#\">{{ $__t('Clear') }}</a>\n\t\t\t<textarea class=\"form-control wysiwyg-editor\"\n\t\t\t\tid=\"description\"\n\t\t\t\tname=\"description\">{{ FindObjectInArrayByPropertyValue($shoppingLists, 'id', $selectedShoppingListId)->description }}</textarea>\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"modal fade\"\n\tid=\"shopping-list-stock-add-workflow-modal\"\n\ttabindex=\"-1\">\n\t<div class=\"modal-dialog\">\n\t\t<div class=\"modal-content text-center\">\n\t\t\t<div class=\"modal-body\">\n\t\t\t\t<iframe id=\"shopping-list-stock-add-workflow-purchase-form-frame\"\n\t\t\t\t\tclass=\"embed-responsive\"\n\t\t\t\t\tsrc=\"\"></iframe>\n\t\t\t</div>\n\t\t\t<div class=\"modal-footer\">\n\t\t\t\t<span id=\"shopping-list-stock-add-workflow-purchase-item-count\"\n\t\t\t\t\tclass=\"d-none mr-auto\"></span>\n\t\t\t\t<button id=\"shopping-list-stock-add-workflow-skip-button\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"btn btn-primary\"><i class=\"fas fa-angle-double-right\"></i> {{ $__t('Skip') }}</button>\n\t\t\t\t<button type=\"button\"\n\t\t\t\t\tclass=\"btn btn-secondary\"\n\t\t\t\t\tdata-dismiss=\"modal\">{{ $__t('Close') }}</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"d-none d-print-block\">\n\t<h1 class=\"text-center\">\n\t\t<img src=\"{{ $U('/img/grocy_logo.svg?v=', true) }}{{ $version }}\"\n\t\t\theight=\"30\"\n\t\t\tclass=\"d-print-flex mx-auto\">\n\t\t{{ $__t(\"Shopping list\") }}\n\t</h1>\n\t@if (FindObjectInArrayByPropertyValue($shoppingLists, 'id', $selectedShoppingListId)->name != $__t(\"Shopping list\"))\n\t<h3 class=\"text-center\">\n\t\t{{ FindObjectInArrayByPropertyValue($shoppingLists, 'id', $selectedShoppingListId)->name }}\n\t</h3>\n\t@endif\n\t<h6 class=\"text-center mb-4\">\n\t\t{{ $__t('Time of printing') }}:\n\t\t<span class=\"d-inline print-timestamp\"></span>\n\t</h6>\n\t<div class=\"row w-75\">\n\t\t<div class=\"col\">\n\t\t\t<table class=\"table\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>{{ $__t('Product') }} / <em>{{ $__t('Note') }}</em></th>\n\t\t\t\t\t\t<th>{{ $__t('Amount') }}</th>\n\n\t\t\t\t\t\t@include('components.userfields_thead', array(\n\t\t\t\t\t\t'userfields' => $userfields\n\t\t\t\t\t\t))\n\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t@foreach($listItems as $listItem)\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t@if(!empty($listItem->product_id)) {{ FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->name }}<br>@endif<em>{!! nl2br($listItem->note) !!}</em>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{{ $listItem->amount }} @if(!empty($listItem->product_id)){{ $__n($listItem->amount, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name_plural) }}@endif\n\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t@include('components.userfields_tbody', array(\n\t\t\t\t\t\t'userfields' => $userfields,\n\t\t\t\t\t\t'userfieldValues' => FindAllObjectsInArrayByPropertyValue($userfieldValues, 'object_id', $listItem->product_id)\n\t\t\t\t\t\t))\n\n\t\t\t\t\t</tr>\n\t\t\t\t\t@endforeach\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n\t<div class=\"row w-75\">\n\t\t<div class=\"col\">\n\t\t\t<h5>{{ $__t('Notes') }}</h5>\n\t\t\t<p id=\"description-for-print\"></p>\n\t\t</div>\n\t</div>\n</div>\n@stop\n"], "fixing_code": ["@extends('layout.default')\n\n@section('title', $__t('Shopping list'))\n@section('activeNav', 'shoppinglist')\n@section('viewJsName', 'shoppinglist')\n\n@push('pageScripts')\n<script src=\"{{ $U('/node_modules/datatables.net-rowgroup/js/dataTables.rowGroup.min.js?v=', true) }}{{ $version }}\"></script>\n<script src=\"{{ $U('/node_modules/datatables.net-rowgroup-bs4/js/rowGroup.bootstrap4.min.js?v=', true) }}{{ $version }}\"></script>\n<script src=\"{{ $U('/viewjs/purchase.js?v=', true) }}{{ $version }}\"></script>\n@endpush\n\n@push('pageStyles')\n<link href=\"{{ $U('/node_modules/animate.css/animate.min.css?v=', true) }}{{ $version }}\"\n\trel=\"stylesheet\">\n<link href=\"{{ $U('/node_modules/datatables.net-rowgroup-bs4/css/rowGroup.bootstrap4.min.css?v=', true) }}{{ $version }}\"\n\trel=\"stylesheet\">\n\n<style>\n\ttr.dtrg-group {\n\t\tcursor: pointer;\n\t}\n\n</style>\n@endpush\n\n@section('content')\n<div class=\"row d-print-none hide-on-fullscreen-card\">\n\t<div class=\"col\">\n\t\t<div class=\"row\">\n\t\t\t<h2 class=\"col-sm-12 col-md-6 mb-2 title\">@yield('title')</h2>\n\t\t\t@if(GROCY_FEATURE_FLAG_SHOPPINGLIST_MULTIPLE_LISTS)\n\t\t\t<div class=\"col-sm-12 col-md-6 d-flex align-items-end flex-wrap\">\n\t\t\t\t<div class=\"d-inline-block flex-grow-1 pr-1 mb-1\">\n\t\t\t\t\t<select class=\"form-control form-control-sm\"\n\t\t\t\t\t\tid=\"selected-shopping-list\">\n\t\t\t\t\t\t@foreach($shoppingLists as $shoppingList)\n\t\t\t\t\t\t<option @if($shoppingList->id == $selectedShoppingListId) selected=\"selected\" @endif value=\"{{ $shoppingList->id }}\">{{ $shoppingList->name }}</option>\n\t\t\t\t\t\t@endforeach\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"d-inline-block mb-1\">\n\t\t\t\t\t<a class=\"btn btn-outline-dark btn-sm responsive-button\"\n\t\t\t\t\t\thref=\"{{ $U('/shoppinglist/new') }}\">\n\t\t\t\t\t\t{{ $__t('New shopping list') }}\n\t\t\t\t\t</a>\n\t\t\t\t\t<a id=\"delete-selected-shopping-list\"\n\t\t\t\t\t\tclass=\"btn btn-outline-danger btn-sm responsive-button @if($selectedShoppingListId == 1) disabled @endif\"\n\t\t\t\t\t\thref=\"#\">\n\t\t\t\t\t\t{{ $__t('Delete shopping list') }}\n\t\t\t\t\t</a>\n\t\t\t\t\t<a id=\"print-shopping-list-button\"\n\t\t\t\t\t\tclass=\"btn btn-outline-dark btn-sm responsive-button\"\n\t\t\t\t\t\thref=\"#\">\n\t\t\t\t\t\t{{ $__t('Print') }}\n\t\t\t\t\t</a>\n\t\t\t\t\t<!--<div class=\"dropdown d-inline-block\">\n\t\t\t\t\t\t\t<button class=\"btn btn-outline-dark responsive-button dropdown-toggle\" data-toggle=\"dropdown\"><i class=\"fas fa-file-export\"></i> {{ $__t('Output') }}</button>\n\t\t\t\t\t\t\t<div class=\"dropdown-menu\">\n\t\t\t\t\t\t\t\t<a id=\"print-shopping-list-button\" class=\"dropdown-item\" href=\"#\"><i class=\"fas fa-print\"></i> {{ $__t('Print') }}</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>-->\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t@else\n\t\t\t<input type=\"hidden\"\n\t\t\t\tname=\"selected-shopping-list\"\n\t\t\t\tid=\"selected-shopping-list\"\n\t\t\t\tvalue=\"1\">\n\t\t\t@endif\n\t\t</div>\n\t\t<hr>\n\t\t<p data-status-filter=\"belowminstockamount\"\n\t\t\tclass=\"normal-message status-filter-message responsive-button\">{{ $__n(count($missingProducts), '%s product is below defined min. stock amount', '%s products are below defined min. stock amount') }}</p>\n\t</div>\n</div>\n\n<div class=\"row mt-3 d-print-none hide-on-fullscreen-card\">\n\t<div class=\"col-md-12 mb-2\">\n\t\t<a class=\"btn btn-primary responsive-button btn-sm mb-1\"\n\t\t\thref=\"{{ $U('/shoppinglistitem/new?list=' . $selectedShoppingListId) }}\">\n\t\t\t{{ $__t('Add item') }}\n\t\t</a>\n\t\t<a id=\"clear-shopping-list\"\n\t\t\tclass=\"btn btn-outline-danger btn-sm mb-1 responsive-button @if($listItems->count() == 0) disabled @endif\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Clear list') }}\n\t\t</a>\n\t\t<a id=\"add-all-items-to-stock-button\"\n\t\t\tclass=\"btn btn-outline-primary btn-sm mb-1 responsive-button\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Add all list items to stock') }}\n\t\t</a>\n\t\t<a id=\"add-products-below-min-stock-amount\"\n\t\t\tclass=\"btn btn-outline-primary btn-sm mb-1 responsive-button\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Add products that are below defined min. stock amount') }}\n\t\t</a>\n\t</div>\n\t<div class=\"col-xs-12 col-md-5\">\n\t\t<div class=\"input-group mb-3\">\n\t\t\t<div class=\"input-group-prepend\">\n\t\t\t\t<span class=\"input-group-text\"><i class=\"fas fa-search\"></i></span>\n\t\t\t</div>\n\t\t\t<input type=\"text\"\n\t\t\t\tid=\"search\"\n\t\t\t\tclass=\"form-control\"\n\t\t\t\tplaceholder=\"{{ $__t('Search') }}\">\n\t\t</div>\n\t</div>\n\t<div class=\"col-xs-12 col-md-4 col-lg-5\">\n\t\t<div class=\"input-group mb-3\">\n\t\t\t<div class=\"input-group-prepend\">\n\t\t\t\t<span class=\"input-group-text\"><i class=\"fas fa-filter\"></i></span>\n\t\t\t</div>\n\t\t\t<select class=\"form-control\"\n\t\t\t\tid=\"status-filter\">\n\t\t\t\t<option value=\"all\">{{ $__t('All') }}</option>\n\t\t\t\t<option value=\"belowminstockamount\">{{ $__t('Below min. stock amount') }}</option>\n\t\t\t\t<option value=\"xxUNDONExx\">{{ $__t('Only undone items') }}</option>\n\t\t\t</select>\n\t\t</div>\n\t</div>\n\t<div class=\"col-xs-12 col-md-3 col-lg-2 mb-3\">\n\t\t<a id=\"shopping-list-compact-view-button\"\n\t\t\tclass=\"btn btn-outline-dark responsive-button switch-view-mode-button w-100\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Compact view') }}\n\t\t</a>\n\t</div>\n</div>\n\n<div id=\"shoppinglist-main\"\n\tclass=\"row d-print-none\">\n\t<div class=\"@if(boolval($userSettings['shopping_list_show_calendar'])) col-xs-12 col-md-8 @else col-12 @endif pb-3\">\n\t\t<a id=\"shopping-list-normal-view-button\"\n\t\t\tclass=\"btn btn-outline-dark btn-block switch-view-mode-button d-none\"\n\t\t\thref=\"#\">\n\t\t\t{{ $__t('Normal view') }}\n\t\t</a>\n\t\t<table id=\"shoppinglist-table\"\n\t\t\tclass=\"table table-sm table-striped dt-responsive\">\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th class=\"border-right\"></th>\n\t\t\t\t\t<th>{{ $__t('Product') }} / <em>{{ $__t('Note') }}</em></th>\n\t\t\t\t\t<th>{{ $__t('Amount') }}</th>\n\t\t\t\t\t<th class=\"d-none\">Hiden product group</th>\n\t\t\t\t\t<th class=\"d-none\">Hidden status</th>\n\n\t\t\t\t\t@include('components.userfields_thead', array(\n\t\t\t\t\t'userfields' => $userfields\n\t\t\t\t\t))\n\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody class=\"d-none\">\n\t\t\t\t@foreach($listItems as $listItem)\n\t\t\t\t<tr id=\"shoppinglistitem-{{ $listItem->id }}-row\"\n\t\t\t\t\tclass=\"@if(FindObjectInArrayByPropertyValue($missingProducts, 'id', $listItem->product_id) !== null) table-info @endif @if($listItem->done == 1) text-muted text-strike-through @endif\">\n\t\t\t\t\t<td class=\"fit-content border-right\">\n\t\t\t\t\t\t<a class=\"btn btn-success btn-sm order-listitem-button\"\n\t\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\t\tdata-item-id=\"{{ $listItem->id }}\"\n\t\t\t\t\t\t\tdata-item-done=\"{{ $listItem->done }}\"\n\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\n\t\t\t\t\t\t\tdata-placement=\"right\"\n\t\t\t\t\t\t\ttitle=\"{{ $__t('Mark this item as done') }}\">\n\t\t\t\t\t\t\t<i class=\"fas fa-check\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a class=\"btn btn-sm btn-info\"\n\t\t\t\t\t\t\thref=\"{{ $U('/shoppinglistitem/') . $listItem->id . '?list=' . $selectedShoppingListId }}\"\n\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\n\t\t\t\t\t\t\tdata-placement=\"right\"\n\t\t\t\t\t\t\ttitle=\"{{ $__t('Edit this item') }}\">\n\t\t\t\t\t\t\t<i class=\"fas fa-edit\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a class=\"btn btn-sm btn-danger shoppinglist-delete-button\"\n\t\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\t\tdata-shoppinglist-id=\"{{ $listItem->id }}\"\n\t\t\t\t\t\t\tdata-toggle=\"tooltip\"\n\t\t\t\t\t\t\tdata-placement=\"right\"\n\t\t\t\t\t\t\ttitle=\"{{ $__t('Delete this item') }}\">\n\t\t\t\t\t\t\t<i class=\"fas fa-trash\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a class=\"btn btn-sm btn-primary @if(empty($listItem->product_id)) disabled @else shopping-list-stock-add-workflow-list-item-button @endif\"\n\t\t\t\t\t\t\thref=\"{{ $U('/purchase?embedded&flow=shoppinglistitemtostock&product=') }}{{ $listItem->product_id }}&amount={{ $listItem->amount }}&listitemid={{ $listItem->id }}\"\n\t\t\t\t\t\t\t@if(!empty($listItem->product_id)) data-toggle=\"tooltip\" title=\"{{ $__t('Add %1$s of %2$s to stock', $listItem->amount . ' ' . $__n($listItem->amount, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name_plural), FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->name, $listItem->amount) }}\" @endif>\n\t\t\t\t\t\t\t<i class=\"fas fa-box\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t@if(!empty($listItem->product_id)) {{ FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->name }}<br>@endif<em>{!! nl2br(e($listItem->note)) !!}</em>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class=\"locale-number locale-number-quantity-amount\">{{ $listItem->amount }}</span> @if(!empty($listItem->product_id)){{ $__n($listItem->amount, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name_plural) }}@endif\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class=\"d-none\">\n\t\t\t\t\t\t@if(!empty(FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->product_group_id)) {{ FindObjectInArrayByPropertyValue($productGroups, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->product_group_id)->name }} @else <span class=\"font-italic font-weight-light\">{{ $__t('Ungrouped') }}</span> @endif\n\t\t\t\t\t</td>\n\t\t\t\t\t<td id=\"shoppinglistitem-{{ $listItem->id }}-status-info\"\n\t\t\t\t\t\tclass=\"d-none\">\n\t\t\t\t\t\t@if(FindObjectInArrayByPropertyValue($missingProducts, 'id', $listItem->product_id) !== null) belowminstockamount @endif\n\t\t\t\t\t\t@if($listItem->done != 1) xxUNDONExx @endif\n\t\t\t\t\t</td>\n\n\t\t\t\t\t@include('components.userfields_tbody', array(\n\t\t\t\t\t'userfields' => $userfields,\n\t\t\t\t\t'userfieldValues' => FindAllObjectsInArrayByPropertyValue($userfieldValues, 'object_id', $listItem->product_id)\n\t\t\t\t\t))\n\n\t\t\t\t</tr>\n\t\t\t\t@endforeach\n\t\t\t</tbody>\n\t\t</table>\n\t</div>\n\n\t@if(boolval($userSettings['shopping_list_show_calendar']))\n\t<div class=\"col-xs-12 col-md-4 mt-md-2 d-print-none\">\n\t\t@include('components.calendarcard')\n\t</div>\n\t@endif\n\n\t<div class=\"@if(boolval($userSettings['shopping_list_show_calendar'])) col-xs-12 col-md-8 @else col-12 @endif d-print-none pt-2\">\n\t\t<div class=\"form-group\">\n\t\t\t<label class=\"text-larger font-weight-bold\"\n\t\t\t\tfor=\"notes\">{{ $__t('Notes') }}</label>\n\t\t\t<a id=\"save-description-button\"\n\t\t\t\tclass=\"btn btn-success btn-sm ml-1 mb-2\"\n\t\t\t\thref=\"#\">{{ $__t('Save') }}</a>\n\t\t\t<a id=\"clear-description-button\"\n\t\t\t\tclass=\"btn btn-danger btn-sm ml-1 mb-2\"\n\t\t\t\thref=\"#\">{{ $__t('Clear') }}</a>\n\t\t\t<textarea class=\"form-control wysiwyg-editor\"\n\t\t\t\tid=\"description\"\n\t\t\t\tname=\"description\">{{ FindObjectInArrayByPropertyValue($shoppingLists, 'id', $selectedShoppingListId)->description }}</textarea>\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"modal fade\"\n\tid=\"shopping-list-stock-add-workflow-modal\"\n\ttabindex=\"-1\">\n\t<div class=\"modal-dialog\">\n\t\t<div class=\"modal-content text-center\">\n\t\t\t<div class=\"modal-body\">\n\t\t\t\t<iframe id=\"shopping-list-stock-add-workflow-purchase-form-frame\"\n\t\t\t\t\tclass=\"embed-responsive\"\n\t\t\t\t\tsrc=\"\"></iframe>\n\t\t\t</div>\n\t\t\t<div class=\"modal-footer\">\n\t\t\t\t<span id=\"shopping-list-stock-add-workflow-purchase-item-count\"\n\t\t\t\t\tclass=\"d-none mr-auto\"></span>\n\t\t\t\t<button id=\"shopping-list-stock-add-workflow-skip-button\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"btn btn-primary\"><i class=\"fas fa-angle-double-right\"></i> {{ $__t('Skip') }}</button>\n\t\t\t\t<button type=\"button\"\n\t\t\t\t\tclass=\"btn btn-secondary\"\n\t\t\t\t\tdata-dismiss=\"modal\">{{ $__t('Close') }}</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<div class=\"d-none d-print-block\">\n\t<h1 class=\"text-center\">\n\t\t<img src=\"{{ $U('/img/grocy_logo.svg?v=', true) }}{{ $version }}\"\n\t\t\theight=\"30\"\n\t\t\tclass=\"d-print-flex mx-auto\">\n\t\t{{ $__t(\"Shopping list\") }}\n\t</h1>\n\t@if (FindObjectInArrayByPropertyValue($shoppingLists, 'id', $selectedShoppingListId)->name != $__t(\"Shopping list\"))\n\t<h3 class=\"text-center\">\n\t\t{{ FindObjectInArrayByPropertyValue($shoppingLists, 'id', $selectedShoppingListId)->name }}\n\t</h3>\n\t@endif\n\t<h6 class=\"text-center mb-4\">\n\t\t{{ $__t('Time of printing') }}:\n\t\t<span class=\"d-inline print-timestamp\"></span>\n\t</h6>\n\t<div class=\"row w-75\">\n\t\t<div class=\"col\">\n\t\t\t<table class=\"table\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>{{ $__t('Product') }} / <em>{{ $__t('Note') }}</em></th>\n\t\t\t\t\t\t<th>{{ $__t('Amount') }}</th>\n\n\t\t\t\t\t\t@include('components.userfields_thead', array(\n\t\t\t\t\t\t'userfields' => $userfields\n\t\t\t\t\t\t))\n\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t@foreach($listItems as $listItem)\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t@if(!empty($listItem->product_id)) {{ FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->name }}<br>@endif<em>{!! nl2br(e($listItem->note)) !!}</em>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t{{ $listItem->amount }} @if(!empty($listItem->product_id)){{ $__n($listItem->amount, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name, FindObjectInArrayByPropertyValue($quantityunits, 'id', FindObjectInArrayByPropertyValue($products, 'id', $listItem->product_id)->qu_id_purchase)->name_plural) }}@endif\n\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t@include('components.userfields_tbody', array(\n\t\t\t\t\t\t'userfields' => $userfields,\n\t\t\t\t\t\t'userfieldValues' => FindAllObjectsInArrayByPropertyValue($userfieldValues, 'object_id', $listItem->product_id)\n\t\t\t\t\t\t))\n\n\t\t\t\t\t</tr>\n\t\t\t\t\t@endforeach\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n\t<div class=\"row w-75\">\n\t\t<div class=\"col\">\n\t\t\t<h5>{{ $__t('Notes') }}</h5>\n\t\t\t<p id=\"description-for-print\"></p>\n\t\t</div>\n\t</div>\n</div>\n@stop\n"], "filenames": ["views/shoppinglist.blade.php"], "buggy_code_start_loc": [193], "buggy_code_end_loc": [300], "fixing_code_start_loc": [193], "fixing_code_end_loc": [300], "type": "CWE-79", "message": "Versions of Grocy <= 2.7.1 are vulnerable to Cross-Site Scripting via the Create Shopping List module, that is rendered upon deleting that Shopping List. The issue was also found in users, batteries, chores, equipment, locations, quantity units, shopping locations, tasks, taskcategories, product groups, recipes and products. Authentication is required to exploit these issues and Grocy should not be publicly exposed. The linked reference details a proof-of-concept.", "other": {"cve": {"id": "CVE-2020-15253", "sourceIdentifier": "security-advisories@github.com", "published": "2020-10-14T19:15:13.853", "lastModified": "2022-10-18T20:20:23.657", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Versions of Grocy <= 2.7.1 are vulnerable to Cross-Site Scripting via the Create Shopping List module, that is rendered upon deleting that Shopping List. The issue was also found in users, batteries, chores, equipment, locations, quantity units, shopping locations, tasks, taskcategories, product groups, recipes and products. Authentication is required to exploit these issues and Grocy should not be publicly exposed. The linked reference details a proof-of-concept."}, {"lang": "es", "value": "Las versiones de Grocy anteriores a 2.7.1 incluy\u00e9ndola, son vulnerables a un ataque de tipo Cross Site Scripting por medio del m\u00f3dulo Create Shopping List, que es procesado al eliminar esa Lista de Compras.&#xa0;El problema tambi\u00e9n fue encontrado en usuarios, bater\u00edas, quehaceres, equipos, ubicaciones, unidades de cantidad, ubicaciones de compras, tareas, categor\u00edas de tareas, grupos de productos, recetas y productos.&#xa0;Es requerida una autenticaci\u00f3n para explotar estos problemas y Grocy no deber\u00eda ser expuesto p\u00fablicamente.&#xa0;La referencia vinculada detalla una prueba de concepto"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 4.8, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.7, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:C/C:H/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 7.3, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.0, "impactScore": 5.8}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:grocy:grocy:*:*:*:*:*:*:*:*", "versionEndIncluding": "2.7.1", "matchCriteriaId": "8A2346AA-2AF0-4B7B-9142-F2F30F79DD26"}]}]}], "references": [{"url": "https://github.com/grocy/grocy/commit/0624b0df594a4353ef25e6b1874565ea52ce7772", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/grocy/grocy/commit/0df2590de27c60c18b7db6e056347bd2aff5a887", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/grocy/grocy/issues/996", "source": "security-advisories@github.com", "tags": ["Exploit", "Issue Tracking", "Third Party Advisory"]}, {"url": "https://github.com/grocy/grocy/security/advisories/GHSA-7f37-2fjr-v9p7", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}, {"url": "https://www.exploit-db.com/exploits/48792", "source": "security-advisories@github.com", "tags": ["Exploit", "Third Party Advisory", "VDB Entry"]}]}, "github_commit_url": "https://github.com/grocy/grocy/commit/0624b0df594a4353ef25e6b1874565ea52ce7772"}}