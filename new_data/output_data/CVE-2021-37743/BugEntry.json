{"buggy_code": ["<?php\n$indexOptions = array(\n    'containerId' => 'elements',\n    'data' => array(\n        'data' => $elements,\n        'top_bar' => array(\n            'children' => array(\n                array(\n                    'children' => array(\n                        array(\n                            'active' => $context === 'all',\n                            'text' => __('Tabular view'),\n                            'onClick' => 'runIndexQuickFilter',\n                            'onClickParams' => [\n                                h($clusterId) . '/context:all',\n                                $baseurl . '/galaxy_elements/index',\n                                '#elements_content'\n                            ],\n                        ),\n                        array(\n                            'active' => $context === 'JSONView',\n                            'text' => __('JSON view'),\n                            'onClick' => 'runIndexQuickFilter',\n                            'onClickParams' => [\n                                h($clusterId) . '/context:JSONView',\n                                $baseurl . '/galaxy_elements/index',\n                                '#elements_content'\n                            ],\n                        ),\n                    )\n                ),\n                array(\n                    'type' => 'simple',\n                    'children' => array(\n                        array(\n                            'onClick' => 'openGenericModal',\n                            'onClickParams' => [$baseurl . '/galaxy_elements/flattenJson/' . h($clusterId)],\n                            'active' => true,\n                            'text' => __('Add JSON as cluster\\'s elements'),\n                            'title' => __('The provided JSON will be converted into Galaxy Cluster Elements'),\n                            'fa-icon' => 'plus',\n                            'requirement' => $canModify && ($context === 'JSONView'),\n                        ),\n                    )\n                ),\n            )\n        ),\n        'primary_id_path' => 'GalaxyElement.id',\n        'fields' => array(\n            array(\n                'name' => __('Key'),\n                'data_path' => 'GalaxyElement.key',\n                'sort' => 'key',\n            ),\n            array(\n                'name' => __('Value'),\n                'data_path' => 'GalaxyElement.value',\n                'sort' => 'value',\n                'element' => 'galaxy_element_value',\n                'elementParams' => array(\n                    'data_path_key' =>'GalaxyElement.key'\n                ),\n            ),\n        ),\n        'actions' => array(\n            array(\n                'title' => __('Delete'),\n                'icon' => 'trash',\n                'onclick' => 'simplePopup(\\'' . $baseurl . '/galaxy_elements/delete/[onclick_params_data_path]\\');',\n                'onclick_params_data_path' => 'GalaxyElement.id',\n                'requirement' => $canModify,\n            )\n        )\n    )\n);\n\nif ($context == 'JSONView') {\n    $indexOptions['data']['fields'] = [];\n    $indexOptions['data']['data'] = [];\n    $indexOptions['data']['skip_pagination'] = true;\n    $indexOptions['data']['actions'] = [];\n}\n\necho $this->element('/genericElements/IndexTable/index_table', $indexOptions);\nif ($context == 'JSONView') {\n    echo sprintf('<div id=\"elementJSONDiv\" class=\"well well-small\">%s</div>', json_encode($JSONElements));\n}\n?>\n\n<script>\n    var $jsondiv = $('#elementJSONDiv');\n    if ($jsondiv.length > 0) {\n        $jsondiv.html(syntaxHighlightJson($jsondiv.text(), 8));\n    }\n</script>\n"], "fixing_code": ["<?php\n$indexOptions = array(\n    'containerId' => 'elements',\n    'data' => array(\n        'data' => $elements,\n        'top_bar' => array(\n            'children' => array(\n                array(\n                    'children' => array(\n                        array(\n                            'active' => $context === 'all',\n                            'text' => __('Tabular view'),\n                            'onClick' => 'runIndexQuickFilter',\n                            'onClickParams' => [\n                                h($clusterId) . '/context:all',\n                                $baseurl . '/galaxy_elements/index',\n                                '#elements_content'\n                            ],\n                        ),\n                        array(\n                            'active' => $context === 'JSONView',\n                            'text' => __('JSON view'),\n                            'onClick' => 'runIndexQuickFilter',\n                            'onClickParams' => [\n                                h($clusterId) . '/context:JSONView',\n                                $baseurl . '/galaxy_elements/index',\n                                '#elements_content'\n                            ],\n                        ),\n                    )\n                ),\n                array(\n                    'type' => 'simple',\n                    'children' => array(\n                        array(\n                            'onClick' => 'openGenericModal',\n                            'onClickParams' => [$baseurl . '/galaxy_elements/flattenJson/' . h($clusterId)],\n                            'active' => true,\n                            'text' => __('Add JSON as cluster\\'s elements'),\n                            'title' => __('The provided JSON will be converted into Galaxy Cluster Elements'),\n                            'fa-icon' => 'plus',\n                            'requirement' => $canModify && ($context === 'JSONView'),\n                        ),\n                    )\n                ),\n            )\n        ),\n        'primary_id_path' => 'GalaxyElement.id',\n        'fields' => array(\n            array(\n                'name' => __('Key'),\n                'data_path' => 'GalaxyElement.key',\n                'sort' => 'key',\n            ),\n            array(\n                'name' => __('Value'),\n                'data_path' => 'GalaxyElement.value',\n                'sort' => 'value',\n                'element' => 'galaxy_element_value',\n                'elementParams' => array(\n                    'data_path_key' =>'GalaxyElement.key'\n                ),\n            ),\n        ),\n        'actions' => array(\n            array(\n                'title' => __('Delete'),\n                'icon' => 'trash',\n                'onclick' => 'simplePopup(\\'' . $baseurl . '/galaxy_elements/delete/[onclick_params_data_path]\\');',\n                'onclick_params_data_path' => 'GalaxyElement.id',\n                'requirement' => $canModify,\n            )\n        )\n    )\n);\n\nif ($context == 'JSONView') {\n    $indexOptions['data']['fields'] = [];\n    $indexOptions['data']['data'] = [];\n    $indexOptions['data']['skip_pagination'] = true;\n    $indexOptions['data']['actions'] = [];\n}\n\necho $this->element('/genericElements/IndexTable/index_table', $indexOptions);\nif ($context == 'JSONView') {\n    echo sprintf('<div id=\"elementJSONDiv\" class=\"well well-small\">%s</div>', json_encode(h($JSONElements)));\n}\n?>\n\n<script>\n    var $jsondiv = $('#elementJSONDiv');\n    if ($jsondiv.length > 0) {\n        $jsondiv.html(syntaxHighlightJson($jsondiv.text(), 8));\n    }\n</script>\n"], "filenames": ["app/View/GalaxyElements/ajax/index.ctp"], "buggy_code_start_loc": [86], "buggy_code_end_loc": [87], "fixing_code_start_loc": [86], "fixing_code_end_loc": [87], "type": "CWE-79", "message": "app/View/GalaxyElements/ajax/index.ctp in MISP 2.4.147 allows Stored XSS when viewing galaxy cluster elements in JSON format.", "other": {"cve": {"id": "CVE-2021-37743", "sourceIdentifier": "cve@mitre.org", "published": "2021-07-30T15:15:09.290", "lastModified": "2021-08-02T20:58:25.350", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "app/View/GalaxyElements/ajax/index.ctp in MISP 2.4.147 allows Stored XSS when viewing galaxy cluster elements in JSON format."}, {"lang": "es", "value": "Un archivo app/View/GalaxyElements/ajax/index.ctp en MISP versi\u00f3n 2.4.147, permite un ataque de tipo XSS almacenado cuando se visualizan los elementos del cluster galaxy en formato JSON"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 5.4, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.3, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:S/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "SINGLE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 3.5}, "baseSeverity": "LOW", "exploitabilityScore": 6.8, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp:misp:2.4.147:*:*:*:*:*:*:*", "matchCriteriaId": "8F7E38EF-BB9F-4739-B2A8-62BF4A7ABC77"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/f318f7c0ddac7dfd2b1f246fd8f488d9dfc3a4bf", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/f318f7c0ddac7dfd2b1f246fd8f488d9dfc3a4bf"}}