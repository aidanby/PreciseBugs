{"buggy_code": ["<?php\n/* Pi-hole: A black hole for Internet advertisements\n*  (c) 2017 Pi-hole, LLC (https://pi-hole.net)\n*  Network-wide ad blocking via your own hardware.\n*\n*  This file is copyright under the latest version of the EUPL.\n*  Please see LICENSE file for your rights under this license. */\n\n// Credit: http://stackoverflow.com/a/4694816/2087442\n// Modified because of https://github.com/pi-hole/AdminLTE/pull/533\nini_set(\"pcre.recursion_limit\", 1500);\nfunction validDomain($domain_name, &$message = NULL)\n{\n\tif(!preg_match(\"/^((-|_)*[a-z\\d]((-|_)*[a-z\\d])*(-|_)*)(\\.(-|_)*([a-z\\d]((-|_)*[a-z\\d])*))*$/i\", $domain_name)) {\n\t\tif($message !== NULL)\n\t\t\t$message = \"it contains invalid characters\";\n\t\treturn false;\n\t}\n\tif(!preg_match(\"/^.{1,253}$/\", $domain_name)) {\n\t\tif($message !== NULL)\n\t\t\t$message = \"its length is invalid\";\n\t\treturn false;\n\t}\n\tif(!preg_match(\"/^[^\\.]{1,63}(\\.[^\\.]{1,63})*$/\", $domain_name)) {\n\t\tif($message !== NULL)\n\t\t\t$message = \"at least one label is of invalid length\";\n\t\treturn false;\n\t}\n\n\t// everything is okay\n\treturn true;\n}\n\nfunction validDomainWildcard($domain_name)\n{\n\t// There has to be either no or at most one \"*\" at the beginning of a line\n\t$validChars = preg_match(\"/^((\\*\\.)?[_a-z\\d](-*[_a-z\\d])*)(\\.([_a-z\\d](-*[a-z\\d])*))*(\\.([_a-z\\d])*)*$/i\", $domain_name);\n\t$lengthCheck = preg_match(\"/^.{1,253}$/\", $domain_name);\n\t$labelLengthCheck = preg_match(\"/^[^\\.]{1,63}(\\.[^\\.]{1,63})*$/\", $domain_name);\n\treturn ( $validChars && $lengthCheck && $labelLengthCheck ); //length of each label\n}\n\nfunction validIP($address){\n\tif (preg_match('/[.:0]/', $address) && !preg_match('/[1-9a-f]/', $address)) {\n\t\t// Test if address contains either `:` or `0` but not 1-9 or a-f\n\t\treturn false;\n\t}\n\treturn !filter_var($address, FILTER_VALIDATE_IP) === false;\n}\n\nfunction validCIDRIP($address){\n\t// This validation strategy has been taken from ../js/groups-common.js\n\t$isIPv6 = strpos($address, \":\") !== false;\n\tif($isIPv6) {\n\t\t// One IPv6 element is 16bit: 0000 - FFFF\n\t\t$v6elem = \"[0-9A-Fa-f]{1,4}\";\n\t\t// CIDR for IPv6 is any multiple of 4 from 4 up to 128 bit\n\t\t$v6cidr = \"(4\";\n\t\tfor ($i=8; $i <= 128; $i+=4) {\n\t\t\t$v6cidr .= \"|$i\";\n\t\t}\n\t\t$v6cidr .= \")\";\n\t\t$validator = \"/^(((?:$v6elem))((?::$v6elem))*::((?:$v6elem))((?::$v6elem))*|((?:$v6elem))((?::$v6elem)){7})\\/$v6cidr$/\";\n\t\treturn preg_match($validator, $address);\n\t} else {\n\t\t// One IPv4 element is 8bit: 0 - 256\n\t\t$v4elem = \"(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\";\n\t\t// Note that rev-server accepts only /8, /16, /24, and /32\n\t\t$allowedv4cidr = \"(8|16|24|32)\";\n\t\t$validator = \"/^$v4elem\\.$v4elem\\.$v4elem\\.$v4elem\\/$allowedv4cidr$/\";\n\t\treturn preg_match($validator, $address);\n\t}\n}\n\nfunction validMAC($mac_addr)\n{\n  // Accepted input format: 00:01:02:1A:5F:FF (characters may be lower case)\n  return !filter_var($mac_addr, FILTER_VALIDATE_MAC) === false;\n}\n\nfunction validEmail($email)\n{\n\treturn filter_var($email, FILTER_VALIDATE_EMAIL)\n\t\t// Make sure that the email does not contain special characters which\n\t\t// may be used to execute shell commands, even though they may be valid\n\t\t// in an email address. If the escaped email does not equal the original\n\t\t// email, it is not safe to store in setupVars.\n\t\t&& escapeshellcmd($email) === $email;\n}\n\nfunction get_ip_type($ip)\n{\n    return  filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4) ? 4 :\n           (filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_IPV6) ? 6 :\n            0);\n}\n\nfunction checkfile($filename) {\n    if(is_readable($filename))\n    {\n        return $filename;\n    }\n    else\n    {\n        // substitute dummy file\n        return \"/dev/null\";\n    }\n}\n\n// Credit: http://php.net/manual/en/function.hash-equals.php#119576\nif(!function_exists('hash_equals')) {\n    function hash_equals($known_string, $user_string) {\n        $ret = 0;\n\n        if (strlen($known_string) !== strlen($user_string)) {\n         $user_string = $known_string;\n         $ret = 1;\n        }\n\n        $res = $known_string ^ $user_string;\n\n        for ($i = strlen($res) - 1; $i >= 0; --$i) {\n         $ret |= ord($res[$i]);\n        }\n\n        return !$ret;\n   }\n}\n\n/**\n * More safely execute a command with pihole shell script.\n *\n * For example,\n *\n *   pihole_execute(\"-h\");\n *\n * would execute command\n *\n *   sudo pihole -h\n *\n * and returns output of that command as a string.\n *\n * @param $argument_string String of arguments to run pihole with.\n * @param $error_on_failure If true, a warning is raised if command execution fails. Defaults to true.\n */\nfunction pihole_execute($argument_string, $error_on_failure = true) {\n    $escaped = escapeshellcmd($argument_string);\n    $output = null;\n    $return_status = -1;\n    $command = \"sudo pihole \" . $escaped;\n    exec($command, $output, $return_status);\n    if($return_status !== 0)\n    {\n        trigger_error(\"Executing {$command} failed.\", E_USER_WARNING);\n    }\n    return $output;\n}\n\n// Custom DNS\n$customDNSFile = \"/etc/pihole/custom.list\";\n\nfunction echoCustomDNSEntries()\n{\n    $entries = getCustomDNSEntries();\n\n    $data = [];\n    foreach ($entries as $entry)\n        $data[] = [ $entry->domain, $entry->ip ];\n\n    return [ \"data\" => $data ];\n}\n\nfunction getCustomDNSEntries()\n{\n    global $customDNSFile;\n\n    $entries = [];\n\n    $handle = fopen($customDNSFile, \"r\");\n    if ($handle)\n    {\n        while (($line = fgets($handle)) !== false) {\n            $line = str_replace(\"\\r\",\"\", $line);\n            $line = str_replace(\"\\n\",\"\", $line);\n            $explodedLine = explode (\" \", $line);\n\n            if (count($explodedLine) != 2)\n                continue;\n\n            $data = new \\stdClass();\n            $data->ip = $explodedLine[0];\n            $data->domain = $explodedLine[1];\n            $entries[] = $data;\n        }\n\n        fclose($handle);\n    }\n\n    return $entries;\n}\n\nfunction addCustomDNSEntry($ip=\"\", $domain=\"\", $json=true)\n{\n    try\n    {\n        if(isset($_REQUEST['ip']))\n            $ip = trim($_REQUEST['ip']);\n\n        if(isset($_REQUEST['domain']))\n            $domain = trim($_REQUEST['domain']);\n\n        if (empty($ip))\n            return returnError(\"IP must be set\", $json);\n\n        $ipType = get_ip_type($ip);\n\n        if (!$ipType)\n            return returnError(\"IP must be valid\", $json);\n\n        if (empty($domain))\n            return returnError(\"Domain must be set\", $json);\n\n        if (!validDomain($domain))\n            return returnError(\"Domain must be valid\", $json);\n\n        // Only check for duplicates if adding new records from the web UI (not through Teleporter)\n        if(isset($_REQUEST['ip']) || isset($_REQUEST['domain']))\n        {\n            $existingEntries = getCustomDNSEntries();\n            foreach ($existingEntries as $entry)\n                if ($entry->domain == $domain && get_ip_type($entry->ip) == $ipType)\n                    return returnError(\"This domain already has a custom DNS entry for an IPv\" . $ipType, $json);\n        }\n\n        // Add record\n        pihole_execute(\"-a addcustomdns \".$ip.\" \".$domain);\n\n        return returnSuccess(\"\", $json);\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage(), $json);\n    }\n}\n\nfunction deleteCustomDNSEntry()\n{\n    try\n    {\n        $ip = !empty($_REQUEST['ip']) ? $_REQUEST['ip']: \"\";\n        $domain = !empty($_REQUEST['domain']) ? $_REQUEST['domain']: \"\";\n\n        if (empty($ip))\n            return returnError(\"IP must be set\");\n\n        if (empty($domain))\n            return returnError(\"Domain must be set\");\n\n        $existingEntries = getCustomDNSEntries();\n\n        $found = false;\n        foreach ($existingEntries as $entry)\n            if ($entry->domain == $domain)\n                if ($entry->ip == $ip) {\n                    $found = true;\n                    break;\n                }\n\n        if (!$found)\n            return returnError(\"This domain/ip association does not exist\");\n\n        pihole_execute(\"-a removecustomdns \".$ip.\" \".$domain);\n\n        return returnSuccess();\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage());\n    }\n}\n\nfunction deleteAllCustomDNSEntries()\n{\n    if (isset($customDNSFile))\n    {\n        $handle = fopen($customDNSFile, \"r\");\n        if ($handle)\n        {\n            try\n            {\n                while (($line = fgets($handle)) !== false) {\n                    $line = str_replace(\"\\r\",\"\", $line);\n                    $line = str_replace(\"\\n\",\"\", $line);\n                    $explodedLine = explode (\" \", $line);\n\n                    if (count($explodedLine) != 2)\n                        continue;\n\n                    $ip = $explodedLine[0];\n                    $domain = $explodedLine[1];\n\n                    pihole_execute(\"-a removecustomdns \".$ip.\" \".$domain);\n                }\n            }\n            catch (\\Exception $ex)\n            {\n                return returnError($ex->getMessage());\n            }\n\n            fclose($handle);\n        }\n    }\n\n    return returnSuccess();\n}\n\n// CNAME\n$customCNAMEFile = \"/etc/dnsmasq.d/05-pihole-custom-cname.conf\";\n\nfunction echoCustomCNAMEEntries()\n{\n    $entries = getCustomCNAMEEntries();\n\n    $data = [];\n    foreach ($entries as $entry)\n        $data[] = [ $entry->domain, $entry->target ];\n\n    return [ \"data\" => $data ];\n}\n\nfunction getCustomCNAMEEntries()\n{\n    global $customCNAMEFile;\n\n    $entries = [];\n\n    if (!file_exists($customCNAMEFile)) return $entries;\n\n    $handle = fopen($customCNAMEFile, \"r\");\n    if ($handle)\n    {\n        while (($line = fgets($handle)) !== false) {\n            $line = str_replace(\"cname=\",\"\", $line);\n            $line = str_replace(\"\\r\",\"\", $line);\n            $line = str_replace(\"\\n\",\"\", $line);\n            $explodedLine = explode (\",\", $line);\n\n            if (count($explodedLine) <= 1)\n                continue;\n\n            $data = new \\stdClass();\n            $data->domains = array_slice($explodedLine, 0, -1);\n            $data->domain = implode(\",\", $data->domains);\n            $data->target = $explodedLine[count($explodedLine)-1];\n            $entries[] = $data;\n        }\n\n        fclose($handle);\n    }\n\n    return $entries;\n}\n\nfunction addCustomCNAMEEntry($domain=\"\", $target=\"\", $json=true)\n{\n    try\n    {\n        if(isset($_REQUEST['domain']))\n            $domain = $_REQUEST['domain'];\n\n        if(isset($_REQUEST['target']))\n            $target = trim($_REQUEST['target']);\n\n        if (empty($domain))\n            return returnError(\"Domain must be set\", $json);\n\n        if (empty($target))\n            return returnError(\"Target must be set\", $json);\n\n        if (!validDomain($target))\n            return returnError(\"Target must be valid\", $json);\n\n        // Check if each submitted domain is valid\n        $domains = array_map('trim', explode(\",\", $domain));\n        foreach ($domains as $d) {\n            if (!validDomain($d))\n                return returnError(\"Domain '$d' is not valid\", $json);\n        }\n\n        $existingEntries = getCustomCNAMEEntries();\n\n        // Check if a record for one of the domains already exists\n        foreach ($existingEntries as $entry)\n            foreach ($domains as $d)\n                if (in_array($d, $entry->domains))\n                    return returnError(\"There is already a CNAME record for '$d'\", $json);\n\n        pihole_execute(\"-a addcustomcname \".$domain.\" \".$target);\n\n        return returnSuccess(\"\", $json);\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage(), $json);\n    }\n}\n\nfunction deleteCustomCNAMEEntry()\n{\n    try\n    {\n        $target = !empty($_REQUEST['target']) ? $_REQUEST['target']: \"\";\n        $domain = !empty($_REQUEST['domain']) ? $_REQUEST['domain']: \"\";\n\n        if (empty($target))\n            return returnError(\"Target must be set\");\n\n        if (empty($domain))\n            return returnError(\"Domain must be set\");\n\n        $existingEntries = getCustomCNAMEEntries();\n\n        $found = false;\n        foreach ($existingEntries as $entry)\n            if ($entry->domain == $domain)\n                if ($entry->target == $target) {\n                    $found = true;\n                    break;\n                }\n\n        if (!$found)\n            return returnError(\"This domain/ip association does not exist\");\n\n        pihole_execute(\"-a removecustomcname \".$domain.\" \".$target);\n\n        return returnSuccess();\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage());\n    }\n}\n\nfunction deleteAllCustomCNAMEEntries()\n{\n    try\n    {\n        $existingEntries = getCustomCNAMEEntries();\n\n        foreach ($existingEntries as $entry) {\n            pihole_execute(\"-a removecustomcname \".$entry->domain.\" \".$entry->target);\n        }\n\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage());\n    }\n\n    return returnSuccess();\n}\n\nfunction returnSuccess($message = \"\", $json = true)\n{\n    if ($json) {\n        return [ \"success\" => true, \"message\" => $message ];\n    } else {\n        echo $message.\"<br>\";\n        return true;\n    }\n}\n\nfunction returnError($message = \"\", $json = true)\n{\n    if ($json) {\n        return [ \"success\" => false, \"message\" => $message ];\n    } else {\n        echo $message.\"<br>\";\n        return false;\n    }\n}\n\nfunction getQueryTypeStr($querytype)\n{\n    $qtypes = [\"A (IPv4)\", \"AAAA (IPv6)\", \"ANY\", \"SRV\", \"SOA\", \"PTR\", \"TXT\", \"NAPTR\", \"MX\", \"DS\", \"RRSIG\", \"DNSKEY\", \"NS\", \"OTHER\", \"SVCB\", \"HTTPS\"];\n    $qtype = intval($querytype);\n    if($qtype > 0 && $qtype <= count($qtypes))\n        return $qtypes[$qtype-1];\n    else\n        return \"TYPE\".($qtype - 100);\n}\n\n?>\n", "<?php /*\n*    Pi-hole: A black hole for Internet advertisements\n*    (c) 2017 Pi-hole, LLC (https://pi-hole.net)\n*    Network-wide ad blocking via your own hardware.\n*\n*    This file is copyright under the latest version of the EUPL.\n*    Please see LICENSE file for your rights under this license. */\nrequire \"scripts/pi-hole/php/header.php\";\nrequire \"scripts/pi-hole/php/savesettings.php\";\nrequire_once \"scripts/pi-hole/php/FTL.php\";\n// Reread ini file as things might have been changed\n$setupVars = parse_ini_file(\"/etc/pihole/setupVars.conf\");\n$piholeFTLConf = piholeFTLConfig();\n\n// Handling of PHP internal errors\n$last_error = error_get_last();\nif(isset($last_error) && ($last_error[\"type\"] === E_WARNING || $last_error[\"type\"] === E_ERROR))\n{\n\t$error .= \"There was a problem applying your settings.<br>Debugging information:<br>PHP error (\".htmlspecialchars($last_error[\"type\"]).\"): \".htmlspecialchars($last_error[\"message\"]).\" in \".htmlspecialchars($last_error[\"file\"]).\":\".htmlspecialchars($last_error[\"line\"]);\n}\n\n?>\n<style>\n\t.tooltip-inner {\n\t\tmax-width: none;\n\t\twhite-space: nowrap;\n\t}\n</style>\n\n<?php // Check if ad lists should be updated after saving ...\nif (isset($_POST[\"submit\"])) {\n    if ($_POST[\"submit\"] == \"saveupdate\") {\n        // If that is the case -> refresh to the gravity page and start updating immediately\n        ?>\n        <meta http-equiv=\"refresh\" content=\"1;url=gravity.php?go\">\n    <?php }\n} ?>\n\n<?php if (isset($debug)) { ?>\n    <div id=\"alDebug\" class=\"alert alert-warning alert-dismissible fade in\" role=\"alert\">\n        <button type=\"button\" class=\"close\" data-hide=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span>\n        </button>\n        <h4><i class=\"icon fa fa-exclamation-triangle\"></i> Debug</h4>\n        <pre><?php print_r($_POST); ?></pre>\n    </div>\n<?php } ?>\n\n<?php if (strlen($success) > 0) { ?>\n    <div id=\"alInfo\" class=\"alert alert-info alert-dismissible fade in\" role=\"alert\">\n        <button type=\"button\" class=\"close\" data-hide=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span>\n        </button>\n        <h4><i class=\"icon fa fa-info\"></i> Info</h4>\n        <?php echo $success; ?>\n    </div>\n<?php } ?>\n\n<?php if (strlen($error) > 0) { ?>\n    <div id=\"alError\" class=\"alert alert-danger alert-dismissible fade in\" role=\"alert\">\n        <button type=\"button\" class=\"close\" data-hide=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span>\n        </button>\n        <h4><i class=\"icon fa fa-ban\"></i> Error</h4>\n        <?php echo $error; ?>\n    </div>\n<?php } ?>\n\n<?php\nif (isset($setupVars[\"PIHOLE_INTERFACE\"])) {\n    $piHoleInterface = $setupVars[\"PIHOLE_INTERFACE\"];\n} else {\n    $piHoleInterface = \"unknown\";\n}\nif (isset($setupVars[\"IPV4_ADDRESS\"])) {\n    $piHoleIPv4 = $setupVars[\"IPV4_ADDRESS\"];\n} else {\n    $piHoleIPv4 = \"unknown\";\n}\n\n// DNS settings\n$DNSservers = [];\n$DNSactive = [];\n\n$i = 1;\nwhile (isset($setupVars[\"PIHOLE_DNS_\" . $i])) {\n    if (isinserverlist($setupVars[\"PIHOLE_DNS_\" . $i])) {\n        array_push($DNSactive, $setupVars[\"PIHOLE_DNS_\" . $i]);\n    } elseif (strpos($setupVars[\"PIHOLE_DNS_\" . $i], \".\") !== false) {\n        if (!isset($custom1)) {\n            $custom1 = $setupVars[\"PIHOLE_DNS_\" . $i];\n        } else {\n            $custom2 = $setupVars[\"PIHOLE_DNS_\" . $i];\n        }\n    } elseif (strpos($setupVars[\"PIHOLE_DNS_\" . $i], \":\") !== false) {\n        if (!isset($custom3)) {\n            $custom3 = $setupVars[\"PIHOLE_DNS_\" . $i];\n        } else {\n            $custom4 = $setupVars[\"PIHOLE_DNS_\" . $i];\n        }\n    }\n    $i++;\n}\n\nif (isset($setupVars[\"DNS_FQDN_REQUIRED\"])) {\n    if ($setupVars[\"DNS_FQDN_REQUIRED\"]) {\n        $DNSrequiresFQDN = true;\n    } else {\n        $DNSrequiresFQDN = false;\n    }\n} else {\n    $DNSrequiresFQDN = true;\n}\n\nif (isset($setupVars[\"DNS_BOGUS_PRIV\"])) {\n    if ($setupVars[\"DNS_BOGUS_PRIV\"]) {\n        $DNSbogusPriv = true;\n    } else {\n        $DNSbogusPriv = false;\n    }\n} else {\n    $DNSbogusPriv = true;\n}\n\nif (isset($setupVars[\"DNSSEC\"])) {\n    if ($setupVars[\"DNSSEC\"]) {\n        $DNSSEC = true;\n    } else {\n        $DNSSEC = false;\n    }\n} else {\n    $DNSSEC = false;\n}\n\nif (isset($setupVars[\"DNSMASQ_LISTENING\"])) {\n    if ($setupVars[\"DNSMASQ_LISTENING\"] === \"single\") {\n        $DNSinterface = \"single\";\n    } elseif ($setupVars[\"DNSMASQ_LISTENING\"] === \"all\") {\n        $DNSinterface = \"all\";\n    } else {\n        $DNSinterface = \"local\";\n    }\n} else {\n    $DNSinterface = \"single\";\n}\nif (isset($setupVars[\"REV_SERVER\"]) && ($setupVars[\"REV_SERVER\"] == 1)) {\n    $rev_server = true;\n    $rev_server_cidr   = $setupVars[\"REV_SERVER_CIDR\"];\n    $rev_server_target = $setupVars[\"REV_SERVER_TARGET\"];\n    $rev_server_domain = $setupVars[\"REV_SERVER_DOMAIN\"];\n} else {\n    $rev_server = false;\n}\n?>\n\n<?php\n// Query logging\nif (isset($setupVars[\"QUERY_LOGGING\"])) {\n    if ($setupVars[\"QUERY_LOGGING\"] == 1) {\n        $piHoleLogging = true;\n    } else {\n        $piHoleLogging = false;\n    }\n} else {\n    $piHoleLogging = true;\n}\n?>\n\n<?php\n// Excluded domains in API Query Log call\nif (isset($setupVars[\"API_EXCLUDE_DOMAINS\"])) {\n    $excludedDomains = explode(\",\", $setupVars[\"API_EXCLUDE_DOMAINS\"]);\n} else {\n    $excludedDomains = [];\n}\n\n// Exluded clients in API Query Log call\nif (isset($setupVars[\"API_EXCLUDE_CLIENTS\"])) {\n    $excludedClients = explode(\",\", $setupVars[\"API_EXCLUDE_CLIENTS\"]);\n} else {\n    $excludedClients = [];\n}\n\n// Exluded clients\nif (isset($setupVars[\"API_QUERY_LOG_SHOW\"])) {\n    $queryLog = $setupVars[\"API_QUERY_LOG_SHOW\"];\n} else {\n    $queryLog = \"all\";\n}\n\n// Privacy Mode\nif (isset($setupVars[\"API_PRIVACY_MODE\"])) {\n    $privacyMode = $setupVars[\"API_PRIVACY_MODE\"];\n} else {\n    $privacyMode = false;\n}\n\n?>\n\n<?php\nif (isset($_GET['tab']) && in_array($_GET['tab'], array(\"sysadmin\", \"adlists\", \"dns\", \"piholedhcp\", \"api\", \"privacy\", \"teleporter\"))) {\n    $tab = $_GET['tab'];\n} else {\n    $tab = \"sysadmin\";\n}\n?>\n<div class=\"row\">\n    <div class=\"col-md-12\">\n        <div class=\"nav-tabs-custom\">\n            <ul class=\"nav nav-tabs\" role=\"tablist\">\n                <li role=\"presentation\"<?php if($tab === \"sysadmin\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#sysadmin\" aria-controls=\"sysadmin\" aria-expanded=\"<?php echo $tab === \"sysadmin\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">System</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"adlists\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#adlists\" aria-controls=\"adlists\" aria-expanded=\"<?php echo $tab === \"adlists\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">Adlists</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"dns\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#dns\" aria-controls=\"dns\" aria-expanded=\"<?php echo $tab === \"dns\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">DNS</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"piholedhcp\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#piholedhcp\" aria-controls=\"piholedhcp\" aria-expanded=\"<?php echo $tab === \"piholedhcp\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">DHCP</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"api\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#api\" aria-controls=\"api\" aria-expanded=\"<?php echo $tab === \"api\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">API / Web interface</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"privacy\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#privacy\" aria-controls=\"privacy\" aria-expanded=\"<?php echo $tab === \"privacy\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">Privacy</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"teleporter\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#teleporter\" aria-controls=\"teleporter\" aria-expanded=\"<?php echo $tab === \"teleporter\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">Teleporter</a>\n                </li>\n            </ul>\n            <div class=\"tab-content\">\n                <!-- ######################################################### System admin ######################################################### -->\n                <div id=\"sysadmin\" class=\"tab-pane fade<?php if($tab === \"sysadmin\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <div class=\"box\">\n                                <div class=\"box-header with-border\">\n                                    <h3 class=\"box-title\">FTL Information</h3>\n                                </div>\n                                <div class=\"box-body\">\n                                    <div class=\"row\">\n                                        <div class=\"col-lg-12\">\n                                            <?php\n                                            if ($FTL) {\n                                                function get_FTL_data($arg)\n                                                {\n                                                    global $FTLpid;\n                                                    return trim(exec(\"ps -p \" . $FTLpid . \" -o \" . $arg));\n                                                }\n\n                                                $FTLversion = exec(\"/usr/bin/pihole-FTL version\");\n                                            ?>\n                                            <table class=\"table table-striped table-bordered nowrap\">\n                                                <tbody>\n                                                    <tr>\n                                                        <th scope=\"row\">FTL version:</th>\n                                                        <td><?php echo $FTLversion; ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">Process identifier (PID):</th>\n                                                        <td><?php echo $FTLpid; ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">Time FTL started:</th>\n                                                        <td><?php print_r(get_FTL_data(\"lstart\")); ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">User / Group:</th>\n                                                        <td><?php print_r(get_FTL_data(\"euser\")); ?> / <?php print_r(get_FTL_data(\"egroup\")); ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">Total CPU utilization:</th>\n                                                        <td><?php print_r(get_FTL_data(\"%cpu\")); ?>%</td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">Memory utilization:</th>\n                                                        <td><?php print_r(get_FTL_data(\"%mem\")); ?>%</td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">\n                                                            <span title=\"Resident memory is the portion of memory occupied by a process that is held in main memory (RAM). The rest of the occupied memory exists in the swap space or file system.\">Used memory:</span>\n                                                        </th>\n                                                        <td><?php echo formatSizeUnits(1e3 * floatval(get_FTL_data(\"rss\"))); ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">\n                                                            <span title=\"Size of the DNS domain cache\">DNS cache size:</span>\n                                                        </th>\n                                                        <td id=\"cache-size\">&nbsp;</td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">\n                                                            <span title=\"Number of cache insertions\">DNS cache insertions:</span>\n                                                        </th>\n                                                        <td id=\"cache-inserted\">&nbsp;</td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">\n                                                            <span title=\"Number of cache entries that had to be removed although they are not expired (increase cache size to reduce this number)\">DNS cache evictions:</span>\n                                                        </th>\n                                                        <td id=\"cache-live-freed\">&nbsp;</td>\n                                                    </tr>\n                                                </tbody>\n                                            </table>\n                                            See also our <a href=\"https://docs.pi-hole.net/ftldns/dns-cache/\" rel=\"noopener\" target=\"_blank\">DNS cache documentation</a>.\n                                            <?php } else { ?>\n                                            <div>The FTL service is offline!</div>\n                                            <?php } ?>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <div class=\"box box-warning\">\n                                <div class=\"box-body\">\n                                    <div class=\"row\">\n                                        <div class=\"col-md-4\">\n                                            <?php if ($piHoleLogging) { ?>\n                                                <button type=\"button\" class=\"btn btn-warning confirm-disablelogging-noflush btn-block\">Disable query logging</button>\n                                            <?php } else { ?>\n                                                <form role=\"form\" method=\"post\">\n                                                    <input type=\"hidden\" name=\"action\" value=\"Enable\">\n                                                    <input type=\"hidden\" name=\"field\" value=\"Logging\">\n                                                    <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                                    <button type=\"submit\" class=\"btn btn-success btn-block\">Enable query logging</button>\n                                                </form>\n                                            <?php } ?>\n                                        </div>\n                                        <p class=\"hidden-md hidden-lg\"></p>\n                                        <div class=\"col-md-4\">\n                                                <button type=\"button\" class=\"btn btn-warning confirm-flusharp btn-block\">Flush network table</button>\n                                        </div>\n                                        <p class=\"hidden-md hidden-lg\"></p>\n                                        <div class=\"col-md-4\">\n                                            <button type=\"button\" class=\"btn btn-warning confirm-restartdns btn-block\">Restart DNS resolver</button>\n                                        </div>\n                                    </div>\n                                    <br/>\n                                    <div class=\"row\">\n                                        <div class=\"col-md-4\">\n                                            <button type=\"button\" class=\"btn btn-danger confirm-flushlogs btn-block\">Flush logs (last 24 hours)</button>\n                                        </div>\n                                        <p class=\"hidden-md hidden-lg\"></p>\n                                        <div class=\"col-md-4\">\n                                            <button type=\"button\" class=\"btn btn-danger confirm-poweroff btn-block\">Power off system</button>\n                                        </div>\n                                        <p class=\"hidden-md hidden-lg\"></p>\n                                        <div class=\"col-md-4\">\n                                            <button type=\"button\" class=\"btn btn-danger confirm-reboot btn-block\">Restart system</button>\n                                        </div>\n                                    </div>\n\n                                    <form role=\"form\" method=\"post\" id=\"flushlogsform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"flushlogs\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"flusharpform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"flusharp\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"disablelogsform-noflush\">\n                                        <input type=\"hidden\" name=\"field\" value=\"Logging\">\n                                        <input type=\"hidden\" name=\"action\" value=\"Disable-noflush\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"poweroffform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"poweroff\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"rebootform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"reboot\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"restartdnsform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"restartdns\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- ######################################################### Adlists ######################################################### -->\n                <div id=\"adlists\" class=\"tab-pane fade<?php if($tab === \"adlists\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <div class=\"box\">\n                                <div class=\"box-header with-border\">\n                                    <h3 class=\"box-title\">Adlists used to generate Pi-hole's Gravity</h3>\n                                </div>\n                                <div class=\"box-body\">\n                                    <p>Please use the <a href=\"groups-adlists.php\">group management pages</a> to edit the adlists used by Pi-hole.</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- ######################################################### DHCP ######################################################### -->\n                <div id=\"piholedhcp\" class=\"tab-pane fade<?php if($tab === \"piholedhcp\"){ ?> in active<?php } ?>\">\n                    <?php\n                    // Pi-hole DHCP server\n                    if (isset($setupVars[\"DHCP_ACTIVE\"])) {\n                        if ($setupVars[\"DHCP_ACTIVE\"] == 1) {\n                            $DHCP = true;\n                        } else {\n                            $DHCP = false;\n                        }\n                        // Read setings from config file\n                        if (isset($setupVars[\"DHCP_START\"])) {\n                            $DHCPstart = $setupVars[\"DHCP_START\"];\n                        } else {\n                            $DHCPstart = \"\";\n                        }\n                        if (isset($setupVars[\"DHCP_END\"])) {\n                            $DHCPend = $setupVars[\"DHCP_END\"];\n                        } else {\n                            $DHCPend = \"\";\n                        }\n                        if (isset($setupVars[\"DHCP_ROUTER\"])) {\n                            $DHCProuter = $setupVars[\"DHCP_ROUTER\"];\n                        } else {\n                            $DHCProuter = \"\";\n                        }\n\n                        // This setting has been added later, we have to check if it exists\n                        if (isset($setupVars[\"DHCP_LEASETIME\"])) {\n                            $DHCPleasetime = $setupVars[\"DHCP_LEASETIME\"];\n                            if (strlen($DHCPleasetime) < 1) {\n                                // Fallback if empty string\n                                $DHCPleasetime = 24;\n                            }\n                        } else {\n                            $DHCPleasetime = 24;\n                        }\n                        if (isset($setupVars[\"DHCP_IPv6\"])) {\n                            $DHCPIPv6 = $setupVars[\"DHCP_IPv6\"];\n                        } else {\n                            $DHCPIPv6 = false;\n                        }\n                        if (isset($setupVars[\"DHCP_rapid_commit\"])) {\n                            $DHCP_rapid_commit = $setupVars[\"DHCP_rapid_commit\"];\n                        } else {\n                            $DHCP_rapid_commit = false;\n                        }\n\n                    } else {\n                        $DHCP = false;\n                        // Try to guess initial settings\n                        if ($piHoleIPv4 !== \"unknown\") {\n                            $DHCPdomain = explode(\".\", $piHoleIPv4);\n                            $DHCPstart = $DHCPdomain[0] . \".\" . $DHCPdomain[1] . \".\" . $DHCPdomain[2] . \".201\";\n                            $DHCPend = $DHCPdomain[0] . \".\" . $DHCPdomain[1] . \".\" . $DHCPdomain[2] . \".251\";\n                            $DHCProuter = $DHCPdomain[0] . \".\" . $DHCPdomain[1] . \".\" . $DHCPdomain[2] . \".1\";\n                        } else {\n                            $DHCPstart = \"\";\n                            $DHCPend = \"\";\n                            $DHCProuter = \"\";\n                        }\n                        $DHCPleasetime = 24;\n                        $DHCPIPv6 = false;\n                        $DHCP_rapid_commit = false;\n                    }\n                    if (isset($setupVars[\"PIHOLE_DOMAIN\"])) {\n                        $piHoleDomain = $setupVars[\"PIHOLE_DOMAIN\"];\n                    } else {\n                        $piHoleDomain = \"lan\";\n                    }\n                    ?>\n                    <form role=\"form\" method=\"post\">\n                        <div class=\"row\">\n                            <!-- DHCP Settings Box -->\n                            <div class=\"col-md-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">DHCP Settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <div><input type=\"checkbox\" name=\"active\" id=\"DHCPchk\" <?php if ($DHCP){ ?>checked<?php } ?>><label for=\"DHCPchk\"><strong>DHCP server enabled</strong></label></div><br>\n                                                <p id=\"dhcpnotice\" <?php if (!$DHCP){ ?>hidden<?php } ?>>Make sure your router's DHCP server is disabled when using the Pi-hole DHCP server!</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-xs-12\">\n                                                <label>Range of IP addresses to hand out</label>\n                                            </div>\n                                            <div class=\"col-xs-12 col-sm-6 col-md-12 col-lg-6\">\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">From</div>\n                                                        <input type=\"text\" class=\"form-control DHCPgroup\" name=\"from\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               value=\"<?php echo $DHCPstart; ?>\"\n                                                               <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-xs-12 col-sm-6 col-md-12 col-lg-6\">\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">To</div>\n                                                        <input type=\"text\" class=\"form-control DHCPgroup\" name=\"to\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               value=\"<?php echo $DHCPend; ?>\"\n                                                               <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <label>Router (gateway) IP address</label>\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">Router</div>\n                                                        <input type=\"text\" class=\"form-control DHCPgroup\" name=\"router\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               value=\"<?php echo $DHCProuter; ?>\"\n                                                               <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <!-- Advanced DHCP Settings Box -->\n                            <div class=\"col-md-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Advanced DHCP settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <label>Pi-hole domain name</label>\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">Domain</div>\n                                                        <input type=\"text\" class=\"form-control DHCPgroup\" name=\"domain\"\n                                                               value=\"<?php echo $piHoleDomain; ?>\"\n                                                               <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <label>DHCP lease time</label>\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">Lease time in hours</div>\n                                                        <input type=\"number\" class=\"form-control DHCPgroup\"\n                                                               name=\"leasetime\"\n                                                               id=\"leasetime\" value=\"<?php echo $DHCPleasetime; ?>\"\n                                                               data-mask <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                                <p>Hint: 0 = infinite, 24 = one day, 168 = one week, 744 = one month, 8760 = one year</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                              <div><input type=\"checkbox\" name=\"DHCP_rapid_commit\" id=\"DHCP_rapid_commit\" class=\"DHCPgroup\" <?php if ($DHCP_rapid_commit){ ?>checked<?php }; if (!$DHCP){ ?> disabled<?php } ?>>&nbsp;<label for=\"DHCP_rapid_commit\"><strong>Enable DHCPv4 rapid commit (fast address assignment)</strong></label></div>\n                                              <div><input type=\"checkbox\" name=\"useIPv6\" id=\"useIPv6\" class=\"DHCPgroup\" <?php if ($DHCPIPv6){ ?>checked<?php }; if (!$DHCP){ ?> disabled<?php } ?>>&nbsp;<label for=\"useIPv6\"><strong>Enable IPv6 support (SLAAC + RA)</strong></label></div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- DHCP Leases Box -->\n                        <div class=\"row\">\n                            <?php\n                            $dhcp_leases = array();\n                            if ($DHCP) {\n                                // Read leases file\n                                $leasesfile = true;\n                                $dhcpleases = @fopen('/etc/pihole/dhcp.leases', 'r');\n                                if (!is_resource($dhcpleases))\n                                    $leasesfile = false;\n\n                                function convertseconds($argument)\n                                {\n                                    $seconds = round($argument);\n                                    if ($seconds < 60) {\n                                        return sprintf('%ds', $seconds);\n                                    } elseif ($seconds < 3600) {\n                                        return sprintf('%dm %ds', ($seconds / 60), ($seconds % 60));\n                                    } elseif ($seconds < 86400) {\n                                        return sprintf('%dh %dm %ds', ($seconds / 3600 % 24), ($seconds / 60 % 60), ($seconds % 60));\n                                    } else {\n                                        return sprintf('%dd %dh %dm %ds', ($seconds / 86400), ($seconds / 3600 % 24), ($seconds / 60 % 60), ($seconds % 60));\n                                    }\n                                }\n\n                                while (!feof($dhcpleases) && $leasesfile) {\n                                    $line = explode(\" \", trim(fgets($dhcpleases)));\n                                    if (count($line) == 5) {\n                                        $counter = intval($line[0]);\n                                        if ($counter == 0) {\n                                            $time = \"Infinite\";\n                                        } elseif ($counter <= 315360000) // 10 years in seconds\n                                        {\n                                            $time = convertseconds($counter);\n                                        } else // Assume time stamp\n                                        {\n                                            $time = convertseconds($counter - time());\n                                        }\n\n                                        if (strpos($line[2], ':') !== false) {\n                                            // IPv6 address\n                                            $type = 6;\n                                        } else {\n                                            // IPv4 lease\n                                            $type = 4;\n                                        }\n\n                                        $host = htmlentities($line[3]);\n                                        if ($host == \"*\") {\n                                            $host = \"<i>unknown</i>\";\n                                        }\n\n                                        $clid = $line[4];\n                                        if ($clid == \"*\") {\n                                            $clid = \"<i>unknown</i>\";\n                                        }\n\n                                        array_push($dhcp_leases, [\"TIME\" => $time, \"hwaddr\" => strtoupper($line[1]), \"IP\" => $line[2], \"host\" => $host, \"clid\" => $clid, \"type\" => $type]);\n                                    }\n                                }\n                            }\n\n                            readStaticLeasesFile();\n                            ?>\n                            <div class=\"col-md-12\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">DHCP leases</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <label>Currently active DHCP leases</label>\n                                                <table id=\"DHCPLeasesTable\" class=\"table table-striped table-bordered nowrap\" width=\"100%\">\n                                                    <thead>\n                                                        <tr>\n                                                            <th>MAC address</th>\n                                                            <th>IP address</th>\n                                                            <th>Hostname</th>\n                                                            <td></td>\n                                                        </tr>\n                                                    </thead>\n                                                    <tbody>\n                                                        <?php foreach ($dhcp_leases as $lease) { ?>\n                                                        <tr data-placement=\"auto\" data-container=\"body\" data-toggle=\"tooltip\"\n                                                            title=\"Lease type: IPv<?php echo $lease[\"type\"]; ?><br/>Remaining lease time: <?php echo $lease[\"TIME\"]; ?><br/>DHCP UID: <?php echo $lease[\"clid\"]; ?>\">\n                                                            <td id=\"MAC\"><?php echo $lease[\"hwaddr\"]; ?></td>\n                                                            <td id=\"IP\" data-order=\"<?php echo bin2hex(inet_pton($lease[\"IP\"])); ?>\"><?php echo $lease[\"IP\"]; ?></td>\n                                                            <td id=\"HOST\"><?php echo $lease[\"host\"]; ?></td>\n                                                            <td>\n                                                                <button type=\"button\" class=\"btn btn-danger btn-xs\" id=\"removedynamic\">\n                                                                    <span class=\"fas fas fa-trash-alt\"></span>\n                                                                </button>\n                                                                <button type=\"button\" id=\"button\" class=\"btn btn-warning btn-xs\" data-static=\"alert\">\n                                                                    <span class=\"fas fas fa-file-import\"></span>\n                                                                </button>\n                                                            </td>\n                                                        </tr>\n                                                        <?php } ?>\n                                                    </tbody>\n                                                </table>\n                                                <br>\n                                            </div>\n                                            <div class=\"col-md-12\">\n                                                <label>Static DHCP leases configuration</label>\n                                                <table id=\"DHCPStaticLeasesTable\" class=\"table table-striped table-bordered nowrap\" width=\"100%\">\n                                                    <thead>\n                                                    <tr>\n                                                        <th>MAC address</th>\n                                                        <th>IP address</th>\n                                                        <th>Hostname</th>\n                                                        <td></td>\n                                                    </tr>\n                                                    </thead>\n                                                    <tbody>\n                                                        <?php foreach ($dhcp_static_leases as $lease) { ?>\n                                                        <tr>\n                                                            <td><?php echo $lease[\"hwaddr\"]; ?></td>\n                                                            <td data-order=\"<?php echo bin2hex(inet_pton($lease[\"IP\"])); ?>\"><?php echo $lease[\"IP\"]; ?></td>\n                                                            <td><?php echo htmlentities($lease[\"host\"]); ?></td>\n                                                            <td><?php if (strlen($lease[\"hwaddr\"]) > 0) { ?>\n                                                                <button type=\"submit\" class=\"btn btn-danger btn-xs\" name=\"removestatic\"\n                                                                        value=\"<?php echo $lease[\"hwaddr\"]; ?>\">\n                                                                    <span class=\"far fa-trash-alt\"></span>\n                                                                </button>\n                                                                <?php } ?>\n                                                            </td>\n                                                        </tr>\n                                                        <?php } ?>\n                                                    </tbody>\n                                                    <tfoot style=\"display: table-row-group\">\n                                                        <tr>\n                                                            <td><input type=\"text\" class=\"form-group\" name=\"AddMAC\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"></td>\n                                                            <td><input type=\"text\" class=\"form-group\" name=\"AddIP\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"></td>\n                                                            <td><input type=\"text\" class=\"form-group\" name=\"AddHostname\" value=\"\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"></td>\n                                                            <td>\n                                                                <button type=\"submit\" class=\"btn btn-success btn-xs\" name=\"addstatic\">\n                                                                    <span class=\"fas fa-plus\"></span>\n                                                                </button>\n                                                            </td>\n                                                        </tr>\n                                                    </tfoot>\n                                                </table>\n                                                <p>Specifying the MAC address is mandatory and only one entry per MAC\n                                                   address is allowed. If the IP address is omitted and a host name is\n                                                   given, the IP address will still be generated dynamically and the\n                                                   specified host name will be used. If the host name is omitted, only\n                                                   a static lease will be added.</p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <input type=\"hidden\" name=\"field\" value=\"DHCP\">\n                                <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                <button type=\"submit\" class=\"btn btn-primary pull-right\">Save</button>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n                <!-- ######################################################### DNS ######################################################### -->\n                <div id=\"dns\" class=\"tab-pane fade<?php if($tab === \"dns\"){ ?> in active<?php } ?>\">\n                    <form role=\"form\" method=\"post\">\n                        <div class=\"row\">\n                            <div class=\"col-lg-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h1 class=\"box-title\">Upstream DNS Servers</h1>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-sm-12\">\n                                                <table class=\"table table-bordered\">\n                                                    <tr>\n                                                        <th colspan=\"2\">IPv4</th>\n                                                        <th colspan=\"2\">IPv6</th>\n                                                        <th>Name</th>\n                                                    </tr>\n                                                    <?php foreach ($DNSserverslist as $key => $value) { ?>\n                                                    <tr>\n                                                    <?php if (isset($value[\"v4_1\"])) { ?>\n                                                        <td title=\"<?php echo $value[\"v4_1\"]; ?>\">\n                                                            <div><input type=\"checkbox\" name=\"DNSserver<?php echo $value[\"v4_1\"]; ?>\" id=\"DNS4server<?php echo $value[\"v4_1\"]; ?>\" value=\"true\" <?php if (in_array($value[\"v4_1\"], $DNSactive)){ ?>checked<?php } ?>><label for=\"DNS4server<?php echo $value[\"v4_1\"]; ?>\"></label></div>\n                                                        </td>\n                                                    <?php } else { ?>\n                                                        <td></td>\n                                                    <?php } ?>\n                                                    <?php if (isset($value[\"v4_2\"])) { ?>\n                                                        <td title=\"<?php echo $value[\"v4_2\"]; ?>\">\n                                                            <div><input type=\"checkbox\" name=\"DNSserver<?php echo $value[\"v4_2\"]; ?>\" id=\"DNS4server<?php echo $value[\"v4_2\"]; ?>\" value=\"true\" <?php if (in_array($value[\"v4_2\"], $DNSactive)){ ?>checked<?php } ?>><label for=\"DNS4server<?php echo $value[\"v4_2\"]; ?>\"></label></div>\n                                                        </td>\n                                                    <?php } else { ?>\n                                                        <td></td>\n                                                    <?php } ?>\n                                                    <?php if (isset($value[\"v6_1\"])) { ?>\n                                                        <td title=\"<?php echo $value[\"v6_1\"]; ?>\">\n                                                            <div><input type=\"checkbox\" name=\"DNSserver<?php echo $value[\"v6_1\"]; ?>\" id=\"DNS6server<?php echo $value[\"v6_1\"]; ?>\" value=\"true\" <?php if (in_array($value[\"v6_1\"], $DNSactive)){ ?>checked<?php } ?>><label for=\"DNS6server<?php echo $value[\"v6_1\"]; ?>\"></label></div>\n                                                        </td>\n                                                    <?php } else { ?>\n                                                        <td></td>\n                                                    <?php } ?>\n                                                    <?php if (isset($value[\"v6_2\"])) { ?>\n                                                        <td title=\"<?php echo $value[\"v6_2\"]; ?>\">\n                                                            <div><input type=\"checkbox\" name=\"DNSserver<?php echo $value[\"v6_2\"]; ?>\" id=\"DNS6server<?php echo $value[\"v6_2\"]; ?>\" value=\"true\" <?php if (in_array($value[\"v6_2\"], $DNSactive)){ ?>checked<?php } ?>><label for=\"DNS6server<?php echo $value[\"v6_2\"]; ?>\"></label></div>\n                                                        </td>\n                                                    <?php } else { ?>\n                                                        <td></td>\n                                                    <?php } ?>\n                                                        <td><?php echo $key; ?></td>\n                                                    </tr>\n                                                    <?php } ?>\n                                                </table>\n                                                <p>ECS (Extended Client Subnet) defines a mechanism for recursive resolvers to send partial client IP address information to authoritative DNS name servers. Content Delivery Networks (CDNs) and latency-sensitive services use this to give geo-located responses when responding to name lookups coming through public DNS resolvers. <em>Note that ECS may result in reduced privacy.</em></p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-lg-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h1 class=\"box-title\">Upstream DNS Servers</h1>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-6\">\n                                                <strong>Custom 1 (IPv4)</strong>\n                                                <div class=\"row\">\n                                                    <div class=\"col-md-1\"><div>\n                                                        <input type=\"checkbox\" name=\"custom1\" id=\"custom1\" value=\"Customv4\" <?php if (isset($custom1)){ ?>checked<?php } ?>>\n                                                        <label for=\"custom1\"></label></div>\n                                                    </div>\n                                                    <div class=\"col-md-11\">\n                                                        <input type=\"text\" name=\"custom1val\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                                <?php if (isset($custom1)){ ?>value=\"<?php echo $custom1; ?>\"<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <strong>Custom 2 (IPv4)</strong>\n                                                <div class=\"row\">\n                                                    <div class=\"col-md-1\"><div>\n                                                        <input type=\"checkbox\" name=\"custom2\" id=\"custom2\" value=\"Customv4\" <?php if (isset($custom2)){ ?>checked<?php } ?>>\n                                                        <label for=\"custom2\"></label></div>\n                                                    </div>\n                                                    <div class=\"col-md-11\">\n                                                        <input type=\"text\" name=\"custom2val\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               <?php if (isset($custom2)){ ?>value=\"<?php echo $custom2; ?>\"<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-6\">\n                                                <strong>Custom 3 (IPv6)</strong>\n                                                <div class=\"row\">\n                                                    <div class=\"col-md-1\"><div>\n                                                        <input type=\"checkbox\" name=\"custom3\" id=\"custom3\" value=\"Customv6\" <?php if (isset($custom3)){ ?>checked<?php } ?>>\n                                                        <label for=\"custom3\"></label></div>\n                                                    </div>\n                                                    <div class=\"col-md-11\">\n                                                        <input type=\"text\" name=\"custom3val\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                                <?php if (isset($custom3)){ ?>value=\"<?php echo $custom3; ?>\"<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <strong>Custom 4 (IPv6)</strong>\n                                                <div class=\"row\">\n                                                    <div class=\"col-md-1\"><div>\n                                                        <input type=\"checkbox\" name=\"custom4\" id=\"custom4\" value=\"Customv6\" <?php if (isset($custom4)){ ?>checked<?php } ?>>\n                                                        <label for=\"custom4\"></label></div>\n                                                    </div>\n                                                    <div class=\"col-md-11\">\n                                                        <input type=\"text\" name=\"custom4val\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               <?php if (isset($custom4)){ ?>value=\"<?php echo $custom4; ?>\"<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-lg-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h1 class=\"box-title\">Interface listening behavior</h1>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <div class=\"form-group\">\n                                                    <div>\n                                                        <input type=\"radio\" name=\"DNSinterface\" id=\"DNSinterface1\" value=\"local\"\n                                                                <?php if ($DNSinterface == \"local\"){ ?>checked<?php } ?>>\n                                                        <label for=\"DNSinterface1\"><strong>Listen on all interfaces</strong><br>Allows only queries from devices that are at most one hop away (local devices)</label>\n                                                    </div>\n                                                    <div>\n                                                        <input type=\"radio\" name=\"DNSinterface\" id=\"DNSinterface2\" value=\"single\"\n                                                                <?php if ($DNSinterface == \"single\"){ ?>checked<?php } ?>>\n                                                        <label for=\"DNSinterface2\"><strong>Listen only on interface <?php echo htmlentities($piHoleInterface); ?></strong></label>\n                                                    </div>\n                                                    <div>\n                                                        <input type=\"radio\" name=\"DNSinterface\" id=\"DNSinterface3\" value=\"all\"\n                                                                <?php if ($DNSinterface == \"all\"){ ?>checked<?php } ?>>\n                                                        <label for=\"DNSinterface3\"><strong>Listen on all interfaces, permit all origins</strong></label>\n                                                    </div>\n                                                </div>\n                                                <p>Note that the last option should not be used on devices which are\n                                                   directly connected to the Internet. This option is safe if your\n                                                   Pi-hole is located within your local network, i.e. protected behind\n                                                   your router, and you have not forwarded port 53 to this device. In\n                                                   virtually all other cases you have to make sure that your Pi-hole is\n                                                   properly firewalled.</p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-lg-12\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Advanced DNS settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"DNSrequiresFQDN\" id=\"DNSrequiresFQDN\" title=\"domain-needed\" <?php if ($DNSrequiresFQDN){ ?>checked<?php } ?>>\n                                                    <label for=\"DNSrequiresFQDN\"><strong>Never forward non-FQDNs</strong></label>\n                                                    <p>When there is a Pi-hole domain set and this box is\n                                                    ticked, this asks FTL that this domain is purely\n                                                    local and FTL may answer queries from <code>/etc/hosts</code> or DHCP leases\n                                                    but should never forward queries on that domain to any upstream servers.</p>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"DNSbogusPriv\" id=\"DNSbogusPriv\" title=\"bogus-priv\" <?php if ($DNSbogusPriv){ ?>checked<?php } ?>>\n                                                    <label for=\"DNSbogusPriv\"><strong>Never forward reverse lookups for private IP ranges</strong></label>\n                                                    <p>All reverse lookups for private IP ranges (i.e., <code>192.168.0.x/24</code>, etc.)\n                                                    which are not found in <code>/etc/hosts</code> or the DHCP leases are answered\n                                                    with \"no such domain\" rather than being forwarded upstream. The set\n                                                    of prefixes affected is the list given in <a href=\"https://tools.ietf.org/html/rfc6303\">RFC6303</a>.</p>\n                                                    <p><strong>Important</strong>: Enabling these two options may increase your privacy,\n                                                    but may also prevent you from being able to access\n                                                    local hostnames if the Pi-hole is not used as DHCP server.</p>\n                                                </div>\n                                                <br>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"DNSSEC\" id=\"DNSSEC\" <?php if ($DNSSEC){ ?>checked<?php } ?>>\n                                                    <label for=\"DNSSEC\"><strong>Use DNSSEC</strong></label>\n                                                    <p>Validate DNS replies and cache DNSSEC data. When forwarding DNS\n                                                    queries, Pi-hole requests the DNSSEC records needed to validate\n                                                    the replies. If a domain fails validation or the upstream does not\n                                                    support DNSSEC, this setting can cause issues resolving domains.\n                                                    Use an upstream DNS server which supports DNSSEC when activating DNSSEC. Note that\n                                                    the size of your log might increase significantly\n                                                    when enabling DNSSEC. A DNSSEC resolver test can be found\n                                                    <a href=\"https://dnssec.vs.uni-due.de/\" rel=\"noopener\" target=\"_blank\">here</a>.</p>\n                                                </div>\n                                                <br>\n                                                <h4>Conditional forwarding</h4>\n                                                <p>If not configured as your DHCP server, Pi-hole  typically won't be able to\n                                                   determine the names of devices on your local network.  As a\n                                                   result, tables such as Top Clients will only show IP addresses.</p>\n                                                <p>One solution for this is to configure Pi-hole to forward these\n\t                                               requests to your DHCP server (most likely your router), but only for devices on your\n\t                                               home network.  To configure this we will need to know the IP\n\t                                               address of your DHCP server and which addresses belong to your local network.\n                                                   Exemplary input is given below as placeholder in the text boxes (if empty).</p>\n                                                <p>If your local network spans 192.168.0.1 - 192.168.0.255, then you will have to input\n                                                   <code>192.168.0.0/24</code>. If your local network is 192.168.47.1 - 192.168.47.255, it will\n                                                   be <code>192.168.47.0/24</code> and similar. If your network is larger, the CIDR has to be\n                                                   different, for instance a range of 10.8.0.1 - 10.8.255.255 results in <code>10.8.0.0/16</code>,\n                                                   whereas an even wider network of 10.0.0.1 - 10.255.255.255 results in <code>10.0.0.0/8</code>.\n                                                   Setting up IPv6 ranges is exactly similar to setting up IPv4 here and fully supported.\n                                                   Feel free to reach out to us on our\n                                                   <a href=\"https://discourse.pi-hole.net\" target=\"_blank\">Discourse forum</a>\n                                                   in case you need any assistance setting up local host name resolution for your particular system.</p>\n                                                <p>You can also specify a local domain name (like <code>fritz.box</code>) to ensure queries to\n                                                   devices ending in your local domain name will not leave your network, however, this is optional.\n                                                   The local domain name must match the domain name specified\n                                                   in your DHCP server for this to work. You can likely find it within the DHCP settings.</p>\n                                                <div class=\"form-group\">\n                                                    <div>\n                                                        <input type=\"checkbox\" name=\"rev_server\" id=\"rev_server\" value=\"rev_server\" <?php if(isset($rev_server) && ($rev_server == true)){ ?>checked<?php } ?>>\n                                                        <label for=\"rev_server\"><strong>Use Conditional Forwarding</strong></label>\n                                                    </div>\n                                                    <div class=\"input-group\">\n                                                      <table class=\"table table-bordered\">\n                                                        <tr>\n                                                          <th>Local network in <a href=\"https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing\" target=\"_blank\">CIDR notation</a></th>\n                                                          <th>IP address of your DHCP server (router)</th>\n                                                          <th>Local domain name (optional)</th>\n                                                        </tr>\n                                                        <tr>\n                                                          <td>\n                                                            <input type=\"text\" name=\"rev_server_cidr\" placeholder=\"192.168.0.0/16\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                            <?php if(isset($rev_server_cidr)){ ?>value=\"<?php echo $rev_server_cidr; ?>\"<?php } ?>\n                                                            <?php if(!isset($rev_server) || !$rev_server){ ?>disabled<?php } ?>>\n                                                          </td>\n                                                          <td>\n                                                            <input type=\"text\" name=\"rev_server_target\" placeholder=\"192.168.0.1\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                            <?php if(isset($rev_server_target)){ ?>value=\"<?php echo $rev_server_target; ?>\"<?php } ?>\n                                                            <?php if(!isset($rev_server) || !$rev_server){ ?>disabled<?php } ?>>\n                                                          </td>\n                                                          <td>\n                                                            <input type=\"text\" name=\"rev_server_domain\" placeholder=\"local\" class=\"form-control\" data-mask autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                            <?php if(isset($rev_server_domain)){ ?>value=\"<?php echo $rev_server_domain; ?>\"<?php } ?>\n                                                            <?php if(!isset($rev_server) || !$rev_server){ ?>disabled<?php } ?>>\n                                                          </td>\n                                                        </tr>\n                                                      </table>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <input type=\"hidden\" name=\"field\" value=\"DNS\">\n                                <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                <button type=\"submit\" class=\"btn btn-primary pull-right\">Save</button>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n                <!-- ######################################################### API and Web ######################################################### -->\n                <?php\n                // Administrator email address\n                if (isset($setupVars[\"ADMIN_EMAIL\"])) {\n                    $adminemail = $setupVars[\"ADMIN_EMAIL\"];\n                } else {\n                    $adminemail = \"\";\n                }\n                ?>\n                <div id=\"api\" class=\"tab-pane fade<?php if($tab === \"api\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <form role=\"form\" method=\"post\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">API settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <h4>Top Lists</h4>\n                                                <p>Exclude the following domains from being shown in</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-xs-12 col-sm-6 col-md-12 col-lg-6\">\n                                                <div class=\"form-group\">\n                                                    <label>Top Domains / Top Advertisers</label>\n                                                    <textarea name=\"domains\" class=\"form-control\" placeholder=\"Enter one domain per line\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                              rows=\"4\"><?php foreach ($excludedDomains as $domain) {\n                                                                             echo $domain . \"\\n\"; }\n                                                                       ?></textarea>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-xs-12 col-sm-6 col-md-12 col-lg-6\">\n                                                <div class=\"form-group\">\n                                                    <label>Top Clients</label>\n                                                    <textarea name=\"clients\" class=\"form-control\" placeholder=\"Enter one IP address or host name per line\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                              rows=\"4\"><?php foreach ($excludedClients as $client) {\n                                                                             echo $client . \"\\n\"; }\n                                                                       ?></textarea>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                            <h4>Query Log</h4>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-6\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"querylog-permitted\" id=\"querylog-permitted\" <?php if($queryLog === \"permittedonly\" || $queryLog === \"all\"){ ?>checked<?php } ?>>\n                                                    <label for=\"querylog-permitted\"><strong>Show permitted domain entries</strong></label>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-lg-6\">\n                                                <div>\n                                                <input type=\"checkbox\" name=\"querylog-blocked\" id=\"querylog-blocked\" <?php if($queryLog === \"blockedonly\" || $queryLog === \"all\"){ ?>checked<?php } ?>>\n                                                <label for=\"querylog-blocked\"><strong>Show blocked domain entries</strong></label>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"box-footer clearfix\">\n                                        <input type=\"hidden\" name=\"field\" value=\"API\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                        <button type=\"button\" class=\"btn btn-primary api-token\">Show API token</button>\n                                        <button type=\"submit\" class=\"btn btn-primary pull-right\">Save</button>\n                                    </div>\n                                </div>\n                            </form>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <form role=\"form\" method=\"post\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Web interface settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <h4>Interface appearance</h4>\n                                                <?php theme_selection(); ?>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"boxedlayout\" id=\"boxedlayout\" value=\"yes\" <?php if ($boxedlayout){ ?>checked<?php } ?>>\n                                                    <label for=\"boxedlayout\"><strong>Use boxed layout (for large screens)</strong></label>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <h4>Administrator Email Address</h4>\n                                                <input type=\"email\" class=\"form-control\" name=\"adminemail\" value=\"<?php echo htmlspecialchars($adminemail); ?>\">\n                                                <input type=\"hidden\" name=\"field\" value=\"webUI\">\n                                                <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"box-footer clearfix\">\n                                        <button type=\"submit\" class=\"btn btn-primary pull-right\">Save</button>\n                                    </div>\n                                </div>\n                            </form>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <div class=\"box box-warning\">\n                                <div class=\"box-header with-border\">\n                                    <h3 class=\"box-title\">Styling (auto saved, per-browser)</h3>\n                                </div>\n                                <div class=\"box-body\">\n                                    <div class=\"row\">\n                                        <div class=\"col-md-6\">\n                                            <p>Checkbox and radio buttons</p>\n                                        </div>\n                                        <div class=\"col-md-6\">\n                                            <select id=\"iCheckStyle\">\n                                                <option>default</option>\n                                                <option>primary</option>\n                                                <option>success</option>\n                                                <option>info</option>\n                                                <option>warning</option>\n                                                <option>danger</option>\n                                                <option>turquoise</option>\n                                                <option>emerland</option>\n                                                <option>peterriver</option>\n                                                <option>amethyst</option>\n                                                <option>wetasphalt</option>\n                                                <option>greensea</option>\n                                                <option>nephritis</option>\n                                                <option>belizehole</option>\n                                                <option>wisteria</option>\n                                                <option>midnightblue</option>\n                                                <option>sunflower</option>\n                                                <option>carrot</option>\n                                                <option>alizarin</option>\n                                                <option>clouds</option>\n                                                <option>concrete</option>\n                                                <option>orange</option>\n                                                <option>pumpkin</option>\n                                                <option>pomegranate</option>\n                                                <option>silver</option>\n                                                <option>asbestos</option>\n\n                                                <option>material-red</option>\n                                                <option>material-pink</option>\n                                                <option>material-purple</option>\n                                                <option>material-deeppurple</option>\n                                                <option>material-indigo</option>\n                                                <option>material-blue</option>\n                                                <option>material-lightblue</option>\n                                                <option>material-cyan</option>\n                                                <option>material-teal</option>\n                                                <option>material-green</option>\n                                                <option>material-lightgreen</option>\n                                                <option>material-lime</option>\n                                                <option>material-yellow</option>\n                                                <option>material-amber</option>\n                                                <option>material-orange</option>\n                                                <option>material-deeporange</option>\n                                                <option>material-brown</option>\n                                                <option>material-grey</option>\n                                                <option>material-bluegrey</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div class=\"row\">\n                                        <div class=\"col-md-6\">\n                                            <p>CPU Temperature Unit</p>\n                                        </div>\n                                        <div class=\"col-md-6\">\n                                            <select id=\"tempunit-selector\">\n                                                <option value=\"C\">Celsius</option>\n                                                <option value=\"K\">Kelvin</option>\n                                                <option value=\"F\">Fahrenheit</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div class=\"row\">\n                                        <div class=\"col-md-12\">\n                                            <div>\n                                                <input type=\"checkbox\" name=\"bargraphs\" id=\"bargraphs\" value=\"yes\">\n                                                <label for=\"bargraphs\"><strong>Use new Bar charts on dashboard</strong></label>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- ######################################################### Privacy (may be expanded further later on) ######################################################### -->\n                <?php\n                // Get privacy level from piholeFTL config array\n                if (isset($piholeFTLConf[\"PRIVACYLEVEL\"])) {\n                    $privacylevel = intval($piholeFTLConf[\"PRIVACYLEVEL\"]);\n                } else {\n                    $privacylevel = 0;\n                }\n                ?>\n                <div id=\"privacy\" class=\"tab-pane fade<?php if($tab === \"privacy\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <form role=\"form\" method=\"post\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Privacy settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <h4>DNS resolver privacy level</h4>\n                                                <p>Specify if DNS queries should be anonymized, available options are:</p>\n                                                <div>\n                                                    <input type=\"radio\" name=\"privacylevel\" id=\"privacylevel_0\" value=\"0\" <?php if ($privacylevel === 0){ ?>checked<?php } ?>>\n                                                    <label for=\"privacylevel_0\"><strong>Show everything and record everything</strong></label>\n                                                    <p>Gives maximum amount of statistics</p>\n                                                </div>\n                                                <div>\n                                                    <input type=\"radio\" name=\"privacylevel\" id=\"privacylevel_1\" value=\"1\" <?php if ($privacylevel === 1){ ?>checked<?php } ?>>\n                                                    <label for=\"privacylevel_1\"><strong>Hide domains: Display and store all domains as \"hidden\"</strong></label>\n                                                    <p>This disables the Top Domains and Top Ads tables on the dashboard</p>\n                                                </div>\n                                                <div>\n                                                    <input type=\"radio\" name=\"privacylevel\" id=\"privacylevel_2\" value=\"2\" <?php if ($privacylevel === 2){ ?>checked<?php } ?>>\n                                                    <label for=\"privacylevel_2\"><strong>Hide domains and clients: Display and store all domains as \"hidden\" and all clients as \"0.0.0.0\"</strong></label>\n                                                    <p>This disables all tables on the dashboard</p>\n                                                </div>\n                                                <div>\n                                                    <input type=\"radio\" name=\"privacylevel\" id=\"privacylevel_3\" value=\"3\" <?php if ($privacylevel === 3){ ?>checked<?php } ?>>\n                                                    <label for=\"privacylevel_3\"><strong>Anonymous mode: This disables basically everything except the live anonymous statistics</strong></label>\n                                                    <p>No history is saved at all to the database, and nothing is shown in the query log. Also, there are no top item lists.</p>\n                                                </div>\n                                                <p>The privacy level may be increased at any time without having to restart the DNS resolver. However, note that the DNS resolver needs to be restarted when lowering the privacy level. This restarting is automatically done when saving.</p>\n                                                <?php if($privacylevel > 0 && $piHoleLogging){ ?>\n                                                <p class=\"lookatme\">Warning: Pi-hole's query logging is activated. Although the dashboard will hide the requested details, all queries are still fully logged to the pihole.log file.</p>\n                                                <?php } ?>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"box-footer clearfix\">\n                                        <input type=\"hidden\" name=\"field\" value=\"privacyLevel\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                        <button type=\"submit\" class=\"btn btn-primary pull-right\">Apply</button>\n                                    </div>\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n                <!-- ######################################################### Teleporter ######################################################### -->\n                <div id=\"teleporter\" class=\"tab-pane fade<?php if($tab === \"teleporter\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <?php if (extension_loaded('Phar')) { ?>\n                        <form role=\"form\" method=\"post\" id=\"takeoutform\"\n                              action=\"scripts/pi-hole/php/teleporter.php\"\n                              target=\"_blank\" enctype=\"multipart/form-data\">\n                            <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                            <div class=\"col-lg-6 col-md-12\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Backup</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <p>Backup your Pi-hole configuration (settings &amp; lists) as a downloadable archive</p>\n                                                <button type=\"submit\" class=\"btn btn-default\">Backup</button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-lg-6 col-md-12\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Restore</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <label>Restore...</label>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-6\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"whitelist\" id=\"tele_whitelist\" value=\"true\" checked>\n                                                    <label for=\"tele_whitelist\">Whitelist (exact)</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"regex_whitelist\" id=\"tele_regex_whitelist\" value=\"true\" checked>\n                                                    <label for=\"tele_regex_whitelist\">Whitelist (regex/wildcard)</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"blacklist\" id=\"tele_blacklist\" value=\"true\" checked>\n                                                    <label for=\"tele_blacklist\">Blacklist (exact)</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"regexlist\" id=\"tele_regexlist\" value=\"true\" checked>\n                                                    <label for=\"tele_regexlist\">Blacklist (regex/wildcard)</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"adlist\" id=\"tele_adlist\" value=\"true\" checked>\n                                                    <label for=\"tele_adlist\">Adlists</label>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-lg-6\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"client\" id=\"tele_client\" value=\"true\" checked>\n                                                    <label for=\"tele_client\">Client</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"group\" id=\"tele_group\" value=\"true\" checked>\n                                                    <label for=\"tele_group\">Group</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"auditlog\" id=\"tele_auditlog\" value=\"true\" checked>\n                                                    <label for=\"tele_auditlog\">Audit log</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"staticdhcpleases\" id=\"tele_staticdhcpleases\" value=\"true\" checked>\n                                                    <label for=\"tele_staticdhcpleases\">Static DHCP Leases</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"localdnsrecords\" id=\"tele_localdnsrecords\" value=\"true\" checked>\n                                                    <label for=\"tele_localdnsrecords\">Local DNS Records</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"localcnamerecords\" id=\"tele_localcnamerecords\" value=\"true\" checked>\n                                                    <label for=\"tele_localcnamerecords\">Local CNAME Records</label>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <label for=\"zip_file\">File input</label>\n                                                <input type=\"file\" name=\"zip_file\" id=\"zip_file\">\n                                                <p class=\"help-block\">Upload only Pi-hole backup files.</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"flushtables\" id=\"tele_flushtables\" value=\"true\" checked>\n                                                    <label for=\"tele_flushtables\">Clear existing data</label>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"box-footer clearfix\">\n                                        <button type=\"submit\" class=\"btn btn-default\" name=\"action\" value=\"in\">Restore</button>\n                                    </div>\n                                </div>\n                            </div>\n                        </form>\n                        <?php } else { ?>\n                        <div class=\"col-lg-12\">\n                            <div class=\"box box-warning\">\n                                <div class=\"box-header with-border\">\n                                    <h3 class=\"box-title\">Teleporter</h3>\n                                </div>\n                                <div class=\"box-body\">\n                                    <p>The PHP extension <code>Phar</code> is not loaded. Please ensure it is installed and loaded if you want to use the Pi-hole teleporter.</p>\n                                </div>\n                            </div>\n                        </div>\n                        <?php } ?>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src=\"scripts/vendor/jquery.confirm.min.js?v=<?=$cacheVer?>\"></script>\n<script src=\"scripts/pi-hole/js/utils.js?v=<?=$cacheVer?>\"></script>\n<script src=\"scripts/pi-hole/js/settings.js?v=<?=$cacheVer?>\"></script>\n\n<?php\nrequire \"scripts/pi-hole/php/footer.php\";\n?>\n"], "fixing_code": ["<?php\n/* Pi-hole: A black hole for Internet advertisements\n*  (c) 2017 Pi-hole, LLC (https://pi-hole.net)\n*  Network-wide ad blocking via your own hardware.\n*\n*  This file is copyright under the latest version of the EUPL.\n*  Please see LICENSE file for your rights under this license. */\n\n// Credit: http://stackoverflow.com/a/4694816/2087442\n// Modified because of https://github.com/pi-hole/AdminLTE/pull/533\nini_set(\"pcre.recursion_limit\", 1500);\nfunction validDomain($domain_name, &$message = NULL)\n{\n\tif(!preg_match(\"/^((-|_)*[a-z\\d]((-|_)*[a-z\\d])*(-|_)*)(\\.(-|_)*([a-z\\d]((-|_)*[a-z\\d])*))*$/i\", $domain_name)) {\n\t\tif($message !== NULL)\n\t\t\t$message = \"it contains invalid characters\";\n\t\treturn false;\n\t}\n\tif(!preg_match(\"/^.{1,253}$/\", $domain_name)) {\n\t\tif($message !== NULL)\n\t\t\t$message = \"its length is invalid\";\n\t\treturn false;\n\t}\n\tif(!preg_match(\"/^[^\\.]{1,63}(\\.[^\\.]{1,63})*$/\", $domain_name)) {\n\t\tif($message !== NULL)\n\t\t\t$message = \"at least one label is of invalid length\";\n\t\treturn false;\n\t}\n\n\t// everything is okay\n\treturn true;\n}\n\nfunction validDomainWildcard($domain_name)\n{\n\t// There has to be either no or at most one \"*\" at the beginning of a line\n\t$validChars = preg_match(\"/^((\\*\\.)?[_a-z\\d](-*[_a-z\\d])*)(\\.([_a-z\\d](-*[a-z\\d])*))*(\\.([_a-z\\d])*)*$/i\", $domain_name);\n\t$lengthCheck = preg_match(\"/^.{1,253}$/\", $domain_name);\n\t$labelLengthCheck = preg_match(\"/^[^\\.]{1,63}(\\.[^\\.]{1,63})*$/\", $domain_name);\n\treturn ( $validChars && $lengthCheck && $labelLengthCheck ); //length of each label\n}\n\nfunction validIP($address){\n\tif (preg_match('/[.:0]/', $address) && !preg_match('/[1-9a-f]/', $address)) {\n\t\t// Test if address contains either `:` or `0` but not 1-9 or a-f\n\t\treturn false;\n\t}\n\treturn !filter_var($address, FILTER_VALIDATE_IP) === false;\n}\n\nfunction validCIDRIP($address){\n\t// This validation strategy has been taken from ../js/groups-common.js\n\t$isIPv6 = strpos($address, \":\") !== false;\n\tif($isIPv6) {\n\t\t// One IPv6 element is 16bit: 0000 - FFFF\n\t\t$v6elem = \"[0-9A-Fa-f]{1,4}\";\n\t\t// CIDR for IPv6 is any multiple of 4 from 4 up to 128 bit\n\t\t$v6cidr = \"(4\";\n\t\tfor ($i=8; $i <= 128; $i+=4) {\n\t\t\t$v6cidr .= \"|$i\";\n\t\t}\n\t\t$v6cidr .= \")\";\n\t\t$validator = \"/^(((?:$v6elem))((?::$v6elem))*::((?:$v6elem))((?::$v6elem))*|((?:$v6elem))((?::$v6elem)){7})\\/$v6cidr$/\";\n\t\treturn preg_match($validator, $address);\n\t} else {\n\t\t// One IPv4 element is 8bit: 0 - 256\n\t\t$v4elem = \"(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]?|0)\";\n\t\t// Note that rev-server accepts only /8, /16, /24, and /32\n\t\t$allowedv4cidr = \"(8|16|24|32)\";\n\t\t$validator = \"/^$v4elem\\.$v4elem\\.$v4elem\\.$v4elem\\/$allowedv4cidr$/\";\n\t\treturn preg_match($validator, $address);\n\t}\n}\n\nfunction validMAC($mac_addr)\n{\n  // Accepted input format: 00:01:02:1A:5F:FF (characters may be lower case)\n  return !filter_var($mac_addr, FILTER_VALIDATE_MAC) === false;\n}\n\nfunction validEmail($email)\n{\n\treturn filter_var($email, FILTER_VALIDATE_EMAIL)\n\t\t// Make sure that the email does not contain special characters which\n\t\t// may be used to execute shell commands, even though they may be valid\n\t\t// in an email address. If the escaped email does not equal the original\n\t\t// email, it is not safe to store in setupVars.\n\t\t&& escapeshellcmd($email) === $email;\n}\n\nfunction get_ip_type($ip)\n{\n    return  filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_IPV4) ? 4 :\n           (filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_IPV6) ? 6 :\n            0);\n}\n\nfunction checkfile($filename) {\n    if(is_readable($filename))\n    {\n        return $filename;\n    }\n    else\n    {\n        // substitute dummy file\n        return \"/dev/null\";\n    }\n}\n\n// Credit: http://php.net/manual/en/function.hash-equals.php#119576\nif(!function_exists('hash_equals')) {\n    function hash_equals($known_string, $user_string) {\n        $ret = 0;\n\n        if (strlen($known_string) !== strlen($user_string)) {\n         $user_string = $known_string;\n         $ret = 1;\n        }\n\n        $res = $known_string ^ $user_string;\n\n        for ($i = strlen($res) - 1; $i >= 0; --$i) {\n         $ret |= ord($res[$i]);\n        }\n\n        return !$ret;\n   }\n}\n\n/**\n * More safely execute a command with pihole shell script.\n *\n * For example,\n *\n *   pihole_execute(\"-h\");\n *\n * would execute command\n *\n *   sudo pihole -h\n *\n * and returns output of that command as a string.\n *\n * @param $argument_string String of arguments to run pihole with.\n * @param $error_on_failure If true, a warning is raised if command execution fails. Defaults to true.\n */\nfunction pihole_execute($argument_string, $error_on_failure = true) {\n    $escaped = escapeshellcmd($argument_string);\n    $output = null;\n    $return_status = -1;\n    $command = \"sudo pihole \" . $escaped;\n    exec($command, $output, $return_status);\n    if($return_status !== 0)\n    {\n        trigger_error(\"Executing {$command} failed.\", E_USER_WARNING);\n    }\n    return $output;\n}\n\n// Custom DNS\n$customDNSFile = \"/etc/pihole/custom.list\";\n\nfunction echoCustomDNSEntries()\n{\n    $entries = getCustomDNSEntries();\n\n    $data = [];\n    foreach ($entries as $entry)\n        $data[] = [ $entry->domain, $entry->ip ];\n\n    return [ \"data\" => $data ];\n}\n\nfunction getCustomDNSEntries()\n{\n    global $customDNSFile;\n\n    $entries = [];\n\n    $handle = fopen($customDNSFile, \"r\");\n    if ($handle)\n    {\n        while (($line = fgets($handle)) !== false) {\n            $line = str_replace(\"\\r\",\"\", $line);\n            $line = str_replace(\"\\n\",\"\", $line);\n            $explodedLine = explode (\" \", $line);\n\n            if (count($explodedLine) != 2)\n                continue;\n\n            $data = new \\stdClass();\n            $data->ip = $explodedLine[0];\n            $data->domain = $explodedLine[1];\n            $entries[] = $data;\n        }\n\n        fclose($handle);\n    }\n\n    return $entries;\n}\n\nfunction addCustomDNSEntry($ip=\"\", $domain=\"\", $json=true)\n{\n    try\n    {\n        if(isset($_REQUEST['ip']))\n            $ip = trim($_REQUEST['ip']);\n\n        if(isset($_REQUEST['domain']))\n            $domain = trim($_REQUEST['domain']);\n\n        if (empty($ip))\n            return returnError(\"IP must be set\", $json);\n\n        $ipType = get_ip_type($ip);\n\n        if (!$ipType)\n            return returnError(\"IP must be valid\", $json);\n\n        if (empty($domain))\n            return returnError(\"Domain must be set\", $json);\n\n        if (!validDomain($domain))\n            return returnError(\"Domain must be valid\", $json);\n\n        // Only check for duplicates if adding new records from the web UI (not through Teleporter)\n        if(isset($_REQUEST['ip']) || isset($_REQUEST['domain']))\n        {\n            $existingEntries = getCustomDNSEntries();\n            foreach ($existingEntries as $entry)\n                if ($entry->domain == $domain && get_ip_type($entry->ip) == $ipType)\n                    return returnError(\"This domain already has a custom DNS entry for an IPv\" . $ipType, $json);\n        }\n\n        // Add record\n        pihole_execute(\"-a addcustomdns \".$ip.\" \".$domain);\n\n        return returnSuccess(\"\", $json);\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage(), $json);\n    }\n}\n\nfunction deleteCustomDNSEntry()\n{\n    try\n    {\n        $ip = !empty($_REQUEST['ip']) ? $_REQUEST['ip']: \"\";\n        $domain = !empty($_REQUEST['domain']) ? $_REQUEST['domain']: \"\";\n\n        if (empty($ip))\n            return returnError(\"IP must be set\");\n\n        if (empty($domain))\n            return returnError(\"Domain must be set\");\n\n        $existingEntries = getCustomDNSEntries();\n\n        $found = false;\n        foreach ($existingEntries as $entry)\n            if ($entry->domain == $domain)\n                if ($entry->ip == $ip) {\n                    $found = true;\n                    break;\n                }\n\n        if (!$found)\n            return returnError(\"This domain/ip association does not exist\");\n\n        pihole_execute(\"-a removecustomdns \".$ip.\" \".$domain);\n\n        return returnSuccess();\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage());\n    }\n}\n\nfunction deleteAllCustomDNSEntries()\n{\n    if (isset($customDNSFile))\n    {\n        $handle = fopen($customDNSFile, \"r\");\n        if ($handle)\n        {\n            try\n            {\n                while (($line = fgets($handle)) !== false) {\n                    $line = str_replace(\"\\r\",\"\", $line);\n                    $line = str_replace(\"\\n\",\"\", $line);\n                    $explodedLine = explode (\" \", $line);\n\n                    if (count($explodedLine) != 2)\n                        continue;\n\n                    $ip = $explodedLine[0];\n                    $domain = $explodedLine[1];\n\n                    pihole_execute(\"-a removecustomdns \".$ip.\" \".$domain);\n                }\n            }\n            catch (\\Exception $ex)\n            {\n                return returnError($ex->getMessage());\n            }\n\n            fclose($handle);\n        }\n    }\n\n    return returnSuccess();\n}\n\n// CNAME\n$customCNAMEFile = \"/etc/dnsmasq.d/05-pihole-custom-cname.conf\";\n\nfunction echoCustomCNAMEEntries()\n{\n    $entries = getCustomCNAMEEntries();\n\n    $data = [];\n    foreach ($entries as $entry)\n        $data[] = [ $entry->domain, $entry->target ];\n\n    return [ \"data\" => $data ];\n}\n\nfunction getCustomCNAMEEntries()\n{\n    global $customCNAMEFile;\n\n    $entries = [];\n\n    if (!file_exists($customCNAMEFile)) return $entries;\n\n    $handle = fopen($customCNAMEFile, \"r\");\n    if ($handle)\n    {\n        while (($line = fgets($handle)) !== false) {\n            $line = str_replace(\"cname=\",\"\", $line);\n            $line = str_replace(\"\\r\",\"\", $line);\n            $line = str_replace(\"\\n\",\"\", $line);\n            $explodedLine = explode (\",\", $line);\n\n            if (count($explodedLine) <= 1)\n                continue;\n\n            $data = new \\stdClass();\n            $data->domains = array_slice($explodedLine, 0, -1);\n            $data->domain = implode(\",\", $data->domains);\n            $data->target = $explodedLine[count($explodedLine)-1];\n            $entries[] = $data;\n        }\n\n        fclose($handle);\n    }\n\n    return $entries;\n}\n\nfunction addCustomCNAMEEntry($domain=\"\", $target=\"\", $json=true)\n{\n    try\n    {\n        if(isset($_REQUEST['domain']))\n            $domain = $_REQUEST['domain'];\n\n        if(isset($_REQUEST['target']))\n            $target = trim($_REQUEST['target']);\n\n        if (empty($domain))\n            return returnError(\"Domain must be set\", $json);\n\n        if (empty($target))\n            return returnError(\"Target must be set\", $json);\n\n        if (!validDomain($target))\n            return returnError(\"Target must be valid\", $json);\n\n        // Check if each submitted domain is valid\n        $domains = array_map('trim', explode(\",\", $domain));\n        foreach ($domains as $d) {\n            if (!validDomain($d))\n                return returnError(\"Domain '$d' is not valid\", $json);\n        }\n\n        $existingEntries = getCustomCNAMEEntries();\n\n        // Check if a record for one of the domains already exists\n        foreach ($existingEntries as $entry)\n            foreach ($domains as $d)\n                if (in_array($d, $entry->domains))\n                    return returnError(\"There is already a CNAME record for '$d'\", $json);\n\n        pihole_execute(\"-a addcustomcname \".$domain.\" \".$target);\n\n        return returnSuccess(\"\", $json);\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage(), $json);\n    }\n}\n\nfunction deleteCustomCNAMEEntry()\n{\n    try\n    {\n        $target = !empty($_REQUEST['target']) ? $_REQUEST['target']: \"\";\n        $domain = !empty($_REQUEST['domain']) ? $_REQUEST['domain']: \"\";\n\n        if (empty($target))\n            return returnError(\"Target must be set\");\n\n        if (empty($domain))\n            return returnError(\"Domain must be set\");\n\n        $existingEntries = getCustomCNAMEEntries();\n\n        $found = false;\n        foreach ($existingEntries as $entry)\n            if ($entry->domain == $domain)\n                if ($entry->target == $target) {\n                    $found = true;\n                    break;\n                }\n\n        if (!$found)\n            return returnError(\"This domain/ip association does not exist\");\n\n        pihole_execute(\"-a removecustomcname \".$domain.\" \".$target);\n\n        return returnSuccess();\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage());\n    }\n}\n\nfunction deleteAllCustomCNAMEEntries()\n{\n    try\n    {\n        $existingEntries = getCustomCNAMEEntries();\n\n        foreach ($existingEntries as $entry) {\n            pihole_execute(\"-a removecustomcname \".$entry->domain.\" \".$entry->target);\n        }\n\n    }\n    catch (\\Exception $ex)\n    {\n        return returnError($ex->getMessage());\n    }\n\n    return returnSuccess();\n}\n\nfunction returnSuccess($message = \"\", $json = true)\n{\n    if ($json) {\n        return [ \"success\" => true, \"message\" => $message ];\n    } else {\n        echo $message.\"<br>\";\n        return true;\n    }\n}\n\nfunction returnError($message = \"\", $json = true)\n{\n    $message = htmlentities($message) ;\n    if ($json) {\n        return [ \"success\" => false, \"message\" => $message ];\n    } else {\n        echo $message.\"<br>\";\n        return false;\n    }\n}\n\nfunction getQueryTypeStr($querytype)\n{\n    $qtypes = [\"A (IPv4)\", \"AAAA (IPv6)\", \"ANY\", \"SRV\", \"SOA\", \"PTR\", \"TXT\", \"NAPTR\", \"MX\", \"DS\", \"RRSIG\", \"DNSKEY\", \"NS\", \"OTHER\", \"SVCB\", \"HTTPS\"];\n    $qtype = intval($querytype);\n    if($qtype > 0 && $qtype <= count($qtypes))\n        return $qtypes[$qtype-1];\n    else\n        return \"TYPE\".($qtype - 100);\n}\n\n?>\n", "<?php /*\n*    Pi-hole: A black hole for Internet advertisements\n*    (c) 2017 Pi-hole, LLC (https://pi-hole.net)\n*    Network-wide ad blocking via your own hardware.\n*\n*    This file is copyright under the latest version of the EUPL.\n*    Please see LICENSE file for your rights under this license. */\nrequire \"scripts/pi-hole/php/header.php\";\nrequire \"scripts/pi-hole/php/savesettings.php\";\nrequire_once \"scripts/pi-hole/php/FTL.php\";\n// Reread ini file as things might have been changed\n$setupVars = parse_ini_file(\"/etc/pihole/setupVars.conf\");\n$piholeFTLConf = piholeFTLConfig();\n\n// Handling of PHP internal errors\n$last_error = error_get_last();\nif(isset($last_error) && ($last_error[\"type\"] === E_WARNING || $last_error[\"type\"] === E_ERROR))\n{\n\t$error .= \"There was a problem applying your settings.<br>Debugging information:<br>PHP error (\".htmlspecialchars($last_error[\"type\"]).\"): \".htmlspecialchars($last_error[\"message\"]).\" in \".htmlspecialchars($last_error[\"file\"]).\":\".htmlspecialchars($last_error[\"line\"]);\n}\n\n?>\n<style>\n\t.tooltip-inner {\n\t\tmax-width: none;\n\t\twhite-space: nowrap;\n\t}\n</style>\n\n<?php // Check if ad lists should be updated after saving ...\nif (isset($_POST[\"submit\"])) {\n    if ($_POST[\"submit\"] == \"saveupdate\") {\n        // If that is the case -> refresh to the gravity page and start updating immediately\n        ?>\n        <meta http-equiv=\"refresh\" content=\"1;url=gravity.php?go\">\n    <?php }\n} ?>\n\n<?php if (isset($debug)) { ?>\n    <div id=\"alDebug\" class=\"alert alert-warning alert-dismissible fade in\" role=\"alert\">\n        <button type=\"button\" class=\"close\" data-hide=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span>\n        </button>\n        <h4><i class=\"icon fa fa-exclamation-triangle\"></i> Debug</h4>\n        <pre><?php print_r(htmlentities($_POST)); ?></pre>\n    </div>\n<?php } ?>\n\n<?php if (strlen($success) > 0) { ?>\n    <div id=\"alInfo\" class=\"alert alert-info alert-dismissible fade in\" role=\"alert\">\n        <button type=\"button\" class=\"close\" data-hide=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span>\n        </button>\n        <h4><i class=\"icon fa fa-info\"></i> Info</h4>\n        <?php echo $success; ?>\n    </div>\n<?php } ?>\n\n<?php if (strlen($error) > 0) { ?>\n    <div id=\"alError\" class=\"alert alert-danger alert-dismissible fade in\" role=\"alert\">\n        <button type=\"button\" class=\"close\" data-hide=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span>\n        </button>\n        <h4><i class=\"icon fa fa-ban\"></i> Error</h4>\n        <?php echo $error; ?>\n    </div>\n<?php } ?>\n\n<?php\nif (isset($setupVars[\"PIHOLE_INTERFACE\"])) {\n    $piHoleInterface = $setupVars[\"PIHOLE_INTERFACE\"];\n} else {\n    $piHoleInterface = \"unknown\";\n}\nif (isset($setupVars[\"IPV4_ADDRESS\"])) {\n    $piHoleIPv4 = $setupVars[\"IPV4_ADDRESS\"];\n} else {\n    $piHoleIPv4 = \"unknown\";\n}\n\n// DNS settings\n$DNSservers = [];\n$DNSactive = [];\n\n$i = 1;\nwhile (isset($setupVars[\"PIHOLE_DNS_\" . $i])) {\n    if (isinserverlist($setupVars[\"PIHOLE_DNS_\" . $i])) {\n        array_push($DNSactive, $setupVars[\"PIHOLE_DNS_\" . $i]);\n    } elseif (strpos($setupVars[\"PIHOLE_DNS_\" . $i], \".\") !== false) {\n        if (!isset($custom1)) {\n            $custom1 = $setupVars[\"PIHOLE_DNS_\" . $i];\n        } else {\n            $custom2 = $setupVars[\"PIHOLE_DNS_\" . $i];\n        }\n    } elseif (strpos($setupVars[\"PIHOLE_DNS_\" . $i], \":\") !== false) {\n        if (!isset($custom3)) {\n            $custom3 = $setupVars[\"PIHOLE_DNS_\" . $i];\n        } else {\n            $custom4 = $setupVars[\"PIHOLE_DNS_\" . $i];\n        }\n    }\n    $i++;\n}\n\nif (isset($setupVars[\"DNS_FQDN_REQUIRED\"])) {\n    if ($setupVars[\"DNS_FQDN_REQUIRED\"]) {\n        $DNSrequiresFQDN = true;\n    } else {\n        $DNSrequiresFQDN = false;\n    }\n} else {\n    $DNSrequiresFQDN = true;\n}\n\nif (isset($setupVars[\"DNS_BOGUS_PRIV\"])) {\n    if ($setupVars[\"DNS_BOGUS_PRIV\"]) {\n        $DNSbogusPriv = true;\n    } else {\n        $DNSbogusPriv = false;\n    }\n} else {\n    $DNSbogusPriv = true;\n}\n\nif (isset($setupVars[\"DNSSEC\"])) {\n    if ($setupVars[\"DNSSEC\"]) {\n        $DNSSEC = true;\n    } else {\n        $DNSSEC = false;\n    }\n} else {\n    $DNSSEC = false;\n}\n\nif (isset($setupVars[\"DNSMASQ_LISTENING\"])) {\n    if ($setupVars[\"DNSMASQ_LISTENING\"] === \"single\") {\n        $DNSinterface = \"single\";\n    } elseif ($setupVars[\"DNSMASQ_LISTENING\"] === \"all\") {\n        $DNSinterface = \"all\";\n    } else {\n        $DNSinterface = \"local\";\n    }\n} else {\n    $DNSinterface = \"single\";\n}\nif (isset($setupVars[\"REV_SERVER\"]) && ($setupVars[\"REV_SERVER\"] == 1)) {\n    $rev_server = true;\n    $rev_server_cidr   = $setupVars[\"REV_SERVER_CIDR\"];\n    $rev_server_target = $setupVars[\"REV_SERVER_TARGET\"];\n    $rev_server_domain = $setupVars[\"REV_SERVER_DOMAIN\"];\n} else {\n    $rev_server = false;\n}\n?>\n\n<?php\n// Query logging\nif (isset($setupVars[\"QUERY_LOGGING\"])) {\n    if ($setupVars[\"QUERY_LOGGING\"] == 1) {\n        $piHoleLogging = true;\n    } else {\n        $piHoleLogging = false;\n    }\n} else {\n    $piHoleLogging = true;\n}\n?>\n\n<?php\n// Excluded domains in API Query Log call\nif (isset($setupVars[\"API_EXCLUDE_DOMAINS\"])) {\n    $excludedDomains = explode(\",\", $setupVars[\"API_EXCLUDE_DOMAINS\"]);\n} else {\n    $excludedDomains = [];\n}\n\n// Exluded clients in API Query Log call\nif (isset($setupVars[\"API_EXCLUDE_CLIENTS\"])) {\n    $excludedClients = explode(\",\", $setupVars[\"API_EXCLUDE_CLIENTS\"]);\n} else {\n    $excludedClients = [];\n}\n\n// Exluded clients\nif (isset($setupVars[\"API_QUERY_LOG_SHOW\"])) {\n    $queryLog = $setupVars[\"API_QUERY_LOG_SHOW\"];\n} else {\n    $queryLog = \"all\";\n}\n\n// Privacy Mode\nif (isset($setupVars[\"API_PRIVACY_MODE\"])) {\n    $privacyMode = $setupVars[\"API_PRIVACY_MODE\"];\n} else {\n    $privacyMode = false;\n}\n\n?>\n\n<?php\nif (isset($_GET['tab']) && in_array($_GET['tab'], array(\"sysadmin\", \"adlists\", \"dns\", \"piholedhcp\", \"api\", \"privacy\", \"teleporter\"))) {\n    $tab = $_GET['tab'];\n} else {\n    $tab = \"sysadmin\";\n}\n?>\n<div class=\"row\">\n    <div class=\"col-md-12\">\n        <div class=\"nav-tabs-custom\">\n            <ul class=\"nav nav-tabs\" role=\"tablist\">\n                <li role=\"presentation\"<?php if($tab === \"sysadmin\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#sysadmin\" aria-controls=\"sysadmin\" aria-expanded=\"<?php echo $tab === \"sysadmin\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">System</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"adlists\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#adlists\" aria-controls=\"adlists\" aria-expanded=\"<?php echo $tab === \"adlists\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">Adlists</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"dns\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#dns\" aria-controls=\"dns\" aria-expanded=\"<?php echo $tab === \"dns\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">DNS</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"piholedhcp\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#piholedhcp\" aria-controls=\"piholedhcp\" aria-expanded=\"<?php echo $tab === \"piholedhcp\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">DHCP</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"api\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#api\" aria-controls=\"api\" aria-expanded=\"<?php echo $tab === \"api\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">API / Web interface</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"privacy\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#privacy\" aria-controls=\"privacy\" aria-expanded=\"<?php echo $tab === \"privacy\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">Privacy</a>\n                </li>\n                <li role=\"presentation\"<?php if($tab === \"teleporter\"){ ?> class=\"active\"<?php } ?>>\n                    <a href=\"#teleporter\" aria-controls=\"teleporter\" aria-expanded=\"<?php echo $tab === \"teleporter\" ? \"true\" : \"false\"; ?>\" role=\"tab\" data-toggle=\"tab\">Teleporter</a>\n                </li>\n            </ul>\n            <div class=\"tab-content\">\n                <!-- ######################################################### System admin ######################################################### -->\n                <div id=\"sysadmin\" class=\"tab-pane fade<?php if($tab === \"sysadmin\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <div class=\"box\">\n                                <div class=\"box-header with-border\">\n                                    <h3 class=\"box-title\">FTL Information</h3>\n                                </div>\n                                <div class=\"box-body\">\n                                    <div class=\"row\">\n                                        <div class=\"col-lg-12\">\n                                            <?php\n                                            if ($FTL) {\n                                                function get_FTL_data($arg)\n                                                {\n                                                    global $FTLpid;\n                                                    return trim(exec(\"ps -p \" . $FTLpid . \" -o \" . $arg));\n                                                }\n\n                                                $FTLversion = exec(\"/usr/bin/pihole-FTL version\");\n                                            ?>\n                                            <table class=\"table table-striped table-bordered nowrap\">\n                                                <tbody>\n                                                    <tr>\n                                                        <th scope=\"row\">FTL version:</th>\n                                                        <td><?php echo $FTLversion; ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">Process identifier (PID):</th>\n                                                        <td><?php echo $FTLpid; ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">Time FTL started:</th>\n                                                        <td><?php print_r(get_FTL_data(\"lstart\")); ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">User / Group:</th>\n                                                        <td><?php print_r(get_FTL_data(\"euser\")); ?> / <?php print_r(get_FTL_data(\"egroup\")); ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">Total CPU utilization:</th>\n                                                        <td><?php print_r(get_FTL_data(\"%cpu\")); ?>%</td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">Memory utilization:</th>\n                                                        <td><?php print_r(get_FTL_data(\"%mem\")); ?>%</td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">\n                                                            <span title=\"Resident memory is the portion of memory occupied by a process that is held in main memory (RAM). The rest of the occupied memory exists in the swap space or file system.\">Used memory:</span>\n                                                        </th>\n                                                        <td><?php echo formatSizeUnits(1e3 * floatval(get_FTL_data(\"rss\"))); ?></td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">\n                                                            <span title=\"Size of the DNS domain cache\">DNS cache size:</span>\n                                                        </th>\n                                                        <td id=\"cache-size\">&nbsp;</td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">\n                                                            <span title=\"Number of cache insertions\">DNS cache insertions:</span>\n                                                        </th>\n                                                        <td id=\"cache-inserted\">&nbsp;</td>\n                                                    </tr>\n                                                    <tr>\n                                                        <th scope=\"row\">\n                                                            <span title=\"Number of cache entries that had to be removed although they are not expired (increase cache size to reduce this number)\">DNS cache evictions:</span>\n                                                        </th>\n                                                        <td id=\"cache-live-freed\">&nbsp;</td>\n                                                    </tr>\n                                                </tbody>\n                                            </table>\n                                            See also our <a href=\"https://docs.pi-hole.net/ftldns/dns-cache/\" rel=\"noopener\" target=\"_blank\">DNS cache documentation</a>.\n                                            <?php } else { ?>\n                                            <div>The FTL service is offline!</div>\n                                            <?php } ?>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <div class=\"box box-warning\">\n                                <div class=\"box-body\">\n                                    <div class=\"row\">\n                                        <div class=\"col-md-4\">\n                                            <?php if ($piHoleLogging) { ?>\n                                                <button type=\"button\" class=\"btn btn-warning confirm-disablelogging-noflush btn-block\">Disable query logging</button>\n                                            <?php } else { ?>\n                                                <form role=\"form\" method=\"post\">\n                                                    <input type=\"hidden\" name=\"action\" value=\"Enable\">\n                                                    <input type=\"hidden\" name=\"field\" value=\"Logging\">\n                                                    <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                                    <button type=\"submit\" class=\"btn btn-success btn-block\">Enable query logging</button>\n                                                </form>\n                                            <?php } ?>\n                                        </div>\n                                        <p class=\"hidden-md hidden-lg\"></p>\n                                        <div class=\"col-md-4\">\n                                                <button type=\"button\" class=\"btn btn-warning confirm-flusharp btn-block\">Flush network table</button>\n                                        </div>\n                                        <p class=\"hidden-md hidden-lg\"></p>\n                                        <div class=\"col-md-4\">\n                                            <button type=\"button\" class=\"btn btn-warning confirm-restartdns btn-block\">Restart DNS resolver</button>\n                                        </div>\n                                    </div>\n                                    <br/>\n                                    <div class=\"row\">\n                                        <div class=\"col-md-4\">\n                                            <button type=\"button\" class=\"btn btn-danger confirm-flushlogs btn-block\">Flush logs (last 24 hours)</button>\n                                        </div>\n                                        <p class=\"hidden-md hidden-lg\"></p>\n                                        <div class=\"col-md-4\">\n                                            <button type=\"button\" class=\"btn btn-danger confirm-poweroff btn-block\">Power off system</button>\n                                        </div>\n                                        <p class=\"hidden-md hidden-lg\"></p>\n                                        <div class=\"col-md-4\">\n                                            <button type=\"button\" class=\"btn btn-danger confirm-reboot btn-block\">Restart system</button>\n                                        </div>\n                                    </div>\n\n                                    <form role=\"form\" method=\"post\" id=\"flushlogsform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"flushlogs\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"flusharpform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"flusharp\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"disablelogsform-noflush\">\n                                        <input type=\"hidden\" name=\"field\" value=\"Logging\">\n                                        <input type=\"hidden\" name=\"action\" value=\"Disable-noflush\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"poweroffform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"poweroff\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"rebootform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"reboot\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                    <form role=\"form\" method=\"post\" id=\"restartdnsform\">\n                                        <input type=\"hidden\" name=\"field\" value=\"restartdns\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                    </form>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- ######################################################### Adlists ######################################################### -->\n                <div id=\"adlists\" class=\"tab-pane fade<?php if($tab === \"adlists\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <div class=\"box\">\n                                <div class=\"box-header with-border\">\n                                    <h3 class=\"box-title\">Adlists used to generate Pi-hole's Gravity</h3>\n                                </div>\n                                <div class=\"box-body\">\n                                    <p>Please use the <a href=\"groups-adlists.php\">group management pages</a> to edit the adlists used by Pi-hole.</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- ######################################################### DHCP ######################################################### -->\n                <div id=\"piholedhcp\" class=\"tab-pane fade<?php if($tab === \"piholedhcp\"){ ?> in active<?php } ?>\">\n                    <?php\n                    // Pi-hole DHCP server\n                    if (isset($setupVars[\"DHCP_ACTIVE\"])) {\n                        if ($setupVars[\"DHCP_ACTIVE\"] == 1) {\n                            $DHCP = true;\n                        } else {\n                            $DHCP = false;\n                        }\n                        // Read setings from config file\n                        if (isset($setupVars[\"DHCP_START\"])) {\n                            $DHCPstart = $setupVars[\"DHCP_START\"];\n                        } else {\n                            $DHCPstart = \"\";\n                        }\n                        if (isset($setupVars[\"DHCP_END\"])) {\n                            $DHCPend = $setupVars[\"DHCP_END\"];\n                        } else {\n                            $DHCPend = \"\";\n                        }\n                        if (isset($setupVars[\"DHCP_ROUTER\"])) {\n                            $DHCProuter = $setupVars[\"DHCP_ROUTER\"];\n                        } else {\n                            $DHCProuter = \"\";\n                        }\n\n                        // This setting has been added later, we have to check if it exists\n                        if (isset($setupVars[\"DHCP_LEASETIME\"])) {\n                            $DHCPleasetime = $setupVars[\"DHCP_LEASETIME\"];\n                            if (strlen($DHCPleasetime) < 1) {\n                                // Fallback if empty string\n                                $DHCPleasetime = 24;\n                            }\n                        } else {\n                            $DHCPleasetime = 24;\n                        }\n                        if (isset($setupVars[\"DHCP_IPv6\"])) {\n                            $DHCPIPv6 = $setupVars[\"DHCP_IPv6\"];\n                        } else {\n                            $DHCPIPv6 = false;\n                        }\n                        if (isset($setupVars[\"DHCP_rapid_commit\"])) {\n                            $DHCP_rapid_commit = $setupVars[\"DHCP_rapid_commit\"];\n                        } else {\n                            $DHCP_rapid_commit = false;\n                        }\n\n                    } else {\n                        $DHCP = false;\n                        // Try to guess initial settings\n                        if ($piHoleIPv4 !== \"unknown\") {\n                            $DHCPdomain = explode(\".\", $piHoleIPv4);\n                            $DHCPstart = $DHCPdomain[0] . \".\" . $DHCPdomain[1] . \".\" . $DHCPdomain[2] . \".201\";\n                            $DHCPend = $DHCPdomain[0] . \".\" . $DHCPdomain[1] . \".\" . $DHCPdomain[2] . \".251\";\n                            $DHCProuter = $DHCPdomain[0] . \".\" . $DHCPdomain[1] . \".\" . $DHCPdomain[2] . \".1\";\n                        } else {\n                            $DHCPstart = \"\";\n                            $DHCPend = \"\";\n                            $DHCProuter = \"\";\n                        }\n                        $DHCPleasetime = 24;\n                        $DHCPIPv6 = false;\n                        $DHCP_rapid_commit = false;\n                    }\n                    if (isset($setupVars[\"PIHOLE_DOMAIN\"])) {\n                        $piHoleDomain = $setupVars[\"PIHOLE_DOMAIN\"];\n                    } else {\n                        $piHoleDomain = \"lan\";\n                    }\n                    ?>\n                    <form role=\"form\" method=\"post\">\n                        <div class=\"row\">\n                            <!-- DHCP Settings Box -->\n                            <div class=\"col-md-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">DHCP Settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <div><input type=\"checkbox\" name=\"active\" id=\"DHCPchk\" <?php if ($DHCP){ ?>checked<?php } ?>><label for=\"DHCPchk\"><strong>DHCP server enabled</strong></label></div><br>\n                                                <p id=\"dhcpnotice\" <?php if (!$DHCP){ ?>hidden<?php } ?>>Make sure your router's DHCP server is disabled when using the Pi-hole DHCP server!</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-xs-12\">\n                                                <label>Range of IP addresses to hand out</label>\n                                            </div>\n                                            <div class=\"col-xs-12 col-sm-6 col-md-12 col-lg-6\">\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">From</div>\n                                                        <input type=\"text\" class=\"form-control DHCPgroup\" name=\"from\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               value=\"<?php echo $DHCPstart; ?>\"\n                                                               <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-xs-12 col-sm-6 col-md-12 col-lg-6\">\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">To</div>\n                                                        <input type=\"text\" class=\"form-control DHCPgroup\" name=\"to\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               value=\"<?php echo $DHCPend; ?>\"\n                                                               <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <label>Router (gateway) IP address</label>\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">Router</div>\n                                                        <input type=\"text\" class=\"form-control DHCPgroup\" name=\"router\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               value=\"<?php echo $DHCProuter; ?>\"\n                                                               <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <!-- Advanced DHCP Settings Box -->\n                            <div class=\"col-md-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Advanced DHCP settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <label>Pi-hole domain name</label>\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">Domain</div>\n                                                        <input type=\"text\" class=\"form-control DHCPgroup\" name=\"domain\"\n                                                               value=\"<?php echo $piHoleDomain; ?>\"\n                                                               <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <label>DHCP lease time</label>\n                                                <div class=\"form-group\">\n                                                    <div class=\"input-group\">\n                                                        <div class=\"input-group-addon\">Lease time in hours</div>\n                                                        <input type=\"number\" class=\"form-control DHCPgroup\"\n                                                               name=\"leasetime\"\n                                                               id=\"leasetime\" value=\"<?php echo $DHCPleasetime; ?>\"\n                                                               data-mask <?php if (!$DHCP){ ?>disabled<?php } ?>>\n                                                    </div>\n                                                </div>\n                                                <p>Hint: 0 = infinite, 24 = one day, 168 = one week, 744 = one month, 8760 = one year</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                              <div><input type=\"checkbox\" name=\"DHCP_rapid_commit\" id=\"DHCP_rapid_commit\" class=\"DHCPgroup\" <?php if ($DHCP_rapid_commit){ ?>checked<?php }; if (!$DHCP){ ?> disabled<?php } ?>>&nbsp;<label for=\"DHCP_rapid_commit\"><strong>Enable DHCPv4 rapid commit (fast address assignment)</strong></label></div>\n                                              <div><input type=\"checkbox\" name=\"useIPv6\" id=\"useIPv6\" class=\"DHCPgroup\" <?php if ($DHCPIPv6){ ?>checked<?php }; if (!$DHCP){ ?> disabled<?php } ?>>&nbsp;<label for=\"useIPv6\"><strong>Enable IPv6 support (SLAAC + RA)</strong></label></div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <!-- DHCP Leases Box -->\n                        <div class=\"row\">\n                            <?php\n                            $dhcp_leases = array();\n                            if ($DHCP) {\n                                // Read leases file\n                                $leasesfile = true;\n                                $dhcpleases = @fopen('/etc/pihole/dhcp.leases', 'r');\n                                if (!is_resource($dhcpleases))\n                                    $leasesfile = false;\n\n                                function convertseconds($argument)\n                                {\n                                    $seconds = round($argument);\n                                    if ($seconds < 60) {\n                                        return sprintf('%ds', $seconds);\n                                    } elseif ($seconds < 3600) {\n                                        return sprintf('%dm %ds', ($seconds / 60), ($seconds % 60));\n                                    } elseif ($seconds < 86400) {\n                                        return sprintf('%dh %dm %ds', ($seconds / 3600 % 24), ($seconds / 60 % 60), ($seconds % 60));\n                                    } else {\n                                        return sprintf('%dd %dh %dm %ds', ($seconds / 86400), ($seconds / 3600 % 24), ($seconds / 60 % 60), ($seconds % 60));\n                                    }\n                                }\n\n                                while (!feof($dhcpleases) && $leasesfile) {\n                                    $line = explode(\" \", trim(fgets($dhcpleases)));\n                                    if (count($line) == 5) {\n                                        $counter = intval($line[0]);\n                                        if ($counter == 0) {\n                                            $time = \"Infinite\";\n                                        } elseif ($counter <= 315360000) // 10 years in seconds\n                                        {\n                                            $time = convertseconds($counter);\n                                        } else // Assume time stamp\n                                        {\n                                            $time = convertseconds($counter - time());\n                                        }\n\n                                        if (strpos($line[2], ':') !== false) {\n                                            // IPv6 address\n                                            $type = 6;\n                                        } else {\n                                            // IPv4 lease\n                                            $type = 4;\n                                        }\n\n                                        $host = htmlentities($line[3]);\n                                        if ($host == \"*\") {\n                                            $host = \"<i>unknown</i>\";\n                                        }\n\n                                        $clid = $line[4];\n                                        if ($clid == \"*\") {\n                                            $clid = \"<i>unknown</i>\";\n                                        }\n\n                                        array_push($dhcp_leases, [\"TIME\" => $time, \"hwaddr\" => strtoupper($line[1]), \"IP\" => $line[2], \"host\" => $host, \"clid\" => $clid, \"type\" => $type]);\n                                    }\n                                }\n                            }\n\n                            readStaticLeasesFile();\n                            ?>\n                            <div class=\"col-md-12\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">DHCP leases</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <label>Currently active DHCP leases</label>\n                                                <table id=\"DHCPLeasesTable\" class=\"table table-striped table-bordered nowrap\" width=\"100%\">\n                                                    <thead>\n                                                        <tr>\n                                                            <th>MAC address</th>\n                                                            <th>IP address</th>\n                                                            <th>Hostname</th>\n                                                            <td></td>\n                                                        </tr>\n                                                    </thead>\n                                                    <tbody>\n                                                        <?php foreach ($dhcp_leases as $lease) { ?>\n                                                        <tr data-placement=\"auto\" data-container=\"body\" data-toggle=\"tooltip\"\n                                                            title=\"Lease type: IPv<?php echo $lease[\"type\"]; ?><br/>Remaining lease time: <?php echo $lease[\"TIME\"]; ?><br/>DHCP UID: <?php echo $lease[\"clid\"]; ?>\">\n                                                            <td id=\"MAC\"><?php echo $lease[\"hwaddr\"]; ?></td>\n                                                            <td id=\"IP\" data-order=\"<?php echo bin2hex(inet_pton($lease[\"IP\"])); ?>\"><?php echo $lease[\"IP\"]; ?></td>\n                                                            <td id=\"HOST\"><?php echo $lease[\"host\"]; ?></td>\n                                                            <td>\n                                                                <button type=\"button\" class=\"btn btn-danger btn-xs\" id=\"removedynamic\">\n                                                                    <span class=\"fas fas fa-trash-alt\"></span>\n                                                                </button>\n                                                                <button type=\"button\" id=\"button\" class=\"btn btn-warning btn-xs\" data-static=\"alert\">\n                                                                    <span class=\"fas fas fa-file-import\"></span>\n                                                                </button>\n                                                            </td>\n                                                        </tr>\n                                                        <?php } ?>\n                                                    </tbody>\n                                                </table>\n                                                <br>\n                                            </div>\n                                            <div class=\"col-md-12\">\n                                                <label>Static DHCP leases configuration</label>\n                                                <table id=\"DHCPStaticLeasesTable\" class=\"table table-striped table-bordered nowrap\" width=\"100%\">\n                                                    <thead>\n                                                    <tr>\n                                                        <th>MAC address</th>\n                                                        <th>IP address</th>\n                                                        <th>Hostname</th>\n                                                        <td></td>\n                                                    </tr>\n                                                    </thead>\n                                                    <tbody>\n                                                        <?php foreach ($dhcp_static_leases as $lease) { ?>\n                                                        <tr>\n                                                            <td><?php echo $lease[\"hwaddr\"]; ?></td>\n                                                            <td data-order=\"<?php echo bin2hex(inet_pton($lease[\"IP\"])); ?>\"><?php echo $lease[\"IP\"]; ?></td>\n                                                            <td><?php echo htmlentities($lease[\"host\"]); ?></td>\n                                                            <td><?php if (strlen($lease[\"hwaddr\"]) > 0) { ?>\n                                                                <button type=\"submit\" class=\"btn btn-danger btn-xs\" name=\"removestatic\"\n                                                                        value=\"<?php echo $lease[\"hwaddr\"]; ?>\">\n                                                                    <span class=\"far fa-trash-alt\"></span>\n                                                                </button>\n                                                                <?php } ?>\n                                                            </td>\n                                                        </tr>\n                                                        <?php } ?>\n                                                    </tbody>\n                                                    <tfoot style=\"display: table-row-group\">\n                                                        <tr>\n                                                            <td><input type=\"text\" class=\"form-group\" name=\"AddMAC\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"></td>\n                                                            <td><input type=\"text\" class=\"form-group\" name=\"AddIP\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"></td>\n                                                            <td><input type=\"text\" class=\"form-group\" name=\"AddHostname\" value=\"\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"></td>\n                                                            <td>\n                                                                <button type=\"submit\" class=\"btn btn-success btn-xs\" name=\"addstatic\">\n                                                                    <span class=\"fas fa-plus\"></span>\n                                                                </button>\n                                                            </td>\n                                                        </tr>\n                                                    </tfoot>\n                                                </table>\n                                                <p>Specifying the MAC address is mandatory and only one entry per MAC\n                                                   address is allowed. If the IP address is omitted and a host name is\n                                                   given, the IP address will still be generated dynamically and the\n                                                   specified host name will be used. If the host name is omitted, only\n                                                   a static lease will be added.</p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <input type=\"hidden\" name=\"field\" value=\"DHCP\">\n                                <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                <button type=\"submit\" class=\"btn btn-primary pull-right\">Save</button>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n                <!-- ######################################################### DNS ######################################################### -->\n                <div id=\"dns\" class=\"tab-pane fade<?php if($tab === \"dns\"){ ?> in active<?php } ?>\">\n                    <form role=\"form\" method=\"post\">\n                        <div class=\"row\">\n                            <div class=\"col-lg-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h1 class=\"box-title\">Upstream DNS Servers</h1>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-sm-12\">\n                                                <table class=\"table table-bordered\">\n                                                    <tr>\n                                                        <th colspan=\"2\">IPv4</th>\n                                                        <th colspan=\"2\">IPv6</th>\n                                                        <th>Name</th>\n                                                    </tr>\n                                                    <?php foreach ($DNSserverslist as $key => $value) { ?>\n                                                    <tr>\n                                                    <?php if (isset($value[\"v4_1\"])) { ?>\n                                                        <td title=\"<?php echo $value[\"v4_1\"]; ?>\">\n                                                            <div><input type=\"checkbox\" name=\"DNSserver<?php echo $value[\"v4_1\"]; ?>\" id=\"DNS4server<?php echo $value[\"v4_1\"]; ?>\" value=\"true\" <?php if (in_array($value[\"v4_1\"], $DNSactive)){ ?>checked<?php } ?>><label for=\"DNS4server<?php echo $value[\"v4_1\"]; ?>\"></label></div>\n                                                        </td>\n                                                    <?php } else { ?>\n                                                        <td></td>\n                                                    <?php } ?>\n                                                    <?php if (isset($value[\"v4_2\"])) { ?>\n                                                        <td title=\"<?php echo $value[\"v4_2\"]; ?>\">\n                                                            <div><input type=\"checkbox\" name=\"DNSserver<?php echo $value[\"v4_2\"]; ?>\" id=\"DNS4server<?php echo $value[\"v4_2\"]; ?>\" value=\"true\" <?php if (in_array($value[\"v4_2\"], $DNSactive)){ ?>checked<?php } ?>><label for=\"DNS4server<?php echo $value[\"v4_2\"]; ?>\"></label></div>\n                                                        </td>\n                                                    <?php } else { ?>\n                                                        <td></td>\n                                                    <?php } ?>\n                                                    <?php if (isset($value[\"v6_1\"])) { ?>\n                                                        <td title=\"<?php echo $value[\"v6_1\"]; ?>\">\n                                                            <div><input type=\"checkbox\" name=\"DNSserver<?php echo $value[\"v6_1\"]; ?>\" id=\"DNS6server<?php echo $value[\"v6_1\"]; ?>\" value=\"true\" <?php if (in_array($value[\"v6_1\"], $DNSactive)){ ?>checked<?php } ?>><label for=\"DNS6server<?php echo $value[\"v6_1\"]; ?>\"></label></div>\n                                                        </td>\n                                                    <?php } else { ?>\n                                                        <td></td>\n                                                    <?php } ?>\n                                                    <?php if (isset($value[\"v6_2\"])) { ?>\n                                                        <td title=\"<?php echo $value[\"v6_2\"]; ?>\">\n                                                            <div><input type=\"checkbox\" name=\"DNSserver<?php echo $value[\"v6_2\"]; ?>\" id=\"DNS6server<?php echo $value[\"v6_2\"]; ?>\" value=\"true\" <?php if (in_array($value[\"v6_2\"], $DNSactive)){ ?>checked<?php } ?>><label for=\"DNS6server<?php echo $value[\"v6_2\"]; ?>\"></label></div>\n                                                        </td>\n                                                    <?php } else { ?>\n                                                        <td></td>\n                                                    <?php } ?>\n                                                        <td><?php echo $key; ?></td>\n                                                    </tr>\n                                                    <?php } ?>\n                                                </table>\n                                                <p>ECS (Extended Client Subnet) defines a mechanism for recursive resolvers to send partial client IP address information to authoritative DNS name servers. Content Delivery Networks (CDNs) and latency-sensitive services use this to give geo-located responses when responding to name lookups coming through public DNS resolvers. <em>Note that ECS may result in reduced privacy.</em></p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-lg-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h1 class=\"box-title\">Upstream DNS Servers</h1>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-6\">\n                                                <strong>Custom 1 (IPv4)</strong>\n                                                <div class=\"row\">\n                                                    <div class=\"col-md-1\"><div>\n                                                        <input type=\"checkbox\" name=\"custom1\" id=\"custom1\" value=\"Customv4\" <?php if (isset($custom1)){ ?>checked<?php } ?>>\n                                                        <label for=\"custom1\"></label></div>\n                                                    </div>\n                                                    <div class=\"col-md-11\">\n                                                        <input type=\"text\" name=\"custom1val\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                                <?php if (isset($custom1)){ ?>value=\"<?php echo $custom1; ?>\"<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <strong>Custom 2 (IPv4)</strong>\n                                                <div class=\"row\">\n                                                    <div class=\"col-md-1\"><div>\n                                                        <input type=\"checkbox\" name=\"custom2\" id=\"custom2\" value=\"Customv4\" <?php if (isset($custom2)){ ?>checked<?php } ?>>\n                                                        <label for=\"custom2\"></label></div>\n                                                    </div>\n                                                    <div class=\"col-md-11\">\n                                                        <input type=\"text\" name=\"custom2val\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               <?php if (isset($custom2)){ ?>value=\"<?php echo $custom2; ?>\"<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-6\">\n                                                <strong>Custom 3 (IPv6)</strong>\n                                                <div class=\"row\">\n                                                    <div class=\"col-md-1\"><div>\n                                                        <input type=\"checkbox\" name=\"custom3\" id=\"custom3\" value=\"Customv6\" <?php if (isset($custom3)){ ?>checked<?php } ?>>\n                                                        <label for=\"custom3\"></label></div>\n                                                    </div>\n                                                    <div class=\"col-md-11\">\n                                                        <input type=\"text\" name=\"custom3val\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                                <?php if (isset($custom3)){ ?>value=\"<?php echo $custom3; ?>\"<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-md-6\">\n                                                <strong>Custom 4 (IPv6)</strong>\n                                                <div class=\"row\">\n                                                    <div class=\"col-md-1\"><div>\n                                                        <input type=\"checkbox\" name=\"custom4\" id=\"custom4\" value=\"Customv6\" <?php if (isset($custom4)){ ?>checked<?php } ?>>\n                                                        <label for=\"custom4\"></label></div>\n                                                    </div>\n                                                    <div class=\"col-md-11\">\n                                                        <input type=\"text\" name=\"custom4val\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                               <?php if (isset($custom4)){ ?>value=\"<?php echo $custom4; ?>\"<?php } ?>>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-lg-6\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h1 class=\"box-title\">Interface listening behavior</h1>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <div class=\"form-group\">\n                                                    <div>\n                                                        <input type=\"radio\" name=\"DNSinterface\" id=\"DNSinterface1\" value=\"local\"\n                                                                <?php if ($DNSinterface == \"local\"){ ?>checked<?php } ?>>\n                                                        <label for=\"DNSinterface1\"><strong>Listen on all interfaces</strong><br>Allows only queries from devices that are at most one hop away (local devices)</label>\n                                                    </div>\n                                                    <div>\n                                                        <input type=\"radio\" name=\"DNSinterface\" id=\"DNSinterface2\" value=\"single\"\n                                                                <?php if ($DNSinterface == \"single\"){ ?>checked<?php } ?>>\n                                                        <label for=\"DNSinterface2\"><strong>Listen only on interface <?php echo htmlentities($piHoleInterface); ?></strong></label>\n                                                    </div>\n                                                    <div>\n                                                        <input type=\"radio\" name=\"DNSinterface\" id=\"DNSinterface3\" value=\"all\"\n                                                                <?php if ($DNSinterface == \"all\"){ ?>checked<?php } ?>>\n                                                        <label for=\"DNSinterface3\"><strong>Listen on all interfaces, permit all origins</strong></label>\n                                                    </div>\n                                                </div>\n                                                <p>Note that the last option should not be used on devices which are\n                                                   directly connected to the Internet. This option is safe if your\n                                                   Pi-hole is located within your local network, i.e. protected behind\n                                                   your router, and you have not forwarded port 53 to this device. In\n                                                   virtually all other cases you have to make sure that your Pi-hole is\n                                                   properly firewalled.</p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-lg-12\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Advanced DNS settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"DNSrequiresFQDN\" id=\"DNSrequiresFQDN\" title=\"domain-needed\" <?php if ($DNSrequiresFQDN){ ?>checked<?php } ?>>\n                                                    <label for=\"DNSrequiresFQDN\"><strong>Never forward non-FQDNs</strong></label>\n                                                    <p>When there is a Pi-hole domain set and this box is\n                                                    ticked, this asks FTL that this domain is purely\n                                                    local and FTL may answer queries from <code>/etc/hosts</code> or DHCP leases\n                                                    but should never forward queries on that domain to any upstream servers.</p>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"DNSbogusPriv\" id=\"DNSbogusPriv\" title=\"bogus-priv\" <?php if ($DNSbogusPriv){ ?>checked<?php } ?>>\n                                                    <label for=\"DNSbogusPriv\"><strong>Never forward reverse lookups for private IP ranges</strong></label>\n                                                    <p>All reverse lookups for private IP ranges (i.e., <code>192.168.0.x/24</code>, etc.)\n                                                    which are not found in <code>/etc/hosts</code> or the DHCP leases are answered\n                                                    with \"no such domain\" rather than being forwarded upstream. The set\n                                                    of prefixes affected is the list given in <a href=\"https://tools.ietf.org/html/rfc6303\">RFC6303</a>.</p>\n                                                    <p><strong>Important</strong>: Enabling these two options may increase your privacy,\n                                                    but may also prevent you from being able to access\n                                                    local hostnames if the Pi-hole is not used as DHCP server.</p>\n                                                </div>\n                                                <br>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"DNSSEC\" id=\"DNSSEC\" <?php if ($DNSSEC){ ?>checked<?php } ?>>\n                                                    <label for=\"DNSSEC\"><strong>Use DNSSEC</strong></label>\n                                                    <p>Validate DNS replies and cache DNSSEC data. When forwarding DNS\n                                                    queries, Pi-hole requests the DNSSEC records needed to validate\n                                                    the replies. If a domain fails validation or the upstream does not\n                                                    support DNSSEC, this setting can cause issues resolving domains.\n                                                    Use an upstream DNS server which supports DNSSEC when activating DNSSEC. Note that\n                                                    the size of your log might increase significantly\n                                                    when enabling DNSSEC. A DNSSEC resolver test can be found\n                                                    <a href=\"https://dnssec.vs.uni-due.de/\" rel=\"noopener\" target=\"_blank\">here</a>.</p>\n                                                </div>\n                                                <br>\n                                                <h4>Conditional forwarding</h4>\n                                                <p>If not configured as your DHCP server, Pi-hole  typically won't be able to\n                                                   determine the names of devices on your local network.  As a\n                                                   result, tables such as Top Clients will only show IP addresses.</p>\n                                                <p>One solution for this is to configure Pi-hole to forward these\n\t                                               requests to your DHCP server (most likely your router), but only for devices on your\n\t                                               home network.  To configure this we will need to know the IP\n\t                                               address of your DHCP server and which addresses belong to your local network.\n                                                   Exemplary input is given below as placeholder in the text boxes (if empty).</p>\n                                                <p>If your local network spans 192.168.0.1 - 192.168.0.255, then you will have to input\n                                                   <code>192.168.0.0/24</code>. If your local network is 192.168.47.1 - 192.168.47.255, it will\n                                                   be <code>192.168.47.0/24</code> and similar. If your network is larger, the CIDR has to be\n                                                   different, for instance a range of 10.8.0.1 - 10.8.255.255 results in <code>10.8.0.0/16</code>,\n                                                   whereas an even wider network of 10.0.0.1 - 10.255.255.255 results in <code>10.0.0.0/8</code>.\n                                                   Setting up IPv6 ranges is exactly similar to setting up IPv4 here and fully supported.\n                                                   Feel free to reach out to us on our\n                                                   <a href=\"https://discourse.pi-hole.net\" target=\"_blank\">Discourse forum</a>\n                                                   in case you need any assistance setting up local host name resolution for your particular system.</p>\n                                                <p>You can also specify a local domain name (like <code>fritz.box</code>) to ensure queries to\n                                                   devices ending in your local domain name will not leave your network, however, this is optional.\n                                                   The local domain name must match the domain name specified\n                                                   in your DHCP server for this to work. You can likely find it within the DHCP settings.</p>\n                                                <div class=\"form-group\">\n                                                    <div>\n                                                        <input type=\"checkbox\" name=\"rev_server\" id=\"rev_server\" value=\"rev_server\" <?php if(isset($rev_server) && ($rev_server == true)){ ?>checked<?php } ?>>\n                                                        <label for=\"rev_server\"><strong>Use Conditional Forwarding</strong></label>\n                                                    </div>\n                                                    <div class=\"input-group\">\n                                                      <table class=\"table table-bordered\">\n                                                        <tr>\n                                                          <th>Local network in <a href=\"https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing\" target=\"_blank\">CIDR notation</a></th>\n                                                          <th>IP address of your DHCP server (router)</th>\n                                                          <th>Local domain name (optional)</th>\n                                                        </tr>\n                                                        <tr>\n                                                          <td>\n                                                            <input type=\"text\" name=\"rev_server_cidr\" placeholder=\"192.168.0.0/16\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                            <?php if(isset($rev_server_cidr)){ ?>value=\"<?php echo $rev_server_cidr; ?>\"<?php } ?>\n                                                            <?php if(!isset($rev_server) || !$rev_server){ ?>disabled<?php } ?>>\n                                                          </td>\n                                                          <td>\n                                                            <input type=\"text\" name=\"rev_server_target\" placeholder=\"192.168.0.1\" class=\"form-control\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                            <?php if(isset($rev_server_target)){ ?>value=\"<?php echo $rev_server_target; ?>\"<?php } ?>\n                                                            <?php if(!isset($rev_server) || !$rev_server){ ?>disabled<?php } ?>>\n                                                          </td>\n                                                          <td>\n                                                            <input type=\"text\" name=\"rev_server_domain\" placeholder=\"local\" class=\"form-control\" data-mask autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                            <?php if(isset($rev_server_domain)){ ?>value=\"<?php echo $rev_server_domain; ?>\"<?php } ?>\n                                                            <?php if(!isset($rev_server) || !$rev_server){ ?>disabled<?php } ?>>\n                                                          </td>\n                                                        </tr>\n                                                      </table>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <input type=\"hidden\" name=\"field\" value=\"DNS\">\n                                <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                <button type=\"submit\" class=\"btn btn-primary pull-right\">Save</button>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n                <!-- ######################################################### API and Web ######################################################### -->\n                <?php\n                // Administrator email address\n                if (isset($setupVars[\"ADMIN_EMAIL\"])) {\n                    $adminemail = $setupVars[\"ADMIN_EMAIL\"];\n                } else {\n                    $adminemail = \"\";\n                }\n                ?>\n                <div id=\"api\" class=\"tab-pane fade<?php if($tab === \"api\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <form role=\"form\" method=\"post\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">API settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <h4>Top Lists</h4>\n                                                <p>Exclude the following domains from being shown in</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-xs-12 col-sm-6 col-md-12 col-lg-6\">\n                                                <div class=\"form-group\">\n                                                    <label>Top Domains / Top Advertisers</label>\n                                                    <textarea name=\"domains\" class=\"form-control\" placeholder=\"Enter one domain per line\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                              rows=\"4\"><?php foreach ($excludedDomains as $domain) {\n                                                                             echo $domain . \"\\n\"; }\n                                                                       ?></textarea>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-xs-12 col-sm-6 col-md-12 col-lg-6\">\n                                                <div class=\"form-group\">\n                                                    <label>Top Clients</label>\n                                                    <textarea name=\"clients\" class=\"form-control\" placeholder=\"Enter one IP address or host name per line\" autocomplete=\"off\" spellcheck=\"false\" autocapitalize=\"none\" autocorrect=\"off\"\n                                                              rows=\"4\"><?php foreach ($excludedClients as $client) {\n                                                                             echo $client . \"\\n\"; }\n                                                                       ?></textarea>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                            <h4>Query Log</h4>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-6\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"querylog-permitted\" id=\"querylog-permitted\" <?php if($queryLog === \"permittedonly\" || $queryLog === \"all\"){ ?>checked<?php } ?>>\n                                                    <label for=\"querylog-permitted\"><strong>Show permitted domain entries</strong></label>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-lg-6\">\n                                                <div>\n                                                <input type=\"checkbox\" name=\"querylog-blocked\" id=\"querylog-blocked\" <?php if($queryLog === \"blockedonly\" || $queryLog === \"all\"){ ?>checked<?php } ?>>\n                                                <label for=\"querylog-blocked\"><strong>Show blocked domain entries</strong></label>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"box-footer clearfix\">\n                                        <input type=\"hidden\" name=\"field\" value=\"API\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                        <button type=\"button\" class=\"btn btn-primary api-token\">Show API token</button>\n                                        <button type=\"submit\" class=\"btn btn-primary pull-right\">Save</button>\n                                    </div>\n                                </div>\n                            </form>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <form role=\"form\" method=\"post\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Web interface settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <h4>Interface appearance</h4>\n                                                <?php theme_selection(); ?>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"boxedlayout\" id=\"boxedlayout\" value=\"yes\" <?php if ($boxedlayout){ ?>checked<?php } ?>>\n                                                    <label for=\"boxedlayout\"><strong>Use boxed layout (for large screens)</strong></label>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <h4>Administrator Email Address</h4>\n                                                <input type=\"email\" class=\"form-control\" name=\"adminemail\" value=\"<?php echo htmlspecialchars($adminemail); ?>\">\n                                                <input type=\"hidden\" name=\"field\" value=\"webUI\">\n                                                <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"box-footer clearfix\">\n                                        <button type=\"submit\" class=\"btn btn-primary pull-right\">Save</button>\n                                    </div>\n                                </div>\n                            </form>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <div class=\"box box-warning\">\n                                <div class=\"box-header with-border\">\n                                    <h3 class=\"box-title\">Styling (auto saved, per-browser)</h3>\n                                </div>\n                                <div class=\"box-body\">\n                                    <div class=\"row\">\n                                        <div class=\"col-md-6\">\n                                            <p>Checkbox and radio buttons</p>\n                                        </div>\n                                        <div class=\"col-md-6\">\n                                            <select id=\"iCheckStyle\">\n                                                <option>default</option>\n                                                <option>primary</option>\n                                                <option>success</option>\n                                                <option>info</option>\n                                                <option>warning</option>\n                                                <option>danger</option>\n                                                <option>turquoise</option>\n                                                <option>emerland</option>\n                                                <option>peterriver</option>\n                                                <option>amethyst</option>\n                                                <option>wetasphalt</option>\n                                                <option>greensea</option>\n                                                <option>nephritis</option>\n                                                <option>belizehole</option>\n                                                <option>wisteria</option>\n                                                <option>midnightblue</option>\n                                                <option>sunflower</option>\n                                                <option>carrot</option>\n                                                <option>alizarin</option>\n                                                <option>clouds</option>\n                                                <option>concrete</option>\n                                                <option>orange</option>\n                                                <option>pumpkin</option>\n                                                <option>pomegranate</option>\n                                                <option>silver</option>\n                                                <option>asbestos</option>\n\n                                                <option>material-red</option>\n                                                <option>material-pink</option>\n                                                <option>material-purple</option>\n                                                <option>material-deeppurple</option>\n                                                <option>material-indigo</option>\n                                                <option>material-blue</option>\n                                                <option>material-lightblue</option>\n                                                <option>material-cyan</option>\n                                                <option>material-teal</option>\n                                                <option>material-green</option>\n                                                <option>material-lightgreen</option>\n                                                <option>material-lime</option>\n                                                <option>material-yellow</option>\n                                                <option>material-amber</option>\n                                                <option>material-orange</option>\n                                                <option>material-deeporange</option>\n                                                <option>material-brown</option>\n                                                <option>material-grey</option>\n                                                <option>material-bluegrey</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div class=\"row\">\n                                        <div class=\"col-md-6\">\n                                            <p>CPU Temperature Unit</p>\n                                        </div>\n                                        <div class=\"col-md-6\">\n                                            <select id=\"tempunit-selector\">\n                                                <option value=\"C\">Celsius</option>\n                                                <option value=\"K\">Kelvin</option>\n                                                <option value=\"F\">Fahrenheit</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div class=\"row\">\n                                        <div class=\"col-md-12\">\n                                            <div>\n                                                <input type=\"checkbox\" name=\"bargraphs\" id=\"bargraphs\" value=\"yes\">\n                                                <label for=\"bargraphs\"><strong>Use new Bar charts on dashboard</strong></label>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- ######################################################### Privacy (may be expanded further later on) ######################################################### -->\n                <?php\n                // Get privacy level from piholeFTL config array\n                if (isset($piholeFTLConf[\"PRIVACYLEVEL\"])) {\n                    $privacylevel = intval($piholeFTLConf[\"PRIVACYLEVEL\"]);\n                } else {\n                    $privacylevel = 0;\n                }\n                ?>\n                <div id=\"privacy\" class=\"tab-pane fade<?php if($tab === \"privacy\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <form role=\"form\" method=\"post\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Privacy settings</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-md-12\">\n                                                <h4>DNS resolver privacy level</h4>\n                                                <p>Specify if DNS queries should be anonymized, available options are:</p>\n                                                <div>\n                                                    <input type=\"radio\" name=\"privacylevel\" id=\"privacylevel_0\" value=\"0\" <?php if ($privacylevel === 0){ ?>checked<?php } ?>>\n                                                    <label for=\"privacylevel_0\"><strong>Show everything and record everything</strong></label>\n                                                    <p>Gives maximum amount of statistics</p>\n                                                </div>\n                                                <div>\n                                                    <input type=\"radio\" name=\"privacylevel\" id=\"privacylevel_1\" value=\"1\" <?php if ($privacylevel === 1){ ?>checked<?php } ?>>\n                                                    <label for=\"privacylevel_1\"><strong>Hide domains: Display and store all domains as \"hidden\"</strong></label>\n                                                    <p>This disables the Top Domains and Top Ads tables on the dashboard</p>\n                                                </div>\n                                                <div>\n                                                    <input type=\"radio\" name=\"privacylevel\" id=\"privacylevel_2\" value=\"2\" <?php if ($privacylevel === 2){ ?>checked<?php } ?>>\n                                                    <label for=\"privacylevel_2\"><strong>Hide domains and clients: Display and store all domains as \"hidden\" and all clients as \"0.0.0.0\"</strong></label>\n                                                    <p>This disables all tables on the dashboard</p>\n                                                </div>\n                                                <div>\n                                                    <input type=\"radio\" name=\"privacylevel\" id=\"privacylevel_3\" value=\"3\" <?php if ($privacylevel === 3){ ?>checked<?php } ?>>\n                                                    <label for=\"privacylevel_3\"><strong>Anonymous mode: This disables basically everything except the live anonymous statistics</strong></label>\n                                                    <p>No history is saved at all to the database, and nothing is shown in the query log. Also, there are no top item lists.</p>\n                                                </div>\n                                                <p>The privacy level may be increased at any time without having to restart the DNS resolver. However, note that the DNS resolver needs to be restarted when lowering the privacy level. This restarting is automatically done when saving.</p>\n                                                <?php if($privacylevel > 0 && $piHoleLogging){ ?>\n                                                <p class=\"lookatme\">Warning: Pi-hole's query logging is activated. Although the dashboard will hide the requested details, all queries are still fully logged to the pihole.log file.</p>\n                                                <?php } ?>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"box-footer clearfix\">\n                                        <input type=\"hidden\" name=\"field\" value=\"privacyLevel\">\n                                        <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                                        <button type=\"submit\" class=\"btn btn-primary pull-right\">Apply</button>\n                                    </div>\n                                </div>\n                            </form>\n                        </div>\n                    </div>\n                </div>\n                <!-- ######################################################### Teleporter ######################################################### -->\n                <div id=\"teleporter\" class=\"tab-pane fade<?php if($tab === \"teleporter\"){ ?> in active<?php } ?>\">\n                    <div class=\"row\">\n                        <?php if (extension_loaded('Phar')) { ?>\n                        <form role=\"form\" method=\"post\" id=\"takeoutform\"\n                              action=\"scripts/pi-hole/php/teleporter.php\"\n                              target=\"_blank\" enctype=\"multipart/form-data\">\n                            <input type=\"hidden\" name=\"token\" value=\"<?php echo $token ?>\">\n                            <div class=\"col-lg-6 col-md-12\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Backup</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <p>Backup your Pi-hole configuration (settings &amp; lists) as a downloadable archive</p>\n                                                <button type=\"submit\" class=\"btn btn-default\">Backup</button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"col-lg-6 col-md-12\">\n                                <div class=\"box box-warning\">\n                                    <div class=\"box-header with-border\">\n                                        <h3 class=\"box-title\">Restore</h3>\n                                    </div>\n                                    <div class=\"box-body\">\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <label>Restore...</label>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-6\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"whitelist\" id=\"tele_whitelist\" value=\"true\" checked>\n                                                    <label for=\"tele_whitelist\">Whitelist (exact)</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"regex_whitelist\" id=\"tele_regex_whitelist\" value=\"true\" checked>\n                                                    <label for=\"tele_regex_whitelist\">Whitelist (regex/wildcard)</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"blacklist\" id=\"tele_blacklist\" value=\"true\" checked>\n                                                    <label for=\"tele_blacklist\">Blacklist (exact)</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"regexlist\" id=\"tele_regexlist\" value=\"true\" checked>\n                                                    <label for=\"tele_regexlist\">Blacklist (regex/wildcard)</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"adlist\" id=\"tele_adlist\" value=\"true\" checked>\n                                                    <label for=\"tele_adlist\">Adlists</label>\n                                                </div>\n                                            </div>\n                                            <div class=\"col-lg-6\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"client\" id=\"tele_client\" value=\"true\" checked>\n                                                    <label for=\"tele_client\">Client</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"group\" id=\"tele_group\" value=\"true\" checked>\n                                                    <label for=\"tele_group\">Group</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"auditlog\" id=\"tele_auditlog\" value=\"true\" checked>\n                                                    <label for=\"tele_auditlog\">Audit log</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"staticdhcpleases\" id=\"tele_staticdhcpleases\" value=\"true\" checked>\n                                                    <label for=\"tele_staticdhcpleases\">Static DHCP Leases</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"localdnsrecords\" id=\"tele_localdnsrecords\" value=\"true\" checked>\n                                                    <label for=\"tele_localdnsrecords\">Local DNS Records</label>\n                                                </div>\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"localcnamerecords\" id=\"tele_localcnamerecords\" value=\"true\" checked>\n                                                    <label for=\"tele_localcnamerecords\">Local CNAME Records</label>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <label for=\"zip_file\">File input</label>\n                                                <input type=\"file\" name=\"zip_file\" id=\"zip_file\">\n                                                <p class=\"help-block\">Upload only Pi-hole backup files.</p>\n                                            </div>\n                                        </div>\n                                        <div class=\"row\">\n                                            <div class=\"col-lg-12\">\n                                                <div>\n                                                    <input type=\"checkbox\" name=\"flushtables\" id=\"tele_flushtables\" value=\"true\" checked>\n                                                    <label for=\"tele_flushtables\">Clear existing data</label>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"box-footer clearfix\">\n                                        <button type=\"submit\" class=\"btn btn-default\" name=\"action\" value=\"in\">Restore</button>\n                                    </div>\n                                </div>\n                            </div>\n                        </form>\n                        <?php } else { ?>\n                        <div class=\"col-lg-12\">\n                            <div class=\"box box-warning\">\n                                <div class=\"box-header with-border\">\n                                    <h3 class=\"box-title\">Teleporter</h3>\n                                </div>\n                                <div class=\"box-body\">\n                                    <p>The PHP extension <code>Phar</code> is not loaded. Please ensure it is installed and loaded if you want to use the Pi-hole teleporter.</p>\n                                </div>\n                            </div>\n                        </div>\n                        <?php } ?>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src=\"scripts/vendor/jquery.confirm.min.js?v=<?=$cacheVer?>\"></script>\n<script src=\"scripts/pi-hole/js/utils.js?v=<?=$cacheVer?>\"></script>\n<script src=\"scripts/pi-hole/js/settings.js?v=<?=$cacheVer?>\"></script>\n\n<?php\nrequire \"scripts/pi-hole/php/footer.php\";\n?>\n"], "filenames": ["scripts/pi-hole/php/func.php", "settings.php"], "buggy_code_start_loc": [474, 44], "buggy_code_end_loc": [474, 45], "fixing_code_start_loc": [475, 44], "fixing_code_end_loc": [476, 45], "type": "CWE-79", "message": "adminlte is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')", "other": {"cve": {"id": "CVE-2021-3812", "sourceIdentifier": "security@huntr.dev", "published": "2021-09-17T07:15:09.467", "lastModified": "2021-09-28T02:32:32.737", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "adminlte is vulnerable to Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')"}, {"lang": "es", "value": "adminlte es vulnerable a una Neutralizaci\u00f3n Inapropiada de Entradas Durante la Generaci\u00f3n de P\u00e1ginas Web (\"Cross-site Scripting\")"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H", "attackVector": "LOCAL", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 6.7, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 0.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security@huntr.dev", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:pi-hole:web_interface:*:*:*:*:*:*:*:*", "versionEndExcluding": "5.6", "matchCriteriaId": "6D79F113-D19A-4712-94DD-5DCF23E6416B"}]}]}], "references": [{"url": "https://github.com/pi-hole/adminlte/commit/f526716de7bb0fd382a64bcbbb33915c926f94bb", "source": "security@huntr.dev", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://huntr.dev/bounties/875a6885-9a64-46f3-94ad-92f40f989200", "source": "security@huntr.dev", "tags": ["Exploit", "Issue Tracking", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/pi-hole/adminlte/commit/f526716de7bb0fd382a64bcbbb33915c926f94bb"}}