{"buggy_code": ["<?php\n/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\nuse Egulias\\EmailValidator\\EmailValidator;\nuse Egulias\\EmailValidator\\Validation\\MultipleValidationWithAnd;\nuse Egulias\\EmailValidator\\Validation\\RFCValidation;\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\Constraints\\CustomerName;\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\Factory\\CustomerNameValidatorFactory;\nuse PrestaShop\\PrestaShop\\Core\\Domain\\Currency\\ValueObject\\NumericIsoCode;\nuse PrestaShop\\PrestaShop\\Core\\Domain\\Customer\\ValueObject\\ApeCode;\nuse PrestaShop\\PrestaShop\\Core\\Domain\\Product\\ValueObject\\Isbn;\nuse PrestaShop\\PrestaShop\\Core\\Email\\SwiftMailerValidation;\nuse PrestaShop\\PrestaShop\\Core\\Security\\PasswordPolicyConfiguration;\nuse Symfony\\Component\\Validator\\Constraints\\Email;\nuse Symfony\\Component\\Validator\\Validation;\nuse ZxcvbnPhp\\Zxcvbn;\n\nclass ValidateCore\n{\n    public const ORDER_BY_REGEXP = '/^(?:(`?)[\\w!_-]+\\1\\.)?(?:(`?)[\\w!_-]+\\2)$/';\n    public const OBJECT_CLASS_NAME_REGEXP = '/^[a-zA-Z_\\x80-\\xff][a-zA-Z0-9_\\x80-\\xff]*(\\\\\\\\[a-zA-Z_\\x80-\\xff][a-zA-Z0-9_\\x80-\\xff]*)*$/';\n    /**\n     * Maximal 32 bits value: (2^32)-1\n     *\n     * @var int\n     */\n    public const MYSQL_UNSIGNED_INT_MAX = 4294967295;\n\n    /**\n     * @deprecated since 8.0.0 use PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_LENGTH\n     */\n    public const ADMIN_PASSWORD_LENGTH = 8;\n\n    /**\n     * @deprecated since 8.0.0 use PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_LENGTH\n     */\n    public const PASSWORD_LENGTH = 5;\n\n    public static function isIp2Long($ip)\n    {\n        return preg_match('#^-?[0-9]+$#', (string) $ip);\n    }\n\n    /**\n     * @deprecated since PrestaShop 8.1 and will be removed in Prestashop 9.0\n     */\n    public static function isAnything()\n    {\n        @trigger_error(\n            'This function is deprecated PrestaShop 8.1 and will be removed in Prestashop 9.0.',\n            E_USER_DEPRECATED\n        );\n\n        return true;\n    }\n\n    /**\n     * Check for e-mail validity.\n     *\n     * @param string $email e-mail address to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isEmail($email)\n    {\n        // Check if the value is empty\n        if (empty($email)) {\n            return false;\n        }\n\n        $validator = Validation::createValidator();\n        $errors = $validator->validate($email, new Email([\n            'mode' => 'loose',\n        ]));\n\n        if (count($errors) > 0) {\n            return false;\n        }\n\n        // Check if the value is correct according to both validators (RFC & SwiftMailer)\n        return (new EmailValidator())->isValid($email, new MultipleValidationWithAnd([\n            new RFCValidation(),\n            new SwiftMailerValidation(), // special validation to be compatible with Swift Mailer\n        ]));\n    }\n\n    /**\n     * Check for module URL validity.\n     *\n     * @param string $url module URL to validate\n     * @param array $errors Reference array for catching errors\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isModuleUrl($url, &$errors)\n    {\n        if (!$url || $url == 'http://') {\n            $errors[] = Context::getContext()->getTranslator()->trans('Please specify module URL', [], 'Admin.Modules.Notification');\n        } elseif (substr($url, -4) != '.tar' && substr($url, -4) != '.zip' && substr($url, -4) != '.tgz' && substr($url, -7) != '.tar.gz') {\n            $errors[] = Context::getContext()->getTranslator()->trans('Unknown archive type.', [], 'Admin.Modules.Notification');\n        } else {\n            if ((strpos($url, 'http')) === false) {\n                $url = 'http://' . $url;\n            }\n            if (!is_array(@get_headers($url))) {\n                $errors[] = Context::getContext()->getTranslator()->trans('Invalid URL', [], 'Admin.Notifications.Error');\n            }\n        }\n        if (!count($errors)) {\n            return true;\n        }\n\n        return false;\n    }\n\n    /**\n     * Check for MD5 string validity.\n     *\n     * @param string $md5 MD5 string to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMd5($md5)\n    {\n        return preg_match('/^[a-f0-9A-F]{32}$/', $md5);\n    }\n\n    /**\n     * Check for SHA1 string validity.\n     *\n     * @param string $sha1 SHA1 string to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isSha1($sha1)\n    {\n        return preg_match('/^[a-fA-F0-9]{40}$/', $sha1);\n    }\n\n    /**\n     * Check for a float number validity.\n     *\n     * @param float $float Float number to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isFloat($float)\n    {\n        return (string) ((float) $float) == (string) $float;\n    }\n\n    public static function isUnsignedFloat($float)\n    {\n        return (string) ((float) $float) == (string) $float && $float >= 0;\n    }\n\n    /**\n     * Check for a float number validity.\n     *\n     * @param float $float Float number to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isOptFloat($float)\n    {\n        return empty($float) || Validate::isFloat($float);\n    }\n\n    /**\n     * Check for a carrier name validity.\n     *\n     * @param string $name Carrier name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCarrierName($name)\n    {\n        return empty($name) || preg_match('/^[^<>;=#{}]*$/u', $name);\n    }\n\n    /**\n     * Check for an image size validity.\n     *\n     * @param string $size Image size to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isImageSize($size)\n    {\n        return preg_match('/^[0-9]{1,4}$/', $size);\n    }\n\n    /**\n     * Check whether given customer name is valid\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool\n     */\n    public static function isCustomerName($name)\n    {\n        $validatorBuilder = Validation::createValidatorBuilder();\n        $validatorBuilder->setConstraintValidatorFactory(new CustomerNameValidatorFactory());\n        $validator = $validatorBuilder->getValidator();\n        $violations = $validator->validate($name, [\n            new CustomerName(),\n        ]);\n\n        return count($violations) === 0;\n    }\n\n    /**\n     * Check whether given name is valid\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool\n     */\n    public static function isName($name)\n    {\n        return preg_match('/^[^0-9!<>,;?=+()@#\"\u00b0{}_$%:\u00a4|]*$/u', $name);\n    }\n\n    /**\n     * Check for hook name validity.\n     *\n     * @param string $hook Hook name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isHookName($hook)\n    {\n        return preg_match('/^[a-zA-Z0-9_-]+$/', $hook);\n    }\n\n    /**\n     * Check for sender name validity.\n     *\n     * @param string $mail_name Sender name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMailName($mail_name)\n    {\n        return is_string($mail_name) && preg_match('/^[^<>;=#{}]*$/u', $mail_name);\n    }\n\n    /**\n     * Check for e-mail subject validity.\n     *\n     * @param string $mail_subject e-mail subject to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMailSubject($mail_subject)\n    {\n        return preg_match('/^[^<>]*$/u', $mail_subject);\n    }\n\n    /**\n     * Check for module name validity.\n     *\n     * @param string $module_name Module name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isModuleName($module_name)\n    {\n        return is_string($module_name) && preg_match('/^[a-zA-Z0-9_-]+$/', $module_name);\n    }\n\n    /**\n     * Check for template name validity.\n     *\n     * @param string $tpl_name Template name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTplName($tpl_name)\n    {\n        return preg_match('/^[a-zA-Z0-9_-]+$/', $tpl_name);\n    }\n\n    /**\n     * Check for image type name validity.\n     *\n     * @param string $type Image type name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isImageTypeName($type)\n    {\n        return preg_match('/^[a-zA-Z0-9_ -]+$/', $type);\n    }\n\n    /**\n     * Check for price validity.\n     *\n     * @param string $price Price to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPrice($price)\n    {\n        return preg_match('/^[0-9]{1,10}(\\.[0-9]{1,9})?$/', $price);\n    }\n\n    /**\n     * Check for price validity (including negative price).\n     *\n     * @param string $price Price to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isNegativePrice($price)\n    {\n        return preg_match('/^[-]?[0-9]{1,10}(\\.[0-9]{1,9})?$/', $price);\n    }\n\n    /**\n     * Check for language code (ISO) validity.\n     *\n     * @param string $iso_code Language code (ISO) to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLanguageIsoCode($iso_code)\n    {\n        return preg_match('/^[a-zA-Z]{2,3}$/', $iso_code);\n    }\n\n    public static function isLanguageCode($s)\n    {\n        return preg_match('/^[a-zA-Z]{2}(-[a-zA-Z]{2})?$/', $s);\n    }\n\n    /**\n     * @see https://en.wikipedia.org/wiki/IETF_language_tag#ISO_3166-1_and_UN_M.49\n     *\n     * @param string $s\n     *\n     * @return bool\n     */\n    public static function isLocale($s)\n    {\n        return preg_match('/^[a-z]{2}-[A-Z]{2}$/', $s);\n    }\n\n    public static function isStateIsoCode($iso_code)\n    {\n        return preg_match('/^[a-zA-Z0-9]{1,4}((-)[a-zA-Z0-9]{1,4})?$/', $iso_code);\n    }\n\n    public static function isNumericIsoCode($iso_code)\n    {\n        return preg_match(NumericIsoCode::PATTERN, $iso_code);\n    }\n\n    /**\n     * Check for voucher name validity.\n     *\n     * @param string $voucher voucher to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isDiscountName($voucher)\n    {\n        return preg_match('/^[^!<>,;?=+()@\"\u00b0{}_$%:]{3,32}$/u', $voucher);\n    }\n\n    /**\n     * Check for product or category name validity.\n     *\n     * @param string $name Product or category name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCatalogName($name)\n    {\n        return preg_match('/^[^<>;=#{}]*$/u', $name);\n    }\n\n    /**\n     * Check for a message validity.\n     *\n     * @param string $message Message to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMessage($message)\n    {\n        return !preg_match('/[<>{}]/i', $message);\n    }\n\n    /**\n     * Check for a country name validity.\n     *\n     * @param string $name Country name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCountryName($name)\n    {\n        return preg_match('/^[a-zA-Z -]+$/', $name);\n    }\n\n    /**\n     * Check for a link (url-rewriting only) validity.\n     *\n     * @param string $link Link to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLinkRewrite($link)\n    {\n        if (Configuration::get('PS_ALLOW_ACCENTED_CHARS_URL')) {\n            return preg_match('/^[_a-zA-Z0-9\\x{0600}-\\x{06FF}\\pL\\pS-]+$/u', $link);\n        }\n\n        return preg_match('/^[_a-zA-Z0-9\\-]+$/', $link);\n    }\n\n    /**\n     * Check for a route pattern validity.\n     *\n     * @param string $pattern to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isRoutePattern($pattern)\n    {\n        if (Configuration::get('PS_ALLOW_ACCENTED_CHARS_URL')) {\n            return preg_match('/^[_a-zA-Z0-9\\x{0600}-\\x{06FF}\\(\\)\\.{}:\\/\\pL\\pS-]+$/u', $pattern);\n        }\n\n        return preg_match('/^[_a-zA-Z0-9\\(\\)\\.{}:\\/\\-]+$/', $pattern);\n    }\n\n    /**\n     * Check for a postal address validity.\n     *\n     * @param string $address Address to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isAddress($address)\n    {\n        return empty($address) || preg_match('/^[^!<>?=+@{}_$%]*$/u', $address);\n    }\n\n    /**\n     * Check for city name validity.\n     *\n     * @param string $city City name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCityName($city)\n    {\n        return preg_match('/^[^!<>;?=+@#\"\u00b0{}_$%]*$/u', $city);\n    }\n\n    /**\n     * Check for search query validity.\n     *\n     * @param string $search Query to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isValidSearch($search)\n    {\n        return preg_match('/^[^<>;=#{}]{0,64}$/u', $search);\n    }\n\n    /**\n     * Check for standard name validity.\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isGenericName($name)\n    {\n        return empty($name) || preg_match('/^[^<>={}]*$/u', $name);\n    }\n\n    /**\n     * Check for HTML field validity (no XSS please !).\n     *\n     * @param string $html HTML field to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCleanHtml($html, $allow_iframe = false)\n    {\n        $events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n        $events .= '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n        $events .= '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n        $events .= '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|onmousewheel';\n        $events .= '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n        $events .= '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n        $events .= '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n        $events .= '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n\n        if (preg_match('/<[\\s]*script/ims', $html) || preg_match('/(' . $events . ')[\\s]*=/ims', $html) || preg_match('/.*script\\:/ims', $html)) {\n            return false;\n        }\n\n        if (!$allow_iframe && preg_match('/<[\\s]*(i?frame|form|input|embed|object)/ims', $html)) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Check for product reference validity.\n     *\n     * @param string $reference Product reference to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isReference($reference)\n    {\n        return preg_match('/^[^<>;={}]*$/u', $reference);\n    }\n\n    /**\n     * Check if the password score is valid\n     *\n     * @param string $password Password to validate\n     *\n     * @return bool Indicates whether the given string is a valid password\n     *\n     * @since 8.0.0\n     */\n    public static function isAcceptablePasswordScore(string $password): bool\n    {\n        $zxcvbn = new Zxcvbn();\n        $result = $zxcvbn->passwordStrength($password);\n        $minScore = Configuration::hasKey(PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_SCORE) ?\n                  Configuration::get(PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_SCORE) :\n                  PasswordPolicyConfiguration::PASSWORD_SAFELY_UNGUESSABLE;\n\n        return isset($result['score']) && $result['score'] >= $minScore;\n    }\n\n    /**\n     * Check if password length is valid\n     *\n     * @param string $password Password to validate\n     *\n     * @return bool Indicates whether the given string is a valid password length\n     *\n     * @since 8.0.0\n     */\n    public static function isAcceptablePasswordLength(string $password): bool\n    {\n        $passwordLength = Tools::strlen($password);\n        if (Configuration::hasKey(PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_LENGTH)\n            && Configuration::hasKey(PasswordPolicyConfiguration::CONFIGURATION_MAXIMUM_LENGTH)\n        ) {\n            return $passwordLength >= Configuration::get(PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_LENGTH)\n                && $passwordLength <= Configuration::get(PasswordPolicyConfiguration::CONFIGURATION_MAXIMUM_LENGTH);\n        }\n\n        // If value doesn't exist in database, use default behavior check\n        return $passwordLength >= PasswordPolicyConfiguration::DEFAULT_MINIMUM_LENGTH && $passwordLength <= PasswordPolicyConfiguration::DEFAULT_MAXIMUM_LENGTH;\n    }\n\n    /**\n     * Check if plaintext password is valid\n     * Size is limited by `password_hash()` (72 chars).\n     *\n     * @param string $plaintextPasswd Password to validate\n     * @param int $size\n     *\n     * @return bool Indicates whether the given string is a valid plaintext password\n     *\n     * @since 1.7.0\n     * @deprecated since 8.0, use Validate::isAcceptablePasswordLength instead\n     */\n    public static function isPlaintextPassword($plaintextPasswd, $size = Validate::PASSWORD_LENGTH)\n    {\n        // The password length is limited by `password_hash()`\n        return Tools::strlen($plaintextPasswd) >= $size && Tools::strlen($plaintextPasswd) <= 72;\n    }\n\n    /**\n     * Check if hashed password is valid\n     * PrestaShop supports both MD5 and `PASSWORD_BCRYPT` (PHP API)\n     * The lengths are 32 (MD5) or 60 (`PASSWORD_BCRYPT`)\n     * Anything else is invalid.\n     *\n     * @param string $hashedPasswd Password to validate\n     *\n     * @return bool Indicates whether the given string is a valid hashed password\n     *\n     * @since 1.7.0\n     */\n    public static function isHashedPassword($hashedPasswd)\n    {\n        return Tools::strlen($hashedPasswd) == 32 || Tools::strlen($hashedPasswd) == 60;\n    }\n\n    /**\n     * @deprecated since 8.0\n     */\n    public static function isPasswdAdmin($passwd)\n    {\n        return Validate::isPlaintextPassword($passwd, Validate::ADMIN_PASSWORD_LENGTH);\n    }\n\n    /**\n     * Check for configuration key validity.\n     *\n     * @param string $config_name Configuration key to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isConfigName($config_name)\n    {\n        return preg_match('/^[a-zA-Z_0-9-]+$/', $config_name);\n    }\n\n    /**\n     * Check date formats like http://php.net/manual/en/function.date.php.\n     *\n     * @param string $date_format date format to check\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPhpDateFormat($date_format)\n    {\n        // We can't really check if this is valid or not, because this is a string and you can write whatever you want in it.\n        // That's why only < et > are forbidden (HTML)\n        return preg_match('/^[^<>]+$/', $date_format);\n    }\n\n    /**\n     * Check for date format.\n     *\n     * @param string $date Date to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isDateFormat($date)\n    {\n        return (bool) preg_match('/^([0-9]{4})-((0?[0-9])|(1[0-2]))-((0?[0-9])|([1-2][0-9])|(3[01]))( [0-9]{2}:[0-9]{2}:[0-9]{2})?$/', $date);\n    }\n\n    /**\n     * Check for date validity.\n     *\n     * @param string $date Date to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isDate($date)\n    {\n        if (!preg_match('/^([0-9]{4})-((?:0?[0-9])|(?:1[0-2]))-((?:0?[0-9])|(?:[1-2][0-9])|(?:3[01]))( [0-9]{2}:[0-9]{2}:[0-9]{2})?$/', $date, $matches)) {\n            return false;\n        }\n\n        return checkdate((int) $matches[2], (int) $matches[3], (int) $matches[1]);\n    }\n\n    public static function isDateOrNull($date)\n    {\n        if (null === $date || $date === '0000-00-00 00:00:00' || $date === '0000-00-00') {\n            return true;\n        }\n\n        return self::isDate($date);\n    }\n\n    /**\n     * Check for birthDate validity. To avoid year in two digits, disallow date < 200 years ago\n     *\n     * @param string $date birthdate to validate\n     * @param string $format optional format\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isBirthDate($date, $format = 'Y-m-d')\n    {\n        if (empty($date) || $date == '0000-00-00') {\n            return true;\n        }\n\n        $d = DateTime::createFromFormat($format, $date);\n        if (!empty(DateTime::getLastErrors()['warning_count']) || false === $d) {\n            return false;\n        }\n        $twoHundredYearsAgo = new Datetime();\n        $twoHundredYearsAgo->sub(new DateInterval('P200Y'));\n\n        return $d->setTime(0, 0, 0) <= new Datetime() && $d->setTime(0, 0, 0) >= $twoHundredYearsAgo;\n    }\n\n    /**\n     * Check for boolean validity.\n     *\n     * @param mixed $bool Value to validate as a boolean\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isBool($bool)\n    {\n        return $bool === null || is_bool($bool) || preg_match('/^(0|1)$/', $bool);\n    }\n\n    /**\n     * Check for phone number validity.\n     *\n     * @param string $number Phone number to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPhoneNumber($number)\n    {\n        return preg_match('/^[+0-9. ()\\/-]*$/', $number);\n    }\n\n    /**\n     * Check for barcode validity (EAN-13).\n     *\n     * @param string $ean13 Barcode to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isEan13($ean13)\n    {\n        return !$ean13 || preg_match('/^[0-9]{0,13}$/', $ean13);\n    }\n\n    /**\n     * Check for ISBN.\n     *\n     * @param string $isbn validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isIsbn($isbn)\n    {\n        return !$isbn || preg_match(Isbn::VALID_PATTERN, $isbn);\n    }\n\n    /**\n     * Check for barcode validity (UPC).\n     *\n     * @param string $upc Barcode to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUpc($upc)\n    {\n        return !$upc || preg_match('/^[0-9]{0,12}$/', $upc);\n    }\n\n    /**\n     * Check for MPN validity.\n     *\n     * @param string $mpn to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMpn($mpn)\n    {\n        return Tools::strlen($mpn) <= 40;\n    }\n\n    /**\n     * Check for postal code validity.\n     *\n     * @param string $postcode Postal code to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPostCode($postcode)\n    {\n        return empty($postcode) || preg_match('/^[a-zA-Z 0-9-]+$/', $postcode);\n    }\n\n    /**\n     * Check for zip code format validity.\n     *\n     * @param string $zip_code zip code format to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isZipCodeFormat($zip_code)\n    {\n        if (!empty($zip_code)) {\n            return preg_match('/^[NLCnlc 0-9-]+$/', $zip_code);\n        }\n\n        return true;\n    }\n\n    /**\n     * Check for table or identifier validity\n     * Mostly used in database for ordering : ASC / DESC.\n     *\n     * @param string $way Keyword to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isOrderWay($way)\n    {\n        return !empty($way) && in_array(strtolower($way), ['asc', 'desc', 'random']);\n    }\n\n    /**\n     * Check for table or identifier validity\n     * Mostly used in database for ordering : ORDER BY field.\n     *\n     * @param string $order Field to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isOrderBy($order)\n    {\n        return !empty($order) && preg_match(static::ORDER_BY_REGEXP, $order);\n    }\n\n    /**\n     * Check for table or identifier validity\n     * Mostly used in database for table names and id_table.\n     *\n     * @param string $table Table/identifier to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTableOrIdentifier($table)\n    {\n        return preg_match('/^[a-zA-Z0-9_-]+$/', $table);\n    }\n\n    /**\n     * Check for tags list validity.\n     *\n     * @param string $list List to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTagsList($list)\n    {\n        return preg_match('/^[^!<>;?=+#\"\u00b0{}_$%]*$/u', $list);\n    }\n\n    /**\n     * Check for product visibility.\n     *\n     * @param string $s visibility to check\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isProductVisibility($s)\n    {\n        return preg_match('/^both|catalog|search|none$/i', $s);\n    }\n\n    /**\n     * Check for an integer validity.\n     *\n     * @param int|bool $value Integer to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isInt($value)\n    {\n        return (string) (int) $value === (string) $value || $value === false;\n    }\n\n    /**\n     * Check for an integer validity (unsigned).\n     *\n     * @param mixed $value Integer to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUnsignedInt($value)\n    {\n        return (is_numeric($value) || is_string($value))\n            && (string) (int) $value === (string) $value\n            && $value < (static::MYSQL_UNSIGNED_INT_MAX + 1)\n            && $value >= 0;\n    }\n\n    /**\n     * Check for a number (int) bigger than 0\n     *\n     * @param mixed $value Integer with value bigger than 0 to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPositiveInt($value)\n    {\n        return self::isUnsignedInt($value) && $value > 0;\n    }\n\n    /**\n     * Check for an percentage validity (between 0 and 100).\n     *\n     * @param float $value Float to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPercentage($value)\n    {\n        return Validate::isFloat($value) && $value >= 0 && $value <= 100;\n    }\n\n    /**\n     * Check for an integer validity (unsigned)\n     * Mostly used in database for auto-increment.\n     *\n     * @param int $id Integer to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUnsignedId($id)\n    {\n        return Validate::isUnsignedInt($id); /* Because an id could be equal to zero when there is no association */\n    }\n\n    public static function isNullOrUnsignedId($id)\n    {\n        return $id === null || Validate::isUnsignedId($id);\n    }\n\n    /**\n     * Check object validity.\n     *\n     * @param object $object Object to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLoadedObject($object)\n    {\n        return is_object($object) && $object->id;\n    }\n\n    /**\n     * Check color validity.\n     *\n     * @param string $color Color to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isColor($color)\n    {\n        return preg_match('/^(#[0-9a-fA-F]{6}|[a-zA-Z0-9-]*)$/', $color);\n    }\n\n    /**\n     * Check url validity (disallowed empty string).\n     *\n     * @param string $url Url to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUrl($url)\n    {\n        return preg_match('/^[~:#,$%&_=\\(\\)\\.\\? \\+\\-@\\/a-zA-Z0-9\\pL\\pS-]+$/u', $url);\n    }\n\n    /**\n     * Check tracking number validity (disallowed empty string).\n     *\n     * @param string $tracking_number Tracking number to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTrackingNumber($tracking_number)\n    {\n        return preg_match('/^[~:#,%&_=\\(\\)\\[\\]\\.\\? \\+\\-@\\/a-zA-Z0-9]+$/', $tracking_number);\n    }\n\n    /**\n     * Check url validity (allowed empty string).\n     *\n     * @param string $url Url to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUrlOrEmpty($url)\n    {\n        return empty($url) || Validate::isUrl($url);\n    }\n\n    /**\n     * Check if URL is absolute.\n     *\n     * @param string $url URL to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isAbsoluteUrl($url)\n    {\n        if (!empty($url)) {\n            return preg_match('/^(https?:)?\\/\\/[$~:;#,%&_=\\(\\)\\[\\]\\.\\? \\+\\-@\\/a-zA-Z0-9]+$/', $url);\n        }\n\n        return true;\n    }\n\n    public static function isMySQLEngine($engine)\n    {\n        return in_array($engine, ['InnoDB', 'MyISAM']);\n    }\n\n    public static function isUnixName($data)\n    {\n        return preg_match('/^[a-z0-9\\._-]+$/ui', $data);\n    }\n\n    public static function isTablePrefix($data)\n    {\n        // Even if \"-\" is theorically allowed, it will be considered a syntax error if you do not add backquotes (`) around the table name\n        return preg_match('/^[a-z0-9_]+$/ui', $data);\n    }\n\n    /**\n     * Check for standard name file validity.\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isFileName($name)\n    {\n        return preg_match('/^[a-zA-Z0-9_.-]+$/', $name);\n    }\n\n    /**\n     * Check for standard name directory validity.\n     *\n     * @param string $dir Directory to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isDirName($dir)\n    {\n        return (bool) preg_match('/^[a-zA-Z0-9_.-]*$/', $dir);\n    }\n\n    /**\n     * Check for admin panel tab name validity.\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTabName($name)\n    {\n        return preg_match('/^[^<>]+$/u', $name);\n    }\n\n    public static function isWeightUnit($unit)\n    {\n        return Validate::isGenericName($unit) & (Tools::strlen($unit) < 5);\n    }\n\n    public static function isDistanceUnit($unit)\n    {\n        return Validate::isGenericName($unit) & (Tools::strlen($unit) < 5);\n    }\n\n    public static function isSubDomainName($domain)\n    {\n        return preg_match('/^[a-zA-Z0-9-_]*$/', $domain);\n    }\n\n    public static function isVoucherDescription($text)\n    {\n        return preg_match('/^([^<>{}]|<br \\/>)*$/i', $text);\n    }\n\n    /**\n     * Check if the value is a sort direction value (DESC/ASC).\n     *\n     * @param string $value\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isSortDirection($value)\n    {\n        return $value === 'ASC' || $value === 'DESC';\n    }\n\n    /**\n     * Customization fields' label validity.\n     *\n     * @param string $label\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLabel($label)\n    {\n        return preg_match('/^[^{}<>]*$/u', $label);\n    }\n\n    /**\n     * Price display method validity.\n     *\n     * @param int $data Data to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPriceDisplayMethod($data)\n    {\n        return $data == PS_TAX_EXC || $data == PS_TAX_INC;\n    }\n\n    /**\n     * @param string $dni to validate\n     *\n     * @return bool\n     */\n    public static function isDniLite($dni)\n    {\n        return empty($dni) || (bool) preg_match('/^[0-9A-Za-z-.]{1,16}$/U', $dni);\n    }\n\n    /**\n     * Check if $data is a PrestaShop cookie object.\n     *\n     * @param mixed $data to validate\n     *\n     * @return bool\n     */\n    public static function isCookie($data)\n    {\n        return is_object($data) && get_class($data) == 'Cookie';\n    }\n\n    /**\n     * Check if $data is a string.\n     *\n     * @param string $data Data to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isString($data)\n    {\n        return is_string($data);\n    }\n\n    /**\n     * Check if the data is a reduction type (amout or percentage).\n     *\n     * @param string $data Data to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isReductionType($data)\n    {\n        return $data === 'amount' || $data === 'percentage';\n    }\n\n    /**\n     * Check for bool_id.\n     *\n     * @param string $ids\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isBoolId($ids)\n    {\n        return (bool) preg_match('#^[01]_[0-9]+$#', $ids);\n    }\n\n    /**\n     * Check the localization pack part selected.\n     *\n     * @param string $data Localization pack to check\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLocalizationPackSelection($data)\n    {\n        return in_array((string) $data, ['states', 'taxes', 'currencies', 'languages', 'units', 'groups']);\n    }\n\n    /**\n     * Check for PHP serialized data.\n     *\n     * @param string|null $data Serialized data to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isSerializedArray($data)\n    {\n        return $data === null || (is_string($data) && preg_match('/^a:[0-9]+:{.*;}$/s', $data));\n    }\n\n    /**\n     * Check if $string is a valid JSON string.\n     *\n     * @param string $string JSON string to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isJson($string)\n    {\n        json_decode($string);\n\n        return json_last_error() == JSON_ERROR_NONE;\n    }\n\n    /**\n     * Check for Latitude/Longitude.\n     *\n     * @param string|null $data Coordinate to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCoordinate($data)\n    {\n        return $data === null || preg_match('/^\\-?[0-9]{1,8}\\.[0-9]{1,8}$/s', $data);\n    }\n\n    /**\n     * Check for Language Iso Code.\n     *\n     * @param string $iso_code\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLangIsoCode($iso_code)\n    {\n        return (bool) preg_match('/^[a-zA-Z]{2,3}$/s', $iso_code);\n    }\n\n    /**\n     * Check for Language File Name.\n     *\n     * @param string $file_name\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLanguageFileName($file_name)\n    {\n        return (bool) preg_match('/^[a-zA-Z]{2,3}\\.(?:gzip|tar\\.gz)$/s', $file_name);\n    }\n\n    /**\n     * @param array $ids\n     *\n     * @return bool return true if the array contain only unsigned int value and not empty\n     */\n    public static function isArrayWithIds($ids)\n    {\n        if (!is_array($ids) || count($ids) < 1) {\n            return false;\n        }\n\n        foreach ($ids as $id) {\n            if ($id == 0 || !Validate::isUnsignedInt($id)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * @param array $stock_management\n     *\n     * @return bool return true if is a valide stock management\n     */\n    public static function isStockManagement($stock_management)\n    {\n        if (!in_array($stock_management, ['WA', 'FIFO', 'LIFO'])) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Validate SIRET Code.\n     *\n     * @param string $siret SIRET Code\n     *\n     * @return bool Return true if is valid\n     */\n    public static function isSiret($siret)\n    {\n        if (Tools::strlen($siret) != 14) {\n            return false;\n        }\n        $sum = 0;\n        for ($i = 0; $i != 14; ++$i) {\n            $tmp = ((($i + 1) % 2) + 1) * (int) ($siret[$i]);\n            if ($tmp >= 10) {\n                $tmp -= 9;\n            }\n            $sum += $tmp;\n        }\n\n        return $sum % 10 === 0;\n    }\n\n    /**\n     * Validate APE Code.\n     *\n     * @param string $ape APE Code\n     *\n     * @return bool Return true if is valid\n     */\n    public static function isApe($ape)\n    {\n        return (bool) preg_match(ApeCode::PATTERN, $ape);\n    }\n\n    public static function isControllerName($name)\n    {\n        return (bool) (is_string($name) && preg_match('/^[0-9a-zA-Z-_]*$/u', $name));\n    }\n\n    public static function isPrestaShopVersion($version)\n    {\n        return preg_match('/^[0-1]\\.[0-9]{1,2}(\\.[0-9]{1,2}){0,2}$/', $version) && ip2long($version);\n    }\n\n    public static function isOrderInvoiceNumber($id)\n    {\n        return preg_match('/^(?:' . Configuration::get('PS_INVOICE_PREFIX', Context::getContext()->language->id) . ')\\s*([0-9]+)$/i', $id);\n    }\n\n    public static function isThemeName($theme_name)\n    {\n        return (bool) preg_match('/^[\\w-]{3,255}$/u', $theme_name);\n    }\n\n    /**\n     * Check if enable_insecure_rsh exists in\n     * this PHP version otherwise disable the\n     * oProxyCommand option.\n     *\n     * @return bool\n     */\n    public static function isValidImapUrl($imapUrl)\n    {\n        if (false === ini_get('imap.enable_insecure_rsh')) {\n            return preg_match('~^((?!oProxyCommand).)*$~i', $imapUrl);\n        }\n\n        return true;\n    }\n\n    /**\n     * Check the given string is a valid PHP class name\n     *\n     * @param string $objectClassName object class name\n     *\n     * @return bool\n     */\n    public static function isValidObjectClassName(string $objectClassName): bool\n    {\n        return preg_match(static::OBJECT_CLASS_NAME_REGEXP, $objectClassName);\n    }\n}\n", "/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\nvar ajax_running_timeout = null;\n\nif (!id_language)\n  var id_language = Number(1);\n\nfunction str2url(str, encoding, ucfirst)\n{\n  str = str.toUpperCase();\n  str = str.toLowerCase();\n  if (PS_ALLOW_ACCENTED_CHARS_URL)\n    str = str.replace(/[^a-z0-9\\s\\'\\:\\/\\[\\]-]\\\\u00A1-\\\\uFFFF/g,'');\n  else\n  {\n\n    /* Lowercase */\n    str = str.replace(/[\\u00E0\\u00E1\\u00E2\\u00E3\\u00E5\\u0101\\u0103\\u0105\\u0430\\u1EA7\\u1EA3\\u1EA1\\u1EAF\\u1EB1\\u1EB3\\u1EB5\\u1EB7\\u1EA5\\u1EA9\\u1EAB\\u1EAD]/g, 'a');\n    str = str.replace(/[\\u0431]/g, 'b');\n    str = str.replace(/[\\u00E7\\u0107\\u0109\\u010D\\u0446]/g, 'c');\n    str = str.replace(/[\\u010F\\u0111\\u0434]/g, 'd');\n    str = str.replace(/[\\u00E8\\u00E9\\u00EA\\u00EB\\u0113\\u0115\\u0117\\u0119\\u011B\\u0435\\u044D\\u1EC7\\u1EBB\\u1EBD\\u1EB9\\u1EBF\\u1EC1\\u1EC3\\u1EC5]/g, 'e');\n    str = str.replace(/[\\u0444]/g, 'f');\n    str = str.replace(/[\\u011F\\u0121\\u0123\\u0433\\u0491]/g, 'g');\n    str = str.replace(/[\\u0125\\u0127]/g, 'h');\n    str = str.replace(/[\\u00EC\\u00ED\\u00EE\\u00EF\\u0129\\u012B\\u012D\\u012F\\u0131\\u0438\\u0456\\u1EC9\\u1ECB]/g, 'i');\n    str = str.replace(/[\\u0135\\u0439]/g, 'j');\n    str = str.replace(/[\\u0137\\u0138\\u043A]/g, 'k');\n    str = str.replace(/[\\u013A\\u013C\\u013E\\u0140\\u0142\\u043B]/g, 'l');\n    str = str.replace(/[\\u043C]/g, 'm');\n    str = str.replace(/[\\u00F1\\u0144\\u0146\\u0148\\u0149\\u014B\\u043D]/g, 'n');\n    str = str.replace(/[\\u00F2\\u00F3\\u00F4\\u00F5\\u00F8\\u014D\\u014F\\u0151\\u043E\\u01A1]/g, 'o');\n    str = str.replace(/[\\u043F]/g, 'p');\n    str = str.replace(/[\\u0155\\u0157\\u0159\\u0440]/g, 'r');\n    str = str.replace(/[\\u015B\\u015D\\u015F\\u0161\\u0441]/g, 's');\n    str = str.replace(/[\\u00DF]/g, 'ss');\n    str = str.replace(/[\\u0163\\u0165\\u0167\\u0442]/g, 't');\n    str = str.replace(/[\\u00F9\\u00FA\\u00FB\\u0169\\u016B\\u016D\\u016F\\u0171\\u0173\\u0443\\u1EED]/g, 'u');\n    str = str.replace(/[\\u0432]/g, 'v');\n    str = str.replace(/[\\u0175]/g, 'w');\n    str = str.replace(/[\\u00FF\\u0177\\u00FD\\u044B]/g, 'y');\n    str = str.replace(/[\\u017A\\u017C\\u017E\\u0437]/g, 'z');\n    str = str.replace(/[\\u00E4\\u00E6]/g, 'ae');\n    str = str.replace(/[\\u0447]/g, 'ch');\n    str = str.replace(/[\\u0445]/g, 'kh');\n    str = str.replace(/[\\u0153\\u00F6]/g, 'oe');\n    str = str.replace(/[\\u00FC]/g, 'ue');\n    str = str.replace(/[\\u0448]/g, 'sh');\n    str = str.replace(/[\\u0449]/g, 'ssh');\n    str = str.replace(/[\\u044F]/g, 'ya');\n    str = str.replace(/[\\u0454]/g, 'ye');\n    str = str.replace(/[\\u0457]/g, 'yi');\n    str = str.replace(/[\\u0451]/g, 'yo');\n    str = str.replace(/[\\u044E]/g, 'yu');\n    str = str.replace(/[\\u0436]/g, 'zh');\n\n    /* Uppercase */\n    str = str.replace(/[\\u0100\\u0102\\u0104\\u00C0\\u00C1\\u00C2\\u00C3\\u00C4\\u00C5\\u0410\\u1EA2\\u1EA0\\u1EAE\\u1EB0\\u1EB2\\u1EB4\\u1EB6\\u1EA4\\u1EA6\\u1EA8\\u1EAA\\u1EAC]/g, 'A');\n    str = str.replace(/[\\u0411]/g, 'B');\n    str = str.replace(/[\\u00C7\\u0106\\u0108\\u010A\\u010C\\u0426]/g, 'C');\n    str = str.replace(/[\\u010E\\u0110\\u0414]/g, 'D');\n    str = str.replace(/[\\u00C8\\u00C9\\u00CA\\u00CB\\u0112\\u0114\\u0116\\u0118\\u011A\\u0415\\u042D\\u1EBA\\u1EBC\\u1EB8\\u1EBE\\u1EC0\\u1EC2\\u1EC4\\u1EC6]/g, 'E');\n    str = str.replace(/[\\u0424]/g, 'F');\n    str = str.replace(/[\\u011C\\u011E\\u0120\\u0122\\u0413\\u0490]/g, 'G');\n    str = str.replace(/[\\u0124\\u0126]/g, 'H');\n    str = str.replace(/[\\u0128\\u012A\\u012C\\u012E\\u0130\\u0418\\u0406\\u00CD\\u00CC\\u1EC8\\u1ECA]/g, 'I');\n    str = str.replace(/[\\u0134\\u0419]/g, 'J');\n    str = str.replace(/[\\u0136\\u041A]/g, 'K');\n    str = str.replace(/[\\u0139\\u013B\\u013D\\u0141\\u041B]/g, 'L');\n    str = str.replace(/[\\u041C]/g, 'M');\n    str = str.replace(/[\\u00D1\\u0143\\u0145\\u0147\\u014A\\u041D]/g, 'N');\n    str = str.replace(/[\\u00D3\\u014C\\u014E\\u0150\\u041E]/g, 'O');\n    str = str.replace(/[\\u041F]/g, 'P');\n    str = str.replace(/[\\u0154\\u0156\\u0158\\u0420]/g, 'R');\n    str = str.replace(/[\\u015A\\u015C\\u015E\\u0160\\u0421]/g, 'S');\n    str = str.replace(/[\\u0162\\u0164\\u0166\\u0422]/g, 'T');\n    str = str.replace(/[\\u00D9\\u00DA\\u00DB\\u0168\\u016A\\u016C\\u016E\\u0170\\u0172\\u0423]/g, 'U');\n    str = str.replace(/[\\u0412]/g, 'V');\n    str = str.replace(/[\\u0174]/g, 'W');\n    str = str.replace(/[\\u0176\\u042B]/g, 'Y');\n    str = str.replace(/[\\u0179\\u017B\\u017D\\u0417]/g, 'Z');\n    str = str.replace(/[\\u00C4\\u00C6]/g, 'AE');\n    str = str.replace(/[\\u0427]/g, 'CH');\n    str = str.replace(/[\\u0425]/g, 'KH');\n    str = str.replace(/[\\u0152\\u00D6]/g, 'OE');\n    str = str.replace(/[\\u00DC]/g, 'UE');\n    str = str.replace(/[\\u0428]/g, 'SH');\n    str = str.replace(/[\\u0429]/g, 'SHH');\n    str = str.replace(/[\\u042F]/g, 'YA');\n    str = str.replace(/[\\u0404]/g, 'YE');\n    str = str.replace(/[\\u0407]/g, 'YI');\n    str = str.replace(/[\\u0401]/g, 'YO');\n    str = str.replace(/[\\u042E]/g, 'YU');\n    str = str.replace(/[\\u0416]/g, 'ZH');\n\n    str = str.toLowerCase();\n\n    str = str.replace(/[^a-z0-9\\s\\'\\:\\/\\[\\]-]/g,'');\n  }\n  str = str.replace(/[\\u0028\\u0029\\u0021\\u003F\\u002E\\u0026\\u005E\\u007E\\u002B\\u002A\\u002F\\u003A\\u003B\\u003C\\u003D\\u003E]/g, '');\n  str = str.replace(/[\\s\\'\\:\\/\\[\\]-]+/g, ' ');\n\n  // Add special char not used for url rewrite\n  str = str.replace(/[ ]/g, '-');\n  str = str.replace(/[\\/\\\\\"'|,;%]*/g, '');\n\n  if (ucfirst == 1) {\n    var first_char = str.charAt(0);\n    str = first_char.toUpperCase()+str.slice(1);\n  }\n\n  return str;\n}\n\nfunction copy2friendlyURL()\n{\n  if (typeof($('#link_rewrite_' + id_language).val()) == 'undefined')\n    return;\n  if (typeof(id_product) == 'undefined')\n    id_product = false;\n\n  if (ps_force_friendly_product || !$('#link_rewrite_' + id_language).val().length || !id_product)//check if user didn't type anything in rewrite field, to prevent overwriting\n  {\n    $('#link_rewrite_' + id_language).val(str2url($.trim($('#name_' + id_language).val().replace(/^[0-9]+\\./, ''), 'UTF-8').replace('%', '')));\n    if ($('#friendly-url'))\n      $('#friendly-url').html($('#link_rewrite_' + id_language).val());\n    // trigger onchange event to use anything binded there\n    $('#link_rewrite_' + id_language).change();\n  }\n  return;\n}\n\nfunction copyMeta2friendlyURL()\n{\n  if (!$('input[name=\"id_cms\"]').length)\n    $('#link_rewrite_' + id_language).val(str2url($('#name_' + id_language).val().replace(/^[0-9]+\\./, ''), 'UTF-8'));\n}\n\nfunction updateCurrentText()\n{\n  $('#current_product').html($('#name_' + id_language).val());\n}\n\nfunction updateFriendlyURLByName()\n{\n  $('#link_rewrite_' + id_language).val(str2url($('#name_' + id_language).val(), 'UTF-8'));\n  $('#friendly-url_' + id_language).html($('#link_rewrite_' + id_language).val());\n}\n\nfunction updateFriendlyURL()\n{\n  var link = $('#link_rewrite_' + id_language);\n  if (link[0])\n  {\n    $('#friendly-url_' + id_language).text(str2url($('#link_rewrite_' + id_language).val(), 'UTF-8'));\n  }\n}\n\nfunction updateLinkRewrite()\n{\n  $('#name_' + id_language).val($.trim($('#name_' + id_language).val()));\n  $('#link_rewrite_' + id_language).val($.trim($('#link_rewrite_' + id_language).val()));\n  var link = $('#link_rewrite_' + id_language);\n  if (link[0])\n  {\n    link.val(str2url(link.val(), 'UTF-8'));\n    $('#friendly-url_' + id_language).text(link.val());\n  }\n}\n\nfunction toggleLanguageFlags(elt)\n{\n  $(elt).parents('.displayed_flag').siblings('.language_flags').toggle();\n}\n\n// Kept for retrocompatibility only (out of AdminProducts & AdminCategories)\nfunction changeLanguage(field, fieldsString, id_language_new, iso_code)\n{\n    $('div[id^='+field+'_]').hide();\n  var fields = fieldsString.split('\u00a4');\n  for (var i = 0; i < fields.length; ++i)\n  {\n    $('div[id^='+fields[i]+'_]').hide();\n    $('#'+fields[i]+'_'+id_language_new).show();\n    $('#'+'language_current_'+fields[i]).attr('src', '../img/l/' + id_language_new + '.jpg');\n  }\n  $('#languages_' + field).hide();\n  id_language = id_language_new;\n}\n\n// kept for retrocompatibility - you should use hideOtherLanguage(id) since 1.6\nfunction changeFormLanguage(id_language_new, iso_code, employee_cookie)\n{\n  $('.translatable').each(function() {\n    $(this).find('.lang_' + id_language_new)\n      .show()\n      .siblings('div:not(.displayed_flag):not(.clear)').hide();\n    $(this).find('.language_current').attr('src', '../img/l/' + id_language_new + '.jpg');\n  });\n\n  // For multishop checkboxes\n  $('.multishop_lang_'+id_language_new).show().siblings('div[class^=\\'multishop_lang_\\']').hide();\n  id_language = id_language_new;\n  changeEmployeeLanguage();\n  updateCurrentText();\n}\n\nfunction displayFlags(languages, defaultLanguageID, employee_cookie)\n{\n  if ($('.translatable'))\n  {\n    $('.translatable').each(function() {\n      if (!$(this).find('.displayed_flag').length > 0) {\n        $.each(languages, function(key, language) {\n          if (language['id_lang'] == defaultLanguageID)\n          {\n            defaultLanguage = language;\n            return false;\n          }\n        });\n        var displayFlags = $('<div></div>')\n          .addClass('displayed_flag')\n          .append($('<img>')\n            .addClass('language_current')\n            .addClass('pointer')\n            .attr('src', '../img/l/' + defaultLanguage['id_lang'] + '.jpg')\n            .attr('alt', defaultLanguage['name'])\n            .click(function() {\n              toggleLanguageFlags(this);\n            })\n          );\n        var languagesFlags = $('<div></div>')\n          .addClass('language_flags')\n          .html(choose_language_translate+':<br /><br />');\n        $.each(languages, function(key, language) {\n          var img = $('<img>')\n            .addClass('pointer')\n            .css('margin', '2px 2px')\n            .attr('src', '../img/l/' + language['id_lang'] + '.jpg')\n            .attr('alt', language['name'])\n            .click(function() {\n              changeFormLanguage(language['id_lang'], language['iso_code'], employee_cookie);\n            });\n          languagesFlags.append(img);\n        });\n        if ($(this).find('p:last-child').hasClass('clear'))\n          $(this).find('p:last-child').before(displayFlags).before(languagesFlags);\n        else\n          $(this).append(displayFlags).append(languagesFlags);\n      }\n    });\n  }\n}\n\nfunction checkAll(pForm)\n{\n  for (i = 0, n = pForm.elements.length; i < n; i++)\n  {\n    var objName = pForm.elements[i].name;\n    var objType = pForm.elements[i].type;\n    if (objType == 'checkbox' && objName != 'checkme')\n    {\n      box = eval(pForm.elements[i]);\n      box.checked = !box.checked;\n    }\n  }\n}\n\nfunction checkDelBoxes(pForm, boxName, parent)\n{\n  for (i = 0; i < pForm.elements.length; i++)\n    if (pForm.elements[i].name == boxName)\n      pForm.elements[i].checked = parent;\n}\n\nfunction checkPaymentBoxes(name, module)\n{\n  setPaymentBoxes(name, module);\n  current = $('input#checkedBox_'+ name +'_'+ module + '[type=hidden]');\n  $('form#form_'+ name +' input[type=checkbox]').each(\n    function()\n    {\n      if ($(this).attr('name') == module + '_' + name + '[]')\n        $(this).attr(\"checked\", ((current.val() == 'checked') ? true : false));\n    }\n  );\n  current.val() == 'checked' ? current.val('unchecked') : current.val('checked');\n}\n\nfunction setPaymentBoxes(name, module)\n{\n  current = $('input#checkedBox_'+ name +'_'+ module + '[type=hidden]');\n  total = 0;\n  checked = 0;\n  $('form#form_'+ name +' input[type=checkbox]').each(\n    function()\n    {\n      if ($(this).attr('name') == module + '_' + name + '[]')\n      {\n        ($(this).attr(\"checked\") ? checked++ : '');\n        total++;\n      }\n    }\n  );\n  (checked == total) ? current.val('unchecked') : current.val('checked');\n}\n\nfunction getE(name)\n{\n  if (document.getElementById)\n    var elem = document.getElementById(name);\n  else if (document.all)\n    var elem = document.all[name];\n  else if (document.layers)\n    var elem = document.layers[name];\n  return elem;\n}\n\nfunction formSubmit(e, button)\n{\n  var key;\n\n  key = window.event ? window.event.keyCode : e.which;\n  if (key == 13)\n  {\n    getE(button).focus();\n    getE(button).click();\n    e.preventDefault();\n  }\n}\nfunction noComma(elem)\n{\n  getE(elem).value = getE(elem).value.replace(new RegExp(',', 'g'), '.');\n}\n\n/* Code generator for Affiliation and vouchers */\nfunction gencode(size)\n{\n  getE('code').value = '';\n  /* There are no O/0 in the codes in order to avoid confusion */\n  var chars = \"123456789ABCDEFGHIJKLMNPQRSTUVWXYZ\";\n  var randomNumbers = crypto.getRandomValues(new Uint32Array(size));\n  for (var i = 1; i <= size; ++i) {\n    getE('code').value += chars.charAt(Math.floor(randomNumbers[i]/2**32 * chars.length));\n  }\n\n  getE('cart-rules-highlight').style.display = '';\n}\n\nvar tpl_viewing_window = null;\nfunction viewTemplates(id_select, lang, ext)\n{\n  var loc = $(id_select).val();\n  if (loc != 0)\n  {\n    if (tpl_viewing_window != null && !tpl_viewing_window.closed)\n      tpl_viewing_window.close();\n    var url_preview = $(\"option[value=\"+loc+\"]\", id_select).data('preview');\n    tpl_viewing_window = window.open(url_preview + lang + loc + ext, 'tpl_viewing', 'toolbar=0,location=0,directories=0,statfr=no,menubar=0,scrollbars=yes,resizable=yes,width=520,height=400,top=50,left=300');\n    tpl_viewing_window.focus();\n  }\n}\n\nfunction orderDeleteProduct(txtConfirm, txtExplain)\n{\n  ret = true;\n  $('table#cancelProducts input[type=checkbox]:checked').each(\n    function()\n    {\n      totalCancel = parseInt($(this).parent().parent().find('td.cancelQuantity input[type=text]').val());\n      totalQty = parseInt($(this).parent().find('input#totalQty[type=hidden]').val());\n      totalQtyReturn = parseInt($(this).parent().find('input#totalQtyReturn[type=hidden]').val());\n      productName = $(this).parent().find('input#productName[type=hidden]').val();\n      totalAvailable = totalQty - totalQtyReturn;\n      if (totalCancel > totalAvailable)\n      {\n        jAlert(txtConfirm + ' : \\'' + ' ' + productName + '\\' ! \\n\\n' + txtExplain + ' ('+ totalCancel + ' > ' + totalAvailable +')' + '\\n ');\n        ret = false;\n      }\n    }\n  );\n  return ret;\n}\n\nfunction selectCheckbox(obj)\n{\n  $(obj).parent().parent().find('td.cancelCheck input[type=checkbox]').attr(\"checked\", true);\n}\n\nfunction toggleShippingCost()\n{\n  generateDiscount = $('#generateDiscount').attr(\"checked\");\n  generateCreditSlip = $('#generateCreditSlip').attr(\"checked\");\n  if (generateDiscount != 'checked' && generateCreditSlip != 'checked')\n  {\n    $('#spanShippingBack input[type=checkbox]').attr(\"checked\", false);\n    $('#spanShippingBack').css('display', 'none');\n  }\n  else\n    $('#spanShippingBack').css('display', 'block');\n}\n\nfunction orderOverwriteMessage(sl, text)\n{\n  var $zone = $('#txt_msg');\n  var sl_value = sl.options[sl.selectedIndex].value;\n\n  if (sl_value != '0')\n  {\n    if ($zone.val().length > 0 && !confirm(text))\n      return ;\n    $zone.val(sl_value);\n  }\n\n  $zone.trigger('autosize.resize');\n}\n\nfunction setCancelQuantity(itself, id_order_detail, quantity)\n{\n  $('#cancelQuantity_' + id_order_detail).val($(itself).prop('checked') ? quantity : '');\n}\n\nfunction stockManagementActivationAuthorization()\n{\n  if (getE('PS_STOCK_MANAGEMENT_on').checked)\n  {\n    getE('PS_ORDER_OUT_OF_STOCK_on').disabled = false;\n    getE('PS_ORDER_OUT_OF_STOCK_off').disabled = false;\n    getE('PS_DISPLAY_QTIES_on').disabled = false;\n    getE('PS_DISPLAY_QTIES_off').disabled = false;\n  }\n  else\n  {\n    getE('PS_DISPLAY_QTIES_off').checked = true;\n    getE('PS_DISPLAY_QTIES_on').disabled = 'disabled';\n    getE('PS_DISPLAY_QTIES_off').disabled = 'disabled';\n    getE('PS_ORDER_OUT_OF_STOCK_on').checked = true;\n    getE('PS_ORDER_OUT_OF_STOCK_on').disabled = 'disabled';\n    getE('PS_ORDER_OUT_OF_STOCK_off').disabled = 'disabled';\n    getE('PS_DEFAULT_WAREHOUSE_NEW_PRODUCT').disabled = 'disabled';\n  }\n}\n\nfunction hookCheckboxes(id, opt, champ)\n{\n  if (opt == 1 && champ.checked == false)\n    $('#Ghook'+id).attr('checked', false);\n  else if (opt == 0)\n  {\n    if (champ.checked)\n      $('.hook'+id).attr('checked', \"checked\");\n    else\n      $('.hook'+id).attr('checked', false);\n  }\n}\n\nfunction changeCMSActivationAuthorization()\n{\n  if (getE('PS_CONDITIONS_on').checked)\n    getE('PS_CONDITIONS_CMS_ID').disabled = false;\n  else\n    getE('PS_CONDITIONS_CMS_ID').disabled = 'disabled';\n}\n\nfunction disableZipFormat()\n{\n  if ($('#need_zip_code_on').prop('checked') == false)\n  {\n    $('.zip_code_format').hide();\n    $('#zip_code_format').val('');\n  }\n  else\n    $('.zip_code_format').show();\n}\n\nfunction disableTAASC()\n{\n  if ($('#iso_code').val() == 'US')\n    $('#TAASC').show();\n  else\n    $('#TAASC').hide();\n}\n\nfunction spreadFees(id_range)\n{\n  newVal = $('#fees_all_'+id_range).val().replace(/,/g, '.');\n  $('.fees_'+id_range).val(newVal);\n}\n\nfunction clearAllFees(id_range)\n{\n  $('#fees_all_'+id_range).val('');\n}\n\nfunction toggleDraftWarning(show)\n{\n  if (show)\n    $('.draft').hide();\n  else\n    $('.draft').show();\n}\n\nfunction showRedirectProductOptions(show)\n{\n  if (show)\n    $('.redirect_product_options').fadeIn();\n  else\n    $('.redirect_product_options').fadeOut();\n\n  redirectSelectChange();\n}\n\nfunction redirectSelectChange()\n{\n  redirectTypeValue = $('#redirect_type :selected').val();\n  if (redirectTypeValue == '404' || \n      redirectTypeValue == '410' || \n      redirectTypeValue == 'default' || \n      redirectTypeValue == '200-displayed' || \n      redirectTypeValue == '404-displayed' || \n      redirectTypeValue == '410-displayed')\n    showRedirectProductSelectOptions(false);\n  else\n    showRedirectProductSelectOptions(true);\n}\n\nfunction addRelatedProduct(id_product_to_add, product_name)\n{\n  if (!id_product_to_add || id_product == id_product_to_add)\n    return;\n  $('#related_product_name').html(product_name);\n  $('input[name=id_type_redirected]').val(id_product_to_add);\n  $('#related_product_autocomplete_input').parent().hide();\n  $('#related_product_remove').show();\n}\n\nfunction removeRelatedProduct()\n{\n  $('#related_product_name').html(no_related_product);\n  $('input[name=id_type_redirected]').val(0);\n  $('#related_product_remove').hide();\n  $('#related_product_autocomplete_input').parent().fadeIn();\n}\n\nfunction showRedirectProductSelectOptions(show)\n{\n  if (show)\n    $('.redirect_product_options_product_choise').show();\n  else\n  {\n    $('.redirect_product_options_product_choise').hide();\n    removeRelatedProduct();\n  }\n\n}\n\nfunction showOptions(show)\n{\n  if (show)\n    $('tr#product_options').show();\n  else\n    $('tr#product_options').hide();\n}\n\nfunction submitAddProductAndPreview()\n{\n  $('#fakeSubmitAddProductAndPreview').attr('name','submitAddProductAndPreview');\n  $('#product_form').submit();\n}\n\nfunction submitAddcmsAndPreview()\n{\n  $('#previewSubmitAddcmsAndPreview').attr('name','submitAddcmsAndPreview');\n  $('#cms').submit();\n}\n\nfunction checkAllMultishopDefaultValue(item)\n{\n  $(item).parent().find('input[name^=\\'multishopOverrideOption\\']').each(function(k, v)\n  {\n    $(v).attr('checked', item.checked);\n    var name = $(v).attr('name');\n    checkMultishopDefaultValue(v, name.substr(24, name.length - 25));\n  })\n}\n\nfunction checkMultishopDefaultValue(obj, key)\n{\n  if (!$(obj).prop('checked') || $('#'+key).hasClass('isInvisible'))\n  {\n    $('#conf_id_'+key+' input, #conf_id_'+key+' textarea, #conf_id_'+key+' select, #conf_id_'+key+' button').prop('disabled', true);\n    $('#conf_id_'+key+' label.conf_title').addClass('isDisabled');\n    $(obj).prop('disabled', false);\n  }\n  else\n  {\n    $('#conf_id_'+key+' input, #conf_id_'+key+' textarea, #conf_id_'+key+' select, #conf_id_'+key+' button').prop('disabled', false);\n    $('#conf_id_'+key+' label.conf_title').removeClass('isDisabled');\n  }\n  $('#conf_id_'+key+' .preference_default_multishop input').prop('disabled', false);\n}\n\nfunction toggleAllMultishopDefaultValue($container, value)\n{\n  $container.find('input[name^=\\'multishopOverrideOption\\']').each(function(k, v)\n  {\n    $(v).attr('checked', value);\n    var name = $(v).attr('name');\n    toggleMultishopDefaultValue(v, name.substr(24, name.length - 25));\n  })\n}\n\nfunction toggleMultishopDefaultValue(obj, key)\n{\n  if (!$(obj).prop('checked') || $('#'+key).hasClass('isInvisible'))\n  {\n    $('#conf_id_'+key+' input, #conf_id_'+key+' textarea, #conf_id_'+key+' select, #conf_id_'+key+' button').attr('disabled', true);\n    $('#conf_id_'+key+' label.conf_title').addClass('isDisabled');\n  }\n  else\n  {\n    $('#conf_id_'+key+' input, #conf_id_'+key+' textarea, #conf_id_'+key+' select, #conf_id_'+key+' button').attr('disabled', false);\n    $('#conf_id_'+key+' label.conf_title').removeClass('isDisabled');\n  }\n  $('#conf_id_'+key+' input[name^=\\'multishopOverrideOption\\']').attr('disabled', false);\n}\n\nfunction doAdminAjax(data, success_func, error_func)\n{\n  $.ajax(\n  {\n    url : 'index.php',\n    data : data,\n    type : 'POST',\n    success : function(data){\n      if (success_func)\n        return success_func(data);\n\n      data = $.parseJSON(data);\n      if (data.confirmations.length != 0)\n        showSuccessMessage(data.confirmations);\n      else\n        showErrorMessage(data.error);\n    },\n    error : function(data){\n      if (error_func)\n        return error_func(data);\n\n      alert(\"[TECHNICAL ERROR]\");\n    }\n  });\n}\n\n//display a success/error/notice message\nfunction showSuccessMessage(msg) {\n  $.growl.notice({ title: \"\", message:msg});\n}\n\nfunction showErrorMessage(msg) {\n  $.growl.error({ title: \"\", message:msg});\n}\n\nfunction showNoticeMessage(msg) {\n  $.growl.notice({ title: \"\", message:msg});\n}\n\n$(document).ready(function()\n{\n  if (typeof helper_tabs != 'undefined' && typeof unique_field_id != 'undefined')\n  {\n    $.each(helper_tabs, function(index) {\n      $('#'+unique_field_id+'fieldset_'+index+' .form-wrapper').prepend('<div class=\"tab-content panel\" />');\n      $('#'+unique_field_id+'fieldset_'+index+' .form-wrapper').prepend('<ul class=\"nav nav-tabs\" />');\n      $.each(helper_tabs[index], function(key, value) {\n        // Move every form-group into the correct .tab-content > .tab-pane\n        $('#'+unique_field_id+'fieldset_'+index+' .tab-content').append('<div id=\"'+key+'\" class=\"tab-pane\" />');\n        var elemts = $('#'+unique_field_id+'fieldset_'+index).find(\"[data-tab-id='\" + key + \"']\");\n        $(elemts).appendTo('#'+key);\n        // Add the item to the .nav-tabs\n        if (elemts.length != 0)\n          $('#'+unique_field_id+'fieldset_'+index+' .nav-tabs').append('<li><a href=\"#'+key+'\" data-toggle=\"tab\">'+value+'</a></li>');\n      });\n      // Activate the first tab\n      $('#'+unique_field_id+'fieldset_'+index+' .tab-content div').first().addClass('active');\n      $('#'+unique_field_id+'fieldset_'+index+' .nav-tabs li').first().addClass('active');\n    });\n  }\n\n  if (typeof formToMove != 'undefined' && typeof formDestination != 'undefined' )\n  {\n    $('<hr style=\"margin 24px 0;\" />').appendTo('#'+formDestination)\n    $('#configuration_fieldset_'+formToMove+' .form-wrapper').appendTo('#'+formDestination);\n  }\n\n  $('select.chosen').each(function(k, item){\n    $(item).chosen({disable_search_threshold: 10, search_contains: true, width: '100%', });\n  });\n  // Apply chosen() when modal is loaded\n  $(document).on('shown.bs.modal', function (e) {\n    $('select.chosen-modal').chosen();\n  })\n\n  $('.isInvisible input, .isInvisible select, .isInvisible textarea').attr('disabled', true);\n  $('.isInvisible label.conf_title').addClass('isDisabled');\n\n  // Disable options fields for each row with a multishop default checkbox\n  $('.preference_default_multishop input[type=checkbox]').each(function(k, v)\n  {\n    var key = $(v).attr('name');\n    var len = key.length;\n    checkMultishopDefaultValue(v, key.substr(24, len - 25));\n  });\n\n  $('input[name^=\\'multishopOverrideOption\\']').each(function(k, v)\n  {\n    var key = $(v).attr('name');\n    var len = key.length;\n    toggleMultishopDefaultValue(v, key.substr(24, len - 25));\n  });\n\n  $(document).on('keyup change', '.copy2friendlyUrl', function(e){\n    if (!isArrowKey(e))\n      return copy2friendlyURL();\n  });\n\n  // on live will make this binded for dynamic content\n  $(document).on('keyup change', '.updateCurrentText', function(e){\n    if (typeof e == KeyboardEvent)\n      if(isArrowKey(e))\n        return;\n\n    updateCurrentText();\n  });\n\n  $(document).on('keyup change', '.copyMeta2friendlyURL', function(e){\n    if (!isArrowKey(e))\n      return copyMeta2friendlyURL()\n  });\n\n  $(document)\n    .ajaxStart(function() {\n      ajax_running_timeout = setTimeout(function() {\n        showAjaxOverlay()\n      }, 1000);\n    })\n    .ajaxStop(function() {\n      setTimeout(function() {\n        $('#ajax_running').hide()\n      }, 1000);\n      clearTimeout(ajax_running_timeout);\n    })\n    .ajaxError(function() {\n      setTimeout(function() {\n        $('#ajax_running').hide()\n      }, 1000);\n      clearTimeout(ajax_running_timeout);\n    });\n\n  bindTabModuleListAction();\n\n  //Check filters value on submit filter\n  $(\"[name='submitFilter']\").click(function(event) {\n    var list_id = $(this).data('list-id');\n    var empty_filters = true;\n\n    $(document.body).find(\"input[name*='\"+list_id+\"Filter']\").each(function() {\n      if ($(this).val() != '')\n      {\n        empty_filters = false;\n        return false;\n      }\n    });\n\n    $(document.body).find(\"select[name*='\"+list_id+\"Filter']\").each(function() {\n      empty_filters = false;\n      return false;\n    });\n\n    if (empty_filters)\n    {\n      event.preventDefault();\n      $('#'+list_id+'-empty-filters-alert').show();\n    }\n  });\n\n  var message = $('.toolbarHead');\n  var view = $(window);\n\n  // bind only if message exists. placeholder will be its parent\n  view.bind(\"scroll resize\", function(e)\n  {\n    message.each(function(el){\n      if (message.length)\n      {\n        placeholder = $(this).parent();\n        if (e.type == 'resize')\n          $(this).css('width', $(this).parent().width());\n\n        placeholderTop = placeholder.offset().top;\n        var viewTop = view.scrollTop() + 15;\n        // here we force the toolbar to be \"not fixed\" when\n        // the height of the window is really small (toolbar hiding the page is not cool)\n        window_is_more_than_twice_the_toolbar  = view.height() > message.parent().height() * 2;\n        if (!$(this).hasClass(\"fix-toolbar\") && (window_is_more_than_twice_the_toolbar && (viewTop > placeholderTop)))\n        {\n          $(this).css('width', $(this).width());\n          // fixing parent height will prevent that annoying \"pagequake\" thing\n          // the order is important : this has to be set before adding class fix-toolbar\n          $(this).parent().css('height', $(this).parent().height());\n          $(this).addClass(\"fix-toolbar\");\n        }\n        else if ($(this).hasClass(\"fix-toolbar\") && (!window_is_more_than_twice_the_toolbar || (viewTop <= placeholderTop)) )\n        {\n          $(this).removeClass(\"fix-toolbar\");\n          $(this).removeAttr('style');\n          $(this).parent().removeAttr('style');\n        }\n      }\n    });\n  }); // end bind\n\n  // if count errors\n  $('#hideError').on('click', function(e)\n  {\n    e.preventDefault();\n    $('.error').hide('slow', function (){\n      $('.error').remove();\n    });\n    return false;\n  });\n\n  // if count warnings\n  $(document).on('click', '#linkSeeMore', function(e){\n    e.preventDefault();\n    $('#seeMore').show();\n    $(this).hide();\n    $('#linkHide').show();\n    return false;\n  });\n  $(document).on('click', '#linkHide', function(e){\n    e.preventDefault();\n    $('#seeMore').hide();\n    $(this).hide();\n    $('#linkSeeMore').show();\n    return false;\n  });\n  $(document).on('click', '#hideWarn', function(e){\n    e.preventDefault();\n    $('.warn').hide('slow', function (){\n      $('.warn').remove();\n    });\n    return false;\n  });\n\n  $('.swap-container').each(function() {\n    var swap_container = this;\n    /** make sure that all the swap id is present in the dom to prevent mistake **/\n    if (typeof $('.addSwap', this) !== undefined && typeof $(\".removeSwap\", this) !== undefined &&\n      typeof $('.selectedSwap', this) !== undefined && typeof $('.availableSwap', this) !== undefined)\n    {\n      bindSwapButton('add', 'available', 'selected', this);\n      bindSwapButton('remove', 'selected', 'available', this);\n\n      $('button:submit').click(function() {\n        bindSwapSave(swap_container);\n      });\n    }\n  });\n\n    if ($('.kpi-container').length) {\n        refresh_kpis();\n    }\n\n    $('.kpi-refresh').on('click', '.refresh-kpis', function () {\n        refresh_kpis(true);\n    });\n});\n\nfunction bindSwapSave(context)\n{\n  if ($('.selectedSwap option', context).length !== 0)\n    $('.selectedSwap option', context).attr('selected', 'selected');\n  else\n    $('.availableSwap option', context).attr('selected', 'selected');\n}\n\nfunction bindSwapButton(prefix_button, prefix_select_remove, prefix_select_add, context)\n{\n  $('.'+prefix_button+'Swap', context).on('click', function(e) {\n    e.preventDefault();\n    $('.' + prefix_select_remove + 'Swap option:selected', context).each(function() {\n      $('.' + prefix_select_add + 'Swap', context).append(\"<option value='\"+$(this).val()+\"'>\"+$(this).text()+\"</option>\");\n      $(this).remove();\n    });\n    $('.selectedSwap option', context).prop('selected', true);\n  });\n}\n\nfunction bindTabModuleListAction()\n{\n  $('.action_tab_module').each( function (){\n    $(this).click(function () {\n      option = $('#'+$(this).data('option')+' :selected');\n      if ($(option).data('onclick') != '')\n      {\n        var f = eval(\"(function(){ \"+$(option).data('onclick')+\"})\");\n        if (f.call())\n          window.location.href = $(option).data('href');\n      }\n      else\n        window.location.href = $(option).data('href');\n      return false;\n    });\n  });\n}\n\n// Delete all tags HTML\nfunction stripHTML(oldString)\n{\n  var newString = '';\n  var inTag = false;\n  for(var i = 0; i < oldString.length; i++) {\n    if(oldString.charAt(i) == '<') inTag = true;\n    if(oldString.charAt(i) == '>') {\n      if(oldString.charAt(i+1)!='<')\n      {\n        inTag = false;\n        i++;\n      }\n    }\n    if(!inTag) newString += oldString.charAt(i);\n  }\n  return newString;\n}\n\n/**\n * Display a loading bar while an ajax call is ongoing.\n *\n * To prevent the loading bar display for a specific ajax call, set the beforeSend event in your ajax declaration:\n *    beforeSend : function(data)\n    {\n      // don't display the loading notification bar\n      clearTimeout(ajax_running_timeout);\n    }\n */\nfunction showAjaxOverlay()\n{\n  $('#ajax_running').show('fast');\n  clearTimeout(ajax_running_timeout);\n}\n\nfunction display_action_details(row_id, controller, token, action, params)\n{\n  var id = action+'_'+row_id;\n  var current_element = $('#details_'+id);\n  if (!current_element.data('dataMaped')) {\n    var ajax_params = {\n      'id': row_id,\n      'controller': controller,\n      'token': token,\n      'action': action,\n      'ajax': true\n    };\n\n    $.each(params, function(k, v) {\n      ajax_params[k] = v;\n    });\n\n    $.ajax({\n      url: 'index.php',\n      data: ajax_params,\n      dataType: 'json',\n      cache: false,\n      context: current_element,\n      async: false,\n      success: function(data) {\n        if (typeof(data.use_parent_structure) == 'undefined' || (data.use_parent_structure == true))\n        {\n          if (current_element.parent().parent().hasClass('alt_row'))\n            var alt_row = true;\n          else\n            var alt_row = false;\n          current_element.parent().parent().after($('<tr class=\"details_'+id+' small '+(alt_row ? 'alt_row' : '')+'\"></tr>')\n            .append($('<td style=\"border:none!important;\" class=\"empty\"></td>')\n            .attr('colspan', current_element.parent().parent().find('td').length)));\n          $.each(data.data, function(it, row)\n          {\n            var bg_color = ''; // Color\n            if (row.color)\n              bg_color = 'style=\"background:' + row.color +';\"';\n\n            var content = $('<tr class=\"action_details details_'+id+' '+(alt_row ? 'alt_row' : '')+'\"></tr>');\n            content.append($('<td class=\"empty\"></td>'));\n            var first = true;\n            var count = 0; // Number of non-empty collum\n            $.each(row, function(it)\n            {\n              if(typeof(data.fields_display[it]) != 'undefined')\n                count++;\n            });\n            $.each(data.fields_display, function(it, line)\n            {\n              if (typeof(row[it]) == 'undefined')\n              {\n                if (first || count == 0)\n                  content.append($('<td class=\"'+current_element.align+' empty\"' + bg_color + '></td>'));\n                else\n                  content.append($('<td class=\"'+current_element.align+'\"' + bg_color + '></td>'));\n              }\n              else\n              {\n                count--;\n                if (first)\n                {\n                  first = false;\n                  content.append($('<td class=\"'+current_element.align+' first\"' + bg_color + '>'+row[it]+'</td>'));\n                }\n                else if (count == 0)\n                  content.append($('<td class=\"'+current_element.align+' last\"' + bg_color + '>'+row[it]+'</td>'));\n                else\n                  content.append($('<td class=\"'+current_element.align+' '+count+'\"' + bg_color + '>'+row[it]+'</td>'));\n              }\n            });\n            content.append($('<td class=\"empty\"></td>'));\n            current_element.parent().parent().after(content.show('slow'));\n          });\n        }\n        else\n        {\n          if (current_element.parent().parent().hasClass('alt_row'))\n            var content = $('<tr class=\"details_'+id+' alt_row\"></tr>');\n          else\n            var content = $('<tr class=\"details_'+id+'\"></tr>');\n          content.append($('<td style=\"border:none!important;\">'+data.data+'</td>').attr('colspan', current_element.parent().parent().find('td').length));\n          current_element.parent().parent().after(content);\n          current_element.parent().parent().parent().find('.details_'+id).hide();\n        }\n        current_element.data('dataMaped', true);\n        current_element.data('opened', false);\n\n        if (typeof(initTableDnD) != 'undefined')\n          initTableDnD('.details_'+id+' table.tableDnD');\n      }\n    });\n  }\n\n  if (current_element.data('opened'))\n  {\n    current_element.find('i.icon-collapse-top').attr('class', 'icon-collapse');\n    current_element.parent().parent().parent().find('.details_'+id).hide('fast');\n    current_element.data('opened', false);\n  }\n  else\n  {\n    current_element.find('i.icon-collapse').attr('class', 'icon-collapse-top');\n    current_element.parent().parent().parent().find('.details_'+id).show('fast');\n    current_element.data('opened', true);\n  }\n}\n\nfunction quickSelect(elt)\n{\n  var eltVal = $(elt).val();\n  if (eltVal == \"0\")\n    return false;\n  else if (eltVal.substr(eltVal.length - 6) == '_blank')\n    window.open(eltVal.substr(0, eltVal.length - 6), '_blank');\n  else\n    location.href = eltVal;\n}\n\nfunction changeEmployeeLanguage()\n{\n  if (typeof allowEmployeeFormLang !== 'undefined' && allowEmployeeFormLang)\n    for (var key in languages) {\n      if (id_language === languages[key]['id_lang']) {\n        $.post(changeFormLanguageUrl, {\n          language_iso_code: languages[key]['iso_code']\n        });\n\n        break;\n      }\n    }\n}\n\nfunction hideOtherLanguage(id)\n{\n  $('.translatable-field').hide();\n  $('.lang-' + id).show();\n\n  var id_old_language = id_language;\n  id_language = id;\n\n  if (id_old_language != id)\n    changeEmployeeLanguage();\n\n  updateCurrentText();\n}\n\nfunction sendBulkAction(form, action)\n{\n  String.prototype.splice = function(index, remove, string) {\n    return (this.slice(0, index) + string + this.slice(index + Math.abs(remove)));\n  };\n\n  var form_action = $(form).attr('action');\n\n  if (form_action.replace(/(?:(?:^|\\n)\\s+|\\s+(?:$|\\n))/g,'').replace(/\\s+/g,' ') == '')\n    return false;\n\n  if (form_action.indexOf('#') == -1)\n    $(form).attr('action', form_action + '&' + action);\n  else\n    $(form).attr('action', form_action.splice(form_action.lastIndexOf('&'), 0, '&' + action));\n\n  $(form).submit();\n}\n\n/**\n * Searches for current controller and current CRUD action. This data can be used to know from where an ajax call is done (source tracking for example).\n * Action is 'index' by default.\n * For instance, only used for back-office.\n * @param force_action optional string to override action part of the result.\n */\nfunction getControllerActionMap(force_action) {\n  query = window.location.search.substring(1);\n  vars = query.split(\"&\");\n  controller = \"Admin\";\n  action = \"index\";\n\n  for (i = 0 ; i < vars.length; i++) {\n    pair = vars[i].split(\"=\");\n\n    if (pair[0] == \"token\")\n      continue;\n    if (pair[0] == \"controller\")\n      controller = pair[1];\n\n    if (pair.length == 1) {\n      if (pair[0].indexOf(\"add\") != -1)\n        action = \"new\";\n      else if (pair[0].indexOf(\"view\") != -1)\n        action = \"view\";\n      else if (pair[0].indexOf(\"edit\") != -1 || pair[0].indexOf(\"modify\") != -1 || pair[0].indexOf(\"update\") != -1)\n        action = \"edit\";\n      else if (pair[0].indexOf(\"delete\") != -1)\n        action = \"delete\";\n    }\n  }\n\n  if (force_action !== undefined)\n    action = force_action;\n\n  if (typeof help_class_name != 'undefined')\n    controller = help_class_name;\n\n  return new Array('back-office',controller, action);\n}\n\nfunction openModulesList()\n{\n\n  if (!modules_list_loaded)\n  {\n    header = $('#modules_list_container .modal-header').html();\n\n    $.ajax({\n      type: \"GET\",\n      url : admin_modules_link,\n      async: true,\n      data : {\n        ajax : \"1\",\n        controller : \"AdminModules\",\n        action : \"getTabModulesList\",\n        tab_modules_list : tab_modules_list,\n        back_tab_modules_list : window.location.href,\n        admin_list_from_source : getControllerActionMap().join()\n      },\n      success : function(data)\n      {\n        $('#modules_list_container_tab_modal').html(data).slideDown();\n        $('#modules_list_loader').hide();\n        modules_list_loaded = data;\n        $('.help-tooltip').tooltip();\n        controllerQuickView();\n      }\n    });\n  }\n  else\n  {\n    $('#modules_list_container_tab_modal').html(modules_list_loaded).slideDown();\n    $('#modules_list_loader').hide();\n    $('#modules_list_container .modal-header').html(header);\n    controllerQuickView();\n  }\n  return false;\n}\n\nfunction controllerQuickView()\n{\n  $('.controller-quick-view').click(function()\n  {\n    $.ajax({\n      type: \"POST\",\n      url : admin_modules_link,\n      dataType: 'json',\n      async: true,\n      data : {\n        ajax : \"1\",\n        controller : \"AdminModules\",\n        action : \"GetModuleReadMoreView\",\n        module: $(this).data(\"name\"),\n      },\n      success : function(data)\n      {\n        $('#modules_list_container_tab_modal').html(data.body);\n        $('#modules_list_container .modal-header').html(data.header);\n      }\n    });\n  });\n}\n\nfunction ajaxStates(id_state_selected)\n{\n  $.ajax({\n    url: \"index.php\",\n    cache: false,\n    data: \"token=\"+state_token+\"&ajax=1&action=states&tab=AdminStates&no_empty=0&id_country=\"+$('#id_country').val() + \"&id_state=\" + $('#id_state').val(),\n    success: function(html)\n    {\n      if (html == 'false')\n      {\n        $(\"#contains_states\").fadeOut();\n        $('#id_state option[value=0]').attr(\"selected\", \"selected\");\n      }\n      else\n      {\n        $(\"#id_state\").html(html);\n        $(\"#contains_states\").fadeIn();\n        $('#id_state option[value=' + id_state_selected + ']').attr(\"selected\", \"selected\");\n      }\n    }\n  });\n}\n\nfunction dniRequired() {\n  $.ajax({\n    url: 'index.php',\n    dataType: 'json',\n    cache: false,\n    data: 'token=' + address_token + '&ajax=1&dni_required=1&tab=AdminAddresses&id_country=' + $('#id_country').val(),\n    success: function(resp) {\n      if (resp && resp.dni_required) {\n        $(\"#dni_required\").fadeIn();\n      } else {\n        $(\"#dni_required\").fadeOut();\n      }\n    }\n  });\n}\n\nfunction check_for_all_accesses(tabsize, tabnumber)\n{\n  var i = 0;\n  var res = 0;\n  var right = 0;\n  var rights = new Array('view', 'add', 'edit', 'delete', 'all');\n\n  while (i != parseInt(tabsize) + 1)\n  {\n    if ($('#view'+i).prop('checked') == false || $('#edit'+i).prop('checked') == false || $('#add'+i).prop('checked') == false || $('#delete'+i).prop('checked') == false)\n      $('#all'+i).attr('checked', false);\n    else\n      $('#all'+i).attr('checked', \"checked\");\n    i++;\n  }\n  right = 0;\n  while (right != 5)\n  {\n    res = 0;\n    i = 0;\n    while (i != tabsize)\n    {\n      if ($('#'+rights[right]+i).prop('checked') == true)\n        res++;\n      i++;\n    }\n    if (res == tabnumber - 1)\n      $('#'+rights[right]+'all').attr('checked', \"checked\");\n    else\n      $('#'+rights[right]+'all').attr('checked', false);\n    right++;\n  }\n}\n\nfunction perfect_access_js_gestion(src, action, id_tab, tabsize, tabnumber, table)\n{\n  if (id_tab == '-1' && action == 'all')\n  {\n    $(table+' .add').attr('checked', src.checked);\n    $(table+' .edit').attr('checked', src.checked);\n    $(table+' .delete').attr('checked', src.checked);\n    $(table+' .view').attr('checked', src.checked);\n    $(table+' .all').attr('checked', src.checked);\n  }\n  else if (action == 'all')\n    $(table+' .'+id_tab).attr('checked', src.checked);\n  else if (id_tab == '-1')\n    $(table+' .'+action).attr('checked', src.checked);\n  check_for_all_accesses(tabsize, tabnumber);\n}\n\nverifMailREGEX = /^([\\w+-]+(?:\\.[\\w+-]+)*)@((?:[\\w-]+\\.)*\\w[\\w-]{0,66})\\.([a-z]{2,66}(?:\\.[a-z]{2})?)$/;\nfunction verifyMail(testMsg, testSubject)\n{\n  $(\"#mailResultCheck\").removeClass(\"alert-danger\").removeClass('alert-success').html('<img src=\"../img/admin/ajax-loader.gif\" alt=\"\" />');\n  $(\"#mailResultCheck\").slideDown(\"slow\");\n\n  //local verifications\n  if (!($(\"#testEmail\").val().length > 0))\n  {\n    $(\"#mailResultCheck\").addClass(\"alert-danger\").removeClass(\"alert-success\").removeClass('userInfos').html(errorMail);\n    return false;\n  }\n  else if (!verifMailREGEX.test( $(\"#testEmail\").val() ))\n  {\n    $(\"#mailResultCheck\").addClass(\"alert-danger\").removeClass(\"alert-success\").removeClass('userInfos').html(errorMail);\n    return false;\n  }\n  else\n  {\n    //external verifications and sets\n    $.ajax(\n    {\n       url: \"index.php\",\n       cache: false,\n       type : \"POST\",\n       data:\n      {\n        \"mailMethod\"  : (($(\"input[name=PS_MAIL_METHOD]:checked\").val() == 2) ? \"smtp\" : \"native\"),\n        \"smtpSrv\"   : $(\"input[name=PS_MAIL_SERVER]\").val(),\n        \"testEmail\"   : $(\"#testEmail\").val(),\n        \"smtpLogin\"   : $(\"input[name=PS_MAIL_USER]\").val(),\n        \"smtpPassword\"  : $(\"input[name=PS_MAIL_PASSWD]\").val(),\n        \"smtpPort\"    : $(\"input[name=PS_MAIL_SMTP_PORT]\").val(),\n        \"smtpEnc\"   : $(\"select[name=PS_MAIL_SMTP_ENCRYPTION]\").val(),\n        \"testMsg\"   : textMsg,\n        \"testSubject\" : textSubject,\n        \"token\"     : token_mail,\n        \"ajax\"      : 1,\n        \"tab\"       : 'AdminEmails',\n        \"action\"      : 'sendMailTest'\n      },\n       success: function(ret)\n       {\n        if (ret == \"ok\")\n        {\n          $(\"#mailResultCheck\").addClass(\"alert-success\").removeClass(\"alert-danger\").removeClass('userInfos').html(textSendOk);\n          mailIsOk = true;\n        }\n        else\n        {\n          mailIsOk = false;\n          $(\"#mailResultCheck\").addClass(\"alert-danger\").removeClass(\"alert-success\").removeClass('userInfos').html(textSendError + '<br />' + ret);\n        }\n       }\n     }\n     );\n  }\n}\n\nfunction checkLangPack(token){\n  if ($('#iso_code').val().length == 2)\n  {\n    $('#lang_pack_loading').show();\n    $('#lang_pack_msg').hide();\n    doAdminAjax(\n      {\n        controller:'AdminLanguages',\n        action:'checkLangPack',\n        token:token,\n        ajax:1,\n        iso_lang:($('#iso_code').val()).toLowerCase(),\n        ps_version:$('#ps_version').val()\n      },\n      function(ret)\n      {\n        $('#lang_pack_loading').hide();\n        ret = $.parseJSON(ret);\n        if( ret.status == 'ok')\n        {\n          content = $.parseJSON(ret.content);\n          message = langPackOk + ' <b>'+content['name'] + '</b>) :'\n            +'<br />' + langPackVersion + ' ' + content['version']\n            + ' <a href=\"https://www.prestashop.com/download/lang_packs/gzip/' + content['version'] + '/'\n            + ($('#iso_code').val()).toLowerCase()+'.gzip\" target=\"_blank\" class=\"link\">'+download+'</a><br />' + langPackInfo;\n          $('#lang_pack_msg').html(message);\n          $('#lang_pack_msg').show();\n        }\n        else\n          showErrorMessage(ret.error);\n      }\n     );\n   }\n}\n\nfunction redirect(new_page) { window.location = new_page; }\n\nfunction isCleanHtml(content)\n{\n  var events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n  events += '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n  events += '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n  events += '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|onmousewheel';\n  events += '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n  events += '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n  events += '|onselectstart|onstart|onstop';\n\n  var script1 = /<[\\s]*script/im;\n  var script2 = new RegExp('('+events+')[\\s]*=', 'im');\n  var script3 = /.*script\\:/im;\n  var script4 = /<[\\s]*(i?frame|embed|object)/im;\n\n  if (script1.test(content) || script2.test(content) || script3.test(content) || script4.test(content))\n    return false;\n\n  return true;\n}\n\nfunction parseDate(date){\n  return $.datepicker.parseDate(\"yy-mm-dd\", date);\n}\n\nfunction refresh_kpis()\n{\n  var force = (arguments.length == 1 && arguments[0] == true);\n  $('.box-stats').each(function() {\n    if ($(this).attr('id')) {\n      var functionName = 'refresh_' + $(this).attr('id').replace(/-/g, '_');\n      if (typeof window[functionName] === 'function') {\n        if (force) {\n          window[functionName](true); // force refresh, ignoring cache delay\n        } else {\n          window[functionName]();\n        }\n      }\n    }\n  });\n}\n\nfunction createSqlQueryName()\n{\n  var container = false;\n  var current = false;\n  if ($('.breadcrumb')) {\n    container = $('.breadcrumb li').eq(0).text().replace(/\\s+/g, ' ').trim();\n    current = $('.breadcrumb li').eq(-1).text().replace(/\\s+/g, ' ').trim();\n  }\n  var title = false;\n  if ($('h2.title'))\n    title = $('h2.title').first().text().replace(/\\s+/g, ' ').trim();\n\n  var name = false;\n  if (container && current && container != current)\n    name = container + ' > ' + current;\n  else if (container)\n    name = container;\n  else if (current)\n    name = current;\n\n  if (title && title != current && title != container)\n  {\n    if (name)\n      name = name + ' > ' + title;\n    else\n      name = title;\n  }\n\n  return name.trim();\n}\n\nfunction confirm_link(head_text, display_text, confirm_text, cancel_text, confirm_link, cancel_link)\n{\n  $.alerts.okButton = confirm_text;\n  $.alerts.cancelButton = cancel_text;\n  jConfirm(display_text, head_text, function(confirm){\n    if (confirm === true)\n      document.location = confirm_link;\n    else\n      document.location = cancel_link;\n  });\n\n}\n\nfunction TogglePackage(detail)\n{\n    var pack = $('#pack_items_' + detail);\n    pack.css('display', (pack.css('display') == 'block') ? \"none\" : \"block\");\n}\nfunction countDown($source, $target) {\n  var max = $source.attr(\"data-maxchar\");\n  $target.html(max-$source.val().length);\n\n  $source.keyup(function(){\n    $target.html(max-$source.val().length);\n  });\n}\n", "/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\nvar currencyFormatter;\nvar numberFormatter;\n\nvar Tools = {\n\n  /**\n   * Constructs a float value from an arbitrarily-formatted string.\n   * In order to prevent unexpected behavior, make sure that your value has a decimal part.\n   * @param {String} value Value to convert to float\n   * @param {Boolean} [coerce=false] If true, this function will return 0 instad of NaN if the value cannot be parsed to float\n   *\n   * @return {Number}\n   */\n  parseFloatFromString: function(value, coerce) {\n    value = String(value).trim();\n\n    if ('' === value) {\n      return 0;\n    }\n\n    // check if the string can be converted to float as-is\n    var parsed = parseFloat(value);\n    if (String(parsed) === value) {\n      return parsed;\n    }\n\n    // replace arabic numbers by latin\n\t\tvalue = value\n\t\t\t// arabic\n\t\t\t.replace(/[\\u0660-\\u0669]/g, function(d) {\n\t\t\t\treturn d.charCodeAt(0) - 1632;\n\t\t\t})\n\t\t\t// persian\n\t\t\t.replace(/[\\u06F0-\\u06F9]/g, function(d) {\n        return d.charCodeAt(0) - 1776;\n      })\n\t\t;\n\n    // remove all non-digit characters\n    var split = value.split(/[^\\dE-]+/);\n\n    if (1 === split.length) {\n      // there's no decimal part\n      return parseFloat(value);\n    }\n\n    for (var i = 0; i < split.length; i++) {\n      if ('' === split[i]) {\n        return coerce ? 0 : NaN;\n      }\n    }\n\n    // use the last part as decimal\n    var decimal = split.pop();\n\n    // reconstruct the number using dot as decimal separator\n    return parseFloat(split.join('') +  '.' + decimal);\n  }\n};\n\n/**\n * @returns float parsed from a string containing a formatted price\n */\nfunction formatedNumberToFloat(price, currencyFormat, currencySign)\n{\n\tprice = price.replace(currencySign, '');\n\tif (currencyFormat === 1)\n\t\treturn parseFloat(price.replace(',', '').replace(' ', ''));\n\telse if (currencyFormat === 2)\n\t\treturn parseFloat(price.replace(' ', '').replace(',', '.'));\n\telse if (currencyFormat === 3)\n\t\treturn parseFloat(price.replace('.', '').replace(' ', '').replace(',', '.'));\n\telse if (currencyFormat === 4)\n\t\treturn parseFloat(price.replace(',', '').replace(' ', ''));\n\treturn price;\n}\n\n/**\n * @deprecated Please use asynchronous formatNumberCldr() instead.\n *\n * @param value float The number to format\n * @param numberOfDecimal Size of fractionnal part in the number\n * @param thousenSeparator Not used anymore\n * @param virgule Not used anymore\n * @returns string a formatted number according to the current locale settings\n */\nfunction formatNumber(value, numberOfDecimal, thousenSeparator, virgule)\n{\n\treturn getNumberFormatter(numberOfDecimal).format(value);\n}\n\n/**\n * This call will load CLDR data to format a number according to the page locale, and then send formatted\n * number into parameter of the callback function. This function is asynchronous as AJAX calls may occur.\n *\n * @param value float The number to format\n * @param callback The function to call with the resulting formatted number as unique parameter\n * @param numberOfDecimal Size of fractionnal part in the number\n */\nfunction formatNumberCldr(value, callback, numberOfDecimal) {\n  callback(getNumberFormatter(numberOfDecimal).format(value));\n}\n\n/**\n * @deprecated Please use asynchronous formatCurrencyCldr() instead.\n *\n * @param price float The value to format in a price\n * @param currencyFormat Not used anymore\n * @param currencySign Not used anymore\n * @param currencyBlank Not used anymore\n * @returns string a formatted price according to the current locale settings\n */\nfunction formatCurrency(price, currencyFormat, currencySign, currencyBlank)\n{\n  // if you modified this function, don't forget to modify the PHP function displayPrice (in the Tools.php class)\n  var blank = '';\n  price = parseFloat(price.toFixed(10));\n  price = ps_round(price, priceDisplayPrecision);\n  if (currencyBlank > 0)\n  \tblank = ' ';\n  if (currencyFormat == 1)\n  \treturn currencySign + blank + formatNumber(price, priceDisplayPrecision, ',', '.');\n  if (currencyFormat == 2)\n  \treturn (formatNumber(price, priceDisplayPrecision, ' ', ',') + blank + currencySign);\n  if (currencyFormat == 3)\n  \treturn (currencySign + blank + formatNumber(price, priceDisplayPrecision, '.', ','));\n  if (currencyFormat == 4)\n  \treturn (formatNumber(price, priceDisplayPrecision, ',', '.') + blank + currencySign);\n  if (currencyFormat == 5)\n  \treturn (currencySign + blank + formatNumber(price, priceDisplayPrecision, '\\'', '.'));\n  return price;\n}\n\n/**\n * This call will load CLDR data to format a price according to the page locale, and then send formatted\n * price into parameter of the callback function. This function is asynchronous as AJAX calls may occur.\n *\n * @param price float The price to format\n * @param callback The function to call with the resulting formatted price as unique parameter\n */\nfunction formatCurrencyCldr(price, callback) {\n\tcallback(getCurrencyFormatter().format(price));\n}\n\n/**\n * Simple function to generate global NumberFormatter\n * with a price specification\n * based one global currency_specifications\n */\nfunction getCurrencyFormatter() {\n\tif (currencyFormatter === undefined) {\n\t\tcurrencyFormatter = window.cldr.NumberFormatter.build(currency_specifications);\n\t}\n\n\treturn currencyFormatter;\n}\n\n/**\n * Simple function to generate global NumberFormatter\n * based one global currency_specifications\n * @param numberOfDecimal Size of fractionnal part in the number\n */\nfunction getNumberFormatter(numberOfDecimal) {\n  if (numberFormatter === undefined) {\n    numberFormatter = window.cldr.NumberFormatter.build(number_specifications);\n  }\n\n  if (numberOfDecimal === undefined) {\n    numberOfDecimal = 2;\n  }\n\n  numberFormatter.numberSpecification.maxFractionDigits = numberOfDecimal;\n  numberFormatter.numberSpecification.minFractionDigits = numberOfDecimal;\n\n  return numberFormatter;\n}\n\nfunction ps_round_helper(value, mode)\n{\n\t// From PHP Math.c\n\tif (value >= 0.0)\n\t{\n\t\ttmp_value = Math.floor(value + 0.5);\n\t\tif ((mode == 3 && value == (-0.5 + tmp_value)) ||\n\t\t\t(mode == 4 && value == (0.5 + 2 * Math.floor(tmp_value / 2.0))) ||\n\t\t\t(mode == 5 && value == (0.5 + 2 * Math.floor(tmp_value / 2.0) - 1.0)))\n\t\t\ttmp_value -= 1.0;\n\t}\n\telse\n\t{\n\t\ttmp_value = Math.ceil(value - 0.5);\n\t\tif ((mode == 3 && value == (0.5 + tmp_value)) ||\n\t\t\t(mode == 4 && value == (-0.5 + 2 * Math.ceil(tmp_value / 2.0))) ||\n\t\t\t(mode == 5 && value == (-0.5 + 2 * Math.ceil(tmp_value / 2.0) + 1.0)))\n\t\t\ttmp_value += 1.0;\n\t}\n\n\treturn tmp_value;\n}\n\nfunction ps_log10(value)\n{\n\treturn Math.log(value) / Math.LN10;\n}\n\nfunction ps_round_half_up(value, precision)\n{\n\tvar mul = Math.pow(10, precision);\n\tvar val = value * mul;\n\n\tvar next_digit = Math.floor(val * 10) - 10 * Math.floor(val);\n\tif (next_digit >= 5)\n\t\tval = Math.ceil(val);\n\telse\n\t\tval = Math.floor(val);\n\n\treturn val / mul;\n}\n\nfunction ps_round(value, places)\n{\n\tif (typeof(roundMode) === 'undefined')\n\t\troundMode = 2;\n\tif (typeof(places) === 'undefined')\n\t\tplaces = 2;\n\n\tvar method = roundMode;\n\n\tif (method === 0)\n\t\treturn ceilf(value, places);\n\telse if (method === 1)\n\t\treturn floorf(value, places);\n\telse if (method === 2)\n\t\treturn ps_round_half_up(value, places);\n\telse if (method == 3 || method == 4 || method == 5)\n\t{\n\t\t// From PHP Math.c\n\t\tvar precision_places = 14 - Math.floor(ps_log10(Math.abs(value)));\n\t\tvar f1 = Math.pow(10, Math.abs(places));\n\n\t\tif (precision_places > places && precision_places - places < 15)\n\t\t{\n\t\t\tvar f2 = Math.pow(10, Math.abs(precision_places));\n\t\t\tif (precision_places >= 0)\n\t\t\t\ttmp_value = value * f2;\n\t\t\telse\n\t\t\t\ttmp_value = value / f2;\n\n\t\t\ttmp_value = ps_round_helper(tmp_value, roundMode);\n\n\t\t\t/* now correctly move the decimal point */\n\t\t\tf2 = Math.pow(10, Math.abs(places - precision_places));\n\t\t\t/* because places < precision_places */\n\t\t\ttmp_value /= f2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t/* adjust the value */\n\t\t\tif (places >= 0)\n\t\t\t\ttmp_value = value * f1;\n\t\t\telse\n\t\t\t\ttmp_value = value / f1;\n\n\t\t\tif (Math.abs(tmp_value) >= 1e15)\n\t\t\t\treturn value;\n\t\t}\n\n\t\ttmp_value = ps_round_helper(tmp_value, roundMode);\n\t\tif (places > 0)\n\t\t\ttmp_value = tmp_value / f1;\n\t\telse\n\t\t\ttmp_value = tmp_value * f1;\n\n\t\treturn tmp_value;\n\t}\n}\n\nfunction autoUrl(name, dest)\n{\n\tvar loc;\n\tvar id_list;\n\n\tid_list = document.getElementById(name);\n\tloc = id_list.options[id_list.selectedIndex].value;\n\tif (loc != 0)\n\t\tlocation.href = dest+loc;\n\treturn ;\n}\n\nfunction autoUrlNoList(name, dest)\n{\n\tvar loc;\n\n\tloc = document.getElementById(name).checked;\n\tlocation.href = dest + (loc == true ? 1 : 0);\n\treturn ;\n}\n\n/*\n** show or hide element e depending on condition show\n*/\nfunction toggle(e, show)\n{\n\te.style.display = show ? '' : 'none';\n}\n\nfunction toggleMultiple(tab)\n{\n    var len = tab.length;\n\n    for (var i = 0; i < len; i++)\n        if (tab[i].style)\n            toggle(tab[i], tab[i].style.display == 'none');\n}\n\nfunction truncateDecimals(value, decimals)\n{\n    var numPower = Math.pow(10, decimals);\n    var tempNumber = value * numPower;\n    var roundedTempNumber = Math.floor(tempNumber);\n    return roundedTempNumber / numPower;\n}\n\n/**\n* Show dynamicaly an element by changing the sytle \"display\" property\n* depending on the option selected in a select.\n*\n* @param string $select_id id of the select who controls the display\n* @param string $elem_id prefix id of the elements controlled by the select\n*   the real id must be : 'elem_id'+nb with nb the corresponding number in the\n*   select (starting with 0).\n*/\nfunction showElemFromSelect(select_id, elem_id)\n{\n\tvar select = document.getElementById(select_id);\n\tfor (var i = 0; i < select.length; ++i)\n\t{\n\t    var elem = document.getElementById(elem_id + select.options[i].value);\n\t\tif (elem != null)\n\t\t\ttoggle(elem, i == select.selectedIndex);\n\t}\n}\n\n/**\n* Get all div with specified name and for each one (by id), toggle their visibility\n*/\nfunction openCloseAllDiv(name, option)\n{\n\tvar tab = $('*[name='+name+']');\n\tfor (var i = 0; i < tab.length; ++i)\n\t\ttoggle(tab[i], option);\n}\n\nfunction toggleDiv(name, option)\n{\n\t$('*[name='+name+']').each(function(){\n\t\tif (option == 'open')\n\t\t{\n\t\t\t$('#buttonall').data('status', 'close');\n\t\t\t$(this).hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#buttonall').data('status', 'open');\n\t\t\t$(this).show();\n\t\t}\n\t})\n}\n\nfunction toggleButtonValue(id_button, text1, text2)\n{\n\tif ($('#'+id_button).find('i').first().hasClass('process-icon-compress'))\n\t{\n\t\t$('#'+id_button).find('i').first().removeClass('process-icon-compress').addClass('process-icon-expand');\n\t\t$('#'+id_button).find('span').first().html(text1);\n\t}\n\telse\n\t{\n\t\t$('#'+id_button).find('i').first().removeClass('process-icon-expand').addClass('process-icon-compress');\n\t\t$('#'+id_button).find('span').first().html(text2);\n\t}\n}\n\n\n/**\n* Toggle the value of the element id_button between text1 and text2\n*/\nfunction toggleElemValue(id_button, text1, text2)\n{\n\tvar obj = document.getElementById(id_button);\n\tif (obj)\n\t\tobj.value = ((!obj.value || obj.value == text2) ? text1 : text2);\n}\n\nfunction addBookmark(url, title)\n{\n\tif (window.sidebar && window.sidebar.addPanel)\n\t\treturn window.sidebar.addPanel(title, url, \"\");\n\telse if ( window.external && ('AddFavorite' in window.external))\n\t\treturn window.external.AddFavorite( url, title);\n}\n\nfunction writeBookmarkLink(url, title, text, img)\n{\n\tvar insert = '';\n\tif (img)\n\t\tinsert = writeBookmarkLinkObject(url, title, '<img src=\"' + img + '\" alt=\"' + escape(text) + '\" title=\"' + removeQuotes(text) + '\" />') + '&nbsp';\n\tinsert += writeBookmarkLinkObject(url, title, text);\n\tif (window.sidebar || window.opera && window.print || (window.external && ('AddFavorite' in window.external)))\n\t\t$('.add_bookmark, #header_link_bookmark').append(insert);\n}\n\nfunction writeBookmarkLinkObject(url, title, insert)\n{\n\tif (window.sidebar || window.external)\n\t\treturn ('<a href=\"javascript:addBookmark(\\'' + escape(url) + '\\', \\'' + removeQuotes(title) + '\\')\">' + insert + '</a>');\n\telse if (window.opera && window.print)\n\t\treturn ('<a rel=\"sidebar\" href=\"' + escape(url) + '\" title=\"' + removeQuotes(title) + '\">' + insert + '</a>');\n\treturn ('');\n}\n\nfunction checkCustomizations()\n{\n\tvar pattern = new RegExp(' ?filled ?');\n\n\tif (typeof customizationFields != 'undefined')\n\t\tfor (var i = 0; i < customizationFields.length; i++)\n\t\t{\n\t\t\t/* If the field is required and empty then we abort */\n\t\t\tif (parseInt(customizationFields[i][1]) == 1 && ($('#' + customizationFields[i][0]).html() == '' ||  $('#' + customizationFields[i][0]).text() != $('#' + customizationFields[i][0]).val()) && !pattern.test($('#' + customizationFields[i][0]).attr('class')))\n\t\t\t\treturn false;\n\t\t}\n\treturn true;\n}\n\nfunction emptyCustomizations()\n{\n\tcustomizationId = null;\n\tif(typeof(customizationFields) == 'undefined') return;\n\n\t$('.customization_block .success').fadeOut(function(){\n\t\t$(this).remove();\n\t});\n\t$('.customization_block .error').fadeOut(function(){\n\t\t$(this).remove();\n\t});\n\tfor (var i = 0; i < customizationFields.length; i++)\n\t{\n\t\t$('#' + customizationFields[i][0]).html('');\n\t\t$('#' + customizationFields[i][0]).val('');\n\t}\n}\n\nfunction ceilf(value, precision)\n{\n\tif (typeof(precision) === 'undefined')\n\t\tprecision = 0;\n\tvar precisionFactor = precision === 0 ? 1 : Math.pow(10, precision);\n\tvar tmp = value * precisionFactor;\n\tvar tmp2 = tmp.toString();\n\tif (tmp2[tmp2.length - 1] === 0)\n\t\treturn value;\n\treturn Math.ceil(value * precisionFactor) / precisionFactor;\n}\n\nfunction floorf(value, precision)\n{\n\tif (typeof(precision) === 'undefined')\n\t\tprecision = 0;\n\tvar precisionFactor = precision === 0 ? 1 : Math.pow(10, precision);\n\tvar tmp = value * precisionFactor;\n\tvar tmp2 = tmp.toString();\n\tif (tmp2[tmp2.length - 1] === 0)\n\t\treturn value;\n\treturn Math.floor(value * precisionFactor) / precisionFactor;\n}\n\nfunction setCurrency(id_currency)\n{\n\t$.ajax({\n\t\ttype: 'POST',\n\t\theaders: { \"cache-control\": \"no-cache\" },\n\t\turl: baseDir + 'index.php' + '?rand=' + new Date().getTime(),\n\t\tdata: 'controller=change-currency&id_currency='+ parseInt(id_currency),\n\t\tsuccess: function(msg)\n\t\t{\n\t\t\tlocation.reload(true);\n\t\t}\n\t});\n}\n\nfunction isArrowKey(k_ev)\n{\n\tvar unicode=k_ev.keyCode? k_ev.keyCode : k_ev.charCode;\n\tif (unicode >= 37 && unicode <= 40)\n\t\treturn true;\n\treturn false;\n}\n\nfunction removeQuotes(value)\n{\n\tvalue = value.replace(/\\\\\"/g, '');\n\tvalue = value.replace(/\"/g, '');\n\tvalue = value.replace(/\\\\'/g, '');\n\tvalue = value.replace(/'/g, '');\n\n\treturn value;\n}\n\nfunction sprintf(format)\n{\n\tfor(var i=1; i < arguments.length; i++)\n\t\tformat = format.replace(/%s/, arguments[i]);\n\n\treturn format;\n}\n\n/**\n * Display a MessageBox\n * @param {string} msg\n * @param {string} title (optional)\n */\nfunction fancyMsgBox(msg, title)\n{\n    if (title) msg = \"<h2>\" + title + \"</h2><p>\" + msg + \"</p>\";\n    msg += \"<br/><p class=\\\"submit\\\" style=\\\"text-align:right; padding-bottom: 0\\\"><input class=\\\"button\\\" type=\\\"button\\\" value=\\\"OK\\\" onclick=\\\"$.fancybox.close();\\\" /></p>\";\n\tif(!!$.prototype.fancybox)\n    \t$.fancybox( msg, {'autoDimensions': false, 'autoSize': false, 'width': 500, 'height': 'auto', 'openEffect': 'none', 'closeEffect': 'none'} );\n}\n\n/**\n * Display a messageDialog with different buttons including a callback for each one\n * @param {string} question\n * @param {mixed} title Optional title for the dialog box. Send false if you don't want any title\n * @param {object} buttons Associative array containg a list of {buttonCaption: callbackFunctionName, ...}. Use an empty space instead of function name for no callback\n * @param {mixed} otherParams Optional data sent to the callback function\n */\nfunction fancyChooseBox(question, title, buttons, otherParams)\n{\n    var msg, funcName, action;\n\tmsg = '';\n    if (title)\n\t\tmsg = \"<h2>\" + title + \"</h2><p>\" + question + \"</p>\";\n    msg += \"<br/><p class=\\\"submit\\\" style=\\\"text-align:right; padding-bottom: 0\\\">\";\n    var i = 0;\n    for (var caption in buttons) {\n        if (!buttons.hasOwnProperty(caption)) continue;\n        funcName = buttons[caption];\n        if (typeof otherParams == 'undefined') otherParams = 0;\n        otherParams = escape(JSON.stringify(otherParams));\n        action = funcName ? \"$.fancybox.close();window['\" + funcName + \"'](JSON.parse(unescape('\" + otherParams + \"')), \" + i + \")\" : \"$.fancybox.close()\";\n\t  msg += '<button type=\"submit\" class=\"button btn-default button-medium\" style=\"margin-right: 5px;\" value=\"true\" onclick=\"' + action + '\" >';\n\t  msg += '<span>' + caption + '</span></button>'\n        i++;\n    }\n    msg += \"</p>\";\n\tif(!!$.prototype.fancybox)\n    \t$.fancybox(msg, {'autoDimensions': false, 'width': 500, 'height': 'auto', 'openEffect': 'none', 'closeEffect': 'none'});\n}\n\nfunction toggleLayer(whichLayer, flag)\n{\n\tif (!flag)\n\t\t$(whichLayer).hide();\n\telse\n\t\t$(whichLayer).show();\n}\n\nfunction openCloseLayer(whichLayer, action)\n{\n\tif (!action)\n\t{\n\t\tif ($(whichLayer).css('display') == 'none')\n\t\t\t$(whichLayer).show();\n\t\telse\n\t\t\t$(whichLayer).hide();\n\t}\n\telse if (action == 'open')\n\t\t$(whichLayer).show();\n\telse if (action == 'close')\n\t\t$(whichLayer).hide();\n}\n\nfunction updateTextWithEffect(jQueryElement, text, velocity, effect1, effect2, newClass)\n{\n\tif(jQueryElement.text() !== text)\n\t{\n\t\tif(effect1 === 'fade')\n\t\t\tjQueryElement.fadeOut(velocity, function(){\n\t\t\t\t$(this).addClass(newClass);\n\t\t\t\tif(effect2 === 'fade') $(this).text(text).fadeIn(velocity);\n\t\t\t\telse if(effect2 === 'slide') $(this).text(text).slideDown(velocity);\n\t\t\t\t\telse if(effect2 === 'show')\t$(this).text(text).show(velocity, function(){});\n\t\t\t});\n\t\telse if(effect1 === 'slide')\n\t\t\tjQueryElement.slideUp(velocity, function(){\n\t\t\t\t$(this).addClass(newClass);\n\t\t\t\tif(effect2 === 'fade') $(this).text(text).fadeIn(velocity);\n\t\t\t\telse if(effect2 === 'slide') $(this).text(text).slideDown(velocity);\n\t\t\t\t\telse if(effect2 === 'show')\t$(this).text(text).show(velocity);\n\t\t\t});\n\t\telse if(effect1 === 'hide')\n\t\t\tjQueryElement.hide(velocity, function(){\n\t\t\t\t$(this).addClass(newClass);\n\t\t\t\tif(effect2 === 'fade') $(this).text(text).fadeIn(velocity);\n\t\t\t\telse if(effect2 === 'slide') $(this).text(text).slideDown(velocity);\n\t\t\t\t\telse if(effect2 === 'show')\t$(this).text(text).show(velocity);\n\t\t\t});\n\t}\n}\n//show a JS debug\nfunction dbg(value)\n{\n\tvar active = false;//true for active\n\tvar firefox = true;//true if debug under firefox\n\n\tif (active)\n\t\tif (firefox)\n\t\t\tconsole.log(value);\n\t\telse\n\t\t\talert(value);\n}\n\n/**\n* Function : print_r()\n* Arguments: The element  - array,hash(associative array),object\n*            The limit - OPTIONAL LIMIT\n*            The depth - OPTIONAL\n* Returns  : The textual representation of the array.\n* This function was inspired by the print_r function of PHP.\n* This will accept some data as the argument and return a\n* text that will be a more readable version of the\n* array/hash/object that is given.\n*/\nfunction print_r(element, limit, depth)\n{\n\tdepth =\tdepth?depth:0;\n\tlimit = limit?limit:1;\n\n\treturnString = '<ol>';\n\n\tfor(property in element)\n\t{\n\t\t//Property domConfig isn't accessable\n\t\tif (property != 'domConfig')\n\t\t{\n\t\t\treturnString += '<li><strong>'+ property + '</strong> <small>(' + (typeof element[property]) +')</small>';\n\n\t\t\tif (typeof element[property] == 'number' || typeof element[property] == 'boolean')\n\t\t\t\treturnString += ' : <em>' + element[property] + '</em>';\n\t\t\tif (typeof element[property] == 'string' && element[property])\n\t\t\t\treturnString += ': <div style=\"background:#C9C9C9;border:1px solid black; overflow:auto;\"><code>' +\n\t\t\t\t\t\t\t\t\telement[property].replace(/</g, '&amp;lt;').replace(/>/g, '&amp;gt;') + '</code></div>';\n\n\t\t\tif ((typeof element[property] == 'object') && (depth < limit))\n\t\t\t\treturnString += print_r(element[property], limit, (depth + 1));\n\n\t\t\treturnString += '</li>';\n\t\t}\n\t}\n\treturnString += '</ol>';\n\n\tif(depth == 0)\n\t{\n\t\twinpop = window.open(\"\", \"\",\"width=800,height=600,scrollbars,resizable\");\n\t\twinpop.document.write('<pre>'+returnString+ '</pre>');\n\t\twinpop.document.close();\n\t}\n\treturn returnString;\n}\n\n//verify if value is in the array\nfunction in_array(value, array)\n{\n\tfor (var i in array)\n\t\tif ((array[i] + '') === (value + ''))\n\t\t\treturn true;\n\treturn false;\n}\n\nfunction isCleanHtml(content)\n{\n\tvar events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n\tevents += '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n\tevents += '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n\tevents += '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|onmousewheel';\n\tevents += '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n\tevents += '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n\tevents += '|onselectstart|onstart|onstop';\n\n\tvar script1 = /<[\\s]*script/im;\n\tvar script2 = new RegExp('('+events+')[\\s]*=', 'im');\n\tvar script3 = /.*script\\:/im;\n\tvar script4 = /<[\\s]*(i?frame|embed|object)/im;\n\n\tif (script1.test(content) || script2.test(content) || script3.test(content) || script4.test(content))\n\t\treturn false;\n\n\treturn true;\n}\n\nfunction getStorageAvailable() {\n\ttest = 'foo';\n\tstorage =  window.localStorage || window.sessionStorage;\n\ttry {\n\t\tstorage.setItem(test, test);\n\t\tstorage.removeItem(test);\n\t\treturn storage;\n\t}\n\tcatch (error) {\n\t\treturn null;\n\t}\n}\n\n$(document).ready(function()\n{\n\t// Hide all elements with .hideOnSubmit class when parent form is submit\n\t$('form').submit(function() {\n\t\t$(this).find('.hideOnSubmit').hide();\n\t});\n\n\t$.fn.checkboxChange = function(fnChecked, fnUnchecked) {\n\t\tif ($(this).prop('checked') && fnChecked)\n\t\t\tfnChecked.call(this);\n\t\telse if(fnUnchecked)\n\t\t\tfnUnchecked.call(this);\n\n\t\tif (!$(this).attr('eventCheckboxChange'))\n\t\t{\n\t\t\t$(this).on('change', function() { $(this).checkboxChange(fnChecked, fnUnchecked); });\n\t\t\t$(this).attr('eventCheckboxChange', true);\n\t\t}\n\t};\n\n\t// attribute target=\"_blank\" is not W3C compliant\n\t$('a._blank, a.js-new-window').attr('target', '_blank');\n});\n", "<?php\n/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\nnamespace PrestaShop\\PrestaShop\\Core\\ConstraintValidator;\n\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\Constraints\\CleanHtml;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Class CleanHtmlValidator is responsible for validating the html content to prevent from having javascript events\n * or script tags.\n */\nfinal class CleanHtmlValidator extends ConstraintValidator\n{\n    private const EMBEDDABLE_HTML_PATTERN = '/<[\\s]*(i?frame|form|input|embed|object)/ims';\n\n    /**\n     * @var bool\n     */\n    private $allowEmbeddableHtml;\n\n    public function __construct(bool $allowEmbeddableHtml)\n    {\n        $this->allowEmbeddableHtml = $allowEmbeddableHtml;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function validate($value, Constraint $constraint)\n    {\n        if (!$constraint instanceof CleanHtml) {\n            throw new UnexpectedTypeException($constraint, CleanHtml::class);\n        }\n\n        if (!$value) {\n            return;\n        }\n\n        if (!is_string($value)) {\n            throw new UnexpectedTypeException($value, 'string');\n        }\n\n        $containsScriptTags = preg_match('/<[\\s]*script/ims', $value) || preg_match('/.*script\\:/ims', $value);\n        $containsJavascriptEvents = preg_match('/(' . $this->getJavascriptEvents() . ')[\\s]*=/ims', $value);\n\n        $iframe = !$this->allowEmbeddableHtml && preg_match(self::EMBEDDABLE_HTML_PATTERN, $value);\n        if ($containsScriptTags || $containsJavascriptEvents || $iframe) {\n            $this->context->buildViolation($constraint->message)\n                ->setTranslationDomain('Admin.Notifications.Error')\n                ->setParameter('%s', $this->formatValue($value))\n                ->addViolation()\n            ;\n        }\n    }\n\n    /**\n     * Gets javascript events separated by pipeline which are used in preg match pattern to determine if string\n     * contains a javascript event. E.g onchange= is valid call for js event.\n     *\n     * @return string\n     */\n    private function getJavascriptEvents()\n    {\n        $events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n        $events .= '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n        $events .= '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n        $events .= '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|onmousewheel';\n        $events .= '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n        $events .= '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n        $events .= '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n        $events .= '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n\n        return $events;\n    }\n}\n", "<?php\n/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\ndeclare(strict_types=1);\n\nnamespace Tests\\Unit\\Adapter;\n\nuse PHPUnit\\Framework\\TestCase;\nuse PrestaShop\\PrestaShop\\Adapter\\Validate;\n\nclass ValidateTest extends TestCase\n{\n    /**\n     * @var Validate\n     */\n    private $validate;\n\n    /**\n     * @param string $name\n     * @param array $data\n     * @param string $dataName\n     */\n    public function __construct($name = null, array $data = [], $dataName = '')\n    {\n        parent::__construct($name, $data, $dataName);\n\n        $this->validate = new Validate();\n    }\n\n    /**\n     * @dataProvider getIsOrderWay\n     */\n    public function testIsOrderWay(int $expected, $input): void\n    {\n        self::assertEquals($expected, $this->validate::isOrderWay($input));\n    }\n\n    public function getIsOrderWay(): iterable\n    {\n        yield [0, 'test'];\n        yield [0, 1];\n        yield [0, true];\n        yield [1, 'ASC'];\n        yield [1, 'DESC'];\n        yield [1, 'asc'];\n        yield [1, 'desc'];\n        yield [1, 'random'];\n        yield [1, 'RANDOM'];\n    }\n\n    /**\n     * @dataProvider isEmailDataProvider\n     */\n    public function testIsEmail(bool $expected, string $email): void\n    {\n        $this->assertSame($expected, $this->validate->isEmail($email));\n    }\n\n    public function isEmailDataProvider(): array\n    {\n        return [\n            [true, 'john.doe@prestashop.com'],\n            [true, 'john.doe+alias@prestshop.com'],\n            [true, 'john.doe+alias@pr.e.sta.shop.com'],\n            [true, 'j@p.com'],\n            [true, 'john#doe@prestashop.com'],\n            [false, ''],\n            [false, 'john.doe@prestashop,com'],\n            [false, 'john.doe@prestashop'],\n            [true, 'john.doe@\u0441\u0430\u0439\u0442.\u0440\u0444'],\n            [true, 'john.doe@xn--80aswg.xn--p1ai'],\n            [false, '\u0438\u0432\u0430\u043d@prestashop.com'], // rfc6531 valid but not swift mailer compatible\n            [true, 'xn--80adrw@prestashop.com'],\n            [true, 'xn--80adrw@xn--80aswg.xn--p1ai'],\n        ];\n    }\n\n    /**\n     * @param bool $expected\n     * @param mixed $value\n     *\n     * @dataProvider isUnsignedIntProvider\n     */\n    public function testIsUnsignedInt(bool $expected, $value): void\n    {\n        self::assertEquals($expected, $this->validate->isUnsignedInt($value));\n    }\n\n    public function isUnsignedIntProvider(): array\n    {\n        return [\n            [true, 1],\n            [true, 666],\n            [true, 0],\n            [true, '234'],\n            [true, '0'],\n            [false, -1],\n            [false, '-1'],\n            [false, false],\n            [false, true],\n            [false, null],\n            [false, 'invalid'],\n            [false, '666invalid'],\n        ];\n    }\n\n    /**\n     * @param bool $expected\n     * @param string $objectClassName\n     *\n     * @dataProvider isValidObjectClassNameDataProvider\n     */\n    public function testisValidObjectClassName(bool $expected, string $objectClassName): void\n    {\n        $this->assertSame($expected, $this->validate->isValidObjectClassName($objectClassName));\n    }\n\n    public function isValidObjectClassNameDataProvider(): array\n    {\n        return [\n            [true, 'MyClassName'],\n            [true, '_MyClassName'],\n            [true, '_My_Class_Name_'],\n            [true, '_MyClassName_'],\n            [true, '__My__Class__Name__'],\n            [false, ''],\n            [false, '666'],\n            [true, '_666'],\n            [true, '_6_6_6_'],\n            [true, '__'],\n        ];\n    }\n}\n", "<?php\n/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\nnamespace Tests\\Unit\\Core\\ConstraintValidator;\n\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\CleanHtmlValidator;\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\Constraints\\CleanHtml;\nuse Symfony\\Component\\Validator\\Test\\ConstraintValidatorTestCase;\n\nclass CleanHtmlValidatorTest extends ConstraintValidatorTestCase\n{\n    public function testItFailsWhenScriptTagsAreGiven()\n    {\n        $scriptTag = '<script></script>';\n\n        $this->validator->validate($scriptTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $scriptTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenJavascriptEventsAreGiven()\n    {\n        $htmlTag = '<a href=\"#\" onchange=\"evilJavascriptIsCalled()\"></a>';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenIframeIsGiven()\n    {\n        $htmlTag = '<iframe src=\"catvideo.html\" /></iframe>';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenIframeWithSpacesIsGiven()\n    {\n        $htmlTag = '< iframe >';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenFormIsGiven()\n    {\n        $htmlTag = '<form>';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenInputIsGiven()\n    {\n        $htmlTag = '<input name=\"your-card-number\">';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenEmbedIsGiven()\n    {\n        $htmlTag = '<embed type=\"image/jpg\" src=\"funny_cat.jpg\" width=\"300\" height=\"200\">';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenObjectIsGiven()\n    {\n        $htmlTag = '<object data=\"funny_cat.jpg\" width=\"300\" height=\"200\"></object> ';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testSucceedsWithPlainWords()\n    {\n        $htmlTag = '/form input > embed object iframe';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->assertNoViolation();\n        $this->context->getViolations();\n    }\n\n    protected function createValidator()\n    {\n        return new CleanHtmlValidator(false);\n    }\n}\n"], "fixing_code": ["<?php\n/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\nuse Egulias\\EmailValidator\\EmailValidator;\nuse Egulias\\EmailValidator\\Validation\\MultipleValidationWithAnd;\nuse Egulias\\EmailValidator\\Validation\\RFCValidation;\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\Constraints\\CustomerName;\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\Factory\\CustomerNameValidatorFactory;\nuse PrestaShop\\PrestaShop\\Core\\Domain\\Currency\\ValueObject\\NumericIsoCode;\nuse PrestaShop\\PrestaShop\\Core\\Domain\\Customer\\ValueObject\\ApeCode;\nuse PrestaShop\\PrestaShop\\Core\\Domain\\Product\\ValueObject\\Isbn;\nuse PrestaShop\\PrestaShop\\Core\\Email\\SwiftMailerValidation;\nuse PrestaShop\\PrestaShop\\Core\\Security\\PasswordPolicyConfiguration;\nuse Symfony\\Component\\Validator\\Constraints\\Email;\nuse Symfony\\Component\\Validator\\Validation;\nuse ZxcvbnPhp\\Zxcvbn;\n\nclass ValidateCore\n{\n    public const ORDER_BY_REGEXP = '/^(?:(`?)[\\w!_-]+\\1\\.)?(?:(`?)[\\w!_-]+\\2)$/';\n    public const OBJECT_CLASS_NAME_REGEXP = '/^[a-zA-Z_\\x80-\\xff][a-zA-Z0-9_\\x80-\\xff]*(\\\\\\\\[a-zA-Z_\\x80-\\xff][a-zA-Z0-9_\\x80-\\xff]*)*$/';\n    /**\n     * Maximal 32 bits value: (2^32)-1\n     *\n     * @var int\n     */\n    public const MYSQL_UNSIGNED_INT_MAX = 4294967295;\n\n    /**\n     * @deprecated since 8.0.0 use PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_LENGTH\n     */\n    public const ADMIN_PASSWORD_LENGTH = 8;\n\n    /**\n     * @deprecated since 8.0.0 use PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_LENGTH\n     */\n    public const PASSWORD_LENGTH = 5;\n\n    public static function isIp2Long($ip)\n    {\n        return preg_match('#^-?[0-9]+$#', (string) $ip);\n    }\n\n    /**\n     * @deprecated since PrestaShop 8.1 and will be removed in Prestashop 9.0\n     */\n    public static function isAnything()\n    {\n        @trigger_error(\n            'This function is deprecated PrestaShop 8.1 and will be removed in Prestashop 9.0.',\n            E_USER_DEPRECATED\n        );\n\n        return true;\n    }\n\n    /**\n     * Check for e-mail validity.\n     *\n     * @param string $email e-mail address to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isEmail($email)\n    {\n        // Check if the value is empty\n        if (empty($email)) {\n            return false;\n        }\n\n        $validator = Validation::createValidator();\n        $errors = $validator->validate($email, new Email([\n            'mode' => 'loose',\n        ]));\n\n        if (count($errors) > 0) {\n            return false;\n        }\n\n        // Check if the value is correct according to both validators (RFC & SwiftMailer)\n        return (new EmailValidator())->isValid($email, new MultipleValidationWithAnd([\n            new RFCValidation(),\n            new SwiftMailerValidation(), // special validation to be compatible with Swift Mailer\n        ]));\n    }\n\n    /**\n     * Check for module URL validity.\n     *\n     * @param string $url module URL to validate\n     * @param array $errors Reference array for catching errors\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isModuleUrl($url, &$errors)\n    {\n        if (!$url || $url == 'http://') {\n            $errors[] = Context::getContext()->getTranslator()->trans('Please specify module URL', [], 'Admin.Modules.Notification');\n        } elseif (substr($url, -4) != '.tar' && substr($url, -4) != '.zip' && substr($url, -4) != '.tgz' && substr($url, -7) != '.tar.gz') {\n            $errors[] = Context::getContext()->getTranslator()->trans('Unknown archive type.', [], 'Admin.Modules.Notification');\n        } else {\n            if ((strpos($url, 'http')) === false) {\n                $url = 'http://' . $url;\n            }\n            if (!is_array(@get_headers($url))) {\n                $errors[] = Context::getContext()->getTranslator()->trans('Invalid URL', [], 'Admin.Notifications.Error');\n            }\n        }\n        if (!count($errors)) {\n            return true;\n        }\n\n        return false;\n    }\n\n    /**\n     * Check for MD5 string validity.\n     *\n     * @param string $md5 MD5 string to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMd5($md5)\n    {\n        return preg_match('/^[a-f0-9A-F]{32}$/', $md5);\n    }\n\n    /**\n     * Check for SHA1 string validity.\n     *\n     * @param string $sha1 SHA1 string to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isSha1($sha1)\n    {\n        return preg_match('/^[a-fA-F0-9]{40}$/', $sha1);\n    }\n\n    /**\n     * Check for a float number validity.\n     *\n     * @param float $float Float number to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isFloat($float)\n    {\n        return (string) ((float) $float) == (string) $float;\n    }\n\n    public static function isUnsignedFloat($float)\n    {\n        return (string) ((float) $float) == (string) $float && $float >= 0;\n    }\n\n    /**\n     * Check for a float number validity.\n     *\n     * @param float $float Float number to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isOptFloat($float)\n    {\n        return empty($float) || Validate::isFloat($float);\n    }\n\n    /**\n     * Check for a carrier name validity.\n     *\n     * @param string $name Carrier name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCarrierName($name)\n    {\n        return empty($name) || preg_match('/^[^<>;=#{}]*$/u', $name);\n    }\n\n    /**\n     * Check for an image size validity.\n     *\n     * @param string $size Image size to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isImageSize($size)\n    {\n        return preg_match('/^[0-9]{1,4}$/', $size);\n    }\n\n    /**\n     * Check whether given customer name is valid\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool\n     */\n    public static function isCustomerName($name)\n    {\n        $validatorBuilder = Validation::createValidatorBuilder();\n        $validatorBuilder->setConstraintValidatorFactory(new CustomerNameValidatorFactory());\n        $validator = $validatorBuilder->getValidator();\n        $violations = $validator->validate($name, [\n            new CustomerName(),\n        ]);\n\n        return count($violations) === 0;\n    }\n\n    /**\n     * Check whether given name is valid\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool\n     */\n    public static function isName($name)\n    {\n        return preg_match('/^[^0-9!<>,;?=+()@#\"\u00b0{}_$%:\u00a4|]*$/u', $name);\n    }\n\n    /**\n     * Check for hook name validity.\n     *\n     * @param string $hook Hook name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isHookName($hook)\n    {\n        return preg_match('/^[a-zA-Z0-9_-]+$/', $hook);\n    }\n\n    /**\n     * Check for sender name validity.\n     *\n     * @param string $mail_name Sender name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMailName($mail_name)\n    {\n        return is_string($mail_name) && preg_match('/^[^<>;=#{}]*$/u', $mail_name);\n    }\n\n    /**\n     * Check for e-mail subject validity.\n     *\n     * @param string $mail_subject e-mail subject to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMailSubject($mail_subject)\n    {\n        return preg_match('/^[^<>]*$/u', $mail_subject);\n    }\n\n    /**\n     * Check for module name validity.\n     *\n     * @param string $module_name Module name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isModuleName($module_name)\n    {\n        return is_string($module_name) && preg_match('/^[a-zA-Z0-9_-]+$/', $module_name);\n    }\n\n    /**\n     * Check for template name validity.\n     *\n     * @param string $tpl_name Template name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTplName($tpl_name)\n    {\n        return preg_match('/^[a-zA-Z0-9_-]+$/', $tpl_name);\n    }\n\n    /**\n     * Check for image type name validity.\n     *\n     * @param string $type Image type name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isImageTypeName($type)\n    {\n        return preg_match('/^[a-zA-Z0-9_ -]+$/', $type);\n    }\n\n    /**\n     * Check for price validity.\n     *\n     * @param string $price Price to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPrice($price)\n    {\n        return preg_match('/^[0-9]{1,10}(\\.[0-9]{1,9})?$/', $price);\n    }\n\n    /**\n     * Check for price validity (including negative price).\n     *\n     * @param string $price Price to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isNegativePrice($price)\n    {\n        return preg_match('/^[-]?[0-9]{1,10}(\\.[0-9]{1,9})?$/', $price);\n    }\n\n    /**\n     * Check for language code (ISO) validity.\n     *\n     * @param string $iso_code Language code (ISO) to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLanguageIsoCode($iso_code)\n    {\n        return preg_match('/^[a-zA-Z]{2,3}$/', $iso_code);\n    }\n\n    public static function isLanguageCode($s)\n    {\n        return preg_match('/^[a-zA-Z]{2}(-[a-zA-Z]{2})?$/', $s);\n    }\n\n    /**\n     * @see https://en.wikipedia.org/wiki/IETF_language_tag#ISO_3166-1_and_UN_M.49\n     *\n     * @param string $s\n     *\n     * @return bool\n     */\n    public static function isLocale($s)\n    {\n        return preg_match('/^[a-z]{2}-[A-Z]{2}$/', $s);\n    }\n\n    public static function isStateIsoCode($iso_code)\n    {\n        return preg_match('/^[a-zA-Z0-9]{1,4}((-)[a-zA-Z0-9]{1,4})?$/', $iso_code);\n    }\n\n    public static function isNumericIsoCode($iso_code)\n    {\n        return preg_match(NumericIsoCode::PATTERN, $iso_code);\n    }\n\n    /**\n     * Check for voucher name validity.\n     *\n     * @param string $voucher voucher to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isDiscountName($voucher)\n    {\n        return preg_match('/^[^!<>,;?=+()@\"\u00b0{}_$%:]{3,32}$/u', $voucher);\n    }\n\n    /**\n     * Check for product or category name validity.\n     *\n     * @param string $name Product or category name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCatalogName($name)\n    {\n        return preg_match('/^[^<>;=#{}]*$/u', $name);\n    }\n\n    /**\n     * Check for a message validity.\n     *\n     * @param string $message Message to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMessage($message)\n    {\n        return !preg_match('/[<>{}]/i', $message);\n    }\n\n    /**\n     * Check for a country name validity.\n     *\n     * @param string $name Country name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCountryName($name)\n    {\n        return preg_match('/^[a-zA-Z -]+$/', $name);\n    }\n\n    /**\n     * Check for a link (url-rewriting only) validity.\n     *\n     * @param string $link Link to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLinkRewrite($link)\n    {\n        if (Configuration::get('PS_ALLOW_ACCENTED_CHARS_URL')) {\n            return preg_match('/^[_a-zA-Z0-9\\x{0600}-\\x{06FF}\\pL\\pS-]+$/u', $link);\n        }\n\n        return preg_match('/^[_a-zA-Z0-9\\-]+$/', $link);\n    }\n\n    /**\n     * Check for a route pattern validity.\n     *\n     * @param string $pattern to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isRoutePattern($pattern)\n    {\n        if (Configuration::get('PS_ALLOW_ACCENTED_CHARS_URL')) {\n            return preg_match('/^[_a-zA-Z0-9\\x{0600}-\\x{06FF}\\(\\)\\.{}:\\/\\pL\\pS-]+$/u', $pattern);\n        }\n\n        return preg_match('/^[_a-zA-Z0-9\\(\\)\\.{}:\\/\\-]+$/', $pattern);\n    }\n\n    /**\n     * Check for a postal address validity.\n     *\n     * @param string $address Address to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isAddress($address)\n    {\n        return empty($address) || preg_match('/^[^!<>?=+@{}_$%]*$/u', $address);\n    }\n\n    /**\n     * Check for city name validity.\n     *\n     * @param string $city City name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCityName($city)\n    {\n        return preg_match('/^[^!<>;?=+@#\"\u00b0{}_$%]*$/u', $city);\n    }\n\n    /**\n     * Check for search query validity.\n     *\n     * @param string $search Query to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isValidSearch($search)\n    {\n        return preg_match('/^[^<>;=#{}]{0,64}$/u', $search);\n    }\n\n    /**\n     * Check for standard name validity.\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isGenericName($name)\n    {\n        return empty($name) || preg_match('/^[^<>={}]*$/u', $name);\n    }\n\n    /**\n     * Check for HTML field validity (no XSS please !).\n     *\n     * @param string $html HTML field to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCleanHtml($html, $allow_iframe = false)\n    {\n        // any html attribute starting with \"on\" (event attributes)\n        $eventAttributeRegex = '/<\\s*\\w+[^>]*\\s(on\\w+)=[\"\\'][^\"\\']*[\"\\']/ims';\n\n        $events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n        $events .= '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n        $events .= '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n        $events .= '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|ondragexit|onmousewheel';\n        $events .= '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n        $events .= '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n        $events .= '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n        $events .= '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n        $events .= '|onpagehide|onpageshow|onautocomplete|onautocompleteerror|oncanplay|oncanplaythrough|onclose|oncuechange|ondurationchange|onemptied|onended|oninvalid|onloadeddata';\n        $events .= '|onloadedmetadata|onloadstart|onpause|onplay|onplaying|onpopstate|onprogress|onratechange|onreset|onseeked|onseeking|onshow|onsort|onstalled|onstorage|onsuspend|ontimeupdate';\n        $events .= '|ontoggle|onvolumechange|onwaiting';\n\n        if (preg_match('/<[\\s]*script/ims', $html) || preg_match($eventAttributeRegex, $html) || preg_match('/(' . $events . ')[\\s]*=/ims', $html) || preg_match('/.*script\\:/ims', $html)) {\n            return false;\n        }\n\n        if (!$allow_iframe && preg_match('/<[\\s]*(i?frame|form|input|embed|object)/ims', $html)) {\n            return false;\n        }\n\n        // RLO characters detection\n        $rloCharacters = \"\\xE2\\x80\\xAE\";\n\n        // Check if the RLO character is in the string\n        if (strpos($html, $rloCharacters) !== false) {\n            // RLO character found, potential RLO attack\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Check for product reference validity.\n     *\n     * @param string $reference Product reference to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isReference($reference)\n    {\n        return preg_match('/^[^<>;={}]*$/u', $reference);\n    }\n\n    /**\n     * Check if the password score is valid\n     *\n     * @param string $password Password to validate\n     *\n     * @return bool Indicates whether the given string is a valid password\n     *\n     * @since 8.0.0\n     */\n    public static function isAcceptablePasswordScore(string $password): bool\n    {\n        $zxcvbn = new Zxcvbn();\n        $result = $zxcvbn->passwordStrength($password);\n        $minScore = Configuration::hasKey(PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_SCORE) ?\n                  Configuration::get(PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_SCORE) :\n                  PasswordPolicyConfiguration::PASSWORD_SAFELY_UNGUESSABLE;\n\n        return isset($result['score']) && $result['score'] >= $minScore;\n    }\n\n    /**\n     * Check if password length is valid\n     *\n     * @param string $password Password to validate\n     *\n     * @return bool Indicates whether the given string is a valid password length\n     *\n     * @since 8.0.0\n     */\n    public static function isAcceptablePasswordLength(string $password): bool\n    {\n        $passwordLength = Tools::strlen($password);\n        if (Configuration::hasKey(PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_LENGTH)\n            && Configuration::hasKey(PasswordPolicyConfiguration::CONFIGURATION_MAXIMUM_LENGTH)\n        ) {\n            return $passwordLength >= Configuration::get(PasswordPolicyConfiguration::CONFIGURATION_MINIMUM_LENGTH)\n                && $passwordLength <= Configuration::get(PasswordPolicyConfiguration::CONFIGURATION_MAXIMUM_LENGTH);\n        }\n\n        // If value doesn't exist in database, use default behavior check\n        return $passwordLength >= PasswordPolicyConfiguration::DEFAULT_MINIMUM_LENGTH && $passwordLength <= PasswordPolicyConfiguration::DEFAULT_MAXIMUM_LENGTH;\n    }\n\n    /**\n     * Check if plaintext password is valid\n     * Size is limited by `password_hash()` (72 chars).\n     *\n     * @param string $plaintextPasswd Password to validate\n     * @param int $size\n     *\n     * @return bool Indicates whether the given string is a valid plaintext password\n     *\n     * @since 1.7.0\n     * @deprecated since 8.0, use Validate::isAcceptablePasswordLength instead\n     */\n    public static function isPlaintextPassword($plaintextPasswd, $size = Validate::PASSWORD_LENGTH)\n    {\n        // The password length is limited by `password_hash()`\n        return Tools::strlen($plaintextPasswd) >= $size && Tools::strlen($plaintextPasswd) <= 72;\n    }\n\n    /**\n     * Check if hashed password is valid\n     * PrestaShop supports both MD5 and `PASSWORD_BCRYPT` (PHP API)\n     * The lengths are 32 (MD5) or 60 (`PASSWORD_BCRYPT`)\n     * Anything else is invalid.\n     *\n     * @param string $hashedPasswd Password to validate\n     *\n     * @return bool Indicates whether the given string is a valid hashed password\n     *\n     * @since 1.7.0\n     */\n    public static function isHashedPassword($hashedPasswd)\n    {\n        return Tools::strlen($hashedPasswd) == 32 || Tools::strlen($hashedPasswd) == 60;\n    }\n\n    /**\n     * @deprecated since 8.0\n     */\n    public static function isPasswdAdmin($passwd)\n    {\n        return Validate::isPlaintextPassword($passwd, Validate::ADMIN_PASSWORD_LENGTH);\n    }\n\n    /**\n     * Check for configuration key validity.\n     *\n     * @param string $config_name Configuration key to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isConfigName($config_name)\n    {\n        return preg_match('/^[a-zA-Z_0-9-]+$/', $config_name);\n    }\n\n    /**\n     * Check date formats like http://php.net/manual/en/function.date.php.\n     *\n     * @param string $date_format date format to check\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPhpDateFormat($date_format)\n    {\n        // We can't really check if this is valid or not, because this is a string and you can write whatever you want in it.\n        // That's why only < et > are forbidden (HTML)\n        return preg_match('/^[^<>]+$/', $date_format);\n    }\n\n    /**\n     * Check for date format.\n     *\n     * @param string $date Date to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isDateFormat($date)\n    {\n        return (bool) preg_match('/^([0-9]{4})-((0?[0-9])|(1[0-2]))-((0?[0-9])|([1-2][0-9])|(3[01]))( [0-9]{2}:[0-9]{2}:[0-9]{2})?$/', $date);\n    }\n\n    /**\n     * Check for date validity.\n     *\n     * @param string $date Date to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isDate($date)\n    {\n        if (!preg_match('/^([0-9]{4})-((?:0?[0-9])|(?:1[0-2]))-((?:0?[0-9])|(?:[1-2][0-9])|(?:3[01]))( [0-9]{2}:[0-9]{2}:[0-9]{2})?$/', $date, $matches)) {\n            return false;\n        }\n\n        return checkdate((int) $matches[2], (int) $matches[3], (int) $matches[1]);\n    }\n\n    public static function isDateOrNull($date)\n    {\n        if (null === $date || $date === '0000-00-00 00:00:00' || $date === '0000-00-00') {\n            return true;\n        }\n\n        return self::isDate($date);\n    }\n\n    /**\n     * Check for birthDate validity. To avoid year in two digits, disallow date < 200 years ago\n     *\n     * @param string $date birthdate to validate\n     * @param string $format optional format\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isBirthDate($date, $format = 'Y-m-d')\n    {\n        if (empty($date) || $date == '0000-00-00') {\n            return true;\n        }\n\n        $d = DateTime::createFromFormat($format, $date);\n        if (!empty(DateTime::getLastErrors()['warning_count']) || false === $d) {\n            return false;\n        }\n        $twoHundredYearsAgo = new Datetime();\n        $twoHundredYearsAgo->sub(new DateInterval('P200Y'));\n\n        return $d->setTime(0, 0, 0) <= new Datetime() && $d->setTime(0, 0, 0) >= $twoHundredYearsAgo;\n    }\n\n    /**\n     * Check for boolean validity.\n     *\n     * @param mixed $bool Value to validate as a boolean\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isBool($bool)\n    {\n        return $bool === null || is_bool($bool) || preg_match('/^(0|1)$/', $bool);\n    }\n\n    /**\n     * Check for phone number validity.\n     *\n     * @param string $number Phone number to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPhoneNumber($number)\n    {\n        return preg_match('/^[+0-9. ()\\/-]*$/', $number);\n    }\n\n    /**\n     * Check for barcode validity (EAN-13).\n     *\n     * @param string $ean13 Barcode to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isEan13($ean13)\n    {\n        return !$ean13 || preg_match('/^[0-9]{0,13}$/', $ean13);\n    }\n\n    /**\n     * Check for ISBN.\n     *\n     * @param string $isbn validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isIsbn($isbn)\n    {\n        return !$isbn || preg_match(Isbn::VALID_PATTERN, $isbn);\n    }\n\n    /**\n     * Check for barcode validity (UPC).\n     *\n     * @param string $upc Barcode to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUpc($upc)\n    {\n        return !$upc || preg_match('/^[0-9]{0,12}$/', $upc);\n    }\n\n    /**\n     * Check for MPN validity.\n     *\n     * @param string $mpn to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isMpn($mpn)\n    {\n        return Tools::strlen($mpn) <= 40;\n    }\n\n    /**\n     * Check for postal code validity.\n     *\n     * @param string $postcode Postal code to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPostCode($postcode)\n    {\n        return empty($postcode) || preg_match('/^[a-zA-Z 0-9-]+$/', $postcode);\n    }\n\n    /**\n     * Check for zip code format validity.\n     *\n     * @param string $zip_code zip code format to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isZipCodeFormat($zip_code)\n    {\n        if (!empty($zip_code)) {\n            return preg_match('/^[NLCnlc 0-9-]+$/', $zip_code);\n        }\n\n        return true;\n    }\n\n    /**\n     * Check for table or identifier validity\n     * Mostly used in database for ordering : ASC / DESC.\n     *\n     * @param string $way Keyword to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isOrderWay($way)\n    {\n        return !empty($way) && in_array(strtolower($way), ['asc', 'desc', 'random']);\n    }\n\n    /**\n     * Check for table or identifier validity\n     * Mostly used in database for ordering : ORDER BY field.\n     *\n     * @param string $order Field to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isOrderBy($order)\n    {\n        return !empty($order) && preg_match(static::ORDER_BY_REGEXP, $order);\n    }\n\n    /**\n     * Check for table or identifier validity\n     * Mostly used in database for table names and id_table.\n     *\n     * @param string $table Table/identifier to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTableOrIdentifier($table)\n    {\n        return preg_match('/^[a-zA-Z0-9_-]+$/', $table);\n    }\n\n    /**\n     * Check for tags list validity.\n     *\n     * @param string $list List to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTagsList($list)\n    {\n        return preg_match('/^[^!<>;?=+#\"\u00b0{}_$%]*$/u', $list);\n    }\n\n    /**\n     * Check for product visibility.\n     *\n     * @param string $s visibility to check\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isProductVisibility($s)\n    {\n        return preg_match('/^both|catalog|search|none$/i', $s);\n    }\n\n    /**\n     * Check for an integer validity.\n     *\n     * @param int|bool $value Integer to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isInt($value)\n    {\n        return (string) (int) $value === (string) $value || $value === false;\n    }\n\n    /**\n     * Check for an integer validity (unsigned).\n     *\n     * @param mixed $value Integer to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUnsignedInt($value)\n    {\n        return (is_numeric($value) || is_string($value))\n            && (string) (int) $value === (string) $value\n            && $value < (static::MYSQL_UNSIGNED_INT_MAX + 1)\n            && $value >= 0;\n    }\n\n    /**\n     * Check for a number (int) bigger than 0\n     *\n     * @param mixed $value Integer with value bigger than 0 to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPositiveInt($value)\n    {\n        return self::isUnsignedInt($value) && $value > 0;\n    }\n\n    /**\n     * Check for an percentage validity (between 0 and 100).\n     *\n     * @param float $value Float to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPercentage($value)\n    {\n        return Validate::isFloat($value) && $value >= 0 && $value <= 100;\n    }\n\n    /**\n     * Check for an integer validity (unsigned)\n     * Mostly used in database for auto-increment.\n     *\n     * @param int $id Integer to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUnsignedId($id)\n    {\n        return Validate::isUnsignedInt($id); /* Because an id could be equal to zero when there is no association */\n    }\n\n    public static function isNullOrUnsignedId($id)\n    {\n        return $id === null || Validate::isUnsignedId($id);\n    }\n\n    /**\n     * Check object validity.\n     *\n     * @param object $object Object to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLoadedObject($object)\n    {\n        return is_object($object) && $object->id;\n    }\n\n    /**\n     * Check color validity.\n     *\n     * @param string $color Color to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isColor($color)\n    {\n        return preg_match('/^(#[0-9a-fA-F]{6}|[a-zA-Z0-9-]*)$/', $color);\n    }\n\n    /**\n     * Check url validity (disallowed empty string).\n     *\n     * @param string $url Url to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUrl($url)\n    {\n        return preg_match('/^[~:#,$%&_=\\(\\)\\.\\? \\+\\-@\\/a-zA-Z0-9\\pL\\pS-]+$/u', $url);\n    }\n\n    /**\n     * Check tracking number validity (disallowed empty string).\n     *\n     * @param string $tracking_number Tracking number to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTrackingNumber($tracking_number)\n    {\n        return preg_match('/^[~:#,%&_=\\(\\)\\[\\]\\.\\? \\+\\-@\\/a-zA-Z0-9]+$/', $tracking_number);\n    }\n\n    /**\n     * Check url validity (allowed empty string).\n     *\n     * @param string $url Url to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isUrlOrEmpty($url)\n    {\n        return empty($url) || Validate::isUrl($url);\n    }\n\n    /**\n     * Check if URL is absolute.\n     *\n     * @param string $url URL to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isAbsoluteUrl($url)\n    {\n        if (!empty($url)) {\n            return preg_match('/^(https?:)?\\/\\/[$~:;#,%&_=\\(\\)\\[\\]\\.\\? \\+\\-@\\/a-zA-Z0-9]+$/', $url);\n        }\n\n        return true;\n    }\n\n    public static function isMySQLEngine($engine)\n    {\n        return in_array($engine, ['InnoDB', 'MyISAM']);\n    }\n\n    public static function isUnixName($data)\n    {\n        return preg_match('/^[a-z0-9\\._-]+$/ui', $data);\n    }\n\n    public static function isTablePrefix($data)\n    {\n        // Even if \"-\" is theorically allowed, it will be considered a syntax error if you do not add backquotes (`) around the table name\n        return preg_match('/^[a-z0-9_]+$/ui', $data);\n    }\n\n    /**\n     * Check for standard name file validity.\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isFileName($name)\n    {\n        return preg_match('/^[a-zA-Z0-9_.-]+$/', $name);\n    }\n\n    /**\n     * Check for standard name directory validity.\n     *\n     * @param string $dir Directory to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isDirName($dir)\n    {\n        return (bool) preg_match('/^[a-zA-Z0-9_.-]*$/', $dir);\n    }\n\n    /**\n     * Check for admin panel tab name validity.\n     *\n     * @param string $name Name to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isTabName($name)\n    {\n        return preg_match('/^[^<>]+$/u', $name);\n    }\n\n    public static function isWeightUnit($unit)\n    {\n        return Validate::isGenericName($unit) & (Tools::strlen($unit) < 5);\n    }\n\n    public static function isDistanceUnit($unit)\n    {\n        return Validate::isGenericName($unit) & (Tools::strlen($unit) < 5);\n    }\n\n    public static function isSubDomainName($domain)\n    {\n        return preg_match('/^[a-zA-Z0-9-_]*$/', $domain);\n    }\n\n    public static function isVoucherDescription($text)\n    {\n        return preg_match('/^([^<>{}]|<br \\/>)*$/i', $text);\n    }\n\n    /**\n     * Check if the value is a sort direction value (DESC/ASC).\n     *\n     * @param string $value\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isSortDirection($value)\n    {\n        return $value === 'ASC' || $value === 'DESC';\n    }\n\n    /**\n     * Customization fields' label validity.\n     *\n     * @param string $label\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLabel($label)\n    {\n        return preg_match('/^[^{}<>]*$/u', $label);\n    }\n\n    /**\n     * Price display method validity.\n     *\n     * @param int $data Data to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isPriceDisplayMethod($data)\n    {\n        return $data == PS_TAX_EXC || $data == PS_TAX_INC;\n    }\n\n    /**\n     * @param string $dni to validate\n     *\n     * @return bool\n     */\n    public static function isDniLite($dni)\n    {\n        return empty($dni) || (bool) preg_match('/^[0-9A-Za-z-.]{1,16}$/U', $dni);\n    }\n\n    /**\n     * Check if $data is a PrestaShop cookie object.\n     *\n     * @param mixed $data to validate\n     *\n     * @return bool\n     */\n    public static function isCookie($data)\n    {\n        return is_object($data) && get_class($data) == 'Cookie';\n    }\n\n    /**\n     * Check if $data is a string.\n     *\n     * @param string $data Data to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isString($data)\n    {\n        return is_string($data);\n    }\n\n    /**\n     * Check if the data is a reduction type (amout or percentage).\n     *\n     * @param string $data Data to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isReductionType($data)\n    {\n        return $data === 'amount' || $data === 'percentage';\n    }\n\n    /**\n     * Check for bool_id.\n     *\n     * @param string $ids\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isBoolId($ids)\n    {\n        return (bool) preg_match('#^[01]_[0-9]+$#', $ids);\n    }\n\n    /**\n     * Check the localization pack part selected.\n     *\n     * @param string $data Localization pack to check\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLocalizationPackSelection($data)\n    {\n        return in_array((string) $data, ['states', 'taxes', 'currencies', 'languages', 'units', 'groups']);\n    }\n\n    /**\n     * Check for PHP serialized data.\n     *\n     * @param string|null $data Serialized data to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isSerializedArray($data)\n    {\n        return $data === null || (is_string($data) && preg_match('/^a:[0-9]+:{.*;}$/s', $data));\n    }\n\n    /**\n     * Check if $string is a valid JSON string.\n     *\n     * @param string $string JSON string to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isJson($string)\n    {\n        json_decode($string);\n\n        return json_last_error() == JSON_ERROR_NONE;\n    }\n\n    /**\n     * Check for Latitude/Longitude.\n     *\n     * @param string|null $data Coordinate to validate\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isCoordinate($data)\n    {\n        return $data === null || preg_match('/^\\-?[0-9]{1,8}\\.[0-9]{1,8}$/s', $data);\n    }\n\n    /**\n     * Check for Language Iso Code.\n     *\n     * @param string $iso_code\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLangIsoCode($iso_code)\n    {\n        return (bool) preg_match('/^[a-zA-Z]{2,3}$/s', $iso_code);\n    }\n\n    /**\n     * Check for Language File Name.\n     *\n     * @param string $file_name\n     *\n     * @return bool Validity is ok or not\n     */\n    public static function isLanguageFileName($file_name)\n    {\n        return (bool) preg_match('/^[a-zA-Z]{2,3}\\.(?:gzip|tar\\.gz)$/s', $file_name);\n    }\n\n    /**\n     * @param array $ids\n     *\n     * @return bool return true if the array contain only unsigned int value and not empty\n     */\n    public static function isArrayWithIds($ids)\n    {\n        if (!is_array($ids) || count($ids) < 1) {\n            return false;\n        }\n\n        foreach ($ids as $id) {\n            if ($id == 0 || !Validate::isUnsignedInt($id)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    /**\n     * @param array $stock_management\n     *\n     * @return bool return true if is a valide stock management\n     */\n    public static function isStockManagement($stock_management)\n    {\n        if (!in_array($stock_management, ['WA', 'FIFO', 'LIFO'])) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Validate SIRET Code.\n     *\n     * @param string $siret SIRET Code\n     *\n     * @return bool Return true if is valid\n     */\n    public static function isSiret($siret)\n    {\n        if (Tools::strlen($siret) != 14) {\n            return false;\n        }\n        $sum = 0;\n        for ($i = 0; $i != 14; ++$i) {\n            $tmp = ((($i + 1) % 2) + 1) * (int) ($siret[$i]);\n            if ($tmp >= 10) {\n                $tmp -= 9;\n            }\n            $sum += $tmp;\n        }\n\n        return $sum % 10 === 0;\n    }\n\n    /**\n     * Validate APE Code.\n     *\n     * @param string $ape APE Code\n     *\n     * @return bool Return true if is valid\n     */\n    public static function isApe($ape)\n    {\n        return (bool) preg_match(ApeCode::PATTERN, $ape);\n    }\n\n    public static function isControllerName($name)\n    {\n        return (bool) (is_string($name) && preg_match('/^[0-9a-zA-Z-_]*$/u', $name));\n    }\n\n    public static function isPrestaShopVersion($version)\n    {\n        return preg_match('/^[0-1]\\.[0-9]{1,2}(\\.[0-9]{1,2}){0,2}$/', $version) && ip2long($version);\n    }\n\n    public static function isOrderInvoiceNumber($id)\n    {\n        return preg_match('/^(?:' . Configuration::get('PS_INVOICE_PREFIX', Context::getContext()->language->id) . ')\\s*([0-9]+)$/i', $id);\n    }\n\n    public static function isThemeName($theme_name)\n    {\n        return (bool) preg_match('/^[\\w-]{3,255}$/u', $theme_name);\n    }\n\n    /**\n     * Check if enable_insecure_rsh exists in\n     * this PHP version otherwise disable the\n     * oProxyCommand option.\n     *\n     * @return bool\n     */\n    public static function isValidImapUrl($imapUrl)\n    {\n        if (false === ini_get('imap.enable_insecure_rsh')) {\n            return preg_match('~^((?!oProxyCommand).)*$~i', $imapUrl);\n        }\n\n        return true;\n    }\n\n    /**\n     * Check the given string is a valid PHP class name\n     *\n     * @param string $objectClassName object class name\n     *\n     * @return bool\n     */\n    public static function isValidObjectClassName(string $objectClassName): bool\n    {\n        return preg_match(static::OBJECT_CLASS_NAME_REGEXP, $objectClassName);\n    }\n}\n", "/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\nvar ajax_running_timeout = null;\n\nif (!id_language)\n  var id_language = Number(1);\n\nfunction str2url(str, encoding, ucfirst)\n{\n  str = str.toUpperCase();\n  str = str.toLowerCase();\n  if (PS_ALLOW_ACCENTED_CHARS_URL)\n    str = str.replace(/[^a-z0-9\\s\\'\\:\\/\\[\\]-]\\\\u00A1-\\\\uFFFF/g,'');\n  else\n  {\n\n    /* Lowercase */\n    str = str.replace(/[\\u00E0\\u00E1\\u00E2\\u00E3\\u00E5\\u0101\\u0103\\u0105\\u0430\\u1EA7\\u1EA3\\u1EA1\\u1EAF\\u1EB1\\u1EB3\\u1EB5\\u1EB7\\u1EA5\\u1EA9\\u1EAB\\u1EAD]/g, 'a');\n    str = str.replace(/[\\u0431]/g, 'b');\n    str = str.replace(/[\\u00E7\\u0107\\u0109\\u010D\\u0446]/g, 'c');\n    str = str.replace(/[\\u010F\\u0111\\u0434]/g, 'd');\n    str = str.replace(/[\\u00E8\\u00E9\\u00EA\\u00EB\\u0113\\u0115\\u0117\\u0119\\u011B\\u0435\\u044D\\u1EC7\\u1EBB\\u1EBD\\u1EB9\\u1EBF\\u1EC1\\u1EC3\\u1EC5]/g, 'e');\n    str = str.replace(/[\\u0444]/g, 'f');\n    str = str.replace(/[\\u011F\\u0121\\u0123\\u0433\\u0491]/g, 'g');\n    str = str.replace(/[\\u0125\\u0127]/g, 'h');\n    str = str.replace(/[\\u00EC\\u00ED\\u00EE\\u00EF\\u0129\\u012B\\u012D\\u012F\\u0131\\u0438\\u0456\\u1EC9\\u1ECB]/g, 'i');\n    str = str.replace(/[\\u0135\\u0439]/g, 'j');\n    str = str.replace(/[\\u0137\\u0138\\u043A]/g, 'k');\n    str = str.replace(/[\\u013A\\u013C\\u013E\\u0140\\u0142\\u043B]/g, 'l');\n    str = str.replace(/[\\u043C]/g, 'm');\n    str = str.replace(/[\\u00F1\\u0144\\u0146\\u0148\\u0149\\u014B\\u043D]/g, 'n');\n    str = str.replace(/[\\u00F2\\u00F3\\u00F4\\u00F5\\u00F8\\u014D\\u014F\\u0151\\u043E\\u01A1]/g, 'o');\n    str = str.replace(/[\\u043F]/g, 'p');\n    str = str.replace(/[\\u0155\\u0157\\u0159\\u0440]/g, 'r');\n    str = str.replace(/[\\u015B\\u015D\\u015F\\u0161\\u0441]/g, 's');\n    str = str.replace(/[\\u00DF]/g, 'ss');\n    str = str.replace(/[\\u0163\\u0165\\u0167\\u0442]/g, 't');\n    str = str.replace(/[\\u00F9\\u00FA\\u00FB\\u0169\\u016B\\u016D\\u016F\\u0171\\u0173\\u0443\\u1EED]/g, 'u');\n    str = str.replace(/[\\u0432]/g, 'v');\n    str = str.replace(/[\\u0175]/g, 'w');\n    str = str.replace(/[\\u00FF\\u0177\\u00FD\\u044B]/g, 'y');\n    str = str.replace(/[\\u017A\\u017C\\u017E\\u0437]/g, 'z');\n    str = str.replace(/[\\u00E4\\u00E6]/g, 'ae');\n    str = str.replace(/[\\u0447]/g, 'ch');\n    str = str.replace(/[\\u0445]/g, 'kh');\n    str = str.replace(/[\\u0153\\u00F6]/g, 'oe');\n    str = str.replace(/[\\u00FC]/g, 'ue');\n    str = str.replace(/[\\u0448]/g, 'sh');\n    str = str.replace(/[\\u0449]/g, 'ssh');\n    str = str.replace(/[\\u044F]/g, 'ya');\n    str = str.replace(/[\\u0454]/g, 'ye');\n    str = str.replace(/[\\u0457]/g, 'yi');\n    str = str.replace(/[\\u0451]/g, 'yo');\n    str = str.replace(/[\\u044E]/g, 'yu');\n    str = str.replace(/[\\u0436]/g, 'zh');\n\n    /* Uppercase */\n    str = str.replace(/[\\u0100\\u0102\\u0104\\u00C0\\u00C1\\u00C2\\u00C3\\u00C4\\u00C5\\u0410\\u1EA2\\u1EA0\\u1EAE\\u1EB0\\u1EB2\\u1EB4\\u1EB6\\u1EA4\\u1EA6\\u1EA8\\u1EAA\\u1EAC]/g, 'A');\n    str = str.replace(/[\\u0411]/g, 'B');\n    str = str.replace(/[\\u00C7\\u0106\\u0108\\u010A\\u010C\\u0426]/g, 'C');\n    str = str.replace(/[\\u010E\\u0110\\u0414]/g, 'D');\n    str = str.replace(/[\\u00C8\\u00C9\\u00CA\\u00CB\\u0112\\u0114\\u0116\\u0118\\u011A\\u0415\\u042D\\u1EBA\\u1EBC\\u1EB8\\u1EBE\\u1EC0\\u1EC2\\u1EC4\\u1EC6]/g, 'E');\n    str = str.replace(/[\\u0424]/g, 'F');\n    str = str.replace(/[\\u011C\\u011E\\u0120\\u0122\\u0413\\u0490]/g, 'G');\n    str = str.replace(/[\\u0124\\u0126]/g, 'H');\n    str = str.replace(/[\\u0128\\u012A\\u012C\\u012E\\u0130\\u0418\\u0406\\u00CD\\u00CC\\u1EC8\\u1ECA]/g, 'I');\n    str = str.replace(/[\\u0134\\u0419]/g, 'J');\n    str = str.replace(/[\\u0136\\u041A]/g, 'K');\n    str = str.replace(/[\\u0139\\u013B\\u013D\\u0141\\u041B]/g, 'L');\n    str = str.replace(/[\\u041C]/g, 'M');\n    str = str.replace(/[\\u00D1\\u0143\\u0145\\u0147\\u014A\\u041D]/g, 'N');\n    str = str.replace(/[\\u00D3\\u014C\\u014E\\u0150\\u041E]/g, 'O');\n    str = str.replace(/[\\u041F]/g, 'P');\n    str = str.replace(/[\\u0154\\u0156\\u0158\\u0420]/g, 'R');\n    str = str.replace(/[\\u015A\\u015C\\u015E\\u0160\\u0421]/g, 'S');\n    str = str.replace(/[\\u0162\\u0164\\u0166\\u0422]/g, 'T');\n    str = str.replace(/[\\u00D9\\u00DA\\u00DB\\u0168\\u016A\\u016C\\u016E\\u0170\\u0172\\u0423]/g, 'U');\n    str = str.replace(/[\\u0412]/g, 'V');\n    str = str.replace(/[\\u0174]/g, 'W');\n    str = str.replace(/[\\u0176\\u042B]/g, 'Y');\n    str = str.replace(/[\\u0179\\u017B\\u017D\\u0417]/g, 'Z');\n    str = str.replace(/[\\u00C4\\u00C6]/g, 'AE');\n    str = str.replace(/[\\u0427]/g, 'CH');\n    str = str.replace(/[\\u0425]/g, 'KH');\n    str = str.replace(/[\\u0152\\u00D6]/g, 'OE');\n    str = str.replace(/[\\u00DC]/g, 'UE');\n    str = str.replace(/[\\u0428]/g, 'SH');\n    str = str.replace(/[\\u0429]/g, 'SHH');\n    str = str.replace(/[\\u042F]/g, 'YA');\n    str = str.replace(/[\\u0404]/g, 'YE');\n    str = str.replace(/[\\u0407]/g, 'YI');\n    str = str.replace(/[\\u0401]/g, 'YO');\n    str = str.replace(/[\\u042E]/g, 'YU');\n    str = str.replace(/[\\u0416]/g, 'ZH');\n\n    str = str.toLowerCase();\n\n    str = str.replace(/[^a-z0-9\\s\\'\\:\\/\\[\\]-]/g,'');\n  }\n  str = str.replace(/[\\u0028\\u0029\\u0021\\u003F\\u002E\\u0026\\u005E\\u007E\\u002B\\u002A\\u002F\\u003A\\u003B\\u003C\\u003D\\u003E]/g, '');\n  str = str.replace(/[\\s\\'\\:\\/\\[\\]-]+/g, ' ');\n\n  // Add special char not used for url rewrite\n  str = str.replace(/[ ]/g, '-');\n  str = str.replace(/[\\/\\\\\"'|,;%]*/g, '');\n\n  if (ucfirst == 1) {\n    var first_char = str.charAt(0);\n    str = first_char.toUpperCase()+str.slice(1);\n  }\n\n  return str;\n}\n\nfunction copy2friendlyURL()\n{\n  if (typeof($('#link_rewrite_' + id_language).val()) == 'undefined')\n    return;\n  if (typeof(id_product) == 'undefined')\n    id_product = false;\n\n  if (ps_force_friendly_product || !$('#link_rewrite_' + id_language).val().length || !id_product)//check if user didn't type anything in rewrite field, to prevent overwriting\n  {\n    $('#link_rewrite_' + id_language).val(str2url($.trim($('#name_' + id_language).val().replace(/^[0-9]+\\./, ''), 'UTF-8').replace('%', '')));\n    if ($('#friendly-url'))\n      $('#friendly-url').html($('#link_rewrite_' + id_language).val());\n    // trigger onchange event to use anything binded there\n    $('#link_rewrite_' + id_language).change();\n  }\n  return;\n}\n\nfunction copyMeta2friendlyURL()\n{\n  if (!$('input[name=\"id_cms\"]').length)\n    $('#link_rewrite_' + id_language).val(str2url($('#name_' + id_language).val().replace(/^[0-9]+\\./, ''), 'UTF-8'));\n}\n\nfunction updateCurrentText()\n{\n  $('#current_product').html($('#name_' + id_language).val());\n}\n\nfunction updateFriendlyURLByName()\n{\n  $('#link_rewrite_' + id_language).val(str2url($('#name_' + id_language).val(), 'UTF-8'));\n  $('#friendly-url_' + id_language).html($('#link_rewrite_' + id_language).val());\n}\n\nfunction updateFriendlyURL()\n{\n  var link = $('#link_rewrite_' + id_language);\n  if (link[0])\n  {\n    $('#friendly-url_' + id_language).text(str2url($('#link_rewrite_' + id_language).val(), 'UTF-8'));\n  }\n}\n\nfunction updateLinkRewrite()\n{\n  $('#name_' + id_language).val($.trim($('#name_' + id_language).val()));\n  $('#link_rewrite_' + id_language).val($.trim($('#link_rewrite_' + id_language).val()));\n  var link = $('#link_rewrite_' + id_language);\n  if (link[0])\n  {\n    link.val(str2url(link.val(), 'UTF-8'));\n    $('#friendly-url_' + id_language).text(link.val());\n  }\n}\n\nfunction toggleLanguageFlags(elt)\n{\n  $(elt).parents('.displayed_flag').siblings('.language_flags').toggle();\n}\n\n// Kept for retrocompatibility only (out of AdminProducts & AdminCategories)\nfunction changeLanguage(field, fieldsString, id_language_new, iso_code)\n{\n    $('div[id^='+field+'_]').hide();\n  var fields = fieldsString.split('\u00a4');\n  for (var i = 0; i < fields.length; ++i)\n  {\n    $('div[id^='+fields[i]+'_]').hide();\n    $('#'+fields[i]+'_'+id_language_new).show();\n    $('#'+'language_current_'+fields[i]).attr('src', '../img/l/' + id_language_new + '.jpg');\n  }\n  $('#languages_' + field).hide();\n  id_language = id_language_new;\n}\n\n// kept for retrocompatibility - you should use hideOtherLanguage(id) since 1.6\nfunction changeFormLanguage(id_language_new, iso_code, employee_cookie)\n{\n  $('.translatable').each(function() {\n    $(this).find('.lang_' + id_language_new)\n      .show()\n      .siblings('div:not(.displayed_flag):not(.clear)').hide();\n    $(this).find('.language_current').attr('src', '../img/l/' + id_language_new + '.jpg');\n  });\n\n  // For multishop checkboxes\n  $('.multishop_lang_'+id_language_new).show().siblings('div[class^=\\'multishop_lang_\\']').hide();\n  id_language = id_language_new;\n  changeEmployeeLanguage();\n  updateCurrentText();\n}\n\nfunction displayFlags(languages, defaultLanguageID, employee_cookie)\n{\n  if ($('.translatable'))\n  {\n    $('.translatable').each(function() {\n      if (!$(this).find('.displayed_flag').length > 0) {\n        $.each(languages, function(key, language) {\n          if (language['id_lang'] == defaultLanguageID)\n          {\n            defaultLanguage = language;\n            return false;\n          }\n        });\n        var displayFlags = $('<div></div>')\n          .addClass('displayed_flag')\n          .append($('<img>')\n            .addClass('language_current')\n            .addClass('pointer')\n            .attr('src', '../img/l/' + defaultLanguage['id_lang'] + '.jpg')\n            .attr('alt', defaultLanguage['name'])\n            .click(function() {\n              toggleLanguageFlags(this);\n            })\n          );\n        var languagesFlags = $('<div></div>')\n          .addClass('language_flags')\n          .html(choose_language_translate+':<br /><br />');\n        $.each(languages, function(key, language) {\n          var img = $('<img>')\n            .addClass('pointer')\n            .css('margin', '2px 2px')\n            .attr('src', '../img/l/' + language['id_lang'] + '.jpg')\n            .attr('alt', language['name'])\n            .click(function() {\n              changeFormLanguage(language['id_lang'], language['iso_code'], employee_cookie);\n            });\n          languagesFlags.append(img);\n        });\n        if ($(this).find('p:last-child').hasClass('clear'))\n          $(this).find('p:last-child').before(displayFlags).before(languagesFlags);\n        else\n          $(this).append(displayFlags).append(languagesFlags);\n      }\n    });\n  }\n}\n\nfunction checkAll(pForm)\n{\n  for (i = 0, n = pForm.elements.length; i < n; i++)\n  {\n    var objName = pForm.elements[i].name;\n    var objType = pForm.elements[i].type;\n    if (objType == 'checkbox' && objName != 'checkme')\n    {\n      box = eval(pForm.elements[i]);\n      box.checked = !box.checked;\n    }\n  }\n}\n\nfunction checkDelBoxes(pForm, boxName, parent)\n{\n  for (i = 0; i < pForm.elements.length; i++)\n    if (pForm.elements[i].name == boxName)\n      pForm.elements[i].checked = parent;\n}\n\nfunction checkPaymentBoxes(name, module)\n{\n  setPaymentBoxes(name, module);\n  current = $('input#checkedBox_'+ name +'_'+ module + '[type=hidden]');\n  $('form#form_'+ name +' input[type=checkbox]').each(\n    function()\n    {\n      if ($(this).attr('name') == module + '_' + name + '[]')\n        $(this).attr(\"checked\", ((current.val() == 'checked') ? true : false));\n    }\n  );\n  current.val() == 'checked' ? current.val('unchecked') : current.val('checked');\n}\n\nfunction setPaymentBoxes(name, module)\n{\n  current = $('input#checkedBox_'+ name +'_'+ module + '[type=hidden]');\n  total = 0;\n  checked = 0;\n  $('form#form_'+ name +' input[type=checkbox]').each(\n    function()\n    {\n      if ($(this).attr('name') == module + '_' + name + '[]')\n      {\n        ($(this).attr(\"checked\") ? checked++ : '');\n        total++;\n      }\n    }\n  );\n  (checked == total) ? current.val('unchecked') : current.val('checked');\n}\n\nfunction getE(name)\n{\n  if (document.getElementById)\n    var elem = document.getElementById(name);\n  else if (document.all)\n    var elem = document.all[name];\n  else if (document.layers)\n    var elem = document.layers[name];\n  return elem;\n}\n\nfunction formSubmit(e, button)\n{\n  var key;\n\n  key = window.event ? window.event.keyCode : e.which;\n  if (key == 13)\n  {\n    getE(button).focus();\n    getE(button).click();\n    e.preventDefault();\n  }\n}\nfunction noComma(elem)\n{\n  getE(elem).value = getE(elem).value.replace(new RegExp(',', 'g'), '.');\n}\n\n/* Code generator for Affiliation and vouchers */\nfunction gencode(size)\n{\n  getE('code').value = '';\n  /* There are no O/0 in the codes in order to avoid confusion */\n  var chars = \"123456789ABCDEFGHIJKLMNPQRSTUVWXYZ\";\n  var randomNumbers = crypto.getRandomValues(new Uint32Array(size));\n  for (var i = 1; i <= size; ++i) {\n    getE('code').value += chars.charAt(Math.floor(randomNumbers[i]/2**32 * chars.length));\n  }\n\n  getE('cart-rules-highlight').style.display = '';\n}\n\nvar tpl_viewing_window = null;\nfunction viewTemplates(id_select, lang, ext)\n{\n  var loc = $(id_select).val();\n  if (loc != 0)\n  {\n    if (tpl_viewing_window != null && !tpl_viewing_window.closed)\n      tpl_viewing_window.close();\n    var url_preview = $(\"option[value=\"+loc+\"]\", id_select).data('preview');\n    tpl_viewing_window = window.open(url_preview + lang + loc + ext, 'tpl_viewing', 'toolbar=0,location=0,directories=0,statfr=no,menubar=0,scrollbars=yes,resizable=yes,width=520,height=400,top=50,left=300');\n    tpl_viewing_window.focus();\n  }\n}\n\nfunction orderDeleteProduct(txtConfirm, txtExplain)\n{\n  ret = true;\n  $('table#cancelProducts input[type=checkbox]:checked').each(\n    function()\n    {\n      totalCancel = parseInt($(this).parent().parent().find('td.cancelQuantity input[type=text]').val());\n      totalQty = parseInt($(this).parent().find('input#totalQty[type=hidden]').val());\n      totalQtyReturn = parseInt($(this).parent().find('input#totalQtyReturn[type=hidden]').val());\n      productName = $(this).parent().find('input#productName[type=hidden]').val();\n      totalAvailable = totalQty - totalQtyReturn;\n      if (totalCancel > totalAvailable)\n      {\n        jAlert(txtConfirm + ' : \\'' + ' ' + productName + '\\' ! \\n\\n' + txtExplain + ' ('+ totalCancel + ' > ' + totalAvailable +')' + '\\n ');\n        ret = false;\n      }\n    }\n  );\n  return ret;\n}\n\nfunction selectCheckbox(obj)\n{\n  $(obj).parent().parent().find('td.cancelCheck input[type=checkbox]').attr(\"checked\", true);\n}\n\nfunction toggleShippingCost()\n{\n  generateDiscount = $('#generateDiscount').attr(\"checked\");\n  generateCreditSlip = $('#generateCreditSlip').attr(\"checked\");\n  if (generateDiscount != 'checked' && generateCreditSlip != 'checked')\n  {\n    $('#spanShippingBack input[type=checkbox]').attr(\"checked\", false);\n    $('#spanShippingBack').css('display', 'none');\n  }\n  else\n    $('#spanShippingBack').css('display', 'block');\n}\n\nfunction orderOverwriteMessage(sl, text)\n{\n  var $zone = $('#txt_msg');\n  var sl_value = sl.options[sl.selectedIndex].value;\n\n  if (sl_value != '0')\n  {\n    if ($zone.val().length > 0 && !confirm(text))\n      return ;\n    $zone.val(sl_value);\n  }\n\n  $zone.trigger('autosize.resize');\n}\n\nfunction setCancelQuantity(itself, id_order_detail, quantity)\n{\n  $('#cancelQuantity_' + id_order_detail).val($(itself).prop('checked') ? quantity : '');\n}\n\nfunction stockManagementActivationAuthorization()\n{\n  if (getE('PS_STOCK_MANAGEMENT_on').checked)\n  {\n    getE('PS_ORDER_OUT_OF_STOCK_on').disabled = false;\n    getE('PS_ORDER_OUT_OF_STOCK_off').disabled = false;\n    getE('PS_DISPLAY_QTIES_on').disabled = false;\n    getE('PS_DISPLAY_QTIES_off').disabled = false;\n  }\n  else\n  {\n    getE('PS_DISPLAY_QTIES_off').checked = true;\n    getE('PS_DISPLAY_QTIES_on').disabled = 'disabled';\n    getE('PS_DISPLAY_QTIES_off').disabled = 'disabled';\n    getE('PS_ORDER_OUT_OF_STOCK_on').checked = true;\n    getE('PS_ORDER_OUT_OF_STOCK_on').disabled = 'disabled';\n    getE('PS_ORDER_OUT_OF_STOCK_off').disabled = 'disabled';\n    getE('PS_DEFAULT_WAREHOUSE_NEW_PRODUCT').disabled = 'disabled';\n  }\n}\n\nfunction hookCheckboxes(id, opt, champ)\n{\n  if (opt == 1 && champ.checked == false)\n    $('#Ghook'+id).attr('checked', false);\n  else if (opt == 0)\n  {\n    if (champ.checked)\n      $('.hook'+id).attr('checked', \"checked\");\n    else\n      $('.hook'+id).attr('checked', false);\n  }\n}\n\nfunction changeCMSActivationAuthorization()\n{\n  if (getE('PS_CONDITIONS_on').checked)\n    getE('PS_CONDITIONS_CMS_ID').disabled = false;\n  else\n    getE('PS_CONDITIONS_CMS_ID').disabled = 'disabled';\n}\n\nfunction disableZipFormat()\n{\n  if ($('#need_zip_code_on').prop('checked') == false)\n  {\n    $('.zip_code_format').hide();\n    $('#zip_code_format').val('');\n  }\n  else\n    $('.zip_code_format').show();\n}\n\nfunction disableTAASC()\n{\n  if ($('#iso_code').val() == 'US')\n    $('#TAASC').show();\n  else\n    $('#TAASC').hide();\n}\n\nfunction spreadFees(id_range)\n{\n  newVal = $('#fees_all_'+id_range).val().replace(/,/g, '.');\n  $('.fees_'+id_range).val(newVal);\n}\n\nfunction clearAllFees(id_range)\n{\n  $('#fees_all_'+id_range).val('');\n}\n\nfunction toggleDraftWarning(show)\n{\n  if (show)\n    $('.draft').hide();\n  else\n    $('.draft').show();\n}\n\nfunction showRedirectProductOptions(show)\n{\n  if (show)\n    $('.redirect_product_options').fadeIn();\n  else\n    $('.redirect_product_options').fadeOut();\n\n  redirectSelectChange();\n}\n\nfunction redirectSelectChange()\n{\n  redirectTypeValue = $('#redirect_type :selected').val();\n  if (redirectTypeValue == '404' ||\n      redirectTypeValue == '410' ||\n      redirectTypeValue == 'default' ||\n      redirectTypeValue == '200-displayed' ||\n      redirectTypeValue == '404-displayed' ||\n      redirectTypeValue == '410-displayed')\n    showRedirectProductSelectOptions(false);\n  else\n    showRedirectProductSelectOptions(true);\n}\n\nfunction addRelatedProduct(id_product_to_add, product_name)\n{\n  if (!id_product_to_add || id_product == id_product_to_add)\n    return;\n  $('#related_product_name').html(product_name);\n  $('input[name=id_type_redirected]').val(id_product_to_add);\n  $('#related_product_autocomplete_input').parent().hide();\n  $('#related_product_remove').show();\n}\n\nfunction removeRelatedProduct()\n{\n  $('#related_product_name').html(no_related_product);\n  $('input[name=id_type_redirected]').val(0);\n  $('#related_product_remove').hide();\n  $('#related_product_autocomplete_input').parent().fadeIn();\n}\n\nfunction showRedirectProductSelectOptions(show)\n{\n  if (show)\n    $('.redirect_product_options_product_choise').show();\n  else\n  {\n    $('.redirect_product_options_product_choise').hide();\n    removeRelatedProduct();\n  }\n\n}\n\nfunction showOptions(show)\n{\n  if (show)\n    $('tr#product_options').show();\n  else\n    $('tr#product_options').hide();\n}\n\nfunction submitAddProductAndPreview()\n{\n  $('#fakeSubmitAddProductAndPreview').attr('name','submitAddProductAndPreview');\n  $('#product_form').submit();\n}\n\nfunction submitAddcmsAndPreview()\n{\n  $('#previewSubmitAddcmsAndPreview').attr('name','submitAddcmsAndPreview');\n  $('#cms').submit();\n}\n\nfunction checkAllMultishopDefaultValue(item)\n{\n  $(item).parent().find('input[name^=\\'multishopOverrideOption\\']').each(function(k, v)\n  {\n    $(v).attr('checked', item.checked);\n    var name = $(v).attr('name');\n    checkMultishopDefaultValue(v, name.substr(24, name.length - 25));\n  })\n}\n\nfunction checkMultishopDefaultValue(obj, key)\n{\n  if (!$(obj).prop('checked') || $('#'+key).hasClass('isInvisible'))\n  {\n    $('#conf_id_'+key+' input, #conf_id_'+key+' textarea, #conf_id_'+key+' select, #conf_id_'+key+' button').prop('disabled', true);\n    $('#conf_id_'+key+' label.conf_title').addClass('isDisabled');\n    $(obj).prop('disabled', false);\n  }\n  else\n  {\n    $('#conf_id_'+key+' input, #conf_id_'+key+' textarea, #conf_id_'+key+' select, #conf_id_'+key+' button').prop('disabled', false);\n    $('#conf_id_'+key+' label.conf_title').removeClass('isDisabled');\n  }\n  $('#conf_id_'+key+' .preference_default_multishop input').prop('disabled', false);\n}\n\nfunction toggleAllMultishopDefaultValue($container, value)\n{\n  $container.find('input[name^=\\'multishopOverrideOption\\']').each(function(k, v)\n  {\n    $(v).attr('checked', value);\n    var name = $(v).attr('name');\n    toggleMultishopDefaultValue(v, name.substr(24, name.length - 25));\n  })\n}\n\nfunction toggleMultishopDefaultValue(obj, key)\n{\n  if (!$(obj).prop('checked') || $('#'+key).hasClass('isInvisible'))\n  {\n    $('#conf_id_'+key+' input, #conf_id_'+key+' textarea, #conf_id_'+key+' select, #conf_id_'+key+' button').attr('disabled', true);\n    $('#conf_id_'+key+' label.conf_title').addClass('isDisabled');\n  }\n  else\n  {\n    $('#conf_id_'+key+' input, #conf_id_'+key+' textarea, #conf_id_'+key+' select, #conf_id_'+key+' button').attr('disabled', false);\n    $('#conf_id_'+key+' label.conf_title').removeClass('isDisabled');\n  }\n  $('#conf_id_'+key+' input[name^=\\'multishopOverrideOption\\']').attr('disabled', false);\n}\n\nfunction doAdminAjax(data, success_func, error_func)\n{\n  $.ajax(\n  {\n    url : 'index.php',\n    data : data,\n    type : 'POST',\n    success : function(data){\n      if (success_func)\n        return success_func(data);\n\n      data = $.parseJSON(data);\n      if (data.confirmations.length != 0)\n        showSuccessMessage(data.confirmations);\n      else\n        showErrorMessage(data.error);\n    },\n    error : function(data){\n      if (error_func)\n        return error_func(data);\n\n      alert(\"[TECHNICAL ERROR]\");\n    }\n  });\n}\n\n//display a success/error/notice message\nfunction showSuccessMessage(msg) {\n  $.growl.notice({ title: \"\", message:msg});\n}\n\nfunction showErrorMessage(msg) {\n  $.growl.error({ title: \"\", message:msg});\n}\n\nfunction showNoticeMessage(msg) {\n  $.growl.notice({ title: \"\", message:msg});\n}\n\n$(document).ready(function()\n{\n  if (typeof helper_tabs != 'undefined' && typeof unique_field_id != 'undefined')\n  {\n    $.each(helper_tabs, function(index) {\n      $('#'+unique_field_id+'fieldset_'+index+' .form-wrapper').prepend('<div class=\"tab-content panel\" />');\n      $('#'+unique_field_id+'fieldset_'+index+' .form-wrapper').prepend('<ul class=\"nav nav-tabs\" />');\n      $.each(helper_tabs[index], function(key, value) {\n        // Move every form-group into the correct .tab-content > .tab-pane\n        $('#'+unique_field_id+'fieldset_'+index+' .tab-content').append('<div id=\"'+key+'\" class=\"tab-pane\" />');\n        var elemts = $('#'+unique_field_id+'fieldset_'+index).find(\"[data-tab-id='\" + key + \"']\");\n        $(elemts).appendTo('#'+key);\n        // Add the item to the .nav-tabs\n        if (elemts.length != 0)\n          $('#'+unique_field_id+'fieldset_'+index+' .nav-tabs').append('<li><a href=\"#'+key+'\" data-toggle=\"tab\">'+value+'</a></li>');\n      });\n      // Activate the first tab\n      $('#'+unique_field_id+'fieldset_'+index+' .tab-content div').first().addClass('active');\n      $('#'+unique_field_id+'fieldset_'+index+' .nav-tabs li').first().addClass('active');\n    });\n  }\n\n  if (typeof formToMove != 'undefined' && typeof formDestination != 'undefined' )\n  {\n    $('<hr style=\"margin 24px 0;\" />').appendTo('#'+formDestination)\n    $('#configuration_fieldset_'+formToMove+' .form-wrapper').appendTo('#'+formDestination);\n  }\n\n  $('select.chosen').each(function(k, item){\n    $(item).chosen({disable_search_threshold: 10, search_contains: true, width: '100%', });\n  });\n  // Apply chosen() when modal is loaded\n  $(document).on('shown.bs.modal', function (e) {\n    $('select.chosen-modal').chosen();\n  })\n\n  $('.isInvisible input, .isInvisible select, .isInvisible textarea').attr('disabled', true);\n  $('.isInvisible label.conf_title').addClass('isDisabled');\n\n  // Disable options fields for each row with a multishop default checkbox\n  $('.preference_default_multishop input[type=checkbox]').each(function(k, v)\n  {\n    var key = $(v).attr('name');\n    var len = key.length;\n    checkMultishopDefaultValue(v, key.substr(24, len - 25));\n  });\n\n  $('input[name^=\\'multishopOverrideOption\\']').each(function(k, v)\n  {\n    var key = $(v).attr('name');\n    var len = key.length;\n    toggleMultishopDefaultValue(v, key.substr(24, len - 25));\n  });\n\n  $(document).on('keyup change', '.copy2friendlyUrl', function(e){\n    if (!isArrowKey(e))\n      return copy2friendlyURL();\n  });\n\n  // on live will make this binded for dynamic content\n  $(document).on('keyup change', '.updateCurrentText', function(e){\n    if (typeof e == KeyboardEvent)\n      if(isArrowKey(e))\n        return;\n\n    updateCurrentText();\n  });\n\n  $(document).on('keyup change', '.copyMeta2friendlyURL', function(e){\n    if (!isArrowKey(e))\n      return copyMeta2friendlyURL()\n  });\n\n  $(document)\n    .ajaxStart(function() {\n      ajax_running_timeout = setTimeout(function() {\n        showAjaxOverlay()\n      }, 1000);\n    })\n    .ajaxStop(function() {\n      setTimeout(function() {\n        $('#ajax_running').hide()\n      }, 1000);\n      clearTimeout(ajax_running_timeout);\n    })\n    .ajaxError(function() {\n      setTimeout(function() {\n        $('#ajax_running').hide()\n      }, 1000);\n      clearTimeout(ajax_running_timeout);\n    });\n\n  bindTabModuleListAction();\n\n  //Check filters value on submit filter\n  $(\"[name='submitFilter']\").click(function(event) {\n    var list_id = $(this).data('list-id');\n    var empty_filters = true;\n\n    $(document.body).find(\"input[name*='\"+list_id+\"Filter']\").each(function() {\n      if ($(this).val() != '')\n      {\n        empty_filters = false;\n        return false;\n      }\n    });\n\n    $(document.body).find(\"select[name*='\"+list_id+\"Filter']\").each(function() {\n      empty_filters = false;\n      return false;\n    });\n\n    if (empty_filters)\n    {\n      event.preventDefault();\n      $('#'+list_id+'-empty-filters-alert').show();\n    }\n  });\n\n  var message = $('.toolbarHead');\n  var view = $(window);\n\n  // bind only if message exists. placeholder will be its parent\n  view.bind(\"scroll resize\", function(e)\n  {\n    message.each(function(el){\n      if (message.length)\n      {\n        placeholder = $(this).parent();\n        if (e.type == 'resize')\n          $(this).css('width', $(this).parent().width());\n\n        placeholderTop = placeholder.offset().top;\n        var viewTop = view.scrollTop() + 15;\n        // here we force the toolbar to be \"not fixed\" when\n        // the height of the window is really small (toolbar hiding the page is not cool)\n        window_is_more_than_twice_the_toolbar  = view.height() > message.parent().height() * 2;\n        if (!$(this).hasClass(\"fix-toolbar\") && (window_is_more_than_twice_the_toolbar && (viewTop > placeholderTop)))\n        {\n          $(this).css('width', $(this).width());\n          // fixing parent height will prevent that annoying \"pagequake\" thing\n          // the order is important : this has to be set before adding class fix-toolbar\n          $(this).parent().css('height', $(this).parent().height());\n          $(this).addClass(\"fix-toolbar\");\n        }\n        else if ($(this).hasClass(\"fix-toolbar\") && (!window_is_more_than_twice_the_toolbar || (viewTop <= placeholderTop)) )\n        {\n          $(this).removeClass(\"fix-toolbar\");\n          $(this).removeAttr('style');\n          $(this).parent().removeAttr('style');\n        }\n      }\n    });\n  }); // end bind\n\n  // if count errors\n  $('#hideError').on('click', function(e)\n  {\n    e.preventDefault();\n    $('.error').hide('slow', function (){\n      $('.error').remove();\n    });\n    return false;\n  });\n\n  // if count warnings\n  $(document).on('click', '#linkSeeMore', function(e){\n    e.preventDefault();\n    $('#seeMore').show();\n    $(this).hide();\n    $('#linkHide').show();\n    return false;\n  });\n  $(document).on('click', '#linkHide', function(e){\n    e.preventDefault();\n    $('#seeMore').hide();\n    $(this).hide();\n    $('#linkSeeMore').show();\n    return false;\n  });\n  $(document).on('click', '#hideWarn', function(e){\n    e.preventDefault();\n    $('.warn').hide('slow', function (){\n      $('.warn').remove();\n    });\n    return false;\n  });\n\n  $('.swap-container').each(function() {\n    var swap_container = this;\n    /** make sure that all the swap id is present in the dom to prevent mistake **/\n    if (typeof $('.addSwap', this) !== undefined && typeof $(\".removeSwap\", this) !== undefined &&\n      typeof $('.selectedSwap', this) !== undefined && typeof $('.availableSwap', this) !== undefined)\n    {\n      bindSwapButton('add', 'available', 'selected', this);\n      bindSwapButton('remove', 'selected', 'available', this);\n\n      $('button:submit').click(function() {\n        bindSwapSave(swap_container);\n      });\n    }\n  });\n\n    if ($('.kpi-container').length) {\n        refresh_kpis();\n    }\n\n    $('.kpi-refresh').on('click', '.refresh-kpis', function () {\n        refresh_kpis(true);\n    });\n});\n\nfunction bindSwapSave(context)\n{\n  if ($('.selectedSwap option', context).length !== 0)\n    $('.selectedSwap option', context).attr('selected', 'selected');\n  else\n    $('.availableSwap option', context).attr('selected', 'selected');\n}\n\nfunction bindSwapButton(prefix_button, prefix_select_remove, prefix_select_add, context)\n{\n  $('.'+prefix_button+'Swap', context).on('click', function(e) {\n    e.preventDefault();\n    $('.' + prefix_select_remove + 'Swap option:selected', context).each(function() {\n      $('.' + prefix_select_add + 'Swap', context).append(\"<option value='\"+$(this).val()+\"'>\"+$(this).text()+\"</option>\");\n      $(this).remove();\n    });\n    $('.selectedSwap option', context).prop('selected', true);\n  });\n}\n\nfunction bindTabModuleListAction()\n{\n  $('.action_tab_module').each( function (){\n    $(this).click(function () {\n      option = $('#'+$(this).data('option')+' :selected');\n      if ($(option).data('onclick') != '')\n      {\n        var f = eval(\"(function(){ \"+$(option).data('onclick')+\"})\");\n        if (f.call())\n          window.location.href = $(option).data('href');\n      }\n      else\n        window.location.href = $(option).data('href');\n      return false;\n    });\n  });\n}\n\n// Delete all tags HTML\nfunction stripHTML(oldString)\n{\n  var newString = '';\n  var inTag = false;\n  for(var i = 0; i < oldString.length; i++) {\n    if(oldString.charAt(i) == '<') inTag = true;\n    if(oldString.charAt(i) == '>') {\n      if(oldString.charAt(i+1)!='<')\n      {\n        inTag = false;\n        i++;\n      }\n    }\n    if(!inTag) newString += oldString.charAt(i);\n  }\n  return newString;\n}\n\n/**\n * Display a loading bar while an ajax call is ongoing.\n *\n * To prevent the loading bar display for a specific ajax call, set the beforeSend event in your ajax declaration:\n *    beforeSend : function(data)\n    {\n      // don't display the loading notification bar\n      clearTimeout(ajax_running_timeout);\n    }\n */\nfunction showAjaxOverlay()\n{\n  $('#ajax_running').show('fast');\n  clearTimeout(ajax_running_timeout);\n}\n\nfunction display_action_details(row_id, controller, token, action, params)\n{\n  var id = action+'_'+row_id;\n  var current_element = $('#details_'+id);\n  if (!current_element.data('dataMaped')) {\n    var ajax_params = {\n      'id': row_id,\n      'controller': controller,\n      'token': token,\n      'action': action,\n      'ajax': true\n    };\n\n    $.each(params, function(k, v) {\n      ajax_params[k] = v;\n    });\n\n    $.ajax({\n      url: 'index.php',\n      data: ajax_params,\n      dataType: 'json',\n      cache: false,\n      context: current_element,\n      async: false,\n      success: function(data) {\n        if (typeof(data.use_parent_structure) == 'undefined' || (data.use_parent_structure == true))\n        {\n          if (current_element.parent().parent().hasClass('alt_row'))\n            var alt_row = true;\n          else\n            var alt_row = false;\n          current_element.parent().parent().after($('<tr class=\"details_'+id+' small '+(alt_row ? 'alt_row' : '')+'\"></tr>')\n            .append($('<td style=\"border:none!important;\" class=\"empty\"></td>')\n            .attr('colspan', current_element.parent().parent().find('td').length)));\n          $.each(data.data, function(it, row)\n          {\n            var bg_color = ''; // Color\n            if (row.color)\n              bg_color = 'style=\"background:' + row.color +';\"';\n\n            var content = $('<tr class=\"action_details details_'+id+' '+(alt_row ? 'alt_row' : '')+'\"></tr>');\n            content.append($('<td class=\"empty\"></td>'));\n            var first = true;\n            var count = 0; // Number of non-empty collum\n            $.each(row, function(it)\n            {\n              if(typeof(data.fields_display[it]) != 'undefined')\n                count++;\n            });\n            $.each(data.fields_display, function(it, line)\n            {\n              if (typeof(row[it]) == 'undefined')\n              {\n                if (first || count == 0)\n                  content.append($('<td class=\"'+current_element.align+' empty\"' + bg_color + '></td>'));\n                else\n                  content.append($('<td class=\"'+current_element.align+'\"' + bg_color + '></td>'));\n              }\n              else\n              {\n                count--;\n                if (first)\n                {\n                  first = false;\n                  content.append($('<td class=\"'+current_element.align+' first\"' + bg_color + '>'+row[it]+'</td>'));\n                }\n                else if (count == 0)\n                  content.append($('<td class=\"'+current_element.align+' last\"' + bg_color + '>'+row[it]+'</td>'));\n                else\n                  content.append($('<td class=\"'+current_element.align+' '+count+'\"' + bg_color + '>'+row[it]+'</td>'));\n              }\n            });\n            content.append($('<td class=\"empty\"></td>'));\n            current_element.parent().parent().after(content.show('slow'));\n          });\n        }\n        else\n        {\n          if (current_element.parent().parent().hasClass('alt_row'))\n            var content = $('<tr class=\"details_'+id+' alt_row\"></tr>');\n          else\n            var content = $('<tr class=\"details_'+id+'\"></tr>');\n          content.append($('<td style=\"border:none!important;\">'+data.data+'</td>').attr('colspan', current_element.parent().parent().find('td').length));\n          current_element.parent().parent().after(content);\n          current_element.parent().parent().parent().find('.details_'+id).hide();\n        }\n        current_element.data('dataMaped', true);\n        current_element.data('opened', false);\n\n        if (typeof(initTableDnD) != 'undefined')\n          initTableDnD('.details_'+id+' table.tableDnD');\n      }\n    });\n  }\n\n  if (current_element.data('opened'))\n  {\n    current_element.find('i.icon-collapse-top').attr('class', 'icon-collapse');\n    current_element.parent().parent().parent().find('.details_'+id).hide('fast');\n    current_element.data('opened', false);\n  }\n  else\n  {\n    current_element.find('i.icon-collapse').attr('class', 'icon-collapse-top');\n    current_element.parent().parent().parent().find('.details_'+id).show('fast');\n    current_element.data('opened', true);\n  }\n}\n\nfunction quickSelect(elt)\n{\n  var eltVal = $(elt).val();\n  if (eltVal == \"0\")\n    return false;\n  else if (eltVal.substr(eltVal.length - 6) == '_blank')\n    window.open(eltVal.substr(0, eltVal.length - 6), '_blank');\n  else\n    location.href = eltVal;\n}\n\nfunction changeEmployeeLanguage()\n{\n  if (typeof allowEmployeeFormLang !== 'undefined' && allowEmployeeFormLang)\n    for (var key in languages) {\n      if (id_language === languages[key]['id_lang']) {\n        $.post(changeFormLanguageUrl, {\n          language_iso_code: languages[key]['iso_code']\n        });\n\n        break;\n      }\n    }\n}\n\nfunction hideOtherLanguage(id)\n{\n  $('.translatable-field').hide();\n  $('.lang-' + id).show();\n\n  var id_old_language = id_language;\n  id_language = id;\n\n  if (id_old_language != id)\n    changeEmployeeLanguage();\n\n  updateCurrentText();\n}\n\nfunction sendBulkAction(form, action)\n{\n  String.prototype.splice = function(index, remove, string) {\n    return (this.slice(0, index) + string + this.slice(index + Math.abs(remove)));\n  };\n\n  var form_action = $(form).attr('action');\n\n  if (form_action.replace(/(?:(?:^|\\n)\\s+|\\s+(?:$|\\n))/g,'').replace(/\\s+/g,' ') == '')\n    return false;\n\n  if (form_action.indexOf('#') == -1)\n    $(form).attr('action', form_action + '&' + action);\n  else\n    $(form).attr('action', form_action.splice(form_action.lastIndexOf('&'), 0, '&' + action));\n\n  $(form).submit();\n}\n\n/**\n * Searches for current controller and current CRUD action. This data can be used to know from where an ajax call is done (source tracking for example).\n * Action is 'index' by default.\n * For instance, only used for back-office.\n * @param force_action optional string to override action part of the result.\n */\nfunction getControllerActionMap(force_action) {\n  query = window.location.search.substring(1);\n  vars = query.split(\"&\");\n  controller = \"Admin\";\n  action = \"index\";\n\n  for (i = 0 ; i < vars.length; i++) {\n    pair = vars[i].split(\"=\");\n\n    if (pair[0] == \"token\")\n      continue;\n    if (pair[0] == \"controller\")\n      controller = pair[1];\n\n    if (pair.length == 1) {\n      if (pair[0].indexOf(\"add\") != -1)\n        action = \"new\";\n      else if (pair[0].indexOf(\"view\") != -1)\n        action = \"view\";\n      else if (pair[0].indexOf(\"edit\") != -1 || pair[0].indexOf(\"modify\") != -1 || pair[0].indexOf(\"update\") != -1)\n        action = \"edit\";\n      else if (pair[0].indexOf(\"delete\") != -1)\n        action = \"delete\";\n    }\n  }\n\n  if (force_action !== undefined)\n    action = force_action;\n\n  if (typeof help_class_name != 'undefined')\n    controller = help_class_name;\n\n  return new Array('back-office',controller, action);\n}\n\nfunction openModulesList()\n{\n\n  if (!modules_list_loaded)\n  {\n    header = $('#modules_list_container .modal-header').html();\n\n    $.ajax({\n      type: \"GET\",\n      url : admin_modules_link,\n      async: true,\n      data : {\n        ajax : \"1\",\n        controller : \"AdminModules\",\n        action : \"getTabModulesList\",\n        tab_modules_list : tab_modules_list,\n        back_tab_modules_list : window.location.href,\n        admin_list_from_source : getControllerActionMap().join()\n      },\n      success : function(data)\n      {\n        $('#modules_list_container_tab_modal').html(data).slideDown();\n        $('#modules_list_loader').hide();\n        modules_list_loaded = data;\n        $('.help-tooltip').tooltip();\n        controllerQuickView();\n      }\n    });\n  }\n  else\n  {\n    $('#modules_list_container_tab_modal').html(modules_list_loaded).slideDown();\n    $('#modules_list_loader').hide();\n    $('#modules_list_container .modal-header').html(header);\n    controllerQuickView();\n  }\n  return false;\n}\n\nfunction controllerQuickView()\n{\n  $('.controller-quick-view').click(function()\n  {\n    $.ajax({\n      type: \"POST\",\n      url : admin_modules_link,\n      dataType: 'json',\n      async: true,\n      data : {\n        ajax : \"1\",\n        controller : \"AdminModules\",\n        action : \"GetModuleReadMoreView\",\n        module: $(this).data(\"name\"),\n      },\n      success : function(data)\n      {\n        $('#modules_list_container_tab_modal').html(data.body);\n        $('#modules_list_container .modal-header').html(data.header);\n      }\n    });\n  });\n}\n\nfunction ajaxStates(id_state_selected)\n{\n  $.ajax({\n    url: \"index.php\",\n    cache: false,\n    data: \"token=\"+state_token+\"&ajax=1&action=states&tab=AdminStates&no_empty=0&id_country=\"+$('#id_country').val() + \"&id_state=\" + $('#id_state').val(),\n    success: function(html)\n    {\n      if (html == 'false')\n      {\n        $(\"#contains_states\").fadeOut();\n        $('#id_state option[value=0]').attr(\"selected\", \"selected\");\n      }\n      else\n      {\n        $(\"#id_state\").html(html);\n        $(\"#contains_states\").fadeIn();\n        $('#id_state option[value=' + id_state_selected + ']').attr(\"selected\", \"selected\");\n      }\n    }\n  });\n}\n\nfunction dniRequired() {\n  $.ajax({\n    url: 'index.php',\n    dataType: 'json',\n    cache: false,\n    data: 'token=' + address_token + '&ajax=1&dni_required=1&tab=AdminAddresses&id_country=' + $('#id_country').val(),\n    success: function(resp) {\n      if (resp && resp.dni_required) {\n        $(\"#dni_required\").fadeIn();\n      } else {\n        $(\"#dni_required\").fadeOut();\n      }\n    }\n  });\n}\n\nfunction check_for_all_accesses(tabsize, tabnumber)\n{\n  var i = 0;\n  var res = 0;\n  var right = 0;\n  var rights = new Array('view', 'add', 'edit', 'delete', 'all');\n\n  while (i != parseInt(tabsize) + 1)\n  {\n    if ($('#view'+i).prop('checked') == false || $('#edit'+i).prop('checked') == false || $('#add'+i).prop('checked') == false || $('#delete'+i).prop('checked') == false)\n      $('#all'+i).attr('checked', false);\n    else\n      $('#all'+i).attr('checked', \"checked\");\n    i++;\n  }\n  right = 0;\n  while (right != 5)\n  {\n    res = 0;\n    i = 0;\n    while (i != tabsize)\n    {\n      if ($('#'+rights[right]+i).prop('checked') == true)\n        res++;\n      i++;\n    }\n    if (res == tabnumber - 1)\n      $('#'+rights[right]+'all').attr('checked', \"checked\");\n    else\n      $('#'+rights[right]+'all').attr('checked', false);\n    right++;\n  }\n}\n\nfunction perfect_access_js_gestion(src, action, id_tab, tabsize, tabnumber, table)\n{\n  if (id_tab == '-1' && action == 'all')\n  {\n    $(table+' .add').attr('checked', src.checked);\n    $(table+' .edit').attr('checked', src.checked);\n    $(table+' .delete').attr('checked', src.checked);\n    $(table+' .view').attr('checked', src.checked);\n    $(table+' .all').attr('checked', src.checked);\n  }\n  else if (action == 'all')\n    $(table+' .'+id_tab).attr('checked', src.checked);\n  else if (id_tab == '-1')\n    $(table+' .'+action).attr('checked', src.checked);\n  check_for_all_accesses(tabsize, tabnumber);\n}\n\nverifMailREGEX = /^([\\w+-]+(?:\\.[\\w+-]+)*)@((?:[\\w-]+\\.)*\\w[\\w-]{0,66})\\.([a-z]{2,66}(?:\\.[a-z]{2})?)$/;\nfunction verifyMail(testMsg, testSubject)\n{\n  $(\"#mailResultCheck\").removeClass(\"alert-danger\").removeClass('alert-success').html('<img src=\"../img/admin/ajax-loader.gif\" alt=\"\" />');\n  $(\"#mailResultCheck\").slideDown(\"slow\");\n\n  //local verifications\n  if (!($(\"#testEmail\").val().length > 0))\n  {\n    $(\"#mailResultCheck\").addClass(\"alert-danger\").removeClass(\"alert-success\").removeClass('userInfos').html(errorMail);\n    return false;\n  }\n  else if (!verifMailREGEX.test( $(\"#testEmail\").val() ))\n  {\n    $(\"#mailResultCheck\").addClass(\"alert-danger\").removeClass(\"alert-success\").removeClass('userInfos').html(errorMail);\n    return false;\n  }\n  else\n  {\n    //external verifications and sets\n    $.ajax(\n    {\n       url: \"index.php\",\n       cache: false,\n       type : \"POST\",\n       data:\n      {\n        \"mailMethod\"  : (($(\"input[name=PS_MAIL_METHOD]:checked\").val() == 2) ? \"smtp\" : \"native\"),\n        \"smtpSrv\"   : $(\"input[name=PS_MAIL_SERVER]\").val(),\n        \"testEmail\"   : $(\"#testEmail\").val(),\n        \"smtpLogin\"   : $(\"input[name=PS_MAIL_USER]\").val(),\n        \"smtpPassword\"  : $(\"input[name=PS_MAIL_PASSWD]\").val(),\n        \"smtpPort\"    : $(\"input[name=PS_MAIL_SMTP_PORT]\").val(),\n        \"smtpEnc\"   : $(\"select[name=PS_MAIL_SMTP_ENCRYPTION]\").val(),\n        \"testMsg\"   : textMsg,\n        \"testSubject\" : textSubject,\n        \"token\"     : token_mail,\n        \"ajax\"      : 1,\n        \"tab\"       : 'AdminEmails',\n        \"action\"      : 'sendMailTest'\n      },\n       success: function(ret)\n       {\n        if (ret == \"ok\")\n        {\n          $(\"#mailResultCheck\").addClass(\"alert-success\").removeClass(\"alert-danger\").removeClass('userInfos').html(textSendOk);\n          mailIsOk = true;\n        }\n        else\n        {\n          mailIsOk = false;\n          $(\"#mailResultCheck\").addClass(\"alert-danger\").removeClass(\"alert-success\").removeClass('userInfos').html(textSendError + '<br />' + ret);\n        }\n       }\n     }\n     );\n  }\n}\n\nfunction checkLangPack(token){\n  if ($('#iso_code').val().length == 2)\n  {\n    $('#lang_pack_loading').show();\n    $('#lang_pack_msg').hide();\n    doAdminAjax(\n      {\n        controller:'AdminLanguages',\n        action:'checkLangPack',\n        token:token,\n        ajax:1,\n        iso_lang:($('#iso_code').val()).toLowerCase(),\n        ps_version:$('#ps_version').val()\n      },\n      function(ret)\n      {\n        $('#lang_pack_loading').hide();\n        ret = $.parseJSON(ret);\n        if( ret.status == 'ok')\n        {\n          content = $.parseJSON(ret.content);\n          message = langPackOk + ' <b>'+content['name'] + '</b>) :'\n            +'<br />' + langPackVersion + ' ' + content['version']\n            + ' <a href=\"https://www.prestashop.com/download/lang_packs/gzip/' + content['version'] + '/'\n            + ($('#iso_code').val()).toLowerCase()+'.gzip\" target=\"_blank\" class=\"link\">'+download+'</a><br />' + langPackInfo;\n          $('#lang_pack_msg').html(message);\n          $('#lang_pack_msg').show();\n        }\n        else\n          showErrorMessage(ret.error);\n      }\n     );\n   }\n}\n\nfunction redirect(new_page) { window.location = new_page; }\n\nfunction isCleanHtml(content)\n{\n  var events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n  events += '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n  events += '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n  events += '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|ondragexit|onmousewheel';\n  events += '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n  events += '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n  events += '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n  events += '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n  events += '|onpagehide|onpageshow|onautocomplete|onautocompleteerror|oncanplay|oncanplaythrough|onclose|oncuechange|ondurationchange|onemptied|onended|oninvalid|onloadeddata';\n  events += '|onloadedmetadata|onloadstart|onpause|onplay|onplaying|onpopstate|onprogress|onratechange|onreset|onseeked|onseeking|onshow|onsort|onstalled|onstorage|onsuspend|ontimeupdate';\n  events += '|ontoggle|onvolumechange|onwaiting';\n\n  var script1 = /<[\\s]*script/im;\n  var script2 = new RegExp('('+events+')[\\s]*=', 'im');\n  var script3 = /.*script\\:/im;\n  var script4 = /<[\\s]*(i?frame|embed|object)/im;\n  var script5 = /<\\s*\\w+[^>]*\\s(on\\w+)=[\"'][^\"']*[\"']/ims;\n  var rloCharacter = \"\\xE2\\x80\\xAE\";\n\n  if (script1.test(content) || script2.test(content) || script3.test(content) || script4.test(content) || script5.test(content) || content.indexOf(rloCharacter) !== -1)\n    return false;\n\n  return true;\n}\n\nfunction parseDate(date){\n  return $.datepicker.parseDate(\"yy-mm-dd\", date);\n}\n\nfunction refresh_kpis()\n{\n  var force = (arguments.length == 1 && arguments[0] == true);\n  $('.box-stats').each(function() {\n    if ($(this).attr('id')) {\n      var functionName = 'refresh_' + $(this).attr('id').replace(/-/g, '_');\n      if (typeof window[functionName] === 'function') {\n        if (force) {\n          window[functionName](true); // force refresh, ignoring cache delay\n        } else {\n          window[functionName]();\n        }\n      }\n    }\n  });\n}\n\nfunction createSqlQueryName()\n{\n  var container = false;\n  var current = false;\n  if ($('.breadcrumb')) {\n    container = $('.breadcrumb li').eq(0).text().replace(/\\s+/g, ' ').trim();\n    current = $('.breadcrumb li').eq(-1).text().replace(/\\s+/g, ' ').trim();\n  }\n  var title = false;\n  if ($('h2.title'))\n    title = $('h2.title').first().text().replace(/\\s+/g, ' ').trim();\n\n  var name = false;\n  if (container && current && container != current)\n    name = container + ' > ' + current;\n  else if (container)\n    name = container;\n  else if (current)\n    name = current;\n\n  if (title && title != current && title != container)\n  {\n    if (name)\n      name = name + ' > ' + title;\n    else\n      name = title;\n  }\n\n  return name.trim();\n}\n\nfunction confirm_link(head_text, display_text, confirm_text, cancel_text, confirm_link, cancel_link)\n{\n  $.alerts.okButton = confirm_text;\n  $.alerts.cancelButton = cancel_text;\n  jConfirm(display_text, head_text, function(confirm){\n    if (confirm === true)\n      document.location = confirm_link;\n    else\n      document.location = cancel_link;\n  });\n\n}\n\nfunction TogglePackage(detail)\n{\n    var pack = $('#pack_items_' + detail);\n    pack.css('display', (pack.css('display') == 'block') ? \"none\" : \"block\");\n}\nfunction countDown($source, $target) {\n  var max = $source.attr(\"data-maxchar\");\n  $target.html(max-$source.val().length);\n\n  $source.keyup(function(){\n    $target.html(max-$source.val().length);\n  });\n}\n", "/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\nvar currencyFormatter;\nvar numberFormatter;\n\nvar Tools = {\n\n  /**\n   * Constructs a float value from an arbitrarily-formatted string.\n   * In order to prevent unexpected behavior, make sure that your value has a decimal part.\n   * @param {String} value Value to convert to float\n   * @param {Boolean} [coerce=false] If true, this function will return 0 instad of NaN if the value cannot be parsed to float\n   *\n   * @return {Number}\n   */\n  parseFloatFromString: function(value, coerce) {\n    value = String(value).trim();\n\n    if ('' === value) {\n      return 0;\n    }\n\n    // check if the string can be converted to float as-is\n    var parsed = parseFloat(value);\n    if (String(parsed) === value) {\n      return parsed;\n    }\n\n    // replace arabic numbers by latin\n\t\tvalue = value\n\t\t\t// arabic\n\t\t\t.replace(/[\\u0660-\\u0669]/g, function(d) {\n\t\t\t\treturn d.charCodeAt(0) - 1632;\n\t\t\t})\n\t\t\t// persian\n\t\t\t.replace(/[\\u06F0-\\u06F9]/g, function(d) {\n        return d.charCodeAt(0) - 1776;\n      })\n\t\t;\n\n    // remove all non-digit characters\n    var split = value.split(/[^\\dE-]+/);\n\n    if (1 === split.length) {\n      // there's no decimal part\n      return parseFloat(value);\n    }\n\n    for (var i = 0; i < split.length; i++) {\n      if ('' === split[i]) {\n        return coerce ? 0 : NaN;\n      }\n    }\n\n    // use the last part as decimal\n    var decimal = split.pop();\n\n    // reconstruct the number using dot as decimal separator\n    return parseFloat(split.join('') +  '.' + decimal);\n  }\n};\n\n/**\n * @returns float parsed from a string containing a formatted price\n */\nfunction formatedNumberToFloat(price, currencyFormat, currencySign)\n{\n\tprice = price.replace(currencySign, '');\n\tif (currencyFormat === 1)\n\t\treturn parseFloat(price.replace(',', '').replace(' ', ''));\n\telse if (currencyFormat === 2)\n\t\treturn parseFloat(price.replace(' ', '').replace(',', '.'));\n\telse if (currencyFormat === 3)\n\t\treturn parseFloat(price.replace('.', '').replace(' ', '').replace(',', '.'));\n\telse if (currencyFormat === 4)\n\t\treturn parseFloat(price.replace(',', '').replace(' ', ''));\n\treturn price;\n}\n\n/**\n * @deprecated Please use asynchronous formatNumberCldr() instead.\n *\n * @param value float The number to format\n * @param numberOfDecimal Size of fractionnal part in the number\n * @param thousenSeparator Not used anymore\n * @param virgule Not used anymore\n * @returns string a formatted number according to the current locale settings\n */\nfunction formatNumber(value, numberOfDecimal, thousenSeparator, virgule)\n{\n\treturn getNumberFormatter(numberOfDecimal).format(value);\n}\n\n/**\n * This call will load CLDR data to format a number according to the page locale, and then send formatted\n * number into parameter of the callback function. This function is asynchronous as AJAX calls may occur.\n *\n * @param value float The number to format\n * @param callback The function to call with the resulting formatted number as unique parameter\n * @param numberOfDecimal Size of fractionnal part in the number\n */\nfunction formatNumberCldr(value, callback, numberOfDecimal) {\n  callback(getNumberFormatter(numberOfDecimal).format(value));\n}\n\n/**\n * @deprecated Please use asynchronous formatCurrencyCldr() instead.\n *\n * @param price float The value to format in a price\n * @param currencyFormat Not used anymore\n * @param currencySign Not used anymore\n * @param currencyBlank Not used anymore\n * @returns string a formatted price according to the current locale settings\n */\nfunction formatCurrency(price, currencyFormat, currencySign, currencyBlank)\n{\n  // if you modified this function, don't forget to modify the PHP function displayPrice (in the Tools.php class)\n  var blank = '';\n  price = parseFloat(price.toFixed(10));\n  price = ps_round(price, priceDisplayPrecision);\n  if (currencyBlank > 0)\n  \tblank = ' ';\n  if (currencyFormat == 1)\n  \treturn currencySign + blank + formatNumber(price, priceDisplayPrecision, ',', '.');\n  if (currencyFormat == 2)\n  \treturn (formatNumber(price, priceDisplayPrecision, ' ', ',') + blank + currencySign);\n  if (currencyFormat == 3)\n  \treturn (currencySign + blank + formatNumber(price, priceDisplayPrecision, '.', ','));\n  if (currencyFormat == 4)\n  \treturn (formatNumber(price, priceDisplayPrecision, ',', '.') + blank + currencySign);\n  if (currencyFormat == 5)\n  \treturn (currencySign + blank + formatNumber(price, priceDisplayPrecision, '\\'', '.'));\n  return price;\n}\n\n/**\n * This call will load CLDR data to format a price according to the page locale, and then send formatted\n * price into parameter of the callback function. This function is asynchronous as AJAX calls may occur.\n *\n * @param price float The price to format\n * @param callback The function to call with the resulting formatted price as unique parameter\n */\nfunction formatCurrencyCldr(price, callback) {\n\tcallback(getCurrencyFormatter().format(price));\n}\n\n/**\n * Simple function to generate global NumberFormatter\n * with a price specification\n * based one global currency_specifications\n */\nfunction getCurrencyFormatter() {\n\tif (currencyFormatter === undefined) {\n\t\tcurrencyFormatter = window.cldr.NumberFormatter.build(currency_specifications);\n\t}\n\n\treturn currencyFormatter;\n}\n\n/**\n * Simple function to generate global NumberFormatter\n * based one global currency_specifications\n * @param numberOfDecimal Size of fractionnal part in the number\n */\nfunction getNumberFormatter(numberOfDecimal) {\n  if (numberFormatter === undefined) {\n    numberFormatter = window.cldr.NumberFormatter.build(number_specifications);\n  }\n\n  if (numberOfDecimal === undefined) {\n    numberOfDecimal = 2;\n  }\n\n  numberFormatter.numberSpecification.maxFractionDigits = numberOfDecimal;\n  numberFormatter.numberSpecification.minFractionDigits = numberOfDecimal;\n\n  return numberFormatter;\n}\n\nfunction ps_round_helper(value, mode)\n{\n\t// From PHP Math.c\n\tif (value >= 0.0)\n\t{\n\t\ttmp_value = Math.floor(value + 0.5);\n\t\tif ((mode == 3 && value == (-0.5 + tmp_value)) ||\n\t\t\t(mode == 4 && value == (0.5 + 2 * Math.floor(tmp_value / 2.0))) ||\n\t\t\t(mode == 5 && value == (0.5 + 2 * Math.floor(tmp_value / 2.0) - 1.0)))\n\t\t\ttmp_value -= 1.0;\n\t}\n\telse\n\t{\n\t\ttmp_value = Math.ceil(value - 0.5);\n\t\tif ((mode == 3 && value == (0.5 + tmp_value)) ||\n\t\t\t(mode == 4 && value == (-0.5 + 2 * Math.ceil(tmp_value / 2.0))) ||\n\t\t\t(mode == 5 && value == (-0.5 + 2 * Math.ceil(tmp_value / 2.0) + 1.0)))\n\t\t\ttmp_value += 1.0;\n\t}\n\n\treturn tmp_value;\n}\n\nfunction ps_log10(value)\n{\n\treturn Math.log(value) / Math.LN10;\n}\n\nfunction ps_round_half_up(value, precision)\n{\n\tvar mul = Math.pow(10, precision);\n\tvar val = value * mul;\n\n\tvar next_digit = Math.floor(val * 10) - 10 * Math.floor(val);\n\tif (next_digit >= 5)\n\t\tval = Math.ceil(val);\n\telse\n\t\tval = Math.floor(val);\n\n\treturn val / mul;\n}\n\nfunction ps_round(value, places)\n{\n\tif (typeof(roundMode) === 'undefined')\n\t\troundMode = 2;\n\tif (typeof(places) === 'undefined')\n\t\tplaces = 2;\n\n\tvar method = roundMode;\n\n\tif (method === 0)\n\t\treturn ceilf(value, places);\n\telse if (method === 1)\n\t\treturn floorf(value, places);\n\telse if (method === 2)\n\t\treturn ps_round_half_up(value, places);\n\telse if (method == 3 || method == 4 || method == 5)\n\t{\n\t\t// From PHP Math.c\n\t\tvar precision_places = 14 - Math.floor(ps_log10(Math.abs(value)));\n\t\tvar f1 = Math.pow(10, Math.abs(places));\n\n\t\tif (precision_places > places && precision_places - places < 15)\n\t\t{\n\t\t\tvar f2 = Math.pow(10, Math.abs(precision_places));\n\t\t\tif (precision_places >= 0)\n\t\t\t\ttmp_value = value * f2;\n\t\t\telse\n\t\t\t\ttmp_value = value / f2;\n\n\t\t\ttmp_value = ps_round_helper(tmp_value, roundMode);\n\n\t\t\t/* now correctly move the decimal point */\n\t\t\tf2 = Math.pow(10, Math.abs(places - precision_places));\n\t\t\t/* because places < precision_places */\n\t\t\ttmp_value /= f2;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t/* adjust the value */\n\t\t\tif (places >= 0)\n\t\t\t\ttmp_value = value * f1;\n\t\t\telse\n\t\t\t\ttmp_value = value / f1;\n\n\t\t\tif (Math.abs(tmp_value) >= 1e15)\n\t\t\t\treturn value;\n\t\t}\n\n\t\ttmp_value = ps_round_helper(tmp_value, roundMode);\n\t\tif (places > 0)\n\t\t\ttmp_value = tmp_value / f1;\n\t\telse\n\t\t\ttmp_value = tmp_value * f1;\n\n\t\treturn tmp_value;\n\t}\n}\n\nfunction autoUrl(name, dest)\n{\n\tvar loc;\n\tvar id_list;\n\n\tid_list = document.getElementById(name);\n\tloc = id_list.options[id_list.selectedIndex].value;\n\tif (loc != 0)\n\t\tlocation.href = dest+loc;\n\treturn ;\n}\n\nfunction autoUrlNoList(name, dest)\n{\n\tvar loc;\n\n\tloc = document.getElementById(name).checked;\n\tlocation.href = dest + (loc == true ? 1 : 0);\n\treturn ;\n}\n\n/*\n** show or hide element e depending on condition show\n*/\nfunction toggle(e, show)\n{\n\te.style.display = show ? '' : 'none';\n}\n\nfunction toggleMultiple(tab)\n{\n    var len = tab.length;\n\n    for (var i = 0; i < len; i++)\n        if (tab[i].style)\n            toggle(tab[i], tab[i].style.display == 'none');\n}\n\nfunction truncateDecimals(value, decimals)\n{\n    var numPower = Math.pow(10, decimals);\n    var tempNumber = value * numPower;\n    var roundedTempNumber = Math.floor(tempNumber);\n    return roundedTempNumber / numPower;\n}\n\n/**\n* Show dynamicaly an element by changing the sytle \"display\" property\n* depending on the option selected in a select.\n*\n* @param string $select_id id of the select who controls the display\n* @param string $elem_id prefix id of the elements controlled by the select\n*   the real id must be : 'elem_id'+nb with nb the corresponding number in the\n*   select (starting with 0).\n*/\nfunction showElemFromSelect(select_id, elem_id)\n{\n\tvar select = document.getElementById(select_id);\n\tfor (var i = 0; i < select.length; ++i)\n\t{\n\t    var elem = document.getElementById(elem_id + select.options[i].value);\n\t\tif (elem != null)\n\t\t\ttoggle(elem, i == select.selectedIndex);\n\t}\n}\n\n/**\n* Get all div with specified name and for each one (by id), toggle their visibility\n*/\nfunction openCloseAllDiv(name, option)\n{\n\tvar tab = $('*[name='+name+']');\n\tfor (var i = 0; i < tab.length; ++i)\n\t\ttoggle(tab[i], option);\n}\n\nfunction toggleDiv(name, option)\n{\n\t$('*[name='+name+']').each(function(){\n\t\tif (option == 'open')\n\t\t{\n\t\t\t$('#buttonall').data('status', 'close');\n\t\t\t$(this).hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$('#buttonall').data('status', 'open');\n\t\t\t$(this).show();\n\t\t}\n\t})\n}\n\nfunction toggleButtonValue(id_button, text1, text2)\n{\n\tif ($('#'+id_button).find('i').first().hasClass('process-icon-compress'))\n\t{\n\t\t$('#'+id_button).find('i').first().removeClass('process-icon-compress').addClass('process-icon-expand');\n\t\t$('#'+id_button).find('span').first().html(text1);\n\t}\n\telse\n\t{\n\t\t$('#'+id_button).find('i').first().removeClass('process-icon-expand').addClass('process-icon-compress');\n\t\t$('#'+id_button).find('span').first().html(text2);\n\t}\n}\n\n\n/**\n* Toggle the value of the element id_button between text1 and text2\n*/\nfunction toggleElemValue(id_button, text1, text2)\n{\n\tvar obj = document.getElementById(id_button);\n\tif (obj)\n\t\tobj.value = ((!obj.value || obj.value == text2) ? text1 : text2);\n}\n\nfunction addBookmark(url, title)\n{\n\tif (window.sidebar && window.sidebar.addPanel)\n\t\treturn window.sidebar.addPanel(title, url, \"\");\n\telse if ( window.external && ('AddFavorite' in window.external))\n\t\treturn window.external.AddFavorite( url, title);\n}\n\nfunction writeBookmarkLink(url, title, text, img)\n{\n\tvar insert = '';\n\tif (img)\n\t\tinsert = writeBookmarkLinkObject(url, title, '<img src=\"' + img + '\" alt=\"' + escape(text) + '\" title=\"' + removeQuotes(text) + '\" />') + '&nbsp';\n\tinsert += writeBookmarkLinkObject(url, title, text);\n\tif (window.sidebar || window.opera && window.print || (window.external && ('AddFavorite' in window.external)))\n\t\t$('.add_bookmark, #header_link_bookmark').append(insert);\n}\n\nfunction writeBookmarkLinkObject(url, title, insert)\n{\n\tif (window.sidebar || window.external)\n\t\treturn ('<a href=\"javascript:addBookmark(\\'' + escape(url) + '\\', \\'' + removeQuotes(title) + '\\')\">' + insert + '</a>');\n\telse if (window.opera && window.print)\n\t\treturn ('<a rel=\"sidebar\" href=\"' + escape(url) + '\" title=\"' + removeQuotes(title) + '\">' + insert + '</a>');\n\treturn ('');\n}\n\nfunction checkCustomizations()\n{\n\tvar pattern = new RegExp(' ?filled ?');\n\n\tif (typeof customizationFields != 'undefined')\n\t\tfor (var i = 0; i < customizationFields.length; i++)\n\t\t{\n\t\t\t/* If the field is required and empty then we abort */\n\t\t\tif (parseInt(customizationFields[i][1]) == 1 && ($('#' + customizationFields[i][0]).html() == '' ||  $('#' + customizationFields[i][0]).text() != $('#' + customizationFields[i][0]).val()) && !pattern.test($('#' + customizationFields[i][0]).attr('class')))\n\t\t\t\treturn false;\n\t\t}\n\treturn true;\n}\n\nfunction emptyCustomizations()\n{\n\tcustomizationId = null;\n\tif(typeof(customizationFields) == 'undefined') return;\n\n\t$('.customization_block .success').fadeOut(function(){\n\t\t$(this).remove();\n\t});\n\t$('.customization_block .error').fadeOut(function(){\n\t\t$(this).remove();\n\t});\n\tfor (var i = 0; i < customizationFields.length; i++)\n\t{\n\t\t$('#' + customizationFields[i][0]).html('');\n\t\t$('#' + customizationFields[i][0]).val('');\n\t}\n}\n\nfunction ceilf(value, precision)\n{\n\tif (typeof(precision) === 'undefined')\n\t\tprecision = 0;\n\tvar precisionFactor = precision === 0 ? 1 : Math.pow(10, precision);\n\tvar tmp = value * precisionFactor;\n\tvar tmp2 = tmp.toString();\n\tif (tmp2[tmp2.length - 1] === 0)\n\t\treturn value;\n\treturn Math.ceil(value * precisionFactor) / precisionFactor;\n}\n\nfunction floorf(value, precision)\n{\n\tif (typeof(precision) === 'undefined')\n\t\tprecision = 0;\n\tvar precisionFactor = precision === 0 ? 1 : Math.pow(10, precision);\n\tvar tmp = value * precisionFactor;\n\tvar tmp2 = tmp.toString();\n\tif (tmp2[tmp2.length - 1] === 0)\n\t\treturn value;\n\treturn Math.floor(value * precisionFactor) / precisionFactor;\n}\n\nfunction setCurrency(id_currency)\n{\n\t$.ajax({\n\t\ttype: 'POST',\n\t\theaders: { \"cache-control\": \"no-cache\" },\n\t\turl: baseDir + 'index.php' + '?rand=' + new Date().getTime(),\n\t\tdata: 'controller=change-currency&id_currency='+ parseInt(id_currency),\n\t\tsuccess: function(msg)\n\t\t{\n\t\t\tlocation.reload(true);\n\t\t}\n\t});\n}\n\nfunction isArrowKey(k_ev)\n{\n\tvar unicode=k_ev.keyCode? k_ev.keyCode : k_ev.charCode;\n\tif (unicode >= 37 && unicode <= 40)\n\t\treturn true;\n\treturn false;\n}\n\nfunction removeQuotes(value)\n{\n\tvalue = value.replace(/\\\\\"/g, '');\n\tvalue = value.replace(/\"/g, '');\n\tvalue = value.replace(/\\\\'/g, '');\n\tvalue = value.replace(/'/g, '');\n\n\treturn value;\n}\n\nfunction sprintf(format)\n{\n\tfor(var i=1; i < arguments.length; i++)\n\t\tformat = format.replace(/%s/, arguments[i]);\n\n\treturn format;\n}\n\n/**\n * Display a MessageBox\n * @param {string} msg\n * @param {string} title (optional)\n */\nfunction fancyMsgBox(msg, title)\n{\n    if (title) msg = \"<h2>\" + title + \"</h2><p>\" + msg + \"</p>\";\n    msg += \"<br/><p class=\\\"submit\\\" style=\\\"text-align:right; padding-bottom: 0\\\"><input class=\\\"button\\\" type=\\\"button\\\" value=\\\"OK\\\" onclick=\\\"$.fancybox.close();\\\" /></p>\";\n\tif(!!$.prototype.fancybox)\n    \t$.fancybox( msg, {'autoDimensions': false, 'autoSize': false, 'width': 500, 'height': 'auto', 'openEffect': 'none', 'closeEffect': 'none'} );\n}\n\n/**\n * Display a messageDialog with different buttons including a callback for each one\n * @param {string} question\n * @param {mixed} title Optional title for the dialog box. Send false if you don't want any title\n * @param {object} buttons Associative array containg a list of {buttonCaption: callbackFunctionName, ...}. Use an empty space instead of function name for no callback\n * @param {mixed} otherParams Optional data sent to the callback function\n */\nfunction fancyChooseBox(question, title, buttons, otherParams)\n{\n    var msg, funcName, action;\n\tmsg = '';\n    if (title)\n\t\tmsg = \"<h2>\" + title + \"</h2><p>\" + question + \"</p>\";\n    msg += \"<br/><p class=\\\"submit\\\" style=\\\"text-align:right; padding-bottom: 0\\\">\";\n    var i = 0;\n    for (var caption in buttons) {\n        if (!buttons.hasOwnProperty(caption)) continue;\n        funcName = buttons[caption];\n        if (typeof otherParams == 'undefined') otherParams = 0;\n        otherParams = escape(JSON.stringify(otherParams));\n        action = funcName ? \"$.fancybox.close();window['\" + funcName + \"'](JSON.parse(unescape('\" + otherParams + \"')), \" + i + \")\" : \"$.fancybox.close()\";\n\t  msg += '<button type=\"submit\" class=\"button btn-default button-medium\" style=\"margin-right: 5px;\" value=\"true\" onclick=\"' + action + '\" >';\n\t  msg += '<span>' + caption + '</span></button>'\n        i++;\n    }\n    msg += \"</p>\";\n\tif(!!$.prototype.fancybox)\n    \t$.fancybox(msg, {'autoDimensions': false, 'width': 500, 'height': 'auto', 'openEffect': 'none', 'closeEffect': 'none'});\n}\n\nfunction toggleLayer(whichLayer, flag)\n{\n\tif (!flag)\n\t\t$(whichLayer).hide();\n\telse\n\t\t$(whichLayer).show();\n}\n\nfunction openCloseLayer(whichLayer, action)\n{\n\tif (!action)\n\t{\n\t\tif ($(whichLayer).css('display') == 'none')\n\t\t\t$(whichLayer).show();\n\t\telse\n\t\t\t$(whichLayer).hide();\n\t}\n\telse if (action == 'open')\n\t\t$(whichLayer).show();\n\telse if (action == 'close')\n\t\t$(whichLayer).hide();\n}\n\nfunction updateTextWithEffect(jQueryElement, text, velocity, effect1, effect2, newClass)\n{\n\tif(jQueryElement.text() !== text)\n\t{\n\t\tif(effect1 === 'fade')\n\t\t\tjQueryElement.fadeOut(velocity, function(){\n\t\t\t\t$(this).addClass(newClass);\n\t\t\t\tif(effect2 === 'fade') $(this).text(text).fadeIn(velocity);\n\t\t\t\telse if(effect2 === 'slide') $(this).text(text).slideDown(velocity);\n\t\t\t\t\telse if(effect2 === 'show')\t$(this).text(text).show(velocity, function(){});\n\t\t\t});\n\t\telse if(effect1 === 'slide')\n\t\t\tjQueryElement.slideUp(velocity, function(){\n\t\t\t\t$(this).addClass(newClass);\n\t\t\t\tif(effect2 === 'fade') $(this).text(text).fadeIn(velocity);\n\t\t\t\telse if(effect2 === 'slide') $(this).text(text).slideDown(velocity);\n\t\t\t\t\telse if(effect2 === 'show')\t$(this).text(text).show(velocity);\n\t\t\t});\n\t\telse if(effect1 === 'hide')\n\t\t\tjQueryElement.hide(velocity, function(){\n\t\t\t\t$(this).addClass(newClass);\n\t\t\t\tif(effect2 === 'fade') $(this).text(text).fadeIn(velocity);\n\t\t\t\telse if(effect2 === 'slide') $(this).text(text).slideDown(velocity);\n\t\t\t\t\telse if(effect2 === 'show')\t$(this).text(text).show(velocity);\n\t\t\t});\n\t}\n}\n//show a JS debug\nfunction dbg(value)\n{\n\tvar active = false;//true for active\n\tvar firefox = true;//true if debug under firefox\n\n\tif (active)\n\t\tif (firefox)\n\t\t\tconsole.log(value);\n\t\telse\n\t\t\talert(value);\n}\n\n/**\n* Function : print_r()\n* Arguments: The element  - array,hash(associative array),object\n*            The limit - OPTIONAL LIMIT\n*            The depth - OPTIONAL\n* Returns  : The textual representation of the array.\n* This function was inspired by the print_r function of PHP.\n* This will accept some data as the argument and return a\n* text that will be a more readable version of the\n* array/hash/object that is given.\n*/\nfunction print_r(element, limit, depth)\n{\n\tdepth =\tdepth?depth:0;\n\tlimit = limit?limit:1;\n\n\treturnString = '<ol>';\n\n\tfor(property in element)\n\t{\n\t\t//Property domConfig isn't accessable\n\t\tif (property != 'domConfig')\n\t\t{\n\t\t\treturnString += '<li><strong>'+ property + '</strong> <small>(' + (typeof element[property]) +')</small>';\n\n\t\t\tif (typeof element[property] == 'number' || typeof element[property] == 'boolean')\n\t\t\t\treturnString += ' : <em>' + element[property] + '</em>';\n\t\t\tif (typeof element[property] == 'string' && element[property])\n\t\t\t\treturnString += ': <div style=\"background:#C9C9C9;border:1px solid black; overflow:auto;\"><code>' +\n\t\t\t\t\t\t\t\t\telement[property].replace(/</g, '&amp;lt;').replace(/>/g, '&amp;gt;') + '</code></div>';\n\n\t\t\tif ((typeof element[property] == 'object') && (depth < limit))\n\t\t\t\treturnString += print_r(element[property], limit, (depth + 1));\n\n\t\t\treturnString += '</li>';\n\t\t}\n\t}\n\treturnString += '</ol>';\n\n\tif(depth == 0)\n\t{\n\t\twinpop = window.open(\"\", \"\",\"width=800,height=600,scrollbars,resizable\");\n\t\twinpop.document.write('<pre>'+returnString+ '</pre>');\n\t\twinpop.document.close();\n\t}\n\treturn returnString;\n}\n\n//verify if value is in the array\nfunction in_array(value, array)\n{\n\tfor (var i in array)\n\t\tif ((array[i] + '') === (value + ''))\n\t\t\treturn true;\n\treturn false;\n}\n\nfunction isCleanHtml(content)\n{\n  var events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n  events += '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n  events += '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n  events += '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|ondragexit|onmousewheel';\n  events += '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n  events += '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n  events += '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n  events += '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n  events += '|onpagehide|onpageshow|onautocomplete|onautocompleteerror|oncanplay|oncanplaythrough|onclose|oncuechange|ondurationchange|onemptied|onended|oninvalid|onloadeddata';\n  events += '|onloadedmetadata|onloadstart|onpause|onplay|onplaying|onpopstate|onprogress|onratechange|onreset|onseeked|onseeking|onshow|onsort|onstalled|onstorage|onsuspend|ontimeupdate';\n  events += '|ontoggle|onvolumechange|onwaiting';\n\n\tvar script1 = /<[\\s]*script/im;\n\tvar script2 = new RegExp('('+events+')[\\s]*=', 'im');\n\tvar script3 = /.*script\\:/im;\n\tvar script4 = /<[\\s]*(i?frame|embed|object)/im;\n  var script5 = /<\\s*\\w+[^>]*\\s(on\\w+)=[\"'][^\"']*[\"']/ims;\n  var rloCharacter = \"\\xE2\\x80\\xAE\";\n\n\tif (script1.test(content) || script2.test(content) || script3.test(content) || script4.test(content) || script5.test(content) || content.indexOf(rloCharacter) !== -1)\n\t\treturn false;\n\n\treturn true;\n}\n\nfunction getStorageAvailable() {\n\ttest = 'foo';\n\tstorage =  window.localStorage || window.sessionStorage;\n\ttry {\n\t\tstorage.setItem(test, test);\n\t\tstorage.removeItem(test);\n\t\treturn storage;\n\t}\n\tcatch (error) {\n\t\treturn null;\n\t}\n}\n\n$(document).ready(function()\n{\n\t// Hide all elements with .hideOnSubmit class when parent form is submit\n\t$('form').submit(function() {\n\t\t$(this).find('.hideOnSubmit').hide();\n\t});\n\n\t$.fn.checkboxChange = function(fnChecked, fnUnchecked) {\n\t\tif ($(this).prop('checked') && fnChecked)\n\t\t\tfnChecked.call(this);\n\t\telse if(fnUnchecked)\n\t\t\tfnUnchecked.call(this);\n\n\t\tif (!$(this).attr('eventCheckboxChange'))\n\t\t{\n\t\t\t$(this).on('change', function() { $(this).checkboxChange(fnChecked, fnUnchecked); });\n\t\t\t$(this).attr('eventCheckboxChange', true);\n\t\t}\n\t};\n\n\t// attribute target=\"_blank\" is not W3C compliant\n\t$('a._blank, a.js-new-window').attr('target', '_blank');\n});\n", "<?php\n/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\nnamespace PrestaShop\\PrestaShop\\Core\\ConstraintValidator;\n\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\Constraints\\CleanHtml;\nuse Symfony\\Component\\Validator\\Constraint;\nuse Symfony\\Component\\Validator\\ConstraintValidator;\nuse Symfony\\Component\\Validator\\Exception\\UnexpectedTypeException;\n\n/**\n * Class CleanHtmlValidator is responsible for validating the html content to prevent from having javascript events\n * or script tags.\n */\nfinal class CleanHtmlValidator extends ConstraintValidator\n{\n    private const EMBEDDABLE_HTML_PATTERN = '/<[\\s]*(i?frame|form|input|embed|object)/ims';\n\n    /**\n     * @var bool\n     */\n    private $allowEmbeddableHtml;\n\n    public function __construct(bool $allowEmbeddableHtml)\n    {\n        $this->allowEmbeddableHtml = $allowEmbeddableHtml;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function validate($value, Constraint $constraint)\n    {\n        if (!$constraint instanceof CleanHtml) {\n            throw new UnexpectedTypeException($constraint, CleanHtml::class);\n        }\n\n        if (!$value) {\n            return;\n        }\n\n        if (!is_string($value)) {\n            throw new UnexpectedTypeException($value, 'string');\n        }\n\n        $containsScriptTags = preg_match('/<[\\s]*script/ims', $value) || preg_match('/.*script\\:/ims', $value);\n        $containsJavascriptEvents = preg_match('/(' . $this->getJavascriptEvents() . ')[\\s]*=/ims', $value);\n\n        $iframe = !$this->allowEmbeddableHtml && preg_match(self::EMBEDDABLE_HTML_PATTERN, $value);\n\n        // any html attribute starting with \"on\" (event attributes), as a second layer protection\n        $eventAttributeRegex = '/<\\s*\\w+[^>]*\\s(on\\w+)=[\"\\'][^\"\\']*[\"\\']/ims';\n        // RLO characters detection\n        $rloCharacters = \"\\xE2\\x80\\xAE\";\n\n        // Check if the RLO character is in the string\n        if (strpos($value, $rloCharacters) !== false) {\n            // RLO character found, potential RLO attack\n            return false;\n        }\n\n        if ($containsScriptTags || $containsJavascriptEvents || $iframe || preg_match($eventAttributeRegex, $value) || strpos($value, $rloCharacters) !== false) {\n            $this->context->buildViolation($constraint->message)\n                ->setTranslationDomain('Admin.Notifications.Error')\n                ->setParameter('%s', $this->formatValue($value))\n                ->addViolation()\n            ;\n        }\n    }\n\n    /**\n     * Gets javascript events separated by pipeline which are used in preg match pattern to determine if string\n     * contains a javascript event. E.g onchange= is valid call for js event.\n     *\n     * @return string\n     */\n    private function getJavascriptEvents()\n    {\n        $events = 'onmousedown|onmousemove|onmmouseup|onmouseover|onmouseout|onload|onunload|onfocus|onblur|onchange';\n        $events .= '|onsubmit|ondblclick|onclick|onkeydown|onkeyup|onkeypress|onmouseenter|onmouseleave|onerror|onselect|onreset|onabort|ondragdrop|onresize|onactivate|onafterprint|onmoveend';\n        $events .= '|onafterupdate|onbeforeactivate|onbeforecopy|onbeforecut|onbeforedeactivate|onbeforeeditfocus|onbeforepaste|onbeforeprint|onbeforeunload|onbeforeupdate|onmove';\n        $events .= '|onbounce|oncellchange|oncontextmenu|oncontrolselect|oncopy|oncut|ondataavailable|ondatasetchanged|ondatasetcomplete|ondeactivate|ondrag|ondragend|ondragenter|ondragexit|onmousewheel';\n        $events .= '|ondragleave|ondragover|ondragstart|ondrop|onerrorupdate|onfilterchange|onfinish|onfocusin|onfocusout|onhashchange|onhelp|oninput|onlosecapture|onmessage|onmouseup|onmovestart';\n        $events .= '|onoffline|ononline|onpaste|onpropertychange|onreadystatechange|onresizeend|onresizestart|onrowenter|onrowexit|onrowsdelete|onrowsinserted|onscroll|onsearch|onselectionchange';\n        $events .= '|onselectstart|onstart|onstop|onanimationcancel|onanimationend|onanimationiteration|onanimationstart';\n        $events .= '|onpointerover|onpointerenter|onpointerdown|onpointermove|onpointerup|onpointerout|onpointerleave|onpointercancel|ongotpointercapture|onlostpointercapture';\n        $events .= '|onpagehide|onpageshow|onautocomplete|onautocompleteerror|oncanplay|oncanplaythrough|onclose|oncuechange|ondurationchange|onemptied|onended|oninvalid|onloadeddata';\n        $events .= '|onloadedmetadata|onloadstart|onpause|onplay|onplaying|onpopstate|onprogress|onratechange|onreset|onseeked|onseeking|onshow|onsort|onstalled|onstorage|onsuspend|ontimeupdate';\n        $events .= '|ontoggle|onvolumechange|onwaiting';\n\n        return $events;\n    }\n}\n", "<?php\n/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\ndeclare(strict_types=1);\n\nnamespace Tests\\Unit\\Adapter;\n\nuse PHPUnit\\Framework\\TestCase;\nuse PrestaShop\\PrestaShop\\Adapter\\Validate;\n\nclass ValidateTest extends TestCase\n{\n    /**\n     * @var Validate\n     */\n    private $validate;\n\n    /**\n     * @param string $name\n     * @param array $data\n     * @param string $dataName\n     */\n    public function __construct($name = null, array $data = [], $dataName = '')\n    {\n        parent::__construct($name, $data, $dataName);\n\n        $this->validate = new Validate();\n    }\n\n    /**\n     * @dataProvider getIsOrderWay\n     */\n    public function testIsOrderWay(int $expected, $input): void\n    {\n        self::assertEquals($expected, $this->validate::isOrderWay($input));\n    }\n\n    public function getIsOrderWay(): iterable\n    {\n        yield [0, 'test'];\n        yield [0, 1];\n        yield [0, true];\n        yield [1, 'ASC'];\n        yield [1, 'DESC'];\n        yield [1, 'asc'];\n        yield [1, 'desc'];\n        yield [1, 'random'];\n        yield [1, 'RANDOM'];\n    }\n\n    /**\n     * @dataProvider isEmailDataProvider\n     */\n    public function testIsEmail(bool $expected, string $email): void\n    {\n        $this->assertSame($expected, $this->validate->isEmail($email));\n    }\n\n    public function isEmailDataProvider(): array\n    {\n        return [\n            [true, 'john.doe@prestashop.com'],\n            [true, 'john.doe+alias@prestshop.com'],\n            [true, 'john.doe+alias@pr.e.sta.shop.com'],\n            [true, 'j@p.com'],\n            [true, 'john#doe@prestashop.com'],\n            [false, ''],\n            [false, 'john.doe@prestashop,com'],\n            [false, 'john.doe@prestashop'],\n            [true, 'john.doe@\u0441\u0430\u0439\u0442.\u0440\u0444'],\n            [true, 'john.doe@xn--80aswg.xn--p1ai'],\n            [false, '\u0438\u0432\u0430\u043d@prestashop.com'], // rfc6531 valid but not swift mailer compatible\n            [true, 'xn--80adrw@prestashop.com'],\n            [true, 'xn--80adrw@xn--80aswg.xn--p1ai'],\n        ];\n    }\n\n    /**\n     * @param bool $expected\n     * @param mixed $value\n     *\n     * @dataProvider isUnsignedIntProvider\n     */\n    public function testIsUnsignedInt(bool $expected, $value): void\n    {\n        self::assertEquals($expected, $this->validate->isUnsignedInt($value));\n    }\n\n    public function isUnsignedIntProvider(): array\n    {\n        return [\n            [true, 1],\n            [true, 666],\n            [true, 0],\n            [true, '234'],\n            [true, '0'],\n            [false, -1],\n            [false, '-1'],\n            [false, false],\n            [false, true],\n            [false, null],\n            [false, 'invalid'],\n            [false, '666invalid'],\n        ];\n    }\n\n    /**\n     * @param bool $expected\n     * @param string $objectClassName\n     *\n     * @dataProvider isValidObjectClassNameDataProvider\n     */\n    public function testisValidObjectClassName(bool $expected, string $objectClassName): void\n    {\n        $this->assertSame($expected, $this->validate->isValidObjectClassName($objectClassName));\n    }\n\n    /**\n     * @param string $html\n     * @param bool $iframeAllowed\n     * @param $expectedResult\n     *\n     * @dataProvider isCleanHtmlDataProvider\n     *\n     * @return void\n     */\n    public function testIsCleanHtml(string $html, bool $allowFrame, $expectedResult): void\n    {\n        $this->assertSame($expectedResult, $this->validate->isCleanHtml($html, $allowFrame));\n    }\n\n    public function isValidObjectClassNameDataProvider(): array\n    {\n        return [\n            [true, 'MyClassName'],\n            [true, '_MyClassName'],\n            [true, '_My_Class_Name_'],\n            [true, '_MyClassName_'],\n            [true, '__My__Class__Name__'],\n            [false, ''],\n            [false, '666'],\n            [true, '_666'],\n            [true, '_6_6_6_'],\n            [true, '__'],\n        ];\n    }\n\n    private function isCleanHtmlDataProvider()\n    {\n        return [\n            [\n                '<div randomattribute=\"randomvalue\">test</div>', // nominal case\n                false,\n                true\n            ],\n            [\n                '<div\n\nrandomattribute=\"anything\"   attributewithoutvalue\n\n        randomattr=\"random value\">\n\n</div>', // nominal case with added spaces and line jumps\n                false,\n                true\n            ],\n            [\n                '/form input > embed onerror iframe object', // test plain words with forbidden tag / attributes: should pass\n                false,\n                true\n            ],\n            [\n                '<a href=\"#\" onchange=\"evilJavascriptIsCalled()\"></a>', // event attributes are forbidden, should not pass\n                false,\n                false\n            ],\n            [\n                '<a href=\"#\" onanything=\"evilJavascriptIsCalled()\"></a>', // random attribute starting with on should not pass\n                false,\n                false\n            ],\n            [\n                '<a href=\"#\" oNnotexi=\"evilJavascriptIsCalled()\"></a>', // random attribute starting with on but case insensitive: should not pass\n                false,\n                false\n            ],\n            [\n                '<iframe src=\"catvideo.html\" /></iframe>', // iframe forbidden\n                false,\n                false\n            ],\n            [\n                '<iframe src=\"catvideo.html\" /></iframe>', // iframe parameter is set to true, should pass\n                true,\n                true\n            ],\n            [\n                '<form></form>', // form should not pass,\n                false,\n                false\n            ],\n            [\n                '<embed></embed>', // embed should not pass\n                false,\n                false\n            ],\n            [\n                '<input>', // input should not pass\n                false,\n                false\n            ],\n            [\n                '<script>\n\n    </script>', // script tags are forbidden, should not pass (added a random tabulation and line break\n                false,\n                false\n            ],\n            [\n                '<object></object>', // objects are forbidden, should not pass\n                false,\n                false\n            ],\n            [\n                '<div\nrandomattribute=\"anything\"\n\n    onbidule=\"test\" attributewithoutvalue\n\n        randomattr=\"random value\">test\n\n        </div>', // puting an attribute starting with \"on\" in the middle of other attributes, with spaces and line breaks: shouldn't pass\n                false,\n                false\n            ],\n            [\n                '\u202e<img src=x onerror=\"alert(\\'img\\')\">', // test RLO xss attack\n                false,\n                false\n            ]\n        ];\n    }\n}\n", "<?php\n/**\n * Copyright since 2007 PrestaShop SA and Contributors\n * PrestaShop is an International Registered Trademark & Property of PrestaShop SA\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.md.\n * It is also available through the world-wide-web at this URL:\n * https://opensource.org/licenses/OSL-3.0\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@prestashop.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade PrestaShop to newer\n * versions in the future. If you wish to customize PrestaShop for your\n * needs please refer to https://devdocs.prestashop.com/ for more information.\n *\n * @author    PrestaShop SA and Contributors <contact@prestashop.com>\n * @copyright Since 2007 PrestaShop SA and Contributors\n * @license   https://opensource.org/licenses/OSL-3.0 Open Software License (OSL 3.0)\n */\n\nnamespace Tests\\Unit\\Core\\ConstraintValidator;\n\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\CleanHtmlValidator;\nuse PrestaShop\\PrestaShop\\Core\\ConstraintValidator\\Constraints\\CleanHtml;\nuse Symfony\\Component\\Validator\\Test\\ConstraintValidatorTestCase;\n\nclass CleanHtmlValidatorTest extends ConstraintValidatorTestCase\n{\n    public function testItFailsWhenScriptTagsAreGiven()\n    {\n        $scriptTag = '<script></script>';\n\n        $this->validator->validate($scriptTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $scriptTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenJavascriptEventsAreGiven()\n    {\n        $htmlTag = '<a href=\"#\" onchange=\"evilJavascriptIsCalled()\"></a>';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenAttributeStartingWithOnIsGiven()\n    {\n        $htmlTag = '<a href=\"#\" onanything=\"evilJavascriptIsCalled()\"></a>';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testCaseInsensitiveOnEventAttributeDetection()\n    {\n        $htmlTag = '<a href=\"#\" oNnotexi=\"evilJavascriptIsCalled()\"></a>';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenIframeIsGiven()\n    {\n        $htmlTag = '<iframe src=\"catvideo.html\" /></iframe>';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenIframeWithSpacesIsGiven()\n    {\n        $htmlTag = '< iframe >';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenFormIsGiven()\n    {\n        $htmlTag = '<form>';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenInputIsGiven()\n    {\n        $htmlTag = '<input name=\"your-card-number\">';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenEmbedIsGiven()\n    {\n        $htmlTag = '<embed type=\"image/jpg\" src=\"funny_cat.jpg\" width=\"300\" height=\"200\">';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testItFailsWhenObjectIsGiven()\n    {\n        $htmlTag = '<object data=\"funny_cat.jpg\" width=\"300\" height=\"200\"></object> ';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n    }\n\n    public function testSucceedsWithPlainWords()\n    {\n        $htmlTag = '/form input > embed object iframe';\n\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->assertNoViolation();\n        $this->context->getViolations();\n    }\n\n    public function testItSucceedsWhenRegularAttributeIsGiven()\n    {\n        $htmlTag = '<div randomattribute=\"blabla\">test</div>';\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->assertNoViolation();\n        $this->context->getViolations();\n    }\n\n    public function testSucceedsWithSpaces()\n    {\n        $htmlTag = '<div\n\nrandomattribute=\"blabla\"   attributewithoutvalue\n\n        randomattr=\"random value\">\n\n</div>';\n        $this->validator->validate($htmlTag, new CleanHtml());\n\n        $this->assertNoViolation();\n    }\n\n    public function itFailsToHaveOnAttributeWithRandomSpacesAndLines()\n    {\n        $htmlTag = '<div\nrandomattribute=\"blabla\"\n\n    onbidule=\"test\" attributewithoutvalue\n\n        randomattr=\"random value\">test\n\n        </div>';\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n\n        $this->context->getViolations();\n    }\n\n    public function itFailsWithRLOInjection()\n    {\n        $htmlTag = '\u202e<img src=x onerror=\"alert(\\'img\\')\">';\n\n        $this->buildViolation((new CleanHtml())->message)\n            ->setParameter('%s', '\"' . $htmlTag . '\"')\n            ->assertRaised()\n        ;\n\n        $this->context->getViolations();\n\n    }\n\n    protected function createValidator()\n    {\n        return new CleanHtmlValidator(false);\n    }\n}\n"], "filenames": ["classes/Validate.php", "js/admin.js", "js/tools.js", "src/Core/ConstraintValidator/CleanHtmlValidator.php", "tests/Unit/Adapter/ValidateTest.php", "tests/Unit/Core/ConstraintValidator/CleanHtmlValidatorTest.php"], "buggy_code_start_loc": [517, 539, 708, 73, 140, 58], "buggy_code_end_loc": [531, 1448, 722, 97, 155, 140], "fixing_code_start_loc": [518, 539, 708, 73, 141, 59], "fixing_code_end_loc": [547, 1454, 728, 113, 266, 220], "type": "CWE-79", "message": "PrestaShop is an open-source e-commerce platform. Prior to versions 8.1.3 and 1.7.8.11, some event attributes are not detected by the `isCleanHTML` method. Some modules using the `isCleanHTML` method could be vulnerable to cross-site scripting. Versions 8.1.3 and 1.7.8.11 contain a patch for this issue. The best workaround is to use the `HTMLPurifier` library to sanitize html input coming from users. The library is already available as a dependency in the PrestaShop project. Beware though that in legacy object models, fields of `HTML` type will call `isCleanHTML`.", "other": {"cve": {"id": "CVE-2024-21627", "sourceIdentifier": "security-advisories@github.com", "published": "2024-01-02T21:15:10.467", "lastModified": "2024-01-08T19:23:49.707", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "PrestaShop is an open-source e-commerce platform. Prior to versions 8.1.3 and 1.7.8.11, some event attributes are not detected by the `isCleanHTML` method. Some modules using the `isCleanHTML` method could be vulnerable to cross-site scripting. Versions 8.1.3 and 1.7.8.11 contain a patch for this issue. The best workaround is to use the `HTMLPurifier` library to sanitize html input coming from users. The library is already available as a dependency in the PrestaShop project. Beware though that in legacy object models, fields of `HTML` type will call `isCleanHTML`."}, {"lang": "es", "value": "PrestaShop es una plataforma de comercio electr\u00f3nico de c\u00f3digo abierto. Antes de las versiones 8.1.3 y 1.7.8.11, el m\u00e9todo `isCleanHTML` no detecta algunos atributos de eventos. Algunos m\u00f3dulos que utilizan el m\u00e9todo `isCleanHTML` podr\u00edan ser vulnerables a cross site scripting. Las versiones 8.1.3 y 1.7.8.11 contienen un parche para este problema. La mejor soluci\u00f3n es utilizar la librer\u00eda `HTMLPurifier` para sanitizar la entrada HTML proveniente de los usuarios. La librer\u00eda ya est\u00e1 disponible como dependencia en el proyecto PrestaShop. Sin embargo, tenga en cuenta que en los modelos de objetos heredados, los campos de tipo `HTML` llamar\u00e1n `isCleanHTML`."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "NONE", "baseScore": 8.1, "baseSeverity": "HIGH"}, "exploitabilityScore": 1.7, "impactScore": 5.8}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-20"}, {"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:prestashop:prestashop:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.7.8.11", "matchCriteriaId": "A2437874-DFE9-40D7-830C-727A225366DD"}, {"vulnerable": true, "criteria": "cpe:2.3:a:prestashop:prestashop:*:*:*:*:*:*:*:*", "versionStartIncluding": "8.0.0", "versionEndExcluding": "8.1.3", "matchCriteriaId": "6D8ED724-5385-47E2-8BE2-C2588964AADA"}]}]}], "references": [{"url": "https://github.com/PrestaShop/PrestaShop/commit/73cfb44666818eefd501b526a894fe884dd12129", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/PrestaShop/PrestaShop/commit/ba06d18466df5b92cb841d504cc7210121104883", "source": "security-advisories@github.com", "tags": ["Patch"]}, {"url": "https://github.com/PrestaShop/PrestaShop/security/advisories/GHSA-xgpm-q3mq-46rq", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}]}, "github_commit_url": "https://github.com/PrestaShop/PrestaShop/commit/73cfb44666818eefd501b526a894fe884dd12129"}}