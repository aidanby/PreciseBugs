{"buggy_code": ["<?php\nif ($batch == 'yes') {\n    $buttonText = __('Upload Files');\n    $multiple = true;\n} else {\n    $multiple = false;\n    if (isset($filenames)) {\n        $buttonText = __('Replace File');\n    } else {\n        $buttonText = __('Upload File');\n    }\n}\n?>\n<div style=\"display:none;\">\n    <?php\n        echo $this->Form->create('', array('id' => 'upload_' . $element_id, 'type' => 'file'));\n        echo $this->Form->input('file.', array('id' => 'upload_' . $element_id . '_file', 'type' => 'file', 'label' => false, 'multiple' => $multiple, 'onChange' => 'this.form.submit()'));\n        echo $this->Form->end();\n    ?>\n</div>\n<span id=\"fileUploadButton_<?php echo $element_id; ?>\"  role=\"button\" tabindex=\"0\" aria-label=\"<?php echo $buttonText; ?>\" title=\"<?php echo $buttonText; ?>\" class=\"btn btn-primary\" onClick=\"templateFileUploadTriggerBrowse('<?php echo $element_id; ?>');\"><?php echo $buttonText; ?></span>\n<script type=\"text/javascript\">\n$(document).ready(function() {\n    <?php if (isset($filenames)): ?>\n    var fileArray = JSON.parse('<?php echo $fileArray;?>');\n    templateFileHiddenAdd(fileArray, '<?php echo $element_id; ?>', '<?php echo $batch; ?>');\n    showMessage('<?php echo $upload_error ? 'fail' : 'success'; ?>', '<?php echo $result; ?>', 'iframe');\n    <?php endif; ?>\n});\n\n</script>\n"], "fixing_code": ["<?php\nif ($batch == 'yes') {\n    $buttonText = __('Upload Files');\n    $multiple = true;\n} else {\n    $multiple = false;\n    if (isset($filenames)) {\n        $buttonText = __('Replace File');\n    } else {    \n        $buttonText = __('Upload File');\n    }\n}\n?>\n<div style=\"display:none;\">\n    <?php\n        echo $this->Form->create('', array('id' => 'upload_' . $element_id, 'type' => 'file'));\n        echo $this->Form->input('file.', array('id' => 'upload_' . $element_id . '_file', 'type' => 'file', 'label' => false, 'multiple' => $multiple, 'onChange' => 'this.form.submit()'));\n        echo $this->Form->end();\n    ?>\n</div>\n<span id=\"fileUploadButton_<?php echo h($element_id); ?>\"  role=\"button\" tabindex=\"0\" aria-label=\"<?php echo $buttonText; ?>\" title=\"<?php echo $buttonText; ?>\" class=\"btn btn-primary\" onClick=\"templateFileUploadTriggerBrowse(<?php echo json_encode($element_id); ?>);\"><?php echo $buttonText; ?></span>\n<script type=\"text/javascript\">\n$(document).ready(function() {\n    <?php if (isset($filenames)): ?>\n    var fileArray = JSON.parse('<?php echo $fileArray;?>');\n    templateFileHiddenAdd(fileArray, '<?php echo h($element_id); ?>', '<?php echo h($batch); ?>');\n    showMessage('<?php echo $upload_error ? 'fail' : 'success'; ?>', '<?php echo h($result); ?>', 'iframe');\n    <?php endif; ?>\n});\n\n</script>\n"], "filenames": ["app/View/Templates/upload_file.ctp"], "buggy_code_start_loc": [9], "buggy_code_end_loc": [28], "fixing_code_start_loc": [9], "fixing_code_end_loc": [28], "type": "CWE-79", "message": "In MISP before 2.4.167, there is XSS in the template file uploads in app/View/Templates/upload_file.ctp.", "other": {"cve": {"id": "CVE-2022-47928", "sourceIdentifier": "cve@mitre.org", "published": "2022-12-22T23:15:10.413", "lastModified": "2022-12-30T21:51:10.667", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In MISP before 2.4.167, there is XSS in the template file uploads in app/View/Templates/upload_file.ctp."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp-project:malware_information_sharing_platform:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.4.167", "matchCriteriaId": "16FA3B29-9E30-444C-9193-F13E3665F139"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/684d3e51398d4ea032b06fa4a1cd2bdf7d8b0ede", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/684d3e51398d4ea032b06fa4a1cd2bdf7d8b0ede"}}