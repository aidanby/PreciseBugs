{"buggy_code": ["<?php\n##################################################\n#\n# Copyright (c) 2004-2016 OIC Group, Inc.\n#\n# This file is part of Exponent\n#\n# Exponent is free software; you can redistribute\n# it and/or modify it under the terms of the GNU\n# General Public License as published by the Free\n# Software Foundation; either version 2 of the\n# License, or (at your option) any later version.\n#\n# GPL: http://www.gnu.org/licenses/gpl.txt\n#\n##################################################\n\n/**\n * This is the class expRatingController\n *\n * @package Core\n * @subpackage Controllers\n */\n\nclass expRatingController extends expController {\n    public $base_class = 'expRating';\n\n    static function displayname() { return gt(\"Ratings Manager\"); }\n    static function description() { return gt(\"This module is for managing ratings on records\"); }\n    static function hasSources() { return false; }\n\t\n\tfunction __construct($src=null, $params=array()) {\n        global $user;\n\t    parent::__construct($src, $params);\n        $this->remove_permissions = ($user->isLoggedIn())?array('update','create'):array();\n    }\n\n    /**\n     * Update rating...handled via ajax\n     */\n    function update() {\n        global $db, $user;\n        \t\n        $this->params['id'] = $db->selectValue('content_expRatings','expratings_id',\"content_id='\".$this->params['content_id'].\"' AND content_type='\".$this->params['content_type'].\"' AND subtype='\".$this->params['subtype'].\"' AND poster='\".$user->id.\"'\");\n        $msg = gt('Thank you for your rating');\n        $rating = new expRating($this->params);\n        if (!empty($rating->id)) $msg = gt('Your rating has been adjusted');\n        // save the rating\n        $rating->update($this->params);\n\n        // attach the rating to the datatype it belongs to (blog, news, etc..);\n        $obj = new stdClass();\n\t\t$obj->content_type = $this->params['content_type'];\n\t\t$obj->content_id = $this->params['content_id'];\n\t\t$obj->expratings_id = $rating->id;\n\t\t$obj->poster = $rating->poster;\n\t\tif(isset($this->params['subtype'])) $obj->subtype = $this->params['subtype'];\n\t\t$db->insertObject($obj, $rating->attachable_table);\n\n        $ar = new expAjaxReply(200,$msg);\n        $ar->send();\n\t\t\n        // flash('message', $msg);\n        // expHistory::back();\n\t}\n\t\n}\n\n?>"], "fixing_code": ["<?php\n##################################################\n#\n# Copyright (c) 2004-2016 OIC Group, Inc.\n#\n# This file is part of Exponent\n#\n# Exponent is free software; you can redistribute\n# it and/or modify it under the terms of the GNU\n# General Public License as published by the Free\n# Software Foundation; either version 2 of the\n# License, or (at your option) any later version.\n#\n# GPL: http://www.gnu.org/licenses/gpl.txt\n#\n##################################################\n\n/**\n * This is the class expRatingController\n *\n * @package Core\n * @subpackage Controllers\n */\n\nclass expRatingController extends expController {\n    public $base_class = 'expRating';\n\n    static function displayname() { return gt(\"Ratings Manager\"); }\n    static function description() { return gt(\"This module is for managing ratings on records\"); }\n    static function hasSources() { return false; }\n\n\tfunction __construct($src=null, $params=array()) {\n        global $user;\n\t    parent::__construct($src, $params);\n        $this->remove_permissions = ($user->isLoggedIn())?array('update','create'):array();\n    }\n\n    /**\n     * Update rating...handled via ajax\n     */\n    function update() {\n        global $db, $user;\n\n        $this->params['content_type'] = preg_replace(\"/[^[:alnum:][:space:]]/u\", '', $this->params['content_type']);\n        $this->params['subtype'] = preg_replace(\"/[^[:alnum:][:space:]]/u\", '', $this->params['subtype']);\n        $this->params['id'] = $db->selectValue('content_expRatings','expratings_id',\"content_id='\".$this->params['content_id'].\"' AND content_type='\".$this->params['content_type'].\"' AND subtype='\".$this->params['subtype'].\"' AND poster='\".$user->id.\"'\");\n        $msg = gt('Thank you for your rating');\n        $rating = new expRating($this->params);\n        if (!empty($rating->id)) $msg = gt('Your rating has been adjusted');\n        // save the rating\n        $rating->update($this->params);\n\n        // attach the rating to the datatype it belongs to (blog, news, etc..);\n        $obj = new stdClass();\n\t\t$obj->content_type = $this->params['content_type'];\n\t\t$obj->content_id = $this->params['content_id'];\n\t\t$obj->expratings_id = $rating->id;\n\t\t$obj->poster = $rating->poster;\n\t\tif(isset($this->params['subtype'])) $obj->subtype = $this->params['subtype'];\n\t\t$db->insertObject($obj, $rating->attachable_table);\n\n        $ar = new expAjaxReply(200,$msg);\n        $ar->send();\n\n        // flash('message', $msg);\n        // expHistory::back();\n\t}\n\n}\n\n?>"], "filenames": ["framework/modules/core/controllers/expRatingController.php"], "buggy_code_start_loc": [31], "buggy_code_end_loc": [67], "fixing_code_start_loc": [31], "fixing_code_end_loc": [69], "type": "CWE-89", "message": "Multiple SQL injection vulnerabilities in the update method in framework/modules/core/controllers/expRatingController.php in Exponent CMS 2.4.0 allow remote authenticated users to execute arbitrary SQL commands via the (1) content_type or (2) subtype parameter.", "other": {"cve": {"id": "CVE-2016-9242", "sourceIdentifier": "cve@mitre.org", "published": "2016-11-07T11:59:01.533", "lastModified": "2016-11-29T18:23:30.043", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Multiple SQL injection vulnerabilities in the update method in framework/modules/core/controllers/expRatingController.php in Exponent CMS 2.4.0 allow remote authenticated users to execute arbitrary SQL commands via the (1) content_type or (2) subtype parameter."}, {"lang": "es", "value": "M\u00faltiples vulnerabilidades de inyecci\u00f3n SQL en el m\u00e9todo de actualizaci\u00f3n en framework/modules/core/controllers/expRatingController.php en Exponent CMS 2.4.0 permiten a usuarios remotos autenticados ejecutar comandos SQL arbitrarios a trav\u00e9s del par\u00e1metro (1) content_type o (2) subtype."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": true, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:exponentcms:exponent_cms:2.4.0:*:*:*:*:*:*:*", "matchCriteriaId": "CFEAA82F-83B2-49B8-B860-2F18C3C66321"}]}]}], "references": [{"url": "http://www.securityfocus.com/bid/94194", "source": "cve@mitre.org", "tags": ["Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/exponentcms/exponent-cms/commit/6172f67620ac13fc2f4e9d650c61937d48e9ecb9", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/exponentcms/exponent-cms/commit/6172f67620ac13fc2f4e9d650c61937d48e9ecb9"}}