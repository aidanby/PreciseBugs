{"buggy_code": ["<?php\n/* Copyright (C) 2013-2014 Olivier Geffroy\t\t<jeff@jeffinfo.com>\n * Copyright (C) 2013-2014 Florian Henry\t\t<florian.henry@open-concept.pro>\n * Copyright (C) 2013-2017 Alexandre Spangaro\t<aspangaro@open-dsi.fr>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n * \\file \thtdocs/accountancy/customer/card.php\n * \\ingroup Accountancy (Double entries)\n * \\brief \tCard customer ventilation\n */\nrequire '../../main.inc.php';\n\nrequire_once DOL_DOCUMENT_ROOT.'/compta/facture/class/facture.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/class/html.formaccounting.class.php';\n\n// Load translation files required by the page\n$langs->loadLangs(array(\"bills\", \"accountancy\"));\n\n$action = GETPOST('action', 'alpha');\n$cancel = GETPOST('cancel', 'alpha');\n$backtopage = GETPOST('backtopage', 'alpha');\n\n$codeventil = GETPOST('codeventil');\n$id = GETPOST('id');\n\n// Security check\nif ($user->socid > 0)\n\taccessforbidden();\n\n\n/*\n * Actions\n */\n\nif ($action == 'ventil' && $user->rights->accounting->bind->write)\n{\n\tif (!$cancel)\n\t{\n\t    if ($codeventil < 0) $codeventil = 0;\n\n\t\t$sql = \" UPDATE \".MAIN_DB_PREFIX.\"facturedet\";\n\t\t$sql .= \" SET fk_code_ventilation = \".$codeventil;\n\t\t$sql .= \" WHERE rowid = \".$id;\n\n\t\t$resql = $db->query($sql);\n\t\tif (!$resql) {\n\t\t\tsetEventMessages($db->lasterror(), null, 'errors');\n\t\t}\n\t\telse\n\t\t{\n\t\t    setEventMessages($langs->trans(\"RecordModifiedSuccessfully\"), null, 'mesgs');\n\t\t    if ($backtopage)\n\t\t    {\n\t\t    \theader(\"Location: \".$backtopage);\n\t\t    \texit();\n\t\t    }\n\t\t}\n\t} else {\n\t\theader(\"Location: ./lines.php\");\n\t\texit();\n\t}\n}\n\n\n/*\n * View\n */\n\nllxHeader(\"\", $langs->trans('FicheVentilation'));\n\nif ($cancel == $langs->trans(\"Cancel\")) {\n\t$action = '';\n}\n\n/*\n * Create\n */\n$form = new Form($db);\n$facture_static = new Facture($db);\n$formaccounting = new FormAccounting($db);\n\nif (!empty($id)) {\n\t$sql = \"SELECT f.ref, f.rowid as facid, l.fk_product, l.description, l.price,\";\n\t$sql .= \" l.qty, l.rowid, l.tva_tx, l.remise_percent, l.subprice, p.accountancy_code_sell as code_sell,\";\n\t$sql .= \" l.fk_code_ventilation, aa.account_number, aa.label\";\n\t$sql .= \" FROM \".MAIN_DB_PREFIX.\"facturedet as l\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"product as p ON p.rowid = l.fk_product\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"accounting_account as aa ON l.fk_code_ventilation = aa.rowid\";\n\t$sql .= \" INNER JOIN \".MAIN_DB_PREFIX.\"facture as f ON f.rowid = l.fk_facture\";\n\t$sql .= \" WHERE f.fk_statut > 0 AND l.rowid = \".$id;\n\t$sql .= \" AND f.entity IN (\".getEntity('invoice', 0).\")\"; // We don't share object for accountancy\n\n\tdol_syslog(\"/accounting/customer/card.php sql=\".$sql, LOG_DEBUG);\n\t$result = $db->query($sql);\n\n\tif ($result) {\n\t\t$num_lines = $db->num_rows($result);\n\t\t$i = 0;\n\n\t\tif ($num_lines) {\n\t\t\t$objp = $db->fetch_object($result);\n\n\t\t\tprint '<form action=\"'.$_SERVER[\"PHP_SELF\"].'?id='.$id.'\" method=\"post\">'.\"\\n\";\n\t\t\tprint '<input type=\"hidden\" name=\"token\" value=\"'.newToken().'\">';\n\t\t\tprint '<input type=\"hidden\" name=\"action\" value=\"ventil\">';\n\t\t\tprint '<input type=\"hidden\" name=\"backtopage\" value=\"'.dol_escape_htmltag($backtopage).'\">';\n\n\t\t\tprint load_fiche_titre($langs->trans('CustomersVentilation'), '', 'title_accountancy');\n\n\t\t\tdol_fiche_head();\n\n\t\t\tprint '<table class=\"border centpercent\">';\n\n\t\t\t// Ref facture\n\t\t\tprint '<tr><td>'.$langs->trans(\"Invoice\").'</td>';\n\t\t\t$facture_static->ref = $objp->ref;\n\t\t\t$facture_static->id = $objp->facid;\n\t\t\tprint '<td>'.$facture_static->getNomUrl(1).'</td>';\n\t\t\tprint '</tr>';\n\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"Line\").'</td>';\n\t\t\tprint '<td>'.nl2br($objp->description).'</td></tr>';\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"Account\").'</td><td>';\n\t\t\tprint $formaccounting->select_account($objp->fk_code_ventilation, 'codeventil', 1);\n\t\t\tprint '</td></tr>';\n\t\t\tprint '</table>';\n\n\t\t\tdol_fiche_end();\n\n\t\t\tprint '<div class=\"center\">';\n\t\t\tprint '<input class=\"button\" type=\"submit\" value=\"'.$langs->trans(\"Save\").'\">';\n\t\t\tprint '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';\n\t\t\tprint '<input class=\"button\" type=\"submit\" name=\"cancel\" value=\"'.$langs->trans(\"Cancel\").'\">';\n\t\t\tprint '</div>';\n\n\t\t\tprint '</form>';\n\t\t} else {\n\t\t\tprint \"Error\";\n\t\t}\n\t} else {\n\t\tprint \"Error\";\n\t}\n} else {\n\tprint \"Error ID incorrect\";\n}\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2004\t\tRodolphe Quiedeville\t<rodolphe@quiedeville.org>\n * Copyright (C) 2005\t\tSimon TOSSER\t\t\t<simon@kornog-computing.com>\n * Copyright (C) 2013-2017\tAlexandre Spangaro\t\t<aspangaro@open-dsi.fr>\n * Copyright (C) 2013-2014\tOlivier Geffroy\t\t\t<jeff@jeffinfo.com>\n * Copyright (C) 2013-2014\tFlorian Henry\t\t\t<florian.henry@open-concept.pro>\n * Copyright (C) 2014\t\tJuanjo Menent\t\t\t<jmenent@2byte.es>\n * Copyright (C) 2015\t\tJean-Fran\u00e7ois Ferry\t\t<jfefe@aternatik.fr>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n *\n */\n/**\n * \\file\t\thtdocs/accountancy/supplier/card.php\n * \\ingroup\t\tAccountancy (Double entries)\n * \\brief\t\tCard expense report ventilation\n */\nrequire '../../main.inc.php';\n\nrequire_once DOL_DOCUMENT_ROOT.'/expensereport/class/expensereport.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/class/html.formaccounting.class.php';\n\n// Load translation files required by the page\n$langs->loadLangs(array(\"bills\", \"accountancy\", \"trips\"));\n\n$action = GETPOST('action', 'alpha');\n$cancel = GETPOST('cancel', 'alpha');\n$backtopage = GETPOST('backtopage', 'alpha');\n\n$codeventil = GETPOST('codeventil');\n$id = GETPOST('id');\n\n// Security check\nif ($user->socid > 0)\n\taccessforbidden();\n\n\n/*\n * Actions\n */\n\nif ($action == 'ventil' && $user->rights->accounting->bind->write)\n{\n\tif (!$cancel)\n\t{\n\t\tif ($codeventil < 0) $codeventil = 0;\n\n\t\t$sql = \" UPDATE \".MAIN_DB_PREFIX.\"expensereport_det\";\n\t\t$sql .= \" SET fk_code_ventilation = \".$codeventil;\n\t\t$sql .= \" WHERE rowid = \".$id;\n\n\t\t$resql = $db->query($sql);\n\t\tif (!$resql) {\n\t\t\tsetEventMessages($db->lasterror(), null, 'errors');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsetEventMessages($langs->trans(\"RecordModifiedSuccessfully\"), null, 'mesgs');\n\t\t\tif ($backtopage)\n\t\t\t{\n\t\t\t\theader(\"Location: \".$backtopage);\n\t\t\t\texit();\n\t\t\t}\n\t\t}\n\t} else {\n\t\theader(\"Location: ./lines.php\");\n\t\texit();\n\t}\n}\n\n\n\n/*\n * View\n */\nllxHeader(\"\", $langs->trans('FicheVentilation'));\n\nif ($cancel == $langs->trans(\"Cancel\")) {\n\t$action = '';\n}\n\n// Create\n$form = new Form($db);\n$expensereport_static = new ExpenseReport($db);\n$formaccounting = new FormAccounting($db);\n\nif (!empty($id)) {\n\t$sql = \"SELECT er.ref, er.rowid as facid, erd.fk_c_type_fees, erd.comments, erd.rowid, erd.fk_code_ventilation,\";\n\t$sql .= \" f.id as type_fees_id, f.code as type_fees_code, f.label as type_fees_label,\";\n\t$sql .= \" aa.account_number, aa.label\";\n\t$sql .= \" FROM \".MAIN_DB_PREFIX.\"expensereport_det as erd\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"c_type_fees as f ON f.id = erd.fk_c_type_fees\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"accounting_account as aa ON erd.fk_code_ventilation = aa.rowid\";\n\t$sql .= \" INNER JOIN \".MAIN_DB_PREFIX.\"expensereport as er ON er.rowid = erd.fk_expensereport\";\n\t$sql .= \" WHERE er.fk_statut > 0 AND erd.rowid = \".$id;\n\t$sql .= \" AND er.entity IN (\".getEntity('expensereport', 0).\")\"; // We don't share object for accountancy\n\n\tdol_syslog(\"/accounting/expensereport/card.php sql=\".$sql, LOG_DEBUG);\n\t$result = $db->query($sql);\n\n\tif ($result) {\n\t\t$num_lines = $db->num_rows($result);\n\t\t$i = 0;\n\n\t\tif ($num_lines) {\n\t\t\t$objp = $db->fetch_object($result);\n\n\t\t\tprint '<form action=\"'.$_SERVER[\"PHP_SELF\"].'?id='.$id.'\" method=\"post\">'.\"\\n\";\n\t\t\tprint '<input type=\"hidden\" name=\"token\" value=\"'.newToken().'\">';\n\t\t\tprint '<input type=\"hidden\" name=\"action\" value=\"ventil\">';\n\t\t\tprint '<input type=\"hidden\" name=\"backtopage\" value=\"'.dol_escape_htmltag($backtopage).'\">';\n\n\t\t\tprint load_fiche_titre($langs->trans('ExpenseReportsVentilation'), '', 'title_accountancy');\n\n\t\t\tdol_fiche_head();\n\n\t\t\tprint '<table class=\"border centpercent\">';\n\n\t\t\t// Ref\n\t\t\tprint '<tr><td class=\"titlefield\">'.$langs->trans(\"ExpenseReport\").'</td>';\n\t\t\t$expensereport_static->ref = $objp->ref;\n\t\t\t$expensereport_static->id = $objp->erid;\n\t\t\tprint '<td>'.$expensereport_static->getNomUrl(1).'</td>';\n\t\t\tprint '</tr>';\n\n\t\t\tprint '<tr><td>'.$langs->trans(\"Line\").'</td>';\n\t\t\tprint '<td>'.stripslashes(nl2br($objp->rowid)).'</td></tr>';\n\n\t\t\tprint '<tr><td>'.$langs->trans(\"Description\").'</td>';\n\t\t\tprint '<td>'.stripslashes(nl2br($objp->comments)).'</td></tr>';\n\n\t\t\tprint '<tr><td>'.$langs->trans(\"TypeFees\").'</td>';\n\t\t\tprint '<td>'.($langs->trans($objp->type_fees_code) == $objp->type_fees_code ? $objp->type_fees_label : $langs->trans(($objp->type_fees_code))).'</td>';\n\n\t\t\tprint '<tr><td>'.$langs->trans(\"Account\").'</td><td>';\n\t\t\tprint $formaccounting->select_account($objp->fk_code_ventilation, 'codeventil', 1);\n\t\t\tprint '</td></tr>';\n\t\t\tprint '</table>';\n\n\t\t\tdol_fiche_end();\n\n\t\t\tprint '<div class=\"center\">';\n\t\t\tprint '<input class=\"button\" type=\"submit\" value=\"'.$langs->trans(\"Save\").'\">';\n\t\t\tprint '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';\n\t\t\tprint '<input class=\"button\" type=\"submit\" name=\"cancel\" value=\"'.$langs->trans(\"Cancel\").'\">';\n\t\t\tprint '</div>';\n\n\t\t\tprint '</form>';\n\t\t} else {\n\t\t\tprint \"Error\";\n\t\t}\n\t} else {\n\t\tprint \"Error\";\n\t}\n} else {\n\tprint \"Error ID incorrect\";\n}\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2004       Rodolphe Quiedeville  <rodolphe@quiedeville.org>\n * Copyright (C) 2005       Simon TOSSER          <simon@kornog-computing.com>\n * Copyright (C) 2013-2017  Alexandre Spangaro    <aspangaro@open-dsi.fr>\n * Copyright (C) 2013-2014  Olivier Geffroy       <jeff@jeffinfo.com>\n * Copyright (C) 2013-2014  Florian Henry         <florian.henry@open-concept.pro>\n * Copyright (C) 2014       Juanjo Menent         <jmenent@2byte.es>\n * Copyright (C) 2015       Jean-Fran\u00e7ois Ferry   <jfefe@aternatik.fr>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n *\n */\n/**\n * \\file \thtdocs/accountancy/supplier/card.php\n * \\ingroup Accountancy (Double entries)\n * \\brief \tCard supplier ventilation\n */\nrequire '../../main.inc.php';\n\nrequire_once DOL_DOCUMENT_ROOT.'/fourn/class/fournisseur.facture.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/class/html.formaccounting.class.php';\n\n// Load translation files required by the page\n$langs->loadLangs(array(\"bills\", \"accountancy\"));\n\n$action = GETPOST('action', 'alpha');\n$cancel = GETPOST('cancel', 'alpha');\n$backtopage = GETPOST('backtopage', 'alpha');\n\n$codeventil = GETPOST('codeventil');\n$id = GETPOST('id');\n\n// Security check\nif ($user->socid > 0)\n\taccessforbidden();\n\n\n/*\n * Actions\n */\n\nif ($action == 'ventil' && $user->rights->accounting->bind->write)\n{\n\tif (!$cancel)\n\t{\n\t    if ($codeventil < 0) $codeventil = 0;\n\n\t\t$sql = \" UPDATE \".MAIN_DB_PREFIX.\"facture_fourn_det\";\n\t\t$sql .= \" SET fk_code_ventilation = \".$codeventil;\n\t\t$sql .= \" WHERE rowid = \".$id;\n\n\t\t$resql = $db->query($sql);\n\t\tif (!$resql) {\n\t\t\tsetEventMessages($db->lasterror(), null, 'errors');\n\t\t}\n\t\telse\n\t\t{\n\t\t    setEventMessages($langs->trans(\"RecordModifiedSuccessfully\"), null, 'mesgs');\n\t\t    if ($backtopage)\n\t\t    {\n\t\t    \theader(\"Location: \".$backtopage);\n\t\t    \texit();\n\t\t    }\n\t\t}\n\t} else {\n\t\theader(\"Location: ./lines.php\");\n\t\texit();\n\t}\n}\n\n\n\n/*\n * View\n */\nllxHeader(\"\", $langs->trans('FicheVentilation'));\n\nif ($cancel == $langs->trans(\"Cancel\")) {\n\t$action = '';\n}\n\n// Create\n$form = new Form($db);\n$facturefournisseur_static = new FactureFournisseur($db);\n$formaccounting = new FormAccounting($db);\n\nif (!empty($id)) {\n\t$sql = \"SELECT f.ref as ref, f.rowid as facid, l.fk_product, l.description, l.rowid, l.fk_code_ventilation, \";\n\t$sql .= \" p.rowid as product_id, p.ref as product_ref, p.label as product_label\";\n\t$sql .= \", aa.account_number, aa.label\";\n\t$sql .= \" FROM \".MAIN_DB_PREFIX.\"facture_fourn_det as l\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"product as p ON p.rowid = l.fk_product\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"accounting_account as aa ON l.fk_code_ventilation = aa.rowid\";\n\t$sql .= \" INNER JOIN \".MAIN_DB_PREFIX.\"facture_fourn as f ON f.rowid = l.fk_facture_fourn \";\n\t$sql .= \" WHERE f.fk_statut > 0 AND l.rowid = \".$id;\n\t$sql .= \" AND f.entity IN (\".getEntity('facture_fourn', 0).\")\"; // We don't share object for accountancy\n\n\tdol_syslog(\"/accounting/supplier/card.php sql=\".$sql, LOG_DEBUG);\n\t$result = $db->query($sql);\n\n\tif ($result) {\n\t\t$num_lines = $db->num_rows($result);\n\t\t$i = 0;\n\n\t\tif ($num_lines) {\n\t\t\t$objp = $db->fetch_object($result);\n\n\t\t\tprint '<form action=\"'.$_SERVER[\"PHP_SELF\"].'?id='.$id.'\" method=\"post\">'.\"\\n\";\n\t\t\tprint '<input type=\"hidden\" name=\"token\" value=\"'.newToken().'\">';\n\t\t\tprint '<input type=\"hidden\" name=\"action\" value=\"ventil\">';\n\t\t\tprint '<input type=\"hidden\" name=\"backtopage\" value=\"'.dol_escape_htmltag($backtopage).'\">';\n\n\t\t\tprint load_fiche_titre($langs->trans('SuppliersVentilation'), '', 'title_accountancy');\n\n\t\t\tdol_fiche_head();\n\n\t\t\tprint '<table class=\"border centpercent\">';\n\n\t\t\t// ref invoice\n\t\t\tprint '<tr><td>'.$langs->trans(\"BillsSuppliers\").'</td>';\n\t\t\t$facturefournisseur_static->ref = $objp->ref;\n\t\t\t$facturefournisseur_static->id = $objp->facid;\n\t\t\tprint '<td>'.$facturefournisseur_static->getNomUrl(1).'</td>';\n\t\t\tprint '</tr>';\n\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"Line\").'</td>';\n\t\t\tprint '<td>'.stripslashes(nl2br($objp->description)).'</td></tr>';\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"ProductLabel\").'</td>';\n\t\t\tprint '<td>'.dol_trunc($objp->product_label, 24).'</td>';\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"Account\").'</td><td>';\n\t\t\tprint $formaccounting->select_account($objp->fk_code_ventilation, 'codeventil', 1);\n\t\t\tprint '</td></tr>';\n\t\t\tprint '</table>';\n\n\t\t\tdol_fiche_end();\n\n\t\t\tprint '<div class=\"center\">';\n\t\t\tprint '<input class=\"button\" type=\"submit\" value=\"'.$langs->trans(\"Save\").'\">';\n\t\t\tprint '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';\n\t\t\tprint '<input class=\"button\" type=\"submit\" name=\"cancel\" value=\"'.$langs->trans(\"Cancel\").'\">';\n\t\t\tprint '</div>';\n\n\t\t\tprint '</form>';\n\t\t} else {\n\t\t\tprint \"Error\";\n\t\t}\n\t} else {\n\t\tprint \"Error\";\n\t}\n} else {\n\tprint \"Error ID incorrect\";\n}\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2009 Laurent Destailleur  <eldy@users.sourceforge.net>\n * Copyright (C) 2010 Regis Houssin        <regis.houssin@inodbox.com>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n *      \\file       htdocs/comm/mailing/info.php\n *      \\ingroup    mailing\n *\t\t\\brief      Page with log information for emailing\n */\n\nrequire '../../main.inc.php';\nrequire_once DOL_DOCUMENT_ROOT.'/comm/mailing/class/mailing.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/lib/functions2.lib.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/lib/emailing.lib.php';\n\n$id = GETPOST('id');\n\n// Load translation files required by the page\n$langs->load(\"mails\");\n\n// Security check\nif (!$user->rights->mailing->lire || $user->socid > 0)\naccessforbidden();\n\n\n\n/*\n * View\n */\n\nllxHeader('', $langs->trans(\"Mailing\"), 'EN:Module_EMailing|FR:Module_Mailing|ES:M&oacute;dulo_Mailing');\n\n$form = new Form($db);\n\n$object = new Mailing($db);\n\nif ($object->fetch($id) >= 0)\n{\n\t$head = emailing_prepare_head($object);\n\n\tdol_fiche_head($head, 'info', $langs->trans(\"Mailing\"), -1, 'email');\n\n\t$linkback = '<a href=\"'.DOL_URL_ROOT.'/comm/mailing/list.php?restore_lastsearch_values=1\">'.$langs->trans(\"BackToList\").'</a>';\n\n\t$morehtmlright = '';\n\t$nbtry = $nbok = 0;\n\tif ($object->statut == 2 || $object->statut == 3)\n\t{\n\t\t$nbtry = $object->countNbOfTargets('alreadysent');\n\t\t$nbko  = $object->countNbOfTargets('alreadysentko');\n\n\t\t$morehtmlright .= ' ('.$nbtry.'/'.$object->nbemail;\n\t\tif ($nbko) $morehtmlright .= ' - '.$nbko.' '.$langs->trans(\"Error\");\n\t\t$morehtmlright .= ') &nbsp; ';\n\t}\n\n\tdol_banner_tab($object, 'id', $linkback, 1, 'rowid', 'ref', '', '', 0, '', $morehtmlright);\n\n\tprint '<div class=\"underbanner clearboth\"></div><br>';\n\n\t//print '<table width=\"100%\"><tr><td>';\n\t$object->user_creation = $object->user_creat;\n\t$object->date_creation = $object->date_creat;\n\t$object->user_validation = $object->user_valid;\n\t$object->date_validation = $object->date_valid;\n\tdol_print_object_info($object, 0);\n\t//print '</td></tr></table>';\n\n\n\tdol_fiche_end();\n}\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2004      Rodolphe Quiedeville <rodolphe@quiedeville.org>\n * Copyright (C) 2004-2009 Laurent Destailleur  <eldy@users.sourceforge.net>\n * Copyright (C) 2013\t\tMarcos Garc\u00eda\t\t<marcosgdf@gmail.com>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n *   \t\\file       htdocs/compta/paiement/info.php\n *\t\t\\ingroup    facture\n *\t\t\\brief      Onglet info d'un paiement\n */\n\nrequire '../../main.inc.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/lib/functions2.lib.php';\nrequire_once DOL_DOCUMENT_ROOT.'/compta/paiement/class/paiement.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/lib/payments.lib.php';\n\n// Load translation files required by the page\n$langs->loadLangs(array('bills', 'companies'));\n\n$id = GETPOST('id');\n$ref = GETPOST('ref', 'alpha');\n$action = GETPOST('action', 'alpha');\n$confirm = GETPOST('confirm', 'alpha');\n\n/*\n * Actions\n */\n\n// None\n\n\n/*\n * View\n */\n\nllxHeader('', $langs->trans(\"Payment\"));\n\n$object = new Paiement($db);\n$object->fetch($id, $ref);\n$object->info($object->id);\n\n$head = payment_prepare_head($object);\n\ndol_fiche_head($head, 'info', $langs->trans(\"PaymentCustomerInvoice\"), -1, 'payment');\n\n\n$linkback = '<a href=\"'.DOL_URL_ROOT.'/compta/paiement/list.php?restore_lastsearch_values=1\">'.$langs->trans(\"BackToList\").'</a>';\n\ndol_banner_tab($object, 'ref', $linkback, 1, 'ref', 'ref', '');\n\n\nprint '<div class=\"fichecenter\">';\nprint '<div class=\"underbanner clearboth\"></div>';\n\nprint '<br>';\n\nprint '<table width=\"100%\"><tr><td>';\ndol_print_object_info($object);\nprint '</td></tr></table>';\n\nprint '</div>';\n\ndol_fiche_end();\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2016\tMarcos Garc\u00eda\t<marcosgdf@gmail.com>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\nif (! defined('NOTOKENRENEWAL')) define('NOTOKENRENEWAL', '1');\nif (! defined('NOREQUIREMENU'))  define('NOREQUIREMENU', '1');\nif (! defined('NOREQUIREHTML'))  define('NOREQUIREHTML', '1');\nif (! defined('NOREQUIREAJAX'))  define('NOREQUIREAJAX', '1');\nif (! defined('NOREQUIRESOC'))   define('NOREQUIRESOC', '1');\n\nrequire '../../main.inc.php';\nrequire_once DOL_DOCUMENT_ROOT.'/product/class/product.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/variants/class/ProductAttribute.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/variants/class/ProductAttributeValue.class.php';\n\nheader('Content-Type: application/json');\n\n$id = GETPOST('id');\n\nif (!$id) {\n    print json_encode(array(\n        'error' => 'ID not set'\n    ));\n    exit();\n}\n\n$prodattr = new ProductAttribute($db);\n\nif ($prodattr->fetch($id) < 0) {\n    print json_encode(array(\n        'error' => 'Attribute not found'\n    ));\n    exit();\n}\n\n$prodattrval = new ProductAttributeValue($db);\n\n$res = $prodattrval->fetchAllByProductAttribute($id);\n\nif ($res == -1) {\n    print json_encode(array(\n        'error' => 'Internal error'\n    ));\n    exit();\n}\n\nprint json_encode($res);\n"], "fixing_code": ["<?php\n/* Copyright (C) 2013-2014 Olivier Geffroy\t\t<jeff@jeffinfo.com>\n * Copyright (C) 2013-2014 Florian Henry\t\t<florian.henry@open-concept.pro>\n * Copyright (C) 2013-2017 Alexandre Spangaro\t<aspangaro@open-dsi.fr>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n * \\file \thtdocs/accountancy/customer/card.php\n * \\ingroup Accountancy (Double entries)\n * \\brief \tCard customer ventilation\n */\nrequire '../../main.inc.php';\n\nrequire_once DOL_DOCUMENT_ROOT.'/compta/facture/class/facture.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/class/html.formaccounting.class.php';\n\n// Load translation files required by the page\n$langs->loadLangs(array(\"bills\", \"accountancy\"));\n\n$action = GETPOST('action', 'alpha');\n$cancel = GETPOST('cancel', 'alpha');\n$backtopage = GETPOST('backtopage', 'alpha');\n\n$codeventil = GETPOST('codeventil', 'int');\n$id = GETPOST('id', 'int');\n\n// Security check\nif ($user->socid > 0)\n\taccessforbidden();\n\n\n/*\n * Actions\n */\n\nif ($action == 'ventil' && $user->rights->accounting->bind->write)\n{\n\tif (!$cancel)\n\t{\n\t    if ($codeventil < 0) $codeventil = 0;\n\n\t\t$sql = \" UPDATE \".MAIN_DB_PREFIX.\"facturedet\";\n\t\t$sql .= \" SET fk_code_ventilation = \".$codeventil;\n\t\t$sql .= \" WHERE rowid = \".$id;\n\n\t\t$resql = $db->query($sql);\n\t\tif (!$resql) {\n\t\t\tsetEventMessages($db->lasterror(), null, 'errors');\n\t\t}\n\t\telse\n\t\t{\n\t\t    setEventMessages($langs->trans(\"RecordModifiedSuccessfully\"), null, 'mesgs');\n\t\t    if ($backtopage)\n\t\t    {\n\t\t    \theader(\"Location: \".$backtopage);\n\t\t    \texit();\n\t\t    }\n\t\t}\n\t} else {\n\t\theader(\"Location: ./lines.php\");\n\t\texit();\n\t}\n}\n\n\n/*\n * View\n */\n\nllxHeader(\"\", $langs->trans('FicheVentilation'));\n\nif ($cancel == $langs->trans(\"Cancel\")) {\n\t$action = '';\n}\n\n/*\n * Create\n */\n$form = new Form($db);\n$facture_static = new Facture($db);\n$formaccounting = new FormAccounting($db);\n\nif (!empty($id)) {\n\t$sql = \"SELECT f.ref, f.rowid as facid, l.fk_product, l.description, l.price,\";\n\t$sql .= \" l.qty, l.rowid, l.tva_tx, l.remise_percent, l.subprice, p.accountancy_code_sell as code_sell,\";\n\t$sql .= \" l.fk_code_ventilation, aa.account_number, aa.label\";\n\t$sql .= \" FROM \".MAIN_DB_PREFIX.\"facturedet as l\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"product as p ON p.rowid = l.fk_product\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"accounting_account as aa ON l.fk_code_ventilation = aa.rowid\";\n\t$sql .= \" INNER JOIN \".MAIN_DB_PREFIX.\"facture as f ON f.rowid = l.fk_facture\";\n\t$sql .= \" WHERE f.fk_statut > 0 AND l.rowid = \".$id;\n\t$sql .= \" AND f.entity IN (\".getEntity('invoice', 0).\")\"; // We don't share object for accountancy\n\n\tdol_syslog(\"/accounting/customer/card.php sql=\".$sql, LOG_DEBUG);\n\t$result = $db->query($sql);\n\n\tif ($result) {\n\t\t$num_lines = $db->num_rows($result);\n\t\t$i = 0;\n\n\t\tif ($num_lines) {\n\t\t\t$objp = $db->fetch_object($result);\n\n\t\t\tprint '<form action=\"'.$_SERVER[\"PHP_SELF\"].'?id='.$id.'\" method=\"post\">'.\"\\n\";\n\t\t\tprint '<input type=\"hidden\" name=\"token\" value=\"'.newToken().'\">';\n\t\t\tprint '<input type=\"hidden\" name=\"action\" value=\"ventil\">';\n\t\t\tprint '<input type=\"hidden\" name=\"backtopage\" value=\"'.dol_escape_htmltag($backtopage).'\">';\n\n\t\t\tprint load_fiche_titre($langs->trans('CustomersVentilation'), '', 'title_accountancy');\n\n\t\t\tdol_fiche_head();\n\n\t\t\tprint '<table class=\"border centpercent\">';\n\n\t\t\t// Ref facture\n\t\t\tprint '<tr><td>'.$langs->trans(\"Invoice\").'</td>';\n\t\t\t$facture_static->ref = $objp->ref;\n\t\t\t$facture_static->id = $objp->facid;\n\t\t\tprint '<td>'.$facture_static->getNomUrl(1).'</td>';\n\t\t\tprint '</tr>';\n\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"Line\").'</td>';\n\t\t\tprint '<td>'.nl2br($objp->description).'</td></tr>';\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"Account\").'</td><td>';\n\t\t\tprint $formaccounting->select_account($objp->fk_code_ventilation, 'codeventil', 1);\n\t\t\tprint '</td></tr>';\n\t\t\tprint '</table>';\n\n\t\t\tdol_fiche_end();\n\n\t\t\tprint '<div class=\"center\">';\n\t\t\tprint '<input class=\"button\" type=\"submit\" value=\"'.$langs->trans(\"Save\").'\">';\n\t\t\tprint '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';\n\t\t\tprint '<input class=\"button\" type=\"submit\" name=\"cancel\" value=\"'.$langs->trans(\"Cancel\").'\">';\n\t\t\tprint '</div>';\n\n\t\t\tprint '</form>';\n\t\t} else {\n\t\t\tprint \"Error\";\n\t\t}\n\t} else {\n\t\tprint \"Error\";\n\t}\n} else {\n\tprint \"Error ID incorrect\";\n}\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2004\t\tRodolphe Quiedeville\t<rodolphe@quiedeville.org>\n * Copyright (C) 2005\t\tSimon TOSSER\t\t\t<simon@kornog-computing.com>\n * Copyright (C) 2013-2017\tAlexandre Spangaro\t\t<aspangaro@open-dsi.fr>\n * Copyright (C) 2013-2014\tOlivier Geffroy\t\t\t<jeff@jeffinfo.com>\n * Copyright (C) 2013-2014\tFlorian Henry\t\t\t<florian.henry@open-concept.pro>\n * Copyright (C) 2014\t\tJuanjo Menent\t\t\t<jmenent@2byte.es>\n * Copyright (C) 2015\t\tJean-Fran\u00e7ois Ferry\t\t<jfefe@aternatik.fr>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n *\n */\n/**\n * \\file\t\thtdocs/accountancy/supplier/card.php\n * \\ingroup\t\tAccountancy (Double entries)\n * \\brief\t\tCard expense report ventilation\n */\nrequire '../../main.inc.php';\n\nrequire_once DOL_DOCUMENT_ROOT.'/expensereport/class/expensereport.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/class/html.formaccounting.class.php';\n\n// Load translation files required by the page\n$langs->loadLangs(array(\"bills\", \"accountancy\", \"trips\"));\n\n$action = GETPOST('action', 'alpha');\n$cancel = GETPOST('cancel', 'alpha');\n$backtopage = GETPOST('backtopage', 'alpha');\n\n$codeventil = GETPOST('codeventil', 'int');\n$id = GETPOST('id', 'int');\n\n// Security check\nif ($user->socid > 0)\n\taccessforbidden();\n\n\n/*\n * Actions\n */\n\nif ($action == 'ventil' && $user->rights->accounting->bind->write)\n{\n\tif (!$cancel)\n\t{\n\t\tif ($codeventil < 0) $codeventil = 0;\n\n\t\t$sql = \" UPDATE \".MAIN_DB_PREFIX.\"expensereport_det\";\n\t\t$sql .= \" SET fk_code_ventilation = \".$codeventil;\n\t\t$sql .= \" WHERE rowid = \".$id;\n\n\t\t$resql = $db->query($sql);\n\t\tif (!$resql) {\n\t\t\tsetEventMessages($db->lasterror(), null, 'errors');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsetEventMessages($langs->trans(\"RecordModifiedSuccessfully\"), null, 'mesgs');\n\t\t\tif ($backtopage)\n\t\t\t{\n\t\t\t\theader(\"Location: \".$backtopage);\n\t\t\t\texit();\n\t\t\t}\n\t\t}\n\t} else {\n\t\theader(\"Location: ./lines.php\");\n\t\texit();\n\t}\n}\n\n\n\n/*\n * View\n */\nllxHeader(\"\", $langs->trans('FicheVentilation'));\n\nif ($cancel == $langs->trans(\"Cancel\")) {\n\t$action = '';\n}\n\n// Create\n$form = new Form($db);\n$expensereport_static = new ExpenseReport($db);\n$formaccounting = new FormAccounting($db);\n\nif (!empty($id)) {\n\t$sql = \"SELECT er.ref, er.rowid as facid, erd.fk_c_type_fees, erd.comments, erd.rowid, erd.fk_code_ventilation,\";\n\t$sql .= \" f.id as type_fees_id, f.code as type_fees_code, f.label as type_fees_label,\";\n\t$sql .= \" aa.account_number, aa.label\";\n\t$sql .= \" FROM \".MAIN_DB_PREFIX.\"expensereport_det as erd\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"c_type_fees as f ON f.id = erd.fk_c_type_fees\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"accounting_account as aa ON erd.fk_code_ventilation = aa.rowid\";\n\t$sql .= \" INNER JOIN \".MAIN_DB_PREFIX.\"expensereport as er ON er.rowid = erd.fk_expensereport\";\n\t$sql .= \" WHERE er.fk_statut > 0 AND erd.rowid = \".$id;\n\t$sql .= \" AND er.entity IN (\".getEntity('expensereport', 0).\")\"; // We don't share object for accountancy\n\n\tdol_syslog(\"/accounting/expensereport/card.php sql=\".$sql, LOG_DEBUG);\n\t$result = $db->query($sql);\n\n\tif ($result) {\n\t\t$num_lines = $db->num_rows($result);\n\t\t$i = 0;\n\n\t\tif ($num_lines) {\n\t\t\t$objp = $db->fetch_object($result);\n\n\t\t\tprint '<form action=\"'.$_SERVER[\"PHP_SELF\"].'?id='.$id.'\" method=\"post\">'.\"\\n\";\n\t\t\tprint '<input type=\"hidden\" name=\"token\" value=\"'.newToken().'\">';\n\t\t\tprint '<input type=\"hidden\" name=\"action\" value=\"ventil\">';\n\t\t\tprint '<input type=\"hidden\" name=\"backtopage\" value=\"'.dol_escape_htmltag($backtopage).'\">';\n\n\t\t\tprint load_fiche_titre($langs->trans('ExpenseReportsVentilation'), '', 'title_accountancy');\n\n\t\t\tdol_fiche_head();\n\n\t\t\tprint '<table class=\"border centpercent\">';\n\n\t\t\t// Ref\n\t\t\tprint '<tr><td class=\"titlefield\">'.$langs->trans(\"ExpenseReport\").'</td>';\n\t\t\t$expensereport_static->ref = $objp->ref;\n\t\t\t$expensereport_static->id = $objp->erid;\n\t\t\tprint '<td>'.$expensereport_static->getNomUrl(1).'</td>';\n\t\t\tprint '</tr>';\n\n\t\t\tprint '<tr><td>'.$langs->trans(\"Line\").'</td>';\n\t\t\tprint '<td>'.stripslashes(nl2br($objp->rowid)).'</td></tr>';\n\n\t\t\tprint '<tr><td>'.$langs->trans(\"Description\").'</td>';\n\t\t\tprint '<td>'.stripslashes(nl2br($objp->comments)).'</td></tr>';\n\n\t\t\tprint '<tr><td>'.$langs->trans(\"TypeFees\").'</td>';\n\t\t\tprint '<td>'.($langs->trans($objp->type_fees_code) == $objp->type_fees_code ? $objp->type_fees_label : $langs->trans(($objp->type_fees_code))).'</td>';\n\n\t\t\tprint '<tr><td>'.$langs->trans(\"Account\").'</td><td>';\n\t\t\tprint $formaccounting->select_account($objp->fk_code_ventilation, 'codeventil', 1);\n\t\t\tprint '</td></tr>';\n\t\t\tprint '</table>';\n\n\t\t\tdol_fiche_end();\n\n\t\t\tprint '<div class=\"center\">';\n\t\t\tprint '<input class=\"button\" type=\"submit\" value=\"'.$langs->trans(\"Save\").'\">';\n\t\t\tprint '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';\n\t\t\tprint '<input class=\"button\" type=\"submit\" name=\"cancel\" value=\"'.$langs->trans(\"Cancel\").'\">';\n\t\t\tprint '</div>';\n\n\t\t\tprint '</form>';\n\t\t} else {\n\t\t\tprint \"Error\";\n\t\t}\n\t} else {\n\t\tprint \"Error\";\n\t}\n} else {\n\tprint \"Error ID incorrect\";\n}\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2004       Rodolphe Quiedeville  <rodolphe@quiedeville.org>\n * Copyright (C) 2005       Simon TOSSER          <simon@kornog-computing.com>\n * Copyright (C) 2013-2017  Alexandre Spangaro    <aspangaro@open-dsi.fr>\n * Copyright (C) 2013-2014  Olivier Geffroy       <jeff@jeffinfo.com>\n * Copyright (C) 2013-2014  Florian Henry         <florian.henry@open-concept.pro>\n * Copyright (C) 2014       Juanjo Menent         <jmenent@2byte.es>\n * Copyright (C) 2015       Jean-Fran\u00e7ois Ferry   <jfefe@aternatik.fr>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n *\n */\n/**\n * \\file \thtdocs/accountancy/supplier/card.php\n * \\ingroup Accountancy (Double entries)\n * \\brief \tCard supplier ventilation\n */\nrequire '../../main.inc.php';\n\nrequire_once DOL_DOCUMENT_ROOT.'/fourn/class/fournisseur.facture.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/class/html.formaccounting.class.php';\n\n// Load translation files required by the page\n$langs->loadLangs(array(\"bills\", \"accountancy\"));\n\n$action = GETPOST('action', 'alpha');\n$cancel = GETPOST('cancel', 'alpha');\n$backtopage = GETPOST('backtopage', 'alpha');\n\n$codeventil = GETPOST('codeventil', 'int');\n$id = GETPOST('id', 'int');\n\n// Security check\nif ($user->socid > 0)\n\taccessforbidden();\n\n\n/*\n * Actions\n */\n\nif ($action == 'ventil' && $user->rights->accounting->bind->write)\n{\n\tif (!$cancel)\n\t{\n\t    if ($codeventil < 0) $codeventil = 0;\n\n\t\t$sql = \" UPDATE \".MAIN_DB_PREFIX.\"facture_fourn_det\";\n\t\t$sql .= \" SET fk_code_ventilation = \".$codeventil;\n\t\t$sql .= \" WHERE rowid = \".$id;\n\n\t\t$resql = $db->query($sql);\n\t\tif (!$resql) {\n\t\t\tsetEventMessages($db->lasterror(), null, 'errors');\n\t\t}\n\t\telse\n\t\t{\n\t\t    setEventMessages($langs->trans(\"RecordModifiedSuccessfully\"), null, 'mesgs');\n\t\t    if ($backtopage)\n\t\t    {\n\t\t    \theader(\"Location: \".$backtopage);\n\t\t    \texit();\n\t\t    }\n\t\t}\n\t} else {\n\t\theader(\"Location: ./lines.php\");\n\t\texit();\n\t}\n}\n\n\n\n/*\n * View\n */\nllxHeader(\"\", $langs->trans('FicheVentilation'));\n\nif ($cancel == $langs->trans(\"Cancel\")) {\n\t$action = '';\n}\n\n// Create\n$form = new Form($db);\n$facturefournisseur_static = new FactureFournisseur($db);\n$formaccounting = new FormAccounting($db);\n\nif (!empty($id)) {\n\t$sql = \"SELECT f.ref as ref, f.rowid as facid, l.fk_product, l.description, l.rowid, l.fk_code_ventilation, \";\n\t$sql .= \" p.rowid as product_id, p.ref as product_ref, p.label as product_label\";\n\t$sql .= \", aa.account_number, aa.label\";\n\t$sql .= \" FROM \".MAIN_DB_PREFIX.\"facture_fourn_det as l\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"product as p ON p.rowid = l.fk_product\";\n\t$sql .= \" LEFT JOIN \".MAIN_DB_PREFIX.\"accounting_account as aa ON l.fk_code_ventilation = aa.rowid\";\n\t$sql .= \" INNER JOIN \".MAIN_DB_PREFIX.\"facture_fourn as f ON f.rowid = l.fk_facture_fourn \";\n\t$sql .= \" WHERE f.fk_statut > 0 AND l.rowid = \".$id;\n\t$sql .= \" AND f.entity IN (\".getEntity('facture_fourn', 0).\")\"; // We don't share object for accountancy\n\n\tdol_syslog(\"/accounting/supplier/card.php sql=\".$sql, LOG_DEBUG);\n\t$result = $db->query($sql);\n\n\tif ($result) {\n\t\t$num_lines = $db->num_rows($result);\n\t\t$i = 0;\n\n\t\tif ($num_lines) {\n\t\t\t$objp = $db->fetch_object($result);\n\n\t\t\tprint '<form action=\"'.$_SERVER[\"PHP_SELF\"].'?id='.$id.'\" method=\"post\">'.\"\\n\";\n\t\t\tprint '<input type=\"hidden\" name=\"token\" value=\"'.newToken().'\">';\n\t\t\tprint '<input type=\"hidden\" name=\"action\" value=\"ventil\">';\n\t\t\tprint '<input type=\"hidden\" name=\"backtopage\" value=\"'.dol_escape_htmltag($backtopage).'\">';\n\n\t\t\tprint load_fiche_titre($langs->trans('SuppliersVentilation'), '', 'title_accountancy');\n\n\t\t\tdol_fiche_head();\n\n\t\t\tprint '<table class=\"border centpercent\">';\n\n\t\t\t// ref invoice\n\t\t\tprint '<tr><td>'.$langs->trans(\"BillsSuppliers\").'</td>';\n\t\t\t$facturefournisseur_static->ref = $objp->ref;\n\t\t\t$facturefournisseur_static->id = $objp->facid;\n\t\t\tprint '<td>'.$facturefournisseur_static->getNomUrl(1).'</td>';\n\t\t\tprint '</tr>';\n\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"Line\").'</td>';\n\t\t\tprint '<td>'.stripslashes(nl2br($objp->description)).'</td></tr>';\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"ProductLabel\").'</td>';\n\t\t\tprint '<td>'.dol_trunc($objp->product_label, 24).'</td>';\n\t\t\tprint '<tr><td width=\"20%\">'.$langs->trans(\"Account\").'</td><td>';\n\t\t\tprint $formaccounting->select_account($objp->fk_code_ventilation, 'codeventil', 1);\n\t\t\tprint '</td></tr>';\n\t\t\tprint '</table>';\n\n\t\t\tdol_fiche_end();\n\n\t\t\tprint '<div class=\"center\">';\n\t\t\tprint '<input class=\"button\" type=\"submit\" value=\"'.$langs->trans(\"Save\").'\">';\n\t\t\tprint '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';\n\t\t\tprint '<input class=\"button\" type=\"submit\" name=\"cancel\" value=\"'.$langs->trans(\"Cancel\").'\">';\n\t\t\tprint '</div>';\n\n\t\t\tprint '</form>';\n\t\t} else {\n\t\t\tprint \"Error\";\n\t\t}\n\t} else {\n\t\tprint \"Error\";\n\t}\n} else {\n\tprint \"Error ID incorrect\";\n}\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2009 Laurent Destailleur  <eldy@users.sourceforge.net>\n * Copyright (C) 2010 Regis Houssin        <regis.houssin@inodbox.com>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n *      \\file       htdocs/comm/mailing/info.php\n *      \\ingroup    mailing\n *\t\t\\brief      Page with log information for emailing\n */\n\nrequire '../../main.inc.php';\nrequire_once DOL_DOCUMENT_ROOT.'/comm/mailing/class/mailing.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/lib/functions2.lib.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/lib/emailing.lib.php';\n\n$id = GETPOST('id', 'int');\n\n// Load translation files required by the page\n$langs->load(\"mails\");\n\n// Security check\nif (!$user->rights->mailing->lire || $user->socid > 0)\naccessforbidden();\n\n\n\n/*\n * View\n */\n\nllxHeader('', $langs->trans(\"Mailing\"), 'EN:Module_EMailing|FR:Module_Mailing|ES:M&oacute;dulo_Mailing');\n\n$form = new Form($db);\n\n$object = new Mailing($db);\n\nif ($object->fetch($id) >= 0)\n{\n\t$head = emailing_prepare_head($object);\n\n\tdol_fiche_head($head, 'info', $langs->trans(\"Mailing\"), -1, 'email');\n\n\t$linkback = '<a href=\"'.DOL_URL_ROOT.'/comm/mailing/list.php?restore_lastsearch_values=1\">'.$langs->trans(\"BackToList\").'</a>';\n\n\t$morehtmlright = '';\n\t$nbtry = $nbok = 0;\n\tif ($object->statut == 2 || $object->statut == 3)\n\t{\n\t\t$nbtry = $object->countNbOfTargets('alreadysent');\n\t\t$nbko  = $object->countNbOfTargets('alreadysentko');\n\n\t\t$morehtmlright .= ' ('.$nbtry.'/'.$object->nbemail;\n\t\tif ($nbko) $morehtmlright .= ' - '.$nbko.' '.$langs->trans(\"Error\");\n\t\t$morehtmlright .= ') &nbsp; ';\n\t}\n\n\tdol_banner_tab($object, 'id', $linkback, 1, 'rowid', 'ref', '', '', 0, '', $morehtmlright);\n\n\tprint '<div class=\"underbanner clearboth\"></div><br>';\n\n\t//print '<table width=\"100%\"><tr><td>';\n\t$object->user_creation = $object->user_creat;\n\t$object->date_creation = $object->date_creat;\n\t$object->user_validation = $object->user_valid;\n\t$object->date_validation = $object->date_valid;\n\tdol_print_object_info($object, 0);\n\t//print '</td></tr></table>';\n\n\n\tdol_fiche_end();\n}\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2004      Rodolphe Quiedeville <rodolphe@quiedeville.org>\n * Copyright (C) 2004-2009 Laurent Destailleur  <eldy@users.sourceforge.net>\n * Copyright (C) 2013\t\tMarcos Garc\u00eda\t\t<marcosgdf@gmail.com>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\n/**\n *   \t\\file       htdocs/compta/paiement/info.php\n *\t\t\\ingroup    facture\n *\t\t\\brief      Onglet info d'un paiement\n */\n\nrequire '../../main.inc.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/lib/functions2.lib.php';\nrequire_once DOL_DOCUMENT_ROOT.'/compta/paiement/class/paiement.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/core/lib/payments.lib.php';\n\n// Load translation files required by the page\n$langs->loadLangs(array('bills', 'companies'));\n\n$id = GETPOST('id', 'int');\n$ref = GETPOST('ref', 'alpha');\n$action = GETPOST('action', 'alpha');\n$confirm = GETPOST('confirm', 'alpha');\n\n/*\n * Actions\n */\n\n// None\n\n\n/*\n * View\n */\n\nllxHeader('', $langs->trans(\"Payment\"));\n\n$object = new Paiement($db);\n$object->fetch($id, $ref);\n$object->info($object->id);\n\n$head = payment_prepare_head($object);\n\ndol_fiche_head($head, 'info', $langs->trans(\"PaymentCustomerInvoice\"), -1, 'payment');\n\n\n$linkback = '<a href=\"'.DOL_URL_ROOT.'/compta/paiement/list.php?restore_lastsearch_values=1\">'.$langs->trans(\"BackToList\").'</a>';\n\ndol_banner_tab($object, 'ref', $linkback, 1, 'ref', 'ref', '');\n\n\nprint '<div class=\"fichecenter\">';\nprint '<div class=\"underbanner clearboth\"></div>';\n\nprint '<br>';\n\nprint '<table width=\"100%\"><tr><td>';\ndol_print_object_info($object);\nprint '</td></tr></table>';\n\nprint '</div>';\n\ndol_fiche_end();\n\n// End of page\nllxFooter();\n$db->close();\n", "<?php\n/* Copyright (C) 2016\tMarcos Garc\u00eda\t<marcosgdf@gmail.com>\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <https://www.gnu.org/licenses/>.\n */\n\nif (! defined('NOTOKENRENEWAL')) define('NOTOKENRENEWAL', '1');\nif (! defined('NOREQUIREMENU'))  define('NOREQUIREMENU', '1');\nif (! defined('NOREQUIREHTML'))  define('NOREQUIREHTML', '1');\nif (! defined('NOREQUIREAJAX'))  define('NOREQUIREAJAX', '1');\nif (! defined('NOREQUIRESOC'))   define('NOREQUIRESOC', '1');\n\nrequire '../../main.inc.php';\nrequire_once DOL_DOCUMENT_ROOT.'/product/class/product.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/variants/class/ProductAttribute.class.php';\nrequire_once DOL_DOCUMENT_ROOT.'/variants/class/ProductAttributeValue.class.php';\n\nheader('Content-Type: application/json');\n\n$id = GETPOST('id', 'int');\n\nif (!$id) {\n    print json_encode(array(\n        'error' => 'ID not set'\n    ));\n    exit();\n}\n\n$prodattr = new ProductAttribute($db);\n\nif ($prodattr->fetch($id) < 0) {\n    print json_encode(array(\n        'error' => 'Attribute not found'\n    ));\n    exit();\n}\n\n$prodattrval = new ProductAttributeValue($db);\n\n$res = $prodattrval->fetchAllByProductAttribute($id);\n\nif ($res == -1) {\n    print json_encode(array(\n        'error' => 'Internal error'\n    ));\n    exit();\n}\n\nprint json_encode($res);\n"], "filenames": ["htdocs/accountancy/customer/card.php", "htdocs/accountancy/expensereport/card.php", "htdocs/accountancy/supplier/card.php", "htdocs/comm/mailing/info.php", "htdocs/compta/paiement/info.php", "htdocs/variants/ajax/get_attribute_values.php"], "buggy_code_start_loc": [37, 41, 41, 30, 34, 31], "buggy_code_end_loc": [39, 43, 43, 31, 35, 32], "fixing_code_start_loc": [37, 41, 41, 30, 34, 31], "fixing_code_end_loc": [39, 43, 43, 31, 35, 32], "type": "CWE-89", "message": "A SQL injection vulnerability in accountancy/customer/card.php in Dolibarr 11.0.3 allows remote authenticated users to execute arbitrary SQL commands via the id parameter.", "other": {"cve": {"id": "CVE-2020-14443", "sourceIdentifier": "cve@mitre.org", "published": "2020-06-18T18:15:11.030", "lastModified": "2020-06-24T19:51:16.790", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A SQL injection vulnerability in accountancy/customer/card.php in Dolibarr 11.0.3 allows remote authenticated users to execute arbitrary SQL commands via the id parameter."}, {"lang": "es", "value": "Una vulnerabilidad de inyecci\u00f3n SQL en el archivo accountancy/customer/card.php en Dolibarr versi\u00f3n 11.0.3, permite a usuarios autenticados remotos ejecutar comandos SQL arbitrarios por medio del par\u00e1metro id"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.5}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-89"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:dolibarr:dolibarr:*:*:*:*:*:*:*:*", "versionEndIncluding": "11.0.3", "matchCriteriaId": "1C548160-7A98-44E9-B548-CEAD63B6663A"}]}]}], "references": [{"url": "https://github.com/Dolibarr/dolibarr/commit/40e16672e3aa4e9208ea7a4829f30507dcdfc4ba", "source": "cve@mitre.org", "tags": ["Patch"]}]}, "github_commit_url": "https://github.com/Dolibarr/dolibarr/commit/40e16672e3aa4e9208ea7a4829f30507dcdfc4ba"}}