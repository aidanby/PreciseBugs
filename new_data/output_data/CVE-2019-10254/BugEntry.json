{"buggy_code": ["<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <?php echo $this->Html->charset(); ?>\n    <meta name=\"viewport\" content=\"width=device-width\" />\n    <title>\n        <?php echo $title_for_layout, ' - '. h(Configure::read('MISP.title_text') ? Configure::read('MISP.title_text') : 'MISP'); ?>\n    </title>\n    <?php\n        echo $this->Html->meta('icon');\n        echo $this->Html->css('bootstrap');\n        //echo $this->Html->css('bootstrap4');\n        echo $this->Html->css('bootstrap-datepicker');\n        echo $this->Html->css('bootstrap-timepicker');\n        echo $this->Html->css('bootstrap-colorpicker');\n        echo $this->Html->css('famfamfam-flags');\n        echo $this->Html->css('font-awesome');\n        if ($me) {\n            echo $this->Html->css('main.css?' . $queryVersion);\n        } else {\n            echo $this->Html->css('main');\n        }\n        if (Configure::read('MISP.custom_css')) {\n            $css = preg_replace('/\\.css$/i', '', Configure::read('MISP.custom_css'));\n            echo $this->Html->css($css);\n        }\n        echo $this->Html->css('print', 'stylesheet', array('media' => 'print'));\n        echo $this->Html->css('jquery-ui');\n        echo $this->Html->script('jquery'); // Include jQuery library\n        echo $this->Html->script('misp-touch'); // touch interface support\n        echo $this->Html->script('jquery-ui'); // UI support\n        echo $this->Html->css('chosen.min');\n        echo $this->Html->script('chosen.jquery.min');\n    ?>\n\n</head>\n<body>\n    <div id=\"popover_form\" class=\"ajax_popover_form\"></div>\n    <div id=\"popover_form_large\" class=\"ajax_popover_form ajax_popover_form_large\"></div>\n    <div id=\"screenshot_box\" class=\"screenshot_box\"></div>\n    <div id=\"confirmation_box\" class=\"confirmation_box\"></div>\n    <div id=\"gray_out\" class=\"gray_out\"></div>\n    <div id=\"container\">\n        <?php\n            echo $this->element('global_menu');\n            $topPadding = '50';\n            if (!empty($debugMode) && $debugMode != 'debugOff') {\n                $topPadding = '0';\n            }\n        ?>\n    </div>\n    <div id=\"flashContainer\" style=\"padding-top:<?php echo $topPadding; ?>px; !important;\">\n        <div id=\"main-view-container\" class=\"container-fluid \">\n            <?php\n                $flash = $this->Flash->render();\n                echo $flash;\n            ?>\n        </div>\n    </div>\n    <div>\n        <?php\n            echo $this->fetch('content');\n        ?>\n    </div>\n    <?php\n    echo $this->element('footer');\n    echo $this->element('sql_dump');\n    echo $this->Html->script('bootstrap');\n    //echo $this->Html->script('bootstrap4');\n    echo $this->Html->script('bootstrap-timepicker');\n    echo $this->Html->script('bootstrap-datepicker');\n    echo $this->Html->script('bootstrap-colorpicker');\n    if ($me) {\n        echo $this->Html->script('misp.js?' . $queryVersion);\n        echo $this->Html->script('keyboard-shortcuts.js?' . $queryVersion);\n    }\n    ?>\n    <div id = \"ajax_success_container\" class=\"ajax_container\">\n        <div id=\"ajax_success\" class=\"ajax_result ajax_success\"></div>\n    </div>\n    <div id = \"ajax_fail_container\" class=\"ajax_container\">\n        <div id=\"ajax_fail\" class=\"ajax_result ajax_fail\"></div>\n    </div>\n    <div class=\"loading\">\n        <div class=\"spinner\"></div>\n        <div class=\"loadingText\"><?php echo __('Loading');?></div>\n    </div>\n\n    <script type=\"text/javascript\">\n    <?php\n        if (!isset($debugMode)):\n    ?>\n        $(window).scroll(function(e) {\n            $('.actions').css('left',-$(window).scrollLeft());\n        });\n    <?php\n        endif;\n    ?>\n        var tabIsActive = true;\n        var baseurl = '<?php echo $baseurl; ?>';\n        var here = '<?php\n                if (substr($this->params['action'], 0, 6) === 'admin_') {\n                    echo $baseurl . '/admin/' . $this->params['controller'] . '/' . substr($this->params['action'], 6);\n                } else {\n                    echo $baseurl . '/' . $this->params['controller'] . '/' . $this->params['action'];\n                }\n            ?>';\n        $(document).ready(function(){\n            $(window).blur(function() {\n                tabIsActive = false;\n            });\n            $(window).focus(function() {\n                tabIsActive = true;\n            });\n        <?php\n            if (!Configure::read('MISP.disable_auto_logout') and $me):\n        ?>\n                checkIfLoggedIn();\n        <?php\n            endif;\n        ?>\n        if ($('.alert').text().indexOf(\"$flashErrorMessage\") >= 0) {\n            //$('#flashErrorMessage').html()\n            var flashMessageLink = '<span class=\"useCursorPointer underline bold\" onClick=\"flashErrorPopover();\">here</span>';\n            $('.alert').html(($('.alert').html().replace(\"$flashErrorMessage\", flashMessageLink)));\n        }\n        });\n    </script>\n</body>\n</html>\n"], "fixing_code": ["<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <?php echo $this->Html->charset(); ?>\n    <meta name=\"viewport\" content=\"width=device-width\" />\n    <title>\n        <?php echo $title_for_layout, ' - '. h(Configure::read('MISP.title_text') ? Configure::read('MISP.title_text') : 'MISP'); ?>\n    </title>\n    <?php\n        echo $this->Html->meta('icon');\n        echo $this->Html->css('bootstrap');\n        //echo $this->Html->css('bootstrap4');\n        echo $this->Html->css('bootstrap-datepicker');\n        echo $this->Html->css('bootstrap-timepicker');\n        echo $this->Html->css('bootstrap-colorpicker');\n        echo $this->Html->css('famfamfam-flags');\n        echo $this->Html->css('font-awesome');\n        if ($me) {\n            echo $this->Html->css('main.css?' . $queryVersion);\n        } else {\n            echo $this->Html->css('main');\n        }\n        if (Configure::read('MISP.custom_css')) {\n            $css = preg_replace('/\\.css$/i', '', Configure::read('MISP.custom_css'));\n            echo $this->Html->css($css);\n        }\n        echo $this->Html->css('print', 'stylesheet', array('media' => 'print'));\n        echo $this->Html->css('jquery-ui');\n        echo $this->Html->script('jquery'); // Include jQuery library\n        echo $this->Html->script('misp-touch'); // touch interface support\n        echo $this->Html->script('jquery-ui'); // UI support\n        echo $this->Html->css('chosen.min');\n        echo $this->Html->script('chosen.jquery.min');\n    ?>\n\n</head>\n<body>\n    <div id=\"popover_form\" class=\"ajax_popover_form\"></div>\n    <div id=\"popover_form_large\" class=\"ajax_popover_form ajax_popover_form_large\"></div>\n    <div id=\"screenshot_box\" class=\"screenshot_box\"></div>\n    <div id=\"confirmation_box\" class=\"confirmation_box\"></div>\n    <div id=\"gray_out\" class=\"gray_out\"></div>\n    <div id=\"container\">\n        <?php\n            echo $this->element('global_menu');\n            $topPadding = '50';\n            if (!empty($debugMode) && $debugMode != 'debugOff') {\n                $topPadding = '0';\n            }\n        ?>\n    </div>\n    <div id=\"flashContainer\" style=\"padding-top:<?php echo $topPadding; ?>px; !important;\">\n        <div id=\"main-view-container\" class=\"container-fluid \">\n            <?php\n                $flash = $this->Flash->render();\n                echo $flash;\n            ?>\n        </div>\n    </div>\n    <div>\n        <?php\n            echo $this->fetch('content');\n        ?>\n    </div>\n    <?php\n    echo $this->element('footer');\n    echo $this->element('sql_dump');\n    echo $this->Html->script('bootstrap');\n    //echo $this->Html->script('bootstrap4');\n    echo $this->Html->script('bootstrap-timepicker');\n    echo $this->Html->script('bootstrap-datepicker');\n    echo $this->Html->script('bootstrap-colorpicker');\n    if ($me) {\n        echo $this->Html->script('misp.js?' . $queryVersion);\n        echo $this->Html->script('keyboard-shortcuts.js?' . $queryVersion);\n    }\n    ?>\n    <div id = \"ajax_success_container\" class=\"ajax_container\">\n        <div id=\"ajax_success\" class=\"ajax_result ajax_success\"></div>\n    </div>\n    <div id = \"ajax_fail_container\" class=\"ajax_container\">\n        <div id=\"ajax_fail\" class=\"ajax_result ajax_fail\"></div>\n    </div>\n    <div class=\"loading\">\n        <div class=\"spinner\"></div>\n        <div class=\"loadingText\"><?php echo __('Loading');?></div>\n    </div>\n\n    <script type=\"text/javascript\">\n    <?php\n        if (!isset($debugMode)):\n    ?>\n        $(window).scroll(function(e) {\n            $('.actions').css('left',-$(window).scrollLeft());\n        });\n    <?php\n        endif;\n    ?>\n        var tabIsActive = true;\n        var baseurl = '<?php echo $baseurl; ?>';\n        var here = '<?php\n                if (substr($this->params['action'], 0, 6) === 'admin_') {\n                    echo $baseurl . '/admin/' . h($this->params['controller']) . '/' . h(substr($this->params['action'], 6));\n                } else {\n                    echo $baseurl . '/' . h($this->params['controller']) . '/' . h($this->params['action']);\n                }\n            ?>';\n        $(document).ready(function(){\n            $(window).blur(function() {\n                tabIsActive = false;\n            });\n            $(window).focus(function() {\n                tabIsActive = true;\n            });\n        <?php\n            if (!Configure::read('MISP.disable_auto_logout') and $me):\n        ?>\n                checkIfLoggedIn();\n        <?php\n            endif;\n        ?>\n        if ($('.alert').text().indexOf(\"$flashErrorMessage\") >= 0) {\n            //$('#flashErrorMessage').html()\n            var flashMessageLink = '<span class=\"useCursorPointer underline bold\" onClick=\"flashErrorPopover();\">here</span>';\n            $('.alert').html(($('.alert').html().replace(\"$flashErrorMessage\", flashMessageLink)));\n        }\n        });\n    </script>\n</body>\n</html>\n"], "filenames": ["app/View/Layouts/default.ctp"], "buggy_code_start_loc": [104], "buggy_code_end_loc": [107], "fixing_code_start_loc": [104], "fixing_code_end_loc": [107], "type": "CWE-79", "message": "In MISP before 2.4.105, the app/View/Layouts/default.ctp default layout template has a Reflected XSS vulnerability.", "other": {"cve": {"id": "CVE-2019-10254", "sourceIdentifier": "cve@mitre.org", "published": "2019-03-28T15:29:00.387", "lastModified": "2019-03-28T18:12:37.620", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In MISP before 2.4.105, the app/View/Layouts/default.ctp default layout template has a Reflected XSS vulnerability."}, {"lang": "es", "value": "En MISP, en versiones anteriores a la 2.4.105, la plantilla de dise\u00f1o por defecto \"app/View/Layouts/default.ctp\" tiene una vulnerabilidad de XSS reflejado."}], "metrics": {"cvssMetricV30": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "NONE", "integrityImpact": "PARTIAL", "availabilityImpact": "NONE", "baseScore": 4.3}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:misp:misp:*:*:*:*:*:*:*:*", "versionEndExcluding": "2.4.105", "matchCriteriaId": "4EFBFD1F-30A7-4BC4-B19C-B709D70929B2"}]}]}], "references": [{"url": "https://github.com/MISP/MISP/commit/586cca384be6710b03e14bcbeb7588c1772604ec", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/MISP/MISP/compare/f493659...0e4f66e", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/MISP/MISP/commit/586cca384be6710b03e14bcbeb7588c1772604ec"}}