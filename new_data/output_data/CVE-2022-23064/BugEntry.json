{"buggy_code": ["# --------------------------------------------\n# REQUIRED: BASIC APP SETTINGS\n# --------------------------------------------\nAPP_ENV=production\nAPP_DEBUG=false\nAPP_KEY=ChangeMe\nAPP_URL=null\nAPP_TIMEZONE='UTC'\nAPP_LOCALE=en\nMAX_RESULTS=500\n\n# --------------------------------------------\n# REQUIRED: UPLOADED FILE STORAGE SETTINGS\n# --------------------------------------------\nPRIVATE_FILESYSTEM_DISK=local\nPUBLIC_FILESYSTEM_DISK=local_public\n\n# --------------------------------------------\n# REQUIRED: DATABASE SETTINGS\n# --------------------------------------------\nDB_CONNECTION=mysql\nDB_HOST=127.0.0.1\nDB_DATABASE=null\nDB_USERNAME=null\nDB_PASSWORD=null\nDB_PREFIX=null\nDB_DUMP_PATH='/usr/bin'\nDB_CHARSET=utf8mb4\nDB_COLLATION=utf8mb4_unicode_ci\n\n# --------------------------------------------\n# OPTIONAL: SSL DATABASE SETTINGS\n# --------------------------------------------\nDB_SSL=false\nDB_SSL_IS_PAAS=false\nDB_SSL_KEY_PATH=null\nDB_SSL_CERT_PATH=null\nDB_SSL_CA_PATH=null\nDB_SSL_CIPHER=null\n\n# --------------------------------------------\n# REQUIRED: OUTGOING MAIL SERVER SETTINGS\n# --------------------------------------------\nMAIL_DRIVER=smtp\nMAIL_HOST=email-smtp.us-west-2.amazonaws.com\nMAIL_PORT=587\nMAIL_USERNAME=YOURUSERNAME\nMAIL_PASSWORD=YOURPASSWORD\nMAIL_ENCRYPTION=null\nMAIL_FROM_ADDR=you@example.com\nMAIL_FROM_NAME='Snipe-IT'\nMAIL_REPLYTO_ADDR=you@example.com\nMAIL_REPLYTO_NAME='Snipe-IT'\nMAIL_AUTO_EMBED_METHOD='attachment'\n\n# --------------------------------------------\n# REQUIRED: IMAGE LIBRARY\n# This should be gd or imagick\n# --------------------------------------------\nIMAGE_LIB=gd\n\n\n# --------------------------------------------\n# OPTIONAL: BACKUP SETTINGS\n# --------------------------------------------\nMAIL_BACKUP_NOTIFICATION_DRIVER=null\nMAIL_BACKUP_NOTIFICATION_ADDRESS=null\nBACKUP_ENV=true\n\n\n# --------------------------------------------\n# OPTIONAL: SESSION SETTINGS\n# --------------------------------------------\nSESSION_LIFETIME=12000\nEXPIRE_ON_CLOSE=false\nENCRYPT=false\nCOOKIE_NAME=snipeit_session\nCOOKIE_DOMAIN=null\nSECURE_COOKIES=false\nAPI_TOKEN_EXPIRATION_YEARS=15\n\n# --------------------------------------------\n# OPTIONAL: SECURITY HEADER SETTINGS\n# --------------------------------------------\nAPP_TRUSTED_PROXIES=192.168.1.1,10.0.0.1\nALLOW_IFRAMING=false\nREFERRER_POLICY=same-origin\nENABLE_CSP=false\nCORS_ALLOWED_ORIGINS=null\nENABLE_HSTS=false\n\n# --------------------------------------------\n# OPTIONAL: CACHE SETTINGS\n# --------------------------------------------\nCACHE_DRIVER=file\nSESSION_DRIVER=file\nQUEUE_DRIVER=sync\nCACHE_PREFIX=snipeit\n\n# --------------------------------------------\n# OPTIONAL: REDIS SETTINGS\n# --------------------------------------------\nREDIS_HOST=null\nREDIS_PASSWORD=null\nREDIS_PORT=null\n\n# --------------------------------------------\n# OPTIONAL: MEMCACHED SETTINGS\n# --------------------------------------------\nMEMCACHED_HOST=null\nMEMCACHED_PORT=null\n\n# --------------------------------------------\n# OPTIONAL: PUBLIC S3 Settings\n# --------------------------------------------\nPUBLIC_AWS_SECRET_ACCESS_KEY=null\nPUBLIC_AWS_ACCESS_KEY_ID=null\nPUBLIC_AWS_DEFAULT_REGION=null\nPUBLIC_AWS_BUCKET=null\nPUBLIC_AWS_URL=null\nPUBLIC_AWS_BUCKET_ROOT=null\n\n# --------------------------------------------\n# OPTIONAL: PRIVATE S3 Settings\n# --------------------------------------------\nPRIVATE_AWS_ACCESS_KEY_ID=null\nPRIVATE_AWS_SECRET_ACCESS_KEY=null\nPRIVATE_AWS_DEFAULT_REGION=null\nPRIVATE_AWS_BUCKET=null\nPRIVATE_AWS_URL=null\nPRIVATE_AWS_BUCKET_ROOT=null\n\n# --------------------------------------------\n# OPTIONAL: LOGIN THROTTLING\n# --------------------------------------------\nLOGIN_MAX_ATTEMPTS=5\nLOGIN_LOCKOUT_DURATION=60\nRESET_PASSWORD_LINK_EXPIRES=900\n\n# --------------------------------------------\n# OPTIONAL: MISC\n# --------------------------------------------\nAPP_LOG=single\nAPP_LOG_MAX_FILES=10\nAPP_LOCKED=false\nAPP_CIPHER=AES-256-CBC\nAPP_FORCE_TLS=false\nGOOGLE_MAPS_API=\nLDAP_MEM_LIM=500M\nLDAP_TIME_LIM=600\nIMPORT_TIME_LIMIT=600\nIMPORT_MEMORY_LIMIT=500M\nREPORT_TIME_LIMIT=12000\n\n", "<?php\nnamespace App\\Providers;\n\n\nuse App\\Models\\Accessory;\nuse App\\Models\\Asset;\nuse App\\Models\\Component;\nuse App\\Models\\Consumable;\nuse App\\Models\\License;\nuse App\\Models\\Setting;\nuse App\\Observers\\AccessoryObserver;\nuse App\\Observers\\AssetObserver;\nuse App\\Observers\\ComponentObserver;\nuse App\\Observers\\ConsumableObserver;\nuse App\\Observers\\LicenseObserver;\nuse App\\Observers\\SettingObserver;\nuse Illuminate\\Support\\Facades\\Schema;\nuse Illuminate\\Support\\ServiceProvider;\nuse Illuminate\\Routing\\UrlGenerator;\n\n/**\n * This service provider handles setting the observers on models\n *\n * PHP version 5.5.9\n * @version    v3.0\n */\n\nclass AppServiceProvider extends ServiceProvider\n{\n    /**\n     * Custom email array validation\n     *\n     * @author [A. Gianotto] [<snipe@snipe.net>]\n     * @since [v3.0]\n     * @return void\n     */\n    public function boot(UrlGenerator $url)\n    {\n        if (env('APP_FORCE_TLS')) {\n            if (strpos(env('APP_URL'), 'https') === 0) {\n                $url->forceScheme('https');\n            } else {\n                \\Log::warning(\"'APP_FORCE_TLS' is set to true, but 'APP_URL' does not start with 'https://'. Will not force TLS on connections.\");\n            }\n        }\n        Schema::defaultStringLength(191);\n        Asset::observe(AssetObserver::class);\n        Accessory::observe(AccessoryObserver::class);\n        Component::observe(ComponentObserver::class);\n        Consumable::observe(ConsumableObserver::class);\n        License::observe(LicenseObserver::class);\n        Setting::observe(SettingObserver::class);\n    }\n\n    /**\n     * Register any application services.\n     *\n     * @return void\n     */\n    public function register()\n    {\n\n        if (($this->app->environment('production'))  && (config('logging.channels.rollbar.access_token'))) {\n            $this->app->register(\\Rollbar\\Laravel\\RollbarServiceProvider::class);\n        }\n\n    }\n}\n"], "fixing_code": ["# --------------------------------------------\n# REQUIRED: BASIC APP SETTINGS\n# --------------------------------------------\nAPP_ENV=production\nAPP_DEBUG=false\nAPP_KEY=ChangeMe\nAPP_URL=null\nAPP_TIMEZONE='UTC'\nAPP_LOCALE=en\nMAX_RESULTS=500\n\n# --------------------------------------------\n# REQUIRED: UPLOADED FILE STORAGE SETTINGS\n# --------------------------------------------\nPRIVATE_FILESYSTEM_DISK=local\nPUBLIC_FILESYSTEM_DISK=local_public\n\n# --------------------------------------------\n# REQUIRED: DATABASE SETTINGS\n# --------------------------------------------\nDB_CONNECTION=mysql\nDB_HOST=127.0.0.1\nDB_DATABASE=null\nDB_USERNAME=null\nDB_PASSWORD=null\nDB_PREFIX=null\nDB_DUMP_PATH='/usr/bin'\nDB_CHARSET=utf8mb4\nDB_COLLATION=utf8mb4_unicode_ci\n\n# --------------------------------------------\n# OPTIONAL: SSL DATABASE SETTINGS\n# --------------------------------------------\nDB_SSL=false\nDB_SSL_IS_PAAS=false\nDB_SSL_KEY_PATH=null\nDB_SSL_CERT_PATH=null\nDB_SSL_CA_PATH=null\nDB_SSL_CIPHER=null\n\n# --------------------------------------------\n# REQUIRED: OUTGOING MAIL SERVER SETTINGS\n# --------------------------------------------\nMAIL_DRIVER=smtp\nMAIL_HOST=email-smtp.us-west-2.amazonaws.com\nMAIL_PORT=587\nMAIL_USERNAME=YOURUSERNAME\nMAIL_PASSWORD=YOURPASSWORD\nMAIL_ENCRYPTION=null\nMAIL_FROM_ADDR=you@example.com\nMAIL_FROM_NAME='Snipe-IT'\nMAIL_REPLYTO_ADDR=you@example.com\nMAIL_REPLYTO_NAME='Snipe-IT'\nMAIL_AUTO_EMBED_METHOD='attachment'\n\n# --------------------------------------------\n# REQUIRED: IMAGE LIBRARY\n# This should be gd or imagick\n# --------------------------------------------\nIMAGE_LIB=gd\n\n\n# --------------------------------------------\n# OPTIONAL: BACKUP SETTINGS\n# --------------------------------------------\nMAIL_BACKUP_NOTIFICATION_DRIVER=null\nMAIL_BACKUP_NOTIFICATION_ADDRESS=null\nBACKUP_ENV=true\n\n\n# --------------------------------------------\n# OPTIONAL: SESSION SETTINGS\n# --------------------------------------------\nSESSION_LIFETIME=12000\nEXPIRE_ON_CLOSE=false\nENCRYPT=false\nCOOKIE_NAME=snipeit_session\nCOOKIE_DOMAIN=null\nSECURE_COOKIES=false\nAPI_TOKEN_EXPIRATION_YEARS=15\n\n# --------------------------------------------\n# OPTIONAL: SECURITY HEADER SETTINGS\n# --------------------------------------------\nAPP_TRUSTED_PROXIES=192.168.1.1,10.0.0.1\nALLOW_IFRAMING=false\nREFERRER_POLICY=same-origin\nENABLE_CSP=false\nCORS_ALLOWED_ORIGINS=null\nENABLE_HSTS=false\n\n# --------------------------------------------\n# OPTIONAL: CACHE SETTINGS\n# --------------------------------------------\nCACHE_DRIVER=file\nSESSION_DRIVER=file\nQUEUE_DRIVER=sync\nCACHE_PREFIX=snipeit\n\n# --------------------------------------------\n# OPTIONAL: REDIS SETTINGS\n# --------------------------------------------\nREDIS_HOST=null\nREDIS_PASSWORD=null\nREDIS_PORT=null\n\n# --------------------------------------------\n# OPTIONAL: MEMCACHED SETTINGS\n# --------------------------------------------\nMEMCACHED_HOST=null\nMEMCACHED_PORT=null\n\n# --------------------------------------------\n# OPTIONAL: PUBLIC S3 Settings\n# --------------------------------------------\nPUBLIC_AWS_SECRET_ACCESS_KEY=null\nPUBLIC_AWS_ACCESS_KEY_ID=null\nPUBLIC_AWS_DEFAULT_REGION=null\nPUBLIC_AWS_BUCKET=null\nPUBLIC_AWS_URL=null\nPUBLIC_AWS_BUCKET_ROOT=null\n\n# --------------------------------------------\n# OPTIONAL: PRIVATE S3 Settings\n# --------------------------------------------\nPRIVATE_AWS_ACCESS_KEY_ID=null\nPRIVATE_AWS_SECRET_ACCESS_KEY=null\nPRIVATE_AWS_DEFAULT_REGION=null\nPRIVATE_AWS_BUCKET=null\nPRIVATE_AWS_URL=null\nPRIVATE_AWS_BUCKET_ROOT=null\n\n# --------------------------------------------\n# OPTIONAL: LOGIN THROTTLING\n# --------------------------------------------\nLOGIN_MAX_ATTEMPTS=5\nLOGIN_LOCKOUT_DURATION=60\nRESET_PASSWORD_LINK_EXPIRES=900\n\n# --------------------------------------------\n# OPTIONAL: MISC\n# --------------------------------------------\nAPP_LOG=single\nAPP_LOG_MAX_FILES=10\nAPP_LOCKED=false\nAPP_CIPHER=AES-256-CBC\nAPP_FORCE_TLS=false\nAPP_ALLOW_INSECURE_HOSTS=false\nGOOGLE_MAPS_API=\nLDAP_MEM_LIM=500M\nLDAP_TIME_LIM=600\nIMPORT_TIME_LIMIT=600\nIMPORT_MEMORY_LIMIT=500M\nREPORT_TIME_LIMIT=12000\n\n", "<?php\nnamespace App\\Providers;\n\n\nuse App\\Models\\Accessory;\nuse App\\Models\\Asset;\nuse App\\Models\\Component;\nuse App\\Models\\Consumable;\nuse App\\Models\\License;\nuse App\\Models\\Setting;\nuse App\\Observers\\AccessoryObserver;\nuse App\\Observers\\AssetObserver;\nuse App\\Observers\\ComponentObserver;\nuse App\\Observers\\ConsumableObserver;\nuse App\\Observers\\LicenseObserver;\nuse App\\Observers\\SettingObserver;\nuse Illuminate\\Support\\Facades\\Schema;\nuse Illuminate\\Support\\ServiceProvider;\nuse Illuminate\\Routing\\UrlGenerator;\n\n/**\n * This service provider handles setting the observers on models\n *\n * PHP version 5.5.9\n * @version    v3.0\n */\n\nclass AppServiceProvider extends ServiceProvider\n{\n    /**\n     * Custom email array validation\n     *\n     * @author [A. Gianotto] [<snipe@snipe.net>]\n     * @since [v3.0]\n     * @return void\n     */\n    public function boot(UrlGenerator $url)\n    {\n        if (env('APP_FORCE_TLS')) {\n            if (strpos(env('APP_URL'), 'https') === 0) {\n                $url->forceScheme('https');\n            } else {\n                \\Log::warning(\"'APP_FORCE_TLS' is set to true, but 'APP_URL' does not start with 'https://'. Will not force TLS on connections.\");\n            }\n        }\n\n        // TODO - isn't it somehow 'gauche' to check the environment directly; shouldn't we be using config() somehow?\n        if ( ! env('APP_ALLOW_INSECURE_HOSTS')) {  // unless you set APP_ALLOW_INSECURE_HOSTS, you should PROHIBIT forging domain parts of URL via Host: headers\n            $url_parts = parse_url(config('app.url'));\n            $root_url = $url_parts['scheme'].'://'.$url_parts['host'].( isset($url_parts['port']) ? ':'.$url_parts['port'] : '');\n            \\URL::forceRootUrl($root_url);\n        }\n\n        Schema::defaultStringLength(191);\n        Asset::observe(AssetObserver::class);\n        Accessory::observe(AccessoryObserver::class);\n        Component::observe(ComponentObserver::class);\n        Consumable::observe(ConsumableObserver::class);\n        License::observe(LicenseObserver::class);\n        Setting::observe(SettingObserver::class);\n    }\n\n    /**\n     * Register any application services.\n     *\n     * @return void\n     */\n    public function register()\n    {\n\n        if (($this->app->environment('production'))  && (config('logging.channels.rollbar.access_token'))) {\n            $this->app->register(\\Rollbar\\Laravel\\RollbarServiceProvider::class);\n        }\n\n    }\n}\n"], "filenames": [".env.example", "app/Providers/AppServiceProvider.php"], "buggy_code_start_loc": [147, 45], "buggy_code_end_loc": [147, 45], "fixing_code_start_loc": [148, 46], "fixing_code_end_loc": [149, 54], "type": "CWE-74", "message": "In Snipe-IT, versions v3.0-alpha to v5.3.7 are vulnerable to Host Header Injection. By sending a specially crafted host header in the reset password request, it is possible to send password reset links to users which once clicked lead to an attacker controlled server and thus leading to password reset token leak. This leads to account take over.", "other": {"cve": {"id": "CVE-2022-23064", "sourceIdentifier": "vulnerabilitylab@mend.io", "published": "2022-05-02T13:15:08.170", "lastModified": "2022-05-10T16:25:09.747", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "In Snipe-IT, versions v3.0-alpha to v5.3.7 are vulnerable to Host Header Injection. By sending a specially crafted host header in the reset password request, it is possible to send password reset links to users which once clicked lead to an attacker controlled server and thus leading to password reset token leak. This leads to account take over."}, {"lang": "es", "value": "En Snipe-IT, versiones v3.0-alpha a v5.3.7, son vulnerables a una Inyecci\u00f3n de Encabezado de Host. Al enviar un encabezado de host especialmente dise\u00f1ado en la petici\u00f3n de restablecimiento de la contrase\u00f1a, es posible enviar enlaces de restablecimiento de la contrase\u00f1a a usuarios que, una vez que se hace clic, conllevan a un servidor controlado por el atacante y, por lo tanto, a un filtrado del token de restablecimiento de la contrase\u00f1a. Esto conlleva a una toma de la cuenta"}], "metrics": {"cvssMetricV31": [{"source": "vulnerabilitylab@mend.io", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 8.8, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.8, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:M/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "MEDIUM", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 6.8}, "baseSeverity": "MEDIUM", "exploitabilityScore": 8.6, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": true}]}, "weaknesses": [{"source": "vulnerabilitylab@mend.io", "type": "Primary", "description": [{"lang": "en", "value": "CWE-74"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:snipeitapp:snipe-it:*:*:*:*:*:*:*:*", "versionStartIncluding": "3.0.0", "versionEndIncluding": "5.3.7", "matchCriteriaId": "B8320AAA-B17E-4CBD-8FB4-6017A43AC818"}, {"vulnerable": true, "criteria": "cpe:2.3:a:snipeitapp:snipe-it:3.0.0:alpha1:*:*:*:*:*:*", "matchCriteriaId": "00A46F6A-D21C-49CE-9B0E-2BE8720667BE"}, {"vulnerable": true, "criteria": "cpe:2.3:a:snipeitapp:snipe-it:3.0.0:alpha2:*:*:*:*:*:*", "matchCriteriaId": "15C80E6E-4F9A-4EC6-B164-3C68EAF4D2F2"}, {"vulnerable": true, "criteria": "cpe:2.3:a:snipeitapp:snipe-it:3.0.0:beta1:*:*:*:*:*:*", "matchCriteriaId": "AC900331-28F7-450D-B737-0CC245748AC7"}, {"vulnerable": true, "criteria": "cpe:2.3:a:snipeitapp:snipe-it:3.0.0:beta2:*:*:*:*:*:*", "matchCriteriaId": "5C923065-E4E2-4200-920E-BE476CDF14CF"}, {"vulnerable": true, "criteria": "cpe:2.3:a:snipeitapp:snipe-it:3.0.0:beta3:*:*:*:*:*:*", "matchCriteriaId": "EA637261-B87C-4759-A89F-368CA203AF0E"}]}]}], "references": [{"url": "https://github.com/snipe/snipe-it/commit/0c4768fd2a11ac26a61814cef23a71061bfd8bcc", "source": "vulnerabilitylab@mend.io", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://www.whitesourcesoftware.com/vulnerability-database/CVE-2022-23064", "source": "vulnerabilitylab@mend.io", "tags": ["Exploit", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/snipe/snipe-it/commit/0c4768fd2a11ac26a61814cef23a71061bfd8bcc"}}