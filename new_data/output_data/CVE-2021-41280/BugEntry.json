{"buggy_code": ["# Change Log\n\nAll notable changes to this project will be documented in this file.\n\nThis project adheres to [Semantic Versioning](http://semver.org/) where possible.\n\nThis file follows the best practices from [keepachangelog.com](http://keepachangelog.com/).\n\n## [Unreleased]\n\n### Added\n\n### Changed\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n### Security\n\n## [10.2.0] - 2021-11-18\n\n### Added\n\n- New Admin panel additions and fixes, done through many many commits/PRs/branches that have `admin2` or `admin v2`in their title\n- Support for French overseas departments/regions IBAN [#4369](https://github.com/sharetribe/sharetribe/pull/4369)\n- Custom Landing Page icon picker [#12adad](https://github.com/sharetribe/sharetribe/commit/12adadc7734d22f0be610440b5e9f721114a9284)\n- Add new body and css fields to the Custom script feature [#46a066](https://github.com/sharetribe/sharetribe/commit/46a0660a5ff3fc864ba8f9e68a0fafd35aa83a5f)\n- Redirect an already logged in user to the home page when they visit the login page [#603eee](https://github.com/sharetribe/sharetribe/commit/603eeedad224376166d0b4a6ea7a9253f4fc1d3b)\n- Validation for the Google Analytics tracking ID field [#46aff6](https://github.com/sharetribe/sharetribe/commit/46aff666845a56787a7e2801acba8a54370c6ef6)\n\n### Changed\n\n- Don't display payment details banner reminder for deleted listings [#4371](https://github.com/sharetribe/sharetribe/pull/4371)\n- Cache fonts partial to avoid scss rendering on every page load [#4367](https://github.com/sharetribe/sharetribe/pull/4367) and [#f158cb9](https://github.com/sharetribe/sharetribe/commit/f158cb9dc61186d5fe9e785d0c738eb54e7d023f)\n- Minimum listing price refactor [#08b61a](https://github.com/sharetribe/sharetribe/commit/08b61af6d26613cf1d132d7c6b237b2161df1e5c)\n- Default first and last names values [#20b662](https://github.com/sharetribe/sharetribe/commit/20b66261753ce95a857fd72b8725e7887fa14874)\n- Update Facebook API graph version [#0a90bb](https://github.com/sharetribe/sharetribe/commit/0a90bb4801d12fd92826a457163bc5d8d1226d78)\n- Update font-family to use the same one everywhere [#41212e](https://github.com/sharetribe/sharetribe/commit/41212e8d1f08b4e73a967aa1231ed2b4f6cbb523)\n\n### Fixed\n- Fixed error message in incorrect location in signup form [#4360](https://github.com/sharetribe/sharetribe/pull/4360)\n- Fixed email notifications can be configured to use an unconfirmed address [#4362](https://github.com/sharetribe/sharetribe/pull/4362)\n- Fixed incorrect use of plural in a review date text on Profile pages [#4361](https://github.com/sharetribe/sharetribe/pull/4361)\n- Fixed wrong name in email notifications [#d66b90](https://github.com/sharetribe/sharetribe/commit/d66b900be0fce2b549f8f348b2eb244619e5ae0c)\n- Fixed UI overlay issue with profile picture on profile pages [#2075e9](https://github.com/sharetribe/sharetribe/commit/2075e9a093dea23d5c574397d679619cd1d50026)\n- Fixed incorrect commission fee shown on the transaction page for buyers if they are also admins [#9e0176](https://github.com/sharetribe/sharetribe/commit/9e017670a8d8e2afd87836be00e46b054a3e6256)\n- Fixed Facebook & LinkedIn logos too small on signup and login pages [#3fdff2](https://github.com/sharetribe/sharetribe/commit/3fdff202ca1e03e8c33d2948de5ff545ee34bc7e)\n- Fixed email sending feature producing error with certain sender names [#5b4a40](https://github.com/sharetribe/sharetribe/commit/5b4a40870e972239d2b6241710f03e592a3309bc)\n- Fixed Custom Landing Page - BrowserDetectVideoAutoplay is not defined [#55352e](https://github.com/sharetribe/sharetribe/commit/55352e769790571d8e25bb739facd87e84b03808)\n- Fixed checkout fails when the total of minimum seller + buyer fees is higher than the listing price [#fc077e](https://github.com/sharetribe/sharetribe/commit/fc077e123f05b1dda9e3463bc4f7efe819590a3f)\n- Fixed module is not defined error [#64f7d7](https://github.com/sharetribe/sharetribe/commit/64f7d7a3acbdbde8bbad2552471735666685aaf2)\n\n### Security\n\n- Upgrade Rails to 5.2.4.5 as well as gems [#4366](https://github.com/sharetribe/sharetribe/pull/4366)\n- Dependencies update [#4373](https://github.com/sharetribe/sharetribe/pull/4373), [#037932](https://github.com/sharetribe/sharetribe/commit/037932af4fda4edea518200391b3a74d301c2bec), [b1c10a](https://github.com/sharetribe/sharetribe/commit/b1c10a4bf5f44ae06f549f3a6b1951f4a8c59626), [#3e00b7](https://github.com/sharetribe/sharetribe/commit/3e00b77c89c006c279fc3758b692ab883677427c), [#cbf815](https://github.com/sharetribe/sharetribe/commit/cbf815a5fbbeeb5c7b3675ef69616d91363b826b), [#7e0eb9](https://github.com/sharetribe/sharetribe/commit/7e0eb94d2bc01ebe5f8e27c6e510631d004c8409), [#1b9d66](https://github.com/sharetribe/sharetribe/commit/1b9d669c05b7023246ce027cf4f7abca65ecde1b)\n\n## [10.1.0] - 2021-03-17\n\n### Added\n\n- New Admin panel, done through many many PRs that have `admin2` or `admin v2`in their title\n- Info text to Stripe form [#4118](https://github.com/sharetribe/sharetribe/pull/4118)\n- Stripe support for Cyprus [#4122](https://github.com/sharetribe/sharetribe/pull/4122)\n- Stripe support for Malta [#4123](https://github.com/sharetribe/sharetribe/pull/4123)\n- Stripe support for Bulgaria [#4124](https://github.com/sharetribe/sharetribe/pull/4124)\n- Add \"paypal/stripe setup\" in users csv export [#4003](https://github.com/sharetribe/sharetribe/pull/4003), [#4196](https://github.com/sharetribe/sharetribe/pull/4196)\n- UI for setting custom domain [#4227](https://github.com/sharetribe/sharetribe/pull/4227), [#4237](https://github.com/sharetribe/sharetribe/pull/4237), [#4241](https://github.com/sharetribe/sharetribe/pull/4241), [#4296](https://github.com/sharetribe/sharetribe/pull/4296), [#4312](https://github.com/sharetribe/sharetribe/pull/4312)\n- reCAPTCHA support [#4299](https://github.com/sharetribe/sharetribe/pull/4299)\n- Email notification to admins when changing the marketplace ident [#4326](https://github.com/sharetribe/sharetribe/pull/4326)\n- Missing settings for two email notifications [#4328](https://github.com/sharetribe/sharetribe/pull/4328)\n- Stripe support for Hungary [#4295](https://github.com/sharetribe/sharetribe/pull/4295)\n\n### Changed\n\n- Increase Facebook and Twitter meta images size [#4100](https://github.com/sharetribe/sharetribe/pull/4100)\n- Add more states to FINISHED_TX_STATES to allow user account deletion correctly [#4109](https://github.com/sharetribe/sharetribe/pull/4109)\n- Update airbrake and newrelic [#4111](https://github.com/sharetribe/sharetribe/pull/4111)\n- Remove default favicon and add type tag to favicon link [#4140](https://github.com/sharetribe/sharetribe/pull/4140)\n- Make active storage service configurable [#4143](https://github.com/sharetribe/sharetribe/pull/4143)\n- Specify the requested fields in Google Maps Places API query [#4146](https://github.com/sharetribe/sharetribe/pull/4146)\n- Review text is required in edits from admins [#4153](https://github.com/sharetribe/sharetribe/pull/4153)\n- Update Proxima font [#4177](https://github.com/sharetribe/sharetribe/pull/4177)\n- Adjust CircleCI configuration for faster test runs [#4274](https://github.com/sharetribe/sharetribe/pull/4274)\n- Make the Custom script plan_feature dependent [#4289](https://github.com/sharetribe/sharetribe/pull/4289)\n- Fix job priorities [#4294](https://github.com/sharetribe/sharetribe/pull/)\n- Email layout v2 - Link color consistency with marketplace color [#4303](https://github.com/sharetribe/sharetribe/pull/4303)\n- Optimize polling for pending delayed jobs [#4311](https://github.com/sharetribe/sharetribe/pull/4311)\n- Email layout v2 - Disable markdown formatting in listing description [#4305](https://github.com/sharetribe/sharetribe/pull/4305)\n- Improve efficiency of community membership counting [#4319](https://github.com/sharetribe/sharetribe/pull/4319)\n- Email layout v2 - Add note to email layout [#4318](https://github.com/sharetribe/sharetribe/pull/4318)\n- Email layout v2 - Disable markdown formatting in listing description [#4305](https://github.com/sharetribe/sharetribe/pull/4305)\n- Email layout v2 - Remove ability to change feature flag from Admin panel [#4307](https://github.com/sharetribe/sharetribe/pull/4307)\n- Use the community default locale for CLP [#4341](https://github.com/sharetribe/sharetribe/pull/4341)\n- Change the main font for Go UI to Proxima soft [#4353](https://github.com/sharetribe/sharetribe/pull/4353)\n\n### Removed\n\n- Sunset PayPal in India [#4338](https://github.com/sharetribe/sharetribe/pull/4338)\n\n### Fixed\n\n- Fixed query for booked dates in range [#4091](https://github.com/sharetribe/sharetribe/pull/4044)\n- Fixed error when using daily availability management datepicker [#4094](https://github.com/sharetribe/sharetribe/pull/4094)\n- Fixed confirming payment multiple times with Stripe [#4102](https://github.com/sharetribe/sharetribe/pull/4102)\n- Fixed inconsistent transaction left after transition fails [#4092](https://github.com/sharetribe/sharetribe/pull/4092)\n- Fixed CLP hero section with upload background image [#4101](https://github.com/sharetribe/sharetribe/pull/4101)\n- Fixed search with fuzzy location [#4103](https://github.com/sharetribe/sharetribe/pull/4103)\n- Fixed issue with error translation in some languages [#4132](https://github.com/sharetribe/sharetribe/pull/4132)\n- Fixed user display_name [#4130](https://github.com/sharetribe/sharetribe/pull/4130)\n- Fixed active map view on listing page [#4145](https://github.com/sharetribe/sharetribe/pull/4145)\n- Fixed default setting automatic newsletters [#4150](https://github.com/sharetribe/sharetribe/pull/4150)\n- Fixed bug with \"Display name\" not being used in transaction steps texts [#4155](https://github.com/sharetribe/sharetribe/pull/4155)\n- Fixed no listing location makes clicks on \"Show in the next newsletter\" impossible [#4181](https://github.com/sharetribe/sharetribe/pull/4181)\n- Fixed infinite scroll on homepage not working w/ Chromium 87 [#4273](https://github.com/sharetribe/sharetribe/pull/4273)\n- Fixed test email not sent to admin if they have unsubscribed [#4327](https://github.com/sharetribe/sharetribe/pull/4327)\n- Fixed inconsistency between the Unsubscribe link in the Receipt of payment email and the notification setting [#4329](https://github.com/sharetribe/sharetribe/pull/4329)\n- Fixed rels deleted users [#4340](https://github.com/sharetribe/sharetribe/pull/4340)\n- Fixed Facebook buttons cut off and misaligned [#4348](https://github.com/sharetribe/sharetribe/pull/4348)\n\n### Security\n\n- Updated fileupload plugin [#4136](https://github.com/sharetribe/sharetribe/pull/4136)\n- Update rails to 5.2.4.3 [#4141](https://github.com/sharetribe/sharetribe/pull/4141)\n- Update rails to 5.2.4.4 [#4231](https://github.com/sharetribe/sharetribe/pull/4231)\n- Upgrades node-sass and json [#4233](https://github.com/sharetribe/sharetribe/pull/4233)\n- Add tests ensuring csrf protection for omniauth auth paths [#4266](https://github.com/sharetribe/sharetribe/pull/4266)\n- Vulnerable dependencies updates - Axios, Nokogiri, Redcarpet [#4325](https://github.com/sharetribe/sharetribe/pull/4325)\n\n## [10.0.0] - 2020-05-10\n\n### Added\n\n- Fuzzy location [#4035](https://github.com/sharetribe/sharetribe/pull/4035)\n- Stripe support for Czech Republic [#4049](https://github.com/sharetribe/sharetribe/pull/4049), [#4069](https://github.com/sharetribe/sharetribe/pull/4069)\n- Allow admin to edit the button in Hero section [#4051](https://github.com/sharetribe/sharetribe/pull/4051)\n- Stripe support for Romania [#4066](https://github.com/sharetribe/sharetribe/pull/4066)\n\n### Changed\n\n- Go no longer uses [Harmony](/docs/configure_harmony.md) for availability management. Functionality is now implemented fully in Go. See the [upgrade instructions](UPGRADE.md#upgrade-from-910-to-1000). [#4020](https://github.com/sharetribe/sharetribe/pull/4020), [#4037](https://github.com/sharetribe/sharetribe/pull/4037), [#4043](https://github.com/sharetribe/sharetribe/pull/4043), [#4048](https://github.com/sharetribe/sharetribe/pull/4048), [#4071](https://github.com/sharetribe/sharetribe/pull/4071)\n- Copy texts for admin email notification of new entry in Contact form [#4077](https://github.com/sharetribe/sharetribe/pull/4077)\n\n### Fixed\n\n- Fixed inbox doesn't consider commission status [#4044](https://github.com/sharetribe/sharetribe/pull/4044)\n- Fixed encoding issue with PayPal [#4045](https://github.com/sharetribe/sharetribe/pull/4045)\n- Fixed missing listing image in community updates email [#4046](https://github.com/sharetribe/sharetribe/pull/4046)\n- Fixed scope of transations for testimonials to support Disputed [#4063](https://github.com/sharetribe/sharetribe/pull/4063)\n\n## [9.1.0] - 2020-03-06\n\n### Added\n\n- Custom Landing Page Editor\n- New emails layout\n- Support for Stripe capabilities\n- Allow admin to mark completed cancel transactions [#3889](https://github.com/sharetribe/sharetribe/pull/3889)\n- Added listing price and unit to csv export [#3891](https://github.com/sharetribe/sharetribe/pull/3891)\n- Add listing price to RSS/Atom feed [#3892](https://github.com/sharetribe/sharetribe/pull/3892)\n- Add link to delete closed listing [#3893](https://github.com/sharetribe/sharetribe/pull/3893)\n- Add shipping address to Transaction view [#3910](https://github.com/sharetribe/sharetribe/pull/3910)\n- Add a transaction state after canceled and improve the flow [#3926](https://github.com/sharetribe/sharetribe/pull/3926)\n- Add support for Mexico accounts [#3937](https://github.com/sharetribe/sharetribe/pull/3937)\n- Allow users to edit their username [#3941](https://github.com/sharetribe/sharetribe/pull/3941)\n- Add \"My transactions\" view in user settings [#3943](https://github.com/sharetribe/sharetribe/pull/3943)\n- Add GHS currency [#3944](https://github.com/sharetribe/sharetribe/pull/3944)\n- Add support for HEIC images [#3966](https://github.com/sharetribe/sharetribe/pull/3966)\n- Allow admin to update the marketplace ident [#3972](https://github.com/sharetribe/sharetribe/pull/3972)\n- Allow admins to delete a user account [#3975](https://github.com/sharetribe/sharetribe/pull/3975)\n- Retry paypal errored commission [#3977](https://github.com/sharetribe/sharetribe/pull/3977)\n- New texts for Google Search Console [#3979](https://github.com/sharetribe/sharetribe/pull/3979)\n- New Add text about GTM [#3997](https://github.com/sharetribe/sharetribe/pull/3997)\n- Add \"paypal/stripe setup\" in users csv export [#4003](https://github.com/sharetribe/sharetribe/pull/4003)\n- Admin can remove logo, square logo, cover photo, small cover photo, favicon, social media image [#4012](https://github.com/sharetribe/sharetribe/pull/4012)\n\n### Changed\n\n- Send additional verification document if required [#3897](https://github.com/sharetribe/sharetribe/pull/3897)\n- Change to dropdown for state values for Canada and Australia [#3905](https://github.com/sharetribe/sharetribe/pull/3905)\n- Title in admin transaction view [#3911](https://github.com/sharetribe/sharetribe/pull/3911)\n- No default option selected if pickup and shipping are offered [#3938](https://github.com/sharetribe/sharetribe/pull/3938)\n- Stripe API version changed to 2019-12-03 [#3948](https://github.com/sharetribe/sharetribe/pull/3948)\n- Hide \"Newsletter\" settings if newsletter has been disabled by admins [#3959](https://github.com/sharetribe/sharetribe/pull/3959)\n- Change meta tag xx:image to use profile picture for user profiles[#3960](https://github.com/sharetribe/sharetribe/pull/3960)\n- Update to Ruby 2.6.5 and a Debian Buster base Docker image [#3967](https://github.com/sharetribe/sharetribe/pull/3967)\n- Delete invitations sent by a user who gets deleted forever [#3973](https://github.com/sharetribe/sharetribe/pull/3973)\n- Show account restricted or pending in the smart way [#3990](https://github.com/sharetribe/sharetribe/pull/3990)\n- Send MCC/Email/URL when updating a Connect account [#3993](https://github.com/sharetribe/sharetribe/pull/3993)\n- Link to transaction should redirect to admin view [#3998](https://github.com/sharetribe/sharetribe/pull/3998)\n- Update the forms to have phone placeholder and JPG information [#4004](https://github.com/sharetribe/sharetribe/pull/4004)\n- Remove Google+ from CLP and Footer [#4005](https://github.com/sharetribe/sharetribe/pull/4005)\n- Longer number of characters for Display name [#4007](https://github.com/sharetribe/sharetribe/pull/4007)\n- Add the listing ID to PayPal's metadata [#4013](https://github.com/sharetribe/sharetribe/pull/4013)\n- Validation if SEO variables are not correct [#4014](https://github.com/sharetribe/sharetribe/pull/4014)\n\n### Fixed\n\n- Fixed users CSV export date field not required [#3886](https://github.com/sharetribe/sharetribe/pull/3886)\n- Fixed notification for each new transaction [#3887](https://github.com/sharetribe/sharetribe/pull/3887)\n- Fix meta title/description bug for social [#3894](https://github.com/sharetribe/sharetribe/pull/3894)\n- Fixed payment JS in older browser [#3920](https://github.com/sharetribe/sharetribe/pull/3920)\n- Fixed listing image width setup [#3921](https://github.com/sharetribe/sharetribe/pull/3921)\n- Fixed day/night availability after payment intent failed or expired [#3922](https://github.com/sharetribe/sharetribe/pull/3922)\n- Fixed check payment method presence when initiating payment [#3935](https://github.com/sharetribe/sharetribe/pull/3935)\n- Fixed Stripe payment card declined without SCA [#3952](https://github.com/sharetribe/sharetribe/pull/3952)\n- Fixed localization of PayPal payment description when charging the admin commission [#3961](https://github.com/sharetribe/sharetribe/pull/3961)\n- Fixed incorrect count of listings when editing an Order type isn't correct [#3964](https://github.com/sharetribe/sharetribe/pull/3964)\n- Fixed incorrect language in placeholder for social media tags [#3995](https://github.com/sharetribe/sharetribe/pull/3995)\n- Fixed wrong receipt for the seller when there is Shipping involved [#4009](https://github.com/sharetribe/sharetribe/pull/4009)\n- Fixed followers get notifications of rejected listings [#4011](https://github.com/sharetribe/sharetribe/pull/4011)\n\n### Security\n\n- Updated gems: rubyzip 1.3.0, devise 4.7.1 [#3899](https://github.com/sharetribe/sharetribe/pull/3899)\n- Bump loofah from 2.3.0 to 2.3.1 [#3918](https://github.com/sharetribe/sharetribe/pull/3918)\n- Bump puma from 3.12.1 to 3.12.2 [#3936](https://github.com/sharetribe/sharetribe/pull/3936)\n- Bump rack from 2.0.7 to 2.0.8 [#3951](https://github.com/sharetribe/sharetribe/pull/3951)\n- Bump nokogiri from 1.10.5 to 1.10.8 [#4010](https://github.com/sharetribe/sharetribe/pull/4010)\n- Bump puma from 3.12.2 to 3.12.4 [#4021](https://github.com/sharetribe/sharetribe/pull/4021)\n\n## [9.0.0] - 2019-10-02\n\n### Changed\n\n- Update Sharetribe Go Licence [#3883](https://github.com/sharetribe/sharetribe/pull/3883)\n\n## [8.1.0] - 2019-10-02\n\n### Added\n\n- Stripe SCA paymentintent based preauth process [#3791](https://github.com/sharetribe/sharetribe/pull/3791)\n- Stripe SCA finalize ui and management [#3805](https://github.com/sharetribe/sharetribe/pull/3805)\n- Support for markdown in listing descriptions [#3795](https://github.com/sharetribe/sharetribe/pull/3795), [#3810](https://github.com/sharetribe/sharetribe/pull/3810), [#3874](https://github.com/sharetribe/sharetribe/pull/3874)\n- Add \"Whats new?\" link in the sidebar [#3822](https://github.com/sharetribe/sharetribe/pull/3822)\n- Add ready made cover pics link next to the cover pick chooser [#3823](https://github.com/sharetribe/sharetribe/pull/3823)\n- Add \"Terms, Privacy Policy and static content\" table and links in \"Basic details\" tab [#3827](https://github.com/sharetribe/sharetribe/pull/3827)\n- Add four new fields to the transactions CSV export [#3845](https://github.com/sharetribe/sharetribe/pull/3845)\n- Allow admins to unskip reviews [#3857](https://github.com/sharetribe/sharetribe/pull/3857)\n- Admin option to send a notification for each new transaction [#3859](https://github.com/sharetribe/sharetribe/pull/3859)\n- Add new countries support: Estonia, Greece, Latvia, Lithuania, Poland, Slovakia, Slovenia [#3872](https://github.com/sharetribe/sharetribe/pull/3872)\n\n### Changed\n\n- In shipping address replace country dropdown with text field [#3815](https://github.com/sharetribe/sharetribe/pull/3815)\n- Use community currency for free transactions avoiding nil.to_money == 0 EUR [#3816](https://github.com/sharetribe/sharetribe/pull/3816)\n- Edit some CSV exports [#3828](https://github.com/sharetribe/sharetribe/pull/3828)\n- Change datetime format in all CSV exports [#3844](https://github.com/sharetribe/sharetribe/pull/3844)\n- Remove username from signup [#3853](https://github.com/sharetribe/sharetribe/pull/3853)\n\n### Removed\n\n- Remove google-site-verification from head and hardcoded GWT tag [#3825](https://github.com/sharetribe/sharetribe/pull/3825), [#3826](https://github.com/sharetribe/sharetribe/pull/3826)\n\n### Fixed\n\n- Order Type name for free listings was not updating cached fragment [#3836](https://github.com/sharetribe/sharetribe/pull/3836)\n- Disabling top bar default links (about, contact) is not possible [#3840](https://github.com/sharetribe/sharetribe/pull/3840)\n\n## [8.0.0] - 2019-07-31\n\n### Added\n\n- Use index hint for homepage query [#3714](https://github.com/sharetribe/sharetribe/pull/3714)\n- Add Albanian to the list of unsupported languages [#3718](https://github.com/sharetribe/sharetribe/pull/3718)\n- Add Macedonian to the list of unsupported languages [#3725](https://github.com/sharetribe/sharetribe/pull/3725)\n- Add .html_safe to content for title [#3744](https://github.com/sharetribe/sharetribe/pull/3744)\n- Ability for providers to delete listings [#3756](https://github.com/sharetribe/sharetribe/pull/3756)\n- Stripe support for Singapore [#3762](https://github.com/sharetribe/sharetribe/pull/3762)\n- Cache community count [#3766](https://github.com/sharetribe/sharetribe/pull/3766)\n- Ability to export listings to a CSV file [#3790](https://github.com/sharetribe/sharetribe/pull/3790)\n- Allow admins to disable direct messaging between users [#3793](https://github.com/sharetribe/sharetribe/pull/3793)\n\n### Changed\n\n- Update to ruby 2.6.2 [#3701](https://github.com/sharetribe/sharetribe/pull/3701)\n- Add more bot rules, disallow login paths [#3715](https://github.com/sharetribe/sharetribe/pull/3715)\n- Update to Rails 5.2.3 [#3722](https://github.com/sharetribe/sharetribe/pull/3722)\n- Prevent lowering minimum transaction size to less than minimum transaction fee with Stripe [#3723](https://github.com/sharetribe/sharetribe/pull/3723)\n- Update to Node.js 10.15 [#3735](https://github.com/sharetribe/sharetribe/pull/3735)\n- Updates to payment preference settings [#3748](https://github.com/sharetribe/sharetribe/pull/3748)\n- Updated copy text from Ban to Disable [#3755](https://github.com/sharetribe/sharetribe/pull/3755)\n- Category translation caching improvements [#3761](https://github.com/sharetribe/sharetribe/pull/3761)\n- Stripe remove the MCC field and hardcode it [#3771](https://github.com/sharetribe/sharetribe/pull/3771)\n- Move \"Phone number\" field down in US Stripe form [#3775](https://github.com/sharetribe/sharetribe/pull/3775)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Fix to the SEO tags without price translation string [#3727](https://github.com/sharetribe/sharetribe/pull/3727)\n- Fix to payment settings causing internal error when PayPal has never been enabled [#3732](https://github.com/sharetribe/sharetribe/pull/3732)\n- Fix to password reset [#3763](https://github.com/sharetribe/sharetribe/pull/3763)\n- Fix to Stripe US account update [#3765](https://github.com/sharetribe/sharetribe/pull/3765)\n- Fix to adding links to footer [#3769](https://github.com/sharetribe/sharetribe/pull/3769)\n- Fix to validation for custom date fields [#3772](https://github.com/sharetribe/sharetribe/pull/3772)\n- Fix to exclude expired listings when filtering for open [#3773](https://github.com/sharetribe/sharetribe/pull/3773)\n- Fix to signup page description tag [#3794](https://github.com/sharetribe/sharetribe/pull/3794)\n\n### Security\n\n\n## [7.6.0] - 2019-04-12\n\n### Added\n\n- Reviews filters in admin panel [#3589](https://github.com/sharetribe/sharetribe/pull/3589)\n- Marketplace logo in all marketplace emails [#3581](https://github.com/sharetribe/sharetribe/pull/3581)\n- New element in the user dropdown menu in the topbar: My listings [#3608](https://github.com/sharetribe/sharetribe/pull/3608)\n- Domain tab in the admin panel [#3614](https://github.com/sharetribe/sharetribe/pull/3614)\n- Social media logins: Google and LinkedIn [#3583](https://github.com/sharetribe/sharetribe/pull/3583)\n- SEO tab in the admin panel and the possibility to customize the metatags for your marketplace main page [#3612](https://github.com/sharetribe/sharetribe/pull/3612)\n- Lithuanian as an unsupported language [#3624](https://github.com/sharetribe/sharetribe/pull/3624)\n- SEO tags working on landing pages as well [#3622](https://github.com/sharetribe/sharetribe/pull/3622)\n- Added the possibility to charge a commission from the buyer [#3490](https://github.com/sharetribe/sharetribe/pull/3490)\n- New templates for the landing page footer [#3645](https://github.com/sharetribe/sharetribe/pull/3645)\n- More SEO options to add custom tags to different marketplace pages [#3647](https://github.com/sharetribe/sharetribe/pull/3647)\n- Ability to have pre-approved listings [#3620](https://github.com/sharetribe/sharetribe/pull/3620)\n- Notifications about listings to approve [#3646](https://github.com/sharetribe/sharetribe/pull/3646)\n- Better logging and error reporting with Stripe [#3676](https://github.com/sharetribe/sharetribe/pull/3676)\n- Listen to account status and missing info from Stripe [#3672](https://github.com/sharetribe/sharetribe/pull/3672)\n- Sending different notifications when a listing is new or edited [#3692](https://github.com/sharetribe/sharetribe/pull/3692)\n\n### Changed\n\n- Link to closed listings redirects to listings table in profile settings [#3607](https://github.com/sharetribe/sharetribe/pull/3607)\n- The way parameters are sent related to creating an connected account with Stripe [#3637](https://github.com/sharetribe/sharetribe/pull/3637)\n- Updated Stripe API keys pattern regex\t[#3660](https://github.com/sharetribe/sharetribe/pull/3660)\n- Updated Facebook login button in accordance to their branding demands [#3696](https://github.com/sharetribe/sharetribe/pull/3696)\n- Updated Facebook API to version 3.2 [#3679](https://github.com/sharetribe/sharetribe/pull/3679)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Fix inefficient queries when admin tries to send emails to all members [#3532](https://github.com/sharetribe/sharetribe/pull/3532)\n- Fixed failed list of listings [#3604](https://github.com/sharetribe/sharetribe/pull/3604)\n- Being able to edit the Stripe connected account name and lastname through the UI [#3653\t](https://github.com/sharetribe/sharetribe/pull/3652)\n- Handle Stripe API keys various lenghts [#3667](https://github.com/sharetribe/sharetribe/pull/3667)\n- Issues with Stripe Payouts [#3668](https://github.com/sharetribe/sharetribe/pull/3668)\n- Update CI to use Ubuntu-based image [#3671](https://github.com/sharetribe/sharetribe/pull/3671)\n\n### Security\n\n- Update passenger gem to latest version [#3609](https://github.com/sharetribe/sharetribe/pull/3609)\n- Update several gems to latest versions [#3675](https://github.com/sharetribe/sharetribe/pull/3675)\n\n## [7.5.0] - 2019-01-30\n\n### Added\n\n- Social media sharing specific image [#3455](https://github.com/sharetribe/sharetribe/pull/3455)\n- Edit reviews feature [#3422](https://github.com/sharetribe/sharetribe/pull/3422)\n- New user segment for sending e-mails to users: \"User who are allowed to post listings\" [#3461](https://github.com/sharetribe/sharetribe/pull/3461)\n- \"Per unit\" default pricing unit [#3462](https://github.com/sharetribe/sharetribe/pull/3462)\n- Japan as supported country for Stripe [#3472](https://github.com/sharetribe/sharetribe/pull/3472)\n- Puerto Rico as supported country for Stripe [#3474](https://github.com/sharetribe/sharetribe/pull/3474)\n- Possibility to hide slogan and description from the cover photo [#3477](https://github.com/sharetribe/sharetribe/pull/3477)\n- Transaction search and filter [#3484](https://github.com/sharetribe/sharetribe/pull/3484) and [#3504](https://github.com/sharetribe/sharetribe/pull/3504)\n- Listing search and filter [#3496](https://github.com/sharetribe/sharetribe/pull/3496)\n- Customizable footer for Pro subscriptions [#3374](https://github.com/sharetribe/sharetribe/pull/3374)\n- New section in admin panel to view and manage invitations [#3505](https://github.com/sharetribe/sharetribe/pull/3505)\n- Add user_id to the listing CSV export [#3511](https://github.com/sharetribe/sharetribe/pull/3511)\n- HSTS support [#3512](https://github.com/sharetribe/sharetribe/pull/3512)\n- Add filters in User search and filters [#3515](https://github.com/sharetribe/sharetribe/pull/3515)\n- Add Conversations search in admin panel [#3521](https://github.com/sharetribe/sharetribe/pull/3521)\n- Admin can act as another user (post listings as, edit profile) [#3525](https://github.com/sharetribe/sharetribe/pull/3525)\n- Admin can resend confirmation email [#3529](https://github.com/sharetribe/sharetribe/pull/3529)\n- Add Review search in admin panel [#3537](https://github.com/sharetribe/sharetribe/pull/3537)\n- Social media sharing specific texts [#3538](https://github.com/sharetribe/sharetribe/pull/3538)\n- Custom link behind marketplace logo [#3564](https://github.com/sharetribe/sharetribe/pull/3564)\n- Ability to edit default top bar menu links [#3565](https://github.com/sharetribe/sharetribe/pull/3565)\n- Admins should be able to see closed listings [#3582](https://github.com/sharetribe/sharetribe/pull/3582)\n- User can browse all their listings in a table [#3584](https://github.com/sharetribe/sharetribe/pull/3584)\n\n\n### Changed\n- Make \"Per unit\" the default pricing unit for product marketplace [#3462](https://github.com/sharetribe/sharetribe/pull/3462)\n- Better messaging for closed marketplaces [#3465](https://github.com/sharetribe/sharetribe/pull/3465)\n- Allow 65 characters in the listing title [#3497](https://github.com/sharetribe/sharetribe/pull/3497)\n- Characters are escaped in URLs [#3546](https://github.com/sharetribe/sharetribe/pull/3546)\n- Updated list of supported and unsupported languages [#3577](https://github.com/sharetribe/sharetribe/pull/3577)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Bug in Hong Kong bank account form [#3456](https://github.com/sharetribe/sharetribe/pull/3456)\n- Bug in transaction agreement text [#3468](https://github.com/sharetribe/sharetribe/pull/3468)\n- Bug in availability per hour manager [#3467](https://github.com/sharetribe/sharetribe/pull/3467)\n- Layout for social media image [#3475](https://github.com/sharetribe/sharetribe/pull/3475)\n- Amazon Web service mail verification [#3471](https://github.com/sharetribe/sharetribe/pull/3471)\n- Number of users when searching in the admin panel [#3483](https://github.com/sharetribe/sharetribe/pull/3483)\n\n### Security\n\n- Fix referrer issue [#3469](https://github.com/sharetribe/sharetribe/pull/3469)\n- Security dependencies update [#3470](https://github.com/sharetribe/sharetribe/pull/3470)\n- Dependency update [#3479](https://github.com/sharetribe/sharetribe/pull/3479)\n\n## [7.4.0] - 2018-10-09\n\n### Added\n\n- View Listings page in the admin panel [#3340](https://github.com/sharetribe/sharetribe/pull/3340)\n- Locations section in the custom landing pages [#3341](https://github.com/sharetribe/sharetribe/pull/3341)\n- Background color and image for any section [#3296](https://github.com/sharetribe/sharetribe/pull/3296)\n- Custom fields for user profiles [#3332](https://github.com/sharetribe/sharetribe/pull/3332)\n- Add a section button for info-2-columns and info-3-columns in the custom landing pages [#3362](https://github.com/sharetribe/sharetribe/pull/3362)\n- File name in the design tab and profile settings to show the stored file [#3364](https://github.com/sharetribe/sharetribe/pull/3364)\n- Allow markdown in user profiles \"About you\" section [#3370](https://github.com/sharetribe/sharetribe/pull/3370)\n- \"Expired\" status in View listings page [#3387](https://github.com/sharetribe/sharetribe/pull/3387)\n- Allow spaces at the end of the e-mails in signup form [#3394](https://github.com/sharetribe/sharetribe/pull/3394)\n- Added Puerto Rico as a Stripe supported country [#3399](https://github.com/sharetribe/sharetribe/pull/3399)\n- Added support for INR with PayPal [#3416](https://github.com/sharetribe/sharetribe/pull/3416)\n- Added support for ARS with PayPal [#3415](https://github.com/sharetribe/sharetribe/pull/3415)\n- Direct link to the admin panel when logging in as admin user[#3414](https://github.com/sharetribe/sharetribe/pull/3414)\n- Added checkmarks to the user fields [#3441](https://github.com/sharetribe/sharetribe/pull/3441)\n- Added the use of session token in Google's autocomplete feature [#3401](https://github.com/sharetribe/sharetribe/pull/3401)\n- Icons to payment provider's page [#3444](https://github.com/sharetribe/sharetribe/pull/3444)\n\n### Changed\n\n- Rename admin panel sections [#3350](https://github.com/sharetribe/sharetribe/pull/3350)\n- Rename save listings button [#3355](https://github.com/sharetribe/sharetribe/pull/3355)\n- Video section variations on the custom landing pages [#3367](https://github.com/sharetribe/sharetribe/pull/3367)\n- Renamed the default category to \"default category\" [#3362](https://github.com/sharetribe/sharetribe/pull/3362)\n- Allow links in the custom user text fields [#3373](https://github.com/sharetribe/sharetribe/pull/3373)\n- Google maps dynamic map for static maps in the listing page [#3382](https://github.com/sharetribe/sharetribe/pull/3382)\n- Change Static map for embedded maps in the listing page [#3395](https://github.com/sharetribe/sharetribe/pull/3395)\n- Update to Circle CI 2.0 [#3360](https://github.com/sharetribe/sharetribe/pull/3360)\n- Profile image is only used once it has been processed [#3427](https://github.com/sharetribe/sharetribe/pull/3427)\n\n### Fixed\n\n- Fix data deletion task to handle missing images [#3349](https://github.com/sharetribe/sharetribe/pull/3349)\n- Requester name in waiting for confirmation messages in the inbox [#3357](https://github.com/sharetribe/sharetribe/pull/3357)\n- Fixed bug in Hungarian Forint minimum transaction size [#3366](https://github.com/sharetribe/sharetribe/pull/3366)\n- Stripe fee information in listing page [#3384](https://github.com/sharetribe/sharetribe/pull/3384)\n- Fixed displaying design page [#3451](https://github.com/sharetribe/sharetribe/pull/3451)\n- Display bug in checkbox user fields [#3385](https://github.com/sharetribe/sharetribe/pull/3385)\n- Fixed a broken link when no date was selected for free \"per day\" and \"per night\" listings [#3410](https://github.com/sharetribe/sharetribe/pull/3410)\n- Allow to leave dropdown option unselected if it is not mandatory [#3446](https://github.com/sharetribe/sharetribe/pull/3446)\n\n## [7.3.1] - 2018-06-07\n\n### Added\n\n- Add soundcloud link support in custom landing page footer [#3300](https://github.com/sharetribe/sharetribe/pull/3300)\n- Add checkbox for consent for receiving emails from admins to signup process [#3318](https://github.com/sharetribe/sharetribe/pull/3318)\n- Add popup notification when giving admin rights to a new user [#3329](https://github.com/sharetribe/sharetribe/pull/3329)\n- Add link to privacy policy in the signup page [#3328](https://github.com/sharetribe/sharetribe/pull/3328)\n- Allow admins to disable end-user Analytics [#3319](https://github.com/sharetribe/sharetribe/pull/3319)\n- Allow links in custom listing text fields [#3297](https://github.com/sharetribe/sharetribe/pull/3297)\n- Add View reviews section in the admin panel [#3267](https://github.com/sharetribe/sharetribe/pull/3267)\n- Add possibility to export transaction as CSV file [#3245](https://github.com/sharetribe/sharetribe/pull/3245)\n\n\n### Changed\n\n- Improve user deletion to clear personal data more thoroughly [#3325](https://github.com/sharetribe/sharetribe/pull/3325)\n- Delete automatically transactions that fail with Stripe [#3326](https://github.com/sharetribe/sharetribe/pull/3326)\n- Prevent an admin from deleting their account if they are the only admin in the marketplace[#3320](https://github.com/sharetribe/sharetribe/pull/3320)\n- Split first name and last name from Stripe account connection form [#3317](https://github.com/sharetribe/sharetribe/pull/3317)\n\n### Removed\n\n- Remove feature flag for export transactions feature [#3288](https://github.com/sharetribe/sharetribe/pull/3288)\n\n### Fixed\n\n- Fix Dockerfile issue where bundler was trying to install binaries in root-owner directory [#3321](https://github.com/sharetribe/sharetribe/pull/3321). Thanks, Nick Meiremans.\n- Fix Stripe payout scheduler [#3309](https://github.com/sharetribe/sharetribe/pull/3309)\n- Fix last 4 digits of SSN passing to Stripe for US bank accounts [#3282](https://github.com/sharetribe/sharetribe/pull/3283)\n\n### Security\n\n- [Critical] Fix several parameter validation bugs that opened the app to SQL injection\n- Update sinatra dependency [#3344](https://github.com/sharetribe/sharetribe/pull/3344)\n- Update multiple dependencies\n- Present form auto-complete for Stripe secret keys [#3338](https://github.com/sharetribe/sharetribe/pull/3338)\n\n## [7.3.0] - 2018-02-23\n\n### Added\n\n- Per hour availability [3166](https://github.com/sharetribe/sharetribe/pull/3166)\n- Support for NZ bank account with Stripe [3165](https://github.com/sharetribe/sharetribe/pull/3165)\n- \"View conversations\" section in admin panel [3173](https://github.com/sharetribe/sharetribe/pull/3173)\n- Account tokens for Stripe bank account connections [3234](https://github.com/sharetribe/sharetribe/pull/3234)\n\n### Changed\n\n- Made user confirmation form more secure [3170](https://github.com/sharetribe/sharetribe/pull/3170)\n\n### Removed\n\n- Confirmation days x after end time of the transaction [3205](https://github.com/sharetribe/sharetribe/pull/3205)\n\n### Fixed\n\n- Improvements to PayPal workflow (IPNs) [3176](https://github.com/sharetribe/sharetribe/pull/3176)\n- Some bugs related to sending emails from admin[#3183](https://github.com/sharetribe/sharetribe/pull/3183)\n\n## [7.2.0] - 2017-11-22\n\n### Added\n\n- Add rack-attack for request throttling [#3078](https://github.com/sharetribe/sharetribe/pull/3078)\n- Stripe integration [#3018](https://github.com/sharetribe/sharetribe/pull/3018)\n- Sending emails from admin to specified subset of users [#3058](https://github.com/sharetribe/sharetribe/pull/3058)\n- Custom Scripts are now also enabled in Custom Landing Page [#3080](https://github.com/sharetribe/sharetribe/pull/3080/files)\n- Allow admins to edit their Custom Outgoing Email and Sender Name [#3106](https://github.com/sharetribe/sharetribe/pull/3106)\n- Allow admins to unban users [3108](https://github.com/sharetribe/sharetribe/pull/3108)\n- Ability to disable Stripe and PayPal [3112](https://github.com/sharetribe/sharetribe/pull/3112)\n- Allow admins to search users by name or email [3113](https://github.com/sharetribe/sharetribe/pull/3113)\n- Add an unsubscribe link to invitation emails [3136](https://github.com/sharetribe/sharetribe/pull/3136)\n- Add more information texts about holding funds with Stripe [3150](https://github.com/sharetribe/sharetribe/pull/3150)\n\n### Changed\n\n- Lowered daily limits for invitations from 50 to 10 [3134](https://github.com/sharetribe/sharetribe/pull/3134)\n- Increased unsubscribe auth token validity from 1 week to 4 weeks [3138](https://github.com/sharetribe/sharetribe/pull/3138)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Fixed correct use of outgoing email address, if configured, when sending manual emails to users [#3058](https://github.com/sharetribe/sharetribe/pull/3058)\n- Fixed sounds of videos in Custom Landing Pages not working [#3101](https://github.com/sharetribe/sharetribe/pull/3101)\n- Fixed listing image reordering when some images were deleted [#3107](https://github.com/sharetribe/sharetribe/pull/3107)\n- Fixed incorrect use of name of receipt email [3127](https://github.com/sharetribe/sharetribe/pull/3127)\n- Fixed many bugs related to Stripe integration\n- Fixed many bugs related to code refactoring\n\n### Security\n\n## [7.1.0] - 2017-09-15\n\n### Added\n\n- Added configuration for trusted proxies [#3040](https://github.com/sharetribe/sharetribe/pull/3040)\n\n### Changed\n\n- Currencies can now be formatted with translations [#3043](https://github.com/sharetribe/sharetribe/pull/3043)\n- Transaction status is now named Completed everywhere instead of Confirmed [#3028](https://github.com/sharetribe/sharetribe/pull/3028)\n- WebTranslateIt API keys were updated [#3029](https://github.com/sharetribe/sharetribe/pull/3029)\n- Force meta tags content to be HTML escaped [#3047](https://github.com/sharetribe/sharetribe/pull/3047)\n- Upgrade to latest ruby 2.3.4 with latest rubygems (2.6.13+) [#3056](https://github.com/sharetribe/sharetribe/pull/3056)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Fixed image deletion in Android [3023](https://github.com/sharetribe/sharetribe/pull/3023)\n- Fixed changing the names of custom listing field options [3024](https://github.com/sharetribe/sharetribe/pull/3024)\n- Fixed image ordering usability in Android [3034](https://github.com/sharetribe/sharetribe/pull/3034)\n- Fixed not sending automatic emails to expired and deleted marketplaces [3044](https://github.com/sharetribe/sharetribe/pull/3044)\n- Fixed carousel black box rendering issue [3045](https://github.com/sharetribe/sharetribe/pull/3045)\n- Fixed datepicker issue with per night availability [3046](https://github.com/sharetribe/sharetribe/pull/3046)\n- Fixed listing checkbox layout issue on mobile [3048](https://github.com/sharetribe/sharetribe/pull/3048)\n- Fixed admin layout issue in Safari [3066](https://github.com/sharetribe/sharetribe/pull/3066)\n- Fixed error message layout placement when reviewing without grade [3067](https://github.com/sharetribe/sharetribe/pull/3067)\n- Fixed managing availability of rejected booking dates [3068](https://github.com/sharetribe/sharetribe/pull/3068)\n\n### Security\n\n## [7.0.0] - 2017-08-08\n\n### Changed\n\n- Updated Rails to 5.1.1 and Node to 7.8 [#2976](https://github.com/sharetribe/sharetribe/pull/2976)\n\n## [6.4.0] - 2017-06-09\n\n### Added\n\n- New feature: User can reorder listing images [#2970](https://github.com/sharetribe/sharetribe/pull/2970)\n\n### Changed\n\n- Change instructions how to compile assets. This reduces the JavaScript bundle size drastically. [c613cac](https://github.com/sharetribe/sharetribe/commit/c613cac)\n\n### Fixed\n\n- Fixed transaction button styles. Styles were broken in IE Edge. [#2968](https://github.com/sharetribe/sharetribe/pull/2968)\n- Fixed admin UI language change. [#2969](https://github.com/sharetribe/sharetribe/pull/2969)\n- Fix old mobile browser compatibility by removing dependency to Intl api. [#2979](https://github.com/sharetribe/sharetribe/pull/2979)\n\n### Security\n\n- Fixed cross-community security issues [#2978](https://github.com/sharetribe/sharetribe/pull/2978)\n\n## [6.3.0] - 2017-04-24\n\n### Changed\n\n- Migrate from database session store to cookie-based session store [#2935](https://github.com/sharetribe/sharetribe/pull/2935)\n\n### Removed\n\n- Removed default twitter handle [#2906](https://github.com/sharetribe/sharetribe/pull/2906)\n\n### Fixed\n\n- Fix cropped cover photo in big screens [#2895](https://github.com/sharetribe/sharetribe/pull/2895)\n- Add missing padding to homepage search field in mobile view [#2895](https://github.com/sharetribe/sharetribe/pull/2895)\n- Fix unwanted scrolling in listing page by removing comment text area auto focus [#2917](https://github.com/sharetribe/sharetribe/pull/2917)\n- Fix faulty feature flag dependency handling [#2932](https://github.com/sharetribe/sharetribe/pull/2932)\n- Fix map bug where multiple listings close to each other caused the icon cluster to disapper when zoomed closed enough [#2942](https://github.com/sharetribe/sharetribe/pull/2942)\n- Fix issue [#2885](https://github.com/sharetribe/sharetribe/issues/2885): Landing page always shows Sign up button for private marketplace, even if the user is logged in [#2944](https://github.com/sharetribe/sharetribe/pull/2944)\n- Fix issue with fetching correct node.js release signing keys in Dockerfile [#2964](https://github.com/sharetribe/sharetribe/pull/2964)\n\n### Security\n\n- Upgrade Nokogiri and rubyzip gems [#2943](https://github.com/sharetribe/sharetribe/pull/2943)\n\n## [6.2.0] - 2017-03-09\n\n### Added\n\n- Add support for redis as cache store [#2786](https://github.com/sharetribe/sharetribe/pull/2786)\n- Add support for using PayPal in fake mode for development purposes. [Read more](./docs/using-fakepal.md) [#2598](https://github.com/sharetribe/sharetribe/pull/2598)\n- Add support for linking to member invitation page in CLP [#2859](https://github.com/sharetribe/sharetribe/pull/2859)\n- New feature: Hide irrelevant search filters when a category or subcategory is selected [#2882](https://github.com/sharetribe/sharetribe/pull/2882)\n- Landing page Markdown support [#2887](https://github.com/sharetribe/sharetribe/pull/2887)\n- Add instructions how to configure Harmony service [#2892](https://github.com/sharetribe/sharetribe/pull/2892)\n- Add support for display name [#2869](https://github.com/sharetribe/sharetribe/pull/2869)\n- Add support for customizing community description and slogan color [#2898](https://github.com/sharetribe/sharetribe/pull/2898)\n\n### Changed\n\n- Redirect user to the page where user was before login/sign up [#2758](https://github.com/sharetribe/sharetribe/pull/2758)\n- Updated NPM packages [#2762](https://github.com/sharetribe/sharetribe/pull/2762)\n\n### Fixed\n\n- Fixed broken transaction button styles [#2723](https://github.com/sharetribe/sharetribe/pull/2723)\n- Fixed number of issues in the Order Types form [#2858](https://github.com/sharetribe/sharetribe/pull/2858)\n- Fixed an issue which caused sign up to fail partially if the Facebook profile picture upload failed [#2886](https://github.com/sharetribe/sharetribe/pull/2886)\n\n## [6.1.0] - 2016-10-31\n\n### Changed\n\n- Updated Node.js to the latest LTS (long term support) version 6.9 [#2655](https://github.com/sharetribe/sharetribe/pull/2665)\n- Updated NPM packages [#2655](https://github.com/sharetribe/sharetribe/pull/2665)\n- Update `react_on_rails` gem [#2655](https://github.com/sharetribe/sharetribe/pull/2665)\n- Upgrade Facebook SDK from v2.2 to v2.8 [#2666](https://github.com/sharetribe/sharetribe/pull/2666)\n- Instruct crawlers not to follow auth paths, add crawling delay for bots that support the directive [#2693](https://github.com/sharetribe/sharetribe/pull/2693)\n\n### Fixed\n\n- Avoid redirect to correct S3 bucket endpoint when bucket is not in `us-east-1` region [#2605](https://github.com/sharetribe/sharetribe/pull/2605)\n- Added missing database indexes [#2621](https://github.com/sharetribe/sharetribe/pull/2621), [#2634](https://github.com/sharetribe/sharetribe/pull/2634), [#2670](https://github.com/sharetribe/sharetribe/pull/2670)\n- Fix bug: `rake assets:precompile` fails if MySQL is not available. Issue fixed by upgrading `money-rails` gem from 1.3 to 1.4 [#2612](https://github.com/sharetribe/sharetribe/pull/2612) by [@nicolaracco](https://github.com/nicolaracco)\n\n### Security\n\n- Fixed insecure gem urls in Gemfile [#2635](https://github.com/sharetribe/sharetribe/pull/2635)\n\n## [6.0.0] - 2016-09-27\n\n### Removed\n\n- Dropped official support for MySQL server version 5.6. Only MySQL 5.7 is officialy supported. This release contains no other changes.\n\n## [5.12.0] - 2016-09-27\n\n### Added\n\n- Added date picker for \"per night\" listing unit type [#2481](https://github.com/sharetribe/sharetribe/pull/2481)\n- SEO: Added `rel=next` and `rel=prev` links to give a hint to crawlers about the paginated content [#2505](https://github.com/sharetribe/sharetribe/pull/2505)\n- Added _New layout_ admin page where marketplace admins can enable new layout designs for the whole marketplace or just for themselves to try out [#2338](https://github.com/sharetribe/sharetribe/pull/2338) and [#2469](https://github.com/sharetribe/sharetribe/pull/2469)\n- Added functionality to edit Post a new listing button text [#2448](https://github.com/sharetribe/sharetribe/pull/2448)\n- Sitemap [#2492](https://github.com/sharetribe/sharetribe/pull/2492), thanks Dan Moore ([@mooreds](https://github.com/mooreds)) for helping!\n- Mocha test setup for new frontend architecture [#2550](https://github.com/sharetribe/sharetribe/pull/2550)\n\n### Deprecated\n\n- Deprecated use of MySQL server version 5.6.x [2566](https://github.com/sharetribe/sharetribe/pull/2566)\n\n### Removed\n\n- Removed configuration for TravisCI (CircleCI now fully in use) [#2489](https://github.com/sharetribe/sharetribe/pull/2489)\n\n### Changed\n\n- Updated React on Rails to 6.0.5 [#2428](https://github.com/sharetribe/sharetribe/pull/2428) and [#2472](https://github.com/sharetribe/sharetribe/pull/2472)\n- Updated [React Storybook](https://github.com/kadirahq/react-storybook) to version 2.13.0 [#2528](https://github.com/sharetribe/sharetribe/pull/2528)\n- Changed ActiveRecord schema format to :sql [#2531](https://github.com/sharetribe/sharetribe/pull/2531)\n- Upgraded Paperclip and Delayed::Paperclip, dropped deprecated AWS SDK v1 [#2522](https://github.com/sharetribe/sharetribe/pull/2522)\n- Upgraded mysql2 dependency [#2565](https://github.com/sharetribe/sharetribe/pull/2565)\n\n### Fixed\n\n- Correctly add https or http to links generated in `community.rb` [#2459](https://github.com/sharetribe/sharetribe/pull/2459)\n- Transactions in `initiated` state showed wrong total price in the transaction page if the item quantity was more than one [#2452](https://github.com/sharetribe/sharetribe/pull/2452)\n- Fix bug in infinite scroll: The current page was not taken into account [#2532](https://github.com/sharetribe/sharetribe/pull/2532)\n- Fix bug: Testimonial reminders were sent even if user had disabled them [#2557](https://github.com/sharetribe/sharetribe/pull/2557)\n- Fix regression: Add quantity pickers to non-payment transactions [#2568](https://github.com/sharetribe/sharetribe/pull/2568)\n\n## [5.11.0] - 2016-08-24\n\n### Changed\n\n- `RAILS_ENV=production` environment added to the `rake assets:compile` command in README [#2440](https://github.com/sharetribe/sharetribe/pull/2440) by [@pcm211](https://github.com/pcm211)\n\n### Removed\n\n- Remove Braintree support completely [#2424](https://github.com/sharetribe/sharetribe/pull/2424), [#2435](https://github.com/sharetribe/sharetribe/pull/2435)\n\n## [5.10.0] - 2016-08-23\n\n### Removed\n\n- Disable Braintree payments [#2423](https://github.com/sharetribe/sharetribe/pull/2423)\n\n## [5.9.0] - 2016-08-18\n\n### Added\n\n- Add support for using CDN for dynamic assets (uploaded images, custom compiled stylesheets) when S3 is otherwise in use [#2314](https://github.com/sharetribe/sharetribe/pull/2314)\n- Add possibility to choose between light and dark background image filter for hero and info sections in custom landing pages [#2310](https://github.com/sharetribe/sharetribe/pull/2310)\n- Add Pinterest link support in custom landing page footer [#2356](https://github.com/sharetribe/sharetribe/pull/2356)\n\n### Changed\n\n- Remove the need for CSS compilation per marketplace [#2325](https://github.com/sharetribe/sharetribe/pull/2325)\n- Update default colors [#2365](https://github.com/sharetribe/sharetribe/pull/2365)\n\n### Removed\n\n- Removed Checkout Finland payment gateway [#2408](https://github.com/sharetribe/sharetribe/pull/2408) [#2406](https://github.com/sharetribe/sharetribe/pull/2406)\n\n### Fixed\n\n- Security: Rails and gems updated [#2393](https://github.com/sharetribe/sharetribe/pull/2393), [#2318](https://github.com/sharetribe/sharetribe/pull/2318)\n- Fix some asset links not respecting `asset_host` setting on landing pages [#2320](https://github.com/sharetribe/sharetribe/pull/2320)\n\n- Fix JS errors in development by replacing `babel-polyfill` with `es6-shim` [#2087](https://github.com/sharetribe/sharetribe/issues/2087)\n\n## [5.8.0] - 2016-07-15\n\n### Added\n\n- Add whitelabel_branding based on features [#2052](https://github.com/sharetribe/sharetribe/pull/2052)\n- Onboarding topbar and wizard enabled for everyone [#2250](https://github.com/sharetribe/sharetribe/pull/2250)\n- Ability to add Google Maps API key [#2172](https://github.com/sharetribe/sharetribe/pull/2172)\n- Landing page. See the [documentation](https://github.com/sharetribe/sharetribe/blob/v5.8.0/docs/landing-page.md)\n\n### Changed\n\n- Facebook sign up/login uses API version 2.2 instead of 2.0 [#2280](https://github.com/sharetribe/sharetribe/pull/2280)\n- Improved documentation [#2271](https://github.com/sharetribe/sharetribe/pull/2271)\n\n### Fixed\n\n- Fix some React dependency issues caused startup timing/ordering [#2046](https://github.com/sharetribe/sharetribe/pull/2046) and [#2053](https://github.com/sharetribe/sharetribe/pull/2053)\n- Fix issue that caused Google Maps Geocoder to return wrong location if the listing address contained an ampersand (&) [#2075](https://github.com/sharetribe/sharetribe/pull/2075)\n- Fix pluralization error for Turkish (tr-TR) [#2292](https://github.com/sharetribe/sharetribe/pull/2292)\n\n## [5.7.1] - 2016-05-12\n\n### Fixed\n\n- Fix missing map icon [#2032](https://github.com/sharetribe/sharetribe/pull/2032)\n\n### Added\n\n- Add instructions for handling libv8 installation problems [#2023](https://github.com/sharetribe/sharetribe/pull/2023)\n- Add [React Storybook](https://github.com/kadirahq/react-storybook) styleguide for React component development [#2030](https://github.com/sharetribe/sharetribe/pull/2030)\n\n## [5.7.0] - 2016-05-11\n\n### Added\n\n- Add a new job queue (css_compile) for css compilations [#1815](https://github.com/sharetribe/sharetribe/pull/1815)\n- Add a warning message which will be shown 15 minutes before the next scheduled maintenance [#1835](https://github.com/sharetribe/sharetribe/pull/1835)\n- Expose used feature flags to Google Tag Manager [#1856](https://github.com/sharetribe/sharetribe/pull/1856)\n- React on Rails development environment [#1918](https://github.com/sharetribe/sharetribe/pull/1918).\n- Add ability to create a new account with username or email which is already in use in another marketplace [#1753](https://github.com/sharetribe/sharetribe/pull/1753) [#1939](https://github.com/sharetribe/sharetribe/pull/1939)\n- Prevents cookies from leaking to subdomains, fixes [#1992](https://github.com/sharetribe/sharetribe/issues/1192), adds a new configuration key: `cookie_session_key` [#1966](https://github.com/sharetribe/sharetribe/pull/1996)\n\n### Changed\n\n- Marketplace ID is removed from the Admin Settings URL [#1839](https://github.com/sharetribe/sharetribe/pull/1839)\n- The application now depends on React components, which need to be built to run Sharetribe. [Instructions here](./client/README.md). This change is related to React on Rails environment [#1918](https://github.com/sharetribe/sharetribe/pull/1918).\n- Update Ruby to 2.3.1 [#2020](https://github.com/sharetribe/sharetribe/pull/2020)\n\n### Deprecated\n\n- Google Analytics and Kissmetrics tracking snippets are deprecated in favor of Google Tag Manager [#1857](https://github.com/sharetribe/sharetribe/pull/1857)\n\n### Removed\n\n- Delete duplicated memberships from the database [#1838](https://github.com/sharetribe/sharetribe/pull/1838)\n- Remove ability to join other marketplaces with an existing account [#1753](https://github.com/sharetribe/sharetribe/pull/1753) [#1939](https://github.com/sharetribe/sharetribe/pull/1939)\n\n### Fixed\n\n- Errors from Braintree API were ignored [#1832](https://github.com/sharetribe/sharetribe/pull/1832) by [@priviterag](https://github.com/priviterag)\n- Fallback language handling was broken [#1869](https://github.com/sharetribe/sharetribe/pull/1869)\n- Confirmation pending page redirects to homepage if the account is already confirmed [#1976](https://github.com/sharetribe/sharetribe/pull/1976)\n- Fix bug: \"Resend confirmation instructions\" button didn't resend the confirmation email [#1963](https://github.com/sharetribe/sharetribe/pull/1963)\n\n### Security\n\n- Updated Paperclip gem [#1836](https://github.com/sharetribe/sharetribe/pull/1836)\n- Unauthorized users were able to upload new listing images [#1866](https://github.com/sharetribe/sharetribe/pull/1866)\n- Change session expiration time from one year to one month [#1877](https://github.com/sharetribe/sharetribe/pull/1877)\n- Correctly reset old password and salt [#1961](https://github.com/sharetribe/sharetribe/pull/1961)\n\n## [5.6.0] - 2016-03-11\n\n### Added\n\n- Add default queue name to jobs [#1814](https://github.com/sharetribe/sharetribe/pull/1814)\n\n### Changed\n\n- Update Ruby to 2.2.4 [#1774](https://github.com/sharetribe/sharetribe/pull/1774)\n\n### Fixed\n\n- Wrong action was executed when radio buttons were clicked back and forth [#1802](https://github.com/sharetribe/sharetribe/pull/1802)\n\n### Security\n\n- Redirect to HTTPS (if configured) before requesting HTTP basic authentication: [#1793](https://github.com/sharetribe/sharetribe/pull/1793)\n\n## [5.5.0] - 2016-03-02\n\n### Changed\n\n- Migrate legacy passwords to Devise's Bcrypt hashing [#1781](https://github.com/sharetribe/sharetribe/pull/1781)\n- Add listing id to option selections table: [#1761](https://github.com/sharetribe/sharetribe/pull/1761) and [#1762](https://github.com/sharetribe/sharetribe/pull/1762)\n- Support optional site-wide HTTP basic authentication: [#1766](https://github.com/sharetribe/sharetribe/pull/1766)\n\n### Fixed\n\n- Fixed broken FontAwesome asset path [#1756](https://github.com/sharetribe/sharetribe/pull/1756)\n- Listing author wasn't able to give feedback if the transaction starter skipped the feedback [#1767](https://github.com/sharetribe/sharetribe/pull/1767)\n\n### Security\n\n- Update Rails to 4.2.5.2 [#1786](https://github.com/sharetribe/sharetribe/pull/1786)\n\n## [5.4.0] - 2016-02-22\n\n### Changed\n\n- Update Ruby to 2.1.8 [#1750](https://github.com/sharetribe/sharetribe/pull/1750)\n\n### Security\n\n- Update JSON Web Token gem [#1723](https://github.com/sharetribe/sharetribe/pull/1723)\n\n### Fixed\n\n- Configure Delayed Job queue adapter for ActiveJob [#1749](https://github.com/sharetribe/sharetribe/pull/1749)\n\n## [5.3.0] - 2016-02-15\n\n### Changed\n\n- Updated Rails to 4.2.5.1 [#1691](https://github.com/sharetribe/sharetribe/pull/1691)\n\n## [5.2.2] - 2016-02-09\n\n### Added\n\n- Initial support for upcoming new search platform. [#1404](https://github.com/sharetribe/sharetribe/pull/1404)\n\n### Changed\n\n- Save model attributes to cache instead of model instances [#1714](https://github.com/sharetribe/sharetribe/pull/1714)\n\n## [5.2.1] - 2016-02-03\n\n### Changed\n\n- Updated Rails to 4.1.14.1 [#1678](https://github.com/sharetribe/sharetribe/pull/1678)\n- Always log deprecation warnings to stderr [#1693](https://github.com/sharetribe/sharetribe/pull/1693)\n\n### Removed\n\n- Removed environment variable `devise_allow_insecure_token_lookup`. [#1675](https://github.com/sharetribe/sharetribe/pull/1675)\n\n### Fixed\n\n- Fixed Mercury Editor image uploader [#1694](https://github.com/sharetribe/sharetribe/pull/1694)\n\n### Security\n\n- Updated Devise gem to version 3.5 [#1675](https://github.com/sharetribe/sharetribe/pull/1675)\n- Updated Sprockets gem to version 2.12.4 [#1692](https://github.com/sharetribe/sharetribe/pull/1692)\n- Remove HTTP end-point that let unauthorized caller to destroy images uploaded via Mercury Editor [#1695](https://github.com/sharetribe/sharetribe/pull/1695)\n\n## [5.2.0] - 2016-01-29\n\n### Added\n\n- Added `secret_key_base` [#1671](https://github.com/sharetribe/sharetribe/pull/1671)\n- Added pessimistic version number for all the gems in Gemfile. Now we can safely run `bundle update` to update gems with patch level updates. [#1663](https://github.com/sharetribe/sharetribe/pull/1663)\n- Added a new environment variable `delayed_job_max_run_time` which controls the maximum time for a single Delayed Job job. [#1668](https://github.com/sharetribe/sharetribe/pull/1668)\n- Added a new environment variable `devise_allow_insecure_token_lookup` for seamless migration from earlier versions. See [UPGRADE.md](UPGRADE.md) for more information. [#1672](https://github.com/sharetribe/sharetribe/pull/1672)\n\n### Changed\n\n- Upgraded jQuery from 1.8.3 to 1.11.1 [#1667](https://github.com/sharetribe/sharetribe/pull/1667)\n- Updated Devise gem to version 3.1. [#1672](https://github.com/sharetribe/sharetribe/pull/1672)\n\n### Removed\n\n- Gemfile clean up. Removed bunch of unused gems. [#1625](https://github.com/sharetribe/sharetribe/pull/1625)\n- Removed ability to downgrade to Rails 3. [#1669](https://github.com/sharetribe/sharetribe/pull/1669)\n\n### Fixed\n\n- Updating a listing field changes the sorting order [#1673](https://github.com/sharetribe/sharetribe/pull/1673)\n\n### Security\n\n- Updated Gems with known security issues [#1667](https://github.com/sharetribe/sharetribe/pull/1667) [#1676](https://github.com/sharetribe/sharetribe/pull/1676)\n\n## [5.1.0] - 2016-01-21\n\n### Added\n\n- Marketplace admins can select if the custom field creates a search filter on the homepage [#1653](https://github.com/sharetribe/sharetribe/pull/1653)\n- CHANGELOG, UPGRADE and RELEASE files [#1658](https://github.com/sharetribe/sharetribe/pull/1658)\n\n## [5.0.0] - 2015-12-31\n\n### Changed\n\n- Rails upgraded from 3.2 to 4.0\n\n## Older releases\n\nFor older releases, see [RELEASE_NOTES.md](https://github.com/sharetribe/sharetribe/blob/v5.0.0/RELEASE_NOTES.md).\n\n[Unreleased]: https://github.com/sharetribe/sharetribe/compare/v10.1.0...HEAD\n[10.1.0]: https://github.com/sharetribe/sharetribe/compare/v10.0.0...v10.1.0\n[10.0.0]: https://github.com/sharetribe/sharetribe/compare/v9.1.0...v10.0.0\n[9.1.0]: https://github.com/sharetribe/sharetribe/compare/v9.0.0...v9.1.0\n[9.0.0]: https://github.com/sharetribe/sharetribe/compare/v8.1.0...v9.0.0\n[8.1.0]: https://github.com/sharetribe/sharetribe/compare/v8.0.0...v8.1.0\n[8.0.0]: https://github.com/sharetribe/sharetribe/compare/v7.6.0...v8.0.0\n[7.6.0]: https://github.com/sharetribe/sharetribe/compare/v7.5.0...v7.6.0\n[7.5.0]: https://github.com/sharetribe/sharetribe/compare/v7.4.0...v7.5.0\n[7.4.0]: https://github.com/sharetribe/sharetribe/compare/v7.3.1...v7.4.0\n[7.3.1]: https://github.com/sharetribe/sharetribe/compare/v7.3.0...v7.3.1\n[7.3.0]: https://github.com/sharetribe/sharetribe/compare/v7.2.0...v7.3.0\n[7.2.0]: https://github.com/sharetribe/sharetribe/compare/v7.1.0...v7.2.0\n[7.1.0]: https://github.com/sharetribe/sharetribe/compare/v7.0.0...v7.1.0\n[7.0.0]: https://github.com/sharetribe/sharetribe/compare/v6.4.0...v7.1.0\n[6.4.0]: https://github.com/sharetribe/sharetribe/compare/v6.3.0...v6.4.0\n[6.3.0]: https://github.com/sharetribe/sharetribe/compare/v6.2.0...v6.3.0\n[6.2.0]: https://github.com/sharetribe/sharetribe/compare/v6.1.0...v6.2.0\n[6.1.0]: https://github.com/sharetribe/sharetribe/compare/v6.0.0...v6.1.0\n[6.0.0]: https://github.com/sharetribe/sharetribe/compare/v5.12.0...v6.0.0\n[5.12.0]: https://github.com/sharetribe/sharetribe/compare/v5.11.0...v5.12.0\n[5.11.0]: https://github.com/sharetribe/sharetribe/compare/v5.10.0...v5.11.0\n[5.10.0]: https://github.com/sharetribe/sharetribe/compare/v5.9.0...v5.10.0\n[5.9.0]: https://github.com/sharetribe/sharetribe/compare/v5.8.0...v5.9.0\n[5.8.0]: https://github.com/sharetribe/sharetribe/compare/v5.7.1...v5.8.0\n[5.7.1]: https://github.com/sharetribe/sharetribe/compare/v5.7.0...v5.7.1\n[5.7.0]: https://github.com/sharetribe/sharetribe/compare/v5.6.0...v5.7.0\n[5.6.0]: https://github.com/sharetribe/sharetribe/compare/v5.5.0...v5.6.0\n[5.5.0]: https://github.com/sharetribe/sharetribe/compare/v5.4.0...v5.5.0\n[5.4.0]: https://github.com/sharetribe/sharetribe/compare/v5.3.0...v5.4.0\n[5.3.0]: https://github.com/sharetribe/sharetribe/compare/v5.2.2...v5.3.0\n[5.2.2]: https://github.com/sharetribe/sharetribe/compare/v5.2.1...v5.2.2\n[5.2.1]: https://github.com/sharetribe/sharetribe/compare/v5.2.0...v5.2.1\n[5.2.0]: https://github.com/sharetribe/sharetribe/compare/v5.1.0...v5.2.0\n[5.1.0]: https://github.com/sharetribe/sharetribe/compare/v5.0.0...v5.1.0\n[5.0.0]: https://github.com/sharetribe/sharetribe/compare/v4.6.0...v5.0.0\n", "class AmazonBouncesController < ApplicationController\n  skip_before_action :verify_authenticity_token, :only => :notification\n  skip_before_action :fetch_community\n  skip_before_action :perform_redirect\n\n  before_action :check_sns_token\n\n  def notification\n    amz_message_type = request.headers['x-amz-sns-message-type']\n\n    if amz_message_type.to_s.downcase == 'subscriptionconfirmation'\n      send_subscription_confirmation request.raw_post\n      head :ok and return\n    end\n\n    if amz_message_type.to_s.downcase == 'notification'\n      msg = JSON.parse(request.raw_post)\n      # Sometimes amazon sends notifications more wrapped than other times\n      msg = JSON.load(msg['Message']) unless msg['Message'].nil?\n      type = msg['notificationType']\n\n      if type == 'Bounce'\n        handle_bounces(msg)\n      elsif type == 'Complaint'\n        handle_complaints(msg)\n      else\n        logger.warn \"\\nUnrecognized message from Amazon SNS notification center:\"\n        logger.warn msg.to_s\n      end\n    end\n    head :ok\n  end\n\n  private\n\n  def send_subscription_confirmation(request_body)\n    require 'open-uri'\n    json = JSON.parse(request_body)\n    subscribe_url = json['SubscribeURL']\n    open(subscribe_url) # rubocop:disable Security/Open\n  end\n\n  def handle_bounces(msg)\n    bounce = msg['bounce']\n    bounce_recipients = bounce['bouncedRecipients']\n    bounce_recipients.each do |recipient|\n      Email.unsubscribe_email_from_community_updates(recipient['emailAddress'])\n    end\n  end\n\n\n  def handle_complaints(msg)\n    complaint = msg['complaint']\n    complaint_recipients = complaint['complainedRecipients']\n    complaint_recipients.each do |recipient|\n      Email.unsubscribe_email_from_community_updates(recipient['emailAddress'])\n    end\n    unless complaint['complaintFeedbackType'].nil?\n      logger.info \"\\nComplaint with feedback from Amazon SNS notification center:\"\n      logger.info msg.to_s\n    end\n  end\n\n  def check_sns_token\n    if APP_CONFIG.sns_notification_token != params['sns_notification_token']\n      return head :ok\n    end\n  end\n\nend\n", "require 'spec_helper'\n\ndescribe \"Amazon Bounces\", type: :request do\n\n  before(:each) do\n    @community = FactoryGirl.create(:community, :domain => \"market.custom.org\")\n  end\n\n  describe \"test notifications\" do\n\n    it \"when notificationType is bounce\" do\n      # Prepare\n      @person = FactoryGirl.create(:person, id: \"123abc\", min_days_between_community_updates: 4)\n      @person.emails = [\n        FactoryGirl.create(:email, :address => \"one@examplecompany.co\", :send_notifications => true),\n      ]\n\n      incoming_data = JSON.parse('{\n        \"notificationType\":\"Bounce\",\n        \"bounce\":{\n           \"bounceType\":\"Permanent\",\n           \"bounceSubType\": \"General\",\n           \"bouncedRecipients\":[\n              {\n                 \"emailAddress\":\"one@examplecompany.co\"\n              }\n           ],\n           \"timestamp\":\"2012-05-25T14:59:38.237-07:00\",\n           \"feedbackId\":\"00000137860315fd-869464a4-8680-4114-98d3-716fe35851f9-000000\"\n        },\n        \"mail\":{\n           \"timestamp\":\"2012-05-25T14:59:38.237-07:00\",\n           \"messageId\":\"00000137860315fd-34208509-5b74-41f3-95c5-22c1edc3c924-000000\",\n           \"source\":\"email_1337983178237@amazon.com\",\n           \"destination\":[\n              \"recipient1@example.com\",\n              \"recipient2@example.com\",\n              \"recipient3@example.com\",\n              \"recipient4@example.com\"\n           ]\n        }\n      }')\n\n      expect(@person.min_days_between_community_updates).to be_equal 4\n      post \"https://market.custom.org/bounces?sns_notification_token=#{APP_CONFIG.sns_notification_token}\", params: incoming_data.to_json.to_s, headers: { 'x-amz-sns-message-type' => 'notification'}\n      expect(Person.find_by_id(@person.id).min_days_between_community_updates).to be_equal 100000\n    end\n\n    it \"when notificationType is Complaint\" do\n      # Prepare\n      @person = FactoryGirl.create(:person, id: \"123abc\", min_days_between_community_updates: 4)\n      @person.emails = [\n        FactoryGirl.create(:email, :address => \"one@examplecompany.co\", :send_notifications => true),\n      ]\n\n      incoming_data = JSON.parse('{\n        \"notificationType\":\"Complaint\",\n        \"complaint\":{\n           \"userAgent\":\"Comcast Feedback Loop (V0.01)\",\n           \"complainedRecipients\":[\n              {\n                 \"emailAddress\":\"one@examplecompany.co\"\n              }\n           ],\n           \"complaintFeedbackType\":\"abuse\",\n           \"arrivalDate\":\"2009-12-03T04:24:21.000-05:00\",\n           \"timestamp\":\"2012-05-25T14:59:38.623-07:00\",\n           \"feedbackId\":\"000001378603177f-18c07c78-fa81-4a58-9dd1-fedc3cb8f49a-000000\"\n        },\n        \"mail\":{\n           \"timestamp\":\"2012-05-25T14:59:38.623-07:00\",\n           \"messageId\":\"000001378603177f-7a5433e7-8edb-42ae-af10-f0181f34d6ee-000000\",\n           \"source\":\"email_1337983178623@amazon.com\",\n           \"destination\":[\n              \"recipient1@example.com\",\n              \"recipient2@example.com\",\n              \"recipient3@example.com\",\n              \"recipient4@example.com\"\n           ]\n        }\n      }')\n\n      expect(@person.min_days_between_community_updates).to be_equal 4\n      post \"https://market.custom.org/bounces?sns_notification_token=#{APP_CONFIG.sns_notification_token}\", params: incoming_data.to_json.to_s, headers: { 'x-amz-sns-message-type' => 'notification'}\n      expect(Person.find_by_id(@person.id).min_days_between_community_updates).to be_equal 100000\n    end\n\n  end\nend\n"], "fixing_code": ["# Change Log\n\nAll notable changes to this project will be documented in this file.\n\nThis project adheres to [Semantic Versioning](http://semver.org/) where possible.\n\nThis file follows the best practices from [keepachangelog.com](http://keepachangelog.com/).\n\n## [Unreleased]\n\n### Added\n\n### Changed\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n### Security\n\n- [Critical] Fix OS command injection vulnerability in installations of\n  Sharetribe Go that do not set explicitly the `sns_notification_token`\n  configuration variable (which is unset by default).\n\n## [10.2.0] - 2021-11-18\n\n### Added\n\n- New Admin panel additions and fixes, done through many many commits/PRs/branches that have `admin2` or `admin v2`in their title\n- Support for French overseas departments/regions IBAN [#4369](https://github.com/sharetribe/sharetribe/pull/4369)\n- Custom Landing Page icon picker [#12adad](https://github.com/sharetribe/sharetribe/commit/12adadc7734d22f0be610440b5e9f721114a9284)\n- Add new body and css fields to the Custom script feature [#46a066](https://github.com/sharetribe/sharetribe/commit/46a0660a5ff3fc864ba8f9e68a0fafd35aa83a5f)\n- Redirect an already logged in user to the home page when they visit the login page [#603eee](https://github.com/sharetribe/sharetribe/commit/603eeedad224376166d0b4a6ea7a9253f4fc1d3b)\n- Validation for the Google Analytics tracking ID field [#46aff6](https://github.com/sharetribe/sharetribe/commit/46aff666845a56787a7e2801acba8a54370c6ef6)\n\n### Changed\n\n- Don't display payment details banner reminder for deleted listings [#4371](https://github.com/sharetribe/sharetribe/pull/4371)\n- Cache fonts partial to avoid scss rendering on every page load [#4367](https://github.com/sharetribe/sharetribe/pull/4367) and [#f158cb9](https://github.com/sharetribe/sharetribe/commit/f158cb9dc61186d5fe9e785d0c738eb54e7d023f)\n- Minimum listing price refactor [#08b61a](https://github.com/sharetribe/sharetribe/commit/08b61af6d26613cf1d132d7c6b237b2161df1e5c)\n- Default first and last names values [#20b662](https://github.com/sharetribe/sharetribe/commit/20b66261753ce95a857fd72b8725e7887fa14874)\n- Update Facebook API graph version [#0a90bb](https://github.com/sharetribe/sharetribe/commit/0a90bb4801d12fd92826a457163bc5d8d1226d78)\n- Update font-family to use the same one everywhere [#41212e](https://github.com/sharetribe/sharetribe/commit/41212e8d1f08b4e73a967aa1231ed2b4f6cbb523)\n\n### Fixed\n- Fixed error message in incorrect location in signup form [#4360](https://github.com/sharetribe/sharetribe/pull/4360)\n- Fixed email notifications can be configured to use an unconfirmed address [#4362](https://github.com/sharetribe/sharetribe/pull/4362)\n- Fixed incorrect use of plural in a review date text on Profile pages [#4361](https://github.com/sharetribe/sharetribe/pull/4361)\n- Fixed wrong name in email notifications [#d66b90](https://github.com/sharetribe/sharetribe/commit/d66b900be0fce2b549f8f348b2eb244619e5ae0c)\n- Fixed UI overlay issue with profile picture on profile pages [#2075e9](https://github.com/sharetribe/sharetribe/commit/2075e9a093dea23d5c574397d679619cd1d50026)\n- Fixed incorrect commission fee shown on the transaction page for buyers if they are also admins [#9e0176](https://github.com/sharetribe/sharetribe/commit/9e017670a8d8e2afd87836be00e46b054a3e6256)\n- Fixed Facebook & LinkedIn logos too small on signup and login pages [#3fdff2](https://github.com/sharetribe/sharetribe/commit/3fdff202ca1e03e8c33d2948de5ff545ee34bc7e)\n- Fixed email sending feature producing error with certain sender names [#5b4a40](https://github.com/sharetribe/sharetribe/commit/5b4a40870e972239d2b6241710f03e592a3309bc)\n- Fixed Custom Landing Page - BrowserDetectVideoAutoplay is not defined [#55352e](https://github.com/sharetribe/sharetribe/commit/55352e769790571d8e25bb739facd87e84b03808)\n- Fixed checkout fails when the total of minimum seller + buyer fees is higher than the listing price [#fc077e](https://github.com/sharetribe/sharetribe/commit/fc077e123f05b1dda9e3463bc4f7efe819590a3f)\n- Fixed module is not defined error [#64f7d7](https://github.com/sharetribe/sharetribe/commit/64f7d7a3acbdbde8bbad2552471735666685aaf2)\n\n### Security\n\n- Upgrade Rails to 5.2.4.5 as well as gems [#4366](https://github.com/sharetribe/sharetribe/pull/4366)\n- Dependencies update [#4373](https://github.com/sharetribe/sharetribe/pull/4373), [#037932](https://github.com/sharetribe/sharetribe/commit/037932af4fda4edea518200391b3a74d301c2bec), [b1c10a](https://github.com/sharetribe/sharetribe/commit/b1c10a4bf5f44ae06f549f3a6b1951f4a8c59626), [#3e00b7](https://github.com/sharetribe/sharetribe/commit/3e00b77c89c006c279fc3758b692ab883677427c), [#cbf815](https://github.com/sharetribe/sharetribe/commit/cbf815a5fbbeeb5c7b3675ef69616d91363b826b), [#7e0eb9](https://github.com/sharetribe/sharetribe/commit/7e0eb94d2bc01ebe5f8e27c6e510631d004c8409), [#1b9d66](https://github.com/sharetribe/sharetribe/commit/1b9d669c05b7023246ce027cf4f7abca65ecde1b)\n\n## [10.1.0] - 2021-03-17\n\n### Added\n\n- New Admin panel, done through many many PRs that have `admin2` or `admin v2`in their title\n- Info text to Stripe form [#4118](https://github.com/sharetribe/sharetribe/pull/4118)\n- Stripe support for Cyprus [#4122](https://github.com/sharetribe/sharetribe/pull/4122)\n- Stripe support for Malta [#4123](https://github.com/sharetribe/sharetribe/pull/4123)\n- Stripe support for Bulgaria [#4124](https://github.com/sharetribe/sharetribe/pull/4124)\n- Add \"paypal/stripe setup\" in users csv export [#4003](https://github.com/sharetribe/sharetribe/pull/4003), [#4196](https://github.com/sharetribe/sharetribe/pull/4196)\n- UI for setting custom domain [#4227](https://github.com/sharetribe/sharetribe/pull/4227), [#4237](https://github.com/sharetribe/sharetribe/pull/4237), [#4241](https://github.com/sharetribe/sharetribe/pull/4241), [#4296](https://github.com/sharetribe/sharetribe/pull/4296), [#4312](https://github.com/sharetribe/sharetribe/pull/4312)\n- reCAPTCHA support [#4299](https://github.com/sharetribe/sharetribe/pull/4299)\n- Email notification to admins when changing the marketplace ident [#4326](https://github.com/sharetribe/sharetribe/pull/4326)\n- Missing settings for two email notifications [#4328](https://github.com/sharetribe/sharetribe/pull/4328)\n- Stripe support for Hungary [#4295](https://github.com/sharetribe/sharetribe/pull/4295)\n\n### Changed\n\n- Increase Facebook and Twitter meta images size [#4100](https://github.com/sharetribe/sharetribe/pull/4100)\n- Add more states to FINISHED_TX_STATES to allow user account deletion correctly [#4109](https://github.com/sharetribe/sharetribe/pull/4109)\n- Update airbrake and newrelic [#4111](https://github.com/sharetribe/sharetribe/pull/4111)\n- Remove default favicon and add type tag to favicon link [#4140](https://github.com/sharetribe/sharetribe/pull/4140)\n- Make active storage service configurable [#4143](https://github.com/sharetribe/sharetribe/pull/4143)\n- Specify the requested fields in Google Maps Places API query [#4146](https://github.com/sharetribe/sharetribe/pull/4146)\n- Review text is required in edits from admins [#4153](https://github.com/sharetribe/sharetribe/pull/4153)\n- Update Proxima font [#4177](https://github.com/sharetribe/sharetribe/pull/4177)\n- Adjust CircleCI configuration for faster test runs [#4274](https://github.com/sharetribe/sharetribe/pull/4274)\n- Make the Custom script plan_feature dependent [#4289](https://github.com/sharetribe/sharetribe/pull/4289)\n- Fix job priorities [#4294](https://github.com/sharetribe/sharetribe/pull/)\n- Email layout v2 - Link color consistency with marketplace color [#4303](https://github.com/sharetribe/sharetribe/pull/4303)\n- Optimize polling for pending delayed jobs [#4311](https://github.com/sharetribe/sharetribe/pull/4311)\n- Email layout v2 - Disable markdown formatting in listing description [#4305](https://github.com/sharetribe/sharetribe/pull/4305)\n- Improve efficiency of community membership counting [#4319](https://github.com/sharetribe/sharetribe/pull/4319)\n- Email layout v2 - Add note to email layout [#4318](https://github.com/sharetribe/sharetribe/pull/4318)\n- Email layout v2 - Disable markdown formatting in listing description [#4305](https://github.com/sharetribe/sharetribe/pull/4305)\n- Email layout v2 - Remove ability to change feature flag from Admin panel [#4307](https://github.com/sharetribe/sharetribe/pull/4307)\n- Use the community default locale for CLP [#4341](https://github.com/sharetribe/sharetribe/pull/4341)\n- Change the main font for Go UI to Proxima soft [#4353](https://github.com/sharetribe/sharetribe/pull/4353)\n\n### Removed\n\n- Sunset PayPal in India [#4338](https://github.com/sharetribe/sharetribe/pull/4338)\n\n### Fixed\n\n- Fixed query for booked dates in range [#4091](https://github.com/sharetribe/sharetribe/pull/4044)\n- Fixed error when using daily availability management datepicker [#4094](https://github.com/sharetribe/sharetribe/pull/4094)\n- Fixed confirming payment multiple times with Stripe [#4102](https://github.com/sharetribe/sharetribe/pull/4102)\n- Fixed inconsistent transaction left after transition fails [#4092](https://github.com/sharetribe/sharetribe/pull/4092)\n- Fixed CLP hero section with upload background image [#4101](https://github.com/sharetribe/sharetribe/pull/4101)\n- Fixed search with fuzzy location [#4103](https://github.com/sharetribe/sharetribe/pull/4103)\n- Fixed issue with error translation in some languages [#4132](https://github.com/sharetribe/sharetribe/pull/4132)\n- Fixed user display_name [#4130](https://github.com/sharetribe/sharetribe/pull/4130)\n- Fixed active map view on listing page [#4145](https://github.com/sharetribe/sharetribe/pull/4145)\n- Fixed default setting automatic newsletters [#4150](https://github.com/sharetribe/sharetribe/pull/4150)\n- Fixed bug with \"Display name\" not being used in transaction steps texts [#4155](https://github.com/sharetribe/sharetribe/pull/4155)\n- Fixed no listing location makes clicks on \"Show in the next newsletter\" impossible [#4181](https://github.com/sharetribe/sharetribe/pull/4181)\n- Fixed infinite scroll on homepage not working w/ Chromium 87 [#4273](https://github.com/sharetribe/sharetribe/pull/4273)\n- Fixed test email not sent to admin if they have unsubscribed [#4327](https://github.com/sharetribe/sharetribe/pull/4327)\n- Fixed inconsistency between the Unsubscribe link in the Receipt of payment email and the notification setting [#4329](https://github.com/sharetribe/sharetribe/pull/4329)\n- Fixed rels deleted users [#4340](https://github.com/sharetribe/sharetribe/pull/4340)\n- Fixed Facebook buttons cut off and misaligned [#4348](https://github.com/sharetribe/sharetribe/pull/4348)\n\n### Security\n\n- Updated fileupload plugin [#4136](https://github.com/sharetribe/sharetribe/pull/4136)\n- Update rails to 5.2.4.3 [#4141](https://github.com/sharetribe/sharetribe/pull/4141)\n- Update rails to 5.2.4.4 [#4231](https://github.com/sharetribe/sharetribe/pull/4231)\n- Upgrades node-sass and json [#4233](https://github.com/sharetribe/sharetribe/pull/4233)\n- Add tests ensuring csrf protection for omniauth auth paths [#4266](https://github.com/sharetribe/sharetribe/pull/4266)\n- Vulnerable dependencies updates - Axios, Nokogiri, Redcarpet [#4325](https://github.com/sharetribe/sharetribe/pull/4325)\n\n## [10.0.0] - 2020-05-10\n\n### Added\n\n- Fuzzy location [#4035](https://github.com/sharetribe/sharetribe/pull/4035)\n- Stripe support for Czech Republic [#4049](https://github.com/sharetribe/sharetribe/pull/4049), [#4069](https://github.com/sharetribe/sharetribe/pull/4069)\n- Allow admin to edit the button in Hero section [#4051](https://github.com/sharetribe/sharetribe/pull/4051)\n- Stripe support for Romania [#4066](https://github.com/sharetribe/sharetribe/pull/4066)\n\n### Changed\n\n- Go no longer uses [Harmony](/docs/configure_harmony.md) for availability management. Functionality is now implemented fully in Go. See the [upgrade instructions](UPGRADE.md#upgrade-from-910-to-1000). [#4020](https://github.com/sharetribe/sharetribe/pull/4020), [#4037](https://github.com/sharetribe/sharetribe/pull/4037), [#4043](https://github.com/sharetribe/sharetribe/pull/4043), [#4048](https://github.com/sharetribe/sharetribe/pull/4048), [#4071](https://github.com/sharetribe/sharetribe/pull/4071)\n- Copy texts for admin email notification of new entry in Contact form [#4077](https://github.com/sharetribe/sharetribe/pull/4077)\n\n### Fixed\n\n- Fixed inbox doesn't consider commission status [#4044](https://github.com/sharetribe/sharetribe/pull/4044)\n- Fixed encoding issue with PayPal [#4045](https://github.com/sharetribe/sharetribe/pull/4045)\n- Fixed missing listing image in community updates email [#4046](https://github.com/sharetribe/sharetribe/pull/4046)\n- Fixed scope of transations for testimonials to support Disputed [#4063](https://github.com/sharetribe/sharetribe/pull/4063)\n\n## [9.1.0] - 2020-03-06\n\n### Added\n\n- Custom Landing Page Editor\n- New emails layout\n- Support for Stripe capabilities\n- Allow admin to mark completed cancel transactions [#3889](https://github.com/sharetribe/sharetribe/pull/3889)\n- Added listing price and unit to csv export [#3891](https://github.com/sharetribe/sharetribe/pull/3891)\n- Add listing price to RSS/Atom feed [#3892](https://github.com/sharetribe/sharetribe/pull/3892)\n- Add link to delete closed listing [#3893](https://github.com/sharetribe/sharetribe/pull/3893)\n- Add shipping address to Transaction view [#3910](https://github.com/sharetribe/sharetribe/pull/3910)\n- Add a transaction state after canceled and improve the flow [#3926](https://github.com/sharetribe/sharetribe/pull/3926)\n- Add support for Mexico accounts [#3937](https://github.com/sharetribe/sharetribe/pull/3937)\n- Allow users to edit their username [#3941](https://github.com/sharetribe/sharetribe/pull/3941)\n- Add \"My transactions\" view in user settings [#3943](https://github.com/sharetribe/sharetribe/pull/3943)\n- Add GHS currency [#3944](https://github.com/sharetribe/sharetribe/pull/3944)\n- Add support for HEIC images [#3966](https://github.com/sharetribe/sharetribe/pull/3966)\n- Allow admin to update the marketplace ident [#3972](https://github.com/sharetribe/sharetribe/pull/3972)\n- Allow admins to delete a user account [#3975](https://github.com/sharetribe/sharetribe/pull/3975)\n- Retry paypal errored commission [#3977](https://github.com/sharetribe/sharetribe/pull/3977)\n- New texts for Google Search Console [#3979](https://github.com/sharetribe/sharetribe/pull/3979)\n- New Add text about GTM [#3997](https://github.com/sharetribe/sharetribe/pull/3997)\n- Add \"paypal/stripe setup\" in users csv export [#4003](https://github.com/sharetribe/sharetribe/pull/4003)\n- Admin can remove logo, square logo, cover photo, small cover photo, favicon, social media image [#4012](https://github.com/sharetribe/sharetribe/pull/4012)\n\n### Changed\n\n- Send additional verification document if required [#3897](https://github.com/sharetribe/sharetribe/pull/3897)\n- Change to dropdown for state values for Canada and Australia [#3905](https://github.com/sharetribe/sharetribe/pull/3905)\n- Title in admin transaction view [#3911](https://github.com/sharetribe/sharetribe/pull/3911)\n- No default option selected if pickup and shipping are offered [#3938](https://github.com/sharetribe/sharetribe/pull/3938)\n- Stripe API version changed to 2019-12-03 [#3948](https://github.com/sharetribe/sharetribe/pull/3948)\n- Hide \"Newsletter\" settings if newsletter has been disabled by admins [#3959](https://github.com/sharetribe/sharetribe/pull/3959)\n- Change meta tag xx:image to use profile picture for user profiles[#3960](https://github.com/sharetribe/sharetribe/pull/3960)\n- Update to Ruby 2.6.5 and a Debian Buster base Docker image [#3967](https://github.com/sharetribe/sharetribe/pull/3967)\n- Delete invitations sent by a user who gets deleted forever [#3973](https://github.com/sharetribe/sharetribe/pull/3973)\n- Show account restricted or pending in the smart way [#3990](https://github.com/sharetribe/sharetribe/pull/3990)\n- Send MCC/Email/URL when updating a Connect account [#3993](https://github.com/sharetribe/sharetribe/pull/3993)\n- Link to transaction should redirect to admin view [#3998](https://github.com/sharetribe/sharetribe/pull/3998)\n- Update the forms to have phone placeholder and JPG information [#4004](https://github.com/sharetribe/sharetribe/pull/4004)\n- Remove Google+ from CLP and Footer [#4005](https://github.com/sharetribe/sharetribe/pull/4005)\n- Longer number of characters for Display name [#4007](https://github.com/sharetribe/sharetribe/pull/4007)\n- Add the listing ID to PayPal's metadata [#4013](https://github.com/sharetribe/sharetribe/pull/4013)\n- Validation if SEO variables are not correct [#4014](https://github.com/sharetribe/sharetribe/pull/4014)\n\n### Fixed\n\n- Fixed users CSV export date field not required [#3886](https://github.com/sharetribe/sharetribe/pull/3886)\n- Fixed notification for each new transaction [#3887](https://github.com/sharetribe/sharetribe/pull/3887)\n- Fix meta title/description bug for social [#3894](https://github.com/sharetribe/sharetribe/pull/3894)\n- Fixed payment JS in older browser [#3920](https://github.com/sharetribe/sharetribe/pull/3920)\n- Fixed listing image width setup [#3921](https://github.com/sharetribe/sharetribe/pull/3921)\n- Fixed day/night availability after payment intent failed or expired [#3922](https://github.com/sharetribe/sharetribe/pull/3922)\n- Fixed check payment method presence when initiating payment [#3935](https://github.com/sharetribe/sharetribe/pull/3935)\n- Fixed Stripe payment card declined without SCA [#3952](https://github.com/sharetribe/sharetribe/pull/3952)\n- Fixed localization of PayPal payment description when charging the admin commission [#3961](https://github.com/sharetribe/sharetribe/pull/3961)\n- Fixed incorrect count of listings when editing an Order type isn't correct [#3964](https://github.com/sharetribe/sharetribe/pull/3964)\n- Fixed incorrect language in placeholder for social media tags [#3995](https://github.com/sharetribe/sharetribe/pull/3995)\n- Fixed wrong receipt for the seller when there is Shipping involved [#4009](https://github.com/sharetribe/sharetribe/pull/4009)\n- Fixed followers get notifications of rejected listings [#4011](https://github.com/sharetribe/sharetribe/pull/4011)\n\n### Security\n\n- Updated gems: rubyzip 1.3.0, devise 4.7.1 [#3899](https://github.com/sharetribe/sharetribe/pull/3899)\n- Bump loofah from 2.3.0 to 2.3.1 [#3918](https://github.com/sharetribe/sharetribe/pull/3918)\n- Bump puma from 3.12.1 to 3.12.2 [#3936](https://github.com/sharetribe/sharetribe/pull/3936)\n- Bump rack from 2.0.7 to 2.0.8 [#3951](https://github.com/sharetribe/sharetribe/pull/3951)\n- Bump nokogiri from 1.10.5 to 1.10.8 [#4010](https://github.com/sharetribe/sharetribe/pull/4010)\n- Bump puma from 3.12.2 to 3.12.4 [#4021](https://github.com/sharetribe/sharetribe/pull/4021)\n\n## [9.0.0] - 2019-10-02\n\n### Changed\n\n- Update Sharetribe Go Licence [#3883](https://github.com/sharetribe/sharetribe/pull/3883)\n\n## [8.1.0] - 2019-10-02\n\n### Added\n\n- Stripe SCA paymentintent based preauth process [#3791](https://github.com/sharetribe/sharetribe/pull/3791)\n- Stripe SCA finalize ui and management [#3805](https://github.com/sharetribe/sharetribe/pull/3805)\n- Support for markdown in listing descriptions [#3795](https://github.com/sharetribe/sharetribe/pull/3795), [#3810](https://github.com/sharetribe/sharetribe/pull/3810), [#3874](https://github.com/sharetribe/sharetribe/pull/3874)\n- Add \"Whats new?\" link in the sidebar [#3822](https://github.com/sharetribe/sharetribe/pull/3822)\n- Add ready made cover pics link next to the cover pick chooser [#3823](https://github.com/sharetribe/sharetribe/pull/3823)\n- Add \"Terms, Privacy Policy and static content\" table and links in \"Basic details\" tab [#3827](https://github.com/sharetribe/sharetribe/pull/3827)\n- Add four new fields to the transactions CSV export [#3845](https://github.com/sharetribe/sharetribe/pull/3845)\n- Allow admins to unskip reviews [#3857](https://github.com/sharetribe/sharetribe/pull/3857)\n- Admin option to send a notification for each new transaction [#3859](https://github.com/sharetribe/sharetribe/pull/3859)\n- Add new countries support: Estonia, Greece, Latvia, Lithuania, Poland, Slovakia, Slovenia [#3872](https://github.com/sharetribe/sharetribe/pull/3872)\n\n### Changed\n\n- In shipping address replace country dropdown with text field [#3815](https://github.com/sharetribe/sharetribe/pull/3815)\n- Use community currency for free transactions avoiding nil.to_money == 0 EUR [#3816](https://github.com/sharetribe/sharetribe/pull/3816)\n- Edit some CSV exports [#3828](https://github.com/sharetribe/sharetribe/pull/3828)\n- Change datetime format in all CSV exports [#3844](https://github.com/sharetribe/sharetribe/pull/3844)\n- Remove username from signup [#3853](https://github.com/sharetribe/sharetribe/pull/3853)\n\n### Removed\n\n- Remove google-site-verification from head and hardcoded GWT tag [#3825](https://github.com/sharetribe/sharetribe/pull/3825), [#3826](https://github.com/sharetribe/sharetribe/pull/3826)\n\n### Fixed\n\n- Order Type name for free listings was not updating cached fragment [#3836](https://github.com/sharetribe/sharetribe/pull/3836)\n- Disabling top bar default links (about, contact) is not possible [#3840](https://github.com/sharetribe/sharetribe/pull/3840)\n\n## [8.0.0] - 2019-07-31\n\n### Added\n\n- Use index hint for homepage query [#3714](https://github.com/sharetribe/sharetribe/pull/3714)\n- Add Albanian to the list of unsupported languages [#3718](https://github.com/sharetribe/sharetribe/pull/3718)\n- Add Macedonian to the list of unsupported languages [#3725](https://github.com/sharetribe/sharetribe/pull/3725)\n- Add .html_safe to content for title [#3744](https://github.com/sharetribe/sharetribe/pull/3744)\n- Ability for providers to delete listings [#3756](https://github.com/sharetribe/sharetribe/pull/3756)\n- Stripe support for Singapore [#3762](https://github.com/sharetribe/sharetribe/pull/3762)\n- Cache community count [#3766](https://github.com/sharetribe/sharetribe/pull/3766)\n- Ability to export listings to a CSV file [#3790](https://github.com/sharetribe/sharetribe/pull/3790)\n- Allow admins to disable direct messaging between users [#3793](https://github.com/sharetribe/sharetribe/pull/3793)\n\n### Changed\n\n- Update to ruby 2.6.2 [#3701](https://github.com/sharetribe/sharetribe/pull/3701)\n- Add more bot rules, disallow login paths [#3715](https://github.com/sharetribe/sharetribe/pull/3715)\n- Update to Rails 5.2.3 [#3722](https://github.com/sharetribe/sharetribe/pull/3722)\n- Prevent lowering minimum transaction size to less than minimum transaction fee with Stripe [#3723](https://github.com/sharetribe/sharetribe/pull/3723)\n- Update to Node.js 10.15 [#3735](https://github.com/sharetribe/sharetribe/pull/3735)\n- Updates to payment preference settings [#3748](https://github.com/sharetribe/sharetribe/pull/3748)\n- Updated copy text from Ban to Disable [#3755](https://github.com/sharetribe/sharetribe/pull/3755)\n- Category translation caching improvements [#3761](https://github.com/sharetribe/sharetribe/pull/3761)\n- Stripe remove the MCC field and hardcode it [#3771](https://github.com/sharetribe/sharetribe/pull/3771)\n- Move \"Phone number\" field down in US Stripe form [#3775](https://github.com/sharetribe/sharetribe/pull/3775)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Fix to the SEO tags without price translation string [#3727](https://github.com/sharetribe/sharetribe/pull/3727)\n- Fix to payment settings causing internal error when PayPal has never been enabled [#3732](https://github.com/sharetribe/sharetribe/pull/3732)\n- Fix to password reset [#3763](https://github.com/sharetribe/sharetribe/pull/3763)\n- Fix to Stripe US account update [#3765](https://github.com/sharetribe/sharetribe/pull/3765)\n- Fix to adding links to footer [#3769](https://github.com/sharetribe/sharetribe/pull/3769)\n- Fix to validation for custom date fields [#3772](https://github.com/sharetribe/sharetribe/pull/3772)\n- Fix to exclude expired listings when filtering for open [#3773](https://github.com/sharetribe/sharetribe/pull/3773)\n- Fix to signup page description tag [#3794](https://github.com/sharetribe/sharetribe/pull/3794)\n\n### Security\n\n\n## [7.6.0] - 2019-04-12\n\n### Added\n\n- Reviews filters in admin panel [#3589](https://github.com/sharetribe/sharetribe/pull/3589)\n- Marketplace logo in all marketplace emails [#3581](https://github.com/sharetribe/sharetribe/pull/3581)\n- New element in the user dropdown menu in the topbar: My listings [#3608](https://github.com/sharetribe/sharetribe/pull/3608)\n- Domain tab in the admin panel [#3614](https://github.com/sharetribe/sharetribe/pull/3614)\n- Social media logins: Google and LinkedIn [#3583](https://github.com/sharetribe/sharetribe/pull/3583)\n- SEO tab in the admin panel and the possibility to customize the metatags for your marketplace main page [#3612](https://github.com/sharetribe/sharetribe/pull/3612)\n- Lithuanian as an unsupported language [#3624](https://github.com/sharetribe/sharetribe/pull/3624)\n- SEO tags working on landing pages as well [#3622](https://github.com/sharetribe/sharetribe/pull/3622)\n- Added the possibility to charge a commission from the buyer [#3490](https://github.com/sharetribe/sharetribe/pull/3490)\n- New templates for the landing page footer [#3645](https://github.com/sharetribe/sharetribe/pull/3645)\n- More SEO options to add custom tags to different marketplace pages [#3647](https://github.com/sharetribe/sharetribe/pull/3647)\n- Ability to have pre-approved listings [#3620](https://github.com/sharetribe/sharetribe/pull/3620)\n- Notifications about listings to approve [#3646](https://github.com/sharetribe/sharetribe/pull/3646)\n- Better logging and error reporting with Stripe [#3676](https://github.com/sharetribe/sharetribe/pull/3676)\n- Listen to account status and missing info from Stripe [#3672](https://github.com/sharetribe/sharetribe/pull/3672)\n- Sending different notifications when a listing is new or edited [#3692](https://github.com/sharetribe/sharetribe/pull/3692)\n\n### Changed\n\n- Link to closed listings redirects to listings table in profile settings [#3607](https://github.com/sharetribe/sharetribe/pull/3607)\n- The way parameters are sent related to creating an connected account with Stripe [#3637](https://github.com/sharetribe/sharetribe/pull/3637)\n- Updated Stripe API keys pattern regex\t[#3660](https://github.com/sharetribe/sharetribe/pull/3660)\n- Updated Facebook login button in accordance to their branding demands [#3696](https://github.com/sharetribe/sharetribe/pull/3696)\n- Updated Facebook API to version 3.2 [#3679](https://github.com/sharetribe/sharetribe/pull/3679)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Fix inefficient queries when admin tries to send emails to all members [#3532](https://github.com/sharetribe/sharetribe/pull/3532)\n- Fixed failed list of listings [#3604](https://github.com/sharetribe/sharetribe/pull/3604)\n- Being able to edit the Stripe connected account name and lastname through the UI [#3653\t](https://github.com/sharetribe/sharetribe/pull/3652)\n- Handle Stripe API keys various lenghts [#3667](https://github.com/sharetribe/sharetribe/pull/3667)\n- Issues with Stripe Payouts [#3668](https://github.com/sharetribe/sharetribe/pull/3668)\n- Update CI to use Ubuntu-based image [#3671](https://github.com/sharetribe/sharetribe/pull/3671)\n\n### Security\n\n- Update passenger gem to latest version [#3609](https://github.com/sharetribe/sharetribe/pull/3609)\n- Update several gems to latest versions [#3675](https://github.com/sharetribe/sharetribe/pull/3675)\n\n## [7.5.0] - 2019-01-30\n\n### Added\n\n- Social media sharing specific image [#3455](https://github.com/sharetribe/sharetribe/pull/3455)\n- Edit reviews feature [#3422](https://github.com/sharetribe/sharetribe/pull/3422)\n- New user segment for sending e-mails to users: \"User who are allowed to post listings\" [#3461](https://github.com/sharetribe/sharetribe/pull/3461)\n- \"Per unit\" default pricing unit [#3462](https://github.com/sharetribe/sharetribe/pull/3462)\n- Japan as supported country for Stripe [#3472](https://github.com/sharetribe/sharetribe/pull/3472)\n- Puerto Rico as supported country for Stripe [#3474](https://github.com/sharetribe/sharetribe/pull/3474)\n- Possibility to hide slogan and description from the cover photo [#3477](https://github.com/sharetribe/sharetribe/pull/3477)\n- Transaction search and filter [#3484](https://github.com/sharetribe/sharetribe/pull/3484) and [#3504](https://github.com/sharetribe/sharetribe/pull/3504)\n- Listing search and filter [#3496](https://github.com/sharetribe/sharetribe/pull/3496)\n- Customizable footer for Pro subscriptions [#3374](https://github.com/sharetribe/sharetribe/pull/3374)\n- New section in admin panel to view and manage invitations [#3505](https://github.com/sharetribe/sharetribe/pull/3505)\n- Add user_id to the listing CSV export [#3511](https://github.com/sharetribe/sharetribe/pull/3511)\n- HSTS support [#3512](https://github.com/sharetribe/sharetribe/pull/3512)\n- Add filters in User search and filters [#3515](https://github.com/sharetribe/sharetribe/pull/3515)\n- Add Conversations search in admin panel [#3521](https://github.com/sharetribe/sharetribe/pull/3521)\n- Admin can act as another user (post listings as, edit profile) [#3525](https://github.com/sharetribe/sharetribe/pull/3525)\n- Admin can resend confirmation email [#3529](https://github.com/sharetribe/sharetribe/pull/3529)\n- Add Review search in admin panel [#3537](https://github.com/sharetribe/sharetribe/pull/3537)\n- Social media sharing specific texts [#3538](https://github.com/sharetribe/sharetribe/pull/3538)\n- Custom link behind marketplace logo [#3564](https://github.com/sharetribe/sharetribe/pull/3564)\n- Ability to edit default top bar menu links [#3565](https://github.com/sharetribe/sharetribe/pull/3565)\n- Admins should be able to see closed listings [#3582](https://github.com/sharetribe/sharetribe/pull/3582)\n- User can browse all their listings in a table [#3584](https://github.com/sharetribe/sharetribe/pull/3584)\n\n\n### Changed\n- Make \"Per unit\" the default pricing unit for product marketplace [#3462](https://github.com/sharetribe/sharetribe/pull/3462)\n- Better messaging for closed marketplaces [#3465](https://github.com/sharetribe/sharetribe/pull/3465)\n- Allow 65 characters in the listing title [#3497](https://github.com/sharetribe/sharetribe/pull/3497)\n- Characters are escaped in URLs [#3546](https://github.com/sharetribe/sharetribe/pull/3546)\n- Updated list of supported and unsupported languages [#3577](https://github.com/sharetribe/sharetribe/pull/3577)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Bug in Hong Kong bank account form [#3456](https://github.com/sharetribe/sharetribe/pull/3456)\n- Bug in transaction agreement text [#3468](https://github.com/sharetribe/sharetribe/pull/3468)\n- Bug in availability per hour manager [#3467](https://github.com/sharetribe/sharetribe/pull/3467)\n- Layout for social media image [#3475](https://github.com/sharetribe/sharetribe/pull/3475)\n- Amazon Web service mail verification [#3471](https://github.com/sharetribe/sharetribe/pull/3471)\n- Number of users when searching in the admin panel [#3483](https://github.com/sharetribe/sharetribe/pull/3483)\n\n### Security\n\n- Fix referrer issue [#3469](https://github.com/sharetribe/sharetribe/pull/3469)\n- Security dependencies update [#3470](https://github.com/sharetribe/sharetribe/pull/3470)\n- Dependency update [#3479](https://github.com/sharetribe/sharetribe/pull/3479)\n\n## [7.4.0] - 2018-10-09\n\n### Added\n\n- View Listings page in the admin panel [#3340](https://github.com/sharetribe/sharetribe/pull/3340)\n- Locations section in the custom landing pages [#3341](https://github.com/sharetribe/sharetribe/pull/3341)\n- Background color and image for any section [#3296](https://github.com/sharetribe/sharetribe/pull/3296)\n- Custom fields for user profiles [#3332](https://github.com/sharetribe/sharetribe/pull/3332)\n- Add a section button for info-2-columns and info-3-columns in the custom landing pages [#3362](https://github.com/sharetribe/sharetribe/pull/3362)\n- File name in the design tab and profile settings to show the stored file [#3364](https://github.com/sharetribe/sharetribe/pull/3364)\n- Allow markdown in user profiles \"About you\" section [#3370](https://github.com/sharetribe/sharetribe/pull/3370)\n- \"Expired\" status in View listings page [#3387](https://github.com/sharetribe/sharetribe/pull/3387)\n- Allow spaces at the end of the e-mails in signup form [#3394](https://github.com/sharetribe/sharetribe/pull/3394)\n- Added Puerto Rico as a Stripe supported country [#3399](https://github.com/sharetribe/sharetribe/pull/3399)\n- Added support for INR with PayPal [#3416](https://github.com/sharetribe/sharetribe/pull/3416)\n- Added support for ARS with PayPal [#3415](https://github.com/sharetribe/sharetribe/pull/3415)\n- Direct link to the admin panel when logging in as admin user[#3414](https://github.com/sharetribe/sharetribe/pull/3414)\n- Added checkmarks to the user fields [#3441](https://github.com/sharetribe/sharetribe/pull/3441)\n- Added the use of session token in Google's autocomplete feature [#3401](https://github.com/sharetribe/sharetribe/pull/3401)\n- Icons to payment provider's page [#3444](https://github.com/sharetribe/sharetribe/pull/3444)\n\n### Changed\n\n- Rename admin panel sections [#3350](https://github.com/sharetribe/sharetribe/pull/3350)\n- Rename save listings button [#3355](https://github.com/sharetribe/sharetribe/pull/3355)\n- Video section variations on the custom landing pages [#3367](https://github.com/sharetribe/sharetribe/pull/3367)\n- Renamed the default category to \"default category\" [#3362](https://github.com/sharetribe/sharetribe/pull/3362)\n- Allow links in the custom user text fields [#3373](https://github.com/sharetribe/sharetribe/pull/3373)\n- Google maps dynamic map for static maps in the listing page [#3382](https://github.com/sharetribe/sharetribe/pull/3382)\n- Change Static map for embedded maps in the listing page [#3395](https://github.com/sharetribe/sharetribe/pull/3395)\n- Update to Circle CI 2.0 [#3360](https://github.com/sharetribe/sharetribe/pull/3360)\n- Profile image is only used once it has been processed [#3427](https://github.com/sharetribe/sharetribe/pull/3427)\n\n### Fixed\n\n- Fix data deletion task to handle missing images [#3349](https://github.com/sharetribe/sharetribe/pull/3349)\n- Requester name in waiting for confirmation messages in the inbox [#3357](https://github.com/sharetribe/sharetribe/pull/3357)\n- Fixed bug in Hungarian Forint minimum transaction size [#3366](https://github.com/sharetribe/sharetribe/pull/3366)\n- Stripe fee information in listing page [#3384](https://github.com/sharetribe/sharetribe/pull/3384)\n- Fixed displaying design page [#3451](https://github.com/sharetribe/sharetribe/pull/3451)\n- Display bug in checkbox user fields [#3385](https://github.com/sharetribe/sharetribe/pull/3385)\n- Fixed a broken link when no date was selected for free \"per day\" and \"per night\" listings [#3410](https://github.com/sharetribe/sharetribe/pull/3410)\n- Allow to leave dropdown option unselected if it is not mandatory [#3446](https://github.com/sharetribe/sharetribe/pull/3446)\n\n## [7.3.1] - 2018-06-07\n\n### Added\n\n- Add soundcloud link support in custom landing page footer [#3300](https://github.com/sharetribe/sharetribe/pull/3300)\n- Add checkbox for consent for receiving emails from admins to signup process [#3318](https://github.com/sharetribe/sharetribe/pull/3318)\n- Add popup notification when giving admin rights to a new user [#3329](https://github.com/sharetribe/sharetribe/pull/3329)\n- Add link to privacy policy in the signup page [#3328](https://github.com/sharetribe/sharetribe/pull/3328)\n- Allow admins to disable end-user Analytics [#3319](https://github.com/sharetribe/sharetribe/pull/3319)\n- Allow links in custom listing text fields [#3297](https://github.com/sharetribe/sharetribe/pull/3297)\n- Add View reviews section in the admin panel [#3267](https://github.com/sharetribe/sharetribe/pull/3267)\n- Add possibility to export transaction as CSV file [#3245](https://github.com/sharetribe/sharetribe/pull/3245)\n\n\n### Changed\n\n- Improve user deletion to clear personal data more thoroughly [#3325](https://github.com/sharetribe/sharetribe/pull/3325)\n- Delete automatically transactions that fail with Stripe [#3326](https://github.com/sharetribe/sharetribe/pull/3326)\n- Prevent an admin from deleting their account if they are the only admin in the marketplace[#3320](https://github.com/sharetribe/sharetribe/pull/3320)\n- Split first name and last name from Stripe account connection form [#3317](https://github.com/sharetribe/sharetribe/pull/3317)\n\n### Removed\n\n- Remove feature flag for export transactions feature [#3288](https://github.com/sharetribe/sharetribe/pull/3288)\n\n### Fixed\n\n- Fix Dockerfile issue where bundler was trying to install binaries in root-owner directory [#3321](https://github.com/sharetribe/sharetribe/pull/3321). Thanks, Nick Meiremans.\n- Fix Stripe payout scheduler [#3309](https://github.com/sharetribe/sharetribe/pull/3309)\n- Fix last 4 digits of SSN passing to Stripe for US bank accounts [#3282](https://github.com/sharetribe/sharetribe/pull/3283)\n\n### Security\n\n- [Critical] Fix several parameter validation bugs that opened the app to SQL injection\n- Update sinatra dependency [#3344](https://github.com/sharetribe/sharetribe/pull/3344)\n- Update multiple dependencies\n- Present form auto-complete for Stripe secret keys [#3338](https://github.com/sharetribe/sharetribe/pull/3338)\n\n## [7.3.0] - 2018-02-23\n\n### Added\n\n- Per hour availability [3166](https://github.com/sharetribe/sharetribe/pull/3166)\n- Support for NZ bank account with Stripe [3165](https://github.com/sharetribe/sharetribe/pull/3165)\n- \"View conversations\" section in admin panel [3173](https://github.com/sharetribe/sharetribe/pull/3173)\n- Account tokens for Stripe bank account connections [3234](https://github.com/sharetribe/sharetribe/pull/3234)\n\n### Changed\n\n- Made user confirmation form more secure [3170](https://github.com/sharetribe/sharetribe/pull/3170)\n\n### Removed\n\n- Confirmation days x after end time of the transaction [3205](https://github.com/sharetribe/sharetribe/pull/3205)\n\n### Fixed\n\n- Improvements to PayPal workflow (IPNs) [3176](https://github.com/sharetribe/sharetribe/pull/3176)\n- Some bugs related to sending emails from admin[#3183](https://github.com/sharetribe/sharetribe/pull/3183)\n\n## [7.2.0] - 2017-11-22\n\n### Added\n\n- Add rack-attack for request throttling [#3078](https://github.com/sharetribe/sharetribe/pull/3078)\n- Stripe integration [#3018](https://github.com/sharetribe/sharetribe/pull/3018)\n- Sending emails from admin to specified subset of users [#3058](https://github.com/sharetribe/sharetribe/pull/3058)\n- Custom Scripts are now also enabled in Custom Landing Page [#3080](https://github.com/sharetribe/sharetribe/pull/3080/files)\n- Allow admins to edit their Custom Outgoing Email and Sender Name [#3106](https://github.com/sharetribe/sharetribe/pull/3106)\n- Allow admins to unban users [3108](https://github.com/sharetribe/sharetribe/pull/3108)\n- Ability to disable Stripe and PayPal [3112](https://github.com/sharetribe/sharetribe/pull/3112)\n- Allow admins to search users by name or email [3113](https://github.com/sharetribe/sharetribe/pull/3113)\n- Add an unsubscribe link to invitation emails [3136](https://github.com/sharetribe/sharetribe/pull/3136)\n- Add more information texts about holding funds with Stripe [3150](https://github.com/sharetribe/sharetribe/pull/3150)\n\n### Changed\n\n- Lowered daily limits for invitations from 50 to 10 [3134](https://github.com/sharetribe/sharetribe/pull/3134)\n- Increased unsubscribe auth token validity from 1 week to 4 weeks [3138](https://github.com/sharetribe/sharetribe/pull/3138)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Fixed correct use of outgoing email address, if configured, when sending manual emails to users [#3058](https://github.com/sharetribe/sharetribe/pull/3058)\n- Fixed sounds of videos in Custom Landing Pages not working [#3101](https://github.com/sharetribe/sharetribe/pull/3101)\n- Fixed listing image reordering when some images were deleted [#3107](https://github.com/sharetribe/sharetribe/pull/3107)\n- Fixed incorrect use of name of receipt email [3127](https://github.com/sharetribe/sharetribe/pull/3127)\n- Fixed many bugs related to Stripe integration\n- Fixed many bugs related to code refactoring\n\n### Security\n\n## [7.1.0] - 2017-09-15\n\n### Added\n\n- Added configuration for trusted proxies [#3040](https://github.com/sharetribe/sharetribe/pull/3040)\n\n### Changed\n\n- Currencies can now be formatted with translations [#3043](https://github.com/sharetribe/sharetribe/pull/3043)\n- Transaction status is now named Completed everywhere instead of Confirmed [#3028](https://github.com/sharetribe/sharetribe/pull/3028)\n- WebTranslateIt API keys were updated [#3029](https://github.com/sharetribe/sharetribe/pull/3029)\n- Force meta tags content to be HTML escaped [#3047](https://github.com/sharetribe/sharetribe/pull/3047)\n- Upgrade to latest ruby 2.3.4 with latest rubygems (2.6.13+) [#3056](https://github.com/sharetribe/sharetribe/pull/3056)\n\n### Deprecated\n\n### Removed\n\n### Fixed\n\n- Fixed image deletion in Android [3023](https://github.com/sharetribe/sharetribe/pull/3023)\n- Fixed changing the names of custom listing field options [3024](https://github.com/sharetribe/sharetribe/pull/3024)\n- Fixed image ordering usability in Android [3034](https://github.com/sharetribe/sharetribe/pull/3034)\n- Fixed not sending automatic emails to expired and deleted marketplaces [3044](https://github.com/sharetribe/sharetribe/pull/3044)\n- Fixed carousel black box rendering issue [3045](https://github.com/sharetribe/sharetribe/pull/3045)\n- Fixed datepicker issue with per night availability [3046](https://github.com/sharetribe/sharetribe/pull/3046)\n- Fixed listing checkbox layout issue on mobile [3048](https://github.com/sharetribe/sharetribe/pull/3048)\n- Fixed admin layout issue in Safari [3066](https://github.com/sharetribe/sharetribe/pull/3066)\n- Fixed error message layout placement when reviewing without grade [3067](https://github.com/sharetribe/sharetribe/pull/3067)\n- Fixed managing availability of rejected booking dates [3068](https://github.com/sharetribe/sharetribe/pull/3068)\n\n### Security\n\n## [7.0.0] - 2017-08-08\n\n### Changed\n\n- Updated Rails to 5.1.1 and Node to 7.8 [#2976](https://github.com/sharetribe/sharetribe/pull/2976)\n\n## [6.4.0] - 2017-06-09\n\n### Added\n\n- New feature: User can reorder listing images [#2970](https://github.com/sharetribe/sharetribe/pull/2970)\n\n### Changed\n\n- Change instructions how to compile assets. This reduces the JavaScript bundle size drastically. [c613cac](https://github.com/sharetribe/sharetribe/commit/c613cac)\n\n### Fixed\n\n- Fixed transaction button styles. Styles were broken in IE Edge. [#2968](https://github.com/sharetribe/sharetribe/pull/2968)\n- Fixed admin UI language change. [#2969](https://github.com/sharetribe/sharetribe/pull/2969)\n- Fix old mobile browser compatibility by removing dependency to Intl api. [#2979](https://github.com/sharetribe/sharetribe/pull/2979)\n\n### Security\n\n- Fixed cross-community security issues [#2978](https://github.com/sharetribe/sharetribe/pull/2978)\n\n## [6.3.0] - 2017-04-24\n\n### Changed\n\n- Migrate from database session store to cookie-based session store [#2935](https://github.com/sharetribe/sharetribe/pull/2935)\n\n### Removed\n\n- Removed default twitter handle [#2906](https://github.com/sharetribe/sharetribe/pull/2906)\n\n### Fixed\n\n- Fix cropped cover photo in big screens [#2895](https://github.com/sharetribe/sharetribe/pull/2895)\n- Add missing padding to homepage search field in mobile view [#2895](https://github.com/sharetribe/sharetribe/pull/2895)\n- Fix unwanted scrolling in listing page by removing comment text area auto focus [#2917](https://github.com/sharetribe/sharetribe/pull/2917)\n- Fix faulty feature flag dependency handling [#2932](https://github.com/sharetribe/sharetribe/pull/2932)\n- Fix map bug where multiple listings close to each other caused the icon cluster to disapper when zoomed closed enough [#2942](https://github.com/sharetribe/sharetribe/pull/2942)\n- Fix issue [#2885](https://github.com/sharetribe/sharetribe/issues/2885): Landing page always shows Sign up button for private marketplace, even if the user is logged in [#2944](https://github.com/sharetribe/sharetribe/pull/2944)\n- Fix issue with fetching correct node.js release signing keys in Dockerfile [#2964](https://github.com/sharetribe/sharetribe/pull/2964)\n\n### Security\n\n- Upgrade Nokogiri and rubyzip gems [#2943](https://github.com/sharetribe/sharetribe/pull/2943)\n\n## [6.2.0] - 2017-03-09\n\n### Added\n\n- Add support for redis as cache store [#2786](https://github.com/sharetribe/sharetribe/pull/2786)\n- Add support for using PayPal in fake mode for development purposes. [Read more](./docs/using-fakepal.md) [#2598](https://github.com/sharetribe/sharetribe/pull/2598)\n- Add support for linking to member invitation page in CLP [#2859](https://github.com/sharetribe/sharetribe/pull/2859)\n- New feature: Hide irrelevant search filters when a category or subcategory is selected [#2882](https://github.com/sharetribe/sharetribe/pull/2882)\n- Landing page Markdown support [#2887](https://github.com/sharetribe/sharetribe/pull/2887)\n- Add instructions how to configure Harmony service [#2892](https://github.com/sharetribe/sharetribe/pull/2892)\n- Add support for display name [#2869](https://github.com/sharetribe/sharetribe/pull/2869)\n- Add support for customizing community description and slogan color [#2898](https://github.com/sharetribe/sharetribe/pull/2898)\n\n### Changed\n\n- Redirect user to the page where user was before login/sign up [#2758](https://github.com/sharetribe/sharetribe/pull/2758)\n- Updated NPM packages [#2762](https://github.com/sharetribe/sharetribe/pull/2762)\n\n### Fixed\n\n- Fixed broken transaction button styles [#2723](https://github.com/sharetribe/sharetribe/pull/2723)\n- Fixed number of issues in the Order Types form [#2858](https://github.com/sharetribe/sharetribe/pull/2858)\n- Fixed an issue which caused sign up to fail partially if the Facebook profile picture upload failed [#2886](https://github.com/sharetribe/sharetribe/pull/2886)\n\n## [6.1.0] - 2016-10-31\n\n### Changed\n\n- Updated Node.js to the latest LTS (long term support) version 6.9 [#2655](https://github.com/sharetribe/sharetribe/pull/2665)\n- Updated NPM packages [#2655](https://github.com/sharetribe/sharetribe/pull/2665)\n- Update `react_on_rails` gem [#2655](https://github.com/sharetribe/sharetribe/pull/2665)\n- Upgrade Facebook SDK from v2.2 to v2.8 [#2666](https://github.com/sharetribe/sharetribe/pull/2666)\n- Instruct crawlers not to follow auth paths, add crawling delay for bots that support the directive [#2693](https://github.com/sharetribe/sharetribe/pull/2693)\n\n### Fixed\n\n- Avoid redirect to correct S3 bucket endpoint when bucket is not in `us-east-1` region [#2605](https://github.com/sharetribe/sharetribe/pull/2605)\n- Added missing database indexes [#2621](https://github.com/sharetribe/sharetribe/pull/2621), [#2634](https://github.com/sharetribe/sharetribe/pull/2634), [#2670](https://github.com/sharetribe/sharetribe/pull/2670)\n- Fix bug: `rake assets:precompile` fails if MySQL is not available. Issue fixed by upgrading `money-rails` gem from 1.3 to 1.4 [#2612](https://github.com/sharetribe/sharetribe/pull/2612) by [@nicolaracco](https://github.com/nicolaracco)\n\n### Security\n\n- Fixed insecure gem urls in Gemfile [#2635](https://github.com/sharetribe/sharetribe/pull/2635)\n\n## [6.0.0] - 2016-09-27\n\n### Removed\n\n- Dropped official support for MySQL server version 5.6. Only MySQL 5.7 is officialy supported. This release contains no other changes.\n\n## [5.12.0] - 2016-09-27\n\n### Added\n\n- Added date picker for \"per night\" listing unit type [#2481](https://github.com/sharetribe/sharetribe/pull/2481)\n- SEO: Added `rel=next` and `rel=prev` links to give a hint to crawlers about the paginated content [#2505](https://github.com/sharetribe/sharetribe/pull/2505)\n- Added _New layout_ admin page where marketplace admins can enable new layout designs for the whole marketplace or just for themselves to try out [#2338](https://github.com/sharetribe/sharetribe/pull/2338) and [#2469](https://github.com/sharetribe/sharetribe/pull/2469)\n- Added functionality to edit Post a new listing button text [#2448](https://github.com/sharetribe/sharetribe/pull/2448)\n- Sitemap [#2492](https://github.com/sharetribe/sharetribe/pull/2492), thanks Dan Moore ([@mooreds](https://github.com/mooreds)) for helping!\n- Mocha test setup for new frontend architecture [#2550](https://github.com/sharetribe/sharetribe/pull/2550)\n\n### Deprecated\n\n- Deprecated use of MySQL server version 5.6.x [2566](https://github.com/sharetribe/sharetribe/pull/2566)\n\n### Removed\n\n- Removed configuration for TravisCI (CircleCI now fully in use) [#2489](https://github.com/sharetribe/sharetribe/pull/2489)\n\n### Changed\n\n- Updated React on Rails to 6.0.5 [#2428](https://github.com/sharetribe/sharetribe/pull/2428) and [#2472](https://github.com/sharetribe/sharetribe/pull/2472)\n- Updated [React Storybook](https://github.com/kadirahq/react-storybook) to version 2.13.0 [#2528](https://github.com/sharetribe/sharetribe/pull/2528)\n- Changed ActiveRecord schema format to :sql [#2531](https://github.com/sharetribe/sharetribe/pull/2531)\n- Upgraded Paperclip and Delayed::Paperclip, dropped deprecated AWS SDK v1 [#2522](https://github.com/sharetribe/sharetribe/pull/2522)\n- Upgraded mysql2 dependency [#2565](https://github.com/sharetribe/sharetribe/pull/2565)\n\n### Fixed\n\n- Correctly add https or http to links generated in `community.rb` [#2459](https://github.com/sharetribe/sharetribe/pull/2459)\n- Transactions in `initiated` state showed wrong total price in the transaction page if the item quantity was more than one [#2452](https://github.com/sharetribe/sharetribe/pull/2452)\n- Fix bug in infinite scroll: The current page was not taken into account [#2532](https://github.com/sharetribe/sharetribe/pull/2532)\n- Fix bug: Testimonial reminders were sent even if user had disabled them [#2557](https://github.com/sharetribe/sharetribe/pull/2557)\n- Fix regression: Add quantity pickers to non-payment transactions [#2568](https://github.com/sharetribe/sharetribe/pull/2568)\n\n## [5.11.0] - 2016-08-24\n\n### Changed\n\n- `RAILS_ENV=production` environment added to the `rake assets:compile` command in README [#2440](https://github.com/sharetribe/sharetribe/pull/2440) by [@pcm211](https://github.com/pcm211)\n\n### Removed\n\n- Remove Braintree support completely [#2424](https://github.com/sharetribe/sharetribe/pull/2424), [#2435](https://github.com/sharetribe/sharetribe/pull/2435)\n\n## [5.10.0] - 2016-08-23\n\n### Removed\n\n- Disable Braintree payments [#2423](https://github.com/sharetribe/sharetribe/pull/2423)\n\n## [5.9.0] - 2016-08-18\n\n### Added\n\n- Add support for using CDN for dynamic assets (uploaded images, custom compiled stylesheets) when S3 is otherwise in use [#2314](https://github.com/sharetribe/sharetribe/pull/2314)\n- Add possibility to choose between light and dark background image filter for hero and info sections in custom landing pages [#2310](https://github.com/sharetribe/sharetribe/pull/2310)\n- Add Pinterest link support in custom landing page footer [#2356](https://github.com/sharetribe/sharetribe/pull/2356)\n\n### Changed\n\n- Remove the need for CSS compilation per marketplace [#2325](https://github.com/sharetribe/sharetribe/pull/2325)\n- Update default colors [#2365](https://github.com/sharetribe/sharetribe/pull/2365)\n\n### Removed\n\n- Removed Checkout Finland payment gateway [#2408](https://github.com/sharetribe/sharetribe/pull/2408) [#2406](https://github.com/sharetribe/sharetribe/pull/2406)\n\n### Fixed\n\n- Security: Rails and gems updated [#2393](https://github.com/sharetribe/sharetribe/pull/2393), [#2318](https://github.com/sharetribe/sharetribe/pull/2318)\n- Fix some asset links not respecting `asset_host` setting on landing pages [#2320](https://github.com/sharetribe/sharetribe/pull/2320)\n\n- Fix JS errors in development by replacing `babel-polyfill` with `es6-shim` [#2087](https://github.com/sharetribe/sharetribe/issues/2087)\n\n## [5.8.0] - 2016-07-15\n\n### Added\n\n- Add whitelabel_branding based on features [#2052](https://github.com/sharetribe/sharetribe/pull/2052)\n- Onboarding topbar and wizard enabled for everyone [#2250](https://github.com/sharetribe/sharetribe/pull/2250)\n- Ability to add Google Maps API key [#2172](https://github.com/sharetribe/sharetribe/pull/2172)\n- Landing page. See the [documentation](https://github.com/sharetribe/sharetribe/blob/v5.8.0/docs/landing-page.md)\n\n### Changed\n\n- Facebook sign up/login uses API version 2.2 instead of 2.0 [#2280](https://github.com/sharetribe/sharetribe/pull/2280)\n- Improved documentation [#2271](https://github.com/sharetribe/sharetribe/pull/2271)\n\n### Fixed\n\n- Fix some React dependency issues caused startup timing/ordering [#2046](https://github.com/sharetribe/sharetribe/pull/2046) and [#2053](https://github.com/sharetribe/sharetribe/pull/2053)\n- Fix issue that caused Google Maps Geocoder to return wrong location if the listing address contained an ampersand (&) [#2075](https://github.com/sharetribe/sharetribe/pull/2075)\n- Fix pluralization error for Turkish (tr-TR) [#2292](https://github.com/sharetribe/sharetribe/pull/2292)\n\n## [5.7.1] - 2016-05-12\n\n### Fixed\n\n- Fix missing map icon [#2032](https://github.com/sharetribe/sharetribe/pull/2032)\n\n### Added\n\n- Add instructions for handling libv8 installation problems [#2023](https://github.com/sharetribe/sharetribe/pull/2023)\n- Add [React Storybook](https://github.com/kadirahq/react-storybook) styleguide for React component development [#2030](https://github.com/sharetribe/sharetribe/pull/2030)\n\n## [5.7.0] - 2016-05-11\n\n### Added\n\n- Add a new job queue (css_compile) for css compilations [#1815](https://github.com/sharetribe/sharetribe/pull/1815)\n- Add a warning message which will be shown 15 minutes before the next scheduled maintenance [#1835](https://github.com/sharetribe/sharetribe/pull/1835)\n- Expose used feature flags to Google Tag Manager [#1856](https://github.com/sharetribe/sharetribe/pull/1856)\n- React on Rails development environment [#1918](https://github.com/sharetribe/sharetribe/pull/1918).\n- Add ability to create a new account with username or email which is already in use in another marketplace [#1753](https://github.com/sharetribe/sharetribe/pull/1753) [#1939](https://github.com/sharetribe/sharetribe/pull/1939)\n- Prevents cookies from leaking to subdomains, fixes [#1992](https://github.com/sharetribe/sharetribe/issues/1192), adds a new configuration key: `cookie_session_key` [#1966](https://github.com/sharetribe/sharetribe/pull/1996)\n\n### Changed\n\n- Marketplace ID is removed from the Admin Settings URL [#1839](https://github.com/sharetribe/sharetribe/pull/1839)\n- The application now depends on React components, which need to be built to run Sharetribe. [Instructions here](./client/README.md). This change is related to React on Rails environment [#1918](https://github.com/sharetribe/sharetribe/pull/1918).\n- Update Ruby to 2.3.1 [#2020](https://github.com/sharetribe/sharetribe/pull/2020)\n\n### Deprecated\n\n- Google Analytics and Kissmetrics tracking snippets are deprecated in favor of Google Tag Manager [#1857](https://github.com/sharetribe/sharetribe/pull/1857)\n\n### Removed\n\n- Delete duplicated memberships from the database [#1838](https://github.com/sharetribe/sharetribe/pull/1838)\n- Remove ability to join other marketplaces with an existing account [#1753](https://github.com/sharetribe/sharetribe/pull/1753) [#1939](https://github.com/sharetribe/sharetribe/pull/1939)\n\n### Fixed\n\n- Errors from Braintree API were ignored [#1832](https://github.com/sharetribe/sharetribe/pull/1832) by [@priviterag](https://github.com/priviterag)\n- Fallback language handling was broken [#1869](https://github.com/sharetribe/sharetribe/pull/1869)\n- Confirmation pending page redirects to homepage if the account is already confirmed [#1976](https://github.com/sharetribe/sharetribe/pull/1976)\n- Fix bug: \"Resend confirmation instructions\" button didn't resend the confirmation email [#1963](https://github.com/sharetribe/sharetribe/pull/1963)\n\n### Security\n\n- Updated Paperclip gem [#1836](https://github.com/sharetribe/sharetribe/pull/1836)\n- Unauthorized users were able to upload new listing images [#1866](https://github.com/sharetribe/sharetribe/pull/1866)\n- Change session expiration time from one year to one month [#1877](https://github.com/sharetribe/sharetribe/pull/1877)\n- Correctly reset old password and salt [#1961](https://github.com/sharetribe/sharetribe/pull/1961)\n\n## [5.6.0] - 2016-03-11\n\n### Added\n\n- Add default queue name to jobs [#1814](https://github.com/sharetribe/sharetribe/pull/1814)\n\n### Changed\n\n- Update Ruby to 2.2.4 [#1774](https://github.com/sharetribe/sharetribe/pull/1774)\n\n### Fixed\n\n- Wrong action was executed when radio buttons were clicked back and forth [#1802](https://github.com/sharetribe/sharetribe/pull/1802)\n\n### Security\n\n- Redirect to HTTPS (if configured) before requesting HTTP basic authentication: [#1793](https://github.com/sharetribe/sharetribe/pull/1793)\n\n## [5.5.0] - 2016-03-02\n\n### Changed\n\n- Migrate legacy passwords to Devise's Bcrypt hashing [#1781](https://github.com/sharetribe/sharetribe/pull/1781)\n- Add listing id to option selections table: [#1761](https://github.com/sharetribe/sharetribe/pull/1761) and [#1762](https://github.com/sharetribe/sharetribe/pull/1762)\n- Support optional site-wide HTTP basic authentication: [#1766](https://github.com/sharetribe/sharetribe/pull/1766)\n\n### Fixed\n\n- Fixed broken FontAwesome asset path [#1756](https://github.com/sharetribe/sharetribe/pull/1756)\n- Listing author wasn't able to give feedback if the transaction starter skipped the feedback [#1767](https://github.com/sharetribe/sharetribe/pull/1767)\n\n### Security\n\n- Update Rails to 4.2.5.2 [#1786](https://github.com/sharetribe/sharetribe/pull/1786)\n\n## [5.4.0] - 2016-02-22\n\n### Changed\n\n- Update Ruby to 2.1.8 [#1750](https://github.com/sharetribe/sharetribe/pull/1750)\n\n### Security\n\n- Update JSON Web Token gem [#1723](https://github.com/sharetribe/sharetribe/pull/1723)\n\n### Fixed\n\n- Configure Delayed Job queue adapter for ActiveJob [#1749](https://github.com/sharetribe/sharetribe/pull/1749)\n\n## [5.3.0] - 2016-02-15\n\n### Changed\n\n- Updated Rails to 4.2.5.1 [#1691](https://github.com/sharetribe/sharetribe/pull/1691)\n\n## [5.2.2] - 2016-02-09\n\n### Added\n\n- Initial support for upcoming new search platform. [#1404](https://github.com/sharetribe/sharetribe/pull/1404)\n\n### Changed\n\n- Save model attributes to cache instead of model instances [#1714](https://github.com/sharetribe/sharetribe/pull/1714)\n\n## [5.2.1] - 2016-02-03\n\n### Changed\n\n- Updated Rails to 4.1.14.1 [#1678](https://github.com/sharetribe/sharetribe/pull/1678)\n- Always log deprecation warnings to stderr [#1693](https://github.com/sharetribe/sharetribe/pull/1693)\n\n### Removed\n\n- Removed environment variable `devise_allow_insecure_token_lookup`. [#1675](https://github.com/sharetribe/sharetribe/pull/1675)\n\n### Fixed\n\n- Fixed Mercury Editor image uploader [#1694](https://github.com/sharetribe/sharetribe/pull/1694)\n\n### Security\n\n- Updated Devise gem to version 3.5 [#1675](https://github.com/sharetribe/sharetribe/pull/1675)\n- Updated Sprockets gem to version 2.12.4 [#1692](https://github.com/sharetribe/sharetribe/pull/1692)\n- Remove HTTP end-point that let unauthorized caller to destroy images uploaded via Mercury Editor [#1695](https://github.com/sharetribe/sharetribe/pull/1695)\n\n## [5.2.0] - 2016-01-29\n\n### Added\n\n- Added `secret_key_base` [#1671](https://github.com/sharetribe/sharetribe/pull/1671)\n- Added pessimistic version number for all the gems in Gemfile. Now we can safely run `bundle update` to update gems with patch level updates. [#1663](https://github.com/sharetribe/sharetribe/pull/1663)\n- Added a new environment variable `delayed_job_max_run_time` which controls the maximum time for a single Delayed Job job. [#1668](https://github.com/sharetribe/sharetribe/pull/1668)\n- Added a new environment variable `devise_allow_insecure_token_lookup` for seamless migration from earlier versions. See [UPGRADE.md](UPGRADE.md) for more information. [#1672](https://github.com/sharetribe/sharetribe/pull/1672)\n\n### Changed\n\n- Upgraded jQuery from 1.8.3 to 1.11.1 [#1667](https://github.com/sharetribe/sharetribe/pull/1667)\n- Updated Devise gem to version 3.1. [#1672](https://github.com/sharetribe/sharetribe/pull/1672)\n\n### Removed\n\n- Gemfile clean up. Removed bunch of unused gems. [#1625](https://github.com/sharetribe/sharetribe/pull/1625)\n- Removed ability to downgrade to Rails 3. [#1669](https://github.com/sharetribe/sharetribe/pull/1669)\n\n### Fixed\n\n- Updating a listing field changes the sorting order [#1673](https://github.com/sharetribe/sharetribe/pull/1673)\n\n### Security\n\n- Updated Gems with known security issues [#1667](https://github.com/sharetribe/sharetribe/pull/1667) [#1676](https://github.com/sharetribe/sharetribe/pull/1676)\n\n## [5.1.0] - 2016-01-21\n\n### Added\n\n- Marketplace admins can select if the custom field creates a search filter on the homepage [#1653](https://github.com/sharetribe/sharetribe/pull/1653)\n- CHANGELOG, UPGRADE and RELEASE files [#1658](https://github.com/sharetribe/sharetribe/pull/1658)\n\n## [5.0.0] - 2015-12-31\n\n### Changed\n\n- Rails upgraded from 3.2 to 4.0\n\n## Older releases\n\nFor older releases, see [RELEASE_NOTES.md](https://github.com/sharetribe/sharetribe/blob/v5.0.0/RELEASE_NOTES.md).\n\n[Unreleased]: https://github.com/sharetribe/sharetribe/compare/v10.1.0...HEAD\n[10.1.0]: https://github.com/sharetribe/sharetribe/compare/v10.0.0...v10.1.0\n[10.0.0]: https://github.com/sharetribe/sharetribe/compare/v9.1.0...v10.0.0\n[9.1.0]: https://github.com/sharetribe/sharetribe/compare/v9.0.0...v9.1.0\n[9.0.0]: https://github.com/sharetribe/sharetribe/compare/v8.1.0...v9.0.0\n[8.1.0]: https://github.com/sharetribe/sharetribe/compare/v8.0.0...v8.1.0\n[8.0.0]: https://github.com/sharetribe/sharetribe/compare/v7.6.0...v8.0.0\n[7.6.0]: https://github.com/sharetribe/sharetribe/compare/v7.5.0...v7.6.0\n[7.5.0]: https://github.com/sharetribe/sharetribe/compare/v7.4.0...v7.5.0\n[7.4.0]: https://github.com/sharetribe/sharetribe/compare/v7.3.1...v7.4.0\n[7.3.1]: https://github.com/sharetribe/sharetribe/compare/v7.3.0...v7.3.1\n[7.3.0]: https://github.com/sharetribe/sharetribe/compare/v7.2.0...v7.3.0\n[7.2.0]: https://github.com/sharetribe/sharetribe/compare/v7.1.0...v7.2.0\n[7.1.0]: https://github.com/sharetribe/sharetribe/compare/v7.0.0...v7.1.0\n[7.0.0]: https://github.com/sharetribe/sharetribe/compare/v6.4.0...v7.1.0\n[6.4.0]: https://github.com/sharetribe/sharetribe/compare/v6.3.0...v6.4.0\n[6.3.0]: https://github.com/sharetribe/sharetribe/compare/v6.2.0...v6.3.0\n[6.2.0]: https://github.com/sharetribe/sharetribe/compare/v6.1.0...v6.2.0\n[6.1.0]: https://github.com/sharetribe/sharetribe/compare/v6.0.0...v6.1.0\n[6.0.0]: https://github.com/sharetribe/sharetribe/compare/v5.12.0...v6.0.0\n[5.12.0]: https://github.com/sharetribe/sharetribe/compare/v5.11.0...v5.12.0\n[5.11.0]: https://github.com/sharetribe/sharetribe/compare/v5.10.0...v5.11.0\n[5.10.0]: https://github.com/sharetribe/sharetribe/compare/v5.9.0...v5.10.0\n[5.9.0]: https://github.com/sharetribe/sharetribe/compare/v5.8.0...v5.9.0\n[5.8.0]: https://github.com/sharetribe/sharetribe/compare/v5.7.1...v5.8.0\n[5.7.1]: https://github.com/sharetribe/sharetribe/compare/v5.7.0...v5.7.1\n[5.7.0]: https://github.com/sharetribe/sharetribe/compare/v5.6.0...v5.7.0\n[5.6.0]: https://github.com/sharetribe/sharetribe/compare/v5.5.0...v5.6.0\n[5.5.0]: https://github.com/sharetribe/sharetribe/compare/v5.4.0...v5.5.0\n[5.4.0]: https://github.com/sharetribe/sharetribe/compare/v5.3.0...v5.4.0\n[5.3.0]: https://github.com/sharetribe/sharetribe/compare/v5.2.2...v5.3.0\n[5.2.2]: https://github.com/sharetribe/sharetribe/compare/v5.2.1...v5.2.2\n[5.2.1]: https://github.com/sharetribe/sharetribe/compare/v5.2.0...v5.2.1\n[5.2.0]: https://github.com/sharetribe/sharetribe/compare/v5.1.0...v5.2.0\n[5.1.0]: https://github.com/sharetribe/sharetribe/compare/v5.0.0...v5.1.0\n[5.0.0]: https://github.com/sharetribe/sharetribe/compare/v4.6.0...v5.0.0\n", "class AmazonBouncesController < ApplicationController\n  skip_before_action :verify_authenticity_token, :only => :notification\n  skip_before_action :fetch_community\n  skip_before_action :perform_redirect\n\n  before_action :check_sns_token\n\n  def notification\n    amz_message_type = request.headers['x-amz-sns-message-type']\n\n    if amz_message_type.to_s.downcase == 'subscriptionconfirmation'\n      if send_subscription_confirmation request.raw_post\n        head :ok and return\n      else\n        head :bad_request and return\n      end\n    end\n\n    if amz_message_type.to_s.downcase == 'notification'\n      msg = JSON.parse(request.raw_post)\n      # Sometimes amazon sends notifications more wrapped than other times\n      msg = JSON.load(msg['Message']) unless msg['Message'].nil?\n      type = msg['notificationType']\n\n      if type == 'Bounce'\n        handle_bounces(msg)\n      elsif type == 'Complaint'\n        handle_complaints(msg)\n      else\n        logger.warn \"\\nUnrecognized message from Amazon SNS notification center:\"\n        logger.warn msg.to_s\n      end\n    end\n    head :ok\n  end\n\n  private\n\n  def send_subscription_confirmation(request_body)\n    json = JSON.parse(request_body)\n    subscribe_url = URI.parse(json['SubscribeURL'])\n    if ['http', 'https'].include?(subscribe_url.scheme)\n      subscribe_url.open\n    end\n  rescue URI::InvalidURIError => e\n    logger.info \"SES send_subscription_confirmation: URI::InvalidURIError: #{e.message}\"\n    return\n  rescue StandardError => e\n    logger.info \"SES send_subscription_confirmation: #{e.message}\"\n    return\n  end\n\n  def handle_bounces(msg)\n    bounce = msg['bounce']\n    bounce_recipients = bounce['bouncedRecipients']\n    bounce_recipients.each do |recipient|\n      Email.unsubscribe_email_from_community_updates(recipient['emailAddress'])\n    end\n  end\n\n\n  def handle_complaints(msg)\n    complaint = msg['complaint']\n    complaint_recipients = complaint['complainedRecipients']\n    complaint_recipients.each do |recipient|\n      Email.unsubscribe_email_from_community_updates(recipient['emailAddress'])\n    end\n    unless complaint['complaintFeedbackType'].nil?\n      logger.info \"\\nComplaint with feedback from Amazon SNS notification center:\"\n      logger.info msg.to_s\n    end\n  end\n\n  def check_sns_token\n    if APP_CONFIG.sns_notification_token.nil? || APP_CONFIG.sns_notification_token != params['sns_notification_token']\n      return head :ok\n    end\n  end\n\nend\n", "require 'spec_helper'\nrequire 'tempfile'\n\ndescribe \"Amazon Bounces\", type: :request do\n\n  before(:each) do\n    @community = FactoryGirl.create(:community, :domain => \"market.custom.org\")\n  end\n\n  describe \"subscription confirmations\" do\n    context \"sns_notification_token is unset\" do\n      before(:all) do\n        @sns_notification_token = APP_CONFIG.sns_notification_token\n        APP_CONFIG.sns_notification_token = nil\n      end\n\n      after(:all) do\n        APP_CONFIG.sns_notification_token = @sns_notification_token\n      end\n\n      it 'does not open subscription notification url' do\n        incoming_data = JSON.parse('{\n            \"SubscribeURL\":\"https://subscribe.example.com/confirm\"\n          }')\n\n        stub_request(:get, \"https://subscribe.example.com/confirm\").to_return(status: 200, body: \"\", headers: {})\n\n        post \"https://market.custom.org/bounces?sns_notification_token=#{APP_CONFIG.sns_notification_token}\", params: incoming_data.to_json.to_s, headers: { 'x-amz-sns-message-type' => 'subscriptionconfirmation'}\n\n        expect(response.status).to eq(200)\n\n        assert_not_requested :get, \"https://subscribe.example.com/confirm\"\n      end\n    end\n\n    context \"sns_notification_token is set\" do\n      it 'opens valid subscription notification url' do\n        incoming_data = JSON.parse('{\n            \"SubscribeURL\":\"https://subscribe.example.com/confirm\"\n          }')\n\n        stub_request(:get, \"https://subscribe.example.com/confirm\").to_return(status: 200, body: \"\", headers: {})\n\n        post \"https://market.custom.org/bounces?sns_notification_token=#{APP_CONFIG.sns_notification_token}\", params: incoming_data.to_json.to_s, headers: { 'x-amz-sns-message-type' => 'subscriptionconfirmation'}\n        expect(response.status).to eq(200)\n        assert_requested :get, \"https://subscribe.example.com/confirm\"\n      end\n\n      it 'does not open non-http schemes' do\n        incoming_data = JSON.parse('{\n            \"SubscribeURL\":\"file://foo\"\n          }')\n\n        post \"https://market.custom.org/bounces?sns_notification_token=#{APP_CONFIG.sns_notification_token}\", params: incoming_data.to_json.to_s, headers: { 'x-amz-sns-message-type' => 'subscriptionconfirmation'}\n        expect(response.status).to eq(400)\n      end\n\n      context \"code_execution\" do\n        before(:all) do\n          @tmp_file = Tempfile.new(\"ses_test\")\n        end\n\n        after(:all) do\n          @tmp_file.close!\n        end\n\n        it 'does not allow code execution' do\n          incoming_data = JSON.parse(\"{\n              \\\"SubscribeURL\\\":\\\"| echo foo >  #{@tmp_file.path}\\\"\n            }\")\n\n          post \"https://market.custom.org/bounces?sns_notification_token=#{APP_CONFIG.sns_notification_token}\", params: incoming_data.to_json.to_s, headers: { 'x-amz-sns-message-type' => 'subscriptionconfirmation'}\n          expect(response.status).to eq(400)\n          # Need to allow some time for the execution to happen, it seems\n          sleep 2\n          expect(@tmp_file.size()).to eq(0)\n        end\n      end\n    end\n  end\n\n  describe \"test notifications\" do\n    it \"when notificationType is bounce\" do\n      # Prepare\n      @person = FactoryGirl.create(:person, id: \"123abc\", min_days_between_community_updates: 4)\n      @person.emails = [\n        FactoryGirl.create(:email, :address => \"one@examplecompany.co\", :send_notifications => true),\n      ]\n\n      incoming_data = JSON.parse('{\n        \"notificationType\":\"Bounce\",\n        \"bounce\":{\n           \"bounceType\":\"Permanent\",\n           \"bounceSubType\": \"General\",\n           \"bouncedRecipients\":[\n              {\n                 \"emailAddress\":\"one@examplecompany.co\"\n              }\n           ],\n           \"timestamp\":\"2012-05-25T14:59:38.237-07:00\",\n           \"feedbackId\":\"00000137860315fd-869464a4-8680-4114-98d3-716fe35851f9-000000\"\n        },\n        \"mail\":{\n           \"timestamp\":\"2012-05-25T14:59:38.237-07:00\",\n           \"messageId\":\"00000137860315fd-34208509-5b74-41f3-95c5-22c1edc3c924-000000\",\n           \"source\":\"email_1337983178237@amazon.com\",\n           \"destination\":[\n              \"recipient1@example.com\",\n              \"recipient2@example.com\",\n              \"recipient3@example.com\",\n              \"recipient4@example.com\"\n           ]\n        }\n      }')\n\n      expect(@person.min_days_between_community_updates).to be_equal 4\n      post \"https://market.custom.org/bounces?sns_notification_token=#{APP_CONFIG.sns_notification_token}\", params: incoming_data.to_json.to_s, headers: { 'x-amz-sns-message-type' => 'notification'}\n      expect(Person.find_by_id(@person.id).min_days_between_community_updates).to be_equal 100000\n    end\n\n    it \"when notificationType is Complaint\" do\n      # Prepare\n      @person = FactoryGirl.create(:person, id: \"123abc\", min_days_between_community_updates: 4)\n      @person.emails = [\n        FactoryGirl.create(:email, :address => \"one@examplecompany.co\", :send_notifications => true),\n      ]\n\n      incoming_data = JSON.parse('{\n        \"notificationType\":\"Complaint\",\n        \"complaint\":{\n           \"userAgent\":\"Comcast Feedback Loop (V0.01)\",\n           \"complainedRecipients\":[\n              {\n                 \"emailAddress\":\"one@examplecompany.co\"\n              }\n           ],\n           \"complaintFeedbackType\":\"abuse\",\n           \"arrivalDate\":\"2009-12-03T04:24:21.000-05:00\",\n           \"timestamp\":\"2012-05-25T14:59:38.623-07:00\",\n           \"feedbackId\":\"000001378603177f-18c07c78-fa81-4a58-9dd1-fedc3cb8f49a-000000\"\n        },\n        \"mail\":{\n           \"timestamp\":\"2012-05-25T14:59:38.623-07:00\",\n           \"messageId\":\"000001378603177f-7a5433e7-8edb-42ae-af10-f0181f34d6ee-000000\",\n           \"source\":\"email_1337983178623@amazon.com\",\n           \"destination\":[\n              \"recipient1@example.com\",\n              \"recipient2@example.com\",\n              \"recipient3@example.com\",\n              \"recipient4@example.com\"\n           ]\n        }\n      }')\n\n      expect(@person.min_days_between_community_updates).to be_equal 4\n      post \"https://market.custom.org/bounces?sns_notification_token=#{APP_CONFIG.sns_notification_token}\", params: incoming_data.to_json.to_s, headers: { 'x-amz-sns-message-type' => 'notification'}\n      expect(Person.find_by_id(@person.id).min_days_between_community_updates).to be_equal 100000\n    end\n\n  end\nend\n"], "filenames": ["CHANGELOG.md", "app/controllers/amazon_bounces_controller.rb", "spec/requests/amazon_bounces_spec.rb"], "buggy_code_start_loc": [21, 12, 1], "buggy_code_end_loc": [21, 66, 11], "fixing_code_start_loc": [22, 12, 2], "fixing_code_end_loc": [26, 76, 82], "type": "CWE-78", "message": "Sharetribe Go is a source available marketplace software. In affected versions operating system command injection is possible on installations of Sharetribe Go, that do not have a secret AWS Simple Notification Service (SNS) notification token configured via the `sns_notification_token` configuration parameter. This configuration parameter is unset by default. The vulnerability has been patched in version 10.2.1. Users who are unable to upgrade should set the`sns_notification_token` configuration parameter to a secret value.", "other": {"cve": {"id": "CVE-2021-41280", "sourceIdentifier": "security-advisories@github.com", "published": "2021-11-19T20:15:18.573", "lastModified": "2021-11-24T14:40:26.470", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "Sharetribe Go is a source available marketplace software. In affected versions operating system command injection is possible on installations of Sharetribe Go, that do not have a secret AWS Simple Notification Service (SNS) notification token configured via the `sns_notification_token` configuration parameter. This configuration parameter is unset by default. The vulnerability has been patched in version 10.2.1. Users who are unable to upgrade should set the`sns_notification_token` configuration parameter to a secret value."}, {"lang": "es", "value": "Sharetribe Go es un software de mercado disponible de origen. En las versiones afectadas, una inyecci\u00f3n de comandos en el sistema operativo es posible en instalaciones de Sharetribe Go que no presentan un token de notificaci\u00f3n secreto de AWS Simple Notification Service (SNS) configurado por medio del par\u00e1metro de configuraci\u00f3n \"sns_notification_token\". Este par\u00e1metro de configuraci\u00f3n no est\u00e1 configurado por defecto. La vulnerabilidad ha sido parcheada en la versi\u00f3n 10.2.1. Los usuarios que no puedan actualizarse deber\u00e1n establecer el par\u00e1metro de configuraci\u00f3n \"sns_notification_token\" con un valor secreto"}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-78"}]}, {"source": "security-advisories@github.com", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-78"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:sharetribe:sharetribe:*:*:*:*:*:*:*:*", "versionEndExcluding": "10.2.1", "matchCriteriaId": "99FC90A2-EB27-4ADF-BFD8-F9FCFA6E4269"}]}]}], "references": [{"url": "https://github.com/sharetribe/sharetribe/commit/5b844f8108c5458d89f0d7ba974f42d7917b5f80", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/sharetribe/sharetribe/releases/tag/v10.2.1", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}, {"url": "https://github.com/sharetribe/sharetribe/security/advisories/GHSA-hjjc-p9hr-424c", "source": "security-advisories@github.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/sharetribe/sharetribe/commit/5b844f8108c5458d89f0d7ba974f42d7917b5f80"}}