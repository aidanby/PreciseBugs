{"buggy_code": ["<?php\n\n//Burden, Copyright Josh Fradley (http://github.com/joshf/Burden)\n\nif (!file_exists(\"config.php\")) {\n    die(\"Error: Config file not found! Please reinstall Burden.\");\n}\n\nrequire_once(\"config.php\");\n\nsession_start();\n\n//Connect to database\n@$con = mysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\nif (!$con) {\n    die(\"Error: Could not connect to database (\" . mysql_error() . \"). Check your database settings are correct.\");\n}\n\nmysql_select_db(DB_NAME, $con);\n    \n//If cookie is set, skip login\nif (isset($_COOKIE[\"burden_user_rememberme\"])) {\n    $id = $_COOKIE[\"burden_user_rememberme\"];\n    $getid = mysql_query(\"SELECT `id` FROM `Users` WHERE `id` = \\\"$id\\\"\");\n    if (mysql_num_rows($getid) == 0) {\n        header(\"Location: logout.php\");\n        exit;\n    }\n    $userinforesult = mysql_fetch_assoc($getid); \n    $_SESSION[\"burden_user\"] = $userinforesult[\"id\"];\n}\n\nif (isset($_POST[\"password\"]) && isset($_POST[\"username\"])) {\n    $username = mysql_real_escape_string($_POST[\"username\"]);\n    $password = $_POST[\"password\"];\n    $userinfo = mysql_query(\"SELECT `id`, `user`, `password`, `salt` FROM `Users` WHERE `user` = \\\"$username\\\"\");\n    $userinforesult = mysql_fetch_assoc($userinfo);\n    if (mysql_num_rows($userinfo) == 0) {\n        header(\"Location: login.php?user_doesnt_exist=true\");\n        exit;\n    }\n    $salt = $userinforesult[\"salt\"];\n    $hashedpassword = hash(\"sha256\", $salt . hash(\"sha256\", $password));\n    if ($hashedpassword == $userinforesult[\"password\"]) {\n        $_SESSION[\"burden_user\"] = $userinforesult[\"id\"];\n        if (isset($_POST[\"rememberme\"])) {\n            setcookie(\"burden_user_rememberme\", $userinforesult[\"id\"], time()+1209600);\n        }\n    } else {\n        header(\"Location: login.php?login_error=true\");\n        exit;\n    }\n}\n\nif (!isset($_SESSION[\"burden_user\"])) {\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>Burden &middot; Login</title>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<meta name=\"robots\" content=\"noindex, nofollow\">\n<link href=\"resources/bootstrap/css/bootstrap.min.css\" type=\"text/css\" rel=\"stylesheet\">\n<link href=\"resources/bootstrap/css/bootstrap-responsive.min.css\" type=\"text/css\" rel=\"stylesheet\">\n<style type=\"text/css\">\nbody {\n    padding-top: 60px;\n    background-color: #f5f5f5;\n}\n.form-signin {\n    max-width: 300px;\n    padding: 19px 29px 29px;\n    margin: 0 auto 20px;\n    background-color: #fff;\n    border: 1px solid #e5e5e5;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n    border-radius: 5px;\n    -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);\n    -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);\n    box-shadow: 0 1px 2px rgba(0,0,0,.05);\n}\n.form-signin .form-signin-heading, .form-signin .checkbox {\n    margin-bottom: 10px;\n}\n.form-signin input[type=\"text\"], .form-signin input[type=\"password\"] {\n    font-size: 16px;\n    height: auto;\n    margin-bottom: 5px;\n    padding: 7px 9px;\n}\n</style>\n<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->\n<!--[if lt IE 9]>\n<script src=\"http://html5shim.googlecode.com/svn/trunk/html5.js\"></script>\n<![endif]-->\n</head>\n<body>\n<!-- Content start -->\n<div class=\"container\">\n<form class=\"form-signin\" method=\"post\">\n<fieldset>\n<h2 class=\"form-signin-heading text-center\">Burden</h2>\n<?php \nif (isset($_GET[\"login_error\"])) {\n    echo \"<div class=\\\"alert alert-error\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\">&times;</button>Incorrect username or password.</div>\";\n} elseif (isset($_GET[\"user_doesnt_exist\"])) {\n    echo \"<div class=\\\"alert alert-error\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\">&times;</button>User does not exist.</div>\";\n} elseif (isset($_GET[\"logged_out\"])) {\n    echo \"<div class=\\\"alert alert-success\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\">&times;</button>Successfully logged out.</div>\";\n}\n?>\n<div class=\"control-group\">\n<label class=\"control-label\" for=\"username\">Username</label>\n<div class=\"controls\">\n<input type=\"text\" id=\"username\" name=\"username\" class=\"input-block-level\" placeholder=\"Username...\">\n</div>\n</div>\n<div class=\"control-group\">\n<label class=\"control-label\" for=\"password\">Password</label>\n<div class=\"controls\">\n<input type=\"password\" id=\"password\" name=\"password\" class=\"input-block-level\" placeholder=\"Password...\">\n</div>\n</div>\n<div class=\"control-group\">\n<div class=\"controls\">\n<label class=\"checkbox\">\n<input type=\"checkbox\" id=\"rememberme\" name=\"rememberme\"> Remember Me\n</label>\n</div>\n</div>\n<button type=\"submit\" class=\"btn pull-right\">Login</button>\n</fieldset>\n</form>\n</div>\n<!-- Content end -->\n<!-- Javascript start -->\n<script src=\"resources/jquery.min.js\"></script>\n<script src=\"resources/bootstrap/js/bootstrap.min.js\"></script>\n<script type=\"text/javascript\">\n$(document).ready(function() {\n    $(\"#username\").focus();\n});\n</script>\n<!-- Javascript end -->\n</body>\n</html>\n<?php\n} else {\n    header(\"Location: index.php\");\n    exit;\n}\n?>", "<?php\n\n//Burden, Copyright Josh Fradley (http://github.com/joshf/Burden)\n\nif (!file_exists(\"config.php\")) {\n    die(\"Error: Config file not found! Please reinstall Burden.\");\n}\n\nrequire_once(\"config.php\");\n\nsession_start();\n\nsession_unset(\"burden_user\");\n\nif (isset($_COOKIE[\"burden_user_rememberme\"])) {\n\tsetcookie(\"burden_user_rememberme\", \"\", time()-86400);\n}\n\nheader(\"Location: login.php?logged_out=true\");\n\nexit;\n\n?>"], "fixing_code": ["<?php\n\n//Burden, Copyright Josh Fradley (http://github.com/joshf/Burden)\n\nif (!file_exists(\"config.php\")) {\n    die(\"Error: Config file not found! Please reinstall Burden.\");\n}\n\nrequire_once(\"config.php\");\n\nsession_start();\n\n//Connect to database\n@$con = mysql_connect(DB_HOST, DB_USER, DB_PASSWORD);\nif (!$con) {\n    die(\"Error: Could not connect to database (\" . mysql_error() . \"). Check your database settings are correct.\");\n}\n\nmysql_select_db(DB_NAME, $con);\n\nif (isset($_POST[\"password\"]) && isset($_POST[\"username\"])) {\n    $username = mysql_real_escape_string($_POST[\"username\"]);\n    $password = $_POST[\"password\"];\n    $userinfo = mysql_query(\"SELECT `id`, `user`, `password`, `salt` FROM `Users` WHERE `user` = \\\"$username\\\"\");\n    $userinforesult = mysql_fetch_assoc($userinfo);\n    if (mysql_num_rows($userinfo) == 0) {\n        header(\"Location: login.php?user_doesnt_exist=true\");\n        exit;\n    }\n    $salt = $userinforesult[\"salt\"];\n    $hashedpassword = hash(\"sha256\", $salt . hash(\"sha256\", $password));\n    if ($hashedpassword == $userinforesult[\"password\"]) {\n        $_SESSION[\"burden_user\"] = $userinforesult[\"id\"];\n        if (isset($_POST[\"rememberme\"])) {\n            setcookie(\"burden_user_rememberme\", $userinforesult[\"id\"], time()+1209600);\n        }\n    } else {\n        header(\"Location: login.php?login_error=true\");\n        exit;\n    }\n}\n\nif (!isset($_SESSION[\"burden_user\"])) {\n?>\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\">\n<title>Burden &middot; Login</title>\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<meta name=\"robots\" content=\"noindex, nofollow\">\n<link href=\"resources/bootstrap/css/bootstrap.min.css\" type=\"text/css\" rel=\"stylesheet\">\n<link href=\"resources/bootstrap/css/bootstrap-responsive.min.css\" type=\"text/css\" rel=\"stylesheet\">\n<style type=\"text/css\">\nbody {\n    padding-top: 60px;\n    background-color: #f5f5f5;\n}\n.form-signin {\n    max-width: 300px;\n    padding: 19px 29px 29px;\n    margin: 0 auto 20px;\n    background-color: #fff;\n    border: 1px solid #e5e5e5;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n    border-radius: 5px;\n    -webkit-box-shadow: 0 1px 2px rgba(0,0,0,.05);\n    -moz-box-shadow: 0 1px 2px rgba(0,0,0,.05);\n    box-shadow: 0 1px 2px rgba(0,0,0,.05);\n}\n.form-signin .form-signin-heading, .form-signin .checkbox {\n    margin-bottom: 10px;\n}\n.form-signin input[type=\"text\"], .form-signin input[type=\"password\"] {\n    font-size: 16px;\n    height: auto;\n    margin-bottom: 5px;\n    padding: 7px 9px;\n}\n</style>\n<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->\n<!--[if lt IE 9]>\n<script src=\"http://html5shim.googlecode.com/svn/trunk/html5.js\"></script>\n<![endif]-->\n</head>\n<body>\n<!-- Content start -->\n<div class=\"container\">\n<form class=\"form-signin\" method=\"post\">\n<fieldset>\n<h2 class=\"form-signin-heading text-center\">Burden</h2>\n<?php \nif (isset($_GET[\"login_error\"])) {\n    echo \"<div class=\\\"alert alert-error\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\">&times;</button>Incorrect username or password.</div>\";\n} elseif (isset($_GET[\"user_doesnt_exist\"])) {\n    echo \"<div class=\\\"alert alert-error\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\">&times;</button>User does not exist.</div>\";\n} elseif (isset($_GET[\"logged_out\"])) {\n    echo \"<div class=\\\"alert alert-success\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"alert\\\">&times;</button>Successfully logged out.</div>\";\n}\n?>\n<div class=\"control-group\">\n<label class=\"control-label\" for=\"username\">Username</label>\n<div class=\"controls\">\n<input type=\"text\" id=\"username\" name=\"username\" class=\"input-block-level\" placeholder=\"Username...\">\n</div>\n</div>\n<div class=\"control-group\">\n<label class=\"control-label\" for=\"password\">Password</label>\n<div class=\"controls\">\n<input type=\"password\" id=\"password\" name=\"password\" class=\"input-block-level\" placeholder=\"Password...\">\n</div>\n</div>\n<button type=\"submit\" class=\"btn pull-right\">Login</button>\n</fieldset>\n</form>\n</div>\n<!-- Content end -->\n<!-- Javascript start -->\n<script src=\"resources/jquery.min.js\"></script>\n<script src=\"resources/bootstrap/js/bootstrap.min.js\"></script>\n<script type=\"text/javascript\">\n$(document).ready(function() {\n    $(\"#username\").focus();\n});\n</script>\n<!-- Javascript end -->\n</body>\n</html>\n<?php\n} else {\n    header(\"Location: index.php\");\n    exit;\n}\n?>", "<?php\n\n//Burden, Copyright Josh Fradley (http://github.com/joshf/Burden)\n\nif (!file_exists(\"config.php\")) {\n    die(\"Error: Config file not found! Please reinstall Burden.\");\n}\n\nrequire_once(\"config.php\");\n\nsession_start();\n\nsession_unset(\"burden_user\");\n\nheader(\"Location: login.php?logged_out=true\");\n\nexit;\n\n?>"], "filenames": ["login.php", "logout.php"], "buggy_code_start_loc": [20, 15], "buggy_code_end_loc": [133, 19], "fixing_code_start_loc": [19, 14], "fixing_code_end_loc": [113, 14], "type": "CWE-287", "message": "The \"remember me\" functionality in login.php in Burden before 1.8.1 allows remote attackers to bypass authentication and gain privileges by setting the burden_user_rememberme cookie to 1.", "other": {"cve": {"id": "CVE-2013-7137", "sourceIdentifier": "cve@mitre.org", "published": "2014-01-26T01:55:09.767", "lastModified": "2022-04-06T18:32:12.223", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "The \"remember me\" functionality in login.php in Burden before 1.8.1 allows remote attackers to bypass authentication and gain privileges by setting the burden_user_rememberme cookie to 1."}, {"lang": "es", "value": "La funcionalidad \"remember me\" en login.php de Burden anteriores a 1.8.1 permite a atacantes remotos sortear la autenticaci\u00f3n y obtener privilegios poniendo a 1 la cookie burden_user_rememberme."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.8, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 3.9, "impactScore": 5.9}], "cvssMetricV2": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:P/A:P", "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "PARTIAL", "availabilityImpact": "PARTIAL", "baseScore": 7.5}, "baseSeverity": "HIGH", "exploitabilityScore": 10.0, "impactScore": 6.4, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "nvd@nist.gov", "type": "Primary", "description": [{"lang": "en", "value": "CWE-287"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:burden_project:burden:*:*:*:*:*:*:*:*", "versionEndExcluding": "1.8.1", "matchCriteriaId": "BADA81DE-B047-4DC6-B292-0C01A07B811E"}]}]}], "references": [{"url": "http://www.exploit-db.com/exploits/30916", "source": "cve@mitre.org", "tags": ["Exploit", "Third Party Advisory", "VDB Entry"]}, {"url": "https://github.com/joshf/Burden/commit/edaa1bb8f73d6f3c8b2e78b67f1b40e02fccd0c1", "source": "cve@mitre.org", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/joshf/Burden/issues/2", "source": "cve@mitre.org", "tags": ["Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://github.com/joshf/Burden/releases/tag/1.8.1", "source": "cve@mitre.org", "tags": ["Release Notes", "Third Party Advisory"]}]}, "github_commit_url": "https://github.com/joshf/Burden/commit/edaa1bb8f73d6f3c8b2e78b67f1b40e02fccd0c1"}}