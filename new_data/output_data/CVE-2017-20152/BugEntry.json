{"buggy_code": ["<?php\n\nrequire_once __DIR__ . '/protected/config/config.php';\n\n$types = array(\n    'png'  => 'image/png',\n    'jpeg' => 'image/jpeg',\n    'gif'  => 'image/gif',\n    'webm' => 'video/webm',\n);\n\n$index = ! (isset($_GET['type']) && isset($_GET['file']));\n\nif ($index) {\n    include_once __DIR__ . '/protected/templates/index.phtml';\n    die();\n}\n\n$type = $_GET['type'];\n$file = $_GET['file'];\n\n$filelocation = __DIR__ . \"/images/$type/$file.$type\";\n\nif ( ! file_exists($filelocation)) {\n    header('HTTP/1.0 404 Not Found');\n    include_once __DIR__ . '/protected/templates/error.phtml';\n    die();\n}\n\n$filesize = filesize($filelocation);\n\nif (RAW_IMAGE && strpos($_SERVER['HTTP_USER_AGENT'], 'Twitterbot') === false) {\n    $filecontents = fopen($filelocation, 'rb');\n\n    header('Content-type: ' . $types[$type]);\n    header('Content-length: ' . $filesize);\n\n    fpassthru($filecontents);\n    exit;\n} else {\n    $time = microtime();\n    $time = explode(' ', $time);\n    $time = $time[1] + $time[0];\n    $start = $time;\n\n    require_once __DIR__ . '/protected/templates/viewer.phtml';\n}\n"], "fixing_code": ["<?php\n\nrequire_once __DIR__ . '/protected/config/config.php';\n\n$types = array(\n    'png'  => 'image/png',\n    'jpeg' => 'image/jpeg',\n    'gif'  => 'image/gif',\n    'webm' => 'video/webm',\n);\n\n$index = ! (isset($_GET['type']) && isset($_GET['file']));\n\nif ($index) {\n    include_once __DIR__ . '/protected/templates/index.phtml';\n    die();\n}\n\n$type = $_GET['type'];\n$file = $_GET['file'];\n\n$filelocation = __DIR__ . \"/images/$type/$file.$type\";\n\nif ( ! file_exists(realpath($filelocation)) || ! array_key_exists($type, $types) ) {\n    header('HTTP/1.0 404 Not Found');\n    include_once __DIR__ . '/protected/templates/error.phtml';\n    die();\n}\n\n$filesize = filesize($filelocation);\n\nif (RAW_IMAGE && strpos($_SERVER['HTTP_USER_AGENT'], 'Twitterbot') === false) {\n    $filecontents = fopen($filelocation, 'rb');\n\n    header('Content-type: ' . $types[$type]);\n    header('Content-length: ' . $filesize);\n\n    fpassthru($filecontents);\n    exit;\n} else {\n    $time = microtime();\n    $time = explode(' ', $time);\n    $time = $time[1] + $time[0];\n    $start = $time;\n\n    require_once __DIR__ . '/protected/templates/viewer.phtml';\n}\n"], "filenames": ["public/viewer.php"], "buggy_code_start_loc": [24], "buggy_code_end_loc": [25], "fixing_code_start_loc": [24], "fixing_code_end_loc": [25], "type": "CWE-22", "message": "A vulnerability, which was classified as problematic, was found in aerouk imageserve. Affected is an unknown function of the file public/viewer.php of the component File Handler. The manipulation of the argument filelocation leads to path traversal. It is possible to launch the attack remotely. The exploit has been disclosed to the public and may be used. The name of the patch is bd23c784f0e5cb12f66d15c100248449f87d72e2. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-217056.", "other": {"cve": {"id": "CVE-2017-20152", "sourceIdentifier": "cna@vuldb.com", "published": "2022-12-30T12:15:08.817", "lastModified": "2023-01-09T17:48:12.673", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "A vulnerability, which was classified as problematic, was found in aerouk imageserve. Affected is an unknown function of the file public/viewer.php of the component File Handler. The manipulation of the argument filelocation leads to path traversal. It is possible to launch the attack remotely. The exploit has been disclosed to the public and may be used. The name of the patch is bd23c784f0e5cb12f66d15c100248449f87d72e2. It is recommended to apply a patch to fix this issue. The identifier of this vulnerability is VDB-217056."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 7.5, "baseSeverity": "HIGH"}, "exploitabilityScore": 3.9, "impactScore": 3.6}], "cvssMetricV30": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N", "attackVector": "NETWORK", "attackComplexity": "HIGH", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 3.1, "baseSeverity": "LOW"}, "exploitabilityScore": 1.6, "impactScore": 1.4}], "cvssMetricV2": [{"source": "cna@vuldb.com", "type": "Secondary", "cvssData": {"version": "2.0", "vectorString": "AV:N/AC:H/Au:S/C:P/I:N/A:N", "accessVector": "NETWORK", "accessComplexity": "HIGH", "authentication": "SINGLE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE", "baseScore": 2.1}, "baseSeverity": "LOW", "exploitabilityScore": 3.9, "impactScore": 2.9, "acInsufInfo": false, "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}]}, "weaknesses": [{"source": "cna@vuldb.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-22"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:imageserve_project:imageserve:-:*:*:*:*:*:*:*", "matchCriteriaId": "1C2BF72E-B12A-413A-A94F-82A928BF1DF2"}]}]}], "references": [{"url": "https://github.com/aerouk/imageserve/commit/bd23c784f0e5cb12f66d15c100248449f87d72e2", "source": "cna@vuldb.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/aerouk/imageserve/pull/27", "source": "cna@vuldb.com", "tags": ["Exploit", "Issue Tracking", "Patch", "Third Party Advisory"]}, {"url": "https://vuldb.com/?ctiid.217056", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}, {"url": "https://vuldb.com/?id.217056", "source": "cna@vuldb.com", "tags": ["Third Party Advisory"]}]}, "github_commit_url": "https://github.com/aerouk/imageserve/commit/bd23c784f0e5cb12f66d15c100248449f87d72e2"}}