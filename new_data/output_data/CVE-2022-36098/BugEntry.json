{"buggy_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.4\" reference=\"XWiki.Mentions.MentionsMacro\" locale=\"\">\n  <web>XWiki.Mentions</web>\n  <name>MentionsMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Mentions.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>MentionsMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>\n</content>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>c01bb948-92a0-403d-bcbc-3bb6997529e8</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require.config({\n  paths: {\n    'xwiki-suggestUsers': $jsontool.serialize($xwiki.getSkinFile('uicomponents/suggest/suggestUsersAndGroups.js', true))\n  }\n});\nrequire(['deferred!ckeditor', 'xwiki-suggestUsers', 'jquery', 'xwiki-meta'], function (ckeditorPromise, suggestUsers, $, xm) {\n  \n  /**\n   * Get the current wiki scope for displaying global, local or global and local users\n   */\n  const userScope = \"$!services.wiki.user.userScope\";\n  \n  // see https://stackoverflow.com/a/6248722/657524\n  function random6chars() {\n    // I generate the UID from two parts here \n    // to ensure the random number provide enough bits.\n    var firstPart = (Math.random() * 46656) | 0;\n    var secondPart = (Math.random() * 46656) | 0;\n    firstPart = (\"000\" + firstPart.toString(36)).slice(-3);\n    secondPart = (\"000\" + secondPart.toString(36)).slice(-3);\n    return firstPart + secondPart;\n  }\n  \n  /**\n   * Compute a new unique anchor for the given reference.\n   * The unique anchor is based on the mentionned user id, concatenaed with a random string of 6 alphanumeric\n   * characters.\n   * The chances of collision are quite low, about 46k mentions for a given mentioned user on a given page (assuming\n   * that no mentions are ever deleted).\n   */\n  const getAnchor = function (reference) {\n    const refId = reference.replace(/[.:]/g, '-');\n    const randomId = random6chars();\n    return refId + '-' + randomId;\n  };\n\n  const search = function (text, callback) {\n    const params = {\n      'input': text,\n      'limit': 6,\n    };\n    $.when(suggestUsers.loadUsers(userScope, params)).then(function (user) {\n      const cct = user.map(function (x) {\n        // insert an id because that's required by the mentions plugins.\n        x.id = x.value;\n        // Make sure to display the icon avatar or the image one.\n        if (x.icon.cssClass) {\n          x.imgClass = \"hidden\";\n          x.cssClass = x.icon.cssClass;\n        } else {\n          x.imgUrl = x.icon.url;\n          x.cssClass = \"hidden\";\n          x.imgClass = \"\";\n        }\n        x.iconHtml\n        return x;\n      });\n      callback(cct);\n    })\n  }\n\n  ckeditorPromise.done(function (ckeditor) {\n    function confMentions(name) {\n      return {\n        feed: function (opts, callback) {\n          search(opts.query, callback);\n        },\n        marker: '@',\n        minChars: 0,\n        itemsLimit: 6,\n        itemTemplate: '&lt;li data-id=\"{id}\" class=\"ckeditor-autocomplete-item\"&gt;'+\n              '&lt;div&gt;'+\n                '&lt;span class=\"ckeditor-autocomplete-item-icon-wrapper\"&gt;'+\n                  '&lt;span class=\"{cssClass}\"&gt;&lt;/span&gt;'+\n                  '&lt;img src=\"{imgUrl}\" class=\"{imgClass}\"/&gt;'+\n                '&lt;/span&gt;'+\n                '&lt;span class=\"ckeditor-autocomplete-item-label\"&gt;{label}&lt;/span&gt;'+\n              '&lt;/div&gt;'+\n            '&lt;/li&gt;',\n        outputTemplate: function (param) {\n          var editor = ckeditor.instances[name];\n          editor.once('afterInsertHtml', function () {\n            editor.execCommand('xwiki-macro-insert', {\n              name: 'mention',\n              inline: 'enforce',\n              parameters: {\n                reference: param.id,\n                style: 'FULL_NAME',\n                anchor: getAnchor(param.id)\n              }\n            });\n          });\n          // the outputTemplate insert nothing but wait for the afterInsertHtml event to be triggered\n          // at this point the xwiki-macro-insert deals with the macro insertion in the rich editor.\n          return '';\n        }\n      };\n    }\n\n    function updateConf(config, name) {\n      const newConf = config || {};\n      newConf.mentions = newConf.mentions || [];\n      newConf.mentions.push(confMentions(name));\n      return newConf;\n    }\n\n    var oldReplace = ckeditor.replace;\n    ckeditor.replace = function (element, config) {\n      return oldReplace.call(this, element, updateConf(config, element.id));\n    };\n\n    var oldInline = ckeditor.inline;\n    ckeditor.inline = function (element, config) {\n      return oldInline.call(this, element, updateConf(config, element.id));\n    };\n  });\n});</code>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>always</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>2e1aa3cf-0475-4362-bad1-0b608bcef372</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>forbid</cache>\n    </property>\n    <property>\n      <code>.xwiki-mention {\n  background-color: $services.mentions.mentionsColor;\n  border-radius: 8px;\n  padding: 2px 5px 2px 5px;\n}\n\n.xwiki-mention.user.self {\n  background-color: $services.mentions.selfMentionsColor;\n}\n\n.xwiki-mention.removed {\n  text-decoration: line-through;\n}\n\nblockquote.mention-quote {\n  font-size: inherit;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>always</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>fe15c3f8-7eff-4a61-a60f-bf2df5e08f24</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>12</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>13</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>11</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategory>\n        <disabled>0</disabled>\n        <name>defaultCategory</name>\n        <number>4</number>\n        <prettyName>Default category</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultCategory>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{velocity}}\n#set ($reference = $wikimacro.parameters.reference)\n#set ($style = $wikimacro.parameters.style)\n#set ($type = \"$!wikimacro.parameters.type\")\n#set ($content = $services.mentions.format($reference.reference, $style, $type))\n#set ($anchor = $wikimacro.parameters.anchor)\n#set ($isCurrentUser = $xcontext.userReference == $reference.reference &amp;&amp; ($type == '' || $type  == 'user'))\n#set ($cssClasses = ['xwiki-mention', 'user'])\n#if ($isCurrentUser)\n  #set ($discard = $cssClasses.add('self'))\n#end\n#set ($link = $xwiki.getURL($reference.reference, 'view'))\n{{html}}\n&lt;a id=\"$anchor\" class=\"$stringtool.join($cssClasses, ' ')\" data-reference=\"$services.model.serialize($reference.reference, 'default')\" href=\"$link\"&gt;$content&lt;/a&gt;\n{{/html}}\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategory>Notifications</defaultCategory>\n    </property>\n    <property>\n      <description>Inserts a user mention.</description>\n    </property>\n    <property>\n      <id>mention</id>\n    </property>\n    <property>\n      <name>User Mention</name>\n    </property>\n    <property>\n      <supportsInlineMode>1</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>b1028021-73f8-4f8b-b481-bf9c2f83b4c7</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>The mentioned user or group reference.</description>\n    </property>\n    <property>\n      <mandatory>1</mandatory>\n    </property>\n    <property>\n      <name>reference</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>80090526-6a61-4284-90d5-bda83f37472d</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>FULL_NAME</defaultValue>\n    </property>\n    <property>\n      <description>The display style of the mention (this is only supported for user mentions).</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>style</name>\n    </property>\n    <property>\n      <type>org.xwiki.mentions.DisplayStyle</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>2</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>72ef13d4-6a59-4981-b125-0e38ba9e8728</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>Anchor name to be used to link to the mention. This should be preferably unique.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>anchor</name>\n    </property>\n    <property>\n      <type>java.lang.String</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>3</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>4c992749-364c-49d6-9d8f-2e4a3734c720</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>The type of mentioned actor.</description>\n    </property>\n    <property>\n      <mandatory/>\n    </property>\n    <property>\n      <name>type</name>\n    </property>\n    <property>\n      <type>java.lang.String</type>\n    </property>\n  </object>\n</xwikidoc>\n"], "fixing_code": ["<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n\n<!--\n * See the NOTICE file distributed with this work for additional\n * information regarding copyright ownership.\n *\n * This is free software; you can redistribute it and/or modify it\n * under the terms of the GNU Lesser General Public License as\n * published by the Free Software Foundation; either version 2.1 of\n * the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public\n * License along with this software; if not, write to the Free\n * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n-->\n\n<xwikidoc version=\"1.4\" reference=\"XWiki.Mentions.MentionsMacro\" locale=\"\">\n  <web>XWiki.Mentions</web>\n  <name>MentionsMacro</name>\n  <language/>\n  <defaultLanguage/>\n  <translation>0</translation>\n  <creator>xwiki:XWiki.Admin</creator>\n  <parent>XWiki.Mentions.WebHome</parent>\n  <author>xwiki:XWiki.Admin</author>\n  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>\n  <version>1.1</version>\n  <title>MentionsMacro</title>\n  <comment/>\n  <minorEdit>false</minorEdit>\n  <syntaxId>xwiki/2.1</syntaxId>\n  <hidden>true</hidden>\n  <content>\n</content>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>0</number>\n    <className>XWiki.JavaScriptExtension</className>\n    <guid>c01bb948-92a0-403d-bcbc-3bb6997529e8</guid>\n    <class>\n      <name>XWiki.JavaScriptExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>long</cache>\n    </property>\n    <property>\n      <code>require.config({\n  paths: {\n    'xwiki-suggestUsers': $jsontool.serialize($xwiki.getSkinFile('uicomponents/suggest/suggestUsersAndGroups.js', true))\n  }\n});\nrequire(['deferred!ckeditor', 'xwiki-suggestUsers', 'jquery', 'xwiki-meta'], function (ckeditorPromise, suggestUsers, $, xm) {\n  \n  /**\n   * Get the current wiki scope for displaying global, local or global and local users\n   */\n  const userScope = \"$!services.wiki.user.userScope\";\n  \n  // see https://stackoverflow.com/a/6248722/657524\n  function random6chars() {\n    // I generate the UID from two parts here \n    // to ensure the random number provide enough bits.\n    var firstPart = (Math.random() * 46656) | 0;\n    var secondPart = (Math.random() * 46656) | 0;\n    firstPart = (\"000\" + firstPart.toString(36)).slice(-3);\n    secondPart = (\"000\" + secondPart.toString(36)).slice(-3);\n    return firstPart + secondPart;\n  }\n  \n  /**\n   * Compute a new unique anchor for the given reference.\n   * The unique anchor is based on the mentionned user id, concatenaed with a random string of 6 alphanumeric\n   * characters.\n   * The chances of collision are quite low, about 46k mentions for a given mentioned user on a given page (assuming\n   * that no mentions are ever deleted).\n   */\n  const getAnchor = function (reference) {\n    const refId = reference.replace(/[.:]/g, '-');\n    const randomId = random6chars();\n    return refId + '-' + randomId;\n  };\n\n  const search = function (text, callback) {\n    const params = {\n      'input': text,\n      'limit': 6,\n    };\n    $.when(suggestUsers.loadUsers(userScope, params)).then(function (user) {\n      const cct = user.map(function (x) {\n        // insert an id because that's required by the mentions plugins.\n        x.id = x.value;\n        // Make sure to display the icon avatar or the image one.\n        if (x.icon.cssClass) {\n          x.imgClass = \"hidden\";\n          x.cssClass = x.icon.cssClass;\n        } else {\n          x.imgUrl = x.icon.url;\n          x.cssClass = \"hidden\";\n          x.imgClass = \"\";\n        }\n        x.iconHtml\n        return x;\n      });\n      callback(cct);\n    })\n  }\n\n  ckeditorPromise.done(function (ckeditor) {\n    function confMentions(name) {\n      return {\n        feed: function (opts, callback) {\n          search(opts.query, callback);\n        },\n        marker: '@',\n        minChars: 0,\n        itemsLimit: 6,\n        itemTemplate: '&lt;li data-id=\"{id}\" class=\"ckeditor-autocomplete-item\"&gt;'+\n              '&lt;div&gt;'+\n                '&lt;span class=\"ckeditor-autocomplete-item-icon-wrapper\"&gt;'+\n                  '&lt;span class=\"{cssClass}\"&gt;&lt;/span&gt;'+\n                  '&lt;img src=\"{imgUrl}\" class=\"{imgClass}\"/&gt;'+\n                '&lt;/span&gt;'+\n                '&lt;span class=\"ckeditor-autocomplete-item-label\"&gt;{label}&lt;/span&gt;'+\n              '&lt;/div&gt;'+\n            '&lt;/li&gt;',\n        outputTemplate: function (param) {\n          var editor = ckeditor.instances[name];\n          editor.once('afterInsertHtml', function () {\n            editor.execCommand('xwiki-macro-insert', {\n              name: 'mention',\n              inline: 'enforce',\n              parameters: {\n                reference: param.id,\n                style: 'FULL_NAME',\n                anchor: getAnchor(param.id)\n              }\n            });\n          });\n          // the outputTemplate insert nothing but wait for the afterInsertHtml event to be triggered\n          // at this point the xwiki-macro-insert deals with the macro insertion in the rich editor.\n          return '';\n        }\n      };\n    }\n\n    function updateConf(config, name) {\n      const newConf = config || {};\n      newConf.mentions = newConf.mentions || [];\n      newConf.mentions.push(confMentions(name));\n      return newConf;\n    }\n\n    var oldReplace = ckeditor.replace;\n    ckeditor.replace = function (element, config) {\n      return oldReplace.call(this, element, updateConf(config, element.id));\n    };\n\n    var oldInline = ckeditor.inline;\n    ckeditor.inline = function (element, config) {\n      return oldInline.call(this, element, updateConf(config, element.id));\n    };\n  });\n});</code>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>always</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>0</number>\n    <className>XWiki.StyleSheetExtension</className>\n    <guid>2e1aa3cf-0475-4362-bad1-0b608bcef372</guid>\n    <class>\n      <name>XWiki.StyleSheetExtension</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <cache>\n        <cache>0</cache>\n        <defaultValue>long</defaultValue>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>cache</name>\n        <number>5</number>\n        <prettyName>Caching policy</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>long|short|default|forbid</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </cache>\n      <code>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>code</name>\n        <number>2</number>\n        <prettyName>Code</prettyName>\n        <rows>20</rows>\n        <size>50</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>6</number>\n        <prettyName>Content Type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>CSS|LESS</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <parse>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>parse</name>\n        <number>4</number>\n        <prettyName>Parse content</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </parse>\n      <use>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>use</name>\n        <number>3</number>\n        <prettyName>Use this extension</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator> </separator>\n        <separators>|, </separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>currentPage|onDemand|always</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </use>\n    </class>\n    <property>\n      <cache>forbid</cache>\n    </property>\n    <property>\n      <code>.xwiki-mention {\n  background-color: $services.mentions.mentionsColor;\n  border-radius: 8px;\n  padding: 2px 5px 2px 5px;\n}\n\n.xwiki-mention.user.self {\n  background-color: $services.mentions.selfMentionsColor;\n}\n\n.xwiki-mention.removed {\n  text-decoration: line-through;\n}\n\nblockquote.mention-quote {\n  font-size: inherit;\n}</code>\n    </property>\n    <property>\n      <contentType>CSS</contentType>\n    </property>\n    <property>\n      <name/>\n    </property>\n    <property>\n      <parse>1</parse>\n    </property>\n    <property>\n      <use>always</use>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroClass</className>\n    <guid>fe15c3f8-7eff-4a61-a60f-bf2df5e08f24</guid>\n    <class>\n      <name>XWiki.WikiMacroClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <async_cached>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_cached</name>\n        <number>13</number>\n        <prettyName>Cached</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_cached>\n      <async_context>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>1</multiSelect>\n        <name>async_context</name>\n        <number>14</number>\n        <prettyName>Context elements</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>, </separator>\n        <separators>|, </separators>\n        <size>5</size>\n        <unmodifiable>0</unmodifiable>\n        <values>action=Action|doc.reference=Document|icon.theme=Icon theme|locale=Language|rendering.defaultsyntax=Default syntax|rendering.restricted=Restricted|rendering.targetsyntax=Target syntax|request.base=Request base URL|request.parameters=Request parameters|request.url=Request URL|request.wiki=Request wiki|user=User|wiki=Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </async_context>\n      <async_enabled>\n        <defaultValue>0</defaultValue>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType/>\n        <name>async_enabled</name>\n        <number>12</number>\n        <prettyName>Asynchronous rendering</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </async_enabled>\n      <code>\n        <disabled>0</disabled>\n        <editor>Text</editor>\n        <name>code</name>\n        <number>10</number>\n        <prettyName>Macro code</prettyName>\n        <rows>20</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </code>\n      <contentDescription>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>contentDescription</name>\n        <number>9</number>\n        <prettyName>Content description (Not applicable for \"No content\" type)</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </contentDescription>\n      <contentJavaType>\n        <cache>0</cache>\n        <defaultValue>Unknown</defaultValue>\n        <disabled>0</disabled>\n        <displayType>input</displayType>\n        <freeText>allowed</freeText>\n        <largeStorage>1</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentJavaType</name>\n        <number>8</number>\n        <picker>1</picker>\n        <prettyName>Macro content type</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Unknown|Wiki</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentJavaType>\n      <contentType>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>contentType</name>\n        <number>7</number>\n        <prettyName>Macro content availability</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Optional|Mandatory|No content</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </contentType>\n      <defaultCategory>\n        <disabled>0</disabled>\n        <name>defaultCategory</name>\n        <number>4</number>\n        <prettyName>Default category</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultCategory>\n      <description>\n        <contenttype>PureText</contenttype>\n        <disabled>0</disabled>\n        <editor>PureText</editor>\n        <name>description</name>\n        <number>3</number>\n        <prettyName>Macro description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <id>\n        <disabled>0</disabled>\n        <name>id</name>\n        <number>1</number>\n        <prettyName>Macro id</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </id>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>2</number>\n        <prettyName>Macro name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <priority>\n        <disabled>0</disabled>\n        <name>priority</name>\n        <number>11</number>\n        <numberType>integer</numberType>\n        <prettyName>Priority</prettyName>\n        <size>10</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.NumberClass</classType>\n      </priority>\n      <supportsInlineMode>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>supportsInlineMode</name>\n        <number>5</number>\n        <prettyName>Supports inline mode</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </supportsInlineMode>\n      <visibility>\n        <cache>0</cache>\n        <disabled>0</disabled>\n        <displayType>select</displayType>\n        <freeText>forbidden</freeText>\n        <largeStorage>0</largeStorage>\n        <multiSelect>0</multiSelect>\n        <name>visibility</name>\n        <number>6</number>\n        <prettyName>Macro visibility</prettyName>\n        <relationalStorage>0</relationalStorage>\n        <separator>|</separator>\n        <separators>|</separators>\n        <size>1</size>\n        <unmodifiable>0</unmodifiable>\n        <values>Current User|Current Wiki|Global</values>\n        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>\n      </visibility>\n    </class>\n    <property>\n      <async_cached>0</async_cached>\n    </property>\n    <property>\n      <async_context/>\n    </property>\n    <property>\n      <async_enabled>0</async_enabled>\n    </property>\n    <property>\n      <code>{{velocity}}\n#set ($reference = $wikimacro.parameters.reference)\n#set ($style = $wikimacro.parameters.style)\n#set ($type = \"$!wikimacro.parameters.type\")\n#set ($content = $services.mentions.format($reference.reference, $style, $type))\n#set ($anchor = $wikimacro.parameters.anchor)\n#set ($isCurrentUser = $xcontext.userReference == $reference.reference &amp;&amp; ($type == '' || $type  == 'user'))\n#set ($cssClasses = ['xwiki-mention', 'user'])\n#if ($isCurrentUser)\n  #set ($discard = $cssClasses.add('self'))\n#end\n#set ($link = $xwiki.getURL($reference.reference, 'view'))\n{{html}}\n&lt;a id=\"$escapetool.xml($anchor)\" class=\"$stringtool.join($cssClasses, ' ')\" data-reference=\"$escapetool.xml($services.model.serialize($reference.reference, 'default'))\" href=\"$escapetool.xml($link)\"&gt;\n  $escapetool.xml($content)\n&lt;/a&gt;\n{{/html}}\n{{/velocity}}</code>\n    </property>\n    <property>\n      <contentDescription/>\n    </property>\n    <property>\n      <contentJavaType/>\n    </property>\n    <property>\n      <contentType>No content</contentType>\n    </property>\n    <property>\n      <defaultCategory>Notifications</defaultCategory>\n    </property>\n    <property>\n      <description>Inserts a user mention.</description>\n    </property>\n    <property>\n      <id>mention</id>\n    </property>\n    <property>\n      <name>User Mention</name>\n    </property>\n    <property>\n      <priority/>\n    </property>\n    <property>\n      <supportsInlineMode>1</supportsInlineMode>\n    </property>\n    <property>\n      <visibility>Current Wiki</visibility>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>0</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>b1028021-73f8-4f8b-b481-bf9c2f83b4c7</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>The mentioned user or group reference.</description>\n    </property>\n    <property>\n      <mandatory>1</mandatory>\n    </property>\n    <property>\n      <name>reference</name>\n    </property>\n    <property>\n      <type>org.xwiki.user.UserReference</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>1</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>80090526-6a61-4284-90d5-bda83f37472d</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue>FULL_NAME</defaultValue>\n    </property>\n    <property>\n      <description>The display style of the mention (this is only supported for user mentions).</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>style</name>\n    </property>\n    <property>\n      <type>org.xwiki.mentions.DisplayStyle</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>2</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>72ef13d4-6a59-4981-b125-0e38ba9e8728</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>Anchor name to be used to link to the mention. This should be preferably unique.</description>\n    </property>\n    <property>\n      <mandatory>0</mandatory>\n    </property>\n    <property>\n      <name>anchor</name>\n    </property>\n    <property>\n      <type>java.lang.String</type>\n    </property>\n  </object>\n  <object>\n    <name>XWiki.Mentions.MentionsMacro</name>\n    <number>3</number>\n    <className>XWiki.WikiMacroParameterClass</className>\n    <guid>4c992749-364c-49d6-9d8f-2e4a3734c720</guid>\n    <class>\n      <name>XWiki.WikiMacroParameterClass</name>\n      <customClass/>\n      <customMapping/>\n      <defaultViewSheet/>\n      <defaultEditSheet/>\n      <defaultWeb/>\n      <nameField/>\n      <validationScript/>\n      <defaultValue>\n        <disabled>0</disabled>\n        <name>defaultValue</name>\n        <number>4</number>\n        <prettyName>Parameter default value</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </defaultValue>\n      <description>\n        <disabled>0</disabled>\n        <name>description</name>\n        <number>2</number>\n        <prettyName>Parameter description</prettyName>\n        <rows>5</rows>\n        <size>40</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>\n      </description>\n      <mandatory>\n        <disabled>0</disabled>\n        <displayFormType>select</displayFormType>\n        <displayType>yesno</displayType>\n        <name>mandatory</name>\n        <number>3</number>\n        <prettyName>Parameter mandatory</prettyName>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n      </mandatory>\n      <name>\n        <disabled>0</disabled>\n        <name>name</name>\n        <number>1</number>\n        <prettyName>Parameter name</prettyName>\n        <size>30</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </name>\n      <type>\n        <disabled>0</disabled>\n        <name>type</name>\n        <number>5</number>\n        <prettyName>Parameter type</prettyName>\n        <size>60</size>\n        <unmodifiable>0</unmodifiable>\n        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>\n      </type>\n    </class>\n    <property>\n      <defaultValue/>\n    </property>\n    <property>\n      <description>The type of mentioned actor.</description>\n    </property>\n    <property>\n      <mandatory/>\n    </property>\n    <property>\n      <name>type</name>\n    </property>\n    <property>\n      <type>java.lang.String</type>\n    </property>\n  </object>\n</xwikidoc>\n"], "filenames": ["xwiki-platform-core/xwiki-platform-mentions/xwiki-platform-mentions-ui/src/main/resources/XWiki/Mentions/MentionsMacro.xml"], "buggy_code_start_loc": [412], "buggy_code_end_loc": [621], "fixing_code_start_loc": [412], "fixing_code_end_loc": [637], "type": "CWE-79", "message": "XWiki Platform Mentions UI is a user interface for mentioning users in wiki content for XWiki Platform, a generic wiki platform. Starting in version 12.5-rc-1 and prior to versions 13.10.6 and 14.4, it's possible to store Javascript or groovy scripts in a mention, macro anchor, or reference field. The stored code is executed by anyone visiting the page with the mention. This issue has been patched on XWiki 14.4 and 13.10.6. As a workaround, one may update `XWiki.Mentions.MentionsMacro` and edit the `Macro code` field of the `XWiki.WikiMacroClass` XObject.", "other": {"cve": {"id": "CVE-2022-36098", "sourceIdentifier": "security-advisories@github.com", "published": "2022-09-08T21:15:08.097", "lastModified": "2022-09-13T19:37:36.540", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Platform Mentions UI is a user interface for mentioning users in wiki content for XWiki Platform, a generic wiki platform. Starting in version 12.5-rc-1 and prior to versions 13.10.6 and 14.4, it's possible to store Javascript or groovy scripts in a mention, macro anchor, or reference field. The stored code is executed by anyone visiting the page with the mention. This issue has been patched on XWiki 14.4 and 13.10.6. As a workaround, one may update `XWiki.Mentions.MentionsMacro` and edit the `Macro code` field of the `XWiki.WikiMacroClass` XObject."}, {"lang": "es", "value": "XWiki Platform Mentions UI es una Interfaz de Usuario para mencionar usuarios en contenido wiki para XWiki Platform, una plataforma wiki gen\u00e9rica.&#xa0;A partir de la versi\u00f3n 12.5-rc-1 y anteriores a 13.10.6 y 14.4, es posible almacenar Javascript o scripts maravillosos en un campo de menci\u00f3n, ancla de macro o referencia.&#xa0;El c\u00f3digo almacenado es ejecutado por cualquiera que visite la p\u00e1gina con la menci\u00f3n.&#xa0;Este problema ha sido parcheado en XWiki versiones 14.4 y 13.10.6.&#xa0;Como mitigaci\u00f3n, puede actualizarse \"XWiki.Mentions.MentionsMacro\" y editar el campo \"Macro code\" del XObject \"XWiki.WikiMacroClass\""}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.0, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.3, "impactScore": 6.0}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "LOW", "baseScore": 8.9, "baseSeverity": "HIGH"}, "exploitabilityScore": 2.3, "impactScore": 6.0}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "12.5", "versionEndExcluding": "13.10.6", "matchCriteriaId": "ED6936AF-2696-4165-B7AD-54CF65C6A904"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "14.0", "versionEndExcluding": "14.4", "matchCriteriaId": "78E9227E-5BAE-44FD-B327-13434E0AF974"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/4032dc896857597efd169966dc9e2752a9fdd459#diff-4fe22885f772e47d3561a05348f73921669ec12d4413b220383b73c7ae484bc4R608-R610", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/commit/4f290d87a8355e967378a1ed6aee23a06ba162eb", "source": "security-advisories@github.com", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-c5v8-2q4r-5w9v", "source": "security-advisories@github.com", "tags": ["Exploit", "Patch", "Third Party Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-19752", "source": "security-advisories@github.com", "tags": ["Exploit", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/4032dc896857597efd169966dc9e2752a9fdd459#diff-4fe22885f772e47d3561a05348f73921669ec12d4413b220383b73c7ae484bc4R608-R610"}}