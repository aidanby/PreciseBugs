{"buggy_code": ["## ---------------------------------------------------------------------------\n## See the NOTICE file distributed with this work for additional\n## information regarding copyright ownership.\n##\n## This is free software; you can redistribute it and/or modify it\n## under the terms of the GNU Lesser General Public License as\n## published by the Free Software Foundation; either version 2.1 of\n## the License, or (at your option) any later version.\n##\n## This software is distributed in the hope that it will be useful,\n## but WITHOUT ANY WARRANTY; without even the implied warranty of\n## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n## Lesser General Public License for more details.\n##\n## You should have received a copy of the GNU Lesser General Public\n## License along with this software; if not, write to the Free\n## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n## 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n## ---------------------------------------------------------------------------\n### Buttons displayed in the preview interface: cancel, back to edit, save and continue, save and view.\n###\n#if(\"$!showactions\" != '0')\n  $xwiki.jsfx.use('js/xwiki/actionbuttons/actionButtons.js', true)\n  $xwiki.ssfx.use('js/xwiki/actionbuttons/actionButtons.css', true)\n  ## In case of conflict issue we want to display the diff properly\n  #set ($discard = $xwiki.ssfx.use('uicomponents/viewers/diff.css', true))\n  #set ($discard = $xwiki.jsfx.use('uicomponents/viewers/diff.js'))\n  #set($backToEditAction = \"$!{request.xeditaction}\")\n  #if($backToEditAction == '')\n    #set($backToEditAction = 'edit')\n  #end\n  #set($keyboardShortcutsEnabled = true)\n  #set($editorUrl = \"$!request.xcontinue\")\n  #if($editorUrl == '')\n    #set($editorUrl = \"$!request.getHeader('Referer')\")\n    #if($editorUrl == '')\n      #if($doc.content.indexOf(\"includeForm(\") != -1)\n        #set($editorUrl = $tdoc.getURL('inline', \"$!docvariant\"))\n      #else\n        #if($xwiki.getUserPreference('editor') == 'Wysiwyg' && (!$tdoc.isAdvancedContent()))\n          #set($editorUrl = $tdoc.getURL(\"edit\", \"editor=wysiwyg&amp;$docvariant\"))\n        #else\n          #set($editorUrl = $tdoc.getURL(\"edit\", \"editor=wiki&amp;$docvariant\"))\n        #end\n      #end\n    #end\n  #end\n<form id=\"backtoedit\" class=\"buttons\" action=\"$!{escapetool.xml($editorUrl)}\" method=\"post\">\n  <div>\n    #foreach($param in $request.getParameterNames())\n      #if(!$param.startsWith('action_'))\n        #foreach($value in $request.getParameterValues($param))\n          <input type=\"hidden\" name=\"$!{escapetool.xml($param)}\" value=\"$!{escapetool.xml($value)}\"/>\n        #end\n      #end\n    #end\n    #editActionButton(\"$!{escapetool.xml($backToEditAction)}\", 'backtoedit', 'btn-default')\n    <div class=\"btn-group\">\n      #editActionButton('save', 'saveandview', 'btn-primary')\n      #editActionButton('saveandcontinue', 'save', 'btn-default')\n    </div>\n    #editActionButton('cancel', 'cancel', 'btn-default')\n  </div>\n</form>\n#end ## showactions\n"], "fixing_code": ["## ---------------------------------------------------------------------------\n## See the NOTICE file distributed with this work for additional\n## information regarding copyright ownership.\n##\n## This is free software; you can redistribute it and/or modify it\n## under the terms of the GNU Lesser General Public License as\n## published by the Free Software Foundation; either version 2.1 of\n## the License, or (at your option) any later version.\n##\n## This software is distributed in the hope that it will be useful,\n## but WITHOUT ANY WARRANTY; without even the implied warranty of\n## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n## Lesser General Public License for more details.\n##\n## You should have received a copy of the GNU Lesser General Public\n## License along with this software; if not, write to the Free\n## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n## 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n## ---------------------------------------------------------------------------\n### Buttons displayed in the preview interface: cancel, back to edit, save and continue, save and view.\n###\n#if(\"$!showactions\" != '0')\n  $xwiki.jsfx.use('js/xwiki/actionbuttons/actionButtons.js', true)\n  $xwiki.ssfx.use('js/xwiki/actionbuttons/actionButtons.css', true)\n  ## In case of conflict issue we want to display the diff properly\n  #set ($discard = $xwiki.ssfx.use('uicomponents/viewers/diff.css', true))\n  #set ($discard = $xwiki.jsfx.use('uicomponents/viewers/diff.js'))\n  #set($backToEditAction = \"$!{request.xeditaction}\")\n  #if($backToEditAction == '')\n    #set($backToEditAction = 'edit')\n  #end\n  #set($keyboardShortcutsEnabled = true)\n  #set($editorUrl = \"$!request.xcontinue\")\n  #if($editorUrl == '')\n    #set($editorUrl = \"$!request.getHeader('Referer')\")\n    #if($editorUrl == '')\n      #if($doc.content.indexOf(\"includeForm(\") != -1)\n        #set($editorUrl = $tdoc.getURL('inline', \"$!docvariant\"))\n      #else\n        #if($xwiki.getUserPreference('editor') == 'Wysiwyg' && (!$tdoc.isAdvancedContent()))\n          #set($editorUrl = $tdoc.getURL(\"edit\", \"editor=wysiwyg&amp;$docvariant\"))\n        #else\n          #set($editorUrl = $tdoc.getURL(\"edit\", \"editor=wiki&amp;$docvariant\"))\n        #end\n      #end\n    #end\n  #end\n  ## We use the wiki editor as fallback url since it's the one supposed to work in all conditions.\n  #set ($fallbackUrl = $tdoc.getURL(\"edit\", \"editor=wiki&amp;$docvariant\"))\n  #getSanitizedURLAttributeValue('form','action',$editorUrl, $fallbackUrl, $finalEditorUrl)\n<form id=\"backtoedit\" class=\"buttons\" action=\"$finalEditorUrl\" method=\"post\">\n  <div>\n    #foreach($param in $request.getParameterNames())\n      #if(!$param.startsWith('action_'))\n        #foreach($value in $request.getParameterValues($param))\n          <input type=\"hidden\" name=\"$!{escapetool.xml($param)}\" value=\"$!{escapetool.xml($value)}\"/>\n        #end\n      #end\n    #end\n    #editActionButton(\"$!{escapetool.xml($backToEditAction)}\", 'backtoedit', 'btn-default')\n    <div class=\"btn-group\">\n      #editActionButton('save', 'saveandview', 'btn-primary')\n      #editActionButton('saveandcontinue', 'save', 'btn-default')\n    </div>\n    #editActionButton('cancel', 'cancel', 'btn-default')\n  </div>\n</form>\n#end ## showactions\n"], "filenames": ["xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/previewactions.vm"], "buggy_code_start_loc": [48], "buggy_code_end_loc": [49], "fixing_code_start_loc": [48], "fixing_code_end_loc": [52], "type": "CWE-79", "message": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. Users are able to forge an URL with a payload allowing to inject Javascript in the page (XSS). It's possible to exploit the previewactions template to perform a XSS, e.g. by using URL such as: > <hostname>/xwiki/bin/get/FlamingoThemes/Cerulean xpage=xpart&vm=previewactions.vm&xcontinue=javascript:alert(document.domain). This vulnerability exists since XWiki 6.1-rc-1. The vulnerability has been patched in XWiki 14.10.5 and 15.1-rc-1.", "other": {"cve": {"id": "CVE-2023-35162", "sourceIdentifier": "security-advisories@github.com", "published": "2023-06-23T19:15:09.720", "lastModified": "2023-06-30T13:12:39.790", "vulnStatus": "Analyzed", "descriptions": [{"lang": "en", "value": "XWiki Platform is a generic wiki platform offering runtime services for applications built on top of it. Users are able to forge an URL with a payload allowing to inject Javascript in the page (XSS). It's possible to exploit the previewactions template to perform a XSS, e.g. by using URL such as: > <hostname>/xwiki/bin/get/FlamingoThemes/Cerulean xpage=xpart&vm=previewactions.vm&xcontinue=javascript:alert(document.domain). This vulnerability exists since XWiki 6.1-rc-1. The vulnerability has been patched in XWiki 14.10.5 and 15.1-rc-1."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "NONE", "baseScore": 6.1, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 2.8, "impactScore": 2.7}, {"source": "security-advisories@github.com", "type": "Secondary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "REQUIRED", "scope": "CHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH", "baseScore": 9.6, "baseSeverity": "CRITICAL"}, "exploitabilityScore": 2.8, "impactScore": 6.0}]}, "weaknesses": [{"source": "security-advisories@github.com", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:*:*:*:*:*:*:*:*", "versionStartIncluding": "6.2", "versionEndExcluding": "14.10.5", "matchCriteriaId": "2584E045-B04A-415F-8A54-E863FA140848"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:6.1:-:*:*:*:*:*:*", "matchCriteriaId": "CB1892AA-3410-41EA-B45A-1E7EEB6D354D"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:6.1:milestone1:*:*:*:*:*:*", "matchCriteriaId": "347BCA66-59DB-4AFE-81AC-CBBC16A9D2C2"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:6.1:milestone2:*:*:*:*:*:*", "matchCriteriaId": "52DBE10F-1F55-46AD-9D47-5C05FAB85777"}, {"vulnerable": true, "criteria": "cpe:2.3:a:xwiki:xwiki:6.1:rc1:*:*:*:*:*:*", "matchCriteriaId": "DE2A8246-5889-4BC6-AF65-F19BBAB094C6"}]}]}], "references": [{"url": "https://github.com/xwiki/xwiki-platform/commit/9f01166b1a8ee9639666099eb5040302df067e4d", "source": "security-advisories@github.com", "tags": ["Patch", "Technical Description", "Vendor Advisory"]}, {"url": "https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-q9hg-9qj2-mxf9", "source": "security-advisories@github.com", "tags": ["Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-20342", "source": "security-advisories@github.com", "tags": ["Issue Tracking", "Permissions Required", "Vendor Advisory"]}, {"url": "https://jira.xwiki.org/browse/XWIKI-20583", "source": "security-advisories@github.com", "tags": ["Issue Tracking", "Patch", "Vendor Advisory"]}]}, "github_commit_url": "https://github.com/xwiki/xwiki-platform/commit/9f01166b1a8ee9639666099eb5040302df067e4d"}}