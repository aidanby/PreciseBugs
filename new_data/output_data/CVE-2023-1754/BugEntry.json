{"buggy_code": ["<?php\n\n/**\n * Displays the group management frontend.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package phpMyFAQ\n * @author Lars Tiedemann <php@larstiedemann.de>\n * @author Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author Charles Boin <c.boin@h-tube.com>\n * @copyright 2005-2022 phpMyFAQ Team\n * @license http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link https://www.phpmyfaq.de\n * @since 2005-12-15\n */\n\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\User;\nuse phpMyFAQ\\User\\CurrentUser;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\nif (\n    !$user->perm->hasPermission($user->getUserId(), 'editgroup') &&\n    !$user->perm->hasPermission($user->getUserId(), 'delgroup') &&\n    !$user->perm->hasPermission($user->getUserId(), 'addgroup')\n) {\n    exit();\n}\n\n// set some parameters\n$groupSelectSize = 10;\n$memberSelectSize = 7;\n$descriptionRows = 3;\n$descriptionCols = 15;\n$defaultGroupAction = 'list';\n$groupActionList = [\n    'update_members',\n    'update_rights',\n    'update_data',\n    'delete_confirm',\n    'delete',\n    'addsave',\n    'add',\n    'list',\n    'import-ldap-groups',\n];\n\n// what shall we do?\n// actions defined by url: group_action=\n$groupAction = Filter::filterInput(INPUT_GET, 'group_action', FILTER_UNSAFE_RAW, $defaultGroupAction);\n\n$currentUser = new CurrentUser($faqConfig);\n\n// actions defined by submit button\nif (isset($_POST['group_action_deleteConfirm'])) {\n    $groupAction = 'delete_confirm';\n}\nif (isset($_POST['cancel'])) {\n    $groupAction = $defaultGroupAction;\n}\n\nif (!in_array($groupAction, $groupActionList)) {\n    // @Todo: implement Error message\n}\n\n// update group members\nif ($groupAction == 'update_members' && $user->perm->hasPermission($user->getUserId(), 'editgroup')) {\n    $message = '';\n    $groupAction = $defaultGroupAction;\n    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT, 0);\n    $groupMembers = isset($_POST['group_members']) ? $_POST['group_members'] : [];\n\n    if ($groupId == 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n    } else {\n        $user = new User($faqConfig);\n        $perm = $user->perm;\n        if (!$perm->removeAllUsersFromGroup($groupId)) {\n            $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_msg_mysqlerr']);\n        }\n        foreach ($groupMembers as $memberId) {\n            $perm->addToGroup((int)$memberId, $groupId);\n        }\n        $message .= sprintf(\n            '<p class=\"alert alert-success\">%s <strong>%s</strong> %s</p>',\n            $PMF_LANG['ad_msg_savedsuc_1'],\n            $perm->getGroupName($groupId),\n            $PMF_LANG['ad_msg_savedsuc_2']\n        );\n    }\n}\n\n// update group rights\nif ($groupAction == 'update_rights' && $user->perm->hasPermission($user->getUserId(), 'editgroup')) {\n    $message = '';\n    $groupAction = $defaultGroupAction;\n    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT, 0);\n    if ($groupId == 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n    } else {\n        $user = new User($faqConfig);\n        $perm = $user->perm;\n        $groupRights = isset($_POST['group_rights']) ? $_POST['group_rights'] : [];\n        if (!$perm->refuseAllGroupRights($groupId)) {\n            $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_msg_mysqlerr']);\n        }\n        foreach ($groupRights as $rightId) {\n            $perm->grantGroupRight($groupId, (int)$rightId);\n        }\n        $message .= sprintf(\n            '<p class=\"alert alert-success\">%s <strong>%s</strong> %s</p>',\n            $PMF_LANG['ad_msg_savedsuc_1'],\n            $perm->getGroupName($groupId),\n            $PMF_LANG['ad_msg_savedsuc_2']\n        );\n    }\n}\n\n// update group data\nif ($groupAction == 'update_data' && $user->perm->hasPermission($user->getUserId(), 'editgroup')) {\n    $message = '';\n    $groupAction = $defaultGroupAction;\n    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT, 0);\n    if ($groupId == 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n    } else {\n        $groupData = [];\n        $dataFields = ['name', 'description', 'auto_join'];\n        foreach ($dataFields as $field) {\n            $groupData[$field] = Filter::filterInput(INPUT_POST, $field, FILTER_UNSAFE_RAW, '');\n        }\n        $user = new User($faqConfig);\n        $perm = $user->perm;\n        if (!$perm->changeGroup($groupId, $groupData)) {\n            $message .= sprintf(\n                '<p class=\"alert alert-danger\">%s<br>%s</p>',\n                $PMF_LANG['ad_msg_mysqlerr'],\n                $db->error()\n            );\n        } else {\n            $message .= sprintf(\n                '<p class=\"alert alert-success\">%s <strong>%s</strong> %s</p>',\n                $PMF_LANG['ad_msg_savedsuc_1'],\n                $perm->getGroupName($groupId),\n                $PMF_LANG['ad_msg_savedsuc_2']\n            );\n        }\n    }\n}\n\n// delete group confirmation\nif ($groupAction == 'delete_confirm' && $user->perm->hasPermission($user->getUserId(), 'delgroup')) {\n    $message = '';\n    $user = new CurrentUser($faqConfig);\n    $perm = $user->perm;\n    $groupId = Filter::filterInput(INPUT_POST, 'group_list_select', FILTER_VALIDATE_INT, 0);\n    if ($groupId <= 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n        $groupAction = $defaultGroupAction;\n    } else {\n        $groupData = $perm->getGroupData($groupId);\n        ?>\n      <header class=\"row\">\n        <div class=\"col-lg-12\">\n          <h2 class=\"page-header\">\n            <i aria-hidden=\"true\" class=\"fa fa-users fa-fw\"></i>\n              <?= $PMF_LANG['ad_group_deleteGroup'] ?> \"<?= $groupData['name'] ?>\"\n          </h2>\n        </div>\n      </header>\n\n      <div class=\"row\">\n        <div class=\"col-lg-12\">\n          <p><?= $PMF_LANG['ad_group_deleteQuestion'] ?></p>\n          <form action=\"?action=group&amp;group_action=delete\" method=\"post\">\n            <input type=\"hidden\" name=\"group_id\" value=\"<?= $groupId ?>\">\n            <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n            <p>\n              <button class=\"btn btn-inverse\" type=\"submit\" name=\"cancel\">\n                  <?= $PMF_LANG['ad_gen_cancel'] ?>\n              </button>\n              <button class=\"btn btn-primary\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_save'] ?>\n              </button>\n            </p>\n          </form>\n        </div>\n      </div>\n        <?php\n    }\n}\n\nif ($groupAction == 'delete' && $user->perm->hasPermission($user->getUserId(), 'delgroup')) {\n    $message = '';\n    $user = new User($faqConfig);\n    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT, 0);\n    $csrfOkay = true;\n    $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_UNSAFE_RAW);\n    if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n        $csrfOkay = false;\n    }\n    $groupAction = $defaultGroupAction;\n    if ($groupId <= 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n    } else {\n        if (!$user->perm->deleteGroup($groupId) && !$csrfOkay) {\n            $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_group_error_delete']);\n        } else {\n            $message .= sprintf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_group_deleted']);\n        }\n        $userError = $user->error();\n        if ($userError != '') {\n            $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $userError);\n        }\n    }\n}\n\nif ($groupAction == 'addsave' && $user->perm->hasPermission($user->getUserId(), 'addgroup')) {\n    $user = new User($faqConfig);\n    $message = '';\n    $messages = [];\n    $groupName = Filter::filterInput(INPUT_POST, 'group_name', FILTER_UNSAFE_RAW, '');\n    $groupDescription = Filter::filterInput(INPUT_POST, 'group_description', FILTER_UNSAFE_RAW, '');\n    $groupAutoJoin = Filter::filterInput(INPUT_POST, 'group_auto_join', FILTER_UNSAFE_RAW, '');\n    $csrfOkay = true;\n    $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_UNSAFE_RAW);\n\n    if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n        $csrfOkay = false;\n    }\n    // check group name\n    if ($groupName == '') {\n        $messages[] = $PMF_LANG['ad_group_error_noName'];\n    }\n    // ok, let's go\n    if (count($messages) == 0 && $csrfOkay) {\n        // create group\n        $groupData = [\n            'name' => $groupName,\n            'description' => $groupDescription,\n            'auto_join' => $groupAutoJoin,\n        ];\n\n        if ($user->perm->addGroup($groupData) <= 0) {\n            $messages[] = $PMF_LANG['ad_adus_dberr'];\n        }\n    }\n\n    // no errors, show list\n    if (count($messages) === 0) {\n        $groupAction = $defaultGroupAction;\n        $message = sprintf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_group_suc']);\n        // display error messages and show form again\n    } else {\n        $groupAction = 'add';\n        $message = '<p class=\"alert alert-danger\">';\n        foreach ($messages as $err) {\n            $message .= $err . '<br>';\n        }\n        $message .= '</p>';\n    }\n}\n\nif (!isset($message)) {\n    $message = '';\n}\n\n// show new group form\nif ($groupAction == 'add' && $user->perm->hasPermission($user->getUserId(), 'addgroup')) {\n    $user = new CurrentUser($faqConfig);\n    ?>\n\n  <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n    <h1 class=\"h2\">\n      <i aria-hidden=\"true\" class=\"fa fa-users\"></i>\n        <?= $PMF_LANG['ad_group_add'] ?>\n    </h1>\n  </div>\n\n  <div class=\"row\">\n    <div class=\"col-lg-12\">\n      <div id=\"user_message\"><?= $message ?></div>\n      <form name=\"group_create\" action=\"?action=group&amp;group_action=addsave\" method=\"post\">\n        <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n\n        <div class=\"form-group row\">\n          <label class=\"col-lg-2 col-form-label\" for=\"group_name\"><?= $PMF_LANG['ad_group_name'] ?></label>\n          <div class=\"col-lg-3\">\n            <input type=\"text\" name=\"group_name\" id=\"group_name\" autofocus class=\"form-control\"\n                   value=\"<?= (isset($groupName) ? $groupName : '') ?>\" tabindex=\"1\">\n          </div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label class=\"col-lg-2 col-form-label\"\n                 for=\"group_description\"><?= $PMF_LANG['ad_group_description'] ?></label>\n          <div class=\"col-lg-3\">\n            <textarea name=\"group_description\" id=\"group_description\" cols=\"<?= $descriptionCols ?>\"\n                      rows=\"<?= $descriptionRows ?>\" tabindex=\"2\" class=\"form-control\"\n            ><?= (isset($groupDescription) ? $groupDescription : '') ?></textarea>\n          </div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label class=\"col-lg-2 col-form-label\" for=\"group_auto_join\"><?= $PMF_LANG['ad_group_autoJoin'] ?></label>\n          <div class=\"col-lg-3\">\n            <div class=\"checkbox\">\n              <label>\n                <input type=\"checkbox\" name=\"group_auto_join\" id=\"group_auto_join\" value=\"1\" tabindex=\"3\"\n                       <?= ((isset($groupAutoJoin) && $groupAutoJoin) ? ' checked' : '') ?>>\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"form-group row\">\n          <div class=\"offset-lg-2 col-lg-3\">\n            <button class=\"btn btn-info\" type=\"reset\" name=\"cancel\">\n                <?= $PMF_LANG['ad_gen_cancel'] ?>\n            </button>\n            <button class=\"btn btn-primary\" type=\"submit\">\n                <?= $PMF_LANG['ad_gen_save'] ?>\n            </button>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n    <?php\n}\n\n// Import LDAP groups\n/*\nif ('import-ldap-groups' === $groupAction && $user->perm->hasPermission($user->getUserId(), 'addgroup')) {\n    $user = new CurrentUser($faqConfig);\n    $message = '';\n    $messages = [];\n\n    // Temporary data\n    $groupName = 'LDAP Group';\n    $groupDescription = 'This is a LDAP group import demo';\n    $groupAutoJoin = false;\n\n    $csrfOkay = true;\n    $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_UNSAFE_RAW);\n\n    if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n        $csrfOkay = false;\n    }\n\n    // check group name\n    if ($groupName == '') {\n        $messages[] = $PMF_LANG['ad_group_error_noName'];\n    }\n\n    // ok, let's go\n    if (count($messages) == 0 && $csrfOkay) {\n        // create group\n        $groupData = [\n            'name' => $groupName,\n            'description' => $groupDescription,\n            'auto_join' => $groupAutoJoin,\n        ];\n\n        if ($user->perm->addGroup($groupData) <= 0) {\n            $messages[] = $PMF_LANG['ad_adus_dberr'];\n        }\n    }\n\n    // no errors, show list\n    if (count($messages) == 0) {\n        $groupAction = $defaultGroupAction;\n        $message = sprintf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_group_suc']);\n        // display error messages and show form again\n    } else {\n        $groupAction = 'import-ldap-groups';\n        $message = '<p class=\"alert alert-danger\">';\n        foreach ($messages as $err) {\n            $message .= $err . '<br>';\n        }\n        $message .= '</p>';\n    }\n}\n*/\n\n// show list of users\nif ('list' === $groupAction) {\n    ?>\n  <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n    <h1 class=\"h2\">\n      <i aria-hidden=\"true\" class=\"fa fa-users\"></i>\n        <?= $PMF_LANG['ad_menu_group_administration'] ?>\n    </h1>\n    <div class=\"btn-toolbar mb-2 mb-md-0\">\n      <div class=\"btn-group mr-2\">\n        <a class=\"btn btn-sm btn-success\" href=\"?action=group&amp;group_action=add\">\n          <?= $PMF_LANG['ad_group_add_link'] ?>\n        </a>\n      </div>\n    </div>\n  </div>\n\n  <script src=\"assets/js/user.js\"></script>\n  <script src=\"assets/js/groups.js\"></script>\n\n  <div id=\"user_message\"><?= $message ?></div>\n\n  <div class=\"row\">\n\n    <div class=\"col-lg-4\" id=\"group_list\">\n\n      <!--\n      <div class=\"card mb-4\">\n        <div class=\"card-header py-3\">\n          <form id=\"group-import-ldap-groups\" method=\"post\"\n                name=\"group-import-ldap-groups\" action=\"?action=group&amp;group_action=import-ldap-groups\">\n            <input type=\"hidden\" name=\"csrf\" value=\"<?= $currentUser->getCsrfTokenFromSession() ?>\">\n            <button class=\"btn btn-success\" type=\"submit\">\n              Import LDAP groups\n            </button>\n          </form>\n        </div>\n      </div>\n      -->\n\n      <div class=\"card mb-4\">\n        <form id=\"group_select\" name=\"group_select\" action=\"?action=group&amp;group_action=delete_confirm\"\n              method=\"post\">\n          <h5 class=\"card-header py-3\">\n            <i aria-hidden=\"true\" class=\"fa fa-users\"></i> <?= $PMF_LANG['ad_groups'] ?>\n          </h5>\n          <div class=\"card-body\">\n            <select name=\"group_list_select\" id=\"group_list_select\" class=\"form-control\"\n                    size=\"<?= $groupSelectSize ?>\" tabindex=\"1\">\n            </select>\n          </div>\n          <div class=\"card-footer\">\n            <div class=\"card-button text-right\">\n              <button class=\"btn btn-danger\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_delete'] ?>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n\n      <div id=\"group_data\" class=\"card mb-4\">\n        <h5 class=\"card-header py-3\">\n          <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i> <?= $PMF_LANG['ad_group_details'] ?>\n        </h5>\n        <form action=\"?action=group&group_action=update_data\" method=\"post\">\n          <input id=\"update_group_id\" type=\"hidden\" name=\"group_id\" value=\"0\">\n          <div class=\"card-body\">\n            <div class=\"form-group row\">\n              <label class=\"col-lg-3 col-form-label\" for=\"update_group_name\">\n                  <?= $PMF_LANG['ad_group_name'] ?>\n              </label>\n              <div class=\"col-lg-9\">\n                <input id=\"update_group_name\" type=\"text\" name=\"name\" class=\"form-control\"\n                       tabindex=\"1\" value=\"<?= (isset($groupName) ? $groupName : '') ?>\">\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-lg-3 col-form-label\" for=\"update_group_description\">\n                  <?= $PMF_LANG['ad_group_description'] ?>\n              </label>\n              <div class=\"col-lg-9\">\n                <textarea id=\"update_group_description\" name=\"description\" class=\"form-control\"\n                          rows=\"<?= $descriptionRows ?>\"\n                          tabindex=\"2\"><?php\n                            echo(isset($groupDescription) ? $groupDescription : '') ?></textarea>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <div class=\"col-lg-offset-3 col-lg-9\">\n                <div class=\"checkbox\">\n                  <label>\n                    <input id=\"update_group_auto_join\" type=\"checkbox\" name=\"auto_join\" value=\"1\"\n                           tabindex=\"3\"<?php\n                            echo((isset($groupAutoJoin) && $groupAutoJoin) ? ' checked' : '') ?>>\n                      <?= $PMF_LANG['ad_group_autoJoin'] ?>\n                  </label>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"card-footer\">\n            <div class=\"card-button text-right\">\n              <button class=\"btn btn-primary\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_save'] ?>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n\n    <div class=\"col-lg-4\" id=\"groupMemberships\">\n      <form id=\"group_membership\" name=\"group_membership\" method=\"post\"\n            action=\"?action=group&amp;group_action=update_members\">\n        <input id=\"update_member_group_id\" type=\"hidden\" name=\"group_id\" value=\"0\">\n        <div class=\"card mb-4\">\n          <h5 class=\"card-header py-3\">\n            <i aria-hidden=\"true\" class=\"fa fa-user-circle\"></i> <?= $PMF_LANG['ad_group_membership'] ?>\n          </h5>\n          <div class=\"card-body\">\n            <div class=\"form-group row\">\n              <div class=\"text-center\">\n                <span class=\"select_all\">\n                  <a class=\"btn btn-primary btn-sm\"\n                     href=\"javascript:selectSelectAll('group_user_list')\">\n                      <i aria-hidden=\"true\" class=\"fa fa-user-plus\"></i>\n                  </a>\n                </span>\n                <span class=\"unselect_all\">\n                  <a class=\"btn btn-primary btn-sm\"\n                     href=\"javascript:selectUnselectAll('group_user_list')\">\n                      <i aria-hidden=\"true\" class=\"fa fa-user-times\"></i>\n                  </a>\n                </span>\n              </div>\n            </div>\n\n            <div class=\"form-group row\">\n              <select id=\"group_user_list\" class=\"form-control\" size=\"<?= $memberSelectSize ?>\"\n                      multiple>\n                <option value=\"0\">...user list...</option>\n              </select>\n            </div>\n\n            <div class=\"form-group row\">\n              <div class=\"text-center\">\n                <input class=\"btn btn-success pmf-add-member\" type=\"button\"\n                       value=\"<?= $PMF_LANG['ad_group_addMember'] ?>\">\n                <input class=\"btn btn-danger pmf-remove-member\" type=\"button\"\n                       value=\"<?= $PMF_LANG['ad_group_removeMember'] ?>\">\n              </div>\n            </div>\n          </div>\n\n          <ul class=\"list-group list-group-flush\">\n            <li class=\"list-group-item\">\n              <i aria-hidden=\"true\" class=\"fa fa-user-circle\"></i> <?= $PMF_LANG['ad_group_members']; ?></li>\n          </ul>\n\n          <div class=\"card-body\">\n            <div class=\"form-group row\">\n              <div class=\"text-center\">\n                <span class=\"select_all\">\n                    <a class=\"btn btn-primary btn-sm\"\n                       href=\"javascript:selectSelectAll('group_member_list')\">\n                        <i aria-hidden=\"true\" class=\"fa fa-user-plus\"></i>\n                    </a>\n                </span>\n                <span class=\"unselect_all\">\n                  <a class=\"btn btn-primary btn-sm\"\n                     href=\"javascript:selectUnselectAll('group_member_list')\">\n                      <i aria-hidden=\"true\" class=\"fa fa-user-times\"></i>\n                  </a>\n                </span>\n              </div>\n            </div>\n\n            <div class=\"form-group row\">\n              <select id=\"group_member_list\" name=\"group_members[]\" class=\"form-control\" multiple\n                      size=\"<?= $memberSelectSize ?>\">\n                <option value=\"0\">...member list...</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"card-footer\">\n            <div class=\"card-button text-right\">\n              <button class=\"btn btn-primary\" onclick=\"javascript:selectSelectAll('group_member_list')\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_save'] ?>\n              </button>\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n\n    <div class=\"col-lg-4\" id=\"groupDetails\">\n\n      <div id=\"groupRights\" class=\"card mb-4\">\n        <form id=\"rightsForm\" action=\"?action=group&amp;group_action=update_rights\" method=\"post\">\n          <input id=\"rights_group_id\" type=\"hidden\" name=\"group_id\" value=\"0\">\n          <h5 class=\"card-header py-3\" id=\"user_rights_legend\">\n            <i aria-hidden=\"true\" class=\"fa fa-lock\"></i> <?= $PMF_LANG['ad_group_rights'] ?>\n\n          </h5>\n\n          <div class=\"card-body\">\n              <div class=\"text-center mb-3\">\n              <a class=\"btn btn-primary btn-sm\" href=\"#\" id=\"checkAll\">\n                <?= $PMF_LANG['ad_user_checkall'] ?> / <?= $PMF_LANG['ad_user_uncheckall'] ?>\n              </a>\n            </div>\n              <?php foreach ($user->perm->getAllRightsData() as $right) : ?>\n                <div class=\"form-check\">\n                  <input id=\"group_right_<?= $right['right_id'] ?>\" type=\"checkbox\"\n                         name=\"group_rights[]\" value=\"<?= $right['right_id'] ?>\"\n                         class=\"form-check-input permission\">\n                  <label class=\"form-check-label\" for=\"group_right_<?= $right['right_id'] ?>\">\n                      <?php\n                        if (isset($PMF_LANG['rightsLanguage'][$right['name']])) {\n                            echo $PMF_LANG['rightsLanguage'][$right['name']];\n                        } else {\n                            echo $right['description'];\n                        }\n                        ?>\n                  </label>\n                </div>\n              <?php endforeach; ?>\n          </div>\n          <div class=\"card-footer\">\n            <div class=\"card-button text-right\">\n              <button class=\"btn btn-primary\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_save'] ?>\n              </button>\n            </div>\n          </div>\n      </div>\n      </form>\n    </div>\n  </div>\n    <?php\n}\n"], "fixing_code": ["<?php\n\n/**\n * Displays the group management frontend.\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/.\n *\n * @package phpMyFAQ\n * @author Lars Tiedemann <php@larstiedemann.de>\n * @author Thorsten Rinne <thorsten@phpmyfaq.de>\n * @author Charles Boin <c.boin@h-tube.com>\n * @copyright 2005-2022 phpMyFAQ Team\n * @license http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link https://www.phpmyfaq.de\n * @since 2005-12-15\n */\n\nuse phpMyFAQ\\Filter;\nuse phpMyFAQ\\Strings;\nuse phpMyFAQ\\User;\nuse phpMyFAQ\\User\\CurrentUser;\n\nif (!defined('IS_VALID_PHPMYFAQ')) {\n    http_response_code(400);\n    exit();\n}\n\nif (\n    !$user->perm->hasPermission($user->getUserId(), 'editgroup') &&\n    !$user->perm->hasPermission($user->getUserId(), 'delgroup') &&\n    !$user->perm->hasPermission($user->getUserId(), 'addgroup')\n) {\n    exit();\n}\n\n// set some parameters\n$groupSelectSize = 10;\n$memberSelectSize = 7;\n$descriptionRows = 3;\n$descriptionCols = 15;\n$defaultGroupAction = 'list';\n$groupActionList = [\n    'update_members',\n    'update_rights',\n    'update_data',\n    'delete_confirm',\n    'delete',\n    'addsave',\n    'add',\n    'list',\n    'import-ldap-groups',\n];\n\n// what shall we do?\n// actions defined by url: group_action=\n$groupAction = Filter::filterInput(INPUT_GET, 'group_action', FILTER_UNSAFE_RAW, $defaultGroupAction);\n\n$currentUser = new CurrentUser($faqConfig);\n\n// actions defined by submit button\nif (isset($_POST['group_action_deleteConfirm'])) {\n    $groupAction = 'delete_confirm';\n}\nif (isset($_POST['cancel'])) {\n    $groupAction = $defaultGroupAction;\n}\n\nif (!in_array($groupAction, $groupActionList)) {\n    // @Todo: implement Error message\n}\n\n// update group members\nif ($groupAction == 'update_members' && $user->perm->hasPermission($user->getUserId(), 'editgroup')) {\n    $message = '';\n    $groupAction = $defaultGroupAction;\n    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT, 0);\n    $groupMembers = isset($_POST['group_members']) ? $_POST['group_members'] : [];\n\n    if ($groupId == 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n    } else {\n        $user = new User($faqConfig);\n        $perm = $user->perm;\n        if (!$perm->removeAllUsersFromGroup($groupId)) {\n            $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_msg_mysqlerr']);\n        }\n        foreach ($groupMembers as $memberId) {\n            $perm->addToGroup((int)$memberId, $groupId);\n        }\n        $message .= sprintf(\n            '<p class=\"alert alert-success\">%s <strong>%s</strong> %s</p>',\n            $PMF_LANG['ad_msg_savedsuc_1'],\n            $perm->getGroupName($groupId),\n            $PMF_LANG['ad_msg_savedsuc_2']\n        );\n    }\n}\n\n// update group rights\nif ($groupAction == 'update_rights' && $user->perm->hasPermission($user->getUserId(), 'editgroup')) {\n    $message = '';\n    $groupAction = $defaultGroupAction;\n    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT, 0);\n    if ($groupId == 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n    } else {\n        $user = new User($faqConfig);\n        $perm = $user->perm;\n        $groupRights = isset($_POST['group_rights']) ? $_POST['group_rights'] : [];\n        if (!$perm->refuseAllGroupRights($groupId)) {\n            $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_msg_mysqlerr']);\n        }\n        foreach ($groupRights as $rightId) {\n            $perm->grantGroupRight($groupId, (int)$rightId);\n        }\n        $message .= sprintf(\n            '<p class=\"alert alert-success\">%s <strong>%s</strong> %s</p>',\n            $PMF_LANG['ad_msg_savedsuc_1'],\n            $perm->getGroupName($groupId),\n            $PMF_LANG['ad_msg_savedsuc_2']\n        );\n    }\n}\n\n// update group data\nif ($groupAction == 'update_data' && $user->perm->hasPermission($user->getUserId(), 'editgroup')) {\n    $message = '';\n    $groupAction = $defaultGroupAction;\n    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT, 0);\n    if ($groupId == 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n    } else {\n        $groupData = [];\n        $dataFields = ['name', 'description', 'auto_join'];\n        foreach ($dataFields as $field) {\n            $groupData[$field] = Filter::filterInput(INPUT_POST, $field, FILTER_UNSAFE_RAW, '');\n        }\n        $user = new User($faqConfig);\n        $perm = $user->perm;\n        if (!$perm->changeGroup($groupId, $groupData)) {\n            $message .= sprintf(\n                '<p class=\"alert alert-danger\">%s<br>%s</p>',\n                $PMF_LANG['ad_msg_mysqlerr'],\n                $db->error()\n            );\n        } else {\n            $message .= sprintf(\n                '<p class=\"alert alert-success\">%s <strong>%s</strong> %s</p>',\n                $PMF_LANG['ad_msg_savedsuc_1'],\n                $perm->getGroupName($groupId),\n                $PMF_LANG['ad_msg_savedsuc_2']\n            );\n        }\n    }\n}\n\n// delete group confirmation\nif ($groupAction == 'delete_confirm' && $user->perm->hasPermission($user->getUserId(), 'delgroup')) {\n    $message = '';\n    $user = new CurrentUser($faqConfig);\n    $perm = $user->perm;\n    $groupId = Filter::filterInput(INPUT_POST, 'group_list_select', FILTER_VALIDATE_INT, 0);\n    if ($groupId <= 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n        $groupAction = $defaultGroupAction;\n    } else {\n        $groupData = $perm->getGroupData($groupId);\n        ?>\n      <header class=\"row\">\n        <div class=\"col-lg-12\">\n          <h2 class=\"page-header\">\n            <i aria-hidden=\"true\" class=\"fa fa-users fa-fw\"></i>\n              <?= $PMF_LANG['ad_group_deleteGroup'] ?> \"<?= Strings::htmlentities($groupData['name']) ?>\"\n          </h2>\n        </div>\n      </header>\n\n      <div class=\"row\">\n        <div class=\"col-lg-12\">\n          <p><?= $PMF_LANG['ad_group_deleteQuestion'] ?></p>\n          <form action=\"?action=group&amp;group_action=delete\" method=\"post\">\n            <input type=\"hidden\" name=\"group_id\" value=\"<?= $groupId ?>\">\n            <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n            <p>\n              <button class=\"btn btn-inverse\" type=\"submit\" name=\"cancel\">\n                  <?= $PMF_LANG['ad_gen_cancel'] ?>\n              </button>\n              <button class=\"btn btn-primary\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_save'] ?>\n              </button>\n            </p>\n          </form>\n        </div>\n      </div>\n        <?php\n    }\n}\n\nif ($groupAction == 'delete' && $user->perm->hasPermission($user->getUserId(), 'delgroup')) {\n    $message = '';\n    $user = new User($faqConfig);\n    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT, 0);\n    $csrfOkay = true;\n    $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_UNSAFE_RAW);\n    if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n        $csrfOkay = false;\n    }\n    $groupAction = $defaultGroupAction;\n    if ($groupId <= 0) {\n        $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_user_error_noId']);\n    } else {\n        if (!$user->perm->deleteGroup($groupId) && !$csrfOkay) {\n            $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $PMF_LANG['ad_group_error_delete']);\n        } else {\n            $message .= sprintf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_group_deleted']);\n        }\n        $userError = $user->error();\n        if ($userError != '') {\n            $message .= sprintf('<p class=\"alert alert-danger\">%s</p>', $userError);\n        }\n    }\n}\n\nif ($groupAction == 'addsave' && $user->perm->hasPermission($user->getUserId(), 'addgroup')) {\n    $user = new User($faqConfig);\n    $message = '';\n    $messages = [];\n    $groupName = Filter::filterInput(INPUT_POST, 'group_name', FILTER_SANITIZE_SPECIAL_CHARS, '');\n    $groupDescription = Filter::filterInput(INPUT_POST, 'group_description', FILTER_SANITIZE_SPECIAL_CHARS, '');\n    $groupAutoJoin = Filter::filterInput(INPUT_POST, 'group_auto_join', FILTER_UNSAFE_RAW, '');\n    $csrfOkay = true;\n    $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_UNSAFE_RAW);\n\n    if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {\n        $csrfOkay = false;\n    }\n    // check group name\n    if ($groupName === '') {\n        $messages[] = $PMF_LANG['ad_group_error_noName'];\n    }\n    // ok, let's go\n    if (count($messages) == 0 && $csrfOkay) {\n        // create group\n        $groupData = [\n            'name' => $groupName,\n            'description' => $groupDescription,\n            'auto_join' => $groupAutoJoin,\n        ];\n\n        if ($user->perm->addGroup($groupData) <= 0) {\n            $messages[] = $PMF_LANG['ad_adus_dberr'];\n        }\n    }\n\n    // no errors, show list\n    if (count($messages) === 0) {\n        $groupAction = $defaultGroupAction;\n        $message = sprintf('<p class=\"alert alert-success\">%s</p>', $PMF_LANG['ad_group_suc']);\n        // display error messages and show form again\n    } else {\n        $groupAction = 'add';\n        $message = '<p class=\"alert alert-danger\">';\n        foreach ($messages as $err) {\n            $message .= $err . '<br>';\n        }\n        $message .= '</p>';\n    }\n}\n\nif (!isset($message)) {\n    $message = '';\n}\n\n// show new group form\nif ($groupAction == 'add' && $user->perm->hasPermission($user->getUserId(), 'addgroup')) {\n    $user = new CurrentUser($faqConfig);\n    ?>\n\n  <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n    <h1 class=\"h2\">\n      <i aria-hidden=\"true\" class=\"fa fa-users\"></i>\n        <?= $PMF_LANG['ad_group_add'] ?>\n    </h1>\n  </div>\n\n  <div class=\"row\">\n    <div class=\"col-lg-12\">\n      <div id=\"user_message\"><?= $message ?></div>\n      <form name=\"group_create\" action=\"?action=group&amp;group_action=addsave\" method=\"post\">\n        <input type=\"hidden\" name=\"csrf\" value=\"<?= $user->getCsrfTokenFromSession() ?>\">\n\n        <div class=\"form-group row\">\n          <label class=\"col-lg-2 col-form-label\" for=\"group_name\"><?= $PMF_LANG['ad_group_name'] ?></label>\n          <div class=\"col-lg-3\">\n            <input type=\"text\" name=\"group_name\" id=\"group_name\" autofocus class=\"form-control\"\n                   value=\"<?= (isset($groupName) ? $groupName : '') ?>\" tabindex=\"1\">\n          </div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label class=\"col-lg-2 col-form-label\"\n                 for=\"group_description\"><?= $PMF_LANG['ad_group_description'] ?></label>\n          <div class=\"col-lg-3\">\n            <textarea name=\"group_description\" id=\"group_description\" cols=\"<?= $descriptionCols ?>\"\n                      rows=\"<?= $descriptionRows ?>\" tabindex=\"2\" class=\"form-control\"\n            ><?= (isset($groupDescription) ? $groupDescription : '') ?></textarea>\n          </div>\n        </div>\n\n        <div class=\"form-group row\">\n          <label class=\"col-lg-2 col-form-label\" for=\"group_auto_join\"><?= $PMF_LANG['ad_group_autoJoin'] ?></label>\n          <div class=\"col-lg-3\">\n            <div class=\"checkbox\">\n              <label>\n                <input type=\"checkbox\" name=\"group_auto_join\" id=\"group_auto_join\" value=\"1\" tabindex=\"3\"\n                       <?= ((isset($groupAutoJoin) && $groupAutoJoin) ? ' checked' : '') ?>>\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"form-group row\">\n          <div class=\"offset-lg-2 col-lg-3\">\n            <button class=\"btn btn-info\" type=\"reset\" name=\"cancel\">\n                <?= $PMF_LANG['ad_gen_cancel'] ?>\n            </button>\n            <button class=\"btn btn-primary\" type=\"submit\">\n                <?= $PMF_LANG['ad_gen_save'] ?>\n            </button>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n    <?php\n}\n\n// show list of users\nif ('list' === $groupAction) {\n    ?>\n  <div class=\"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom\">\n    <h1 class=\"h2\">\n      <i aria-hidden=\"true\" class=\"fa fa-users\"></i>\n        <?= $PMF_LANG['ad_menu_group_administration'] ?>\n    </h1>\n    <div class=\"btn-toolbar mb-2 mb-md-0\">\n      <div class=\"btn-group mr-2\">\n        <a class=\"btn btn-sm btn-success\" href=\"?action=group&amp;group_action=add\">\n          <?= $PMF_LANG['ad_group_add_link'] ?>\n        </a>\n      </div>\n    </div>\n  </div>\n\n  <script src=\"assets/js/user.js\"></script>\n  <script src=\"assets/js/groups.js\"></script>\n\n  <div id=\"user_message\"><?= $message ?></div>\n\n  <div class=\"row\">\n\n    <div class=\"col-lg-4\" id=\"group_list\">\n\n      <div class=\"card mb-4\">\n        <form id=\"group_select\" name=\"group_select\" action=\"?action=group&amp;group_action=delete_confirm\"\n              method=\"post\">\n          <h5 class=\"card-header py-3\">\n            <i aria-hidden=\"true\" class=\"fa fa-users\"></i> <?= $PMF_LANG['ad_groups'] ?>\n          </h5>\n          <div class=\"card-body\">\n            <select name=\"group_list_select\" id=\"group_list_select\" class=\"form-control\"\n                    size=\"<?= $groupSelectSize ?>\" tabindex=\"1\">\n            </select>\n          </div>\n          <div class=\"card-footer\">\n            <div class=\"card-button text-right\">\n              <button class=\"btn btn-danger\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_delete'] ?>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n\n      <div id=\"group_data\" class=\"card mb-4\">\n        <h5 class=\"card-header py-3\">\n          <i class=\"fa fa-info-circle\" aria-hidden=\"true\"></i> <?= $PMF_LANG['ad_group_details'] ?>\n        </h5>\n        <form action=\"?action=group&group_action=update_data\" method=\"post\">\n          <input id=\"update_group_id\" type=\"hidden\" name=\"group_id\" value=\"0\">\n          <div class=\"card-body\">\n            <div class=\"form-group row\">\n              <label class=\"col-lg-3 col-form-label\" for=\"update_group_name\">\n                  <?= $PMF_LANG['ad_group_name'] ?>\n              </label>\n              <div class=\"col-lg-9\">\n                <input id=\"update_group_name\" type=\"text\" name=\"name\" class=\"form-control\"\n                       tabindex=\"1\" value=\"<?= (isset($groupName) ? $groupName : '') ?>\">\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <label class=\"col-lg-3 col-form-label\" for=\"update_group_description\">\n                  <?= $PMF_LANG['ad_group_description'] ?>\n              </label>\n              <div class=\"col-lg-9\">\n                <textarea id=\"update_group_description\" name=\"description\" class=\"form-control\"\n                          rows=\"<?= $descriptionRows ?>\"\n                          tabindex=\"2\"><?php\n                            echo(isset($groupDescription) ? $groupDescription : '') ?></textarea>\n              </div>\n            </div>\n            <div class=\"form-group row\">\n              <div class=\"col-lg-offset-3 col-lg-9\">\n                <div class=\"checkbox\">\n                  <label>\n                    <input id=\"update_group_auto_join\" type=\"checkbox\" name=\"auto_join\" value=\"1\"\n                           tabindex=\"3\"<?php\n                            echo((isset($groupAutoJoin) && $groupAutoJoin) ? ' checked' : '') ?>>\n                      <?= $PMF_LANG['ad_group_autoJoin'] ?>\n                  </label>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"card-footer\">\n            <div class=\"card-button text-right\">\n              <button class=\"btn btn-primary\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_save'] ?>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n\n    <div class=\"col-lg-4\" id=\"groupMemberships\">\n      <form id=\"group_membership\" name=\"group_membership\" method=\"post\"\n            action=\"?action=group&amp;group_action=update_members\">\n        <input id=\"update_member_group_id\" type=\"hidden\" name=\"group_id\" value=\"0\">\n        <div class=\"card mb-4\">\n          <h5 class=\"card-header py-3\">\n            <i aria-hidden=\"true\" class=\"fa fa-user-circle\"></i> <?= $PMF_LANG['ad_group_membership'] ?>\n          </h5>\n          <div class=\"card-body\">\n            <div class=\"form-group row\">\n              <div class=\"text-center\">\n                <span class=\"select_all\">\n                  <a class=\"btn btn-primary btn-sm\"\n                     href=\"javascript:selectSelectAll('group_user_list')\">\n                      <i aria-hidden=\"true\" class=\"fa fa-user-plus\"></i>\n                  </a>\n                </span>\n                <span class=\"unselect_all\">\n                  <a class=\"btn btn-primary btn-sm\"\n                     href=\"javascript:selectUnselectAll('group_user_list')\">\n                      <i aria-hidden=\"true\" class=\"fa fa-user-times\"></i>\n                  </a>\n                </span>\n              </div>\n            </div>\n\n            <div class=\"form-group row\">\n              <select id=\"group_user_list\" class=\"form-control\" size=\"<?= $memberSelectSize ?>\"\n                      multiple>\n                <option value=\"0\">...user list...</option>\n              </select>\n            </div>\n\n            <div class=\"form-group row\">\n              <div class=\"text-center\">\n                <input class=\"btn btn-success pmf-add-member\" type=\"button\"\n                       value=\"<?= $PMF_LANG['ad_group_addMember'] ?>\">\n                <input class=\"btn btn-danger pmf-remove-member\" type=\"button\"\n                       value=\"<?= $PMF_LANG['ad_group_removeMember'] ?>\">\n              </div>\n            </div>\n          </div>\n\n          <ul class=\"list-group list-group-flush\">\n            <li class=\"list-group-item\">\n              <i aria-hidden=\"true\" class=\"fa fa-user-circle\"></i> <?= $PMF_LANG['ad_group_members']; ?></li>\n          </ul>\n\n          <div class=\"card-body\">\n            <div class=\"form-group row\">\n              <div class=\"text-center\">\n                <span class=\"select_all\">\n                    <a class=\"btn btn-primary btn-sm\"\n                       href=\"javascript:selectSelectAll('group_member_list')\">\n                        <i aria-hidden=\"true\" class=\"fa fa-user-plus\"></i>\n                    </a>\n                </span>\n                <span class=\"unselect_all\">\n                  <a class=\"btn btn-primary btn-sm\"\n                     href=\"javascript:selectUnselectAll('group_member_list')\">\n                      <i aria-hidden=\"true\" class=\"fa fa-user-times\"></i>\n                  </a>\n                </span>\n              </div>\n            </div>\n\n            <div class=\"form-group row\">\n              <select id=\"group_member_list\" name=\"group_members[]\" class=\"form-control\" multiple\n                      size=\"<?= $memberSelectSize ?>\">\n                <option value=\"0\">...member list...</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"card-footer\">\n            <div class=\"card-button text-right\">\n              <button class=\"btn btn-primary\" onclick=\"javascript:selectSelectAll('group_member_list')\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_save'] ?>\n              </button>\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n\n    <div class=\"col-lg-4\" id=\"groupDetails\">\n\n      <div id=\"groupRights\" class=\"card mb-4\">\n        <form id=\"rightsForm\" action=\"?action=group&amp;group_action=update_rights\" method=\"post\">\n          <input id=\"rights_group_id\" type=\"hidden\" name=\"group_id\" value=\"0\">\n          <h5 class=\"card-header py-3\" id=\"user_rights_legend\">\n            <i aria-hidden=\"true\" class=\"fa fa-lock\"></i> <?= $PMF_LANG['ad_group_rights'] ?>\n\n          </h5>\n\n          <div class=\"card-body\">\n              <div class=\"text-center mb-3\">\n              <a class=\"btn btn-primary btn-sm\" href=\"#\" id=\"checkAll\">\n                <?= $PMF_LANG['ad_user_checkall'] ?> / <?= $PMF_LANG['ad_user_uncheckall'] ?>\n              </a>\n            </div>\n              <?php foreach ($user->perm->getAllRightsData() as $right) : ?>\n                <div class=\"form-check\">\n                  <input id=\"group_right_<?= $right['right_id'] ?>\" type=\"checkbox\"\n                         name=\"group_rights[]\" value=\"<?= $right['right_id'] ?>\"\n                         class=\"form-check-input permission\">\n                  <label class=\"form-check-label\" for=\"group_right_<?= $right['right_id'] ?>\">\n                      <?php\n                        if (isset($PMF_LANG['rightsLanguage'][$right['name']])) {\n                            echo $PMF_LANG['rightsLanguage'][$right['name']];\n                        } else {\n                            echo $right['description'];\n                        }\n                        ?>\n                  </label>\n                </div>\n              <?php endforeach; ?>\n          </div>\n          <div class=\"card-footer\">\n            <div class=\"card-button text-right\">\n              <button class=\"btn btn-primary\" type=\"submit\">\n                  <?= $PMF_LANG['ad_gen_save'] ?>\n              </button>\n            </div>\n          </div>\n      </div>\n      </form>\n    </div>\n  </div>\n    <?php\n}\n"], "filenames": ["phpmyfaq/admin/group.php"], "buggy_code_start_loc": [20], "buggy_code_end_loc": [433], "fixing_code_start_loc": [21], "fixing_code_end_loc": [365], "type": "CWE-79", "message": "Improper Neutralization of Input During Web Page Generation in GitHub repository thorsten/phpmyfaq prior to 3.1.12.", "other": {"cve": {"id": "CVE-2023-1754", "sourceIdentifier": "security@huntr.dev", "published": "2023-03-31T01:15:09.247", "lastModified": "2023-04-26T16:15:09.840", "vulnStatus": "Modified", "descriptions": [{"lang": "en", "value": "Improper Neutralization of Input During Web Page Generation in GitHub repository thorsten/phpmyfaq prior to 3.1.12."}], "metrics": {"cvssMetricV31": [{"source": "nvd@nist.gov", "type": "Primary", "cvssData": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 4.7, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.2, "impactScore": 3.4}], "cvssMetricV30": [{"source": "security@huntr.dev", "type": "Secondary", "cvssData": {"version": "3.0", "vectorString": "CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:L/I:L/A:L", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "HIGH", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "LOW", "integrityImpact": "LOW", "availabilityImpact": "LOW", "baseScore": 4.7, "baseSeverity": "MEDIUM"}, "exploitabilityScore": 1.2, "impactScore": 3.4}]}, "weaknesses": [{"source": "security@huntr.dev", "type": "Primary", "description": [{"lang": "en", "value": "CWE-79"}]}, {"source": "nvd@nist.gov", "type": "Secondary", "description": [{"lang": "en", "value": "CWE-79"}]}], "configurations": [{"nodes": [{"operator": "OR", "negate": false, "cpeMatch": [{"vulnerable": true, "criteria": "cpe:2.3:a:phpmyfaq:phpmyfaq:*:*:*:*:*:*:*:*", "versionEndExcluding": "3.1.12", "matchCriteriaId": "653EC167-06FC-4D30-AAF8-B75F596519AE"}]}]}], "references": [{"url": "https://github.com/thorsten/phpmyfaq/commit/d773df925cb74e874527458beed1f66f966ec491", "source": "security@huntr.dev", "tags": ["Patch"]}, {"url": "https://huntr.dev/bounties/529f2361-eb2e-476f-b7ef-4e561a712e28", "source": "security@huntr.dev", "tags": ["Exploit", "Patch"]}]}, "github_commit_url": "https://github.com/thorsten/phpmyfaq/commit/d773df925cb74e874527458beed1f66f966ec491"}}